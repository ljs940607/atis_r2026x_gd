/*!  Copyright 2018 Dassault Systemes. All rights reserved. */
"use strict";define("DS/i3DXRDFGroupViewer/js/Viewer/SkeletonConfiguration/IdCardsOptions",["DS/W3DXComponents/Skeleton","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/i3DXRDFGroupViewer/assets/nls/group"],(function(e,t,n){return{getMyGroupsIdCardOptions:function(r){var i=r.platformId,s=r.model.get("@id");return s.includes("<")||s.includes(">")||(s=`<${s}>`),{actions:function(){var e=[];return"OnPremise"!==i&&e.push({text:n.get("action.openWith"),icon:"fonticon fonticon-open",handler:function(e,n){t.getServiceUrl({serviceName:"3DDashboard",platformId:i,onComplete:function(e){let t=e+"/#app:X3DRDUG_AP/content:groupURI="+encodeURIComponent(s);t+="&tenant="+encodeURIComponent(i),window.open(t,"_top")}})}}),e},thumbnail:function(){return{squareFormat:!1,url:this.get("image")}},attributesMapping:{title:function(){return this.escape("name")},ownerName:function(){return this.get("owner")?this.get("owner").givenName+" "+this.get("owner").familyName:""},description:function(){return this.get("memberCount")+" "+n.get("tile.member")}},facets:function(){return[{name:"members",text:n.get("facet.members"),icon:"users",handler:e.getRendererHandler("membersRenderer")},{name:"properties",text:n.get("facet.properties"),icon:"doc-text",handler:e.getRendererHandler("groupPropertiesRenderer")}]}}}}})),define("DS/i3DXRDFGroupViewer/js/Viewer/Models/GroupModel",["UWA/Class/Model","DS/WebappsUtils/WebappsUtils"],(function(e,t){var n,r,i,s=t.getWebappsAssetUrl("i3DXRDFGroupViewer","img/default-group.png");return e.extend({idAttribute:"@id",defaults:{name:"",description:"",groupMembers:[],memberCount:0,image:s,readOnly:!1},setup:function(e,t){n=t.usersGroupURL,r=t.platformId,i=t.customRequest},urlRoot:function(){return"OnPremise"===r?n+"/group":n+"/resources/v1/usersgroup"},url:function(){var e=this._parent();return"OnPremise"===r?e+"?$mask=dsaccess:Mask.GroupUI.Properties&select=title&select=description&select=uri&select=members&select=membersfullname&select=modified":e+"/properties"},sync:function(e,t,n){n.ajax=i,this._parent(e,t,n)},parse:function(e,t){var n=e,i=n.owner;return"OnPremise"===r?{"@id":n.uri,name:n.title,description:n.description,groupMembers:n.members?n.members:[],memberCount:n.members?n.members.length:0,owner:{"@id":i,givenName:i.firstname,familyName:i.lastname},modified:n.modified}:{"@id":n.uri,name:n.title,description:n.description,memberCount:n.memberCount,owner:i?{"@id":i.id,givenName:i.givenName?i.givenName:"",familyName:i.familyName?i.familyName:""}:{},modified:n.modificationDate?n.modificationDate:"",maturity:n.maturity&&n.maturity.name?n.maturity.name:""}}})})),define("DS/i3DXRDFGroupViewer/js/Viewer/Models/MemberModel",["UWA/Class/Model","DS/WebappsUtils/WebappsUtils"],(function(e,t){var n=t.getWebappsAssetUrl("i3DXRDFGroupViewer","img/default-member.png");return e.extend({idAttribute:"@id",defaults:{image:n},parse:function(e,t){return{"@id":e["@id"],givenName:e.givenName&&e.givenName.member?e.givenName.member.filter((function(e){return""!==e}))[0]:"",familyName:e.familyName&&e.familyName.member?e.familyName.member.filter((function(e){return""!==e}))[0]:"",accountName:e.accountName||e.mbox||""}}})})),define("DS/i3DXRDFGroupViewer/js/Viewer/Views/GroupProperties",["DS/UIKIT/Form","UWA/Class/View","DS/W3DXComponents/Views/Layout/ScrollView","i18n!DS/i3DXRDFGroupViewer/assets/nls/group"],(function(e,t,n,r){return t.extend({tagName:"div",className:"group-properties",setup:function(e){this.form=this.buildForm(),this.form.disable(),this.elements.formScrollView=new n({view:this.form,useInfiniteScroll:!1,usePullToRefresh:!1})},buildForm:function(){var t=[{type:"text",name:"name",label:r.get("form.name"),value:this.model.get("name")},{type:"text",multiline:!0,rows:5,name:"description",label:r.get("form.description"),value:this.model.get("description")},{type:"text",name:"owner",label:r.get("form.owner")},{type:"text",name:"modified",label:r.get("form.modified"),value:this.model.get("modified")},{type:"text",name:"groupURI",label:r.get("form.groupURI"),value:this.model.get("@id")}];"OnPremise"!==this.options.platformId&&t.splice(3,0,{type:"text",name:"maturity",label:r.get("form.maturity"),value:this.model.get("maturity")});var n=new e({fields:t});return n.setValue("owner",this.model.get("owner").givenName+" "+this.model.get("owner").familyName),n.render=function(){},n.container=n.elements.container,n.container.addClassName("form-properties"),console.log(n.container),n},destroy:function(){this.stopListening(),this.model=null,this.form=null,this._parent()},render:function(){return this.elements.formScrollView.render().inject(this.container),this}})})),define("DS/i3DXRDFGroupViewer/js/Viewer/Models/MemberModelOnPremise",["UWA/Class/Model","DS/WebappsUtils/WebappsUtils"],(function(e,t){var n=t.getWebappsAssetUrl("i3DXRDFGroupViewer","img/default-member.png");return e.extend({defaults:{image:n,givenName:"",familyName:"",accountName:""},parse:function(e,t){return{givenName:e.firstname?e.firstname:"",familyName:e.lastname?e.lastname:"",accountName:e.name?e.name:""}}})})),define("DS/i3DXRDFGroupViewer/js/Viewer/Collections/MemberCollection",["UWA/Class/Collection","DS/i3DXRDFGroupViewer/js/Viewer/Models/MemberModel"],(function(e,t){var n,r,i="dsaccess:Mask.GroupUI.Members",s="";return e.extend({model:t,setup:function(e,t){this._parent(e,t),n=t._modelKey;var i=t.usersGroupURL;this.swymURL=t.swymURL,r=t.customRequest,this.url=i+"/v1/resources/"+n.id+"/groupMembers",this.state={hasNextPage:!0,skip:0,itemsPerPage:50}},sync:function(e,t,n){n.ajax=r,this._parent(e,t,n)},fetch:function(e){var t=this.state.itemsPerPage;e.pattern?(s=e.pattern,i="dsaccess:Mask.GroupUI.UserInfo",this.url.includes("/3drdfpersist/v1/resources/")&&(this.url=this.url.replace("/3drdfpersist/v1/resources/","/3drdfpersist/resources/v1/usersgroup/"))):(s="",i="dsaccess:Mask.GroupUI.Members",this.url.includes("/3drdfpersist/resources/v1/usersgroup/")&&(this.url=this.url.replace("/3drdfpersist/resources/v1/usersgroup/","/3drdfpersist/v1/resources/"))),e.getNextPage?e.getNextPage&&(this.state.skip+=t):(this.state.skip=0,this.state.hasNextPage=!0),e.data=s?{$mask:i,$skip:this.state.skip,$top:t,pattern:s}:{$mask:i,$skip:this.state.skip,$top:t,$orderby:"familyName"},e.onTimeout&&(e.onTimeout=e.onTimeout.bind(this)),this._parent(e)},parse:function(e){var t=e.member;return t&&t.length||(this.state.hasNextPage=!1),t},onAdd:function(e,t,n){this.swymURL&&e.set("image",this.swymURL+"/api/user/getpicture/login/"+e.get("accountName"))}})})),define("DS/i3DXRDFGroupViewer/js/Viewer/Collections/MemberCollectionOnPremise",["UWA/Class/Collection","DS/i3DXRDFGroupViewer/js/Viewer/Models/MemberModelOnPremise"],(function(e,t){var n,r,i="?select=members&select=membersfullname",s="";return e.extend({model:t,setup:function(e,s){var a=this;this._parent(e,s),n=s._modelKey,r=s.customRequest;let o=s.usersGroupURL;(s.groupMembers?s.groupMembers:[]).map((e=>a.add(new t({givenName:e.firstname,familyName:e.lastname,accountName:e.name}))));let c=o+"/group/"+n.id;c.includes(i)?this.url=c:this.url=c+i},sync:function(e,t,n){n.ajax=r,this._parent(e,t,n)},fetch:function(e){e.pattern?(s=e.pattern,e.data={pattern:s}):s="",e.onTimeout&&(e.onTimeout=e.onTimeout.bind(this)),this._parent(e)},parse:function(e){return e.members}})})),define("DS/i3DXRDFGroupViewer/js/Viewer/SkeletonConfiguration/RenderersOptions",["UWA/Core","DS/UIKIT/Input/Text","DS/UIKIT/Mask","DS/W3DXComponents/Collections/ActionsCollection","DS/W3DXComponents/Views/EmptyView","DS/W3DXComponents/MemberSet","DS/i3DXRDFGroupViewer/js/Viewer/Collections/MemberCollection","DS/i3DXRDFGroupViewer/js/Viewer/Collections/MemberCollectionOnPremise","DS/i3DXRDFGroupViewer/js/Viewer/Views/GroupProperties","i18n!DS/i3DXRDFGroupViewer/assets/nls/group"],(function(e,t,n,r,i,s,a,o,c,l){function m(e,t,n){t.add({message:n}),e.state.hasNextPage=!1}return{getRenderers:function(u){var d,h,p=u.usersGroupURL,f=u.swymURL,g=u.customRequest,w=u.errorAlert,v=u.onUserClick,C=u.platformId,D="",b={fetchMode:"never",view:c,viewOptions:{errorAlert:w,platformId:C}},N="OnPremise"===C?{collection:o,collectionOptions:{groupMembers:u.model.get("groupMembers")?u.model.get("groupMembers"):[],usersGroupURL:p,customRequest:g},fetchMode:"never",fetchOptions:{onComplete:function(e){n.unmask(d.container)},onFailure:function(e){n.unmask(d.container),m(e,w,l.get("member.fetchError"))},onTimeout:function(){n.unmask(d.container),m(this,w,l.get("member.fetchError"))}},view:s,viewOptions:function(s){return{actions:{collection:function(){return new r([{id:"searchMember",title:l.get("action.searchMember"),icon:"search",overflow:!1}])}},contents:{useInfiniteScroll:!1,usePullToRefresh:!1,headers:[{label:l.get("header.firstName"),property:"header_gname"},{label:l.get("header.lastName"),property:"header_fname"}],emptyView:i,itemViewOptions:{icon:"users",title:l.get("noMembers"),mapping:{title:function(){return this.model.escape("givenName")+" "+this.model.escape("familyName")},header_gname:function(){return this.model.escape("givenName")},header_fname:function(){return this.model.escape("familyName")}}}},events:{onActionClick:function(e,t,n){n.model.get("id");"searchMember"&&(this.searchIcon.addClassName("hide"),this.searchElements.searchMainCtn.removeClassName("hide"))},onRender:function(){(d=this).searchElements={},d.searchElements.searchMainCtn&&d.searchElements.searchMainCtn.destroy(),d.searchElements.searchMainCtn=e.createElement("div",{class:"search-main-container hide"}),d.searchElements.clearBtn=e.createElement("span",{class:"search-view-action search-view-cancel fonticon fonticon-2x fonticon-cancel-squared hide",events:{click:function(){n.mask(d.container),d.searchElements.searchInput.setValue(""),D="",d.collection.reset(),d.collection.fetch({onComplete:function(){n.unmask(d.container)},onFailure:function(){n.unmask(d.container)}}),d.searchElements.clearBtn.addClassName("hide"),d.searchIcon.removeClassName("hide"),d.searchElements.searchMainCtn.addClassName("hide")}}}),d.searchElements.searchBtn=e.createElement("span",{class:"search-view-action search-view-apply fonticon fonticon-2x fonticon-search",events:{click:function(){d.searchElements.searchInput.focus()}}}),d.searchElements.searchAction=e.createElement("div",{class:"search-view-container",html:[d.searchElements.clearBtn,d.searchElements.searchBtn]}),d.searchElements.searchInput=new t({placeholder:l.get("action.searchMember"),className:"search-input",events:{onKeyDown:function(){clearTimeout(h);h=setTimeout((function(){n.mask(d.container);var e=d.searchElements.searchInput.getValue();D=e.trim(),0===e.length?(d.searchElements.clearBtn.addClassName("hide"),d.searchIcon.removeClassName("hide"),d.searchElements.searchMainCtn.addClassName("hide"),d.collection.reset(),d.collection.fetch({onComplete:function(e){n.unmask(d.container)},onFailure:function(){n.unmask(d.container)}})):e.length>=2&&(d.searchElements.clearBtn.removeClassName("hide"),d.collection.reset(),d.collection.fetch({pattern:D,onComplete:function(){n.unmask(d.container)},onFailure:function(){n.unmask(d.container)}}))}),1e3)}}}).inject(d.searchElements.searchAction,"top"),d.searchElements.searchAction.inject(d.searchElements.searchMainCtn,"top")},onRenderSwitcherView:function(e){this.tileIcon=e.container.getElement('input[value="tile"]').parentElement,this.tableIcon=e.container.getElement('input[value="table"]').parentElement,this.tileIcon.addClassName("hide")},onInjected:function(){this.searchIcon=this.actionsView.actionsView.container.getChildren()[0],this.searchElements.searchMainCtn.inject(this.actionsView.actionsView.container,"top")},onSwitch:function(){"table"===this.currentViewId?(this.tableIcon.addClassName("hide"),this.tileIcon.removeClassName("hide")):(this.tileIcon.addClassName("hide"),this.tableIcon.removeClassName("hide"))}}}}}:{collection:a,collectionOptions:{usersGroupURL:p,swymURL:f,customRequest:g},fetchMode:"once",fetchOptions:{onComplete:function(e){n.unmask(d.container)},onFailure:function(e){n.unmask(d.container),m(e,w,l.get("member.fetchError"))},onTimeout:function(){n.unmask(d.container),m(this,w,l.get("member.fetchError"))}},view:s,viewOptions:function(s){return{className:"loading",actions:{collection:function(){return new r([{id:"searchMember",title:l.get("action.searchMember"),icon:"search",overflow:!1}])}},contents:{selectionMode:"",headers:[{label:l.get("header.firstName"),property:"header_gname"},{label:l.get("header.lastName"),property:"header_fname"}],emptyView:i,itemViewOptions:{icon:"users",title:l.get("noMembers"),mapping:{title:function(){return this.model.escape("givenName")+" "+this.model.escape("familyName")},header_gname:function(){return this.model.escape("givenName")},header_fname:function(){return this.model.escape("familyName")}}},useInfiniteScroll:!0,events:{onInfiniteScroll:function(){!function(e,t,n,r){var i=e.collection,s=e.scrollView,a=function(t){s.endLoading(),s.container.offsetParent.removeClassName("loading"),(t&&!i.state.hasNextPage||!t)&&(s.useInfiniteScroll(!1),e.dispatchEvent("infiniteScrollEnd"))};i.state.hasNextPage?i.fetch({pattern:r,getNextPage:!0,remove:!1,onComplete:function(){a(!0)},onFailure:function(){a(!1),m(i,t,n)},onTimeout:function(){a(!1),m(this,t,n)}}):a(!1)}(this,w,l.get("member.fetchError"),D)},onItemViewClick:function(e,t){v&&v(t.model.get("accountName"))}}},events:{onActionClick:function(e,t,n){n.model.get("id");"searchMember"&&(this.searchIcon.addClassName("hide"),this.searchElements.searchMainCtn.removeClassName("hide"))},onRender:function(){(d=this).searchElements={},d.searchElements.searchMainCtn&&d.searchElements.searchMainCtn.destroy(),d.searchElements.searchMainCtn=e.createElement("div",{class:"search-main-container hide"}),d.searchElements.clearBtn=e.createElement("span",{class:"search-view-action search-view-cancel fonticon fonticon-2x fonticon-cancel-squared hide",events:{click:function(){n.mask(d.container),d.searchElements.searchInput.setValue(""),D="",d.collection.reset(),d.collection.fetch({onComplete:function(){n.unmask(d.container)},onFailure:function(){n.unmask(d.container)}}),d.searchElements.clearBtn.addClassName("hide"),d.searchIcon.removeClassName("hide"),d.searchElements.searchMainCtn.addClassName("hide")}}}),d.searchElements.searchBtn=e.createElement("span",{class:"search-view-action search-view-apply fonticon fonticon-2x fonticon-search",events:{click:function(){d.searchElements.searchInput.focus()}}}),d.searchElements.searchAction=e.createElement("div",{class:"search-view-container",html:[d.searchElements.clearBtn,d.searchElements.searchBtn]}),d.searchElements.searchInput=new t({placeholder:l.get("action.searchMember"),className:"search-input",events:{onKeyDown:function(){clearTimeout(h);h=setTimeout((function(){var e=d.searchElements.searchInput.getValue();1!==(D=e.trim()).length&&(n.mask(d.container),0===D.length?(d.searchElements.clearBtn.addClassName("hide"),d.searchIcon.removeClassName("hide"),d.searchElements.searchMainCtn.addClassName("hide"),d.collection.reset(),d.collection.fetch({onComplete:function(){n.unmask(d.container)},onFailure:function(){n.unmask(d.container)}})):D.length>=2&&(d.searchElements.clearBtn.removeClassName("hide"),d.collection.reset(),d.collection.fetch({pattern:D,onComplete:function(){n.unmask(d.container)},onFailure:function(){n.unmask(d.container)}})))}),1e3)}}}).inject(d.searchElements.searchAction,"top"),d.searchElements.searchAction.inject(d.searchElements.searchMainCtn,"top")},onInjected:function(){this.searchIcon=this.actionsView.actionsView.container.getChildren()[0],this.searchElements.searchMainCtn.inject(this.actionsView.actionsView.container,"top"),n.mask(this.container)},onRenderSwitcherView:function(e){this.tileIcon=e.container.getElement('input[value="tile"]').parentElement,this.tableIcon=e.container.getElement('input[value="table"]').parentElement,this.tileIcon.addClassName("hide")},onSwitch:function(){"table"===this.currentViewId?(this.tableIcon.addClassName("hide"),this.tileIcon.removeClassName("hide")):(this.tileIcon.addClassName("hide"),this.tableIcon.removeClassName("hide"))}}}}};return{groupPropertiesRenderer:b,membersRenderer:N}}}})),define("DS/i3DXRDFGroupViewer/js/GroupViewer",["UWA/Class/View","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/UIKIT/Alert","DS/WAFData/WAFData","DS/W3DXComponents/Skeleton","DS/W3DXComponents/Views/EmptyView","DS/UIKIT/Mask","DS/i3DXRDFGroupViewer/js/Viewer/Models/GroupModel","DS/i3DXRDFGroupViewer/js/Viewer/SkeletonConfiguration/RenderersOptions","DS/i3DXRDFGroupViewer/js/Viewer/SkeletonConfiguration/IdCardsOptions","i18n!DS/i3DXRDFGroupViewer/assets/nls/group","css!DS/i3DXRDFGroupViewer/i3DXRDFGroupViewer.css"],(function(e,t,n,r,i,s,a,o,c,l,m){var u,d,h,p,f,g=new n({className:"create-alert",closable:!0,visible:!0,autoHide:!0,messageClassName:"error"}),w=function(e,t){p||(e+=-1===e.indexOf("?")?"?":"&",e+="tenant=dstenant:"+d);var n=t.headers||{};return n["Accept-Language"]=u,"OnPremise"===d&&(n.SecurityContext=f),t.headers=n,r.authenticatedRequest(e,t)};return e.extend({className:"GroupViewer",setup:function(e){d=e.platformId,u=e.language||"en",f=e.securityContext||"VPLMAdmin.MyCompany.Default";var t=e.groupId;h=-1!==t.indexOf("<")&&-1!==t.indexOf(">")?t.slice(t.indexOf("<")+1,t.indexOf(">")):t,p=e.fromSharingView},_buildSkeleton:function(e){e.errorAlert=g;var t=new i(c.getRenderers(e),{rootIdCardOptions:UWA.merge(l.getMyGroupsIdCardOptions(e),{model:e.model}),events:{}});this.bones=t},render:function(){var e=this,n=this.options.onUserClick;return a.mask(e.container),t.getPlatformServices({platformId:d,onComplete:function(t){var r="OnPremise"===d?t["3DSpace"]+"/resources/modeler/pno":t.usersgroup+"/3drdfpersist",i=t["3DSwym"],c=new o({"@id":h},{usersGroupURL:r,platformId:d,customRequest:w});c.fetch({onComplete:function(t,o){if(0!==Object.keys(o).length&&o.uri&&o.title)e._buildSkeleton({model:c,languagePref:u,usersGroupURL:r,swymURL:i,customRequest:w,onUserClick:n,platformId:d}),g.inject(e.container),e.bones.render().inject(e.container);else{new s({icon:"alert",title:m.get("group.notFound")}).render().inject(e.container)}a.unmask(e.container)},onFailure:function(t,n,r){var i=n["@code"];a.unmask(e.container),new s({icon:"alert",title:404===i?m.get("group.notFound"):m.get("group.fetchError")}).render().inject(e.container)}})},onFailure:function(){a.unmask(e.container),new s({icon:"alert",title:m.get("compassError")}).render().inject(e.container)}}),this},destroy:function(){this.bones&&this.bones.destroy(),this._parent()}})}));