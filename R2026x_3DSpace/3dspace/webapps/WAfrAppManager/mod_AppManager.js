var wafrVersion="WAFR2.0";define("DS/WAfrAppManager/mod_AppManager",["UWA/Class/Promise","DS/WAfrUtils/Logger","DS/WAfrUtils/mod_ConcatenationUtils","i18n!DS/WAfrContainer/assets/nls/Notification"],(function(t,e,n,i){"use strict";var o=Object.create(null);const a=n.hasConfigurationFor;var r=function(t){this._options=t};return r.DEFAULT_COMPONENT_NAME="AFR_AppManager",r.prototype.setCurrentConfig=function(t){this._config=t},r.prototype.initialize=function(){this._executionContext=this.getExecutionContext(),this._container=this._executionContext._container;var t=this._executionContext.getComponent(WAfrStandardComponentKey.ModelEvents);if(this._subscriptionsTokens=[],t){var e=this;["onWillLoadApp","onDidLoadApp","onDidFailToLoadApp"].forEach((function(n){let i=t.subscribe({event:n},e[n].bind(e));e._subscriptionsTokens.push(i)}))}return Promise.resolve()},r.prototype.clean=function(){this._executionContext=this.getExecutionContext(),this._container=this._executionContext._container;var t=this._executionContext.getComponent(WAfrStandardComponentKey.ModelEvents);t&&this._subscriptionsTokens.forEach((function(e){t.unsubscribe(e)}))},r.prototype.onWillLoadApp=function(t){this._appId=t,this._sourceApp=this._executionContext.getSourceApp()},r.prototype.onDidLoadApp=function(){if(void 0===this._executionContext._masterAppId){var t=this._executionContext.getSourceApp();void 0===t.options.brand&&(this._container._view.getValue("brand")?t.options.brand=this._container._view.getValue("brand"):this._container._view.getTitleHeader().brand&&(t.options.brand=this._container._view.getTitleHeader().brand));var e=this._executionContext.getComponent(WAfrStandardComponentKey.NotificationManager);this._appId=t.getId();var n=this._sourceApp?this._sourceApp.getTitle()||this._container._view.getTitleHeader().appTitle||this._sourceApp.getId():null,o=this._container._view.getValue("afrExecutionContexts");if(!o)throw new Error("The persisted contexts must not be undefined");o[this._container._currentExecutionContext].currentappId=t.getId(),this._container._view.setValue("afrCode",t.getIdCard().afrCode),this._container._view.setValue("afrExecutionContexts",o.slice()),this._container._view.setValue("afrCurrentExecutionContextIdx",this._container._currentExecutionContext),this._container._view.setValue("afrAppId",t.getAfrAppId()),this._container._view.setValue("appId",t.getId()),this._container._view.setValue("afrPrdId",t.getId()),this._container._view.setBrand(t.options.brand),this._container._view.setValue("appTitle",t.getTitle()),this._container.updateAppTitle(t.getTitle()),this._container.updateTitle({title:this._container.productTitle},t),this._container._view.setValue("brand",t.getBrand()||this._container._view.getValue("brand")),this._container._view.setValue("afrFamily",t.getIdCard().afrFamily),this._container._view.setValue("afrTransitionsFrom",t.getIdCard().afrTransitionsFrom),this._container._view.setValue("afrTransitionsFromFamily",t.getIdCard().afrTransitionsFromFamily),this._container._view.setValue("afrTransitionsTo",t.getIdCard().afrTransitionsTo),this._container._view.setValue("afrTransitionsToFamily",t.getIdCard().afrTransitionsToFamily),this._container._view.setValue("afrStdConf",t.getIdCard().stdConf);var r=t.getTitle(),s={containerId:this._container.id,contextId:this._executionContext.getId(),targetApp:{options:t.options}};s.targetApp.options.appConfig.appId=t.getId(),this._container.publish("onAppReady."+this._appId,s);if(a(t.getIdCard(),"a2x"))this._container._view.setValue("nativeInformation",t.getNativeInformation()),this._container._view.setValue("defaultPage",t.isDefaultPage()),this._container.publish("TransEnd",s);else if(n){var p,c={};p="WAfrTransitionSuccessful",c[0]=r,c[1]=n;var d=i.get(p+".message"),_=i.get(p+".title");c&&d&&(d=i.replace(d,c)),e&&e.notifySuccess({title:_,message:d})}this._appId=null,this._sourceApp=null}},r.prototype.onDidFailToLoadApp=function(t){const n=this._executionContext.getComponent(WAfrStandardComponentKey.NotificationManager),o=this._executionContext.getTargetApp()&&this._executionContext.getTargetApp().getTitle(),a={containerId:this._container.id,contextId:this._executionContext.getId()};let r=this._sourceApp?"WAfrTransitionFailed":"WAfrLoadingFailed";var s={0:o};if(o){s[1]=t&&t.message||"";var p=i.get(r+".message");p=i.replace(p,s);var c=i.get(r+".title");n&&n.notifyError({title:c,message:p})}t&&(e.severe("Error when loading configuration \n"+t.stack),a.error={name:t?t.name:"Error",message:t?t.message:""}),this._container.publish("onAppFail."+this._appId,a)},r.prototype.createExposedComponent=function(){return{launchApp:this.getExecutionContext()._container.launchApp.bind(this.getExecutionContext()._container)}},o.AppManager=r,o}));