define("DS/CAT3DWText/CAT3DWTextCommonConstants",[],(function(){"use strict";return{defaultTextPadding:{top:0,bottom:0,left:2,right:2},defaultTextWithBackgroundColorPadding:{top:5,bottom:5,left:10,right:10},defaultTextPaddingWithShape:{top:0,bottom:0,left:0,right:0},defaultTextWidth:330,defaultStickyNoteWidth:180,defaultStickyNoteHeight:180,defaultStickyNoteScaleFactor:.4,defaultTextScaleFactor:1}})),define("DS/CAT3DWText/CAT3DWTextArea",["UWA/Core","DS/CAT3DWInfraUI/CAT3DWPointerEvents","DS/CoreEvents/Events","DS/Utilities/Color","css!DS/CAT3DWText/CAT3DWText"],(function(t,e,i,n){"use strict";var a=t.Class.extend({init:function(){this._mainContainer=new t.Element("div",{class:"CAT3DWTextArea-Container"}),this._mainButtonsContainer=new t.Element("div",{class:"CAT3DWTextArea-ButtonsContainer"}),this._autoresizeFlag=!0,this.manipulateContentOnChgCallback=!0,this._moveable=!1,this._scaleTextStep=.1,this._defaultFontSize=22,this._defaultLineHeight=30},createTextarea:function(){return this._textarea=document.createElement("textarea"),this._textarea.classList.add("CAT3DWTextArea"),this._textarea.autofocus=!0,this._onChangeCB=this._onChange.bind(this),this._onPasteCB=this._onPaste.bind(this),this._textarea.addEventListener("paste",this._onPasteCB),this._textarea.addEventListener("input",this._onChangeCB),this._mainContainer.appendChild(this._textarea),this._mainButtonsContainer.inject(this._mainContainer),this._moveManipulator=new t.Element("div",{class:"CAT3DWTextArea-MoveManipulator CAT3DSKButton-container",html:[{tag:"span",class:"MoveManipulator-icon CAT3DSKButton-icon fonticon fonticon-arrow-double-combo "}]}).inject(this._mainButtonsContainer),this._resizeManipulator=new t.Element("div",{class:"CAT3DWTextArea-ResizeManipulator CAT3DSKButton-container",html:[{tag:"span",class:"ResizeManipulator-icon  CAT3DSKButton-icon fonticon fonticon-double-arrow-horizontal "}]}).inject(this._mainButtonsContainer),this._onManipulateCB=this._onManipulate.bind(this),this._onBeginManipulateCB=this._onBeginManipulate.bind(this),this._onEndManipulateCB=this._onEndManipulate.bind(this),this._onBeginMoveCB=this._onBeginMove.bind(this),document.addEventListener(e.POINTERMOVE,this._onManipulateCB),this._resizeManipulator.addEventListener(e.POINTERDOWN,this._onBeginManipulateCB),this._moveManipulator.addEventListener(e.POINTERDOWN,this._onBeginMoveCB),document.addEventListener(e.POINTERUP,this._onEndManipulateCB),this._mainContainer},setOnChangeCallback:function(t){this._onChnageTextAreaCB=t},setOnMoveCB:function(t){this._onMoveTextAreaCB=t},focus:function(){this._textarea.focus()},getContainer:function(){return this._mainContainer},getTextArea:function(){return this._textarea},getRawText:function(){return this._textarea.value},getDimensions:function(){let t=this._textarea.offsetWidth;return parseFloat(this._textarea.style.width)>0&&(t=Math.max(this._textarea.offsetWidth,parseFloat(this._textarea.style.width))),{width:t,height:this._textarea.offsetHeight}},getFontSize:function(){let t=this._textarea.style.fontSize.replace("px","");return Number(t)},getLineHeight:function(){let t=this._textarea.style.lineHeight.replace("px","");return Number(t)},getScale:function(){if(this._mainContainer)return parseFloat(this._mainContainer.style.scale)},_getContainerPosition:function(){let t=this.getContainer().style.left.replace("px",""),e=this.getContainer().style.top.replace("px","");return{x:Number(t),y:Number(e)}},getTopLeftCorner:function(){let t=this._textarea.getBoundingClientRect(),e=this._mainContainer.style.transform,i=0,n=0;return e&&this._mainContainer.style.transform.includes("rotate")&&(e=this._mainContainer.style.transform.slice(this._mainContainer.style.transform.indexOf("rotate")),e=e.replace("rotate(",""),e=e.replace("deg)",""),e=parseFloat(e),e=e*Math.PI/180,e<0?i=Math.sin(-1*e)*this._textarea.offsetWidth*parseFloat(this._mainContainer.style.scale):n=Math.sin(e)*this._textarea.offsetHeight*parseFloat(this._mainContainer.style.scale)),{x:t.x+n,y:t.y+i}},getBottomRightCorner:function(){let t=this._textarea.getBoundingClientRect(),e=this._mainContainer.style.transform,i=0,n=0;return e&&this._mainContainer.style.transform.includes("rotate")?(e=this._mainContainer.style.transform.slice(this._mainContainer.style.transform.indexOf("rotate")),e=e.replace("rotate(",""),e=e.replace("deg)",""),e=parseFloat(e),e=e*Math.PI/180,e<0?(i=Math.sin(-1*e)*this._textarea.offsetHeight*parseFloat(this._mainContainer.style.scale),n=t.width):(n=Math.cos(e)*this._textarea.offsetWidth*parseFloat(this._mainContainer.style.scale),i=t.height)):(n=t.width,i=t.height),{x:t.x+n,y:t.y+i}},getCenter:function(){let t=this._textarea.getBoundingClientRect();return{x:t.x+t.width/2,y:t.y+t.height/2}},setProperties:function(t){if(t){if(void 0!==t.autoresize&&(this._autoresizeFlag=t.autoresize),this._autoresizeFlag||(this._resizeManipulator.style.display="none"),void 0!==t.manipulateContentOnChgCallback&&(this.manipulateContentOnChgCallback=t.manipulateContentOnChgCallback),void 0!==t.moveable&&(this._moveable=t.moveable),this._moveable||(this._moveManipulator.style.visibility="hidden"),void 0!==t.autoresize&&0==t.autoresize&&void 0!==t.moveable&&0==t.moveable&&(this._mainButtonsContainer.style.display="none"),t.placeholder&&(this._textarea.placeholder=t.placeholder),t.cols&&(this._textarea.cols=t.cols),t.rows&&(this._textarea.rows=t.rows),t.text&&(this._textarea.value=t.text),t.fontSize&&(this._textarea.style.fontSize=t.fontSize+"px"),t.lineHeight&&(this._textarea.style.lineHeight=t.lineHeight+"px"),t.padding&&(this._textarea.style.paddingLeft=t.padding.left+"px",this._textarea.style.paddingRight=t.padding.right+"px",this._textarea.style.paddingBottom=t.padding.bottom+"px",this._textarea.style.paddingTop=t.padding.top+"px"),t.translate&&(this._mainContainer.style.transform=t.translate),t.angle&&(this._mainContainer.style.transform=this._mainContainer.style.transform+"rotate("+t.angle+"deg)"),t.backgroundColor&&(this._textarea.style.backgroundColor=t.backgroundColor),t.clearBackgroundColor&&(this._textarea.style.backgroundColor=""),t.whiteSpace&&(this._textarea.style.whiteSpace=t.whiteSpace),t.color){let e,i,a;if(this._textarea.style.color=t.color,t.color.startsWith("#"))({r:e,g:i,b:a}=n.hexToRgb(t.color));else{const n=t.color.match(/\d+(\.\d+)?/g);if(!n)return null;[e,i,a]=n.map(Number)}Math.sqrt((e-255)**2+(i-255)**2+(a-255)**2)<=25&&(this._textarea.style.backgroundColor="#000000")}t.width&&(this._textarea.style.width=t.width+"px"),t.height&&(this._textarea.style.height=t.height+"px"),t.borderColor&&(this._textarea.style.borderColor=t.borderColor),t.fontStyle&&(this._textarea.style.fontStyle=t.fontStyle),t.fontWeight&&(this._textarea.style.fontWeight=t.fontWeight),t.textAlign&&(this._textarea.style.textAlign=t.textAlign),t.fontFamily&&(this._textarea.style.fontFamily=t.fontFamily),t.scale&&(this._mainContainer.style.scale=t.scale,this._displayButtonsWithAFixedSize(t.scale))}},isEmpty:function(){return""===this.getRawText()},fitToContent:function(){this._autoResizeHeight=!0,this.autoResizeHeight()},fitToContainer:function(){this._textarea.scrollHeight>this._textarea.clientHeight?(this._scaleText(1-this._scaleTextStep),this.fitToContainer()):this._textarea.scrollHeight===this._textarea.clientHeight&&this.getFontSize()!==this._defaultFontSize&&(this._scaleText(1+this._scaleTextStep),this._textarea.scrollHeight>this._textarea.clientHeight?this._scaleText(1-this._scaleTextStep):this.fitToContainer())},_onChange:function(){this.manipulateContentOnChgCallback&&(this._autoresizeFlag?this.fitToContent():this.fitToContainer()),this._onChnageTextAreaCB&&this._onChnageTextAreaCB()},_onBeginManipulate:function(t){t.preventDefault(),this._autoresizeFlag&&(this._autoResizeHeight=!0,this._manipulate=!0,this._lastManipulatorPos={x:t.clientX,y:t.clientY},this._lastTextAreaDimensions=this.getDimensions())},_onBeginMove:function(t){t.preventDefault(),this._moveable&&(this._move=!0,this._lastMoveBtnPos={x:t.clientX,y:t.clientY},this._lastContainerPos=this._getContainerPosition())},_onManipulate:function(t){if(this._manipulate&&this._autoresizeFlag){this._textarea.disabled="disabled",this._textarea.blur();let e=t.clientX-this._lastManipulatorPos.x,i=t.clientY-this._lastManipulatorPos.y,n=parseFloat(this._mainContainer.style.scale),a=null,o=null;o=i,a=e;let s=this._lastTextAreaDimensions.width+a/n,r=this._lastTextAreaDimensions.height+o/n;this._textarea.style.height=r+"px",this._textarea.style.width=s+"px"}else if(this._move){this._textarea.disabled="disabled",this._textarea.blur();let e=t.clientX-this._lastMoveBtnPos.x,i=t.clientY-this._lastMoveBtnPos.y,n=this._lastContainerPos.x+e,a=this._lastContainerPos.y+i;this.getContainer().setStyle("left",n+"px"),this.getContainer().setStyle("top",a+"px")}i.publish({event:"CAT3DSKEndManipulationText"})},_onEndManipulate:function(){this._textarea.disabled="",this.focus(),this._manipulate&&this._autoresizeFlag?(this._manipulate=!1,this.autoResizeHeight()):this._move&&(this._move=!1,this._onMoveTextAreaCB&&this._onMoveTextAreaCB()),i.publish({event:"CAT3DSKEndManipulationText"})},_onPaste:function(){this._autoresizeFlag&&setTimeout(function(){this.autoResizeWidth(),this.fitToContent()}.bind(this),10)},autoResizeWidth:function(){if(this._autoresizeFlag)for(;this._isNotInViewport(this._textarea);){let t=this._textarea.getBoundingClientRect();if(t.width>=window.innerWidth/2)break;let e=parseFloat(this._mainContainer.style.scale);this._textarea.style.width=1.5*t.width/e+"px",this.fitToContent()}},autoResizeHeight:function(){this._autoresizeFlag&&this._autoResizeHeight&&(this._textarea.style.height="auto",this._textarea.style.height=this._textarea.scrollHeight+"px",this._autoResizeHeight=!1)},_isNotInViewport:function(t){let e=t.getBoundingClientRect();return!(e.top>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight))},_scaleText:function(t){let e=this.getFontSize(),i=Math.round(e*t);i>this._defaultFontSize&&(i=this._defaultFontSize);let n=this.getLineHeight(),a=Math.round(n*t);a>this._defaultLineHeight&&(a=this._defaultLineHeight),this._textarea.style.fontSize=i+"px",this._textarea.style.lineHeight=a+"px"},_displayButtonsWithAFixedSize:function(t){let e=42;this._mainButtonsContainer.style.height=e/t+"px",this._moveManipulator.setStyles({height:e/t+"px",width:e/t+"px","min-height":e/t+"px","min-width":e/t+"px","box-shadow":"0 0 "+3/t+"px rgba(0, 0, 0, 0.5)"}),this._moveManipulator.firstChild.setStyles({"font-size":18/t+"px"}),this._resizeManipulator.setStyles({height:e/t+"px",width:e/t+"px","min-height":e/t+"px","min-width":e/t+"px","box-shadow":"0 0 "+3/t+"px rgba(0, 0, 0, 0.5)",right:-21/t+"px"}),this._resizeManipulator.firstChild.setStyles({"font-size":18/t+"px"})},unsubscribeAllTextInputEvents:function(){this._textarea.removeEventListener("input",this._onChangeCB),this._textarea.removeEventListener("paste",this._onPasteCB),this._onPasteCB=null,this._onChangeCB=null,this._resizeManipulator.removeEventListener(e.POINTERDOWN,this._onBeginManipulateCB),this._moveManipulator.removeEventListener(e.POINTERDOWN,this._onBeginMoveCB),document.removeEventListener(e.POINTERMOVE,this._onManipulateCB),document.removeEventListener(e.POINTERUP,this._onEndManipulateCB),this._onBeginManipulateCB=null,this._onManipulateCB=null,this._onEndManipulateCB=null,this._onMoveTextAreaCB=null,this._onChnageTextAreaCB=null},destroy:function(){this.unsubscribeAllTextInputEvents(),this._mainContainer&&this._mainContainer.destroy(),this._mainContainer=null}});return t.namespace("DS/CAT3DWText/CAT3DWTextArea",a)})),define("DS/CAT3DWText/CAT3DWTextRenderService",["UWA/Class","UWA/Core","DS/CAT3DWInfraUI/CAT3DWCanvasServices","WebappsUtils/WebappsUtils","DS/CAT3DWInfra/CAT3DWPreferenceManager"],(function(t,e,i,n,a){"use strict";var o=t.extend({init:function(){this._parent()},loadTextboxFont:function(){return new Promise(function(t){var e=[{name:"GochiHand",src:"GochiHand-Regular.ttf"},{name:"Alphabet Caps Lined",src:"AlphabetCapsLined.woff2"},{name:"dsbold",src:"3dsBold.woff2"},{name:"dslight",src:"3dslight.woff2"},{name:"Alex Brush",src:"AlexBrush-Regular.woff2"},{name:"AmaticSC",src:"AmaticSC-Regular.ttf"},{name:"Archicoco",src:"Archicoco.woff2"},{name:"Archivo Narrow",src:"ArchivoNarrow-Regular.woff2"},{name:"Arimo",src:"Arimo-Regular.woff2"},{name:"Barrio",src:"Barrio-Regular.woff2"},{name:"Bebas Neue",src:"BebasNeue.woff2"},{name:"Beon",src:"Beon-Regular.woff2"},{name:"Carpathe",src:"CarpatheRegular.woff2"},{name:"Cooper Hewitt",src:"CooperHewitt-Light.woff2"},{name:"Crass Roots Ofl",src:"CRASS-ROOTS-OFL.woff2"},{name:"Datalegreya Gradient",src:"Datalegreya-Gradient.woff2"},{name:"Fantasque",src:"FantasqueSansMono-Regular.woff2"},{name:"Fira Mono",src:"FiraMono-Regular.woff2"},{name:"Genome",src:"Genome-Thin.woff2"},{name:"Gnu TypeWriter",src:"gtw.woff2"},{name:"Hussar Print",src:"HussarPrintA.woff2"},{name:"LedFont sharP",src:"ledfont-sharp-Regular.woff2"},{name:"Lindbergh Baby",src:"Lindbergh_Baby.woff2"},{name:"Marapfhont",src:"Marapfhont.woff2"},{name:"Monodeco",src:"Monodeco.woff2"},{name:"Montserrat",src:"Montserrat-Regular.woff2"},{name:"Now",src:"Now-Regular.woff2"},{name:"Pinyon Script",src:"PinyonScript-Regular.woff2"},{name:"Raleway",src:"Raleway-Regular.woff2"},{name:"Roundstyle",src:"RoundStyleBasic.woff2"},{name:"Some Time Later",src:"SomeTimeLater.woff2"},{name:"Unique",src:"Unique.woff2"},{name:"Xolonium",src:"Xolonium-Regular.woff2"}],i=[];for(let t=0;t<e.length;t++)i.push(this._loadFont(e[t]));Promise.all(i).then((function(){t()}))}.bind(this))},_loadFont:function(t){return new Promise((function(i){var o=n.getWebappsAssetUrl("CAT3DWText","fonts/"+t.src),s=null;if(a.getPreferenceValue("M3DEMobile")){var r=e.Data.proxifyUrl(o,{proxy:"passport"});s=new FontFace(t.name,"url("+r+') format("woff2")')}else s=new FontFace(t.name,"url("+o+') format("woff2")');s.load().then((function(){document.fonts.add(s),i()})).catch((function(){console.error("failed to load font : "+t.name),i()}))}))},renderTextToCanvas:function(t){return new Promise(function(e){var n=(new i).createCanvas({width:t.width*t.scale,height:t.height*t.scale,tag:"textCanvas"});let a=n.getContext("2d");if(t.backgroundColor?(a.fillStyle=t.backgroundColor,a.strokeStyle=t.backgroundColor,a.roundRect(0,0,n.width,n.height,10),a.fill()):(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=1*window.devicePixelRatio,a.shadowColor="white"),t.borderColor){let e=5;a.beginPath(),a.strokeStyle=t.borderColor,a.lineWidth=e,a.roundRect(e/2,e/2,n.width-e,n.height-e,10),a.stroke()}a.textBaseline="top";let o=t.fontStyle+" ";o+=t.fontWeight+" ",o+=t.fontSize*t.scale+"px ",o+=t.fontFamily,a.font=o,a.fillStyle=t.color||"black",a.strokeStyle=t.color||"black",a.textAlign=t.textAlign;var s=n.width-t.padding.left*t.scale-t.padding.right*t.scale,r=t.lineHeight*t.scale,l=0;"left"===t.textAlign?l=t.padding.left*t.scale:"center"===t.textAlign?l=n.width/2:"right"===t.textAlign&&(l=n.width-t.padding.right*t.scale);var h=r/(6.5*window.devicePixelRatio)+t.padding.top*t.scale,u=[];t.text&&(u=t.text.split(" "));var c="";for(let t=0;t<u.length;t++){let e=u[t];if(-1!==e.indexOf("\n")){let t=this._drawWordWithLineBreak(e,a,s,r,l,h,c);c=t.addtxt,h=t.y_pos}else{let t=this._drawWord(e,a,s,r,l,h,c);c=t.addtxt,h=t.y_pos}}a.fillText(c,l,h),e(n)}.bind(this))},_drawWord:function(t,e,i,n,a,o,s){var r=s,l=o;let h=r+t,u=e.measureText(h).width,c=e.measureText(t).width;if(u>i)if(-1!==t.indexOf("-")){let o=this._drawWordWidthSpecialChar("-",t,e,i,n,a,l,r);r=o.addtxt,l=o.y_pos}else if(c>i){let o=this._drawLongWord(t,e,i,n,a,l,r," ");r=o.addtxt,l=o.y_pos}else e.fillText(r,a,l),r=t+" ",l+=n;else r=h+" ";return{addtxt:r,y_pos:l}},_drawWordWidthSpecialChar:function(t,e,i,n,a,o,s,r){var l=r,h=s;let u=e.split(t);for(let e=0;e<u.length;e++){let s=e===u.length-1?" ":t,r=u[e],c=l+r+s,d=i.measureText(c).width,f=i.measureText(r).width;if(d>n)if(f>n){i.fillText(l,o,h),l="",h+=a;let t=this._drawLongWord(r,i,n,a,o,h,l,s);l=t.addtxt,h=t.y_pos}else i.fillText(l,o,h),l=r+s,h+=a;else l=c}return{addtxt:l,y_pos:h}},_drawLongWord:function(t,e,i,n,a,o,s,r){var l=s,h=o;let u=Array.from(t);for(let t=0;t<u.length;t++){let o=u[t],s=t===u.length-1?r:"",c=l+o;e.measureText(c).width>i?(e.fillText(l,a,h),l=o+s,h+=n):l=c+s}return{addtxt:l,y_pos:h}},_drawWordWithLineBreak:function(t,e,i,n,a,o,s){var r=s,l=o;let h=t.split("\n");for(let t=0;t<h.length;t++){let o=h[t],s=this._drawWord(o,e,i,n,a,l,r);r=s.addtxt,l=s.y_pos,t===h.length-1?r+="":(e.fillText(r,a,l),r="",l+=n)}return{addtxt:r,y_pos:l}}});return e.namespace("DS/CAT3DWText/CAT3DWTextRenderService",o)})),define("DS/CAT3DWText/CAT3DWTextServices",["UWA/Core"],(function(t){"use strict";const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".toLocaleUpperCase(),i={};var n={BoundTextPadding:5,measureText:function(t,e,i,n=!1){const a=t.split("\n").map((t=>t||" ")).join("\n"),o=parseFloat(i),s=this.getTextHeight(a,o);return{width:this.getTextWidth(a,e,n),height:s}},getTextHeight:function(t,e){return e*this.splitIntoLines(t).length},getTextWidth:function(t,e,i=!1){const n=this.splitIntoLines(t);let a=0;return n.forEach((t=>{a=Math.max(a,this.getLineWidth(t,e,i))})),a},splitIntoLines:function(t){return this.normalizeText(t).split("\n")},normalizeText:function(t){return this.normalizeEOL(t).replace(/\t/g,"        ")},normalizeEOL:function(t){return t.replace(/\r?\n|\r/g,"\n")},getLineWidth:function(t,e,i=!1){let n=document.createElement("canvas").getContext("2d");n.font=e;const a=n.measureText(t),o=a.width;if(!i&&window.TextMetrics&&"actualBoundingBoxLeft"in window.TextMetrics.prototype&&"actualBoundingBoxRight"in window.TextMetrics.prototype){const t=Math.abs(a.actualBoundingBoxLeft)+Math.abs(a.actualBoundingBoxRight);return Math.max(t,o)}return o},getApproxMinLineWidthInShape:function(t){return this.getTextWidth(e.split("").join("\n"),t,!1)+10},getApproxMinLineHeightInShape:function(t){return parseFloat(t)+10},calculatecharWidth:function(t,e){const n=t.charCodeAt(0);if(i[e]||(i[e]=[]),!i[e][n]){const a=this.getLineWidth(t,e,!1);i[e][n]=a}return i[e][n]},parseTokens:function(t){const e=t.split("-");return e.length>1&&e.forEach(((t,i)=>{i!==e.length-1&&(e[i]=t+="-")})),e.join(" ").split(" ")},wrapText:function(t,e,i){if(!Number.isFinite(i)||i<0)return t;const n=[],a=t.split("\n"),o=this.getLineWidth(" ",e,!1);let s="",r=0;const l=function(t){t.trim()&&n.push(t)},h=function(){s="",r=0};for(const t of a){if(this.getLineWidth(t,e,!1)<=i){n.push(t);continue}const a=this.parseTokens(t);h();let u=0;for(;u<a.length;){const t=this.getLineWidth(a[u],e,!1);if(t===i)l(a[u]),u++;else if(t>i){for(l(s),h();a[u].length>0;){const t=String.fromCodePoint(a[u].codePointAt(0)),n=s+t,o=this.getLineWidth(n,e,!1),h=this.calculatecharWidth(t,e);r=o,a[u]=a[u].slice(t.length),r>=i?(l(s),s=t,r=h):s=n}r+o>=i?(l(s),h()):s.endsWith("-")||(s+=" ",r+=o),u++}else for(;r<i&&u<a.length;){const t=a[u];if(r=this.getLineWidth(s+t,e,!1),r>i){l(s),h();break}u++;const c=!t.endsWith("-");if(s+=t,c&&(s+=" "),r+o>=i){c?n.push(s.slice(0,-1)):n.push(s),h();break}}}" "===s.slice(-1)&&(s=s.slice(0,-1),l(s))}return n.join("\n")},getFontSizeLineHeightToAConfiguration:function(t){return"S"===t?{fontSize:16,lineHeight:22}:"M"===t?{fontSize:22,lineHeight:30}:"L"===t?{fontSize:28,lineHeight:38}:"XL"===t?{fontSize:36,lineHeight:49}:void 0},getfontSizeGroup:function(t){return 16===t?"S":22===t?"M":28===t?"L":36===t?"XL":void 0}};return t.namespace("DS/CAT3DWText/CAT3DWTextServices",n)}));