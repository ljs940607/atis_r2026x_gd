define("DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices",[],(function(){"use strict";var t=function(){var t={};function e(){return window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top:top}return function(n,o){if(t[n])t[n]&&o(t[n]);else if(function(){var t;try{e().document,t=!0}catch(e){t=!1}return t}())try{e().require([n],(function(e){t[n]=e,o(e)}))}catch(e){try{require([n],(function(e){t[n]=e,o(e)}))}catch(t){o(null)}}else try{require([n],(function(e){t[n]=e,o(e)}))}catch(t){o(null)}}}(),e=function(e){t("DS/i3DXCompass/i3DXCompassServices",e)},n=function(e){t("DS/i3DXCompass/i3DXCompass",e)},o=function(e){t("DS/i3DXCompass/ServiceApi/PortfolioApi",e)};return{getPlatformServices:function(t){e((function(e){e?e.getPlatformServices(t):t.onFailure&&t.onFailure()}))},getServiceUrl:function(t){e((function(e){e?e.getServiceUrl(t):t.onFailure&&t.onFailure()}))},getGrantedRoles:function(e){t("DS/i3DXCompass/ServiceApi/GrantedRolesApi",(function(t){t.getGrantedRoles(e)}))},getPortfolioRole:function(t,e){o((function(n){n.getPortolioRole(t,e)}))},getPortolioRole:function(t,e){o((function(n){n.getPortolioRole(t,e)}))},getPlatformConfig:function(t){e((function(e){e?e.getPlatformConfig(t):t.onFailure&&t.onFailure()}))},getUser:function(t){e((function(e){e?e.getUser(t):t.onFailure&&t.onFailure()}))},getAppInfo:function(t){n((function(e){e?e.getAppInfo(t):t.onComplete&&t.onComplete()}))},getAppsInfo:function(t){n((function(e){e?e.getAppsInfo(t):t.onComplete&&t.onComplete()}))},getBusinessMethodApps:function(t){n((function(e){e?e.getBusinessMethodApps(t):t.onComplete&&t.onComplete()}))},getBusinessExperiences:function(t){n((function(e){e?e.getBusinessExperiences(t):t.onComplete&&t.onComplete()}))},searchApplication:function(t){n((function(e){e?e.searchApplication(t):t.onComplete&&t.onComplete()}))},_private:{getParentAPI:t}}})),define("DS/i3DXCompassPlatformServices/i3DXCompassRegistryClient",["UWA/Core","DS/WAFData/WAFData"],(function(t,e){"use strict";var n,o=!1,i={},a={},r=function(t){var e=t.config.url;return e?e+"/api/v1/platform/service/instance":null},s=function(t){var e=t.config.url;return e?e+"/api/v1/platform/public":null},c=function(){return"caches"in window&&!o},u=function(){return n||(n=caches.open("3DCompass-service")),n},p=function(t,e){var n=t.data||t.urlParams;return c()?u().then((function(e){var o=t.url+JSON.stringify(n);return e.match(o)})).then((function(t){return!(!l(t)&&!e)&&(t&&t.json())})):new Promise((function(t,e){t(null)}))},l=function(t){if(!t)return!1;var e=t.headers.get("x-fetched-on");return!!(e&&parseFloat(e)+72e5>(new Date).getTime())},f=function(t,e,n){var o;o=e.serviceId?e.serviceId+e.platformId:e.id,a[o].forEach((function(e){e[t]&&setTimeout(e[t],0,n)})),a[o].length=0},d=function(t,n){var o="",a=window.ds&&"MOBILE"===window.ds.env?e.proxifiedRequest:e.request;if(!(o=n.data?n.data.serviceId?r(t):function(t){var e=t.config.url;return e?e+"/api/v1/platform/instance":null}(t):s(t)))throw new Error("No url found for registryUrl");i[JSON.stringify(n.data)]=!0,a(o,{timeout:15e3,method:"GET",type:"json",headers:{Accept:"application/json","x-requested-with":"registry-client-js-1.0.0"},data:n.data,onComplete:function(e,o){var a,r,s;i[JSON.stringify(n.data)]=!1,e&&(o&&n.data?(a=n,r=e,s=o,c()?u().then((function(t){var e=a.url+JSON.stringify(a.data),n=new Headers(s);return n.append("x-fetched-on",(new Date).getTime()),r&&0===r.length?new Promise((function(t,e){t()})):t.put(e,new Response(JSON.stringify(r),{headers:n}))})):new Promise((function(t,e){t()}))).then((function(){f("onComplete",n.data,e)})):o&&n&&e&&t.onComplete(e))},onFailure:function(){i[JSON.stringify(n.data)]=!1,p(n,!0).then((function(t){t?f("onComplete",n.data,t):f("onFailure",n.data)}))},onTimeout:function(){i[JSON.stringify(n.data)]=!1,p(n,!0).then((function(t){t?f("onComplete",n.data,t):f("onFailure",n.data)}))}})},m=function(t){var e,n={url:r(t)};t.serviceId?(e=t.serviceId.join(",")+t.platformId.join(","),n.data={serviceId:t.serviceId.join(","),platformId:t.platformId.join(",")}):(e=t.platformId.join(","),n.data={id:t.platformId.join(",")}),p(n).then((function(o){o?t.onComplete(o):(a[e]||(a[e]=[]),a[e].push({onComplete:t.onComplete,onFailure:t.onFailure}),i[JSON.stringify(n.data)]||d(t,n))}))};return{getServicesByPlatform:function(t){return new Promise((function(e,n){c()?u().catch((function(){o=!0})).then((function(){m({platformId:t.platforms,serviceId:t.services,config:t.config,onComplete:e,onFailure:n})})):m({platformId:t.platforms,serviceId:t.services,config:t.config,onComplete:e,onFailure:n})}))},getServices:function(t){return new Promise((function(e,n){c()?u().catch((function(){o=!0})).then((function(){m({platformId:[t.platform],config:t.config,onComplete:function(t){e(t[Object.keys(t)[0]])},onFailure:n})})):m({platformId:[t.platform],config:t.config,onComplete:function(t){e(t[Object.keys(t)[0]])},onFailure:n})}))},getAllServicesAllPlatforms:function(t){return new Promise((function(e,n){!function(t){var e={url:s(t)};p(e).then((function(n){n?t.onComplete(n):(a[""]||(a[""]=[]),a[""].push({onComplete:t.onComplete,onFailure:t.onFailure}),d(t,e))}))}({config:t.config,onComplete:e,onFailure:n})}))}}})),define("DS/i3DXCompassPlatformServices/OpenWith",["UWA/Core","UWA/Class","UWA/Utils","DS/i3DXCompassServices/i3DXCompassPubSub","DS/i3DXCompass/Tools","DS/i3DXCompass/Data","DS/i3DXCompass/CacheManager","DS/i3DXCompass/Collection/AppList","i18n!DS/i3DXCompassPlatformServices/assets/nls/openWith","css!DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices.css"],(function(t,e,n,o,i,a,r,s,c){"use strict";var u=null,p=[],l=!1,f=function(){var t={};function e(){return window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top:top}return function(n,o){if(!t[n]&&function(){var t;try{e().document,t=!0}catch(e){t=!1}return t}())try{e().require([n],(function(e){t[n]=e,o(e)}))}catch(e){try{require([n],(function(e){t[n]=e,o(e)}))}catch(t){o(null)}}else t[n]&&o(t[n])}}(),d=function(t){f("DS/i3DXCompass/i3DXCompass",t)};return e.extend({DROPDOWN_CONF:null,init:function(){this._UID="open-with"+n.getUUID().substr(0,6),this._content=null,this._type=!1,this.DROPDOWN_CONF={name:this._UID,fonticon:"open-menu-dot",text:c.OpenWith}},set3DXContent:function(t,e){return this._check3DXContentFormat(t),this._content=t,this._type=!!e,this},setIndex:function(t){return this._index=t,this},render:function(t){var e=this;return t&&(this._dropdown=t),this._index&&(this.DROPDOWN_CONF.index=this._index),this._fetchCompatibleApps((function(t){e._appsList=t,e._addSubMenu()})),this},retrieveCompatibleApps:function(t){var e,n=this;this._fetchCompatibleApps((function(o){n.removeParentItemId=!0,n._appsList=o,e=n._buildItems(),t(e)}))},_fetchCompatibleApps:function(e){var n=this;d((function(o){"undefined"==typeof COMPASS_CONFIG||!COMPASS_CONFIG.myAppsBaseUrl||u||l?l?p.push(e):e(u||o._private._getAppList()):(l=!0,a.myAppsBaseUrl||(a.initialize(COMPASS_CONFIG),r.setup(COMPASS_CONFIG.userId,COMPASS_CONFIG.lang)),o._private._getMyAppsView()||(t.createElement("div",{class:"hidden",id:"compass-id"}).inject(document.body),o.initialize(t.merge(COMPASS_CONFIG,{compassTarget:"compass-id"}))),(u=new s).fetch({onComplete:function(){l=!1,e(u),n._fireCallbacks(u)},onFailure:function(){l=!1,t.log("AppList: onFailure")}}))}))},_buildItems:function(){var e=this,n=[],i=this._getCompatibleApps();return i.length>0&&((i=i.slice(0,4)).forEach((function(t){var o=t.get("icon");t.get("icon")&&t.get("icon").indexOf(".svg")!==t.get("icon").length-4&&(o+=".svg"),n.push({className:"Widget"===t.get("type")?"app-widget app-open-with":"app-open-with",name:t.get("id"),text:t.get("title"),icon:t.get("icon")?o:null,fonticon:t.get("icon")?null:"play",handler:function(){e._launchApp(t)},launchApp:function(){e._launchApp(t)}})})),n.push({name:"more-apps",text:c.moreApps,fonticon:"plus",handler:function(){d((function(n){var i;n.showAccordion(!0),e._content&&e._content.data&&e._content.data.items&&e._content.data.items.length>0&&(i=t.clone(e._content.data.items[0]),e._setObjectEvents(i),!0===e._type&&o.publish("setTypes",e._content))}))}})),n},_fireCallbacks:function(t){p.forEach((function(e){e&&setTimeout(e,0,t)})),p.length=0},_addSubMenu:function(){var e=this,n=this._getCompatibleApps();this._dropdown.removeItem(this._dropdown.getItem(e._UID).id),n.length>0&&(this._dropdown.addItem(t.merge(this.DROPDOWN_CONF,{items:[]})),this._buildItems().forEach((function(t,n){t.parentItemId=e._dropdown.getItem(e._UID).id,e._dropdown.addItem(t)})))},_launchApp:function(e){var n,o=t.clone(this._content.data.items[0]);t.log("_launchApp:"+e.id),t.log("_launchApp:"+this._content),this._content&&(t.is(o.objectType,"array")&&(n=o.objectType.detect((function(t){return e.get("compatibility").indexOf(t)>-1})),o.objectType=n),this._setObjectEvents(o)),this._launchAppEvent(e.id)},_setObjectEvents:function(e){o.publish("setObject",e),o.publish("setX3DContent",t.clone(this._content))},_launchAppEvent:function(e){var n=this,i=n._appsList.get(e);!0===n._type&&i&&i.isNative()?(o.publish("setTypes",n._content),o.publish("setTypesCallback",t.merge({appId:e},n._content)),n._type=!1):o.publish("launchApp",{appId:e,origin:"openWith"},(function(e){var o=n._appsList.get(e.appId);t.log(e),e.error&&o&&d((function(t){t._private._setQuadrant(o.get("quadrant")),t.showAccordion(!0),f("DS/i3DXCompass/EventManager",(function(t){t.dispatchEvent("onShowMessage",c.no_install_compatible),t.dispatchEvent("onHideMessage",5e3)}))}))}))},_getCompatibleMap:function(){var t=this,e=[];return this._appsList.forEach((function(n){n.get("compatibility")&&n.get("compatibility").forEach((function(o){var i=t._removeFirstDot(o.toLowerCase());e[i]||(e[i]=[]),e[i].push(n)}))})),e},_check3DXContentFormat:function(t){if(!(t.data||t.data.items||t.data||t.data.items[0]||t.data.items[0].objectType))throw new Error("Not good format for 3DXContent")},_getContentType:function(){var e,n=this,o=[];if(!this._content)throw new Error("A 3DXContent need to be set");return this._check3DXContentFormat(this._content),e=this._content.data.items[0].objectType,t.is(this._content.data.items[0].objectTaxonomies,"array")?this._content.data.items[0].objectTaxonomies.forEach((function(t){o.push(n._removeFirstDot(t.toLowerCase()))})):"string"==typeof e?o.push(this._removeFirstDot(e.toLowerCase())):t.is(this._content.data.items[0].objectType,"array")&&(t.log("Usage of objectType as array is deprecated!, use objectTaxonomies instead"),e.forEach((function(t){o.push(n._removeFirstDot(t.toLowerCase()))}))),o},_isAvailableAppOnPlatform:function(t){var e=this._content.data.items[0].envId;return!(e&&t.get("platforms")&&t.get("platforms").length>0)||t.get("platforms").detect((function(t){return t.id&&t.id.toLowerCase()===e.toLowerCase()}))},_getCompatibleApps:function(){var t=this._getCompatibleMap(),e=this,n=[];return this._getContentType().forEach((function(o){t[o]&&t[o].forEach((function(t){e._isAvailableAppOnPlatform(t)&&i.pushUnique(n,t)}))})),n.sort((function(t,e){var n=(!0===t.get("isFavorite")?"#":"")+t.get("lowerCaseTitle"),o=(!0===e.get("isFavorite")?"#":"")+e.get("lowerCaseTitle"),i=0;return n<o?i=-1:n>o&&(i=1),i})),n},_removeFirstDot:function(t){return t.length&&"."===t[0]?t.slice(1):t}})})),define("DS/i3DXCompassPlatformServices/i3DXCompassPlatformAgreement",["UWA/Core","UWA/Class","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassRegistryClient"],(function(t,e,n,o){"use strict";return e.extend({fetchingData:{},callbacks:{},fireCallbacks:function(t,e,n){var o=e;this.callbacks[o].forEach((function(e){e[t]&&setTimeout(e[t],0,n)})),this.callbacks[o].length=0},_request:function(e){var o=this,i=o._options.platformId;if(!e.url)throw new Error("No url found");this.fetchingData[JSON.stringify(i)]=!0,n.authenticatedRequest(e.url,{timeout:15e3,method:e.method||"GET",type:"json",data:JSON.stringify(e.data),headers:{Accept:"application/json","Content-Type":"application/json","x-requested-with":"compass-agreement-client-js-1.0.0"},onComplete:function(e){var n=t.clone(e);e&&(e.fp&&(o._fp=e.fp,delete n.fp),o.fireCallbacks("onComplete",i,n),o.fetchingData[JSON.stringify(i)]=!1)},onFailure:function(){o.fireCallbacks("onFailure",i),o.fetchingData[JSON.stringify(i)]=!1}})},init:function(t){this._options=t},fetch:function(){var t=this,e=t._options.platformId;return new Promise((function(n,i){o.getServicesByPlatform({platforms:[e],services:["3dcompass"],config:{url:t._options.config.url}}).then((function(o){console.log(o),t._url=function(t,e){return t?t+"/resources/AppsMngt/api/v1/platform/{platformId}/agreement".replace("{platformId}",e):null}(o[0].services[0].url,e);var a={url:t._url},r=e;t.callbacks[r]||(t.callbacks[r]=[]),t.callbacks[r].push({onComplete:n,onFailure:i}),t.fetchingData[JSON.stringify(a.data)]||t._request(a)}),(function(){}))}))},save:function(){var t=this,e=t._options.platformId;return new Promise((function(n,o){var i={method:"PUT",url:t._url,contentType:"application/x-www-form-urlencoded",data:{fp:t._fp}},a=e;t.callbacks[a]||(t.callbacks[a]=[]),t.callbacks[a].push({onComplete:n,onFailure:o}),t.fetchingData[JSON.stringify(i.data)]||t._request(i)}))}})}));