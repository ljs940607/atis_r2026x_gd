define("DS/IssueManagementWebInWin/ENOIssueFromTemplateGenerationPanel",["UWA/Core","UWA/Class","DS/IssueServices/services/PlatformServices","DS/IssueServices/Contexts","DS/IssueComponents/create/Create","DS/PlatformAPI/PlatformAPI","DS/IssueComponents/templates/TemplatesDataGridLayout_V2","text!DS/IssueCommon/assets/Settings.json"],(function(e,t,n,a,s,i,o,r){"use strict";return t.extend({init:function(r){var d=parent,c=null,l=null,u=d.htmlContainer||window.widget.body;function p(e){var t=[],n=[];return e.forEach((e=>{n.includes(e.physicalId)||(t.push(e),n.push(e.physicalId))})),t}n.initPlatformServices().then((function(){a.add("widget",window.widget),a.get("widget").name="ENOIssueFromTemplateGenerationPanel",new o(u,{editMode:!1,onClose:function(){},onEnd:function(o){var d=a.get("templateComponentDialog")?a.get("templateComponentDialog"):a.get("templateComponent");if(d){l=o,c=new s(u,{escapeToClose:!1,resizable:!0});var g=l.data;null==g&&((g={}).data={},g.info={}),d.updateDataPresentOnNode(l.physicalId,g).then((a=>{d.updateTemplateData(g).then((function(){var a,s,o,d;(a=r.contexts?r.contexts.map((function(e){return{physicalId:e.physicalId,serviceId:e.serviceId,objectType:e.objectType}})):[],s=r.reportedAgainst?r.reportedAgainst.map((function(e){return{physicalId:e.physicalId,serviceId:e.serviceId,objectType:e.objectType,position:e.position,path:e.path,automation:{assignee:!r.assignees}}})):[],o=r.attachments?r.attachments:[],d={id:"Ext_GenereateIssue",info:{description:null,name:null},ui:{assignees:[],responsibleOrganization:n.getCurrentCredentials().organization},data:{title:r.title,description:r.description,priority:void 0===r.priority?"Low":r.priority,resolutionDate:Date.now(),reportedAgainst:s,contexts:a,assignees:[],attachments:o,automationTasks:[],responsibleOrganization:n.getCurrentCredentials().organization,reportingOrganization:n.getCurrentCredentials().organization}},new Promise((function(t){if(r.assignees&&r.assignees.length>=1){var a=[],s=r.assignees.length;r.assignees.forEach((function(i){n.getUserInfo(i,{onComplete:function(n){var i=JSON.parse(n);d.data.assignees.push(i.name),a.push({user:i.name,fullName:i.firstname+" "+i.lastname,organization:i.company.name}),0==--s&&(d.ui.assignees=e.merge({},a),t())},onFailure:function(){0==--s&&t()}})}))}else t()})).then((function(){return d}))).then((function(e){var n,a;if(g.hidden.contexts||(g.data.contexts.push(...e.data.contexts),g.data.contexts=p(g.data.contexts)),g.hidden.reportedAgainst||(g.data.reportedAgainst.push(...e.data.reportedAgainst),g.data.reportedAgainst=p(g.data.reportedAgainst)),g.hidden.attachments||(g.data.attachments.push(...e.data.attachments),g.data.attachments=(n=g.data.attachments,a=[],n.forEach((e=>{a.includes(e)||a.push(e)})),a)),""==g.data.title&&""!=e.data.title&&(g.data.title=e.data.title),g.hidden.description||""!=g.data.description||""==e.data.description||(g.data.description=e.data.description),g.hidden.resolutionRecommendation||""!=g.data.resolutionRecommendation||""==e.data.resolutionRecommendation||(g.data.resolutionRecommendation=e.data.resolutionRecommendation),!g.hidden.priority){let t=function(e,t){let n=PRIORITY_OPTIONS[e],a=PRIORITY_OPTIONS[t],s="";return s=null==t||n>a?e:t,s}(g.data.priority,e.data.priority);g.data.priority=t}null!=e.data.priority&&PRIORITY_OPTIONS.includes(e.data.priority)&&(g.data.priority=e.data.priority),c.render(),c.isLoaded.finally((function(){var e;c.applyTemplate(g),function(e){e.templateList||e.getDialog().addEvent("onResizeFloating",(function(){var t=e.getDialog().elements.container.getSize();t.width===window.widget.body.getSize().width&&t.height===window.widget.body.getSize().height||(e.getDialog().setNewBodySize(window.widget.body.getSize()),e.getDialog().centerIt())}));var n=new t.Listener;n.listenToOnce(e,"onCreateDialogClose",(function(){window.dscef.sendString(JSON.stringify({action:"closePanel"}))})),e.templateList&&n.listenToOnce(e,"onTemplatesDialogClose",(function(){window.dscef.sendString(JSON.stringify({action:"closePanel"}))})),i.subscribe("DS/Object/create",(function(){window.dscef.sendString(JSON.stringify({action:"displayNotif",notifMsg:"IssueSuccess"}))}))}(c),"attachments"in(e=c).views&&(e.views.attachments.view.fields.attachments.iconBar.disableItem("attachFrom3DX"),e.views.attachments.view.fields.attachments.iconBar.disableItem("screenshot")),"related"in e.views&&(e.views.related.view.fields.reportedAgainst.iconBar.getItem("location").elements.container.addClassName("disabled"),e.views.related.view.fields.contexts.iconBar.getItem("location").elements.container.addClassName("disabled"),e.views.related.view.fields.reportedAgainst.iconBar.getItem("addReported").elements.container.addClassName("disabled"),e.views.related.view.fields.contexts.iconBar.getItem("addContext").elements.container.addClassName("disabled")),e.getDialog().options.limitParent=!0,e.getDialog().setNewBodySize(window.widget.body.getSize()),document.getElementsByClassName("floatingPanel_RightButtons")[0]&&document.getElementsByClassName("floatingPanel_RightButtons")[0].setStyle("display","none"),document.getElementsByClassName("isu-am-catalog-placeholder-button btn-primary btn btn-root")[0]&&document.getElementsByClassName("isu-am-catalog-placeholder-button btn-primary btn btn-root")[0].setStyle("display","none")}))}))}))}))}}}).render()}))}})})),define("DS/IssueManagementWebInWin/MfgIssueManagement",["DS/IssueManagement/IssueManagement","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/PlatformAPI/PlatformAPI","DS/IssueServices/Contexts"],(function(e,t,n,a){"use strict";var s=null,i={SELECT_IN_3D:"SELECT_IN_3D",ADD_OBJECTS:"ADD_OBJECTS",TAKE_SCREENSHOT:"TAKE_SCREENSHOT"},o="ENXISSU_RC",r=/[/\\?%*:|"<>]/g,d=function(){dscef.sendString("Refresh=")},c={_tasks:{subscriberTokens:[],current:null},InitWebInWin:function(t){s=t;var n={};c._getWebInWinParameters((function(t){n=t||null,c._populate3DSpaceURL(n).then((function(t){var n=e.prototype.onResize;e.prototype.onResize=function(){var e=this;setTimeout((function(){n.call(e)}),0)};new e({standalone:!0})}),(function(e){return Promise.reject(e)}))}))},_getWebInWinParameters:function(e){window.COMPASS_CONFIG&&window.COMPASS_CONFIG.myAppsBaseUrl?e(window.COMPASS_CONFIG):c._getAppsUrl((function(t){window.COMPASS_CONFIG||(window.COMPASS_CONFIG={}),t&&(window.COMPASS_CONFIG.myAppsBaseUrl=t,window.COMPASS_CONFIG.userId||(window.COMPASS_CONFIG.userId=s),window.COMPASS_CONFIG.lang||(window.COMPASS_CONFIG.lang=widget.lang)),e(window.COMPASS_CONFIG)}))},_getAppsUrl:function(e){"function"==typeof dscef.getMyAppsURL?dscef.getMyAppsURL().then((function(t){e.call(null,t)})).catch((function(t){console.error("Failed to fetch MyApps URL: "+t),e.call(null,null)})):e.call(null,null)},_populate3DSpaceURL:function(e){return new Promise((function(n,a){var s=null;e&&((s={}).myAppsBaseUrl=e.myAppsBaseUrl,s.userId=e.userId,s.lang=e.lang),t.getPlatformServices({config:s,onComplete:function(e){for(var t=0;t<e.length;t++);n()},onFailure:a})}))},subscribeToTasks:function(){var e=this;e._tasks.subscriberTokens.push(n.subscribe("DS/IssueManagementTask/add",(function(e){var t=e.data.paths[0][0],a=e.data.attributes[t];if(-1!==Object.keys(i).indexOf(a.taskType)){var s=[],o={};s.push([t]),o[t]={taskType:a.taskType,widgetIdIM:a.widgetIdIM,widgetId3D:widget.id},n.publish("DS/IssueManagementTask/ready",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:s,attributes:o},version:"1.0"})}}))),e._tasks.subscriberTokens.push(n.subscribe("DS/IssueManagementTask/exec",(function(t){var n=t.data.paths[0][0],a=t.data.attributes[n];if(-1!==Object.keys(i).indexOf(a.taskType))switch(e._tasks.current={taskId:n,taskType:a.taskType,widgetIdIM:a.widgetIdIM,widgetId3D:widget.id},a.taskType){case i.SELECT_IN_3D:dscef.sendString("SelectFrom3D=1");break;case i.ADD_OBJECTS:dscef.sendString("SelectFromSearch=1");break;case i.TAKE_SCREENSHOT:dscef.sendString("TakeScreenShot=1")}}))),e._tasks.subscriberTokens.push(n.subscribe("DS/IssueManagementTask/cancel",(function(t){dscef.sendString("TaskCancelled=1");var n=a.get("component");null!==n&&n.unmaskForTask(e._tasks.current),e._tasks.current=null}))),e._tasks.subscriberTokens.push(n.subscribe("DS/Object/select",(function(t){if(t.metadata&&t.metadata.appName!==o&&t.data&&t.data.paths){var n="";t.data.paths.forEach((function(e){1==e.length&&(n+=e[0]+";")})),dscef.sendString("ObjectSelect="+n);var s=a.get("component");null!==s&&s.unmaskForTask(e._tasks.current),e._tasks.current=null}}))),e._tasks.subscriberTokens.push(n.subscribe("DS/Object/delete",(function(t){if(t.metadata&&t.metadata.appName!==o&&t.data&&t.data.paths){var n="";t.data.paths.forEach((function(e){1==e.length&&(n+=e[0]+";")})),dscef.sendString("ObjectDelete="+n);var s=a.get("component");null!==s&&s.unmaskForTask(e._tasks.current),e._tasks.current=null}}))),e._tasks.subscriberTokens.push(n.subscribe("DS/Object/create",d)),e._tasks.subscriberTokens.push(n.subscribe("DS/Object/update",d))},SetSecurityContextAndTenant:function(e){e.tenantID?widget.setValue("x3dPlatformId",e.tenantID):""===e.tenantID&&widget.setValue("x3dPlatformId","OnPremise"),e.securityContext&&widget.setValue("pad_security_ctx","ctx::"+e.securityContext)},SelectFrom3DDone:function(e){var t=this,a=[],s={},i={nodes:[]},o=JSON.parse(e);i.nodes.push("node"),i.paths=o[0].physicalId;var r={};r[o[0].physicalId]={x:0,y:0,z:0,balloons:[]},a.push([t._tasks.current.taskId]),s[t._tasks.current.taskId]={taskType:t._tasks.current.taskType,widgetIdIM:t._tasks.current.widgetIdIM,widgetId3D:t._tasks.current.widgetId3D,response:{target:o[0].physicalId,positions:r,nodes:i,objectType:o[0].objectType,serviceId:o[0].serviceId}},n.publish("DS/IssueManagementTask/done",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:a,attributes:s},version:"1.0"})},SelectFromSearchDone:function(e){var t=this,a=JSON.parse(e),s=[],i={};s.push([t._tasks.current.taskId]),i[t._tasks.current.taskId]={taskType:t._tasks.current.taskType,widgetIdIM:t._tasks.current.widgetIdIM,widgetId3D:t._tasks.current.widgetId3D,response:a},n.publish("DS/IssueManagementTask/done",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:s,attributes:i},version:"1.0"})},ScreenShotCaptured:function(e){var t=this,a=e,s=(new Date).toLocaleString(),i="screenshot_"+(s=s.replace(r,"-"))+".png",o=Date.now(),d=[],c={};d.push([t._tasks.current.taskId]),c[t._tasks.current.taskId]={taskType:t._tasks.current.taskType,widgetIdIM:t._tasks.current.widgetIdIM,widgetId3D:t._tasks.current.widgetId3D,response:{data:a,fileName:i,fileType:"image/png",lastModified:o}},n.publish("DS/IssueManagementTask/done",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:d,attributes:c},version:"1.0"})},SelectIssues:function(e){var t={},a=[];e.forEach((function(e){a.push([e]),t[e]={id:e,type:"Issue"}}));var s={metadata:{appName:o},data:{paths:a,attributes:t},version:"1.0"};n.publish("DS/Object/select",s)}};return c})),define("DS/IssueManagementWebInWin/ENOIssueGenerationPanel",["UWA/Core","UWA/Class","DS/IssueServices/services/PlatformServices","DS/IssueServices/Contexts","DS/IssueComponents/create/Create","DS/PlatformAPI/PlatformAPI"],(function(e,t,n,a,s,i){"use strict";return t.extend({init:function(o){n.initPlatformServices().then((function(){var r,d,c,l;(r=o.contexts?o.contexts.map((function(e){return{physicalId:e.physicalId,serviceId:e.serviceId,objectType:e.objectType}})):[],d=o.reportedAgainst?o.reportedAgainst.map((function(e){return{physicalId:e.physicalId,serviceId:e.serviceId,objectType:e.objectType,position:e.position,path:e.path,automation:{assignee:!o.assignees}}})):[],c=o.attachments?o.attachments:[],l={id:"Ext_GenereateIssue",info:{description:null,name:null},ui:{assignees:[],responsibleOrganization:n.getCurrentCredentials().organization},data:{title:o.title,description:o.description,priority:void 0===o.priority?"Low":o.priority,resolutionDate:Date.now(),reportedAgainst:d,contexts:r,assignees:[],attachments:c,automationTasks:[],responsibleOrganization:n.getCurrentCredentials().organization,reportingOrganization:n.getCurrentCredentials().organization}},new Promise((function(t){if(o.assignees&&o.assignees.length>=1){var a=[],s=o.assignees.length;o.assignees.forEach((function(i){n.getUserInfo(i,{onComplete:function(n){var i=JSON.parse(n);l.data.assignees.push(i.name),a.push({user:i.name,fullName:i.firstname+" "+i.lastname,organization:i.company.name}),0==--s&&(l.ui.assignees=e.merge({},a),t())},onFailure:function(){0==--s&&t()}})}))}else t()})).then((function(){return l}))).then((function(e){a.add("widget",window.widget),a.get("widget").name="ENOIssueGenerationPanel";var n=new s(window.widget.body,{escapeToClose:!1,resizable:!1});n.render(),n.isLoaded.finally((function(){var a;n.applyTemplate(e),(a=n).getDialog().addEvent("onResizeFloating",(function(){var e=a.getDialog().elements.container.getSize();e.width===window.widget.body.getSize().width&&e.height===window.widget.body.getSize().height||(a.getDialog().setNewBodySize(window.widget.body.getSize()),a.getDialog().centerIt())})),(new t.Listener).listenToOnce(a,"onCreateDialogClose",(function(){window.dscef.sendString(JSON.stringify({action:"closePanel"}))})),i.subscribe("DS/Object/create",(function(){window.dscef.sendString(JSON.stringify({action:"displayNotif",notifMsg:"IssueSuccess"}))})),function(e){"attachments"in e.views&&(e.views.attachments.view.fields.attachments.iconBar.disableItem("attachFrom3DX"),e.views.attachments.view.fields.attachments.iconBar.disableItem("screenshot")),"related"in e.views&&(e.views.related.view.fields.reportedAgainst.iconBar.getItem("location").elements.container.addClassName("disabled"),e.views.related.view.fields.contexts.iconBar.getItem("location").elements.container.addClassName("disabled"),e.views.related.view.fields.reportedAgainst.iconBar.getItem("addReported").elements.container.addClassName("disabled"),e.views.related.view.fields.contexts.iconBar.getItem("addContext").elements.container.addClassName("disabled")),e.getDialog().options.limitParent=!0,e.getDialog().setNewBodySize(window.widget.body.getSize()),document.getElementsByClassName("floatingPanel_RightButtons")[0]&&document.getElementsByClassName("floatingPanel_RightButtons")[0].setStyle("display","none"),document.getElementsByClassName("isu-am-catalog-placeholder-button btn-primary btn btn-root")[0]&&document.getElementsByClassName("isu-am-catalog-placeholder-button btn-primary btn btn-root")[0].setStyle("display","none")}(n)}))}))}))}})})),define("DS/IssueManagementWebInWin/ENOIssueGenerationWebPanel",["UWA/Core","UWA/Class","DS/IssueServices/services/PlatformServices","DS/IssueComponents/create/Create","DS/IssueServices/Contexts"],(function(e,t,n,a,s){"use strict";return t.extend({init:function(i,o){var r,d,c,l,u=i,p=null,g=o||i.data,m=i.onClose,h=u.htmlContainer||window.widget.body;this.hide=this.hideIssuePanel=function(){p&&p.getDialog().hide()},this.show=this.showIssuePanel=function(){p&&p.getDialog().show()},this.destroy=this.destroyIssuePanel=function(){p&&p.getDialog().destroy()},(r=g.contexts?g.contexts.map((function(e){return{physicalId:e.physicalId,serviceId:e.serviceId,objectType:e.objectType}})):[],d=g.reportedAgainst?g.reportedAgainst.map((function(e){return{physicalId:e.physicalId,serviceId:e.serviceId,objectType:e.objectType,position:e.position,path:e.path,automation:{assignee:!g.assignees}}})):[],c=g.attachments?g.attachments:[],l={id:"Ext_GenereateIssue",data:{title:g.title,description:g.description,priority:g.priority,reportedAgainst:d,contexts:r,assignees:g.assignees,attachments:c}},new Promise((function(t){if(g.assignees&&g.assignees.length>0){var a=[],s=g.assignees.length;l.ui={assignees:[]},g.assignees.forEach((function(i){n.getUserInfo(i,{onComplete:function(n){var i=JSON.parse(n);l.data.assignees.push(i.name),a.push({user:i.name,fullName:i.firstname+" "+i.lastname,organization:i.company.name}),0==--s&&(l.ui.assignees=e.merge({},a),t())},onFailure:function(){0==--s&&t()}})}))}else t()})).then((function(){return l}))).then((function(e){s.add("widget",window.widget),(p=new a(h,{escapeToClose:!1,resizable:!0})).render(),p.isLoaded.finally((function(){var n;p.applyTemplate(e),n=p,(new t.Listener).listenToOnce(n,"onCreateDialogClose",(function(e){m?m(e):u.end()})),function(e){"attachments"in e.views&&e.views.attachments.view.fields.attachments.iconBar.disableItem("screenshot"),"related"in e.views&&(e.views.related.view.fields.reportedAgainst.iconBar.getItem("location").elements.container.addClassName("disabled"),e.views.related.view.fields.contexts.iconBar.getItem("location").elements.container.addClassName("disabled")),e.getDialog().options.limitParent=!0}(p)}))}))}})})),define("DS/IssueManagementWebInWin/ENOIssueFromTemplateGenerationWebPanel",["UWA/Core","UWA/Class","DS/IssueServices/services/PlatformServices","DS/IssueComponents/create/Create","DS/IssueComponents/templates/TemplatesDialog","DS/IssueServices/Contexts"],(function(e,t,n,a,s,i){"use strict";return t.extend({init:function(o,r){var d=o,c=null,l=null,u=null,p=r||o.data,g=o.onClose,m=d.htmlContainer||window.widget.body;const h={Low:0,Medium:1,High:2,Urgent:3};function f(e){var n=new t.Listener;n.listenToOnce(e,"onCreateDialogClose",(function(e){g?g(e):d.end()})),n.listenToOnce(e,"onTemplatesDialogClose",(function(e){g?g(e):d.end()}))}function I(e){var t=[],n=[];return e.forEach((e=>{n.includes(e.physicalId)||(t.push(e),n.push(e.physicalId))})),t}this.hide=this.hideIssuePanel=function(){c&&c.getDialog().hide(),l&&c.getDialog().hide()},this.show=this.showIssuePanel=function(){c&&c.getDialog().show(),l&&l.getDialog().show()},this.destroy=this.destroyIssuePanel=function(){c&&c.getDialog().destroy(),l&&(l.destroy(),l=null)},l=new s(m,{editMode:!1,onClose:function(){},onEnd:function(t){var s=i.get("templateComponentDialog")?i.get("templateComponentDialog"):i.get("templateComponent");if(s){u=t,c=new a(m,{escapeToClose:!1,resizable:!0});var o=u.data;null==o&&((o={}).data={},o.info={}),s.updateDataPresentOnNode(u.physicalId,o).then((t=>{s.updateTemplateData(o).then((function(){var t,a,s,i;(t=p.contexts?p.contexts.map((function(e){return{physicalId:e.physicalId,serviceId:e.serviceId,objectType:e.objectType}})):[],a=p.reportedAgainst?p.reportedAgainst.map((function(e){return{physicalId:e.physicalId,serviceId:e.serviceId,objectType:e.objectType,position:e.position,path:e.path,automation:{assignee:!p.assignees}}})):[],s=p.attachments?p.attachments:[],i={id:"Ext_GenereateIssue",data:{title:p.title,description:p.description,priority:p.priority,reportedAgainst:a,contexts:t,assignees:p.assignees,attachments:s}},new Promise((function(t){if(p.assignees&&p.assignees.length>0){var a=[],s=p.assignees.length;i.ui={assignees:[]},p.assignees.forEach((function(o){n.getUserInfo(o,{onComplete:function(n){var o=JSON.parse(n);i.data.assignees.push(o.name),a.push({user:o.name,fullName:o.firstname+" "+o.lastname,organization:o.company.name}),0==--s&&(i.ui.assignees=e.merge({},a),t())},onFailure:function(){0==--s&&t()}})}))}else t()})).then((function(){return i}))).then((function(e){var t,n;if(o.hidden.contexts||(o.data.contexts.push(...e.data.contexts),o.data.contexts=I(o.data.contexts)),o.hidden.reportedAgainst||(o.data.reportedAgainst.push(...e.data.reportedAgainst),o.data.reportedAgainst=I(o.data.reportedAgainst)),o.hidden.attachments||(o.data.attachments.push(...e.data.attachments),o.data.attachments=(t=o.data.attachments,n=[],t.forEach((e=>{n.includes(e)||n.push(e)})),n)),""==o.data.title&&""!=e.data.title&&(o.data.title=e.data.title),o.hidden.description||""!=o.data.description||""==e.data.description||(o.data.description=e.data.description),o.hidden.resolutionRecommendation||""!=o.data.resolutionRecommendation||""==e.data.resolutionRecommendation||(o.data.resolutionRecommendation=e.data.resolutionRecommendation),!o.hidden.priority){let t=function(e,t){let n="";return n=null==t||h[e]>h[t]?e:t,n}(o.data.priority,e.data.priority);o.data.priority=t}c.render(),c.isLoaded.finally((function(){var e;c.applyTemplate(o),f(c),"attachments"in(e=c).views&&e.views.attachments.view.fields.attachments.iconBar.disableItem("screenshot"),"related"in e.views&&(e.views.related.view.fields.reportedAgainst.iconBar.getItem("location").elements.container.addClassName("disabled"),e.views.related.view.fields.contexts.iconBar.getItem("location").elements.container.addClassName("disabled")),e.getDialog().options.limitParent=!0}))}))}))}))}}}),l.render(),l.isLoaded.finally((function(){f(l)}))}})}));