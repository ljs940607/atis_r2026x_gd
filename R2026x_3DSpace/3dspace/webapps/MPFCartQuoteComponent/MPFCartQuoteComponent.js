define("DS/MPFCartQuoteComponent/CartQuoteDownloadLink",["UWA/Core","UWA/Class/View","DS/UIKIT/Spinner","DS/MPFServices/ObjectService","DS/MPFCartQuoteModel/CartQuoteModel","DS/MPFFiniteStateMachine/FiniteStateMachine","i18n!DS/MPFCartQuoteComponent/assets/nls/CartQuoteComponent","css!DS/MPFCartQuoteComponent/MPFCartQuoteComponent"],(function(t,e,n,o,i,s,a){"use strict";const r="ACTIVE",l="LOADING",h=[{from:r,to:l},{from:l,to:r}],c=Object.freeze({CLICKED:"downloadQuoteClicked",QUOTE_DOWNLOADED:"quoteDownloaded",ERROR:"error"}),u=e.extend({tagName:"div",className:"mpf-cart-quote",setup:function(t){o.requiredOfPrototype(t.quote,i,"options.quote must be a CartQuoteModel"),this.quote=t.quote,this.label=t.label||a.get("downloadQuote"),this.paymentUpdateCb=t.paymentUpdateCb||(()=>Promise.resolve()),this.stateMachine=new s({state:r,states:[r,l],transitions:h}),this.loader=new n,this.link=this._createLink()},render:function(){return this.stateMachine.getState()===l?(this.container.setContent(this.loader),this.loader.show()):this.container.setContent(this.link),this},async downloadQuote(e){t.Event.stop(e),this.stateMachine.changeState(l),this.render(),this.dispatchEvent(c.CLICKED);const n=window.open();let o,i;try{await this.paymentUpdateCb(),await this.quote.fetchPromise(),this.link.setAttributes({href:this.quote.getUrl()}),n.location=this.quote.getUrl(),o=c.QUOTE_DOWNLOADED}catch(t){console.log(t),o=c.ERROR,i={error:t}}this.stateMachine.changeState(r),this.render(),this.dispatchEvent(o,i)},destroy(){this.link=null,this.loader=null,this.quote=null,this.stateMachine=null,this.paymentUpdateCb=null,this._parent(),this.container=null},_createLink(){return t.createElement("a",{class:"mpf-link",target:"_blank",text:this.label,events:{click:this.downloadQuote.bind(this)}})}});return u.Events=c,u}));