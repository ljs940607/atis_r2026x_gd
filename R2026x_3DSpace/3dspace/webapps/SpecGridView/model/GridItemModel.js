define("DS/SpecGridView/model/GridItemModel",["DS/TreeModel/TreeNodeModel","UWA/Core","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/TypeUtils","DS/XSRCommonComponents/utils/RequestUtil","DS/XSRCommonComponents/utils/XInfraRequestUtil","DS/XSRCommonComponents/utils/IndexServiceProvider","DS/XSRCommonComponents/utils/Constants"],(function(t,e,i,o,n,r,s,p){"use strict";function a(e){this._parentNode={_nodeDepth:1},this.pathElement={externalPath:[]};var i=this.showChildren?this.showChildren:e&&e.showChildren?e.showChildren:null;this.options={children:i,useAsyncPreExpand:!1,filteringContext:{isFilterOutBySearch:!0,isFilterOutByTagger:!0,isFilterOutByNG:!0},grid:{physicalId:void 0,id:void 0,"ds6w:type":void 0,"ds6w:type_value":void 0,"ds6w:policy":void 0,"ds6w:policy_value":void 0,name:void 0,"ds6w:identifier":void 0,"ds6w:label":void 0,"ds6w:description":void 0,"ds6w:globalType":void 0,"ds6w:reserved":void 0,isLastVersion:void 0,"ds6w:isLastRevision":void 0,"ds6w:reservedBy":void 0,owner:void 0,"ds6w:responsible":void 0,"ds6wg:revision":void 0,"ds6w:status":void 0,"ds6w:status_value":void 0,"ds6w:created":void 0,"ds6w:lastModifiedBy":void 0,"ds6w:modified":void 0,typeIcon:[]},icons:[],thumbnail:void 0,thumbnail_2d:void 0,label:void 0,subLabel:void 0,description:void 0},t.call(this,this.options)}var c=function(t,e){if(t.indexOf("all")>=0)return!0;var i=e;if(Array.isArray(i)){for(var o=!0,n=0;n<i.length;n++){var r=i[n];if(-1===t.indexOf(r)){o=!1;break}}return o}return t.indexOf(i)>=0||void 0};return a.prototype=Object.create(t.prototype),a.prototype.shouldBeEditable=function(){return!1},a.prototype.getType=function(){return this.options.grid["ds6w:type"]},a.prototype.getPolicy=function(){return this.options.grid["ds6w:policy"]},a.prototype.getDisplayName=function(){return this.getLabel()+" "+this.getRevision()},a.prototype.getName=a.prototype.getIdentifier=function(){return this.options.grid["ds6w:identifier"]},a.prototype.getDescription=function(){return this.options.grid["ds6w:description"]},a.prototype.setDescription=function(t){this.options.grid["ds6w:description"]=t},a.prototype.getPhysicalId=a.prototype.getID=function(){return this.options.grid.physicalId},a.prototype.getTitle=function(){return this.options.grid["ds6w:label"]},a.prototype.setTitle=function(t){this.options.grid["ds6w:label"]=this.options.grid.tree=t},a.prototype.getLabel=function(){return this.options.grid["ds6w:label"]},a.prototype.getParentId=function(){return this.options.grid.parentId},a.prototype.getTypeActualName=function(){return this.options.grid["ds6w:type_value"]},a.prototype.getPolicyActualName=function(){return this.options.grid["ds6w:policy_value"]},a.prototype.getTypeIcon=function(){return this.options.icons},a.prototype.getGlobalType=function(){return this.options.grid["ds6w:globalType"]},a.prototype.getReserved=function(){return this.options.grid["ds6w:reserved"]},a.prototype.setReserved=function(t){this.options.grid["ds6w:reserved"]=t},a.prototype.getOwner=a.prototype.getResponsible=function(){return this.options.grid["ds6w:responsible"]},a.prototype.setOwner=a.prototype.setResponsible=function(t){this.options.grid["ds6w:responsible"]=t},a.prototype.getRevision=function(){return this.options.grid["ds6wg:revision"]},a.prototype.getThumbnail=function(){return this.options.thumbnail_2d||this.options.thumbnail},a.prototype.getMaturity=function(){return this.options.grid["ds6w:status"]},a.prototype.setMaturity=function(t){this.options.grid["ds6w:status"]=t},a.prototype.getMaturityActualName=function(){return this.options.grid["ds6w:status_value"]},a.prototype.setMaturityActualName=function(t){this.options.grid["ds6w:status_value"]=t},a.prototype.getModifedDate=function(){return this.options.grid["ds6w:modified"]},a.prototype.setModifedDate=function(t){this.options.grid["ds6w:modified"]=t},a.prototype.getOriginatedDate=function(){return this.options.grid["ds6w:created"]},a.prototype.getCurrentAccess=function(){return this.options.grid.currentAccess},a.prototype.setCurrentAccess=function(t){this.options.grid.currentAccess=t},a.prototype.hasAccess=function(t){var e=this.getCurrentAccess();if(e)return c(e,t);if(this.currentTabKey===p.MEI_TAB||void 0!==this.getMEIInterface&&this.getMEIInterface()===p.MEI_INTERFACE){var i=this.getMaturity();if(i===p.MATURITY_RELEASED||i===p.WELCOMEPANEL_ID_RELEASED||i===p.WELCOMEPANEL_ID_OBSOLETE||i===p.OBSOLETE)return!1}return!0},a.prototype.updateSpecDetails_async=async function(){var t=this;if(this.getType()!==p.TYPE_DOCUMENT){var e=new r({id:"getAttributeDetails"});if(this.getAttributeValue("instanceId")){var o=i.getInstanceCustomAttributesData();if(o){var n={attributes:o,relIds:[this.getAttributeValue("instanceId")]};e.getInstanceTypeData(n).then((function(e){if(e){var i=e.response[0];if(i)for(var o in i)if("physicalid"!==o){var n=o.split("[")[1];t.options.grid[t.currentTabKey+n.split("]")[0]]=i[o]}}})).catch((function(t){console.warn(t)}))}}var s={lIds:[this.getID()],relIDs:[],busIDs:[],plmparameters:"false",attributes:"true",navigateToMain:"false",readonly:"true",debug_properties:""};e.getDetails(s).then((function(e){if(null!=e){var o=e.results[0].data;o&&(o.forEach((e=>{if(e.value)if(e.type&&"boolean"===e.type)t.options.grid[t.currentTabKey+e.path]=e.value[0].toString();else if(e.dimensionType&&e.dimension&&(e.extension&&i.isEnterpriseAttribute(e.extension)&&e.deploymentExtension||i.isCustomAttribute(e.extension)))t.options.grid[t.currentTabKey+e.path]=e.value[0].toString()+" "+e.dimension;else if("timestamp"===e.type){const o=[];for(let t=0;t<e.value.length;t++)o.push(i.formatDate(e.value[t]));t.options.grid[t.currentTabKey+e.path]=o}else t.options.grid[t.currentTabKey+e.path]=e.value;else t.options.grid[t.currentTabKey+e.path]=""})),t.updateOptions(t.options))}})).catch((function(t){console.log(t)}))}var a=new r({id:this.getID()}),c={mask:"SpecAndRelatedInfoObjectMask",typeActual:this.getTypeActualName(),typeName:this.getType()};a.get(c).then((function(e){if(void 0!==e.member[0]["@id"]){var i=e.member[0];if(t.options.grid.cestamp=i.cestamp,t.options.grid.currentAccess=i.access||"",t.options.grid.creator=i.creator,t.options.grid.hasRecipe=i.hasRecipe||"false",i.specificationReport){var o=i.specificationReport.member[0];if(t.options.grid.specReportPid=o["@id"]||"",t.options.grid.specReportType=o.typedisplayName||"",t.options.grid.specReportTypeActualName=o.typeactualName||"",t.options.grid.specReportTypeSymbolicName=o.symbolicTypeName||"",t.options.grid.specReportName=o.name||"",t.options.grid.specReportRevision=o.revision||"",t.options.grid.specReportMaturity=o.maturitydisplayName||"",t.options.grid.specReportMaturityActualName=o.maturityactualName||"",t.options.grid.specReportCreator=o.creator||"",t.options.grid.specReportDescription=o.description||"",t.options.grid.specReportTitle=o.title||"",t.options.grid.specReportCurrentAccess=o.access||"",t.options.grid.isReportCheckedIn=!(!o.hasReport||""===o.hasReport||null===o.hasReport||void 0===o.hasReport),o.template){var n=o.template.member[0];t.options.grid.templatePid=n["@id"],t.options.grid.templateTitle=n.title||"",t.options.grid.templateName=n.name||"",t.options.grid.templateRevision=n.revision||"",t.options.grid.templateState=n.maturityactualName||""}}if(i.changeDetails){var r=i.changeDetails[t.getID()];if(r){if(Array.isArray(r))for(var s=0;s<r.length;s++){var p=r[s];if("Complete"!=p.current){r=p;break}}t.options.grid.changeActionName=r.name,t.options.grid.changeActionState=r.current,t.options.grid.changeActionId=r.physicalid,t.options.grid.changeActionType=r.type,t.options.grid.changeActionpolicy=r.policy,t.options.grid.changeActionRelType=r.relationship,t.options.grid.changeActionRelID=r["physicalid[connection]"],t.options.grid.changeActionRequestedFor=r["attribute[Requested Change]"],t.options.grid.changeActionTitle=r["attribute[Synopsis]"]}}}})).catch((function(t){console.log(t)}))},a.prototype.getSpecReportCurrentAccess=function(){return this.options.grid.specReportCurrentAccess},a.prototype.hasAccessOnSpecReport=function(t){var e=this.getSpecReportCurrentAccess();return!e||c(e,t)},a.prototype.getTemplatePid=function(){return this.options.grid.templatePid},a.prototype.getTemplateTitle=function(){return this.options.grid.templateTitle},a.prototype.getTemplateName=function(){return this.options.grid.templateName},a.prototype.getTemplateRev=function(){return this.options.grid.templateRevision},a.prototype.getTemplateState=function(){return this.options.grid.templateState},a.prototype.getSpecReportPid=function(){return this.options.grid.specReportPid},a.prototype.getSpecReportType=function(){return this.options.grid.specReportType},a.prototype.isReportCheckedIn=function(){return this.options.grid.isReportCheckedIn},a.prototype.getSpecReportTypeActualName=function(){return this.options.grid.specReportTypeActualName},a.prototype.getSpecReportTypeSymbolicName=function(){return this.options.grid.specReportTypeSymbolicName},a.prototype.getSpecReportName=function(){return this.options.grid.specReportName},a.prototype.getSpecReportRevision=function(){return this.options.grid.specReportRevision},a.prototype.getSpecReportMaturity=function(){return this.options.grid.specReportMaturity},a.prototype.getSpecReportMaturityActualName=function(){return this.options.grid.specReportMaturityActualName},a.prototype.getSpecReportCreator=function(){return this.options.grid.specReportCreator},a.prototype.getSpecReportDescription=function(){return this.options.grid.specReportDescription},a.prototype.getSpecReportTitle=function(){return this.options.grid.specReportTitle},a.prototype.isChangeConnected=function(){return!!this.options.grid.changeActionId},a.prototype.getChangeActionId=function(){return this.options.grid.changeActionId},a.prototype.getChangeActionTitle=function(){return this.options.grid.changeActionTitle},a.prototype.getChangeActionName=function(){return this.options.grid.changeActionName},a.prototype.getChangeActionRequestedFor=function(){return this.options.grid.changeActionRequestedFor},a.prototype.getChangeActionState=function(){return this.options.grid.changeActionState},a.prototype.getChangeActionType=function(){return this.options.grid.changeActionType},a.prototype.updateAddtitionalValues=function(){this.options.label=this.getTitle(),this.options.subLabel=this.getTileSubLabel(),this.options.contextualMenu=[null]},a.prototype.setTileDescription=function(t){this.options.description=t},a.prototype.setTypeIcon=function(t){var e=this,i=function(t){var i,o=(i=t)&&i.startsWith("http")?i:i.indexOf("/")>=0?n.get3DSpaceURL().concat(i):i?n.get3DSpaceURL().concat("/snresources/images/icons/small/"+i+".png"):void 0;o&&-1===e.options.grid.typeIcon.indexOf(o)&&(e.options.grid.typeIcon=[],e.options.icons=[],e.options.grid.typeIcon.push(o),e.options.icons.push(o))};Array.isArray(t)?i(t[0]):i(t)},a.prototype.setThumbnail2d=function(t){if(t&&t.startsWith("http"))this.options.thumbnail_2d=t;else if(t)this.options.thumbnail_2d=n.get3DSpaceURL().concat(t);else{let t=this.getTypeActualName(),e=o.isFormulatedProduct(t)?"FormulatedProduct":o.isPhyOrRaw(t)?"product":"document";i.getIconFormXSR(e)}},a.prototype.setThumbnail=function(t){if(t&&t.startsWith("http"))this.options.thumbnail=t;else if(t)this.options.thumbnail=n.get3DSpaceURL().concat(t);else{let t=this.getTypeActualName(),e=o.isFormulatedProduct(t)?"FormulatedProduct":o.isPhyOrRaw(t)?"product":"document";i.getIconFormXSR(e)}},a.prototype.setTaggerFilterState=function(t){this.options.filteringContext.isFilterOutByTagger=t},a.prototype.setSearchFilterState=function(t){this.options.filteringContext.isFilterOutBySearch=t},a.prototype.setNGFilterState=function(t){this.options.filteringContext.isFilterOutByNG=t},a.prototype.setColor=function(t){this.options.color=t,this.updateOptions(this.options)},a.prototype.applyFilters=function(){var t=this;t.options.filteringContext.isFilterOutByTagger&&t.options.filteringContext.isFilterOutBySearch&&t.options.filteringContext.isFilterOutByNG?this.show():this.hide()},a.prototype.getTreeModel=function(){return this.options.grid.tree=this.options.grid["ds6w:label"],this.updateOptions(this.options),this},a.prototype.updateOtherDetails=function(){this.updateAddtitionalValues(),this.updateSpecDetails_async(),this.updateThumbnail_async(),this.updateOptions(this.options)},a.prototype.getNodesById=function(t){var e={listOfFoundNodes:[]};return this._getNodesById(t,e),e.listOfFoundNodes},a.prototype._getNodesById=function(t,e){var i=!1;if(this.getID()===t)e.listOfFoundNodes.push(this),i=!0;else{var o=this.getChildren();if(o)for(var n=0;o&&n<o.length;n++)i="function"==typeof o[n]._getNodesById&&o[n]._getNodesById(t,e)||i}return i},a.prototype.sync=function(){this.appCore&&this.appCore.specViewerModelEvents&&this.appCore.specViewerModelEvents.publish({event:"grid-sync-node-data",data:this.getID()})},a.prototype.updateThumbnail_async=function(){var t=this;this.getID()&&(new s).fetchItemDataByFederated([this.getID()],["preview_url"]).then((function(e){if(e){var i=e.results?e.results[0]:void 0,o=i?i.attributes:void 0;if(o)for(var n=!1,r=!1,s=0;s<o.length;s++){var p=o[s].value;if("preview_url"===o[s].name?(t.setThumbnail(p),n=!0):"type_icon_url"===o[s].name&&(t.setTypeIcon(p),r=!0),r&&n)break}}t.updateOptions(t.options)})).catch((function(t){console.log(t)}))},a.prototype.setPhysicalId=a.prototype.setID=function(t){this.options.grid.physicalId=t},a.prototype.setName=a.prototype.setIdentifier=function(t){this.options.grid["ds6w:identifier"]=t},a.prototype.setPolicy=function(t){this.options.grid["ds6w:policy"]=t},a.prototype.setPolicyActualName=function(t){this.options.grid["ds6w:policy_value"]=t},a.prototype.setTypeActualName=function(t){this.options.grid["ds6w:type_value"]=t},a.prototype.setType=function(t){this.options.grid["ds6w:type"]=t},a.prototype.isPrivate=function(){return this.getMaturityActualName().toUpperCase()===p.MATURITY_PRIVATE},a.prototype.isInWork=function(){return this.getMaturityActualName().toUpperCase()===p.MATURITY_IN_WORK},a.prototype.isFrozen=function(){return this.getMaturityActualName().toUpperCase()===p.MATURITY_FROZEN},a.prototype.isReleased=function(){return this.getMaturityActualName().toUpperCase()===p.MATURITY_RELEASED},a.prototype.isObsolete=function(){return this.getMaturityActualName().toUpperCase()===p.MATURITY_OBSOLETE},a}));