define("DS/SpecGridView/model/GridTreeDocument",["UWA/Core","UWA/Class","DS/SpecGridView/model/TreeDocument","DS/TreeModel/DataModelSet","DS/SpecGridView/utils/GridUtil","DS/XSRCommonComponents/utils/Utils","DS/PlatformAPI/PlatformAPI","DS/XSRCommonComponents/utils/Constants"],(function(e,t,i,o,n,r,a,l){"use strict";return t.extend({init:function(e){e&&(this.modelEvents=e.modelEvents?e.modelEvents:e.appCore.basicModelEvents,this.enableCrossWidgetFeature=!!e.enableCrossWidgetFeature&&e.enableCrossWidgetFeature,this.currentTabKey=e.currentTabKey?e.currentTabKey:void 0,this.isColorized=!!e.isColorized,this.appCore=e.appCore,this.parentModel=e.parentModel,this.enableRightInteractivity=e.enableRightInteractivity,this.specTagsFilter=e.specTagsFilter?e.specTagsFilter:null,this.rowGroupingOptions=e.rowGroupingOptions,this.itemModelMapping=[])},getNodeFromModelMapping:function(e){if(e){var t=this.itemModelMapping.filter((function(t){return Object.keys(t)[0]===e}));return t&&t.length>0?Object.values(t[0])[0]:null}},getTreeDocuments:function(e){var t=this,n=new o;return this.model=new i({dataModelSet:n,currentTabKey:t.currentTabKey,xsrModelEvents:t.modelEvents}),this.model.setUseChangeTransactionMode(!0),this.model.prepareUpdate(),e&&e.forEach((function(e){t.model.addRoot(e.getTreeModel())})),this.model.pushUpdate(),this.model.expandAll(),this.addEventsOnModel(),this.model.isColorized=this.isColorized,this.model.rowGroupingOptions=this.rowGroupingOptions,this.model.bomItemModelMapping=this.itemModelMapping,this.model},unGroupRoots:function(){this.model.ungroupRoots()},groupRoots:function(e){var t=Array.isArray(e)?{propertiesToGroup:e}:{propertiesToGroup:[e]};this.model.groupRoots(t),this.model.expandAll()},publishSelectedNodesInGrid:function(){let e=this.model.getSelectedNodes(),t=e.length;if(1==t){!e[0]._canBeGrouped()||this.modelEvents.publish({event:l.EVENT_GRID_TOTAL_SELECTED_NODES,data:{count:t,currentModel:e,gridModel:this.model}})}else this.modelEvents.publish({event:l.EVENT_GRID_TOTAL_SELECTED_NODES,data:{count:t,currentModel:e,gridModel:this.model}})},manageTriptychRightPanel:function(){var e=this,t=e.model.getSelectedNodes(),i=e.appCore.triptychManager;if(i.setLaunchFromIcon(!1),t&&i.isRightPanelVisible){var o=t.length;if(o>1)e.appCore.basicModelEvents.publish({event:l.EVENT_SPEC_GRID_NODES_SELECTION_ACTION,data:{currentTab:e.currentTabKey,count:o,commandId:i.commandId,currentModel:e.model}});else if(1==o){!t[0]._canBeGrouped()||setTimeout((function(){e.appCore.basicModelEvents.publish({event:l.EVENT_SPEC_GRID_NODES_SELECTION_ACTION,data:{currentTab:e.currentTabKey,count:o,commandId:i.commandId,currentModel:t[0]}})}),50)}else setTimeout((function(){e.appCore.basicModelEvents.publish({event:l.EVENT_SPEC_GRID_NODES_SELECTION_ACTION,data:{currentTab:e.currentTabKey,count:o,commandId:i.commandId,currentModel:t[0],parentModel:void 0}})}),50)}},addEventsOnModel:function(){var e=this,t=function(){var t=e.model.getSelectedNodes(),i=t.length;if(e.modelEvents.publish({event:l.UPDATE_ITEMVIEW_TOOLBOOR_COUNT,data:i}),!e.notApplyXhightlight&&e.enableCrossWidgetFeature&&i>0){var o=(new n).getCrossHLData(t);r.publishCrossWidgetHighlightEvent(r.uid(),o[0])}};this.model.getXSO().onPostAdd((function(i){for(var o=0;o<i.length;o++){var n=i[o];!n._canBeGrouped()?n.selectAll():t()}e.enableRightInteractivity&&(e.manageTriptychRightPanel(),e.publishSelectedNodesInGrid())})),this.model.getXSO().onPostRemove((function(i){for(var o=0;o<i.length;o++){var n=i[o];!n._canBeGrouped()?n.unselectAll():t()}e.enableRightInteractivity&&(e.manageTriptychRightPanel(),e.publishSelectedNodesInGrid())})),e.enableCrossWidgetFeature&&(this.platFormSusbcribtion=a.subscribe(l.CROSS_APP_SELECTION_EVENT,(function(t){if(t.metadata&&t.metadata.appid==="ENOSPEC_AP_"+widget.id)return;var i=[];t.data.attributes;t.data.paths.forEach((function(e){let t={};t.parentId=e[0],t.connectionId=e[1],t.childId=e[2];let o=e.length;o>3&&(t.parentId=e[o-3],t.connectionId=e[o-2],t.childId=e[o-1]),i.push(t)})),e.notApplyXhightlight=!0,e.model.unselectAll();var o=e.model.getAllDescendants();i=i.filter((e=>e.childId&&e.connectionId));for(var n=0;n<o.length;n++){var r=o[n];if(0===i.length)break;for(let e=0;e<i.length;e++)i[e].childId===r.getID()&&i[e].connectionId===r.getInstanceId()&&(r.isSelected()||r.select())}e.notApplyXhightlight=!1})))},addRoot:function(e,t,i){if(e){var o=this,r=!1!==t;Array.isArray(e)?o.model.withTransactionUpdate((()=>{o.model.addRoot(e),e.forEach((e=>{if(o.currentTabKey===l.BOM_TAB){var t={};t[e.getID()]=e;var i=o.itemModelMapping.filter((function(t){return Object.keys(t)[0]===e.getID()}));if(i&&i.length>0){let t=(new n).updateItemModelMapping(o.itemModelMapping,e);o.itemModelMapping=t}else o.itemModelMapping.push(t)}}))})):e&&(!function(e){var t=e.getTreeModel();if(o.model.addRoot(t,i),o.currentTabKey===l.BOM_TAB){var r={};r[t.getID()]=t;var a=o.itemModelMapping.filter((function(e){return Object.keys(e)[0]===t.getID()}));if(a&&a.length>0){let e=(new n).updateItemModelMapping(o.itemModelMapping,t);o.itemModelMapping=e}else o.itemModelMapping.push(r)}}(e),r&&e.select())}this.model.acceptChanges()},removeRoot:function(e){if(e){var t=this,i=function(e){t.model.removeRoot(e);e.getParent();if(t.currentTabKey===l.BOM_TAB&&t.itemModelMapping){var i=t.itemModelMapping.filter((function(t){return Object.keys(t)[0]===e.getID()}));if(i&&i.length>0){let i=(new n).removeItemModelMapping(t.itemModelMapping,e);t.itemModelMapping=i}}t.model.acceptChanges()};Array.isArray(e)?e.forEach((function(e){i(e)})):i(e)}},destroy:function(){this.platFormSusbcribtion&&a.unsubscribe(this.platFormSusbcribtion),this.itemModelMapping=[]}})}));