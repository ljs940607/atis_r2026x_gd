define("DS/WebVisuGLTF/CreateAccessors",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WEBGL_COMPONENT_TYPES=void 0,t.getAccessor=function(e,o,s){if(!e.gltf_data)return;if(e.accessorsCache.has(s))return e.accessorsCache.get(s);const a=e.gltf_data.accessors[s],n=t.WEBGL_COMPONENT_TYPES[a.componentType],i=r[a.type],l=a.count*i;let c;if(void 0===a.bufferView)c=new n(l);else{const t=e.gltf_data.bufferViews[a.bufferView],r=o[t.buffer],s=t.byteStride,u=n.BYTES_PER_ELEMENT*i,d=(t.byteOffset||0)+(a.byteOffset||0);if(s&&s!==u){c=new n(l);for(let e=0;e<a.count;e++){const t=new n(r,d+e*s,i);for(let r=0;r<i;r++)c[e*i+r]=t[r]}}else c=null===t.buffer?new n(l):new n(r,d,l)}if(a.sparse){const s=a.sparse,l=function(e,r,o,s){if(!e.gltf_data)return;const a=e.gltf_data.bufferViews[o.indices.bufferView],n=(o.indices.byteOffset||0)+(a.byteOffset||0),i=r[a.buffer],l=o.count,c=o.indices.componentType,u=t.WEBGL_COMPONENT_TYPES[c],d=u.BYTES_PER_ELEMENT,f=a.byteStride||d;if(!a.byteStride||a.byteStride===d)return new u(i,n,l);const m=new u(l),h=new DataView(i,n);for(let e=0;e<l;e++){const t=e*f;switch(c){case 5121:m[e]=h.getUint8(t);break;case 5123:m[e]=h.getUint16(t,!0);break;case 5125:m[e]=h.getUint32(t,!0);break;default:throw new Error(`Unsupported index componentType: ${c}`)}}return m}(e,o,s,n.BYTES_PER_ELEMENT),u=function(e,o,s,a,n){if(!e.gltf_data)return;const i=e.gltf_data.bufferViews[s.values.bufferView],l=(s.values.byteOffset||0)+(i.byteOffset||0),c=o[i.buffer],u=r[n],d=s.count*u,f=t.WEBGL_COMPONENT_TYPES[a],m=f.BYTES_PER_ELEMENT,h=i.byteStride||m*u;if(!i.byteStride||i.byteStride===m*u)return new f(c,l,d);const p=new f(d),_=new DataView(c,l);for(let e=0;e<s.count;e++){const t=e*h,r=e*u;for(let e=0;e<u;e++){const o=t+e*m;let s;switch(a){case 5120:s=_.getInt8(o);break;case 5121:s=_.getUint8(o);break;case 5122:s=_.getInt16(o,!0);break;case 5123:s=_.getUint16(o,!0);break;case 5125:s=_.getUint32(o,!0);break;case 5126:s=_.getFloat32(o,!0);break;default:throw new Error(`Unsupported componentType: ${a}`)}p[r+e]=s}}return p}(e,o,s,a.componentType,a.type),d=i;for(let e=0;e<s.count;e++){const t=l[e]*d;for(let r=0;r<d;r++)c[t+r]=u[e*d+r]}}else if("VEC3"===a.type&&void 0!==a.min&&void 0!==a.max&&5126!==a.componentType){const e=new Float32Array(c.length);for(let t=0;t<c.length;t++)e[t]=c[t];c=e}a.normalized&&(c=function(e,t){const r=new Float32Array(e.length);switch(t){case 5120:{const t=127;for(let o=0;o<e.length;o++)r[o]=Math.max(e[o]/t,-1);break}case 5121:{const t=255;for(let o=0;o<e.length;o++)r[o]=e[o]/t;break}case 5122:{const t=32767;for(let o=0;o<e.length;o++)r[o]=Math.max(e[o]/t,-1);break}case 5123:{const t=65535;for(let o=0;o<e.length;o++)r[o]=e[o]/t;break}default:throw new Error("normalizeAccessor: Unsupported componentType "+t)}return r}(c,a.componentType));const u={buffer:c,count:a.count,componentType:a.componentType,type:a.type,min:a.min,max:a.max};return e.accessorsCache.set(s,u),u};const r={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};t.WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}})),define("DS/WebVisuGLTF/GLTFLoaderUtils",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})),define("DS/WebVisuGLTF/CreateNodes",["require","exports","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS"],(function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createNodes=function(e,t,s){const a=[];if(e.gltf_data){const n=e.gltf_data.nodes,i=new Array;for(let e=0;e<n.length;e++){const l=n[e],c=new o.Vector3(0,0,0),u=new o.Quaternion(0,0,0,1),d=new o.Vector3(1,1,1);void 0!==l.scale&&d.set(l.scale[0],l.scale[1],l.scale[2]),void 0!==l.rotation&&u.set(l.rotation[0],l.rotation[1],l.rotation[2],l.rotation[3]),void 0!==l.translation&&c.set(l.translation[0],l.translation[1],l.translation[2]);const f=new o.Matrix4;void 0!==l.matrix?f.setFromArray(l.matrix):f.compose(c,u,d);const m=new r;if(void 0!==l.mesh){const e=t[l.mesh];void 0!==l.skin&&(e.setSkinningTransformations(s[l.skin].skin),i.push([s[l.skin],e])),m.addChild(e)}m.setName(l.name||`GLTF node ${e}`),m.setMatrix(f),a[e]=m}for(let e=0;e<n.length;e++){const t=n[e],r=a[e];if(void 0!==t.children)for(let e=0;e<t.children.length;e++)r.addChild(a[t.children[e]]),a[t.children[e]].parents[0]=r}for(const[e,t]of i)e.arrayNodes=a,e.updateBonesPoses()}return a}})),define("DS/WebVisuGLTF/CreateTextures",["require","exports","DS/Visualization/ThreeJS_DS"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createTextures=function(e,t){const n=[];if(e.gltf_data){const i=e.gltf_data.textures;if(!i)return[];for(let l=0;l<i.length;l++){const i=e.gltf_data.textures[l],c=void 0!==i.sampler?e.gltf_data.samplers[i.sampler]:{},u=void 0!==i.extensions&&void 0!==i.extensions.KHR_texture_basisu;let d;const f=a(u?e.gltf_data.images[i.extensions.KHR_texture_basisu.source]:e.gltf_data.images[i.source],e,t),m=()=>{d?(d.wrapS=o[c.wrapS],d.wrapT=o[c.wrapT],d.minFilter=s[c.minFilter],d.magFilter=s[c.magFilter],u&&(d.repeat=new r.Vector2(1,1),d.wrapS=r.RepeatWrapping,d.wrapT=r.RepeatWrapping),d.flipY=!1):console.log("no map is defined")};if(u)d=r.ImageUtils.loadKTX2Texture(f,null,m,m,void 0,r.BasisUsage.RGBA);else{const e=!(o[c.wrapS]===r.ClampToEdgeWrapping&&o[c.wrapT]===r.ClampToEdgeWrapping||i.wrapS===r._ClampToBorderWrapping&&i.wrapT===r._ClampToBorderWrapping);d=r.ImageUtils.loadTexture(f,void 0,m,m,r.ImageUtils.crossOriginPolicy,e)}d&&(n[l]=d)}}return n};const o={10497:1e3,33071:1001,33648:1002},s={9728:1003,9984:1004,9986:1005,9729:1006,9985:1007,9987:1008};function a(e,t,r){if(void 0!==e.bufferView&&t.gltf_data){const o=t.gltf_data.bufferViews[e.bufferView],s=o.byteOffset||0,a=s+o.byteLength;if(null==o.byteStride){const t=r[o.buffer].slice(s,a),n=new Blob([t],{type:e.mimeType});return URL.createObjectURL(n)}return console.log("TextureURL byteStride present, but not handled yet"),""}if(void 0!==e.uri){const r=e.uri;if("data"==r.slice(0,4)){const e=r.split(",").pop(),t=window.atob(e),o=new Uint8Array(t.length);for(let e=0;e<o.length;e++)o[e]=t.charCodeAt(e);return URL.createObjectURL(new Blob([o.buffer]))}if(t.path)return t.path+e.uri;if(t.complementaryFiles)for(const e of t.complementaryFiles)if(e.name===r){const t=new Blob([e.data]);return URL.createObjectURL(t)}}return console.warn("no data found for texture",e),""}})),define("DS/WebVisuGLTF/CreateMaterials",["require","exports","DS/Visualization/ThreeJS_DS"],(function(e,t,r){"use strict";function o(e,t){const o={},s=new r.Matrix3;if(void 0!==e.scale){const t=new r.Vector2(e.scale[0],e.scale[1]);s.scale(t)}const a=new r.Matrix3;if(void 0!==e.rotation){const t=e.rotation;a.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1)}let n=new r.Matrix3;if(void 0!==e.offset){const t=e.offset[0],o=e.offset[1];n=new r.Matrix3(1,0,t,0,1,o,0,0,1)}const i=(new r.Matrix3).multiplyMatrices(a,s),l=(new r.Matrix3).multiplyMatrices(n,i);return"glossiness"==t?o.roughnessUvTransform=l:o[t+"UvTransform"]=l,void 0!==e.texCoord&&(e.texCoord>2?console.warn(`texCoord > 2 of textureTransform extension for ${t}, but only 2 uvSlot supported`):"glossiness"==t?o.roughnessUvSlot=1===e.texCoord?2:1:o[t+"UvSlot"]=1===e.texCoord?2:1),o}function s(e,t){let s={};const a=e.diffuseFactor||[1,1,1,1];if(s.opacity=a[3],void 0!==e.diffuseTexture){const n=e.diffuseTexture;if(void 0!==n.texCoord&&n.texCoord>2?console.warn(`texCoord > 2 for ${n}, but only 2 uvSlot supported`):(s.diffuseUvSlot=1===n.texCoord?2:1,s.map=t[n.index]),s.diffuseMulCoef=new r.Vector3(a[0],a[1],a[2]),void 0!==n.extensions){const e=n.extensions;void 0!==e.KHR_texture_transform&&(s={...s,...o(e.KHR_texture_transform,"diffuse")})}}else s.color=(new r.Color).setRGB(a[0],a[1],a[2]).convertLinearToGamma();const n=e.specularFactor||[1,1,1],i=void 0!==e.glossinessFactor?e.glossinessFactor:1;if(s.ior=1e6,s._fromGLTF_SpecGloss=!0,void 0!==e.specularGlossinessTexture){const a=e.specularGlossinessTexture,l=t[a.index];if(s.specularMap=l,s.roughnessMap=l,s.specularUvSlot=1===a.texCoord?2:1,s.roughnessUvSlot=1===a.texCoord?2:1,s.specularMulCoef=new r.Vector3(n[0],n[1],n[2]),s.specularAddCoef=new r.Vector3(0,0,0),s.roughnessMulCoef=-i,s.roughnessAddCoef=1,void 0!==a.extensions){const e=a.extensions;void 0!==e.KHR_texture_transform&&(s={...s,...o(e.KHR_texture_transform,"specular")},s={...s,...o(e.KHR_texture_transform,"glossiness")})}}else s.specular=(new r.Color).setRGB(n[0],n[1],n[2]).convertLinearToGamma(),s.roughness=1-i;return s}function a(e,t){let s={};const a=e.baseColorFactor||[1,1,1,1];if(s.opacity=a[3],void 0!==e.baseColorTexture){const n=e.baseColorTexture;if(void 0!==n.texCoord&&n.texCoord>2?console.warn("texCoord > 2, but only 2 uvSlot supported"):(s.diffuseUvSlot=1===n.texCoord?2:1,s.map=t[n.index]),s.diffuseMulCoef=new r.Vector3(a[0],a[1],a[2]),s.diffuseAddCoef=new r.Vector3(0,0,0),void 0!==n.extensions){const e=n.extensions;void 0!==e.KHR_texture_transform&&(s={...s,...o(e.KHR_texture_transform,"diffuse")})}}else s.color=(new r.Color).setRGB(a[0],a[1],a[2]).convertLinearToGamma();const n=void 0!==e.metallicFactor?e.metallicFactor:1,i=void 0!==e.roughnessFactor?e.roughnessFactor:1;if(void 0!==e.metallicRoughnessTexture){const r=e.metallicRoughnessTexture;if(s.metalnessMap=t[r.index],s.roughnessMap=t[r.index],s.MetalnessUvSlot=1===r.texCoord?2:1,s.roughnessUvSlot=1===r.texCoord?2:1,s.metalnessMulCoef=n,s.metalnessAddCoef=0,s.roughnessMulCoef=i,s.roughnessAddCoef=0,void 0!==r.extensions){const e=r.extensions;void 0!==e.KHR_texture_transform&&(s={...s,...o(e.KHR_texture_transform,"metalness")},s={...s,...o(e.KHR_texture_transform,"roughness")})}}else s.metalness=n,s.roughness=i;return s}function n(e,t,r){let s={};if(void 0!==t.texCoord&&t.texCoord>=2)console.warn(`texCoord >= 2 for ${r}, but only 2 uvSlot supported`);else{s[r+"UvSlot"]=1===t.texCoord?2:1;const o=e[t.index];s[r+"Map"]=o}if(void 0!==t.extensions){const e=t.extensions;void 0!==e.KHR_texture_transform&&(s={...s,...o(e.KHR_texture_transform,r)})}return s}function i(e,t){let o={};const s=void 0!==t.specularFactor?t.specularFactor:1;void 0!==t.specularTexture?(o={...o,...n(e,t.specularTexture,"specularContrib")},o.specularContribMulCoef=s,o.specularContribAddCoef=0):o.specularContrib=s;const a=t.specularColorFactor||[1,1,1];return void 0!==t.specularColorTexture?(o={...o,...n(e,t.specularColorTexture,"specular")},o.specularMulCoef=new r.Vector3(a[0],a[1],a[2]),o.specularAddCoef=new r.Vector3(0,0,0)):o.specular=(new r.Color).setRGB(a[0],a[1],a[2]).convertLinearToGamma(),o}function l(e,t){let o={};const s=t.thicknessFactor||0;void 0!==t.thicknessTexture&&(o={...o,...n(e,t.thicknessTexture,"thickness")},o.thicknessAddCoef=0,o.thicknessMulCoef=s),o.transparent=!0,o.thinWalled=0===s;const a=void 0!==t.attenuationDistance?t.attenuationDistance:1e6,i=t.attenuationColor||[1,1,1];return o.attenuationColor=(new r.Color).setRGB(i[0],i[1],i[2]).convertLinearToGamma(),o.attenuationDistance=a,o}function c(e,t){let r={};const o=t.clearcoatFactor||0;void 0!==t.clearcoatTexture?(r={...r,...n(e,t.clearcoatTexture,"clearCoat")},r.clearCoatMulCoef=o,r.clearCoatAddCoef=0):r.clearCoat=o;const s=t.clearcoatRoughnessFactor||0;return void 0!==t.clearcoatRoughnessTexture?(r={...r,...n(e,t.clearcoatRoughnessTexture,"clearCoatRoughness")},r.clearCoatRoughnessMulCoef=s,r.clearCoatRoughnessAddCoef=0):r.clearCoatRoughness=s,void 0!==t.clearcoatNormalTexture&&(r={...r,...n(e,t.clearcoatNormalTexture,"clearCoatNormal")}),r}function u(e,t){let o={};const s=t.sheenColorFactor||[1,1,1];void 0!==t.sheenColorTexture?(o={...o,...n(e,t.sheenColorTexture,"sheenColor")},o.sheenColorMulCoef=new r.Vector3(s[0],s[1],s[2]),o.sheenColorAddCoef=new r.Vector3(0,0,0)):o.sheenColor=(new r.Color).setRGB(s[0],s[1],s[2]).convertLinearToGamma();const a=t.sheenRoughnessFactor||0;return void 0!==t.sheenRoughnessTexture?(o={...o,...n(e,t.sheenRoughnessTexture,"sheenRoughness")},o.sheenRoughnessMulCoef=a,o.sheenRoughnessAddCoef=0):o.sheenRoughness=a,o}function d(e,t){let r={transparent:!0};const o=t.transmissionFactor||0;return void 0!==t.transmissionTexture?(r={...r,...n(e,t.transmissionTexture,"transparency")},r.transparencyMulCoef=o,r.transparencyAddCoef=0):r.transparency=o,r}function f(e,t){let r={transparent:!0},o=t.translucencyFactor||0;return void 0!==t.translucencyTexture?(r={...r,...n(e,t.translucencyTexture,"translucency")},r.translucencyMulCoef=o,r.translucencyAddCoef=0):r.translucency=o,r}function m(e,t){const r={},o=e.anisotropyFactor||0,s=e.anisotropyRotationFactor||0;if(void 0!==e.anisotropyTexture){const a=e.anisotropyTexture,n=t[a.index];r.anisotropyMap=n,r.anisotropyAngleMap=n,r.anisotropyUvSlot=1===a.texCoord?2:1,r.anisotropyAngleUvSlot=1===a.texCoord?2:1,r.anisotropyMulCoef=o,r.anisotropyAddCoef=0,r.anisotropyAngleMulCoef=s,r.anisotropyAngleAddCoef=0}else r.anisotropy=o,r.anisotropyAngle=s;return r}Object.defineProperty(t,"__esModule",{value:!0}),t.DummyMaterialManager=void 0,t.createMaterials=function(e,t){const o=[];if(e.gltf_data){const h=e.gltf_data.materials;if(h)for(let p=0;p<h.length;p++){const h=e.gltf_data.materials[p];let _={_from_GLTF:!0},g=!1;void 0!==h.extensions&&void 0!==h.extensions.KHR_materials_pbrSpecularGlossiness&&(g=!0),void 0!==h.name&&(_.name=h.name),g&&(_={..._,...s(h.extensions.KHR_materials_pbrSpecularGlossiness,t)}),void 0===h.pbrMetallicRoughness||g||(_={..._,...a(h.pbrMetallicRoughness,t)});const w=h.emissiveFactor||[0,0,0];if(_.emissionValue=Math.PI,void 0!==h.emissiveTexture?(_={..._,...n(t,h.emissiveTexture,"emissionColor")},_.emissionColorMulCoef=new r.Vector3(w[0],w[1],w[2]),_.emissionColorAddCoef=new r.Vector3(0,0,0)):_.emissionColor=(new r.Color).setRGB(w[0],w[1],w[2]).convertLinearToGamma(),void 0!==h.alphaMode){const e=h.alphaMode;"OPAQUE"==e&&(_.opacity=1,_.useAlphaFromDiffuseMap=!1),"BLEND"==e&&(_.transparent=!0),"MASK"==h.alphaMode&&(_.alphaTestMode=r.AlphaTestMode.DISCARD_OR_OPAQUE,void 0!==h.alphaCutoff?_._alphaTest=h.alphaCutoff<1?h.alphaCutoff:1:_._alphaTest=.5)}else _.opacity=1,_.useAlphaFromDiffuseMap=!1;if(h.doubleSided?(_.side=2,_.forceSide=!0):_.side=0,void 0!==h.normalTexture){_.needTangent=!0,_.needTangentBinormal=!0;const e=h.normalTexture;_={..._,...n(t,e,"normal")},_.normalMulCoef=new r.Vector3(-1,1,1),_.normalAddCoef=new r.Vector3(0,0,0),void 0!==e.scale&&(_.normalMulCoef=new r.Vector3(e.scale[0],-e.scale[1],1),_.normalAddCoef=new r.Vector3(0,0,0))}if(void 0!==h.occlusionTexture&&console.warn("occlusion texture not supported"),void 0!==h.extensions){const e=h.extensions;if(void 0!==e.KHR_materials_sheen&&(_={..._,...u(t,e.KHR_materials_sheen)}),void 0!==e.KHR_materials_transmission&&(_={..._,...d(t,e.KHR_materials_transmission)}),void 0!==e.KHR_materials_clearcoat&&(_={..._,...c(t,e.KHR_materials_clearcoat)}),void 0===e.KHR_materials_specular||g||(_={..._,...i(t,e.KHR_materials_specular)}),e.KHR_materials_volume&&(_={..._,...l(t,e.KHR_materials_volume)}),void 0===e.KHR_materials_ior||g||(_.ior=void 0!==e.KHR_materials_ior.ior?e.KHR_materials_ior.ior:1.5),void 0!==e.KHR_materials_sss){const t=e.KHR_materials_sss;if(_.attenuationDistance=t.scatterDistance||_.attenuationDistance,void 0!==t.scatterColor){const e=t.scatterColor;_.subsurfaceColor=(new r.Color).setRGB(e[0],e[1],e[2]).convertLinearToGamma()}}void 0!==e.KHR_materials_unlit&&(_.useLighting=!1),void 0!==e["3DS_materials_translucency"]&&(_={..._,...f(t,e["3DS_materials_translucency"])}),void 0!==e["3DS_materials_anisotropy"]&&(_={..._,...m(e["3DS_materials_anisotropy"],t)})}const v=new r.DSPBR25xMaterial(_);o.push(v)}}return o};t.DummyMaterialManager=class{constructor(){this.map=new Map}getCGRSharedMaterial(e,t){return this.map.get(e)}setCGRSharedMaterial(e,t){return this.map.set(e,t)}get CGRSharedMaterials(){return{clear:()=>this.map.clear()}}}})),define("DS/WebVisuGLTF/CreateMeshes",["require","exports","DS/Mesh/Mesh","DS/Visualization/Mesh3D","DS/WebVisuGLTF/CreateAccessors","DS/Visualization/ThreeJS_DS"],(function(e,t,r,o,s,a){"use strict";function n(e,t,r,o,n){let i=0;const l=new a.BufferGeometryDS;if(function(e,t,r,o,n,i){if(void 0!==e.POSITION){const a=(0,s.getAccessor)(n,i,e.POSITION);if(t.vertexPositionArray=a.buffer,a.min)r[0]>a.min[0]&&(r[0]=a.min[0]),r[1]>a.min[1]&&(r[1]=a.min[1]),r[2]>a.min[2]&&(r[2]=a.min[2]);else{for(let e=0;e<a.buffer.length;e+=3)r[0]>a.buffer[e]&&(r[0]=a.buffer[e]),r[1]>a.buffer[e+1]&&(r[1]=a.buffer[e+1]),r[2]>a.buffer[e+2]&&(r[2]=a.buffer[e+2]);console.warn("Position Accessor has no min values defined, this does not respects GLTF 2.0 specifications. new Computed min is",r)}if(a.max)o[0]<a.max[0]&&(o[0]=a.max[0]),o[1]<a.max[0]&&(o[1]=a.max[1]),o[2]<a.max[0]&&(o[2]=a.max[2]);else{for(let e=0;e<a.buffer.length;e+=3)o[0]<a.buffer[e]&&(o[0]=a.buffer[e]),o[1]<a.buffer[e+1]&&(o[1]=a.buffer[e+1]),o[2]<a.buffer[e+2]&&(o[2]=a.buffer[e+2]);console.warn("Position Accessor has no max values defined, this does not respects GLTF 2.0 specifications. new Computed max is",o)}}if(void 0!==e.JOINTS_0){const r=(0,s.getAccessor)(n,i,e.JOINTS_0),o=new Float32Array(r.buffer.length);for(let e=0;e<r.buffer.length;e++)o[e]=r.buffer[e];t.vertexSkinIndexArray=o}void 0!==e.WEIGHTS_0&&(t.vertexSkinWeightArray=(0,s.getAccessor)(n,i,e.WEIGHTS_0).buffer),void 0!==e.NORMAL&&(t.vertexNormalArray=(0,s.getAccessor)(n,i,e.NORMAL).buffer);const l=e=>{const t=e.length>>1,r=new Float32Array(3*t);let o=0,s=0;for(;o<e.length;)r[s++]=e[o++],r[s++]=e[o++],r[s++]=0;return r};if(void 0!==e.TEXCOORD_0&&(t.vertexUvArray=l((0,s.getAccessor)(n,i,e.TEXCOORD_0).buffer)),void 0!==e.TEXCOORD_1&&(t.vertexUv2Array=l((0,s.getAccessor)(n,i,e.TEXCOORD_1).buffer)),void 0!==e.TANGENT){const r=(0,s.getAccessor)(n,i,e.TANGENT).buffer,o=r.length>>2,l=new Float32Array(3*o),c=new Float32Array(3*o),u=new a.Vector3,d=new a.Vector3,f=new a.Vector3;for(let e=0,s=0,a=0;e<o;e++,s+=4,a+=3){const e=r[s],o=r[s+1],n=r[s+2],i=r[s+3];l[a]=e,l[a+1]=o,l[a+2]=n,u.set(e,o,n),d.set(t.vertexNormalArray[a],t.vertexNormalArray[a+1],t.vertexNormalArray[a+2]),f.crossVectors(d,u).multiplyScalar(i),c[a]=f.x,c[a+1]=f.y,c[a+2]=f.z}t.vertexTangentArray=l,t.vertexBinormalArray=c}}(e.attributes,l,r,t,o,n),void 0!==e.indices){const t=(0,s.getAccessor)(o,n,e.indices);i=t.count,l.vertexIndexArray=t.buffer}else{const t=[];i=(0,s.getAccessor)(o,n,e.attributes.POSITION).buffer.length/3;for(let e=0;e<i;e++)t.push(e);l.vertexIndexArray=new Uint32Array(t)}return{geom:l,count:i}}function i(e,t,r,o){let s;return s="material"===r?e.getCGRSharedMaterial(t[r],o):e.getCGRSharedMaterial(t.extras[r],o),null!==s?.normalMap&&void 0!==t.attributes.TANGENT&&(s.normalMulCoef.x*=-1),s}Object.defineProperty(t,"__esModule",{value:!0}),t.createMeshes=async function(e,t,s){const l=[];if(e.gltf_data){const u=e.gltf_data.meshes;for(let d=0;d<u.length;d++){const f=[],m=u[d].primitives,h=[-1/0,-1/0,-1/0],p=[1/0,1/0,1/0];let _=4;const g={4:a.GeomTypeEnum.FACE,1:a.GeomTypeEnum.UNKNOWN,0:a.GeomTypeEnum.UNKNOWN};let w=0;const v=new a._GASPBRMaterial({color:0,side:2,roughness:.34},new a.MeshPhongMaterial({color:0,specular:16777215,shininess:76,side:2}));for(let o=0;o<m.length;o++){const l=m[o];let u,d=null;if(l.extensions&&l.extensions.KHR_draco_mesh_compression){const t=await c(s,l,e),r=e.gltf_data.accessors[l.attributes.POSITION];h[0]=r.max[0],h[1]=r.max[1],h[2]=r.max[2],p[0]=r.min[0],p[1]=r.min[1],p[2]=r.min[2],d=t.geometry,u=t.count}else{const t=n(l,h,p,e,s);d=t.geom,u=t.count}let y=null;void 0!==l.material&&(y=i(t,l,"material",!1)),l.extras&&void 0!==l.extras.materialLibraryId&&e.materialManager&&(y=i(e.materialManager,l,"materialLibraryId",!1)),void 0!==l.mode&&(_=l.mode);const x=[],b=new r.DrawingGroup(v,y,_,w,u,x,void 0,g[_]||a.GeomTypeEnum.UNKNOWN);if(b.geometry=d,l.extras&&l.extras.SGPrimitivesArray){const e=l.extras.SGPrimitivesArray;for(const t of e){let e;const o=new r.SGPrimitive({group:b,rep:e,start:t.start,count:t.count,cgmId:""});x.push(o),console.log("rep should be null, I don't know why it would be different",e),e._primitives.push(o)}}else{const e=new r.SGRep({primitives:x}),t=new r.SGPrimitive({group:b,start:w,count:u,rep:e,cgmId:""});x.push(t)}b.geometry.drawingGroups=[b],f.push(d)}f.boundingBox=new a.Box3(new a.Vector3(p[0],p[1],p[2]),new a.Vector3(h[0],h[1],h[2])),f.boundingSphere=f.boundingBox.getBoundingSphere(),e.meshCommonMaterial&&console.warn("has meshCommonMaterial, pls handle");const y=new a.Mesh(f);y.fromLoadedModel=!0;const x=new o(y,u[d].name||`Mesh ${d}`);x.setShadow(!0,!0),l.push(x)}}return l};const l={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"};async function c(e,t,r){const o=t.extensions.KHR_draco_mesh_compression.attributes,a={},n={},i={};for(const e in o){a[l[e]||e.toLowerCase()]=o[e]}for(const e in t.attributes){const a=l[e]||e.toLowerCase();if(void 0!==o[e]){const o=r.gltf_data.accessors[t.attributes[e]],l=s.WEBGL_COMPONENT_TYPES[o.componentType];i[a]=l.name,n[a]=!0===o.normalized}}const c={attributeIDs:a||{position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},attributeTypes:i||{position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"},useUniqueIDs:!!a},u=r.gltf_data.bufferViews[t.extensions.KHR_draco_mesh_compression.bufferView];let d;const f=u.byteOffset||0,m=f+u.byteLength;if(null!=u.byteStride)throw new Error("DEBUG HERE, bytestride handling");d=e[u.buffer].slice(f,m);const h=r.dracoLoader.decodeGeometry(d,c);for(const e in h.attributes){const t=h.attributes[e],r=n[e];void 0!==r&&(t.normalized=r)}return h}})),define("DS/WebVisuGLTF/CreateAnimations",["require","exports","DS/WebVisuGLTF/CreateAccessors","DS/Visualization/ThreeJS_DS"],(function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnimationClip=void 0,t.createAnimations=function(e,t,o){const n=new Array;if(e.gltf_data&&e.gltf_data.animations)for(const i of e.gltf_data.animations){const l=new Array;for(const a of i.channels){const n=o[a.target.node],c=i.samplers[a.sampler],u=(0,r.getAccessor)(e,t,c.input),d=(0,r.getAccessor)(e,t,c.output),f=a.target.path;l.push(new s(n,f,u.buffer,d.buffer,c.interpolation,"rotation"===a.target.path?4:3))}n.push(new a(l,i.name))}return n};class s{constructor(e,t,r,o,s,a){this._node=e,this._path=t,this._times=r,this._values=o,this._interpolation=s||"LINEAR",this._valueSize=a,this._maxTime=r[r.length-1],this._minTime=r[0]}get maxTime(){return this._maxTime}get minTime(){return this._minTime}getInterpolatedData(e){let t=0,r=this._times.length-1;for(let r=0;r<this._times.length;r++)if(this._times[r]>e){t=r-1;break}for(let t=this._times.length-2;t>=0;t--)if(this._times[t]<=e){r=t+1;break}switch(this._interpolation){case"CUBICSPLINE":return this.cubicSplieInterpolate();case"LINEAR":return this.linearInterpolate(e,t,r);case"STEP":return this.stepInterpolate(t)}}get path(){return this._path}cubicSplieInterpolate(){return console.log("TODO, CubicSpline interpolation not implemented yet"),4===this._valueSize?new o.Quaternion:new o.Vector3}stepInterpolate(e){return 4===this._valueSize?new o.Quaternion(this._values[this._valueSize*e],this._values[this._valueSize*e+1],this._values[this._valueSize*e+2],this._values[this._valueSize*e+3]):new o.Vector3(this._values[this._valueSize*e],this._values[this._valueSize*e+1],this._values[this._valueSize*e+2])}linearInterpolate(e,t,r){if(4===this._valueSize){const s=new o.Quaternion(this._values[this._valueSize*t],this._values[this._valueSize*t+1],this._values[this._valueSize*t+2],this._values[this._valueSize*t+3]),a=new o.Quaternion(this._values[this._valueSize*r],this._values[this._valueSize*r+1],this._values[this._valueSize*r+2],this._values[this._valueSize*r+3]);return s.slerp(a,(e-this._times[t])/(this._times[r]-this._times[t]))}{const s=new o.Vector3(this._values[this._valueSize*t],this._values[this._valueSize*t+1],this._values[this._valueSize*t+2]),a=new o.Vector3(this._values[this._valueSize*r],this._values[this._valueSize*r+1],this._values[this._valueSize*r+2]),n=(e-this._times[t])/(this._times[r]-this._times[t]);return s.lerp(a,n)}}get node(){return this._node}}class a{constructor(e,t){this._name=t,this._keyframes=e,this._minTime=this._keyframes[0].minTime;for(const e of this._keyframes)e.minTime<this._minTime&&(this._minTime=e.minTime);this._maxTime=this._keyframes[0].maxTime;for(const e of this._keyframes)e.maxTime>this._maxTime&&(this._maxTime=e.maxTime)}get name(){return this._name}get startTime(){return this._minTime}get endTime(){return this._maxTime}update(e){e<this._minTime&&(e=this._minTime),e>this._maxTime&&(e=this._maxTime);for(const t of this._keyframes){const r=t.node.getMatrix().decompose(),s=r[0],a=r[1],n=r[2],i=t.getInterpolatedData(e);switch(t.path){case"rotation":a.copy(i);break;case"scale":n.copy(i);break;case"translation":s.copy(i)}t.node.setMatrix((new o.Matrix4).compose(s,a,n))}}}t.AnimationClip=a})),define("DS/WebVisuGLTF/CreateSkins",["require","exports","DS/WebVisuGLTF/CreateAccessors","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory"],(function(e,t,r,o,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GLTFSkeleton=void 0,t.createSkins=function(e,t){const o=new Array;if(e.gltf_data&&e.gltf_data.skins){const s=e.gltf_data.skins;for(let a=0;a<s.length;a++){const i=s[a],l=i.inverseBindMatrices?(0,r.getAccessor)(e,t,i.inverseBindMatrices):null;if(l){const e=new n(l.buffer,i.joints,void 0!==i.skeleton?i.skeleton:i.joints[0]);o.push(e)}else o.push(new n(null,i.joints,void 0!==i.skeleton?i.skeleton:i.joints[0]))}}return o};class n{constructor(e,t,r){this._skin=new o.SkinningTransformations,this._inverseBindMatrices=e,this._bones=t,this._bonesMatrices=new Float32Array(12*t.length),this._skeletonRoot=r}set arrayNodes(e){this._arrayNodes=e}getSkeletonRootNode(){if(this._arrayNodes)return this._arrayNodes[this._skeletonRoot];throw new Error("Cannot get root node as the Skeleton does not have access yet to all nodes")}getInverseBindMatrix(e){if(null===this._inverseBindMatrices)return new o.Matrix4;const t=Array.from(this._inverseBindMatrices.slice(16*e,16*(e+1)));return(new o.Matrix4).setFromArray(t)}get skin(){return this._skin}_getNodeTransform_Rec(e,t){let r=e.getMatrix();return e!==t&&e.parents.length>0&&e.parents[0]?this._getNodeTransform_Rec(e.parents[0],t).multiply(r):r}addDebugBones(e){if(void 0!==this._arrayNodes){this._debugNodes=new Array(this._arrayNodes.length);for(let t=0;t<this._bones.length;t++){const r=new s;r.addChild(a.createCuboidNode({cornerPoint:new o.Vector3(0,0,0),firstAxis:new o.Vector3(.01,0,0),secondAxis:new o.Vector3(0,.001,0),thirdAxis:new o.Vector3(0,0,.001),material:new o.MeshBasicMaterial({color:"red",force:!0})})),r.addChild(a.createCuboidNode({cornerPoint:new o.Vector3(0,0,0),firstAxis:new o.Vector3(.001,0,0),secondAxis:new o.Vector3(0,.01,0),thirdAxis:new o.Vector3(0,0,.001),material:new o.MeshBasicMaterial({color:"green",force:!0})})),r.addChild(a.createCuboidNode({cornerPoint:new o.Vector3(0,0,0),firstAxis:new o.Vector3(.001,0,0),secondAxis:new o.Vector3(0,.001,0),thirdAxis:new o.Vector3(0,0,.01),material:new o.MeshBasicMaterial({color:"blue",force:!0})})),this._debugNodes[t]=r,e.addChild(r)}}else console.error("cannot add debug bones poses without nodes array")}updateBonesPoses(){if(void 0!==this._arrayNodes){for(let e=0;e<this._bones.length;e++){let t=12*e;const r=this._getNodeTransform_Rec(this._arrayNodes[this._bones[e]],this._arrayNodes[this._skeletonRoot]),o=r.clone().multiply(this.getInverseBindMatrix(e));this._bonesMatrices[t]=o.elements[0],this._bonesMatrices[t+1]=o.elements[1],this._bonesMatrices[t+2]=o.elements[2],this._bonesMatrices[t+3]=o.elements[4],this._bonesMatrices[t+4]=o.elements[5],this._bonesMatrices[t+5]=o.elements[6],this._bonesMatrices[t+6]=o.elements[8],this._bonesMatrices[t+7]=o.elements[9],this._bonesMatrices[t+8]=o.elements[10],this._bonesMatrices[t+9]=o.elements[12],this._bonesMatrices[t+10]=o.elements[13],this._bonesMatrices[t+11]=o.elements[14],this._debugNodes&&this._debugNodes[e].setMatrix(r)}this._skin.setSkinningMatrices(this._bonesMatrices,this._bones.length)}else console.error("cannot update bones poses without nodes array")}}t.GLTFSkeleton=n})),define("DS/WebVisuGLTF/GLTFLoader",["require","exports","DS/Visualization/Node3D","UWA/Utils","DS/WAFData/WAFData","DS/WebVisuGLTF/CreateMeshes","DS/WebVisuGLTF/CreateNodes","DS/WebVisuGLTF/CreateTextures","DS/WebVisuGLTF/CreateMaterials","DS/Visualization/ThreeJS_DS","DS/Visualization/MaterialManager","DS/WebVisuDracoLoader/DracoLoader","DS/WebVisuGLTF/CreateSkins","DS/WebVisuGLTF/CreateAnimations"],(function(e,t,r,o,s,a,n,i,l,c,u,d,f,m){"use strict";class h{constructor(){this.supportedExtensions={KHR_materials_ior:!0,KHR_materials_clearcoat:!0,KHR_materials_sheen:!0,KHR_materials_translucency:!0,KHR_materials_transmission:!0,KHR_texture_transform:!0,KHR_materials_specular:!0,KHR_materials_pbrSpecularGlossiness:!0,KHR_lights_punctual:!0,KHR_materials_unlit:!0,KHR_texture_basisu:!0,"3DS_materials_translucency":!0,KHR_draco_mesh_compression:!0,KHR_mesh_quantization:!0},this.accelStruct=!1,this.loadMaterial=!0}async _load(e,t){if("string"==typeof e){const r=e.trim();return new Promise(((e,a)=>{const n=(0,o.parseUrl)(r),i=n.protocol+"://"+n.authority+n.directoryPath,l=(n.fileName?n.fileName:r).match(/\.[0-9a-z]+$/i);if(null===l)a(new Error("Could not find extension in filename "+r));else{const o=l[0],n=o=>{t.gltf_data=o,t.path=i,t.filename=r,this.loadBuffers(0,t,[]).then((r=>{e(this.loadModel(t,r))}))},c=o=>{t.path=i,t.filename=r,this.processGLB(o,t).then((r=>{e(this.loadModel(t,r))}))},u=e=>{a(e)};try{".gltf"===o?(0,s.request)(r,{async:!0,responseType:"json",onComplete:n,onFailure:u}):".glb"===o&&(0,s.request)(r,{async:!0,responseType:"arraybuffer",onComplete:c,onFailure:u})}catch(e){a(e)}}}))}if(e instanceof ArrayBuffer){const r=await this.processGLB(e,t);return this.loadModel(t,r)}if(e instanceof Uint8Array){const o=await this.processGLB((r=e,r.buffer.slice(r.byteOffset,r.byteLength+r.byteOffset)),t);return this.loadModel(t,o)}return this.loadFromFileBlobs(e);var r}async load(e){return this._load(e,{accessorsCache:new Map})}async loadMaterialLibrary(e){return void 0===this._materialManager&&(this._materialManager=new u),this._materialManager.CGRSharedMaterials.clear(),new Promise(((t,r)=>{if("string"==typeof e){const a=e.trim(),n=(0,o.parseUrl)(a),c=n.protocol+"://"+n.authority+n.directoryPath,u=(n.fileName?n.fileName:a).match(/\.[0-9a-z]+$/i);if(null===u)r(new Error((n.fileName,n.fileName)));else{const e=u[0],o={path:c,accessorsCache:new Map},n=e=>{this.processGLB(e,o).then((async e=>{const r=(0,i.createTextures)(o,e),s=(0,l.createMaterials)(o,r);for(let e=0;e<s.length;e++)this._materialManager.setCGRSharedMaterial(e,s[e]);t()}))},d=e=>{o.gltf_data=e,o.path=c,o.filename=a,this.loadBuffers(0,o,[]).then((e=>{const r=(0,i.createTextures)(o,e),s=(0,l.createMaterials)(o,r);for(let e=0;e<s.length;e++)this._materialManager.setCGRSharedMaterial(e,s[e]);t()}))},f=e=>{r(e)};try{".glb"===e&&(0,s.request)(a,{async:!0,responseType:"arraybuffer",onComplete:n,onFailure:f}),".gltf"===e&&(0,s.request)(a,{async:!0,responseType:"json",onComplete:d,onFailure:f})}catch(e){r(e)}}}else if(e instanceof ArrayBuffer){const r={accessorsCache:new Map};this.processGLB(e,r).then((async e=>{const o=(0,i.createTextures)(r,e),s=(0,l.createMaterials)(r,o);for(let e=0;e<s.length;e++)this._materialManager.setCGRSharedMaterial(e,s[e]);t()}))}}))}async loadWithMaterialLibrary(e){const t={materialManager:this._materialManager,accessorsCache:new Map};return this._load(e,t)}loadBinFileBlob(e,t){return new Promise(((r,o)=>{t.addEventListener("loadend",(e=>{e.target&&e.target.result?"string"==typeof e.target.result?o(new Error("Please call loadBinFileBlob to load binary files")):r(e.target.result):o(new Error("Failed to read file"+e))})),t.readAsArrayBuffer(e)}))}loadTextFileBlob(e,t){return new Promise(((r,o)=>{t.addEventListener("loadend",(e=>{e.target&&e.target.result?"string"==typeof e.target.result?r(e.target.result):o(new Error("Please call loadBinFileBlob to load text files")):o(new Error("Failed to read file"))})),t.readAsText(e)}))}async loadFromFileBlobs(e){const t=new FileReader,o=[],s=[],a=[];if(e instanceof ArrayBuffer)s.push(e);else for(let r=0;r<e.length;r++){const n=e.item(r),i=n.name.match(/\.[0-9a-z]+$/i);if(i&&i[0])switch(i[0]){case".gltf":a.push(await this.loadTextFileBlob(n,t));break;case".glb":const e=await this.loadBinFileBlob(n,t);s.push(e);break;default:o.push({data:await this.loadBinFileBlob(n,t),name:n.name})}}const n=new r;for(const e of a){const t={gltf_data:JSON.parse(e),complementaryFiles:o,accessorsCache:new Map},r=await this.loadBuffers(0,t,[]),s=await this.loadModel(t,r);n.addChild(s)}for(const e of s){const t={gltf_data:void 0,complementaryFiles:o,accessorsCache:new Map},r=await this.processGLB(e,t),s=await this.loadModel(t,r);n.addChild(s)}return n}async processGLB(e,t){let r=0,o=12;const s=new Uint32Array(e.slice(r,o)),a=s[0],n=s[2];1179937895!=a&&console.warn("magic in header of glb not recognized"),r=12,o=new Uint32Array(e.slice(r,r+4))[0];let i=new Uint32Array(e.slice(r+4,r+8))[0];if(r+=8,1313821514!=i)throw new Error("type in json chunk not equal to json ASCII (in glb file), got "+i+" expected 1313821514");const l=e.slice(r,r+o),c=JSON.parse((new TextDecoder).decode(l));r+=o,r+=r%4==0?0:4-r%4,t.gltf_data=c;const u=[];for(;r<n;)o=new Uint32Array(e.slice(r,r+4))[0],i=new Uint32Array(e.slice(r+4,r+8))[0],r+=8,5130562==i&&u.push(e.slice(r,r+o)),r+=o,r+=r%4==0?0:4-r%4;return this.loadBuffers(0,t,u)}async loadBuffers(e,t,r){if(t.gltf_data&&e<t.gltf_data.buffers.length){const o=t.gltf_data.buffers[e].uri;if(void 0!==o){if("data"==o.slice(0,4)){const s=o.split(",").pop(),a=window.atob(s),n=new Uint8Array(a.length);for(let e=0;e<n.length;e++)n[e]=a.charCodeAt(e);return r[e]=n.buffer,this.loadBuffers(e+1,t,r)}return new Promise(((a,n)=>{const i=o=>{r[e]=o,a(this.loadBuffers(e+1,t,r))},l=()=>{console.warn(`failed to load buffer ${e} `),a(this.loadBuffers(e+1,t,r))};if(t.path){const e=t.path+o;(0,s.request)(e,{async:!0,responseType:"arraybuffer",onComplete:i,onFailure:l})}else if(t.complementaryFiles){for(const e of t.complementaryFiles)if(e.name===o){i(e.data);break}}else console.error("no path nor complementary files")}))}return this.loadBuffers(e+1,t,r)}if(t.gltf_data&&e==t.gltf_data.buffers.length)return r;throw new Error("mmmhhh, index out of bounds or no modelData.gltf_data")}async loadModel(e,t){if(e.gltf_data&&e.gltf_data.extensionsRequired){let t=!0;for(const r of e.gltf_data.extensionsRequired)"KHR_draco_mesh_compression"!==r||e.dracoLoader||(void 0===this._dracoLoader&&(this._dracoLoader=new d),e.dracoLoader=this._dracoLoader,h.forceDracoLibAsJS&&e.dracoLoader.setDecoderConfig({type:"js"}),e.dracoLoader.preload()),this.supportedExtensions[r]||(t=!1,console.error("WebVisuGLTF: GLTF Extension : "+r+" is not supported"));if(!t)throw new Error("WebVisuGLTF: Not all required GLTF extensions are supported")}const o=new l.DummyMaterialManager;if(this.loadMaterial){const r=(0,i.createTextures)(e,t),s=(0,l.createMaterials)(e,r);for(let e=0;e<s.length;e++)o.setCGRSharedMaterial(e,s[e])}const s=await(0,a.createMeshes)(e,o,t),u=(0,f.createSkins)(e,t),p=(0,n.createNodes)(e,s,u),_=e.gltf_data?e.gltf_data.scenes:[],g=new r(e.filename),w=new r("ConversionMatrix");g.addChild(w);const v=new c.Matrix4;v.makeScale(1e3,1e3,1e3).rotateX(.5*Math.PI).rotateY(Math.PI),w.setMatrix(v);for(let e=0;e<_.length;e++){const t=_[e];if(void 0!==t.nodes){const e=t.nodes;for(let t=0;t<e.length;t++)w.addChild(p[e[t]])}}this.accelStruct&&g.buildAccelerationStructure(!1);const y=(0,m.createAnimations)(e,t,p);return y.length>0&&(g.getAnimations=()=>y),u.length>0&&(g.getSkeletons=()=>u),g}setAccelerationStructure(e){this.accelStruct=e}setLoadMaterial(e){this.loadMaterial=e}}return h.forceDracoLibAsJS=!1,h})),define("DS/WebVisuGLTF/DragAndDropGLTFLoad",["require","exports","DS/WebVisuGLTF/GLTFLoader","DS/Visualization/GaussianSplattingUtils","DS/WebappsUtils/WebappsUtils","DS/WAFData/WAFData","UWA/Core","DS/Windows/Panel","DS/Controls/Slider"],(function(e,t,r,o,s,a,n,i,l){"use strict";function c(e,t,r,o){const s=new n.Element("div"),a=e.getImmersiveFrame();new i({title:"Animation Manager",content:s,immersiveFrame:a,resizableFlag:!1,titleBarVisibleFlag:!0,width:350,height:125});const c=new n.Element("div");c.inject(s);const u=new n.Element("p");u.textContent="Animations",u.inject(c);for(const e of t){if(e.name){const t=new n.Element("p");t.textContent=e.name+":",t.inject(c)}const t=new l({value:e.startTime,minValue:e.startTime,maxValue:e.endTime,stepValue:(e.endTime-e.startTime)/100});t.inject(c);let s=0;const a=e.endTime,i=e.startTime;let u;const d=()=>{if(e.update(i+s),s=(s+.016)%(a-i),o)for(const e of o)e.updateBonesPoses();r.get3DViewer().defaultAnimationLoop&&r.get3DViewer().render(),u=setTimeout(d,16)};d(),t.addEventListener("change",(function(){if(clearTimeout(u),e.update(t.value),r.get3DViewer().render(),o)for(const e of o)e.updateBonesPoses()}))}}return class{constructor(e){}async initialize(){const e=this.getExecutionContext().getComponent("Viewer"),t=new o({viewer:e.get3DViewer()}),n=new r,i=new URLSearchParams(window.location.search),l=i.get("assetsModuleName"),u=i.get("modelUrl");if(u){let r=u;l&&(r=(0,s.getWebappsAssetUrl)(l,u));const o=r.match(/\.[0-9a-z]+$/i);if(o&&o[0])if(".cgr"===o[0])e.getModelLoader().setFileType("cgr"),e.getModelLoader().onLoadedCB=()=>{e._viewpoint.reframe()},e.getModelLoader().loadModel(r,e.get3DViewer().getRootNode());else if(".3dxml"===o[0])e.getModelLoader().setFileType("xmlv43"),e.getModelLoader().onLoadedCB=()=>{e._viewpoint.reframe()},e.getModelLoader().loadModel(r,e.get3DViewer().getRootNode());else if(".ply"===o[0]){e.get3DViewer().autoUpdateFrustum=!1,e._viewpoint.camera.far=1e9,e._viewpoint.camera.near=1,e.get3DViewer().renderer.initEffect("GaussianSplat"),e.get3DViewer().renderer.setEffect("GaussianSplat",!0);const o=r=>{const o=t.createNode3DFromPLYFileData(r);e.get3DViewer().getRootNode().add(o),e._viewpoint.reframe(),e.get3DViewer().render()},s=e=>{console.log("error loading ply from url",e)};(0,a.request)(r,{async:!0,responseType:"arraybuffer",onComplete:o,onFailure:s})}else n.load(r).then((t=>{if(e.get3DViewer().getRootNode().addChild(t),t.getAnimations){c(this.getExecutionContext().getComponent(WAfrStandardComponentKey.UIFrame),t.getAnimations(),e,t.getSkeletons?t.getSkeletons():void 0)}e._viewpoint.reframe(),e.get3DViewer().render({updateInfinitePlane:!0})}))}return document.addEventListener("drop",(r=>{if(r.preventDefault(),r.dataTransfer){const o=r.dataTransfer.files;for(let r=0;r<o.length;r++){const s=o.item(r),a=s.name.match(/\.[0-9a-z]+$/i);if(a&&a[0])if(".cgr"===a[0]){e.get3DViewer().autoUpdateFrustum=!1,e._viewpoint.camera.far=1e9,e._viewpoint.camera.near=1,e.get3DViewer().renderer.initEffect("GaussianSplat"),e.get3DViewer().renderer.setEffect("GaussianSplat",!0),e.getModelLoader().setFileType("cgr");const t=window.URL.createObjectURL(s);e.getModelLoader().onLoadedCB=()=>{e._viewpoint.reframe()},e.getModelLoader().loadModel(t,e.get3DViewer().getRootNode()),console.log("loading cgr with Gaussian Splat effect activated")}else if(".3dxml"===a[0]){e.getModelLoader().setFileType("xmlv43");const t=window.URL.createObjectURL(s);e.getModelLoader().onLoadedCB=()=>{e._viewpoint.reframe()},e.getModelLoader().loadModel(t,e.get3DViewer().getRootNode())}else".ply"===a[0]&&(e.get3DViewer().autoUpdateFrustum=!1,e._viewpoint.camera.far=1e9,e._viewpoint.camera.near=1,e.get3DViewer().renderer.initEffect("GaussianSplat"),e.get3DViewer().renderer.setEffect("GaussianSplat",!0),s.arrayBuffer().then((r=>{const o=t.createNode3DFromPLYFileData(r);e.get3DViewer().getRootNode().add(o),e._viewpoint.reframe(),e.get3DViewer().render()})))}n.load(o).then((t=>{e.get3DViewer().getRootNode().addChild(t),e._viewpoint.reframe(),e.get3DViewer().render({updateInfinitePlane:!0});for(const r of t.children)if(r.getAnimations){c(this.getExecutionContext().getComponent(WAfrStandardComponentKey.UIFrame),r.getAnimations(),e,r.getSkeletons?r.getSkeletons():void 0)}}))}r.stopPropagation()})),document.addEventListener("dragenter",(e=>{e.preventDefault()})),document.addEventListener("dragover",(e=>{e.preventDefault()})),Promise.resolve()}async clean(){return Promise.resolve()}async destroy(){return Promise.resolve()}}}));