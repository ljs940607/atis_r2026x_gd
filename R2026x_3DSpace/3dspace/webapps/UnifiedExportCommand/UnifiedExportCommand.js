define("DS/UnifiedExportCommand/Utils/ExchangeInfra",["UWA/Class","DS/WAFData/WAFData","DS/CoreEvents/ModelEvents","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],(function(e,t,n,o,i,a){"use strict";return a.setNotificationManager(i),e.singleton({EXPORT_OUTPUT:"exportMethod",EngineeringFormatType:{NONE:0,ALL:1,NATIVE:2,DERIVED:3},URLS:{CVSERVLET_FETCH:"/cvservlet/fetch/v2",CVSERVLET_PROGESSIVEEXPAND:"/cvservlet/progressiveexpand/v2?output_format=cvjson&xrequestedwith=xmlhttprequest",COLLABORATIVESPACE_URL_EXPORT:"/resources/dataexchangeservice/collaborativespaceconfig/getvplmroleconfig?command=vplm::EXPORT"},EVENTS:{LOAD_METHOD_FAILED:"loadmethodfailed",ERROR_OCCURED:"erroroccured",PREPROCESS_STARTED:"preprocessstarted",PREPROCESS_SUCCEEDED:"preprocesssucceeded",EXPAND_STARTED:"expandstarted",EXPAND_SUCCEEDED:"expandsucceeded",CHECKIN_STARTED:"checkinstarted",CHECKIN_SUCCEEDED:"checkinsucceeded",CHECKIN_PROGRESS:"checkinprogress"},SERVICE_CONFIG:{"STEP AP242":"exchange","CAD Files":"xcaddataprocessor","3DEXPERIENCE":"transfer"},SERVER:{VERB:{GET:"GET",POST:"POST",PATCH:"PATCH",DELETE:"DELETE"},DEFAULT_HEADERS:{Accept:"application/json","Accept-Language":window.widget?window.widget.lang:window.dsLang||"en","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}}},{setup:function(e){let t=this;return t._private_={modelEvents:new n},t.options=UWA.extend(t.options||{},e),t.APP_ID=t.getAppId(),UWA.Promise.all([t.expectations(),t.getPlatformServices().then(t.getSecurityContext.bind(null,t)).then(t.getGrantedRoles.bind(null,t))])},get:function(){let e=this;return{platformServices:e.platformServices,securityContext:e.securityContext,grantedRoles:e.grantedRoles}},getPlatformServices:function(){let e=this;return new UWA.Promise((function(t,n){o.getPlatformServices({onComplete:e.postGetPlatformServices.bind(null,e,t)})}))},postGetPlatformServices:function(e,t,n){let o=n.find((function(t){return t.platformId==e.getX3DPlatformId()}));o||(o=n[0]),e.platformServices=o,e.platformServicesForAllPlatforms=n,t()},getSecurityContext:function(e){return new UWA.Promise((function(t,n){var o=e.getWidget()&&widget.getValue("xPref_CREDENTIAL")||e.options.context.getSecurityContext&&e.options.context.getSecurityContext();o?(e.securityContext=o.includes("::")?o.split("::")[1]:o,t()):e.postGetSecurityContextFailure(e,n)}))},postGetSecurityContextFailure:function(e,t){e.alert.error("",UWA.i18n("exchangecommand.notification.exportfailed.message4")),t()},getGrantedRoles:function(e){return new UWA.Promise((function(t,n){o.getGrantedRoles(e.postGetGrantedRoles.bind(null,e,t))}))},postGetGrantedRoles:function(e,t,n){e.grantedRoles=n,t()},getAppId:function(){let e=this;return e.getWidget()&&widget.getValue("x3dAppId")||e.options.context&&e.options.context.getAppId&&e.options.context.getAppId()||e.getWidget()&&widget.data&&widget.data.appId},getX3DPlatformId:function(){let e=this;return e.getWidget()&&widget.getValue("x3dPlatformId")||e.options.context.getX3DPlatformId&&e.options.context.getX3DPlatformId()},getWidget:function(){return window.widget&&window.widget||this.options.widget},expectations:function(){var e=this;return new UWA.Promise((function(t,n){var o=["DS/UnifiedExportCommand/Utils/Expectations",["ENOFOL3_AP","ENOPSTR_AP","ENOSCEN_AP","ENXENG_AP","X3DSEAR_AP","ENOSC2D_AP","ENXISSU_AP"].includes(e.APP_ID)&&e.APP_ID||"ExpectationsBase"].join("/");require([o],(n=>{for(var o in n.prototype)"contructor"!=n.prototype&&(e.__proto__[o]=n.prototype[o]);t()}),n)}))},server:function(e){var n=this,o={url:e.url,method:e.method||n.SERVER.VERB.GET,data:e.data,dataType:e.dataType||"json",timeout:e.timeout||5e5,cache:e.cache||3600,proxy:e.proxy||void 0,onComplete:e.onComplete,onFailure:e.onFailure,headers:e.headers&&UWA.merge(e.headers,n.SERVER.DEFAULT_HEADERS)||n.SERVER.DEFAULT_HEADERS};return t.authenticatedRequest(o.url,o)},alert:{info:function(e,t){return i.addNotif({title:e,message:t,level:"info"})},success:function(e,t){return i.addNotif({title:e,message:t,level:"success"})},warning:function(e,t){return i.addNotif({title:e,message:t,level:"warning"})},error:function(e,t){return i.addNotif({title:e,message:t,level:"error"})}},unique:function(){return UUID.v4().substring(0,10).replaceAll("-","")},noop:function(){}})})),define("DS/UnifiedExportCommand/Views/Options/ExpandLevel",["UWA/Class/Model","DS/Controls/Abstract","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/UnifiedExchangeCommons/parameters/ParameterView"],((e,t,n,o,i)=>{"use strict";const a=/^([6-9]\d*|[1-9]\d+)$/,r=/^$/;return t.inherit({name:"expandLevel",publishedProperties:{value:{defaultValue:void 0,type:"number"}},init:function(e){this.setOptions(e),this._parent()},buildView:function(){var t=this;t.options.exchangemodel=t.options.exchangemodel||new e,t._private={}},postBuildView:function(e){var t=this;t._private.lastStoredPreferences=e.value,t.elementsTree(),t.setupExpandField(t)},elementsTree:function(){var e=this;if((e.expandLevelTreeDocument=new n({}),e.expandLevelTreeDocument.prepareUpdate(),[{label:UWA.i18n("exchangecommand.options.field.expandLevel.expandNone"),value:0},{label:UWA.i18n("exchangecommand.options.field.expandLevel.expandAll"),value:-1},{label:"1",value:1},{label:"2",value:2},{label:"3",value:3},{label:"4",value:4},{label:"5",value:5}].forEach((t=>{var n=new o(t);e.expandLevelTreeDocument.addRoot(n)})),e._private.lastStoredPreferences)&&!e.expandLevelTreeDocument.getRoots().find((t=>t.options.value===e._private.lastStoredPreferences))){var t=new o({label:String(e._private.lastStoredPreferences),value:Number(e._private.lastStoredPreferences),freeText:!0});e.expandLevelTreeDocument.addRoot(t)}return e.expandLevelTreeDocument.pushUpdate(),e.expandLevelTreeDocument},setupExpandField:function(e){var t=UWA.is(e._private.lastStoredPreferences)?e._private.lastStoredPreferences:-1;e._private.expandLevel=new i({}).inject(e.elements.container),e._private.expandLevel.build({key:"expandLevel",label:UWA.i18n("exchangecommand.options.field.expandLevel"),help:UWA.i18n("exchangecommand.options.field.expandLevel.help"),value:t,type:"DS/WUXAutoComplete/AutoComplete",options:{value:t,fireOnlyFromUIInteractionFlag:!1,multiSearchMode:!1,allowFreeInputFlag:!1,allowResetToUndefinedByUIFlag:!1,keepSearchResultsFlag:!1,customFilterMessage:UWA.i18n("exchangecommand.options.field.expandLevel.error"),placeholder:"",elementsTree:e.expandLevelTreeDocument},uncommittedChange:e.uncommittedChange.bind(null,e),change:e.change.bind(null,e),blur:e.blur.bind(null,e),keydown:e.keydown.bind(null,e)})},_applyValue:function(e,t){this.elements.autocomplete.value=this.value},uncommittedChange:function(e,t){var n=e.expandLevelTreeDocument,i=n.getRoots(),s=t.dsModel.getValueToCommit();if(a.test(s)){s=Number(s),n.prepareUpdate();var l=i.find((e=>e.options.freeText));l&&l.remove(),l=new o({label:String(s),value:Number(s),freeText:!0}),n.addChild(l,7),n.pushUpdate(),e.options.exchangemodel.set("uexp-validFlag-expansion",!1)}else if(r.test(s)){n.prepareUpdate();for(let e=0;e<i.length;e++){const t=i[e];if(t.options.freeText){t.remove();break}}n.pushUpdate(),t.target.dsModel.value=void 0,e.options.exchangemodel.set("uexp-validFlag-expansion",!1),e._private.expandLevel.setError({message:UWA.i18n("exchangecommand.options.field.expandLevel.empty")}),e._private&&e._private.expandLevel&&e._private.expandLevel.control&&e._private.expandLevel.control.hidePopup()}else e.options.exchangemodel.set("uexp-validFlag-expansion",!1);e._private&&e._private.expandLevel&&e._private.expandLevel.control&&e._private.expandLevel.control.elements&&e._private.expandLevel.control.elements.popup&&e._private.expandLevel.control.elements.popup.fire&&e._private.expandLevel.control.elements.popup.fire("dimensionsChanged")},change:function(e,t){t&&t.dsModel&&UWA.is(t.dsModel.value)&&""!==t.dsModel.value&&(e._private.expandLevel.unsetError(),e.options.exchangemodel.set("uexp-expandLevel",t.dsModel.value))},blur:function(e,t){t&&t.dsModel&&UWA.is(t.dsModel.value)&&""!==t.dsModel.value&&e.options.exchangemodel.set("uexp-validFlag-expansion",!0)},keydown:function(e,t){t&&t.target&&UWA.is(t.target.value)&&""!==t.target.value&&e.options.exchangemodel.set("uexp-validFlag-expansion",!0)}})})),define("DS/UnifiedExportCommand/Views/Selected",["UWA/Class/View","DS/Controls/Expander","DS/TreeModel/TreeNodeModel","DS/TreeModel/TreeDocument","DS/DataGridView/DataGridView","DS/Tweakers/GeneratedToolbar"],(function(e,t,n,o,i,a){"use strict";try{return e.extend({setup:function(){var e=this;e.hide(),e.setupEvents(),e.setupToolbar(),e.setupGrid(),e.setupAccordion()},setupEvents:function(){var e=this;e.listenTo(e.model,"onChange:uexp-cvfnodes",e.onChangeCVFNodes.bind(null,e)),e.listenTo(e.model,"onChange:uexp-validcvfnodes",e.onChangeValidCVFNodes.bind(null,e))},onChangeCVFNodes:function(e){if(e.model.get("uexp-cvfnodes")){var t=e.model.get("uexp-cvfnodes"),o=t.length||0;e.show(),e.setHeader(o),e.dataGridView.maxVisibleRowCount=o,t.forEach((function(t){var o=t.attributes.find((e=>"resourceid"===e.name)),i=t.attributes.find((e=>"ds6w:label"===e.name)),a=t.attributes.find((e=>"type_icon_url"===e.name)),r=new n({grid:{id:o&&o.value,title:{label:i&&i.value,icon:a&&a.value},status:""}});e.treeDocument.addRoot(r)}))}},onChangeValidCVFNodes:function(e){var t=e.model.get("uexp-validcvfnodes"),n="exclude",o=0,i=0,a=0;t&&t.length&&e.treeDocument&&(e.treeDocument.getRoots().forEach((e=>{var r=e.options.grid.id;t.find((e=>e.attributes.find((e=>"resourceid"===e.name)).value===r))?(i++,n="include",o=1):(a++,n="exclude",o=0),e.updateOptions({grid:{status:n,statusValue:o}})})),i&&e.generatedToolbar.updateNodeModel("includedNodes",{visibleFlag:!0,grid:{data:i+" "+UWA.i18n("exchangecommand.dialog.selectionpanel.included")}}),a?e.generatedToolbar.updateNodeModel("excludedNodes",{visibleFlag:!0,grid:{data:a+" "+UWA.i18n("exchangecommand.dialog.selectionpanel.excluded")}}):e.generatedToolbar.updateNodeModel("excludedNodes",{visibleFlag:!1,grid:{data:a+" "+UWA.i18n("exchangecommand.dialog.selectionpanel.excluded")}})),e.applySortOnProcessEnd(e)},applySortOnProcessEnd:function(e){e.dataGridView.reapplySortModel()},setupToolbar:function(){var e=this;e.toolbarTreeDocument=a.prototype.createTreeDocument({entries:[{id:"includedNodes",dataElements:{typeRepresentation:"string",readOnly:!0,visibleFlag:!1,icon:"status-ok",emphasize:"success",position:"far",category:"1"}},{id:"excludedNodes",dataElements:{typeRepresentation:"string",readOnly:!0,visibleFlag:!1,icon:"block",emphasize:"error",position:"far",category:"1"}}]}),e.generatedToolbar=new a({overflowManagement:"dropdown",direction:"horizontal",items:e.toolbarTreeDocument}),e.generatedToolbar.getContent().style.fontWeight="bold"},setupGrid:function(){var e=this;e.treeDocument=new o;var t=new i({treeDocument:e.treeDocument,sortModel:[{dataIndex:"statusValue",sort:"desc"}],columns:[{dataIndex:"title",typeRepresentation:"url"},{dataIndex:"status",width:"100",getCellValue:function(e){if(e.nodeModel)return"include"===e.nodeModel.options.grid.status?UWA.i18n("exchangecommand.dialog.selectionpanel.included"):UWA.i18n("exchangecommand.dialog.selectionpanel.excluded")},getCellSemantics:function(e){return"include"===e.nodeModel.options.grid.status?{emphasize:"success",icon:{iconStyle:1,iconName:"status-ok"}}:{emphasize:"error",icon:{iconStyle:1,iconName:"block"}}}},{dataIndex:"statusValue",typeRepresentation:"number",visibleFlag:!1}]});t.rowSelection="multiple",t.columnSelection="none",t.cellSelection="none",t.layout.collectionView.showAlternateBackgroundFlag=!1,t.layout.columnsHeader=!1,t.layout.rowsHeader=!1,t.showRowIndexFlag=!1,t.showSelectionCheckBoxesFlag=!0,t.layout.collectionView.showRowBorderFlag=!0,t.getContent().style.position="relative",e.dataGridView=t},setupAccordion:function(){var e=this;e.expander=new t({header:UWA.i18n("exchangecommand.dialog.selectionpanel.title")+"(0)",icon:{iconName:"select-on",fontIconFamily:1},body:e.dataGridView.getContent(),customHeader:e.generatedToolbar,customHeaderPosition:"far",style:"simple"}).inject(UWA.createElement("div",{styles:{background:"#F2F5F7"}}).inject(e.container))},setHeader:function(e){this.expander.header=UWA.i18n("exchangecommand.dialog.selectionpanel.title")+"("+e+")"}})}catch(e){console.log(e)}})),define("DS/UnifiedExportCommand/Views/Options/DerivedFormatOptions",["UWA/Class/Model","UWA/Class/View","DS/Controls/Expander","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/UnifiedExchangeCommons/parameters/ParameterView"],((e,t,n,o,i,a)=>(a=a.extend({destroy:function(){this.control.fire("change"),this.getContent().remove()}}),t.extend({className:"engineering-formats-options",setup:function(){var t=this;t._private={attrViewList:[],formatOptionsTreeDocument:new o},t.model=new e({}),t.elementsTreeCallback(t),["STEP","step"].includes(t.options.target)?(t._private.content=UWA.createElement("div"),new n({header:UWA.String.format(UWA.i18n("exchangecommand.options.field.includeformatoptions"),t.options.target),expandedFlag:!0,body:t._private.content}).inject(t.container),t._private.includeFormatAttributes=new a({}).inject(t._private.content),t._private.includeFormatAttributes.build({key:"formatAttributes",label:UWA.i18n("exchangecommand.options.placeholder.chooseoptions"),type:"DS/WUXAutoComplete/AutoComplete",options:{allowFreeInputFlag:!1,placeholder:UWA.i18n("exchangecommand.options.placeholder.chooseoptions"),elementsTree:t._private.formatOptionsTreeDocument,customFilterMessage:UWA.i18n("exchangecommand.options.field.chooseoptions.customFilterMessage")},change:t.onAddOrRemoveFormatAttributes.bind(null,t)})):t.hide()},elementsTreeCallback:function(e){e.options.formatStore.getFormatParameters({source:e.options.source,sourceType:e.options.sourceType,connector:e.options.connector,target:e.options.target}).then((function(t){e._private.attributes=t,valueOfParameter=t.map((t=>({label:e.options.formatStore.getFormatParameterNLS(e.options.source,t.name),value:t.name,icon:"parameters"}))),e.populateSpecificFormatOptions(valueOfParameter)}))},populateSpecificFormatOptions:function(e){var t=this,n=t.options.lastStoredPreferences,o=[];n&&n.geometricalParameters&&(o=o.concat(n.geometricalParameters)),e.length&&t._private.formatOptionsTreeDocument.withTransactionUpdate((()=>{t._private.formatOptionsTreeDocument.empty(),e.forEach((e=>{var n=new i(e);n.options.icons.push(n.options.icon),t._private.formatOptionsTreeDocument.addRoot(n),UWA.is(o&&o.find((function(t){return t.name===e.value})))&&n.select()}))}))},onAddOrRemoveFormatAttributes:function(e,t){t.stopPropagation();for(var n=t.dsModel.value||[],o=e._private.attrViewList.length-1;o>=0;o--){var i=e._private.attrViewList[o];n.includes(i.key)||(e._private.attrViewList.splice(o,1),i.destroy(),i=void 0)}n.forEach((function(t){var n=e._private.attrViewList.find((e=>e.key===t));if(!n){var o=(new a).inject(e._private.content),i=e.toAttributeUIOpts(t);o.build(i),e._private.attrViewList.push(o)}}))},toAttributeUIOpts:function(e){var t,n=this,o=n._private.attributes.find((t=>t.name===e)),i="DS/Controls/ComboBox",a={};if(o.values){var r=o.name,s=[];n.options.lastStoredPreferences&&n.options.lastStoredPreferences.geometricalParameters&&n.options.lastStoredPreferences.geometricalParameters.forEach((e=>{if(e.name===r)return s=e.values[0]}));var l=o.values.split("|");2===l.length&&l.includes("true")&&l.includes("false")?(s&&s.length>0&&(s="true"===s.toLowerCase()),i="DS/Controls/Toggle",a={...a,type:"switch",value:!!s,checkFlag:!!s},t=!!s):(a.elementsList=l.map((e=>({label:n.options.formatStore.getFormatParameterNLS(n.options.source,e),value:e}))),t=s.length>0?s:a.elementsList[0].value)}return{key:o.name,label:n.options.formatStore.getFormatParameterNLS(n.options.source,o.name),type:i,value:t,options:a,change:n.onAttributeChange.bind(null,n)}},onAttributeChange:function(e,t){t.stopPropagation();var n=[];e._private.attrViewList.forEach((e=>{var t=e.key,o=e.control&&e.control.value;e.control&&void 0!==e.control.checkFlag&&(o=e.control.checkFlag),UWA.is(t)&&UWA.is(o)&&n.push({name:t,values:[o]})})),e.model.unset("geometricalParameters"),n.length&&e.model.set("geometricalParameters",n),e&&e._private&&e._private.includeFormatAttributes&&e._private.includeFormatAttributes.control&&e._private.includeFormatAttributes.control.elements&&e._private.includeFormatAttributes.control.elements.popup&&e._private.includeFormatAttributes.control.elements.popup.fire&&e._private.includeFormatAttributes.control.elements.popup.fire("dimensionsChanged")},destroy:function(){this.options.formatStore.cancel(),this._private.attrViewList.forEach((e=>{e.destroy()})),this.model.clear(),this.getContent().remove(),this._parent()}})))),define("DS/UnifiedExportCommand/Utils/ProxyContext",["UWA/Core","UWA/Class","UWA/Class/Options"],(function(e,t,n){"use strict";return t.extend(n,{init:function(e){this._parent(),this.setOptions(e)},getSelectedNodes:function(){return this.options.selectedNodes||[]},getTreeDocument:function(){return this.options.treeDocument},getPADTreeDocument:function(){return this.options.treeDocument},getX3DPlatformId:function(){return this.options.x3dPlatformId},getAppId:function(){return this.options.x3dAppId},getSecurityContext:function(){return this.options.securityContext}})})),define("DS/UnifiedExportCommand/Utils/Expectations/ExpectationsBase",["UWA/Class","DS/Utilities/UUID","DS/UnifiedExchangeAnalytics/Tracker"],(function(e,t,n){"use strict";return e.extend({CVQUERY:{EXPAND:{level:-1,batch:{graph:{}},outputs:{select_object:["physicalid","type","interface","ds6w:cadMaster","flattenedtaxonomies"],select_relation:["identifier","physicalid","type","interface","flattenedtaxonomies"],format:"entity_relation_occurrence"}}}},{setCVFNodes:function(e){this.cvfnodes=e},treatAsRoot:function(e){},extractRoot:function(e){return e.getRoot()},refineSelectionByValidCVFNodes:function(e){var t=this;return!t.cvfnodes||!(t.cvfnodes&&!t.cvfnodes.find((n=>n.attributes.find((e=>"resourceid"===e.name)).value===t.getNodeId(e))))},getTreeDocument:function(){var e=this.options.context;return e.options.model||e.getPADTreeDocument()},processSelectedNodes:function(e){var t=this,n=[];return e.forEach((e=>{e.isRelationsObjectNode||t.refineSelectionByValidCVFNodes(e)&&n.push(e)})),n},getSelectedNodes:function(){var e=this.options.context.getSelectedNodes();return!(e.filter((e=>UWA.is(e)&&UWA.is(e.options)&&!0===e.options.isGroupingNode)).length>0)&&e},getExportableContent:function(){var e=this.getSelectedNodes();return this.processSelectedNodes(e)},getOccurrencePath:function(e){return e.getOccurrencePath&&e.getOccurrencePath()},getNodeId:function(e){return e.getID&&e.getID()||e.options.id},extractNodes:function(){var e=this,t=[],o=[],i=e.getExportableContent();return n.setSelectionSize(i.length),i.forEach((n=>{let i=-1;if(e.treatAsRoot(n)){var a=n.getID&&n.getID()||n.options.id;i=t.indexOf(a),-1===i&&(t.push(a),o.push([[a]]))}else{let a=e.getOccurrencePath(n),r=e.extractRoot(n).getID();i=t.indexOf(r),-1===i?(t.push(r),o.push([a])):o[i]&&o[i].push(a)}})),{roots:t,paths:o}},expandLabel:function(){return`unifiedexport-${this.APP_ID}-${(new Date).getTime()}`},expandGraphParams:function(){return this.CVQUERY.EXPAND.batch.graph},expandLevel:function(){return this.CVQUERY.EXPAND.level},prefixPath:function(e){return e.map((e=>({physical_id_path:e})))},expandFilterParams:function(e,t){var n=this.options.context,o={filter:{all:1}};if(n.GetFilterSpec){var i=this.prefixPath(t);o=n.GetFilterSpec(e,{V2:{prefixPathArray:i}})}return o.filter},expandOutput:function(){return{select_object:this.CVQUERY.EXPAND.outputs.select_object,select_relation:this.CVQUERY.EXPAND.outputs.select_relation,format:this.CVQUERY.EXPAND.outputs.format}},expandBatch:function(e,t){var n=this,o={label:n.expandLabel(),root:{physical_id:e},filter:n.expandFilterParams(e,t),graph:n.expandGraphParams()},i=n.expandLevel();return i>-1&&(o.aggregation_processors=[{truncate:{max_distance_from_prefix:i,prefix_filter:{prefix_path:n.prefixPath(t)}}}]),o},expandQuery:function(){var e=this,t=e.extractNodes(),n=t.roots,o=t.paths,i=n&&n.map(((t,n)=>{var i=o[n];return e.expandBatch(t,i)}));return i&&{batch:{expands:i},outputs:e.expandOutput()}||void 0},fetchQuery:function(){var e=this;return e.setCVFNodes(void 0),{physicalid:e.getExportableContent().map((t=>e.getNodeId(t))),label:e.expandLabel(),select_predicate:["ds6w:label","flattenedtaxonomies","ds6w:cadMaster"]}}})})),define("DS/UnifiedExportCommand/Utils/Expectations/ENOPSTR_AP",["DS/UnifiedExportCommand/Utils/Expectations/ExpectationsBase"],(e=>{"use strict";return e.extend({getOccurrencePath:function(e){return e.getOccurencePath&&e.getOccurencePath()}})})),define("DS/UnifiedExportCommand/Utils/Expectations/ENOSC2D_AP",["DS/UnifiedExportCommand/Utils/Expectations/ExpectationsBase"],(e=>{"use strict";return e.extend({getOccurrencePath:function(e){return e.getOccurencePath&&e.getOccurencePath()}})})),define("DS/UnifiedExportCommand/Utils/Expectations/ENXISSU_AP",["DS/UnifiedExportCommand/Utils/Expectations/ExpectationsBase"],(e=>{"use strict";return e.extend({CVQUERY:{EXPAND:{level:-1,batch:{graph:{descending_condition_object:{uql:'(flattenedtaxonomies:"types/Workspace Vault") OR (flattenedtaxonomies:"types/Workspace") OR (flattenedtaxonomies:"types/VPMReference") OR (flattenedtaxonomies:"types/VPMRepReference") OR (flattenedtaxonomies:"types/XCADNonPSBaseRepReference") OR (flattenedtaxonomies:"types/XCADModelRepReference") OR (flattenedtaxonomies:"types/Document") OR (flattenedtaxonomies:"types/PLMDMTDocument") OR (flattenedtaxonomies: "types/Issue")'},descending_condition_relation:{uql:"(taxonomies:*Vaults*) OR (taxonomies:*Vaulted Objects*) OR (taxonomies:*VPMInstance*) OR (taxonomies:*VPMRepInstance*) OR (taxonomies:*XCADAssemblyRepInstance*)"}}}}}},{})})),define("DS/UnifiedExportCommand/Utils/Expectations/ENXENG_AP",["DS/UnifiedExportCommand/Utils/Expectations/ExpectationsBase"],(e=>{"use strict";return e.extend({CVQUERY:{EXPAND:{level:-1,batch:{graph:{descending_condition_object:{uql:'(flattenedtaxonomies:"types/VPMReference") OR (flattenedtaxonomies:"types/VPMRepReference") OR (flattenedtaxonomies:"types/XCADNonPSBaseRepReference") OR (flattenedtaxonomies:"types/XCADModelRepReference") OR (flattenedtaxonomies:"types/Document")OR (flattenedtaxonomies:"types/PLMDMTDocument")'},descending_condition_relation:{uql:"(taxonomies:*VPMInstance*) OR (taxonomies:*VPMRepInstance*) OR (taxonomies:*XCADAssemblyRepInstance*) OR (taxonomies:*Reference Document*) OR (taxonomies:*SpecificationDocument*)"}}}}}},{checkForDoc:function(){if(this.cvfnodes)return!!this.cvfnodes.find((e=>!!e.attributes.find((e=>"flattenedtaxonomies"===e.name&&("types/PLMDMTDocument"===e.value||"types/Document"===e.value)))))},treatAsRoot:function(e){return!(this.isStructureIndented()&&!this.checkForDoc())},extractRoot:function(e){var t=this;return t.isStructureIndented()?t.options.context.getActiveEngItem():t._parent(e)},expandLevel:function(){return this.isStructureIndented()||this.options.context.isThereARootSelected()?this.CVQUERY.EXPAND.level:0},getTreeDocument:function(){return this.options.context.getXENTreeDocument()},isStructureIndented:function(){return this.options.context.isStructureIndented()}})})),define("DS/UnifiedExportCommand/Utils/Expectations/ENOSCEN_AP",["DS/UnifiedExportCommand/Utils/Expectations/ExpectationsBase"],(e=>{"use strict";return e.extend({getOccurrencePath:function(e){return e.getOccurencePath&&e.getOccurencePath()}})})),define("DS/UnifiedExportCommand/Models/EngineeringFormatsModel",["UWA/Class/Model","DS/UnifiedExportCommand/Utils/ExchangeInfra"],(function(e,t){"use strict";try{const n="3d-object-unknown-format",o="derived-output",i="/resources/v1/modeler/conversionAdmin/derivedformatmanagement/declarative",a="/resources/v1/derivedoutput/derivedoutputrules/getconversionformats?downloadableOnly=true&converter=all&category=";return e.extend({defaults:{engineeringType:"part"},setup:function(){this._private={currentReq:[]}},transform:function(){return this._attributes},getCADMastersForNative:function(e){var t=this.get("engineeringType"),n=e.objects||this.objects||[],o=new Set;return n.forEach((e=>{var n=e["ds6w:cadMaster"],i=e.flattenedtaxonomies;n&&("drawing"===t&&i.includes("types/Drawing")?o.add(n):"part"!==t||i.includes("types/Drawing")||o.add(n))})),o.delete("3DEXPERIENCE"),[...o]},getCADMastersForDO:function(e){var t=this.get("engineeringType"),n=e.objects||this.objects||[],o=new Set;return n.forEach((n=>{var i=n["ds6w:cadMaster"];if(i)if(!0===e.showDerivedFormatsBasedOnAssembly){var a=n.flattenedtaxonomies;("drawing"===t&&a.includes("types/Drawing")||"part"===t&&a.includes("types/3DShape"))&&o.add(i)}else o.add(i)})),[...o]},getNativeFormats:function(e){var t=this;return new UWA.Promise(((o,i)=>{var a=t.getCADMastersForNative(e);a.sort(),o(a=a.map((e=>({value:e,label:e,native:"true",icons:[n]}))))}))},getDerivedFormats:function(e){let n=this,o=n.getCADMastersForDO(e),i=[];return o.forEach((e=>{let n=[t.platformServices["3DSpace"],a,e].join(""),o=new UWA.Promise(((e,o)=>{t.server({url:n,headers:{SecurityContext:encodeURIComponent(t.securityContext)},onComplete:t=>{try{let n=JSON.parse(t);n&&n.derivedOutputFormats?e(n.derivedOutputFormats):o(new Error("Invalid response"))}catch(e){o(e)}},onFailure:e=>{o(e)}})}));i.push(o)})),UWA.Promise.allSettled(i).then((e=>{let t=e.map((e=>e.value)).flat();return n.postGetDerivedFormatsSuccess(n,t)})).fail((e=>n.postGetDerivedFormatsFailure(n,e)))},postGetDerivedFormatsSuccess:function(e,t){let n=t;n.sort(((e,t)=>e.category<t.category?-1:e.category>t.category?1:0));let i=new Set,a=[];return n.forEach((t=>{"part"!==e.get("engineeringType")||"3D"!==t.appliesOn||i.has(t.outputStreamId)?"2D"!==t.appliesOn||i.has(t.outputStreamId)||(i.add(t.outputStreamId),i.add(t.outputStreamId),a.push({value:t.format,label:t.formatToDisplay,outputStreamId:t.outputStreamId,icons:[o]})):(i.add(t.outputStreamId),a.push({value:t.format,label:t.formatToDisplay,outputStreamId:t.outputStreamId,icons:[o]}))})),e.derivedformats=a.sort(((e,t)=>e.label.localeCompare(t.label))),e.derivedformats},postGetDerivedFormatsFailure:function(e,t){console.error(t)},getAllFormats:function(e){return UWA.Promise.all([this.getNativeFormats(e),this.getDerivedFormats(e)])},getFormats:function(e){var n=this;return n.formatType=e.formatType||t.EngineeringFormatType.ALL,n.objects=e.objects||[],t.EngineeringFormatType.ALL===n.formatType?this.getAllFormats(e):t.EngineeringFormatType.NATIVE===n.formatType?this.getNativeFormats(e):t.EngineeringFormatType.DERIVED===n.formatType?this.getDerivedFormats(e):void 0},getFormatParameters:function(e){let t=this;return new UWA.Promise((function(n,o){t.getDeclarative().then(t.filterParameters.bind(null,t,e,n))}))},getFormatParameterNLS:function(e,t){return this._private.declarative.nlsData[e].parameter[t]},getDeclarative:function(){let e=this;return new UWA.Promise((function(n,o){if(e._private.decalrative)n(e._private.decalrative);else{let a=[t.platformServices["3DSpace"],i].join("");e._private.currentReq.push(t.server({url:a,onComplete:e.postGetDeclarativeSuccess.bind(null,e,n),onFailure:e.postGetDeclarativeFailure.bind(null,o)}))}}))},postGetDeclarativeSuccess:function(e,t,n){e._private.declarative=JSON.parse(n),t(e._private.declarative)},postGetDeclarativeFailure:function(e){e()},filterParameters:function(e,t,n){var o=[];let i=e._private.declarative.data.find((e=>e.name.toLowerCase()===t.source.toLowerCase())).connectors.find((function(e){return e.id.toLowerCase()===t.connector.toLowerCase()}));if(i.id==t.connector){let e=i.supportedformats.find((function(e){return e.source.type.toLowerCase()===t.sourceType.toLowerCase()}));if(e.source.type.toLowerCase()==t.sourceType.toLowerCase()){let n=e.targets.find((function(e){return e.target.toLowerCase()===t.target.toLowerCase()}));n&&(o=n.parameters)}}n(o)},cancel:function(){this._private.currentReq&&this._private.currentReq.forEach((e=>{e.cancel()}))}})}catch(e){console.log(e)}})),define("DS/UnifiedExportCommand/Views/Options/EngineeringFormats",["UWA/Class/Model","DS/Controls/Abstract","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/UnifiedExportCommand/Models/EngineeringFormatsModel","DS/UnifiedExchangeCommons/parameters/ParameterView","DS/UnifiedExportCommand/Views/Options/DerivedFormatOptions","DS/UnifiedExportCommand/Utils/ExchangeInfra"],((e,t,n,o,i,a,r,s)=>{"use strict";const l=["",UWA.i18n("exchangecommand.options.placeholder.chooseall"),UWA.i18n("exchangecommand.options.placeholder.choosenative"),UWA.i18n("exchangecommand.options.placeholder.choosederived")],c="3d-object-unknown-format";return t.inherit({name:"engineering-formats",init:function(e){UWA.is(e.showSpecificNativeCAD)||(e.showSpecificNativeCAD=!1),UWA.is(e.showSpecificDerivedFormats)||(e.showSpecificDerivedFormats=!1),UWA.is(e.showNativeFormatsToggle)||(e.showNativeFormatsToggle=!1),UWA.is(e.showDerivedFormatsToggle)||(e.showDerivedFormatsToggle=!1),UWA.is(e.showSpecificFormatsField)||(e.showSpecificFormatsField=!1),UWA.is(e.showLatestDerivedFormatsToggle)||(e.showLatestDerivedFormatsToggle=!1),UWA.is(e.showDerivedFormatsOptionsField)||(e.showDerivedFormatsOptionsField=!1),UWA.is(e.showDerivedFormatsBasedOnAssembly)||(e.showDerivedFormatsBasedOnAssembly=!1),this.setOptions(e),this._parent()},buildView:function(){var t=this;t.options.exchangemodel=t.options.exchangemodel||new e,t._private={},t.model=new i,t.model.addEvent("onChange",t.transformAndFire.bind(null,t))},postBuildView:function(e){var t=this;t._private.lastStoredPreferences=e.value||{},t.options.exchangemodel.addEvent("onChange:objects",t.resetView.bind(null,t)),t.resetView(t)},resetView:function(e){e.options.exchangemodel.has("objects")&&(e.elements.container.empty(),e.model.clear(),e.model.set("engineeringType",e.options.engineeringType),e._private.formatType=s.EngineeringFormatType.NONE,e._private.derivedFormatOptionViewList=[],e._private.formatsTreeDocument&&e._private.formatsTreeDocument.empty()||(e._private.formatsTreeDocument=new n),e.options.showSpecificFormatsField?e.setupIncludeSpecificFormats().then((function(){e.options.showNativeFormatsToggle&&e.setupAllNativeFormatsToggle(),e.options.showDerivedFormatsToggle&&e.setupAllDerivedFormatsToggle(),e.options.showNativeFormatsToggle&&e.options.showDerivedFormatsToggle||e.toggleIncludeSpecificFormats()})):(e.options.showNativeFormatsToggle&&e.setupAllNativeFormatsToggle(),e.options.showDerivedFormatsToggle&&e.setupAllDerivedFormatsToggle()),e.options.showLatestDerivedFormatsToggle&&e.setupIncludeLatestFormats())},destroy:function(){this.options.exchangemodel.removeEvent("onChange:objects"),this.elements.container.destroy()},setupAllNativeFormatsToggle:function(){var e=this,t=e.toggleIncludeAllNativeFormats(),n=!(UWA.is(e._private.lastStoredPreferences.includeAllNativeFormats)&&!t)||e._private.lastStoredPreferences.includeAllNativeFormats;e._private.includeAllNativeFormats=new a({}),e._private.includeSpecificFormats.getContent().insertAdjacentElement("beforebegin",e._private.includeAllNativeFormats.getContent()),e._private.includeAllNativeFormats.build({key:"includeAllNativeFormats",label:UWA.i18n("exchangecommand.options.field.engineeringformat.includeallnative"),help:UWA.i18n("exchangecommand.options.field.engineeringformat.includeallnative.help"),value:n,type:"DS/Controls/Toggle",options:{type:"switch",value:n,checkFlag:n,disabled:e.toggleIncludeAllNativeFormats()},change:function(t){t.stopPropagation(),e.toggleIncludeAllNativeFormats()?e.model.unset("includeAllNativeFormats"):e.model.set("includeAllNativeFormats",t.dsModel.checkFlag),e.toggleIncludeSpecificFormats()}})},setupAllDerivedFormatsToggle:function(){var e=this,t=e.toggleIncludeAllDerivedFormats(),n=!(UWA.is(e._private.lastStoredPreferences.includeAllDerivedFormats)&&!t)||e._private.lastStoredPreferences.includeAllDerivedFormats;e._private.includeAllDerivedFormats=new a({}),e._private.includeSpecificFormats.getContent().insertAdjacentElement("beforebegin",e._private.includeAllDerivedFormats.getContent()),e._private.includeAllDerivedFormats.build({key:"includeAllDerivedFormats",label:UWA.i18n("exchangecommand.options.field.engineeringformat.includeallderived"),help:UWA.i18n("exchangecommand.options.field.engineeringformat.includeallderived.help"),value:n,type:"DS/Controls/Toggle",options:{type:"switch",value:n,checkFlag:n,disabled:e.toggleIncludeAllDerivedFormats()},change:function(t){t.stopPropagation(),e.toggleIncludeAllDerivedFormats()?e.model.unset("includeAllDerivedFormats"):e.model.set("includeAllDerivedFormats",t.dsModel.checkFlag),e.toggleIncludeSpecificFormats()}})},setupIncludeSpecificFormats:function(){var e=this;return e._private.includeSpecificFormats=new a({}).inject(e.elements.container),e._private.includeSpecificFormats.hide(),new UWA.Promise((function(t){e._private.includeSpecificFormats.build({key:"includeSpecificFormats",label:e.computeLabelforSpecificFormats(e)+" "+("part"===e.options.engineeringType?UWA.i18n("exchangecommand.options.field.engineeringformat.includespecificfield.forparts"):UWA.i18n("exchangecommand.options.field.engineeringformat.includespecificfield.fordrawings")),help:UWA.i18n("exchangecommand.options.field.engineeringformat.includespecific.help"),type:"DS/WUXAutoComplete/AutoComplete",options:{elementsTree:e._private.formatsTreeDocument,allowFreeInputFlag:!1,customFilterMessage:UWA.i18n("exchangecommand.options.field.chooseoptions.customFilterMessage")},change:function(t){t.stopPropagation();var n=[],o=[],i=[],a=t.dsModel.value,r=e._private.includeSpecificFormats.control.selectedItems;a&&a.forEach((e=>{if(e){var t=r.find((t=>t.options.value===e));t.options.icons.includes(c)?n.push(e):(t.options.value&&o.push(t.options.value),t.options.outputStreamId&&i.push(t.options.outputStreamId))}})),n.length?e.model.set("specificNativeFormats",n):e.model.unset("specificNativeFormats"),o.length?(e.model.set("specificDerivedFormats",o),e.model.set("outputStreamIdForDerivedFormats",i)):e.model.unset("specificDerivedFormats"),e.options.showDerivedFormatsOptionsField&&e.setupSpecificFormatOptions(),e.options.showLatestDerivedFormatsToggle&&e.toggleIncludeLatestFormats()}},t)}))},computeLabelforSpecificFormats:function(e){return e.options.showNativeFormatsToggle&&e.options.showDerivedFormatsToggle?UWA.i18n("exchangecommand.options.field.engineeringformat.includespecificfield.specificformat"):e.options.showSpecificFormatsField&&e.options.showSpecificNativeCAD?UWA.i18n("exchangecommand.options.field.engineeringformat.includespecificfield.nativeformat"):e.options.showSpecificFormatsField&&e.options.showSpecificDerivedFormats?UWA.i18n("exchangecommand.options.field.engineeringformat.includespecificfield.derivedformat"):UWA.i18n("exchangecommand.options.field.engineeringformat.includespecificfield.format")},getDerivedFormatOptionsViewByTarget:function(e){return this._private.derivedFormatOptionViewList.find((t=>t.options.target===e.target))},setupSpecificFormatOptions:function(){var e=this;e&&e._private&&e._private.includeSpecificFormats&&e._private.includeSpecificFormats.control&&e._private.includeSpecificFormats.control.elements&&e._private.includeSpecificFormats.control.elements.popup&&e._private.includeSpecificFormats.control.elements.popup.fire&&e._private.includeSpecificFormats.control.elements.popup.fire("dimensionsChanged");for(var t=e.model.get("specificDerivedFormats")||[],n=e._private.derivedFormatOptionViewList.length-1;n>=0;n--){var o=e._private.derivedFormatOptionViewList[n];t.includes(o.options.target)||(o.destroy(),o=void 0,e._private.derivedFormatOptionViewList.splice(n,1))}t.forEach((t=>{if(!e.getDerivedFormatOptionsViewByTarget({target:t})){var n=new r({formatStore:e.model,source:"3DEXPERIENCE",sourceType:e.options.engineeringType,connector:"CATIAV5",target:t,lastStoredPreferences:e._private.lastStoredPreferences&&e.getLastStoredFormatOptions(t)||{}}).inject(e.elements.container);n.listenTo(n.model,"onChange",(function(){const t=e._private.derivedFormatOptionViewList.reduce(((e,t)=>{var n=t.model._attributes;return Object.keys(n).length&&e.push(n),e}),[]);e.model.unset("specificDerivedOutputWithParams"),t.length&&e.model.set("specificDerivedOutputWithParams",t)})),e._private.derivedFormatOptionViewList.push(n),n.model.set("format",t)}}))},getLastStoredFormatOptions:function(e){var t=this;return t._private.lastStoredPreferences&&t._private.lastStoredPreferences.specificDerivedOutputWithParams&&t._private.lastStoredPreferences.specificDerivedOutputWithParams.find((t=>t.format===e))},hasReferenceObjects:function(e){var t=this.options.exchangemodel.get("objects")||[],n=this.options.engineeringType;return t.findIndex(((e,t)=>!("part"!==n||!e.flattenedtaxonomies||!e.flattenedtaxonomies.includes("types/3DShape"))||(!("drawing"!==n||!e.flattenedtaxonomies||!e.flattenedtaxonomies.includes("types/Drawing"))||void 0)))>-1},toggleIncludeAllNativeFormats:function(){var e=this,t=e.options.exchangemodel.get("objects")||[];return!(e.model.getCADMastersForNative({objects:t,showDerivedFormatsBasedOnAssembly:e.options.showDerivedFormatsBasedOnAssembly}).length>0)},toggleIncludeAllDerivedFormats:function(){return!this.hasReferenceObjects()},setupIncludeLatestFormats:function(){var e=this,t=!!UWA.is(e._private.lastStoredPreferences.includeLatestFormats)&&e._private.lastStoredPreferences.includeLatestFormats;e._private.includeLatestFormats=new a({}).inject(e.elements.container),e._private.includeLatestFormats.hide(),e._private.includeLatestFormats.build({key:"includeLatestFormats",label:UWA.i18n("exchangecommand.options.field.engineeringformat.includelatestformats"),help:UWA.i18n("exchangecommand.options.field.engineeringformat.includelatestformats.help"),value:t,type:"DS/Controls/Toggle",options:{type:"switch",value:t,checkFlag:t},change:function(t){t.stopPropagation(),e.model.set("includeLatestFormats",t.dsModel.checkFlag)}})},toggleIncludeLatestFormats:function(){var e=this;e.isLatestFormatsRequired()?(e._private.includeLatestFormats.show(),e.model.set(e._private.includeLatestFormats.treeNodeModel.options.grid.value,e._private.includeLatestFormats.control.checkFlag)):(e._private.includeLatestFormats.hide(),e.model.unset(e._private.includeLatestFormats.treeNodeModel.options.grid.value))},isLatestFormatsRequired:function(){var e=this;return e._private.includeLatestFormats&&(e._private.includeAllDerivedFormats&&e._private.includeAllDerivedFormats.control&&!0!==e._private.includeAllDerivedFormats.control.disabled&&1==e._private.includeAllDerivedFormats.control.checkFlag||!e._private.includeSpecificFormats.getContent().isHidden()&&e.model.get("specificDerivedFormats")&&e.model.get("specificDerivedFormats").length>0)},toggleIncludeSpecificFormats:function(){var e=this;if(e._private.includeSpecificFormats&&e._private.includeSpecificFormats.control){var t=void 0,n=void 0;"boolean"===UWA.typeOf(e.model.get("includeAllNativeFormats"))&&(t=e.model.get("includeAllNativeFormats"));var o=e.model.get("includeAllDerivedFormats");!1===t&&!1===o?(n=s.EngineeringFormatType.ALL,e._private.includeSpecificFormats.show(),e.getFormats(n)):!1===t||!UWA.is(e._private.includeAllNativeFormats)&&!0===e.options.showSpecificNativeCAD?(n=s.EngineeringFormatType.NATIVE,e._private.includeSpecificFormats.show(),e.getFormats(n)):!1===o||!UWA.is(e._private.includeAllNativeFormats)&&!0===e.options.showSpecificDerivedFormats?(n=s.EngineeringFormatType.DERIVED,e.getFormats(n),e._private.includeSpecificFormats.show()):(n=s.EngineeringFormatType.NONE,e._private.includeSpecificFormats.control.value=void 0,e._private.includeSpecificFormats.hide()),e.options.showLatestDerivedFormatsToggle&&e.toggleIncludeLatestFormats(),e._private.includeSpecificFormats.control.placeholder=l[n]}},getFormats:function(e){var t=this,n=t.options.exchangemodel.get("objects");t.refineSpecificselectedFormats(e),n&&n.length&&(t._private.includeSpecificFormats.control.disabled=!0,t.model.getFormats({formatType:e,objects:n,showDerivedFormatsBasedOnAssembly:t.options.showDerivedFormatsBasedOnAssembly}).then((e=>{e=e.flat(),t.populateSpecificFormats(e)})).finally((function(){t._private.includeSpecificFormats.control.disabled=!1})))},populateSpecificFormats:function(e){var t=this,n=t._private.lastStoredPreferences,i=[];n&&(n.specificNativeFormats&&(i=i.concat(n.specificNativeFormats)),n.specificDerivedFormats&&(i=i.concat(n.specificDerivedFormats))),t._private.formatsTreeDocument.withTransactionUpdate((()=>{var n=t._private.formatsTreeDocument.getSelectedNodes().map((e=>e.options.value));t._private.formatsTreeDocument.empty(),e.forEach((e=>{var a=new o(e);t._private.formatsTreeDocument.addRoot(a),(n.includes(e.value)||i.includes(e.value))&&a.select()}))}))},refineSpecificselectedFormats:function(e){var t=this,n=t._private.includeSpecificFormats.control.value,o=t._private.includeSpecificFormats.control.selectedItems;n&&n.length&&(e===s.EngineeringFormatType.NATIVE?n=n.filter((e=>o.find((t=>t.options.value===e&&t.options.icons.includes(c))))):e===s.EngineeringFormatType.DERIVED&&(n=n.filter((e=>o.find((t=>t.options.value===e&&t.options.icons.includes("derived-output")))||void 0))),t._private.includeSpecificFormats.control.value=n)},transformAndFire:function(e){e.value=e.model.transform(),e.fire("change")}})})),define("DS/UnifiedExportCommand/Utils/Expectations/ENOFOL3_AP",["DS/UnifiedExportCommand/Utils/Expectations/ExpectationsBase"],(e=>{"use strict";return e.extend({CVQUERY:{EXPAND:{level:-1,batch:{graph:{descending_condition_object:{uql:'(flattenedtaxonomies:"types/Workspace Vault") OR (flattenedtaxonomies:"types/Workspace") OR (flattenedtaxonomies:"types/VPMReference") OR (flattenedtaxonomies:"types/VPMRepReference") OR (flattenedtaxonomies:"types/XCADNonPSBaseRepReference") OR (flattenedtaxonomies:"types/XCADModelRepReference") OR (flattenedtaxonomies:"types/Document") OR (flattenedtaxonomies:"types/PLMDMTDocument") OR (flattenedtaxonomies: "types/Issue")'},descending_condition_relation:{uql:"(taxonomies:*Vaults*) OR (taxonomies:*Vaulted Objects*) OR (taxonomies:*VPMInstance*) OR (taxonomies:*VPMRepInstance*) OR (taxonomies:*XCADAssemblyRepInstance*)"}}}}}},{treatAsRoot:function(e){return!(this.getWidget()&&this.getWidget().getValue("allow-products-expand")&&e.isTreeElementType&&!e.isTreeElementType()&&(e.canBeExpanded&&e.canBeExpanded()||e.getFirstVisibleParent&&e.getFirstVisibleParent()))},getOccurrencePath:function(e){return e.getOccurencePath&&e.getOccurencePath()}})})),define("DS/UnifiedExportCommand/Utils/Expectations/X3DSEAR_AP",["DS/UnifiedExportCommand/Utils/Expectations/ENOFOL3_AP"],(e=>{"use strict";return e.extend({})})),define("DS/UnifiedExportCommand/Views/ExchangeOptions",["UWA/Class/View","DS/UIKIT/Spinner","DS/UnifiedExchangeCommons/Storage","DS/UnifiedExchangeCommons/parameters/ParameterView","DS/UnifiedExchangeCommons/parameters/ParametersViewFactory","DS/UnifiedExportCommand/Utils/ExchangeInfra","DS/UnifiedExchangeAnalytics/Tracker"],(function(e,t,n,o,i,a,r){"use strict";const s="exportMethod",l=/^$/,c=/^(?!\s*$).+/,d=/^[^?*:<>"\/|\\]+$/;return e.extend({tagName:"div",id:"exportcommand-optionsview",className:"exportcommand-optionsview",setup:function(){try{let e=this;e.setupMethods(),e.setupLoader()}catch(e){console.log(e)}},setupLoader:function(){var e=this;e.loader=UWA.createElement("p",{}).inject(e.container),e.loader.style.textAlign="center",new t({zIndex:2e3}).inject(e.loader).show()},setupMethods:function(){let e=this,t=!1,i=n.getPreference(s);if(e.model.exporters&&e.model.exporters.length){let n=null,a=[];e.model.exporters.forEach(((e,o)=>{0==o&&(n=e),i===e.value&&(t=!0),a.push({value:e.value,label:UWA.i18n(e.label)})})),e.exporters=(new o).inject(e.container),new UWA.Promise((function(t){e.exporters.build({key:s,label:UWA.i18n("exchangecommand.options.field.exportOutput"),help:UWA.i18n("exchangecommand.options.field.exportOutput.help"),type:"DS/Controls/ComboBox",options:{elementsList:a},uncommittedChange:e.uncommittedChange.bind(null,e,a),keydown:e.keydown.bind(null,e,a)},t)})).then((function(o){e.exporters.treeNodeModel._modelEvents.subscribe({event:"attributeChanged"},e.changeOutput.bind(null,e,o,a)),o.value=t?i:n.value}))}},uncommittedChange:function(e,t,o){let i=o.dsModel.value,a=o.options.uncommittedValue;t.some((e=>e.label===a))?e.exporters.control.value=n.getPreference(s)?n.getPreference(s):a:e.exporters.control.value=i},keydown:function(e,t,o){o&&o.target&&UWA.is(o.target.value)&&"Control"!==o.key&&t.some((e=>e.value!==o.target.value))&&(e.exporters.control.value=n.getPreference(s))},changeOutput:function(e,t,o){e.exportmethodcombobox=t;let i=e.exporters.treeNodeModel.getValue();if(i){e.clear(),e.exportmethodcombobox.disabled=!0,o.some((e=>e.value===i))&&n.setPreference(s,i),e.model.set("uexp-exportMethod",i);var a=e.model.exporters.find((e=>e.value==i));a&&(e.model.exporter=a,r.setFormat(i),r.setService(a.service.id),e.load(a))}},clear:function(){let e=this;r.clear(),e.model.clear({silent:!0}),e.generatedView&&e.generatedView.container.empty(),e.loader.hide()},load:function(e){let t=this;t.loader.show(),t.model.setCVFNodesByExporter(e),t.model.requireModulePath(e),require([["DS",e.service["export-ui"]["module-name"],e.service["export-ui"]["module-directory"]].join("")],(e=>{t.exportmethodcombobox.disabled=!1,t.parse(e)}),(e=>{a._private_.modelEvents.publish({event:a.EVENT_LOAD_METHOD_FAILED})}))},parse:function(e){let t=this,n=a.getSelectedNodes();t.config=e,e.preprocess?t.model.preprocess=e.preprocess:t.model.preprocess=void 0,e.transform&&(t.model.transform=e.transform),e.upload&&e.upload.checkinticketurl&&(t.model.upload=e.upload,t.model.set("uexp-checkinticketurl",e.upload.checkinticketurl));var o="function"==UWA.typeOf(e.fields)?e.fields.bind(null,{platformServices:a.platformServices,platformServicesForAllPlatforms:a.platformServicesForAllPlatforms,securityContext:a.securityContext,selectedNodes:n}):t=>t(e.fields);new UWA.Promise(o).then((function(e){t.parseExpoterFields(e)}))},parseExpoterFields:function(e){let t=this;t.loader.hide();let n=[].concat(e);n=t.refine(n),n.unshift(t.getTitleConfig()),t.model.get("uexp-expansion-ready")||t.model.set("uexp-expandLevel",-1);var o=["Unified-Export",t.model.get("uexp-exportMethod")],a=new i({id:o.join("-"),allow:t.options.allow,block:t.options.block});t.generatedView=a.build(n),t.generatedView.inject(t.container)},refine:function(e){var t=this;let n=[];return e.forEach((e=>{if(e){if(e.children&&e.children.forEach((e=>{e.fields=t.refine(e.fields)})),e.key||(e.key=a.unique()),"title"===e.key.toLowerCase())return;"formats"===e.key.toLowerCase()?e=t.getFormatsConfig(e):"expandlevel"===e.key.toLowerCase()&&(e=t.getExpandLevelConfig()),n.push(e)}})),n},getTitleConfig:function(){var e,t=this.model.get("uexp-title");return(e=t)&&(e=(e=e.trim()).replace(/[<>:"\/\\|?*]/g,"")),t=e,{key:"title",label:UWA.i18n("exchangecommand.options.field.title"),type:"DS/Controls/LineEditor",value:t,persist:!1,validate:function(){var e=this.getValue();return l.test(e)||!c.test(e)?UWA.i18n("exchangecommand.options.field.title.placeholder"):d.test(e)?void 0:UWA.i18n("exchangecommand.options.field.title.error")}}},getExpandLevelConfig:function(){return this.model.set("uexp-expansion-ready",!0),{key:"expandLevel",type:"DS/UnifiedExportCommand/Views/Options/ExpandLevel",options:{exchangemodel:this.model}}},getFormatsConfig:function(e){return e.options||(e[options]={}),e.options.exchangemodel=this.model,e.options.engineeringType||(e.options.engineeringType="part"),{key:"part"===e.options.engineeringType?"engineering-part-formats":"engineering-drawing-formats",type:"DS/UnifiedExportCommand/Views/Options/EngineeringFormats",options:e.options}},storeCurrentOptionsAsPreferences:function(){this.generatedView&&this.generatedView.store()},removeCurrentOptionsAsPreferences:function(){this.generatedView&&this.generatedView.remove(),n.removePreference(s)}})})),define("DS/UnifiedExportCommand/Utils/CVExpandUtil",["DS/WAFData/WAFData","DS/UnifiedExportCommand/Utils/ExchangeInfra"],(function(e,t){"use strict";var n={fetch:function(){return new UWA.Promise((function(e,o){let i=t.fetchQuery();i.physicalid&&i.physicalid.length?t.server({url:`${t.platformServices["3DSpace"]}${t.URLS.CVSERVLET_FETCH}?tenant=${t.getX3DPlatformId()}`,method:t.SERVER.VERB.POST,data:JSON.stringify(i),headers:{SecurityContext:t.securityContext},onComplete:n.postFetchSuccess.bind(null,e,o),onFailure:n.postFetchFailure.bind(null,o)}):o(UWA.i18n("exchangecommand.cvfetch.failure.emptypayload"))}))},postFetchSuccess:function(e,t,n){(n=JSON.parse(n))&&n.results?e(n):t(UWA.i18n("exchangecommand.options.field.cvfetch.noresult"))},postFetchFailure:function(e){e(UWA.i18n("exchangecommand.options.field.cvfetch.failure"))},expand:function(e){return t.CVQUERY.EXPAND.level=e.expandLevel,new UWA.Promise((function(o,i){let a=t.expandQuery();a?t.server({url:`${t.platformServices["3DSpace"]}${t.URLS.CVSERVLET_PROGESSIVEEXPAND}?tenant=${t.getX3DPlatformId()}`,method:t.SERVER.VERB.POST,data:JSON.stringify(a),headers:{SecurityContext:t.securityContext},onComplete:n.postExpandSuccess.bind(null,e,o,i),onFailure:n.postExpandFailure.bind(null,i)}):i(UWA.i18n("exchangecommand.options.field.cvexpand.error"))}))},postExpandSuccess:function(e,t,o,i){var a=(i=JSON.parse(i)).errors,r=i.results;if(a)o(UWA.i18n("exchangecommand.notification.exportfailed.message2"));else if(r){var s=e.allowedExpansionTypes;r.length?s&&s.length?n.alterExpansion(r,s).then(t).fail(o):t(r):o(UWA.i18n("exchangecommand.notification.exportfailed.noresults"))}},postExpandFailure:function(e){e(UWA.i18n("exchangecommand.notification.expansionfailed"))},alterExpansion:function(e,t){return new UWA.Promise((function(n,o){let i=[],a=[],r=[],s=[],l=[],c=[];var d={},p={};e.forEach((e=>{e.from?r.push(e):e.Path?l.push(e):t.some((t=>e.flattenedtaxonomies.includes(t)))&&(d[e.resourceid]=!0,a.push(e))})),a&&a.length&&(i.push(a),s=r.filter((e=>{if(d[e.from]&&d[e.to])return p[e.resourceid]=!0,!0})),i.push(s),l.forEach((e=>{var t=e.Path.filter(((e,t)=>t%2==0?d[e]:p[e]));t&&t.length&&c.push({Path:t})})),i.push(c));let u=[...a,...s,...c];0==u.length?o(UWA.i18n("exchangecommand.notification.exportfailed.noresults3")):n(u)}))}};return n})),define("DS/UnifiedExportCommand/Models/Exchange",["UWA/Class/Model","DS/PlatformAPI/PlatformAPI","DS/WAFData/WAFData","DS/Utilities/UUID","DS/UnifiedExchangeCommons/Upload","DS/UnifiedExportCommand/Utils/ExchangeInfra","DS/UnifiedExportCommand/Utils/CVExpandUtil","DS/UnifiedExchangeAnalytics/Tracker","text!DS/UnifiedExportCommand/assets/config/UnifiedExportCommand.json"],(function(e,t,n,o,i,a,r,s,l){"use strict";try{let c=require.toUrl("");c=c.substr(0,c.lastIndexOf("?")),l=JSON.parse(l);let d,p;const u=["types/Project Management","types/Workspace","types/Workspace Vault"];return e.extend({defaults:{title:"Export - "+o.v4()},preprocess:null,transform:null,upload:null,setup:function(){let e=this,t=a.get();e.addEvent("onChange:uexp-expandLevel",(()=>{e.expand()})),e.addEvent("onChange:payload",(()=>{var t=e.get("payload");t&&t.transferdestination&&t.transferdestination.id&&e.set("uexp-selected-platform",t.transferdestination.id)}));for(const n in t)e[n]=t[n]},authorize:function(){let e=this;return new UWA.Promise((function(t,n){e.authorizeWithoutFetch().then((()=>{e.authorizeWithFetch(e).then((function(){e.authorizeWithExpand(e).then((function(){e.set("uexp-cvfnodes",e.cvf),t()})).fail((function(e){n(e)}))})).fail((function(e){n(e)}))})).fail((function(e){n(e)}))}))},authorizeWithoutFetch:function(){return this.validateByVPMRoles()},authorizeWithFetch:function(e,t,n){return new UWA.Promise((function(t,n){e.fetch().then((function(o){o&&(e.exporters=[],e.grantedRoles=e.grantedRoles,l.forEach((t=>{e.validateExporterByEnvironment(t)&&e.validateExporterByRole(t)&&e.validateExporterByLimitedAvailability(t)&&e.validateExporterBySelection(t)&&e.validateExporterByRestrictedApps(t)&&e.exporters.push(t)})),e.exporters.length>0?t():n(UWA.i18n("exchangecommand.notification.notallowed")))})).fail(n)}))},validateByVPMRoles:function(){var e=this;return new UWA.Promise((function(t,n){a.server({url:`${a.platformServices["3DSpace"]}${a.URLS.COLLABORATIVESPACE_URL_EXPORT}`,method:a.SERVER.VERB.GET,headers:{SecurityContext:encodeURIComponent(a.securityContext)},onComplete:e.validateByVPMRolesSuccess.bind(null,e,t,n),onFailure:e.validateByVPMRolesFailures.bind(null,e,n)})}))},validateByVPMRolesSuccess:function(e,t,n,o){var i=UWA.is(o,"string")?JSON.parse(o):o;if(i&&i.RoleList&&i.RoleList.length>0){var r=a.securityContext.split(".")[0];i.RoleList.includes(r)?t():n(UWA.i18n("exchangecommand.vplmroles.error"))}n(UWA.i18n("exchangecommand.vplmroles.error"))},validateByVPMRolesFailures:function(e,t){t(UWA.i18n("exchangecommand.vplmroles.error"))},validateExporterByRestrictedApps:function(e){var t=e&&e.validate&&e.validate["restricted-apps"];return!t||!t.length||!t.includes(a.APP_ID)},validateExporterByEnvironment:function(e){return"OnPremise"!==a.getX3DPlatformId()||!(!e||!e.validate||void 0===e.validate.onPremise)&&e.validate.onPremise},validateExporterByRole:function(e){return e&&e.value&&this.grantedRoles.some((function(t){return e.roles.indexOf(t.id)>-1}))&&e.value&&e.service&&e.service.id&&e.service.url},validateExporterByLimitedAvailability:function(e){var t=e.validate&&e.validate["limited-availability"];return!t||!!new URL(a.getWidget()&&a.getWidget().widgetDomain||window.location.href).searchParams.has(t)},validateExporterBySelection:function(e){var t=this,n=(e=e).validate&&e.validate["allowed-selection-types"];if(n&&n.length){var o=t.getCVFNodesByExporter(e);return t.validNodesTypes=t.getValidNodesTypes(o),o.length>0}return!0},getValidNodesTypes:function(e){var t=new Set;return e.forEach((e=>{e.attributes.filter((e=>"flattenedtaxonomies"===e.name)).map((e=>e.value)).forEach((e=>{t.has(e)||t.add(e)}))})),t},getCVFNodesByExporter:function(e){var t,n;return(e=e).validate&&(t=e.validate["allowed-selection-types"],n=e.validate["restrict-3dexp-objects"]),this.cvf.filter((e=>{if(!t)return!0;if(!e.attributes.find((e=>{if("flattenedtaxonomies"===e.name&&t.includes(e.value))return!0})))return!1;if(n&&(e.attributes.some((e=>"ds6w:cadMaster"===e.name))&&!e.attributes.find((e=>{if("ds6w:cadMaster"===e.name&&"3DEXPERIENCE"!=e.value)return!0}))))return!1;return!0}))},setCVFNodesByExporter:function(e){var t=this.getCVFNodesByExporter(e);this.set("uexp-validcvfnodes",t);var n=t[0].attributes.find((e=>"ds6w:label"===e.name));n=n.value,t.length>1&&(n=n+" "+UWA.i18n("exchangecommand.options.field.title.and")+" "+(t.length-1)+" "+UWA.i18n("exchangecommand.options.field.title.more")),this.set("uexp-title",n),a.setCVFNodes(t)},authorizeWithExpand:function(e){try{var t=[...e.validNodesTypes].some((e=>!u.includes(e)));return t&&t.length?UWA.Promise.resolve():e.performExpandForBookmark(e)}catch(e){return console.error(e),UWA.Promise.resolve()}},performExpandForBookmark:function(e){return new UWA.Promise((function(t,n){let o=a.expandQuery();o.outputs={select_object:["type","flattenedtaxonomies"],format:"entity_relation_occurrence"},o?a.server({url:`${a.platformServices["3DSpace"]}${a.URLS.CVSERVLET_PROGESSIVEEXPAND}?tenant=${a.getX3DPlatformId()}`,method:a.SERVER.VERB.POST,data:JSON.stringify(o),headers:{SecurityContext:a.securityContext},onComplete:e.postExpandForBookmarkSuccess.bind(null,e,t,n),onFailure:e.postExpandForBookmarkFailure.bind(null,n)}):e.postExpandForBookmarkFailure.bind(null,n)}))},postExpandForBookmarkSuccess:function(e,t,n,o){try{var i=(o=JSON.parse(o)).errors,a=o.results,r=[];i?n(UWA.i18n("exchangecommand.notification.bookmarkexpansionfailed")):a&&(a.length?(r=a.map((e=>e.flattenedtaxonomies?e.flattenedtaxonomies.split(","):[])).flat(),r=new Set(r),r=Array.from(r)):n(UWA.i18n("exchangecommand.notification.exportfailed.noresults2"))),e.exporters=e.exporters.filter((e=>(e.validate&&e.validate["allowed-expansion-types"]).some((e=>r.includes(e))))),e.exporters.length>0?t():n(UWA.i18n("exchangecommand.notification.notallowed"))}catch(e){console.error(e),t()}},postExpandForBookmarkFailure:function(e){e(UWA.i18n("exchangecommand.notification.bookmarkexpansionfailed"))},fetch:function(){var e=this;return new UWA.Promise(((t,n)=>{r.fetch().then((function(n){e.cvf=n.results,t(n)})).fail(n)}))},expand:function(){var e=this;return new UWA.Promise(((t,n)=>{e.set("uexp-expand-starts",!0),r.expand({expandLevel:e.get("uexp-expandLevel"),allowedExpansionTypes:e.exporter.validate&&e.exporter.validate["allowed-expansion-types"]}).then((function(n){e.set("objects",n),e.set("uexp-expand-resolved",!0),t()})).fail((function(e){a._private_.modelEvents.publish({event:a.EVENTS.ERROR_OCCURED,data:{message:e}})})).finally((function(){e.unset("uexp-expand-starts",{silent:!0}),e.unset("uexp-expand-resolved",{silent:!0})}))}))},save:function(){let e=this,t=a.getExportableContent(),n=e.get("objects");e.set("uexp-preprocess",!0);let o=e.preprocess?e.preprocess.bind(null,{selectedNodes:t,expandedNodes:n,securityContext:e.securityContext,platformServices:e.platformServices}):e=>e();return new UWA.Promise(o).then(e.refinement.bind(null,e,n)).then(e.uploads.bind(null,e)).then(e.export.bind(null,e))},refinement:function(e,t){return new UWA.Promise(((e,n)=>{e(t=t.map((e=>(e.resourceid&&(e.flattenedtaxonomies&&delete e.flattenedtaxonomies,e["ds6w:cadMaster"]&&delete e["ds6w:cadMaster"],e.from&&delete e.from,e.to&&delete e.to),e))))}))},getSelectedPlatformServices:function(){var e=this;if(e.has("uexp-selected-platform")){return a.platformServicesForAllPlatforms.find((t=>t.platformId==e.get("uexp-selected-platform")))}return a.platformServices},uploads:function(e,t){let n=JSON.stringify({results:t}),o=new Blob([n],{type:"application/json"});if(s.setContentSize(o.size),o.size>175e3&&e.upload){return e.set("uexp-checkin-starts",!0),new i({content:{blob:o,extension:"json"},checkinticket:e.getCheckinTicket(),success:function(t){e.set("receipts",t.checkInAnswer.trim()),e.set("fileIds",t.checkinFileId),e.unset("objects",{silent:!0})},progress:function(t){e.set("uexp-checkin-progress",Math.ceil(100*t.loaded/t.total))}}).upload()}return new UWA.Promise((function(e,t){e()}))},getCheckinTicket:function(){var e=this,t=e.get("uexp-checkinticketurl"),n=e.getSelectedPlatformServices()[e.exporter.service.id];return"string"===UWA.typeOf(t)?t=[n,t,"?maxNumberOfFiles=1"].join(""):"function"===UWA.typeOf(t)&&(t=t({platformServices:e.getSelectedPlatformServices(),securityContext:a.securityContext})),t},export:function(e){return d=(new Date).getTime(),e.set("uexp-export-requested",!0),new Promise((function(t,o){let i=e.getSelectedPlatformServices()[e.exporter.service.id]+e.exporter.service.url,a=e.exportPayload(),r={Accept:"application/json","Content-Type":"application/json","Accept-Language":window.widget?window.widget.lang:window.dsLang||"en","X-Requested-With":"XMLHttpRequest",SecurityContext:"3DSpace"===e.exporter.service.id?encodeURIComponent(e.securityContext):e.securityContext},s={data:JSON.stringify(a),method:"POST",headers:r,onComplete:e.success.bind(null,e,t),onFailure:e.failure.bind(null,e,o)};n.authenticatedRequest(i,s)}))},exportPayload:function(){let e=this;if(e.transform)try{var t=e.get("payload");return e.has("receipts")&&e.has("fileIds")?UWA.merge(t,{receipts:e.get("receipts"),fileIds:e.get("fileIds")}):e.has("objects")&&UWA.merge(t,{objects:e.get("objects")}),e.transform.call(t,{platformServices:e.platformServices,securityContext:e.securityContext})}catch(e){console.log(e)}return e._attributes},requireModulePath:function(e){let t=this;try{if(t.platformServices[e.service.id]){let o=[t.platformServices[e.service.id],e.service["export-ui"]["module-deployment-directory"]?e.service["export-ui"]["module-deployment-directory"]:"/webapps"].join("");var n={};n[["DS",e.service["export-ui"]["module-directory"]].join("")]=o+e.service["export-ui"]["module-directory"],require.config({paths:n})}}catch(e){console.log(e)}},resetBaseUrl:function(){},success:function(e,n,o){(o=JSON.parse(o)).platform=e.has("uexp-selected-platform")||a.getX3DPlatformId(),e.calculateExportTime(e),e.track(),e.set("uexp-exchange-success",!0),t.publish("ds-unified-exchange-topic-job-created",o),n&&n(UWA.i18n("exchangecommand.notification.exportstarted.message"))},failure:function(e,t){e.calculateExportTime(e),e.track(),t&&t(UWA.i18n("exchangecommand.notification.exportfailed.message"))},calculateExportTime:function(e){p=(new Date).getTime();let t=(p-d)/1e3;s.setTime(t)},track:function(){s.setOperation(s.EVENT.CATEGORY.VALUES.EXPORT),s.setUrl(s.VIEW.URL.VALUES.EXPORT),s.setTitle(s.VIEW.TITLE.VALUES.EXPORT),s.setLanguage(a.SERVER.DEFAULT_HEADERS["Accept-Language"]),s.setTenant(a.getX3DPlatformId()),s.setAppId(a.getAppId()),s.sendEvent()}})}catch(e){console.log(e)}})),define("DS/UnifiedExportCommand/Views/ExchangeProcessDialog",["UWA/Class/View","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/Label","DS/Controls/Button","DS/Controls/ProgressBar","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/UnifiedExportCommand/Models/Exchange","DS/UnifiedExportCommand/Utils/ExchangeInfra","DS/UnifiedExportCommand/Views/ExchangeOptions","DS/UnifiedExportCommand/Views/Selected","i18n!DS/UnifiedExportCommand/assets/nls/UnifiedExportCommandNLS","css!DS/UIKIT/UIKIT.css","css!DS/UnifiedExportCommand/UnifiedExportCommand"],(function(e,t,n,o,i,a,r,s,l,c,d,p,u){"use strict";try{let m,f,g,v,h,x,E,S,D,A;return UWA.i18n(u),e.extend({tagName:"div",id:"exportcommand-exchangeprocessdialog",className:"exportcommand-exchangeprocessdialog",setup:function(e){let t=this;t._private={},t.model=e&&e.model||new l,t.setupOverlay(),t.setupDialog(),t.model.authorize().then(t.setupExporters.bind(null,t)).fail(t.reject.bind(null,t))},setupOverlay:function(){UWA.createElement("div",{id:"export-overlay",class:"export-overlay"}).inject(this.container)},setupDialog:function(){var e=this;e.setupSubscriptions(),e.setupDialogContainer(),e.setupProgressView(),e.setupInputSelection(),f&&f.close(),g=new n,g.inject(e.container),f=new t({title:UWA.i18n("exchangecommand.dialog.header"),content:m,immersiveFrame:g,modalFlag:!0,usePaddingFlag:!1,resizableFlag:!0}),f.resizableFlag=!1,f.closeButtonFlag=!1,f.addEventListener("close",e.afterClose.bind(null,e)),f.addEventListener("resize",e.onDialogResize.bind(null,e)),c.getWidget()&&c.getWidget().addEvent("onResize",e.setDialogWidth.bind(null,e)),e.container.inject(e.options.elParent||c.getWidget()&&widget.body),e.setDialogWidth(e)},setupDialogContainer:function(){m=UWA.createElement("div",{class:"exchangecommand-dialogcontainer"})},setupProgressView:function(){x=UWA.createElement("div",{class:"exportcommand-exchangeprocessdialog-progressview",styles:{margin:10}}).inject(m),h=new o({value:UWA.i18n("exchangecommand.dialog.progressMessage.analyzing"),maxDisplayLength:500,icon:{iconName:"multiselect",fontIconFamily:1}}).inject(x),h.getContent().style.background="transparent",h.getContent().style.fontSize="13px",h.getContent().style.fontWeight="bold",v=new a({statusFlag:!1,infiniteFlag:!0,displayStyle:"lite"}).inject(x)},setupExporters:function(e){x.hide(),e.exchangeoptions=new d({model:e.model,allow:function(t){e.model.set("payload",t),e.fireDimensionsChanged(),e.model.set("uexp-field-validate",!0)},block:function(){e.model.set("uexp-field-validate",!1)}}),e.exchangeoptions.inject(m),f.buttons=e.getFooter(),f.resizableFlag=!0,f.closeButtonFlag=!0,e.setDialogWidth(e)},setupInputSelection:function(){this._private.inputSelection=new p({model:this.model}).inject(m)},expansionStarts:function(e){A.start(),A.element.show(),S.disabled=!0,e.model.set({"uexp-validFlag-expansion":!1})},expansionResolved:function(e){A.stop(),A.element.hide();var t=e.model.get("objects");t=t.filter((e=>{if(!e.Path&&!t.from)return!0})),E.hide(),e.model.set({"uexp-validFlag-expansion":!0})},getFooter:function(){let e=this;E=new i({displayStyle:"lite",label:UWA.i18n("exchangecommand.dialog.footer.button.ok"),visibleFlag:!1}),S=new i({label:UWA.i18n("exchangecommand.dialog.footer.button.save"),disabled:!0,onClick:e.save.bind(null,e)}),D=new i({label:UWA.i18n("exchangecommand.dialog.footer.button.cancel"),onClick:e.cancel.bind(null,e)});var t=E.getContent();return t.style.position="absolute",t.style.left="15px",t.style.cursor="default",A=new UWA.Fx(t,{duration:1200,wait:!0,events:{onComplete:function(){A.tween("color","#005686","#B4B6BA")}}}),A.element.hide(),{Ok:E,Save:S,Cancel:D}},save:function(e,t){let n=e;S.label=UWA.i18n("exchangecommand.dialog.footer.button.saving"),S.disabled=!0,n.model.save().then(n.resolve.bind(null,n),n.reject.bind(null,n))},setupSubscriptions:function(){var e=this;e.listenTo(e.model,"onChange",e.fireDimensionsChanged),c.getWidget()&&widget.addEvent("onRefresh",(function(){f.close()})),e.listenTo(e.model,"onChange:uexp-expand-starts",e.expansionStarts.bind(null,e)),e.listenTo(e.model,"onChange:uexp-preprocess",e.preprocessStarts.bind(null,e)),e.listenTo(e.model,"onChange:uexp-checkin-starts",e.checkinStarts.bind(null,e)),e.listenTo(e.model,"onChange:uexp-checkin-progress",e.checkinProgress.bind(null,e)),e.listenTo(e.model,"onChange:uexp-export-requested",e.exportRequested.bind(null,e)),e.listenTo(e.model,"onChange:uexp-expand-resolved",e.expansionResolved.bind(null,e)),e.listenTo(e.model,"onChange:uexp-field-validate",e.enableBtnSave.bind(null,e)),e.listenTo(e.model,"onChange:uexp-validFlag-expansion",e.enableBtnSave.bind(null,e)),c._private_.modelEvents.subscribeOnce({event:c.EVENTS.ERROR_OCCURED},(function(t){e.reject(e,t),c._private_.modelEvents.unsubscribe("ExchangeInfra.EVENTS.ERROR_OCCURED")}))},enableBtnSave:function(e){S.disabled=!(e.model.get("uexp-validFlag-expansion")&&e.model.get("uexp-field-validate"))},preprocessStarts:function(e){e._private.inputSelection.hide(),h.value=UWA.i18n("exchangecommand.dialog.progressMessage.validated"),h.icon={iconName:"check",fontIconFamily:1},f.resizableFlag=!1,f.closeButtonFlag=!1,f.buttons=null,e.exchangeoptions.hide(),x.show()},checkinStarts:function(e){v.infiniteFlag=!1,h.value=UWA.i18n("exchangecommand.dialog.progressMessage.packaged"),h.icon={iconName:"upload",fontIconFamily:1}},checkinProgress:function(e,t){v.value=e.model.get("uexp-checkin-progress")},exportRequested:function(e){h.value=UWA.i18n("exchangecommand.dialog.progressMessage.progress"),h.icon={iconName:"hourglass ",fontIconFamily:1}},resolve:function(e,t){e.exchangeoptions&&e.exchangeoptions.storeCurrentOptionsAsPreferences(),f&&f.close(),UWA.is(t)&&e.exportStarted(t)},reject:function(e,t){f&&f.close(),t&&t["clear-export-method"]&&e.exchangeoptions&&e.exchangeoptions.removeCurrentOptionsAsPreferences(),t&&e.exportNotAllowed(t)},cancel:function(e){f.close()},afterClose:function(e){g.destroy(),f.destroy(),e.model.dispatchEvent("closeexchange")},exportStarted:function(e){s.setNotificationManager(r),s.setFadeOutPolicy(2),s.setStackingPolicy(5),r.addNotif({level:"success",message:e})},exportNotAllowed:function(e){s.setNotificationManager(r),s.setFadeOutPolicy(2),s.setStackingPolicy(5);let t={level:"error"};"string"==typeof e?t.message=e:"object"==typeof e&&(t={...t,...e}),r.addNotif(t)},fireDimensionsChanged:function(){f.fire("dimensionsChanged")},onDialogResize:function(e,t){m&&(t.currentTarget.clientWidth>=480?(e.container.querySelectorAll(".exportcommand-parametersview-col-label").forEach((e=>{e.classList.remove("resize-shrinked"),e.classList.add("resize-expanded")})),e.container.querySelectorAll(".exportcommand-parametersview-col-value").forEach((e=>{e.classList.remove("resize-shrinked"),e.classList.add("resize-expanded")}))):(e.container.querySelectorAll(".exportcommand-parametersview-col-label").forEach((e=>{e.classList.remove("resize-expanded"),e.classList.add("resize-shrinked")})),e.container.querySelectorAll(".exportcommand-parametersview-col-value").forEach((e=>{e.classList.remove("resize-expanded"),e.classList.add("resize-shrinked")}))))},setDialogWidth:function(e){f&&(f.width=e.computeWidth())},computeWidth:function(e=0){0===e&&(this.options.elParent?e=this.options.elParent.clientWidth:c.getWidget()&&(e=c.getWidget().body.clientWidth));return e>=510&&(e=510),e}})}catch(e){console.log(e)}})),define("DS/UnifiedExportCommand/Commands/UnifiedExportCommand",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/PADServices/utils/SGIUtils","DS/UnifiedExportCommand/Views/ExchangeProcessDialog","DS/UnifiedExportCommand/Utils/ExchangeInfra","DS/UnifiedExportCommand/Utils/ProxyContext"],(function(e,t,n,o,i,a){return e.extend({init:function(e){let n=this;(n._parent(e),!window.jasmine||window.tstEnvironment)&&(n.model=e&&e.model,i.setup({context:n.options&&UWA.is(n.options.context,"object")&&n.options.context||t&&t.get()||new a(e)}).then(n.onInfraReady.bind(null,n)))},onInfraReady:function(e){e.disable();var t=i.getTreeDocument();t&&(t.getXSO().onPostAdd(e.toggleExport.bind(null,e)),t.getXSO().onPostRemove(e.toggleExport.bind(null,e)),t.getXSO().onEmpty(e.toggleExport.bind(null,e)),t._modelEvents)},execute:function(){let e=this;e.disable();let t=new o({model:e.model});t.listenTo(t.model,"closeexchange",(()=>{e.toggleExport(e)}))},toggleExport:function(e){e.disable();var t=UWA.is(i.getSelectedNodes,"function")&&i.getSelectedNodes(),o=t&&t.map((e=>{if(e.getRoot())return e.getRoot().getID()})),a=n.isSupplemental(o);o&&o.length&&!a&&e.enable()}})})),define("DS/UnifiedExportCommand/Commands/UnifiedExportCommandExt",["DS/UnifiedExportCommand/Commands/UnifiedExportCommand","DS/UnifiedExportCommand/Views/ExchangeProcessDialog","DS/UnifiedExportCommand/Utils/ExchangeInfra"],(function(e,t,n){return e.extend({onInfraReady:function(e){e.execute()},execute:function(){n.get()&&n.get();let e=new t({elParent:document.body});e.listenTo(e.model,"closeexchange",this.closeexchange.bind(null,this))},closeexchange:function(e){document.querySelectorAll("exportcommand-widget-container").forEach((e=>{e.empty(),e.destory()}))}})}));