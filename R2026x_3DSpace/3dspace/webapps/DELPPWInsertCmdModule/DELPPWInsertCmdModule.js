define("DS/DELPPWInsertCmdModule/InsertUI",["UWA/Core"],(function(e){"use strict";return function(t,n,i,o){var a,r=1,l=2,s=3,u=1,c=2,f=3,g=n.getComponent("Element"),d=n.getComponent("Button"),I=null,h=null,D=null,p=!1,C={},y=!0,v=function(t){e.is(t)&&e.is(t.invalidXML)&&(p=t.invalidXML)},V=function(t,n){var o,r;switch(r=i.getNLSValue(t),a){case c:return o="InsertUI.ReplaceByNewDialog.Title",e.is(r)||(r=i.getNLSValue(t,null,"Type")),i.getNLSValue(o,{type:r});case f:return o="InsertUI.ContinuousProvidedMaterial.Title",e.is(r)||(r=i.getNLSValue(t,null,"Dimension")),i.getNLSValue(o,{dimension:i.getNLSValue(n,null,"Dimension")});default:return o="InsertUI.CreateDialog.Title",e.is(r)||(r=i.getNLSValue(t,null,"Type")),i.getNLSValue(o,{type:r})}},m=function(e){D.title=V(e),D.clearMessages()},T=function(n){let i={type:n.split("/")[1],V_Type:n,oneDelmiaAggregationMode:t.getPreferenceValue("oneDelmiaAggregationMode")};return new Promise(((t,n)=>{o.getTypeProxy(i,(function(i){var a={},r={};if(!e.is(i))return y=!0,void n();for(const[t,n]of Object.entries(i.attributesValue)){let i=o.getAttributeInfo(t);if(!e.is(i)){let n=t.split(".");n.length>1&&(e.is(r[n[0]])?r[n[0]].push(n[1]):r[n[0]]=[n[1]])}a[t]=n}if(Object.keys(r).length>0){let e=[];for(const[t,n]of Object.entries(r))e.push({type:t,attributes:n});o.fetchDicoAttributeInfo(e,(function(){C=a,y=!1,t(a)}),(function(e){y=!0,C={},n(e)}))}else C=a,y=!1,t(a)}),(function(e){y=!0,C={},n(e)}))}))},b=function(){var e=I.getValues(),t=e.V_Type,n=e.type;T(t).then((function(){I.updateToDefaultValues(C),m(n)})).catch((function(){m(n)}))},U=function(e){T(e).then((function(){I.updateToDefaultValues(C),m(e)})).catch((function(){m(e)}))},L=function(e,t){T(e).then((function(){I.updateToDefaultValues(C),m(e)})).catch((function(){m(e)}))},S=function(t){var n=e.clone(C),i={};if(!y){if(e.is(I))for(const[e,t]of Object.entries(n)){let n=o.getAttributeInfo(e);i[e]=I.getAuthorizedValue(t,n)}e.merge(t,i)}return t.isBLToBecalled=y,t},P=function(u,f,g,y,v){var m,b,U,L,P,M,w,N,A,R=e.is(v)&&e.is(v.fatherPID,"string")&&v.fatherPID.length>0?v.fatherPID:null,O=e.is(v)&&e.is(v.transactionUUID,"string")&&v.transactionUUID.length>0?v.transactionUUID:null,F={transactionUUID:O,requestedCreation:0},B=t.getPreferenceValue("showDialog")&&(!e.is(g,"boolean")||g);if(N=function(){!0!==(U=I.validate()).result?(b=i.getNLSValue("ModelBehavior.CreateReference.Failure.ReferenceNotCreated")+U.message,t.warn(b),D.close()):(A=I.getSecurityContextOverride(),m=I.getValues(),m=S(m),D.close(),f(m,{securityContextOverride:A,fatherPID:R,transactionUUID:O}))},P=function(n){var i=function(){var t=I.validate(),n=I.getSecurityContextOverride();return!0!==t.result?(e.is(t.message)&&D.error(t.message),!1):(D.clearMessages(),m=I.getValues(),m=S(m),f(m,{securityContextOverride:n,fatherPID:R,transactionUUID:O}),!0)},o=function(){D.close()};switch(n){case r:return function(){U=null,o(),e.is(O)&&t.notify("objectCreationUIClosed",F)};case s:return function(){var t,n,o,a;e.is(O)&&F.requestedCreation++,i()&&(t=m.V_Type,n=I.getValues(),o={},a=C,T(t).then((function(){for(const[t,i]of Object.entries(a))e.is(n[t])&&e.is(C[t])&&(i===n[t]?o[t]=C[t]:o[t]=n[t]);I.updateToDefaultValues(o)})))};case l:return function(){i()&&(o(),e.is(O)&&(F.requestedCreation++,t.notify("objectCreationUIClosed",F)))};default:t.log("wrong option")}},a===c)L={No:new d({label:i.getNLSValue("InsertUI.Close.Title"),onClick:P(r)}),Yes:new d({label:i.getNLSValue("InsertUI.ReplaceAndClose.Title"),onClick:P(l)})};else L={No:new d({label:i.getNLSValue("InsertUI.Close.Title"),onClick:P(r)}),Apply:new d({label:i.getNLSValue("InsertUI.Create.Title"),onClick:P(s)}),Yes:new d({label:i.getNLSValue("InsertUI.CreateAndClose.Title"),onClick:P(l)})};e.is(n)?(w={title:V(u.split("/")[1]||"",y),domId:"InsertUI-dialog",content:h,resizableFlag:!0,modalFlag:!0,minWidth:290,buttons:L,visibleFlag:B},e.is(o)&&(M=u.indexOf("/")>-1?u.split("/")[1]:u,w="WORKINSTRUCTION"!==o.getPPRTypeFromType(M)||o.isAKindOf(M,"DELWkiDataCollectPlanReference")||o.isAKindOf(M,"DELWkiDataCollectChecklistReference")||o.isAKindOf(M,"DELResourceParameterPlanReference")?e.merge({width:400},w):e.merge({position:{my:"top",at:"top"},height:500,width:600},w)),(D=n.create("Dialog",w)).close=function(){e.is(I)&&(I.destroy(),I=null),e.is(h)&&h.destroy(),this.destroy(),D=null},B?p&&D.error(i.getNLSValue("ModelBehavior.CreateReference.Failure.InvalidXML")):N()):t.debug("uxFactoryBehavior is not available."),t.notify("objectCreationUIOpened",{})};return{createDialog:function(t,i,o,r,l,s){a=u,e.is(r)&&(a=f),h=new g("div",{class:"Insert-Command-Container"}),e.is(D)||(e.is(I)||(I=n.create("DataCollectionUI",{type:t,onTypeChange:b,renderTo:h,dimension:r,createRoot:l,onFailure:v,onMagnitudeChange:L})),T(t).then((function(){I.updateToDefaultValues(C),P(t,i,o,r,s)})).catch((function(){P(t,i,o,r,s)})))},createDialogForReplaceByNew:function(t,i,o,r){a=c,h=new g("div",{class:"Insert-Command-Container"}),e.is(D)||(e.is(I)||(I=n.create("DataCollectionUI",{type:o,baseTypes:t,selectedBaseType:i,createRoot:!0,onTypeChange:U,renderTo:h,onFailure:v,onMagnitudeChange:L})),T(o).then((function(){I.updateToDefaultValues(C),P(o,r)})).catch((function(){P(o,r)})))},isActive:function(){return!!e.is(D)&&D.visibleFlag},destroyUI:function(){e.is(D)&&D.close()},getFieldValue(t,n){var i=null,a=o.getAttributeInfo(n);return e.is(I)&&(i=I.getFieldValue(t,a)),i}}}})),define("DS/DELPPWInsertCmdModule/InsertCmdModule",["UWA/Core","DS/DELPPWInsertCmdModule/InsertUI"],(function(e,t){"use strict";return{behaviors:["UXFactoryBehavior","ModelBehavior","LinkBehavior","ResourceBehavior","SelectionBehavior","SearchBehavior","MfgProcessBehavior"],creator:function(n,i,o,a,r,l,s,u){var c,f,g,d={},I=null,h=null;return g=function(t){var n,i,o;if(e.is(t)&&t.length>0)(n=l.getModuleSelections(t)).length>0&&(n=n[0].id);else if(o=l.getSelections(),e.is(o,"array")&&o.length>0)for(i=0;i<o.length&&(n=o[i][0],!e.is(n));i++);if(e.is(n))return n},f=function(t,n){var i,a=n.fatherPID;e.is(a)&&a.length>0&&(i=o.getInstance(a),e.is(i)&&(t.instancePID=i.get("PID"))),e.is(h)&&(t["DELFmiMagnitudeExt.V_DimensionType"]=h),o.createRefOrInst(t,a,n)},c=function(t){var n,i,a,r=t.arguments,l="",s=[],u=!0;I.isActive()&&I.destroyUI(),h=null,e.is(r,"array")&&0<r.length&&r.forEach((function(t){if(e.is(t)&&e.is(t.ID,"string")&&e.is(t.Value,"string"))switch(t.ID){case"ReferenceType":l=t.Value;break;case"ShowDialog":n="false"!==t.Value;break;case"DisplayedInTableView":e.is(this._displayedInTableView,"array")||(s=[]),s.push(t.Value);break;case"V_DimensionType":h=t.Value}}),this),a=g(t.sourceModuleId),e.is(a)&&a.length>0&&(u=!1,i=o.getReferenceModel(a).get("PID")),I.createDialog(l,f,n,h,u,{fatherPID:e.is(i)?i:null})},{listenTo:function(){return{InsertCmd:c,refreshAll:this.closeDialog}},onStart:function(a,l){d=e.extend(d,a),e.is(d.insertFormAttributeXML)||(n.debug("Insert Module (OLD) loading failed : insertFormAttributeXML option is undefined"),l()),I=new t(n,i,r,o),l()},onStop:function(){I.isActive()&&I.destroyUI(),I=void 0},closeDialog:function(){e.is(I)&&I.destroyUI()}}}}}));