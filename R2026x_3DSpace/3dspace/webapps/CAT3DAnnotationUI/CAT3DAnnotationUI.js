/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/CAT3DAnnotationUI/CAT3DAnnotationAttrDiv",["UWA/Core","UWA/Class","UWA/Controls/ThemedScroller","DS/VisuEvents/EventsManager","DS/WebappsUtils/WebappsUtils","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/CAT3DAnnotationUtils/CAT3DAnnotationStorageController","i18n!DS/CAT3DAnnotationUI/assets/nls/CAT3DAnnotationUI","css!DS/CAT3DAnnotationUI/CAT3DAnnotationUI.css"],(function(e,t,n,i,r,a,o,l){"use strict";return t.extend({init:function(t){this._parent(t);var s,c,A,d,v,D=e.createElement("div",{class:"CAT3DAnnotationAttrDiv"}),p=[],u=!1,h=r.getWebappsAssetUrl("CAT3DAnnotationRsc","icons/22/"),C={4:"I_W3DAnnot_VeryHighFailureMode.png",3:"I_W3DAnnot_HighFailureMode.png",2:"I_W3DAnnot_MediumFailureMode.png",1:"I_W3DAnnot_LowFailureMode.png",0:"I_W3DAnnot_LeastImportantFailureMode.png"};let T=o.getPreference("CATWebUXMePreferences_Units");function m(){this.setStyles({color:"#368ec4",cursor:""})}function f(){this.setStyles({color:"rgb(130, 190, 220)",cursor:"pointer"})}function g(t,n,i){var r=e.createElement("div",{class:"CAT3DAnnotationAttrDivTitleAndText"});(i&&r.setStyle("height","16px"),t)&&(e.createElement("p",{class:"CAT3DAnnotationAttrDivBoldTitle"}).inject(r).innerHTML=t);n&&(e.createElement("p",{class:"CAT3DAnnotationAttrDivText CAT3DAnnotationAttrDivValue"}).inject(r).innerHTML=n);return r}function y(t){var n=e.createElement("div",{class:"CAT3DAnnotationFailureDiv"}),i=e.createElement("div",{class:"CAT3DAnnotationFailureImgBoxDiv"}).inject(n);e.createElement("img",{class:"CAT3DAnnotationFailureImgDiv",src:h+C[t.crit]}).inject(i);var r=e.createElement("div",{class:"CAT3DAnnotationFailureTextDiv"}).inject(n),a=e.createElement("p",{class:"CAT3DAnnotationFailureTextBoldDiv"}).inject(r);a.innerHTML=l.FailureModes[t.crit];for(var o=0;o<t.descriptions.length;o++)(a=e.createElement("p",{class:"CAT3DAnnotationFailureTextValueDiv"}).inject(r)).innerHTML=t.descriptions[o];return n}function x(t,n,r){var a=e.createElement(t,{class:"CAT3DAnnotationAttrDivText CAT3DAnnotationAttrDivUrl"});return"a"===t&&a.setAttributes({href:n.url}),void 0!==n.title&&""!==n.title?(a.innerHTML=n.title,a.setAttributes({title:n.url})):a.innerHTML=n.url,a.addEventListener("mouseenter",f),a.addEventListener("mouseleave",m),a.setStyles({color:"rgb(0, 120, 175)",padding:u?"5px 0px":"2px 0px"}),"a"!==t&&r&&(a.linkedData=n,p.push(i.addEvent(a,"onPrimaryPointerClick",(function(){r(n)})))),a}this.setTouchDisplay=function(e){var t="boolean"==typeof e&&e;if(u!==t){u=t;var n=D.querySelectorAll(".CAT3DAnnotationAttrDivUrl");if(!n.length)return;for(var i=0;i<n.length;i++)n[i].setStyles({padding:u?"5px 0px":"0px"})}},this.buildDivWithDots=function(t){(s=e.createElement("div")).appendChild(D),t.uiFrame.appendChild(s),s.setStyle("position","absolute");var r=s.offsetHeight,a=s.offsetWidth+5;if(s.setStyle("position",""),t.uiFrame.removeChild(s),t.createReadMoreDiv){var o=e.createElement("div",{class:"CAT3DAnnotationAttrDivDots"}).inject(s);o.innerHTML=l.MoreLbl,v=i.addEvent(o,"onPrimaryPointerClick",(function(e){e.from[0].event.stopPropagation(),e.from[0].event.preventDefault(),t.callback(e)}))}if(D.setStyles({height:r+"px",width:a+"px"}),r>290){D.setStyles({maxHeight:"290px"});var c=D.firstChild;D.removeChild(c),(new n).inject(D).getInnerElement().setContent(c),c.parentNode.parentNode.setStyles({height:"100%"}),c.setStyles({height:r+"px"})}t.onDivCreated({div:s})},this.build=function(t,n,r){var o,l,u;if(t===A&&d===n)return D;for(A=t,d=n;D.firstChild;)D.removeChild(D.firstChild);if(v&&(i.removeEventFromToken(v),v=0),p.length){for(o=0;o<p.length;o++)i.removeEventFromToken(p[o]);p.length=0}s=null,c=null,D.setStyles({maxHeight:"",height:"",width:""});var h,C=0;for(o=0;o<A.length;o++){h||(h=e.createElement("div",{class:"CAT3DAnnotationAttrDivMainContainer"}));var m=A[o],f=e.createElement("div",{class:"CAT3DAnnotationAttrDivContent"}).inject(h);if(d){var E=e.createElement("div",{class:"CAT3DAnnotationAttrContainer"}).inject(f);if(m.icon&&e.createElement("img",{src:m.icon,class:"CAT3DAnnotationAttrDivIcon"}).inject(E),m.name){var b=e.createElement("p",{class:"CAT3DAnnotationAttrDivText CAT3DAnnotationAttrDivTitle"}).inject(E);b.innerHTML=m.name,b.title=m.name}}c=e.createElement("div",{class:"CAT3DAnnotationAttrDivTextContainer"}).inject(f);var M=m.infos,S=Object.keys(M);for(l=0;l<S.length;l++)switch(S[l]){case"hyperlinksAndComments":var j=M.hyperlinksAndComments.urls;if(j&&j.length)for(u=0;u<j.length;u++)x("a",{title:j[u].title,url:j[u].url}).inject(c),C++;if(M.hyperlinksAndComments.hiddenText){var U=M.hyperlinksAndComments.hiddenText.split(/(\r\n|\n|\r)/gm);for(u=0;u<U.length;u++)g(null,U[u]).inject(c),C++}break;case"tolerances":M.tolerances.tabulatedLimit&&M.tolerances.toleranceLimits&&(g(M.tolerances.tabulatedLimit," ("+M.tolerances.toleranceLimits.min+" / +"+M.tolerances.toleranceLimits.max+")",!0).inject(c),C++),M.tolerances.generalTol&&(g(M.tolerances.generalTol.name," ("+M.tolerances.generalTol.variation+")",!0).inject(c),C++);break;case"failureModes":if(M.failureModes.length){var L,I=[];for(u=0;u<M.failureModes.length;u++)I[(L=M.failureModes[u]).crit]?I[L.crit].descriptions=I[L.crit].descriptions.concat(L.descriptions):I[L.crit]={crit:L.crit,descriptions:L.descriptions.slice()};for(u=0;u<I.length;u++)I[u]&&(y(I[u]).inject(c),C++)}break;default:if("requirements"===S[l]||"relatedDocs"===S[l]){var F=M[S[l]];if(F&&F.length)for(u=0;u<F.length;u++)x("p",{title:F[u].displayLabel,url:F[u].label,phyID:F[u].phyID,type:F[u].type,phyType:F[u].phyType},r).inject(c),C++}else if(Array.isArray(M[S[l]])){var W,k;for(u=0;u<M[S[l]].length;u++)M[S[l]][u].Hidden||(k=M[S[l]][u].Magnitude,W=M[S[l]][u].Value,k&&k.toLowerCase&&(k=k.toLowerCase()),a.isMagnitudeSupported(k)?a.convertUnitValueToString(M[S[l]][u].Value,k.charAt(0).toUpperCase()+k.slice(1),T[k.charAt(0).toUpperCase()+k.slice(1)],T[k.charAt(0).toUpperCase()+k.slice(1)+"CalcDisplay"],T.TrailingZeros):"boolean"===k&&(W=("1"===W).toString()),g(M[S[l]][u].Name+": ",W,!0).inject(c),C++)}else{var H=M[S[l]].split(/(\r\n|\n|\r)/gm);for(u=0;u<H.length;u++)if(10!==H[u].charCodeAt(0)){var _=H[u].indexOf("=");-1===_&&(_=H[u].indexOf(":")),-1!==_?g(H[u].substring(0,_+1),H[u].substring(_+1,H[u].length),!0).inject(c):g(null,H[u],!0).inject(c),C++}}}o!==A.length-1&&A.length>1&&e.createElement("div",{class:"CAT3DAnnotationAttrDivLine"}).inject(f)}return h&&D.appendChild(h),C||d?D:null}}})})),define("DS/CAT3DAnnotationUI/CAT3DAnnotationUI",[],(function(){}));