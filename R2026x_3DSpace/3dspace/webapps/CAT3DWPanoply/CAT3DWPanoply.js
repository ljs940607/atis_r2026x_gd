define("DS/CAT3DWPanoply/CAT3DWDropMenu",["UWA/Core","UWA/Promise","DS/UIKIT/Dropdown","DS/UIKIT/DropdownMenu","DS/CAT3DWInfraUI/CAT3DWPointerEvents"],(function(t,e,n,i,o){"use strict";var s=t.Class.extend({init:function(e){this._callback=e.onClickCallback,this._isOpen=!1,this._hidden=!0,this._offset={x:0,y:0};var o=[],s={target:e.target,multiSelect:void 0!==e.multiSelect&&e.multiSelect,closeOnClick:void 0===e.closeOnClick||e.closeOnClick,className:e.className?e.className:"CAT3DWDropMenu",removeOnHide:!1,bound:!1};switch(this._target=e.target,this.menu=null,e.menuClassList&&(o=e.menuClassList),void 0!==e.offset&&(s.offset=e.offset),void 0!==e.renderTo&&(this._renderTo=e.renderTo,s.renderTo=e.renderTo),this._checkProportions=!0,!1===e.checkProportions&&(this._checkProportions=!1),void 0!==e.onUpdatePosition&&(this._onUpdatePositionCB=e.onUpdatePosition),s.events={},s.events.onClickOutside=this.hide.bind(this),void 0!==e.onClickCallback&&(s.events.onClick=e.onClickCallback),void 0!==e.onShowCallback&&(s.events.onShow=e.onShowCallback),e.arrowPosition){case"bottom":o.push("arrow-down");break;case"right":o.push("arrow-right");break;case"left":o.push("arrow-left");break;case"top":o.push("arrow-up")}if(void 0!==e.body)s.body=e.body,this.menu=new n(s),window.addEventListener("resize",this._debounce(this._onWindowResize,100).bind(this));else{s.items=[],this.menu=new i(s),s.items=e.items;for(let e=0;e<s.items.length;e++)if(s.items[e].name=s.items[e].id,s.items[e].icon&&s.items[e].icon.indexOf(".svg")>-1){let n=s.items[e].icon;s.items[e].icon="#",this.menu.addItem(s.items[e]);let i=this.menu.getItem(s.items[e].id);this._loadSVG(n,function(e,n){let i=e.elements.icon.parentElement,o=t.createElement("span");o.classList.add("item-icon"),e.elements.icon.remove(),e.elements.icon=o,i.prepend(o),e.elements.icon.setStyle("height","36px"),e.elements.icon.setStyle("padding","4px 7px"),e.elements.icon.setStyle("font-size","18px"),e.elements.icon.setStyle("fill","#77797C"),e.elements.icon.setStyle("margin","0 0.2em"),e.elements.icon.innerHTML=n}.bind(this,i))}else this.menu.addItem(s.items[e]);for(let t=0;t<s.items.length;t++){let e=function(t,e){t.elements.container.setAttribute("data-uid_po",e.id),Object.hasOwn(e,"tooltip")&&e.tooltip&&t.elements.container.setAttribute("title",e.tooltip)};if(e(this.menu.getItem(s.items[t].id),s.items[t]),s.items[t].items)for(let n=0;n<s.items[t].items.length;n++){e(this.menu.getItem(s.items[t].items[n].id),s.items[t].items[n])}}}for(let t=0;t<o.length;t++)this.menu.elements.container.classList.add(o[t]);this._onUpdatePositionCB&&(this._nativeUpdatePosition=this.menu.updatePosition.bind(this.menu),this.menu.updatePosition=this._updatePosition.bind(this)),this._addClickOutsideListener(e.onClickOutsideCallback)},checkProportions:function(t){if(this._checkProportions){var e=this.menu.elements.container.getBoundingClientRect(),n=this.menu.elements.container.getDimensions(),i=this.menu.elements.container.getOffsets();if(this.menu.elements.container.setStyle("bottom","auto"),this.menu.elements.container.setStyle("right","auto"),e.top<0&&this.menu.elements.container.setStyle("top","5px"),n.outerHeight+i.y>(window.innerHeight||document.documentElement.clientHeight)&&(this.menu.elements.container.setStyle("top","auto"),this.menu.elements.container.setStyle("bottom","5px")),"left"===t)e.left;else n.outerWidth+i.x>(window.innerWidth||document.documentElement.clientWidth)&&(this.menu.elements.container.setStyle("left","auto"),this.menu.elements.container.setStyle("right","5px"))}},_updatePosition:function(t,e){this._nativeUpdatePosition(t,e),this._onUpdatePositionCB&&this._onUpdatePositionCB(this.menu)},_loadSVG:function(t,n){return new e((function(e){require([t],(function(t){n(t),e(t)}))}))},setCallback:function(t){this.menu.events.onClick=t},show:function(){this.menu.show(),this.checkProportions()},hide:function(){this.menu.hide()},toggle:function(){this.menu.toggle(),this.checkProportions()},getHTMLElement:function(){return this.menu.getContent()},remove:function(){if(null!==this.menu&&null!==this.menu.body&&window.removeEventListener("resize",this._onWindowResize),this.menu.menus)for(let t=0;t<this.menu.menus.length;t++)this.menu.menus[t].remove();this.menu.remove()},onHide:function(t){this.menu.addEvent("onHide",function(){t&&t(this._lastClickEvent)}.bind(this))},_onWindowResize:function(){this.menu.isVisible&&(this.menu.updatePosition(),this.checkProportions())},_debounce:function(t,e,n){var i;return function(){var o,s=arguments,a=function(){i=null,n||t.apply(this,s)}.bind(this);o=n&&!i,clearTimeout(i),i=setTimeout(a,e),o&&t.apply(this,s)}},_addClickOutsideListener:function(t=null){document.addEventListener(o.POINTERDOWN,function(e){if(this._lastClickEvent=e,this.menu.isVisible&&!this.menu.getContent().contains(e.target)&&!this._target.contains(e.target)){let n=!1;if(this.menu.menus)for(let t=0;t<this.menu.menus.length;t++)this.menu.menus[t].getContent().contains(e.target)&&(n=!0);n||(t&&t(),this.hide())}}.bind(this))}});return t.namespace("DS/CAT3DWPanoply/CAT3DWDropMenu",s)})),define("DS/CAT3DWPanoply/CAT3DWButton",["UWA/Core","UWA/Promise"],(function(t,e){"use strict";var n=t.Class.extend({init:function(e){this._callback=e.callback,this._svgLoadcallback=e.svgLoadcallback,this._name=e.name,this._container=new t.Element("div",{class:"CAT3DSKAction-container "+this._name,"data-uid_po":this._name}),e.tooltip&&this._container.setAttribute("title",e.tooltip)},loadSVG:function(t,n){return new e((function(e){require([t],(function(t){n&&n(t),e(t)}))}))},addLabel:function(e){e&&""!=e&&(this._labelContainer?this.updateLabel(e):(this._labelContainer=new t.Element("div",{class:"CAT3DSKButton-label-container",text:e}).inject(this._container,"top"),this._container.hasClassName("hasLabel")||this._container.addClassName("hasLabel")))},updateLabel:function(t){this._labelContainer?t&&""!==t&&(this._labelContainer.innerHTML=t):this.addLabel(t)},onClick:function(t){this._callback(t)},toggleON:function(){},toggleOFF:function(){},setCallback:function(t){this._callback=t},setAvailability:function(t){t?(this._container.removeClassName("non-available"),this._container.hasClassName("available")||this._container.addClassName("available")):(this._container.removeClassName("available"),this._container.hasClassName("non-available")||this._container.addClassName("non-available"))},getAvailability:function(){return!!this._container.hasClassName("available")},getHTMLElement:function(){return this._container}});return t.namespace("DS/CAT3DWPanoply/CAT3DWButton",n)})),define("DS/CAT3DWPanoply/CAT3DWActionHelp",["UWA/Core","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/CAT3DWInfraUI/CAT3DWPointerEvents","DS/UIKIT/Alert","DS/UIKIT/SuperModal","i18n!DS/CAT3DWPanoply/assets/nls/CAT3DWActionHelp"],(function(t,e,n,i,o,s){"use strict";var a=t.Class.extend({init:function(e){this._banner=new t.Element("div",{class:"CAT3DWHelp-banner "+e.name}),this._icon=e.icon,this._cmd=e.cmd,this._key=null,this._alert=null,this._message=null,this._tip=null,this._title=null,this._text1=null,this._text2=null,this._gif=null,this._superModal=null,this._viewContainer=null,this._hasBeenClosed={}},show:function(){if(this._message&&!this._alert&&e.getPreferenceValue("help")&&!this._hasBeenClosed[this._key]){this._alert=new i({visible:!0,fullWidth:!1,autoHide:!1,closable:!0,closeOnClick:!1,maximumVisibleMessages:1,events:{onRemoveMessage:function(){this._onRemoveMessage()}.bind(this)}}).inject(this._banner),(this._tip||this._text1||this._text2||this._gif)&&(this._superModal=new o({className:"CAT3DWHelp-modal"}));var t="",a="";this._superModal&&(t='<span class="more-text">'+s.get("moreLabel")+"</span>",a="has-modal");var l='<span class="title">'+this._title+"</span>"+'<span class="divider"></span><span class="message">'+this._message+t+"</span>";l+=t,this._alert.add({className:"alert-help",message:'<div class="message-container '+a+'">'+l+"</div>"}),this._superModal&&this._alert.getContent().addEvent(n.POINTERHIT,function(t){this._openModal(t)}.bind(this));var h=this._cmd.getView(),c=this._cmd.getPanoply();h?this._viewContainer=h.getViewContainer():c&&(this._viewContainer=c.getViewContainer()),this._viewContainer&&this._viewContainer.addClassName("has-help")}},hide:function(){this._alert&&(this._viewContainer&&(this._viewContainer.removeClassName("has-help"),this._viewContainer=null),this._alert.destroy(),this._alert=null,this._superModal&&this._superModal.destroy(),this._superModal=null)},isVisible:function(){return!!this._alert},reset:function(){this._hasBeenClosed={}},_openModal:function(t){if(this._superModal&&!t.target.classList.contains("close")){var e="";e+='<div class="helpmodal-textcontent">',this._message&&(e+='<div class="helpmodal-message">'+this._message+"</div>"),this._text1&&(e+='<div class="helpmodal-text1">'+this._text1+"</div>"),this._text2&&(e+='<div class="helpmodal-text2">'+this._text2+"</div>"),e+="</div>",e+='<div class="helpmodal-mediacontent">',this._gif&&(e+=this._gif.outerHTML),e+="</div>",e+='<div class="helpmodal-textcontent">',this._tip&&(e+='<div class="helpmodal-tip"><u>'+s.get("tipLabel")+":</u> "+this._tip+"</div>"),e+="</div>",this._superModal.dialog({body:e,title:this._title,buttons:[{className:"primary",value:s.get("modal.labelButton"),action:function(t){t.hide()}}]})}},_onRemoveMessage:function(){this._hasBeenClosed[this._key]=!0,this._viewContainer.removeClassName("has-help"),this._viewContainer=null},setHelp:function(t){this._key=t.key,this._message=t.message,this._tip=t.tip,this._title=t.title?t.title:s.get("defaultTitle"),this._text1=t.text1,this._text2=t.text2,this._gif=null,t.gif&&(this._gif=new Image,this._gif.onerror=function(t){console.error("Failed to load gif")},this._gif.src=t.gif,this._gif.className="helpmodal-gif",this._gif.alt=this._title)},getHTMLElement:function(){return this._banner}});return t.namespace("DS/CAT3DWPanoply/CAT3DWActionHelp",a)})),define("DS/CAT3DWPanoply/CAT3DWView",["UWA/Core","DS/ApplicationFrame/FrameWindowsManager"],(function(t,e){"use strict";var n=t.Class.extend({init:function(n){this._frmWindow=e.getFrameWindow(),this._webGLV6Viewer=this._frmWindow.getViewer(),this._viewpoint=this._frmWindow.getViewpoint(),this._uiFrame=this._frmWindow.getUIFrame(),this._buttonsArray=[],this._ViewContainer=new t.Element("div",{class:"CAT3DSKPanoplyViewContainer"}),n&&n.id&&this._ViewContainer.addClassName(n.id),this._OptionsLContainer=new t.Element("div",{class:"CAT3DSKPanoplyView-OptionsLeftContainer"}).inject(this._ViewContainer),this._ActionsContainer=new t.Element("div",{class:"CAT3DSKPanoplyView-ActionsContainer"}).inject(this._ViewContainer),this._OptionsMContainer=new t.Element("div",{class:"CAT3DSKPanoplyView-OptionsMiddleContainer",styles:{display:"none"}}).inject(this._ViewContainer),this._OptionsRContainer=new t.Element("div",{class:"CAT3DSKPanoplyView-OptionsRightContainer"}).inject(this._ViewContainer),this._HelpContainer=new t.Element("div",{class:"CAT3DWView-HelpContainer"}).inject(this._ViewContainer),this._SelectionMenuContainer=new t.Element("div",{class:"CAT3DWView-SelectionMenuContainer"}).inject(this._ViewContainer),this._MultiSelectionMenuContainer=new t.Element("div",{class:"CAT3DWView-SelectionMenuContainer",id:"CAT3DWView-MultiSelectionMenuContainer"}).inject(this._ViewContainer),n&&n.mobileActionContainer&&(this._MobileActionsContainer=new t.Element("div",{class:"CAT3DSKPanoplyView-MobileActionsContainer"}).inject(this._ViewContainer))},setHand:function(t){t&&!this._ActionsContainer.hasClassName("left-hand")?this._ViewContainer.addClassName("left-hand"):this._ViewContainer.removeClassName("left-hand")},update:function(){},show:function(){this._ViewContainer.inject(this._uiFrame,"top")},hide:function(){this._ViewContainer.remove()},getViewContainer:function(){return this._ViewContainer},getActionsContainer:function(){return this._ActionsContainer},getMobileActionsContainer:function(){return this._MobileActionsContainer},getSelectionMenuContainer:function(){return this._SelectionMenuContainer},getMultiSelectionMenuContainer:function(){return this._MultiSelectionMenuContainer},getOptionsLContainer:function(){return this._OptionsLContainer},getOptionsMContainer:function(){return this._OptionsMContainer},getOptionsRContainer:function(){return this._OptionsRContainer},getHelpContainer:function(){return this._HelpContainer},isLeftPanelEnabled:function(){return!0}});return t.namespace("DS/CAT3DWPanoply/CAT3DWView",n)})),define("DS/CAT3DWPanoply/CAT3DWActionButton",["DS/CAT3DWPanoply/CAT3DWButton","UWA/Core","DS/CAT3DWInfraUI/CAT3DWPointerEvents","DS/CAT3DWInfra/CAT3DWFileServices","DS/CAT3DWInfra/CAT3DWPreferenceManager"],(function(t,e,n,i,o){"use strict";var s=t.extend({init:function(t){(this._parent(t),this._icon=t.icon,this._needCheck=t.needCheck,this._button=new e.Element("div",{class:"CAT3DSKButton-container"}).inject(this.getHTMLElement()),o.getPreferenceValue("AppleVisionPro")?this._button.addEvent(n.POINTERDOWN,this.onClick.bind(this,this._name)):this._button.addEvent(n.POINTERHIT,this.onClick.bind(this,this._name)),t.tooltip&&(this.getHTMLElement().removeAttribute("title"),this._button.setAttribute("title",t.tooltip)),this._iconContainer=new e.Element("span",{class:"CAT3DSKButton-icon"}).inject(this._button),this._icon.indexOf(".")>-1)?"png"===(new i).extractExtensionFromName(this._icon)?(this._iconContainer.style.backgroundImage="url("+this._icon+")",this._iconContainer.style.backgroundRepeat="no-repeat",this._iconContainer.style.backgroundSize="contain",this._iconContainer.style.height="70%",this._iconContainer.style.width="70%"):this.loadSVG(this._icon,function(t){this._button.innerHTML=t}.bind(this)):this._iconContainer.addClassName(this._icon);this._needCheck||this.activate(),this.setAvailability(!0)},onClick:function(t,e){e.preventDefault&&e.preventDefault(),this._activated&&(e.buttonType="CAT3DWActionButton",this._parent(e))},addLabel:function(t){if(t&&""!==t)if(this._labelContainer)this.updateLabel(t);else{var n=this.getHTMLElement();this._labelContainer=new e.Element("div",{class:"CAT3DSKButton-label-container",text:t}).inject(n,"top"),n.hasClassName("hasLabel")||n.addClassName("hasLabel")}},updateLabel:function(t){this._labelContainer?t&&""!==t&&(this._labelContainer.innerHTML=t):this.addLabel(t)},removeLabel:function(){this.getHTMLElement().removeClassName("hasLabel"),this._labelContainer&&this._labelContainer.destroy()},activate:function(){this._button.hasClassName("cmd-activate")||this._button.addClassName("cmd-activate"),this._activated=!0},deactivate:function(){this._button.removeClassName("cmd-activate"),this._activated=!1},setIcon:function(t){t.indexOf(".")>-1?this.loadSVG(t,function(t){this._button.innerHTML=t}.bind(this)):(this._iconContainer.removeClassName(this._icon),this._iconContainer.addClassName(t),this._icon=t)},getButtonElement:function(){return this._button}});return e.namespace("DS/CAT3DWPanoply/CAT3DWActionButton",s)})),define("DS/CAT3DWPanoply/CAT3DWActionView",["UWA/Core","DS/CAT3DWPanoply/CAT3DWView","DS/CAT3DWPanoply/CAT3DWActionButton","i18n!DS/CAT3DWInfra/assets/nls/CAT3DWTooltip"],(function(t,e,n,i){"use strict";var o=e.extend({init:function(e){this._parent({id:"CAT3DWActionView"}),this._id=e.id,this._validateCallback=e.onValidate,this._cancelCallback=e.onCancel;var o=e.help;this._isLeftPanelEnabled=!1,this._isRightPanelEnabled=!1,this._fallbackPanoply=null,e.fallbackPanoply&&(this._fallbackPanoply=e.fallbackPanoply),this._cancelButton=new n({name:"CAT3DWActionView-cancelButton "+this._id,icon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong",callback:this._cancelCallback,tooltip:i.get("cancelActionButton")}),this._cancelButton.getHTMLElement().inject(this._OptionsRContainer),this._subActionsContainer=new t.Element("div",{class:"CAT3DWActionView-subActionsContainer"}).inject(this._ActionsContainer),this._validateButton=new n({name:"CAT3DWActionView-validateButton "+this._id,icon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check",callback:this._validateCallback,tooltip:i.get("validateActionButton")}),this._validateButton.getHTMLElement().inject(this._OptionsRContainer),o&&(o.getHTMLElement().inject(this._HelpContainer),this.getHelpContainer().classList.add("WB-MOB-adjustSizePosition-help-currentPanoply")),this._OptionsRContainer.setStyles({top:"50%",transform:"translateY(-50%)"}),this.hide()},setRightOptions:function(t){this._OptionsRContainer.empty();for(var e=0;e<t.length;e++)t[e].button.getHTMLElement().inject(this._OptionsRContainer);this._cancelButton.getHTMLElement().inject(this._OptionsRContainer),this._validateButton.getHTMLElement().inject(this._OptionsRContainer)},setLeftOptions:function(t){this._OptionsLContainer.empty();for(var e=0;e<t.length;e++)t[e].button.getHTMLElement().inject(this._OptionsLContainer)},setMiddleOptions:function(t){this._OptionsMContainer.empty();for(var e=0;e<t.length;e++)t[e].button.getHTMLElement().inject(this._OptionsMContainer)},setActions:function(t){this._subActionsContainer.empty();for(var e=0;e<t.length;e++)t[e].inject(this._subActionsContainer)},isLeftPanelEnabled:function(){return this._isLeftPanelEnabled},isRightPanelEnabled:function(){return this._isRightPanelEnabled},getFallbackPanoply:function(){return this._fallbackPanoply}});return t.namespace("DS/CAT3DWPanoply/CAT3DWActionView",o)})),define("DS/CAT3DWPanoply/CAT3DWActionToggleButton",["DS/CAT3DWPanoply/CAT3DWActionButton","UWA/Core"],(function(t,e){"use strict";var n=t.extend({init:function(t){this._parent(t),t.isOn?this.toggleON():this.toggleOFF()},toggleON:function(){this._parent(),this.getHTMLElement().addClassName("active")||this.getHTMLElement().addClassName("active"),this._isOn=!0},toggleOFF:function(){this._parent(),this.getHTMLElement().removeClassName("active"),this._isOn=!1},isOn:function(){return this._isOn}});return e.namespace("DS/CAT3DWPanoply/CAT3DWActionToggleButton",n)})),define("DS/CAT3DWPanoply/CAT3DWActionSubButton",["DS/CAT3DWPanoply/CAT3DWButton","UWA/Core","DS/CAT3DWInfraUI/CAT3DWPointerEvents","UWA/Class"],(function(t,e,n,i){"use strict";var o=i.extend({init:function(t){this._callback=t.callback,this._pointerOutCallback=null,this._pointerOverCallback=null,this._name=t.name,this._icon=t.icon,this._needCheck=t.needCheck,this._availability=!0,this._button=new e.Element("li",{class:"item CAT3DWActionSubButton-container",id:this._name,"data-uid_po":t.name}),this._button.addEvent(n.POINTERHIT,(t=>{this.onClick(t)})),this._button.addEvent("pointerover",function(t){this.onPointerHover(t)}.bind(this)),this._button.addEvent("pointerout",(t=>{this.onPointerOut(t)})),t.tooltip&&(this.getHTMLElement().removeAttribute("title"),this._button.setAttribute("title",t.tooltip)),this.setIcon(this._icon),this._textContainer=new e.Element("span",{class:"item-text",text:this._name}).inject(this._button),this._needCheck||this.activate(),this.setAvailability(!0),this._parent(t)},loadSVG:function(t,e){require([t],(function(t){e&&e(t)}))},onPointerOut:function(t){t.preventDefault&&t.preventDefault(),this._activated&&this._pointerOutCallback&&this._pointerOutCallback(this._name,t)},onPointerHover:function(t){t.preventDefault&&t.preventDefault(),this._activated&&this._pointerOverCallback&&this._pointerOverCallback(this._name,t)},onClick:function(t){t.preventDefault&&t.preventDefault(),this._activated&&this._callback&&this._callback(this._name,t)},activate:function(){this._button.removeClassName("cmd-activate"),this._button.removeClassName("disabled"),this._button.addClassName("cmd-activate"),this._activated=!0},deactivate:function(){this._button.removeClassName("cmd-activate"),this._button.removeClassName("disabled"),this._button.addClassName("disabled"),this._activated=!1},setCallback:function(t){this._callback=t},setPointerOverCallback:function(t){this._pointerOverCallback=t},setPointerOutCallback:function(t){this._pointerOutCallback=t},setAvailability:function(t){this._availability=t,t?this._button.setStyle("display","flex"):this._button.setStyle("display","none")},getAvailability:function(){return this._availability},setText:function(t){this._textContainer.setText(t)},setIcon:function(t){this._iconContainer&&(this._iconContainer.destroy(),this._iconContainer=null),this._icon=t,this._icon.indexOf(".")>-1?(this._iconContainer=new e.Element("div",{class:"icon",styles:{width:"24px",height:"24px",margin:"0px 14px"}}).inject(this._button,"top"),this.loadSVG(this._icon,function(t){this._iconContainer.innerHTML=t}.bind(this))):(this._iconContainer=new e.Element("span",{class:"fonticon"}).inject(this._button,"top"),this._iconContainer.addClassName(this._icon))},getHTMLElement:function(){return this._button}});return e.namespace("DS/CAT3DWPanoply/CAT3DWActionSubButton",o)})),define("DS/CAT3DWPanoply/CAT3DWActionToggleSubButton",["DS/CAT3DWPanoply/CAT3DWActionSubButton","UWA/Core"],(function(t,e){"use strict";var n=t.extend({init:function(t){this._parent(t),this._button.addClassName("selectable"),this._isOn=!1},toggleON:function(){this._parent(),this.getHTMLElement().hasClassName("selected")||this.getHTMLElement().addClassName("selected"),this._isOn=!0},toggleOFF:function(){this._parent(),this.getHTMLElement().removeClassName("selected"),this._isOn=!1},isOn:function(){return this._isOn}});return e.namespace("DS/CAT3DWPanoply/CAT3DWActionToggleSubButton",n)})),define("DS/CAT3DWPanoply/CAT3DWPanoplyView",["UWA/Core","DS/ApplicationFrame/CommandsManager","DS/CAT3DWInfra/CAT3DWLogger","DS/CAT3DWPanoply/CAT3DWDropMenu","DS/CAT3DWPanoply/CAT3DWView","DS/CAT3DWVisu/CAT3DWVisuEvents","DS/CoreEvents/Events","UWA/Promise","i18n!DS/CAT3DWInfra/assets/nls/CAT3DWTooltip"],(function(t,e,n,i,o,s,a,l,h){"use strict";var c=o.extend({init:function(t,e){this._parent(t),this._content=t,this._id=t.id,this._ViewContainer.addClassName(this._id),this._icon=t.icon,this._panoplyManager=e,this._controlSettings=this._panoplyManager.getControlSettings(),this._actions=[],this._actionsObject={},this._moreCommandsMenu=null,this._moreCommandsMenuButton=null,this._optionsL=[],this._optionsR=[],this._optionsM=[],this._helpBarCommands=[],this._selectionMenu=[],this._multiSelectionMenu=[],this._defaultCmd=t.command,this._settingsCmd=t.settings,this._settings=t,this._frame3DOptions=t.frame3DOptions,this._onReadyCallbacks=[],this._isReady=!1,this._onScreenOrientationChange=null,this._onResize=null,this._contextualMenu=null,this._contextualMenuPosition=null,this.noContextMenu=t.noContextMenu,this._subContextualMenu=null,this._subContextualMenuPosition=null,this._eventsService=new s,this.noContextMenu=t.noContextMenu},initialize:function(){this._setUpCommands(this._settings).then(function(){for(this.hide(),this._isReady=!0;this._onReadyCallbacks.length;){this._onReadyCallbacks.pop()()}}.bind(this)).catch((function(t){n.error(t)}))},onReady:function(t){this._onReadyCallbacks.push(t)},_getJSONData:function(t,e){var n={};for(var i in t)Object.hasOwn(t,i)&&0===i.indexOf(e)&&(n[i]=t[i]);return n},_setUpCommands:function(t){var e,i,o=[];if(this._defaultCmd&&o.push(this._processCommand({command:this._defaultCmd})),this._settingsCmd&&o.push(this._processCommand({command:t.settings})),t.helpBarCommands&&t.helpBarCommands.length)for(this._helpBarCommands=t.helpBarCommands,e=0;e<t.helpBarCommands.length;e++)i=t.helpBarCommands[e],o.push(this._processCommand(i));if(t["options-left"]&&t["options-left"].length)for(this._optionsL=t["options-left"],e=0;e<t["options-left"].length;e++)i=t["options-left"][e],o.push(this._processCommand(i));if(t["options-middle"]&&t["options-middle"].length)for(this._optionsM=t["options-middle"],e=0;e<t["options-middle"].length;e++)i=t["options-middle"][e],o.push(this._processCommand(i));if(t.actions&&t.actions.length)for(this._actions=t.actions,e=0;e<t.actions.length;e++){var s=t.actions[e];this._actionsObject[s.command]=s,o.push(this._processCommand(s)),s.settings&&o.push(this._processCommand({command:s.settings}))}if(t["options-right"]&&t["options-right"].length)for(this._optionsR=t["options-right"],e=0;e<t["options-right"].length;e++)i=t["options-right"][e],o.push(this._processCommand(i));if(t["selection-menu"]&&t["selection-menu"].length)for(this._selectionMenu=t["selection-menu"],e=0;e<t["selection-menu"].length;e++)i=t["selection-menu"][e],o.push(this._processCommand(i));if(t["multi-selection-menu"]&&t["multi-selection-menu"].length)for(this._multiSelectionMenu=t["multi-selection-menu"],e=0;e<t["multi-selection-menu"].length;e++)i=t["multi-selection-menu"][e],o.push(this._processCommand(i));return Promise.all(o).catch((function(t){n.error(t)}))},_processCommand:function(t){return new l(function(n){var i=e.getCommand(t.command),o=this._getJSONData(this._panoplyManager.nls,t.command),s=function(n,i){if(i&&i.isLoadingAllowed()){if(n.icon&&i.setIcon(n.icon),o&&i.setNls(o),t.subMenu&&t.subMenu.length&&i.addSubMenuIconToContextButton(),t.settings){var s=e.getCommand(n.settings);i.setSettingsCmd(s)}i.subscribeEvents&&!i.isSubscribed()&&i.subscribeEvents(),i.setPanoply(this)}}.bind(this,t);if(i)s(i),n();else var l=a.subscribe({event:"onSketchReady"},function(t){a.unsubscribe(l);var i=e.getCommand(t.command);s(i),n()}.bind(this,t))}.bind(this))},unload:function(){for(let t=0;t<this._actions.length;t++){e.getCommand(this._actions[t].command).unsubscribeEvents()}const t=this.getSelectionMenuContainer();for(;t.lastChild;)t.lastChild.remove();const n=this.getMultiSelectionMenuContainer();for(;n.lastChild;)n.lastChild.remove();if(this._defaultCmd){e.getCommand(this._defaultCmd).unsubscribeEvents()}this.hide()},getPanoplyManager:function(){return this._panoplyManager},getID:function(){return this._id},getIcon:function(){return this._icon},getContent:function(){return this._content},getMoreMenuButton:function(){return this._moreCommandsMenuButton},showAllActions:function(){for(var t=0;t<this._actions.length;t++)if(this._actions[t].command&&this._actionsObject[this._actions[t].command]){e.getCommand(this._actions[t].command).setAvailability(!0)}},hideAllActions:function(){for(var t=0;t<this._actions.length;t++)if(this._actions[t].command&&this._actionsObject[this._actions[t].command]){e.getCommand(this._actions[t].command).setAvailability(!1)}},_onCmdAvailabilityChange:function(t){var n=e.getCommand(t);n&&this._actionsObject[t]&&(this._checkActionsContainerSize(45)?this._actionsObject[t].irreducible?this._reduceActionsContainerByOneIfPossible():n.setSubButtonAvailable():n.setButtonAvailable())},_reduceActionsContainerByOneIfPossible:function(){for(var t=0;t<this._actions.length;t++)if(this._actions[t].command&&this._actionsObject[this._actions[t].command]&&!this._actionsObject[this._actions[t].command].irreducible)return void this._reduceAction(this._actions[t].command)},_reduceActionsContainerAsMuchAsPossible:function(){if(this._checkActionsContainerSize())for(var t=0;t<this._actions.length;t++)if(this._actions[t].command&&!this._actionsObject[this._actions[t].command].irreducible){if(!this._checkActionsContainerSize())return;this._reduceAction(this._actions[t].command)}},_reduceActionsInDropDownAsMuchAsPossible:function(){if(!this._checkActionsContainerSize(45))for(var t=0;t<this._actions.length;t++)if(this._actions[t].command&&!this._actionsObject[this._actions[t].command].irreducible){if(this._checkActionsContainerSize(45))return;this._extendAction(this._actions[t].command)}},_checkActionsContainerSize:function(t){var e=0;return t&&(e=t),this.getActionsContainer().offsetHeight+e>=window.innerHeight-84},_reduceAction:function(t){var n=e.getCommand(t);n.isButtonAvailable()&&n.setSubButtonAvailable()},_extendAction:function(t){var n=e.getCommand(t);n.isSubButtonAvailable()&&n.setButtonAvailable()},setHand:function(t){this._parent(t),this._moreCommandsMenu&&(this._moreCommandsMenu.menu.options.offset.x=t?55:-55,this._moreCommandsMenu.menu.updatePosition());for(let n=0;n<this._actions.length;n++){e.getCommand(this._actions[n].command).setHand(t)}"AddMedia"===this.getID()&&(e.getCommand("AddMediaCmd").setHand(t),a.publish({event:"MediaPanelHandPositionChangeScenario",data:{isLefthand:t}}))},start:function(n){var o=function(){if(this._moreCommandsMenu&&(this._moreCommandsMenu.remove(),this._moreCommandsMenu=null),this._moreCommandsMenuButton&&(this._moreCommandsMenuButton.getHTMLElement().destroy(),this._moreCommandsMenuButton=null),this._frame3DOptions&&"object"==typeof this._frame3DOptions)for(var o in this._frame3DOptions)"profile"===o&&this._controlSettings&&this._frame3DOptions[o]&&this._controlSettings.applyProfile(this._frame3DOptions[o].toUpperCase(),this._frame3DOptions.forceRotation);var s,l,h,c;if(this._clearContextualMenu(),this.show(),this._settingsCmd){let t=e.getCommand(this._settingsCmd);t&&t.onPanoplyStart&&t.onPanoplyStart()}if(this._defaultCmd){let t=e.getCommand(this._defaultCmd);(c=t.getHelp())&&!t.getView()&&c.getHTMLElement().inject(this.getHelpContainer()),e.setDefaultCommand({ID:this._defaultCmd})}for(s=0;s<this._helpBarCommands.length;s++){l=this._helpBarCommands[s];let t=e.getCommand(l.command);t&&((h=t.getButton())&&h.getHTMLElement().inject(this.getHelpContainer().querySelector("."+this._defaultCmd)),t.onPanoplyStart())}for(s=0;s<this._optionsL.length;s++){l=this._optionsL[s];let t=e.getCommand(l.command);t&&((h=t.getButton())&&h.getHTMLElement().inject(this.getOptionsLContainer()),(c=t.getHelp())&&!t.getView()&&c.getHTMLElement().inject(this.getHelpContainer()),t.onPanoplyStart())}for(s=0;s<this._optionsM.length;s++){l=this._optionsM[s];let t=e.getCommand(l.command);t&&t.getAvailability()&&((h=t.getButton())&&(this.getOptionsMContainer().style.display="flex",h.getHTMLElement().inject(this.getOptionsMContainer())),(c=t.getHelp())&&!t.getView()&&c.getHTMLElement().inject(this.getHelpContainer()),t.onPanoplyStart())}var r=[],u=null,d=function(n){let i=e.getCommand(n.command);i&&(u||(u=new t.Element("ul",{class:"CAT3DWView-MoreMenu dropdown-menu-wrap dropdown-menu-icons"})),i.getSubButton().getHTMLElement().inject(u))};for(s=0;s<this._actions.length;s++){var p=this._actions[s];let t=e.getCommand(p.command);t&&(p.irreducible||(d(p),r.push(p)),(h=t.getButton())&&h.getHTMLElement().inject(this.getActionsContainer()),this._onCmdAvailabilityChange(p.command),this.getMobileActionsContainer()&&t.getSubButton()&&t.getSubButton().getHTMLElement().inject(this.getMobileActionsContainer()),(c=t.getHelp())&&!t.getView()&&c.getHTMLElement().inject(this.getHelpContainer()),t.onPanoplyStart())}if(n&&n.moreCommands&&n.moreCommands.length)for(s=0;s<n.moreCommands.length;s++){let t=e.getCommand(n.moreCommands[s].command);t&&(d(n.moreCommands[s]),(c=t.getHelp())&&!t.getView()&&c.getHTMLElement().inject(this.getHelpContainer()),t.onPanoplyStart())}var m=null;let _=!1;if(!this.noContextMenu&&n&&n.contextualCommands&&n.contextualCommands.length)for(s=0;s<n.contextualCommands.length;s++)if(n.contextualCommands[s].subMenu&&n.contextualCommands[s].subMenu.length){_=!0;break}if(!this.noContextMenu&&n&&n.contextualCommands&&n.contextualCommands.length)for(s=0;s<n.contextualCommands.length;s++){let i=e.getCommand(n.contextualCommands[s].command);if(!i)continue;let o=n.contextualCommands[s].subMenu&&n.contextualCommands[s].subMenu.length;if(o){let t=n.contextualCommands[s].subMenu;if("ontouchstart"in window||navigator.msMaxTouchPoints>0)i.getContextButton().setCallback(((...e)=>{this.createSubContextualMenu(...e,t)})),i.getContextButton().setPointerOverCallback(null);else{i.getContextButton().setCallback(((...t)=>{this._subContextualMenu.show(),this._subContextualMenu.menu.elements.container.setStyle("top",this._subContextualMenuPosition.y),this._subContextualMenu.menu.elements.container.setStyle("left",this._subContextualMenuPosition.x)}));let e=(...n)=>{this.createSubContextualMenu(...n,t);let o=t=>{!1===i.getContextButton().getHTMLElement().contains(t.target)&&!1===this._subContextualMenu.menu.elements.container.contains(t.target)&&(this._subContextualMenu.hide(),document.removeEventListener("pointermove",o),i.getContextButton().setPointerOverCallback(e))};document.addEventListener("pointermove",o),i.getContextButton().setPointerOverCallback(null)};i.getContextButton().setPointerOverCallback(e)}}m||(m=new t.Element("ul",{class:"dropdown-menu-wrap dropdown-menu-icons"})),i.getContextButton().getHTMLElement().inject(m),!o&&_&&i.getContextButton().setCallback(((...t)=>{this._contextualMenu.hide(),i.begin()})),(c=i.getHelp())&&!i.getView()&&c.getHTMLElement().inject(this.getHelpContainer()),i.onPanoplyStart()}for(m&&(this._contextualMenu=new i({target:new t.Element("div",{}),renderTo:this._panoplyManager._frmWindow.getUIFrame(),body:m,closeOnClick:!_}),this._contextualMenu.menu.elements.container.addClassName("CAT3DWView-contextualMenu"),this._contextualMenu.menu.elements.container.addClassName("dropdown-menu"),this._contextualMenu.menu.elements.container.addClassName("dropdown-menu-root"),this._contextualMenu.menu.elements.container.setStyle({"overflow-x":"hidden","overflow-y":"auto"}),this._contextMenuCB=function(t){setTimeout(function(){if(this._contextualMenu.show(),this._subContextualMenu&&this._subContextualMenu.hide(),this._contextualMenuPosition={x:null,y:null},t.position?(this._contextualMenuPosition.x=t.position.x,this._contextualMenuPosition.y=t.position.y):(this._contextualMenuPosition.x=t.clientX,this._contextualMenuPosition.y=t.clientY),this._contextualMenu.menu.elements.container.setStyle("top",this._contextualMenuPosition.y),this._contextualMenu.menu.elements.container.setStyle("left",this._contextualMenuPosition.x),n&&n.contextualCommands&&n.contextualCommands.length)for(s=0;s<n.contextualCommands.length;s++){let t=e.getCommand(n.contextualCommands[s].command);t&&t.onShowContextMenu&&t.onShowContextMenu(this._contextualMenuPosition)}this._contextualMenu.checkProportions()}.bind(this),100)}.bind(this),this._onRightClickEventToken=a.subscribe({event:this._eventsService.getRightClickEvent()},this._contextMenuCB),this._onLongHoldEventToken=a.subscribe({event:this._eventsService.getLongHoldEvent()},function(t){t.isTouch&&"Diagram"!==this.getID()&&this._contextMenuCB(t)}.bind(this))),s=0;s<this._optionsR.length;s++){l=this._optionsR[s];let t=e.getCommand(l.command);t&&((h=t.getButton())&&h.getHTMLElement().inject(this.getOptionsRContainer()),(c=t.getHelp())&&!t.getView()&&c.getHTMLElement().inject(this.getHelpContainer()),t.onPanoplyStart())}var C=null;function g(t,n,i){for(s=0;s<t.length;s++){l=t[s];let o=e.getCommand(l.command);o&&o.isLoadingAllowed()&&((h=o.getButton())&&(C=h.getHTMLElement())&&!C.getParent()&&C.inject(n),(c=o.getHelp())&&!o.getView()&&(C=c.getHTMLElement())&&!C.getParent()&&C.inject(i),o.onPanoplyStart())}}const b=this.getSelectionMenuContainer(),f=this.getHelpContainer();g(this._selectionMenu,b,f);const y=this.getMultiSelectionMenuContainer();g(this._multiSelectionMenu,y,f);var v=function(){this._reduceActionsContainerAsMuchAsPossible(),this._reduceActionsInDropDownAsMuchAsPossible()}.bind(this);this._onResize=v,window.addEventListener("resize",v),n&&n.callback&&n.callback()}.bind(this);this._isReady?o():this.onReady(o)},createSubContextualMenu:function(n,o,s){let a=[];for(let t=0;t<s.length;t++){let i=s[t],o=h.get(i.tooltipNlsId),l=this._panoplyManager.nls.get(i.labelNlsId),c=n+"."+l,r=i.icon||"";a.push({id:c,tooltip:o,text:l,icon:r,selectable:!1,handler:function(){e.getCommand(n).onSubContextMenuOptionsSelected({indexSelected:t})}})}this._clearSubContextualMenu(),this._subContextualMenu=new i({target:new t.Element("div",{}),renderTo:this._panoplyManager._frmWindow.getUIFrame(),items:a}),this._subContextualMenu.menu.elements.container.addClassName("CAT3DWView-contextualMenu"),this._subContextualMenu.menu.elements.container.addClassName("dropdown-menu"),this._subContextualMenu.menu.elements.container.addClassName("dropdown-menu-root"),this._subContextualMenu.menu.elements.container.setStyle({"overflow-x":"hidden","overflow-y":"auto"}),this._subContextualMenu.show();let{top:l,left:c}=this._panoplyManager._frmWindow.getViewer().canvas.getBoundingClientRect(),r=o.currentTarget,u=getComputedStyle(r),d=parseFloat(u.paddingTop),p=parseFloat(u.paddingLeft),{top:m,left:_,width:C}=r.getBoundingClientRect(),g=m-d-l,b=_+C-p-c+2;this._subContextualMenuPosition={x:b,y:g},this._subContextualMenu.menu.elements.container.setStyle("top",g),this._subContextualMenu.menu.elements.container.setStyle("left",b),this._subContextualMenu.checkProportions()},stop:function(){this._moreCommandsMenu&&(this._moreCommandsMenu.remove(),this._moreCommandsMenu=null),this._moreCommandsMenuButton&&(this._moreCommandsMenuButton.getHTMLElement().destroy(),this._moreCommandsMenuButton=null),this._onResize&&(window.removeEventListener("resize",this._onResize),this._onResize=null),this._clearContextualMenu(),e.resetDefaultCommand(),this.hide()},_clearContextualMenu:function(){this._contextualMenu&&(this._contextualMenu.remove(),this._contextualMenu=null,this._contextualMenuPosition=null),this._clearSubContextualMenu(),this._contextMenuCB=null,a.unsubscribe(this._onRightClickEventToken),a.unsubscribe(this._onLongHoldEventToken)},_clearSubContextualMenu:function(){this._subContextualMenu&&(this._subContextualMenu.remove(),this._subContextualMenu=null,this._subContextualMenuPosition=null)}});return t.namespace("DS/CAT3DWPanoply/CAT3DWPanoplyView",c)})),define("DS/CAT3DWPanoply/CAT3DWPanoplyManager",["UWA/Core","DS/CAT3DWPanoply/CAT3DWPanoplyView","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/CoreEvents/Events","DS/ApplicationFrame/CommandsManager","DS/ApplicationFrame/FrameWindowsManager","UWA/Promise","css!DS/CAT3DWPanoply/CAT3DWPanoply"],(function(t,e,n,i,o,s,a){"use strict";var l=t.Class.extend({init:function(t){this._panoplyArray=[],this._panoplyObject={},this._panoplyInfosArray=[],this._panoplyDrawInfosArray=[],this._onPanoplyStartTokens=[],this._currentPanoply=null,this._defaultPanoply=null,this._globalPanoply=null,this._moreCommands=[],this._contextualCommands=[],this._panoplyShortcuts={},this._panoplyDrawingShortcuts={},this._onReady=[],this._frmWindow=s.getFrameWindow(),this._uiFrame=this._frmWindow.getUIFrame(),t.nls&&t.rsc&&(this.nls=t.nls,this.rsc=t.rsc),t.controlSettings&&(this._controlSettings=t.controlSettings),this._onWindowResizeCB=function(){this._handleStylingForMobileScreenSize(this._currentPanoply,{action:"resize"})}.bind(this),window.addEventListener("resize",this._onWindowResizeCB),this._MOBShowPanoplyBarToken=i.subscribe({event:"3DSketch.Show.Panoply.Bar.MOB"},function(){this._handleStylingForMobileScreenSize(this._currentPanoply,{action:"click-show-panoply-bar-btn"})}.bind(this)),this._MOBThingSelectedToken=i.subscribe({event:"3DSketch.thing.selected.MOB"},function(){this._handleStylingForMobileScreenSize(this._currentPanoply,{action:"selection-of-thing"})}.bind(this)),this._MOBEmptyCanvasPointerHitToken=i.subscribe({event:"3DSketch.empty.canvas.pointer.hit.MOB"},function(){this._handleStylingForMobileScreenSize(this._currentPanoply,{action:"click-on-empty-canvas"})}.bind(this)),this._MOBSelectedCompositionDeletedToken=i.subscribe({event:"3DSketch.selected.composition.deleted.MOB"},function(){this._handleStylingForMobileScreenSize(this._currentPanoply,{action:"selected-composition-deleted"})}.bind(this)),this._MOBThingSelectedLockedToken=i.subscribe({event:"3DSketch.selected.thing.locked.MOB"},function(){this._handleStylingForMobileScreenSize(this._currentPanoply,{action:"selected-thing-locked"})}.bind(this))},initialize:function(){var t=this.rsc.panoplyArray,n=this.rsc.globalPanoply;this.rsc.moreCommands&&this.rsc.moreCommands.length&&(this._moreCommands=this.rsc.moreCommands),this.rsc.contextualCommands&&this.rsc.contextualCommands.length&&(this._contextualCommands=this.rsc.contextualCommands);var s=[];for(let n=0;n<t.length;n++)if(s.push(new a(function(n,i){var o=t[n];this._panoplyArray.push(o.id),this._panoplyObject[o.id]=new e(o,this),this._panoplyObject[o.id].onReady(i),this._panoplyObject[o.id].initialize(),o.masterPanoply?"DrawingTool"===o.masterPanoply&&this._panoplyDrawInfosArray.push({id:o.id,icon:o.icon,icon_active:o.icon_active,settings:o.settings}):this._panoplyInfosArray.push({id:o.id,icon:o.icon,icon_active:o.icon_active,settings:o.settings})}.bind(this,n))),t[n].shortcut&&t[n].masterPanoply&&"DrawingTool"===t[n].masterPanoply){this._panoplyDrawingShortcuts[t[n].shortcut]=t[n].id;let e="Digit"+t[n].shortcut,i="Numpad"+t[n].shortcut;this._panoplyDrawingShortcuts[e]=t[n].id,this._panoplyDrawingShortcuts[i]=t[n].id}else{this._panoplyShortcuts[t[n].shortcut]=t[n].id;let e=t[n].shortcut;this._panoplyShortcuts[e]=t[n].id}this._onKeydownCB=this._onKeyDown.bind(this),document.addEventListener("keydown",this._onKeydownCB),n&&s.push(new a(function(t){n.id="GlobalPanoplyContainer",this._globalPanoply=new e(n,this),this._globalPanoply.onReady(t),this._globalPanoply.initialize()}.bind(this))),this._onCommandStartToken=o.onCommandStart(this._onActionBegin.bind(this)),this._onCommandResumeToken=i.subscribe({event:"/WUX/AFR/CMD//RESUME"},this._onActionBegin.bind(this)),Promise.all(s).then(function(){let t=[];var e=this._moreCommands.concat(this._contextualCommands);for(let n=0;n<e.length;n++)t.push(this._globalPanoply._processCommand(e[n]));return Promise.all(t).catch((function(t){console.error(t)}))}.bind(this)).then(function(){this._globalPanoply.start(),i.publish({event:"CAT3DWPanoplyManager/INIT"});for(var t=0;t<this._onReady.length;t++)this._onReady[t]()}.bind(this)).catch((function(t){console.error(t)}))},onManagerReady:function(t){this._onReady.push(t)},unload:function(){var t;for(window.removeEventListener("resize",this._onWindowResizeCB),i.unsubscribe(this._MOBShowPanoplyBarToken),i.unsubscribe(this._MOBThingSelectedToken),i.unsubscribe(this._MOBEmptyCanvasPointerHitToken),i.unsubscribe(this._MOBSelectedCompositionDeletedToken),i.unsubscribe(this._MOBThingSelectedLockedToken),this._temporaryView&&this._temporaryView.hide(),i.unsubscribe(this._onCommandStartToken),i.unsubscribe(this._onCommandResumeToken),document.removeEventListener("keydown",this._onKeydownCB),t=0;t<this._onPanoplyStartTokens.length;t++)i.unsubscribe(this._onPanoplyStartTokens[t]);for(this._globalPanoply&&(this._globalPanoply.unload(),this._globalPanoply=null),t=0;t<this._panoplyArray.length;t++)this._panoplyObject[this._panoplyArray[t]].unload(),this._panoplyObject[this._panoplyArray[t]]=null;this._panoplyArray=[],this._panoplyObject={},this._currentPanoply=null,this._defaultPanoply=null,this._moreCommands=[],this._contextualCommands=[],this._onReady=[]},importCSS:function(t){t.indexOf("css!")>-1&&require([t],(function(){}))},_handleStylingForMobileScreenSize:function(t,e){if(t)if("panoply-start"===e.action.toLowerCase()||"resize"===e.action.toLowerCase()||"selected-composition-deleted"===e.action.toLowerCase()){let e=0,n=t.getActionsContainer().children;for(let t of n)"none"===getComputedStyle(t).getPropertyValue("display")||t.classList.contains("non-available")||e++;"selection"!==t.getID().toLowerCase()||e?(t.getHelpContainer().classList.add("WB-MOB-adjustSizePosition-help-currentPanoply"),this._globalPanoply.getOptionsLContainer().classList.add("WB-MOB-hideLeftContainer-globalPanoply"),"settings"===t.getID().toLowerCase()?(this._globalPanoply.getActionsContainer().classList.remove("WB-MOB-hideActionsContainer-globalPanoply"),this._globalPanoply.getActionsContainer().classList.add("WB-MOB-panoplyBarLookChange-globalPanoply"),t.getActionsContainer().classList.remove("WB-MOB-showSelectionActionButtons"),t.getActionsContainer().classList.remove("WB-MOB-borders-height")):(this._globalPanoply.getActionsContainer().classList.add("WB-MOB-hideActionsContainer-globalPanoply"),this._globalPanoply.getActionsContainer().classList.remove("WB-MOB-panoplyBarLookChange-globalPanoply"),t.getActionsContainer().classList.remove("WB-MOB-showSelectionActionButtons"),0===e?t.getActionsContainer().classList.remove("WB-MOB-borders-height"):t.getActionsContainer().classList.add("WB-MOB-borders-height")),this._globalPanoply.getOptionsRContainer().classList.add("WB-MOB-hideRightContainer-globalPanoply"),this._globalPanoply.getOptionsMContainer().classList.add("WB-MOB-hideMiddleContainer-globalPanoply")):(t.getHelpContainer().classList.add("WB-MOB-adjustSizePosition-help-currentPanoply"),this._globalPanoply.getOptionsLContainer().classList.remove("WB-MOB-hideLeftContainer-globalPanoply"),this._globalPanoply.getOptionsLContainer().classList.add("WB-MOB-showPanoplyBarSettingsViewMOBCmd"),this._globalPanoply.getActionsContainer().classList.add("WB-MOB-hideActionsContainer-globalPanoply"),this._globalPanoply.getActionsContainer().classList.remove("WB-MOB-panoplyBarLookChange-globalPanoply"),t.getActionsContainer().classList.remove("WB-MOB-showSelectionActionButtons"),t.getActionsContainer().classList.remove("WB-MOB-borders-height"),this._globalPanoply.getOptionsRContainer().classList.add("WB-MOB-hideRightContainer-globalPanoply"),this._globalPanoply.getOptionsMContainer().classList.add("WB-MOB-hideMiddleContainer-globalPanoply"))}else"click-show-panoply-bar-btn"===e.action.toLowerCase()?(this._globalPanoply.getOptionsLContainer().classList.add("WB-MOB-hideLeftContainer-globalPanoply"),this._globalPanoply.getOptionsLContainer().classList.remove("WB-MOB-showPanoplyBarSettingsViewMOBCmd"),this._globalPanoply.getActionsContainer().classList.remove("WB-MOB-hideActionsContainer-globalPanoply"),this._globalPanoply.getActionsContainer().classList.add("WB-MOB-panoplyBarLookChange-globalPanoply"),t.getActionsContainer().classList.remove("WB-MOB-showSelectionActionButtons"),t.getActionsContainer().classList.remove("WB-MOB-borders-height")):"selection-of-thing"===e.action.toLowerCase()?"selection"===t.getID().toLowerCase()&&(t.getHelpContainer().classList.add("WB-MOB-adjustSizePosition-help-currentPanoply"),this._globalPanoply.getOptionsLContainer().classList.add("WB-MOB-hideLeftContainer-globalPanoply"),this._globalPanoply.getActionsContainer().classList.add("WB-MOB-hideActionsContainer-globalPanoply"),t.getActionsContainer().classList.remove("WB-MOB-showSelectionActionButtons"),t.getActionsContainer().classList.add("WB-MOB-borders-height"),this._globalPanoply.getOptionsRContainer().classList.add("WB-MOB-hideRightContainer-globalPanoply"),this._globalPanoply.getOptionsMContainer().classList.add("WB-MOB-hideMiddleContainer-globalPanoply")):"click-on-empty-canvas"!==e.action.toLowerCase()&&"selected-thing-locked"!==e.action.toLowerCase()||"selection"!==t.getID().toLowerCase()||o.getCommand("QuickTourCmd")._isStarted||(t.getHelpContainer().classList.add("WB-MOB-adjustSizePosition-help-currentPanoply"),this._globalPanoply.getOptionsLContainer().classList.remove("WB-MOB-hideLeftContainer-globalPanoply"),this._globalPanoply.getOptionsLContainer().classList.add("WB-MOB-showPanoplyBarSettingsViewMOBCmd"),this._globalPanoply.getActionsContainer().classList.add("WB-MOB-hideActionsContainer-globalPanoply"),this._globalPanoply.getActionsContainer().classList.remove("WB-MOB-panoplyBarLookChange-globalPanoply"),t.getActionsContainer().classList.remove("WB-MOB-showSelectionActionButtons"),t.getActionsContainer().classList.remove("WB-MOB-borders-height"),this._globalPanoply.getOptionsRContainer().classList.add("WB-MOB-hideRightContainer-globalPanoply"),this._globalPanoply.getOptionsMContainer().classList.add("WB-MOB-hideMiddleContainer-globalPanoply"))},startPanoply:function(t,e){if(!e){let t=new Error;throw t.name="Function invoked incorrectly",t.message='Invoking startPanoply method on panoply manager object is deprecated. Instead check "3DSketch.toggle.any.panoply" event',t}this._panoplyObject[t]&&(this._currentPanoply&&t!==this._currentPanoply.getID()&&this._panoplyObject[t]&&this.endPanoply(),this._currentPanoply=this._panoplyObject[t],this._panoplyObject[t].start({moreCommands:this._moreCommands,contextualCommands:this._contextualCommands,callback:function(){this._updateNextPanoply(),i.publish({event:"CAT3DSKPanoply/START",data:{id:this._currentPanoply.getID(),icon:this._currentPanoply.getIcon(),nextId:this._nextPanoply.getID(),nextIcon:this._nextPanoply.getIcon()}})}.bind(this)}));this._handleStylingForMobileScreenSize(this._panoplyObject[t],{action:"panoply-start"})},_onKeyDown:function(t){if(this._currentPanoply&&o.getCurrentCmdId()!==this._currentPanoply._defaultCmd)return;if(t&&t.target&&("INPUT"===t.target.tagName||"TEXTAREA"===t.target.tagName))return;let e=o.getCommand("QuickTourCmd");if(e&&e._isStarted)return;let s=!1;if(this._drawingToolPanoply&&(this._drawingToolPanoply.getActionsContainer().clientHeight||this._drawingToolPanoply.getMobileActionsContainer().clientHeight)&&(s=!0),this._panoplyShortcuts[t.key]&&!s?i.publish({event:"3DSketch.toggle.any.panoply",data:{panoplyID:this._panoplyShortcuts[t.key]}}):this._panoplyShortcuts[t.code]&&!s&&i.publish({event:"3DSketch.toggle.any.panoply",data:{panoplyID:this._panoplyShortcuts[t.code]}}),this._panoplyDrawingShortcuts[t.key]&&s)i.publish({event:"3DSketch.toggle.any.panoply",data:{panoplyID:this._panoplyDrawingShortcuts[t.key]}});else if(this._panoplyDrawingShortcuts[t.code]&&s)i.publish({event:"3DSketch.toggle.any.panoply",data:{panoplyID:this._panoplyDrawingShortcuts[t.code]}});else if(84===t.keyCode)i.publish({event:"3DSketch.toggle.any.panoply",data:{panoplyID:"Text"}});else if(78===t.keyCode)i.publish({event:"3DSketch.toggle.any.panoply",data:{panoplyID:"StickyNote"}});else if("f"===t.key.toLowerCase()&&!0===t.ctrlKey){if("whiteboard"!==n.getPreferenceValue("appMode"))return;t.preventDefault();let e=o.getCommand("SearchTextCmd");e&&!1===e.isRunning()&&"selection"===this._currentPanoply.getID().toLowerCase()&&e.begin()}},endPanoply:function(){this._currentPanoply.stop(),i.publish({event:"CAT3DSKPanoply/STOP",data:{id:this._currentPanoply.getID(),icon:this._currentPanoply.getIcon(),nextId:this._nextPanoply.getID(),nextIcon:this._nextPanoply.getIcon()}}),this._currentPanoply=void 0},getNextPanoply:function(){return this._nextPanoply},_updateNextPanoply:function(){for(var t,e=0;e<this._panoplyArray.length;e++)this._currentPanoply.getID()===this._panoplyArray[e]&&(t=e===this._panoplyArray.length-1&&0!==e?this._panoplyArray[0]:this._panoplyArray[e+1]);this._nextPanoply=this._panoplyObject[t]},nextPanoply:function(){i.publish({event:"3DSketch.start.any.panoply",data:{panoplyID:this._nextPanoply.getID()}})},setDefaultPanoply:function(t){this._panoplyObject[t]&&(this._defaultPanoply=this._panoplyObject[t]),this.startDefaultPanoply()},startDefaultPanoply:function(){this._defaultPanoply&&i.publish({event:"3DSketch.start.any.panoply",data:{panoplyID:this._defaultPanoply.getID()}})},setHand:function(t){if(this._globalPanoply&&this._globalPanoply.setHand(t),this._panoplyArray.length)for(var e=0;e<this._panoplyArray.length;e++)this._panoplyObject[this._panoplyArray[e]].setHand(t)},_onActionBegin:function(t){var e,n=o.getCommand(o.getCurrentCmdId());if(n&&(e=n.getView()),e)this._temporaryView&&this._temporaryView.hide(),this._temporaryView=e,this._currentPanoply.hide(),this._temporaryView.show(),e.isLeftPanelEnabled()&&e.isRightPanelEnabled()||this._globalPanoply.hide();else if(this._temporaryView){var s=this._temporaryView.getFallbackPanoply();if(this._temporaryView.hide(),this._temporaryView=null,this._currentPanoply.show(),this._globalPanoply.show(),s)var a=t.onExecute((function(){i.unsubscribe(a),i.publish({event:"3DSketch.start.any.panoply",data:{panoplyID:s}})})),l=t.onResume((function(){i.unsubscribe(l),i.publish({event:"3DSketch.start.any.panoply",data:{panoplyID:s}})}))}},isInCommandSubView:function(){return!!this._temporaryView},onPanoplyStart:function(t){this._onPanoplyStartTokens.push(i.subscribe({event:"CAT3DSKPanoply/START"},t))},onPanoplyEnd:function(t){this._onPanoplyStartTokens.push(i.subscribe({event:"CAT3DSKPanoply/STOP"},t))},getPanoplyInfosArray:function(){return this._panoplyInfosArray},getDrawPanoplyInfosArray:function(){return this._panoplyDrawInfosArray},getCurrentPanoply:function(){return this._currentPanoply},enableHelp:function(t){n.setPreferenceValue("help",t);var e=o.getCommand(o.getCurrentCmdId());if(e)if(t)e.getHelp().show(),i.publish({event:"Help.Message.Visibility.Changed",data:{isVisible:!0}});else{e.getHelp().hide();var s=o.getCommands();for(let t in s)"string"==typeof t&&s[t].getHelp().reset();i.publish({event:"Help.Message.Visibility.Changed",data:{isVisible:!1}})}},getControlSettings:function(){return this._controlSettings}});return t.namespace("DS/CAT3DWPanoply/CAT3DWPanoplyManager",l)})),define("DS/CAT3DWPanoply/CAT3DWToggleButton",["DS/CAT3DWPanoply/CAT3DWButton","UWA/Core"],(function(t,e){"use strict";var n=t.extend({init:function(t){this._parent(t),this.isChecked=!1},onClick:function(t){this.isChecked?this.isChecked=!1:this.isChecked=!0,this._parent(t)},toggleON:function(){this.isChecked=!0},toggleOFF:function(){this.isChecked=!1},isON:function(){return this.isChecked}});return e.namespace("DS/CAT3DWPanoply/CAT3DWToggleButton",n)})),define("DS/CAT3DWPanoply/CAT3DWActionCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CAT3DWPanoply/CAT3DWActionButton","DS/CAT3DWPanoply/CAT3DWActionHelp","DS/CAT3DWPanoply/CAT3DWToggleButton","DS/WebappsUtils/WebappsUtils","DS/CoreEvents/Events","DS/CAT3DWPanoply/CAT3DWActionSubButton","DS/CAT3DWInfra/CAT3DWMOBStylingHelper","DS/ApplicationFrame/FrameWindowsManager","i18n!DS/CAT3DWInfra/assets/nls/CAT3DWTooltip"],(function(t,e,n,i,o,s,a,l,h,c,r){"use strict";var u=e.extend({init:function(t,e){this._parent(t,e),this._icon="",t&&t.icon&&this.setIcon(t.icon),this._button=null,this._subButton=null,this._availability=!0,this._actionView=null,this._panoply=null,this._help=null,this._repeat=!0,"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch?this._touchMode=!0:this._touchMode=!1},isLoadingAllowed:function(){return!0},onPanoplyStart:function(){},setPanoply:function(t){this._panoply=t},getPanoply:function(){return this._panoply},setRepeat:function(t){this._repeat=t},isRepeat:function(){return this._repeat},subscribeEvents:function(){this._subscribed=!0},unsubscribeEvents:function(){this._subscribed=!1},isSubscribed:function(){return this._subscribed},_debounce:function(t,e=100){let n;return(...i)=>{clearTimeout(n),n=setTimeout((()=>{t.bind(this)(...i)}),e)}},_onResizeUpdateHelp:function(){this.setHelpDataOnHelpObject(),this._help.isVisible()&&(this._help.hide(),this._help.show())},beginExecute:function(t){this._button&&this._button instanceof o&&this._button.toggleON(),(t=t||{}).actionView=null!==this._actionView,a.publish({event:"CAT3DWActionCmd/START/",data:t}),a.publish({event:this._globalEvtID+"/EXECUTE",data:this}),this.helpData&&this.helpDataMobile&&(this.setHelpDataOnHelpObject(),this.frameWindow||(this.frameWindow=c.getFrameWindow()),this._onResizeUpdateHelpBind=this._debounce(this._onResizeUpdateHelp),window.addEventListener("resize",this._onResizeUpdateHelpBind)),this._help&&this._help.show(),this._parent()},cancelExecute:function(t){a.publish({event:"CAT3DWActionCmd/CANCEL/",data:t}),a.publish({event:this._globalEvtID+"/CANCEL",data:this}),this._parent()},endExecute:function(t){this._button&&this._button instanceof o&&this._button.toggleOFF(),(t=t||{}).actionView=null!==this._actionView,a.publish({event:"CAT3DWActionCmd/END/",data:t}),a.publish({event:this._globalEvtID+"/END",data:this}),this._help&&this._help.hide(),this.helpData&&this.helpDataMobile&&(this.frameWindow||(this.frameWindow=c.getFrameWindow()),window.removeEventListener("resize",this._onResizeUpdateHelpBind),this._onResizeUpdateHelpBind=null),this._parent()},check:function(){},getAvailability:function(){return this._availability},setAvailability:function(t){this._availability!==t&&(this._availability=t,this._button&&this._button.setAvailability&&this._button.setAvailability(t),this._subButton&&this._subButton.setAvailability&&this._subButton.setAvailability(t),this._contextButton&&this._contextButton.setAvailability&&this._contextButton.setAvailability(t),this._panoply&&this._panoply._onCmdAvailabilityChange(this._id))},setButtonAvailable:function(){this._availability?(this._button&&this._button.setAvailability&&this._button.setAvailability(!0),this._subButton&&this._subButton.setAvailability&&this._subButton.setAvailability(!1)):(this._button&&this._button.setAvailability&&this._button.setAvailability(!1),this._subButton&&this._subButton.setAvailability&&this._subButton.setAvailability(!1))},setSubButtonAvailable:function(){this._availability?(this._button&&this._button.setAvailability&&this._button.setAvailability(!1),this._subButton&&this._subButton.setAvailability&&this._subButton.setAvailability(!0)):(this._button&&this._button.setAvailability&&this._button.setAvailability(!1),this._subButton&&this._subButton.setAvailability&&this._subButton.setAvailability(!1))},isButtonAvailable:function(){if(this._button&&this._button.getAvailability)return this._button.getAvailability()},isSubButtonAvailable:function(){if(this._subButton&&this._subButton.getAvailability)return this._subButton.getAvailability()},setIcon:function(t){this._icon=t,this.getButton().setIcon(this._icon),this.getSubButton().setIcon(this._icon),this.getContextButton().setIcon(this._icon)},setLabel:function(t){this._label=t,this.getButton().addLabel(t),this.getSubButton().setText(t),this.getContextButton().setText(t)},setNls:function(t){this._nls=t,this._nls[this._id+".text"]&&(this.getButton().addLabel(this._nls[this._id+".text"]),this.getSubButton().setText(this._nls[this._id+".text"]),this.getContextButton().setText(this._nls[this._id+".text"]))},setSettingsCmd:function(t){this._settingsCmd=t},_callback:function(){this._isRunning||this.begin()},setButton:function(t){this._button=t},setSubButton:function(t){this._subButton=t},setContextButton:function(t){this._contextButton=t},setHand:function(){},getButton:function(){return this._button||(this._button=this.createButton()),this._button},getSubButton:function(){return this._subButton||(this._subButton=this.createSubButton()),this._subButton},getContextButton:function(){return this._contextButton||(this._contextButton=this.createSubButton()),this._contextButton},addSubMenuIconToContextButton:function(){let t=document.createElement("span");t.className="fonticon fonticon-right-open",t.style.marginRight="-10px",t.style.width="25px",this.getContextButton().getHTMLElement().append(t)},createButton:function(){var t;return t=Object.hasOwn(r,this._id)?r.get(this._id):"",new n({name:this._id,icon:this._icon,callback:this._callback.bind(this),tooltip:t})},createSubButton:function(){var t;return t=Object.hasOwn(r,this._id)?r.get(this._id):"",new l({name:this._id,icon:this._icon,callback:this._callback.bind(this),tooltip:t})},getView:function(){return this._actionView},setView:function(t){this._actionView=t},getHelp:function(){return this._help||(this._help=new i({name:this._id,icon:this._icon,cmd:this})),this._help},setHelp:function(t){this._help=t},setHelpDataOnHelpObject:function(){h.isScreenDimensionMobilePhone()?this._help.setHelp(this.helpDataMobile):this._help.setHelp(this.helpData)},setHelpResources:function(t){if(t.i18nObj){this.getHelp().hide();var e=t.i18nObj,n="help."+t.key+".",i="help.touch."+t.key+".",o=t.mediaObj,a={message:null,tip:null,title:null,text1:null,text2:null};for(var l in a)a[l]=e[n+l]?e.get(n+l):null,this._touchMode&&(a[l]=e[i+l]?e.get(i+l):a[l]);this.helpData={key:t.key,message:a.message,tip:a.tip,title:a.title,text1:a.text1,text2:a.text2,gif:o&&o[n+"gif"]?s.getWebappsBaseUrl()+o[n+"gif"]:null},this.helpDataMobile=JSON.parse(JSON.stringify(this.helpData));var h=e[n+"message.mobile"]?e.get(n+"message.mobile"):a.message;this.helpDataMobile.message=h,this.setHelpDataOnHelpObject()}}});return t.namespace("DS/CAT3DWPanoply/CAT3DWActionCmd",u)}));