var id="";"undefined"!=typeof widget&&widget.id&&(id=widget.id),window["3DPlay.ProbesManager.clapDone"]=!0,window.performance.mark(id+"clap");try{window.top.performance.mark(id+"clap")}catch(e){window["3DPlay.ProbesManager.TopWindowNotAvailable"]=!0}var mark=id+"_3DPlayApp";window.performance.mark(mark);var status="";define("DS/3DPlayApp/3DPlayApp",["DS/WAfrContainer/App","DS/3DPlayWidget/Widget3DPlay","DS/WebSystem/Environment","DS/WebSystem/Settings","UWA/Promise","DS/WebUtils/ProbesManager","DS/WebUtils/Tracker","DS/3DPlaySupport/SupportList","DS/3DPlaySupport/AssetSupport","DS/WebUtils/Profiler","DS/3DPlayWidgetControllers/3DPlayWidgetProxy","DS/WebUtils/WebServices","DS/3DPlayWidget/3DPlayWidgetLinkManager","DS/CoreEvents/Events"],(function(e,i,t,r,n,a,o,d,s,p,l,c,D,u){"use strict";var w=["i18n!DS/ENOCockpit/assets/nls/ENOCockpit.json","DS/PADServices/views/private/AppStructure"];require(w,(function(e,i){w=e,b=i}));var v=new l,f={};require(["i18n!DS/3DPlayApp/assets/nls/3DPlayApp"],(function(e){f=e})),a.createProbe("Widget_EntryPoint",mark).end();var g=a.createProbe("Unified_Widget_2");g.begin();var P,S,y,A,m,b,h=!1,V=!1,E=!1,x=["3DSPACE","EV6","R2VSURVEY"];return widget.getValue("x3dPlatformId")||widget.setValue("x3dPlatformId",c.getTenant()),"OnPremise"!==widget.getValue("x3dPlatformId")&&t.set("3DPlay.Plateform.Cloud",!0),e.extend({init:function(e){m=this,this._parent(e)},onWillEnter:function(e){var i={};return e&&e.options&&i[e.options.id]?n.reject(new Error(i[e.options.id])):n.resolve()},onWillLeave:function(e){var i=!1,t=f.SpecificData_NoTransition,r={};if(r[e.options.id]?t=r[e.options.id]:i=!0,i&&this.experience&&this.experience.acceptSwitch&&(i=this.experience.acceptSwitch(e)),i&&this.pad3DViewer.getController().hasAnyEffectiveFlexibleAssembly()&&(i=!1,t=w.transitionRefusedFlexibleAssemblies),i){if(V=!0,this.experience.publish("EXPERIENCE/TRANSITION",e),!P&&A&&!0!==A.fromLoadJSON){const e="xsceneStoredObjects";if(A.rootLog){b.setWidget(window.widget);var a=b.retrieveData(e);if(A.filterId){A.serviceId||(A.serviceId="3DSpace");({})[A.filterId]={associatedProduct:A.id},b.addFilter(a,A.filterId,A.id),b.addOpenFilter(a,[A.filterId])}else if("r2vsurvey"===A.serviceId)a.pCloudServiceId=A.serviceId,b.addPointCloud(a,A.idPath[0],A.soiId),b.addOpenPointCloud(a,A.soiId);else{A.serviceId||(A.serviceId="3DSpace"),b.addProductPath(a,A.idPath,!0);var d=[A.idPath];b.addOpenProduct(a,d)}b.persistData(e,a)}}A=void 0,y&&u.unsubscribe(y);var s={timeIn3DPlay:p.stop("3DPlayAppTimer")};p.start("3DPlayAppTimer"),o.trackPageEvent("transitions","transition-to",e?e.options.title:"",void 0,s);var l=window.widget;return l.addEvent("onChangeFlexibleAssembliesSupport",(function(e,i){require("DS/PADUtils/PADSettingsMgt").setSetting(e,i)})),l.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"hidden",defaultValue:!1,label:require("i18n!DS/ENOPAD3DViewer/assets/nls/PAD3DViewer").flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:!1}),require("DS/PADUtils/PADSettingsMgt").setSetting("enopad3dviewer_flexibleAssemblySupportActivated",!1),this.pad3DViewer.getController()._disableElasticLoadingForTransition(),this.pad3DViewer.getController()._disableStaticMappingSupport(),n.resolve()}return n.reject(new Error(t))},dispose:function(){if(status="outside",!E){E=!0;var e={disposeFrameWindow:!V,cleaarSession:!0};if(!0===h&&m.pad3DViewer){var i=m.pad3DViewer.getFrameWindow();m.experience&&(m.experience.clearView(),i.getViewer().render())}v.dispose(),S.dispose(e),this._parent(e),S=null,m.experience=null,m=null,V=!1}},setUp:function(e){g.end(),a.createProbe("Widget_3DPlay").begin(),y=u.subscribe({event:"onRootAdded"},(function(e){A=e})),E=!1;var t,r,n={};if(e&&(t=e.sourceApp),t){if(t.options.id===this.options.id)return e.done(),void(this.pad3DViewer=t.pad3DViewer);var d;if("outside"===status){var l=p.stop("3DPlayAppTimer");l>0&&(d={timeOustSide3DPlay:l})}o.trackPageEvent("transitions","transition-from",t.options.title,void 0,d),this.pad3DViewer=t.pad3DViewer;var c=void 0!==this.pad3DViewer;if(c){if(!t.isDisposeCalled()){var w={disposeFrameWindow:!1,appInfo:"X3DPLAW_AP"};t.dispose(w),w.preferredType&&(r=w.preferredType)}require(["DS/3DPlayWAFRMigration/CommandsManager"],(function(e){e._reset()})),n={ctx:this.pad3DViewer.getCommandContext(),pad3DViewer:this.pad3DViewer,appMainDiv:t.appMainDiv};let e=m.pad3DViewer.getViewer();e&&e.updateViewPanelUIConfiguration&&e.updateViewPanelUIConfiguration({useShadingIllustration:!0,useOutline:!0});try{(P=m.pad3DViewer.getRoots())&&(P=!(!Array.isArray(P)||!P.length))}catch(e){P=!1}}D.update(!0)}else D.init().then((function(){D.update(!0)}));status="inside",p.start("3DPlayAppTimer"),n.callbacks={ASSET:{LOADINGFINISHED:function(e){if(P)return h=!1,void(P=!1);var i=e.loadAssetInfo;h="string"==typeof i||!(i&&x.indexOf(i.provider)>-1)}},experience:{experienceready:[function(e){m.pad3DViewer=e.pad3DViewer,m.experience=e,widget.dispatchEvent("onWidgetAndAppReady",m)}]}};var f={options:n,widgetCB:function(i){S=i,v.waitLoadEvent((function(e){S.wModel.setCurrentContent(e)})),v.waitRefreshEvent((function(){widget.dispatchEvent("onRefresh")})),m.appMainDiv=i.wModel.getCanvasDiv(),S.wPlayer.lightbox||c?(e.done(),P&&S.wModel.setCurrentContentFromSwitch(m.pad3DViewer.getRoots())):e.done(m.appMainDiv)}};r?s.getExperienceID({provider:"3DSPACE",type:r},{},(function(e){f.experience=e,i({widget:widget,applicationFrameOptions:f})})):i({widget:widget,applicationFrameOptions:f})}})}));