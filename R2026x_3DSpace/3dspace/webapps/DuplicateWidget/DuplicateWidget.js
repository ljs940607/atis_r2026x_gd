define("DS/DuplicateWidget/AlertBar",["UWA/Controls/Abstract"],(function(e){"use strict";return e.extend({name:"alertBar",defaultOptions:{autoHide:!0,autoHideDelay:3e4},init:function(e){this._parent(e),this.buildSkeleton()},buildSkeleton:function(){if(!this.elements.container){var e=this;this.elements.container=UWA.createElement("div",{class:this.getClassNames()}),UWA.createElement("span",{class:"fonticon fonticon-info "+this.getClassNames("-info")}).inject(this.elements.container),this.elements.text=UWA.createElement("span",{class:this.getClassNames("-text")}).inject(this.elements.container),UWA.createElement("span",{class:"fonticon fonticon-cancel "+this.getClassNames("-close")}).inject(this.elements.container),this.elements.container.addEventListener("click",(function(){e.hide()})),this.hide()}},show:function(e){var t=this;this.elements.text.setContent(e),this.elements.container.addClassName("alertBar-visible"),setTimeout((function(){t.elements.container.addClassName("alertBar-height")}),100),this.options.autoHide&&(this.timer=setTimeout((function(){t.timer=null,t.hide()}),this.options.autoHideDelay))},hide:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.elements.container.removeClassName("alertBar-visible"),this.elements.container.removeClassName("alertBar-height")}})})),define("DS/DuplicateWidget/utils/IdNs",["UWA/Controls/Abstract","DS/LifecycleServices/HTMLTemplating"],(function(e,t){"use strict";return e.extend({init:function(e,t){this.container=e,this.idPfx=t},getPfx:function(){return this.idPfx},getElById:function(e){return UWA.extendElement(this.container.querySelector("#"+this.idPfx+e))},elementFromTemplate:function(e,i,n,a){return UWA.extendElement(t.ElementFromTemplate(e,i,n,this.idPfx,a))}})})),define("DS/DuplicateWidget/DuplicateWidget",["UWA/Controls/Abstract","DS/ENOjquery/ENOjquery","UWA/Class/Model","DS/Utilities/TouchUtils","i18n!DS/DuplicateWidget/assets/nls/DuplicateWidgetNls","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","i18n!DS/LifecycleServices/assets/nls/LifecycleServicesNls","DS/Windows/ImmersiveFrame","DS/LifecycleServices/LifecycleCommandManager","DS/LifecycleControls/DelayedMask","DS/WAFData/WAFData","DS/LifecycleServices/WebReq","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/LifecycleAlert","DS/LifecycleServices/IllegalCharMapping","DS/LifecycleServices/Utils","DS/LifecycleControls/InputValidation","DS/LifecycleControls/CredentialList","DS/LifecycleServices/DefaultCredential","DS/LifecycleServices/ChunkedwebReq","DS/AdvancedView/AdvancedTree","DS/DuplicateWidget/AlertBar","DS/LifecycleServices/IdNs","DS/LifecycleControls/CommandDialog","DS/LifecycleCmd/MessageMediator","DS/LifecycleCmd/SelectionUtil","DS/WidgetServices/WidgetServices","DS/LifecycleCmd/TargetFolderUtil","DS/LifecycleServices/expandServices/ExpandReqBuilder","text!DS/DuplicateWidget/assets/html/simpledup.html","DS/LifecycleControls/DataGridViewContainer","DS/LifecycleControls/RelatedObjectsControl","DS/LifecycleControls/RelatedObjectsDialog","DS/LifecycleControls/CredentialSelector","DS/AdvancedView/ExtensibilityConstants","DS/LifecycleServices/expandServices/duplicateExpand","DS/ENOCollabToolsUI/tracker/ENOCollabTracker","DS/ENOCollabToolsUI/tracker/ENOCollabTrackerBackEnd","DS/WebInWinHelper/WebInWinHelper","DS/WebToWinInfra/WebToWinCom","DS/UIKIT/Input/Button","DS/LifecycleControls/WebUXDialog","DS/LifecycleControls/AsyncOpProgressDlg","css!DS/LifecycleControls/LifecycleControls","css!DS/LifecycleControls/assets/styles/InputValidation","css!DS/DuplicateWidget/DuplicateWidget"],(function(e,t,i,n,a,o,s,r,l,c,d,u,h,p,g,f,m,v,C,D,y,b,S,w,_,E,x,I,A,O,T,P,k,j,W,N,L,U,M,V,F,R,B,z){"use strict";return e.extend({physicalid:"",supportedObjects:null,multiselect:!1,selType:"",context:null,tenant:null,NLVIntents:"",obj2expandProviders:new Map,init:function(e,t,i){var n=this;this._parent(i),this.roots=[],this.supportedObjects=[],a=m.createDbgNlsProxy(a),this.illegalChars="",this.IllegalCharMapping=new f,this.duplicateOptions=[],this.duplicateCaps={},this.commandManager=new l,this.selUtil=new x,this.simpleDupInputChecker=function(){return!(n._SimpleDupInputValidation&&!n._SimpleDupInputValidation.isInputValid(1))},this.inputChecker=this.simpleDupInputChecker,this.usingAdvancedDuplicate=!1,this.allCredentials=[],this.updateCSWarning=m.debounce(this._updateCollabSpaceWarning.bind(this),200),this.addEvent("AdvancedUIModeChanged",(()=>{this.updateCSWarning()})),this.duplicateContent=UWA.createElement("div",{class:"duplicate_content dlg_cmd_content"}),this.container=UWA.createElement("div",{class:"duplicate_container"}),this.duplicateContent.inject(this.container),this.wintop=!1,i&&i.wintop&&(this.wintop=!0,this.without_cred=!0,V.initTenant(this),V.getServices(this),this.webToWinCom_Socket=F.createSocket({socket_id:"WebInWin_DuplicateWidget_Socket_"+Math.floor(1e5*Math.random()+1)}),this.context=i.context||{},void 0!==i.serverUrl&&i.serverUrl.length>0&&(void 0!==i.serverUrl[0].platformId&&(this.tenant=i.serverUrl[0].platformId),p.setTenant(this.tenant)),i.hasOwnProperty("ChangeActionId")&&(this.wintop_ChangeActionId=i.ChangeActionId),"TRUE"===i.ODT_MODE&&(this.wintop_odt_mode=!0),"TRUE"===i.auto_execute&&(this.auto_execute=!0),i.hasOwnProperty("dup_string")&&(this.dup_string=i.dup_string),this.footerDiv=UWA.createElement("div",{class:"duplicate_footer modal-footer"}),this.footerDiv.inject(this.container),this.container.addClassName("column_flex_container"),this.container.addClassName("webinwin_lc_command_dialog"))},initDatafromWin:function(e){var t=[];e.forEach((function(e){var i=e.physicalId,n=e.name,a={physicalid:i,name:n,displayName:n};t.push(a)}));var i={duplicateAdvanced:!1,context:this.context};console.log("initDatafromWin / selection size: "+e.length),console.log("initDatafromWin / tenant: "+this.tenant),this.executeCmd(t,i,(function(e){console.log("The duplicate web in win has done what he should have done")}))},onRefresh:function(){console.log("onRefresh called from win")},onResize:function(){console.log("onResize called from win")},_CloseWebInWinPanel:function(){this.wintop&&(console.log("CloseWebInWinPanel"),this.webToWinCom_Socket.dispatchEvent("onDispatchToWin",{notif_name:"ClosePanel",notif_parameters:"ClosePanel",recordable:!0,captureAll:!0},"lf_web_in_win"))},_getTargetFolderId:function(){var e=A.getTargetFolderId(this.context);try{if(void 0!==p.getActiveFolder){var t=p.getActiveFolder();null!==t.id&&""!==t.id&&void 0!==t.id&&(e=t.id,require(["DS/PlatformAPI/PlatformAPI"],(function(e){e.publish("FolderEditor.ActiveFolderCallBack",{id:t.id,label:t.label})})))}}catch(t){e=A.getTargetFolderId(this.context)}return e},verifyTargetFolder:function(){return this.folderId=this._getTargetFolderId(),null!==this.folderId||!p.getEnforceFolderLinkSetting()},_getUniqueListBy:function(e,t){return[...new Map(e.map((e=>[e[t],e]))).values()]},executeCmd:function(e,t,i){if(e=this._getUniqueListBy(e,"physicalid"),this.addEvent("onReady",(function(){this._showCommandUI(e)}),this),this.addEvent("onComplete",(function(e){i(e)})),this.context=t.context||{},this.selType=e.length>0?e[0].type:"",this.trackerEventBeginTime=Date.now(),this.context.displayNotification=e=>{this._displayNotification(e)},!this.verifyTargetFolder())throw a.noFolderSelected;this.setObjects(e)},_createDialogTitle:function(e){return a.duplicate+e},_showCommandUI:function(e){var t=this;this._execDup=async function(){if(t.loadStructurePromise){let e=new c(t.dialog.elements.body,500,a.checkPrivateData);if(await t.loadStructurePromise,e.unmask(),t.warningInfoData.warningVisible){let e=new B;if(await e.create({container:t.dialog.elements.body,content:o.selectedCSNotPrivate+a.continueQ,title:a.warningTitle,footer:WebUXDialogFooter.YesNo})==WebUXDialogButton.No)return void(t.commandDialog&&t.commandDialog._disableUI(!1))}}t.inputChecker()&&(t.commandDialog&&t.commandDialog._disableUI(),l._executeDuplicate().then((e=>{t._saveDlgSize(),t.commandDialog.destroy(),l._onComplete(e)}),(e=>{t._saveDlgSize(),t.commandDialog.destroy()})))};var i=this._renderDialogContent();this.rootGrid=UWA.createElement("div",{class:"lcm-duplicate-root-grid"}),i.inject(this.rootGrid),this.wintop&&i.inject(this.duplicateContent);let n=UWA.createElement("div",{class:"lcm-cspace-warn-root"});n.inject(this.rootGrid),UWA.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-attention lcm-cspace-warn-icon"}).inject(n);let s=UWA.createElement("div",{class:"lcm-cspace-warn-msg"});s.innerText=o.selectedCSNotPrivate,s.inject(n);var r="";this.multiselect?(r=" - "+this.supportedObjects.length+" "+o.multipleSelectionObjects,this.wintop||this.dgvContainer.inject(i.firstChild,"top"),!0===this.dgvContainer.options.clickToShowDGV&&i.addClassName("hasExpander")):r=` - ${e[0].name} ${e[0].revision}`;var l=this;if(this.wintop){var d=new R({value:a.duplicate,name:"DuplicateButtonOk",className:"default medium primary"}),u=new R({value:a.cancelButton,name:"DuplicateButtonCancel",className:"default medium"});d.inject(this.footerDiv),u.inject(this.footerDiv),this._onOkPromise=function(){return new Promise((e=>{t.inputChecker()&&(d.setDisabled(),u.setDisabled(),l._executeDuplicate().then((t=>{t.messageToDisplay=o.duplicateSuccessful,e(t)}),(t=>{var i="Duplicate Error";t&&(i=t);var n={severity:"error",message:i},a=[];a.push(n),e({errors:a})})))}))},this._onOkPromiseFromWin=function(){return new Promise((e=>{this._onOkPromise().then((t=>{console.log("Promise _onOkPromiseFromWin resolving");var i=JSON.stringify(t);e(i),this._onCompleteWithoutClose()}))}))},this._onOk=function(){d.setDisabled(),u.setDisabled(),t.webToWinCom_Socket.dispatchEvent("onDispatchToWin",{notif_name:"dispatchWinAction",notif_parameters:{action:"WebToWinAction_OnOKButton",data:{ExecuteSync:"_onOkPromiseFromWin",timeout:1e6}},recordable:!0,captureAll:!0},"lf_web_in_win")},this._onCancel=function(){d.setDisabled(),u.setDisabled(),void 0!==t.options.FailureCallbackCommandHeader&&V.fireWintopCommandWithArgs(t.webToWinCom_Socket,"Cancel Button",t.options.FailureCallbackCommandHeader),t._onComplete()},d.addEvents({onClick:function(){t._onOk()}}),u.addEvents({onClick:function(){t._onCancel()}}),setTimeout((()=>{i.style.minHeight="127px";let e=i.querySelector(".EditProp_MainContain");e&&(e.style.minHeight=""),this.auto_execute?(console.log("launching automatically execution of the command"),d.dispatchEvent("onClick")):t.dispatchEvent("UICreated")}),10)}else this._createCommandDialog(i,e,r)},_createCommandDialog:function(e,t,i){var n=this,o=this,s=new _,r=this._createDialogTitle(i),l=s.create(this.rootGrid,{title:r,OKBtnText:a.duplicate,closeButton:!0,imageUrl:t[0].imageUrl||"",resizable:!0,powerMaximize:!0,onOk:this._execDup,onClose:function(){n._saveDlgSize(),o._onComplete()}});this._setupEventListeners(e),this.commandDialog=s,this.dialog=l,l.inject(widget.body),l.elements.body.setStyle("height","100%"),l.elements.container.addClassName("dupDlg"),this.multiselect&&l.elements.container.addClassName("multiSel"),this._isDesktopMode()&&l.elements.container.setAttribute("desktop-mode",""),this.commandDialog.addEvent("widget-maxmized-changed",(function(e){e&&n.usingAdvancedDuplicate&&n.commandDialog.maximize(!0)})),this.commandDialog&&this.commandDialog.setPowermaximizeVisibility(!1);var c=this._isDesktopMode()?0:30;this.duplicateCaps.includeChildrenDyn&&(c+=25);var d=this.multiselect?600:610,u=(this.multiselect?window.screen.width>429?370:380:window.screen.width>429?265:285)+c,h=(this.multiselect?window.screen.width>429?370:380:window.screen.width>429?265:285)+c;this.multiselect&&!0===this.dgvContainer.options.clickToShowDGV&&(u=275,h=275),l.setNewSize({width:d,height:u}),setTimeout((function(){l.setMinSize(440,h);let e=n.trackerEventBeginTime?Date.now()-n.trackerEventBeginTime:0,i={UXName:"Duplicate",models:t,actionStatus:"success",actionTime:e};n.trackerEvent=U.createInitActionEvent(i),U.checkAndTrackPageEvent(n.trackerEvent),l.dispatchEvent("UICreated"),n.dispatchEvent("UICreated")}),10),this._setupSimpleDupInputValidation(t[0].name||""),this._adjustModalBody(!0),this.dialog.elements.footer.querySelector("button.btn-primary").disabled=!0;var p=this.dialog.elements.container.querySelector("#enolcm-dup-simple-expander");p&&(p.style.pointerEvents="none",p.classList.add("enolcm-dup-disabled-div")),UWA.Promise.all([this.credListLoader,this.defSecCtxLoader]).then((e=>{e.length<2||!UWA.is(e[0],"array")?console.error("Missing credentials"):C.filterCredentialsEx(this.tenant,e[0],"duplicate").then((t=>{this.allCredentials=t;let i=t.filter((e=>!e.isFiltered)).map((t=>{let i=e[0].filter((e=>e.ctx===t.secCtx)),n=t.secCtx,a=null;return i&&i[0]&&i[0].prjTitle&&(i[0].prjTitle&&(n=i[0].prjTitle),i[0].orgTitle&&(a=i[0].orgTitle)),{prjTitle:n,ctx:t.secCtx,isPrivate:t.isPrivate,orgTitle:a}}));if(i.length>0){i=i.sort(((e,t)=>e.prjTitle.localeCompare(t.prjTitle,void 0,{numeric:!0,sensitivity:"base"}))),UWA.is(i,"array")&&(this._userCredentials=C.groupCredentialsByCollabSpace(i));let t=()=>{var e=this.dialog.elements.footer.querySelector(".btn-primary");if(e.disabled){e.disabled=!1;var t=this.dialog.elements.container.querySelector("#enolcm-dup-simple-expander");t&&(t.style.pointerEvents="",t.classList.remove("enolcm-dup-disabled-div"))}},s=this.dialog.elements.body.querySelector("#enolcm-dup-simple-cred-combo-container");s||(s=this.dialog.elements.body.querySelector("#enolcm-dup-simple-mainContainer"));var a=W.createCredentialComboBox({userCredentials:this._userCredentials,dialog:this.dialog,dialogContainer:s,defaultCtx:e[1],activateOkButtonCallback:t});this.credComboCollabSpace=a[0],this.credComboOrg=a[1],this.credComboCollabSpace.addEventListener("change",(e=>{console.log("Credentials changed:"+this.credComboCollabSpace.currentLabel),W.manageComboCollabSpaceChange(this._userCredentials,this.credComboCollabSpace,this.credComboOrg),t(),this.updateCSWarning()}));var o=[this.credComboCollabSpace,this.credComboOrg];n.updateCSWarning(),widget.dispatchEvent("CredentialUiCreated",o),n.dispatchEvent("CredentialUiCreated",o)}else{let e=this.dialog.elements.body.querySelector("#enolcm-dup-simple-cred-combo-container");e||(e=this.dialog.elements.body.querySelector("#enolcm-dup-simple-mainContainer"));let t=W.manageNoCredential({dialog:this.dialog,dialogContainer:e});this.showError(t.title,t),n.dispatchEvent("CredentialUiCreated",t.combos)}})).catch((e=>{console.error("Failed to call credential filter svc, error:",e);let t=this.dialog.elements.body.querySelector("#enolcm-dup-simple-cred-combo-container");t||(t=this.dialog.elements.body.querySelector("#enolcm-dup-simple-mainContainer"));let i=W.manageNoCredential({dialog:this.dialog,dialogContainer:t});this.showError(a.errCredFilterSvc),n.dispatchEvent("CredentialUiCreated",i.combos)}))}))},_isDesktopMode:function(){return!n.getTouchMode()},_adjustModalBody:function(e){this.dialog.elements&&this.dialog.elements.body&&(e?(this.dialog.elements.body.setStyle("padding-top","2px"),this.dialog.elements.body.setStyle("padding-bottom","2px"),this.dialog.elements.body.setStyle("padding-left","6px"),this.dialog.elements.body.setStyle("padding-right","6px")):(this.dialog.elements.body.setStyle("padding-top","1px"),this.dialog.elements.body.setStyle("padding-bottom","1px"),this.dialog.elements.body.setStyle("padding-left","2px"),this.dialog.elements.body.setStyle("padding-right","2px")))},_openAdvancedDup:function(e){this._delayedMask||(this._delayedMask=new c(e,1e3,a.loadingText)),this.dialog.elements.container.addClassName("dupAdv"),"function"==typeof this.dialog._handleWidgetResize&&this.dialog._handleWidgetResize(),this._openAccordion(this.dialog,e)},_closeAdvancedDup:function(){this._closeAccordion(this.dialog)},_setupEventListeners:function(e){this.commandManager.addEvent("onOpenAccordion",(function(e){this._openAdvancedDup(e.div)}),this),this.commandManager.addEvent("onCloseAccordion",(function(e){this._closeAdvancedDup()}),this)},_typeHasIllegalChars:function(){return this.haveVPMReference},_setupSimpleDupInputValidation:function(e){if(this._typeHasIllegalChars()){this._SimpleDupInputValidation=new v;var t=this.dialog.elements.body.querySelector("#enolcm-dup-simple-addtext-input > input");if(t){var i=this.dialog.elements.footer.querySelector("button.btn-primary");this._SimpleDupInputValidation.addValidateElement(t,this._getInputValidators(e.length),!1,1),this._SimpleDupInputValidation.addSubmitElement(i,1)}}},_dupOptions2Caps:function(e){let t={addPrefix:!1,defaultPrefix:null,includeChildren:!1,includeChildrenDefaultValue:!1,clearConfigurations:!1,includeChildrenDyn:!1,includeChildrenLabelDyn:null,advanced:!1,relatedObjects:!1},i=this._getOptionsHelper(e);return t.addPrefix=i.prefix(),t.defaultPrefix=i.defaultPrefix(),i.wholeStructure()&&(t.includeChildren=!0),i.wholeStructureDyn()&&(t.includeChildrenDyn=!0,t.includeChildrenLabelDyn=i.getWholeStructureName(a["dlg-incChildren"])),t.includeChildrenDefaultValue=i.getWholeStructureDefault(!0),t.advanced=i.advanced(),t.relatedObjects=i.relatedObjects(),t.clearConfigurations=i.clearConfigurations(),t},_mergeOptionsAndCaps:function(e,t){let i=this._dupOptions2Caps(e);return t.addPrefix=i.addPrefix||t.addPrefix,t.advanced=i.advanced&&t.advanced,t.includeChildren=i.includeChildren||t.includeChildren,t},_selectRelatedObjects:function(){let e=new j,t=this.supportedObjects[0].physicalid,n=new i({source:"3DSpace",tenant:this.tenant,objectId:t,id:t});e.create({parentContainer:widget.body,model:n}).then((e=>{this.roots=this.roots.concat(e.map((e=>e.id))),this.simpleDupViewModel._openAdvanced(),this._selectRelatedObjects=()=>{this.simpleDupViewModel._openAdvanced()}})).catch((e=>{console.log("Rel obj dialog cancel: ",e)}))},_renderDialogContent:function(){var e=UWA.createElement("div",{class:"duplicate_popup dlg_cmd_content"}),t=this;this.simpleDupViewModel={includeChildren:!!this.duplicateCaps.includeChildrenDefaultValue,text:"",useAdvanced:!1,openAdvanced:function(){t.duplicateCaps.relatedObjects&&!t.multiselect?t._selectRelatedObjects():t.simpleDupViewModel._openAdvanced()},closeAdvanced:function(){t.simpleDupViewModel.useAdvanced=!1,t._closeAdvancedDup()},onTextChange:function(e,i,n){t.simpleDupViewModel.text=e},onIncludeChildrenChange:function(e){t.updateCSWarning()},duplicate:function(){t._execDup()},_openAdvanced:function(){t.simpleDupViewModel.useAdvanced=!0,t._openAdvancedDup(o)}},this.multiselect&&(this.simpleDupViewModel.includeChildren=!1);var i=new w(e,"enolcm-dup-simple-");this.idns=i,a["dlg-incChildren-dynamic"]=this.duplicateCaps.includeChildrenLabelDyn,i.elementFromTemplate(T,null,a,this.simpleDupViewModel).inject(e);let n=i.getElById("wholestructure");if(n&&this.anyRootHasFilter()){let e=n.querySelector(".wux-label");e&&(e.innerText+=" ("+a.noFilterUsed+")")}n.addEventListener("change",(function(e){var t=i.getElById("wholestructureDyn");t&&(t.wuxControl.checkFlag=this.wuxControl.checkFlag)})),i.getElById("wholestructureDyn").addEventListener("change",(function(e){var t=i.getElById("wholestructure");t&&(t.wuxControl.checkFlag=this.wuxControl.checkFlag)}));var o=i.getElById("advanced-content"),s=function(e){var t=i.getElById(e);t.parentElement.removeChild(t)};if(this.duplicateCaps.addPrefix?setTimeout((function(){var e=i.getElById("addtext-input");if(e){var t=e.querySelector("input");t&&(t.setSelectionRange(0,t.value.length),t.focus())}}),100):(s("addtext-label-container"),s("addtext-input-container")),this.duplicateCaps.defaultPrefix){var r=i.getElById("addtext-input").querySelector("input");r&&r.parentElement&&r.parentElement.wuxControl&&(r.parentElement.wuxControl.value=this.duplicateCaps.defaultPrefix),this.simpleDupViewModel.text=this.duplicateCaps.defaultPrefix}return this.duplicateCaps.includeChildren||s("wholestructure"),this.duplicateCaps.includeChildrenDyn||s("wholestructureDynContainer"),this.isDuplicateAdvancedAllowed()&&(this.duplicateCaps.advanced||this.duplicateCaps.relatedObjects&&!this.multiselect)||(s("advanced-content"),s("expander"),s("collapser")),this.HTMLContent=e,e},isDuplicateAdvancedAllowed:function(){return!this.wintop},_getOptionsHelper:function(t){return new(e.extend({init:function(e){this.dupOpts=e},prefix:function(){return 0!==this._findKey("prefix").length},defaultPrefix:function(){return this.prefix()?this._findKey("prefix")[0].value:null},setPrefix:function(e){let t=!1;for(var i=0;i<this.dupOpts.length;i++)"prefix"===this.dupOpts[i].key&&(this.dupOpts[i].value=e,t=!0);t||this.dupOpts.push({key:"prefix",value:e})},wholeStructure:function(){var e=this._findKey("wholeStructure");return(1!==e.length||!e[0].variation||"drawing"!==e[0].variation)&&0!==e.length},wholeStructureDyn:function(){var e=this._findKey("wholeStructure");if(!(e.length>0))return!1;for(var t=0;t<e.length;t++)if(e[t].variation&&"drawing"===e[t].variation)return!0},setWholeStructure:function(e){let t=!1;for(var i=0;i<this.dupOpts.length;i++)"wholeStructure"===this.dupOpts[i].key&&(this.dupOpts[i].value=e,t=!0);t||this.dupOpts.push({key:"wholeStructure",value:e})},getWholeStructureName:function(e){var t=this._findKey("wholeStructure");if(t.length>0)for(var i=0;i<t.length;i++)if(t[i].variation&&"drawing"===t[i].variation)return t[i].nlsKey;return e},getWholeStructureDefault:function(e){var t=this._findKey("wholeStructure");return t.length>0&&void 0!==t[0].value?t[0].value:e},advanced:function(){return 0!==this._findKey("advanced").length},relatedObjects:function(){return 0!==this._findKey("relatedObjects").length},clearConfigurations:function(){return 0!==this._findKey("clearConfigurations").length},setUseAdvanced:function(e){let t=!1;for(var i=0;i<this.dupOpts.length;i++)"advanced"===this.dupOpts[i].key&&(t=!0,!1===e&&!0!==this.dupOpts[i].usingAdvancedDuplicate||(this.dupOpts[i].usingAdvancedDuplicate=e));t||this.dupOpts.push({key:"advanced",value:!0,usingAdvancedDuplicate:e})},_findKey:function(e){return this.dupOpts.filter((function(t){return t.key===e}))}}))(t)},_updateOptionsFromViewModel:function(){if(this.simpleDupViewModel){var e=this._getOptionsHelper(this.duplicateOptions);e.setWholeStructure(this.simpleDupViewModel.includeChildren),e.setPrefix(this.simpleDupViewModel.text),e.setUseAdvanced(this.simpleDupViewModel.useAdvanced),this.duplicateOptions=e.dupOpts}},_getInputValidators:function(e){var t=this,i=e||0;return[{name:"illegalChars",validate:function(e){return t.strIsLegal(e)},getErrorInfo:function(e){return a.replace(a.illegalText,{illegalChars:t.illegalChars})}},{name:"maxChars",max:100,validate:function(e){return e.length+i<=this.max},getErrorInfo:function(e){return a.replace(a.dupTooLongTitle2,{max:this.max})},setTitleMaxLength:function(e){this.max=e}}]},_createAdvancedDuplicateTree:function(){var e=this;if(this.trackerEventBeginTime=Date.now(),!this.trackerEvent){let e={UXName:"Duplicate",numberObjects:0};this.trackerEvent=U.createInitActionEvent(e)}var t=new b({tenant:this.tenant,identifier:"duplicate",illegalChars:this.illegalChars,submitElement:this.okBtn,showError:this.showError.bind(this),getAuthoringMode:this._getAuthoringMode.bind(this),composeeOptions:{allExcludeComposeeTypes:this.duplicateCaps.allExcludeComposeeTypes||[],composeeIncludeOptions:this.duplicateCaps.composeeIncludeOptions||[]},metadata:{widgetId:I.getWidgetId(),appId:h._getAppId(widget)}});return this.advancedDuplicateTree=t,this.advancedDuplicateTree.immersiveFrame=this.immersiveFrame,e.dispatchEvent("AdvancedUIComponetCreated",t),this.debugMenuItems&&(t.debugMenuItems=this.debugMenuItems),t.addEvent("expandingStructure",(function(t){e.okBtn&&(e.okBtn.disabled=!0)})),t.addEvent("onTreeListCreated",(function(i){e._delayedMask&&e._delayedMask.unmask(),t.treeList.onInitialUpdateView().then((function(){t.initInvalidElements(),e.dispatchEvent("AdvancedUICreated",t);let i=e.trackerEventBeginTime?Date.now()-e.trackerEventBeginTime:0,n={UXMode:"Advanced",numberObjects:t.getTreeData().length,actionStatus:"success",actionTime:i};e.trackerEvent=U.createInitActionEvent(n,e.trackerEvent),U.checkAndTrackPageEvent(e.trackerEvent)})),t.translationService.translationFailure&&e.showNotification("Translation failed")})),this._createAlertBar(),t},_createAlertBar:function(){var e=(new S).inject(this._getDialogElement("advdup-content"),"top");E.addEvent("Lifecycle.Duplicate.Alert",(function(t){e.show(t)}))},_getSecurityContext:function(){return D.loadDefaultContexCredential({tenant:this.tenant,context:this.context})},_getSelectedSecurityContext:function(){return this.wintop?this.defSecCtxLoader:UWA.Class.Promise.resolve(this.credComboOrg.value?this.credComboOrg.value.ctx:"noCredentials")},getPADSessionPromise:function(){var e=this;return new UWA.Class.Promise((function(t,i){require(["DS/PADUtils/PADSession"],(function(i){e.hasRequestedPADSession=!0,e.PADSession=i,t(e.PADSession)}),(function(i){e.hasRequestedPADSession=!0,e.PADSession=null,t(e.PADSession)}))}))},_getPADSession:function(){return this.hasRequestedPADSession?UWA.Class.Promise.resolve(this.PADSession):this.getPADSessionPromise()},_getAuthoringMode:function(){if(this.context&&"function"==typeof this.context.isIndexMode)return UWA,Promise.resolve(!this.context.isIndexMode());var e=this;return new UWA.Class.Promise((function(t,i){widget&&h.isInPSEditorWidget(widget)?e._getPADSession().then((function(e){var i=!0;e&&(i=e.determineAuthoredFlag()),t(i)})):t(!0)}))},_createImmersiveFrame:function(e){var t="4046f1f2-6823-11e9-a923-1681be663d3e";window.c145ae486a7011e9a9231681be663d3e&&(t=void 0);var i=new r({identifier:t});i.dockingElements.forEach((function(e){e._properties.side.value===WUXDockAreaEnum.TopDockArea||e._properties.side.value==WUXDockAreaEnum.BottomDockArea?e._properties.dockingZoneSize.value=120:e._properties.side.value!==WUXDockAreaEnum.LeftDockArea&&e._properties.side.value!=WUXDockAreaEnum.RightDockArea||(e._properties.dockingZoneSize.value=230)}));var n=UWA.createElement("div",{class:"immersive-frame-parent"});return n.inject(e),i.inject(n),i},_openAccordion:function(e,t){var i=this;this.immersiveFrame||(this.immersiveFrame=this._createImmersiveFrame(t));var n=e.getContainer?e.getContainer():e.elements?e.elements.container:null;this.okBtn=n?n.querySelector(".btn-primary"):null,this.advancedDuplicateTree=this.advancedDuplicateTree||this._createAdvancedDuplicateTree(),this.advancedDuplicateTree.updateInvalidElements(),this.advancedDuplicateTree.updateSubmitBtnState(),this.defSecCtxLoader.then((async function(n){i.disableWholeStructureCheckbox(),i.setPrefixOrSuffixEditDisabledState(!0),i.inputValidation=i.inputValidation||new v(t,i._getInputValidators());var a=UWA.createElement("div",{class:"duplicate_tree_container"});if(t.appendChild(a),i.advRootContainer=e.getContainer?e.getContainer():e.elements?e.elements.container:null,i._hideShowOpts(i.advRootContainer,!0),i.loadedAdvancedUI)i.advancedDuplicateTree.launchCrossHighlightWithColor();else{i.loadedAdvancedUI=!0;let e=await i._getOrCreateTreeLoader();i.advancedDuplicateTree.loadUI({immersiveFrame:i.immersiveFrame,parentElement:a,securityContext:n,treeLoader:e,legacyExpand:i.completeLegacyExpandNodeData.bind(i.advancedDuplicateTree),clearConfigurations:i.duplicateCaps.clearConfigurations})}i._adjustDialogSizeLarge(e),e.centerIt(),i._adjustModalBody(!1),i.usingAdvancedDuplicate=!0,i.dispatchEvent("AdvancedUIModeChanged",i.usingAdvancedDuplicate)}))},_getOrCreateTreeLoader:async function(e){if(this.treeLoader&&(this.treeLoader.options.noFilter==e||!this.treeLoader.hasCachedFilteredExpand))return this.treeLoader;this.treeLoader&&this.dispatchEvent("TreeloaderDiscarded");let t=await this._getusev2expand();return this.treeLoader=new L({roots:this.roots,tenant:this.tenant,expandReqBuilder:new O(this.context,null,{useV2expand:t}),objId2ExpandProvider:this.obj2expandProviders,getAuthoringMode:this._getAuthoringMode.bind(this),noFilter:!!e,useV2expand:t}),this.dispatchEvent("onTreeLoaderCreated",this.treeLoader),this.treeLoader},_getusev2expand:async function(){return!0},_adjustDialogSizeLarge:function(e){var t=this._loadSize("advDupLarge"),i=this._getCurrentSize(e);this._storeSize("advDupSmall",i),e.setNewSize(t?{width:t.width,height:t.height}:{width:2*i.width,height:480}),this.commandDialog&&this.commandDialog.isWidgetMaximized()&&this.commandDialog.maximize(!0)},_adjustDialogSizeSmall:function(e){var t=this._loadSize("advDupSmall"),i=this._getCurrentSize(e);this._storeSize("advDupLarge",i),e.setNewSize(i?{width:t.width,height:t.height}:{})},_closeAccordion:function(e){this.commandDialog&&this.commandDialog.setPowermaximizeVisibility(!1),this._SimpleDupInputValidation&&this._SimpleDupInputValidation.updateValidation(),this.inputChecker=this.simpleDupInputChecker,this._hideShowOpts(this.advRootContainer,!1),this.enableWholeStructureCheckbox(),this.setPrefixOrSuffixEditDisabledState(!1),this._adjustDialogSizeSmall(e),e.centerIt(),this._adjustModalBody(!0),this.usingAdvancedDuplicate=!1,this.dispatchEvent("AdvancedUIModeChanged",this.usingAdvancedDuplicate),m.removeCrossHighlightWithColor({widgetId:I.getWidgetId(),appId:h._getAppId(widget)})},_getCurrentSize:function(e){var t=e.getModalBodySize();return t.height=e.getContainerHeight(),t},_saveDlgSize:function(){var e="advDupSmall";this.usingAdvancedDuplicate&&(e="advDupLarge");var t=this._getCurrentSize(this.dialog);this._storeSize(e,t)},_loadSize:function(e){var t=widget.getValue(e);return t?JSON.parse(t):null},_storeSize:function(e,t){widget.getValue(e)||widget.addPreference({name:e,type:"hidden",defaultValue:"{}"}),widget.setValue(e,JSON.stringify(t))},_onComplete:function(e){this.dispatchEvent("onComplete",{result:e}),m.removeCrossHighlightWithColor({widgetId:I.getWidgetId(),appId:h._getAppId(widget)}),this.wintop&&this._CloseWebInWinPanel()},_onCompleteWithoutClose:function(e){this.dispatchEvent("onComplete",{result:e})},_getDialogElement:function(e){return this.HTMLContent?this.HTMLContent.getElementsByClassName(e)[0]:null},getWholeStructureCheckbox:function(){return this._getDialogElement("lifecycle-option-wholeStructure")},getPrefixOrSuffixEdit:function(){var e=this._getDialogElement("lifecycle-option-suffix");return e||(e=this._getDialogElement("lifecycle-option-prefix")),e},enableWholeStructureCheckbox:function(){var e=this.getWholeStructureCheckbox();e&&(e.disabled=!1,e.checked=this.wholeStructureCheckboxSaved)},disableWholeStructureCheckbox:function(){var e=this.getWholeStructureCheckbox();e&&(e.disabled=!0,this.wholeStructureCheckboxSaved=e.checked,e.checked=!1)},_getOptions:function(e,t){return new UWA.Promise(((t,i)=>{this.commandManager.addEvent("onCompleteGetOptions",(function(e){let n=this.supportedObjects.length;if(this._updateSupportedObjectList(e.objects),0===this.supportedObjects.length){let e=n>1?a.noSupportedObjectsInSel:a.errDup3dpart;return this.closeWithError(e),void i(e)}void 0!==e.options&&e.options.forEach((function(e){"NLV"===e.key&&(this.NLVIntents=e.value)}),this),t(e)}),this);var n=this,o={data:e,command:"duplicate"};this.commandManager.getOptions(o,(function(e){n.closeWithError(e),i(e)}),this.context)}))},_getCapabilites:function(e,t){return new UWA.Promise((async(i,n)=>{let o=p.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/duplicate/capabilites",null),s=await this._getAuthoringMode(),r={data:e,command:"duplicate",validateInput:!0,authoring:s};u.post(o,JSON.stringify(r),{securityContext:t,timeout:3e5}).then((e=>{console.log("capabilites response:",e);let t=0,n=[],o=e.providers.filter((e=>e.capabilities.filter((e=>e.id==N.OperationCapabilites.Expand)).length>0)).map((e=>e.objectIds)),s=new Set(m.flattenArray(o)),r={providers:[],addPrefix:!1,advanced:!1,includeChildren:!1,includeChildrenDyn:!1,relatedObjects:!1,clearConfigurations:!1,allExcludeComposeeTypes:[],composeeIncludeOptions:[]};r.validationFailures=e.validationFailures,e.providers.forEach((e=>{let i={clearConfigurations:!1},o=new Map;if(e.capabilities.forEach((e=>{o.set(e.id,e)})),(o.has(N.OperationCapabilites.Expand)||e.objectIds.every((e=>s.has(e))))&&(i.advanced=!0,t++),o.has(N.OperationCapabilites.IncludeStructrualObjects)){i.includeChildren=!0,r.includeChildren=!0;let e=o.get(N.OperationCapabilites.IncludeStructrualObjects);e.haveDefault&&(r.includeChildrenDefaultValue=e.value)}if(o.has(N.OperationCapabilites.AddPrefix)){i.addPrefix=!0,r.addPrefix=!0;let e=o.get(N.OperationCapabilites.AddPrefix);e.haveDefault&&(r.defaultPrefix=e.value)}o.has(N.OperationCapabilites.RelatedObjects)&&(i.advanced=!0,t++),o.has(N.OperationCapabilites.ClearConfigurations)&&(i.clearConfigurations=!0,r.clearConfigurations=!0),o.has(N.OperationCapabilites.LegacyRelatedObjects)&&(i.relatedObjects=!0,r.relatedObjects=!0),o.has(N.OperationCapabilites.Include3DAndStructrualObjects)&&(i.includeChildrenDyn=!0,r.includeChildrenDyn=!0,r.includeChildrenLabelDyn=a.inc3DAndStrcuture),e.allExcludeComposeeTypes=e.allExcludeComposeeTypes||[],r.allExcludeComposeeTypes=r.allExcludeComposeeTypes.concat(e.allExcludeComposeeTypes.filter((e=>-1==r.allExcludeComposeeTypes.indexOf(e)))),e.composeeIncludeOptions=e.composeeIncludeOptions||[],r.composeeIncludeOptions=r.composeeIncludeOptions.concat(e.composeeIncludeOptions.filter((e=>-1==n.indexOf(JSON.stringify(e.types))))),e.composeeIncludeOptions.forEach((e=>n.push(JSON.stringify(e.types)))),i.expandProviderUUID=e.expandID,i.expandOpts=e.expandOptions,i.relatedObjectsProviderUUID=e.relatedObjectsID,i.objectIds=e.objectIds,i.providerClass=e.providerClass,r.providers.push(i)})),r.advanced=t>0&&t===e.providers.length,i(r)})).catch((e=>{console.log("capabilites error:"+e.errorMessage),this.showError(e.errorMessage)}))}))},setPrefixOrSuffixEditDisabledState:function(e){var t=this.getPrefixOrSuffixEdit();t&&(t.disabled=e)},setObjects:function(e){var t=this;if(this.data=e,0===e.length)throw a.noObject;var i=e[0];if(i.hasOwnProperty("physicalid")&&""===i.physicalid)throw a.epmtyPhysicalId;this.roots.push(i.physicalid),this.supportedObjects=e,this.multiselect=this.data.length>1,this.tenant=i.tenant,this.commandManager.setTenant(this.tenant),this.defSecCtxLoader=this._getSecurityContext(),this.credListLoader=C.loadCredentialsFromGetdgnctx(this.tenant);let n=null;this.defSecCtxLoader.then((t=>(n=t,this._getOptions(this.supportedObjects.length>0?this.supportedObjects:e,t)))).then((e=>(this.duplicateOptions=e.options,this._initIllegalCharMappings(),e.hasExtProviders&&e.hasExtProviders.length>0?this._getCapabilites(e.hasExtProviders,n):this._dupOptions2Caps(e.options)))).then((e=>{this.duplicateCaps=this.duplicateOptions.length>0?this._mergeOptionsAndCaps(this.duplicateOptions,e):e,this._createProviderMap(e);let i=Array.isArray(e.validationFailures)&&e.validationFailures.length>0;this.supportedObjects=this._filterInvalidObjects(this.supportedObjects,e.validationFailures),this.roots=this.supportedObjects.map((e=>e.physicalid)),0!==this.supportedObjects.length?(i&&this.showNotification(a.notSupportedRemoved),this.multiselect&&this._createMultiselDatagrid(),t.dispatchEvent("onReady")):i?this.closeWithError(e.validationFailures[0].errorMessage):this.closeWithError(a.noSupportedObjectsInSel)})).catch((e=>{console.log(e)}))},_createProviderMap(e){e.providers&&(this.obj2expandProviders=new Map,e.providers.forEach((e=>{e.objectIds.forEach((t=>{this.obj2expandProviders.has(t)||this.obj2expandProviders.set(t,[]),e.expandProviderUUID&&this.obj2expandProviders.get(t).push(e.expandProviderUUID)}))})))},_filterInvalidObjects(e,t){if(!Array.isArray(t))return e;for(const i of t){let t=i.objects.map((e=>e.pid));e=e.filter((e=>!t.includes(e.physicalid)))}return e},_initIllegalCharMappings:function(){this.haveVPMReference=this.supportedObjects.some((function(e){return"VPMReference"==e.type})),this.supportedObjects.forEach((e=>{var t=e.CADOrigin||"CATIAV5",i="";"CATIAV5"===t&&(i=":!"),this.IllegalCharMapping.addCADType(t,i)})),console.log("BEGIN: Getting illegal char mappings"),this.IllegalCharMapping.getMappings().then((e=>{console.log("END: Getting illegal char mappings"),this.illegalChars=e.find("CATIAV5")||""}))},_createMultiselDatagrid:function(){this.dgvContainer=new P({idName:"dgvContainer",clickToShowDGV:!1,onContextualEvent:function(e){if(e?.collectionView){let t={filter:!1,pin:!1,sizeColumnToFit:!1,columnsManagement:!1,firstColumnsVisibility:!0};return e.collectionView.buildDefaultContextualMenu(e,t)}}},this.supportedObjects)},_updateSupportedObjectList:function(e){if(!e)return;let t=e.filter((e=>e.IsOnceInstantiable)).map((e=>e.physicalid));this.supportedObjects=this.supportedObjects.filter((e=>!t.includes(e.physicalid)))},closeWithError:function(e){this.showError(e),this._onComplete()},_maskDialog:function(){var e=null;if(!this.wintop){var t=this.dialog.getContainer?this.dialog.getContainer():this.dialog.elements?this.dialog.elements.container:null;if(t){var i=t.querySelector("#enolcm-dup-simple-mainContainer");i&&(e=new c(UWA.extendElement(i),1e3,a.duplicatingText))}}return{unmask:function(){e&&e.unmask()}}},_generateDuplicateServiceReqPayload:function(){var e=this.getDuplicateData(),t=!1,i=!1;let n=[];return this.usingAdvancedDuplicate&&(t=this.advancedDuplicateTree.optionsModel.IncludeDrawings,i=this.advancedDuplicateTree.optionsModel.KeepConfig,n=this.advancedDuplicateTree.optionsModel.excludeComposeeTypes),{data:e,options:this.duplicateOptions,folderid:this.folderId,NLVEnabled:this.NLVIntents&&this.NLVIntents.length>0,includeDrawings:t,keepConfig:i,excludeComposeeTypes:n}},_executeDuplicate:function(){return new Promise(((e,t)=>{if(this.trackerEventBeginTime=Date.now(),this.verifySuffix()&&this.verifyPrefix()){if(!this.verifyTargetFolder())return this.showError(a.noFolderSelected),void t(a.noFolderSelected);var i=this._generateDuplicateServiceReqPayload(),n=this._maskDialog(),o=function(i,a){document.body.style.cursor="default",n.unmask(),i?e(a):t(a)},s=this;this._getSelectedSecurityContext().then((async function(e){return await s.duplicateServiceRequest(i,e,o)})).catch((function(e){var i=h.parseWebServiceError(e);s.showError(i),t(i)}))}else t()}))},getDuplicateOptionValue:function(e){for(var t=0;t<this.duplicateOptions.length;++t)if(this.duplicateOptions[t].key===e)return this.duplicateOptions[t].value},getDuplicateOptionNlsKey:function(e){for(var t=0;t<this.duplicateOptions.length;++t){if(this.duplicateOptions[t].key===e)return this.duplicateOptions[t].nlsKey.substring(0,this.duplicateOptions[t].nlsKey.length-1)}},strContainsNonASCII:function(e){if(e)for(var t=0;t<e.length;++t){if(e.charCodeAt(t)>127)return!0}return!1},strContainsIllegalChars:function(e,t){return!!(e&&I.commonChar(e,this.illegalChars,!0)>0)},strIsLegal:function(e){return!this.strContainsIllegalChars(e,this.illegalChars)},verifyDuplicationString:function(e,t){return null==e||(!!this.strIsLegal(e)||(this.showError(a.replace(a.illegalChar,{label:t,illegalChars:this.illegalChars})),!1))},verifySuffix:function(){var e=this.getDuplicateOptionValue("suffix"),t=this.getDuplicateOptionNlsKey("suffix");return!!this.verifyDuplicationString(e,t)&&(!this.strContainsNonASCII(e)||(this.showError(a.replace(a.nonAsciiChar,{label:t})),!1))},verifyPrefix:function(){return this.verifyDuplicationString(this.getDuplicateOptionValue("prefix"),this.getDuplicateOptionNlsKey("prefix"))},verifyTitle:function(e){if(!this.usingAdvancedDuplicate)return!0;var t=[...new Set(this.data.map((e=>e.type)))];return!e.some((function(e){return"duplicate"===e.operation&&!this.strIsLegal(e.title)}),this)||!t.some((function(e){return["VPMReference","3DShape","Drawing"].indexOf(e)>-1}))||(this.showError(a.replace(a.illegalTitle,{illegalChars:this.illegalChars})),!1)},getDuplicateData:function(){return this.usingAdvancedDuplicate?this.advancedDuplicateTree.getTreeNodesData():this.supportedObjects.map((e=>({physicalid:e.physicalid})))},showNotification:function(e,t){if(t=t||{},this.wintop)this.dispatchNotificationWebToWin(errorString,"warning");else if(this.context&&"function"==typeof this.context.displayNotification){var i={eventID:"string"==typeof t.type?t.type:"primary",msg:e,sticky:t.sticky||!1};this.context.displayNotification(i)}else alert(e)},showSuccess:function(e,t){if(this.wintop)this.dispatchNotificationWebToWin(e,"warning");else if(this.context&&"function"==typeof this.context.displayNotification){var i={eventID:"string"==typeof t?t:"success",msg:e};this.context.displayNotification(i)}else alert(e)},showError:function(e,t){if(t=t||{},this.wintop)console.log(e),this.dispatchNotificationWebToWin(e,"error");else if(this.context&&"function"==typeof this.context.displayNotification){var i={eventID:"error",msg:t.title||t.subtitle?t.submessage:e.message||e,title:t.title,subtitle:t.subtitle};this.context.displayNotification(i)}else alert(e)},dispatchNotificationWebToWin:function(e,t){this.webToWinCom_Socket.dispatchEvent("onDispatchToWin",{notif_name:"onDisplayErrorMessage",notif_parameters:{severity:t,message:e},recordable:!0},"lf_web_in_win")},_displayNotification:function(e){e.hasHtml=!0,g.displayNotification(e)},_getUseAsyncDuplicateService:async function(){if(widget&&void 0!==widget.lcmUseAsynDup)return widget.lcmUseAsynDup;let e=await this._getExpression("LifecycleUseAsyncDup");return widget&&(widget.lcmUseAsynDup=e),e},duplicateAsync:async function(e,t){let i=p.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/duplicate/start",null),n=await u.post(i,JSON.stringify(e),{securityContext:t}),a=new z,o=null;return o=await a.show({parent:widget.body,progressId:n.data,title:"Duplicate",securityContext:t,tenant:this.tenant,zIndex:5e4,closeConfirmFn:async e=>{let t=parseInt(e.getStyle("zIndex"));isNaN(t)?t=1e3:t+=1;let i=new B;return await i.create({container:widget.body,footer:WebUXDialogFooter.YesNo,title:"Duplicate",content:"Duplicate cannot be cancelled.<br>Do you want to close the dialog and let the operation continue in background?<br>You will receive a Dashboard notification when completed",zIndex:t})==WebUXDialogButton.Yes}}),console.log(o),o},createResultEventPayload:function(e,t){var i=this.getCreatedObjectsToDisplay(e),n={created:[],deleted:[],modified:[]};n.context=this.context;for(var a=this.selUtil.getAppSelectionRootPids(this.context),o=a.length>0,s=0;s<i.length;++s){var r={physicalid:i[s].physicalid,sourceObjectId:i[s].sourceid?i[s].sourceid:t.data[s].physicalid,operation:"Duplicate"},l=[this.folderId];if(r.folders=l,n.refreshFolder=!0,!o||o&&-1!==a.indexOf(r.sourceObjectId))n.created.push(r);else if(o){var c={physicalid:i[s].sourceid,operation:"Duplicate"};n.modified.push(c)}}return n},duplicateServiceRequest:async function(e,t,i){var n=this;if(this._updateOptionsFromViewModel(),await this._getUseAsyncDuplicateService()){try{let n=await this.duplicateAsync(e,t),a=this.createResultEventPayload(n,e);i(!0,a),this.dispatchModificationEvent(a)}catch(e){let t="error";e&&"cancel"==e.error?t=e.error:e&&e.isTimeout&&(t="timeout",this.showError("timeout")),i(!0,{error:t})}return}var o=6e5;if(e.notificationTimeout=600,this.trackerNumberObjects=e.data?e.data.length:0,!this.trackerEvent){let e={UXName:"Duplicate",numberObjects:this.trackerNumberObjects};this.trackerEvent=U.createInitActionEvent(e)}let s="";e.options&&e.options.forEach((e=>{"Advanced"===e.nlsKey&&!0===e.usingAdvancedDuplicate&&(s="Advanced")}));var r=p.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/duplicate/structure"),l=p.getHeaders(t);document.body.style.cursor="wait";M.enrichRequestWithMetrics(e,{UXName:"Duplicate"}),d.authenticatedRequest(r,{method:"POST",headers:l,timeout:o,onComplete:function(t){if(null!=t&&t.hasOwnProperty("status")){var o;if("failure"===t.status)return o=t.hasOwnProperty("report")&&0!==t.report.length?t.report[0].error:a.duplicateFailed,n.showError(o),void i(!1,o);n.showSuccess(a.duplicateSuccessful),t.hasOwnProperty("report")&&0!==t.report.length&&(t.report[0].error?n.showNotification(t.report[0].error):t.report[0].warning&&n.showNotification(t.report[0].warning))}let r=n.createResultEventPayload(t.results,e),l=n.trackerEventBeginTime?Date.now()-n.trackerEventBeginTime:0,c={UXMode:void 0,numberObjects:e.data?e.data.length:0,actionStatus:"success",actionTime:l};s&&(c.UXMode=s),t.results&&Array.isArray(t.results[0])&&(c.pv16=t.results[0].length),n.trackerEvent=U.createValidationEventFromEvent(c,n.trackerEvent),U.checkAndTrackPageEvent(n.trackerEvent),i(!0,r),n.dispatchModificationEvent(r)},data:JSON.stringify(e),onFailure:function(t,o){i(!1,t),h.showWebServiceError(t,o,(function(t,i){if(i){n.showNotification(a.notificationTimeoutInfo,{sticky:!0});let t=n.trackerEventBeginTime?Date.now()-n.trackerEventBeginTime:0,i={numberObjects:e.data?e.data.length:0,actionStatus:"running_on_backend",actionTime:t};n.trackerEvent=U.createValidationEventFromEvent(i,n.trackerEvent),U.checkAndTrackPageEvent(n.trackerEvent)}else{n.showError(a.duplicateFailed+"<br>"+t);let i=n.trackerEventBeginTime?Date.now()-n.trackerEventBeginTime:0,o={numberObjects:e.data?e.data.length:0,actionStatus:"failure",actionTime:i};n.trackerEvent=U.createValidationEventFromEvent(o,n.trackerEvent),U.checkAndTrackPageEvent(n.trackerEvent)}}),!0),console.log("Duplicate failed:",t,o)},onTimeout:function(){var t=a.notificationTimeoutInfo;i(!1,t);let o=n.trackerEventBeginTime?Date.now()-n.trackerEventBeginTime:0,s={numberObjects:e.data?e.data.length:0,actionStatus:"running_on_backend",actionTime:o};n.trackerEvent=U.createValidationEventFromEvent(s,n.trackerEvent),U.checkAndTrackPageEvent(n.trackerEvent),n.showNotification(a.notificationTimeoutInfo,{sticky:!0}),console.log("Duplicate: Timeout error")},type:"json"})},dispatchModificationEvent:function(e){E.dispatchEvent("onModification",e)},isDerivedFrom:function(e,t){if(void 0===t)return!1;var i=t["attribute[PLMReference.V_DerivedFrom]"],n=t.derivedFromPhysicalid;return i===e||n===e||t.sourceid===e},getCreatedObjectsToDisplay:function(e){for(var t=this,i=[],n=0;n<e[0].length;n++){var a=e[0][n];a.isRoot&&!0===a.isRoot?i.push(a):this.supportedObjects.forEach((function(e){t.isDerivedFrom(e.physicalid,a)&&i.push(a)}))}return 0===i.length&&i.push(e[0][0]),i},_hideShowOpts:function(e,i){var n=this,a=function(e,t,i){if(n.idns){var a=n.idns.getElById(e);a&&a.setStyle(t,i)}};i?(e&&e.classList.add("advanced-mode"),t(e).find(".simpdup-option").slideUp(300,(function(){t(this).removeClass("simpdup-option").addClass("lifecycle-option-hidden"),n.dispatchEvent("optionsHidden")})),t(e).find(".duplicate_popup_text").slideUp(300),t(e).find("#dgvContainer").slideUp(300),a("advanced-content","display","block"),a("expander","display","none"),a("collapser","display","block")):(e&&e.classList.remove("advanced-mode"),t(e).find(".lifecycle-option-hidden").slideDown(150,(function(){t(this).addClass("simpdup-option").removeClass("lifecycle-option-hidden")})),t(e).find(".duplicate_popup_text").slideDown(150),t(e).find("#dgvContainer").slideDown(150),a("advanced-content","display","none"),a("expander","display","block"),a("collapser","display","none"))},anyRootHasFilter:function(){let e=null;e=this.context&&this.context._biFilter&&this.context._biFilter.hasFilter?this.context._biFilter.hasFilter.bind(this.context._biFilter):this.context&&this.context.hasFilter?this.context.hasFilter.bind(this.context):()=>!1;let t=!1;return this.roots.forEach((i=>{let n=e(i);t||(t=n&&n.hasFilter)})),this.anyRootHasFilter=()=>t,t},_getProjects:async function(e){let t=await this._getSelectedSecurityContext(),i={data:e,attributes:["project"]},n=p.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/product/attributeList",null),a=await u.post(n,JSON.stringify(i),{securityContext:t}),o=a.results.filter((e=>!this.warningInfoData.allCS.includes(e.project))).map((e=>e.project));return console.log("Unknown projects: "+o),await this._updateCSLists(o),a},_updateCSLists:async function(e){if(0==e.length)return;let t=await this._getSelectedSecurityContext(),i={CollabSpaces:[...new Set(e)]},n=p.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/util/getCSState",null),a=(await u.post(n,JSON.stringify(i),{securityContext:t})).data.filter((e=>!e.IsError)),o=a.filter((e=>e.IsPrivate)).map((e=>e.CSRole));this.warningInfoData.allCS=this.warningInfoData.allCS.concat(a.map((e=>e.CSRole))),this.warningInfoData.privatCS=this.warningInfoData.privatCS.concat(o)},_getStructureObjectsInPrivateCS:async function(e){let t=await this._getSelectedSecurityContext(),i=await this._getOrCreateTreeLoader(e),n=await i.expand(t,e),a=[],o=[],s=[];if(n.assemblies.forEach((e=>{o=o.concat(e.nodes.filter((e=>null!=e.project&&!this.warningInfoData.allCS.includes(e.project))).map((e=>({project:e.project}))))})),console.log(o.length+" unknown collab spaces found"),await this._updateCSLists(o.map((e=>e.project))),n.assemblies.forEach((e=>{s=s.concat(e.nodes.filter((e=>this.warningInfoData.privatCS.includes(e.project))).map((e=>e.physicalid))),a=a.concat(e.nodes.filter((e=>null==e.project)).map((e=>({physicalid:e.physicalid}))))})),a.length>0){let e=(await this._getProjects(a)).results.filter((e=>this.warningInfoData.privatCS.includes(e.project))).map((e=>e.physicalid));s=s.concat(e)}return s},_getCSWarningsEnabled:async function(){return await this._getExpression("LifecycleConfidentialityEnabled")},_getExpression:async function(e){let t=await this._getSelectedSecurityContext(),i=await u.get("/resources/lifecycle/util/getExpression",{tenant:this.tenant,securityContext:t,params:{expression:e}});return!!i.result&&"true"==i.result.toLowerCase()},_showCSWarning:function(e){e?this.rootGrid.addClassName("lcm-duplicate-root-grid-warning-visible"):this.rootGrid.removeClassName("lcm-duplicate-root-grid-warning-visible")},_updateCollabSpaceWarning:async function(){console.log("_updateCollabSpaceWarning");let e=!1;this.credComboOrg&&this.credComboOrg.value&&(e=this.credComboOrg.value.isPrivate);let t=this.duplicateCaps.includeChildren&&this.simpleDupViewModel.includeChildren,i=this.usingAdvancedDuplicate?"advanced":"basic";if(this.warningInfoData||(this.warningInfoData={isTargetCSPrivate:e,incChildren:t,mode:"basic",warningVisible:!1,initialized:!1},this.warningInfoData.enabled=await this._getCSWarningsEnabled(),this.warningInfoData.allCS=this.allCredentials.map((e=>e.cs)),this.warningInfoData.privatCS=this.allCredentials.filter((e=>e.isPrivate)).map((e=>e.cs)),console.log("Private CS list:"+this.warningInfoData.privatCS),this.addEvent("TreeloaderDiscarded",(()=>{this.warningInfoData.objectsInPrivateCSBasic=this.warningInfoData.objectsInPrivateCS,this.warningInfoData.objectsInPrivateCS=null}))),!this.warningInfoData.enabled)return void console.log("Disabled - exiting");if(this.warningInfoData.initialized&&this.warningInfoData.isTargetCSPrivate===e&&this.warningInfoData.incChildren===t&&this.warningInfoData.mode===i)return void console.log("State unchanged - exiting");console.log("Target is private:"+e),console.log("Include children:"+t),console.log("UI mode:"+i);var n=this.dialog.elements.footer.querySelector("button.btn-primary");let o=!1;if(t||"advanced"==i){if("advanced"!=i&&this.warningInfoData.objectsInPrivateCSBasic?(this.warningInfoData.objectsInPrivateCSAdvanced=this.warningInfoData.objectsInPrivateCS,this.warningInfoData.objectsInPrivateCS=this.warningInfoData.objectsInPrivateCSBasic):this.warningInfoData.objectsInPrivateCSAdvanced&&(this.warningInfoData.objectsInPrivateCS=this.warningInfoData.objectsInPrivateCSAdvanced),!this.warningInfoData.objectsInPrivateCS)try{let e=null;"advanced"==i&&(n.disabled=!0,e=new c(this.rootGrid,1e3,a.loadingText)),this.loadStructurePromise=this._getStructureObjectsInPrivateCS("advanced"!=i),this.warningInfoData.objectsInPrivateCS=await this.loadStructurePromise,this.loadStructurePromise=null,"advanced"==i&&(e.unmask(),n.disabled=!1),console.log("Num objects in private CS: "+this.warningInfoData.objectsInPrivateCS.length)}catch(e){console.log("error loading tree:"+e)}o=this.warningInfoData.objectsInPrivateCS&&this.warningInfoData.objectsInPrivateCS.length>0&&!e}else{if(!this.warningInfoData.rootsInPrivateCS){var s=n.disabled;s||(n.disabled=!0);let e=new c(this.rootGrid,1e3,a.loadingText),t=await this._getProjects(this.supportedObjects);e.unmask(),console.log("projects:"+t),this.warningInfoData.rootsInPrivateCS=t.results.filter((e=>this.warningInfoData.privatCS.includes(e.project))),console.log("Num roots in private CS:"+this.warningInfoData.rootsInPrivateCS.length),s||(n.disabled=!1)}o=this.warningInfoData.rootsInPrivateCS.length>0&&!e}o!=this.warningInfoData.warningVisible&&(o?(console.log("Show CS warning"),this._showCSWarning(!0)):(console.log("Remove CS warning"),this._showCSWarning(!1))),o&&"advanced"==i&&!this.warningInfoData.setAdvObjs&&(this.advancedDuplicateTree.setObjsInPrivateCS(o?this.warningInfoData.objectsInPrivateCS:[]),this.warningInfoData.setAdvObjs=!0),this.warningInfoData.isTargetCSPrivate=e,this.warningInfoData.incChildren=t,this.warningInfoData.warningVisible=o,this.warningInfoData.mode=i,this.warningInfoData.initialized=!0},completeLegacyExpandNodeData:async function(e,t,i,n){var o=this;let s=!this.options.getAuthoringMode||await this.options.getAuthoringMode();var r=p.get3DSpaceWSUrl(o.tenant,"/resources/lifecycle/duplicate/info",null),l={ids:e,attributes:["type","physicalid","attribute[PLMEntity.V_usage]","attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]","attribute[PLMCoreRepReference.V_isOnceInstantiable]","type.kindof[BundleFastenerAbstract]"],childAttributes:["type","physicalid","attribute[PLMEntity.V_usage]","attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]","attribute[PLMCoreRepReference.V_isOnceInstantiable]","attribute[PLMEntity.V_Name]","type_icon_url","stateNls","typeNls","revision"],getDesignTables:!0,getSpecificationDocs:!0,useIndex:!s};y.post(r,l,{chunkMember:"ids",securityContext:o.securityContext,timeout:6e5}).then((function(e){var n=function(e,t){var i=t.attributes.filter((function(t){return t.name===e}));return i.length>0?i[0].value:""};e&&e.forEach((function(e){var a=t.get(e.physicalid)||[];let s,r,l=[];e.children.forEach((function(e){if(e.Title=n("attribute[PLMEntity.V_Name]",e),""==e.Title&&(e.Title=n("ds6w:label",e)),o.initTreeNode(e),e.revision=n("revision",e),""==e.revision&&(e.revision=n("ds6wg:revision",e)),e.type=n("typeNls",e),e.typeRaw=n("type",e),e.state=n("current",e),e.maturityNls=n("stateNls",e),""==e.state){let t=n("ds6w:status",e),i=t.split(".");e.state=2===i.length?i[1]:t}n("type_icon_url",e)?e.type_icon_url=p.get3DSpaceWSUrl(o.tenant,n("type_icon_url",e),null):e.type_icon_url=n("icon",e),e.defaultAction=EnoTreeNodeAction.Reuse,"SpecificationDocument"===e.reltype?(e.supportedActionsV5=[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Reuse,EnoTreeNodeAction.Exclude],e.supportedActions=[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Reuse,EnoTreeNodeAction.Exclude]):(e.supportedActionsV5=[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Reuse],e.supportedActions=[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Reuse]),o.model._addType(e.typeRaw,e.type),o.model._addState(e.state,e.maturityNls),l.push(e)}));let c=null;"3DPart"===n("attribute[PLMEntity.V_usage]",e)&&"3DShape"===e.type||"TRUE"===n("attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]",e)?(s=!0,"TRUE"===n("attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]",e)&&(r=!0)):"TRUE"===n("attribute[PLMCoreRepReference.V_isOnceInstantiable]",e)?s=!0:("DIFLayout"===n("type",e)||"DIFSheet"===n("type",e)||"TRUE"===n("type.kindof[BundleFastenerAbstract]",e))&&(c=[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Exclude]),a.forEach((t=>{l.forEach((e=>{o._addChildToAssembly(t.assembly,t.node.nodeid,e,i)})),t.node.typeRaw=e.type,void 0!==s&&(t.node.connectToParent=s),void 0!==r&&(t.node.isEmbeddedComponent=r),c&&(t.node.supportedActions=c)}))})),o.createAdvancedTree()})).catch((function(e){console.error("completeLegacyExpandNodeData error:",e),o.options&&o.options.showError&&o.options.showError(a.expandFailed+": "+(e?e.error?e.error:e:""))}))}})})),define("DS/DuplicateWidget/DuplicateComponentWidget",["DS/DuplicateWidget/DuplicateWidget","DS/LifecycleServices/LifecycleServices"],(function(e,t){"use strict";return e.extend({widgetTitle:null,isDuplicateAdvAllowed:!1,init:function(e,t,i){console.log("init de DuplicateComponentWidget"),this._parent(e,t,i)},executeCmd:function(i,n){this.widgetTitle=n.title;var a=this;n.duplicateAdvanced&&(this.isDuplicateAdvAllowed=!0),e.prototype.executeCmd.bind(this)(i,n,(function(e){if(n.loadObjectsName){if(e&&e.result&&e.result.created){var i=[];for(let t of e.result.created)i.push(t.physicalid),i.push(t.sourceObjectId);t.listAttributesPromise(a.tenant,i,["attribute[PLMEntity.V_Name]"]).then((t=>{if(console.log(t),t.results)for(let i of t.results)for(let t of e.result.created)t.physicalid==i.physicalid?t.name=i.displayName:t.sourceObjectId==i.physicalid&&(t.sourceObjectName=i.displayName);"function"==typeof n.onCompletedCallback&&n.onCompletedCallback(e)}))}}else"function"==typeof n.onCompletedCallback&&n.onCompletedCallback(e)}))},_createDialogTitle:function(t){return this.widgetTitle?this.widgetTitle+t:e.prototype._createDialogTitle(t)},isDuplicateAdvancedAllowed:function(){return this.isDuplicateAdvAllowed}})}));