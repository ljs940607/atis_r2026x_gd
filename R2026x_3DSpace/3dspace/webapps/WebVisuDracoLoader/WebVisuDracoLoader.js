define("DS/WebVisuDracoLoader/DracoLoader",["DS/Visualization/ThreeJS_DS","DS/WAFData/WAFData","DS/WebappsUtils/WebappsUtils"],(function(e,r,t){return e.DRACOLoader=function(){this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}},e.DRACOLoader.prototype=Object.create({constructor:e.DRACOLoader,setDecoderPath:function(e){return this.decoderPath=e,this},setDecoderConfig:function(e){return this.decoderConfig=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},load:function(r,t,a,o){var i=new e.FileLoader(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),"use-credentials"===this.crossOrigin&&i.setWithCredentials(!0),i.load(r,(e=>{var r={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,r).then(t).catch(o)}),a,o)},decodeGeometry:function(r,t){for(var a in t.attributeTypes){var o=t.attributeTypes[a];void 0!==o.BYTES_PER_ELEMENT&&(t.attributeTypes[a]=o.name)}var i,s=JSON.stringify(t);if(e.DRACOLoader.taskCache.has(r)){var n=e.DRACOLoader.taskCache.get(r);if(n.key===s)return n.promise;if(0===r.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var d=this.workerNextTaskID++,c=r.byteLength,l=this._getWorker(d,c).then((e=>(i=e,new Promise(((e,a)=>{i._callbacks[d]={resolve:e,reject:a},i.postMessage({type:"decode",id:d,taskConfig:t,buffer:r},[r])}))))).then((e=>this._createGeometry(e.geometry)));return l.finally((()=>{i&&d&&this._releaseTask(i,d)})),e.DRACOLoader.taskCache.set(r,{key:s,promise:l}),l},_createGeometry:function(r){let t=null;var a=new e.BufferGeometryDS;r.index&&(a.vertexIndexArray=r.index.array,t=r.index.array.length);for(var o=0;o<r.attributes.length;o++){var i=r.attributes[o],s=i.name,n=i.array;if("normal"===s&&(a.vertexNormalArray=n),"position"===s&&(a.vertexPositionArray=n,null===t&&(t=n.length/i.itemSize)),"uv"===s){const e=n.length/2,r=new Float32Array(3*e);for(let t=0;t<e;t++)r[3*t]=n[2*t],r[3*t+1]=n[2*t+1],r[3*t+2]=0;a.vertexUvArray=r}}return{geometry:a,count:t}},_loadLibrary:function(e,t){return new Promise(((a,o)=>{r.request(e,{async:!0,responseType:t,onComplete:a,onFailure:o})}))},preload:function(){return this._initDecoder(),this},_initDecoder:function(){if(this.decoderPending)return this.decoderPending;var r="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,a=[];return r?a.push(this._loadLibrary(t.getWebappsAssetUrl("WebVisuDracoLib","draco_decoder.js"),"text")):(a.push(this._loadLibrary(t.getWebappsAssetUrl("WebVisuDracoLib","draco_wasm_wrapper.js"),"text")),a.push(this._loadLibrary(t.getWebappsAssetUrl("WebVisuDracoLib","draco_decoder.wasm"),"arraybuffer"))),this.decoderPending=Promise.all(a).then((t=>{var a=t[0];r||(this.decoderConfig.wasmBinary=t[1]);var o=e.DRACOLoader.DRACOWorker.toString(),i=["/* draco decoder */",a,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i]))})),this.decoderPending},_getWorker:function(e,r){return this._initDecoder().then((()=>{var t;this.workerPool.length<this.workerLimit?((t=new Worker(this.workerSourceURL))._callbacks={},t._taskCosts={},t._taskLoad=0,t.postMessage({type:"init",decoderConfig:this.decoderConfig}),t.onmessage=function(e){var r=e.data;switch(r.type){case"decode":t._callbacks[r.id].resolve(r);break;case"error":t._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(t)):this.workerPool.sort((function(e,r){return e._taskLoad>r._taskLoad?-1:1}));return(t=this.workerPool[this.workerPool.length-1])._taskCosts[e]=r,t._taskLoad+=r,t}))},_releaseTask:function(e,r){e._taskLoad-=e._taskCosts[r],delete e._callbacks[r],delete e._taskCosts[r]},debug:function(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))},dispose:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}),e.DRACOLoader.DRACOWorker=function(){var e,r;function t(e,r,t,a,o,i){var s,n,d=i.num_components(),c=t.num_points()*d;switch(o){case Float32Array:var l=4*c;s=e._malloc(l),r.GetAttributeDataArrayForAllPoints(t,i,e.DT_FLOAT32,l,s),n=new Float32Array(e.HEAPF32.buffer,s,c).slice(),e._free(s);break;case Int8Array:s=e._malloc(c),r.GetAttributeDataArrayForAllPoints(t,i,e.DT_INT8,c,s),n=new Int8Array(e.HEAP8.buffer,s,c).slice(),e._free(s);break;case Int16Array:l=2*c;s=e._malloc(l),r.GetAttributeDataArrayForAllPoints(t,i,e.DT_INT16,l,s),n=new Int16Array(e.HEAP16.buffer,s,c).slice(),e._free(s);break;case Int32Array:l=4*c;s=e._malloc(l),r.GetAttributeDataArrayForAllPoints(t,i,e.DT_INT32,l,s),n=new Int32Array(e.HEAP32.buffer,s,c).slice(),e._free(s);break;case Uint8Array:s=e._malloc(c),r.GetAttributeDataArrayForAllPoints(t,i,e.DT_UINT8,c,s),n=new Uint8Array(e.HEAPU8.buffer,s,c).slice(),e._free(s);break;case Uint16Array:l=2*c;s=e._malloc(l),r.GetAttributeDataArrayForAllPoints(t,i,e.DT_UINT16,l,s),n=new Uint16Array(e.HEAPU16.buffer,s,c).slice(),e._free(s);break;case Uint32Array:l=4*c;s=e._malloc(l),r.GetAttributeDataArrayForAllPoints(t,i,e.DT_UINT32,l,s),n=new Uint32Array(e.HEAPU32.buffer,s,c).slice(),e._free(s);break;default:throw new Error("THREE.DRACOLoader: Unexpected attribute type.")}return{name:a,array:n,itemSize:d}}onmessage=function(a){var o=a.data;switch(o.type){case"init":e=o.decoderConfig,r=new Promise((function(r){e.onModuleLoaded=function(e){r({draco:e})},DracoDecoderModule(e)}));break;case"decode":var i=o.buffer,s=o.taskConfig;r.then((e=>{var r=e.draco,a=new r.Decoder,n=new r.DecoderBuffer;n.Init(new Int8Array(i),i.byteLength);try{var d=function(e,r,a,o){var i,s,n=o.attributeIDs,d=o.attributeTypes,c=r.GetEncodedGeometryType(a);if(c===e.TRIANGULAR_MESH)i=new e.Mesh,s=r.DecodeBufferToMesh(a,i);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");i=new e.PointCloud,s=r.DecodeBufferToPointCloud(a,i)}if(!s.ok()||0===i.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+s.error_msg());var l={index:null,attributes:[]};for(var u in n){var f,h,y=self[d[u]];if(o.useUniqueIDs)h=n[u],f=r.GetAttributeByUniqueId(i,h);else{if(-1===(h=r.GetAttributeId(i,e[n[u]])))continue;f=r.GetAttribute(i,h)}l.attributes.push(t(e,r,i,u,y,f))}if(c===e.TRIANGULAR_MESH){var A=3*i.num_faces(),b=4*A,D=e._malloc(b);r.GetTrianglesUInt32Array(i,b,D);var _=new Uint32Array(e.HEAPU32.buffer,D,A).slice();e._free(D),l.index={array:_,itemSize:1}}return e.destroy(i),l}(r,a,n,s),c=d.attributes.map((e=>e.array.buffer));d.index&&c.push(d.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:d},c)}catch(e){console.error(e),self.postMessage({type:"error",id:o.id,error:e.message})}finally{r.destroy(n),r.destroy(a)}}))}}},e.DRACOLoader.taskCache=new WeakMap,e.DRACOLoader}));