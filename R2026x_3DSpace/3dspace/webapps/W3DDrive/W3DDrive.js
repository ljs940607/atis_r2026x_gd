define("DS/W3DDrive/Metas/DSDrive/inode",["DS/W3DContentApp/Metas/inode","DS/PlatformAPI/PlatformAPI"],(function(e,t){"use strict";return function(){var n=e();Object.assign(n.ids,{root:"DSROOT",sharedWithMe:"sharedwithme",trash:"TRASH",recents:"recents",favorites:"favorites"}),Object.assign(n.mimeType,{folder:"application/folder",labeled:"application/labeled"}),Object.assign(n.actionPubIds,{giveReadAccess:"giveReadAccess",giveEditAccess:"giveEditAccess",giveShareAccess:"giveShareAccess",shareLink:"share.link"}),n.boType={folder:"DriveFolder",document:"DriveFile"};const i=Number(t.getApplicationConfiguration("app.3ddrive.uploadMaxFileSize"));return n.constants={maxFileSize:Number.isInteger(i)?i:1073741824},n}})),define("DS/W3DDrive/initWidget",["DS/WebAppsFoundations/Views/CollectionView","DS/vue/vue","DS/vuekit/vuekit","DS/TransientWidget/TransientWidget","css!DS/W3DContentApp/W3DContentApp.css","css!DS/W3DDriveApp/W3DDriveApp.css"],(function(e,t,n,i){"use strict";return function(e){function o(t,n){return"string"==typeof t&&(n!==e.getValue(t)?(e.setValue(t,n),!0):void 0)}return t.use(n),e.hasPreference("isInodePanelSideBarOpened")||e.addPreference({name:"isInodePanelSideBarOpened",type:"hidden",label:"InodePanelView SideBar opened state",defaultValue:"`false`"}),e.hasPreference("isDrivePanelSideBarCollapsed")||e.addPreference({name:"isDrivePanelSideBarCollapsed",type:"hidden",label:"DrivePanelView SideBar opened state",defaultValue:"`false`"}),e.hasPreference("inodeTableLayoutKey")||e.addPreference({name:"inodeTableLayoutKey",type:"hidden",label:"selected inodeTableLayout layout",defaultValue:"listLayout"}),e.hasPreference("inodeDetailViewKey")||e.addPreference({name:"inodeDetailViewKey",type:"hidden",label:"selected inodeDetailView tab",defaultValue:"inode-detail-properties"}),"true"===e.getValue("is3DSpaceWidget")||i.isWidgetOpen()||e.addPreference({type:"list",name:"selectedPlatform",label:"3DEXPERIENCE Platform",options:[]}),e.setValue("3ddrive_uuid","W-"+function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}()),e.setValue("tenantAware",!0),e.addEvents({onToggleInodePanelSideBarVisibility:function(){var t=!e.getBool("isInodePanelSideBarOpened");e.setValue("isInodePanelSideBarOpened",t),e.dispatchEvent("onInodePanelSideBarVisibilityToggled",t)},onToggleLightboxPropertiesVisibility:function(){e.dispatchEvent("onToggleLightboxPropertiesVisibilityToggled")},onToggleDrivePanelSideBarCollapsed:function(){var t=!e.getBool("isDrivePanelSideBarCollapsed");e.setValue("isDrivePanelSideBarCollapsed",t),e.dispatchEvent("onDrivePanelSideBarCollapsedToggled",t)},onUpdateInodeTableLayoutKey:function(t){o("inodeTableLayoutKey",t)&&e.dispatchEvent("onInodeTableLayoutKeyUpdated",t)},onUpdateInodeDetailViewKey:function(t){var n="inodeDetailViewKey";e.getValue(n)!==t&&o(n,t)},onViewChange:function(e){e&&"fullscreen"===e.type?document.body.querySelector(".moduleContent").addClassName("fullscreen"):document.body.querySelector(".moduleContent").removeClassName("fullscreen")}}),e}})),define("DS/W3DDrive/Utils/StructureNavigation",["DS/W3DContentApp/Utils/Helpers"],(function(e){"use strict";return{filesAreEqual:function(e,t){if(!e||!t)return!1;return e.name===t.name&&e.size===t.size&&e.lastModified===t.lastModified},hasRelations:t,isLinkedFile:function(e){if("object"!=typeof e||Array.isArray(e)||!e.isContainer||!e.drive)return!1;if(e.isContainer())return!1;return t(e)&&e.drive.isDsDrive},isPart:function(e){if("object"!=typeof e||Array.isArray(e)||!e.isContainer||!e.drive)return!1;if(e.isContainer())return!1;return e.drive.isDsDrive&&n({inode:e,extensions:["sldprt","catpart"]})},isSupportedBy3DPlay:function(t){var i=["CATProduct","gml","stpx","stpxz"];"true"===e.getAppBehaviour("FUN115463_step")&&(i.push("stp"),i.push("step"),i.push("stpz"));"true"===e.getAppBehaviour("FUN122525_dwg")&&(i.push("dwg"),i.push("dxf"));return n({inode:t,extensions:i})}};function t(t){var i=["CATProduct","sldasm","gml","stpx","stpxz","dwg","dxf"];return"true"===e.getAppBehaviour("FUN115463_step")&&(i.push("stp"),i.push("step"),i.push("stpz")),n({inode:t,extensions:i})}function n(e){if(void 0===e)throw"isExtensionAllowed takes an object options as parameter";if(void 0===e.extensions)throw'isExtensionAllowed takes an array of extensions as "options.extensions"';if(void 0===e.inode)throw'isExtensionAllowed takes an object/string to compare the extension as "options.inode"';var t=e.extensions,n=e.inode,i="",o=new RegExp(t.join("|"),"i");if("string"==typeof n){var a=n.lastIndexOf(".")+1;i=n.substr(a)}else i=n.get("fileExtension");return!(!i||!i.search)&&i.search(o)>-1}})),define("DS/W3DDrive/Utils/errors",["DS/W3DContentApp/Utils/Helpers","i18n!DS/W3DDrive/assets/nls/W3DDrive"],(function(e,t){"use strict";function n(){var e=Error.apply(this,arguments);e.name=this.name=this.constructor.name,this.stack=e.stack,this.message=e.message}return n.prototype=Object.create(Error.prototype,{constructor:{value:n,writtable:!0,configurable:!0}}),{createUploadFileSizeError:function(i){var o=e.computeNLSSize(i.constants.maxFileSize);return new n(t.replace(t.maxSize,{size:o}))},createUploadFileSizeErrorDSDrive:function(i){var o=e.computeNLSSize(i.constants.maxFileSize);return new n(t.replace(t.maxSizeDSDrive,{size:o}))},createUploadFileNameErrorDSDrive:function(e){return new n(t.replace(t.uploadUnsupportedChar,{character:e}))},UploadError:n}})),define("DS/W3DDrive/Actions/download",["UWA/Promise","UWA/Utils","UWA/Utils/Client"],(function(e,t,n){"use strict";return function(e,i,o){if(e){if("GET"===(i=i||"POST")){if(window.navigator.msSaveOrOpenBlob)return void window.open(e,"_blank");var a=document.createElement("a"),r=function(e){e.stopPropagation(),document.body.removeChild(a),a.removeEventListener("click",r)};return a.href=e,a.target="_blank",a.download=o.get("title"),a.addEventListener("click",r),document.body.appendChild(a),void a.click()}var s,c=document.createElement("form");if(c.style.display="none",c.method=i,n.Platform.hasOwnProperty("ios")&&n.Platform.ios&&((s=navigator.userAgent.match(/OS (\d+)_(\d+)_?(\d+)?/))?s[1]:null)<13&&(c.target="_blank"),-1!==e.indexOf("?")){var l=t.parseQuery(e);Object.keys(l).reduce((function(e,t){var n=document.createElement("input");return n.setAttribute("name",t),n.setAttribute("value",l[t]),e.appendChild(n),e}),c)}c.action=e.substring(0,e.indexOf("?")),document.body.appendChild(c),c.submit()}}})),define("DS/W3DDrive/widget",["DS/W3DDrive/initWidget","UWA/Class/Events"],(function(e,t){"use strict";return e(t.extend({preferences:{},events:{},getValue:function(e){if(void 0!==this.data[e])return this.data[e]},data:{appId:"fakeAppId"},setTitle:function(){},getBool:function(e){return this.getValue(e)},setValue:function(e,t){this.data[e]=t},hasPreference:function(e){return!!this.getValue(e)},addPreference:function(e){"`false`"===e.defaultValue&&(e.defaultValue=!1),this.setValue(e.name,e.defaultValue)},setBody:function(e){this.body=e}}).singleton())})),define("DS/W3DDrive/w3DDriveMainView",["UWA/Class/Events","DS/W3DDrive/widget","DS/i3DXCompassServices/i3DXCompassPubSub"],(function(e,t,n){"use strict";var i=e.extend({_targetElement:null,_w3ddriveAppElement:null,_selectedFilesIn3DDrive:[],init:function(e){this._subscribeToCompassEvent(),t.showAllPlatforms=!1,t.showExternalDrives=!0,e.platformId&&t.setValue("x3dPlatformId",e.platformId),e.hasOwnProperty("showAllPlatforms")&&(t.showAllPlatforms=e.showAllPlatforms),e.hasOwnProperty("showExternalDrives")&&(t.showExternalDrives=e.showExternalDrives),this._parent.apply(this,arguments)},inject:function(e){if(!e.targetElement)throw new Error("A target Element is required in order to be able to know where the 3DDrive app must be injected in the DOM. Please provide this option");this._targetElement=e.targetElement,this._render()},_subscribeToCompassEvent:function(){var e=this;n.subscribe("setX3DContent",(function(t){e._selectedFilesIn3DDrive=t.data.items.filter((function(e){return"text/directory"!==e.objectType})),e.dispatchEvent("onSelectionChange",[e._selectedFilesIn3DDrive])})),n.subscribe("resetX3DContent",(function(t){e._selectedFilesIn3DDrive=[],e.dispatchEvent("onSelectionChange",[e._selectedFilesIn3DDrive])}))},_render:function(){var e=this;e._w3ddriveAppElement?(t.setBody(e._targetElement),e._targetElement.appendChild(e._w3ddriveAppElement)):e._targetElement&&(t.setBody(e._targetElement),t.setValue("firstlyLoading",!0),require(["DS/W3DDrive/Utils/Preferences","DS/W3DDrive/widget","DS/W3DDrive/w3DDriveApp"],(function(t,n){t.runHistory("DSROOT/content"),e._w3ddriveAppElement=n.body.firstChild})))}}),o=i.singleton(),a=!1;return i.initInstance=function(e){return!1===a&&(e=e||{},o.init(e),a=!0),o},i})),define("DS/W3DDrive/InodeActions",["UWA/Core","UWA/Class","UWA/Class/Events","DS/W3DContentApp/Utils/Metrics","DS/W3DContentApp/Actions/Utils/actionsUtils","DS/UIKIT/Input/Toggle","DS/UIKIT/Alert","DS/W3DContentApp/Utils/Alert","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/Metas/actions","DS/W3DContentApp/Metas/inode","DS/W3DContentApp/Metas/errors","DS/W3DDriveApp/Views/createFolder","DS/W3DDriveApp/Views/editInode","DS/W3DContentApp/Utils/Actions/delete","DS/W3DDrive/Actions/download","DS/W3DContentApp/Utils/Actions/moveAndCopy","DS/W3DDriveApp/Views/ExternalServices/ShareContent","DS/W3DDriveApp/Views/ShareModal","DS/W3DSpaceApp/Views/PublishContent","DS/W3DSpaceComponents/Views/shareCollaborativeSpace","DS/W3DDriveApp/Utils/Actions/addToMyDrive","DS/W3DContentApp/Utils/IntegrationHelper","DS/W3DContentApp/Utils/contextHelpers","DS/W3DDrive/Utils/StructureNavigation","DS/W3DDrive/widget","DS/W3DContentApp/BusEvent","DS/W3DDriveApp/Utils/Actions/upload-folder/upload-folder","DS/W3DContentApp/Metas/drive","DS/W3DSpaceApp/Actions/createCS","DS/W3DSpaceApp/Actions/editCS","DS/W3DSpaceApp/Actions/editContent","DS/W3DSpaceApp/Actions/deleteContent","i18n!DS/W3DDrive/assets/nls/W3DDrive"],(function(e,t,n,i,o,a,r,s,c,l,d,u,p,m,g,f,v,D,h,S,w,A,C,b,y,I,E,P,W,F,N,x,T,V){"use strict";const k=l(),U=d(),O=(W(),u().xmlhttprequestCodes);return t.extend(n,{actions:[],init:function(t={}){const n=t.model,r=t.context;if(!n)return;if("sharedwithme"===n.get("parentId")&&n.get("addtomydrive")){const e=n.get("actions").filter((e=>"changeAlias"!==e&&"removeFromMyDrive"!==e));n.set("actions",e)}function l(e){return i.trackAction(Object.assign(e,{model:n,contextView:r}))}function d(e,t){E.dispatchEvent("inodeActions:"+e,t)}function u(){if(C.SWIntegration&&C.SWIntegration.downloadFile)C.SWIntegration.downloadFile(JSON.stringify({fileId:n.id}));else{var t,i,r,d,u=n.get("title");if(y.hasRelations(n)&&n.drive.isDsDrive&&!0!==I.getValue("isStandalone"))return t={name:"downloadType",className:"primary"},i=new a(Object.assign({},t,{value:"all",label:V.downloadLinkedFiles})).check(),r=new a(Object.assign({},t,{value:"one",label:V.downloadFileOnly})),(d=document.createElement("div")).appendChild(i.elements.container),d.appendChild(r.elements.container),c.dialog({title:V.download+" "+u,body:d,buttons:[{className:"primary",value:V.download,action:function(e){e.hide();var t=i.isChecked();l({eventAction:"download",hasLinkedFiles:t.toString()}),t?p({data:{expand:"true"}}):p()}},{value:V.cancel,action:function(e){e.hide()}}]});if(n.isFolder())return function(){var t=new a({type:"checkbox",name:"recursiveDownload",className:"primary",label:V.downloadRecursivelyOption}),n=e.createElement("div",{html:[{tag:"span",text:V.downloadRecursively},t]});return c.dialog({title:V.replace(V.downloadSelected,{title:u}),body:n,buttons:[{className:"primary",value:V.download,action:function(e){e.hide();var n=t.isChecked();l({eventAction:"download",recursiveDownload:n.toString()}),n?p({data:{expand:"force"}}):p()}},{value:V.cancel,action:function(e){e.hide()}}]})}();l({eventAction:"download"}),p()}function p(e){n.getDownloadUrl(e).then((function(e){var t=e.url;if(t){if(e&&e.expandDetails&&e.expandDetails.missingFiles&&e.expandDetails.missingFiles.length>0){var i=e.expandDetails.missingFiles;o.showMoreInfoPopup(i,"downloaded")}f(t,e.method,n)}}),(function(e){if(404===e.status)return s.add({message:V.replace(V.get("emptyDownload"),{name:u}),className:"warning"});if(e&&e.data&&e.data.error&&("linkInfoMissing"===e.data.error.errorCode||"mainNotIndexed"===e.data.error.errorCode)){var t=V.download,i=e.data.url,a=V.replace(V.downloadSelected,{title:n.get("title")}),r=e.data.error.failingFiles;return o.getConfirmationModal(a,r,t,(function(){window.open(i,"_self")}),!1)}e&&e.hasOwnProperty("status")&&e.status===O.CONFLICT?s.add({message:V.replace(V.duplicationError,{msg:e.data.error.message,fileName:e.data.error.filename}),className:"error"}):e&&e.status===O.NOT_FOUND&&e.options&&e.options.xhr&&/reached max quota/i.test(e.options.xhr.responseText)?s.add({message:V.guestNoRemainingAccess,className:"error"}):s.add({message:V.replace(V.downloadError,{name:u}),className:"error"})}))}}function W(){if(n.drive.get("blockactions"))s.add({message:V.get("quotaExceededWarning"),className:"warning"});else if(C.SWIntegration&&C.SWCheckShared&&!C.SWCheckShared(n))C.SWIntegration.uploadFile(JSON.stringify({folderId:n.id,envId:n.drive.id}));else{var t=e.createElement("input",{attributes:{type:"file",multiple:!0,accept:n.extensionsAllowed?n.extensionsAllowed.join(", "):""},styles:{display:"none"},events:{change:function(){var t=this.files[0].name;if(n.drive.isDsDrive&&1===this.files.length&&y.hasRelations(t))return void function(t){var i=document.createElement("div"),o=document.createElement("div"),a=t.title,s=t.file;o.innerHTML=V.uploadLinkedFileDescription,i.appendChild(o),c.dialog({title:V.upload+" "+a,body:i,buttons:[{className:"primary",value:V.uploadAttachedFiles,action:function(t){t.hide();var i=e.createElement("input",{attributes:{type:"file",multiple:!0},styles:{display:"none"},events:{change:function(){var e=Array.prototype.slice.call(this.files),t=e.filter((function(e){return e.name===s.name}));0!==t.length||y.filesAreEqual(t[0],s)||(e=e.concat(s)),d("onUpload",[n,e,{viewContext:r,linkedFiles:!0}])},click:function(e){document.body.onfocus=function(){setTimeout((function(){i.remove()}),100),document.body.onfocus=null},e.stopPropagation()}}}).inject(document.body);i.click()}},{value:V.uploadOneFile,action:function(e){e.hide(),d("onUpload",[n,[s],{viewContext:r,linkedFiles:!1}])}}]})}({title:t,file:this.files[0]});d("onUpload",[n,this.files,{viewContext:r,linkedFiles:!1}])},click:function(e){document.body.onfocus=i,e.stopPropagation()}}});t.inject(document.body),t.click()}function i(){setTimeout((function(){t.remove()}),100),document.body.onfocus=null}}function M(e){navigator.clipboard.writeText(e).then((()=>{require(["DS/UWPClientControls/PlatformNotify"],(function(e){e.success(V.get("linkCopiedToClipboard"))}))}))}function R(){l({eventAction:"publishTo3DSwym"}),new S(n)}function L(){l({eventAction:"addMemberCS"}),w(n)}const j={};j[U.actionPubIds.viewInformation]=function(){l({eventAction:"viewInformation"}),d("onViewProperties",n)},j[U.actionPubIds.preview]=function(){l({eventAction:"preview"}),d("onPreview",n)},j[U.actionPubIds.editDocument]=function(){l({eventAction:"editDocument"}),d("onEditDocument",n)},j[U.actionPubIds.openFileLocation]=function(){l({eventAction:"openFileLocation"});const e=n.getLocationLink&&n.getLocationLink();e&&d("openLocation",[n,e])},j[U.actionPubIds.share]=function(){l({eventAction:"share"}),n&&n.drive&&n.drive.isDsDrive?new h({models:n}):new D(n,{onComplete:function(e,t,n){d("onShareAccess",[e[0],t,n])}})},j[U.actionPubIds.getLink]=function(){var e=n.getDirectLink();e instanceof Promise?e.then((function(e){M(e)})):M(e)},j[U.actionPubIds.publishTo3DSwym]=R,j[U.actionPubIds.moveTo]=function(){v(n,{dispatchEvent:d})},j[U.actionPubIds.copy]=function(){v(n,{dispatchEvent:d,duplicate:!0})},j[U.actionPubIds.changeProperties]=function(){l({eventAction:"changeProperties"}),m(n)},j[U.actionPubIds.del]=function(){g(n,{dispatchEvent:d})},j[U.actionPubIds.delFinal]=function(){g(n,{dispatchEvent:d,isPermanent:!0})},j[U.actionPubIds.createFolder]=function(){return l({eventAction:"create"}),p(n)},j[U.actionPubIds.upload]=W,j[U.actionPubIds.uploadFolder]=function(){if(n.drive.get("blockactions"))return void s.add({message:V.get("quotaExceededWarning"),className:"warning"});const t=e.createElement("input",{attributes:{type:"file",directory:!0,webkitdirectory:!0,accept:n.extensionsAllowed?n.extensionsAllowed.join(", "):""},styles:{display:"none"},events:{change:function(){P.processFolder(this.files,n)}}});t.inject(document.body),t.click()},j[U.actionPubIds.download]=u,j[U.actionPubIds.insert]=function(){l({eventAction:"insert"}),C.SWIntegration&&C.SWIntegration.insertFile(JSON.stringify({fileId:n.id}))},j[U.actionPubIds.restoreVersion]=function(){if(l({eventAction:"restoreVersion"}),!C.SWIntegration||!C.SWIntegration.downloadFile)return y.hasRelations(n)?c.dialog({title:V.restore+" "+n.get("title"),body:V.restorePointingFile,buttons:[{className:"primary",value:V.restore,action:function(e){e.hide(),d("onRestore",[n])}},{value:V.cancel,action:function(e){e.hide()}}]}):void d("onRestore",[n]);C.SWIntegration.downloadFile(JSON.stringify({fileId:n.id}))},j[U.actionPubIds.restore]=function(){l({eventAction:"restore"});var e=function(){n.destroy({noSync:!0}),s.add({message:V.get("restoreElemSuccess",{name:n.get("title")}),className:"success"})},t=function(i){var o=0;409===i.status&&("parentNotAvailable"===i.code?o=1:"nameNotUnique"===i.code&&(o=2)),0===o?s.add({message:V.get("unexpectedError"),className:"error"}):v(n,{dispatchEvent:d,newTitle:!0,restore:!0,errorCode:o,callback:e,fallback:t})};n.restore().then(e,t)},j[U.actionPubIds.addToMyDrive]=function(){l({eventAction:"addToMyDrive"}),A(n,{action:"add",dispatchEvent:d})},j[U.actionPubIds.removeFromMyDrive]=function(){l({eventAction:"removeFromMyDrive"}),A(n,{action:"remove",dispatchEvent:d})},j[U.actionPubIds.removeOwnAccess]=function(){l({eventAction:"removeOwnAccess"}),d("removeOwnAccess",n)},j[U.actionPubIds.addToFavorites]=function(){l({eventAction:"addToFavorites"}),d("onAddToFavorites",n)},j[U.actionPubIds.removeFromFavorites]=function(){l({eventAction:"removeFromFavorites"}),d("onRemoveFromFavorites",n)},j[U.actionPubIds.createCollabSpace]=function(){return l({eventAction:"createCS"}),F(n,U.mimeType.collabSpace)},j[U.actionPubIds.addContent]=W,j[U.actionPubIds.addMember]=L,j[U.actionPubIds.addMemberRestricted]=L,j[U.actionPubIds.editCS]=function(){return l({eventAction:"editCS"}),N(n,U.mimeType.collabSpace)},j[U.actionPubIds.changeThumbnail]=function(){function t(){setTimeout((function(){i.remove()}),100),document.body.onfocus=null}l({eventAction:"changeThumbnailCS"});var i=e.createElement("input",{attributes:{type:"file",multiple:!0},styles:{display:"none"},events:{change:function(){d("onChangeThumbnail",[n,this.files])},click:function(e){document.body.onfocus=t,e.stopPropagation()}}});i.inject(document.body),i.click()},j[U.actionPubIds.update]=function(){function t(){setTimeout((function(){i.remove()}),100),document.body.onfocus=null}l({eventAction:"update"});var i=e.createElement("input",{attributes:{type:"file",multiple:!1,accept:!0!==I.getValue("is3DSpaceWidget")&&n.get("fileExtension")?"."+n.get("fileExtension"):"*"},styles:{display:"none"},events:{change:function(){d("onUpdate",[n,this.files])},click:function(e){document.body.onfocus=t,e.stopPropagation()}}});i.inject(document.body),i.click()},j[U.actionPubIds.moveToCS]=function(){var e="w3ddrive item inode-item selected inode-item--focused",t=document.getElementsByClassName(e)[0]?document.getElementsByClassName(e)[0]:this.container;v(n,{dispatchEvent:d,itemView:t})},j[U.actionPubIds.editContent]=function(){return l({eventAction:"editContent"}),x(n)},j[U.actionPubIds.deleteContent]=function(){T(n)},j[U.actionPubIds.downloadVersion]=u,j[U.actionPubIds.shareContent]=R;let B=k.map((e=>{const t=j[e.id];return t&&(e=Object.assign({handler:t},e)),e}));B=B.filter((e=>n.isActionIdoK(e.id))),B=b.actionsFilters.applyCurrentContexts(B),this.actions=B,t.validate&&(this.validate=t.validate),t.events&&this.addEvents(t.events)},toJSON:function(){return this.actions}})})),define("DS/W3DDrive/inodesActions",["DS/UIKIT/Input/Toggle","DS/W3DContentApp/Utils/Actions/delete","DS/W3DDrive/Actions/download","DS/W3DDriveApp/Views/ShareModal","DS/W3DContentApp/Utils/Actions/moveAndCopy","DS/W3DContentApp/Metas/actions","DS/W3DContentApp/Metas/inode","DS/W3DContentApp/Utils/Helpers","DS/W3DContentApp/Utils/contextHelpers","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/Utils/Alert","DS/W3DContentApp/BusEvent","DS/W3DSpaceApp/Actions/deleteContent","DS/W3DDrive/widget","i18n!DS/W3DDrive/assets/nls/W3DDrive"],(function(e,t,n,i,o,a,r,s,c,l,d,u,p,m,g){"use strict";const f=a(),v=r(),D={};function h(e,t){u.dispatchEvent("inodesActions:"+e,t),u.dispatchEvent("inodesActions",t)}return D[v.actionPubIds.share]=function(e){new i({models:e})},"true"!==m.getValue("is3DSpaceWidget")&&(D[v.actionPubIds.del]=function(e){t(e,{dispatchEvent:h})},D[v.actionPubIds.delFinal]=function(e){t(e,{dispatchEvent:h,isPermanent:!0})},D[v.actionPubIds.moveTo]=function(e){o(e,{dispatchEvent:h})},D[v.actionPubIds.download]=function(t){if(t.length){if(function(e){return e.some((function(e){return e.isFolder()}))}(t))return i=new e({type:"checkbox",name:"recursiveDownload",className:"primary",label:g.downloadRecursivelyOption}),l.dialog({title:g.download,body:[{tag:"span",text:g.downloadRecursively},i],buttons:[{className:"primary",value:g.download,action:function(e){e.hide(),i.isChecked()?o({data:{expand:!0}}):o()}},{value:g.cancel,action:function(e){e.hide()}}]});var i;o()}else d.add({className:"warning",message:g.replace(g.empty)});function o(e){t[0].collection.getDownloadUrl(t,e).then((function(e){var t=e.url;t?n(t,e.method):d.add({className:"warning",message:g.replace(g.empty)})}),(function(){d.add({className:"error",message:g.replace(g.downloadsError)})}))}},D[v.actionPubIds.addToFavorites]=function(e){h("onAddToFavorites",[e])},D[v.actionPubIds.removeFromFavorites]=function(e){h("onRemoveFromFavorites",[e])}),"true"===m.getValue("is3DSpaceWidget")&&(D[v.actionPubIds.deleteContent]=function(e){p(e,{dispatchEvent:h})}),{getActionsJSON:function(e){if(!e)return[];e=[].concat(e);let t=s.getActionIds(e);t=c.actionsFilters.applyCurrentContexts(t);let n=t.indexOf("giveReadAccess");-1===n&&(n=t.indexOf("giveEditAccess")),-1!==n&&t.splice(n,0,v.actionPubIds.share);let i=f.filter((e=>-1!==t.indexOf(e.id)));return i=i.filter((e=>D[e.id])),i.map((t=>{const n=D[t.id];return Object.assign({handler:function(){n(e)}},t)}))}}})),define("DS/W3DDrive/Actions/downloadAction",["DS/W3DContentApp/Metas/drive","DS/W3DContentApp/Metas/errors","DS/W3DContentApp/Utils/IntegrationHelper","DS/W3DDrive/Actions/download","DS/W3DDrive/Utils/StructureNavigation","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/Utils/Alert","DS/W3DDrive/widget","DS/UIKIT/Input/Toggle","DS/W3DContentApp/Utils/Metrics","i18n!DS/W3DDrive/assets/nls/W3DDrive"],(function(e,t,n,i,o,a,r,s,c,l,d){"use strict";return function(e){var t=Object.assign({},e),i=t.model;if(!i)throw"A model is mandatory to initiate a download action.";if(l.trackAction({model:i,eventAction:"downloadIteration",contextView:t.context}),!n.SWIntegration||!n.SWIntegration.downloadFile)return o.hasRelations(i)&&i.drive.isDsDrive&&!0!==s.getValue("isStandalone")?function(e){var t=e.model,n={name:"downloadType",className:"primary"},i=new c(Object.assign({},n,{value:"all",label:d.downloadLinkedFiles})).check(),o=new c(Object.assign({},n,{value:"one",label:d.downloadFileOnly})),r=document.createElement("div");return r.appendChild(i.elements.container),r.appendChild(o.elements.container),a.dialog({title:d.download+" "+t.get("title"),body:r,buttons:[{className:"primary",value:d.download,action:function(t){t.hide(),i.isChecked()?u(Object.assign({},e,{data:{expand:"force"}})):u(e)}},{value:d.cancel,action:function(e){e.hide()}}]})}(t):void u(t);n.SWIntegration.downloadFile(JSON.stringify({fileId:i.id}))};function u(e){var n=e.model,o=n.get("title"),a=t().xmlhttprequestCodes;n.getDownloadUrl(e).then((function(e){var t=e.url;t?i(t,e.method,n):r.add({message:d.replace(d.emptyDownload,{name:o}),className:"warning"})}),(function(e){e&&e.hasOwnProperty("status")&&e.status===a.CONFLICT?r.add({message:d.replace(d.duplicationError,{msg:e.data.error.message,fileName:e.data.error.filename}),className:"error"}):r.add({message:d.replace(d.downloadError,{name:o}),className:"error"})}))}})),define("DS/W3DDrive/Utils/Preferences",["UWA/String","DS/W3DContentApp/Utils/Platform","DS/W3DContentApp/Utils/History","DS/W3DDrive/widget","DS/W3DContentApp/Utils/RequestHelper"],(function(e,t,n,i,o){"use strict";return{validateRoute:function(t,n,i){let o="drives/{0}/mimetype/text%2Fdirectory/inode/{1}";const a=i.find((function(e){return e.id===n}));return n=a?a.id:i[0].id,o=e.format(o,n,t),o},runHistory:function(e){const a=this,r=i.getValue("x3dPlatformId");!0===i.getValue("isStandalone")?require(["DS/PlatformAPI/PlatformAPI","DS/i3DXCompassPlatformServices/i3DXCompassRegistryClient"],(function(t,r){const s=`${window.location.href.match(/https:\/\/([^-/]+)/)[1]}`.toUpperCase();o.setTenant(s),t.getApplicationConfiguration("app.urls.registry")&&s&&r.getServicesByPlatform({services:["SCDataMgt","3DDrive"],platforms:[s],config:{url:t.getApplicationConfiguration("app.urls.registry")}}).then((t=>{if(t&&t.length){const r=t[0].services,s=r.find((e=>"SCDataMgt"===e.id)),c=r.find((e=>"3DDrive"===e.id));i.setValue("SCDataMgtBaseUrl",s.url),o.setBaseUrl(c.url),n.setBaseURI(e),a._runStartingRoute()}}))})):t.getAllPlatforms().then((function(t){r?n.setBaseURI(a.validateRoute(e,r,t),r):t[0]?n.setBaseURI(a.validateRoute(e,t[0].id,t),t[0].id):n.setBaseURI("/"),a._runStartingRoute()}),(function(){n.setBaseURI("/"),a._runStartingRoute()}))},_runStartingRoute:function(e,t){t&&(i.setValue("granted-"+t,!0),n._saveFragment(e)),n.start({root:e})}}})),define("DS/W3DDrive/Utils/CompassHelpers",["DS/W3DDrive/widget","DS/W3DSpaceComponents/Utils/SecurityContext","i18n!DS/W3DDrive/assets/nls/W3DDrive"],(function(e,t,n){"use strict";return{getObject:function(i){var o,a,r,s,c;return e.getValue("is3DSpaceWidget")?(o="3DSpace",a=t.getNominalContext(i.collection._parentInode),r=i.get("iconLink"),s=i.get("type")?i.get("type").value:"",c=i.get("type")?i.get("type").name:""):"3DEXPERIENCE"===i.drive.get("title")?(o="3DDrive",a="",r="",s=i.isContainer()?"DriveFolder":"DriveFile",c=i.isContainer()?n.folder:n.file):(o=i.drive.id,a="",r="",s=i.isContainer()?i.get("mimeType"):"Document",c=i.get("fileExtension")),{envId:i._auth.platformId||"",serviceId:o,contextId:a,objectId:i.id,objectRootId:i.get("root"),objectType:s,displayName:i.get("title"),displayType:c,displayIcon:r,displayPreview:i.get("thumbnailLink").medium}},get3DXContent:function(t){var n,i;return e.getValue("is3DSpaceWidget")?(i="X3DCSMA_AP",n="1.0"):(i=e.data.appId,n="2.0"),{protocol:"3DXContent",version:n,source:i,data:{items:t.map(this.getObject)}}}}})),define("DS/W3DDrive/Models/DriveFactory",["DS/W3DContentApp/Models/Drive","DS/W3DDriveApp/Models/Drive","DS/W3DSpaceApp/Models/Drive","DS/W3DDriveApp/Models/DrivesHub/Drive","DS/W3DDrive/widget"],(function(e,t,n,i,o){"use strict";function a(e,a){return new(!0===e.isDrivesHubProvider?i:o.getValue("is3DSpaceWidget")?n:t)(e,a)}return a.prototype.idAttribute=e.prototype.idAttribute,a})),define("DS/W3DDrive/Utils/drives",["UWA/Class/Collection","UWA/Class/Promise","DS/W3DContentApp/Utils/Helpers","DS/W3DContentApp/Utils/DSAuth","DS/W3DContentApp/Models/Drive","DS/W3DDrive/Models/DriveFactory","DS/W3DContentApp/Utils/Platform","DS/W3DContentApp/Utils/RequestHelper","DS/W3DDrive/widget","DS/W3DContentApp/Utils/IntegrationHelper","DS/W3DDriveApp/Utils/drivesHubConnect"],(function(e,t,n,i,o,a,r,s,c,l,d){"use strict";var u=new e;return Object.assign(u,{model:a,comparator:"title",sync:function(e,a,u){if("read"===e){var p=[],m=[],g=u.onComplete;if(delete(u=Object.assign({},u)).onComplete,c.showAllPlatforms&&document.addEventListener("all-platforms-available",(function(e){e&&e.detail&&e.detail.platforms&&e.detail.platforms.forEach((e=>{m.push({id:e.id,auth:new i(e.id,e)})}))})),!c.getValue("is3DSpaceWidget")&&!a.isEmpty())return a.forEach((function(e){p.push(new t((function(t,n){o.prototype.sync("read",e,Object.assign(u,{onComplete:t,onFailure:n}))})))})),t.all(p).then((function(e){g(e,u)}));s.hasTenant()&&m.push({id:s.getTenant(),auth:new i(s.getTenant(),{id:s.getTenant()})}),r.getAllPlatforms().then((e=>(e.forEach((e=>{m.push({id:e.id,auth:new i(e.id,e)})})),new t((i=>{if(c.getValue("is3DSpaceWidget")||c.getValue("isStandalone")||l.CATIAV5||l.SW||n.isExternalDrivesDisabled()||!c.showExternalDrives)i(m);else{const n=e.find((e=>e.id===r.getSelectedPlatformId())),o=n?n.url:"";r.getDrivesHubUrl().then((e=>new t((t=>{e?s.performRequestWithOptions(o+"/resources/3ddrive/v1/admin/config",{method:"GET",type:"json",headers:{"Content-Type":"application/json"},onComplete:function(e={}){const n=e.externaldrives?e.externaldrives.split(","):[];t(n)},onFailure:function(){t([])}}):t(m)})).then((t=>d.tryFetch(e,t).then((e=>{i(m.concat(e))}))))))}})).then((e=>(e.forEach((function(e){p.push(new t((function(t,n){o.prototype.sync("read",e,Object.assign(u,{onComplete:t,onFailure:n}))})))})),t.all(p).then((function(e){g(e,u)}))))))))}}})})),define("DS/W3DDrive/w3DDriveApp",["UWA/Class/Promise","UWA/Utils","DS/W3DContentApp/Utils/Metrics","DS/W3DContentApp/Actions/Utils/actionsUtils","DS/W3DDrive/Utils/drives","DS/W3DContentApp/Actions/upload-manager/upload-manager","DS/W3DContentApp/Utils/Router","DS/W3DContentApp/Utils/Alert","DS/W3DContentApp/Views/errorDetailsModal","DS/W3DContentApp/BusEvent","DS/i3DXCompassServices/i3DXCompassPubSub","DS/W3DContentApp/Utils/Tagger6WProxy","DS/W3DContentApp/w3DDriveView","DS/W3DDriveApp/Views/inodeAllAccessesContainer","DS/W3DSpaceApp/Views/inodeAllAccessesContainer","DS/W3DDriveApp/Views/inodeFileHistoryContainer","DS/W3DContentApp/Views/InodeDetailView/inodeDetailNewSocialView","DS/W3DDriveApp/Views/QuotaExceededView","DS/W3DSpaceApp/Views/inodeDetailAnalyticsView","DS/W3DDriveApp/Views/inodePropertiesView3DDriveContainer","DS/W3DSpaceApp/Views/inodePropertiesView3DSpaceContainer","DS/W3DContentApp/Metas/inode","DS/W3DSpaceApp/Metas/inode","DS/W3DDrive/widget","DS/W3DDrive/Utils/errors","DS/W3DContentApp/Utils/IntegrationHelper","DS/W3DDrive/Utils/CompassHelpers","DS/W3DContentApp/Utils/Rerouter","DS/W3DContentApp/Metas/errors","DS/PlatformAPI/PlatformAPI","DS/W3DDriveApp/Utils/AutoRefresh","DS/W3DContentApp/Utils/Helpers","DS/W3DContentApp/Utils/AdvancedHelpers","DS/W3DContentApp/Views/SuperModal","DS/W3DDriveApp/Utils/Actions/upload-folder/upload-folder","DS/W3DSpaceApp/Views/cleanCollaborativeSpace","DS/W3DContentApp/Utils/scheduleTasksToGlobalSession","DS/W3DDrive/Utils/StructureNavigation","DS/W3DDriveApp/Views/startView","DS/W3DSpaceApp/Views/dndCoachmark","DS/W3DContentApp/Utils/Store","i18n!DS/W3DDrive/assets/nls/W3DDrive","css!DS/UIKIT/UIKIT.css"],(function(e,t,n,i,o,a,r,s,c,l,d,u,p,m,g,f,v,D,h,S,w,A,C,b,y,I,E,P,W,F,N,x,T,V,k,U,O,M,R,L,j,B){"use strict";var _,q,H,z,X,K="setTags",J=(C=C(),W().w3ddrive),$=A(),G=!0,Q=!1;function Y(t){return new e((function(e,n){t.get("authenticated")&&b.getValue("is3DSpaceWidget")?t.fetch({onComplete:function(){e()}}):t.fetch({onComplete:function(){return t.get("authenticated")?e():(s.add({message:B.replace(B.authenticationExpired,{service:t.get("title")}),className:"error"}),n())}})}))}function Z(e,t){a.askForUpload(e,t,{drive:e.drive,onComplete:function(e){e.collection&&e.cid!==e.collection.get(e.id).cid&&s.add({message:B.get("updateSuccess",{title:e.get("title")}),className:"success"})},onFailure:function(e,t){if(void 0!==t){var n="function"==typeof e.get?e.get("title"):e.title,i=B.replace(B.uploadError,{name:n||""});t&&(t.error&&"quotaExceed"===t.error.errorCode?i+=": "+B.allocatedDiskSpaceExceeded:t.error&&"nameDifferent"===t.error.errorCode?i+=": "+B.differentLettercase:"Access denied"===t.message?i+=": "+B.get("accessDenied"):t.error&&t.error.details&&("insufficientFilePermissions"===t.error.details.reason?i+=": "+B.get("accessDenied"):"fileSizeLimitExceeded"===t.error.details.reason&&(i+=": "+B.get("fileSizeLimitExceeded")))),e&&e.destroy&&e.destroy(),t instanceof y.UploadError&&(i+=": "+t.message),s.add({message:i,className:"error"})}else e&&e.destroy&&e.destroy()}})}function ee(e){Array.isArray(e)||(e=[].concat(e));if(1===e.length){const t=e[0];t.addToFavorites().then((e=>{s.add({className:"success",message:B.get("addToFavoritesSuccess")}),(e=>{if("object"==typeof e){const t="favorites"===H.get("id"),n=z&&z.get("id")===e.get("id");e.collection&&t&&n&&e.collection.fetch({merge:!0,withThumbnails:!0})}})(e)}),(()=>{s.add({className:"error",message:B.get("addToFavoritesUniqueError",{name:t.get("title")})})}))}else{const t=e.filter((e=>"function"==typeof e.addToFavorites)).map((e=>function(){return e.addToFavorites()}));t.length&&O(t).then((()=>{s.add({className:"success",message:B.get("addToFavoritesSuccess")})}),(()=>{s.add({className:"error",message:B.get("addToFavoritesSomeError")})}))}}function te(e){Array.isArray(e)||(e=[].concat(e));const t=e=>{if("object"==typeof e){const t="favorites"===H.get("id"),n=z&&z.get("id")===e.get("id");e.collection&&t&&(e.isContainer()&&H.get("id")===e.get("id")||n?e.collection.fetch({merge:!0,withThumbnails:!0}):e.collection.remove(e))}};if(1===e.length){const n=e[0];n.removeFromFavorites().then((e=>{s.add({className:"success",message:B.get("removeFromFavoritesSuccess")}),t(e)}),(()=>{s.add({className:"error",message:B.get("removeFromFavoritesUniqueError",{name:n.get("title")})})}))}else{const n=e.filter((e=>"function"==typeof e.removeFromFavorites)).map((e=>function(){return e.removeFromFavorites()}));n.length&&O(n).then((e=>{e&&e.forEach((e=>{t(e)})),s.add({className:"success",message:B.get("removeFromFavoritesSuccess")})}),(()=>{s.add({className:"error",message:B.get("removeFromFavoritesSomeError")})}))}}function ne(t,n,o){const a=t.get("title");let r,c;c=t.get("parentId")===n.id||!t.drive.isDsDrive||o.queryStrings&&o.queryStrings.expand?new e((function(e,i){r=t.save({parentid:n.id},Object.assign({action:"move",patch:!0,wait:!0,onComplete:function(t,n){e(n)},onFailure:function(e,t){i(t)}},o))})):n.inodeTable.autoname(a).then((i=>{let s=a;return i.iteration&&(s=t.isFolder()?s+" ("+i.iteration+")":s.replace(/(\.[^.]+)$/,` (${i.iteration})$1`)),o.data.title=s,new e((function(e,i){r=t.save({parentid:n.id,title:s},Object.assign({action:"move",patch:!0,wait:!0,onComplete:function(t,n){e(n)},onFailure:function(e,t){i(t)}},o))}))})),c.then((function(e){if(o.itemView&&(l.dispatchEvent("inodePanelView:ontoggleMultiSelectionMode"),o.itemView.destroy()),e&&e.expandDetails&&e.expandDetails.missingFiles&&e.expandDetails.missingFiles.length>0){var r=e.expandDetails.missingFiles;i.showMoreInfoPopup(r,"moved")}else e&&e.title&&a!==e.title?(s.add({message:B.replace(B.moveAutonameSuccess,{prevName:a,newName:e.title,toName:n.get("title")}),className:"success"}),(M.isPart(t)||M.isLinkedFile(t))&&s.add({message:B.replace(B.autonameLinkedfile,{newName:e.title}),className:"primary"})):s.add({message:B.replace(B.moveSuccess,{name:a,toName:n.get("title")||n.id}),className:"success"});if(e)return{collection:t.collection,expandedIds:e.expandDetails?e.expandDetails.expandedIds:null}}),(function(e){if(e&&e.error&&("linkInfoMissing"===e.error.errorCode||"mainNotIndexed"===e.error.errorCode)){var c=B.move,d=c+" "+t.get("title"),u=e.error.failingFiles;return i.getConfirmationModal(d,u,c,(function(){var e=Object.assign({},o);e.queryStrings={expand:"force"},l.dispatchEvent("inodeActions:onMove",[t,n,e])}),!1)}var p=B.get("moveError",{name:a,toName:n.get("title")});if(e&&e.error&&"quotaExceed"===e.error.errorCode)p+=": "+B.allocatedDiskSpaceExceeded;else if(r&&409===r.xhr.status){const t=e?e.error:void 0;p=t&&"string"==typeof t.message&&/parent is not authorized/i.test(t.message)?B.replace(B.moveErrorSelf,{name:a,toName:n.get("title")}):B.replace(B.moveErrorNameConflict,{name:a,toName:n.get("title")})}else e&&e.error&&e.error.details&&("insufficientFilePermissions"===e.error.details.reason?p+=": "+B.get("accessDenied"):"duplicateContentName"===e.error.details.reason&&(p=B.replace(B.get("moveErrorNameConflict"),{name:a,toName:n.get("title")})));s.add({message:p,className:"error"})})).then(de)}function ie(e,t){var n=e[0].collection;n&&"function"==typeof n.moveItems?n.moveItems(e,t,{wait:!1}).then((function(){s.add({message:B.get("movesSuccess",{toName:t.get("title")}),className:"success"})}),(function(n){var i=B.get("movesError",{nbFail:n.length,nbItems:e.length,toName:t.get("title")}),o=e.length-n.length;s.addAndCallback({message:i,className:"error",callback:function(){var e=B.get("movesSuccessDetail",{nbSuccess:o,toName:t.get("title")})+"</br> </br>";e+=B.get("movesErrorDetail")+"</br> </br>";var i=[];return n.map((function(e){return i.push(e.get("title")),i})),new c({message:e,items:i})}})})):s.add({message:B.replace(B.movesNotSupported,{toName:t.get("title")}),className:"error"})}function oe(e,t){const n="recents"===t.get("root")?t.get("parentId"):null,i=n?"text/directory":null;q.navigate(e.getInodePreviewURI(t,{containerType:i,containerId:n}),{trigger:!0})}function ae(e){if(n.trackNavigation({model:e,eventAction:"dblClick"}),I.SWIntegration&&I.SWCheckShared&&!I.SWCheckShared(e)){var t=e.get("fileExtension").toLowerCase();if("sldprt"===t||"sldasm"===t||"slddrw"===t)return void I.SWIntegration.openFile(JSON.stringify({fileId:e.id,envId:e.drive.id}))}var i=e.drive;const o="recents"===e.get("root")?e.get("parentId"):null,a=o?"text/directory":null;var r=e.isContainer()?i.getInodePanelContentURI(e):i.getInodePreviewURI(e,{containerType:a,containerId:o});q.navigate(r,{trigger:!0}),b.getValue("is3DSpaceWidget")&&e.isCollabSpace()&&(e.securityContext(e),e.get("solution")!==C.boType.team&&s.add({message:B.warningNonOCDX,className:"warning"}))}function re(e,t,n,o){e.getFileUrl(t).then((e=>{if(e&&e.expandDetails&&e.expandDetails.missingFiles&&e.expandDetails.missingFiles.length>0){const t=e.expandDetails.missingFiles;i.showMoreInfoPopup(t,"previewed")}n()}),(t=>{if(t&&t.error&&("linkInfoMissing"===t.error.errorCode||"mainNotIndexed"===t.error.errorCode)){const n=B.preview,a=n+" "+e.get("title"),r=t.error.failingFiles;return i.getConfirmationModal(a,r,n,o,!0)}}))}function se(t){return new e((function(e){return t.getRootInodes(!0).then((function(t){e(t.first())}))})).then((function(e){q.navigate(t.getInodePanelContentURI(e),{trigger:!0})}))}function ce(){var e=p.getSecondPanel();if(e){var t=e.model;if(t){var n=t.inodeTable,i=t.permissions;"function"==typeof n.getFirstPage?n.getFirstPage({reset:!0,withThumbnails:!0,onFailure:o,drive:t.drive}):n.fetch({reset:!0,withThumbnails:!0,onFailure:o,drive:t.drive}),i.fetch({reset:!0,inode:t.id,from:"refresh"})}}function o(){se(t.drive),t.collection.remove(t)}}function le(t,n){var i=t.get("emailAddress")===t.collection._parentInode.drive.get("user").emailAddress;return new e((function(e,i){t.destroy(Object.assign({wait:!0,onComplete:e,onFailure:i},n))})).then((function(){i&&ce(),s.add({message:n.messageSuccess,className:"success"})}),(function(){s.add({message:n.messageFailure,className:"error"})}))}function de(t){if(!t||!t.expandedIds||!t.collection)return e.resolve();var n=t.collection,i=t.expandedIds;return e.resolve(n.remove(i))}function ue(e){if(!e)return void console.error("Missing input");let t;const n=setTimeout((()=>{clearTimeout(t),s.add({className:"warning",message:B.get("cannotRetrieveContentLocation")})}),25e3);!function i(){const o=H.get("id");o===e.get("parentContainerId")||!e.get("parentContainerId")&&o===e.get("parentId")?function i(){e.get("parentContainerId")&&(e=e.drive.getInode({id:e.get("id"),containerToSearchIn:e.get("parentContainerId")}));const o=p.getSecondPanel();o&&e&&e.get("parentId")?(o.handleItemSelection(e),function i(){const a=o.getElementFromModel(e);a?(clearTimeout(n),a.scrollIntoView({block:"start",behavior:"smooth"})):t=setTimeout(i,500)}()):t=setTimeout(i,500)}():t=setTimeout(i,500)}()}!0===b.getValue("isStandalone")&&(Q=!0,G=!1),_=r.extend({routes:{error:"onError","error/:errorType/:errorCode/:errorMsg":"onError",":parentInodeId/init":"onReroute","drives/:driveId/mimetype/:mimetype/inode/:parentInodeId/content":"onInodeContent","drives/:driveId/mimetype/:mimetype/inode/:inodeId/content/focus":"onInodeContentWithFocus","drives/:driveId/mimetype/:mimetype/inode/:parentInodeId/content/:inodeId/preview":"onInodePreview","drives/:driveId/mimetype/:mimetype/inode/:inodeId/preview":"onInodePreview"},execute:function(t,n){const i=n[":driveId"];let a,r=!1;i!==this.driveId&&(this.driveId=i,r=!0);let c=[],d=!0;new e(((e,t)=>{o.fetch({onComplete:function(t){const n={};t.forEach((e=>{n[e.id]=e.get("auth")})),e(n)},onFailure:t,reset:o.isEmpty(),merge:!1})})).then((t=>function(t,n){const i=[];return new e(((e,a)=>{let r=t[":driveId"],c=t[":parentInodeId"];const d=t[":inodeId"],u=t[":mimetype"];let p,m,g,f,v;if("sharedWithMe"===c&&(c=c.toLowerCase()),void 0===r)return a();p=o.get(r),p||(n[r]||(!0!==Q&&s.add({message:B.replace(B.driveAccessError,{driveId:r}),className:"warning"}),r=Object.keys(n)[0],v=!0),p=o.get(r)),q.setBaseURI(p.getInodePanelContentURI(p.getRootInodes().first())),i[0]=p,i[1]=u,p&&(!Q&&v&&(c=p.getRootInodes().first().id),f={},f.mimeType=u,f[p.inodeIdAttr]=c,m=p.getInode(f),i[2]=m),m?(g=m.inodeTable.get(d),!g&&d&&(f={},f[p.inodeIdAttr]=d,f.parentId=c,g=p.getInode(f),m.inodeTable.add(g)),i[3]=g,e({drive:p,mappedArgs:i})):(g=p.getInode({id:d}),g.fetch({onComplete:function(){m=p.getInode({id:g.get("parentId"),mimeType:u}),m.inodeTable.add(g),i[2]=m,i[3]=g,e({drive:p,mappedArgs:i})},onFailure:function(){e({errorType:"inodeAccessError",drive:p,mappedArgs:i})}})),j.currentTenant!==p.id&&(j.currentTenant&&j.resetStore(),j.currentTenant=p.id,require(["DS/W3DContentApp/Utils/Platform"],(function(e){e.getAllPlatforms().then((e=>{const t=e.find((e=>e.id===j.currentTenant));t&&(j.servicesUrl=t)}))})),p&&p.isDsDrive&&!b.getValue("isStandalone")&&T.isODEFeatureEnabled(p).then((e=>{j.features.isODEFeatureAvailable=e,l.dispatchEvent("driveFeaturesList",[m])}),(()=>{j.features.isODEFeatureAvailable=!1})))}))}(n,t))).then(((e={})=>{a=e.drive,c=e.mappedArgs,d=Boolean(c&&!e.errorType),t&&t.apply(q,c)}),(()=>{if(!0===Q&&!n.hasOwnProperty(":driveId"))return c=Object.keys(n).map((e=>n[e])),void(t&&t.apply(q,c));n.hasOwnProperty(":errorType")?(n.hasOwnProperty(":errorCode")?n.hasOwnProperty(":errorMsg")?t.apply(q,[n[":errorType"],n[":errorCode"],n[":errorMsg"]]):t.apply(q,[n[":errorType"],n[":errorCode"]]):t.apply(q,[n[":errorType"]]),t=null):q.navigate("",{trigger:!0,loadBaseUri:!0})})).then((()=>{if(d){const i=c[2];let o=c[3];return a&&a.isCollabSpace&&(o=null),function(t=null,n=null){return new e(((e,i)=>{t?t.doesExistInBackend().then((t=>{t?n?n.doesExistInBackend().then((t=>{t?e(!0):i(new Error("inodeAccessError"))})):e(!0):i(new Error("inodeAccessError"))})):e(!0)}))}(i,o).then((()=>{r&&!Q&&a&&Y(a)}),(e=>{Y(a),((e,i)=>{!0!==Q||n.hasOwnProperty(":driveId")?n.hasOwnProperty(":errorType")?(n.hasOwnProperty(":errorCode")?n.hasOwnProperty(":errorMsg")?t.apply(q,[n[":errorType"],n[":errorCode"],n[":errorMsg"]]):t.apply(q,[n[":errorType"],n[":errorCode"]]):t.apply(q,[n[":errorType"]]),t=null):!0===Q?q.navigate("error",{trigger:!0}):e[0]?(i===J.inodeAccessError&&s.add({className:"warning",message:B.get("inodeAccessError")}),se(e[0])):q.navigate("",{trigger:!0,loadBaseUri:!0}):e=Object.keys(n).map((function(e){return n[e]}))})(c,e.message)}))}})),P.setRouter(q)},onError:function(e,n,i){if(s.options.autoHide=!1,e===J.noToken)s.add({message:B.standaloneNoToken,className:"error"});else if(e===J.ressourceAccess)s.add({message:B.standaloneLinkError,className:"error"});else if(e===J.inodeAccessError){(function(){const e=document.getElementsByClassName("alert-warning");let t=!1;for(let n=0;n<e.length;n++)if(e[n].innerText===B.inodeAccessError){t=!0;break}return t})()||s.add({className:"warning",message:B.get("inodeAccessError")})}else s.add({message:B.unexpectedError,className:"error"});t.setImmediate((function(){p.showEmptyView()}))},onReroute:function(){P.rerouteFromSharedToken(b.getValue("SCDataMgtBaseUrl"),b.getValue("token"))},onDrives:function(){p.showFirstPanel(),p.getFirstPanel().selectedChildren.reset(),p.showSecondPanel(),b.setTitle(),o.fetch({reset:o.isEmpty(),merge:!1}),G&&t.setImmediate((function(){u.unSetInodeTable()}))},onInodePreview:function(e,n,i,o){if(!o)return s.add({message:B.inodeAccessError,className:"warning"}),void(e?se(e):q.navigate("",{trigger:!0,loadBaseUri:!0}));z=o,p.showLightbox({inode:o}),!0===Q&&o.fetch(),t.setImmediate((function(){var t=q.onInodeContent(e,n,i,o);t&&t[K].then((function(){G&&(u.focusOnSubjectsWithInode(o),u.deactivate())}),(function(){}))}))},onInodeContent:function(n,i,o,a){var r={},c=e.deferred(),l=e.deferred();if(r.fetchInodeTable=c.promise,r[K]=l.promise,H===o)return t.setImmediate((function(){q.onInodePanel(n,i,o)})),G?(t.setImmediate((function(){l.resolve()})),r):void 0;H=o;var d=o.inodeTable,m=b.getValue("inodesSorting");if(d){var g,f=p.showSecondPanel(o).getSecondPanel();if(f&&(g=f.elements.contentView.view),d.sort({sorting:m}),G&&t.setImmediate((function(){u.setTaggerProxy(n),g&&u.setInodeTable(g)})),!0!==Q||"sharedwithme"!==o.id){let e;e=d.fetch({reset:d.isEmpty(),merge:!0,queryReset:!0,withThumbnails:!0,drive:n,onComplete:()=>{d.sort({sorting:m}),c.resolve(),G&&t.setImmediate((function(){l.resolve()})),a&&ue(a)},onFailure:()=>{const t=e.xhr.status;0!==t&&503!==t||s.add({message:B.get("requestTimeout"),className:"error"}),c.reject(),l.reject()}})}return t.setImmediate((function(){q.onInodePanel(n,i,o)})),r}},onInodeContentWithFocus:function(e,t,n,i){return q.onInodeContent(e,t,n,i)},onInodePanel:function(e,n,i){p.showSecondPanel(i),!0!==Q&&t.setImmediate((function(){if(p.getFirstPanel()){var t=p.getFirstPanel().findChildViewByModel(e);p.getFirstPanel().selectedChildren.add(t),e.getInodesPath(i.id).then((function(e){var n=t.expandInodesPath(e);n[n.length-1].select(!0)}))}}))}}),(q=new _).listenTo(l,{"driveActions:onInstallApp":function(){d.publish("installApp",{appId:"X3DDRVN_AP",widgetId:b.id,silent:!0})},"driveActions:onLaunchApp":function(){d.publish("launchApp",{appId:"X3DDRVN_AP",widgetId:b.id,silent:!0})},"driveActions:onStorage":function(e){e&&e.getStorage()},"driveActions:onDisconnect":function(t){const n=p.getFirstPanel().selectedChildren,i=new e(((e,n)=>{t.save({authenticated:!1},{wait:!1,onComplete:e,onFailure:n})}));i.then((function(){const e=t.collection.find((e=>e.get("authenticated")));l.dispatchEvent("drivesView:onWannaChangeSelection",[e]),s.add({message:B.get("disconnectSuccess",{service:t.get("title")}),className:"success"})}),(function(){s.add({message:B.get("disconnectError",{service:t.get("title")}),className:"error"})})),n.length||i.then((function(){q.navigate("",{trigger:!0,loadBaseUri:!0})}))},"inodeActions:onUpload":function(e,t,i){n.trackAction({model:e,eventAction:"upload",eventValue:t.length,contextView:i.viewContext,hasLinkedFiles:i.linkedFiles}),Z(e,t)},"inodeActions:onCreateFolder":function(e,t,n={}){const i=n.title;e.inodeTable.create({parentId:e.id,mimeType:t,title:n.title,description:n.description},{wait:!0,onComplete:function(e){e.collection&&e.cid!==e.collection.get(e.id).cid?s.add({message:B.get("folderAlreadyExists",{name:i}),className:"warning"}):(s.add({message:B.get("createSuccess",{name:i}),className:"success"}),l.dispatchEvent("inodePanelView:selectItemAmongItems",[e,{selectItemIfNoItemsSelected:!0,scrollToItem:!0}]))},onFailure:function(e,t){let n;t.error&&t.error.message&&-1!==t.error.message.indexOf("unique")?n=B.replace(B.get("createErrorFolderNameConflict"),{name:i}):(n=B.replace(B.get("createError"),{name:i}),"Access denied"===t.message&&(n+=": "+B.get("accessDenied"))),s.add({message:n,className:"error"})}})},"inodesActions:onShare":function(e,t){e[0].collection.shareChildren(e,t).then((function(e){s.add({message:B.replace(B.sharesSuccess),className:"success"})}),(function(e){e.map((function(e){s.add({message:B.replace(B.shareError,{name:e.inode.get("title")}),className:"error"})}))}))},"access:onTransferOwnership":function(e,t){var n=e.get("title");e.transferOwnership(t).then((function(e){var t=e.title,i="";n!==t&&(i=B.replace(B.changeOwnerAndRenameSuccess,{title:n,rename:t})),s.add({message:i+B.replace(B.changeOwnerSuccess,{user:e.fullnameowner,title:t}),className:"success"})}),(function(e){s.add({message:B.replace(B.changeOwnerError,{title:n}),className:"error"})}))},"inodeActions:onEdit":function(e,t){var n=e.get("title");e.save({title:t.title,description:t.description},{wait:!0,onComplete:function(){s.add({message:B.replace(B.get("editSuccess"),{name:e.get("title")}),className:"success"})},onFailure:function(e,t){var i=t||{},o=B.replace(B.get("editError"),{name:n});i.error&&i.error.message&&"string"==typeof i.error.message&&(o+=": "+i.error.message),"Access denied"===i.message&&(o+=": "+B.get("accessDenied")),s.add({message:o,className:"error"})}})},"inodeActions:onCopy":function(t,o,a){const r=t.get("title");let c;c=!t.drive.isDsDrive||a.queryStrings&&a.queryStrings.expand?new e((function(e,n){o.inodeTable.create({duplicatedfrom:t.id,mimeType:t.get("mimeType")},Object.assign({action:"copy",wait:!0,onComplete:function(t,n){e(n)},onFailure:function(e,t){n(t)}},a))})):o.inodeTable.autoname(r).then((n=>{let i=r;return n.iteration&&(i=t.isFolder()?i+" ("+n.iteration+")":i.replace(/(\.[^.]+)$/,` (${n.iteration})$1`)),new e((function(e,n){o.inodeTable.create({duplicatedfrom:t.id,mimeType:t.get("mimeType"),title:i},Object.assign({action:"copy",wait:!0,onComplete:function(t,n){e(n)},onFailure:function(e,t){n(t)}},a))}))})),c.then((function(e){if(e&&e.expandDetails&&e.expandDetails.missingFiles&&e.expandDetails.missingFiles.length>0){var n=e.expandDetails.missingFiles;i.showMoreInfoPopup(n,"copied")}else e&&e.title&&r!==e.title?(s.add({message:B.replace(B.copyAutonameSuccess,{prevName:r,newName:e.title,toName:o.get("title")}),className:"success"}),(M.isPart(t)||M.isLinkedFile(t))&&s.add({message:B.replace(B.autonameLinkedfile,{newName:e.title}),className:"primary"})):s.add({message:B.replace(B.copySuccess,{name:r,toName:o.get("title")}),className:"success"})}),(function(e){var n;if(e&&e.error&&("linkInfoMissing"===e.error.errorCode||"mainNotIndexed"===e.error.errorCode)){var c=B.copy,d=c+" "+t.get("title"),u=e.error.failingFiles;return i.getConfirmationModal(d,u,c,(function(){var e=Object.assign({},a);e.queryStrings={expand:"force"},l.dispatchEvent("inodeActions:onCopy",[t,o,e])}),!1)}e&&"nameNotUnique"===e.error.errorCode?n=B.replace(B.copyErrorNameConflict,{name:r,toName:o.get("title")}):(n=B.replace(B.copyError,{name:r,toName:o.get("title")}),"quotaExceed"===e.error.errorCode?n+=": "+B.allocatedDiskSpaceExceeded:e.error.details&&("insufficientFilePermissions"===e.error.details.reason?n+=": "+B.get("accessDenied"):"duplicateContentName"===e.error.details.reason&&(n=B.replace(B.get("copyErrorNameConflict"),{name:r,toName:o.get("title")})))),s.add({message:n,className:"error"})})),n.trackAction({model:t,eventAction:"copy",hasLinkedFiles:a.queryStrings&&"true"===a.queryStrings.expand?"true":"false"})},"inodeActions:onMove":function(e,t,i){ne(e,t,i),n.trackAction({model:e,eventAction:"move",hasLinkedFiles:i&&i.queryStrings&&"true"===i.queryStrings.expand?"true":"false"})},"inodesActions:onMove":function(e,t){ie(e,t),n.trackAction({model:e[0],eventAction:"move",eventValue:e.length,hasLinkedFiles:"false"})},"inodesActions:onDnDMove":function(e,t){var i=[];if(e.map((function(e){i.push(t.drive.getInode({id:e}))})),1===i.length){var o={data:{}};o.data.parentid=t.id,ne(i[0],t,o)}else ie(i,t);n.trackAction({model:i[0],eventAction:"move",eventValue:i.length,contextView:"dnd",hasLinkedFiles:"false"})},"inodeActions:onViewProperties":function(e){const t=p.getSecondPanel();t&&t.handleItemSelection(e),function(e){b.getBool("isInodePanelSideBarOpened")||b.dispatchEvent("onToggleInodePanelSideBarVisibility");var t=p.getSecondPanel();t&&t.elements&&t.elements.detailView&&t.elements.detailView.navigateToTab(e)}("properties")},"inodeActions:onPreview":function(e,t){const n=e.drive;if(e.drive.isCollabSpace)oe(n,e);else if(M.isLinkedFile(e)){const i=()=>{const t={queryStrings:{expand:"force"}};l.dispatchEvent("inodeActions:onPreview",[e,t])};re(e,t,oe.bind(null,n,e),i)}else oe(n,e)},"inodeActions:onEditDocument":function(e){const t=e.drive;x.isAndroidOrIphone()?s.add({message:B.get("ODdisabledActions"),className:"primary"}):(e.editMode=!0,oe(t,e))},"inodeActions:onDelete":function(t,o){var a=t.drive,r="delete";t.isContainer()&&q.navigate(a.getInodePanelContentURI(t.inodeTable.dotDot()),{trigger:!0}),function(t,n){var o=t.get("title"),a=t.collection;new e((function(e,r){t.destroy(Object.assign({wait:!0,onComplete:function(n,s){if(s&&"failure"===s.status&&s.report){for(var c=" ",l=0;l<s.report.length;l++)c+=s.report[l].error+" ";return a.add(t),r({msg:B.replace(B.errorDelete,{title:o,errorMessage:c})})}if(s&&s.expandDetails&&s.expandDetails.missingFiles&&s.expandDetails.missingFiles.length>0){var d=s.expandDetails.missingFiles;i.showMoreInfoPopup(d,"deleted")}var u=s&&s.expandDetails&&s.expandDetails.expandedIds?s.expandDetails.expandedIds:null;e(u)},onFailure:function(e,o){if(o&&o.error&&("linkInfoMissing"===o.error.errorCode||"mainNotIndexed"===o.error.errorCode)){var a=B.deleteText,s=a+" "+t.get("title"),c=o.error.failingFiles;return i.getConfirmationModal(s,c,a,(function(){var e=Object.assign({},n);e.queryStrings={expand:"force"},l.dispatchEvent("inodeActions:onDelete",[t,e])}),!1)}r(o)},onTimeout:function(e){r({reason:"timeout"})}},n))})).then((function(e){if(s.add({message:B.replace(B.deleteSuccess,{name:o}),className:"success"}),e)return{expandedIds:e,collection:a}}),(function(e){if(e&&"timeout"===e.reason){var n=B.replace(B.get("deleteTimeout"),{name:o});s.add({message:n,className:"warning"})}else e&&"Access denied"===e.message?s.add({message:B.replace(B.deleteError,{name:o})+": "+B.get("accessDenied"),className:"error"}):t.isCollabSpace()?s.addAndCallback({message:B.replace(B.deleteError,{name:o}),className:"error",callback:function(){return"check"===x.getAppBehaviour("deleteCS")?t.getDetailsUndeletedCS(t).then((function(e){var t={};return t.items=e,t.message=B.DetailsMsgFailureCS,new c(t)})):t.checkContent().then((function(e){return new U(t,e)}),(function(e){var t=e&&e.errorMessage?e.errorMessage:"";":Timeout"===t?s.add({message:B.unexpectedError+t,className:"warning"}):s.add({message:B.unexpectedError+t,className:"error"})}))}}):s.add({message:e&&e.msg?e.msg:B.replace(B.deleteError,{name:o}),className:"error"})})).then(de)}(t,o),"myCollabSpaces"===t.get("parentId")&&(r="deleteCS"),n.trackAction({model:t,eventAction:r,hasLinkedFiles:o&&o.queryStrings&&"true"===o.queryStrings.expand?"true":"false"})},"inodesActions:onDelete":function(e,t){var i=e[0].collection,o=Object.assign({wait:!1},t);i.destroyChildren(e,o).then((function(){s.add({message:B.deletesSuccess,className:"success"})}),(function(t){var n=B.get("deletesError",{nbFail:t.length,nbItems:e.length}),i=e.length-t.length;s.addAndCallback({message:n,className:"error",callback:function(){var e=B.get("deletesSuccessDetail",{nbSuccess:i})+"</br> </br>";e+=B.get("deletesErrorDetail")+"</br> </br>";var n=[];return t.map((function(e){return n.push(e.get("title")),n})),new c({message:e,items:n})}})})),n.trackAction({model:e[0],eventAction:"delete",eventValue:e.length,hasLinkedFiles:"false"})},"inodeScrollTableView:onDrop":function(e,t){n.trackAction({model:e.dot(),eventAction:"upload",eventValue:t.length,contextView:"dnd"}),Z(e.dot(),t)},"inodeScrollTableView:onFolderDrop":function(e,t){n.trackAction({model:e,eventAction:"folderUpload",contextView:"dnd"}),k.processFolderDnD(e,t)},onRefresh:function(){ce()},"permission:onRemoveLinkAuthorization":function(e,t){var n=Object.assign({},t),i=e.get("displayName");n.messageSuccess=B.replace(B.shareRemoveSuccess,{name:i}),n.messageFailure=B.replace(B.shareRemoveError,{name:i}),le(e,n)},"inodeActions:onChangeAlias":function(e,t){var n=e.get("alias");e.save({alias:t.title,description:t.description},{wait:!0,onComplete:function(){s.add({message:B.replace(B.get("editSuccess"),{name:e.get("alias")}),className:"success"})},onFailure:function(e,t){var i=t.error,o=B.replace(B.get("editError"),{name:n});i&&i.message&&"string"==typeof i.message&&(o+=": "+i.message),s.add({message:o,className:"error"})}})},"inodeActions:onCreateCS":function(t,n,i){new e((function(e,o){t.inodeTable.create({parentId:t.id,csAtrributes:i,mimeType:n},{wait:!0,onComplete:e,onFailure:o,onTimeout:function(e){o({reason:"timeout"})}})})).then((function(e){s.add({message:B.replace(B.CScreateSuccess,{name:i.title}),className:"success"})}),(function(e){"timeout"===e.reason?s.add({message:B.replace(B.CScreateTimeout,{name:i.title}),className:"warning"}):s.add({message:B.replace(B.CScreateError,{name:e.get("csAtrributes").title}),className:"error"})}))},"access:onRemoveCollabSpaceMember":function(e,t){var n=Object.assign({},t),i=e.collection._parentInode.get("title"),o=e.get("title");e.collection&&e.collection._parentInode&&e.collection._parentInode.get("parentId")===C.ids.myCollabSpaces&&(n.messageSuccess=B.replace(B.shareRemoveSuccessCS,{name:o,CSTitle:i}),n.messageFailure=B.replace(B.shareRemoveErrorCS,{name:o})),le(e,n)},"access:onChangeCollabSpaceMemberRole":function(t,n){var i=t.get("role");new e((function(e,i){t.save({role:n},{wait:!0,onComplete:e,onFailure:i})})).then((function(){var e=t.get("role").value;s.add({message:B.replace(B.shareSucessCS,{userName:t.get("title"),name:t.collection._parentInode.get("title"),access:B[e]}),className:"success"})}),(function(e){t.set("role",i),s.add({message:e&&e.message?e.message:B.replace(B.shareErrorCS,{name:t.get("collabspace")}),className:"error"})}))},"access:onChangeMainOwnerCS":function(t){if(!t)throw new Error("Missing input");var n=t.collection._parentInode;new e((function(e,i){n.save({owner:{login:t.get("id")}},{wait:!0,onComplete:e,onFailure:i})})).then((function(){t.set("accessright","leaderOwner"),t.set("actions",[]),s.add({message:B.replace(B.shareSucessCS,{userName:t.get("title"),name:inode.collection._parentInode.get("title"),access:B.leaderOwner}),className:"success"})}),(function(e){s.add({message:e&&e.message?e.message:B.replace(B.shareErrorCS,{name:t.get("collabspace")}),className:"error"})}))},"inodeActions:onEditCS":function(t,n,i){new e((function(e,o){t.save({actualName:t.id,csAtrributes:i,mimeType:n},{wait:!0,onComplete:function(e){s.add({message:B.replace(B.CSEditSuccess,{name:e.get("title")}),className:"success"})},onFailure:function(e,t,n){s.add({message:B.replace(B.CSEditError,{name:e.get("csAtrributes").title}),className:"error"})}})})).then((function(e){s.add({message:B.replace(B.CSEditSuccess,{name:e.get("title")}),className:"success"})}),(function(e){s.add({message:B.replace(B.CScreateError,{name:e.get("title")}),className:"error"})}))},"inodeActions:onChangeThumbnail":function(t,n,i){new e((function(e,i){t.save({actualName:t.id,file:n[0],action:"changeThumbnail"},{wait:!0,onComplete:e,onFailure:i})})).then((function(e){s.add({message:B.replace(B.CSEditThumbnailSuccess,{name:e.get("title")}),className:"success"})}),(function(e){s.add({message:e.message?e.message:B.replace(B.CSEditThumbnailError,{name:e.get("title")}),className:"error"})}))},"iteration:onRestore":function(e){var t=e.get("title");e.restoreVersion().then((function(){s.add({message:B.replace(B.restoreSuccess,{name:t}),className:"success"})}),(function(){s.add({message:B.replace(B.restoreFail,{name:t}),className:"error"})}))},"inodeActions:onUpdate":function(t,n){let i=n[0];new e(((e,o)=>{"true"!==b.getValue("is3DSpaceWidget")&&t.get("fileExtension").toLowerCase()!==n[0].name.split(".").pop().toLowerCase()?(s.add({message:B.get("updateDifferentExtension",{extension:t.get("fileExtension")}),className:"error"}),o()):"true"!==b.getValue("is3DSpaceWidget")&&t.get("title")!==n[0].name?(V.dialog({title:B.get("update"),body:B.get("updateDifferentFileNames",{nameA:t.get("title"),nameB:n[0].name}),buttons:[{className:"primary",value:B.get("update"),action:function(t){t.hide(),e()}},{value:B.get("cancel"),action:function(e){e.hide(),o()}}]}),i=new File([i],t.get("title"),{type:i.type})):e()})).then((function(){a.addUploadTask(t),t.sync("create",t,{file:i,action:"update",onComplete:function(e){t.set(t.parse(e)),t.dispatchEvent("onChange:thumbnail"),t.dispatchEvent("onUpdateCompleted"),"true"===b.getValue("is3DSpaceWidget")&&s.add({message:B.replace(B.updateSuccess,{title:t.get("title")}),className:"success"})},onFailure:function(e){t.dispatchEvent("onError",t);let n=B.get("updateError",{title:t.get("title")});e&&e.error&&"quotaExceed"===e.error.errorCode&&(n+=": "+B.get("allocatedDiskSpaceExceeded")),s.add({message:n,className:"error"})}})}))},"inodeActions:onEditContent":function(t,n){new e((function(e,i){t.save({inode:t,attributes:n,action:"editContent"},{wait:!0,onComplete:e,onFailure:i})})).then((function(e){s.add({message:B.replace(B.succesEditingContent,{name:e.get("title")}),className:"success"})}),(function(){s.add({message:B.replace(B.errorEditingContent,{name:t.get("title")}),className:"error"})}))},"inodeActions:removeFromMyDrive":function(e){if(!e)throw new Error("Missing input");if(e.isContainer()){var t=e.drive,n=e.drive.getInode(e.get("parentId"));q.navigate(t.getInodePanelContentURI(n),{trigger:!0})}},"inodeActions:openLocation":function(e,t){if(!e||!t)throw new Error("Missing input");const n=p.getLightbox(),i=!!n&&n.isLightboxVisible();e.isFolder()||!e.isFolder()&&!i?q.navigate(t,{trigger:!0}):!e.isFolder()&&i&&l.dispatchEvent("lightbox:onCancelClick",[t]),ue(e)},"drivesView:onWannaChangeSelection":function(t){new e(((e,i)=>{if(n.trackNavigation({eventAction:"switch-service",tenant:t.get("id")}),t.get("authenticated"))return e();t.save({authenticated:!0},{wait:!0,onComplete:e,onFailure:i})})).then((()=>{t.get("auth")&&t.get("auth").platform&&t.get("auth").platform.id&&b.setValue("x3dPlatformId",t.get("auth").platform.id),se(t)}),(()=>{s.add({message:B.get("authenticationError",{service:t.get("title")}),className:"error"}),q.navigate("",{trigger:!0,loadBaseUri:!0})}))},"driveView:onNodeClick":function(e){var t=e.drive;n.trackNavigation({eventAction:"tree"}),b.getValue("is3DSpaceWidget")&&e.isCollabSpace()&&(e.securityContext(e),e.get("solution")!==C.boType.team&&s.add({message:B.warningNonOCDX,className:"warning"})),q.navigate(t.getInodePanelContentURI(e),{trigger:!0})},"driveTreeView:onPreExpand":function(e){(!b.getValue("is3DSpaceWidget")||b.getValue("is3DSpaceWidget")&&!e.isCollabSpace())&&e.inodeTable.fetch({reset:!1,merge:!1,remove:!1})},"inodePanelView:onSort":function(e){const t=p.getSecondPanel();if(!t)return;const n=t.model.inodeTable;n&&(b.setValue("inodesSorting",e),n.sort({sorting:e}),p.getSecondPanel().refreshTopBarView())},"inodePanelView:onPathClick":function(e){n.trackNavigation({eventAction:"breadcrumb"}),q.navigate(e,{trigger:!0})},"inodePaneView:onChangeSelection":function(e,t){if(e,!t.length)return G&&u.unfocus(),d.publish("resetObject"),void d.publish("resetX3DContent");G&&u.focusOnSubjectsWithInode(t),!0!==e.isCollabSpace()&&(d.publish("setObject",E.getObject(e)),d.publish("setX3DContent",E.get3DXContent(t)))},"inodeTableScrollView:onNextPage":function(e){e.getNextPage({evnt:"onFilterChange",merge:!1,remove:!1})},"inodeAllAccessesView:onNextPage":function(e){e.getNextPage({permissions:e,merge:!1,remove:!1})},"inodeView:onDblClick":function(e,t){if(e.isContainer()||e.drive.isCollabSpace)ae(e);else if(!e.isContainer()&&"TRASH"!==e.get("root")&&e.getActionIds().includes("preview"))if(M.isLinkedFile(e)){const n=()=>{const t={queryStrings:{expand:"force"}};l.dispatchEvent("inodeView:onDblClick",[e,t])};re(e,t,ae.bind(null,e),n)}else ae(e)},"inodeFileHistoryView:onVersions":function(e){e.inodeVersions.fetch({reset:!0,onFailure:function(){s.add({message:B.contentHistoryError,className:"error"})}})},"inodeDetailAccessesView:onAccesses":function(e){e.permissions.fetch({inode:e,firstLoad:!0,onFailure:function(){s.add({message:B.replace(B.permissionError,{name:e.get("title")}),className:"error"})}})},"lightbox:onPreviewError":function(){s.add({message:B.replace(B.previewError),className:"error"})},"lightbox:onCancelClick":function(e){G&&(u.unfocus(),u.activate()),p.hideLightbox(),q.navigate(e,{trigger:!1}),z=void 0},"lightbox:onArrowClick":function(e){q.navigate(e,{trigger:!0})},"lightbox:onPlay":function(e){n.trackAction({model:e,eventAction:"play360",contextView:"lightbox"}),p.updateLightbox(e,!0)},"lightbox:onAnnotationShared":function(e){const t=p.getLightbox();t.showCommentsPanel(!0);const n=t.getCommentsPanel();let i,o=!1;setTimeout((function(){clearTimeout(i),o||s.add({message:B.annotationSharedError,className:"error"})}),25e3),function a(){t.isCommentsPanelVisible()&&n.view._successFullInit?(o=!0,n.view.elements.socialToolbar.setActiveCommentInputContent({annotations:[{annotation:{screenshot:e.screenshot,annotation:e.annotation}}]})):i=setTimeout(a,100)}()},"socialToolbar:onPreviewAnnotation":function(e,t){if(e.editMode)s.add({message:B.get("cannotLoadAnnotationInEditMode"),className:"warning"});else{e.set("annotation",t);const n=p.getLightbox(),i=e.drive,o={trigger:!0};n&&n.isLightboxVisible()&&(o.force=!0,n.getContainer().$el.getBoundingClientRect().width<639&&n.showCommentsPanel(!1)),q.navigate(i.getInodePreviewURI(e),o)}},"preferences:onEdit":function(){const e=window.parent.document.getElementById("m_"+b.id).getElementsByClassName("form-vertical form")[0],t=z?z.get("title"):H.get("title");if(e){const n=this;require(["DS/W3DDriveApp/Views/PreferencesView"],(function(i){new i({widget:b,currentModelTitle:t,currentNavigationFragment:n.getLastFragment()}).inject(e,"bottom")}))}},"inodeActions:onShareAccess":function(t,n,i){var o=t.get("title");e.all(n.map((function(n){return new e((function(e,o){var a=t.permissions.findWhere({id:n.id});a?a.save(n,Object.assign({wait:!0,onComplete:e,onFailure:o},i)):t.permissions.create(n,Object.assign({wait:!0,onComplete:e,onFailure:o},i))}))}))).then((function(){s.add({message:B.replace(B.shareElemSuccess,{name:o}),className:"success"}),t.set("shared",!0)}),(function(e){Array.isArray(e)||(e=[e]);var t=e.some((function(e){return"timeout"===e.reason}));if(n.length!==e.length||t){var i=e.filter((function(e){return"function"==typeof e.permission.get})).map((function(e){return e.permission.get("displayName")}));s.add({message:B.replace(B.shareErrorMembers,{name:o,members:i.join(", ")}),className:"error"}),t&&s.add({message:B.replace(B.shareTimeout,{name:o}),className:"warning"})}else s.add({message:B.replace(B.shareError,{name:o}),className:"error"})}))},"access:onUpdate":function(t,n,i){var o=t.get("accessright");new e((function(e,o){t.save({accessright:n},Object.assign({wait:!0,onComplete:e,onFailure:o},i))})).then((function(){s.add({message:B.replace(B.shareSucess,{access:B[t.get("accessright")],name:t.collection._parentInode.get("title"),userName:t.get("title")}),className:"success"})}),(function(e){t.set("accessright",o),s.add({message:e&&e.message?e.message:B.replace(B.shareError,{name:t.collection._parentInode.get("title")}),className:"error"})}))},"access:onRemove":function(e,t){var n=Object.assign({},t),i=e.get("title");n.messageSuccess=B.replace(B.shareRemoveSuccess,{name:i}),n.messageFailure=B.replace(B.shareRemoveError,{name:i}),le(e,n)},"inodesActions:onShareAccess":function(e,t){e[0].collection.shareChildren(e,t).then((function(){s.add({message:B.replace(B.sharesSuccess),className:"success"})}),(function(t){var n=B.get("sharesError",{nbFail:t.length,nbItems:e.length}),i=e.length-t.length;s.addAndCallback({message:n,className:"error",callback:function(){var e=B.get("sharesSuccessDetail",{nbSuccess:i})+"</br> </br>";e+=B.get("sharesErrorDetail")+"</br> </br>";var n=[];return t.map((function(e){return n.push(e.inode.get("title")),n})),new c({message:e,items:n})}})}))},"inodeActions:removeOwnAccess":function(e){V.dialog({title:B.get("revokeAccess"),body:B.get("revokeOwnAccessDescription"),buttons:[{className:"primary",value:B.get("Revoke"),action:function(t){var n=e.drive.get("user").displayName;e.permissions.removeOwnAccess({onComplete:function(){s.add({message:B.replace(B.get("shareRemoveSuccess"),{name:n}),className:"success"}),e.collection&&e.collection.remove(e)},onFailure:function(){s.add({message:B.replace(B.get("shareRemoveError"),{name:n}),className:"error"})}}),t.hide()}},{value:B.get("cancel"),action:function(e){e.hide()}}]})},"inodeActions:onAddToFavorites":function(e){ee(e)},"inodesActions:onAddToFavorites":function(e,t){if((t=t||{}).isDnD&&t.favoritesRootInode){const n=t.favoritesRootInode;e=e.map((e=>n.drive.getInode({id:e.inodeId,containerToSearchIn:e.rootId})))}ee(e)},"inodeActions:onRemoveFromFavorites":function(e){te(e)},"inodesActions:onRemoveFromFavorites":function(e){te(e)}}),N.setw3dDriveView(p),N.setRouter(q),F.subscribe("3ddrive.resfresh.notif",(function(e){b.getValue("is3DSpaceWidget")||N.processEvent(e,e.lastmodifier===b.getValue("3ddrive_uuid"))})),b.body.empty(),!0===Q&&document.body.addClassName("standalone");var pe=!1;let me,ge,fe=[];!0===Q?(X=[{key:"inode-detail-properties",view:S,nls:B.properties,icon:"doc-text"},{key:"inode-detail-comments",view:v,nls:B.comments,icon:"comment",action:$.actionPubIds.comment}],pe=!0,fe=["title","modifiedDate","createdDate","size","type","creator"],me="title-a"):"true"===b.getValue("is3DSpaceWidget")?(X=[{key:"inode-detail-properties",view:w,nls:B.properties,icon:"doc-text"},{key:"inode-detail-accesses",view:g,nls:B.get("Members"),icon:"users",action:$.actionPubIds.viewAccesses},{key:"inode-detail-analytics",view:h,nls:B.analytics,icon:"chart-bar",action:$.actionPubIds.viewAnalytics}],fe=["title","modifiedDate","createdDate"],me="modifiedDate-a",ge=L):(X=[{key:"inode-detail-properties",view:S,nls:B.properties,icon:"doc-text"},{key:"inode-detail-history",view:f,nls:B.history,icon:"navigation-history",action:$.actionPubIds.viewHistory},{key:"inode-detail-accesses",view:m,nls:B.get("Members"),icon:"users",action:$.actionPubIds.viewAccesses},{key:"inode-detail-comments",view:v,nls:B.comments,icon:"comment",action:$.actionPubIds.comment}],fe=["title","modifiedDate","createdDate","size","type","creator"],me="title-a",ge=R);var ve={detailViewsList:X,defaultView:"inode-detail-properties"},De={viewSpecs:{drivesPanelView:{treeView:{expandFolderOnOver:!b.getValue("is3DSpaceWidget"),contextMenu:!b.getValue("is3DSpaceWidget")}},inodePanelView:{detailViewSpecs:ve,contentViewSpecs:{emptyView:ge,quotaExceededView:D,filterType:b.getValue("is3DSpaceWidget")?"none":"default"},multisel:!b.getValue("is3DSpaceWidget"),sortingList:fe,sorting:b.getValue("inodesSorting")?b.getValue("inodesSorting").id:me},hideFirstPanel:pe,lightboxView:{detailViewSpecs:ve}}};return p.render(De).inject(b.body),q}));