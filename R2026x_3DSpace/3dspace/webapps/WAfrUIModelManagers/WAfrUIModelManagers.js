define("DS/WAfrUIModelManagers/ContextualUIComponentManager",["UWA/Core","UWA/Class","DS/Selection/CSOManager","DS/WAfrControls/WAfrContextualBar","DS/CoreEvents/Events","DS/Core/PointerEvents","DS/WAfrControls/WAfrContextualMenu","DS/WAfrHandlers/mod_HandlerComponent","DS/Utilities/DeviceUtils"],(function(e,t,n,i,o,r,a,s,l){"use strict";function d(e,t,n){return Math.abs(e-t)<=n}class u{constructor(){this._subscribers=[]}subscribe(e,t,n){e.addEventListener(t,n),this._subscribers.push({sender:e,event:t,callback:n})}unsubscribeAll(){this._subscribers.forEach((e=>{e.sender.removeEventListener(e.event,e.callback)})),this._subscribers=[]}}return t.extend({init:function(){this._parent()}}).extend({defaultOptions:{onContextualBarReady:function(){return null},onContextualMenuReady:function(){return null},subscribersId:void 0},setContext:function(e){var t=this;void 0!==e.executionContext&&(t._executionContext=e.executionContext),void 0!==e.UIComponent&&(t._uiComponent=e.UIComponent),void 0!==e.UIFrame&&(t._uiFrame=e.UIFrame,t._container=t._uiFrame.getContainer(),void 0!==t._container&&(t._unbindBehaviors(),t._bindBehaviors())),void 0!==e.Viewer&&(t._viewer=e.Viewer)},init:function(t){var i=this;i.options=e.extend(e.clone(this.defaultOptions),t),i._parent(),i._contextBar=null,i._isInViewpointManipulation=!1,i._listOfSubscribers=[],i._ContextualBarAvailable=!0,i._ContextualBarOnLeftClic=!0,i._ContextualMenuOnRightClic=!0,n.onEmpty((function(){i.hideContextualMenus()})),i._eventsSubscriptions=new u},register:function(t){(t=e.extend(e.clone(this.defaultOptions),t)).merge||(this._listOfSubscribers=[]),this._listOfSubscribers.push(t)},registerUnshift:function(t){(t=e.extend(e.clone(this.defaultOptions),t)).merge||(this._listOfSubscribers=[]),this._listOfSubscribers.unshift(t)},unregister:function(e){if(e)for(var t=0;t<this._listOfSubscribers.length;t++)if(this._listOfSubscribers[t].subscriberId===e){this._listOfSubscribers.splice(t,1);break}},dispose:function(){o.unsubscribe(this._visuEventToken),o.unsubscribe(this._ctxbarHiddenEventToken)},hideContextualMenus:function(){this._listOfSubscribers.length&&(document.body.removeEventListener("mouseup",this._hideListener),i.hide(),
//! IR-1226205-3DEXPERIENCER2024x
a.hide())},hideContextualMenu:function(){},buildDefaultHandlerContextMenuItem:function(e){var t=this._executionContext.getComponent(s.DEFAULT_COMPONENT_NAME);return a._createHandlerModel(e,t)},buildCheckHandlerContextMenuItem:function(e){var t=this._executionContext.getComponent(s.DEFAULT_COMPONENT_NAME);return a._createCheckHandlerModel(e,t)},deactivateContextualBarOnLeftClic:function(){this._ContextualBarOnLeftClic=!1},activateContextualBarOnLeftClic:function(){this._ContextualBarOnLeftClic=!0},deactivateContextualBar:function(){this._ContextualBarAvailable=!1},activateContextualBar:function(){this._ContextualBarAvailable=!0},deactivateContextualMenuOnRightClic:function(){this._ContextualMenuOnRightClic=!1},activateContextualMenuOnRightClic:function(){this._ContextualMenuOnRightClic=!0},getContextualBar:function(){return i},_onBarDisplayed:null,_onMenuDisplayed:null,_showContextualBar:async function(e){void 0===e&&(e={});var t=this;let n;if(e.freeZone=t._uiFrame.getImmersiveFrame().getFreeZone(),document.body.removeEventListener("mouseup",this._hideListener),document.body.addEventListener("mouseup",this._hideListener),n=t._contextBar||t.getContextualBar(),await(n?.hide()),t._listOfSubscribers.length){e.executionContext=t._executionContext,e.viewer=void 0;let n=t._executionContext.getApplicationComponent("Viewer");n&&(e.viewer=n.get3DViewer()),e.uiFrame=t._uiFrame.getUIFrame(),e.uiComponent=t._uiComponent,!0===t._isTouch?(e.Xposition=void 0===e.x?t._initMousePos.x:e.x,e.Yposition=void 0===e.y?t._initMousePos.y:e.y):(e.Xposition=void 0===e.x?t._mousePos.x:e.x,e.Yposition=void 0===e.y?t._mousePos.y:e.y),e.subscribersOptions=void 0===e.fillingList||0===e.fillingList.length?t._listOfSubscribers:e.fillingList,e.hideWithDistance=void 0===e.hideWithDistance||e.hideWithDistance,null!==t._onBarDisplayed&&(e.eventCallback=t._onBarDisplayed.bind(t)),e.Xoffset=void 0===e.Xoffset?45:e.Xoffset,e.Yoffset=void 0===e.Yoffset?-45:e.Yoffset,t._ContextualBarAvailable&&i.show(e)}},_showContextMenu:function(e){void 0===e&&(e={});var t=this;let n;if(e.freeZone=t._uiFrame.getImmersiveFrame().getFreeZone(),document.body.removeEventListener("mouseup",this._hideListener),document.body.addEventListener("mouseup",this._hideListener),t._listOfSubscribers.length){e.executionContext=t._executionContext,e.viewer=void 0;let i=t._executionContext.getApplicationComponent("Viewer");i&&(e.viewer=i.get3DViewer()),e.uiFrame=t._uiFrame.getUIFrame(),e.uiComponent=t._uiComponent,!0===t._isTouch?(e.Xposition=void 0===e.x?t._initMousePos.x:e.x,e.Yposition=void 0===e.y?t._initMousePos.y:e.y):(e.Xposition=void 0===e.x?t._mousePos.x:e.x,e.Yposition=void 0===e.y?t._mousePos.y:e.y),e.subscribersOptions=void 0===e.fillingList||0===e.fillingList.length?t._listOfSubscribers:e.fillingList,e.Xoffset=void 0===e.Xoffset?45:e.Xoffset,e.Yoffset=void 0===e.Yoffset?-45:e.Yoffset,n=a.show(e)}return n},
//! IR-1224606-3DEXPERIENCER2024x
_onLongHold:function(e){if(r.isTouchEvent(e)&&l.isMobileiOS()){null!=this._longHoldTimer&&clearTimeout(this._longHoldTimer);let t=this;function n(e){document.removeEventListener("click",n,!0),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),null!=t._longHoldTimer&&clearTimeout(t._longHoldTimer)}this._longHoldTimer=setTimeout((()=>{document.removeEventListener("click",n,!0),this._longHoldTimer=null}),600),document.addEventListener("click",n,!0),this._onRightClick(e)}},_onRightClick:function(e){document.body.removeEventListener("mouseup",this._hideListener),document.body.addEventListener("mouseup",this._hideListener);var t=this;e.preventDefault();let n=t._uiFrame.getContainer().getBoundingClientRect();t._finalMousePos={x:e.clientX-n.left,y:e.clientY-n.top};
//! IR-1184944-3DEXPERIENCER2024x
//! Context menu isn’t open at all when left side panel is open
//! IR-1360866 - Right click contextual menu on 1D doc annotation missing
let i=!1,o=!1;const r=this._executionContext.getComponent("Viewer");if(null!=r){const t=r.get3DViewer();if(null!=t&&null!=t.canvas){const n=t.canvas,r=t.divCss3DElement;e.srcElement==n?i=!0:r.contains(e.srcElement)&&(o=!0)}}
//! IR-1184944-3DEXPERIENCER2024x
//! Context menu isn’t open at all when left side panel is open
//! IR-1222626-3DEXPERIENCER2024x
//! IR-1226205-3DEXPERIENCER2024x
//! IR-1360866 - Right click contextual menu on 1D doc annotation missing
let s=0;if(t._isTouch&&(s=5),!1!==t._ContextualMenuOnRightClic&&4!==e.buttons&&d(t._initMousePos.x,t._finalMousePos.x,s)&&d(t._initMousePos.y,t._finalMousePos.y,s)&&(i||o||d(t._initMouseOffset.x,t._finalMousePos.x,s)&&d(t._initMouseOffset.y,t._finalMousePos.y,s))){var l={hideWithDistance:!1,x:t._mousePos.x,y:t._mousePos.y,Xoffset:0,Yoffset:-5,withContextMenu:!0};
//! IR-1184944-3DEXPERIENCER2024x
//! Context menu isn’t open at all when left side panel is open
i&&(l.viewerX=e.offsetX,l.viewerY=e.offsetY),t._isTouch&&(l.x=t._finalMousePos.x,l.y=t._finalMousePos.y);let n=t._showContextMenu(l);if(void 0!==n&&(l.rectCtxMenuInfo=n.ctxMenuDimPos),t._showContextualBar(l),!0===t.getContextualBar().isShown()&&void 0!==n){t.getContextualBar().getContent().getBoundingClientRect().x<l.x&&l.x>=l.rectCtxMenuInfo.x&&(l.x=l.x+l.Xoffset-l.rectCtxMenuInfo.width,a._display(n.menuContent,l))}}},_convertToMenuOptions:function(e){var t=this._executionContext.getComponent(s.DEFAULT_COMPONENT_NAME);return a._convertToMenuOptions(e,t)},_bindBehaviors:function(){var t=this;t._mousePos={x:0,y:0};const n=t._uiFrame.getContainer();t._eventsSubscriptions.subscribe(n,"mousemove",(function(e){let n=t._uiFrame.getContainer().getBoundingClientRect();t._mousePos={x:e.clientX-n.left,y:e.clientY-n.top}})),this._hideListener=function(t){e.Event.findElement(t,".wux-afr-contextual-bar")},t._eventsSubscriptions.subscribe(n,r.POINTERDOWN,this._onPointerDown.bind(this)),t._eventsSubscriptions.subscribe(n,"mousedown",this._onMouseDown.bind(this)),t._eventsSubscriptions.subscribe(n,r.POINTERUP,this._onMouseUp.bind(this)),t._eventsSubscriptions.subscribe(n,"contextmenu",this._onRightClick.bind(this)),
//! IR-1224606-3DEXPERIENCER2024x (see main comment in this file)
t._eventsSubscriptions.subscribe(n,r.LONGHOLD,this._onLongHold.bind(this));var i=0,a=function(e){i=0},s=!1;t._visuEventToken=o.subscribe({event:"/VISU/"},(function(e){var n={};"@onViewpointChange"===e.eventType?(0===i&&(!0===t.getContextualBar().isShown()&&(s=!0),t.hideContextualMenus(),t._uiFrame.getContainer().removeEventListener("mouseup",a),t._uiFrame.getContainer().addEventListener("mouseup",a)),i++):"@onViewpointBeginMove"===e.eventType?(i=0,t._isInViewpointManipulation=!0,s=!1):"@onViewpointEndMove"===e.eventType?(t._isInViewpointManipulation=!1,!0===s&&(t.hideContextualMenus(),n.hideWithDistance=!0,t._showContextualBar(n))):"@onClickEvent"===e.eventType&&!0===t._ContextualBarOnLeftClic&&("@pickNothing"!==e.eventID&&"@pickPrimitive"!==e.eventID&&"@pickRep"!==e.eventID&&"@pickMesh"!==e.eventID&&"@leftClickDown"!==e.eventID||(t.hideContextualMenus(),(
//! IR-1184937-3DEXPERIENCER2024x
//! Contextual bar isn’t displayed at the right location when left panel opened
n={x:e.event.event.clientX,y:e.event.event.clientY,viewerX:e.event.currentPosition.x,viewerY:e.event.currentPosition.y}).hideWithDistance="Touch"!==e.event.type,t._showContextualBar(n)))})),this._ctxbarHiddenEventToken=o.subscribe({event:"WUX/AFR/ctxBarHidden"},(function(){t.hideContextualMenu()}))},_unbindBehaviors:function(){
//! IR-1224606-3DEXPERIENCER2024x (see main comment in this file)
this._eventsSubscriptions.unsubscribeAll(),o.unsubscribe(this._ctxbarHiddenEventToken)},_onMouseUp:function(e){1===e.button&&(this._isInViewpointManipulation=!1)},_onMouseDown:function(e){var t=this;let n=t._uiFrame.getContainer().getBoundingClientRect();t._initMousePos={x:e.clientX-n.left,y:e.clientY-n.top},t._initMouseOffset={x:e.offsetX,y:e.offsetY},1===e.button&&(t._isInViewpointManipulation=!0)},_onPointerDown:function(e){var t=this;let n=t._uiFrame.getContainer().getBoundingClientRect();t._initMousePos={x:e.clientX-n.left,y:e.clientY-n.top},t._initMouseOffset={x:e.offsetX,y:e.offsetY},t._isTouch=r.isTouchEvent(e)}})})),define("DS/WAfrUIModelManagers/mod_ActionBarResponsiveManager",["DS/Utilities/DeviceUtils"],(function(e){"use strict";function t(){this.compute()}function n(){this.compute()}let i=Object.create(null);return i.ActionBarResponsiveManager=class{constructor(e,t){this._private=Object.create(null),this._private._actionBar=e,this._private._smallViewportActionBar=t,this._private._state=null,this.configureMediaQueries()}getSmallViewportActionBar(){return this._private._smallViewportActionBar}getActionBar(){return this._private._actionBar}configureMediaQueries(){this._private._mediaQueryXS=window.matchMedia("screen and (max-width: 240px), screen and (max-height: 240px)"),this._private._boundOnMediaQueryXS=t.bind(this),this._private._mediaQueryXS.addListener(this._private._boundOnMediaQueryXS),this._private._mediaQuerySVAB=window.matchMedia("screen and (min-width: 241px) and (max-width: 580px), screen and (min-height:241px) and (max-height: 280px)"),this._private._boundOnMediaQuerySVAB=n.bind(this),this._private._mediaQuerySVAB.addListener(this._private._boundOnMediaQuerySVAB)}compute(){let t=null;return t=this._private._mediaQueryXS.matches&&(e.isAndroid()||e.isMobileiOS())?this.setState(null):this._private._smallViewportActionBar&&this._private._mediaQuerySVAB.matches?this.setState("SVAB"):this.setState("SAB"),t}setState(e){let t=Promise.resolve();return null===e?(this._private._actionBar.hide(),this._private._smallViewportActionBar&&this._private._smallViewportActionBar.hide()):"SAB"===e?(this._private._smallViewportActionBar&&this._private._smallViewportActionBar.hide(),t=this._private._actionBar.show()):"SVAB"===e&&(this._private._actionBar.hide(),this._private._smallViewportActionBar&&(t=this._private._smallViewportActionBar.show())),t}clean(){this._private._mediaQueryXS.removeListener(this._private._boundOnMediaQueryXS),this._private._mediaQuerySVAB.removeListener(this._private._boundOnMediaQuerySVAB)}},i})),define("DS/WAfrUIModelManagers/MainUIComponentManager",["css!DS/WAfrUI/wafr.css","UWA/Core","UWA/Class","DS/Windows/Panel","DS/Menu/ContextualMenu","DS/WAfrModelEvents/mod_ModelEvents","DS/Utilities/TouchUtils","DS/WAfrUIStandardComponents/mod_TreeModel","DS/WAfrTweakers/TweakerHandlerGenerateMethods","DS/WAfrUIComponents/mod_SmallViewportActionBar","DS/WAfrUIModelManagers/mod_ActionBarResponsiveManager","DS/WAfrUtils/mod_Performances","i18n!DS/WAfrUIModelManagers/assets/nls/ActionBarContextMenu","DS/WAfrControls/WAfrUIExpander","DS/Utilities/DeviceUtils","DS/Menu/ContextualMenu"],(function(e,t,n,i,o,r,a,s,l,d,u,c,h,p,f,_){"use strict";const m=!("false"===localStorage.getItem("ACTION_BAR_OPTIMIZED_WINDOW_GROUP_CREATION")),v=d.SmallViewportActionBar,g=u.ActionBarResponsiveManager,C=c.Performances,w="[DS/WAfrUIModelManagers/MainUIComponentManager]",b=new C;var M=r.DEFAULT_COMPONENT_NAME;if(!M||0===M.length)throw new Error("mod_ModelEvents.DEFAULT_COMPONENT_NAME has to be defined");const A=46,x=74,y=52,S=70,E=96,B=88,D=112;function I(e){const t=e._showLabelFlag,n=e._touchMode,i=e._panels;if(i&&i.length>0){let e=A;if(t?e=x:n&&(e=y),i[0].minWidth!==e)for(const t of i)t.minWidth=e}}function L(e){const t=e._panels;if(t&&t.length>0){let n=t[0].immersiveFrame;if(null!=n){let t=n.getDockingElement(WUXDockAreaEnum.TopDockArea),i=n.getDockingElement(WUXDockAreaEnum.BottomDockArea);void 0!==i&&void 0!==t&&(i.minSize=function(e,t){let n=S;return e&&t?n=D:e?n=B:t&&(n=E),n}(e._touchMode,e._showLabelFlag),i.dockingZoneSize=i.minSize,i._saveDockingZoneSizeInPreferences(),t.minSize=i.minSize,t.dockingZoneSize=i.minSize,t._saveDockingZoneSizeInPreferences(),i.elements.dockingWithCollapserContainer.classList.add("WAfrPageObjectUseOnly-WAfr-Actionbar"))}}}function W(e){return e.getData().view=document.createDocumentFragment(),Promise.resolve()}function k(e){let t=e.getData(),n=document.createElement("div");n.classList.add("wafr-toolbar-section-group");let i=document.createElement("div");return i.classList.add("wafr-toolbar-section-group-primary"),n.appendChild(i),t.view=n,Promise.resolve()}function P(e){let t=e.getData(),n=(new p).getDom(),i=O.bind(this);return n.addEventListener("expand",i),n.addEventListener("collapse",i),n.classList.add("wafr-toolbar-section-group-secondary"),t.view=n,Promise.resolve()}function F(e){let t="";for(let n of e){let e;e=n.accept({visitActionHandler:()=>!1,visitCommandHandler:()=>!1,visitCheckHandler:()=>!0,visitRadioHandler:()=>{throw new Error("RadioHandlers are not supported in a Set.")}})?n.getState()?n.onCheckHandler:n.onUncheckHandler:n,e&&e.getI18n()&&(t=t+e.getI18n().title+",")}return t}function U(e,t){let n="";switch(t.type){case"commandHandler":case"actionHandler":n=t.handler.getI18n().title+",";break;case"checkHandlerButton":n=(t.handler.getState()?t.handler.onCheckHandler:t.handler.onUncheckHandler).getI18n().title+",";break;case"set":n=F(t.view.dsModel.value.items);break;case"radioHandler":case"radioHandlerLoopButton":n=F(t.handler.items)}if(null!==e.getAttribute("data-wafrpageobectuseonlysecondaryarea")){n=e.getAttribute("data-wafrpageobectuseonlysecondaryarea")+n}e.setAttribute("data-wafrpageobectuseonlysecondaryarea",n)}function O(){var e=this;if(!e._panels[0].immersiveFrame)throw new Error("no immersive frame related to this panel",e._panels[0]);if(I(e),!e._panels[0].immersiveFrame.getDockingElement(WUXDockAreaEnum.BottomDockArea))throw new Error("no bottom dock area in this immersive frame",e._panels[0].immersiveFrame);e._panels.forEach((function(e){e.fire("dimensionsChanged"),e.currentDockArea!==WUXDockAreaEnum.TopDockArea&&e.currentDockArea!==WUXDockAreaEnum.BottomDockArea||e._afr._bound_computeCompactWidth()}))}function T(e){if(!e)throw new Error("executionContext not found");const t=e.getSourceApp(),n=t?t.getId():void 0,i=e.getTargetApp(),o=i?i.getId():void 0;return o||n}function V(e,t,n,i){let o=e.getData(),r=b.start([w,"[Async] generateTweaker",e.getId()].join(" ")),a=[],s=e.getForwardIterator();for(;s.isValid();){let e=s.get().getData();a.push(e.handler),s.next()}let l=t.handlerSet({value:{items:a},typePath:o.type,touchMode:i,modelEventsCpt:n,showLabelFlag:this._showLabelFlag,appId:T(this._uiComponent.getExecutionContext()),handlerTrigger:"AfrActionBar"});return this._tweakersView.push(l),o.view=l.getContent(),b.stop(r),Promise.resolve()}function X(e,t,n,i){let o=null,r=e.getData();if(r.handler){let e=r.handler,a=b.start([w,"[Async] generateTweaker",e.getId()].join(" ")),s=t[r.type]({value:e,typePath:r.type,touchMode:i,modelEventsCpt:n,showLabelFlag:this._showLabelFlag,appId:T(this._uiComponent.getExecutionContext()),handlerTrigger:"AfrActionBar"});this._tweakersView.push(s);let l=s.getContent();r.view=l,b.stop(a),o=Promise.resolve()}else console.error(r.label,"is not a handler"),o=Promise.resolve(new Error(r.label+" is not a handler"));return o}function R(e){return Object.assign({},e)}function H(){var e=this;if(!e)throw new Error("panel must be defined");var t=b.start([w,"[Sync] computeCompactWidth",e.identifier].join(" "));if(!e._afr._isContentInitialized)return void b.stop(t);var n=e.content.parentNode.getBoundingClientRect().height;if(n<0)throw b.stop(t),new Error("panelHeight must not be a negative number");if(0===n)return void b.stop(t);var i=e.content.getElementsByClassName("wafr-toolbar-section-group"),o=0;let r=i.length;if(r>0){var a=window.getComputedStyle(i[0],null);n-=parseInt(a.paddingTop,10),n-=parseInt(a.paddingBottom,10),o=parseInt(a.paddingLeft,10)+parseInt(a.paddingRight,10)}for(var s=e.content.getElementsByClassName("wafr-toolbar-section-group-primary"),l=null,d=null,u=0,c=0,h=0,p=s.length,f=null,_=null,m=null;h<p;++h){if((m=(f=s[h]).getElementsByClassName("wafr-tweakers"))&&(_=Array.from(m)),!_)throw b.stop(t),new Error("Empty group");if(null===l&&m.length>0){var v=window.getComputedStyle(m[0],null),g=parseInt(v.paddingTop,10)+parseInt(v.paddingBottom,10);l=_[0].getBoundingClientRect().height+g}var C=0;l>0&&(C=Math.floor(n/l)),0===C&&(C=1);for(var M=Math.ceil(_.length/C),A=0,x=1,y=0,S=0;A<M;++A){for(var E=_[y].getBoundingClientRect().width;x<=C&&y<_.length;)(d=_[y].getBoundingClientRect().width)>E&&(E=d),++y,++x;x=1,S+=E}u=S,(h>0||0===h&&0===m.length)&&(u+=1),f.style.width=Math.ceil(u)+"px",c+=Math.ceil(u)}let B=function(e,t){let n=0,i=0;if(!e)throw new Error("panel must be defined");t<=0&&(t=1);let o=b.start([w,"[Sync] computeSecondaryCompactWidth",e.identifier].join(" ")),r=e.content.getElementsByClassName("wafr-toolbar-section-group-secondary");if(r.length<=0)return i;window.getComputedStyle(r[0],null);let a,s=null,l=0,d=r.length,u=null,c=null,h=null,p=0,f=null;r[0]&&r[0].children&&("wafr-ui-control-expander-button-collapsed"===r[0].firstChild.className||"wafr-ui-control-expander-button-expanded"===r[0].firstChild.className)&&(f=r[0].firstChild);if(f){p=f.getBoundingClientRect().width;let e=window.getComputedStyle(f,null);a=parseInt(e.paddingLeft,10)+parseInt(e.paddingRight,10),p=a+p}for(;l<d;++l){if(u=r[l],h=u.getElementsByClassName("wafr-ui-control-expander-item-container"),h&&(c=h[0]),n=p,!c||0===c.length){i+=n,u.style.width=Math.ceil(n)+"px";continue}let e=Math.ceil(c.childNodes.length/t),o=0,a=1,d=0,f=0;for(;o<e;++o){let e=c.childNodes[d].getBoundingClientRect().width;for(;a<=t&&d<c.length;)s=c.childNodes[d].getBoundingClientRect().width,s>e&&(e=s),++d,++a;a=1,f+=e}n+=f,i+=Math.ceil(n),u.style.width=Math.ceil(n)+"px"}return b.stop(o),i}(e,C);c+=B,c+=r*o,e.content.style.width=c+"px",e.fire("dimensionsChanged"),b.stop(t)}function N(e){for(var t=b.start([w,"[Sync] computeAndResizeForAllPanels"].join(" ")),n=0,i=e.length,o=null;n<i;++n)!1!==(o=e[n])._afr._isContentInitialized&&(o.content.classList.contains("column")?(-1!==o.height&&(o.height=-1),o.windowGroup&&-1!==o.windowGroup.height&&(o.windowGroup.height=-1)):(-1!==o.width&&(o.width=-1),o.windowGroup&&-1!==o.windowGroup.width&&(o.windowGroup.width=-1)),o.currentDockArea!==WUXDockAreaEnum.TopDockArea&&o.currentDockArea!==WUXDockAreaEnum.BottomDockArea||o._afr._bound_computeCompactWidth());b.stop(t)}function G(e,t){e.content.style.height="",e.content.style.width="auto";for(var n=e.content.getElementsByClassName("wafr-toolbar-section-group-secondary"),i=0,o=n.length,r=null;i<o;++i)(r=n[i])&&(r.style.width="auto",t?(r.classList.add("wafr-ui-control-expander-horizontal"),r.classList.remove("wafr-ui-control-expander-vertical")):(r.classList.remove("wafr-ui-control-expander-horizontal"),r.classList.add("wafr-ui-control-expander-vertical")))}function z(){var e=b.start([w,"[Sync] onPrePlaceChangeCB"].join(" ")),t=this.panel;if(!t)throw b.stop(e),new Error("panel must be defined");t.currentDockArea===WUXDockAreaEnum.TopDockArea||t.currentDockArea===WUXDockAreaEnum.BottomDockArea?(t.content.classList.remove("column"),t.resizableFlag="vertical",L(this),t.removeEventListener("resize",t._afr._bound_computeCompactWidth),t.addEventListener("resize",t._afr._bound_computeCompactWidth),t.removeEventListener("activate",t._afr._bound_computeCompactWidth),t.addEventListener("activate",t._afr._bound_computeCompactWidth),G(t,!0)):(t.removeEventListener("resize",t._afr._bound_computeCompactWidth),t.removeEventListener("activate",t._afr._bound_computeCompactWidth),function(e){e.content.style.height="",e.content.style.width="auto";for(var t=e.content.getElementsByClassName("wafr-toolbar-section-group-primary"),n=0,i=t.length;n<i;++n)t[n].style.width="auto"}(t),t.content.classList.add("column"),t.resizableFlag="horizontal",G(t,!1)),N(this.mainUIComponentManager._panels),b.stop(e)}function Y(e){return"item"===e||"section"!==e&&"group"!==e&&"set"!==e&&"secondaryArea"!==e}return n.extend({defaultOptions:{availability:!0,visibleFlag:!0},init:function(e){this.options=t.extend(t.clone(this.defaultOptions),e),this._parent(),this._panels=[],this._tweakersView=[],this._touchMode=a.getTouchMode(),this._defaultTabOrder=[],this._isViewGenerated=!1,this._showLabelFlag=this.getShowLabelFlagPreference(),this._originalTouchValue=this._touchMode,this._handleTouchChange(),this._manageBrowserZoom()},createView:function(e,t,n,o,r,a){var l=this;let d=[],u=function(e,t,n){let i=new(0,s.TreeModel)({identifier:"root"});for(let t=0,o=e.length;t<o;++t){let o=R(e[t].options.grid);if(o.hasOwnProperty("category")&&void 0!==o.category){let e=o.category;Array.isArray(o.category)&&(e=o.category[0]);let t=null,r=i.getChild(e);if(!r){let t=e;n&&n[e]&&n[e].internationalization&&n[e].internationalization.title&&(t=n[e].internationalization.title),r=i.addChild({identifier:e,title:t,type:"section"})}if(t=r,o.group||(o.group=`${e}_defaultGroup`),o.hasOwnProperty("group")&&void 0!==o.group){let e=t.getChild(o.group);e||(e=t.addChild({identifier:o.group,type:"group"})),t=e}if(o.priority){if(o.priority>1){let e=t.getChild(o.group+"_Secondary");e||(o.group=o.group+"_Secondary",e=t.addChild({identifier:o.group,type:"secondaryArea"})),e.type="secondaryArea",t=e}}else o.priority=1;if(o.hasOwnProperty("set")&&void 0!==o.set){let e=t.getChild(o.set);e||(e=t.addChild({identifier:o.set,type:"set"})),t=e}t.addChild(o)}else console.error("Item must at least have a category property",o)}return t&&i.reorder(t),i}(e,t,n);{let e={section:W,group:k,set:V,secondaryArea:P,item:X},t=[],n=[];{let e=u.getForwardIterator();for(;e.isValid();)"WAfrFront"!==e.get().getId()&&t.push(e.get()),e.next()}let s=[...t];for(;s.length>0;){let t=s.pop(),i=t.getData().type;if(Y(i)&&(i="item"),n.push(e[i].call(this,t,o,r,a)),"set"===i)continue;let l=t.getBackwardIterator();for(;l.isValid();)s.push(l.get()),l.next()}d.push(Promise.all(n).then((function(){for(s=[...t];s.length>0;){let e=s.pop(),t=e.getData().type;if(Y(t)&&(t="item"),"set"===t)continue;let n=e.getForwardIterator(),i=e.getData().view;for(;n.isValid();){let t=n.get(),o=t.getData();if(s.push(t),o.view)if("secondaryArea"===e.type)p.addItem(i,o.view),U(i,o);else if(1===o.priority||"set"===o.type){i.childNodes[0].appendChild(o.view)}else i.appendChild(o.view);n.next()}}})).then((function(){s=[...t];let e=null,n=l._uiFrame.getUIFrame(),o=l._uiFrame.getImmersiveFrame();o.remove();let r=A,d=48;l._showLabelFlag=l.getShowLabelFlagPreference(),l._showLabelFlag?(r=x,d=74):a&&(r=y,d=50,l._showLabelFlag&&(d=74));for(let t=0,n=s.length;t<n;++t){let n=s[t].getData(),a=n.title,u=document.createElement("div");u.classList.add("wafr-toolbar-section"),u.setAttribute("wafr-po-use-only-section-title",n.title),u.appendChild(n.view);let c="WAfrUIModelMainComponent"+n.identifier,h=new i({title:a,identifier:c,content:u,immersiveFrame:m?null:o,resizableFlag:!0,movableFlag:!0,currentDockArea:WUXDockAreaEnum.BottomDockArea,closeButtonFlag:!1,usePaddingFlag:!1,minHeight:d,minWidth:r,onContextualEvent:function(e){return l.getCtxMenu({that:l,panel:this,params:e})}});const p=h.getContent();_.addEventListener(p,{callback:function(e){return l.getCtxMenu({that:l,panel:this,params:e})}}),h._afr=Object.create(null),h._afr._bound_computeCompactWidth=H.bind(h),h._afr._bound_onPrePlaceChangeCB=z.bind({panel:h,mainUIComponentManager:l}),h.addEventListener("prePlaceChange",h._afr._bound_onPrePlaceChangeCB),h._afr._isContentInitialized=!0,m||h._afr._bound_onPrePlaceChangeCB(),n.view=h,l._panels.push(h),e?h.attachToWindow(e,WUXSnapAreaEnum.InsideArea):e=h}if(m)for(const e of l._panels)e.immersiveFrame=o,e._afr._bound_onPrePlaceChangeCB();if(e){let t,n=e.windowGroup;if(n){if(t=n.getEmbeddedWindows(),t&&t.length&&t.length>1){let i=[t[0]];("WAfrUIModelMainComponentWAfrStandard"===e.identifier||"WAfrUIModelMainComponentFixed Area"===e.identifier&&t.length>2)&&(i.push(t[1]),sessionStorage.getItem("WAfrABV3FirstLaunch")||(sessionStorage.setItem("WAfrABV3FirstLaunch","true"),"WAfrUIModelMainComponentWAfrStandard"===e.identifier?l.pinSection("WAfrStandard"):"WAfrUIModelMainComponentFixed Area"===e.identifier&&l.pinSection("Fixed Area"))),n.currentWindows=i}n._tab.tabBar.addEventListener("pinStateChange",(e=>{l._panels[e.dsModel.value].pinnedFlag||(l._panels[e.dsModel.value]._afr._pinnedByCode=void 0),N(l._panels)}))}}let u=o.getDockingElement(WUXDockAreaEnum.BottomDockArea);void 0!==u&&u.elements.dockingWithCollapserContainer.classList.add("WAfrPageObjectUseOnly-WAfr-Actionbar"),o.inject(n),N(l._panels),l._isViewGenerated=!0})))}return Promise.all(d)},generate:function(e){var t=b.start([w,"[Sync] generate"].join(" ")),n=this;if(void 0===n||void 0===n._uiComponent||void 0===n._uiComponent._properties||void 0===n._uiComponent._properties.flatModel)return void b.stop(t);var i=n._uiComponent._properties;n._touchMode=e.touchMode;var o=i.flatModel.getChildren();if(void 0===o||void 0===o.length||0===o.length)return void b.stop(t);let r=this._uiComponent.getExecutionContext();if(!r)throw new Error("executionContext not found");let a=r.getComponent(M);if(!a)throw new Error("modelEventsCpt not found");let s=null;if(this._uiComponent._isMABAvailable&&(f.isAndroid()||f.isMobileiOS())){let t=new v(n._uiFrame.getContainer(),l);s={hide:function(){t.isGenerated()&&t.hide()},show:function(){let i=Promise.resolve();return t.isGenerated()||(i=t.generate(o,n._defaultTabOrder,n._uiComponent.getCategories(),l,a,e.touchMode)),i.then((function(){t.show()}))},destroy:function(){t.destroy()}}}let d={hide:function(){n.isGenerated()&&n.hide()},show:function(){let t=Promise.resolve();return n.isGenerated()||(t=n.createView(o,n._defaultTabOrder,n._uiComponent.getCategories(),l,a,e.touchMode)),t.then((function(){return n.show(t)}))}};return this._actionBarResponsiveManager=new g(d,s),this._actionBarResponsiveManager.compute().then((()=>(b.stop(t),Promise.resolve())))},setContext:function(e){void 0!==e.executionContext&&(this._executionContext=e.executionContext),void 0!==e.UIComponent&&(this._uiComponent=e.UIComponent),void 0!==e.UIFrame&&(this._uiFrame=e.UIFrame)},getCtxMenu:function(e){var t=e.that,n=[];return n.push({type:"PushItem",title:h.get(!0===t._showLabelFlag?"iconLabelHide.title":"iconLabel.title"),icon:"",action:{callback:function(e){t.toggleButtonLabel()}}},{type:"PushItem",title:h.get("resetActionBar.title"),icon:"",action:{callback:function(e){t.resetPositionMainComponent()}}}),n},resetPositionMainComponent:function(){var e,t,n,i,o=this;o._panels.forEach((function(i){void 0===e?(i.deleteWindowPreferences(),n=i.windowGroup,i.currentDockArea=WUXDockAreaEnum.BottomDockArea,e=i):(i.windowGroup=null,i.deleteWindowPreferences(),i.attachToWindow(t,WUXSnapAreaEnum.InsideArea,"after")),t=i})),i=[o._panels[0]],("WAfrUIModelMainComponentWAfrStandard"===e.identifier||"WAfrUIModelMainComponentFixed Area"===e.identifier&&o._panels.length>2)&&i.push(o._panels[1]),n&&(n.currentWindows=i)},showMainComponentLabels:function(){!0!==this._showLabelFlag&&this.toggleButtonLabel()},hideMainComponentLabels:function(){!1!==this._showLabelFlag&&this.toggleButtonLabel()},toggleButtonLabel:function(e){var t=this;if(t._showLabelFlag=!0!==t._showLabelFlag,t.setShowLabelFlagPreference(t._showLabelFlag),t._tweakersView.forEach((function(e){void 0!==e&&(e.showLabelFlag=t._showLabelFlag)})),!t._panels[0].immersiveFrame)throw new Error("no immersive frame related to this panel",t._panels[0]);I(t);let n=48,i=t._showLabelFlag;i?n=74:t._touchMode&&(n=50,i&&(n=74)),t._panels.forEach((function(e){e.minHeight=n,e.currentDockArea!==WUXDockAreaEnum.TopDockArea&&e.currentDockArea!==WUXDockAreaEnum.BottomDockArea||e._afr._bound_computeCompactWidth()})),L(t)},clean:function(){var e=this;if(e._panels&&Array.isArray(e._panels)&&e._panels.length>0){var t,n=e._uiFrame;if(n&&(t=n.getImmersiveFrame()),e._tweakersView=[],t)for(var i;0!==e._panels.length||void 0!==e._panels[0];){i=e._panels[0],e._panels.splice(0,1),i.removeEventListener("resize",i._afr._bound_computeCompactWidth),i.removeEventListener("activate",i._afr._bound_computeCompactWidth),i.removeEventListener("prePlaceChange",i._afr._bound_onPrePlaceChangeCB),delete i._afr._bound_computeCompactWidth,delete i._afr._bound_onPrePlaceChangeCB,delete i._afr._isContentInitialized,delete i._afr._pinnedByCode;var o=null;for(o in i._afr)i._afr.hasOwnProperty(o)&&console.error(o," must be cleaned");i&&i.destroy()}}if(this._actionBarResponsiveManager){let e=this._actionBarResponsiveManager.getSmallViewportActionBar();e&&e.destroy(),this._actionBarResponsiveManager.clean(),delete this._actionBarResponsiveManager}this._isViewGenerated=!1,delete this._isHidden,sessionStorage.removeItem("WAfrABV3FirstLaunch")},hide:function(){if(!this._isHidden){this._isHidden=!0;var e=this;e._activatedSections=[],void 0!==e&&void 0!==e._panels&&(e._activatedSections=e.getActiveSections(),e._panels.forEach((function(e){e.visibleFlag&&(e.visibleFlag=!1)})))}},isGenerated:function(){return this._isViewGenerated},show:function(e=null){if(void 0===this._isHidden||this._isHidden){this._isHidden=!1;var t=this;if(t._uiComponent._isMABAvailable&&t._mabOnScreen)return;if(void 0!==t&&void 0!==t._panels&&void 0!==t._uiComponent._properties&&void 0!==t._uiComponent._properties.flatModel)if(0===t._panels.length){var n=t._uiComponent._properties.flatModel.getChildren();void 0!==n&&0!==n.length&&(e=t.generate({touchMode:t._touchMode}))}else t._panels.forEach((function(e){e.visibleFlag||(e.visibleFlag=!0)}));t._activatedSections&&t.activateSections(t._activatedSections)}return e||Promise.resolve()},activateSection:function(e){var t=this;void 0!==t&&void 0!==t._panels&&void 0!==t._uiComponent._properties&&void 0!==t._uiComponent._properties.flatModel&&0!==t._panels.length&&t._panels.forEach((function(t){var n="WAfrUIModelMainComponent"+e;t.identifier===n&&(t.ensureVisible(),t.currentDockArea===WUXDockAreaEnum.BottomDockArea&&t._afr._bound_computeCompactWidth())}))},activateSections:function(e){var t=this;if(void 0!==t&&void 0!==t._panels&&void 0!==t._uiComponent._properties&&void 0!==t._uiComponent._properties.flatModel&&0!==t._panels.length){var n=[];e.forEach((function(e){var i="WAfrUIModelMainComponent"+e;t._panels.forEach((function(e){e.identifier===i&&(e.expandedFlag=!0,e.visibleFlag=!0,e.windowGroup&&(e.windowGroup.ensureVisible(),n.push(e),e.windowGroup.currentWindows=n),e.currentDockArea===WUXDockAreaEnum.BottomDockArea&&e._afr._bound_computeCompactWidth())}))}))}},getActiveSections:function(){var e=this,t=[];return void 0!==e&&void 0!==e._panels&&void 0!==e._uiComponent&&void 0!==e._uiComponent._properties&&void 0!==e._uiComponent._properties.flatModel&&0!==e._panels.length&&e._panels.forEach((function(e){e.windowGroup&&-1!==e.windowGroup.currentWindows.indexOf(e)&&t.push(e.identifier.replace("WAfrUIModelMainComponent",""))})),t},pinSection:function(e){var t=this;if(void 0!==t&&void 0!==t._panels&&void 0!==t._uiComponent._properties&&void 0!==t._uiComponent._properties.flatModel&&0!==t._panels.length){var n="WAfrUIModelMainComponent"+e;for(const e of t._panels)if(e.identifier===n)return e._afr._pinnedByCode=!0,e.pinnedFlag=!0,!0}return!1},unpinSection:function(e){var t=this;if(void 0!==t&&void 0!==t._panels&&void 0!==t._uiComponent._properties&&void 0!==t._uiComponent._properties.flatModel&&0!==t._panels.length){var n="WAfrUIModelMainComponent"+e;for(const e of t._panels)if(e.identifier===n)return e._afr._pinnedByCode=!1,e.pinnedFlag=!1,!0}return!1},isSectionPinnedByUser:function(e){var t=this;if(void 0!==t&&void 0!==t._panels&&void 0!==t._uiComponent._properties&&void 0!==t._uiComponent._properties.flatModel&&0!==t._panels.length){var n="WAfrUIModelMainComponent"+e;for(const e of t._panels)if(e.identifier===n&&e.pinnedFlag&&void 0===e._afr._pinnedByCode)return!0}return!1},setTouchMode:function(e){e!==this._touchMode&&this.toggleButtonLabel()},setActivatedCategory:function(e){this._defaultActivatedCategory=e},setCategoriesOrder:function(e){void 0!==e&&void 0!==e.length&&(this._defaultTabOrder=e)},_setActiveCategory:function(e){if(void 0!==e&&void 0!==e.windowGroup&&void 0!==e.windowGroup.getEmbeddedWindows&&void 0!==e.windowGroup.getEmbeddedWindows()&&e.activeCategoryId){var t=e.windowGroup.getEmbeddedWindows(),n=0;for(n=0;n<t.length;n++){var i=t[n].identifier;if(0===i.search("WAfrUIModelMainComponent")&&i.slice(24)===e.activeCategoryId){e.windowGroup.currentWindows=[t[n]];break}}}},_reorderCategories:function(e){var t=e.orderPreferences,n=e.tabPanels;if(void 0!==e&&void 0!==n&&void 0!==t&&void 0!==t.length){var i=0,o=0,r=-1;for(i=0;i<t.length;i++){var a=t[i];for(o=0;o<n.length;o++){var s=n[o].identifier;if(0===s.search("WAfrUIModelMainComponent")&&s.slice(24)===a){if(r>o){var l=n.splice(o,1);n.splice(r,0,l[0])}else r=o;break}}}}},_handleTouchChange:function(){var e=this;document.addEventListener("touchChange",(function(){if(e._touchMode=!e._touchMode,e._panels&&e._panels.length>0){if(!e._panels[0].immersiveFrame)throw new Error("no immersive frame related to this panel",e._panels[0]);I(e),L(e),N(e._panels)}}))},_manageBrowserZoom:function(){var e=this;let t=window.devicePixelRatio||window.screen.availWidth/document.documentElement.clientWidth;window.addEventListener("resize",(function(){var n=window.devicePixelRatio||window.screen.availWidth/document.documentElement.clientWidth;n!=t&&(t=n,N(e._panels))}))},getShowLabelFlagPreference:function(){let e=!1;return"true"===localStorage.getItem("webafr_IsLabelShown")&&(e=!0),e},setShowLabelFlagPreference:function(e){"boolean"==typeof e&&(!0===e?localStorage.setItem("webafr_IsLabelShown","true"):localStorage.setItem("webafr_IsLabelShown","false"))}})}));