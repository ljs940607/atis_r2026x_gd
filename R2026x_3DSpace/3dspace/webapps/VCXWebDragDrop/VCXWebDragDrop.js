var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDragDrop/VCXDragDropServices",["require","exports","DS/VCXWebComposer/VCXExperienceLoader","DS/VCXWebSystem/VCXHardwareServices","DS/VCXWebEWS/VCXExperienceServices","DS/ApplicationFrame/CommandsManager","DS/VCXWebExperienceBase/VCXContextManager"],(function(e,t,r,a,n,o,i){"use strict";a=__importDefault(a),n=__importDefault(n),o=__importDefault(o),i=__importDefault(i);class s{static DecideDragDrop(e,t,r){const a=e.getManager("VCXSelectionManager"),n=e.getManager("VCXContextManager");let o=[];if(a.ProcessComponentsFromSelection("CSO",(e=>{e.IsKindOf("VCXComponentOccurrenceComposer")&&(e.IsMesh()||n.isSupported("FullFeaturesOnNodes"))&&o.push(e)})),o.length>0)return r===s.ETypeDecisionBase.DROP?{hovered:null,droppedOn:o}:{hovered:null,droppedOn:null};{let a=[];const o=e.getManager("VCXContextualContentManager");return o&&(a=o.GetHoveredObjects(t),a=a.filter((e=>e.component.IsKindOf("VCXComponentOccurrenceComposer")&&(e.component.IsMesh()||n.isSupported("FullFeaturesOnNodes"))))),r===s.ETypeDecisionBase.DROP?{hovered:null,droppedOn:a.map((e=>e.component))}:{hovered:a,droppedOn:null}}}static GetRawDataFromDragEvent(e){var t="text/plain";a.default.isIE11()&&(t="text");let r,n="dataTransfer"in e?{text:e.dataTransfer?.getData(t),files:e.dataTransfer?.files,items:e.dataTransfer?.items,types:e.dataTransfer?.types}:e;if(n.text)try{r=JSON.parse(n.text)}catch(e){}let o=(n?.items&&Array.from(n?.items))??[];return{text:n.text,items:o.reduce(((t,r)=>(t.set(r.type,"dataTransfer"in e?e.dataTransfer?.getData(r.type):r),t)),new Map),types:n?.types,files:n?.files&&Array.from(n?.files),parsedText:r}}static async onDrop3DXMLFiles(e,t,r){if(r.getManager("VCXContextManager").isSupported("Import3DXML")&&!i.default.getUrlVars().file)return(async()=>{const e=await n.default.handle3DXML(t,r);if(t){const a=Object.keys(t).map((e=>t[e]));for(let t of Array.from(a))r.getManager("VCXAnalyticsTrackerAppManager").trackImport3dxmlEvent("xH_HomePageDragAndDrop",e.insertProducts,t.size)}return e})()}static async onDropBlobFiles(e,t,r){const a={x:e.clientX,y:e.clientY},n=Object.keys(t).map((e=>t[e]));for(let e=0;e<n.length;e++){const t=n[e];var i=t.type;let p=["application/x-zip-compressed"];if(i.length&&!p.includes(i)){var s=t.name,l=new FileReader;l.onloadend=()=>{var e=l.result;if(e){var n=new Blob([e],{type:t.type}),i=URL.createObjectURL(n),p=r.getManager("VCXDocManager").BuildPathFromString(i,s),c=o.default.getCommand("VCXCreateDressup2DImageCmd",r.getManager("VCXContextManager").getContext());if(c){let e=r.getManager("VCXDocManager").AddOrModifyDoc(p);c.begin({_mousePosition:a,_sceneIDToUse:"",_docIDToUse:e})}}r.getManager("VCXGUIManager").RemoveDropZone()},l.readAsArrayBuffer(t)}}}static async onDropPlatformPresentation(e,t,r){return"HighlightPresentation3DCom"===t.type?(r.getManager("VCXAnalyticsTrackerAppManager").trackOpenPresentationEvent("xH_HomePageDragAndDrop"),r.getManager("VCXGUIManager").saveToMRU(t.PID),n.default.onLoadExperienceFromPhysicalID(r,t.name,t.PID,t.securityContext)):"CityPresentation3DCom"===t.type?n.default.onLoadExperienceFromPhysicalID(r,t.name,t.PID,t.securityContext):null}static async onDropPlatformMaterial(e,t,r){const a=s.DecideDragDrop(r,e,s.ETypeDecisionBase.DROP).droppedOn;if(a&&a.length>0)return n.default.onDropMaterial(t.name,t.PID,t.eventCSI,r,a);{const e=r.getManager("VCXCAT3DXModelManager");if(e)return e.InsertMaterial(t.name,null,t.PID,[])}}static async onDropPlatformAmbience(e,t,r){return n.default.onDropAmbience(t.name,t.PID,t.eventCSI,r)}static async onDropPlatformProduct(e,t,r){return r.getManager("VCXAnalyticsTrackerAppManager").trackNewPresentationEvent("xH_HomePageDragAndDrop"),n.default.onDropProduct(t.name,t.PID,r,t.type)}static async onDropPlatformMaterials(e,t,r){const a=r.getManager("VCXCAT3DXModelManager");if(a){const n=await a.InsertMaterials(t,null);if(r.getManager("VCXContextManager").isSupported("VCXMaterialsOptionChooser")){const t=s.DecideDragDrop(r,e,s.ETypeDecisionBase.DROP).droppedOn;if(t&&t.length>0&&n.length>0){let e=[];for(let t of n){const r=t.QueryInterface("VCXIMaterialCache");e.push({name:r.GetTitle(),PID:r.GetPID(),preview:r.GetImage(),id:t.GetID()})}const a=r.getManager("VCXGUIManager");if(a&&a.GetGUIComponentFromName){const n=a.GetGUIComponentFromName("VCXMaterialsChooserCtrl");n&&n.ReBuildView(e,{apply:async e=>{let a=r.GetActiveChild();a||(a=r);const n=a.ComponentsMap.GetComponentFromID(e),o=r.getManager("VCXMaterialManager");n&&o&&await o.applyMaterialOnComponents(n,t)},close:()=>{}})}}}return n}return[]}}return function(e){let t;!function(e){e[e.DROP=2]="DROP",e[e.DRAG=4]="DRAG"}(t=e.ETypeDecisionBase||(e.ETypeDecisionBase={}))}(s||(s={})),s})),define("DS/VCXWebDragDrop/interfaces/IDraggable",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDragDrop/VCXDraggableItem",["require","exports","DS/Core/Core","DS/VCXWebDragDrop/VCXDragDropServices"],(function(e,t,r,a){"use strict";a=__importDefault(a);return class{constructor(e){this._experienceBase=e,this._droppableZonesIds=["3DContext"]}onStart(e){console.log(e)}onEnd(e){console.log(e)}onDragOver(e){const t=a.default.DecideDragDrop(this._experienceBase,e,a.default.ETypeDecisionBase.DRAG).hovered,n=r.Selection.PSOManager;if(n.empty(!0),t&&t.length>0){const e=t.map((e=>({pathElement:e.pathElement})));n.add(e)}}onFailDrop(e,t){const r=this._experienceBase.getManager("VCXNotificationManager"),a={level:e,title:t.title??"Failed",subtitle:t.subTitle??"",sticky:!0};r.addNotification(a)}async onDrop(e){return null}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDragDrop/VCXDraggableCard",["require","exports","DS/VCXWebDragDrop/VCXDraggableItem"],(function(e,t,r){"use strict";r=__importDefault(r);class a extends r.default{constructor(e){super(e),this._droppableZonesIds=["3DContext","UIPanel"]}onStart(e){super.onStart(e)}onEnd(e){super.onEnd(e)}onDragOver(e){super.onDragOver(e)}async onDrop(e){return super.onDrop(e)}}return a}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDragDrop/VCXDraggableAmbience",["require","exports","DS/VCXWebDragDrop/VCXDraggableCard"],(function(e,t,r){"use strict";r=__importDefault(r);class a extends r.default{constructor(e,t){super(t),this.ambienceID=e,this._droppableZonesIds=["3DContext","ambiencePanel"]}onStart(e){super.onStart(e),console.log(this.ambienceID)}onDragOver(e){}async onDrop(e){return super.onDrop(e)}}return a}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDragDrop/VCXDraggableScene",["require","exports","DS/ApplicationFrame/CommandsManager","DS/VCXWebDragDrop/VCXDraggableCard"],(function(e,t,r,a){"use strict";a=__importDefault(a);class n extends a.default{constructor(e,t){super(t),this.sceneID=e,this._droppableZonesIds=["3DContext","scenePanel"]}onStart(e){super.onStart(e),console.log(this.sceneID)}onEnd(e){super.onEnd(e)}onDragOver(e){}async onDrop(e){const t=e.target.closest("[data-vcxContext]");if(t&&t.getAttribute("data-vcxcontext")&&["3DContext"].includes(t.getAttribute("data-vcxcontext"))){const t=this._experienceBase.getManager("VCXContextManager");const n={x:e.x-t.getFrameWindow().getImmersiveFrame().getContent().getBoundingClientRect().left,y:e.y-t.getFrameWindow().getImmersiveFrame().getContent().getBoundingClientRect().top};if(this.sceneID){var a=r.getCommand("VCXCreateDressup2DImageCmd",this._experienceBase.getManager("VCXContextManager").getContext());if(a){const e=this._experienceBase.getManager("VCXDocManager").GetPropPath(this.sceneID);console.log(e),a.begin({_mousePosition:n,_sceneIDToUse:this.sceneID})}}}return null}}return n}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDragDrop/VCXDraggableRatio",["require","exports","DS/VCXWebDragDrop/VCXDraggableCard"],(function(e,t,r){"use strict";r=__importDefault(r);class a extends r.default{constructor(e,t){super(t),this.ratioID=e,this._droppableZonesIds=["3DContext","UIPanel"]}onStart(e){super.onStart(e),console.log(this.ratioID)}onDragOver(e){}async onDrop(e){return super.onDrop(e)}}return a}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDragDrop/VCXDraggableMaterial",["require","exports","DS/VCXWebDragDrop/VCXDragDropServices","DS/VCXWebDragDrop/VCXDraggableCard"],(function(e,t,r,a){"use strict";r=__importDefault(r),a=__importDefault(a);class n extends a.default{constructor(e,t){super(t),this.materialID=e,this._droppableZonesIds=["3DContext","materialPanel"]}onDragOver(e){super.onDragOver(e)}async onDrop(e){if(e.target){const t=e.target.closest("[data-vcxContext]");if(t&&t.getAttribute("data-vcxcontext")&&!this._droppableZonesIds.includes(t.getAttribute("data-vcxcontext")))return null}await super.onDrop(e);const t=r.default.DecideDragDrop(this._experienceBase,e,r.default.ETypeDecisionBase.DROP).droppedOn;if(t&&t.length>0){let e=this._experienceBase.GetActiveChild();e||(e=this._experienceBase);const r=e.ComponentsMap.GetComponentFromID(this.materialID),a=this._experienceBase.getManager("VCXMaterialManager");r&&a&&await a.applyMaterialOnComponents(r,t)}return null}}return n})),define("DS/VCXWebDragDrop/VCXDraggableExternalItem",["require","exports","DS/VCXWebDragDrop/VCXDraggableItem"],(function(e,t,r){"use strict";return class extends r{constructor(e){super(e)}onStart(e){super.onStart(e)}onEnd(e){super.onEnd(e)}onDragOver(e){super.onDragOver(e)}async onDrop(e){return super.onDrop(e)}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDragDrop/VCXDraggableFileItem",["require","exports","DS/VCXWebIO/VCXMimeTypeServices","DS/VCXWebDragDrop/VCXDragDropServices","DS/VCXWebDragDrop/VCXDraggableExternalItem","i18n!DS/VCXWebDragDrop/assets/nls/VCXWebDragDrop"],(function(e,t,r,a,n,o){"use strict";o=__importDefault(o);return class extends n{constructor(e){super(e)}onStart(e){console.log(e)}onEnd(e){console.log(e)}onDragOver(e){}async onDrop(e){const t=this._experienceBase.getManager("VCXContextManager");let n=a.GetRawDataFromDragEvent(e);const i=n.files;if(n.files&&1===n.files.length&&"record"===this._experienceBase.odt){var s=n.files[0],l=this._experienceBase.getManager("VCXGUIManager").getGettingStartedUI();await this._experienceBase.getManager("VCXAPIManager").OpenModel(s),l.endLoadingExperience()}let p=[],c=!1;if(i&&i.length>0){c=!0;for(let e=0;e<i.length;e++){const t=i[e];if(void 0!==t){const e=t.name;t.type||(c=!1);let r=e.slice(e.lastIndexOf(".")+1);r=r.toLowerCase(),p.push(r)}}}if(p.length>0){const e=t.CheckInputFile(!1,p);if(!c&&!e.supported){let t={level:"warning",title:o.default["Notification.DragAndDrop.Loading.Title"],subtitle:e.message,sticky:!0};return this._experienceBase.getManager("VCXNotificationManager").addNotification(t),this._experienceBase.getManager("VCXGUIManager").RemoveDropZone(),null}}this._experienceBase.getManager("VCXGUIManager").RemoveDropZone();let D={},u=null;if(i&&i.length>0)for(let e=0;e<i.length;e++){let a=i[e];if(void 0!==a){const e=a.name;if(void 0!==e){let n=e.slice(e.lastIndexOf(".")+1);n=n.toLowerCase();const i=t.CheckInputExtension(n);if(!i.supported){this.onFailDrop("warning",{title:o.default["Notification.DragAndDrop.ActionNotSupported.Title"],subTitle:i.message});continue}if("json"===n||"exprd"===n)D.hasOwnProperty("json")||(D.json={}),D.json[e]=a;else if("3dxml"===n){D.hasOwnProperty("3dxml")||(D["3dxml"]={}),u=a;let t=URL.createObjectURL(a);D["3dxml"][e]=t}else"application/octet-stream"!==r.GetMimeType("."+n)?(D.hasOwnProperty("blob")||(D.blob={}),D.blob[e]=a):this.onFailDrop("warning",{title:o.default["Notification.DragAndDrop.ExtensionNotSupported.Title"]})}}}return D.hasOwnProperty("3dxml")?(u&&"record"===this._experienceBase.odt&&this._experienceBase.getManager("VCXODTManager").SetModelForZip(u),a.onDrop3DXMLFiles(e,D["3dxml"],this._experienceBase)):D.hasOwnProperty("blob")?this._experienceBase.getManager("VCXContextManager").getRootComponent()?a.onDropBlobFiles(e,D.blob,this._experienceBase):(this.onFailDrop("warning",{title:o.default["Notification.DragAndDrop.NotYet.Title"],subTitle:o.default["Notification.DragAndDrop.NotYet.SubTitle"]}),this._experienceBase.getManager("VCXGUIManager").RemoveDropZone(),null):null}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDragDrop/VCXDraggablePlatformItem",["require","exports","DS/VCXWebDragDrop/VCXDragDropServices","DS/VCXWebDragDrop/VCXDraggableExternalItem","DS/VCXWebEWS/VCXExperienceServices","DS/VCXWebPlatform/VCXPlatformServices","i18n!DS/VCXWebDragDrop/assets/nls/VCXWebDragDrop"],(function(e,t,r,a,n,o,i){"use strict";n=__importDefault(n),o=__importDefault(o),i=__importDefault(i);return class extends a{constructor(e){super(e)}onStart(e){console.log(e)}onEnd(e){console.log(e)}onDragOver(e){super.onDragOver(e)}async onDrop(e){this._experienceBase.getManager("VCXGUIManager").RemoveDropZone();try{let a=r.GetRawDataFromDragEvent(e);const n=a?.parsedText?.data?.items;let s={},l=[];if(n){const e=this._experienceBase.getManager("VCXContextManager").CheckInputFile(!0);if(!e.supported)return this.onFailDrop("warning",{title:e.message}),null;for(let e of n){const t=e.objectType;try{await o.default.CheckTenant(e);let r=t;r="Document"===t?"Document":t.includes("Presentation")?"Presentation":"dsc_matref_ref_Covering"===t?"CoveringMaterial":"AmbienceEnvironment"===t?"AmbienceEnvironment":"Product",s.hasOwnProperty(r)||(s[r]=[]),s[r].push(e)}catch(e){l.push(t)}}}if(1===Object.keys(s).length){const a=Object.keys(s)[0],n=s[a];var t={};if(1===n.length){const o=n[0];t.data=o,t.getData=function(){return Promise.resolve(t.data)},t.files=[];const s=o.contextId,l=o.displayName,p=o.objectId,c=o.objectType,D=e.target&&e.target.closest("[data-vcxContext]");try{if("Presentation"===a)return r.onDropPlatformPresentation(e,{type:c,name:l,PID:p,securityContext:s},this._experienceBase);if("CoveringMaterial"===a){if(!this._experienceBase.GetActiveChild())return this.onFailDrop("error",{title:i.default["Notification.DragAndDrop.Insert.Failed"],subTitle:i.default["Notification.DragAndDrop.Insert.Before.Experience"]}),null;{const a=e.target&&e.target.closest("[data-vcxContext]");if(a&&a.getAttribute("data-vcxcontext")&&["3DContext","materialPanel"].includes(a.getAttribute("data-vcxcontext")))return r.onDropPlatformMaterial(e,{name:l,eventCSI:t,PID:p},this._experienceBase)}}else{if("AmbienceEnvironment"!==a)return"Product"===a?r.onDropPlatformProduct(e,{type:a,name:l,PID:p},this._experienceBase):(this.onFailDrop("warning",{title:i.default["Notification.DragAndDrop.Insert.Failed"],subTitle:i.default["Notification.DragAndDrop.Not.Supported"]}),null);if(!this._experienceBase.GetActiveChild())return this.onFailDrop("error",{title:i.default["Notification.DragAndDrop.Insert.Failed"],subTitle:i.default["Notification.DragAndDrop.Insert.Before.Experience"]}),null;if(D&&D.getAttribute("data-vcxcontext")&&["3DContext","ambiencePanel"].includes(D.getAttribute("data-vcxcontext")))return r.onDropPlatformAmbience(e,{name:l,eventCSI:t,PID:p},this._experienceBase)}}catch(e){return null}}else{if("CoveringMaterial"!==a)return this.onFailDrop("warning",{title:i.default["Notification.DragAndDrop.Insert.MultipleItems.Failed"],subTitle:i.default["Notification.DragAndDrop.Insert.MultipleItems.Failed.SubTitle"]}),null;try{let t={};n.forEach((e=>{t[e.objectId]=e.displayName}));const a=await r.onDropPlatformMaterials(e,t,this._experienceBase);console.log(a)}catch(e){return this.onFailDrop("warning",{title:i.default["Notification.DragAndDrop.Insert.Materials.Failed"],subTitle:""}),null}}}else if(0!==Object.keys(s).length)return this.onFailDrop("warning",{title:i.default["Notification.DragAndDrop.Insert.MultipleItems.Failed"],subTitle:i.default["Notification.DragAndDrop.Insert.MultipleItems.Failed.SubTitle"]}),null;if(l.length>0){let e="";l.forEach((t=>{e+=t+"- <br>"}));let t=UWA.Element("div",{html:e});return this.onFailDrop("warning",{title:i.default["Notification.DragAndDrop.Insert.MultipleItems.Failed"],subTitle:t}),null}}catch(e){if(console.error(e),"Warning"!==e.criticity)return n.default.CloseExperienceAndReset(this._experienceBase,{level:"error",title:i.default["Notification.DragAndDrop.Loading.Title.Error"],message:i.default["Notification.DragAndDrop.Loading.Message.Error"]},e)}return null}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDragDrop/VCXDragDropManager",["require","exports","DS/Controls/Loader","DS/DataDragAndDrop/DataDragAndDrop","DS/VCXWebComponents/VCXWebComponentBaseExperience","i18n!DS/VCXWebComposer/assets/nls/VCXWebComposer","DS/VCXWebDragDrop/VCXDragDropServices","DS/VCXWebDragDrop/VCXDraggableFileItem","DS/VCXWebDragDrop/VCXDraggablePlatformItem","DS/VCXWebExperienceBase/VCXContextManager"],(function(e,t,r,a,n,o,i,s,l,p){"use strict";n=__importDefault(n),o=__importDefault(o),i=__importDefault(i),s=__importDefault(s),l=__importDefault(l);class c extends n.default{constructor(){super(...arguments),this._currentDraggableItem=null}SetCurrentDraggableItem(e){this._currentDraggableItem=e}GetCurrentDraggableItem(){return this._currentDraggableItem}initialize(){this._currentDraggableItem=null}postInitialize(){var e={over:(e,t)=>{this.overCB(t)},enter:(e,t)=>{this.enterCB(t)},leave:()=>{this.leaveCB()},drop:(e,t,r)=>{this._onDrop(r)}};a.droppable(document.body,e)}unInitialize(){a.clean(document.body)}getVersion(){return"2.24.0"}_onDrop(e){if(p.IsWAFR()){this._experienceBase.GetActiveChild()&&this.dropCB(e)}else this.dropCB(e)}_CheckCurrentDraggableItem(e,t){var r=i.default.GetRawDataFromDragEvent(e).types;if(!(r&&r.length>=1))return!1;let a=!1;for(let e=0;e<r.length;e++)if("Files"===r[e])t&&(t.dropZone="copy"),a=!0,this._currentDraggableItem&&this._currentDraggableItem instanceof s.default||(this._currentDraggableItem=new s.default(this._experienceBase));else if("text/plain"===r[e])t&&(t.dropZone="copy"),a=!0,this._currentDraggableItem&&this._currentDraggableItem instanceof l.default||(this._currentDraggableItem=new l.default(this._experienceBase));else if("cke/id"===r[e]||"text/uri-list"===r[e]){t&&(t.dropZone="none"),a=!1,this._currentDraggableItem=null;break}return!!this._currentDraggableItem||a}async dropCB(e){if(!this._CheckCurrentDraggableItem(e))return;let t=i.default.GetRawDataFromDragEvent(e);if(t.parsedText&&"source"in t.parsedText&&"XCTXPR_AP"===t.parsedText.source){let e={level:"warning",title:o.default["Notification.DragAndDrop.Impossible.Title"],subtitle:o.default["Notification.DragAndDrop.Impossible.SubTitle"]};return this._experienceBase.getManager("VCXNotificationManager").addNotification(e),void this._experienceBase.getManager("VCXGUIManager").RemoveDropZone()}return this._currentDraggableItem?this._currentDraggableItem.onDrop(e):null}getProgressBar(){var e=new r({text:"Preparing..."});return e.inject(widget.body),e.getContent().setStyles({margin:"auto",position:"absolute",top:"110px",left:"0",bottom:"0",right:"0",width:"60px",height:"60px"}),e}overCB(e){const t=this._CheckCurrentDraggableItem(e);return this._currentDraggableItem&&this._currentDraggableItem.onDragOver(e),t}enterCB(e){let t={dropZone:"none"};this._CheckCurrentDraggableItem(e,t)&&this._experienceBase.getManager("VCXGUIManager").AddDropZone(),e.dataTransfer&&(e.dataTransfer.dropEffect=t.dropZone)}leaveCB(){this._experienceBase.getManager("VCXGUIManager").RemoveDropZone()}}return Object.defineProperty(c.prototype,"componentType",{enumerable:!0,get:function(){return"VCXDragDropManager"}}),c}));