define("DS/VisuLoaders/XMLV43Loader",["DS/Visualization/ThreeJS_DS","WebappsUtils/WebappsUtils","UWA/Utils","DS/Visualization/Utils","DS/VisuDataAccess/Ox4XHRWithProxyAbstraction","DS/Visualization/Node3D","DS/Visualization/Mesh3D","DS/Visualization/MaterialManager","DS/Visualization/PathElement","DS/Visualization/SceneGraph","DS/SceneGraphNodes/AxisSystemNode","DS/Mesh/Mesh","DS/Visualization/LoaderUtils","DS/VisuLoaders/ThreeDXLoader","DS/VisuLoaders/CGRReader","DS/ZipJS2/ZipJS2","DS/ZipJS2/LoaderInflate"],(function(e,a,t,r,n,i,l,o,s,c,d,f,u,p,h,m,v){"use strict";var g={TECHREP:{module:"DS/SIMAnimationWebMdl",file:"SIMAnimationRepRefUnstreamer"},CDS:{module:"DS/CATAssemblySolverWeb",file:"CATAsmWebJsonUnstreamer"}};return function(n,l){var c=!1,d=!1,f=n,b=void 0;e.supportedExtensions&&(b=!!e.supportedExtensions.elementIndexUint||void 0);var C,S,N=[],x=!1,M=null,k=void 0!==l?l:null,D=null,A=null,R=null,I=null,T=4,w=null,y=[],E=!1,B=0,L=0,G=4,W=0,P=[],U=null,F=null,O="TESSELLATED",V=[],_=[],X=((new Date).getTime(),{}),q=[],H=[],j=!1,z={},$={},J=null,Z=2,Y=[],K={};function Q(e,a,t,r,n,i){if(c)if(document.implementation&&document.implementation.createDocument){var l=new XMLHttpRequest;l.overrideMimeType&&l.overrideMimeType(t),"blob"===a&&(l.responseType="blob"),"arraybuffer"===a&&(l.responseType="arraybuffer"),l.onreadystatechange=function(){if(4===l.readyState)if(0===l.status||200===l.status){if(l.response&&"blob"===l.responseType){var a=new Blob([l.response],{type:t});r(a,e,i)}l.response&&"arraybuffer"===l.responseType?r(l.response,e,i):l.responseXML?r(l.responseXML,e,i):l.responseText?r(l.responseText,e,i):(console.error("XMLV43Loader: Empty or non-existing file ("+e+")"),void 0!==n&&n(e))}else void 0!==n&&n(e)},l.open("GET",e,!0),l.send(null)}else alert("Don't know how to parse XML!"),void 0!==n&&n(e);else{var o=e.replace(/^.*[\\\/]/,""),s=M.find(o);if(s&&W<G)W++,"blob"===a?s.getBlob(t).then((function(a){if(W--,P.length>0){var t=P[0];Q(t.url,t.type,t.mime,t.cbLoad,t.cbError,t.args),P.splice(0,1)}r(a,e,i)})):"arraybuffer"===a?s.getUint8Array(t).then((function(a){if(W--,P.length>0){var t=P[0];Q(t.url,t.type,t.mime,t.cbLoad,t.cbError,t.args),P.splice(0,1)}r(a.slice().buffer,e,i)})):"xml"===a?s.getText().then((function(a){if(W--,P.length>0){var t=P[0];Q(t.url,t.type,t.mime,t.cbLoad,t.cbError,t.args),P.splice(0,1)}try{var l=(new DOMParser).parseFromString(a,"text/xml");r(l,e,i)}catch(a){void 0!==n&&n(e)}})):"string"===a&&s.getRope().then((function(a){if(W--,P.length>0){var t=P[0];Q(t.url,t.type,t.mime,t.cbLoad,t.cbError,t.args),P.splice(0,1)}r(a,e,i)}));else if(W>=G)P.push({url:e,type:a,mime:t,cbLoad:r,cbError:n,args:i});else if(void 0!==n&&n(e),P.length>0){var d=P[0];P.splice(0,1),Q(d.url,d.type,d.mime,d.cbLoad,d.cbError,d.args)}}}function ee(e){if(e instanceof Object){var a="Error loading 3DXML : "+e.url+"\n";switch(e.type){case"LOAD":case"LOAD_ARCHIVE":a+="Could not load the 3DXML file.";break;case"LOAD_ENTRY":a+="Could not read Zip entries for this 3DXML.";break;case"PARSE":a+="Could not parse XML data.";break;case"REPFORMAT":a+="Rep format is not supported.";break;case"VERSION":a+="This version is not supported.";break;case"REVIEW_MISSING":a+="3DXML file does not contain any review data, only briefcase."}}a+="The model is not found, corrupted or not entirely supported.",console.warn(a)}function ae(e,a,t){var r=e.createOverrideSetManager();if(r){var n="__3DXMLV43Loader__",i=r.getSceneGraphOverrideSetByName(n);return i||(i=r.createSceneGraphOverrideSet({name:n,asmInherit:!1,materialModeSensitive:t,noOpacityOnLines:!0}),r.pushSceneGraphOverrideSet(i)),i.createOverride({pathes:[a],depthPriority:!0})}}function te(){for(var e=0;e<H.length;e++){var a=H[e],t=null,r=null;(null!==a.visible||a.material&&!a.materialModeSensitive)&&(t=ae(a.occPath.getElement(0),a.occPath,!1)),a.material&&a.materialModeSensitive&&(r=ae(a.occPath.getElement(0),a.occPath,!0)),a.material&&(a.material.force||(a.material.force=!0),a.materialModeSensitive?r.setMaterial(a.material):t.setMaterial(a.material)),null!==a.visible&&t.setVisibility(a.visible)}H=[]}this.abort=function(){if(N=[],L=0,null!==w){for(var e=0;e<w.length;++e)null!==w[e]&&(w[e].terminate(),w[e].onmessage=null);y=[],E=!1,w=null}I&&(I=null),ne()},this.load=function(e,a,t){x?N.push({url:e,cb:a,options:t}):(x=!0,C=e,e instanceof Object&&(C=e.serverurl?e.serverurl:"",C+=e.filename?e.filename:"",e.loaderSettings&&e.loaderSettings.uncompressed&&(c=!!e.loaderSettings.uncompressed,"3DX"!==(O=e.loaderSettings.repType?e.loaderSettings.repType:"CGR")||U||(U=new p))),A=a,R=t,U&&(U.setSharedBuffers(R.sharedBuffers),U.setNoMeshInRAM(R.noMeshInRAM)),D=function(e){L--,null!==A.progressCallback&&A.progressCallback({loaded:B-L,total:B});var a=(new Date).getTime();if(k&&k({hack:!0,updateInfinitePlane:!0,budgeted:!!L}),a,te(),L<=0){for(var t=0;t<w.length;++t)null!==w[t]&&(w[t].terminate(),w[t].onmessage=null);if(y=[],E=!1,w=null,null!==A.doneCallback){var r=A.doneCallback;ne(),r()}}},d=R.filterNavReps,R.refreshTime,R.containersName=function(e){if(q=[],e){for(var a in e)q.push(a);return q}}(R.applicativeContainers),c?Q(e+"/CATMaterialRef.3dxml","xml","text/xml",ie,(function(e){ie(null,e,!0)})):(M=new m.fs.FS,e.blob?M.importBlob(e.blob,{useXHR:!1,useRangeHeader:!1,preventHeadRequest:!0}).then((function(){Q(C+"/CATMaterialRef.3dxml","xml","text/xml",ie,(function(e){Q(C+"/CATMaterialDisciplines.3dxml","xml","text/xml",ie,(function(e){ie(null,e,!0)}))}))}),A.errorCallback?A.errorCallback:ee):M.importHttpContent(e,{useXHR:!1,useRangeHeader:!1,preventHeadRequest:!0}).then((function(){Q(C+"/CATMaterialRef.3dxml","xml","text/xml",ie,(function(e){Q(C+"/CATMaterialDisciplines.3dxml","xml","text/xml",ie,(function(e){ie(null,e,!0)}))}))}),A.errorCallback?A.errorCallback:ee)))};var re=this.load;function ne(){if(M=null,A=null,C="",B=0,L=0,W=0,P=[],O="TESSELLATED",V=[],_=[],(new Date).getTime(),F&&(F.abort(),F=null),H=[],j=!1,[],z={},$={},S="",J=null,Z=2,Y=[],K={},x=!1,N.length){var e=N.shift();re(e.url,e.cb,e.options)}}function ie(e,a,t){if(void 0===t||!t){var r=e.firstChild;if("Model_3dxml"!==r.nodeName)return;for(var n=0;n<r.childNodes.length;n++){var i=r.childNodes[n];if("CATMaterialRef"===i.nodeName)for(var l=0;l<i.childNodes.length;l++){var o=i.childNodes[l];if("CATMatReference"===o.nodeName||"MaterialDomainInstance"===o.nodeName||"MaterialDomain"===o.nodeName){var s=o.getAttribute("id"),c=o.getAttribute("name");switch(o.nodeName){case"CATMatReference":void 0!==z[s]?z[s].name=c:z[s]={name:c};break;case"MaterialDomainInstance":for(var d=0,f=0,u=0;u<o.childNodes.length;u++){"IsAggregatedBy"===(g=o.childNodes[u]).nodeName?d=g.textContent:"IsInstanceOf"===g.nodeName&&(f=g.textContent)}z[s]={parent:d,instance:f},void 0!==z[d]?z[d].instance=s:z[d]={instance:s};break;case"MaterialDomain":var p,h=o.getAttribute("associatedFile"),m=o.getAttribute("format");p=h.split("urn:3DXML:"),h=p[1];var v=!0;for(u=0;u<o.childNodes.length;u++){var g,b=(g=o.childNodes[u]).textContent;if("V_MatDomain"===g.nodeName&&"RENDERING"!==b.toUpperCase()){v=!1;break}}if(!v)break;void 0!==z[s]?(z[s].filename=h,z[s].format=m):z[s]={filename:h,format:m}}}}}}Q(C+"/CATRepImage.3dxml","xml","text/xml",le,(function(e){Q(C+"/PLMDmtDocument.3dxml","xml","text/xml",le,(function(e){le(null,e,!0)}))}))}function le(e,a,t){if(void 0===t||!t){var r=e.firstChild;if("Model_3dxml"!==r.nodeName)return;for(var n=0;n<r.childNodes.length;n++){var i=r.childNodes[n];if("CATRepImage"===i.nodeName)for(var l=0;l<i.childNodes.length;l++){var o=i.childNodes[l];if("CATRepresentationImage"===o.nodeName){var s=o.getAttribute("id"),c=(o.getAttribute("name"),o.getAttribute("format"),o.getAttribute("associatedFile").split("urn:3DXML:"));$[s]={filename:c[1],buffer:null}}}}}var d=0;for(var f in $)$.hasOwnProperty(f)&&d++;se(d?d-1:0)}function oe(e,a){var t=0,r=null;for(var n in e)if(e.hasOwnProperty(n)){if(t===a){r=n;break}t++}return r}function se(e){if(-1!==e){var a,t=oe($,e);if(void 0===$[t]||void 0===$[t].filename||""===$[t].filename)se(e-1);else{var r=/(?:\.([^.]+))?$/.exec($[t].filename)[1],n="image/";"jpg"===r&&(r="jpeg"),n+=r;var i="blob";"dds"===r&&(n="application/octet-stream",i="arraybuffer"),Q(C+"/"+$[t].filename,i,n,ce,(a=e,function(){se(a-1)}),e)}}else{var l=0;for(var o in z)z.hasOwnProperty(o)&&l++;de(l?l-1:0)}}function ce(e,a,t){var r=oe($,t);$[r].buffer=e,se(t-1)}function de(e){if(-1!==e){var a=oe(z,e);void 0===z[a]||void 0===z[a].filename?de(e-1):"UVR"!==z[a].format?Q(C+"/"+z[a].filename,"xml","text/xml",fe,(function(){}),e):de(e-1)}else Q(C+"/Manifest.xml","xml","text/xml",ue)}function fe(a,t,r){var n={shading:"Phong"};n.DiffuseMapWrap=[e.CGR_WRAPPING.CLAMP_TO_EDGE,e.CGR_WRAPPING.CLAMP_TO_EDGE],n.DiffuseMapRepeat=[0,0];var i=a.firstChild;if("Osm"===i.nodeName){for(var l=0;l<i.childNodes.length;l++){var o=i.childNodes[l],s="Feature"===o.nodeName&&o.getAttribute("Alias");if(s&&-1!==s.indexOf("RenderingFeature"))for(var c=0;c<o.childNodes.length;c++){var d=o.childNodes[c];if("Attr"===d.nodeName){var f=d.getAttribute("Type"),u=d.getAttribute("Value"),p=d.getAttribute("Name");switch(f){case"int":switch(u=parseInt(u,10),n[p]=u,p){case"WrappingModeU":u&&(n.DiffuseMapWrap[0]=e.CGR_WRAPPING.REPEAT,n.DiffuseMapRepeat[0]=1);break;case"WrappingModeV":u&&(n.DiffuseMapWrap[1]=e.CGR_WRAPPING.REPEAT,n.DiffuseMapRepeat[1]=1);break;case"PreviewType":switch(parseInt(u)){case 0:n.mappingFunction="SPHERICAL_ENV_MAP";break;case 2:n.mappingFunction="USER_MAPPING"}}break;case"double":switch(p){case"DiffuseColor":n.colorDiffuse=Ce(u);break;case"SpecularColor":n.colorSpecular=Ce(u);break;case"AmbientColor":n.colorAmbient=Ce(u);break;case"SpecularExponent":n.shininess=128*parseFloat(u);break;case"SpecularCoef":n.specularCoef=parseFloat(u);break;case"Reflectivity":n.reflectivityCoef=parseFloat(u);break;case"Transparency":n.transparency=parseFloat(u),n.transparent=n.transparency>0}break;case"boolean":if(u="true"===u,"AlphaTest"===p)n.alphaTest=u?.5:0;else n[p]=u;break;case"external":var h=[];h=u.split("urn:3DXML:"),h=(u=h[1]).split("#"),u=h[0];var m=h[1];"TextureImage"===p&&$[m]&&$[m].buffer&&(n.DiffuseMap=$[m])}}}}if(void 0!==r){var v=oe(z,r);void 0===z[v]&&(z[v]={}),n.type="material3DXML",z[v].params=n}de(r-1)}else de(r-1)}function ue(e,a){var t=e.firstChild;if(t&&t.childNodes)for(var r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];if("Root"===n.nodeName)S=n.textContent}Q(C+"/"+S,"xml","text/xml",pe,(function(e){var a=A.errorCallback?A.errorCallback:ee;a&&a({url:e,type:"REVIEW_MISSING"})}))}function pe(n,l){var o=n.firstChild;if(o&&"Model_3dxml"===o.nodeName){for(var s=0;s<o.childNodes.length;s++){if("Header"!==(re=o.childNodes[s]).nodeName){if("ProductStructure"===re.nodeName){var c=re.getAttribute("root");for($=0;$<re.childNodes.length;$++){if("Reference3D"===(ie=re.childNodes[$]).nodeName||"Instance3D"===ie.nodeName||"ReferenceRep"===ie.nodeName||"InstanceRep"===ie.nodeName){var f=ie.getAttribute("id"),p=ie.getAttribute("name"),h=new i;switch(ie.nodeName){case"Reference3D":void 0===Y[f]?Y[f]=h:h=Y[f];var m=c===f&&null===J;m&&(J=h);for(var v=0;v<ie.childNodes.length;v++){var b=ie.childNodes[v];if(m&&"Extension"===b.nodeName)for(var S=0;S<b.childNodes.length;S++){var N=b.childNodes[S];"V_WorldOrientation"===N.nodeName&&(Z=parseInt(N.textContent,10))}else"V_Name"===b.nodeName&&(p=b.textContent)}break;case"Instance3D":case"InstanceRep":Y[f]=h;var x="",M="",D=null;for(v=0;v<ie.childNodes.length;v++){if("IsAggregatedBy"===(b=ie.childNodes[v]).nodeName)x=b.textContent;else if("IsInstanceOf"===b.nodeName)M=b.textContent;else if("RelativeMatrix"===b.nodeName){var G=Ne(b.textContent);null===D&&(D=new e.Matrix4),D.set(G[0],G[3],G[6],G[9],G[1],G[4],G[7],G[10],G[2],G[5],G[8],G[11],0,0,0,1)}else"V_Name"===b.nodeName&&(p=b.textContent)}null!==D&&(h._matrix=D),""!==x&&""!==M&&(void 0===Y[x]&&(Y[x]=new i),Y[x].addChild(h),void 0===Y[M]&&(Y[M]=new i),h.addChild(Y[M]));break;case"ReferenceRep":void 0===Y[f]?Y[f]=h:h=Y[f];for(v=0;v<ie.childNodes.length;v++){"V_Name"===(b=ie.childNodes[v]).nodeName&&(p=b.textContent)}M="";var W,P=ie.getAttribute("format");P&&"string"==typeof P&&(W=P.toUpperCase());var U=ie.getAttribute("associatedFile");"UVR"!==W&&"TESSELLATED"!==W&&"CGR"!==W||("3DX"===O?P="3DX":"CGR"===O?P="CGR":(P=W,O=W));var F;F=U.split("urn:3DXML:");var q={file:U=F[1],format:P,node:h};void 0!==V[U]?V[U].push(h):(V[U]=[h],"ifc"!==r.getExtension(U)&&_.push(q)),K[h.id]=q}h.name=p,h.productType=ie.nodeName,h.persistentId=f,h.getPersistentId=function(){return this.persistentId}}}}}else for(var $=0;$<re.childNodes.length;$++){if("SchemaVersion"===(ie=re.childNodes[$]).nodeName)if(ie.textContent.substring(0,1)<4){var ae=A.errorCallback?A.errorCallback:ee;return void(ae&&ae({url:l,type:"VERSION"}))}}}for(s=0;s<o.childNodes.length;s++){if("DefaultView"===(re=o.childNodes[s]).nodeName)for($=0;$<re.childNodes.length;$++){"DefaultViewProperty"===(ie=re.childNodes[$]).nodeName&&he(ie)}}for(s=0;s<o.childNodes.length;s++){var re;if("CATMaterial"===(re=o.childNodes[s]).nodeName)for($=0;$<re.childNodes.length;$++){var ie;"CATMatConnection"===(ie=re.childNodes[$]).nodeName&&me(ie)}}}if(d&&J&&J.traverse((function(e,a){var t=a.indexOf(e);if(-1!==t){a.splice(t,1),"ReferenceRep"===e.productType&&K[e.id]&&(console.log(K[e.id]),-1!==(t=_.indexOf(K[e.id]))&&_.splice(t,1));for(var r=0;r<e.children.length;r++)a.push(e.children[r]);return!1}if("Reference3D"===e.productType){var n=[],i=!1;for(r=0;r<e.children.length;r++){var l=e.children[r];i=i||"Instance3D"===l.productType,"InstanceRep"===l.productType&&n.push(l)}if(i)for(r=0;r<n.length;r++)a.push(n[r])}return!1}),new Array),Q(C+"/ProductCDS.json","string","text/string",(function(e,a){var t=g.CDS.module+"/"+g.CDS.file;require([t],(function(a){(new a).unstream(e)}),(function(e){var t=e.requireModules&&e.requireModules[0];console.log("Module "+t+" is missing.");var r=A.errorCallback||ee;r&&r({url:a,type:"LOAD_ENTRY"})}))}),(function(){})),_.length)!function(){if(j){for(var e=0;e<H.length;e++){var n=H[e];if(void 0!==n&&n.matrix){var i=n.occPath._getOccurrences();if(i.length)for(var l=0;l<i.length;l++)i[l]._relativeMatrix=n.matrix,i[l]._setFrom3dxml(!0)}}J&&J._updateMatrix()}if("3DX"===O)return void be(A.readyCallback);if(null!==w){for(e=0;e<T;++e)w[e].terminate();w[e].onmessage=null}w=null,y=[],E=!1;var o="";if(R.useUvrWorker||"TESSELLATED"===O)if(null===w){var s=t.matchUrl(a.getWebappsBaseUrl(),window.location)?null:"Passport",c=[],d=r.getWorkerAssets();if("UVR"===O||"CGR"===O){var f=r.getCGRLoaderAssets();o={provider:"FILE",filename:"CGRWorkerNewInfra.js",serverurl:a.getWebappsBaseUrl()+"Workers/",module:"Workers",requiredAuth:s},(c=d.concat(f.concat(o))).realWorkerUrl=a.getWebappsBaseUrl()+"Workers/CGRWorkerNewInfra.js"}else if("TESSELLATED"===O){var p=r.getEasysaxAssets();o={provider:"FILE",filename:"XMLV43Worker.js",serverurl:a.getWebappsBaseUrl()+"Workers/",module:"Workers",requiredAuth:s},(c=d.concat(p.concat(o))).realWorkerUrl=a.getWebappsBaseUrl()+"Workers/XMLV43Worker.js"}r.getWorkerBlobFromSpecs(c,(function(e){w=[];for(var a={processText:R.processText,udlMode:R.udlMode,edgeTransparency:R.edgeTransparency,sharedBuffers:R.sharedBuffers,noMeshInRAM:R.noMeshInRAM,primitiveWithBS:R.primWithBS,withBlanking:R.withBlanking,repWithBS:R.repWithBS,withSAG:R.withSAG,udlMode:R.udlMode,sagInfo:R.sagInfo,withBagUUID:R.withBagUUID},t=0;t<T;++t)w[t]=new Worker(e);for(t=0;t<T;++t)!function(e){w[e].onmessage=function(t){var r=t.data;if(r.loaded)y.push(e),E||(E=!0,be(A.readyCallback));else{var n=V[r.node];L--,r.CGR&&(a.fromCGR=!0);var i=function(e){r.applicativesContainers&&ve(r.applicativesContainers,R.applicativeContainers,n),null!==A.progressCallback&&A.progressCallback({loaded:B-L,total:B});var a=(new Date).getTime();if(k&&k({hack:!0,updateInfinitePlane:!0,budgeted:!!L}),a,te(),L<=0){if(null!==w)for(var t=0;t<w.length;++t)null!==w[t]&&(w[t].terminate(),w[t].onmessage=null);if(I&&(I=null),y=[],E=!1,w=null,null!==A.doneCallback){var i=A.doneCallback;if(ne(),i(),R.applicativeContainers)for(var l in R.applicativeContainers)R.applicativeContainers[l].doneCallback&&(X&&X[l]&&R.applicativeContainers[l].doneCallback?R.applicativeContainers[l].doneCallback(X[l]):R.applicativeContainers[l].doneCallback([]))}}};u.processData(n,r,{materialLibrary:z,baseUrl:C},R.withSceneGraph,a,i)}}}(t)}))}else E&&be(A.readyCallback);else if(I)be(A.readyCallback);else{require(["DS/Formats/CGRFile"],(function(e){I=e,be(A.readyCallback)}),(function(e){var a=e.requireModules&&e.requireModules[0];console.log("Module "+a+" is missing."),errorCallbacallBackFunc.errorCallbackckFunc&&A.errorCallback()}))}}();else{var le=A.doneCallback;ne(),le()}}function he(a){for(var t=[],r=!0,n=!1,i=null,l=null,c=new e.Color,d=1,f=0;f<a.childNodes.length;f++){var u=a.childNodes[f];if("OccurenceId"===u.nodeName)for(var p=0;p<u.childNodes.length;p++){if("id"===(v=u.childNodes[p]).nodeName){var h="",m=[];(m=(h=(m=v.textContent.split("urn:3DXML:"))[1]).split("#"))[0],h=m[1],void 0===Y[h]||0!==t.length&&Y[h]===t[t.length-1]||t.push(Y[h])}}else if("GraphicProperties"===u.nodeName)for(p=0;p<u.childNodes.length;p++){var v;if("SurfaceAttributes"===(v=u.childNodes[p]).nodeName)for(var g=0;g<v.childNodes.length;g++){var b=v.childNodes[g];if("Color"===b.nodeName&&(n=!0,c.r=parseFloat(b.getAttribute("red")),c.g=parseFloat(b.getAttribute("green")),c.b=parseFloat(b.getAttribute("blue")),b.getAttribute("alpha")&&(d=parseFloat(b.getAttribute("alpha"))),-1===c.r))return}else"GeneralAttributes"===v.nodeName&&v.getAttribute("visible")&&(r="true"===v.getAttribute("visible"))}else if("RelativePosition"===u.nodeName){var C=Ne(u.textContent);(l=new e.Matrix4).set(C[0],C[3],C[6],C[9],C[1],C[4],C[7],C[10],C[2],C[5],C[8],C[11],0,0,0,1)}}n&&((i=(new o).getMaterialFromGAS({color:c,opacity:d})).force="forceGeomTypeFACE");for(var S=t.length>0,N=[],x=t.length-1;S&&0!==x;){for(var M=t[x],k=t[x-1];M!==k;){N.unshift(M);var D=M.getParents();if(D.length>1||0===D.length){S=!1;break}M=D[0]}x--}if(S){N.unshift(t[0]);var A=new s(N);A.externalPath.length&&H.push({occPath:A,material:i,materialModeSensitive:!1,matrix:l,visible:r})}l&&(j=!0)}function me(e){e.getAttribute("id"),e.getAttribute("name");for(var a="",t=[],r=null,n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];if("IsAggregatedBy"===i.nodeName)i.textContent;else if("PLMRelation"===i.nodeName)for(var l=0;l<i.childNodes.length;l++){var o=i.childNodes[l];if("C_Role"===o.nodeName)a=o.textContent;else if("Ids"===o.nodeName)for(var c=0;c<o.childNodes.length;c++){var d=o.childNodes[c];if("id"===d.nodeName)if("CATMaterialMadeOfLink"===a||"CATMaterialDressByLink"===a)void 0===Y[d.textContent]||0!==t.length&&Y[d.textContent]===t[t.length-1]||(t.push(Y[d.textContent]),void 0!==Y[d.textContent].children[0]&&t.push(Y[d.textContent].children[0]));else if("CATMaterialToReferenceLink"===a){var f=[],u=(f=d.textContent.split("urn:3DXML:"))[1];r={file:(f=u.split("#"))[0],id:u=f[1]}}}}}if(null!==r){var p=new s(t);p.externalPath.length&&H.push({occPath:p,material:Se(r.id),materialModeSensitive:!0,visible:null})}}var ve=function(e,a,t){if(a&&e)for(var r in a){var n=a[r].errorCallback,i=a[r].binaryOutput;if(e[r]){var l=e[r];if(i){X[r]||(X[r]=[]);for(var o=0;o<t.length;o++)X[r].push({node:t[o],data:l})}else{if(!l){n(),delete a[r];continue}var s=l.buffer.subarray(l.options.offset,l.options.compressed+l.options.offset);if(s.length<=2){n(),delete a[r];continue}if(120!==s[0]){n(),delete a[r];continue}if(218!==s[1]){n(),delete a[r];continue}var c=s.subarray(2,l.options.compressed),d=(new v).Inflate(c),f=new TextDecoder("UTF-8").decode(d);X[r]||(X[r]=[]);for(o=0;o<t.length;o++)X[r].push({node:t[o],xml:f})}}}};function ge(){if(L--,A.progressCallback&&A.progressCallback({loaded:B-L,total:B}),0===L){if(null!==w){for(var e=0;e<w.length;++e)null!==w[e]&&(w[e].terminate(),w[e].onmessage=null);y=[],E=!1,w=null}if(I&&(I=null),A.doneCallback){var a=A.doneCallback;if(ne(),a(),R.applicativeContainers)for(var t in R.applicativeContainers)R.applicativeContainers[t].doneCallback&&(X&&X[t]&&R.applicativeContainers[t].doneCallback?R.applicativeContainers[t].doneCallback(X[t]):R.applicativeContainers[t].doneCallback([]))}}}function be(e){L=_.length,B=L;for(var a=0;a<_.length;a++){var t=_[a],r=t.file,n=t.format,l=t.node;if(void 0!==r){var o=C+"/"+r,s=o,d=V[r];if(""!==r)if("3DX"===n)s+=".3dxc",U.load({url:s,concat:!0,zipped:!1,primitives:!0,reps:!0,ssb:!1,destinationNodes:d,readyCallback:function(e){L--,null!==A.progressCallback&&A.progressCallback({loaded:B-L,total:B});var a=(new Date).getTime();if(k&&k({hack:!0,updateInfinitePlane:!0,budgeted:!!L}),a,L<=0&&null!==A.doneCallback){var t=A.doneCallback;ne(),t()}},gasSharing:!0});else if(!R.useUvrWorker&&I&&"UVR"===n)!function(e,a){Q(o,"arraybuffer","text/plain",(function(a){var t={processText:R.processText,udlMode:R.udlMode,fromCGR:!0,edgeTransparency:R.edgeTransparency,sharedBuffers:R.sharedBuffers,noMeshInRAM:R.noMeshInRAM,primitiveWithBS:R.primWithBS,withBlanking:R.withBlanking,repWithBS:R.repWithBS,withSAG:R.withSAG,sagInfo:R.sagInfo,withBagUUID:R.withBagUUID},r=new Uint8Array(a),n={processText:R.processText,primitiveWithBS:R.primWithBS,repWithBS:R.repWithBS,applicativesContainers:R.applicativesContainers,smartStaticBatching:R.smartStaticBatching,mode2D:R.mode2D,sceneGraphOrderMode:R.sceneGraphOrderMode,withSceneGraph:R.withSceneGraph,flexibleBatching:R.udlMode,withBagUUID:R.withBagUUID,withSAG:R.withSAG,uvr:R.uvr,useDefaultTCSet:R.useDefaultTCSet,withBlankingRep:R.withBlanking,OOCSmartStaticInfo:R.OOCSmartStaticInfo,keepCompression:R.keepCompression,uint32Index:R.uint32Index,useGPUPlanarFace:R.useGPUPlanarFace,sag2D:R.sagInfo&&R.sagInfo.sag2D?R.sagInfo.sag2D:0,sag3D:R.sagInfo&&R.sagInfo.sag3D?R.sagInfo.sag3D:0},i=new I([],n);i.setFileBuffer(r);var l=i.open(),o=V[e];L--;u.processData(o,l,{materialLibrary:z,baseUrl:C},R.withSceneGraph,t,(function(e){null!==A.progressCallback&&A.progressCallback({loaded:B-L,total:B});var a=(new Date).getTime();if(k&&k({hack:!0,updateInfinitePlane:!0,budgeted:!!L}),a,te(),L<=0){if(null!==w){for(var t=0;t<w.length;++t)null!==w[t]&&(w[t].terminate(),w[t].onmessage=null);y=[],E=!1,w=null}if(I&&(I=null),null!==A.doneCallback){var r=A.doneCallback;ne(),r()}}}))}))}(r);else if(w)switch(n){case"UVR":case"CGR":"CGR"===n&&(s=s.replace(".3DRep",".cgr"));var p={renderCallback:null,readyCallback:D,doneCallback:null,errorCallback:function(){ge(),A.errorCallback()},progressCallback:A.progressCallback};if(c){F||(F=new h(f,null,{keepLoader:!0}));var m={isBuffer:!1,destination:d[0],readDeco:R.readDeco,primWithBS:R.primWithBS,withBlanking:R.withBlanking,repWithBS:R.repWithBS,smartStaticBatching:R.smartStaticBatching,withSAG:R.withSAG,withBagUUID:R.withBagUUID,sagInfo:R.sagInfo,edgeTransparency:R.edgeTransparency,sharedBuffers:R.sharedBuffers,noMeshInRAM:R.noMeshInRAM,withSceneGraph:R.withSceneGraph};F.load({serverurl:s},p,m)}else!function(e,a){Q(o,"arraybuffer","text/plain",(function(t,r){var i=y[a%y.length];w&&w[i].postMessage({inputFile:t,node:e,readDecoration:R.readDeco,primitiveWithBS:R.primWithBS,withBlanking:R.withBlanking,repWithBS:R.repWithBS,smartStaticBatching:R.smartStaticBatching,withSAG:R.withSAG,withBagUUID:R.withBagUUID,sagInfo:R.sagInfo,applicativesContainers:R.containersName,withSceneGraph:R.withSceneGraph,uint32Index:b,processText:R.processText,uvr:"CGR"!==n},[t])}))}(r,a);break;case"TESSELLATED":!function(e,a){Q(o,"string","text/plain",(function(t,r){var n=y[a%y.length];w&&w[n].postMessage({path:t,node:e,uint32Index:b})}),(function(e){var a=A.errorCallback||ee;ge(),a&&a({url:e,type:"LOAD_ENTRY"})}))}(r,a);break;default:g[n]?function(e,a,t){Q(o,"xml","text/xml",(function(r,n){var i=g[a].module+"/"+g[a].file;require([i],(function(a){(new a).unstream(r,e,t),ge()}),(function(e){var a=e.requireModules&&e.requireModules[0];console.log("Module "+a+" is missing.");var t=errorCallbcallBackFunc.errorCallbackackFunc||ee;ge(),t&&t({url:n,type:"REPFORMAT"})}))}),(function(e){var a=A.errorCallback||ee;ge(),a&&a({url:e,type:"REPFORMAT"})}))}(r,n,l):ge()}else ge()}}e&&(null===J&&(J=new i),e(J,Z))}function Ce(e){var a=[],t=new RegExp(/\[([0,1]|(?:[0-9]?\.[0-9]*(?:[eE][-+][0-9]+)?)),([0,1]|(?:[0-9]?\.[0-9]*(?:[eE][-+][0-9]+)?)),([0,1]|(?:[0-9]?\.[0-9]*(?:[eE][-+][0-9]+)?))\]/),r=t.exec(e);return null!==r?(a[0]=parseFloat(RegExp.$1),a[1]=parseFloat(RegExp.$2),a[2]=parseFloat(RegExp.$3)):null!==(r=(t=new RegExp(/\[([0,1]|(?:[0-9]?\.[0-9]*(?:[eE][-+][0-9]+)?)),([0,1]|(?:[0-9]?\.[0-9]*(?:[eE][-+][0-9]+)?)),([0,1]|(?:[0-9]?\.[0-9]*(?:[eE][-+][0-9]+)?)),([0,1]|(?:[0-9]?\.[0-9]*(?:[eE][-+][0-9]+)?))\]/)).exec(e))&&(a[0]=parseFloat(RegExp.$1),a[1]=parseFloat(RegExp.$2),a[2]=parseFloat(RegExp.$3),a[3]=parseFloat(RegExp.$4)),a}function Se(a){var t=new o,r=z[a];if(void 0===r)return null;var n=z[r.instance];if(void 0===n)return null;var i=z[n.instance];return void 0===i?null:(void 0===i.material&&void 0!==i.params?(i.material=t.getMaterial3DXML(i.params,C,"XMLV43"),i.material.force=!0):void 0===i.params&&(i.material=e.MaterialUtils.createMatteFaceMaterial(),i.material.force=!0),i.material)}function Ne(e){for(var a=function(e){return e.length>0?function(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}(e).split(/\s+/):[]}(e),t=[],r=0,n=a.length;r<n;r++)t.push(parseFloat(a[r]));return t}}}));