define("DS/CfgRuleMatrixComponent/Buildtime/ConstrainedCriteriaPresenter",["UWA/Core","DS/CoreEvents/ModelEvents","UWA/Element","DS/TreeModel/TreeDocument","DS/xModelEventManager/xModelEventManager","DS/ENOXModelListView/ModelListView/js/ModelListView","DS/ENOXModelListView/ModelListView/js/ModelListViewDataExtension","i18n!DS/CfgRuleMatrixComponent/assets/nls/ConstrainedCriteriaPresenter","i18n!DS/CfgRuleMatrixComponent/assets/nls/GlobalPresenter","css!DS/CfgRuleMatrixComponent/Buildtime/ConstrainedCriteriaPresenter.css"],(function(e,t,i,n,a,o,r,s,l){"use strict";var d=function(){};return d.prototype.init=function(e,i,n,o,r){this._listConstrainedCriteria=e,this._criteria_panel_open=!1,this._matrixRuleModel=i,this._privateChannel=o||new t,this._updateChannel=r&&void 0!==r.updateChannel?r.updateChannel:new t,this._applicationChannel=n,this._modelEventXmodel=new t,this._myEventManager=new a(this._privateChannel,this._updateChannel,this._applicationChannel,this._modelEventXmodel),this._editable=!0===r.editable,this._isRHSPanelActivated=!1,this._workaroundCheckAndWakeUpResizeSensor=r.resizeSensorEnablerFun?r.resizeSensorEnablerFun:function(){},this._subscribeToEvents(),this._initXModelListView(),this._initDivs(),this.loadData(this._listConstrainedCriteria)},d.prototype._initXModelListView=function(){var t=this;this._model_constrained_criteria=new n({});var i={id:"constrainedCriteria",defaultNodeDepth:2,model:this._model_constrained_criteria,modelEvents:this._modelEventXmodel,childKeys:["options"],restrictSortFlag:!0,viewOptions:{identifier:"constrained_criteria",grid:{columns:[{text:s.TITLE,dataIndex:"tree"},{text:s.COMMERCIAL,dataIndex:"commercial",typeRepresentation:"string",groupableFlag:!1,width:"100",getCellValue:function(e){return 1==e.nodeModel.options.grid.commercial?s.YES:s.NO},hasCellValue:function(e){switch(e.nodeModel.options.grid.type){case"Variant":case"variant":case"Variability Group":case"variability_group":case"Variant Parameter":return!0;default:return!1}}},{text:s.SEQUENCE_NUMBER,dataIndex:"sequenceNumber",typeRepresentation:"integer"},{text:s.TYPE,dataIndex:"type",getCellValue:function(e){var t=e.nodeModel.options.grid.type;switch(t){case"variability_group":case"Variability Group":t=s.OPTION_GROUP;break;case"option":case"Variability Option":t=s.OPTION;break;case"value":case"Variant Value":t=s.VALUE;break;case"variant":case"Variant":t=s.VARIANT}return t}}]},contextualActions:[{id:"remove-constrained",fonticon:"remove",disable:!this._editable,title:s.REMOVE,text:s.REMOVE,handler:function(){t.removeCriteriaCombination([this])}}],disabledContextualActions:!this._editable},emptyContentOptions:{sentences:[{type:"icon",fonticon:"book-open",sizeicon:"40px",text:e.String.format(s.EMPTY_CONTENT_MESSAGE,'<span class="wux-ui-3ds wux-ui-3ds-book-open"></span>')}]},toolbarOptions:{withStableActions:!0,hideView:!0,useGeneratedToolbar:!0,touchMode:!1,withInformation:!1,actions:[{id:"add-criteria-constrained",text:l._openVariability,fonticon:"book-open",visibility:!this._editable,handler:function(){t._displayCriteriaPanel()}},{className:"divider"},{id:"delete-multiple-criteria",text:s.REMOVE,visibility:!this._editable,showOnSelection:!0,fonticon:"remove",handler:function(e,i){t.removeCriteriaCombination(i)}}]},extensions:[r],withActionColumn:t._editable};this._xModelListView=new o(i),this._modelEventXmodel.publish({event:"xmodel-list-enable-contextual-menu",data:this._editable})},d.prototype._addData=function(e){this._modelEventXmodel.publish({event:"xmodel-list-data-item-add-update-action",data:e})},d.prototype.loadData=function(e){this._listConstrainedCriteria=e,this._modelEventXmodel.publish({event:"xmodel-list-data-load-action",data:e})},d.prototype._initDivs=function(){this._container=document.createElement("div"),this._container.classList.add("build-tablerule-presenter"),e.extendElement(this._container),this._xModelListView.inject(this._container)},d.prototype._subscribeToEvents=function(){var e=this;this._myEventManager.subscribe(this._applicationChannel,{event:"triptych-hide-panel"},(function(){e.resetCriteriaVariantIcon()})),this._myEventManager.subscribe(this._applicationChannel,{event:"information-panel-open"},(function(){e.resetCriteriaVariantIcon()})),this._myEventManager.subscribe(this._applicationChannel,{event:"open-constrained-criteria-variability"},(function(){e._openCriteriaPanel()}))},d.prototype.getContainer=function(){return this._container},d.prototype.inject=function(e){e.appendChild(this._container)},d.prototype.refreshUI=function(){this._updateChannel.publish({event:"refresh-criteria-panel",data:"constrained-criteria"})},d.prototype._openCriteriaPanel=function(){this._updateChannel.publish({event:"display-criteria-panel",data:"constrained-criteria"}),this._applicationChannel.publish({event:"information-panel-hidden",data:"right"}),this.highLightCriteriaVariantIcon()},d.prototype._closeCriteriaPanel=function(){this._applicationChannel.publish({event:"triptych-hide-panel",data:"right"}),this.resetCriteriaVariantIcon()},d.prototype._displayCriteriaPanel=function(){this._criteria_panel_open?this._closeCriteriaPanel():this._openCriteriaPanel()},d.prototype.resetCriteriaVariantIcon=function(){this._criteria_panel_open=!1,this._updateChannel.publish({event:"criteria-panel-active",data:!1});var e={id:"add-criteria-constrained",fonticon:"book-open",text:l._openVariability};this._modelEventXmodel.publish({event:"enox-collection-toolbar-change-icon-action",data:e})},d.prototype.addCriteriaCombination=function(e){for(var t=0;t<e.length;t++){var i=e[t].item,n=this._matrixRuleModel.formatXmodelListViewForJsonModel(i);this._matrixRuleModel.addConstrainedCriteria(n),this._addData(e[t])}this._listConstrainedCriteria=this._matrixRuleModel.formatJsonModelForXmodelListView(this._matrixRuleModel.getJsonModel().constrainedCriteria,"constrained-criteria"),this._privateChannel.publish({event:"mr-model-change"}),this._privateChannel.publish({event:"switch-view-allow",data:!0})},d.prototype.removeCriteriaCombination=function(e){if(0===e.length)return;var t;let i=[];for(var n=0;n<e.length;n++){var a=e[n].options.grid;let r=e[n].getChildren();if(r&&r.length>0)for(var o=0;o<r.length;o++)i.push(r[o].options.id);else i.push(a.id);t=this._matrixRuleModel.formatXmodelListViewForJsonModel(a),this._matrixRuleModel.removeConstrainedCriteria(t),this._updateChannel.publish({event:"add-update-to-criteria-panel",data:[e[n]]}),this._modelEventXmodel.publish({event:"xmodel-list-data-item-remove-and-parent",data:a.id})}this._listConstrainedCriteria=this._matrixRuleModel.formatJsonModelForXmodelListView(this._matrixRuleModel.getJsonModel().constrainedCriteria,"constrained-criteria"),this._privateChannel.publish({event:"xmodel-update-comments-status",data:i}),this._privateChannel.publish({event:"mr-model-change"}),this._privateChannel.publish({event:"switch-view-allow",data:!0})},d.prototype.destroy=function(){this._myEventManager.cleanup("ConstrainedCriteriaPresenter")},d.prototype.highLightCriteriaVariantIcon=function(){this._criteria_panel_open=!0,this._updateChannel.publish({event:"criteria-panel-active",data:!0});let e={id:"add-criteria-constrained",icon:"book-open",text:l._closeVariability};this._modelEventXmodel.publish({event:"enox-collection-toolbar-color-selected-action",data:e}),this._modelEventXmodel.publish({event:"enox-collection-toolbar-change-text-tooltip-action",data:e})},d})),define("DS/CfgRuleMatrixComponent/Runtime/MatrixRuleCellTweaker",["UWA/Core","DS/Tweakers/TweakerBase","DS/Controls/ComboBox","DS/Core/PointerEvents","DS/Utilities/Utils","i18n!DS/CfgRuleMatrixComponent/assets/nls/MatruiTablePresenter","css!DS/CfgRuleMatrixComponent/Runtime/MatrixRuleCellTweaker.css"],(function(e,t,i,n,a,o){"use strict";var r="check",s="block",l="favorite-on",d={S:o.Selected,A:o.Available,N:o.NA,D:o.Default,U:o.Undefined},c={selectedValue:{label:d.S,icon:r},defaultValue:{label:d.D,icon:l},notAvailableValue:{label:d.N,icon:s},availableValue:{label:d.A,icon:" "}},u=t.inherit({name:"matrixRuleCellTweaker",publishedProperties:{stateValidity:{defaultValue:"",type:"string"},state:{defaultValue:c.availableValue,type:"string"},isNonEditableCell:{defaultValue:!1,type:"boolean"},isPainterModeEnabled:{defaultValue:!1,type:"boolean"},displayStyle:{defaultValue:"editText",type:"string",category:"Appearance"}}}),h=function(e,i){t.prototype.baseViewModule.call(this,e,i)};a.applyMixin(h,t.prototype.baseViewModule);var p=function(e,t){h.call(this,e,t)};return a.applyMixin(p,h),p.prototype._applyState=function(e){this._tweaker.value.state=e,this.setValue()},p.prototype.buildView=function(){if(this._tweaker.elements.container){var t=e.merge({},this._options.viewOptions);t.touchMode=this._tweaker._getCurrentTouchMode(),t.allowUnsafeHTMLLabel=!1,t.selectAllOnFocus=!0,this._tweaker.value&&(t.value=this._tweaker.value),this._view=e.createElement("div",{class:"matrix-rule-cell-tweaker"}),this._cellValue=new i({elementsList:[],enableSearchFlag:!1,displayStyle:"lite",mainElementContent:"icon",expanderVisibleFlag:!1}),this._cellValue.elements.container.addClassName("cell-value"),this._view.addContent(this._cellValue),this.setValue()}},p.prototype.setCommentFlag=function(e){e?this._cellValue.elements.container.addClassName("comment-icon"):this._cellValue.elements.container.hasClassName("comment-icon")&&this._cellValue.elements.container.removeClassName("comment-icon")},p.prototype.setIsDifferentFlag=function(e){e?this._cellValue.elements.container.addClassName("highlight-background"):this._cellValue.elements.container.hasClassName("highlight-background")&&this._cellValue.elements.container.removeClassName("highlight-background")},p.prototype.handleEvents=function(){var e=this;this._cellValue.addEventListener(n.POINTERDOWN,(function(){e._tweaker.value.isPainterModeEnabled?(document.body.addClassName("hidden-popup-mode"),e._tweaker.executionContext.nodeModel.getModelEvents().publish({event:"painter-cell-click",data:{target:this,context:e._tweaker.executionContext}})):e._tweaker.value.isNonEditableCell?document.body.addClassName("hidden-popup-mode"):document.body.removeClassName("hidden-popup-mode")})),this._cellValue.addEventListener("change",(function(t){switch(t.dsModel.value){case d.N:e._tweaker.value.state="N";break;case d.S:e._tweaker.value.state="S";break;case d.D:e._tweaker.value.state="D";break;default:e._tweaker.value.state="A"}})),this._cellValue.addEventListener("mouseover",(function(){e._tweaker.executionContext.nodeModel.getModelEvents().publish({event:"update-tooltip",data:{target:this,context:e._tweaker.executionContext}})}))},p.prototype.getSolverStatus=function(){var e,t,i;switch(t="",i=!1,this._tweaker.value.state){case"S":switch(e=c.selectedValue,this._tweaker.value.stateValidity){case"C":case"A":case"T":case"I":i=!0;break;default:t=""}break;case"D":switch(e=c.defaultValue,this._tweaker.value.stateValidity){case"U":case"R":case"E":case"C":case"A":case"T":case"I":i=!0;break;default:t=""}break;case"N":switch(e=c.notAvailableValue,this._tweaker.value.stateValidity){case"C":case"U":case"R":case"E":case"D":i=!0;break;default:t=""}break;case"A":if(e=c.availableValue,"D"===this._tweaker.value.stateValidity)t="rule-status-default";else switch(this._tweaker.value.stateValidity){case"U":case"R":case"E":t="rule-status-required";break;case"C":case"A":case"T":case"I":t="rule-status-incompatible";break;default:t=""}break;default:switch(e=c.availableValue,this._tweaker.value.stateValidity){case"U":case"R":case"E":t="rule-status-required";break;case"C":case"A":case"T":case"I":t="rule-status-incompatible";break;default:t=""}}return[e,t,i]},p.prototype.setValue=function(){if(this._view){var[e,t,i]=this.getSolverStatus();this._tweaker.value.isNonEditableCell?(this._cellValue.elementsList=[e],this._view.removeClassName("wux-layouts-datagridview-tweaker-container")):this._view.addClassName("wux-layouts-datagridview-tweaker-container"),""!==t?(c={selectedValue:{label:d.S,icon:r},defaultValue:{label:d.D,icon:l},notAvailableValue:{label:d.N,icon:s},availableValue:{label:d.A,icon:t}},this._cellValue.elementsList=Object.values(c)):(c={selectedValue:{label:d.S,icon:r},defaultValue:{label:d.D,icon:l},notAvailableValue:{label:d.N,icon:s},availableValue:{label:d.A,icon:""}},this._cellValue.elementsList=Object.values(c));var n=this._cellValue.elements.iconPlaceholder;i?n.addClassName("conflict"):n.removeClassName("conflict"),this._cellValue.value=c.notAvailableValue.label,this._cellValue.value=e.label,this.setCommentFlag(this._tweaker.value.hasComment),this.setIsDifferentFlag(this._tweaker.value.isDifferent),this._cellValue.disabled=this._tweaker.value.isParentCell}},u.prototype.baseViewModule=h,u.prototype.VIEW_MODULES={editText:{classObject:p,options:{viewOptions:{displayStyle:"editText"}}},editText_readOnly:{classObject:p,options:{viewOptions:{displayStyle:"editText"}}}},u})),define("DS/CfgRuleMatrixComponent/Utils/CfgRuleMatrixExpressionGenerator",[],(function(){"use strict";var e={generateBCR:function(t,i){var n={};n.rightExpression=e.generateRightExpression(t,i),n.defaultExpression=e.generateDefaultExpression(t);var a={};a.version=t.version,a.defaultExpression=n.defaultExpression,a.expression=n.rightExpression;var o=JSON.stringify(a);return n.fullExpression="MREV1:"+o,n},generateDefaultExpression:function(e){var i="",n="",a=0;for(a=0;a<e.drivingCombinationValues.length&&""===(i=t(a,e));a++);for(a+=1;a<e.drivingCombinationValues.length;a++)""!==(n=t(a,e))&&(i=i+" ; "+n);return i}},t=function(e,t){var n=[],a="",o=0;for(o=0;o<t.constrainedValues.length;o++)"D"===t.states[e][o]&&n.push(t.constrainedValues[o]);for(0!==n.length&&(a=n[0]),o=1;o<n.length;o++)a=a+" , "+n[o];return""!==a&&(a="DEFAULT ( "+(a="( "+a+" )")+" , ( "+i(t.drivingCombinationValues[e])+" ) )"),a};e.generateRightExpression=function(e,t){var o="",r=0,s="",l="",d="";if(0===e.drivingCombinationValues.length||0===e.constrainedValues.length)return"";for(r=0;r<e.drivingCombinationValues.length;r++)if(l=i(e.drivingCombinationValues[r]),t&&(d=n(r,e)),""!==(s=a(l,d))){o="( "+s+" )";break}for(r+=1;r<e.drivingCombinationValues.length;r++)l=i(e.drivingCombinationValues[r]),t&&(d=n(r,e)),""!==(s=a(l,d))&&(o=o+" AND ( "+s+" )");return o};var i=function(e){var t="",i="";for(i in e){var n="";n="yes"===e[i]?i:"no"===e[i]?"NOT ("+i+")":e[i],t=""===t?n:t+" AND "+n}return t},n=function(e,t){var i="",n=t.states,a=0,o="";for(a=0;a<t.constrainedValues.length;a++)"N"===n[e][a]?(o=t.constrainedValues[a],i=""===i?"NOT ( "+o+" )":"NOT ( "+o+" ) AND "+i):"S"===n[e][a]&&(o=t.constrainedValues[a],i=""===i?"( "+o+" )":"( "+o+" ) AND "+i);return i},a=function(e,t){return""===e||""===t?"":"NOT ( "+e+" ) OR ( "+t+" )"};return e})),define("DS/CfgRuleMatrixComponent/Runtime/ConflictPanelPresenter",["UWA/Class","DS/WebappsUtils/WebappsUtils","DS/CollectionView/ResponsiveTilesCollectionView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","css!DS/CfgRuleMatrixComponent/Runtime/ConflictPanelPresenter.css","i18n!DS/CfgRuleMatrixComponent/assets/nls/ConflictPanelPresenter"],(function(e,t,i,n,a,o,r){return e.singleton({render:function(e){var o,s,l="home.ModelDefinition.ModelInfo.RuleDetails",d="/home/ModelDefinition/ModelInfo/RuleDetails",c="ve4al501dsy.ux.dsone.3ds.com:443/3DSpace/snresources/images/icons/large/I_VariabilityRulesThumbnail.png",u="/home/ModelDefinition/ModelInfo/RuleDetails",h=e.reasons,p=r._list_conflict_rules;h&&(h.type&&"InvColumn"===h.type?(p=r._list_invalid_Column,o=e.BC_ENFORCEMENT_ENABLED?r._causingRulesOrBaseConfigurations+" :":r._causingRules+" :",s=h.drivingCombinationValuesText):h.type&&"conflictMandatory"===h.type?(p=r._conflict_helper,o=r._reason,h.constrained||(s="NOT "+e.conflictingRules[0]+" "+r._conflict_message)):h.type&&"ConfigConflict"===h.type?(p=r._list_conflict_rules,o=r.impliedRules+" :",s=h.drivingCombinationValuesText):(p=r._list_conflict_rules,o=r._rule,h.causingRulesList&&h.causingRulesList.length>1&&(o+="s"),o=h.causingRulesList.length+" "+o+" :","ConflictRules"!==h.type&&"Constraint"!==h.type||(s=h.drivingCombinationValuesText+" - "+h.constrained)));var m=h.causingRulesList;(this._container=UWA.createElement("div",{class:"conflict-panel",styles:{height:"100%",width:"100%"}}),UWA.createElement("div",{html:p,styles:{fontFamily:"Arial",fontSize:"16px",color:" #77797c",margin:"5px 0 3px 8px",fontWeight:"bold"},class:"title-conflict-panel"}).inject(this._container),s)&&UWA.createElement("div",{html:s,styles:{fontFamily:"Arial",fontSize:"14px",color:"#3d3d3d",margin:"10px 0 10px 18px",fontWeight:"normal"},class:"combination-conflict-panel"}).inject(this._container);o&&UWA.createElement("div",{html:o,styles:{fontFamily:"Arial",fontSize:"14px",color:"#3d3d3d",margin:"10px 0 10px 18px",fontWeight:"normal"},class:"toolbar-conflict-panel"}).inject(this._container);var v,_=UWA.createElement("div",{class:"list-Section",styles:{margin:"10px 0 10px 20px",height:"80%",width:"90%",position:"absolute"}});if(_.inject(this._container),h.type&&"conflictMandatory"===h.type){UWA.createElement("div",{html:e.conflictingRules[0]+" "+r._mandatory_message_expression_rule,class:"noConflict-message"}).inject(_)}else{for(var C=(new i).inject(_),f=t.getWebappsAssetUrl("ENOXModelApp","icon/rules.png"),g=t.getWebappsAssetUrl("ENOXModelApp","icon/BaseConfiguration.png"),b=new n,y=0;y<h.causingRulesList.length;y++){var M=m[y].description;M&&" "===M&&(M="");var V=new a({label:h.causingRulesList[y].title,id:h.causingRulesList[y].id,icons:"Model Type"==h.causingRulesList[y].type?[g]:[f],thumbnail:"Model Type"==h.causingRulesList[y].type?g:f,subLabel:m[y].ruleType+" | "+m[y].owner,description:M,type:h.causingRulesList[y].ruleType,version:h.causingRulesList[y].revision?h.causingRulesList[y].revision:"",customTooltip:(v=void 0,m[y].title&&(v=r.TITLE+" : "+m[y].title+"\n"),m[y].ruleType&&(v+=r.TYPE+" : "+m[y].ruleType+"\n"),m[y].revision&&(v+=r.REVISION+" : "+m[y].revision+"\n"),m[y].basePrice&&(v+=r.BASEPRICE+" : "+m[y].basePrice+"\n"),m[y].state&&(m[y].nlsValues&&m[y].nlsValues.nlsState?v+=r.MATURITY_STATE+" : "+m[y].nlsValues.nlsState+"\n":v+=r.MATURITY_STATE+" : "+m[y].state+"\n"),m[y].owner&&(v+=r.OWNER+" : "+m[y].owner+"\n"),m[y].modified&&(v+=r.MODIFICATION_DATE+" : "+function(e){var t,i={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone};widget&&widget.lang?t=widget.lang:navigator&&navigator.language&&(t=navigator.language);var n=Intl.DateTimeFormat(t,i),a=new Date(e);return n.format(a)}(m[y].modified)+"\n"),m[y].organization&&(v+=r.ORGANIZATION+" : "+m[y].organization+"\n"),m[y].collabspace&&(v+=r.COLLABSPACE+" : "+m[y].collabspace+"\n"),m[y].name&&(v+=r.NAME+" : "+m[y].name+"\n"),v),multipleTitleLineNumber:!1,contextualMenu:[r._open]});b.addRoot(V)}C.onCellDoubleClick((function(e){console.log("Rule clicked: "+e.cellView.contentView.title);var t=e.cellView.contentView.title,i=e.cellModel.options.id,n=this.options.type,a=this.options.version;h.privateChannelForRules.publish({event:"xmodel-open-conflict-rule",data:{name:l,path:d,type:n,version:a,model:{id:i,name:t,image:c,version:u}}})})),C.onContextualEvent={callback:function(e){var i=e,n=[];if(e.menu&&e.menu.length)for(var a=0;a<e.menu.length;a++){var o=e.menu[a],r=t.getWebappsBaseUrl();r=0==a?r+"WUXResponsiveTileView/assets/ExpandAll.png":r+"WUXResponsiveTileView/assets/CollapseAll.png",n.push({type:"PushItem",title:o,icon:"open",context:i.context.title,action:{callback:function(e){var t=this.context.title,i=this.context.cellInfos.cellModel.options.id,n=this.context.cellInfos.cellModel.options.version,a=this.context.cellInfos.cellModel.options.type;h.privateChannelForRules.publish({event:"xmodel-open-conflict-rule",data:{name:l,path:d,type:a,version:n,model:{id:i,name:t,image:c,version:u}}})}.bind(i),context:{}}})}return n}},C.loadApplicativeModel(b)}return this._container},getContainer:function(){return this._container}})})),define("DS/CfgRuleMatrixComponent/Buildtime/DrivingCriteriaPresenter",["UWA/Core","DS/CoreEvents/ModelEvents","UWA/Element","DS/TreeModel/TreeDocument","DS/xModelEventManager/xModelEventManager","DS/ENOXModelListView/ModelListView/js/ModelListView","DS/ENOXModelListView/ModelListView/js/ModelListViewDataExtension","i18n!DS/CfgRuleMatrixComponent/assets/nls/DrivingCriteriaPresenter","i18n!DS/CfgRuleMatrixComponent/assets/nls/GlobalPresenter","css!DS/CfgRuleMatrixComponent/Buildtime/DrivingCriteriaPresenter.css"],(function(e,t,i,n,a,o,r,s,l){"use strict";var d=function(){};return d.prototype.init=function(e,i,n,o,r){this._listDrivingCriteria=e,this._criteria_panel_open=!1,this._matrixRuleModel=i,this._privateChannel=o||new t,this._updateChannel=r&&void 0!==r.updateChannel?r.updateChannel:new t,this._applicationChannel=n,this._modelEventXmodel=new t,this._myEventManager=new a(this._privateChannel,this._updateChannel,this._applicationChannel,this._modelEventXmodel),this._editable=!0===r.editable,this.reservedbyFullName=r.reservedbyFullName,this._isRHSPanelActivated=!1,this._workaroundCheckAndWakeUpResizeSensor=r.resizeSensorEnablerFun?r.resizeSensorEnablerFun:function(){},this._subscribeToEvents(),this._initXModelListView(),this._initDivs(),this.loadData(this._listDrivingCriteria)},d.prototype._initXModelListView=function(){var t=this;this._model_driving_criteria=new n({});var i={id:"drivingCriteria",model:this._model_driving_criteria,modelEvents:this._modelEventXmodel,defaultNodeDepth:2,childKeys:["options"],restrictSortFlag:!0,viewOptions:{identifier:"driving_criteria",grid:{columns:[{text:s.TITLE,dataIndex:"tree"},{text:s.COMMERCIAL,dataIndex:"commercial",typeRepresentation:"string",groupableFlag:!1,width:"100",getCellValue:function(e){return 1==e.nodeModel.options.grid.commercial?s.YES:s.NO},hasCellValue:function(e){switch(e.nodeModel.options.grid.type){case"Variant":case"variant":case"Variability Group":case"variability_group":case"Variant Parameter":return!0;default:return!1}}},{text:s.SEQUENCE_NUMBER,dataIndex:"sequenceNumber",typeRepresentation:"integer"},{text:s.TYPE,dataIndex:"type",getCellValue:function(e){var t=e.nodeModel.options.grid.type;switch(t){case"variability_group":case"Variability Group":t=s.OPTION_GROUP;break;case"option":case"Variability Option":t=s.OPTION;break;case"value":case"Variant Value":t=s.VALUE;break;case"variant":case"Variant":t=s.VARIANT}return t}}]},contextualActions:[{id:"remove-driving",fonticon:"remove",title:s.REMOVE,text:s.REMOVE,handler:function(){t.removeCriteriaCombination([this])}}],disabledContextualActions:!this._editable},emptyContentOptions:{sentences:[{type:"icon",fonticon:"book-open",sizeicon:"40px",text:e.String.format(s.EMPTY_CONTENT_MESSAGE,'<span class="wux-ui-3ds wux-ui-3ds-book-open"></span>')}]},toolbarOptions:{withStableActions:!0,useGeneratedToolbar:!0,touchMode:!1,hideView:!0,withInformation:!1,actions:[{id:"add-criteria-driving",text:this._editable?l._openVariability:e.String.format(l._lockedVariability,t.reservedbyFullName),fonticon:"book-open",visibility:!this._editable,handler:function(){t._displayCriteriaPanel()}},{id:"delete-multiple-criteria",visibility:!this._editable,showOnSelection:!0,category:"destructive",text:s.REMOVE,fonticon:"remove",handler:function(e,i){t.removeCriteriaCombination(i)}}]},extensions:[r],withActionColumn:t._editable};this._xModelListView=new o(i),this._modelEventXmodel.publish({event:"xmodel-list-enable-contextual-menu",data:this._editable})},d.prototype._addData=function(e){this._modelEventXmodel.publish({event:"xmodel-list-data-item-add-update-action",data:e})},d.prototype.loadData=function(e){this._listDrivingCriteria=e,this._modelEventXmodel.publish({event:"xmodel-list-data-load-action",data:e})},d.prototype._initDivs=function(){this._container=document.createElement("div"),this._container.classList.add("build-tablerule-presenter"),e.extendElement(this._container),this._xModelListView.inject(this._container)},d.prototype._subscribeToEvents=function(){var e=this;this._myEventManager.subscribe(this._applicationChannel,{event:"triptych-hide-panel"},(function(){e.resetCriteriaVariantIcon()})),this._myEventManager.subscribe(this._applicationChannel,{event:"information-panel-open"},(function(){e.resetCriteriaVariantIcon()})),this._myEventManager.subscribe(this._applicationChannel,{event:"open-driving-criteria-variability"},(function(){e._openCriteriaPanel()}))},d.prototype.inject=function(e){e.appendChild(this._container)},d.prototype.getContainer=function(){return this._container},d.prototype.refreshUI=function(){this._updateChannel.publish({event:"refresh-criteria-panel",data:"driving-criteria"})},d.prototype._openCriteriaPanel=function(){this._updateChannel.publish({event:"display-criteria-panel",data:"driving-criteria"}),this._applicationChannel.publish({event:"information-panel-hidden",data:"right"}),this.highLightCriteriaVariantIcon()},d.prototype._closeCriteriaPanel=function(){this._applicationChannel.publish({event:"triptych-hide-panel",data:"right"}),this.resetCriteriaVariantIcon()},d.prototype._displayCriteriaPanel=function(){this._criteria_panel_open?this._closeCriteriaPanel():this._openCriteriaPanel()},d.prototype.resetCriteriaVariantIcon=function(){this._criteria_panel_open=!1,this._updateChannel.publish({event:"criteria-panel-active",data:!1});var e={id:"add-criteria-driving",fonticon:"book-open",text:l._openVariability};this._modelEventXmodel.publish({event:"enox-collection-toolbar-change-icon-action",data:e})},d.prototype.addCriteriaCombination=function(e){for(var t=0;t<e.length;t++){var i=this._matrixRuleModel.formatXmodelListViewForJsonModel(e[t].item);this._matrixRuleModel.addDrivingCriteria(i),this._addData(e[t])}this._matrixRuleModel.reOrderDrivingCriteria(),this._listDrivingCriteria=this._matrixRuleModel.formatJsonModelForXmodelListView(this._matrixRuleModel.getJsonModel().drivingCriteria,"driving-criteria"),this._privateChannel.publish({event:"mr-model-change"}),this._privateChannel.publish({event:"switch-view-allow",data:!0})},d.prototype.removeCriteriaCombination=function(e){if(0===e.length)return;var t;let i=[];for(var n=0;n<e.length;n++){var a=e[n].options.grid;let r=e[n].getChildren();if(r&&r.length>0)for(var o=0;o<r.length;o++)i.push(r[o].options.id);else i.push(a.id);t=this._matrixRuleModel.formatXmodelListViewForJsonModel(a),this._matrixRuleModel.removeDrivingCriteria(t),this._updateChannel.publish({event:"add-update-to-criteria-panel",data:[e[n]]}),this._modelEventXmodel.publish({event:"xmodel-list-data-item-remove-and-parent",data:a.id})}this._privateChannel.publish({event:"mr-model-change"}),this._matrixRuleModel.reOrderDrivingCriteria(),this._listDrivingCriteria=this._matrixRuleModel.formatJsonModelForXmodelListView(this._matrixRuleModel.getJsonModel().drivingCriteria,"driving-criteria"),this._privateChannel.publish({event:"xmodel-update-comments-status",data:i}),this._privateChannel.publish({event:"switch-view-allow",data:!0})},d.prototype.destroy=function(){this._myEventManager.cleanup("DrivingCriteriaPresenter")},d.prototype.highLightCriteriaVariantIcon=function(){this._criteria_panel_open=!0,this._updateChannel.publish({event:"criteria-panel-active",data:!0});let e={id:"add-criteria-driving",icon:"book-open",text:l._closeVariability};this._modelEventXmodel.publish({event:"enox-collection-toolbar-color-selected-action",data:e}),this._modelEventXmodel.publish({event:"enox-collection-toolbar-change-text-tooltip-action",data:e})},d})),define("DS/CfgRuleMatrixComponent/Runtime/MatruiTablePresenterStaticContent",["DS/UIKIT/Popover","css!DS/CfgRuleMatrixComponent/Runtime/MatruiTablePresenterStaticContent.css","css!DS/UIKIT/UIKIT.css"],(function(e,t,i){"use strict";var n={},a=function(e,t){null!=e&&t instanceof Array&&t.forEach((function(t){e.classList.add(t)}))};return n.generateMRStandard=function(e,t){var i=document.createElement("div");a(i,["mr-body-cell","mr-standard","user-selection"]);var n=document.createElement("span");return a(n,["fonticon","fonticon-check","user-selection"]),i.appendChild(n),i},n.generateMRStandardConflict=function(e,t){var i=document.createElement("div");a(i,["mr-body-cell","mr-standard","mr-conflict","user-selection"]);var n=document.createElement("span");a(n,["fonticon","fonticon-check","user-selection"]),i.appendChild(n);var o=document.createElement("span");return a(o,["mr-span-conflict","fonticon","fonticon-attention","mr-combi-details"]),i.appendChild(o),i},n.generateMRStandardIncompatible=function(){var e=document.createElement("div");a(e,["mr-body-cell","mr-standard","user-selection"]);var t=document.createElement("span");a(t,["fonticon","fonticon-check","user-selection"]),e.appendChild(t);var i=this.createTriangleDiv("incompatible");return e.appendChild(i),e},n.generateMRStandardRequired=function(){var e=document.createElement("div");a(e,["mr-body-cell","mr-standard","user-selection"]);var t=document.createElement("span");a(t,["fonticon","fonticon-check","user-selection"]),e.appendChild(t);var i=this.createTriangleDiv("required");return e.appendChild(i),e},n.generateMRDefault=function(e,t){var i=document.createElement("div");a(i,["mr-body-cell","mr-default","user-selection"]);var n=document.createElement("span");return a(n,["fonticon","fonticon-favorite-on","user-selection"]),i.appendChild(n),i},n.generateMRDefaultRequired=function(){var e=document.createElement("div");a(e,["mr-body-cell","mr-default","user-selection"]);var t=document.createElement("span");a(t,["fonticon","fonticon-favorite-on","user-selection"]),e.appendChild(t);var i=this.createTriangleDiv("required");return e.appendChild(i),e},n.generateMRDefaultIncompatible=function(){var e=document.createElement("div");a(e,["mr-body-cell","mr-default","user-selection"]);var t=document.createElement("span");a(t,["fonticon","fonticon-favorite-on","user-selection"]),e.appendChild(t);var i=document.createElement("span");return a(i,["mr-span-conflict","fonticon","fonticon-attention","mr-combi-details"]),e.appendChild(i),e},n.generateMRAvailable=function(e,t){var i=document.createElement("div");return a(i,["mr-body-cell","mr-available","mr-standard"]),i},n.generateMRAvailableRequired=function(e,t){var i=document.createElement("div");a(i,["mr-body-cell","mr-available","mr-standard"]);var n=this.createTriangleDiv("required");return i.appendChild(n),i},n.generateMRAvailableIncompatible=function(e,t){var i=document.createElement("div");a(i,["mr-body-cell","mr-available","mr-standard"]);var n=this.createTriangleDiv("incompatible");return i.appendChild(n),i},n.generateMRAvailableConflict=function(e,t){var i=document.createElement("div");a(i,["mr-body-cell","mr-available","mr-standard"]);var n=document.createElement("span");return a(n,["mr-span-conflict","fonticon","fonticon-attention","mr-combi-details"]),i.appendChild(n),i},n.generateMRNotAvailable=function(e,t){var i=document.createElement("div");a(i,["mr-body-cell","mr-notavailable","user-selection"]);var n=document.createElement("span");return a(n,["fonticon","fonticon-block","user-selection"]),i.appendChild(n),i},n.generateMRNotAvailableConflict=function(e,t){var i=document.createElement("div");a(i,["mr-body-cell","mr-notavailable","mr-conflict","user-selection"]);var n=document.createElement("span");a(n,["fonticon","fonticon-block","user-selection"]),i.appendChild(n);var o=document.createElement("span");return a(o,["mr-span-conflict","fonticon","fonticon-attention","mr-combi-details"]),i.appendChild(o),i},n.generateMRNotAvailableIncompatible=function(e,t){var i=document.createElement("div");a(i,["mr-body-cell","mr-notavailable","user-selection"]);var n=document.createElement("span");a(n,["fonticon","fonticon-block","user-selection"]),i.appendChild(n);var o=this.createTriangleDiv("incompatible");return i.appendChild(o),i},n.createTriangleDiv=function(e){var t=document.createElement("div");t.classList.add("triangle");var i=document.createElement("span");return a(i,["mr-span-information","fonticon"]),"required"===e?i.classList.add("fonticon-check"):"incompatible"===e?i.classList.add("fonticon-block"):i.classList.add("fonticon-info"),i.classList.add("mr-combi-details"),t.appendChild(i),t},n.createConflictDiv=function(){var e=document.createElement("span");return a(e,["mr-span-conflict","fonticon","fonticon-attention","mr-combi-details"]),e},n.changeStateIcon=function(e,t){if(e.cellModel){var i,a=e.cellModel.stateValidity,o=e.cellModel.state,r=e.cellView.getContent();e.cellView.getContent().getElement(".triangle");if(t){var s=e.cellView.getContent().getElement(".mr-body-cell");s.getChildren().length>0?i=s.getChildren()[0]:(i=UWA.createElement("span"),s.appendChild(i))}else{var l=e.cellView.getContent().getElement(".wux-controls-combobox").getElement(".mr-body-cell");l.getChildren().length>0?i=l.getChildren()[0]:(i=UWA.createElement("span"),l.appendChild(i))}switch(this.setAttributeSpanElement(o,i),this.getCellState(o,a)){case"conflict":r.appendChild(n.createConflictDiv());break;case"required":r.appendChild(n.createTriangleDiv("required"));break;case"incompatible":r.appendChild(n.createTriangleDiv("incompatible"))}}else console.error("Issue MatruiTablePresenterStaticContent changeStateIcon : cell no cellmodel")},n.getCellState=function(e,t){var i="";switch(e){case"S":switch(t){case"C":case"A":case"T":case"I":i="conflict";break;case"U":case"R":case"E":i="required"}break;case"A":case"N":switch(t){case"U":case"R":case"E":i="required";break;case"A":case"T":case"I":i="incompatible";break;case"C":i="conflict"}break;case"D":switch(t){case"U":case"R":case"E":i="required";break;case"A":case"T":case"I":case"C":i="conflict"}}return i},n.setAttributeSpanElement=function(e,t){if(t&&e)switch(e){case"S":t.setAttribute("class","fonticon fonticon-check user-selection");break;case"A":t.setAttribute("class","");break;case"N":t.setAttribute("class","fonticon fonticon-block user-selection");break;case"D":t.setAttribute("class","fonticon fonticon-favorite-on user-selection")}},n})),define("DS/CfgRuleMatrixComponent/Buildtime/CriteriaPresenter",["DS/Handlebars/Handlebars","DS/CoreEvents/ModelEvents","DS/xModelEventManager/xModelEventManager","DS/WebappsUtils/WebappsUtils","DS/TreeModel/TreeDocument","DS/ENOXModelListView/ModelListView/js/ModelListView","DS/ENOXModelListView/ModelListView/js/ModelListViewDataExtension","i18n!DS/CfgRuleMatrixComponent/assets/nls/CriteriaPresenter","i18n!DS/xDimensionManager/assets/nls/xUnitLabelLong","i18n!DS/xDimensionManager/assets/nls/xDimentions","text!DS/CfgRuleMatrixComponent/Buildtime/CriteriaPresenter.html","css!DS/CfgRuleMatrixComponent/Buildtime/CriteriaPresenter.css"],(function(e,t,i,n,a,o,r,s,l,d,c){"use strict";var u=function(){},h={variability_group:s.OPTION_GROUP,"Variability Group":s.OPTION_GROUP,option:s.OPTION,"Variability Option":s.OPTION,value:s.VALUE,"Variant Value":s.VALUE,variant:s.VARIANT,Variant:s.VARIANT,"Variant Parameter":s.PARAMETER};return u.prototype.init=function(e){this._options=e,this._criteria_model=new t,this._myEventManager=new i(this._criteria_model),this._initDivs(this._options)},u.prototype._initDivs=function(t){var i=e.compile(c)(t);this._container=document.createElement("div"),this._container.innerHTML=i,this._container=this._container.firstChild,this._criteriaContent=this._container.querySelector(".criteria-content"),this._criteriaTitle=this._container.querySelector(".criteria-main-title")},u.prototype._getGridInitialListView=function(e){return e?{columns:[{text:s.TITLE,dataIndex:"tree"},{text:s.COMMERCIAL,dataIndex:"commercial",typeRepresentation:"string",groupableFlag:!1,width:"100",getCellValue:function(e){return 1==e.nodeModel.options.grid.commercial?s.YES:s.NO},hasCellValue:function(e){switch(e.nodeModel.options.grid.type){case"Variant":case"variant":case"Variability Group":case"variability_group":case"Variant Parameter":return!0;default:return!1}}},{text:s.SEQUENCE_NUMBER,dataIndex:"sequenceNumber",typeRepresentation:"integer",width:100},{text:s.TYPE,groupableFlag:!0,dataIndex:"type",width:100,getCellValue:function(e){return h[e.nodeModel.options.grid.type]}},{text:s.RANGE,sortableFlag:!1,dataIndex:"range",valueAttribute:["minValue","maxValue"],width:100,kind:["instance"],getCellValue:function(e){if("Variant Parameter"===e.nodeModel.options.grid.type){var t="";if(e.nodeModel.options.grid.hasOwnProperty("minValue")&&e.nodeModel.options.grid.hasOwnProperty("maxValue")){var i=e.nodeModel.options.grid.minValue.split(" ")[0],n=e.nodeModel.options.grid.maxValue.split(" ")[0];i&&n&&(t=i+" "+s.RangeValueDelimiter+" "+n)}return t}}},{text:s.UNIT,groupableFlag:!0,dataIndex:"unit",valueAttribute:["unit"]},{text:s.DIMENSION,groupableFlag:!0,dataIndex:"dimension",valueAttribute:["dimension"],width:100,kind:["instance"],getCellValue:function(e){var t=" ";return e.nodeModel.options.grid.hasOwnProperty("dimension")?(t=e.nodeModel.options.grid.dimension,"Integer"===(t=d.get(t))||"Real"===t?s.NoDimensionLabel:t):t}},{text:s.DESCRIPTION,dataIndex:"description"}]}:{columns:[{text:s.TITLE,dataIndex:"tree"},{text:s.COMMERCIAL,dataIndex:"commercial",typeRepresentation:"string",groupableFlag:!1,width:"100",getCellValue:function(e){return 1==e.nodeModel.options.grid.commercial?s.YES:s.NO},hasCellValue:function(e){switch(e.nodeModel.options.grid.type){case"Variant":case"variant":case"Variability Group":case"variability_group":case"Variant Parameter":return!0;default:return!1}}},{text:s.SEQUENCE_NUMBER,dataIndex:"sequenceNumber",typeRepresentation:"integer",width:100},{text:s.TYPE,dataIndex:"type",getCellValue:function(e){return h[e.nodeModel.options.grid.type]}},{text:s.DESCRIPTION,dataIndex:"description"}]}},u.prototype.initializeListView=function(e,t=!1){this._options_xmodellistview=e,this._model_criteria=new a({});var i={id:"criteria-model",model:this._model_criteria,modelEvents:this._criteria_model,defaultNodeDepth:2,restrictSortFlag:!0,childKeys:["values","options"],viewOptions:{currentView:"DataGridView",identifier:"criteria-component",layoutOptions:e.layoutOptions,grid:this._getGridInitialListView(t),contextualActions:this._options_xmodellistview.contextualActions?this._options_xmodellistview.contextualActions:null},emptyContentOptions:{sentences:[{type:"img",src:n.getWebappsAssetUrl("ENOXModelApp","icon/variantValue.png"),sizeicon:"40px",text:s.EMPTY_CONTENT_MESSAGE}]},toolbarOptions:this._options_xmodellistview.toolbarOptions?this._options_xmodellistview.toolbarOptions:null,extensions:[r]};this._xModelListView=new o(i),this._xModelListView.inject(this._criteriaContent)},u.prototype.getCriteriaModel=function(){return this._criteria_model},u.prototype._updateDataWithUnit=function(e){for(var t,i=0;i<e.member.length;i++)e.member[i].isA===s.TYPE_PARAMETER&&(t=e.member[i].minValue.split(" ")[1],e.member[i].unit=t?l.get(t):" ")},u.prototype.loadData=function(e){var t;this._updateDataWithUnit(e),e.member.forEach((e=>{(t=e.values?e.values:e.options)&&t.member.forEach((e=>{e.sequenceNumber=parseInt(e.sequenceNumber)}))})),this._criteria_model.publish({event:"xmodel-list-data-load-action",data:e})},u.prototype.removeData=function(e){this._criteria_model.publish({event:"xmodel-list-data-item-remove-and-parent",data:e})},u.prototype._addData=function(e){this._criteria_model.publish({event:"xmodel-list-data-item-add-update-action",data:e})},u.prototype.inject=function(e){e.appendChild(this._container)},u.prototype.getContainer=function(){return this._container},u.prototype.getXModelListView=function(){return this._xModelListView},u.prototype.destroy=function(){this._myEventManager.cleanup("Chanel CriteriaPresenter clean")},u})),define("DS/CfgRuleMatrixComponent/LoadingPanel/LoadingPanel",["DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/CoreEvents/ModelEvents","i18n!DS/CfgRuleMatrixComponent/assets/nls/LoadingPanel"],(function(e,t,i,n,a){"use strict";var o=function(e){e&&(this._modelEventObj=e,this._tokens=[])};o.prototype.subscribe=function(e,t,i){t&&i&&this._modelEventObj&&this._tokens.push(this._modelEventObj.subscribe(t,i))},o.prototype.cleanup=function(e){if(this._tokens&&this._tokens.length>0){var t=this;console.log("[ENOXWizard:LocalEvtManager] Performing event cleanup for: "+e),this._tokens.forEach((function(e){t._modelEventObj.unsubscribe(e)}))}};var r=function(e){e&&(this._options=e,this._content=this._options.content,this._immersiveFrame=this._options.immersiveFrame,this._modelEvents=this._options.modelEvents,this._myEventManager=new o(this._modelEvents),this._init())};return r.prototype._init=function(){this._createLoadingPanel(this._content),this._subscribeToEvents()},r.prototype.close=function(){this.myDialog?this.myDialog.close():console.log("No loadingPanel displayed")},r.prototype.destroy=function(){this._modelEvents.publish({event:"destroy-loading"}),this._myEventManager&&(this._myEventManager.cleanup("LoadingPanel"),this._myEventManager=null)},r.prototype._subscribeToEvents=function(){var e=this;this._modelEvents&&(this._myEventManager.subscribe(this._modelEvents,{event:"change-icon-loading"},(function(t){e._changeIconLoading(t.id,t.icon)})),this._myEventManager.subscribe(this._modelEvents,{event:"change-text-loading"},(function(t){e._changeText(t.id,t.text)})))},r.prototype._createLoadingPanel=function(e){var i=this;this.contentLoading=UWA.createElement("div");for(var n=0;n<e.length;n++){var o,r=UWA.createElement("div");switch(e[n].icon?e[n].icon:"no-start"){case"no-start":(o=new UWA.Element("i",{id:"icon-loading-panel-"+n,class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-clock"})).style="color: orange;";break;case"on-progress":(o=new UWA.Element("i",{id:"icon-loading-panel-"+n,class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-progress-2"})).style="color: #368EC4;";break;case"done":(o=new UWA.Element("i",{id:"icon-loading-panel-"+n,class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check"})).style="color: green;"}var s=new UWA.Element("div",{id:"title-loading-panel-"+n,html:e[n].title+" : "}),l=new UWA.Element("div",{id:"percentage-loading-panel-"+n,html:e[n].text?e[n].text:""});l.style="display: inline; margin-left: 2px;",s.inject(r),o&&o.inject(s),l.inject(s),r.inject(this.contentLoading)}this.myDialog=new t({immersiveFrame:this._immersiveFrame,title:a.loading_Status,content:this.contentLoading,activeFlag:!1,modalFlag:!1,resizableFlag:!1}),this.myDialog.addEventListener("close",(function(e){i.destroy()}))},r.prototype._changeIconLoading=function(e,t){var i=document.getElementById("icon-loading-panel-"+e);if(i)switch(t){case"no-start":i.className="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-clock",i.style="color : orange";break;case"done":i.className="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check",i.style="color : green";break;case"on-progress":i.className="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-progress-2",i.style="color : #368EC4"}return i},r.prototype._changeText=function(e,t){var i=document.getElementById("percentage-loading-panel-"+e);return i&&i.setText(t),i},r})),define("DS/CfgRuleMatrixComponent/Model/DemoModel",["UWA/Class/Model"],(function(e){return UWA.Class.Model.extend({defaults:{drivingCriteria:[],constrainedCriteria:[],drivingCombinationValues:[],constrainedValues:[],states:null,statesValidity:null}})})),define("DS/CfgRuleMatrixComponent/Utils/MatruiTablePersistanceUtils",[],(function(){"use strict";var e={convertJsonToV3:function(t,i){switch(i.version){case"1.0.1":var n=e.generateJsonModelV2FromV1(t,i);return e.generateJsonModelV3FromV2(t,n);case"2.0":return e.generateJsonModelV3FromV2(t,i);default:return i}},generateJsonModelV2FromV1:function(e,t){var i=0,n=0,a={},o=[];for(a.constrainedValues=[],i=0;i<t.constrainedCombinations.length;i+=1){(v={}).id=t.constrainedCombinations[i].combinationOptions[0].id,e[v.id]?("option"===e[v.id].type?(v.parent=null,v.criteriaValidity="yes"):(v.parent=e[v.id].parent,v.variantValue=v.id),a.constrainedValues.push(v),o.push(v.id)):console.error("Issue generateJsonModelV2FromV1 dico not found id : "+v.id)}var r={};for(a.drivingCombinationValues=[],i=0;i<t.drivingCombinations.length;i+=1){var s=[];for(n=0;n<t.drivingCombinations[i].combinationOptions.length;n+=1)s.push(t.drivingCombinations[i].combinationOptions[n].id);var l={};for(n=0;n<s.length;n+=1)if(e[s[n]])if("option"===e[s[n]].type)l[s[n]]={},l[s[n]].criteriaValidity="yes";else{var d=e[s[n]].parent;if(l[d]={},l[d].variantValue=s[n],l[d].value=e[s[n]].title,l[d].type=e[s[n]].type,void 0===r[d])r[d]={},r[d].values=[],r[d].values.push(s[n]);else r[d].values.find((e=>e===s[n]))||r[d].values.push(s[n])}else console.error("Issue 2  generateJsonModelV2FromV1 dico not found id : "+s[n]);0!==Object.keys(l).length&&a.drivingCombinationValues.push(l)}a.drivingCriteria=[];for(i=0;i<t.drivingFeatures.length;i+=1){if(e[t.drivingFeatures[i].id]){if((p={}).id=t.drivingFeatures[i].id,p.type=e[t.drivingFeatures[i].id].type,p.name=e[t.drivingFeatures[i].id].title,p.selectedValues=[],p.rejectedValues=[],r&&Object.keys(r).length>0)for(n=0;n<r[t.drivingFeatures[i].id].values.length;n+=1)p.selectedValues.push({variantValue:r[t.drivingFeatures[i].id].values[n],validity:!0,id:r[t.drivingFeatures[i].id].values[n]});p.rejectedValues.push({criteriaValidity:"no"}),p.selectedValues.length>0&&a.drivingCriteria.push(p)}}if(a.constrainedCriteria=[],o.length>0)for(i=0;i<t.constrainedFeatures.length;i+=1){if(e[t.constrainedFeatures[i].id])if((m={}).id=t.constrainedFeatures[i].id,m.type=e[t.constrainedFeatures[i].id].type,m.name=e[t.constrainedFeatures[i].id].title,m.selectedValues=[],m.rejectedValues=[],"variability_group"===m.type)for(n=0;n<e[t.constrainedFeatures[i].id].content.length;n+=1){(m={}).id=e[t.constrainedFeatures[i].id].content[n],m.type="option",m.parent=null,m.rejectedValues=[{criteriaValidity:"no"}],m.selectedValues=[{id:e[t.constrainedFeatures[i].id].content[n],parent:null,criteriaValidity:"yes"}],a.constrainedCriteria.push(m)}else{for(n=0;n<e[t.constrainedFeatures[i].id].values.length;n+=1)m.selectedValues.push({variantValue:e[t.constrainedFeatures[i].id].values[n]});m.selectedValues.length>0&&a.constrainedCriteria.push(m)}}if(a.states=[],a.statesValidity=[],!t.statesValidity){t.statesValidity="";for(i=0;i<t.states.length;i++)t.statesValidity+="V"}for(i=0;i<a.drivingCombinationValues.length;i+=1){var c="",u="";for(n=0;n<a.constrainedValues.length;n+=1){var h=n*t.drivingCombinations.length+i;c+=t.states[h],u+=t.statesValidity[h]}a.states.push(c),a.statesValidity.push(u)}if(a.drivingCriteria.length!=t.drivingFeatures.length)for(i=0;i<t.drivingFeatures.length;i+=1){if(e[t.drivingFeatures[i].id]){var p;(p={}).id=t.drivingFeatures[i].id,p.type=e[t.drivingFeatures[i].id].type,p.selectedValues=[],p.rejectedValues=[];for(n=0;n<e[t.drivingFeatures[i].id].values.length;n+=1)p.selectedValues.push({variantValue:e[t.drivingFeatures[i].id].values[n]});p.rejectedValues.push({criteriaValidity:"no"}),p.selectedValues.length>0&&a.drivingCriteria.push(p)}}if(a.constrainedCriteria.length!=t.constrainedFeatures.length&&0===o.length||a.constrainedCriteria[0].selectedValues.length!=o.length){a.constrainedCriteria=[];for(i=0;i<t.constrainedFeatures.length;i+=1){if(e[t.constrainedFeatures[i].id])if((m={}).id=t.constrainedFeatures[i].id,m.type=e[t.constrainedFeatures[i].id].type,m.name=e[t.constrainedFeatures[i].id].title,m.selectedValues=[],m.rejectedValues=[],"variability_group"===m.type)for(n=0;n<e[t.constrainedFeatures[i].id].content.length;n+=1){var m;(m={}).id=e[t.constrainedFeatures[i].id].content[n],m.type="option",m.parent=null,m.rejectedValues=[{criteriaValidity:"no"}],m.selectedValues=[{id:e[t.constrainedFeatures[i].id].content[n],parent:null,criteriaValidity:"yes"}],a.constrainedCriteria.push(m)}else{for(n=0;n<e[t.constrainedFeatures[i].id].values.length;n+=1)m.selectedValues.push({variantValue:e[t.constrainedFeatures[i].id].values[n]});m.selectedValues.length>0&&a.constrainedCriteria.push(m)}}for(i=0;i<a.constrainedCriteria.length;i+=1){var v;if((v={}).id=a.constrainedCriteria[i].id,e[v.id]){if("option"===e[v.id].type)v.parent=null,v.criteriaValidity="yes";else{if("variant"===e[v.id].type){for(let t=0;t<e[v.id].values.length;t++){let i={};i.id=e[v.id].values[t],i.parent=v.id,i.variantValue=i.id,void 0===a.constrainedValues.find((e=>e.id===i.id))&&a.constrainedValues.push(i)}continue}"value"===e[v.id].type&&(v.parent=e[v.id].parent)}void 0===a.constrainedValues.find((e=>e.id===v.id))&&a.constrainedValues.push(v)}else console.error("Issue generateJsonModelV2FromV1 dico not found id : "+v.id)}}if(0===t.constrainedCombinations.length&&0===t.drivingCombinations.length){let e=1;for(let t=0;t<a.drivingCriteria.length;t++)e*=a.drivingCriteria[t].selectedValues.length;var _="";for(let e=0;e<a.constrainedCriteria.length;e++)if("option"===a.constrainedCriteria[e].type)_+="X","X";else for(let t=0;t<a.constrainedCriteria[e].selectedValues.length;t++)_+="X","X";for(let t=0;t<e;t++){var C=UWA.clone(_),f=UWA.clone(_);a.states.push(C),a.statesValidity.push(f)}}return a.version="2.0",a},generateJsonModelV3FromV2:function(t,i){var n={};n.drivingCriteria=e.getCriteriaV3FromV2(t,i.drivingCriteria),n.constrainedCriteria=e.getCriteriaV3FromV2(t,i.constrainedCriteria),n.constrainedValues=[],i.constrainedValues.forEach((e=>{n.constrainedValues.push({id:e.id})})),n.drivingCombinationValues=[];var a={};return i.drivingCombinationValues.forEach((e=>{Object.keys(e).forEach((t=>{a[t]={variantValue:e[t].variantValue}})),n.drivingCombinationValues.push(a),a={}})),n.states=i.states,n.statesValidity=i.statesValidity,n.drivingCombinationsValidity=i.drivingCombinationsValidity,n.version="3.0",n},getCriteriaV3FromV2:function(e,t){var i=[],n={},a={};return t.forEach((t=>{"variant"===t.type?(a.id=t.id,a.selectedValues=[],t.selectedValues.forEach((e=>{a.selectedValues.push({id:e.variantValue})})),i.push(a),a={}):"option"===t.type&&(UWA.is(n[e[t.id].parent],"number")?i[n[e[t.id].parent]].selectedValues.push({id:t.id}):(n[e[t.id].parent]=i.length,a.id=e[t.id].parent,a.selectedValues=[],a.selectedValues.push({id:t.id}),i.push(a)),a={})})),void 0!==a.id&&i.push(a),i}};return e})),define("DS/CfgRuleMatrixComponent/Runtime/MatruiTablePresenter",["UWA/Core","DS/CfgRuleMatrixComponent/Runtime/MatruiTablePresenterStaticContent","DS/Tree/TreeListView","DS/TreeModel/TreeNodeModel","DS/TreeModel/TreeDocument","DS/Controls/Popup","DS/CfgSolver/CfgSolverServices","DS/TreeModel/DataModelSet","DS/DataGridView/DataGridView","DS/UIKIT/Mask","DS/xModelEventManager/xModelEventManager","DS/Windows/Dialog","DS/Controls/Tab","DS/Controls/Button","DS/ENOXCollectionToolBar/js/ENOXGeneratedToolBar","DS/CoreEvents/ModelEvents","DS/xModelSocialToolbar/js/xModelCommentUtils","DS/ENOXNotificationsUtil/ENOXNotificationUtil","i18n!DS/CfgRuleMatrixComponent/assets/nls/MatruiTablePresenter","css!DS/CfgRuleMatrixComponent/Runtime/MatruiTablePresenter.css"],(function(e,t,i,n,a,o,r,s,l,d,c,u,h,p,m,v,_,C,f){"use strict";var g,b,y,M,V,D="string";let w,x,E,S=f.ANY,I="OR";var T={S:"check",A:"",N:"block",D:"favorite-on",U:"question-circle",X:"block"},R={S:f.Selected,A:f.Available,N:f.NA,D:f.Default,U:f.Undefined};const A={conflict:f.conflicting,required:f.required,incompatible:f.incompatible,default:f.Default};var j=function(){};return j.prototype.init=function(t,i,n){let a;this.loadingConflictPercent=0,this.loadingSuggestionPercent=0,t.removeStateValidity(),t.removeDrivingCombinationsValidity(),this._matrixModel=t,this._mapDico=this._matrixModel._mapDico,this._jsonModel=this._matrixModel.getJsonModel(),this._solverKey=n.solverKey,this._solverModelEvent=n.solverModelEvent,this._options=n||{},this._privateChannel=i,this.context=n.context?n.context:"",this._invalidColumns=[],this.filterBy=[],this.invalidFilter=[],this._ruleId=n.ruleID,this.isFilterApplied=!1,this._currentUser=n.currentUser,this.previousInvalidFilter=[],this.previousHeaderFilter=[],this._applicationChannel=n.applicationChannel,n.filter&&n.filter.filterBy&&n.filter.invalidFilter&&(this.filterBy=n.filter.filterBy,this.invalidFilter=n.filter.invalidFilter,this.previousInvalidFilter=e.clone(this.invalidFilter),this.previousHeaderFilter=e.clone(this.filterBy)),this.conflictColumn={},this.invalidColumn=[],this.arrColumnAfterSort=[],this._editable=n.editable,this._painterEnabled=void 0,this._isConflictPanelOpened=!1,this._cellTooltip=new o({target:void 0,constraint:this._container,position:"bottom",alignment:"near",autoHide:!1}),this._cellTooltip.getContent().addClassName("mr-custom-popup"),a="Compare"===this.context?new c(this._privateChannel,this._solverModelEvent):new c(this._privateChannel,this._solverModelEvent,this._applicationChannel),this._myEventManager=a,this._container||(this._container=document.createElement("div"),this._container.classList.add("matrui-table-presenter")),this._subscribeToEvent(),this._resizableTableModel=this._createResizableModel(),this.lengthHeader=this._resizableTableModel.title_columns.length,this._initTreeModel(),this._stopRecursiveCall=!1,this._initComments(!1),this._jsonModel.states&&this._jsonModel.states.length>0&&this._buildTable()},j.prototype._initComments=function(e){let t={subjectID:this._ruleId,modelEvent:this._privateChannel,view:this._dataGridView,setDGV:e,currentUser:this._currentUser,appForcedLinkUri:"ENXMODL_AP"};_.launchSocialToolbar(t)},j.prototype._subscribeToEvent=function(){var e=this;this._myEventManager.subscribe(this._privateChannel,{event:"reset-loading-status-bar"},(function(){var t={id:"statusConflict",text:f.Conflicts_Computing+" 0%",icon:"clock"};e._updateStatusBar(t),t={id:"statusSuggestion",text:f.Constraints_Computing+" 0%",icon:"clock"},e._updateStatusBar(t)})),this._myEventManager.subscribe(this._solverModelEvent,{event:"mr-stop-recursive-call"},(function(){e._stopAsyncRecursiveCallSolver()})),this._myEventManager.subscribe(this._solverModelEvent,{event:"mr-check-all-conflict-suggestion"},(function(){e._stopRecursiveCall=!1,e._checkAllConflictMatrix(e._matrixModel)})),this._myEventManager.subscribe(this._solverModelEvent,{event:"mr-reload-table"},(function(){e._container.innerHTML="",e._buildTable()})),this._myEventManager.subscribe(this._privateChannel,{event:"mr-resize"},(function(){e._dataGridView&&e._dataGridView.layout.postRender()})),this._myEventManager.subscribe(this._privateChannel,{event:"conflict-panel-opened"},(function(t){e._isConflictPanelOpened=t})),this._myEventManager.subscribe(this._privateChannel,{event:"matrui-reset-filter"},(function(){e.resetFilter()})),this._myEventManager.subscribe(this._privateChannel,{event:"matrui-setprevious-filter"},(function(){e.invalidFilter=e.previousInvalidFilter,e.filterBy=e.previousHeaderFilter,e._privateChannel.publish({event:"widget-preference-update-filter",data:{invalidFilter:e.invalidFilter,filterBy:e.filterBy}})})),this._myEventManager.subscribe(this._privateChannel,{event:"enox-collection-toolbar-action-activated"},(function(t){e._actionToolBar(t),e._container&&e._previousPainterEnabled!==e._painterEnabled&&(e._dataGridView.invalidateLayout({updateCellContent:!0}),e._previousPainterEnabled=e._painterEnabled)}))},j.prototype._actionToolBar=function(e){switch(e){case"painter-not-available":this._painterState="N",this._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:{id:"painter",icon:"brush-block"}}),this._painterEnabled=!0;break;case"painter-available":this._painterState="A",this._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:{id:"painter",icon:"brush"}}),this._painterEnabled=!0;break;case"painter-default":this._painterState="D",this._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:{id:"painter",icon:"brush-favorite"}}),this._painterEnabled=!0;break;case"painter-selected":this._painterState="S",this._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:{id:"painter",icon:"brush-ok"}}),this._painterEnabled=!0;break;case"painter-none":default:this._painterState="A",this._painterEnabled=!1;break;case"large":this._setColumnWidth(600);break;case"medium":this._setColumnWidth(400);break;case"small":this._setColumnWidth(200);break;case"display-all-combination":this.resetFilter();break;case"filter-invalid-column":this.filterInvalidColumn()}},j.prototype._setColumnWidth=function(e){for(var t=0;t<this._dataGridView.columns.length;t++)this._dataGridView.layout.setColumnWidth(t,e)},j.prototype._handleKeyEvent=function(){var e=this;this._dataGridView.addEventListener("keydown",(t=>{if(t.ctrlKey){var i=this._dataGridView.getPreselectedCellID();if(void 0!==i){var n=document.querySelector(`.wux-layouts-datagridview-cell[cell-id='${i}']`),a=null===n?null:n.getElement(".cell-value");null!==a&&!a.hasAttribute("disabled")?(this._container.addClassName("selection-mode"),e._cellTooltip.hide()):this._container.removeClassName("selection-mode")}}})),this._dataGridView.addEventListener("keyup",(t=>{"Control"===t.key?this._container.removeClassName("selection-mode"):"c"===t.key.toLowerCase()&&t.ctrlKey&&e.copiedToClipboard&&(C.showSuccess(f.CopiedToClipboard),e.copiedToClipboard=!1)}))},j.prototype._buildTable=function(){this._resizableTableModel=this._createResizableModel(),this._resizableTableModel.columns&&this._resizableTableModel.columns.length>0&&(this.lengthHeader=this._resizableTableModel.title_columns.length,this._initTreeModel(),this._insertDataNodes(),this._createDatagrid(),this._handleKeyEvent(),this._initDivs(),this._refreshed=!0,this._dataGridView&&this._dataGridView.treeDocument&&this._dataGridView.treeDocument.expandAll()),this._initComments(!0)},j.prototype._createResizableModel=function(){var e={lines:[],columns:[],title_columns:[],linesColumns:[]};this._jsonModel=this._matrixModel.getJsonModel(),this._mapDico=this._matrixModel._mapDico;for(var t=this._jsonModel.drivingCriteria,i=[],n=0;n<t.length;n++){var a=this._mapDico[t[n].id],o={};o.id=t[n].id,o.value=a.title,e.title_columns.push(o)}if(void 0!==this._jsonModel.drivingCombinationValues[0])for(var r in this._jsonModel.drivingCombinationValues[0])for(var s=0;s<e.title_columns.length;s++)e.title_columns[s].id===r&&i.push(s);for(var l=0;l<this._jsonModel.drivingCombinationValues.length;l+=1){var d=new Array(this._jsonModel.drivingCriteria.length),c=new Array(this._jsonModel.drivingCriteria.length),u=0;for(var h in this._jsonModel.drivingCombinationValues[l]){a=this._mapDico[this._jsonModel.drivingCombinationValues[l][h].variantValue];d.splice(i[u],1,a.title),a.id=this._jsonModel.drivingCombinationValues[l][h].variantValue,c.splice(i[u],1,a),u++}e.columns.push(d),e.linesColumns.push(c)}for(l=0;l<this._jsonModel.constrainedCriteria.length;l+=1){var p={};p.id=this._jsonModel.constrainedCriteria[l].id;a=this._mapDico[p.id];p.id=a.title,p.type=a.type,p.idparent=a.parent,p.idparent?p.value=this._mapDico[p.idparent].title:p.value=a.title,p.seqNumber=a.seqNumber,e.lines.push(p)}return e},j.prototype._initDivs=function(){this._container||(this._container=document.createElement("div"),this._container.classList.add("matrui-table-presenter")),this._dataGridView.inject(this._container),this._dataGridView.layout.postRender()},j.prototype.inject=function(e){e.appendChild(this._container)},j.prototype.destroy=function(){this._container="",this._myEventManager&&(this._myEventManager.cleanup("MatruiTablePresenter"),this._myEventManager=null),this._stopAsyncRecursiveCallSolver(),this.observer&&this.observer.disconnect(),this._cellTooltip.destroy(),_.resetDGV(this._ruleId)},j.prototype._initTreeModel=function(){var e=this._jsonModel.drivingCombinationValues?this._jsonModel.drivingCombinationValues.length:0,t=this._jsonModel.constrainedValues?this._jsonModel.constrainedValues.length:0,i=this.lengthHeader;this.allData=[];for(var n=0;n<t;n++){for(var a={},o=0;o<e;o++)a["col"+o+i]={state:this._jsonModel.states[o][n],stateValidity:this._jsonModel.statesValidity[o][n]||"V",flatIndexRowID:n};this.allData.push(a)}},j.prototype._insertDataNodes=function(){this._dataModelSet=new s,this._treeDocumentModel=new a({useAsyncPreExpand:!0,dataModelSet:this._dataModelSet}),this._treeDocumentModel.prepareUpdate();for(var e=0;e<this._jsonModel.constrainedCriteria.length;e++){var t;!this._mapDico[this._jsonModel.constrainedCriteria[e].id]||"variant"!==this._mapDico[this._jsonModel.constrainedCriteria[e].id].type&&"variability_group"!==this._mapDico[this._jsonModel.constrainedCriteria[e].id].type||(t=n.createTreeNodeDataModel(this._dataModelSet,{label:this._mapDico[this._jsonModel.constrainedCriteria[e].id].title,icons:this._mapDico[this._jsonModel.constrainedCriteria[e].id].image?[this._mapDico[this._jsonModel.constrainedCriteria[e].id].image]:[],grid:{},id:this._jsonModel.constrainedCriteria[e].id}),this._treeDocumentModel.addChild(t));for(var i=0;i<this._jsonModel.constrainedValues.length;i++){var o=this._jsonModel.constrainedValues[i].id,r=this.allData[i];this._dataModelSet.createDataModel(r),this._mapDico[this._jsonModel.constrainedValues[i].id]&&this._jsonModel.constrainedCriteria[e].id===this._mapDico[this._jsonModel.constrainedValues[i].id].parent&&t.addChild({label:this._mapDico[o].title,icons:this._mapDico[o].image?[this._mapDico[o].image]:[],grid:this.allData[i],id:o}),this._jsonModel.constrainedCriteria[e].id===this._jsonModel.constrainedValues[i].id&&this._treeDocumentModel.addChild({label:this._mapDico[o].title,icons:this._mapDico[o].image?[this._mapDico[o].image]:[],grid:this.allData[i],id:o})}t&&t.setState({state:"expanded"})}this._treeDocumentModel.pushUpdate()},j.prototype._updateTooltip=function(e,t,i=!1){var n=this;if(n._cellTooltip.target=e,void 0!==t.nodeModel._options.grid["col"+(t.columnID-1)+n.lengthHeader]){var a=t.nodeModel._options.grid["col"+(t.columnID-1)+n.lengthHeader].flatIndexRowID;if(t.columnID>=0&&t.rowID>=0){var o=n._matrixModel.getMiniJsonModel(t.columnID-1);o._clientData.rowID=a,o._clientData.treeRowID=t.rowID;var r="";if(o.states[0])for(var s=0;s<o.states[0].length;s++)r+=s===a?"Y":"N";o.statesCauses=[r],o.isDefaultValue="D"===n._jsonModel.states[t.columnID-1][a];var l={states:o.states[0][a],statesValidity:o.statesValidity[0][a]},d=n._dataGridView.getPreselectedCellID();n.currentPreSelectedCellID=d,n.updateTooltipAndShow(l,a,e,o,i)}}else!0===n._cellTooltip.visibleFlag&&n._cellTooltip.hide()},j.prototype.getCausingRules=function(t,i){var n=this;n._privateChannel.publish({event:"show-loading-conflict-right-panel"}),t.getElement(".conflict")?(i._clientData.isConflict=!0,i.runtimeCauseComputation="yes",i.buildtimeCheckLevel="statesValidity",i.buildtimeCauseComputation="yes",n._callSolverToAbort().then((function(){n._callSolverConflict(i)}),(function(){e.log('Error "abort" solver matruiTablePresenter')}))):(i.runtimeCauseComputation="yes",n._callSolverToAbort().then((function(){n._callSolverConstraint(i)}),(function(){e.log('Error "abort" solver matruiTablePresenter')})))},j.prototype.getConstraintFrom=function(e){switch(e){case"SA":case"ST":case"SI":case"DI":case"DT":case"DA":case"NE":case"NR":case"NU":case"AC":case"SC":case"DC":case"NC":return A.conflict;case"DU":case"SU":case"AU":case"DR":case"DE":case"AR":case"AE":case"SR":case"SE":return A.required;case"NA":case"NT":case"NI":case"AA":case"AT":case"AI":return A.incompatible;case"AD":return A.default;default:return""}},j.prototype.showTooltip=function(){document.querySelector(".wux-controls-combobox-popup")||this._cellTooltip.show()},j.prototype.handleConstraint=function(t,i,n,a){var o=this,r=e.String.format(f.ReasonString,t);o.tooltipText=r;var s="<a class=clickable>"+f.ShowCausingRules+"</a>",l=function(){o.getCausingRules(i,n)};(a?l():o._cellTooltip.setBody(r+s),1!==document.getElementsByClassName("wux-controls-combobox-popup").length&&o._dataGridView.getPreselectedCellID()===o.currentPreSelectedCellID)&&(o._cellTooltip.elements.container.getElement("a").addEventListener("click",(()=>{l()})),o.showTooltip())},j.prototype.handleEmptyConstraint=function(e){this._cellTooltip.setBody(R[e]),this.showTooltip()},j.prototype.handleIncompatibleValue=function(t,i){for(var n,a,o=this,r=o._mapDico[i.constrainedValues[t].id].parent,s=0,l=0;l<i.constrainedCriteria.length;l++){if(i.constrainedCriteria[l].id===r){a=i.constrainedCriteria[l].selectedValues.map((e=>e.id));break}s+=i.constrainedCriteria[l].selectedValues.length}if(o._mapDico[r].values&&a.length===o._mapDico[r].values.length){for(var d=0,c=0;c<a.length;c++){if(i.constrainedValues[t].id!==a[c])if(0===d&&o._mapDico[r].values.includes(a[c])&&"S"===i.states[0].charAt(s))d++;else if(o._mapDico[r].values.includes(a[c])&&"A"!==i.states[0].charAt(s))return!1;s++}if(1===d)return n=e.String.format(f.ReasonString,A.incompatible),n+=f.variantSelectedValue,o._cellTooltip.setBody(n),o.showTooltip(),!0}return!1},j.prototype.handleDefaultValue=function(t,i){var n,a=this;return!!a._mapDico[i.constrainedValues[t].id].default&&(n=e.String.format(f.ReasonString,A.default),n+=f.EntDefaultValue,a._cellTooltip.setBody(n),a.showTooltip(),!0)},j.prototype.handleMandatoryVariant=function(t,i,n){var a,o,r=this,s=r._mapDico[n.constrainedValues[i].id].parent,l=0;if(this._mapDico[s].mandatory){for(var d=0;d<n.constrainedCriteria.length;d++){if(n.constrainedCriteria[d].id===s){o=n.constrainedCriteria[d].selectedValues.map((e=>e.id));break}l+=n.constrainedCriteria[d].selectedValues.length}if(o.length===r._mapDico[s].values.length){for(var c=0;c<o.length;c++){if(t&&n.constrainedValues[i].id===o[c]);else if(!r._mapDico[s].values.includes(o[c])||"N"!==n.states[0].charAt(l))return!1;l++}return t?(a=e.String.format(f.ReasonString,A.required),a+=f.mandatoryVariantRequiredValue):(a=e.String.format(f.ReasonString,A.conflict),a+=f.mandatoryVariant),r._cellTooltip.setBody(a),r.showTooltip(),!0}}return!1},j.prototype.updateTooltipAndShow=function(e,t,i,n,a){var o=this,r=o.getConstraintFrom(e.states+e.statesValidity);if(""===r)o.handleEmptyConstraint(e.states);else{var s;switch(r){case A.conflict:"N"===e.states&&(s=o.handleMandatoryVariant(!1,t,n));break;case A.required:"A"!==e.states&&"N"!==e.states&&"D"!==e.states||(s=o.handleMandatoryVariant(!0,t,n));break;case A.incompatible:"A"===e.states&&(s=o.handleIncompatibleValue(t,n));break;case A.default:"A"!==e.states&&"N"!==e.states||(s=o.handleDefaultValue(t,n))}if(s)return;o.handleConstraint(r,i,n,a)}},j.prototype._createDatagrid=function(){var t=this,n=i.SETTINGS.STANDARD;delete n.height,n.columns=[],n.treeDocument=this._treeDocumentModel,n.selectionMode="cell",n.defaultColumnDef={minWidth:40,editableFlag:!0,resizableFlag:!0,sortableFlag:!0,allowUnsafeHTMLContent:!1};for(var a=this._jsonModel.drivingCombinationValues?this._jsonModel.drivingCombinationValues.length:0,o=this.lengthHeader,r=[],s={},c=this.lengthHeader;c>-1;c-=1)s=c<this.lengthHeader?{text:this._resizableTableModel.title_columns[c].value,dataIndex:"colTree"+c,children:[s],editableFlag:!1}:{text:f.ConstrainedCriteria,dataIndex:"tree",pinned:"left",width:"150px",editableFlag:!1,cellSelection:"none",typeRepresentation:D,compareFunction:function(e,t){var i=Object.values(this._mapDico).map((e=>({title:e.title,seqNumber:e.seqNumber})));if("integer"===D){for(var n,a,o=0;o<i.length;o++){if((l=i[o]).title===e&&(n=l.seqNumber),l.title===t&&(a=l.seqNumber),void 0!==n&&void 0!==a)break}if(void 0!==n&&void 0!==a)return n-a}else if("string"===D){var r,s;for(o=0;o<i.length;o++){var l;if((l=i[o]).title===e&&(r=l.title),l.title===t&&(s=l.title),void 0!==r&&void 0!==s)break}if(void 0!==r&&void 0!==s)return r.localeCompare(s)}return 0}.bind(this)};r.push(s),this.mappingData=[];for(var u=0;u<a;u+=1){s={};for(var h=o;h>-1;h-=1)if(h<o)this.mappingData.push({dataIndex:"col"+u+h,columnID:u+1,rowID:-(o-h)-1,text:this._resizableTableModel.columns[u][h],idObject:this._resizableTableModel.linesColumns[u][h].id}),s={text:this._resizableTableModel.columns[u][h],dataIndex:"col"+u+h,seqNumber:this._resizableTableModel.linesColumns[u][h].seqNumber,children:[s]};else{var p,m=[],v="";for(var C in t._jsonModel.drivingCombinationValues[u])t._jsonModel.drivingCombinationValues[u].hasOwnProperty(C)&&(p=t._jsonModel.drivingCombinationValues[u][C].variantValue,m.push(p),v+=""===v?"":", ",v+=t._mapDico[p].title);m.sort(),s={text:"",dataIndex:m.toString()+"-"+v,typeRepresentation:"Compare"===t.context?"urlBlock":"matrixRuleCellTweaker",editableFlag:"Compare"!==t.context&&t._editable,getCellValue:function(e){var i=e.columnID-1,n=e.nodeModel._options.grid["col"+i+t.lengthHeader];if(n){let a=n.flatIndexRowID;if(t._invalidColumns&&t._invalidColumns.includes(i))return{state:t._jsonModel.states[i].charAt(a),isNonEditableCell:!0,isPainterModeEnabled:t._painterEnabled,hasComment:_.hasOpenedCommentThread(t._ruleId,e)};if(void 0!==e.nodeModel._options.grid["col"+i+t.lengthHeader])return"Compare"===t.context?t._createCompareView(t._jsonModel.states[i][a]):{state:t._jsonModel.states[i].charAt(a),stateValidity:t._jsonModel.statesValidity[i].charAt(a),isPainterModeEnabled:t._painterEnabled,hasComment:_.hasOpenedCommentThread(t._ruleId,e),isNonEditableCell:!t._editable}}return{isParentCell:!0,isNonEditableCell:!0,isPainterModeEnabled:t._painterEnabled}},setCellValue:function(i,n){var a=i.columnID-1;if(i.nodeModel._options.grid["col"+a+t.lengthHeader]){for(var o=i.nodeModel._options.grid["col"+a+t.lengthHeader].flatIndexRowID,r=n.state,s=0;s<t._jsonModel.constrainedValues.length;s+=1)s!==o&&"option"!==t._mapDico[t._jsonModel.constrainedValues[s].id].type&&t._mapDico[t._jsonModel.constrainedValues[s].id].parent&&t._mapDico[t._jsonModel.constrainedValues[s].id].parent===t._mapDico[t._jsonModel.constrainedValues[o].id].parent&&("S"===r?t._matrixModel.setStateWithID(a,s,"N"):"D"!==r||"S"!==t._matrixModel.__jsonModel.states[a][s]&&"D"!==t._matrixModel.__jsonModel.states[a][s]||t._matrixModel.setStateWithID(a,s,"A"),"A"===r&&"S"===t._matrixModel.__jsonModel.states[a][s]&&(r="N"));t._matrixModel.setStateWithID(a,o,r),t._matrixModel.setTimerIDForColumnID(a);var l=t._matrixModel.getMiniJsonModel(a);l.check="runtime",d.mask(e.extendElement(t._container)),t._updateColumnCombination(l),t._privateChannel.publish({event:"mr-model-change",data:""})}},getCellValueForCopy:e=>{if(e.cellModel.state)return t.copiedToClipboard=!0,e.cellModel.state},processCellValueFromPaste:(e,t)=>({state:t}),getCellClassName:function(e){var i=e.columnID-1;if("I"===t._jsonModel.drivingCombinationsValidity[i])return t._invalidColumns.push(i),"invalid-column-cell";t._invalidColumns&&t._invalidColumns.includes(i)&&(t._invalidColumns=t._invalidColumns.filter((e=>e!==i)))},getCellTooltip:function(e){var i=e.columnID-1;if(e.rowID+t.lengthHeader<=0&&"I"===t._jsonModel.drivingCombinationsValidity[i])return{shortHelp:f.tooltip_invalid_column}}}}r.push(s)}n.columns=r,n.showOutlineFlag=!0,this._dataGridView=new l(n),this._dataGridView.onReady((function(){t._stopRecursiveCall=!1,t._checkAllConflictMatrix(t._matrixModel),"Compare"===t.context&&t._addStyleToCompareCells()})),"Compare"!==this.context&&this._dataGridView.buildStatusBar([{type:1},{type:0,id:"totalColumn",dataElements:{typeRepresentation:"string",value:f.Total_Columns+" : "+(this._jsonModel.drivingCombinationValues.length+1),displayLabel:!0}},{type:0,id:"nbConflict",dataElements:{typeRepresentation:"string"}},{type:0,id:"invalidColumn",dataElements:{typeRepresentation:"string",displayLabel:!0}},{type:0,id:"statusConflict",dataElements:{position:"far",typeRepresentation:"string",value:f.Conflicts_Computing+" : 0%",displayLabel:!0,icon:"clock"}},{type:0,id:"statusSuggestion",dataElements:{position:"far",typeRepresentation:"string",value:f.Constraints_Computing+" : 0%",displayLabel:!0,icon:"clock"}}]),this._dataGridView.columnDragEnabledFlag=!1,this._dataGridView.columns[0].sortableFlag=!0,this._dataGridView.columns[0].editableFlag=!1,this._dataGridView.showRowBorderFlag=!0,this._dataGridView.layout.rowsHeader=!1,this._dataGridView.layout.cellHeight=36,this._dataGridView.onContextualEvent=function(e){var i=e.cellInfos;if(w=e&&e.cellInfos&&void 0!==e.cellInfos.rowID?e.cellInfos.rowID:null,i&&i.rowID<=-1){if(!(i.columnID>0))return t.createMenuVariant(i);if(t._editable)return t.createMenuValue(i)}return[]},this._dataGridView.addEventListener("click",(function(e,i){if(i&&i.rowID<-1&&e.target.classList.contains("wux-ui-3ds-help")){var n=i.columnID;t.arrColumnAfterSort&&t.arrColumnAfterSort.length>0&&(n=t.arrColumnAfterSort[n-1].columnID);var a=t._matrixModel.getMiniJsonModel(n-1);a._clientData.rowID=i.rowID,t._callSolverDrivingCombCause(a)}}));var g=this._dataGridView.getTypeRepresentationFactory();if(g.registerTypeTemplates({matrixRuleCellTemplate:{path:"DS/CfgRuleMatrixComponent/Runtime/MatrixRuleCellTweaker"}}),g.registerTypeRepresentations({matrixRuleCellTweaker:{stdTemplate:"matrixRuleCellTemplate",semantics:{}}}),this.notVisibleColumns=[],this.notVisibleColumns=this.removeDuplicateFilterValues(this.filterBy),this.notVisibleColumns=this.removeDuplicateFilterValues(this.headerFilter),this._dataGridView.treeDocument.subscribe({event:"update-tooltip"},(function(e){t._updateTooltip(e.data.target,e.data.context)})),this._dataGridView.treeDocument.subscribe({event:"painter-cell-click"},(function(e){t._setCellValueWithPainter(e.data.target,e.data.context)})),this.updateCountColumn(this._jsonModel.drivingCombinationValues.length+1-(this.invalidFilter.length+this.notVisibleColumns.length)),this.invalidFilter.length>0)this.updateCountInvalidColumn(this.invalidFilter.length);else{var b;b=this.notVisibleColumns.filter((e=>this.invalidColumn.includes(e))),this.updateCountInvalidColumn(b.length)}this.updateDataGridVisibleColumn(this.filterBy,this.invalidFilter),this.updateDataGridVisibleColumn(this.headerFilter,this.invalidFilter),this._dataGridView.elements.container.addEventListener("mouseleave",(function(e){e.relatedTarget!==t._cellTooltip.elements.container&&t._cellTooltip.hide()}))},j.prototype._setCellValueWithPainter=function(e,t){var i=this;t&&t.cellModel&&t.columnID>0&&t.rowID>=0&&t.nodeModel&&t.nodeModel._options.grid["col"+(t.columnID-1)+i.lengthHeader]&&"I"!==t.cellModel.drivingCombinationsValidity&&i._dataGridView.setModelAt(t.cellID,{state:i._painterState,stateValidity:"V"})},j.prototype._addStyleToCompareCells=function(){var e;document.querySelectorAll(".wux-tweakers-string-pipe").forEach((t=>{(e=t.getParent().getElements(".wux-tweakers-string-icon"))[0].addClassName("leftOnly"),e[1].addClassName("rightOnly")}))},j.prototype._createCompareView=function(e){if(1===e.length)return{icon:T[e]};if(e.length>1){var t=e,i=t[0],n=t[1];return[{icon:T[i]},{icon:T[n]}]}},j.prototype.getView=function(){return this._dataGridView},j.prototype._updateColumnCombination=function(e){var t=this,i=e;t._stopAsyncRecursiveCallSolver(),this._callSolverToAbort().then((function(){t._callSolverConflict(i,!0).then((function(){t._callSolverConstraint(i,!0).then((function(){var e=t._matrixModel.getMiniJsonModel(t.columnNumber);t._stopRecursiveCall=!1,t.checkAllConflictDone?t._recursiveCheckSuggestionMatrixModel(e,t.columnNumber):t._recursiveCheckConflictMatrixModel(e,t.columnNumber)}),(function(e){console.error(e)}))}),(function(e){console.error(e)}))}),(function(e){console.error(e)}))},j.prototype._restartMatrixSolverCall=function(){var e=this;this._privateChannel.publish({event:"reset-loading-status-bar"}),e._stopRecursiveCall=!0,e._callSolverToAbort().then((function(){e._stopRecursiveCall=!1,e._checkAllConflictMatrix(e._matrixModel)}),(function(){console.log('Error "abort" solver matruiTablePresenter')}))},j.prototype._checkAllConflictMatrix=function(e){var t=e.getMiniJsonModel(0);this.conflictColumn={},this.checkAllConflictDone=!1,this.invalidColumn=[],this._privateChannel.publish({event:"enox-collection-toolbar-disable-action",data:"filter-invalid-column"}),this._recursiveCheckConflictMatrixModel(t)},j.prototype._checkAllSuggestionMatrix=function(e){var t=e.getMiniJsonModel(0);this._recursiveCheckSuggestionMatrixModel(t)},j.prototype._recursiveCheckConflictMatrixModel=function(e,t){var i=this;"Compare"!==i.context&&(this.columnNumber=t||0,e&&this._callSolverConflict(e,!0).then((function(){if(i.columnNumber++,i._updateLoadingStatus(i.columnNumber,"conflict"),!1===i._stopRecursiveCall){var e=i._matrixModel.getMiniJsonModel(i.columnNumber);e?setTimeout(i._recursiveCheckConflictMatrixModel(e,i.columnNumber),10):(i.checkAllConflictDone=!0,i._checkAllSuggestionMatrix(i._matrixModel))}}),(function(e){console.error("Error _callSolverConflict _recursiveCheckConflictMatrixModel"),console.error(e)})))},j.prototype._recursiveCheckSuggestionMatrixModel=function(e,t){var i=this;this.columnNumber=t||0,e&&this._callSolverConstraint(e,!0).then((function(){if(i.columnNumber++,i.columnNumber<=i._matrixModel.getNumberCombination()&&i._updateLoadingStatus(i.columnNumber,"suggestion"),!1===i._stopRecursiveCall){var e=i._matrixModel.getMiniJsonModel(i.columnNumber);e&&setTimeout(i._recursiveCheckSuggestionMatrixModel(e,i.columnNumber),10)}i.columnNumber===i._matrixModel.getNumberCombination()&&i._privateChannel.publish({event:"enox-collection-toolbar-enable-action",data:"filter-invalid-column"})}),(function(){console.log("[_recursiveCheckSuggestionMatrixModel : _callSolverConstraint] failed/rejected!")}))},j.prototype._callSolverToAbort=function(){return r.abortSolverCall(this._solverKey,this._solverModelEvent)},j.prototype._callSolverConflict=function(e,t){return r.callSolveForRulesCheckConflict(e,this._solverKey,this._solverModelEvent,t)},j.prototype._callSolverConstraint=function(e,t){return r.callSolveForRulesCheckSuggestion(e,this._solverKey,this._solverModelEvent,t)},j.prototype._callSolverDrivingCombCause=function(e){return r.callSolveForCausingDrivingComb(e,this._solverKey,this._solverModelEvent)},j.prototype.update=function(t,i){var n=this,a=e.is(t.columnID,"number")&&t.columnID>=0?t.columnID+1:0;if(a&&this._dataGridView&&n._dataGridView.treeDocument){this._dataGridView.prepareUpdateView(),this.countInvalidColumn(a,i);t=n._dataGridView.layout.getDataIndexFromColumnIndex(a);this._dataGridView.updateRenderedColumn(a,{updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1}),d.unmask(e.extendElement(n._container)),this._dataGridView.pushUpdateView(),this.countConflict(a,n._jsonModel)}else this._container.innerHTML="",this._buildTable(),n._container&&d.unmask(e.extendElement(n._container))},j.prototype.refresh=function(){this._container.innerHTML="",this.arrColumnAfterSort=[],this._mapDico=this._matrixModel._mapDico,this._jsonModel=this._matrixModel.getJsonModel(),this._matrixModel.drivingCombinationsChanged()&&this.resetFilter(),this._matrixModel.updateJsonModel(),this._jsonModel.states&&this._jsonModel.states.length>0&&(this._buildTable(),this._refreshed=!0)},j.prototype._stopAsyncRecursiveCallSolver=function(){this._stopRecursiveCall=!0},j.prototype.createMenuVariant=function(e){var t=[];t.push({type:"PushItem",title:f.Sort_By,submenu:this.createMenuItemSort(e)});var i=[],n={};if(-1===e.rowID)for(var a=0;a<this._resizableTableModel.lines.length;a++){n[(r=this._resizableTableModel.lines[a]).idparent]||(n[r.idparent]=new Set),n[r.idparent].has(r.value)||(n[r.idparent].add(r.value),i.push(r))}else if(this._resizableTableModel.linesColumns)for(a=0;a<this._resizableTableModel.linesColumns.length;a++){for(var o=!1,r=this._resizableTableModel.linesColumns[a][this._resizableTableModel.linesColumns[a].length+(e.rowID+1)],s=0;s<i.length;s++)if(i[s].id===r.id){o=!0;break}o||i.push(r)}return t.push({type:"RadioItem",title:f.Filter,action:{callback:function(){this._createFilterUI()}.bind(this)}}),this.lineHeader1=i,t},j.prototype.createMenuValue=function(e){var t=[];return t.push({type:"PushItem",title:f.SetColumn,submenu:this.createMenuItemSetColumn(e)}),t},j.prototype.createMenuItemFilter=function(e,t){for(var i=[],n=0;n<e.length;n++){if(this.filterBy.length>0)for(var a=0;a<this.filterBy.length;a++){if(this.filterBy[a].id===e[n].id){o=void 0;break}o={family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-check"}}else var o={family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-check"};i.push({type:"PushItem",title:e[n].title?e[n].title:e[n].value,fonticon:o,visible:!0,action:{callback:function(e){this.filterColumn(e.context.item.id,e.context.row)}.bind(this),context:{item:e[n],row:t}}})}return i},j.prototype.createMenuItemSort=function(e){var t=this,i=[],n=[],a=[];return n.push({type:"RadioItem",title:f.ASC,state:"",action:{callback:function(){this.sortColumn(e,"asc","text"),this.removeAllIconSortHeader(),e.cellView.elements.container.setAttribute("sort-direction","asc"),e.cellView.elements.container.setAttribute("type-representation","string")}.bind(t),context:{}}}),n.push({type:"RadioItem",title:f.DESC,state:"",action:{callback:function(){this.sortColumn(e,"desc","text"),this.removeAllIconSortHeader(),e.cellView.elements.container.setAttribute("sort-direction","desc"),e.cellView.elements.container.setAttribute("type-representation","string")}.bind(t),context:{}}}),a.push({type:"RadioItem",title:f.ASC,state:"",action:{callback:function(){e.cellModel===f.ConstrainedCriteria?this.sortRows(t.lineHeader1,"asc","integer"):this.sortColumn(e,"asc","integer"),this.removeAllIconSortHeader(),e.cellView.elements.container.setAttribute("sort-direction","asc"),e.cellView.elements.container.removeAttribute("type-representation","string")}.bind(t)}}),a.push({type:"RadioItem",title:f.DESC,state:"",action:{callback:function(){e.cellModel===f.ConstrainedCriteria?this.sortRows(t.lineHeader1,"desc","integer"):this.sortColumn(e,"desc","integer"),this.removeAllIconSortHeader(),e.cellView.elements.container.setAttribute("sort-direction","desc"),e.cellView.elements.container.removeAttribute("type-representation","string")}.bind(t)}}),i.push({type:e.cellModel===f.ConstrainedCriteria?"RadioItem":"PushItem",title:f.SeqNumber,submenu:e.cellModel!==f.ConstrainedCriteria?a:void 0,action:{callback:function(){D="integer",e.cellModel===f.ConstrainedCriteria||this.sortColumn(e,"asc","integer"),this.removeAllIconSortHeader(),e.cellView.elements.container.setAttribute("sort-direction","asc"),e.cellView.elements.container.removeAttribute("type-representation","string")}.bind(t)}}),i.push({type:e.cellModel===f.ConstrainedCriteria?"RadioItem":"PushItem",title:f.Title,submenu:e.cellModel!==f.ConstrainedCriteria?a:void 0,action:{callback:function(){D="string",e.cellModel===f.ConstrainedCriteria||this.sortColumn(e,"asc","integer"),this.removeAllIconSortHeader(),e.cellView.elements.container.setAttribute("sort-direction","asc"),e.cellView.elements.container.removeAttribute("type-representation","string")}.bind(t)}}),i},j.prototype.createMenuItemSetColumn=function(e){var t=this,i=[];return i.push({type:"PushItem",title:f.NA,state:t.invalidColumn.includes(e.columnID)?"disabled":"enabled",action:{callback:function(t){if(e&&e.columnID>0&&e.rowID<0){t.context.object.setColumnTo(e,"N")}},context:{object:this}}}),i.push({type:"PushItem",title:f.Available,state:t.invalidColumn.includes(e.columnID)?"disabled":"enabled",action:{callback:function(i){(t=i.context.object).setColumnTo(e,"A")},context:{object:this}}}),i},j.prototype.getStableColumnId=function(e){for(var t=!1,i=this._dataGridView.layout.getColumnOrGroupFromCoordinates(e);!t;)i.children?i=i.children[0]:t=!0;return this._dataGridView.layout.getColumnIndex(i.dataIndex)},j.prototype.setColumnTo=function(t,i){var n=this.getStableColumnId(t);this._matrixModel.__jsonModel.states[n-1]=i.repeat(this._matrixModel.__jsonModel.states[n-1].length);var a=this._matrixModel.getMiniJsonModel(n-1);a.check="runtime",d.mask(e.extendElement(this._container)),this._updateColumnCombination(a),this._privateChannel.publish({event:"mr-model-change",data:""})},j.prototype.sortColumn=function(t,i,n){for(var a=[],o=this._dataGridView.layout.getLeafColumns().length,r=1;r<o;r++)a.push(e.merge({columnID:this._dataGridView.layout.getOrderedColumnsIndexes()[r]},this._dataGridView.layout.getColumnOrGroupFromCoordinates({rowID:t.rowID,columnID:r})));this.invalidColumn&&this.invalidColumn.length>0&&(this.invalidColumn=[]);var s=this.bubbleSort(a,i,n);this.arrColumnAfterSort=s,this._dataGridView.prepareUpdateView();for(var l=0;l<s.length;l++)this._dataGridView.layout.moveColumn(s[l].columnID,this._dataGridView.layout.getOrderedColumnsIndexes()[l+1]),s[l].icon&&this.invalidColumn.push(l+1);this._dataGridView.pushUpdateView({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1})},j.prototype.filterRow=function(e){const t=this._treeDocumentModel.getRoots();if(null===e||0===Object.keys(e).length)return t.forEach((e=>{e.isHidden()&&e.show();const t=e.getChildren();t&&t.length>0&&t.forEach((e=>{e.isHidden()&&e.show()}))})),null;for(let e=0;e<b.length;e++){const i=b[e],n=i.options&&i.options.label;n&&t.forEach((e=>{e.getChildren().forEach((t=>{t&&t.options&&t.options.label===n&&("function"==typeof t.isHidden&&t.isHidden()&&t.show(),e&&"function"==typeof e.isHidden&&e.isHidden()&&e.show())}))}))}const i="option"===e.type||"value"===e.type;return t.forEach((t=>{if(i){t.getChildren().forEach((t=>{t.options&&t.options.label===e.title&&t.hide()}))}else t.options&&t.options.label===e&&t.hide()})),null},j.prototype.handleItemCountChange=function(){let e=y&&y.length>0||M&&M.length>0||V&&V.length>0||this.invalidFilter&&this.invalidFilter.length>0;e!==this.isFilterApplied&&(this.isFilterApplied=e,this._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:{id:"filter-column",icon:"list-filter"}}))},j.prototype._createFilterUI=function(){let e={missingunChildren:[],missingunParent:[],missingunCriteria:[]};Array.isArray(y)&&y.length>0&&y.forEach((t=>{e.missingunChildren.push({title:t.title,type:t.type,parent:t.parent,name:t.name})})),M&&e.missingunParent.push({title:M,value:M}),V&&e.missingunCriteria.push({title:V,value:V});const t={};Object.values(this._mapDico).forEach((e=>{t[e.parent]||(t[e.parent]=[]),t[e.parent].some((t=>t.name===e.name&&t.title===e.title))||t[e.parent].push(e)}));const i=[],o=[];this._jsonModel.constrainedCriteria.forEach((e=>{const n=e.id,a=e.selectedValues||[],o=this._mapDico[n];if(!o)return;const r=o.title||`Unnamed Parent (${n})`,s=o.seqNumber||0,l=t[n]||[],d=a.map((e=>{const t=this._mapDico[e.id];return{title:t?t.title:`Unnamed Value (${e.id})`,value:t||{id:e.id}}})),c=new Set(d.map((e=>e.title))),u={seqNumber:s,parent:r,children:l.filter((e=>c.has(e.title))).map((e=>({title:e.title||`Unnamed Child (${e.id})`,value:e}))),selectedValues:d};i.push(u)})),this._jsonModel.drivingCriteria.forEach((e=>{const i=e.id,n=e.selectedValues||[],a=this._mapDico[i];if(!a)return;const r=a.title||`Unnamed Parent (${i})`,s=a.seqNumber,l=t[i]||[],d=n.map((e=>{const t=this._mapDico[e.id];return{title:t?t.title:`Unnamed Value (${e.id})`,value:t||{id:e.id}}})),c=new Set(d.map((e=>e.title))),u={seqNumber:s,parent:r,children:l.filter((e=>c.has(e.title))).map((e=>({title:e.title||`Unnamed Child (${e.id})`,value:e}))),selectedValues:n};o.push(u)}));let r=(t,i)=>{var o=new a({shouldSelectDescendants:function(){return!0},shouldUnselectDescendants:function(){return!0},shouldSelectParents:function(){return!0},shouldUnselectParents:function(e){if(!(e&&e.__trueRoot&&e.__trueRoot._options&&e.__trueRoot._options.children))return!1;var t=e.getParent(),i=0;if(t.options&&t.options.children)for(let e=0;e<t.options.children.length;e++){let n=t.options.children[e];!0===n._isSelected&&i++,!0===n._isHidden&&i++}return 1===i}});return o.prepareUpdate(),t.forEach((e=>{let t=e.parent,a=e.selectedValues||[];"driving"===i?t=`Driving - ${t}`:"constrained"===i&&(t=`Constrained - ${t}`);var r=new n({label:t,value:a,grid:{title:t,SequenceNumber:e.seqNumber}});e.children.forEach((e=>{var t=new n({label:e.title,value:e.value,grid:{title:e.title,SequenceNumber:e.value.seqNumber}});r.addChild(t)})),o.addRoot(r)})),o.expandAll(),o.pushUpdate(),o.selectAll(),this._refreshed?(s(),this._refreshed=!1):s(o,e),o};function s(e,t){if(!e||!t)return;const i=e.getRoots(),n=[],a=[];return t.missingunChildren&&t.missingunChildren.length>0&&t.missingunChildren.forEach((e=>{for(let t=0;t<i.length;t++){const o=i[t].getChildren();if(o&&0!==o.length)for(let t=0;t<o.length;t++){const i=o[t];i.options&&i.options.label===e.title?(i.unselect(),a.push(i.options.label),missingChildrenCount++):n.push(i.options.label)}}})),t.missingunCriteria&&t.missingunCriteria.length>0&&t.missingunCriteria.forEach((e=>{let t=[];Array.isArray(e.title)?t=e.title:"object"==typeof e.title?t=Object.values(e.title):t.push(e.title);for(let e=0;e<i.length;e++){const o=i[e].getChildren();if(o&&o.length>0)for(let e=0;e<o.length;e++){const i=o[e];if(i._options&&i._options.value){const o=i._options.value;t.forEach((t=>{o.id===t?(i.unselect(e),a.push(o.id)):n.push(o.id)}))}}}})),{selectedValues:n,unselectedValues:a}}function d(e,t){let i=[];const n=document.createElement("div");n.style.padding="20px";const a=document.createElement("div");a.classList.add("matri-table-toolbar"),a.style.marginBottom="10px";let o=new v;new m({modelEvents:o,filter:{enableCache:!0},withStableActions:!0,stableActions:[],actions:[],useGeneratedToolbar:!0}).inject(a),o.subscribe({event:"enox-collection-toolbar-filter-search-value"},(function(t){var n=(t.searchValue[0]||"").toLowerCase();const a="ConstrainedCriteria"===e?E.getChildren()?E.getChildren():null:"DrivingCriteria"===e&&x.getChildren()?x.getChildren():null;let o=!1;Array.isArray(i)||(i=[]),a&&Array.isArray(a)&&(n.length>0?a.forEach((e=>{e.options&&Array.isArray(e.options.children)&&(e.options.children.forEach((e=>{if(e.options&&e.options.label){const t=e.options.label.toLowerCase();e.options.value.seqNumber.toString().includes(n)||t.includes(n)?(e.show(),o=!0):e._isSelected?(e.hide(),e.select()):e._isSelected||(i.push(e),e.hide())}else e.hide(),e.select()})),!o&&e.options.label.toLowerCase().includes(n)?e.options.children.forEach((e=>{e.show()})):o||e.options.label.toLowerCase().includes(n)||(e.hide(),e.select(),e.selectAll()))})):(Array.isArray(a)&&a.forEach((e=>{e.options&&Array.isArray(e.options.children)&&(e._isHidden&&e.show(),e.options.children.forEach((e=>{e._isHidden&&(e.show(),e.select())})))})),a.forEach((e=>{if(e.options&&Array.isArray(e.options.children)){let t=e.options.children;for(let e=0;e<t.length;e++){let n=t[e];for(let e=0;e<i.length;e++){if(i[e].options.label===n.options.label){n.unselect();break}}}}})),i=null))}));const r=document.createElement("div");if(r.style.display="flex",r.style.alignItems="center","DrivingCriteria"===e){const e=document.createElement("label");e.textContent=f.Filter_All_or_Any_Of_The_following,e.style.marginRight="10px";const t=function(){var e=document.createElement("button");return e.innerHTML=f.Any,e.className="toggle-button",e.addEventListener("click",(function(){"All"===S?(S=f.Any,I="OR"):(S=f.All,I="AND"),e.innerHTML=S})),e}();r.appendChild(e),r.appendChild(t)}const s=function(e){return new l({identifier:"DataGridViewDemo",treeDocument:e,columns:[{text:f.Title,dataIndex:"tree",typeRepresentation:"string"},{text:f.SeqNumber,dataIndex:"SequenceNumber",typeRepresentation:"integer"}]})}(t);s.selectionBehavior.showMixedStateOnParents=!0;const d=s.getNodesXSO();d.onPostAdd((()=>{"DrivingCriteria"===e?g=t.getSelectedNodes():"ConstrainedCriteria"===e&&(b=t.getSelectedNodes())})),d.onPostRemove((()=>{"DrivingCriteria"===e?g=t.getSelectedNodes():"ConstrainedCriteria"===e&&(b=t.getSelectedNodes())}));const c=document.createElement("div");return c.id=`${e}-container`,c.style.position="relative",c.style.height="300px",n.appendChild(a),n.appendChild(r),n.appendChild(c),s.inject(c),{div:n,datagrid:s}}var c=new h({displayStyle:"strip"});E=r(i),x=r(o);let _=w,C=d("DrivingCriteria",x),D=d("ConstrainedCriteria",E);c.add({label:f.DrivingCriteria,content:C.div,icon:{iconName:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-table wux-ui-3ds-lg",fontIconFamily:WUXManagedFontIcons.Font3DS},isSelected:-1!==_}),c.add({label:f.ConstrinedCriteria,content:D.div,icon:{iconName:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-table-vertical wux-ui-3ds-lg",fontIconFamily:WUXManagedFontIcons.Font3DS},isSelected:-1===_});var T=new u({title:f.Filter_by_value,content:c.getContent(),activeFlag:!1,modalFlag:!0,width:600,height:400,buttons:{Close:new p({label:f.Cancel,onClick:function(){T.close()}}),Ok:new p({label:f.Filter,onClick:function(){if(g&&Array.isArray(g)&&g.length>=0){V=[];let e=new Set,t=g.map((e=>e.options.label)).filter(Boolean);this.mappingData&&Array.isArray(this.mappingData)&&o.forEach((function(i){if(Array.isArray(i.children)){i.children.filter((e=>e.title&&e.value&&!t.includes(e.title))).forEach((t=>{t.value&&t.value.id&&(V.push(t.value.id),this.mappingData.forEach((i=>{i.idObject===t.value.id&&e.add(i.rowID)})))}),this)}}),this),this.filterColumn(e,V,I)}if(b&&Array.isArray(b)&&b.length>=0){M=[],y=[];let e=b.map((e=>e.options.label)).filter(Boolean);Object.keys(i).forEach((function(t){let n,a,o=i[t];o.parent&&!e.includes(o.parent)&&(a=o.parent,Array.isArray(o.children)&&o.children.forEach((e=>{const t=e.value;t.parent&&(n=t.parent)})),M.push({title:a,parentId:n})),Array.isArray(o.children)&&o.children.forEach((function(t){t.title&&!e.includes(t.title)&&y.push(t.value)}))})),0===M.length&&0===y.length&&this.filterRow(null),M.forEach((function(e){this.filterRow(e.title)}),this),y.forEach((function(e){this.filterRow(e)}),this)}this.handleItemCountChange(),T.close()}.bind(this)})}})},j.prototype.resetFilter=function(){if(this.isFilterApplied&&this._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:{id:"filter-column",icon:"list-filter"}}),this.isFilterApplied=!1,y=[],M=[],V=[],this._privateChannel.publish({event:"widget-preference-update-filter",data:{invalidFilter:[],filterBy:[]}}),this.invalidFilter=[],this.filterBy=[],this._dataGridView){this._dataGridView.prepareUpdateView();for(var e=0;e<this._dataGridView.layout.getLeafColumns().length;e++)this._dataGridView.layout.setColumnVisibleFlag(e,!0),this.conflictColumn&&this.conflictColumn[e]&&(this.conflictColumn[e].visible=!0);this.updateCountConflict(),this.filterRow(null),this.updateCountColumn(this._jsonModel.drivingCombinationValues.length+1),this.updateCountInvalidColumn(),this._dataGridView.pushUpdateView()}b=E&&"function"==typeof E.getSelectedNodes?E.getAllDescendants():void 0,g=x&&"function"==typeof x.getSelectedNodes?x.getAllDescendants():void 0},j.prototype.filterInvalidColumn=function(){var t=e.clone(this._matrixModel.getJsonModel());this.previousInvalidFilter=e.clone(this.invalidFilter),this._dataGridView.prepareUpdateView();for(var i=0;i<t.drivingCombinationsValidity.length;i++)"I"===t.drivingCombinationsValidity[i]&&(this.invalidFilter.includes(i+1)||(this.invalidFilter.push(i+1),this._dataGridView.layout.columns[i+1]&&this._dataGridView.layout.setColumnVisibleFlag(this.invalidFilter[this.invalidFilter.length-1],!1)));this._dataGridView.pushUpdateView(),this._privateChannel.publish({event:"widget-preference-update-filter",data:{invalidFilter:this.invalidFilter,filterBy:this.filterBy}});var n;for(n=this.removeDuplicateFilterValues(this.filterBy),i=0;i<n.length;i++)this.conflictColumn[n[i]]&&(this.conflictColumn[n[i]].visible=!1);this.handleItemCountChange(),this.updateCountConflict(),this.updateCountInvalidColumn(this.invalidFilter.length),this.updateCountColumn(this._jsonModel.drivingCombinationValues.length+1-(this.invalidFilter.length+n.length))},j.prototype._launchCommentsOnCell=function(){this._privateChannel.publish({event:"model-app-launch-cell-comment-info",data:this._dataGridView})},j.prototype.filterColumn=function(e,t,i){if(this._resizableTableModel&&Array.isArray(this._resizableTableModel.linesColumns)){const l=this._resizableTableModel.linesColumns,d=[],c={},u=[];let h=t,p=Array.from(e);l.filter(((e,t)=>{const n=[];if(Array.isArray(h)&&h.forEach((t=>{e.forEach(((e,i)=>{e.id===t&&n.push(i)}))})),"AND"===i)return n.length>0?(u.push(t+1),c[t]=n,!1):(d.push(t),!0);if("OR"===i){const i=h.length,a=new Set;h.forEach((e=>{const t=l.flatMap((e=>e)).find((t=>t.id===e));t&&t.parent&&a.add(t.parent)}));const o=a.size;if(i>=o){return h.filter((t=>e.some((e=>e.id===t)))).length===o?(u.push(t+1),c[t]=n,!1):(d.push(t),!0)}return!0}return!0}));var n=[];this._dataGridView.prepareUpdateView();for(var a=[],o=0;o<this.mappingData.length;o++)t[s]===this.mappingData[o].idObject&&e===this.mappingData[o].rowID&&(this.invalidFilter.includes(this.mappingData[o].columnID)||(a.push(this.mappingData[o].columnID),this._dataGridView.layout.setColumnVisibleFlag(this.mappingData[o].columnID,!1)));this.filterBy.push({columnID:a,id:t[s],rowID:e}),this.filterBy=[];for(let e=0;e<t.length;e++){let i={rowID:p[e],columnID:u,id:t[e]};this.filterBy.push(i)}for(s=1;s<this._dataGridView.layout.getLeafColumns().length;s++)n.push(s);this.invalidFilter.length>0&&(n=n.filter((e=>!this.invalidFilter.includes(e))));var r=[];if(this.filterBy.length>0){let e=this.removeDuplicateFilterValues(this.filterBy);for(var s=0;s<e.length;s++)this.invalidColumn.includes(e[s])&&r.push(s),this.conflictColumn[e[s]]&&(this.conflictColumn[e[s]].visible=!1);n=n.filter((t=>!e.includes(t)))}for(s=0;s<n.length;s++)n[s]&&(this._dataGridView.layout.setColumnVisibleFlag(n[s],!0),this.conflictColumn[n[s]]&&!this.conflictColumn[n[s]].visible&&(this.conflictColumn[n[s]].visible=!0));if(this.filterBy.length>0)for(s=0;s<u.length;s++)u[s]&&(this._dataGridView.layout.setColumnVisibleFlag(u[s],!1),this.conflictColumn[u[s]]&&this.conflictColumn[u[s]].visible&&(this.conflictColumn[u[s]].visible=!1));this._privateChannel.publish({event:"widget-preference-update-filter",data:{invalidFilter:this.invalidFilter,filterBy:this.filterBy}}),this.updateCountConflict(),this.updateCountInvalidColumn(r.length),this.updateCountColumn(n.length+1),this._dataGridView.pushUpdateView()}},j.prototype.removeAllIconSortHeader=function(){for(var e=document.getElementsByClassName("wux-layouts-datagridview-column-header-cell"),t=0;t<e.length;t++)e[t].removeAttribute("sort-direction"),e[t].removeAttribute("type-representation")},j.prototype.bubbleSort=function(e,t,i){i=i.toLowerCase(),t=t.toLowerCase();var n=e.length;switch(i){case"integer":for(var a=n-1;a>=0;a--)for(var o=1;o<=a;o++)if(parseInt(e[o-1].seqNumber,10)>parseInt(e[o].seqNumber,10)){var r=e[o-1];e[o-1]=e[o],e[o]=r}break;case"text":for(a=n-1;a>=0;a--)for(o=1;o<=a;o++)if(e[o-1].text>e[o].text){r=e[o-1];e[o-1]=e[o],e[o]=r}}return"desc"===t&&e.reverse(),e},j.prototype._updateLoadingStatus=function(e,t){var i=this._matrixModel.getJsonModel().drivingCombinationValues.length,n=Math.floor(100*e/i);switch(n>100&&(console.error("Caution they have a issue in _updateLoadingStatus where we have a % over 100"),n=100),t){case"conflict":this.loadingConflictPercent=n;var a={id:"statusConflict",text:f.Conflicts_Computing+" : "+this.loadingConflictPercent+"%",icon:100===this.loadingConflictPercent?"check":"clock"};this._updateStatusBar(a);break;case"suggestion":this.loadingSuggestionPercent=n;a={id:"statusSuggestion",text:f.Constraints_Computing+" : "+this.loadingSuggestionPercent+"%",icon:100===this.loadingSuggestionPercent?"check":"clock"};this._updateStatusBar(a);break;default:console.error("Error updateLoadinPanel : typeUpdate not recognize")}},j.prototype._updateStatusBar=function(e){"Compare"!==this.context&&(e&&this._dataGridView.elements.statusBar.getNodeModelByID(e.id).updateOptions({grid:{data:e.text,semantics:{icon:e.icon}}}))},j.prototype.countConflict=function(e,i){if(e&&i){var n=i.statesValidity[e-1],a=i.states[e-1];if(n&&a)for(var o=0;o<n.length;o++)if("conflict"===t.getCellState(a[o],n[o]))this.conflictColumn[e]?this.conflictColumn.nbTotalConflict&&!this.conflictColumn[e].rowID.includes(o)&&(this.conflictColumn.nbTotalConflict++,this.conflictColumn[e].rowID.push(o),this.updateCountConflict()):(this.conflictColumn[e]={columnID:e,rowID:[o],visible:!0},this.conflictColumn.nbTotalConflict?this.conflictColumn.nbTotalConflict++:this.conflictColumn.nbTotalConflict=1,this.notVisibleColumns&&this.notVisibleColumns.length>0&&this.notVisibleColumns.includes(e)&&(this.conflictColumn[e].visible=!1),this.updateCountConflict());else if(this.conflictColumn[e]&&this.conflictColumn[e].rowID.includes(o)){var r=this.conflictColumn[e].rowID.indexOf(o);this.conflictColumn[e].rowID.splice(r,1),this.conflictColumn.nbTotalConflict--,0===this.conflictColumn[e].rowID.length&&delete this.conflictColumn[e],this.updateCountConflict()}}},j.prototype.countInvalidColumn=function(e,t){if(e&&t&&("I"===t.drivingCombinationsValidity&&(this.invalidColumn.includes(e)||this.invalidColumn.push(e),this.updateCountInvalidColumn(this.invalidFilter.length)),t.InvalidDrivingValues&&t.InvalidDrivingValues.length>0&&(t.drivingCombinationsInvalidValues=t.InvalidDrivingValues),t.drivingCombinationsValidity&&"I"===t.drivingCombinationsValidity)){this._dataGridView.prepareUpdateView();var i={icon:{iconName:"help"}};if(t.drivingCombinationsInvalidValues&&t.drivingCombinationsInvalidValues.length>0)for(var n=t.drivingCombinationsInvalidValues[0],a=0;a<n.length;a++){var o=this._dataGridView.layout._columnItemsByDepth[a][e].dataIndex;i.text=this._resizableTableModel.columns[e-1][a]+" (invalid)",this._dataGridView.layout.getLeafColumns()[e].editableFlag=!1,this._dataGridView.layout.setColumnOrGroupProperties(o,i)}this._dataGridView.pushUpdateView()}},j.prototype.updateCountInvalidColumn=function(e){var t,i;this.invalidColumn.length>0&&(e&&e>0?(t=this.invalidColumn.length-e,i={id:"invalidColumn",text:f.Invalid_columns+" : "+t+"/"+this.invalidColumn.length}):i={id:"invalidColumn",text:f.Invalid_columns+" : "+this.invalidColumn.length},this._updateStatusBar(i))},j.prototype.updateCountColumn=function(e){if(e){var t={id:"totalColumn",text:e===this._jsonModel.drivingCombinationValues.length+1?f.Total_Columns+" : "+(this._jsonModel.drivingCombinationValues.length+1):f.Total_Columns+" : "+e+"/"+(this._jsonModel.drivingCombinationValues.length+1)};this._updateStatusBar(t)}},j.prototype.countNotVisibleConflicts=function(){var e=0;for(var t in this.conflictColumn)this.conflictColumn[t].rowID&&(this.conflictColumn[t].visible||(e+=this.conflictColumn[t].rowID.length));return e},j.prototype.updateCountConflict=function(){if(this.conflictColumn){var e=this.countNotVisibleConflicts();if(this.conflictColumn.nbTotalConflict&&this.conflictColumn.nbTotalConflict>0)if(e&&e>0){var t=this.conflictColumn.nbTotalConflict-e,i={id:"nbConflict",text:f.Number_Conflict+" : "+t+"/"+this.conflictColumn.nbTotalConflict,icon:"attention"};this._updateStatusBar(i)}else{i={id:"nbConflict",text:f.Number_Conflict+" : "+this.conflictColumn.nbTotalConflict,icon:"attention"};this._updateStatusBar(i)}else{i={id:"nbConflict"};this._updateStatusBar(i)}}},j.prototype.removeDuplicateFilterValues=function(e){var t=[];if(e&&e.length>0){var i;i=e.map((e=>e.columnID)),t=(t=t.concat.apply(t,i)).filter((function(e,i){return t.indexOf(e)===i}))}return t},j.prototype.updateDataGridVisibleColumn=function(e,t){if(this._dataGridView&&e&&t){var i=this._dataGridView.layout.getOrderedColumnsIndexes();if(t.length>0)for(var n=0;n<t.length;n++)i.includes(t[n])&&this._dataGridView.layout.setColumnVisibleFlag(t[n],!1);if(e.length>0)for(n=0;n<e.length;n++)for(var a=e[n].columnID,o=0;o<a.length;o++)i.includes(a[o])&&this._dataGridView.layout.setColumnVisibleFlag(a[o],!1)}},j})),define("DS/CfgRuleMatrixComponent/Model/MatrixRuleModel",["UWA/Core","DS/CfgRuleMatrixComponent/Utils/MatruiTablePersistanceUtils","DS/CfgSolver/CfgSolverServices","DS/ENOXNotificationsUtil/ENOXNotificationUtil","i18n!DS/CfgRuleMatrixComponent/assets/nls/MatrixRuleModel"],(function(e,t,i,n,a){"use strict";var o=function(e,t,i){this.init(e,t,i)};return o.prototype.init=function(e,i,n){var a=t.convertJsonToV3(e,i);this.__jsonModel=JSON.parse(JSON.stringify(a)),this.__jsonModel.drivingCombinationsValidity=this.__jsonModel.drivingCombinationsValidity||[],this._isDrivingCombinationsDirtified=!0,this._isConstrainedCriteriaDirtified=!1,void 0!==this.__jsonModel.drivingCombinationsValidity&&"string"==typeof this.__jsonModel.drivingCombinationsValidity&&(this.__jsonModel.drivingCombinationsValidity=[]),this._allDrivingCombination=[],this._drivingCriteria=this.__jsonModel.drivingCriteria||[],this._constrainedCriteria=this.__jsonModel.constrainedCriteria||[],this._constrainedValues=this.__jsonModel.constrainedValues||[],this._drivingCombinationValues=this.__jsonModel.drivingCombinationValues||[],this._mapDico=e||[],this._solverKey=n||"",this._states=this.__jsonModel.states||[],this._statesValidity=this.__jsonModel.statesValidity||[],this._timerID=[]},o.prototype.getJsonModel=function(){return this.__jsonModel},o.prototype.getAllIds=function(){let e=[];return this.__jsonModel.drivingCriteria.forEach((t=>{t.selectedValues.forEach((t=>{e.push(t.id)}))})),this.__jsonModel.constrainedCriteria.forEach((t=>{t.selectedValues.forEach((t=>{e.push(t.id)}))})),e},o.prototype.drivingCombinationsChanged=function(){return this._isDrivingCombinationsDirtified},o.prototype.setJsonModel=function(t){e.extend(this.__jsonModel,t),this._drivingCriteria=this.__jsonModel.drivingCriteria,this._constrainedCriteria=this.__jsonModel.constrainedCriteria,this._constrainedValues=this.__jsonModel.constrainedValues,this._drivingCombinationValues=this.__jsonModel.drivingCombinationValues,this._states=this.__jsonModel.states,this._statesValidity=this.__jsonModel.statesValidity,this._isDrivingCombinationsDirtified=!0,this.updateJsonModel()},o.prototype.reOrderDrivingCriteria=function(){var e=this,t=[];e.__jsonModel.drivingCriteria.forEach((function(e){t.push(e.id)}));var i=function(i,n){for(var a=0,o=i[0],r=n[0],s=0;s<t.length;s++){var l=t[s];if(void 0!==o[l]){if(o[l].variantValue&&r[l].variantValue){if(e._mapDico[o[l].variantValue].title===e._mapDico[r[l].variantValue].title)continue;a=e._mapDico[o[l].variantValue].title<e._mapDico[r[l].variantValue].title?-1:1}break}}return a},n=function(e){for(var t=0;t<e.length;t++)e[t]=[e[t],t];e.sort(i);for(var n=[],a=0;a<e.length;a++)n.push(e[a][1]),e[a]=e[a][0];return n}(e.__jsonModel.drivingCombinationValues),a=[],o=[],r=0;for(r=0;r<n.length;r+=1)a.push(e.__jsonModel.states[n[r]]),o.push(e.__jsonModel.statesValidity[n[r]]);e.__jsonModel.states=a,e.__jsonModel.statesValidity=o},o.prototype.addDrivingCriteria=function(e){this._addCriteria(this.__jsonModel.drivingCriteria,e),this._isDrivingCombinationsDirtified=!0},o.prototype.removeDrivingCriteria=function(e){this._removeCriteria(this.__jsonModel.drivingCriteria,e),this._isDrivingCombinationsDirtified=!0},o.prototype._addCriteria=function(e,t){for(var i in t)if(t.hasOwnProperty(i)){var n=!1;if(e.forEach((function(e){e.id===i&&(n=!0,t[i].forEach((function(t){var i=!1;e.selectedValues.forEach((function(e){e.id===t.id&&(i=!0)})),i||e.selectedValues.push(t)})))})),!n){var a={id:i};this._mapDico[i]&&(a.selectedValues=t[i]),e.push(a)}}},o.prototype._removeCriteria=function(e,t){for(var i in t)if(t.hasOwnProperty(i)){var n=-1;e.forEach((function(e,a){e.id===i&&(t[i].forEach((function(t){var i=e.selectedValues.findIndex((function(e){return e.id===t.id}));-1!==i&&e.selectedValues.splice(i,1)})),0===e.selectedValues.length&&(n=a))})),n>-1&&e.splice(n,1)}},o.prototype.addConstrainedCriteria=function(e){this._addCriteria(this.__jsonModel.constrainedCriteria,e),this._isConstrainedCriteriaDirtified=!0},o.prototype.removeConstrainedCriteria=function(e){this._removeCriteria(this.__jsonModel.constrainedCriteria,e),this._isConstrainedCriteriaDirtified=!0},o.prototype.setStateWithID=function(e,t,i){var n=this.__jsonModel.states[e],a=n.substr(0,t)+i+n.substr(t+1,n.length);this.__jsonModel.states[e]=a},o.prototype.getMiniJsonModel=function(e){var t;return this.__jsonModel.drivingCombinationValues[e]&&(t={drivingCriteria:this.__jsonModel.drivingCriteria,constrainedCriteria:this.__jsonModel.constrainedCriteria,drivingCombinationValues:[this.__jsonModel.drivingCombinationValues[e]],drivingCombinationsValidity:[this.__jsonModel.drivingCombinationsValidity[e]],constrainedValues:this.__jsonModel.constrainedValues,states:[this.__jsonModel.states[e]],statesValidity:[this.__jsonModel.statesValidity[e]],version:"3.0",_clientData:{columnID:e,timerID:this._timerID[e]}}),t},o.prototype.replaceStateValidityToConflict=function(t,i){var n=e.clone(t);if(i.statesValidity.length>0)for(var a=0;a<i.statesValidity.length;a++){for(var o="",r=0;r<i.statesValidity[a].length;r++)"C"===n.statesValidity[a][r]?o+="C":o+=i.statesValidity[a][r];n.statesValidity[a]=o}return i.drivingCombinationsValidity&&"I"===i.drivingCombinationsValidity&&(n.drivingCombinationsValidity=i.drivingCombinationsValidity),n},o.prototype.removeStateValidity=function(){for(var e=0;e<this.__jsonModel.statesValidity.length;e++){for(var t="",i=0;i<this.__jsonModel.statesValidity[e].length;i++)t+="V";this.__jsonModel.statesValidity[e]=t}},o.prototype.removeDrivingCombinationsValidity=function(){if(this.__jsonModel&&this.__jsonModel.drivingCombinationsValidity)for(var e=0;e<this.__jsonModel.drivingCombinationsValidity.length;e++)"I"===this.__jsonModel.drivingCombinationsValidity[e]&&(this.__jsonModel.drivingCombinationsValidity[e]="V")},o.prototype.setTimerIDForColumnID=function(e){e>=0&&(this._timerID[e]=performance.now())},o.prototype.setJsonModelColumn=function(e){var t=e._clientData.columnID;t>=0&&(this.__jsonModel.states[t]=e.states[0],this.__jsonModel.statesValidity[t]=e.statesValidity[0]),void 0!==e.drivingCombinationsValidity&&this.__jsonModel.drivingCombinationsValidity.length>=0&&("I"===e.drivingCombinationsValidity?this.__jsonModel.drivingCombinationsValidity[t]=e.drivingCombinationsValidity:this.__jsonModel.drivingCombinationsValidity[t]="V")},o.prototype.checkAndFixDiscrepancy=function(){var e={_rc:0,discrepancyList:[]},t=0,i=0,n=[],a=[];for(t=0;t<this.__jsonModel.drivingCriteria.length;t+=1)void 0===this._mapDico[this.__jsonModel.drivingCriteria[t].id]&&(this.__jsonModel.states=[],this.__jsonModel.statesValidity=[],this.__jsonModel.drivingCriteria[t]="to remove",this.__jsonModel.drivingCombinationValues=[],a.push(this.__jsonModel.drivingCriteria[t].id));for(this.__jsonModel.drivingCriteria=this.__jsonModel.drivingCriteria.filter((function(e){return"to remove"!==e})),t=0;t<this.__jsonModel.drivingCriteria.length;t+=1)this.__jsonModel.drivingCriteria[t].selectedValues&&(this.__jsonModel.drivingCriteria[t].selectedValues=this.__jsonModel.drivingCriteria[t].selectedValues.filter((e=>!(void 0===this._mapDico[e.id])||(a.push(e.id),!1))));for(t=0;t<this.__jsonModel.constrainedCriteria.length;t+=1)void 0===this._mapDico[this.__jsonModel.constrainedCriteria[t].id]&&(a.push(this.__jsonModel.constrainedCriteria[t].id),this.__jsonModel.constrainedCriteria[t]="to remove");for(this.__jsonModel.constrainedCriteria=this.__jsonModel.constrainedCriteria.filter((function(e){return"to remove"!==e})),t=0;t<this.__jsonModel.constrainedCriteria.length;t+=1)this.__jsonModel.constrainedCriteria[t].selectedValues&&(this.__jsonModel.constrainedCriteria[t].selectedValues=this.__jsonModel.constrainedCriteria[t].selectedValues.filter((e=>!(void 0===this._mapDico[e.id])||(a.push(e.id),!1))));var o=null,r=[];for(t=0;t<this.__jsonModel.drivingCombinationValues.length;t+=1){var s=!0;if(0===r.length)for(o in this.__jsonModel.drivingCombinationValues[0])r.push(o);for(i=0;i<r.length;i+=1)void 0===this._mapDico[this.__jsonModel.drivingCombinationValues[t][r[i]].variantValue]&&(a.push(this.__jsonModel.drivingCombinationValues[t][r[i]].variantValue),s=!1);s||(this.__jsonModel.drivingCombinationValues[t]="to remove",this.__jsonModel.states[t]="YOURE REMOVED",this.__jsonModel.statesValidity[t]="YOURE REMOVED")}for(this.__jsonModel.states=this.__jsonModel.states.filter((function(e){return"YOURE REMOVED"!==e})),this.__jsonModel.statesValidity=this.__jsonModel.statesValidity.filter((function(e){return"YOURE REMOVED"!==e})),this.__jsonModel.drivingCombinationValues=this.__jsonModel.drivingCombinationValues.filter((function(e){return"to remove"!==e})),t=0;t<this.__jsonModel.constrainedValues.length;t+=1)void 0===this._mapDico[this.__jsonModel.constrainedValues[t].id]&&(n.push(t),a.push(this.__jsonModel.constrainedValues[t].id));if(n.length>0){for(i=0;i<this.__jsonModel.states.length;i+=1){for(t=0;t<n.length;t+=1)this.__jsonModel.states[i]=this.__jsonModel.states[i].substr(0,n[t])+"_"+this.__jsonModel.states[i].substr(n[t]+1),this.__jsonModel.statesValidity[i]=this.__jsonModel.statesValidity[i].substr(0,n[t])+"_"+this.__jsonModel.statesValidity[i].substr(n[t]+1);this.__jsonModel.states[i]=this.__jsonModel.states[i].replace(/_/g,""),this.__jsonModel.statesValidity[i]=this.__jsonModel.statesValidity[i].replace(/_/g,"")}for(t=0;t<n.length;t+=1)this.__jsonModel.constrainedValues[n[t]]="test_remove";this.__jsonModel.constrainedValues=this.__jsonModel.constrainedValues.filter((function(e){return"test_remove"!==e}))}return e._discrepancyIds=a,e._discrepancyIds.length>0&&(e._discrepancyIds=e._discrepancyIds.filter((function(t,i){return e._discrepancyIds.indexOf(t)===i})),e._rc=-1),e},o.prototype.updateJsonModel=function(){if(this._isDrivingCombinationsDirtified){var t=this.__jsonModel.drivingCriteria;if(t.reduce(((e,t)=>e*t.selectedValues.length),1)<=1e3){for(var o=[],r=0;r<t.length;r++)o.push(t[r].selectedValues);this._allDrivingCombination=this.recursiveCombination(o,0),this._allDrivingCombination&&this._addMissingDataToJsonModel(this._allDrivingCombination)}else{var s=this._solverKey,l=t.flatMap((e=>e.selectedValues.map((e=>e.id))));let e={},o={};t.forEach(((t,i)=>{const n=t.id;t.selectedValues.forEach((t=>{e[t.id]=n,o[t.id]=i}))})),this._allDrivingCombination=i.callDrivingCombinationsValues(l,s).then((t=>{this._allDrivingCombination=JSON.parse(t)._data.combinations.map((t=>t.map((t=>({id:t.id,parent:e[t.id]}))).sort(((e,t)=>o[e.id]-o[t.id])))),this._allDrivingCombination.length>0&&(n.showWarning({title:a._mr_max_valid_combination_msg_title,message:a._mr_max_valid_combination_msg_message}),this._addMissingDataToJsonModel(this._allDrivingCombination))}))}this._isDrivingCombinationsDirtified=!1}else e.is(this._allDrivingCombination,"array")&&this._isConstrainedCriteriaDirtified&&this._addMissingDataToJsonModel(this._allDrivingCombination);return this._allDrivingCombination},o.prototype._addMissingDataToJsonModel=function(t){var i=[],n=[],a=[],o=[],r=[],s=this,l=function(t,i){n[t]="",a[t]="",s.__jsonModel.constrainedCriteria.forEach((o=>{e.is(o.selectedValues,"array")&&o.selectedValues.forEach((e=>{var o=!1;s.__jsonModel.constrainedValues.forEach(((a,r)=>{a.id===e.id&&(n[t]+=s.__jsonModel.states[i][r]?s.__jsonModel.states[i][r]:"A",o=!0)})),o||(n[t]+="A"),a[t]+="V",r.find((t=>t.id===e.id))||r.push(e)}))}))};if(e.is(t,"array")&&t.length>0){for(var d=0;d<t.length;d++){var c=t[d],u={};n[d]="",a[d]="";for(var h=0;h<c.length;h++)if(c[h].id){var p=this._mapDico[c[h].id];if(!p)break;void 0!==p.parent&&(u[p.parent]={variantValue:c[h].id})}let s=Object.keys(u);if(s.length>0){if(this.__jsonModel.drivingCombinationValues.length>0){var m=s.sort();this.__jsonModel.drivingCombinationValues.forEach(((e,t)=>{var i=Object.keys(e).sort();if(i.length<=m.length&&i.length>0&&m.length>0){i.reduce(((t,i)=>{let n=!1,a=u[i];return t&&a&&e[i].variantValue===u[i].variantValue&&(n=!0),n}),!0)&&(l(d,t),o[d]="V")}}))}i.push(u),n[d]||(o[d]="V",this.__jsonModel.constrainedCriteria.forEach((t=>{e.is(t.selectedValues,"array")&&t.selectedValues.forEach((e=>{r.find((t=>t.id===e.id))||r.push(e),n[d]+="A",a[d]+="V"}))})))}else t.splice(d,1),d--}this.__jsonModel.drivingCombinationValues=i,this.__jsonModel.drivingCombinationsValidity=o,this.__jsonModel.constrainedValues=r}else if(this.__jsonModel.drivingCombinationValues.length>0){s=this;this.__jsonModel.drivingCombinationValues.forEach(((e,t)=>{l(t,t)})),this.__jsonModel.constrainedValues=r}this._isConstrainedCriteriaDirtified=!1,this.__jsonModel.states=n,this.__jsonModel.statesValidity=a},o.prototype.recursiveCombination=function(t,i){for(var n=[],a=[],o=i;o<t.length;o++)if(o+2===t.length)for(c=0;c<t[o].length;c++)for(var r=0;r<t[o+1].length;r++){var s=[];s.push(t[o][c]),s.push(t[o+1][r]),n.push(s)}else{if(o+2<t.length){for(a=this.recursiveCombination(t,o+1),c=0;c<t[o].length;c++)for(var l=e.clone(a),d=0;d<a.length;d++)l[d].unshift(t[o][c]),n.unshift(l[d]);break}if(1===t.length)for(var c=0;c<t[o].length;c++)(a=[]).push(t[0][c]),n.push(a)}return n},o.prototype.addDrivingToAllCombination=function(t){if(0===this._allDrivingCombination.length)for(const e in t)for(var i=0;i<t[e].length;i++)this._allDrivingCombination.push([t[e][i]]);else{var n=[];for(const r in t)for(i=0;i<t[r].length;i++)for(var a=e.clone(this._allDrivingCombination),o=0;o<this._allDrivingCombination.length;o++)a[o].push(t[r][i]),n.push(a[o]);this._allDrivingCombination=n}},o.prototype.getNumberCombination=function(){return this._allDrivingCombination.length},o.prototype.getAllDrivingCombination=function(){return this._allDrivingCombination},o.prototype.formatJsonModelForXmodelListView=function(e,t){var i=this;if(void 0!==this._mapDico){var n=[],a=[],o={},r={member:n,allIds:a};if(e)for(var s in e.forEach((function(e){var r=i._mapDico[e.id],s={};if(void 0!==r)if(void 0!==r.type&&null!==r.type){switch(r.type.toLocaleLowerCase()){case"variant":s.id=e.id,s.type=r.type,s.title=r.title,s.image=r.image,s.sequenceNumber=r.seqNumber,s.description=r.description,s.commercial=r.commercial,a.push(e.id),n.push(s);break;case"option":(e.selectedValues&&e.selectedValues[0]||"yes"===e.criteriaValidity)&&(a.includes(r.parent)?o[r.parent].push(e.id):(o[r.parent]=[],o[r.parent].push(e.id),a.push(r.parent)),a.push(e.id));break;case"variability_group":if(s.id=e.id,s.type=r.type,s.title=r.title,s.image=r.image,s.sequenceNumber=r.seqNumber,s.description=r.description,s.commercial=r.commercial,i._mapDico[e.id].content.length===e.selectedValues.length)a.push(e.id);else{var l=i._mapDico[e.id].content.filter((t=>!e.selectedValues.some((e=>t===e.id)))),d="driving-criteria"===t?i.__jsonModel.constrainedCriteria:i.__jsonModel.drivingCriteria;for(let t of d)if(t.id===e.id){l=l.filter((e=>!t.selectedValues.some((t=>e===t.id))));break}0===l.length&&a.push(e.id)}n.push(s)}if(e.selectedValues){var c=[];s.options={member:c},e.selectedValues.forEach((function(t){var n={};if(void 0!==t.id){var o=i._mapDico[t.id];void 0!==o?t.id&&(n.id=t.id,n.type=o.type,n.sequenceNumber=o.seqNumber,n.title=o.title,n.image=o.image,n.description=o.description,n.parentId=o.parent,c.push(n),a.push(t.id)):console.error("The dico didn't can't map the id : "+e.id)}}))}}else console.log("Error type not defined formatJsonModelForXmodelListView");else console.error("The dictionary can't map the id : "+e.id)})),o){var l={},d=i._mapDico[s];l.id=s,l.type=d.type,l.title=d.title,l.image=d.image,l.sequenceNumber=d.seqNumber,n.push(l);var c=[];l.options={member:c};for(var u=0;u<o[s].length;u++){var h={},p=i._mapDico[o[s][u]];h.id=o[s][u],h.type=p.type,h.title=p.title,h.image=p.image,h.sequenceNumber=p.seqNumber,h.description=p.description,c.push(h)}}return r}console.error("The disco isn't loaded")},o.prototype.formatXmodelListViewForJsonModel=function(e){var t,i=e.parentId?e.parentId:this._mapDico[e.id].parent;if(i)t={[i]:[{id:e.id,parent:i}]};else{var n,a;t={[e.id]:[]};var o=e.values?e.values:e.options;if(o)for(a=0;a<o.member.length;a++)n={id:o.member[a].id,parent:e.id},t[e.id].push(n)}return t},o.prototype.getDetailFromIdOnDico=function(e){return this._mapDico[e]},o})),define("DS/CfgRuleMatrixComponent/Runtime/RunTimePresenter",["DS/CfgRuleMatrixComponent/Runtime/MatruiTablePresenter","DS/ENOXCollectionToolBar/js/ENOXCollectionToolBarV2","DS/Handlebars/Handlebars","DS/CoreEvents/ModelEvents","DS/UIKIT/Mask","UWA/Element","text!DS/CfgRuleMatrixComponent/Runtime/RunTimePresenter.html","i18n!DS/CfgRuleMatrixComponent/assets/nls/RunTimePresenter","css!DS/CfgRuleMatrixComponent/Runtime/RunTimePresenter.css"],(function(e,t,i,n,a,o,r,s,l){"use strict";var d=function(){};return d.prototype.init=function(t,i,a){this._matrixModel=t,this._privateChannel=i||new n,this._options={},this._options.painter=!!a.painter&&a.painter,this._solverKey=a.solverKey,this._solverModelEvent=a.solverModelEvent,this._dictionary=a.dictionary,this._editable=a.editable,this._subscribedEventTokens=[],this._subscribedEventTokensPrivate=[],this._matruiTablePresenter=new e;try{this._matruiTablePresenter.init(this._matrixModel,this._privateChannel,{solverKey:this._solverKey,solverModelEvent:this._solverModelEvent,dictionary:this._dictionary,editable:this._editable,immersiveFrame:a.immersiveFrame,filter:a.filter,context:a.context,ruleID:a.ruleID,applicationChannel:a.applicationChannel,currentUser:a.currentUser})}catch(e){this._matruiTablePresenter.init(this._matrixModel,this._privateChannel,{solverKey:this._solverKey,solverModelEvent:this._solverModelEvent,dictionary:this._dictionary,editable:this._editable,immersiveFrame:a.immersiveFrame,context:a.context,ruleID:a.ruleID,applicationChannel:a.applicationChannel,currentUser:a.currentUser})}this._initToolbar(),this._initDivs(),this._subscribeToEvents()},d.prototype.getView=function(){return this._matruiTablePresenter.getView()},d.prototype._initToolbar=function(){var e=[{id:"zoom",text:s.ResizeColumn,fonticon:"zoom-in",category:"edition",content:[{id:"large",text:s.Large,fonticon:"fonticon fonticon-high"},{id:"medium",text:s.Medium,fonticon:"fonticon fonticon-medium"},{id:"small",text:s.Small,fonticon:"fonticon fonticon-low"}]},{id:"filter-column",text:s.Filter_Column,fonticon:"list-filter",category:"stableAction",content:[{id:"display-all-combination",text:s.Clear},{id:"filter-invalid-column",text:s.Valid_Column,disabled:!0}]}];this._editable&&e.unshift({id:"painter",fonticon:"brush",text:s.Painter,category:"edition",content:[{id:"painter-not-available",text:s.NA,fonticon:"brush-block",changeIconSelection:!0},{id:"painter-available",text:s.Available,fonticon:"brush",changeIconSelection:!0},{id:"painter-default",text:s.Default,fonticon:"brush-favorite",changeIconSelection:!0},{id:"painter-selected",text:s.Selected,fonticon:"brush-ok",changeIconSelection:!0},{id:"painter-none",text:s.None,fonticon:"brush",changeIconSelection:!0}]});var i={modelEvents:this._privateChannel,actions:e,useGeneratedToolbar:!0,touchMode:!1,withInformation:!1};this._containerToolBar=document.createElement("div"),this._containerToolBar.classList.add("matri-table-toolbar"),this.collectionToolbar=new t(i),this.collectionToolbar.inject(this._containerToolBar)},d.prototype._initDivs=function(){var e=i.compile(r)(this._options);this._container=document.createElement("div"),this._container.innerHTML=e,this._container=this._container.firstChild,this._painterContainer=this._container.querySelector(".painter-presenter"),this._matruiTablePresenterContainer=this._container.querySelector(".table-presenter"),this._matruiTablePresenterContainer.appendChild(this._containerToolBar),this._matruiTablePresenter.inject(this._matruiTablePresenterContainer),UWA.extendElement(this._container)},d.prototype._clearPreviousEvents=function(){if(this._solverModelEvent)for(var e=UWA.clone(this._subscribedEventTokens)||[],t=0;t<e.length;t++)this._solverModelEvent.unsubscribe(e[t]);if(this._privateChannel)for(e=UWA.clone(this._subscribedEventTokensPrivate)||[],t=0;t<e.length;t++)this._privateChannel.unsubscribe(e[t])},d.prototype._subscribeToEvents=function(){var e=this;this._subscribedEventTokensPrivate.push(this._privateChannel.subscribe({event:"mr-refresh-run-view"},(function(t){e._matruiTablePresenter._options.filter=t,e._matruiTablePresenter.refresh()}))),this._subscribedEventTokens.push(this._solverModelEvent.subscribe({event:"checkMatrixRuleValidity_statesConflicts_SolverAnswer"},(function(t){var i=t.answerData._clientData?t.answerData._clientData.columnID:-1;i>=0?e._matrixModel.getMiniJsonModel(i)._clientData.timerID===t.answerData._clientData.timerID&&(e._matrixModel.setJsonModelColumn(t.answerData),e.update({columnID:i},t.answerData)):(e._matrixModel.setJsonModel(t.answerData),e.update({columnID:i},t.answerData));a.unmask(e._container)}))),this._subscribedEventTokens.push(this._solverModelEvent.subscribe({event:"checkMatrixRuleValidity_SolverAnswer"},(function(t){var i=t.answerData._clientData?t.answerData._clientData.columnID:-1;if(i>=0){var n=e._matrixModel.getMiniJsonModel(i);n._clientData.timerID===t.answerData._clientData.timerID&&(n=e._matrixModel.replaceStateValidityToConflict(n,t.answerData),e._matrixModel.setJsonModelColumn(t.answerData),e.update({columnID:i},t.answerData))}else e._matrixModel.setJsonModel(t.answerData),e.update({columnID:i});a.unmask(e._container)}))),this._subscribedEventTokens.push(this._solverModelEvent.subscribe({event:"checkMatrixRuleValidity_SolverReason"},(function(t){var i=t.answerData._clientData.columnID,n=t.answerData._clientData.rowID;if(i>=0&&n>=0){var o={};o.statesCausingValues=t.answerData.statesCausingValues[0][n],o.statesCausingRules=t.answerData.statesCausingRules[0][n],o.statesValidity=t.answerData.statesValidity[0][n],o.states=t.answerData.states[0][n],e._privateChannel.publish({event:"get-mr-details",data:{conflictingRules:o.statesCausingRules,reasons:o,clientData:t.answerData._clientData}})}a.unmask(e._container)})))},d.prototype.inject=function(e){e.appendChild(this._container)},d.prototype.attachResizeSensor=function(){this.collectionToolbar.attachResizeSensor()},d.prototype.loadData=function(){},d.prototype.update=function(e,t){this._matruiTablePresenter.update(e,t)},d.prototype.destroy=function(){this._matruiTablePresenter.destroy()},d.prototype.refreshUI=function(){this._privateChannel.publish({event:"mr-refresh-run-view"})},d.prototype.restartAsyncCallSolver=function(){this._matruiTablePresenter._restartMatrixSolverCall()},d})),define("DS/CfgRuleMatrixComponent/GlobalPresenter/GlobalPresenter",["UWA/Core","DS/Handlebars/Handlebars","DS/CoreEvents/ModelEvents","DS/UIKIT/Mask","UWA/Element","DS/CfgDictionary/CfgDictionaryMapperUtils","DS/Controls/TabBar","DS/CfgRuleMatrixComponent/Buildtime/DrivingCriteriaPresenter","DS/CfgRuleMatrixComponent/Buildtime/ConstrainedCriteriaPresenter","DS/CfgRuleMatrixComponent/Runtime/RunTimePresenter","DS/CfgRuleMatrixComponent/Model/MatrixRuleModel","DS/CfgRuleMatrixComponent/Utils/MatruiTablePersistanceUtils","UWA/Class/Model","DS/UIKIT/Input/Button","DS/UIKIT/Alert","DS/xModelEventManager/xModelEventManager","DS/xModelSocialToolbar/js/xModelCommentUtils","text!DS/CfgRuleMatrixComponent/GlobalPresenter/GlobalPresenter.html","css!DS/CfgRuleMatrixComponent/GlobalPresenter/GlobalPresenter.css","i18n!DS/CfgRuleMatrixComponent/assets/nls/GlobalPresenter"],(function(e,t,i,n,a,o,r,s,l,d,c,u,h,p,m,v,_,C,f,g){"use strict";var b=function(){};return b.prototype.init=function(t,n,a,h,p,m){if(this.firstLoad=!0,this._variabilityDictionaryFormatForXmodel=m.variabilityDictionaryFormatForXmodel?m.variabilityDictionaryFormatForXmodel:null,this._options=m,this._solverKey=m.solverKey?m.solverKey:null,this._solverModelEvent=m.solverModelEvent,this._privateChannelForRules=m.privateChannelForRules,this._updateChannel=p,this._applicationChannel=h||void 0,this._privateChannel=new i,this._myEventManager=new v(this._applicationChannel,this._updateChannel,this._privateChannel,this._solverModelEvent),this._currentView="build",this._jsonModel=a||null,this._jsonModel?this._jsonModel.states&&this._jsonModel.states.length>0&&(this._currentView="run"):this._jsonModel={drivingCriteria:[],constrainedCriteria:[],constrainedValues:[],drivingCombinationValues:[],states:[],statesValidity:[],version:"2.0"},this._variabilityDictionary=n,this._contextDictionary=m.contextDico,this._mapDico=o.dicoMinifiedV3ToMap(n),"1.0.1"===this._jsonModel.version){var _=u.convertJsonToV3(this._mapDico,this._jsonModel);this._jsonModel=_}this._matrixRuleModel=new c(this._mapDico,this._jsonModel,this._solverKey);var C=this._matrixRuleModel.checkAndFixDiscrepancy();if(0!==C._rc?this._matrixRuleModel.setJsonModel(this._matrixRuleModel.__jsonModel):(this._matrixRuleModel.updateJsonModel(),this._matrixRuleModel._allDrivingCombination instanceof Promise&&this._matrixRuleModel._allDrivingCombination.then((()=>{this._contentrunContainer.classList.remove("no-content"),this._privateChannel.publish({event:"mr-refresh-run-view",data:this._options.filter})}))),this._inputJsonModel=e.clone(this._matrixRuleModel.getJsonModel()),this._isReadyToSwitch=!0,this._ruleId=t.ruleId,this._modelId=t.modelId,this._ruleName=t.ruleName,this._ruleSaveAllowed=!0,this._ruleSaveErrorMessage="",this._runTimePresenter=new d,this._drivingCriteriaPresenter=new s,this._constrainedCriteriaPresenter=new l,this._tabBar=new r({displayStyle:"strip",centeredFlag:!1}),this._tabBar.add({label:g._driving_criteria,icon:{iconName:"table",fontIconFamily:WUXManagedFontIcons.Font3DS},isSelected:"build"===this._currentView}),this._tabBar.add({label:g._constrained_criteria,icon:{iconName:"table-vertical",fontIconFamily:WUXManagedFontIcons.Font3DS}}),this._tabBar.add({label:g._content,icon:{iconName:"pencil",fontIconFamily:WUXManagedFontIcons.Font3DS},isSelected:"run"===this._currentView}),this._workaroundCheckAndWakeUpResizeSensor=m.resizeSensorEnablerFun?m.resizeSensorEnablerFun:function(){},this._runTimePresenter.init(this._matrixRuleModel,this._privateChannel,{painter:!1,solverKey:this._solverKey,solverModelEvent:m.solverModelEvent,dictionary:this._variabilityDictionary,editable:m.editable,immersiveFrame:m.immersiveFrame,filter:m.filter,ruleID:this._ruleId,applicationChannel:m.applicationChannel,currentUser:m.currentUser}),this._drivingCriteriaList=this._matrixRuleModel.formatJsonModelForXmodelListView(this._jsonModel.drivingCriteria,"driving-criteria"),this._constrainedCriteriaList=this._matrixRuleModel.formatJsonModelForXmodelListView(this._jsonModel.constrainedCriteria,"constrained-criteria"),this._drivingCriteriaPresenter.init(this._drivingCriteriaList,this._matrixRuleModel,this._applicationChannel,this._privateChannel,{updateChannel:this._updateChannel,editable:m.editable,resizeSensorEnablerFun:this._workaroundCheckAndWakeUpResizeSensor,reservedbyFullName:m.reservedbyFullName}),this._constrainedCriteriaPresenter.init(this._constrainedCriteriaList,this._matrixRuleModel,this._applicationChannel,this._privateChannel,{updateChannel:this._updateChannel,editable:m.editable,resizeSensorEnablerFun:this._workaroundCheckAndWakeUpResizeSensor}),this._initDivs(),this._subscribeToEvents(),this._msgError="",0!==C._rc){var f="",b=0;for(b=0;b<C._discrepancyIds.length;b+=1)0===b?f=C._discrepancyIds[b]:f+=", "+C._discrepancyIds[b];this._msgError=f+" "+g._HaveNotBeenFoundWhileOpeningRule}""!==this._msgError&&(this._msgError=g._error_missing_criteria,this._updateChannel.publish({event:"mr-global-presenter-error-criteria-not-found",data:this._msgError}),console.warn(this._msgError)),""!==this._msgError&&this._privateChannel.publish({event:"mr-model-change"});var y=this._matrixRuleModel.getJsonModel();0!==y.drivingCriteria.length&&0!==y.constrainedCriteria.length||this._contentrunContainer.classList.add("no-content");let M=this;m.editable&&("build"===this._currentView?setTimeout((function(){M._applicationChannel.publish({event:"open-driving-criteria-variability"})}),500):"run"===this._currentView&&this._showOkCancel())},b.prototype._initDivs=function(){var i=t.compile(C)();this._container=document.createElement("div"),this._container.innerHTML=i,this._container=this._container.firstChild,e.extendElement(this._container),this._alertContainer=this._container.querySelector(".tablerule-alert-container"),this._wizardContainer=this._container.querySelector(".wizard-container"),this._contentDrivingContainer=this._container.querySelector(".contentbuild-container"),this._contentConstrainedContainer=this._container.querySelector(".contentconstrained-container"),this._contentrunContainer=this._container.querySelector(".contentrun-container"),this._alert=new m,this._alert.inject(this._alertContainer),this._tabBar.inject(this._wizardContainer),this._drivingCriteriaPresenter.inject(this._contentDrivingContainer),this._constrainedCriteriaPresenter.inject(this._contentConstrainedContainer),this._runTimePresenter.inject(this._contentrunContainer),e.createElement("div",{class:"no-criteria-container",html:g._noCriteriaSelected}).inject(this._contentrunContainer),"build"===this._currentView?(this._contentrunContainer.classList.add("displaynone"),this._contentConstrainedContainer.classList.add("displaynone"),this._contentDrivingContainer.classList.remove("displaynone")):"run"===this._currentView&&(this._contentDrivingContainer.classList.add("displaynone"),this._contentrunContainer.classList.remove("displaynone"),this._contentrunContainer.classList.remove("no-content")),this._okCancelContainer=this._container.querySelector(".okcancel-footer"),this._createOKCancelActions().forEach((e=>e.inject(this._okCancelContainer)))},b.prototype.getTabBar=function(){return this._tabBar},b.prototype.getView=function(){return this._runTimePresenter.getView()},b.prototype._switchView=function(e){var t=this;switch(e){case 0:this._currentTab="driving-criteria",!0===t._options.editable&&t._solverModelEvent.publish({event:"mr-stop-recursive-call"}),t._contentDrivingContainer.classList.remove("displaynone"),t._contentrunContainer.classList.add("displaynone"),t._contentConstrainedContainer.classList.add("displaynone"),t._drivingCriteriaPresenter.refreshUI(),t._IsActiveCriteriaPanel?t._drivingCriteriaPresenter.highLightCriteriaVariantIcon():t._drivingCriteriaPresenter.resetCriteriaVariantIcon(),t._hideOKCancel();break;case 1:this._currentTab="constrained-criteria",!0===t._options.editable&&t._solverModelEvent.publish({event:"mr-stop-recursive-call"}),t._contentConstrainedContainer.classList.remove("displaynone"),t._contentDrivingContainer.classList.add("displaynone"),t._contentrunContainer.classList.add("displaynone"),t._constrainedCriteriaPresenter.refreshUI(),t._IsActiveCriteriaPanel?t._constrainedCriteriaPresenter.highLightCriteriaVariantIcon():t._constrainedCriteriaPresenter.resetCriteriaVariantIcon(),t._workaroundCheckAndWakeUpResizeSensor(t._constrainedCriteriaPresenter.getContainer()),t._hideOKCancel();break;case 2:if(t._contentrunContainer.classList.contains("displaynone")){t._applicationChannel.publish({event:"information-panel-close"}),t._IsActiveCriteriaPanel=!1,t._contentConstrainedContainer.classList.add("displaynone"),t._contentDrivingContainer.classList.add("displaynone"),t._contentrunContainer.classList.remove("displaynone"),t._privateChannel.publish({event:"mr-refresh-run-view",data:t._options.filter});var i=t._matrixRuleModel._allDrivingCombination,a=t._matrixRuleModel.getJsonModel();i instanceof Promise?(n.mask(this._container),i.then((()=>{n.unmask(this._container),t._contentrunContainer.classList.remove("no-content"),t._privateChannel.publish({event:"mr-refresh-run-view",data:t._options.filter})}))):0===a.drivingCriteria.length||0===a.constrainedCriteria.length||0===a.states.length?t._contentrunContainer.classList.add("no-content"):t._contentrunContainer.classList.remove("no-content")}t._options.editable&&t._showOkCancel()}},b.prototype.loadComments=function(e){let t={id:this._ruleId,dictionaryIds:this._matrixRuleModel.getAllIds(),comments:e};_.updateSocialStatus(t)},b.prototype._subscribeToEvents=function(){var e=this;this._myEventManager.subscribe(this._privateChannel,{event:"widget-preference-update-filter"},(function(t){e._options.filter=t,e._updateChannel.publish({event:"widget-preference-update-filter",data:t})})),this._myEventManager.subscribe(this._privateChannel,{event:"notification-conflict-matrix"},(function(){e._updateChannel.publish({event:"notification-conflict-matrix"})})),this._myEventManager.subscribe(this._privateChannel,{event:"matrix-rule-conflict-computation-done"},(function(){e._updateChannel.publish({event:"matrix-rule-conflict-computation-done"})})),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-comments-fetched"},(function(t){e.loadComments(t)})),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-comments-update-filtered-comments-status"},(function(){e.loadComments()})),this._myEventManager.subscribe(this._privateChannel,{event:"model-app-launch-cell-comment-info"},(function(t){e._updateChannel.publish({event:"model-app-launch-cell-comment-info",data:t})})),this._myEventManager.subscribe(this._privateChannel,{event:"show-loading-conflict-right-panel"},(function(){e._updateChannel.publish({event:"show-loading-right-panel"})})),this._myEventManager.subscribe(this._updateChannel,{event:"criteria-panel-active"},(function(t){e._IsActiveCriteriaPanel=t})),this._myEventManager.subscribe(this._applicationChannel,{event:"model-conflict-panel-closed"},(function(){e._privateChannel.publish({event:"model-conflict-panel-hidden",data:"right"})})),this._myEventManager.subscribe(this._applicationChannel,{event:"information-panel-loaded"},(function(){e.loadComments()})),this._myEventManager.subscribe(this._privateChannel,{event:"xmodel-update-comments-status"},(function(t){e.updateCommentsContext(t)})),this._myEventManager.subscribe(this._applicationChannel,{event:"warning-dialog-cancel-button-clicked"},(function(){console.log("Save canceled")})),this._myEventManager.subscribe(this._updateChannel,{event:"activate-filter-icon"},(function(){e._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:{id:"filter-column",icon:"list-filter"}})})),this._myEventManager.subscribe(this._privateChannel,{event:"cell-selected"},(function(t){e._updateChannel.publish({event:"dgv-cell-selected",data:t})})),this._myEventManager.subscribe(this._applicationChannel,{event:"warning-dialog-dontsave-button-clicked"},(function(t){e._privateChannel.publish({event:"matrui-setprevious-filter"}),t&&(e._applicationChannel.publish({event:"update-ready-to-navigation-flag",data:!0}),t.linkID?e._applicationChannel.publish({event:"breadcrumb-link-clicked",data:t}):t.isBackClicked?window.history.back():e._privateChannelForRules.publish({event:"xmodel-open-conflict-rule",data:t}))})),this._myEventManager.subscribe(this._applicationChannel,{event:"warning-dialog-save-button-clicked"},(function(t){console.log("Save .."),e._ruleSaveAllowed?e._updateChannel.publish({event:"mr-onsave",data:{jsonModel:e._matrixRuleModel.getJsonModel(),model:t}}):e._privateChannel.publish({event:"set-notification-message",data:{className:"error",message:e._ruleSaveErrorMessage}})})),this._myEventManager.subscribe(this._applicationChannel,{event:"triptych-panel-visible"},(function(t){e._privateChannel.publish({event:"conflict-panel-opened",data:!0})})),this._myEventManager.subscribe(this._applicationChannel,{event:"triptych-panel-hidden"},(function(){e._privateChannel.publish({event:"conflict-panel-opened",data:!1})})),this._myEventManager.subscribe(this._solverModelEvent,{event:"checkMatrixRuleValidity_SolverReason"},(function(t){var i=t.answerData._clientData.columnID,n=t.answerData._clientData.rowID;if(t.answerData._clientData.columnID&&t.answerData._clientData.rowID&&(i=t.answerData._clientData.columnID,n=t.answerData._clientData.rowID),i>=0&&n>=0){var a={};switch(a.privateChannelForRules=e._privateChannelForRules,a.statesCausingValues=t.answerData.statesCausingValues[0][n],a.statesValidity=t.answerData.statesValidity[0][n],a.states=t.answerData.states[0][n],a.statesCausingRules=[],a.type=t.answerData._clientData.isConflict?"ConflictRules":"Constraint",a.statesValidity){case"I":case"R":case"T":case"C":a.statesCausingRules=t.answerData.statesCausingRules[0][n];break;default:a.statesCausingRules=[]}if(a.drivingCombinationValues=t.answerData.drivingCombinationValues,a.conflictingRules=[],t.answerData.constrainedValues&&t.answerData.constrainedValues[n].parent){for(var o=t.answerData.constrainedValues[n].parent,r=[],s=0;s<t.answerData.constrainedValues.length;s++)if(t.answerData.constrainedValues[s].parent===o){var l=t.answerData.constrainedValues[s];l&&(l.index=s,r.push(l))}var d=e._mapDico[o];if(d){var c=t.answerData.statesValidity[0],u=t.answerData.states[0],h=0;for(s=0;s<r.length&&("C"===c[r[s].index]&&"N"===u[r[s].index]);s++)h++;"Constraint"!==a.type&&r.length===h&&(a.constrainedCriteria=d,a.type="conflictMandatory")}}var p="";for(s=0;s<t.answerData.drivingCriteria.length;s++){var m=t.answerData.drivingCriteria[s].id;p+=0===s?"":", ",p+=e._mapDico[a.drivingCombinationValues[0][m].variantValue].title}a.drivingCombinationValuesText=p;var v="";a.constrained="",t.answerData.constrainedValues[n]&&(v=t.answerData.constrainedValues[n].id,e._matrixRuleModel._mapDico[v].title&&(a.constrained=e._matrixRuleModel._mapDico[v].title));var _={};_.conflictingRules=t.answerData.statesCausingRules[0][n],_.reasons=a,e._updateChannel.publish({event:"get-rule-details",data:_})}})),this._myEventManager.subscribe(this._solverModelEvent,{event:"checkInvalidColumnCausingRules"},(function(t){if(t.answerData){var i=t.answerData._clientData.columnID,n=t.answerData._clientData.rowID;if(t.answerData._clientData.columnID&&t.answerData._clientData.rowID&&(i=t.answerData._clientData.columnID,n=t.answerData._clientData.rowID),i>=0&&n<-1){var a={};a.privateChannelForRules=e._privateChannelForRules,a.type="InvColumn",a.drivingCombinationsCausingRules=t.answerData.drivingCombinationsCausingRules,a.drivingCombinationValues=t.answerData.drivingCombinationValues,a.conflictingRules=[];for(var o="",r=0;r<t.answerData.drivingCriteria.length;r++){var s=t.answerData.drivingCriteria[r].id;o+=" "+e._mapDico[a.drivingCombinationValues[0][s].variantValue].title}a.drivingCombinationValuesText=o;var l={};l.conflictingRules=t.answerData.drivingCombinationsCausingRules[0],l.reasons=a,e._updateChannel.publish({event:"get-rule-details",data:l})}}})),this._tabBar.modelEvent.subscribe({event:"selectTab"},(function(t){e._switchView(t.index)})),this._myEventManager.subscribe(this._privateChannel,{event:"display-more-details-solver"},(function(){console.log("receiving display-more-details-solver")})),this._myEventManager.subscribe(this._privateChannel,{event:"mr-model-change"},(function(){e._buttonOk.enable(),e._privateChannel.publish({event:"mr-rule-save-allow",data:{allow:!0}}),e._updateChannel.publish({event:"mr-model-change"}),e._applicationChannel.publish({event:"update-ready-to-navigation-flag",data:!1})})),this._myEventManager.subscribe(this._privateChannel,{event:"set-notification-message"},(function(t){e._alert.add(t),e._alert.show()})),this._myEventManager.subscribe(this._privateChannel,{event:"mr-rule-save-allow"},(function(t){t&&(e._ruleSaveAllowed=!0===t.allow,e._ruleSaveAllowed?e._ruleSaveErrorMessage="":e._ruleSaveErrorMessage=t.message)})),this._myEventManager.subscribe(this._privateChannel,{event:"switch-view-allow"},(function(t){e._isReadyToSwitch=!0===t,e._wizardContainer&&(e._isReadyToSwitch?e._wizardContainer.classList.remove("switch-disabled"):e._wizardContainer.classList.add("switch-disabled"))})),this._updateChannel.subscribe({event:"mr-reload-table"},(function(){e._runTimePresenter.refreshUI()})),this._myEventManager.subscribe(this._privateChannel,{event:"get-mr-details"},(function(t){e._updateChannel.publish({event:"get-rule-details-for-tooltip",data:t})}))},b.prototype.attachResizeSensor=function(){this._runTimePresenter.attachResizeSensor()},b.prototype.inject=function(e){e.appendChild(this._container)},b.prototype.destroy=function(){this._runTimePresenter&&(this._runTimePresenter._clearPreviousEvents(),this._runTimePresenter.destroy()),this._drivingCriteriaPresenter&&this._drivingCriteriaPresenter.destroy(),this._constrainedCriteriaPresenter&&this._constrainedCriteriaPresenter.destroy(),this._myEventManager.cleanup("GlobalPresenter")},b.prototype._createOKCancelActions=function(){var t=this;this._myEventManager.subscribe(this._updateChannel,{event:"mr-onsavedone"},(function(){t._applicationChannel.publish({event:"update-ready-to-navigation-flag",data:!0})})),this._myEventManager.subscribe(this._updateChannel,{event:"update-json-model-on-mr-save"},(function(i){t._jsonModel=t._matrixRuleModel.getJsonModel(),t._inputJsonModel=e.clone(t._jsonModel),i.model&&(i.model.linkID?(t._applicationChannel.publish({event:"update-ready-to-navigation-flag",data:!0}),t._applicationChannel.publish({event:"breadcrumb-link-clicked",data:i.model})):i.model.isBackClicked?window.history.back():t._privateChannelForRules.publish({event:"xmodel-open-conflict-rule",data:i.model})),console.log("updating json model on mr save done"),t._buttonOk.disable()}));var i=new p({value:g._save,className:"primary"});i.addEvent("onClick",(function(){t._ruleSaveAllowed?t._updateChannel.publish({event:"mr-onsave",data:{jsonModel:t._matrixRuleModel.getJsonModel()}}):t._privateChannel.publish({event:"set-notification-message",data:{className:"error",message:t._ruleSaveErrorMessage}})}));var n=new p({value:g._cancel,className:"default"});return n.addEvent("onClick",(function(){t.refreshUI(t._inputJsonModel),t.restartAsyncCall(),t._applicationChannel.publish({event:"update-ready-to-navigation-flag",data:!0}),t._buttonOk.disable()})),t._buttonOk=i,t._buttonOk.disable(),[i,n]},b.prototype._showOkCancel=function(){this._okCancelContainer.classList.remove("displaynone"),this._contentDrivingContainer.classList.add("with-footer"),this._contentrunContainer.classList.add("with-footer"),this._contentConstrainedContainer.classList.add("with-footer"),this._contentrunContainer.classList.contains("displaynone")||this._privateChannel.publish({event:"mr-resize"})},b.prototype._hideOKCancel=function(){this._okCancelContainer.classList.add("displaynone"),this._contentDrivingContainer.classList.remove("with-footer"),this._contentConstrainedContainer.classList.remove("with-footer"),this._contentrunContainer.classList.remove("with-footer")},b.prototype.restartAsyncCall=function(){this._contentrunContainer.classList.contains("displaynone")||this._runTimePresenter.restartAsyncCallSolver()},b.prototype.refreshUI=function(t){n.mask(this._container),this._jsonModel=t?e.clone(t):null,this._jsonModel||(this._jsonModel={drivingCriteria:[],constrainedCriteria:[],constrainedValues:[],drivingCombinationValues:[],states:[],statesValidity:[],version:"3.0"}),(this._jsonModel.states||0===this._jsonModel.states.length)&&(this._currentView="build",this._jsonModel.drivingCriteria&&this._jsonModel.constrainedCriteria&&(0!==this._jsonModel.drivingCriteria.length&&0!==this._jsonModel.constrainedCriteria.length&&0!==this._jsonModel.states.length||this._contentrunContainer.classList.add("no-content"))),this._matrixRuleModel.setJsonModel(this._jsonModel),this._drivingCriteriaList=this._matrixRuleModel.formatJsonModelForXmodelListView(this._jsonModel.drivingCriteria,"driving-criteria"),this._drivingCriteriaPresenter.loadData(this._drivingCriteriaList),this._constrainedCriteriaList=this._matrixRuleModel.formatJsonModelForXmodelListView(this._jsonModel.constrainedCriteria,"constrained-criteria"),this._constrainedCriteriaPresenter.loadData(this._constrainedCriteriaList),this.refreshUICriteriaPanel(this._currentTab),this._runTimePresenter.refreshUI(),n.unmask(this._container)},b.prototype.refreshUICriteriaPanel=function(e){var t=this;this._applicationChannel.publish({event:"triptych-fetch-panel-visibility-status",data:function(i){i&&!0===i.right&&t._updateChannel.publish({event:"refresh-criteria-panel",data:e})}})},b.prototype.addListCriteriaTo=function(e,t){let i=[],n=[];switch(Array.isArray(e)&&e.forEach((e=>{n=e.item.options&&Array.isArray(e.item.options.member)?[...n,...e.item.options.member]:[...n,e.item]})),n.forEach((e=>{i.push(e.id)})),t){case"driving-criteria":this._drivingCriteriaPresenter.addCriteriaCombination(e);break;case"constrained-criteria":this._constrainedCriteriaPresenter.addCriteriaCombination(e)}this.updateCommentsContext(i)},b.prototype.updateCommentsContext=function(e){_.updateContext(this._ruleId,e,this._matrixRuleModel.getAllIds())},b.prototype.getListDrivingCriteriaAndRefresh=function(){return this._drivingCriteriaList=this._matrixRuleModel.formatJsonModelForXmodelListView(this._matrixRuleModel.__jsonModel.drivingCriteria,"driving-criteria"),this._drivingCriteriaList},b.prototype.getListConstrainedCriteriaAndRefresh=function(){return this._constrainedCriteriaList=this._matrixRuleModel.formatJsonModelForXmodelListView(this._matrixRuleModel.__jsonModel.constrainedCriteria,"constrained-criteria"),this._constrainedCriteriaList},b}));