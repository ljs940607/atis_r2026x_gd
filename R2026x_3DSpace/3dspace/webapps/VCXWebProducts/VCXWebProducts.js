define("DS/VCXWebProducts/VCXCameraPlayModeCmd",["DS/ApplicationFrame/CommandCheckHeader"],(function(e){"use strict";return e.extend({init:function(e){this._parent(e,{});var t=this;this.onStateChange((function(){var e=t.getFrameWindow()._experienceBase;if(e){var n=e.getManager("VCXVisuManager");n&&(t.getState()?n.setUpdateViewport(!0):n.setUpdateViewport(!1))}})),this.setState(!0)}})})),define("DS/VCXWebProducts/VCXSwapVisibleSpace",["DS/ApplicationFrame/CommandCheckHeader"],(function(e){"use strict";const t=e.extend({});return t.check=function(e,t){const n=t.executionContext.getComponent("StoryTeller").getExperienceBase().getManager("VCXVisuManager");n&&n.setNonVisibleSpaceState(!0),e()},t.uncheck=function(e,t){const n=t.executionContext.getComponent("StoryTeller").getExperienceBase().getManager("VCXVisuManager");n&&n.setNonVisibleSpaceState(!1),e()},t}));var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebProducts/VCXAFRCmdBase",["require","exports","DS/VCXWebSystem/VCXAdvancedEventService"],(function(e,t,n){"use strict";n=__importDefault(n);return class{constructor(e,t){if(this.wuxTokens={},this.isCancelled=!1,this.options=e,this._id=this.options.ID,!e.executionContext)throw new Error("No ExecutionContext, VCXAFRCmdBase is only for TS WAFR Commands !");this._experienceBase=e.executionContext.getComponent("StoryTeller").getExperienceBase(),e.arguments=[e.args],this.executionContext=e.executionContext,this.isAsynchronous=t?.isAsynchronous??!1,this.odtCmd=t?.odtCmd??!1,this._eventKeyDown=this.doKeyDownAction.bind(this),document.addEventListener("keydown",this._eventKeyDown),this._beginExecute=this.beginExecute,this.beginExecute=async()=>{if(this._broadcastEvent("PRE_BEGIN"),this.isCancelled)return this.done();this._broadcastEvent("BEGIN"),await this._beginExecute(),this._broadcastEvent("POST_BEGIN")}}async done(e){}async doKeyDownAction(e){if(e.repeat)return;"esc"===UWA.Event.whichKey(e)&&await this.done({cancel:!0})}setCancel(e){this.isCancelled=e}async beginExecute(){this.executionContext&&(await this.execute(),this.isAsynchronous||this.end())}async execute(){}async endExecute(){}async pauseExecute(){await this.done()}async resumeExecute(){await this.execute()}async cancelExecute(){await this.endExecute(),await this.done({undoOnEnd:!1})}_broadcastEvent(e){let t=this._experienceBase?.getManager("VCXContextManager");t&&n.default.publish({event:"/WUX/AFR/CMD/"+t.getContext()+"/"+e,data:this})}getFrameWindow(){return this._experienceBase.getManager("VCXContextManager").getFrameWindow()}getId(){return this._id}isRunning(){return this.executionContext.getComponent("AFR_CommandsManager").getRunningCommand()===this.getId()}async end(){await this.endExecute(),await this.done()}destroy(){document.removeEventListener("keydown",this._eventKeyDown),this._broadcastEvent("END"),this.unsubscribeEvents()}unsubscribeEvents(){for(let e in this.wuxTokens)this.wuxTokens.hasOwnProperty(e)&&n.default.unsubscribe(this.wuxTokens[e])}static getExperienceBaseFromParametersFunction(e){const t=e?.executionContext,n=t?.getComponent("StoryTeller");return n?.getExperienceBase()??null}}})),define("DS/VCXWebProducts/VCXPlayGuidedTourUI",["UWA/Class","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","i18n!DS/VCXWebProducts/assets/nls/VCXWebProducts","css!DS/VCXWebProducts/VCXWebProducts.css"],(function(e,t,n,i,a){"use strict";return e.extend({init:function(e){this._modelEvent=new n,this.buttonsTooltipsStr={terminate:i.GuidedTourTerminateButton}},destroy:function(){this.terminateUI(),this.buttonsTooltipsStr=null,this._modelEvent=null},setplayGuidedTourUI:async function(e){var n=e._experienceBase.getManager("VCXGUIManager").getGUIServices();this.preHidingConfig=await n.hideDockingElements(e),e.getActionBar().hide(),this._setImmersiveUICustomization(!0),this.frmWindow=e;var i=this.frmWindow.getUIFrame();this._container=UWA.createElement("div",{html:"",class:"guidedTourGUI pauseOnClickCurtain atCmdLaunch paused"}),this._playPauseButton=UWA.createElement("div",{html:"",class:"VCXWebGuidedTourGUI__PlayPauseButton playIcon"}),this._playPauseButton.inject(this._container),this._terminateButton=UWA.createElement("div",{html:"",class:"guidedTourGUI__terminateButton",title:this.buttonsTooltipsStr.terminate}),this._terminateButton.inject(this._container);var a=document.getElementById("PlayWeb-TopMenu");a&&a.classList.add("shifted"),this._waitingContainer=UWA.createElement("div",{html:"",class:"pauseWaitingContainer"});for(var s=0;s<4;++s){UWA.createElement("div",{html:"",class:"pauseWaitingBar"}).inject(this._waitingContainer)}this.terminateUICB=this._publishEvent.bind(this,"terminate"),this.togglePlayPauseCB=this._togglePlayPauseUI.bind(this),this._terminateButton.addEventListener("click",this.terminateUICB),this._playPauseButton.addEventListener("click",this.togglePlayPauseCB),this._container.addEventListener("click",this.togglePlayPauseCB);var r=this;this.tokenSubscribeEnd=t.subscribe({event:"VCX_PLAY_GUIDED_TOUR_END"},(function(e){r._setPauseWaitingAnimation(!1),r._container.classList.contains("playing")&&r.displayUI(),r._deactivateCustoImmersiveUIArrow()})),this.tokenSubscribeGoToScen=t.subscribe({event:"VCX_PLAY_GUIDED_TOUR_GOTOSCENARIO"},(function(e){r._activateCustoImmersiveUIArrow(e.currentScenarioIdx<e.nextScenarioIdx)})),this.tokenSubscribeGoToScen=t.subscribe({event:"VCX_PLAY_GUIDED_TOUR_GOTOSCENARIO_END"},(function(e){r._deactivateCustoImmersiveUIArrow()})),this._container.inject(i)},terminateUI:function(e){if(e&&e.stopPropagation(),this.frmWindow){var n=this.frmWindow._experienceBase.getManager("VCXGUIManager").getGUIServices();if(this.preHidingConfig=n.restoreDockingElements(this.frmWindow,this.preHidingConfig),this.frmWindow.getActionBar().show(),this._container){this.tokenSubscribeEnd&&t.unsubscribe(this.tokenSubscribeEnd),this.tokenSubscribeEnd=null,this._terminateButton.removeEventListener("click",this.terminateUICB),this._playPauseButton.removeEventListener("click",this.togglePlayPauseCB),this._container.removeEventListener("click",this.togglePlayPauseCB),this.terminateUICB=null,this.togglePlayPauseCB=null,this.togglePlayPauseCB=null;for(var i=this._waitingContainer.getChildren(),a=0;a<i.length;++a){var s=i[a];s&&s.destroy()}this._waitingContainer.destroy(),this._terminateButton.destroy();var r=document.getElementById("PlayWeb-TopMenu");r&&r.classList.contains("shifted")&&r.classList.remove("shifted"),this._playPauseButton.destroy(),this._container.destroy()}this.frmWindow=null}else console.log("No Framewindow available anymore..")},displayUI:function(){this._playPauseButton.classList.contains("pauseIcon")&&(this._userInteraction?(this._setPauseWaitingAnimation(!0),this._userInteraction=!1):(this._playPauseButton.classList.remove("pauseIcon"),this._playPauseButton.classList.add("playIcon"))),this._container.classList.contains("pauseOnClickCurtain")&&this._container.classList.remove("pauseOnClickCurtain"),this._container.classList.contains("playing")&&this._container.classList.replace("playing","paused"),this._setImmersiveUICustomization(!1)},hideUI:function(){this._container.classList.contains("atCmdLaunch")&&this._container.classList.remove("atCmdLaunch"),this._playPauseButton.classList.contains("playIcon")&&this._playPauseButton.classList.replace("playIcon","pauseIcon"),this._container.classList.contains("pauseOnClickCurtain")||this._container.classList.add("pauseOnClickCurtain"),this._container.classList.contains("paused")&&this._container.classList.replace("paused","playing"),this._setImmersiveUICustomization(!0),this._userInteraction=!1},subscribe:function(e,t){if(this._modelEvent)return this._modelEvent.subscribe({event:e},t)},unsubscribe:function(e){this._modelEvent&&this._modelEvent.unsubscribe(e)},togglePlayPauseUIODT:function(e){"replay"===e.odt&&(this._playPauseButton.classList.contains("playIcon")||this._playPauseButton.classList.contains("pauseIcon"))&&(this._userInteraction=!0,this._publishEvent("togglePlayPause"))},_activateCustoImmersiveUIArrow:function(e){this._toggleActivationCustoImmersiveUIArrow(!0,{ibNextArrow:e})},_deactivateCustoImmersiveUIArrow:function(){this._toggleActivationCustoImmersiveUIArrow(!1)},_toggleActivationCustoImmersiveUIArrow:function(e,t){for(var n=document.getElementsByClassName("VCXScenarioUI_loading"),i=0;i<n.length;++i){var a=n[i],s=a.closest(".forPlayGuidedTourCmd");if(s)if(e){var r=t.ibNextArrow;if(r&&s.hasClassName("VCXRightArrow")||!r&&s.hasClassName("VCXLeftArrow")){a.removeClassName("hide"),s.addClassName("inTransition");break}}else a.addClassName("hide"),s.removeClassName("inTransition")}},_togglePlayPauseUI:function(e){e&&e.currentTarget===this._playPauseButton&&e.stopPropagation(),(this._playPauseButton.classList.contains("playIcon")||this._playPauseButton.classList.contains("pauseIcon"))&&(this._userInteraction=!0,this._publishEvent("togglePlayPause"))},_setPauseWaitingAnimation:function(e){!this._waitingContainer&&this._playPauseButton||(e?(this._waitingContainer&&this._waitingContainer.inject(this._playPauseButton),this._playPauseButton.classList.replace("pauseIcon","pauseInWait")):(this._waitingContainer&&this._waitingContainer.remove(),this._playPauseButton.classList.remove("pauseInWait"),this._playPauseButton.classList.add("playIcon")))},_setImmersiveUICustomization:function(e){var t=document.getElementsByClassName("VCXScenariosUIArrow"),n=0;for(n=0;n<t.length;++n){var i=t[n];e?i.addClassName("forPlayGuidedTourCmd"):i.removeClassName("forPlayGuidedTourCmd")}var a=document.getElementsByClassName("VCXScenariosUIDots_container");for(n=0;n<a.length;++n){var s=a[n];e?s.addClassName("forPlayGuidedTourCmd"):s.removeClassName("forPlayGuidedTourCmd")}},_publishEvent:function(e){this._modelEvent.publish({event:e,data:{eventChannel:e}})}})})),define("DS/VCXWebProducts/VCXAFRAdaptatorCmdBase",["DS/ApplicationFrame/Command","DS/CoreEvents/Events"],(function(e,t){"use strict";return e.extend({init:function(e,t){this.options=e,e.executionContext?(this._experienceBase=e.executionContext.getComponent("StoryTeller").getExperienceBase(),e.arguments=[e.args],this.executionContext=e.executionContext):this._parent(e,t),this.isCancelled=!1,this.isAsynchronous=!(!t||!t.isAsynchronous)&&t.isAsynchronous,this.odtCmd=t&&t.odtCmd,this._eventKeyDown=this.doKeyDownAction.bind(this),document.addEventListener("keydown",this._eventKeyDown),this._beginExecute=this.beginExecute,this.beginExecute=async()=>{if(this.broadcastEvent("PRE_BEGIN"),this.isCancelled)return this.done();this.broadcastEvent("BEGIN"),await this._beginExecute(),this.broadcastEvent("POST_BEGIN")}},doKeyDownAction:async function(e){e.repeat||"esc"===UWA.Event.whichKey(e)&&await this.done&&this.done({cancel:!0})},beginExecute:async function(){this.executionContext&&(this._globalEvtID=this._evtID,this.execute&&await this.execute(),this.isAsynchronous||this.end())},setCancel(e){this.isCancelled=e},broadcastEvent(e){let n=this._experienceBase&&this._experienceBase.getManager("VCXContextManager");n&&t.publish({event:"/WUX/AFR/CMD/"+n.getContext()+"/"+e,data:this})},isWAFR(){return!!this.executionContext},getFrameWindow:function(){return this.executionContext?this._experienceBase.getManager("VCXContextManager").getFrameWindow():this._parent()},isRunning:function(){return this.executionContext?this.executionContext.getComponent("AFR_CommandsManager").getRunningCommand()===this.getId():this._parent()},enable:function(){this.executionContext&&console.warn("Did nothing, you can't do that with WAFR, check the wiki page"),this._parent()},disable:function(){this.executionContext&&console.warn("Did nothing, you can't do that with WAFR, check the wiki page"),this._parent()},isWAFR(){return!!this.executionContext},end:async function(){if(!this.executionContext)return this._parent();this.endExecute&&await this.endExecute(),this.done&&await this.done()},pauseExecute:async function(){this.executionContext&&this.done&&await this.done()},resumeExecute:async function(){this.executionContext&&this.execute&&await this.execute()},cancelExecute:async function(){this.executionContext&&(this.endExecute&&await this.endExecute(),this.done&&await this.done({undoOnEnd:!1}))},destroy(){document.removeEventListener("keydown",this._eventKeyDown),this.broadcastEvent("END")}})})),define("DS/VCXWebProducts/VCXPlayGuidedTourModel",["UWA/Class","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCmdGoToScenarioWithInterpolation","DS/VCXWebKernelCommands/VCXCmdPlayScenario"],(function(e,t,n,i){"use strict";return e.extend({init:function(){this._pauseRequested=!1,this.setGuidedTourOccurring(!1),this._nbSecsForWaiting=5;var e=this;this.tokenSubscribeEnd=t.subscribe({event:"VCX_PLAY_GUIDED_TOUR_END"},(function(t){e._pauseRequested=!1,e.setGuidedTourOccurring(!1)}))},destroy:function(){this._pauseRequested=null,this._guidedTourOccurring=null,t.unsubscribe(this.tokenSubscribeEnd)},setSecondsForWaiting:function(e){this._nbSecsForWaiting=e},setPauseRequested:function(e){this._pauseRequested=!0;for(var t=e.getManager("VCXScenarioManager"),n=Object.keys(t._scenariosToPlay).length-1;n>=0;--n){var i=t._scenariosToPlay[n];t.StopPlayingScenario(i)}},getPauseRequested:function(){return this._pauseRequested},setGuidedTourOccurring:function(e){this._guidedTourOccurring=e},getGuidedTourOccurring:function(){return this._guidedTourOccurring},checkScenarioPresence:function(e){var t=e.getManager("VCXSequenceManager");if(!t)return!1;for(var n=t.GetListSequencesFromType(0),i=0;i<n.length;i++){var a=n[i];a.QueryInterface("VCXIModifiable");if(a.GetListScenariosId().length>0)return!0}return!1},getListAllScenarios:function(e,t){var n=e.getManager("VCXSequenceManager"),i=e.getManager("VCXScenarioManager");let a;var s=n.GetListSequencesFromType(0);a=[];for(var r=0;r<s.length;r++)for(var o=s[r].GetListScenariosId(),c=0;c<o.length;c++){var u=o[c],l=i.GetScenarios()[u];if(l){if(t&&l.GetConcealed())continue;a.push(l)}}return a},getIdxNextScenToPlay:function(e,t){var n=e.getManager("VCXScenarioManager").GetCurrentScenario();if(""===n)return 0;var i=e.getManager("VCXSequenceManager"),a=i.GetListSequencesFromType(0);let s=[];for(var r=0;r<a.length;++r)s=s.concat(i.GetListScenariosInSequence(a[r]));let o=-1,c=-1;for(let e=0;e<s.length;e++){if(s[e].GetID()===n){o=e;break}}if(c=o+1,t)for(;s[c]&&s[c].GetConcealed();)c++;return s[c]?c+1:(console.error("no scene was found after the current one!"),-1)},getNextScenToPlay:function(e,t){return this.getListAllScenarios(e)[this.getIdxNextScenToPlay(e,t)-1]},runGuidedTour:function(e){var t=this.getNextScenToPlay(e,!0),a=e.getManager("VCXScenarioManager"),s=e.getManager("VCXSequenceManager"),r=e.getManager("VCXCommandManager"),o=this.getListAllScenarios(e,!0);let c=s.GetSequenceFromId(s.GetCurrentSequenceID());var u=this;for(o.sort(((e,t)=>c.GetIndexOfScenario(e)-c.GetIndexOfScenario(t)));0!==o.length&&o.shift()!==t;);var l=async function(t){if(0===o.length||u._pauseRequested)u._publishGuidedTourEvent("end");else{var n=new i(e);n.PlayScenario(t),n.SetCallback(d,t),await r.Do(n)}},d=async function(t){if(u._pauseRequested)return void u._publishGuidedTourEvent("end");0===o.length&&(o=this.getListAllScenarios(e,!0));let n=o.shift();var s=e.Factory.BuildComponent("VCXScenario");s.SetPersistency(2),s.SetApplyNeutralAtGoToScenario(!1),s.SetMaxFrame(a.GetFPS()*u._nbSecsForWaiting),s._bWait=!0;var c=new i(e);c.PlayScenario(s),c.SetCallback(h,n),await r.Do(c)},h=async function(t){if(u._pauseRequested)u._publishGuidedTourEvent("end");else{var i=l,a=t;if(u.customGoToScenario)u.customGoToScenario(t,i,a);else{var s=new n(e);s.BuildTransitionTo(t),s.SetCallback(i,a),await r.Do(s)}}};this._publishGuidedTourEvent("begin"),this.setGuidedTourOccurring(!0),h(t)},_publishGuidedTourEvent:function(e,n){t.publish({event:"VCX_PLAY_GUIDED_TOUR_"+e.toUpperCase(),data:n})}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebProducts/VCXShowSelectionCmd",["require","exports","DS/VCXWebProducts/VCXAFRCmdBase","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebKernelCommands/VCXCmdChangeVisibility"],(function(e,t,n,i,a){"use strict";n=__importDefault(n),i=__importDefault(i),a=__importDefault(a);class s extends n.default{async execute(){var e=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection().filter((e=>{let t=e.QueryInterface("VCXIVisibility");return t&&t.GetVisibility()===i.default.EVisState.Hidden})),t=new a.default(this._experienceBase);t.ChangeVisibility(e,i.default.EVisState.Visible),this._experienceBase.getManager("VCXCommandManager").Push(t)}}return s}));var __decorate=this&&this.__decorate||function(e,t,n,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(r=(s<3?a(r):s>3?a(t,n,r):a(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebProducts/VCXTransformFreeDragCmd",["require","exports","DS/VCXWebVisu/VCXModifiablesAccess","DS/VCXWebModifiablesServices/VCXModifiablesServices","DS/VisuEvents/EventsManager","DS/VCXWebProducts/VCXAFRCmdBase","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXEvent","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey"],(function(e,t,n,i,a,s,r,o,c){"use strict";s=__importDefault(s),r=__importDefault(r),o=__importDefault(o),c=__importDefault(c);class u extends s.default{constructor(e){super(e,{isAsynchronous:!0}),this.inProgress=!1,this._isDragging=!1}async beginExecute(){let e=this._experienceBase.getManager("VCXContextManager").getMainViewer();this.pointerDownToken=a.addEvent(e?.div,"onPrimaryPointerDownUnique",this._onPointerDownCB.bind(this))}executeFreeDragODT(e){var t=e.origin,n=e.target,i=this._experienceBase.ComponentsMap.GetComponentsFromIDs(e.componentsIDs).map((e=>e.QueryInterface("VCXIModifiable")));this._translateFromOriginToTarget(t,n,i)}_onPointerDownCB(e){const t=this._experienceBase.getManager("VCXManipulatorManager");if(t&&t.manipulatorPreActivated)return;if(this.inProgress)return;let s=this._experienceBase.getManager("VCXContextManager").getMainViewer();if(s){var c,u=s.getMousePosition(e.from[0].getCurrentPosition(s.div)),l=s.pick(u,"mesh",!0);l&&l.path&&l.path.length>0&&(c=l.path[0].clone());var d=c&&n.GetModifiableFromPathElement(c,this._experienceBase);if(d){var h=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection("VCXComponentOccurrenceExt");if(!d.GetObject().IsKindOf("VCXComponentOccurrenceExt"))return;var C=[];if(d.GetObject().IsKindOf("VCXComponentOccurrenceExt"))C=h.map((e=>e.QueryInterface("VCXIModifiable"))),0!==(C=i.filterChildrenOfModsFromArray(C)).length&&this.checkPickedComponentHasAncestorInArray(d,C)||d.GetObject().IsKindOf("VCXComponentOccurrenceExt")&&(C=[d]);s.currentViewpoint.setControlActive({viewpoint:!1}),s.setPrePicking({activated:!1}),s.setPicking({activated:!1,trapSelection:!1});var p=l.position.clone(),g=(new r.default.Vector3).subVectors(s.currentViewpoint.target,s.currentViewpoint.position).normalize(),m=new r.default.Plane(g,0).setFromNormalAndCoplanarPoint(g,p);this._initInfos={data:e,pickInfo:l,modifiablesArray:C,plane3D:m,mousePos:u},this._isDragging=!1,this._lastPosition=p;this._experienceBase.getManager("VCXGUIManager").SetCursor("grabbing"),this._experienceBase.getManager("VCXCommandManager").StartTransaction(),o.default.subscribe(this,"/VISU/onPrimaryPointerMove",this._translate),this.pointerUpToken=a.addEvent(s.div,"onPrimaryPointerUpUnique",this._disposeEvents.bind(this)),this.inProgress=!0}}}_onPointerMoveCB(e){const t=this._experienceBase.getManager("VCXManipulatorManager");if(t&&t.manipulatorPreActivated)return;let i=this._experienceBase.getManager("VCXContextManager").getMainViewer();if(!i)return;const a=this._experienceBase.getManager("VCXGUIManager");if(!this._initInfos){var s,r=i.getMousePosition(e.from[0].getCurrentPosition(i.div)),o=i.pick(r,"mesh",!0);o&&o.path&&o.path.length>0&&(s=o.path[0].clone());var c=s&&n.GetModifiableFromPathElement(s,this._experienceBase);c&&c.GetObject().IsKindOf("VCXComponentOccurrenceExt")?a.SetCursor("grab"):a.SetCursor("default")}}_translate(e){let t=this._experienceBase.getManager("VCXContextManager").getMainViewer();if(t&&this._initInfos&&this._lastPosition){var n=t.getMousePosition(e.from[0].getCurrentPosition(t.div));if(!this._isDragging){var i=this._initInfos.mousePos;if(Math.max(Math.abs(n.xPix-i.xPix),Math.abs(n.yPix-i.yPix))<3)return;this._isDragging=!0}var a=t.pick(n,"mesh",!1).ray.intersectPlane(this._initInfos.plane3D),s=this._initInfos.modifiablesArray;this._translateFromOriginToTarget(this._lastPosition,a,s),this._lastPosition=a.clone()}}_translateFromOriginToTarget(e,t,n){for(var a=(new r.default.Vector3).subVectors(t,e),s=new c.default(this._experienceBase),o=0;o<n.length;++o){var u=n[o];if(u){var l=i.buildPropertyLocationWithTranslationInWCS(u,a);s.ChangeProperty(n[o],l)}}this._experienceBase.getManager("VCXCommandManager").Push(s)}_disposeEvents(){let e=this._experienceBase.getManager("VCXContextManager").getMainViewer();if(!e)return;const t=this._experienceBase.getManager("VCXGUIManager");if(o.default.unsubscribeMethod(this,"/VISU/onPrimaryPointerMove",this._translate),a.removeEventFromToken(this.pointerUpToken),this.pointerUpToken=null,this.inProgress=!1,this._experienceBase.getManager("VCXCommandManager").EndTransaction("Free Drag"),t.SetCursor("grab"),e.currentViewpoint.setControlActive({viewpoint:!0}),e.setPrePicking({activated:!0},!0),e.setPicking({activated:!0,trapSelection:!0},!0),"record"===this._experienceBase.odt&&this._isDragging){var n={commandName:"VCXTransformFreeDragCmd",componentsIDs:this._initInfos.modifiablesArray.map((e=>e.GetObject().GetID())),origin:this._initInfos.pickInfo.position.createJSON(),target:this._lastPosition.createJSON()};this._experienceBase.getManager("VCXODTManager").LogAPI("VCXExecuteFreeDrag",n)}this._initInfos=null,this._isDragging=!1}async endExecute(){this._experienceBase.getManager("VCXGUIManager").SetCursor("default"),this.pointerDownToken&&a.removeEventFromToken(this.pointerDownToken),this._lastPosition=null}checkPickedComponentHasAncestorInArray(e,t){if(t.includes(e))return!0;for(var n=e.QueryInterface("VCXIModelNavigable"),i=0;i<t.length;++i){if(t[i].QueryInterface("VCXIModelNavigable").isAncestorOf(n))return!0}return!1}}return __decorate([o.default.subscribeAll],u.prototype,"beginExecute",null),__decorate([o.default.Handler("/ODT/VCXTransformFreeDragCmd")],u.prototype,"executeFreeDragODT",null),__decorate([o.default.Handler("/VISU/onPrimaryPointerMove")],u.prototype,"_onPointerMoveCB",null),__decorate([o.default.unsubscribeAll],u.prototype,"endExecute",null),u}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebProducts/VCXRedoCmd",["require","exports","DS/VCXWebProducts/VCXAFRCmdBase"],(function(e,t,n){"use strict";n=__importDefault(n);class i extends n.default{async execute(){this._experienceBase.getManager("VCXExperience")._bPreviewMode&&this._experienceBase.getManager("VCXPulseManager")&&await new Promise((e=>this._experienceBase.getManager("VCXPulseManager").StopPulse(e))),this._experienceBase.getManager("VCXCommandManager").Redo()}}return i}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebProducts/VCXUndoCmd",["require","exports","DS/VCXWebProducts/VCXAFRCmdBase"],(function(e,t,n){"use strict";n=__importDefault(n);class i extends n.default{async execute(){this._experienceBase.getManager("VCXExperience")._bPreviewMode&&this._experienceBase.getManager("VCXPulseManager")&&await new Promise((e=>this._experienceBase.getManager("VCXPulseManager").StopPulse(e))),this._experienceBase.getManager("VCXCommandManager").Undo()}}return i}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebProducts/VCXInvertVisibilityCmd",["require","exports","DS/VCXWebProducts/VCXAFRCmdBase","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebKernelCommands/VCXCmdChangeVisibility"],(function(e,t,n,i,a){"use strict";n=__importDefault(n),i=__importDefault(i),a=__importDefault(a);class s extends n.default{async execute(){var e=this._experienceBase.ComponentsMap.GetComponentFromType("VCXWebComponentOccurrence"),t=[],n=[];for(let a of e){var s,r=a.IsKindOf("VCXDressup_Spec");if(a.IsKindOf("VCXComponentOccurrenceComposer")&&a.IsMesh())(s=a.QueryInterface("VCXIVisibility"))&&(s.GetVisibility()===i.default.EVisState.Hidden?t.push(a):n.push(a));if(r)(s=a.QueryInterface("VCXIVisibility"))&&(s.GetVisibility()===i.default.EVisState.Hidden?t.push(a):n.push(a))}var o=new a.default(this._experienceBase);o.ChangeVisibility(n,i.default.EVisState.Hidden),this._experienceBase.getManager("VCXCommandManager").Do(o);var c=new a.default(this._experienceBase);c.ChangeVisibility(t,i.default.EVisState.Visible),this._experienceBase.getManager("VCXCommandManager").Do(c)}}return s}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebProducts/VCXApplyToAmbienceCmd",["require","exports","DS/VCXWebProducts/VCXAFRCmdBase","DS/VCXWebKernelCommands/VCXCmdApplyTo"],(function(e,t,n,i){"use strict";n=__importDefault(n),i=__importDefault(i);class a extends n.default{async execute(){var e=this._experienceBase.getManager("VCXContextManager"),t=e?.getActiveViewport()?.getActiveAmbienceID(),n=t&&this._experienceBase.ComponentsMap.GetComponentFromID(t);const a=i.default.checkSelectionContext(this._experienceBase,{scenariosFilter:"all",dressups:[n]}),s=new i.default(this._experienceBase,a);this._experienceBase.getManager("VCXCommandManager").Push(s)}}return a}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebProducts/VCXMoveRobotOnBBoxCenterCmd",["require","exports","DS/Robot/Robot","DS/VCXWebModifiablesServices/VCXModifiablesServices","DS/VCXWebProducts/VCXAFRCmdBase","DS/Visualization/ThreeJS_DS"],(function(e,t,n,i,a,s){"use strict";a=__importDefault(a),s=__importDefault(s);class r extends a.default{async execute(){this._displayBBoxCenter()}_displayBBoxCenter(){var e=this._experienceBase.getManager("VCXContextManager").getMainViewer(),t=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO");if(t.filter((function(e){return e.IsKindOf("VCXWebComponentOccurrence")&&!e.IsDressup})),t.length>0&&e){var a=e.getRobot();if(!(a instanceof n))return void console.error("No robot found..");a.connect(),a.fixedSizeNode3D.setRatio(7);var r=i.getBBoxInWorldFromComponents(t).center(),o=(new s.default.Matrix4).setPosition(r);a.setRobotMatrix(o),e.render()}}}return r}));__decorate=this&&this.__decorate||function(e,t,n,i){var a,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(r=(s<3?a(r):s>3?a(t,n,r):a(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebProducts/VCXTransformCmd",["require","exports","DS/Robot/Robot","DS/VCXWebProducts/VCXAFRCmdBase","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXEvent"],(function(e,t,n,i,a,s){"use strict";i=__importDefault(i),a=__importDefault(a),s=__importDefault(s);class r extends i.default{constructor(e){super(e,{isAsynchronous:!0})}async beginExecute(){await super.beginExecute(),this._experienceBase.getManager("VCXContextualContentManager").contextualShortcutToolbarCtrl.hideContextualBar(),this._displayPivot();this._experienceBase.getManager("VCXManipulatorManager").robotChangePositionAtCmdBeginning||this.changeRobotPosAtCmdBeginning(!0)}async endExecute(){let e=this._experienceBase.getManager("VCXContextManager").getMainViewer();var t=e?.getRobot();t instanceof n&&(t.target=null,t.setConnectionState(!1),t.CallBackEventHandlerViewPoint(),this._experienceBase.getManager("VCXRobotAdapter").displayRobot(!1,!0),e?.render())}async cancelExecute(){this.changeRobotPosAtCmdBeginning(!0),super.cancelExecute()}onSelectionChange(){this.isRunning()&&this._displayPivot()}_displayPivot(){const e=this._experienceBase.getManager("VCXManipulatorManager");let t=this._experienceBase.getManager("VCXContextManager").getMainViewer();if(!(e.robotChangePositionAtCmdBeginning||e.robotTargetsAtBeginning&&e.robotMatrixAtBeginning))return;var i=t?.getRobot();if(!(i instanceof n))return console.error("No robot found.."),void this.end();e.robotTargetsAtBeginning&&this._experienceBase.getManager("VCXSelectionManager").addComponentsToSelection(e.robotTargetsAtBeginning);const a=[];for(var s=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO"),r=0;r<s.length;++r)if(s[r].IsKindOf("VCXWebComponentOccurrence")&&!s[r].IsDressup){var o=s[r].QueryInterface("VCXIModifiable");o&&a.push(o)}if(Array.isArray(a)&&a.length>0){let t;i.setConnectionState(!0),i.fixedSizeNode3D.setRatio(7),i.target=a[0].QueryInterface("W3AISGNodeHolder")?.getPathElement(),t=e.robotMatrixAtBeginning?e.robotMatrixAtBeginning:this._getNewRobotFrame(a),t&&(i.setRobotMatrix(t),i.setVisibility(!0))}else i.setVisibility(!1),i.target=null,i.setConnectionState(!1),i.CallBackEventHandlerViewPoint();t?.render()}_getNewRobotFrame(e){if(0!==e.length){if(1===e.length&&"VCX_Root"!==e[0].GetObject().GetID()){var t=e[0].GetProperty("Actor.Position").GetPropertyValue().GetPivot().GetValue(),n=e[0].GetObject().getParentWorldPosition();return r=(new a.default.Matrix4).copy(n).multiply(t)}var i,s=null;for(i=0;i<e.length;++i)if("VCX_Root"!==e[i].GetObject().GetID()){t=e[i].GetProperty("Actor.Position").GetPropertyValue().GetPivot().GetValue(),n=e[i].GetObject().getParentWorldPosition();var r=(new a.default.Matrix4).copy(n).multiply(t);if(null!==s){if(!this._equalMatrices(r,s))break}else s=r.clone()}return i===e.length?s:(new a.default.Matrix4).setPosition(this._getBBoxInWCS(e).center())}console.error("No modifiable specified in the array parameter")}changeRobotPosAtCmdBeginning(e){if("boolean"!=typeof e)return void console.error("A boolean is needed as parameter");const t=this._experienceBase.getManager("VCXManipulatorManager");t&&(t.robotChangePositionAtCmdBeginning=!0,t.robotMatrixAtBeginning=null,t.robotTargetsAtBeginning=null)}_equalMatrices(e,t){if(e instanceof a.default.Matrix4&&t instanceof a.default.Matrix4){var n;for(n=0;n<16&&!(Math.abs(e.elements[n]-t.elements[n])>.001);++n);return 16===n}console.error("2 THREE.Matrix4 objects are needed as parameters")}_getBBoxInWCS(e){let t=this._experienceBase.getManager("VCXContextManager").getMainViewer();for(var n=new a.default.Box3,i=0;i<e.length;i++){var s=e[i].QueryInterface("W3AISGNodeHolder"),r=s?.getPathElement(),o=r.getBoundingBox(null,t);o.applyMatrix4(s?.getWorldMatrix(t)),n.union(o)}return n}}return __decorate([s.default.subscribeAll],r.prototype,"beginExecute",null),__decorate([s.default.unsubscribeAll],r.prototype,"endExecute",null),__decorate([s.default.Handler(["VCX_SELECTION_COMPONENTSLIST_ADD","VCX_SELECTION_COMPONENTSLIST_REMOVE","VCX_SELECTED_ACTORS_EMPTY"])],r.prototype,"onSelectionChange",null),r})),define("DS/VCXWebProducts/VCXPlayGuidedTourCmd",["DS/ApplicationFrame/Command","DS/CoreEvents/Events","DS/VCXWebProducts/VCXPlayGuidedTourModel","DS/VCXWebProducts/VCXPlayGuidedTourUI"],(function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0}),this.tokenUISubs=null,this.playGuidedTourUI=null,this.playGuidedTourModel=new n},destroy:function(){this.isRunning()&&this.end(),this.playGuidedTourModel&&(this.playGuidedTourModel.destroy(),this.playGuidedTourModel=null),this.playGuidedTourUI&&(this.playGuidedTourUI.destroy(),this.playGuidedTourUI=null),this._parent()},beginExecute:function(){var e=this.getFrameWindow();if(this._experienceBase=e._experienceBase,!this.playGuidedTourModel.checkScenarioPresence(this._experienceBase))return console.log("No scenario available to create a tour... Ending command PlayGuidedTour."),void this.end();this.playGuidedTourUI=new i(this.getFrameWindow()),this.playGuidedTourUI&&(this.playGuidedTourUI.setplayGuidedTourUI(e),this.tokenUISubs=[this.playGuidedTourUI.subscribe("togglePlayPause",this._togglePlayPause.bind(this)),this.playGuidedTourUI.subscribe("terminate",this.end.bind(this))]),this._parent()},execute:function(){},endExecute:function(){if(this.playGuidedTourUI&&(this.playGuidedTourUI.terminateUI(),this.tokenUISubs))for(var e=0;e<this.tokenUISubs.length;++e)this.playGuidedTourUI.unsubscribe(this.tokenUISubs[e]);this.playGuidedTourModel.getGuidedTourOccurring()&&this.playGuidedTourModel.setPauseRequested(this._experienceBase),this.playGuidedTourModel._publishGuidedTourEvent("end"),this.playGuidedTourUI=null,this._parent()},_togglePlayPause:function(){this.playGuidedTourModel.getGuidedTourOccurring()?this.pause():this.play()},pause:function(){this.playGuidedTourUI.displayUI(),this.playGuidedTourModel.setPauseRequested(this._experienceBase)},play:function(){this.playGuidedTourUI.hideUI(),this.playGuidedTourModel.runGuidedTour(this._experienceBase)},executeGuidedTourODT:function(){if("replay"===this._experienceBase.odt){var e=this;return[function(t,n){e.playGuidedTourUI.togglePlayPauseUIODT(e._experienceBase),setTimeout((function(){t(!0)}),2e3)},function(t,n){e.playGuidedTourUI.togglePlayPauseUIODT(e._experienceBase),t(!0)},function(e,t){setTimeout((function(){e(!0)}),6e3)},function(t,n){e.playGuidedTourUI.togglePlayPauseUIODT(e._experienceBase),setTimeout((function(){t(!0)}),2e3)}]}}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebProducts/VCXCloseExperienceCmd",["require","exports","DS/VCXWebProducts/VCXAFRCmdBase","DS/VCXWebEWS/VCXExperienceServices"],(function(e,t,n,i){"use strict";n=__importDefault(n),i=__importDefault(i);class a extends n.default{constructor(e){super(e,{isAsynchronous:!0})}async execute(){await this.doClose(),this.end()}async doClose(){this._experienceBase.getManager("VCXExperience").ClearTimerScenarioUpdate();var e=this._experienceBase.getManager("VCXContextManager"),t=e.getContextFromName("PlayerMode"),n=e.getCat3DXIntegration();if(t||!n){return await i.default.CloseExperienceAndReset(this._experienceBase)}return i.default.DisplaySaveBeforeCloseModal(this._experienceBase)}}return a}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebProducts/VCXShowAllCmd",["require","exports","DS/VCXWebProducts/VCXAFRCmdBase","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebKernelCommands/VCXCmdChangeVisibility"],(function(e,t,n,i,a){"use strict";n=__importDefault(n),i=__importDefault(i),a=__importDefault(a);class s extends n.default{async execute(){var e=Object.values(this._experienceBase.ComponentsMap.GetComponentTable()).filter((e=>{let t=e.QueryInterface("VCXIVisibility");return t&&t.GetVisibility()===i.default.EVisState.Hidden}));if(0!==e.length){var t=new a.default(this._experienceBase);t.ChangeVisibility(e,i.default.EVisState.Visible),this._experienceBase.getManager("VCXCommandManager").Push(t)}}}return s}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebProducts/VCXCheckFilterSelection",["require","exports","DS/VCXWebProducts/VCXAFRCmdBase"],(function(e,t,n){"use strict";n=__importDefault(n);let i={checkGeometries:function(e,t){const i=n.default.getExperienceBaseFromParametersFunction(t),a=i?.getManager("VCXSelectionManager");a&&(a.excludeParts=!1),e()},uncheckGeometries:function(e,t){const i=n.default.getExperienceBaseFromParametersFunction(t),a=i?.getManager("VCXSelectionManager");a&&(a.excludeParts=!0),e()},checkDressups:function(e,t){const i=n.default.getExperienceBaseFromParametersFunction(t),a=i?.getManager("VCXSelectionManager");a&&(a.excludeDressups=!1),e()},uncheckDressups:function(e,t){const i=n.default.getExperienceBaseFromParametersFunction(t),a=i?.getManager("VCXSelectionManager");a&&(a.excludeDressups=!0),e()}};return i}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebProducts/VCXSmartVisibilityControlCmd",["require","exports","DS/VCXWebProducts/VCXAFRCmdBase","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebKernelCommands/VCXCmdChangeVisibility"],(function(e,t,n,i,a){"use strict";n=__importDefault(n),i=__importDefault(i),a=__importDefault(a);class s extends n.default{async execute(){var e=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO");if(0===e.length)return;let{visible:t,invisible:n}=this._doPrepareVisibleOrInvisible(e);for(let e in t)t.hasOwnProperty(e)&&n.hasOwnProperty(e)&&delete n[e];let s=Object.values(t).map((e=>e.GetObject())),r=Object.values(n).map((e=>e.GetObject()));if(0!==s.length||0!==r.length){const e=new a.default(this._experienceBase);e.ChangeVisibility(r,i.default.EVisState.Hidden);const t=new a.default(this._experienceBase);t.ChangeVisibility(s,i.default.EVisState.Visible);let n=this._experienceBase.getManager("VCXCommandManager");n.StartTransaction(),n.Push(e),n.Push(t),n.EndTransaction()}}_doPrepareVisibleOrInvisible(e){return console.log("To Be Overridden !"),{visible:{},invisible:{}}}_addBrothers(e,t){const n=t.QueryInterface("VCXIModelNavigable")?.getParent();if(n){n.getChildren().forEach((n=>{n.GetObject().GetID()!=t.GetObject().GetID()&&(e[n.GetObject().GetID()]=n)}))}}}return s}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebProducts/VCXIsolateCmd",["require","exports","DS/VCXWebProducts/VCXSmartVisibilityControlCmd"],(function(e,t,n){"use strict";n=__importDefault(n);class i extends n.default{_doPrepareVisibleOrInvisible(e){let t={},n={};return e.forEach((e=>{let i=e.QueryInterface("VCXIModelNavigable");for(;null!==i;)t[i.GetObject().GetID()]=i,this._addBrothers(n,i),i=i.getParent()})),e.forEach((e=>{const n=e.QueryInterface("VCXIModelNavigable");n?.traverse((e=>{t[e.GetObject().GetID()]=e}))})),{visible:t,invisible:n}}}return i}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebProducts/VCXSmartShowInVisibleSpaceCmd",["require","exports","DS/VCXWebProducts/VCXSmartVisibilityControlCmd","DS/VCXWebVisibility/VCXIVisibility"],(function(e,t,n,i){"use strict";n=__importDefault(n),i=__importDefault(i);class a extends n.default{_doPrepareVisibleOrInvisible(e){let t={},n={};const a=e=>{const s=e.GetObject().QueryInterface("VCXIVisibility");if(s){s.GetVisibility()===i.default.EVisState.Hidden&&(t[e.GetObject().GetID()]=e);const r=e.getParent();if(null!==r){const s=r.GetObject().QueryInterface("VCXIVisibility");if(s){s.GetVisibility()===i.default.EVisState.Hidden&&(t[e.GetObject().GetID()]=e,this._addBrothers(n,e))}a(r)}}};for(let t of e){const e=t.QueryInterface("VCXIModelNavigable");null!==e&&a(e)}return{visible:t,invisible:n}}}return a}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebProducts/VCXSelectSimilarInstance",["require","exports","DS/VCXWebProducts/VCXAFRCmdBase","DS/VCXWebKernel/VCXCmdChangeSelection"],(function(e,t,n,i){"use strict";n=__importDefault(n),i=__importDefault(i);class a extends n.default{async execute(){this.DoSelection()}DoSelection(){var e=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceComposer");let t=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO").map((e=>e._reference)).filter((e=>!!e));e=e.filter((e=>t.includes(e._reference)));var n=new i.default(this._experienceBase);n.SetComponentsSelection(e),this._experienceBase.getManager("VCXCommandManager").Do(n)}}return a}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebProducts/VCXSelectSimilarInstanceActionBar",["require","exports","DS/VCXWebProducts/VCXSelectSimilarInstance","DS/CoreEvents/Events"],(function(e,t,n,i){"use strict";n=__importDefault(n),i=__importDefault(i);class a extends n.default{async beginExecute(){this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO").length?(this.DoSelection(),this.end()):(this.wuxTokens.COMPONENTSLIST_ADD_Token=i.default.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},(()=>{this.DoSelection(),this.end()})),this.wuxTokens.COMPONENTSLIST_REMOVE_Token=i.default.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},(()=>{this.end()})),this.wuxTokens.COMPONENTSLIST_EMPTY_Token=i.default.subscribe({event:"VCX_SELECTED_ACTORS_EMPTY"},(()=>{this.end()})))}}return a})),define("DS/VCXWebProducts/VCXStepsCmd",["DS/VCXWebProducts/VCXAFRAdaptatorCmdBase","DS/CoreEvents/Events","DS/VCXWebIO/VCXLogServices","DS/VCXWebSystem/VCXCommandHelperEnum"],(function(e,t,n,i){"use strict";const a=e.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0}),this.commandHelperName="Step",this.commandHelperId=""},beginExecute:async function(){const e=this.getFrameWindow()._experienceBase.getManager("VCXGUIManager").GetGUIComponentFromName("VCXGUICommandHelperManagerCtrl");if(e){const t=e.addCommandHelper(i.Type.DEFAULT,this.commandHelperName);this.commandHelperId=t.id}},NoticeStep:function(e,i){if(void 0===e)return n.log("[VCXStepsCmd] Requested Step is missing !"),!1;const a={requestedStep:e,name:this.commandHelperName,options:i};return t.publish({event:"VCX/Cmd/Step",data:a}),!0}});return a.StepNotificationEnum={},a})),define("DS/VCXWebProducts/VCXApplyTransformationCmd",["DS/CoreEvents/Events","DS/VCXWebProducts/VCXStepsCmd","DS/VCXWebSystem/VCXCommandHelperEnum","i18n!DS/VCXWebProducts/assets/nls/VCXWebProducts","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebModifiablesServices/VCXModifiablesServices","DS/VCXWebVisu/VCXModifiablesAccess"],(function(e,t,n,i,a,s,r,o,c){"use strict";return t.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0}),this.wuxTokens={},this.parentReferential=!0,this._SceneGraphOverrideSet=null,this.target=null,this.optionsID={parent:"parent",world:"world"},this.initialMatrices={},this._commandOptionsId=""},beginExecute:async function(){await this._parent();const e=this.getFrameWindow()._experienceBase,t=e.getManager("VCXGUIManager").isTouchActivated();e.getManager("VCXCommandManager").StartTransaction();const a=e.getManager("VCXContextualContentManager");a&&a.deactivateContextualMenu();const s=this._GetSelection();let r=[];if(s.length>0)r=[...s],this.NoticeStep(n.Step.START,{numberSteps:1,message:i["VCXStepCmd.ApplyTransformation.Action"]});else{const e=2;this.NoticeStep(n.Step.START,{numberSteps:e,message:i["VCXStepCmd.ApplyTransformation.Step1"]}),r=await this._waitForSelection(null),this.NoticeStep(n.Step.NEXT,{message:i["VCXStepCmd.ApplyTransformation.Step2"]})}this.target=r;let o=null;this.CaptureInitialMatrices(r),this._StartChoiceOptions(),t?(o=await this._waitForSelectionTouch(),this._EndChoiceOptions(),this._ApplyTransformation(o,r)):(o=await this._waitForSelection(r),this._EndChoiceOptions(),this._ApplyTransformation(o,r)),this.NoticeStep(n.Step.END,{}),this.end()},endExecute:function(){const e=this.getFrameWindow()._experienceBase;this.NoticeStep(n.Step.END,{}),this._EndChoiceOptions(),this.unsubscribeEvents();const t=e.getManager("VCXContextualContentManager");t&&t.activateContextualMenu();e.getManager("VCXCommandManager").EndTransaction(),console.log("End Execute")},cancelExecute:function(){const e=this.getFrameWindow()._experienceBase;this.RestoreInitialMatrices(),this.NoticeStep(n.Step.END,{}),this._EndChoiceOptions(),this.unsubscribeEvents();const t=e.getManager("VCXContextualContentManager");t&&t.activateContextualMenu();e.getManager("VCXCommandManager").CancelTransaction(),console.log("Cancel Execute"),this._parent()},unsubscribeEvents:function(){for(let t in this.wuxTokens)this.wuxTokens.hasOwnProperty(t)&&e.unsubscribe(this.wuxTokens[t])},_waitForSelectionTouch:function(){return new Promise((t=>{this.wuxTokens.UpdateContext=e.subscribe({event:"VCX/Context/Update"},(e=>{const t=this._GetSelection();"3DContext"===e.vcxContextType&&0===t.length&&(this.NoticeStep(n.Step.WARN,{}),this._CheckValidatorOptions(!0));const i=this.getFrameWindow()._experienceBase,a=i.getManager("VCXGUIManager");i.getManager("VCXUserInputControllerManager");if(a&&a.GetGUIComponentFromName){const t=a.GetGUIComponentFromName("VCXGUICommandValidatorCtrl");t&&(t.locked||(t.UpdatePosition(e.mousePosition.x,e.mousePosition.y),t.locked=!0))}})),this.wuxTokens.COMPONENTSLIST_ADD_Token=e.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},(()=>{const e=this._GetSelection();if(1===e.length){this.RestoreInitialMatrices();const n=this.getFrameWindow()._experienceBase,i=n.getManager("VCXGUIManager"),a=n.getManager("VCXUserInputControllerManager").getInputContext();if(i&&i.GetGUIComponentFromName){const n=i.GetGUIComponentFromName("VCXGUICommandValidatorCtrl");if(n){let i=[];i.push({label:"",showLabelFlag:!1,icon:"check",color:"green",callback:()=>{this._onValidateTouch(),t(e)},id:"check"}),i.push({label:"",showLabelFlag:!1,icon:"wrong",callback:()=>{this._onCancelTouch()},id:"cancel"}),n.UpdateValidatorUI(a.mousePosition,i),n.locked=!1}}this._CheckChoiceOptions(!1),this._ApplyTransformation(e,this.target)}}))}))},_onValidateTouch:function(){this._CheckValidatorOptions(!0)},_onCancelTouch:function(){this.RestoreInitialMatrices(),this._CheckValidatorOptions(!0)},_CheckValidatorOptions:function(e){const t=this.getFrameWindow()._experienceBase.getManager("VCXGUIManager");if(t&&t.GetGUIComponentFromName){const n=t.GetGUIComponentFromName("VCXGUICommandValidatorCtrl");n&&e&&n.DestroyValidatorUI()}},_OnOverObjectsV2:function(e){const t=this.getFrameWindow()._experienceBase;if(e&&Array.isArray(e)&&1===e.length&&e[0].pathElement){const i=e[0].pathElement;var n=c.GetModifiableFromPathElement(i,t);if(n){const e=[n.GetObject()];e.length>0&&(this._CheckChoiceOptions(!1),this._ApplyTransformation(e,this.target))}else console.log("no modifiable associated to pathElement.")}},_setOverrideSet:function(){if(this.target&&this.target.length>0){const e=this.getFrameWindow()._experienceBase,t=e.getManager("VCXContextManager").getMainViewer();e.getManager("VCXVisuManager").hideDecorations("Apply Transformations",t,!1)}},_unSetOverrideSet:function(){const e=this.getFrameWindow()._experienceBase,t=e.getManager("VCXContextManager").getMainViewer();e.getManager("VCXVisuManager").showDecorations("Apply Transformations",t,!1)},_OnOverObjects:function(e){if(this.target&&this.target.length>0&&1===e.length){const t=this.getFrameWindow()._experienceBase.getManager("VCXContextualContentManager");if(t&&e[0].event&&e[0].event.event){const n=e[0].event.event,i=t.GetHoveredObjects(n);if(i.length>0){const e=i.map((e=>e.component));e.length>0&&(this._CheckChoiceOptions(!1),this._ApplyTransformation(e,this.target))}}}},_GetSelection:function(){var e=this.getFrameWindow()._experienceBase.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO");return e=e.filter((e=>e.IsKindOf("VCXComponentOccurrenceExt")))},_StartChoiceOptions:function(){let e=[];e.push({label:i["VCXApplyTransformation.Referential.World"],icon:"part-position",callback:()=>{},id:this.optionsID.world}),e.push({label:i["VCXApplyTransformation.Referential.Parent"],icon:"3d-object",callback:()=>{},id:this.optionsID.parent,selected:!0});const t=this.getFrameWindow()._experienceBase.getManager("VCXGUIManager");if(t&&t.GetGUIComponentFromName){const i=t.GetGUIComponentFromName("VCXGUICommandHelperManagerCtrl");if(i){const t=i.addCommandHelper(n.Type.OPTIONS);t&&(t.BuildOptionsUI(e),this._commandOptionsId=t.id)}}},_CheckChoiceOptions:function(e){const t=this.getFrameWindow()._experienceBase.getManager("VCXGUIManager");if(t&&t.GetGUIComponentFromName){const n=t.GetGUIComponentFromName("VCXGUICommandHelperManagerCtrl");if(n){const t=n.getCommandHelperById(this._commandOptionsId);t&&(e&&t.DestroyOptionsUI(),t.selectedOption===this.optionsID.world&&(this.parentReferential=!1),t.selectedOption===this.optionsID.parent&&(this.parentReferential=!0))}}},_EndChoiceOptions:function(){this._CheckValidatorOptions(!0),this._CheckChoiceOptions(!0)},_waitForSelection:function(t){return new Promise((i=>{this.wuxTokens.UpdateContext=e.subscribe({event:"VCX/Context/Update"},(e=>{const t=this._GetSelection();"3DContext"===e.vcxContextType&&0===t.length&&this.NoticeStep(n.Step.WARN,{})})),t&&(this.wuxTokens.AddPrehighlight=e.subscribe({event:"VCX_PREHIGHLIGHT_ADD"},(e=>{Array.isArray(e)?this._OnOverObjectsV2(e):console.warn("Data given by SelectionManager for adds have changed..")})),this.wuxTokens.EmptyPrehighlight=e.subscribe({event:"VCX_PREHIGHLIGHT_EMPTY"},(e=>{this.RestoreInitialMatrices()})),this.wuxTokens.RemovePrehighlight=e.subscribe({event:"VCX_PREHIGHLIGHT_REMOVE"},(e=>{this.RestoreInitialMatrices()}))),this.wuxTokens.COMPONENTSLIST_ADD_Token=e.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},(()=>{const e=this._GetSelection();e.length>0&&(console.log("Selection Added"),this.unsubscribeEvents(),i(e))}))}))},ComputeApplyTransformationWorld:function(e,t){const n=this.getFrameWindow()._experienceBase,i=(n.getManager("VCXContextManager").getMainViewer(),n.getManager("VCXCommandManager")),c=new r(n,!0),u=o.ComputeOriginalWorldMatrices(e),l=o.ComputeCurrentWorldMatrices(e),d=this._ComputeTransformation(u.frame,l.frame),h=this._ComputeTransformation(u.pivot,l.pivot);for(let e of t){const t=o.ComputeOriginalWorldMatrices(e),n=(new a.Matrix4).copy(d).multiply(t.frame),i=(new a.Matrix4).copy(h).multiply(t.pivot),r=e.getParentWorldPosition(),u=s.getLocalMatrixFromRefMatrix(n,r),l=s.getLocalMatrixFromRefMatrix(i,r),C=e.QueryInterface("VCXIModifiable"),p=o.buildPropertyLocationWithFramePivot(u,l);c.ChangeProperty(C,p)}i.Push(c)},ComputeApplyTransformationLocal:function(e,t){const n=this.getFrameWindow()._experienceBase,i=n.getManager("VCXCommandManager"),s=new r(n,!0),c=o.ComputeOriginalLocalMatrices(e),u=o.ComputeCurrentLocalMatrices(e),l=this._ComputeTransformation(c.frame,u.frame),d=this._ComputeTransformation(c.pivot,u.pivot);for(let e of t){const t=o.ComputeOriginalLocalMatrices(e),n=(new a.Matrix4).copy(l).multiply(t.frame),i=(new a.Matrix4).copy(d).multiply(t.pivot),r=e.QueryInterface("VCXIModifiable"),c=o.buildPropertyLocationWithFramePivot(n,i);s.ChangeProperty(r,c)}i.Push(s)},CaptureInitialMatrices:function(e){for(let t of e){this.initialMatrices[t.GetID()]={};const e=o.ComputeCurrentLocalMatrices(t);this.initialMatrices[t.GetID()]={component:t,frame:(new a.Matrix4).copy(e.frame),pivot:(new a.Matrix4).copy(e.pivot)}}},RestoreInitialMatrices:function(){const e=this.getFrameWindow()._experienceBase,t=e.getManager("VCXCommandManager"),n=new r(e,!0);if(this.initialMatrices){for(let e in this.initialMatrices){const t=this.initialMatrices[e].component,i=this.initialMatrices[e].frame,a=this.initialMatrices[e].pivot,s=t.QueryInterface("VCXIModifiable"),r=o.buildPropertyLocationWithFramePivot(i,a);n.ChangeProperty(s,r)}t.Push(n)}},_ComputeTransformation:function(e,t){const n=(new a.Matrix4).getInverse(e);return(new a.Matrix4).multiplyMatrices(t,n)},_ApplyTransformation:function(e,t){1===e.length&&t.length>0&&(this.parentReferential?this.ComputeApplyTransformationLocal(e[0],t):this.ComputeApplyTransformationWorld(e[0],t))}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebProducts/VCXHideSelectionCmd",["require","exports","DS/VCXWebProducts/VCXAFRCmdBase","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisibility/VCXIVisibility"],(function(e,t,n,i,a){"use strict";n=__importDefault(n),i=__importDefault(i),a=__importDefault(a);class s extends n.default{async execute(){this._hideSelection()}_hideSelection(){var e=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection();this._hideElementsFromArray(e)}_hideElementsFromArray(e){if(!Array.isArray(e))return;let t=e.filter((e=>{var t=e.QueryInterface("VCXIVisibility");let n=t?.GetVisibility();return t&&(n===a.default.EVisState.Visible||void 0===n)}));if(0!==t.length){var n=new i.default(this._experienceBase);n.ChangeVisibility(t,a.default.EVisState.Hidden),this._experienceBase.getManager("VCXCommandManager").Push(n)}}}return s}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebProducts/VCXHideDressupsCmd",["require","exports","DS/VCXWebProducts/VCXHideSelectionCmd"],(function(e,t,n){"use strict";n=__importDefault(n);class i extends n.default{async execute(){this._hideAllDressups()}_hideAllDressups(){var e=this._experienceBase.ComponentsMap.GetComponentFromType("VCXDressup_Spec");this._hideElementsFromArray(e),this._experienceBase.getManager("VCXContextualContentManager").contextualShortcutToolbarCtrl.hideContextualBar()}}return i}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebProducts/VCXSelectSimilarColor",["require","exports","DS/VCXWebProducts/VCXAFRCmdBase","DS/VCXWebProperties/VCXColor","DS/VCXWebKernel/VCXCmdChangeSelection"],(function(e,t,n,i,a){"use strict";n=__importDefault(n),i=__importDefault(i),a=__importDefault(a);class s extends n.default{async execute(){this.DoSelection()}DoSelection(){var e=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceComposer");let t=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO").map((e=>{if(!e.IsKindOf("VCXComponentOccurrenceComposer"))return!1;let t=e;if(!t.IsMesh())return!1;let n=t.GetCurrentMaterial();if(n)return n;let i=e.QueryInterface("VCXIModifiable");return i?.GetProperty("Actor.Color")?.GetPropertyValue().GetValue()})).filter((e=>!!e));e=e.filter((e=>{if(!e.IsMesh())return!1;let n=e.GetCurrentMaterial();if(n)return t.includes(n);let a=e.QueryInterface("VCXIModifiable"),s=a?.GetProperty("Actor.Color")?.GetPropertyValue().GetValue();return s&&t.find((e=>e instanceof i.default&&e.equals(s)))}));var n=new a.default(this._experienceBase);n.SetComponentsSelection(e),this._experienceBase.getManager("VCXCommandManager").Do(n)}}return s}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebProducts/VCXSelectSimilarColorActionBar",["require","exports","DS/VCXWebProducts/VCXSelectSimilarColor","DS/CoreEvents/Events"],(function(e,t,n,i){"use strict";n=__importDefault(n),i=__importDefault(i);class a extends n.default{async beginExecute(){this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO").length?(this.DoSelection(),this.end()):(this.wuxTokens.COMPONENTSLIST_ADD_Token=i.default.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},(()=>{this.DoSelection(),this.end()})),this.wuxTokens.COMPONENTSLIST_REMOVE_Token=i.default.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},(()=>{this.end()})),this.wuxTokens.COMPONENTSLIST_EMPTY_Token=i.default.subscribe({event:"VCX_SELECTED_ACTORS_EMPTY"},(()=>{this.end()})))}}return a}));