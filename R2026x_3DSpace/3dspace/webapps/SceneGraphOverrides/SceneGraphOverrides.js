define("DS/SceneGraphOverrides/ClippingContext",["DS/Visualization/ClippingContext"],(function(e){return console.log("Please require 'DS/Visualization/ClippingContext' instead of 'DS/SceneGraphOverrides/ClippingContext"),e})),define("DS/SceneGraphOverrides/SceneGraphOverrideSetToken",["UWA/Class"],(function(e){"use strict";var i=0;return e.extend({init:function(e,t){i++,this.id=i,this.sceneGraphOverrideSet=e,this.rank=t,this.index=-1}})})),define("DS/SceneGraphOverrides/IdPathOverrideWatcherTree",["DS/CoreEvents/Events","DS/Visualization/IdPathWatcher","DS/Visualization/IdPath"],(function(e,i,t){"use strict";var r=function(t){this.idPathWatcher=new i({onIdPathActiveCB:this.onIdPathActive.bind(this),onIdPathInactiveCB:this.onIdPathInactive.bind(this),idPathMatcher:t.idPathMatcher||null,viewer:t.viewer}),this.overrideToWatchedOverride=new Map,this.nodeIdOverrideSet=this.idPathWatcher.oocManager?null:new Set,this.needsUpdate=!0,this.token=e.subscribe({event:"/VISU/onSceneGraphUpdate"},this.onSceneGraphUpdate.bind(this)),this.overridesToActivateMap=new Map};r.prototype.addIdPathOverride=function(e){var i,r,s,a=new n(e);this.overrideToWatchedOverride.set(e,a);var h=e._idPathes;if(h){let e=[];for(i=0;i<h.length;i++)r=h[i],s=a.addIdPath(r),e.push(s);for(i=0;i<e.length;i++){let t=e[i];this.idPathWatcher.addIdPath(t.idPath,t)}}else if(e._nodeIdArray){let r=[];for(i=0;i<e._nodeIdArray.length;i++){let n=new t([e._nodeIdArray[i]]);s=a.addIdPath(n),r.push(s)}for(i=0;i<r.length;i++){let e=r[i];this.idPathWatcher.addIdPath(e.idPath,e)}this.nodeIdOverrideSet&&(this.nodeIdOverrideSet.add(e),this.requestActivateOverride(e))}},r.prototype.removeIdPathOverride=function(e){var i=this.overrideToWatchedOverride.get(e);if(this.overridesToActivateMap.delete(e),i){this.nodeIdOverrideSet&&e._nodeIdArray&&this.nodeIdOverrideSet.delete(e);for(var t=i.firstIdPath;t;)this.idPathWatcher.removeIdObject(t),t=t.nextIdPath;this.overrideToWatchedOverride.delete(e)}},r.prototype.onOverrideDetach=function(e){},r.prototype.dispose=function(){this.idPathWatcher.dispose(),this.idPathWatcher=null,this.token&&(e.unsubscribe(this.token),this.token=null)},r.prototype.onIdPathActive=function(e){var i=e.watchedOverride;i.count--,this.requestActivateOverride(i.override)},r.prototype.onIdPathInactive=function(e){var i=e.watchedOverride;i.count++;var t=i.override;i.count>=i.totalCount&&t&&this.requestDeactivateOverride(t)},r.prototype.update=function(){this.needsUpdate&&(this.needsUpdate=!1,this.nodeIdOverrideSet&&this.nodeIdOverrideSet.forEach((e=>{this.requestActivateOverride(e)}))),this.activateOrDeactivateOverrides()},r.prototype.onSceneGraphUpdate=function(e){this.needsUpdate=!0},r.prototype.requestActivateOverride=function(e){let i=this.overridesToActivateMap.get(e);i||(i=new a(e),this.overridesToActivateMap.set(e,i)),i.requestActivate()},r.prototype.requestDeactivateOverride=function(e){let i=this.overridesToActivateMap.get(e);i||(i=new a(e),this.overridesToActivateMap.set(e,i)),i.requestDeactivate()},r.prototype.activateOrDeactivateOverrides=function(){this.overridesToActivateMap.forEach(((e,i)=>{if(e.activate){var t;t=i.getSceneGraphOverrideSet()._getViewerEntries();var r=this.idPathWatcher.getIdPathMatcher();i._tryIdPathActivate(r,t),i.isEnabled()&&i._activateInAllViewers()}e.deactivate&&i._deactivateInAllViewers()})),this.overridesToActivateMap.clear()};var n=function(e){this.override=e,this.count=0,this.totalCount=0,this.firstIdPath=null};n.prototype.addIdPath=function(e){var i=new s(e,this);return i.nextIdPath=this.firstIdPath,this.firstIdPath=i,this.count++,this.totalCount++,i};var s=function(e,i){this.idPath=e,this.watchedOverride=i,this.nextIdPath=null};class a{constructor(e){this.override=e,this.activate=!1,this.deactivate=!1}requestActivate(){this.activate=!0,this.deactivate=!1}requestDeactivate(){this.deactivate=!0}}return r})),define("DS/SceneGraphOverrides/OverrideUtils",[],(function(){"use strict";return new class{fillOverrideLink(e,i,t,r){var n;i&&i.lib&&(i.lib.length=0),t&&t.lib&&(t.lib.length=0);var s=i||t;return e||s&&(n=i&&i.visibilityFix||t&&t.visibilityFix,e=s.createOverrideLink(n)),e&&e.combine(i,t,r),e}}})),define("DS/SceneGraphOverrides/OverrideLink",["UWA/Class"],(function(e){"use strict";var i=1;const t=1<<30;var r=e.extend({init:function(e){this.id=i++,this.visibilityFix=e,this.reset(),window.sealWebVisuObjects&&Object.seal(this)},reset:function(){this.opacityOverride=null,this.fullMaterialOverride=null,this.visibilityOverride=null,this.colorOverride=null,this.pickabilityOverride=null,this.position=null,this.internalMaterialOverride=null,this.disableColorOverride=!1,this.disablePGP=!1,this.internalMaterialOverrideReset=!1},copyInheritableProperties:function(e){this.opacityOverride=e.opacityOverride,this.fullMaterialOverride=e.fullMaterialOverride,this.visibilityFix||(this.visibilityOverride=e.visibilityOverride),this.colorOverride=e.colorOverride},setFromOverrideSet:function(e){this.fullMaterialOverride=null!==e.fullMaterial?e:null,this.colorOverride=null!==e.color?e:null,this.pickabilityOverride=null!==e.pickability?e:null,this.opacityOverride=null!==e.opacity?e:null,this.visibilityOverride=null!==e.visibility?e:null,this.position=e.position,this.internalMaterialOverride=e.internalMaterialOverride},getFullMaterial:function(){return this.fullMaterialOverride&&this.fullMaterialOverride.fullMaterial},getOpacity:function(){return this.opacityOverride&&this.opacityOverride.opacity},hasTransparency:function(){var e=this.getOpacity();return null!==e&&e<1},getVisibility:function(){return this.visibilityOverride&&this.visibilityOverride.visibility},getForceShowVisibility:function(){return!1},getForceShowVisibilityFree:function(){return!1},getVisibilityFree:function(){return null},getPickability:function(){return this.pickabilityOverride&&this.pickabilityOverride.pickability},getForceShowPickability:function(){return!1},getPickingPriorityID:function(){return null},_setDisableColorOverride:function(e){this.disableColorOverride!==e&&(this.disableColorOverride=e,this.disableColorOverride?this.id|=t:this.id&=~t)},getColor:function(){return this.disableColorOverride?null:this.colorOverride&&this.colorOverride.color},getSubstituteMatrix:function(){return this.position},getClipping:function(){return null},hasVisibilityOverride:function(){return!!this.visibilityOverride},hasMaterialOverride:function(){return this.fullMaterialOverride||this.colorOverride||this.opacityOverride},getAppliedPropertiesNEW:function(){var e={};function i(i,t,r){e[i]={value:t}}return this.hasMaterialOverride()&&(this.getColor()&&i("color",this.getColor()),this.getFullMaterial()&&i("material",this.getFullMaterial()),this.getOpacity()&&i("opacity",this.getOpacity())),this.getPickability()&&i("pickability",this.getPickability()),this.getVisibility()&&i("visibility",this.getVisibility().visibility),this.position&&i("matrix",this.position.clone()),e},createOverrideLink:function(){return new r},combine:function(e,i){e?(this.setFromOverrideSet(e),i&&(i.fullMaterialOverride&&!e.forceInheritFullMaterial&&(this.fullMaterialOverride=i.fullMaterialOverride),i.colorOverride&&!e.forceInheritColor&&(this.colorOverride=i.colorOverride),this.visibilityFix||!i.pickabilityOverride||e.forceInheritPickability||(this.pickabilityOverride=i.pickabilityOverride),i.opacityOverride&&!e.forceInheritOpacity&&(this.opacityOverride=i.opacityOverride),this.visibilityFix||!i.visibilityOverride||e.forceInheritVisibility||(this.visibilityOverride=i.visibilityOverride))):i?this.copyInheritableProperties(i):this.reset()},getMatrixUpdate:function(){return!0},clearMatrixUpdate:function(){},setMatrixUpdate:function(){},getRenderStyle:function(){return null},isPGPOnly:function(){return!1}});return r})),define("DS/SceneGraphOverrides/OverrideLink2",["UWA/Class","DS/Visualization/ThreeJS_DS"],(function(e,i){"use strict";var t=1,r=-1;const n=1<<30;function s(){return 1===r&&console.log("ERROR - SceneGraphOverrideSet internal inconsistency"),null}var a=e.extend({init:function(e){this.id=t++,this.visibilityFix=!0,this.reset(),this.disableColorOverride=!1,this.disablePGP=!1,this.matrixUpdate=!1,r<0&&(r=window.WUXOverrideDebug?1:0),window.sealWebVisuObjects&&Object.seal(this)},reset:function(){this.positionOverride&&(this.matrixUpdate=!0),this.opacityOverride=null,this.pgpInheritance=0,this.fullMaterialOverride=null,this.visibilityOverride=null,this.visibilityFreeOverride=null,this.colorOverride=null,this.pickabilityOverride=null,this.positionOverride=null,this.clippingOverride=null,this.renderStyleOverride=null},copyInheritableProperties:function(e){this.opacityOverride=e.opacityOverride,this.pgpInheritance=e.pgpInheritance,this.fullMaterialOverride=e.fullMaterialOverride,this.visibilityFix||(this.visibilityOverride=e.visibilityOverride),this.colorOverride=e.colorOverride,this.renderStyleOverride=e.renderStyleOverride},setFromOverrideSet:function(e){this.fullMaterialOverride=null!==e.fullMaterial?e:null,this.colorOverride=null!==e.color?e:null,this.pickabilityOverride=null!==e.pickability?e:null,this.opacityOverride=null!==e.opacity?e:null,this.pgpInheritance=e.pgpInheritance?e.pgpInheritance._values.pgpInheritance:0,this.visibilityOverride=null!==e.visibility?e:null,this.visibilityFreeOverride=null!==e.visibilityFree?e:null,this.positionOverride=null!==e.position?e:null,this.clippingOverride=null!==e.clipping?e:null,this.renderStyleOverride=null!==e.renderStyle?e:null,e.matrixUpdate&&(this.matrixUpdate=!0,e.unsetMatrixUpdate())},getFullMaterial:function(e){if(this.fullMaterialOverride&&!this.fullMaterialOverride.fullMaterial)return s();var i=null;if(this.fullMaterialOverride){var t=this.fullMaterialOverride.fullMaterial;!e&&t._sceneGraphOverrideSet._materialModeSensitive||(i=t._values.fullMaterial)}return i},getOpacity:function(e,i){if(this.opacityOverride&&!this.opacityOverride.opacity)return s();var t=this.opacityOverride,r=null;if(t&&t.isOpacityEnabled(e)&&(!i||!t.opacity._getKeepOcclusion()))if(t.opacity._pgp){var n=this.getPGPInheritance();!this.disablePGP&&2&n&&(r=this.opacityOverride.opacity._values.opacity)}else(r=this.opacityOverride.opacity._values.opacity)===a.NO_OPACITY&&(r=null);return r},hasTransparency:function(e,i){var t=this.getOpacity(e,i);return null!==t&&t<1},getVisibility:function(){return this.visibilityOverride&&!this.visibilityOverride.visibility?s():this.visibilityOverride&&this.visibilityOverride.visibility._values.visibility},getForceShowVisibility:function(){return!(!this.visibilityOverride||!this.visibilityOverride.visibility)&&this.visibilityOverride.visibility._getForceShowMode()},getVisibilityFree:function(){return this.visibilityFreeOverride&&!this.visibilityFreeOverride.visibilityFree?s():this.visibilityFreeOverride&&this.visibilityFreeOverride.visibilityFree._values.visibilityFree},getForceShowVisibilityFree:function(){return!(!this.visibilityFreeOverride||!this.visibilityFreeOverride.visibilityFree)&&this.visibilityFreeOverride.visibilityFree._getForceShowPlusMode()},getClipping:function(){return this.clippingOverride&&!this.clippingOverride.clipping?s():this.clippingOverride&&this.clippingOverride.clipping._values.clipping},getRenderStyle:function(){return this.renderStyleOverride&&!this.renderStyleOverride.renderStyle?s():this.renderStyleOverride&&this.renderStyleOverride.renderStyle._values.renderStyle},getPickability:function(){if(this.pickabilityOverride&&!this.pickabilityOverride.pickability)return s();var e=this.pickabilityOverride&&this.pickabilityOverride.pickability._values.pickability;return e&&e.pickability},getForceShowPickability:function(){return!(!this.pickabilityOverride||!this.pickabilityOverride.pickability)&&this.pickabilityOverride.pickability._getForceShowMode()},getPickingPriorityID:function(){if(this.pickabilityOverride&&!this.pickabilityOverride.pickability)return s();var e=this.pickabilityOverride&&this.pickabilityOverride.pickability._values.pickability;return e&&e.pickingPriorityID},getPGPInheritance:function(){return this.pgpInheritance},_setDisableColorOverride:function(e){this.disableColorOverride!==e&&(this.disableColorOverride=e,this.disableColorOverride?this.id|=n:this.id&=~n)},getColor:function(){if(this.colorOverride&&!this.colorOverride.color)return s();var e=this.colorOverride,i=null;if(e&&!this.disableColorOverride)if(e.color._pgp){var t=this.getPGPInheritance();!this.disablePGP&&1&t&&(i=this.colorOverride.color._values.color)}else(i=this.colorOverride.color._values.color)===a.NO_COLOR&&(i=null);return i},getSubstituteMatrix:function(){return this.positionOverride&&!this.positionOverride.position?s():this.positionOverride&&this.positionOverride.position._values.position},hasVisibilityOverride:function(){return!(!this.visibilityOverride&&!this.visibilityFreeOverride)},hasMaterialOverride:function(){var e=!1;return this.fullMaterialOverride&&(e=!0),this.colorOverride&&!this.colorOverride._pgp&&(e=!0),this.opacityOverride&&!this.opacityOverride._pgp&&(e=!0),e},getAppliedPropertiesNEW:function(){var e={};function i(i,t,r){e[i]={value:t}}if(this.hasMaterialOverride()){this.getColor()&&i("color",this.getColor()),this.getFullMaterial()&&i("material",this.getFullMaterial());var t=this.getOpacity(2);null!=t&&i("opacity",t)}return this.getPickability()&&i("pickability",this.getPickability()),this.getVisibility()&&i("visibility",this.getVisibility().visibility),this.getVisibilityFree()&&i("visibilityFree",this.getVisibilityFree().visibilityFree),this.getClipping()&&i("clipping",this.getClipping().clone()),this.getRenderStyle()&&i("renderStyle",this.getRenderStyle().clone()),this.positionOverride&&i("position",this.getSubstituteMatrix().clone()),e},createOverrideLink:function(){return new a},combine:function(e,i){var t,r;if(e){if(this.setFromOverrideSet(e),i){var n=e.getInheritLevel("fullMaterial");if(i.fullMaterialOverride){var s=i.fullMaterialOverride.getInheritLevel("fullMaterial");this.isWeakInherit(s)?this.fullMaterialOverride=this.fullMaterialOverride||i.fullMaterialOverride:this.isStandardOrWeakInherit(n)?this.fullMaterialOverride=i.fullMaterialOverride:this.isReset(n)&&(this.fullMaterialOverride=null)}if(!(t=i.colorOverride&&i.colorOverride.color?i.colorOverride:null)||!t.color._pgp||1&i.getPGPInheritance()||(t=null),t)if(t.color._pgp&&this.colorOverride&&!this.colorOverride.color._pgp);else if(this.colorOverride&&this.colorOverride.color._pgp&&!t.color._pgp)this.colorOverride=t;else{var a=e.getInheritLevel("color"),h=t.getInheritLevel("color");this.isWeakInherit(h)?this.colorOverride=this.colorOverride||t:this.isStandardOrWeakInherit(a)?this.colorOverride=t:this.isReset(a)&&(this.colorOverride=null)}if(!(r=i.opacityOverride&&i.opacityOverride.opacity?i.opacityOverride:null)||!r.opacity._pgp||2&i.getPGPInheritance()||(r=null),r)if(r.opacity._pgp&&this.opacityOverride&&!this.opacityOverride.opacity._pgp);else if(this.opacityOverride&&this.opacityOverride.opacity._pgp&&!r.opacity._pgp)this.opacityOverride=r;else{var o=e.getInheritLevel("opacity"),l=r.getInheritLevel("opacity");this.isWeakInherit(l)?this.opacityOverride=this.opacityOverride||r:this.isStandardOrWeakInherit(o)?this.opacityOverride=r:this.isReset(o)&&(this.opacityOverride=null)}this.pgpInheritance=this.pgpInheritance|i.pgpInheritance,i.renderStyleOverride&&(i.renderStyleOverride.hasWeakInherit("renderStyle")?this.renderStyleOverride=this.renderStyleOverride||i.renderStyleOverride:e.hasForceInherit("renderStyle")||(this.renderStyleOverride=i.renderStyleOverride))}}else i?this.copyInheritableProperties(i):this.reset()},isWeakInherit:function(e){return 4===e},isStandardOrWeakInherit:function(e){return e<=1||4===e},isReset:function(e){return 3===e},getMatrixUpdate:function(){return this.matrixUpdate},clearMatrixUpdate:function(){this.matrixUpdate=!1},setMatrixUpdate:function(){this.matrixUpdate=!0},getRenderPriorityOpacity:function(){return null},isPGPOnly:function(){var e=!1;if(this.opacityOverride&&this.opacityOverride.opacity){if(!this.opacityOverride.opacity._pgp)return!1;e=!0}if(this.colorOverride&&this.colorOverride.color){if(!this.colorOverride.color._pgp)return!1;e=!0}return!this.fullMaterialOverride&&e},getPGPGSSOId:function(){var e="#";return this.opacityOverride&&this.opacityOverride.opacity&&(e+="o"+this.opacityOverride.opacity._values.opacity),this.colorOverride&&this.colorOverride.color&&(e+="c"+i.getColorHex(this.colorOverride.color._values.color)),e+="i"+this.pgpInheritance}});return a.getNewId=function(){return t++},a.NO_COLOR="NO_COLOR",a.NO_OPACITY=-1,a})),define("DS/SceneGraphOverrides/OverrideSet",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/SceneGraphOverrides/SceneGraphOverrideSetToken","DS/SceneGraphOverrides/OverrideLink"],(function(e,i,t,r){"use strict";var n=1,s=e.extend({init:function(e,i){this.id=n++,this.pathElement=e,this.visibilityFix=i||!1,this.reset(),this.forceInheritOpacity=null,this.forceInheritFullMaterial=null,this.forceInheritVisibility=null,this.forceInheritColor=null,this.forceInheritPickability=null,this.invalidateBE=!1,this.internalMaterialOverride=null,this.resetGSSOCache=!0,window.sealWebVisuObjects&&Object.seal(this)},reset:function(){this.fullMaterial=null,this.color=null,this.pickability=null,this.opacity=null,this.visibility=null,this.position=null,this.internalMaterialOverride=null},cloneForFlatten:function(){var e=new s(this.pathElement,this.visibilityFix);return e.fullMaterial=this.fullMaterial,e.color=this.color,e.pickability=this.pickability,e.opacity=this.opacity,e.visibility=null!==this.visibility?{visibility:this.visibility.visibility}:null,e.position=this.position,e.internalMaterialOverride=this.internalMaterialOverride,e},clone:function(){var e=this.cloneForFlatten();return e.forceInheritOpacity=this.forceInheritOpacity,e.forceInheritFullMaterial=this.forceInheritFullMaterial,e.forceInheritVisibility=this.forceInheritVisibility,e.forceInheritColor=this.forceInheritColor,e.forceInheritPickability=this.forceInheritPickability,e},copy:function(e){this.fullMaterial=e.fullMaterial,this.color=e.color,this.pickability=e.pickability,this.opacity=e.opacity,this.visibility=e.visibility,this.internalMaterialOverride=e.internalMaterialOverride,this.position=e.position},copyWithoutPosition:function(e){this.fullMaterial=e.fullMaterial,this.color=e.color,this.opacity=e.opacity,this.internalMaterialOverride=e.internalOverride,this.visibilityFix||(this.visibility=e.visibility,this.pickability=e.pickability)},createOverrideLink:function(){return new r},mergeInto:function(e){var i=this;function t(t,r){null!==i[t]&&(e[t]=i[t],r&&(e[r]=i[r]))}t("fullMaterial","forceInheritFullMaterial"),t("color","forceInheritColor"),t("pickability",this.visibilityFix?void 0:"forceInheritPickability"),t("opacity","forceInheritOpacity"),t("visibility",this.visibilityFix?void 0:"forceInheritVisibility"),t("position"),t("internalMaterialOverride")},add:function(e){e.applyToOverrideSet(this)},hasMaterialOverride:function(){return this.fullMaterial||this.color||null!==this.opacity},hasVisibilityOverride:function(){return null!=this.visibility},getSubstituteMatrix:function(){return this.position},getVisibility:function(){return this.visibility},changeOpacity:function(e,i){this.forceInheritOpacity=i,this.opacity=e},changeMaterial:function(e,i){this.forceInheritFullMaterial=i,this.fullMaterial=e},changePosition:function(e){this.invalidateBE=!0,e?(this.position||(this.position=new i.Matrix4),this.position.copy(e)):this.position=null},unsetInvalidateBE:function(){this.invalidateBE=!1},changeVisibility:function(e,i){this.forceInheritVisibility=i,this.visibility=null!==e?{visibility:e}:null},changeColor:function(e,i){this.visibilityFix||(this.forceInheritColor=i),this.color=e},changePickability:function(e,i){this.visibilityFix||(this.forceInheritPickability=i),this.pickability=e},getColor:function(){return this.color},getPickability:function(){return this.pickability},getOpacity:function(){return this.opacity},getMaterial:function(){return this.fullMaterial},getPosition:function(){return this.position},getAppliedProperties:function(e){var i=[];function t(e){return e?"FORCE_INHERIT":"INHERIT"}return this.hasMaterialOverride()&&(!this.color||e&&"color"!==e||i.push({type:"color",color:this.color,inheritance:t(this.forceInheritColor)}),!this.fullMaterial||e&&"material"!==e||i.push({type:"material",material:this.fullMaterial,inheritance:t(this.forceInheritFullMaterial)}),!this.opacity||e&&"opacity"!==e||i.push({type:"opacity",opacity:this.opacity,inheritance:t(this.forceInheritOpacity)})),!this.pickability||e&&"pickability"!==e||i.push({type:"pickability",pickability:this.pickability,inheritance:t(this.forceInheritPickability)}),!this.visibility||e&&"visibility"!==e||i.push({type:"visibility",visibility:this.visibility.visibility,inheritance:t(this.forceInheritVisibility)}),!this.position||e&&"matrix"!==e||i.push({type:"matrix",matrix:this.position.clone(),inheritance:"NOT_INHERIT"}),i},combine:function(e,i,t){this.fullMaterial;e?(this.copy(e),i&&(i.fullMaterial&&!e.forceInheritFullMaterial&&(this.fullMaterial=i.fullMaterial),i.color&&!e.forceInheritColor&&(this.color=i.color),this.visibilityFix||!i.pickability||e.forceInheritPickability||(this.pickability=i.pickability),null===i.opacity||e.forceInheritOpacity||(this.opacity=i.opacity),this.visibilityFix||!i.visibility||e.forceInheritVisibility||(this.visibility=i.visibility))):i?this.copyWithoutPosition(i):this.reset()},setInternalMaterial:function(e,i){this.internalMaterialOverride=e?{internalPath:i,material:e}:null},hasASMInherit:function(){return!0},isOpacityEnabled:function(){return!0},unsetResetGSSOCache:function(){}});return s})),define("SceneGraphOverrides/OverrideSet",["DS/SceneGraphOverrides/OverrideSet","DS/DSMigration/DSMigration"],(function(e,i){return i.deprecateModule("SceneGraphOverrides/OverrideSet"),e})),define("DS/SceneGraphOverrides/OverrideSet2",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/SceneGraphOverrides/SceneGraphOverrideSetToken","DS/SceneGraphOverrides/OverrideLink2"],(function(e,i,t,r){"use strict";var n=1;return e.extend({init:function(){this.id=n++,this.visibilityFix=!0,this.reset(),this.genericOverrides=[],this.invalidateBE=!1,this.matrixUpdate=!1,this.resetGSSOCache=!1,window.sealWebVisuObjects&&Object.seal(this)},reset:function(){this.fullMaterial=null,this.color=null,this.pickability=null,this.opacity=null,this.pgpInheritance=null,this.visibility=null,this.visibilityFree=null,this.clipping=null,this.renderStyle=null,this.position=null},copy:function(e){this.fullMaterial=e.fullMaterial,this.color=e.color,this.pickability=e.pickability,this.opacity=e.opacity,this.pgpInheritance=e.pgpInheritance,this.visibility=e.visibility,this.visibilityFree=e.visibilityFree,this.clipping=e.clipping,this.renderStyle=e.renderStyle,this.position=e.position},createOverrideLink:function(){return new r},addGenericOverride:function(e,i){var r,n,s=i.index,a=!1;for(s=0,n=i.index-1;n>=0&&!a;n--)if((r=this.genericOverrides[n])instanceof t||r._index<e._index)s=n+1,a=!0;else if(r===e)return;this.invalidateBE=this.invalidateBE||e.hasBoundingElementInfluence(),this.matrixUpdate=this.matrixUpdate||e.hasPositionOverride(),this.genericOverrides.splice(s,0,e),i.index++},removeGenericOverride:function(e){var i=this.genericOverrides.indexOf(e);if(i>-1){this.invalidateBE=this.invalidateBE||e.hasBoundingElementInfluence(),this.matrixUpdate=this.matrixUpdate||e.hasPositionOverride(),this.genericOverrides.splice(i,1);var r=i>0?this.genericOverrides[i-1]:null,n=this.genericOverrides[i];(!r||r instanceof t)&&n instanceof t&&this.genericOverrides.splice(i,1)}},initToken:function(e){var i,r,n=this.genericOverrides.indexOf(e);if(n<0){for(n=0,i=0;i<this.genericOverrides.length;i++)(r=this.genericOverrides[i])instanceof t&&r.rank<e.rank&&(n=i+1);this.genericOverrides.splice(n,0,e)}e.index=n},update:function(e,i,t,r,n){t&&(this.resetGSSOCache=!0),this.invalidateBE=this.invalidateBE||e,this.matrixUpdate=this.matrixUpdate||i;var s,a,h,o,l,d,c={};for(s=0;s<this.genericOverrides.length;s++)if((h=this.genericOverrides[s])._values)for(a in d=h._getDepth(r,n),h._values)(o=c[a])&&d!==(l=o._getDepth(r,n))&&h._depthPriority?c[a]=l<d?h._getForceInherit()?h:o:o._getForceInherit()?o:h:c[a]=h;var v=this;function p(e){c.hasOwnProperty(e)?v[e]=c[e]:v[e]=null}p("fullMaterial"),p("color"),p("opacity"),p("pgpInheritance"),p("pickability"),p("visibility"),p("visibilityFree"),p("clipping"),p("renderStyle"),p("position")},onDetach:function(e,i){var r,n,s=i.node;for(r=0;r<this.genericOverrides.length;r++)(n=this.genericOverrides[r])instanceof t||n._hasPropagation()&&!n._isNodeTargeted(s)||n._detach(e)},onAddChild:function(e){var i;for(i=0;i<this.genericOverrides.length;i++){var r=this.genericOverrides[i];r instanceof t||r._onAddChild(e)}},onAddCandidateChild:function(e){var i;for(i=0;i<this.genericOverrides.length;i++){var r=this.genericOverrides[i];r instanceof t||r._onAddCandidateChild(e)}},hasMaterialOverride:function(){return this.fullMaterial||this.color||null!==this.opacity},getSubstituteMatrix:function(){return this.position&&this.position._values.position},unsetInvalidateBE:function(){this.invalidateBE=!1},unsetMatrixUpdate:function(){this.matrixUpdate=!1},getInheritLevel:function(e){return this[e]?this[e]._inheritLevel[e]:0},hasForceInherit:function(e){return this[e]&&2===this[e]._inheritLevel[e]},hasClearInherit:function(e){return this[e]&&3===this[e]._inheritLevel[e]},hasWeakInherit:function(e){return this[e]&&4===this[e]._inheritLevel[e]},hasASMInherit:function(){return!(!this.color||!this.color._sceneGraphOverrideSet._hasASMInherit())},isOpacityEnabled:function(e){return!(this.opacity&&(this.opacity._pgp||this.opacity._sceneGraphOverrideSet._noOpacityOnLines)&&e<=1)},unsetResetGSSOCache:function(){this.resetGSSOCache=!1}})})),define("SceneGraphOverrides/OverrideSet2",["DS/SceneGraphOverrides/OverrideSet2","DS/DSMigration/DSMigration"],(function(e,i){return i.deprecateModule("SceneGraphOverrides/OverrideSet2"),e})),define("DS/SceneGraphOverrides/SceneGraphState",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/SceneGraphOverrides/OverrideSet","DS/Visualization/Node3D","DS/Visualization/PathElement"],(function(e,i,t,r,n){"use strict";var s=e.extend({init:function(e,i){this.sceneGraph=i,this.viewer=e,this.overrideSets={},this.active=!1},clone:function(){var e,i,t=new s(this.viewer,this.sceneGraph);for(e in this.overrideSets)i=this.overrideSets[e],t.overrideSets[e]=i?i.clone(this.sceneGraph):null;return t},mergeInto:function(e){var i,t,r;for(i in this.overrideSets)(t=this.overrideSets[i])&&((r=e.overrideSets[i])?t.mergeInto(r):e.overrideSets[i]=t.clone(e));e.active&&e.onActivation(e.viewer.getRootNode())},applyOpacityToPath:function(e,i,t){var r,n,s=h(e,this.sceneGraph),a=s.length>0;for(r=0;r<s.length;r++)n=s[r],a=l.call(this,n,i,t)&&a;return a},getAppliedOpacity:function(e){var i=h(e,this.sceneGraph),t=null;if(1===i.length){var r=i[0]._getUniqueOccurrence(this.viewer),n=a.call(this,r,!1,e);n&&(t=n.getOpacity())}return t},applyMaterialToPath:function(e,i,t,r){e.internalPath.length;var n,s,a=h(e,this.sceneGraph),l=a.length>0;for(n=0;n<a.length;n++)s=a[n],l=o.call(this,s,i,t,null)&&l;return l},getAppliedMaterial:function(e){var i=h(e,this.sceneGraph),t=null;if(1===i.length){var r=i[0]._getUniqueOccurrence(this.viewer),n=a.call(this,r,!1,e);n&&(t=n.getMaterial())}return t},applyPositionToPath:function(e,i){var t,r,n=h(e,this.sceneGraph),s=n.length>0;for(t=0;t<n.length;t++)r=n[t],s=d.call(this,r,i)&&s;return s},applyAbsolutePositionToPath:function(e,i,t){var r,n,s=h(e,this.sceneGraph),a=s.length>0;for(r=0;r<s.length;r++)n=s[r],a=c.call(this,n,i,t)&&a;return a},getAppliedPosition:function(e){var i=h(e,this.sceneGraph),t=null;if(1===i.length){var r=i[0]._getUniqueOccurrence(this.viewer),n=a.call(this,r,!1,e);n&&(t=n.getPosition())}return t},applyVisibilityToPath:function(e,i,t){var r,n,s=h(e,this.sceneGraph),a=s.length>0;for(r=0;r<s.length;r++)n=s[r],a=v.call(this,n,i,t)&&a;return a},getAppliedVisibility:function(e){var i=h(e,this.sceneGraph),t=null;if(1===i.length){var r=i[0]._getUniqueOccurrence(this.viewer),n=a.call(this,r,!1,e);n&&(t=(t=n.getVisibility())?t.visibility:null)}return t},applyColorToPath:function(e,i,t){var r,n,s=h(e,this.sceneGraph),a=s.length>0;for(r=0;r<s.length;r++)n=s[r],a=p.call(this,n,i,t)&&a;return a},getAppliedColor:function(e){var i=h(e,this.sceneGraph),t=null;if(1===i.length){var r=i[0]._getUniqueOccurrence(this.viewer),n=a.call(this,r,!1,e);n&&(t=n.getColor())}return t},applyPickabilityToPath:function(e,i,t){var r,n,s=h(e,this.sceneGraph),a=s.length>0;for(r=0;r<s.length;r++)n=s[r],a=u.call(this,n,i,t)&&a;return a},getAppliedProperties:function(e){var i=h(e,this.sceneGraph),t=null;if(1===i.length){var r=i[0]._getUniqueOccurrence(this.viewer),n=a.call(this,r,!1,e);t=n?n.getAppliedProperties():[]}return t},getAllModifications:function(){var e,i,r=[];for(e in this.overrideSets)(i=this.overrideSets[e])instanceof t&&r.push({pathElement:i.pathElement,properties:this.getAppliedProperties(i.pathElement)});return r},computeInheritedVisibility:function(e){return this.computeInheritedProperty(e,"visibility")},computeInheritedColor:function(e){return this.computeInheritedProperty(e,"color")},computeInheritedMaterial:function(e){return this.computeInheritedProperty(e,"material")},computeInheritedOpacity:function(e){return this.computeInheritedProperty(e,"opacity")},computeInheritedPickability:function(e){return this.computeInheritedProperty(e,"pickability")},getCurrentVisibility:function(e){var i=this.computeInheritedProperty(e,"visibility");if(null===i){var t=e._getUniqueOccurrence(this.viewer);t&&(i=t._getVisible())}return i},computeInheritedProperty:function(e,i){var t=h(e,this.sceneGraph);if(1===t.length){t[0];for(var r=[];e;){var n=e._getUniqueOccurrence(this.viewer),s=a.call(this,n,!1,e);s&&(r=s.getAppliedProperties(i).concat(r)),e=e.getParentPath()}var o,l=null;for(o=0;o<r.length;o++)l&&"FORCE_INHERIT"!==r[o].inheritance||(l=r[o]);return l?l[i]:null}return null},toJSON:function(){var e,i,r={};for(e in this.overrideSets)if((i=this.overrideSets[e])instanceof t){r[e]={};var n=r[e];n.pathElement=i.pathElement.toJSON(this.sceneGraph),n.properties=[];for(var s=n.properties,a=this.getAppliedProperties(i.pathElement),h=0;h<a.length;h++){var o=a[h];switch(s[h]={type:o.type,inheritance:o.inheritance},o.type){case"material":s[h].material=o.material.name;break;case"matrix":s[h].matrix=[],o.matrix.flattenToArray(s[h].matrix)}}}return r},setFromJSON:function(e,t,r){var s,a,h,o,l=null,d={},c=function(e,i){l||(l=new e),l.buildFromFile(i,(function(e){e.force=!0,d[i].state="loaded",d[i].material=e;for(var t=0;t<d[i].paths.length;t++)v.applyMaterialToPath(d[i].paths[t],e,d[i].inheritances[t])}))},v=this,p=t||this.sceneGraph.userRoot;for(s in e){a=e[s],(h=new n).setFromJSON(a.pathElement,p);for(var u=0;u<a.properties.length;u++){var O=a.properties[u];switch(O.type){case"material":if(r){this.applyMaterialToPath(h,r[O.material],O.inheritance);break}var g=d[O.material];if(g){if("loading"===g.state){console.log("need to apply a material that is loading"),g.paths.push(h),g.inheritances.push(O.inheritance);break}this.applyMaterialToPath(h,g,O.inheritance)}else d[O.material]={state:"loading",paths:[h],inheritances:[O.inheritance],material:null},require(["ShaderComposer/ShaderComposer"],function(e){return function(i){return c(i,e)}}(O.material));break;case"matrix":o=(new i.Matrix4).setFromArray(O.matrix),this.applyAbsolutePositionToPath(h,o)}}}},onActivation:function(e){var i=e._occurrences,t=0,r=this;for(t=0;t<i.length;t++)i[t].traverse((function(e,i){var t=i+(e.node.getNotAllowedInPathElement()?"":e.node.id+"/"),n=r.overrideSets[t+"/"];return n&&(e.originalOverrideSet=n),t}),""),i[t].requestOverridesUpdate();this.active=!0},onDeactivation:function(e){var i=e._occurrences,t=0;for(t=0;t<i.length;t++)i[t].traverse((function(e){e.originalOverrideSet=null,e.overrideLink&&(e.overrideLink.reset(),e._invalidateBoundingElements(!1),e.updateVisibilityFlag())}));this.active=!1},getGlobalAppliedVisibility:function(){return this.computeInheritedVisibility.apply(this,arguments)},getGlobalAppliedColor:function(){return this.computeInheritedColor.apply(this,arguments)},getGlobalAppliedMaterial:function(e){return this.computeInheritedMaterial.apply(this,arguments)},getGlobalAppliedOpacity:function(e){return this.computeInheritedOpacity.apply(this,arguments)},getGlobalAppliedPickability:function(e){return this.computeInheritedPickability.apply(this,arguments)}});function a(e,i,r){return e?(this.active?n=e.originalOverrideSet:(s=r.getKey(),n=this.overrideSets[s]),i&&!n&&(n=new t(r),this.active&&(e.originalOverrideSet=n),s||(s=r.getKey()),this.overrideSets[s]=n),n):null;var n,s}function h(e,i){if(i&&e.externalPath[0]===i)return[e];var t,r,s=[],a=[];for(function e(t,r){var n;if(t[0]===i||0===t[0].parents.length)r.push(t);else for(n=0;n<t[0].parents.length;n++)e([t[0].parents[n]].concat(t),r)}((r=e.externalPath.indexOf(i))>0?e.externalPath.slice(r):e.externalPath,s),t=0;t<s.length;t++){var h=new n;for(r=0;r<s[t].length;r++)s[t][r].getNotAllowedInPathElement()||h.addElement(s[t][r]);for(r=0;r<h.internalPath.length;r++)h.addElement(h.internalPath[r]);a.push(h)}return a}function o(e,i,t,r){var n=e._getUniqueOccurrence(this.viewer);if(!n)return!1;var s=a.call(this,n,!0,e);return r?s.setInternalMaterial(i,r):s.changeMaterial(i,t),this.active&&(n.requestOverridesUpdate(),O(n)),!0}function l(e,i,t){var r=e._getUniqueOccurrence(this.viewer);return!!r&&(a.call(this,r,!0,e).changeOpacity(i,t),this.active&&(r.requestOverridesUpdate(),O(r)),!0)}function d(e,i){var t=e._getUniqueOccurrence(this.viewer);return!!t&&(a.call(this,t,!0,e).changePosition(i),this.active&&t.requestOverridesUpdate(),!0)}function c(e,t,n){var s=e.getLastElement();if(null===s)return!1;if(!(s instanceof r))return!1;var h=e._getUniqueOccurrence(this.viewer),o=a.call(this,h,!0,e);if(t){var l=t.clone();n&&l.multiplyMatrices(n,l);var d=e.getParentPath(),c=d?d.getWorldMatrix(this.viewer):new i.Matrix4,v=new i.Matrix4;v.getInverse(c),l.multiplyMatrices(v,l),o.changePosition(l)}else o.changePosition(null);return this.active&&function(e){var i,t=e._getOccurrences();for(i=0;i<t.length;i++)t[i].requestOverridesUpdate()}(e),!0}function v(e,i,t){var r=e._getUniqueOccurrence(this.viewer);return!!r&&(a.call(this,r,!0,e).changeVisibility(i,t),this.active&&r.requestOverridesUpdate(),!0)}function p(e,i,t){var r=e._getUniqueOccurrence(this.viewer);return!!r&&(a.call(this,r,!0,e).changeColor(i,t),this.active&&(r.requestOverridesUpdate(),O(r)),!0)}function u(e,i,t){var r=e._getUniqueOccurrence(this.viewer);return!!r&&(a.call(this,r,!0,e).changePickability(i,t),this.active&&r.requestOverridesUpdate(),!0)}function O(e){var i=e.originalOverrideSet;if(i&&!i.hasMaterialOverride())for(var t=e.parent,r=!1;t&&!r;)(i=t.originalOverrideSet)&&i.hasMaterialOverride()&&(t.requestOverridesUpdate(),r=!0),t=t.parent}return s})),define("SceneGraphOverrides/SceneGraphState",["DS/SceneGraphOverrides/SceneGraphState","DS/DSMigration/DSMigration"],(function(e,i){return i.deprecateModule("SceneGraphOverrides/SceneGraphState"),e})),define("DS/SceneGraphOverrides/GenericOverride",["UWA/Class","DS/SceneGraphOverrides/OverrideSet2","DS/Visualization/PathElement","DS/Visualization/ThreeJS_DS","DS/SceneGraphOverrides/OverrideLink2","DS/Visualization/JSONSettings"],(function(e,i,t,r,n,s){"use strict";var a=1;class h{constructor(e,i,t,r,n,s,h,o,l,d,c,v){this.id=a++,this._flags=0;var p=e?[]:null;for(O=0;e&&O<e.length;O++)p.push(e[O].clone());s&&Array.isArray(s)?this._nodeArray=s:this._nodeArray=s?[s]:null,o&&Array.isArray(o)?this._nodeIdArray=o:this._nodeIdArray=o?[o]:null,this._pathes=p||null;var u=h?[]:null;for(O=0;h&&O<h.length;O++)u.push(h[O].clone());if(this._idPathes=u,this._vdrpIdPathes=c||null,this._sceneGraphOverrideSet=i,this._values={},this._inheritLevel={},this._index=t,this._occurrenceBuffer={},this._missingTargets=null,this._propagationMode=r,this._pgp=!!l,this._depthPriority=!(!l&&!d),this._enabled=!!n,this._forceInherit=!1,this._watched=!1,this._resetGSSOCache=!1,v&&this._updateVDRP(v),this._enabled){var O,g=i._getViewerEntries();for(O=0;O<g.length;O++)this._watch(g[O],!1);for(O=0;O<g.length;O++)this._activate(g[O],!1)}}setColor(e,i){this.setColorAttribute({value:e,inheritance:i?2:1})}setColorAttribute({value:e,inheritance:i}){this._setAttribute("color",e,i)}setPGPNoColor(){this._setAttribute("color",n.NO_COLOR,4)}resetColor(){this._setAttribute("color",null,3)}setMaterial(e,i){this.setMaterialAttribute({value:e,inheritance:i?2:1})}setMaterialAttribute({value:e,inheritance:i}){this._setAttribute("fullMaterial",e,i)}resetMaterial(){this._setAttribute("fullMaterial",null,3)}setOpacity(e,i){this.setOpacityAttribute({value:e,inheritance:i?h.InheritMode.FORCE_INHERIT:h.InheritMode.INHERIT})}setOpacityAttribute({value:e,inheritance:i,keepOcclusion:t}){var r=e;this._pgp&&s.getEmulateScreenDoorTransparency()&&e<1&&(r=.5),void 0!==t&&this._setKeepOcclusion(t),this._setAttribute("opacity",r,i||h.InheritMode.INHERIT)}setPGPNoOpacity(){this._setAttribute("opacity",n.NO_OPACITY,4)}resetOpacity(){this._setAttribute("opacity",null,3)}setPGPInheritance(e){if(!this._pgp)throw new Error("not a pgp override");this._setAttribute("pgpInheritance",e)}setPickability(e,i){if(null===e)this._setAttribute("pickability",e,null);else{var t=null;i&&(t=this._values.pickability||{faces:null,edges:null,points:null,_override:!0},"string"==typeof i&&(t.faces=i,t.edges=i,t.points=i),(i.faces||null===i.faces)&&(t.faces=i.faces),(i.edges||null===i.edges)&&(t.edges=i.edges),(i.points||null===i.points)&&(t.points=i.points)),this._setAttribute("pickability",{pickability:e,pickingPriorityID:t},null)}}setPosition(e){var i=this._idPathes&&this.getPosition();this._setAttribute("position",e,null),this._idPathes&&(!i&&e||i&&!e)&&(e?this._sceneGraphOverrideSet._onAddPositionIdPathOverride(this):this._sceneGraphOverrideSet._onRemovePositionIdPathOverride(this))}setVisibility(e){var i=null!=e?{visibility:e}:null;e!==this.getVisibility()&&this._setNeedsOOCUpdate(!0),this._setAttribute("visibility",i,null)}setVisibilityFree(e){var i=null!=e?{visibilityFree:e}:null;e!==this.getVisibilityFree()&&this._setNeedsOOCUpdate(!0),this._setAttribute("visibilityFree",i,null)}setClippingContext(e){var i=e?e.clone():null;this._getClipping_internal();this._setAttribute("clipping",i,null)}setRenderMode(e){}setRenderStyle(e,i){this.setRenderStyleAttribute({value:e,inheritance:i?2:1})}setRenderStyleAttribute({value:e,inheritance:i}){e&&e._lock(),this._setAttribute("renderStyle",e,i)}getPosition(){return this._values.hasOwnProperty("position")?this._values.position:null}getVisibility(){return this._values.hasOwnProperty("visibility")?this._values.visibility.visibility:null}getVisibilityFree(){return this._values.hasOwnProperty("visibilityFree")?this._values.visibilityFree.visibilityFree:null}getColor(){return this._values.hasOwnProperty("color")?this._values.color:null}getMaterial(){return this._values.hasOwnProperty("fullMaterial")?this._values.fullMaterial:null}getOpacity(){return this._values.hasOwnProperty("opacity")?this._values.opacity:null}getPGPInheritance(){return this._values.hasOwnProperty("pgpInheritance")?this._values.pgpInheritance:null}getPickability(){if(this._values.hasOwnProperty("pickability")){var e=this._values.pickability;return e?e.pickability:null}return null}getPickingPriorityID(){if(this._values.hasOwnProperty("pickability")){var e=this._values.pickability;return e?e.pickingPriorityID:null}return null}getRenderMode(){var e=null;return this._values.hasOwnProperty("renderMode")&&(e=this._values.renderMode),e&&e.clone()}getRenderStyle(){var e=null;return this._values.hasOwnProperty("renderStyle")&&(e=this._values.renderStyle),e}getClippingContext(){var e=this._getClipping_internal();return e?e.clone():null}hasBoundingElementInfluence(){return this._values.hasOwnProperty("position")||this._values.hasOwnProperty("visibility")||this._values.hasOwnProperty("visibilityFree")}hasPositionOverride(){return this._values.hasOwnProperty("position")}getPathes(){return this._pathes?this._pathes.concat([]):null}getIdPathes(){return this._idPathes?this._idPathes.concat([]):null}getVDRPIdPathes(){return this._vdrpIdPathes?this._vdrpIdPathes.concat([]):null}isTargetingNode(e){var i,t,r;if(this._pathes){for(i=0;i<this._pathes.length;i++)for(r=this._pathes[i],t=0;t<r.externalPath.length;t++)if(r.externalPath[t]===e)return!0}else if(this._nodeArray&&this._nodeArray.indexOf(e)>=0)return!0;return!1}enable(e){var i=!!e;if(i!==this._enabled){var t;this._enabled=i;var r=this._sceneGraphOverrideSet._getViewerEntries();if(this._enabled)for(t=0;t<r.length;t++)this._watch(r[t],!1),this._activate(r[t],!1,!0);else for(t=0;t<r.length;t++)this._deactivate(r[t])}}isEnabled(){return this._enabled}getSceneGraphOverrideSet(){return this._sceneGraphOverrideSet}isIdPathOverride(e){return!(!this._idPathes&&!this._vdrpIdPathes)}isNodeIdOverride(){return!!this._nodeIdArray}getValues(){var e,i,t={};for(e in this._values)i=this._values[e],"pickability"===e&&i?(t.pickability=i.pickability,i.pickingPriorityID&&(t.pickingPriorityID=i.pickingPriorityID)):t[e]=i;return t}_forceOverrideUpdate(){this._update(!0,!0)}_hasAttribute(e){return this._values.hasOwnProperty(e)}_getValue(e){return this._values[e]}_setAttribute(e,i,t){var n=this._values[e];void 0===n&&(n=null);var s=!1;null!=i?(null===n&&(s=!0),"position"===e?(this._values[e]||(this._values[e]=new r.Matrix4),this._values[e].copy(i)):this._values[e]=i,t!==this._inheritLevel[e]&&(this._inheritLevel[e]=t,s=!0)):(null===n&&t===this._inheritLevel[e]||(s=!0),3!==t?(delete this._values[e],delete this._inheritLevel[e]):(this._values[e]=null,this._inheritLevel[e]=t));var a=this._isBEChangingAttribute(e),h="position"===e;let o="position"!==e;(s=s||a||"pickability"===e||"clipping"===e||"renderStyle"===e||"pgpInheritance"===e)?this._update(a,h,o):this._clearGSSOCache()}_isBEChangingAttribute(e){return"position"===e||"visibility"===e||"visibilityFree"===e}_removeAttribute(e){delete this._values[e],delete this._inheritLevel[e];var i=this._isBEChangingAttribute(e);this._update(i,"position"===e)}_getToken(){return this._sceneGraphOverrideSet._token}_clone(e){var i,t=new h(this._pathes,e,this._index,this._propagationMode,this._enabled,this._nodeArray,this._idPathes,this._nodeIdArray,this._pgp);for(i in this._needsOOCUpdate=t._needsOOCUpdate,this._values)t._values[i]=this._values[i];for(i in this._inheritLevel)t._inheritLevel[i]=this._inheritLevel[i];return t}_detach(e){this._idPathes||this._nodeIdArray?(this._resetOccurrenceBuffer(e),this._pathes=null):(this._resetOccurrenceBuffer(e),this._addMissingTarget(e))}_addMissingTarget(e,i){this._missingTargets||(this._missingTargets=[]),this._missingTargets.indexOf(e)<0&&(this._missingTargets.push(e),i||(i=this._sceneGraphOverrideSet._getViewerEntryFromViewer(e)),i&&i.missingTargetOverrides.push(this))}_onAddChild(e){this._propagationMode>0&&(this._resetOccurrenceBuffer(e),this._addMissingTarget(e))}_onAddCandidateChild(e){this._propagationMode>0&&e.addOverrideToUpdate(this)}_resetOccurrenceBuffer(e){var i;if(e)delete this._occurrenceBuffer[e.id];else for(i in this._occurrenceBuffer)delete this._occurrenceBuffer[i]}_getOccurrences(e){var i,t=e.viewer;if(this._nodeArray){var r=[];let e;for(e=0;e<this._nodeArray.length;e++){let i=this._nodeArray[e];var n,s,a;if(this._propagationMode===h.PropagationMode._applyToChildren)for(r=[],n=0;n<i._occurrences.length;n++)for(a=i._occurrences[n].children,s=0;s<a.length;s++)r.push(a[s]);else r=r.concat(i._occurrences)}i=r.filter((function(e){return e.scene3js&&e.scene3js.viewer===t}))}else this._nodeIdArray||(i=t&&this._occurrenceBuffer[t.id])||(i=this._buildOccurrenceList(e),t&&(!this._missingTargets||this._missingTargets.indexOf(t)<0)&&(this._occurrenceBuffer[t.id]=i));return i}_fillLDHOverrideSetHolderBag(e,i,t,r,n){let s=[];if(this._idPathes&&i){let t;for(t=0;t<this._idPathes.length;t++){let r=this._idPathes[t]._getOverrideDatas(i);if(r){let e;for(e=0;e<r.length;e++)s.push(r[e])}else{let r=i._ldhNodeManager.viewer.idPathMatcher,n=this._idPathes[t].buildPathElement(r)._getOccurrences();e.addOccurrenceNodes(n)}}s=this._propagateOverrideDatas(s,this._propagationMode,this._sceneGraphOverrideSet.rootId,n)}else if(this._nodeIdArray&&i){let e;for(e=0;e<this._nodeIdArray.length;e++){let t=this._nodeIdArray[e],r=i._getLDHReference(t,!0);if(r){let e,i=r._occurrences;for(e=0;e<i.length;e++)s.push(i[e].getReferenceOverrideData())}else if(r=i._getInstance(t),r){let e,i=r.getChild(t),n=i.reference._occurrences;for(e=0;e<n.length;e++)n[e].instanceData===i&&s.push(n[e].getInstanceOverrideData())}}s=this._propagateOverrideDatas(s,this._propagationMode,this._sceneGraphOverrideSet.rootId,n)}else{var a,h,o=this._getOccurrences(r);if(o)for(h=0;h<o.length;h++){let e=(a=o[h])&&a.ldhOccurrence,i=e&&e.getOverrideDataFromOccurrenceNode(a);i&&s.push(i)}s=this._propagateOverrideDatas(s,this._propagationMode,this._sceneGraphOverrideSet.rootId,n)}e.addOverrideDatas(s)}_propagateOverrideDatas(e,i,t,r){let n=e;switch(i){case h.PropagationMode.propagateToDirectChildren:n=this._expandOverrideDatasApplyToChildren(e,!0,r);break;case h.PropagationMode.propagateToChildren:case h.PropagationMode.propagateUntilRepRefs:n=this._expandOverrideDatasToChildren(e,r);break;case h.PropagationMode.propagateToParents:n=this._expandOverrideDatasToParents(e,t,r);break;case h.PropagationMode._applyToChildren:n=this._expandOverrideDatasApplyToChildren(e,!1,r)}return n}_expandOverrideDatasToChildren(e,i){let t,r=[];for(t=0;t<e.length;t++){let i,n=e[t];n.isInstanceOverrideData()?(r.push(n),i=n.ldhOccurrence.getReferenceOverrideData()):i=n,i.ldhOccurrence.traverseWithCondition((e=>{let i=e.getInstanceOverrideData();return i&&r.push(i),r.push(e.getReferenceOverrideData()),!0}))}return r}_expandOverrideDatasApplyToChildren(e,i,t){let r,n=[];for(r=0;r<e.length;r++){let t,s=e[r];if(i&&n.push(s),s.isInstanceOverrideData())t=s.ldhOccurrence.getReferenceOverrideData(),n.push(t);else{t=s;let e=0;for(e=0;e<t.ldhOccurrence.children.length;e++){let i=t.ldhOccurrence.children[e].getInstanceOverrideData();i&&n.push(i)}}}return n}_expandOverrideDatasToParents(e,i,t){let r,n=[];for(r=0;r<e.length;r++){let s,a=e[r];a.isInstanceOverrideData()?(n.push(a),s=a.ldhOccurrence.getReferenceOverrideData()):s=a;let h,o=a.ldhOccurrence,l=!1;for(;o&&!l;){let e=o.getInstanceOverrideData();e&&n.push(e),n.push(o.getReferenceOverrideData()),o.reference.referenceId===i&&(l=!0),h=o.occurrenceNode,o=o.parent}!o&&h&&t&&t.push(h)}return n}_buildOccurrenceList(e,i){if(!(this._pathes&&0!==this._pathes.length||i))return null;this._sceneGraphOverrideSet.rootId;var r,n,s,a,o,l,d,c=e.viewer,v=i||[],p=e.prefixPathes?e.prefixPathes:[new t],u=!1,O=this._sceneGraphOverrideSet.rootNode;if(!i)for(r=0;r<this._pathes.length;r++)for(n=this._pathes[r],a=0;a<p.length;a++)(l=p[a].externalPath.concat([])).length>0&&l.splice(l.length-1,1),d=!0,e.substractivePath?n.isAParentOf(e.substractivePath)?d=!0:(s=new t).substractPath(e.substractivePath,this._pathes[r])?(l=l.concat(s.externalPath),d=!0):d=!1:(d=!0,l=l.concat(n.externalPath)),d&&(l.length>0?((s=new t).setFromArray(l),s.checkExternalPath()?o=s._getOccurrences(c):u=!0):o=e.viewer.getRootNode()._occurrences,v=o?v.concat(o):v);if(this._propagationMode>0)switch(this._propagationMode){case h.PropagationMode.propagateToDirectChildren:v=function(e){var i,t,r,n=[];for(i=0;i<e.length;i++)for(t=e[i].children,n.push(e[i]),r=0;r<t.length;r++)n.push(t[r]);return n}(v);break;case h.PropagationMode.propagateToChildren:v=function(e){var i,t=[];for(i=0;i<e.length;i++)e[i].traverseWithCondition((function(e){return t.push(e),!e.ldhOccurrence}));return t}(v);break;case h.PropagationMode.propagateUntilRepRefs:v=function(e,i){var t,r=[];for(t=0;t<e.length;t++)e[t].traverseWithCondition((function(e){return r.push(e),!i.isNodeRepRef(e.node)&&!e.ldhOccurrence}));return r}(v,e.viewer.idPathMatcher);break;case h.PropagationMode.propagateToParents:v=function(e,i){var t,r,n,s=[];for(t=0;t<e.length;t++){r=e[t],n=!1;do{r?(s.push(r),r.node===i&&(n=!0),r=r.parent):n=!0}while(!n)}return s}(v,O)}return v=function(e){var i,t,r;if(e.length>1){for(i=[],t=0;t<e.length;t++)(r=e[t])&&!r.__rdo_visited&&(i.push(r),r.__rdo_visited=1);for(t=0;t<i.length;t++)i[t].__rdo_visited=0}else i=e;return i}(v),c&&(u?this._addMissingTarget(c,e):this._missingTargets&&(r=this._missingTargets.indexOf(c))>=0&&(this._missingTargets.splice(r,1),0===this._missingTargets.length&&(this._missingTargets=null),(a=e.missingTargetOverrides.indexOf(this))>=0&&e.missingTargetOverrides.splice(a,1))),v}_createOverrideSet(e,t){e.node._setOverrideExistsTraverse();let r=e.getOriginalOverrideSetToUse();return r||(e.originalOverrideSet=new i,r=e.originalOverrideSet),r.initToken(t),r.addGenericOverride(this,t),r}_createOverrideSetOverrideData(e,t){let r=e.originalOverrideSet;return r||(e.originalOverrideSet=new i,r=e.originalOverrideSet),r.initToken(t),r.addGenericOverride(this,t),r}_watch(e,i,t){this._watched||(this._watched=!0,(this._idPathes||this._nodeIdArray)&&e.idPathOverrideWatcher&&!i&&e.idPathOverrideWatcher.addIdPathOverride(this))}_activate(e,i,t){let r=e.getOOCManager();r&&this._requestOOCUpdateIfNeeded(r,!1);let n=e.getIdPathMatcher(),s=!1;(!this._pathes||this._idPathes&&this._pathes.length!==this._idPathes.length)&&(s=!0),s&&(r||n)&&t&&(n=n||r._ldhNodeManager.viewer.getIdPathMatcher(),this._tryIdPathActivate(n,[e],r)),this.hasPositionOverride()&&null!==this._idPathes&&null!==r&&r._updateOccurrences(this._idPathes),this._getOverrideSetHolderBag(e).activate(e,this)}_activateInAllViewers(){var e,i,t=this._sceneGraphOverrideSet._getViewerEntries();for(e=0;e<t.length;e++)i=t[e],this._activate(i)}_deactivateInAllViewers(){var e,i,t=this._sceneGraphOverrideSet._getViewerEntries();for(e=0;e<t.length;e++)i=t[e],this._deactivate(i)}_removeFromIdPathWatcher(e){this._watched=!1,(this._idPathes||this._nodeIdArray)&&(e&&e.removeIdPathOverride(this),this._pathes=null)}_deactivate(e){let i=e.getOOCManager();i&&this._requestOOCUpdateIfNeeded(i,!1),this._getOverrideSetHolderBag(e).deactivate(e,this)}_update(e,i,t){if(this._enabled){var r,n=this._sceneGraphOverrideSet._viewers;for(r=0;r<n.length;r++)this._updateInViewer(n[r],e,i,t)}}_clearGSSOCache(){if(this._enabled){var e,i,t,r,n,s,a=this._sceneGraphOverrideSet._viewers;for(e=0;e<a.length;e++)if(i=a[e],t=this._getOccurrences(i))for(r=0;r<t.length;r++)for(n=t[r]._getRenderableOccurrences(),s=0;s<n.length;s++)n[s]._flagAsGSSOInvalidated()}}_updateInViewer(e,i,t,r){if(this._enabled){let n=e.getOOCManager();n&&this._requestOOCUpdateIfNeeded(n,!0),n&&t&&null!==this._idPathes&&e.viewer&&n._updateOccurrences(this._idPathes),this._getOverrideSetHolderBag(e).update(e,this,i,t,r)}}_getClipping_internal(){return this._values.hasOwnProperty("clipping")?this._values.clipping:null}_tryIdPathActivate(e,i,t){if(this._idPathes){if(!this._sceneGraphOverrideSet.rootNode)return!1;var r,n,s=[];for(r=0;r<i.length;r++)this._resetOccurrenceBuffer(i[r].viewer);for(r=0;r<this._idPathes.length;r++)(n=this._idPathes[r].buildPathElement(e))&&s.push(n);return this._pathes=s,!0}if(this._nodeIdArray){let i,t=[];for(i=0;i<this._nodeIdArray.length;i++){var a=e.idToNode(this._nodeIdArray[i]);a&&t.push(a)}return t.length===this._nodeIdArray.length&&(this._nodeArray=t,!0)}return!1}_isNodeIdAndActive(){if(this._nodeIdArray){let r;for(r=0;r<this._nodeIdArray.length;r++){var e=idPathMatcher.idToNode(this._nodeIdArray[r]);if(!e)return!1;var i,t=this._sceneGraphOverrideSet._getViewerEntries();let n=!1;for(i=0;i<t.length;i++)vewerEntry=t,e._hasOccurrenceInViewer(undefined.viewer)&&(n=!0);if(!n)return!1}}return!1}_getIdPathes(){return this._idPathes}_isNodeTargeted(e){if(!this._pathes)return!0;var i;for(i=0;i<this._pathes.length;i++)if(this._pathes[i].getLastElement(!0)===e)return!0;return!1}_hasPropagation(){return this._propagationMode!==h.PropagationMode.none}_getDepth(e,i){if(e.ldhOccurrence){let t=this._idPathes&&this._idPathes[0];return t?e.ldhOccurrence.getParentDepthFromId(t.getFirstElement(),i.getOOCManager()):this._nodeIdArray?e.ldhOccurrence.getParentDepthFromId(this._nodeIdArray[0],i.getOOCManager()):0}let t=this._nodeArray?this._nodeArray[0]:null;if(t&&t!==this._sceneGraphOverrideSet.rootNode){if(1===t._occurrences.length)return t._occurrences[0].depth;for(var r=e;r&&r.node!==t;)r=r.parent;return r?r.depth:0}return this._sceneGraphOverrideSet._getDepth(e)}_getForceShowMode(){return this._sceneGraphOverrideSet._isForceShowMode()}_getForceShowPlusMode(){return this._sceneGraphOverrideSet._isForceShowPlusMode()}_setMaterialWeak(e){this._setAttribute("fullMaterial",e,4)}_setRenderStyleWeak(e){this._setAttribute("renderStyle",e,4)}_getOverrideSetHolderBag(e){let i=e.getOOCManager(),t=new o,r=[];if(this._fillLDHOverrideSetHolderBag(t,i,!1,e,r),r.length>0){let i=this._buildOccurrenceList(e,r);t.addOccurrenceNodes(i)}if(!t.hasOverrideData()){let i=this._getOccurrences(e);if(i){let e=[];for(let r=0;r<i.length;r++){let n=i[r];n.ldhOccurrence?e.push(n.ldhOccurrence.getOverrideDataFromOccurrenceNode(n)):t.addOccurrenceNode(n)}let r=this._propagateOverrideDatas(e,this._propagationMode,this._sceneGraphOverrideSet.rootId,[]);t.addOverrideDatas(r)}}return t}_requestOOCUpdateIfNeeded(e,i){(this._needsOOCUpdate||!i&&(this._hasAttribute("visibility")||this._hasAttribute("visilityFree")))&&(e._ldhNodeManager.requestUpdate(!0),this._needsOOCUpdate=!1)}_buildNodeIdKey(){let e,i="";if(this._nodeIdArray)for(e=0;e<this._nodeIdArray.length;e++)i=`${i}${e>0?"/":""}${this._nodeIdArray[e]}`;return i}_updateVDRP(e){if(this._vdrpIdPathes){let i,t=[];for(i=0;i<this._vdrpIdPathes.length;i++){let r=this._vdrpIdPathes[i]._buildInternalIdPathes(e.oocManager);r&&(t=t.concat(r))}this._idPathes=t}if(this._nodeIdArray){let i=e.getPGOOCInstance(this._nodeIdArray[0]),t=i&&i.derivedInstanceIds;t&&(this._nodeIdArray=t.concat([]))}}}class o{constructor(){this.occurrenceNodes=[],this.ldhOverrideDatas=[]}addOverrideDatas(e){if(e){let i;for(i=0;i<e.length;i++)this.ldhOverrideDatas.push(e[i])}}addOccurrenceNodes(e){if(e){let i;for(i=0;i<e.length;i++)this.occurrenceNodes.push(e[i])}}addOccurrenceNode(e){this.occurrenceNodes.push(e)}hasOverrideData(){return 0!==this.ldhOverrideDatas.length}activate(e,i){let t,r=this.ldhOverrideDatas;for(t=0;t<r.length;t++){let n=r[t];if(n){i._createOverrideSetOverrideData(n,e.token).update(i.hasBoundingElementInfluence(),i.hasPositionOverride(),!0,n,e),n.ldhOccurrence.requestOverridesUpdate()}}let n=this.occurrenceNodes;for(t=0;t<n.length;t++){let r=n[t];i._createOverrideSet(r,e.token).update(i.hasBoundingElementInfluence(),i.hasPositionOverride(),!0,r,e),r.requestOverridesUpdate()}}update(e,i,t,r,n){let s,a=this.ldhOverrideDatas;for(s=0;s<a.length;s++){let h=a[s];if(h){i._createOverrideSetOverrideData(h,e.token).update(i.hasBoundingElementInfluence()||t,i.hasPositionOverride()||r,n,h,e),h.ldhOccurrence.requestOverridesUpdate()}}let h=this.occurrenceNodes;for(s=0;s<h.length;s++){let a=h[s],o=i._createOverrideSet(a,e.token);o&&(o.update(i.hasBoundingElementInfluence()||t,i.hasPositionOverride()||r,n,a,e),a.requestOverridesUpdate())}}deactivate(e,i){let t,r=this.ldhOverrideDatas;for(t=0;t<r.length;t++){let n=r[t];if(n){let t=n.originalOverrideSet;t&&(t.removeGenericOverride(i),t.update(i.hasBoundingElementInfluence(),i.hasPositionOverride(),!0,n,e)),n.ldhOccurrence.requestOverridesUpdate()}}let n=this.occurrenceNodes;for(t=0;t<n.length;t++){let r=n[t],s=r.getOriginalOverrideSetToUse();s&&(s.removeGenericOverride(i),s.update(i.hasBoundingElementInfluence(),i.hasPositionOverride(),!0,r,e)),r.requestOverridesUpdate()}e&&e.viewer&&(i._resetOccurrenceBuffer(e.viewer),i._missingTargets&&(t=i._missingTargets.indexOf(e.viewer),t>=0&&(i._missingTargets.splice(t,1),0===i._missingTargets.length&&(i._missingTargets=null))),e.missingTargetOverrides&&(t=e.missingTargetOverrides.indexOf(i),t>=0&&e.missingTargetOverrides.splice(t,1)))}}h.PropagationMode={none:0,propagateToDirectChildren:1,propagateToChildren:2,propagateUntilRepRefs:3,propagateToParents:4,_applyToChildren:5},h.InheritMode={INHERIT:1,FORCE_INHERIT:2,GRAPH_SCENE:3,WEAK:4},h.NO_COLOR=n.NO_COLOR,h.NO_OPACITY=n.NO_OPACITY;var l=1,d=2,c=4,v=8,p=16,u=32,O=64;function g(e){return function(){return(this._flags&e)>0}}function _(e){return function(i){this._flags=i?this._flags|e:this._flags&~e}}return h.prototype._getPGP=g(l),h.prototype._setPGP=_(l),Object.defineProperty(h.prototype,"_pgp",{get:function(){return this._getPGP()},set:function(e){this._setPGP(e)}}),h.prototype._getDepthPriority=g(d),h.prototype._setDepthPriority=_(d),Object.defineProperty(h.prototype,"_depthPriority",{get:function(){return this._getDepthPriority()},set:function(e){this._setDepthPriority(e)}}),h.prototype._getEnabled=g(c),h.prototype._setEnabled=_(c),Object.defineProperty(h.prototype,"_enabled",{get:function(){return this._getEnabled()},set:function(e){this._setEnabled(e)}}),h.prototype._getForceInherit=g(v),h.prototype._setForceInherit=_(v),Object.defineProperty(h.prototype,"_forceInherit",{get:function(){return this._getForceInherit()},set:function(e){this._setForceInherit(e)}}),h.prototype._getWatched=g(p),h.prototype._setWatched=_(p),Object.defineProperty(h.prototype,"_watched",{get:function(){return this._getWatched()},set:function(e){this._setWatched(e)}}),h.prototype._getNeedsOOCUpdate=g(u),h.prototype._setNeedsOOCUpdate=_(u),Object.defineProperty(h.prototype,"_needsOOCUpdate",{get:function(){return this._getNeedsOOCUpdate()},set:function(e){this._setNeedsOOCUpdate(e)}}),h.prototype._getKeepOcclusion=g(O),h.prototype._setKeepOcclusion=_(O),Object.defineProperty(h.prototype,"_keepOcclusion",{get:function(){return this._getKeepOcclusion()},set:function(e){this._setKeepOcclusion(e)}}),h})),define("DS/SceneGraphOverrides/SceneGraphOverrideSet",["DS/SceneGraphOverrides/GenericOverride","DS/SceneGraphOverrides/OverrideSet","DS/SceneGraphOverrides/SceneGraphOverrideSetToken","DS/Visualization/PathElement","DS/Visualization/OccurrenceInterface","DS/Visualization/Node3D","DS/Visualization/IdPath"],(function(e,i,t,r,n,s,a){"use strict";var h=1;class o{constructor(e,i,t,r,n,s){s=s||{},this.id=h++,this.name=void 0!==n?n:"",this.rootNode=e,this.rootId=i||null,this._enabled=!0,this._overrides=[],this._viewers=[],this._pathElementToOverridesMap=null,this._idPathToOverridesMap=null,this._nodeIdToOverridesMap=null,this._rootIdOverrideSet=!(!i||this.rootNode),this._allowNodeOverrides=t&&!this._rootIdOverrideSet,this._idToIdPathPositionOverrideMap=new Map,this._idPathPositionOverridesMap=new Map,this._mode=s.mode||o.normal,this.nodesOnly=!!s.nodesOnly,this._activating=!1,this._asmInherit=void 0===s.asmInherit||s.asmInherit,this._materialModeSensitive=!!s.materialModeSensitive,this._noOpacityOnLines=!!s.noOpacityOnLines,this._oocManager=null,this._pgManager=null}createOverride(i){if(!this.rootNode||!i||this._rootIdOverrideSet||this.nodesOnly)return null;(Array.isArray(i)||i instanceof r||i instanceof n)&&(i={pathes:i});var t,s,a=i.pathes;if(Array.isArray(a)||(a=[a]),0===a.length)return null;for(s=0;s<a.length;s++){if(a[s]instanceof n){if(!(t=a[s].buildPathElement(this.rootNode)))return console.warn("ERROR - provided OccurrenceInterface is not under the rootNode of the SceneGraphOverrideSet"),null;a[s]=t}if(a[s].getElement(0)!==this.rootNode)return console.warn("ERROR - SceneGraphOverrideSet.createOverride: first PathElement node is not equal to this.rootNode"),null;if(!a[s].checkExternalPath())return console.warn("ERROR - SceneGraphOverrideSet.createOverride: invalid path provided"),null}var h=i.propagateToDirectChildren?e.PropagationMode.propagateToDirectChildren:e.PropagationMode.none;i.propagateUntilRepRefs&&(h=e.PropagationMode.propagateUntilRepRefs),i.propagateToChildren&&(h=e.PropagationMode.propagateToChildren),i.propagateToParents&&(h=e.PropagationMode.propagateToParents);var o=!i.hasOwnProperty("enabled")||i.enabled,l=new e(a,this,this._overrides.length,h,o&&this._enabled,null,void 0,void 0,i.pgp,i.depthPriority);return this._overrides.push(l),this._pathElementToOverridesMap&&this._addOverrideToMap(l,this._pathElementToOverridesMap),l}createIdPathOverride(i){if(/*!this.rootNode || */!this.rootId||this.nodesOnly)return null;(Array.isArray(i)||i instanceof a||i instanceof n)&&(i={idPathes:i});var t=i.idPathes,r=i.vdrpIdPathes;if(t){if(Array.isArray(t)||(t=[t]),0===t.length)return null;let e;for(e=0;e<t.length;e++)if(t[e].getElement(0)!==this.rootId)return console.warn("ERROR - SceneGraphOverrideSet.createIdPathOverride: first id is not equal to this.rootId"),null}else{if(!r)return null;{if(0===r.length)return null;let e;for(e=0;e<r.length;e++)if(r[e].productIdPath[0]!==this.rootId)return console.warn("ERROR - SceneGraphOverrideSet.createIdPathOverride: first vdrp product id is not equal to this.rootId"),null}}var s=!i.hasOwnProperty("enabled")||i.enabled,h=i.propagateToDirectChildren?e.PropagationMode.propagateToDirectChildren:e.PropagationMode.none;i.propagateUntilRepRefs&&(h=e.PropagationMode.propagateUntilRepRefs),i.propagateToChildren&&(h=e.PropagationMode.propagateToChildren),i.propagateToParents&&(h=e.PropagationMode.propagateToParents);var o=new e(null,this,this._overrides.length,h,s,void 0,t,void 0,i.pgp,i.depthPriority,i.vdrpIdPathes,this._pgManager);return o._enabled=this._enabled,this._overrides.push(o),this._idPathToOverridesMap&&this._addIdPathOverrideToMap(o,this._idPathToOverridesMap),o}createNodeIdOverride(i,t,r,n){if(!this._allowNodeOverrides)return null;var s=t?e.PropagationMode._applyToChildren:e.PropagationMode.none,a=new e(null,this,this._overrides.length,s,!0,void 0,void 0,i,r,n,void 0,this._pgManager);return this._overrides.push(a),this._nodeIdToOverridesMap&&this._addNodeIdOverrideToMap(a,this._nodeIdToOverridesMap),a}getOverrides(){return[].concat(this._overrides)}deleteOverrides(e){var i;for(i=0;i<e.length;i++)this.deleteOverride(e[i])}deleteOverride(e){var i,t=this._overrides.indexOf(e);if(t>=0){for(i=0;i<this._viewers.length;i++)e._deactivate(this._viewers[i]);for(this._overrides.splice(t,1),e.isIdPathOverride()?this._idPathToOverridesMap&&this._removeIdPathOverrideFromMap(e,this._idPathToOverridesMap):e.isNodeIdOverride()?this._nodeIdToOverridesMap&&this._removeNodeIdOverrideFromMap(e,this._nodeIdToOverridesMap):this._pathElementToOverridesMap&&this._removeOverrideFromMap(e,this._pathElementToOverridesMap),e._idPathes&&e.getPosition()&&this._onRemovePositionIdPathOverride(e),i=0;i<this._viewers.length>0;i++)e._removeFromIdPathWatcher(this._viewers[i].idPathOverrideWatcher);return!0}return!1}clone(){var e,i=new o(this.rootNode);for(e=0;e<this._overrides.length;e++)i._overrides.push(this._overrides[e]._clone(i));return i}getOverridesFromPathElement(e){this._pathElementToOverridesMap||(this._pathElementToOverridesMap=this._buildPathElementToOverridesMap());var i=e.getKey();return this._pathElementToOverridesMap[i]||null}getUniqueOverrideFromPathElement(e){var i=this.getOverridesFromPathElement(e);return i&&1===i.length?i[0]:null}getOverridesFromIdPath(e){this._idPathToOverridesMap||(this._idPathToOverridesMap=this._buildIdPathToOverridesMap());var i=e.getKey();return this._idPathToOverridesMap[i]||null}getUniqueOverrideFromIdPath(e){var i=this.getOverridesFromIdPath(e);return i&&1===i.length?i[0]:null}getOverridesFromVDRPIdPath(e){this._idPathToOverridesMap||(this._idPathToOverridesMap=this._buildIdPathToOverridesMap());var i=e.getKey();return this._idPathToOverridesMap[i]||null}getUniqueOverrideFromVDRPIdPath(e){var i=this.getOverridesFromVDRPIdPath(e);return i&&1===i.length?i[0]:null}getOverridesFromNodeId(e){return this._nodeIdToOverridesMap||(this._nodeIdToOverridesMap=this._buildNodeIdToOverridesMap()),this._nodeIdToOverridesMap[e]||null}getUniqueOverrideFromNodeId(e){var i=this.getOverridesFromNodeId(e);return i&&1===i.length?i[0]:null}getOverridesTargetingNode(e){var i,t,r=[];for(i=0;i<this._overrides.length;i++)(t=this._overrides[i]).isTargetingNode(e)&&r.push(t);return r}getAllowNodeOverrides(){return this._allowNodeOverrides}enable(e){var i;for(this._enabled=!!e,i=0;i<this._overrides.length;i++)this._overrides[i].enable(e)}_buildPathElementToOverridesMap(){var e,i,t={};for(e=0;e<this._overrides.length;e++)(i=this._overrides[e]).isIdPathOverride()||this._addOverrideToMap(i,t);return t}_buildIdPathToOverridesMap(){var e,i,t={};for(e=0;e<this._overrides.length;e++)(i=this._overrides[e]).isIdPathOverride()&&this._addIdPathOverrideToMap(i,t);return t}_buildNodeIdToOverridesMap(){var e,i,t={};for(e=0;e<this._overrides.length;e++)(i=this._overrides[e]).isNodeIdOverride()&&this._addNodeIdOverrideToMap(i,t);return t}_addOverrideToMap(e,i){var t,r,n;if(e._pathes)for(t=0;t<e._pathes.length;t++)(n=i[r=e._pathes[t].getKey()])||(n=[],i[r]=n),n.push(e)}_removeOverrideFromMap(e,i){var t,r,n,s;for(t=0;t<e._pathes.length;t++)(n=i[r=e._pathes[t].getKey()])&&(s=n.indexOf(e))>=0&&n.splice(s,1),n&&0!==n.length||delete i[r]}_addIdPathOverrideToMap(e,i){var t,r,n;if(e._vdrpIdPathes)for(t=0;t<e._vdrpIdPathes.length;t++)(n=i[r=e._vdrpIdPathes[t].getKey()])||(n=[],i[r]=n),n.push(e);else for(t=0;t<e._idPathes.length;t++)(n=i[r=e._idPathes[t].getKey()])||(n=[],i[r]=n),n.push(e)}_removeIdPathOverrideFromMap(e,i){var t,r,n,s;if(e._vdrpIdPathes)for(t=0;t<e._vdrpIdPathes.length;t++)(n=i[r=e._vdrpIdPathes[t].getKey()])&&(s=n.indexOf(e))>=0&&n.splice(s,1),n&&0!==n.length||delete i[r];else for(t=0;t<e._idPathes.length;t++)(n=i[r=e._idPathes[t].getKey()])&&(s=n.indexOf(e))>=0&&n.splice(s,1),n&&0!==n.length||delete i[r]}_addNodeIdOverrideToMap(e,i){var t,r;(r=i[t=e._buildNodeIdKey()])||(r=[],i[t]=r),r.push(e)}_removeNodeIdOverrideFromMap(e,i){var t,r,n;(r=i[t=e._buildNodeIdKey()])&&(n=r.indexOf(e))>=0&&r.splice(n,1),r&&0!==r.length||delete i[t]}_activate(e,i,r,n,s,a,h){if(!this._activating){this._activating=!0;var l=!1;if(this._mode!==o.normal&&this.rootNode&&(this._mode===o.invert?(this.rootNode._setInvertMode(!0),l=!0):this._mode===o.invertPick&&(this.rootNode._setInvertPickMode(!0),l=!0)),this.rootId&&e&&this.rootNode){var c=e.getIdPathMatcher();if(!c||c.idToNode(this.rootId)!==this.rootNode)return console.warn("Enable to activate SceneGraphOverrideSet: bad rootId"),void(this._activating=!1)}var v,p=0,u=-1;for(p=0;p<this._viewers.length&&u<0;p++)this._viewers[p].viewer===e&&(u=p);for(u<0&&(e?(u=this._viewers.length,this._viewers.push(new d({viewer:e,prefixPathes:i,substractivePath:r,token:new t(this,n),missingTargetOverrides:[],idPathOverrideWatcher:s}))):(this._viewers.push(new d({viewer:null,token:new t(this,n),idPathOverrideWatcher:s})),u=this._viewers.length-1)),p=0;p<this._overrides.length;p++)(v=this._overrides[p]).isEnabled()&&(v._watch(this._viewers[u],a),v._activate(this._viewers[u],a,!0));l&&!h&&this.rootNode._forceUpdate(),this._activating=!1}}_deactivate(e,i,t){if(!this._activating){this._activating=!0;var r=!1;this._mode!==o.normal&&this.rootNode&&(this._mode===o.invert?(this.rootNode._setInvertMode(!1),r=!0):this._mode===o.invertPick&&(this.rootNode._setInvertPickMode(!1),r=!0));var n=0,s=-1;for(n=0;n<this._viewers.length&&s<0;n++)this._viewers[n].viewer===e&&(s=n);if(s>=0){n=0;for(n=0;n<this._overrides.length;n++)this._overrides[n]._deactivate(this._viewers[s]),i||this._overrides[n]._removeFromIdPathWatcher(this._viewers[s].idPathOverrideWatcher);this._viewers.splice(s,1)}r&&!t&&this.rootNode._forceUpdate(),this._activating=!1}}_getViewerEntries(){return this._viewers}_getViewerEntryFromViewer(e){var i,t;for(i=0;i<this._viewers.length;i++)if((t=this._viewers[i]).viewer===e)return t;return null}_updateOverridesWithMissingTarget(e){var i,t,r=this._getViewerEntryFromViewer(e);if(r&&r.missingTargetOverrides.length>0)for(t=r.missingTargetOverrides.concat([]),i=0;i<t.length;i++)t[i]._updateInViewer(r,!0)}_onAddPositionIdPathOverride(e){var i,t,r=e._getIdPathes();for(i=0;i<r.length;i++)t=r[i],this._onAddPositionIdPathOverrideSingle(e,t)}_onRemovePositionIdPathOverride(e){var i,t,r=e._getIdPathes();for(i=0;i<r.length;i++)t=r[i],this._onRemovePositionIdPathOverrideSingle(e,t)}_registerPositionOverrideIdPath(e){var i=e.getLastId(),t=(e.getKey(),this._idToIdPathPositionOverrideMap.get(i));t||(t=new c(i),this._idToIdPathPositionOverrideMap.set(i,t)),t.useCount++,this._oocManager&&this._oocManager._registerPositionOverrideSet(i,this)}_unregisterPositionOverrideIdPath(e){var i=e.getLastId(),t=(e.getKey(),this._idToIdPathPositionOverrideMap.get(i));t&&(t.useCount--,0===t.useCount&&(this._idToIdPathPositionOverrideMap.delete(i),this._oocManager&&this._oocManager._unregisterPositionOverrideSet(i,this)))}_onAddPositionIdPathOverrideSingle(e,i){var t=i.getKey(),r=this._idPathPositionOverridesMap.get(t);r||(r=[],this._idPathPositionOverridesMap.set(t,r)),r[e._index]=e,this._registerPositionOverrideIdPath(i)}_onRemovePositionIdPathOverrideSingle(e,i){var t=i.getKey(),r=this._idPathPositionOverridesMap.get(t);if(r){r[e._index]=null;for(var n=r.length-1;n>=0&&r[n];)n--;r.length=n,0===r.length&&this._idPathPositionOverridesMap.delete(t)}this._unregisterPositionOverrideIdPath(i)}_createNodeOverride(i){if(!this._allowNodeOverrides)return null;var t=new e(null,this,this._overrides.length,e.PropagationMode.none,this._enabled,i);return this._overrides.push(t),t}_hasIdPathOverride(e){var i=this._idToIdPathPositionOverrideMap.get(e);return!!(i&&i.useCount>0)}_getIdPathPositionOverride(e){var i,t=e.getKey(),r=this._idPathPositionOverridesMap.get(t),n=null;if(r)for(i=r.length-1;i>=0&&null===n;i--)r[i]&&(n=r[i]);return n}_exportIdPathOverrides(e,i){var t,r,n,s,a,h,o,d;for(t=0;t<this._overrides.length;t++)if((r=this._overrides[t]).isIdPathOverride()&&r._hasAttribute(i))for(a=r._idPathes,d=r._getValue(i),s=0;s<a.length;s++)o=new l(h=a[s],d),n=h.getKey(),e.set(n,o)}_removeFromIdPathWatcher(e){var i;for(i=0;i<this._overrides.length;i++)this._overrides[i]._removeFromIdPathWatcher(e)}_isCurrentlyActive(){return this._viewers.length>0}_getDepth(e){if(0===this._viewers.length||this._viewers[0].viewer)return 0;var i,t=this.rootNode;if(1===t._occurrences.length)i=t._occurrences[0].depth;else{for(var r=e;r&&r.node!==t;)r=r.parent;i=r?r.depth:0}return this.prefixPathes&&(i+=this.prefixPathes.externalPath.length-1),this.substractivePath&&(i-=this.substractivePath.externalPath.length-1),i}_isForceShowMode(){return this._mode===o.forceShow||this._mode===o.forceShowPlus}_isForceShowPlusMode(){return this._mode===o.forceShowPlus}_hasASMInherit(){return this._asmInherit}_setOOCManager(e){(e=e||null)!==this._oocManager&&(e?this._idToIdPathPositionOverrideMap.forEach(((i,t)=>{i.useCount>0&&e._registerPositionOverrideSet(t,this)})):this._idToIdPathPositionOverrideMap.forEach(((e,i)=>{this._oocManager._unregisterPositionOverrideSet(i,this)})),this._oocManager=e)}_setPGManager(e){this._pgManager=e,e&&this._updateVDRPOverrides(e)}_getPositionOverrides(e){if(this._idPathPositionOverridesMap){var i=a.buildIdPathKey(e);return this._idPathPositionOverridesMap.get(i)||null}return null}_updateVDRPOverrides(e){let i;for(i=0;i<this._overrides.length;i++)this._overrides[i]._updateVDRP(e)}}function l(e,i){this.idPath=e,this.value=i}class d{constructor(e){this.viewer=e.viewer,this.prefixPathes=e.prefixPathes||null,this.substractivePath=e.substractivePath||null,this.token=e.token,this.missingTargetOverrides=e.missingTargetOverrides||null,this.idPathOverrideWatcher=e.idPathOverrideWatcher||null}getOOCManager(){return this.idPathOverrideWatcher&&this.idPathOverrideWatcher.idPathWatcher.oocManager||this.viewer&&this.viewer._getOOCManager()}getIdPathMatcher(){return this.idPathOverrideWatcher&&this.idPathOverrideWatcher.idPathWatcher.getIdPathMatcher()}}function c(e){this.id=e,this.useCount=0}return o.normal="normal",o.forceShow="forceShow",o.invert="invert",o.invertPick="invertPick",o.forceShowPlus="forceShowPlus",o})),define("DS/SceneGraphOverrides/SceneGraphOverrideSetManager",["DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/SceneGraphOverrides/SceneGraphOverrideSetToken","DS/Visualization/PathElement","DS/SceneGraphOverrides/IdPathOverrideWatcherTree"],(function(e,i,t,r){"use strict";return class{constructor(e){this.viewer=e.viewer||null,this.node=e.node||null,this.nodeId=e.nodeId||null,this.active=void 0===e.active||e.active,this._sceneGraphOverrideSetArray=[],this._idPathOverrideWatcher=e.idPathOverrideWatcher||null,this._refreshing=!1,this._oocManager=null,this._pgManager=null}pushSceneGraphOverrideSet(e,i){return this.insertSceneGraphOverrideSetAt(e,this._sceneGraphOverrideSetArray.length,i)}getSceneGraphOverrideSetAt(e){return this._sceneGraphOverrideSetArray[e].sceneGraphOverrideSet}getNumberOfSceneGraphOverrideSets(){return this._sceneGraphOverrideSetArray.length}getSceneGraphOverrideSetIndex(e){var i,t=-1;for(i=0;i<this._sceneGraphOverrideSetArray.length&&t<0;i++)this._sceneGraphOverrideSetArray[i].sceneGraphOverrideSet===e&&(t=i);return t}getSceneGraphOverrideSetByName(e){for(var i=0;i<this._sceneGraphOverrideSetArray.length;i++){var t=this._sceneGraphOverrideSetArray[i].sceneGraphOverrideSet;if(t&&t.name===e)return t}return null}getSceneGraphOverrideSetsByPrefix(e){for(var i=[],t=0;t<this._sceneGraphOverrideSetArray.length;t++){var r=this._sceneGraphOverrideSetArray[t].sceneGraphOverrideSet;r&&r.name.startsWith(e)&&i.push(r)}return i}removeSceneGraphOverrideSet(e){var i=this.getSceneGraphOverrideSetIndex(e);this.removeSceneGraphOverrideSetAt(i)}removeSceneGraphOverrideSetAt(e){if(e>-1&&e<this._sceneGraphOverrideSetArray.length){var i=this._sceneGraphOverrideSetArray.concat([]);i.splice(e,1),this._setSceneGraphOverrideSetArray(i)}}insertSceneGraphOverrideSetAt(i,t,r){if(!(i instanceof e))throw new Error("sceneGraphOverrideSet must be a SceneGraphOverrideSet");if(r=r||{},this._checkSceneGraphOverrideSetParameters(i,r)){if(!(this.getSceneGraphOverrideSetIndex(i)>=0)){var n=this._sceneGraphOverrideSetArray.concat([]);return n.splice(t,0,{sceneGraphOverrideSet:i,prefixPathes:r.prefixPathes,substractivePath:r.substractivePath}),this._setSceneGraphOverrideSetArray(n),!0}console.warn("SceneGraphOverrideSet already active")}else console.warn("SceneGraphOverrideSet not added because either prefixPathes or substractive path were missing/incorrect/provided.\nPlease check SceneGraphOverrideSetManager methods documentation");return!1}clear(){this._setSceneGraphOverrideSetArray([])}computeInheritedAttributes(e){if(!e)return null;this.viewer.getRootNode()._tryOverridesUpdate(this.viewer);var i=e._getUniqueOccurrence(this.viewer),t=null;if(i){let e=i.getOverrideLinkToUse();t=e?e.getAppliedPropertiesNEW():{}}return t}computeInheritedOpacity(e){var i=this.computeInheritedAttributes(e),t=null;return i&&i.opacity&&(t=i.opacity.value),t}computeInheritedMaterial(e){var i=this.computeInheritedAttributes(e),t=null;return i&&i.material&&(t=i.material.value),t}computeInheritedColor(e){var i=this.computeInheritedAttributes(e),t=null;return i&&i.color&&(t=i.color.value),t}computeInheritedVisibility(e){var i=this.computeInheritedAttributes(e),t=null;return i&&i.visibility&&(t=i.visibility.value),t}computeInheritedVisibilityFree(e){var i=this.computeInheritedAttributes(e),t=null;return i&&i.visibilityFree&&(t=i.visibilityFree.value),t}computeInheritedPickability(e){var i=this.computeInheritedAttributes(e),t=null;return i&&i.pickability&&(t=i.pickability.value),t}computeAppliedPosition(e){var i=this.computeInheritedAttributes(e),t=null;return i&&i.position&&(t=i.position.value),t}getCurrentVisibility(e){if(!e)return null;var i;this.viewer.getRootNode()._tryOverridesUpdate(this.viewer);var t=e._getUniqueOccurrence(this.viewer);return t&&(i=t._getVisible()&&!t._getInvertMode()),i}getCurrentVisibilityFree(e){if(!e)return null;var i;this.viewer.getRootNode()._tryOverridesUpdate(this.viewer);var t=e._getUniqueOccurrence(this.viewer);return t&&(i=t._getVisibilityFree()),i}hasSceneGraphOverrideSet(){return this._sceneGraphOverrideSetArray.length>0}createSceneGraphOverrideSet(i){return new e((i=i||{}).rootNode||this.node,i.nodeId||i.rootId||this.nodeId,i.allowNodeOverrides,void 0,i.name,i)}exportIdPathOverrides(e){if("position"!==e&&"visibility"!==e)return null;var i=0,t=new Map;for(i=0;i<this._sceneGraphOverrideSetArray.length;i++)this._sceneGraphOverrideSetArray[i].sceneGraphOverrideSet._exportIdPathOverrides(t,e);var r=[];return t.forEach((function(i,t){var n;r.push({idPath:[].concat(i.idPath.ids),value:"position"===e?(n=i.value,[].concat(n.elements)):i.value})})),r}_getSceneGraphOverrideSetArray(){return this._sceneGraphOverrideSetArray.concat([])}_setSceneGraphOverrideSetArray(e){if(!this.active)return void(this._sceneGraphOverrideSetArray=e.concat([]));if(this.viewer){if(this.viewer._sceneGraphStateVersion&&2!==this.viewer._sceneGraphStateVersion)throw console.warn("Cannot use both v1 and v2 sceneGraphStates"),Error();this.viewer._sceneGraphStateVersion||(this.viewer._sceneGraphStateVersion=2)}e=e||[];var i,t=0,r=this._sceneGraphOverrideSetArray;this._sceneGraphOverrideSetIdToRank={};let n=e.concat([]);for(this._sceneGraphOverrideSetArray=n,t=0;t<r.length;t++)i=r[t].sceneGraphOverrideSet,this._oocManager&&(i._setOOCManager(null),i.rootNode=null),this._pgManager&&i._setPGManager(null),i._deactivate(this.viewer,!1);var s;for(t=0;t<n.length;t++)i=(s=n[t]).sceneGraphOverrideSet,this._oocManager&&(i._setOOCManager(this._oocManager),i.rootNode=this.node),this._pgManager&&i._setPGManager(this._pgManager),i._activate(this.viewer,s.prefixPathes,s.substractivePath,t,this._getIdPathOverrideWatcher());for(t=0;t<r.length;t++)(i=(s=r[t]).sceneGraphOverrideSet)._isCurrentlyActive()||i._removeFromIdPathWatcher(this._getIdPathOverrideWatcher())}_activate(){if(!this.active){var e,i,t;for(e=0;e<this._sceneGraphOverrideSetArray.length;e++)t=(i=this._sceneGraphOverrideSetArray[e]).sceneGraphOverrideSet,this._oocManager&&(t._setOOCManager(this._oocManager),t.rootNode=this.node),this._pgManager&&t._setPGManager(this._pgManager),t._activate(this.viewer,i.prefixPathes,i.substractivePath,e,this._getIdPathOverrideWatcher());this.active=!0}}_deactivate(){if(this.active){var e,i;for(e=0;e<this._sceneGraphOverrideSetArray.length;e++)i=this._sceneGraphOverrideSetArray[e].sceneGraphOverrideSet,this._oocManager&&(i._setOOCManager(this._oocManager),i.rootNode=null),this._pgManager&&i._setPGManager(this._pgManager);this.active=!1}}_refresh(e){if(!this._refreshing){var i,t;for(this._refreshing=!0,i=0;i<this._sceneGraphOverrideSetArray.length;i++)(t=this._sceneGraphOverrideSetArray[i]).sceneGraphOverrideSet._deactivate(this.viewer,!0,e);for(i=0;i<this._sceneGraphOverrideSetArray.length;i++)this._sceneGraphOverrideSetArray[i].sceneGraphOverrideSet._activate(this.viewer,t.prefixPathes,t.substractivePath,i,this._getIdPathOverrideWatcher(),!0,e);this._refreshing=!1}}_checkSceneGraphOverrideSetParameters(e,i){var r;if(e.getAllowNodeOverrides()&&(i.prefixPathes||i.substractivePath)&&console.warn("prefixPathes and substractivePath are forbidden when allowNodeOverrides is true"),i.prefixPathes)for(r=0;r<i.prefixPathes.length;r++)if(!i.prefixPathes[r].checkExternalPath)return!1;if(i.substractivePath&&!i.substractivePath.checkExternalPath())return!1;if(this.node)return!!(this.node===e.rootNode||this.nodeId&&this.nodeId===e.rootId)||(console.warn("SceneGraphOverrideSet root must be equal to SceneGraphOverrideSetManager root"),!1);if(!e.rootNode&&e.nodesOnly)return!0;if(this.viewer){var n=this.viewer.getRootNode();if(n.children.indexOf(e.rootNode)>=0)return!(i.prefixPathes&&0!==i.prefixPathes.length||i.substractivePath);var s,a,h=i.prefixPathes||[new t],o=i.substractivePath&&i.substractivePath.externalPath,l=e.rootNode;if(o){if(e.rootNode!==o[0])return!1;l=o[o.length-1]}for(r=0;r<h.length;r++)if(0===(s=h[r].externalPath).length){if(n.children.indexOf(l)<0)return!1}else if(a=s[s.length-1],n.children.indexOf(s[0])<0||a!==l)return!1}else if(this.nodeId!==e.rootId)return!1;return!0}_hasIdPathOverride(e){var i;for(i=0;i<this._sceneGraphOverrideSetArray.length;i++)if(this._sceneGraphOverrideSetArray[i].sceneGraphOverrideSet._hasIdPathOverride(e))return!0;return!1}_getIdPathPositionOverride(e){var i,t,r=null;for(i=0;i<this._sceneGraphOverrideSetArray.length;i++)null!==(t=this._sceneGraphOverrideSetArray[i].sceneGraphOverrideSet._getIdPathPositionOverride(e))&&(r=t);return r}_updateOverridesWithMissingTarget(){var e;for(e=0;e<this._sceneGraphOverrideSetArray.length;e++)this._sceneGraphOverrideSetArray[e].sceneGraphOverrideSet._updateOverridesWithMissingTarget(this.viewer)}_getIdPathOverrideWatcher(){return this._idPathOverrideWatcher||this.viewer&&this.viewer._getIdPathOverrideWatcher()}_removeNodeId(){var e,i,t=[];for(e=0;e<this._sceneGraphOverrideSetArray.length;e++)null!=(i=this._sceneGraphOverrideSetArray[e]).rootId&&t.push(i);this._setSceneGraphOverrideSetArray(t)}dispose(){this._setOOCManager(null),this._setPGManager(null),2===this.viewer._sceneGraphStateVersion&&(this._setSceneGraphOverrideSetArray([]),this._idPathOverrideWatcher&&(this._idPathOverrideWatcher.dispose(),this._idPathOverrideWatcher=null))}_setOOCManager(e){var i;if(e!==this._oocManager)for(this._oocManager=e,i=0;i<this._sceneGraphOverrideSetArray.length;i++)this._sceneGraphOverrideSetArray[i].sceneGraphOverrideSet._setOOCManager(e)}_setPGManager(e){if(this._pgManager!==e){let i,t;for(this._pgManager=e,i=0;i<this._sceneGraphOverrideSetArray.length;i++)t=this._sceneGraphOverrideSetArray[i],t.sceneGraphOverrideSet._setPGManager(e)}}}})),define("DS/SceneGraphOverrides/CSIOverrideManager",["DS/Visualization/ThreeJS_DS","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/VisuLoaders/ThreeDXLoader","DS/Visualization/MaterialApplication","DS/Visualization/RenderMode","DS/Visualization/RenderStyle","DS/Visualization/Node3D","DS/WebVisuParameters/GraphicPropertyParameterHelper"],(function(e,i,t,r,n,s,a,h){"use strict";var o=function(e){this.viewer=e,this.repViewModeOverrides=new c(!1,"CSIRepViewMode",0),this.permanentRepViewModeOverrides=new c(!0,"CSIPermanentRepViewMode",1),this.viewModeFilterOverrides=new c(!0,"CSIViewModeFilter",1),this.visRenderingModeOverrides=new c(!0,"CSIVisRenderingMode",2),this.plmViewModeOverridesMap=new Map,this.viewpointPLMViewModeMap=new Map,this.nodeToPLMViewModeMap=new WeakMap,this.repViewModeParamsMap=new WeakMap,this.plmViewModeLoaded=!1,this.plmViewModeDataSets=[],this.plmCustomViewModeDataSet=null,this.currentPLMViewMode=null,this.viewToNodeMap=new WeakMap};function l(){this.plmViewModeData=[]}function d(){this.matApp=null,this.renderStyle=null}function c(e,i,t){this.name=i,this.enabled=e,this.overrideSet=null,this.overrideMap=null,this.index=t}return o.prototype.getRepViewModeOverride=function(e,i){return i?this.repViewModeOverrides.getOverride(e,this):this.permanentRepViewModeOverrides.getOverride(e,this)},o.prototype.getViewModeFilterOverride=function(e){return this.viewModeFilterOverrides.getOverride(e,this)},o.prototype.getVisRenderingModeOverride=function(e){return this.visRenderingModeOverrides.getOverride(e,this)},o.prototype.deleteRepViewModeOverride=function(e){this.repViewModeOverrides.deleteOverride(e),this.permanentRepViewModeOverrides.deleteOverride(e)},o.prototype.deleteViewModeFilterOverride=function(e){this.viewModeFilterOverrides.deleteOverride(e)},o.prototype.deleteVisRenderingModeOverride=function(e){this.visRenderingModeOverrides.deleteOverride(e)},o.prototype.setRepViewMode=function(e){this.repViewModeOverrides.setEnabled(e),this.viewModeFilterOverrides.setEnabled(e)},o.prototype._getPLMViewModeOverrides=function(e){var i=this.plmViewModeOverridesMap.get(e);return i||(i=new c(!1,"PLMViewMode"+e,1),this.plmViewModeOverridesMap.set(e,i)),i},o.prototype.getPLMViewModeOverrideSet=function(e){return this._getPLMViewModeOverrides(e).getOverrideSet(this)},o.prototype.getPLMViewModeOverride=function(e,i){return this._getPLMViewModeOverrides(e).getOverride(i)},o.prototype.deletePLMViewModeOverride=function(e,i){this._getPLMViewModeOverrides(e).deleteOverride(i)},o.prototype.setPLMViewMode=function(e,i){this._getPLMViewModeOverrides(e).setEnabled(i)},o.prototype.setViewpointPLMViewMode=function(e,i){var t=-1;this.viewpointPLMViewModeMap.has(e)?t=this.viewpointPLMViewModeMap.get(e):this.viewpointPLMViewModeMap.set(e,-1),t!==i&&(i>=0||this.setPLMViewMode(e,!1),this.viewpointPLMViewModeMap.set(e,i))},o.prototype.refreshPLMViewMode=function(e){return this.currentPLMViewMode?this.updatePLMViewMode(this.currentPLMViewMode,e):Promise.resolve(!0)},o.prototype.updatePLMViewMode=function(e,i){this.currentPLMViewMode=e;var r,n,s=[],a=new t;if(this.plmViewModeLoaded=!1,e._PLMCustomRenderingStyle?(this.plmCustomViewModeDataSet=new l,s.push(this.plmCustomViewModeDataSet.load(a,e._PLMCustomRenderingStyle,i,this.viewer))):this.plmCustomViewModeDataSet=null,e._PLMRenderingStyles)for(r=0;r<e._PLMRenderingStyles.length;r++)n=new l,this.plmViewModeDataSets[r]=n,s.push(n.load(a,e._PLMRenderingStyles[r],i,this.viewer));return Promise.all(s).then((()=>(this.plmViewModeLoaded=!0,this.applyPLMViewModes(),!0)))},o.prototype.applyPLMViewModes=function(e){this.plmViewModeLoaded&&this.viewpointPLMViewModeMap.forEach(((e,i)=>{this.plmCustomViewModeDataSet?this.applyPLMViewMode(i,4):this.applyPLMViewMode(i,e)}))},o.prototype.applyPLMViewMode=function(e,i){var t=this.plmViewModeOverridesMap.get(e);if(t&&t.resetOverrides(this),i>=0){var r=4===i?this.plmCustomViewModeDataSet:this.plmViewModeDataSets[i],n=(this.getPLMViewModeOverrideSet(e),this.getViewpointRoot(e));this.getPLMViewModeOverride(e,n)._setMaterialWeak(r.getMaterialApplication(0)),n.traverse((t=>{if(this.nodeToPLMViewModeMap.has(t)){var n=this.nodeToPLMViewModeMap.get(t),s=this.getPLMViewModeOverride(e,t);r.setupOverride(s,n[i])}})),this.setPLMViewMode(e,!0)}this.viewpointPLMViewModeMap.set(e,i)},o.prototype.getViewpointPLMViewModeDataSet=function(e){var i=this.viewpointPLMViewModeMap.get(e);return 4===i?this.plmCustomViewModeDataSet:i>=0?this.plmViewModeDataSets[i]:null},o.prototype.setNodePLMViewMode=function(e,i,t){var r,n=[];for(r=0;r<i._Styles.length;r++)n.push(i._Styles[r]);if(this.nodeToPLMViewModeMap.set(e,n),this.plmViewModeLoaded){var s=this.getViewpointPLMViewModeDataSet(t);if(s){var a=this.viewpointPLMViewModeMap.get(t),h=this.getPLMViewModeOverride(t,e);s.setupOverride(h,n[a])}}},o.prototype.getViewpointRoot=function(e){return this.viewer.getRootNode()},o.prototype.registerRepViewModeParams=function(e,i){this.repViewModeParamsMap.set(e,i)},o.prototype.getRepViewModeParams=function(e,i,t){let r=this.repViewModeParamsMap.get(e),n={repViewMode:void 0!==i?i:r?r.repViewMode:0,viewModeSensitive:void 0!==t?t:!!r&&r.viewModeSensitive};return this.repViewModeParamsMap.set(e,n),n},l.prototype.setupOverride=function(e,i){var t=this.plmViewModeData[i];0===i?(e._setMaterialWeak(t.matApp),t.renderStyle&&e._setRenderStyleWeak(t.renderStyle)):(e.setMaterial(t.matApp),t.renderStyle&&e.setRenderStyle(t.renderStyle))},l.prototype.getMaterialApplication=function(e){return this.plmViewModeData[e].matApp},l.prototype.load=function(e,i,t,r){var n,s,a=[];for(n=0;n<i._renderingStyleData.length;n++)s=new d,this.plmViewModeData.push(s),a.push(s.load(e,i._renderingStyleData[n],t,r));return Promise.all(a)},d.prototype.load=function(i,t,n,o){return new Promise(((n,l)=>{var d=new a;new h(t._edgeGas,this.clientManager).applyGP(this,d),d.setGAS(new e.GraphicAttributeSet.IncrementalGraphicAttributeSet({inheritance:e.GASEnum.RGBA_INHERITANCE_ON|e.GASEnum.LINEWIDTH_INHERIT|e.GASEnum.LINETYPE_INHERIT}));var c=d.getGAS(),v=c?c.getMaterial(null,1,null,o.getRenderer(),void 0,-1):new e.LineBasicMaterial({color:"black"});t._filterMode?(this.matApp=new r({}),n(!0)):t._meshMaterial?i.load({json:t._meshMaterial._json,doneCallback:e=>{this.renderStyle=new s,this.renderStyle.setRenderMode("Face",!0),this.renderStyle.setRenderMode("@Edge",t._edgeVisibility),this.matApp=new r({lineMaterial:v,faceMaterial:e.material}),n(!0)}}):(this.matApp=null,n(!0))}))},c.prototype.getOverrideSet=function(e){if(null===this.overrideSet){var t=e.viewer.getSceneGraphOverrideSetManager();this.overrideSet=new i(null,null,!0,void 0,this.name,{nodesOnly:!0}),this.overrideSet.enable(this.enabled),t.insertSceneGraphOverrideSetAt(this.overrideSet,this.index,{}),this.overrideMap=new WeakMap}return this.overrideSet},c.prototype.resetOverrides=function(e){null!==this.overrideSet&&(this.enabled=!1,this.overrideMap=null,e.viewer.getSceneGraphOverrideSetManager().removeSceneGraphOverrideSet(this.overrideSet),this.overrideSet=null)},c.prototype.getOverride=function(e,i){var t;(this.overrideMap&&(t=this.overrideMap.get(e)),t)||(t=this.getOverrideSet(i)._createNodeOverride(e),this.overrideMap.set(e,t));return t},c.prototype.deleteOverride=function(e){var i;null!==this.overrideSet&&((i=this.overrideMap.get(e))&&(this.overrideSet.deleteOverride(i),i=null,this.overrideMap.delete(e)))},c.prototype.setEnabled=function(e){var i=!!e;this.enabled!==i&&(this.enabled=i,this.overrideSet&&this.overrideSet.enable(i))},o}));