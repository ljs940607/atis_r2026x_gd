define("DS/XCADSTPXDocument/STPXProductRepresentation",["DS/XCADInputDocuments/XCADProductRepresentation"],(function(e){"use strict";return e.extend((function(e,t,s){this._name=s,this._associatedDocument=e,this._representationType=t,this._rootProducts=[]}),{addRootProduct:function(e){this._rootProducts.push(e)}})})),define("DS/XCADSTPXDocument/STPXProductInstance",["DS/XCADInputDocuments/XCADProductInstance"],(function(e){"use strict";return e.extend((function(e,t){this._document=e,this._STPXProductInstance=t}),{getGeometricProperties:function(){throw"Error: not implemented method"},getInstanceAttributes:function(){var e=[];return e.push(this._STPXProductInstance.instanceName),e},getReferenceProduct:function(){return this._document.getProductReference(this._STPXProductInstance.productReferenceIdx)},getUID:function(){throw"Error: not implemented method"},getTransformation:function(){var e,t=this._STPXProductInstance.transfo;if(void 0!==t){var s=t.rotation.elements,i=t.translation;e=[[[s[0],s[1],s[2]],[s[3],s[4],s[5]],[s[6],s[7],s[8]]],[i.x,i.y,i.z]]}return e}})})),define("DS/XCADSTPXDocument/STPXProduct",["exports","DS/XCADInputDocuments/XCADProduct","DS/XCADSTPXDocument/STPXProductInstance"],(function(e,t,s){"use strict";var i=t.extend((function(e,t){this._document=e,this._STPXProduct=t}),{getDocument:function(){var e,t;return this._STPXProduct.geometries&&0!=this._STPXProduct.geometries.length&&(t=this._STPXProduct.geometries),null!=t&&((e=this._document)._internalRepresentationIndex=t[0].url),e},getFilePath:function(){var e;return void 0!==this._STPXProduct.geomRep&&null!==this._STPXProduct.geomRep&&"geometry"===this._STPXProduct.geomRep.type&&(e=this._STPXProduct.geomRep.folder+"/"+this._STPXProduct.geomRep.filename),e},getGeometricProperties:function(){throw"Error: not implemented method"},getInstanceList:function(){for(var e=[],t=this._STPXProduct.childrenList.length,i=0;i<t;i++){var n=new s(this._document,this._STPXProduct.childrenList[i]);null!=n&&e.push(n)}return e},getProductAttributes:function(){var e;void 0!==this._STPXProduct.geomRep&&null!==this._STPXProduct.geomRep&&"geometry"===this._STPXProduct.geomRep.type&&(e=this._STPXProduct.geomRep.fileContent);var s=[];return s.push(this._STPXProduct.referenceName),s.push(e),s.push(""),s.push(""),s.push(""),s.push(t.SourceTypes.Unknown),s},getUID:function(){throw"Error: not implemented method"}});return e.STPXProduct=i,i})),define("DS/XCADSTPXDocument/STPXInputDocument",["DS/XCADInputDocuments/XCADInputDocument","DS/XCADInputDocuments/XCADRepresentation","DS/XCADSTPXDocument/STPXProductRepresentation","DS/XCADSTPXDocument/STPXInputDocument","DS/XCADSTPXDocument/STPXProduct","DS/XCADLoader/XCADLoader","DS/VisuLoaders/CGRReader","DS/Visualization/Utils","DS/Mesh/ThreeJS_Base","DS/EasySax/EasySax"],(function(e,t,s,i,n,r,o,a,c,u){"use strict";return e.extend((function(){this.url=null,this.sceneGraph=null,this.spec=null,this.folder=null,this.refFiles=[],this.cgrLoader=null,this.shapeRepListMap=new Map,this.assyProductsMap=new Map,this.assyProducts=[],this.rootProducts=[],this.nbInstPart=0,this.rootBbox=void 0,this.rootName=void 0,this.childSet=new Set,this.nbExternalRef=0,this._filesSet=new Set,this._Files=[],this._Parts=[],this._VORs=[],this._occurencesMap=new Map,this._matchingDoc=new Map,this._matchingRC=new Map,this._matchingBBox=new Map,this._matchingFile=new Map,this.filesuids=[],this._missingPart=[],this._roots=[]}),{zipped:!1,requestResponseType:"text",close:function(){},getGeomRep:function(e){throw"Error: not implemented method"},getInstanceList:function(e){throw"Error: not implemented method"},getReferencedFiles:function(){throw"Error: not implemented method"},getReferenceName:function(e){throw"Error: not implemented method"},getRepresentationType:function(e){throw"Error: not implemented method"},getTransformation:function(e){throw"Error: not implemented method"},getRootProducts:function(){return this.rootProducts},initialize:async function(e){console.log("initialize");var t=this;let s,i,n,r,o,a=!1,h=!1,l=!1,d=!1,p=!1,P=!1,_=!1,m=!1,g=!1,f=!1,D=!1,S=!1,R=!1,X=!1,F=!1;var b=[];if("string"==typeof e)b[0]=e;else{var T=268435456,v=new TextDecoder("utf-8");if(e.byteLength>T){let t=0,s=T,i=0;for(;s<e.byteLength;)b[i]=v.decode(e.slice(t,s)),i++,t=s+1,s+=T;b[i]=v.decode(e.slice(t,e.byteLength))}else b[0]=v.decode(e)}var x=new u;x.on("startNode",(function(e,i){var n=i();switch(e){case"Header":a=!0;break;case"DataContainer":case"Document":break;case"File":if(h=!0,!l){var c={uid:n.uid,path:".",root:s};t._matchingFile.set(c.uid+s,t._Files.length),t._Files.push(c)}break;case"Id":null!=n.id&&!0===h&&(t._Files[t._Files.length-1].filename=n.id),null!=n.id&&!0===_&&!0===X&&(t._Parts[t._Parts.length-1].occurences[t._Parts[t._Parts.length-1].occurences.length-1].id=n.id);break;case"Identifier":null!=n.id&&!0===_&&!0===X&&(t._Parts[t._Parts.length-1].occurences[t._Parts[t._Parts.length-1].occurences.length-1].id=n.id);break;case"IdentifierString":d=!0;break;case"DocumentVersion":l=!0,o=n.uid;break;case"ClassString":p=!0;break;case"Part":_=!0;var u={uid:n.uid,root:s,occurences:[],vors:[],bbox:[]};t._Parts.push(u);break;case"Name":P=!0;break;case"CharacterString":R=!0;break;case"Occurrence":if(X=!0,null!=n.uid&&!0===_){var b={uid:n.uid};t._Parts[t._Parts.length-1].occurences.push(b)}break;case"AssignedDocument":if(_){let e=n.uidRef;t._Parts[t._Parts.length-1].AssignedDocumentUidRef=e}break;case"ViewOccurrenceRelationship":m=!0;var T={uid:n.uid,idx:t._VORs.length,part_idx:-1};_&&(T.part_idx=t._Parts.length-1),h&&(T.File_id=t._Files[t._Files.length-1].id),t._VORs.push(T);break;case"Related":m&&(t._VORs[t._VORs.length-1].uidRef=n.uidRef);break;case"RotationMatrix":g=!0;break;case"TranslationVector":f=!0;break;case"RepresentationContext":r=n.uid,D=!0;break;case"DigitalFile":l&&t._matchingDoc.set(o,n.uidRef);break;case"ShapeDependentProperty":S=!0;break;case"DefinedIn":_&&S&&(t._Parts[t._Parts.length-1].bbox[t._Parts[t._Parts.length-1].bbox.length]=n.uidRef);break;case"Coordinates":F=!0}})),x.on("textNode",(function(e,o){!0===h&&(!0===d&&(t._Files[t._Files.length-1].path=e),!0===p&&(t._Files[t._Files.length-1].type=e)),!0===m&&(!0===g&&(i=e),!0===f&&(n=e)),!0===_&&P&&R&&void 0===t._Parts[t._Parts.length-1].name&&(t._Parts[t._Parts.length-1].name=e+t._Parts[t._Parts.length-1].uid),D&&F&&t._matchingRC.set(r,e),a&&P&&void 0===s&&(s=e)})),x.on("endNode",(function(e){switch(e){case"Header":a=!1;break;case"DataContainer":s=void 0;break;case"File":h=!1;break;case"Id":case"Document":break;case"IdentifierString":d=!1;break;case"ClassString":p=!1;break;case"Part":_=!1;break;case"Name":P=!1;break;case"CharacterString":R=!1;break;case"Occurrence":X=!1;break;case"ViewOccurrenceRelationship":let e=(r=i.trim().split(" "),u=n.trim().split(" "),(b=new c.Matrix4).set(parseFloat(r[0]),parseFloat(r[3]),parseFloat(r[6]),parseFloat(u[0]),parseFloat(r[1]),parseFloat(r[4]),parseFloat(r[7]),parseFloat(u[1]),parseFloat(r[2]),parseFloat(r[5]),parseFloat(r[8]),parseFloat(u[2]),0,0,0,1),b);t._VORs[t._VORs.length-1].curTransfo=e,!0===_&&t._Parts[t._Parts.length-1].vors.push(t._VORs[t._VORs.length-1]),m=!1;break;case"RotationMatrix":g=!1;break;case"TranslationVector":f=!1;break;case"RepresentationContext":D=!1;break;case"DocumentVersion":l=!1,o=void 0;break;case"ShapeDependentProperty":S=!1;break;case"Coordinates":F=!1}var r,u,b})),t.processSTPXFileV2(b,x,(function(){t._missingPart.length>0&&console.log("missingPart");for(let e=0;e<t._Parts.length;e++)for(let s=0;s<t._Parts[e].vors.length;s++)t._occurencesMap.set(t._Parts[e].root+t._Parts[e].vors[s].uidRef,t._Parts[e].vors[s].idx);for(var e=0;e<t._Parts.length;e++)t.processOccurenceV2(t._Parts[e])}))},processSTPXFileV2:function(e,t,s,i,n){let r=0;t.parse(e);for(var o=0;o<this._Files.length;o++){let e;e=void 0===i?this._Files[o].uid:i;var a=this._Files[o].filename.substring(this._Files[o].filename.lastIndexOf(".")+1,this._Files[o].filename.length);if(("geometry"==this._Files[o].type||"STPX"!=a.toUpperCase())&&"/NULL"!==this._Files[o].filename){let t=this._Files[o].path;t.startsWith("./")?t=t.substring(2,t.length):t.startsWith(".")&&(t=t.substring(1,t.length));let s=t+this._Files[o].filename;null!=s?this.shapeRepListMap.set(e+this._Files[o].root,{type:this._Files[o].type,filename:this._Files[o].filename,folder:this._Files[o].path}):this._missingPart.push(s)}if(!1===this._filesSet.has(this._Files[o].path+this._Files[o].filename)){r++,this._filesSet.add(this._Files[o].path+this._Files[o].filename);this._Files[o].uid;"STPX"===a.toUpperCase()&&this.nbExternalRef++}}null!=n&&n(this),null!=n||0!=r&&0!=this.nbExternalRef||s()},processOccurenceV2:function(e){let t,s,i,n,r;for(let o=0;o<e.occurences.length;o++){let a=this._occurencesMap.get(e.root+e.occurences[o].uid);t=e.occurences[o].id,s=e.name,i=this._Parts[this._VORs[a].part_idx].name;let c=i?this._matchingBBox.get(s):void 0;if(n=e.AssignedDocumentUidRef,null!=n&&n.startsWith("DV")&&(n=this._matchingDoc.get(n)),null!=n){let t=this._matchingFile.get(n+e.root);"STPX"===this._Files[t].filename.substring(this._Files[t].filename.lastIndexOf(".")+1,this._Files[t].filename.length).toUpperCase()?n+=this._Files[t].filename:n+=e.root}if(r=e.AssignedDocumentUidRef,null!=r&&r.startsWith("DV")&&(r=this._matchingDoc.get(r)),null!=r){let t=this._matchingFile.get(r+e.root);"STPX"===this._Files[t].filename.substring(this._Files[t].filename.lastIndexOf(".")+1,this._Files[t].filename.length).toUpperCase()?r+=this._Files[t].filename:r+=e.root}if(null!==s&&null!==s){if(!1===this.assyProductsMap.has(i)&&(this.assyProductsMap.set(i,{referenceName:i,isRoot:!0,childrenList:[],geomRep:this.shapeRepListMap.get(r)}),this.rootProducts.push(i),this.rootName=i,this.rootBbox=c),!0===this.assyProductsMap.has(s)){this.assyProductsMap.get(s).isRoot=!1;let e=this.rootProducts.indexOf(s);-1!=e&&this.rootProducts.splice(e,1)}else this.assyProductsMap.set(s,{referenceName:s,isRoot:!1,childrenList:[],geomRep:this.shapeRepListMap.get(n)});this.assyProductsMap.get(i).geomRep=void 0,this.assyProductsMap.get(i).childrenList.push({instanceName:t,productReferenceIdx:s,transfo:this._VORs[a].curTransfo,bbox:c})}}},getProductReference:function(e){return new n(this,this.assyProducts[e])}})}));