window.teacherParams||(window.performance.mark("createWidget_begin"),require(["UWA/Widget","DS/i3DXCompass/Data"],(function(e,t){var i=window.widget=new e;window.dsDashboardWindow=window.parent.dsDashboardWindow;var a=!widget.body;i.body=i.body?i.body:UWA.createElement("div"),i.body.addClassName("FolderEditor"),i.body.setStyles({height:"100%",width:"100%",position:"relative","text-align":"initial","z-index":1});const o=new URLSearchParams(new URL(window.location.href).search);window.bmkId=o.get("bmkId"),window.dsUserLogin=o.get("userId"),window.platformURLs={compassUrl:decodeURI(o.get("compassUrl"))},window.platformId=o.get("platformId"),window.lang=o.get("lang"),i.widgetDomain=window.parent.widget.widgetDomain,i.id="preview-0a9c8e",i.title="Bookmark Editor",i.setValue("x3dPlatformId",window.platformId),i.platformId=window.platformId,i.setValue("x3dAppId","ENOFOL3_AP"),i.setValue("x3dSharedId",i.id),i.setValue("useIndexAccleration",!1),i.setValue("embeddedWidget",!0),i.lang=window.lang,a&&(document.body.setStyles({"overflow-y":"hidden"}),i.body.inject(document.body,"top")),i.launch();var n,s=(n={privateOrgName:"",publicOrgName:"",context:"",isClass:!1,isCourse:!1,dashboardUrl:""},{setParams:function(e){n.privateOrgName=e.get("privateOrgName")||"",n.publicOrgName=e.get("publicOrgName")||"",n.context=decodeURIComponent(e.get("context")||""),n.isClass="true"===e.get("isClass"),n.isCourse="true"===e.get("isCourse"),n.dashboardUrl=e.get("dashboardUrl")||"",window.teacherParams=n,i.setValue("pad_security_ctx",(n.context.startsWith("ctx::")?"":"ctx::")+n.context)},getParams:function(){return n}});s.setParams(o),window.IPConfig&&(window.IPConfig.plugins=["DS/BookmarkEditor/plugins/BkPlugin","DS/TeachersBookmarkEditor/plugins/TeachersPlugin"],window.IPConfig.settingsFile="text!DS/FolderEditor/assets/folder_settings.json",window.IPConfig.toolbarCmds={file:"DS/TeachersBookmarkEditor/plugins/TeachersPlugin",method:"getToolbarCmds"},window.IPConfig.columnDefinition="DS/TeachersBookmarkEditor/assets/FolderEditorColumns.json",window.IPConfig.computedColumns=window.IPConfig.computedColumns.filter((e=>"DS/FolderEditor/views/additionalColumns/FolderIsLastRevisionColumn"!==e)),window.IPConfig.computedColumns.includes("DS/TeachersBookmarkEditor/views/additionalColumns/VisibilityColumn")||window.IPConfig.computedColumns.push("DS/TeachersBookmarkEditor/views/additionalColumns/VisibilityColumn"),window.IPConfig.layout={treeView:!1}),new FolderEditor({widget:i,container:i.body,folderToOpen:window.bmkId})}))),define("DS/TeachersBookmarkEditor/utils/TeacherEventManager",["DS/IPClassifyUtil/IPClassifyModelEvents","DS/FolderEditor/Folder_CSO","DS/IPClassifyUXUtil/service/IPClassifyUXUtilWebService"],((e,t,i)=>({InitializeEvents:async function(){this.createCustomEvents(),this.listenCustomEvents();let t=window.teacherParams;this.url=await i.getSourceURI("3DDashboard"),t.isClass?e.publish({event:"update_column_visibility",data:{dataIndex:"Visibility",visible:!0}}):t.isCourse&&e.publish({event:"update_column_visibility",data:{dataIndex:"Visibility",visible:!1}})},createCustomEvents:async function(){e.subscribe({event:"previewFile"},(()=>{const e=this.url.match(/^https?:\/\/[^/]+/)[0];window.parent.postMessage({eventType:"hide-info-option"},e)})),e.subscribe({event:"close-preview2"},(()=>{const e=this.url.match(/^https?:\/\/[^/]+/)[0];window.parent.postMessage({eventType:"show-info-option"},e)})),e.subscribe({event:"openBookmark"},(()=>{let e=t.getSelectedContent();if(e&&e.length&&1===e.length){let t={eventType:"teacherBmkOpened",options:{label:e[0].label,bmkId:e[0].id,maturity:e[0]._options.grid["ds6w:status"],owner:e[0]._options.grid.owner}};const i=this.url.match(/^https?:\/\/[^/]+/)[0];window.parent.postMessage(t,i)}})),e.subscribe({event:"updateBMESelection"},(()=>{let e=t.getSelectedContent(),i={eventType:"teacherBmkSelected",options:e&&1===e.length?{label:e[0].label,bmkId:e[0].id,type:e[0].getType(),maturity:e[0]._options.grid["ds6w:status"],owner:e[0]._options.grid.owner}:{}};const a=this.url.match(/^https?:\/\/[^/]+/)[0];window.parent.postMessage(i,a)}))},listenCustomEvents:function(){window.addEventListener("message",(i=>{this.url&&i.origin===this.url.match(/^https?:\/\/[^/]+/)[0]&&(i.data.eventType&&"routeToDesiredBmk"===i.data.eventType?i.data.options.bmkId&&t.dispatchBookmarkIdSelection(i.data.options.bmkId):i.data.eventType&&"unselect-bmk-node"===i.data.eventType&&e.publish({event:"unselect_content"}))}))}}))),define("DS/TeachersBookmarkEditor/views/additionalColumns/VisibilityColumn",["UWA/Core","UWA/Class","i18n!DS/TeachersBookmarkEditor/assets/nls/additionalColumn","DS/IPClassifyUXUtil/service/IPClassifyUXUtilWebService","DS/FolderEditor/service/FolderEditorWebService","DS/IPClassifyUXUtil/ProgressPaneExecution","DS/IPClassifyUXUtil/utils/DictionaryAccess","DS/IPClassifyUtil/IPClassifyAlert"],(function(e,t,i,a,o,n,s,r){"use strict";async function l(e,t){try{const i=`/resources/v1/modeler/dseng/dseng:EngItem/${e}/expand`,o={expandDepth:-1,withPath:!1,type_filter_bo:["VPMReference","VPMRepReference"],type_filter_rel:["VPMInstance","VPMRepInstance"]},n=(await a._executeQuery(i,{method:"POST",type:"json",withCSRF:!0,headers:{"Content-Type":"application/json"},data:JSON.stringify(o)},"expandChildren")).member||[];for(const e of n)if(!["VPMInstance","VPMRepInstance"].includes(e.type)){const i={id:e.id,status:e.state,type:e.type};t[i.id]||(t[i.id]=i)}}catch(t){console.error(`Failed to expand children for ID ${e}:`,t)}}function d(e){var t=e;t.inSource="3DSpace",t.method="POST",t.type="json",t.withCSRF=!0,t.headers={"content-type":"application/json"};var i={data:e.data};return t.data=JSON.stringify(i),a._executeQuery("/resources/v1/modeler/dslc/maturity/changeState",t,"changeMaturityState")}async function c(e,t){try{let i={content:"All",filterChildren:"",noSizeLimit:!1,pid:e.bookmarkId,section:"FolderSection_AllFolders",smartFiltering:void 0,sortModel:{dataIndex:"ds6w:label",sort:"asc"},type:"Workspace Vault"},a=o.content(i),n=await Promise.all([a]);for(const e of n)if(e.content&&e.content.length>0)for(const i of e.content)i.id&&(t[i.id]={id:i.id,status:i.status,type:i.type},"Workspace Vault"===i.type?await c({bookmarkId:i.id},t):"VPMReference"!==i.type&&"VPMRepReference"!==i.type||await l(i.id,t))}catch(e){console.error("Error fetching bookmarks:",e)}return t}async function u(e,t){let i={};i[e]={id:e,status:t.getInternalValue("current"),type:t.getType()};try{const a=t.getType();"Workspace Vault"===a?i=await c({bookmarkId:e},i):"VPMReference"!==a&&"VPMRepReference"!==a||await l(e,i)}catch(e){console.error("Error collecting sub-bookmarks/children:",e)}return Object.values(i)}async function p(e){return new Promise((async(t,o)=>{try{let o=e.id,l=await u(o,e),c=[],p=e.getInternalValue("ds6w:organizationResponsible")===m.privateOrgName?m.publicOrgName:m.privateOrgName,g=[];for(let e=0;e<l.length;e+=25)g.push(l.slice(e,e+25));let w=1===l.length?i.replace(i.progressSingle,{targetfolder:e.getLabel()}):i.replace(i.progressMultiple,{objectsAdded:l.length,targetfolder:e.getLabel()});await n.execute({title:w,datas:g,query:async t=>{let i={data:t.map((e=>({bmkInfo:e})))};var o=await async function(e){let t=e.data.map((e=>({data:e.bmkInfo})));for(let e of t)if(("Draft"===e.data.status||"Create"===e.data.status)&&"Workspace Vault"===e.data.type){let t=await d({data:[{id:e.data.id,nextState:"Active"}]});t&&console.log(t)}e.inSource="3DSpace",e.method="POST",e.type="json",e.withCSRF=!0,e.headers={"content-type":"application/json"};let i={data:e.data.map((e=>({id:e.bmkInfo.id})))};var o={organization:e.company,owner:e.user,collabspace:e.collabSpace,data:i.data};return e.data=JSON.stringify(o),await a._executeQuery("/resources/v1/modeler/dslc/ownership/transfer",e,"transferOwnership")}({user:e.getInternalValue("owner"),data:i.data,company:p,collabSpace:e.getInternalValue("ds6w:project")});c.push(...o.results)}});if(c.length){e.withTransactionUpdate((e=>{let t=e.nodeModel,a=t.options.grid.Visibility===i.isVisible;delete t.options.gridValue["ds6w:organizationResponsible"],"Create"===t.options.gridValue["ds6w:status"]?(delete t.options.gridValue["ds6w:status"],delete t.options.gridValue.current,t.updateOptions({grid:{Visibility:a?i.isHidden:i.isVisible,"ds6w:organizationResponsible":p,"ds6w:status":"Workspace.Active",current:"Workspace.Active"}})):t.updateOptions({grid:{Visibility:a?i.isHidden:i.isVisible,"ds6w:organizationResponsible":p}}),s.updateNLS(t)}));let a=c.filter((e=>200===e.status)).length,o=c.filter((e=>200!==e.status)).length;a>0&&(1===a?r.displayNotification({message:i.replace(i.msgSuccess,{itemCount:a}),className:"success"}):r.displayNotification({message:i.replace(i.msgMultipleSuccess,{itemCount:a}),className:"success"})),o>0&&(1===o?r.displayNotification({message:i.replace(i.msgError,{itemCount:o}),className:"error"}):r.displayNotification({message:i.replace(i.msgMultipleError,{itemCount:o}),className:"error"})),t(c)}else r.displayNotification({message:i.msgMaturityError,className:"error"})}catch(e){console.error("Error in func:",e),o(e)}}))}var m=[],g=t.singleton({init:function(e){this._parent(e),m=window.teacherParams},isAdditionalColumnsAvailable:function(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");!function(e){var t={dataIndex:"Visibility",text:i.column_Visibility,width:"auto",isHidden:!1,sortableFlag:!1,alignment:"left",typeRepresentation:"url",getCellValue:function(e){var t=e.nodeModel;if(t.getAttributeValue("links")||t.getAttributeValue("serviceId")&&"3DSpace"!==t.getAttributeValue("serviceId"))return;let a=(t.options.grid.Visibility?t.options.grid.Visibility.toString():"")===i.isVisible;return{icon:a?"eye":"eye-off",label:a?i.isVisible:i.isHidden,url:"",func:async e=>{await p(e.context.nodeModel)}}},customisation:{dataIndex:"Visibility",exportable:{lock:!1,value:!0},layout:{removable:!1}}};g._columnDataIndex=["Visibility"],g._columnDef={Visibility:t},e()}((function(){t(!0)}))},getName:function(){return"Visibility"},getManagedColumnNames:function(){return this._columnDataIndex},toBeUpdated:function(e,t){var i=!1;return void 0!==e.Visibility&&""!==e.Visibility||(i=!0),i},getOnCellClickCB:function(e,t){return e===this.getName()&&(t.target.className.contains("wux-button-icon-placeholder")||t.target.className.contains("wux-tweaker-function")),!1},updateAttributes:function(e,t){var a=[];e.pids.forEach((function(t){var i=e.nodes.find((e=>e.id===t));a.push({id:t,label:i?i.getInternalValue("ds6w:organizationResponsible"):null})}));var o={pids:{}};a.forEach((e=>{let t=m.privateOrgName===e.label?i.isHidden:i.isVisible;o.pids[e.id]={Visibility:t}})),t(o=JSON.stringify(o))},getAdditionalColumnsUXDGV:function(t){for(var i=[],a=0;a<t.length;a++)i.push(t[a].dataIndex);for(var o=0;o<this._columnDataIndex.length;o++){var n=this._columnDataIndex[o],s=e.clone(this._columnDef[n]),r=i.indexOf(n);-1===r?t.push(s):t[r]=e.extend(t[r],s,!0)}}});return g})),define("DS/TeachersBookmarkEditor/plugins/TeachersPlugin",["DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/service/FolderEditorWebService","DS/TeachersBookmarkEditor/utils/TeacherEventManager","DS/IPClassifyUtil/IPClassifyUtility"],((e,t,i,a)=>{var o={unstable:["ActionBar_NewFolderCmd","AddExistingContent","FolderUpload","AddFile","AddExternalLink",{Name:"DocumentCommands",icon:"update",Commands:[]},"DownloadFile",{Name:"RemoveCommands",Commands:["RemoveContent","RemoveShortcut","DeleteHdr"]}],stable:[{Name:"display",Commands:["thumbnailview","tileview","datagridview"],type:"layout"}],ctxMenu:["openWith","openInV5","OpenInCADHdr","ActionBar_NewFolderCmd","AddExistingContent","AddFile","AddExternalLink","RenameCmd","PreviewFile","BookmarkLocation","ExpandAll","CollapseAll","ActionBar_FindInCtxCmd","Cut","Copy","Paste","DocumentCommands","ActiveFolder","FolderDownload","DownloadFile","SetThePartNumber","OpenExternalLink","RemoveContent","DeleteHdr"]};let n={DeleteHdr:{TREE:{treeNode:!0}}};return{getToolbarCmds:function(){return new Promise((a=>{t.getToolbar().then((e=>{e&&(console.log(e),function(e,t){function i(e,t){return e.filter((e=>"sep"===e||("string"==typeof e?t.includes(e):e.Name&&t.some((t=>t.Name===e.Name)))))}e.ctxMenu&&t.ctxMenu&&(e.ctxMenu=i(e.ctxMenu,t.ctxMenu)),e.toolbar&&(e.toolbar.stable&&t.stable&&(e.toolbar.stable=i(e.toolbar.stable,t.stable)),e.toolbar.unstable&&t.unstable&&(e.toolbar.unstable=i(e.toolbar.unstable,t.unstable)))}(e,o),a(e),i.InitializeEvents())})).catch((t=>{strError=t.serverErr,strError&&strError.error&&e.displayNotification({message:strError.error,className:"error"}),a()}))}))},updateCmdsRules:function(e){a.concatJsonValue(e,n)}}}));