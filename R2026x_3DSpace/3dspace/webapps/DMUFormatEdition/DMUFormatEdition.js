define("DS/DMUFormatEdition/DMUEditFormatsCmd",["UWA/Utils","DS/CATWebUXComponents/DMUCommand","DS/DMUControls/EXPNotify","DS/DMUBaseExperience/DMUContextManager","DS/DMUPlaySlide/DMUFormat","DS/DMUBaseUIControllers/DMUSlidesController","i18n!DS/DMUFormatEdition/assets/nls/DMUFormatEdition"],(function(e,t,r,n,i,o,a){"use strict";return t.extend({init:function(t){this._parent(t,"exclusive");var s,d=this;this.beginExecute=function(){var t=n.getReviewContext({viewer:d.getFrameWindow().getViewer()});if(!t)return void this.done();let l=t.getValidation();if(l||t){let f=l?l.getCurrentMarkup():null;for(;f&&"Markup"!==f.getValType();)f=f.getParentRepRef().getParent();f&&f.getValType&&"Markup"===f.getValType()&&(f=f.getRepRef());var m=f?f.getMarkupContent():t.getCurrentSessionMarkup();if(m){m.isVisible()||(t.getTransientReviewBag().removeDMUObjects(),m.setVisibleFlag(!0));var g=t.getEnvironment().getEnvironmentInfo(),u=!t.getUIManager().getFormatEditionModeFlag();if(t.getUIManager().setFormatEditionModeFlag(u),u&&!m.getFormats().length){var c=new i(d.getFrameWindow().getViewer(),m);c.setAttributes([{name:"sID",value:m.computeNewID()},{name:"sUuid",value:e.getUUID()},{name:"sName",value:m.computeNewName({object:c,prefix:a.normalFormatTitle})}]),c.updateEnvironmentOverload({target:t.getEnvironment(),state:g}),m.addFormat(c),c.fireEvent("onDMUObjectInitialized",{dmuObject:c,dmuCont:m,mkpRepRef:f});var D=o.giveDMUSlidesController({context:d.getFrameWindow()});D&&D.setActiveSlide(c,{duration:0})}s&&s.destroy(),s=new r({body:d.getFrameWindow().getUIFrame(),type:"info",message:u?a.formatEditionModeStarted:a.slideEditionModeStarted});var h=n.giveEventsController({viewer:d.getFrameWindow().getViewer()});h&&h.fireEvent(u?"onFormatsEditionModeStarted":"onFormatsEditionModeEnded")}}d.end(),d.done&&d.done()}}})})),define("DS/DMUFormatEdition/DMUFormatEdition",[],(function(){})),define("DS/DMUFormatEdition/DMUFormatChooserCtrl",["UWA/Core","UWA/Class","DS/Selection/CSOManager","DS/CATWebUXComponents/CATWebUXPanel","DS/DMUBaseExperience/DMUContextManager","DS/DMUControls/DMUThumbnailChooser","DS/DMUBaseUIControllers/DMUSlidesController","DS/WebappsUtils/WebappsUtils","DS/CATWebUXComponents/DMUCommandsManager","i18n!DS/DMUFormatEdition/assets/nls/DMUFormatEdition"],(function(e,t,r,n,i,o,a,s,d,l){"use strict";var m=t.extend({init:function(t){this._parent(t);var m,g=t||{},u=!1,c=null,D={},h=!1,f=this,U=e.createElement("canvas"),M=function(){m&&(m.clean(),m=null),c&&(c.setPanelVisibilityFlag(!1),c.clean(),c=null)},v=function(){u&&f.setActiveState(!1)};this.setActiveState=function(t){(u=t)?(h||(D.onAdd=r.onAdd(v),D.onRemove=r.onRemove(v),D.onEmpty=r.onEmpty(v),h=!0),function(){if(M(),u){var t,r=i.getReviewContext({viewer:g.frmWindow.getViewer()});if(r){var D=r.getCurrentSessionMarkup();if(D){var h=D.getFormats(),v=D.getCurrentSlide(),p=r.getUIManager().getSelectedObjects(),S=!1;if(p&&p.length){for(t=p.length-1;t>=0;t--){if("DMUSlide"!==p[t].getType())return;p[t]===v&&(S=!0,p.splice(t,1))}v&&S&&p.push(v);var C=1===p.length?p[0].getPointedFormats():null;if(!p.length)return;var F=[],w=e.createElement("img",{src:v&&S?v.getPreview():p[0].getPreview()}),E=U.getContext("2d");U.width=w.width,U.height=w.height,E.drawImage(w,0,0,w.width,w.height);for(var b=E.getImageData(0,0,w.width,w.height),A=0;A<b.height;A++)for(var W=0;W<b.width;W++){var y=4*A*b.width+4*W,P=(b.data[y]+b.data[y+1]+b.data[y+2])/3;b.data[y]=P,b.data[y+1]=P,b.data[y+2]=P}for(E.putImageData(b,0,0,0,0,w.width,w.height),F.push({id:"noFormat",title:l.NoFormat,icon:s.getWebappsAssetUrl("DMUFormatEdition","icons/22/I_DMU_NoFormat.png"),preview:U.toDataURL("image/jpg"),isSelected:C&&0===C.length}),t=0;t<h.length;t++)F.push({id:h[t].getAttribute("sID"),title:h[t].getAttribute("sName"),icon:s.getWebappsAssetUrl("DMUPlaySlide","icons/22/I_DMUFormat.png"),preview:h[t].getPreview(),isSelected:C&&-1!==C.indexOf(h[t])});(m=new o(g.frmWindow)).build({thumbnailData:F,onThumbnailSelectedCB:function(e){var r="noFormat"===e.id?[]:[e.id];for(t=0;t<p.length;t++){var n=p[t].getAttribute("sPointedFormats")||[];(n.length!==r.length||n.length&&r.length&&r[0]!==n[0])&&(p[t].setAttribute("sPointedFormats","noFormat"===e.id?[]:[e.id]),p[t].fireEvent("onSaveRequested",{}),p[t].refreshNode())}v&&S&&v.fireEvent("onSlidePreviewRefreshRequired",{dmuObject:v}),g.frmWindow.getViewer().render()},additionalCommands:1===p.length?[{nls:l.generateFormat,icon:s.getWebappsAssetUrl("DMUSlideEdition","icons/32/I_GenerateFormatCmd.png"),cb:function(){var e=i.getContextViewer({viewer:g.frmWindow.getViewer()});if(e){var t=d.getCommand("DMUGenerateFormatHdr",e.getCommandContext());t&&t.begin()}f.setActiveState(!1)}}]:[]});var x,O=m.getWidth()+10,I=m.getHeight()+10,T={id:"DMUFormatChooser",className:"DMUFormatChooserPanel",title:l.FormatChooserPanelTitle,titleBarVisibleFlag:!1,frameWindow:g.frmWindow,immersiveFrame:g.frmWindow.getImmersiveFrame(),viewerFrame:g.frmWindow.getViewerFrame(),content:m.getContent(),minHeight:I,height:I,minWidth:O,width:O,allowedDockAreas:WUXDockAreaEnum.NoneDockArea,currentDockArea:WUXDockAreaEnum.NoneDockArea,closeButtonFlag:!0,resizableFlag:!1,closePanelCB:function(){f.setActiveState(!1)}};c=new n(T);var H=a.giveDMUSlidesController({context:g.frmWindow});H&&(x=H.getActiveThumbnailCtxMenuPosition()),x&&(x.offsetX=x.x,x.offsetY=x.y-I/2),c.setPanelPosition(x),c.elements.container.setStyles({borderWidth:"0px"})}}}}}()):(h&&(r.unsubscribe(D.onAdd),r.unsubscribe(D.onRemove),r.unsubscribe(D.onEmpty),D={},h=!1),M())},this.getActiveState=function(){return u},this.clearController=function(){f.setActiveState(!1),m=c=U=null}}}),g=[];return t.singleton({init:function(){},getDMUFormatChooserCtrl:function(e){var t=this.giveDMUFormatChooserCtrl(e);if(!t&&e&&e.frmWindow){var r=new m({frmWindow:e.frmWindow});t=Object.freeze({setActiveState:function(e){r&&r.setActiveState(e)},getActiveState:function(){if(r)return r.getActiveState()},clearController:function(){r&&(r.clearController(),r=null)}}),g.push({frmWindow:e.frmWindow,ctrl:t})}return t},giveDMUFormatChooserCtrl:function(e){if(e&&e.frmWindow)for(var t=0;t<g.length;t++)if(g[t].frmWindow===e.frmWindow)return g[t].ctrl},unreferenceDMUFormatChooserCtrl:function(e){if(e&&e.frmWindow)for(var t=0;t<g.length;t++)if(g[t].frmWindow===e.frmWindow){g[t].ctrl.clearController(),g.splice(t,1);break}}})})),define("DS/DMUFormatEdition/DMUUpdateFormatSessionOverloadCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/DMUContextManager"],(function(e,t){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e);var r=this;this.beginExecute=function(){var e=t.getReviewContext({viewer:r.getFrameWindow().getViewer()});if(e){var n=e.getCurrentSessionMarkup();if(n){var i=n.getCurrentSlide();if(i){var o=i.getEnvironmentOverload(),a=e.getEnvironment().getEnvironmentInfo();a.sFocusProperty=o.state.sFocusProperty,i.updateEnvironmentOverload({target:e.getEnvironment(),state:a}),i.fireEvent("onDMUSlideSessionInfoChanged",{dmuObject:i})}}}r.end()}}})})),define("DS/DMUFormatEdition/DMUFormatContextualBar",["DS/DMUBaseUI/DMUContextualBarAdapter","DS/Selection/CSOManager","DS/DMUBaseUI/DMUToolsContextualBar","DS/DMUBaseUIServices/DMUSlidePreferences"],(function(e,t,r,n){"use strict";let i,o;const a=function(){return Boolean("wafr"===require("DS/PADUtils/PADSettingsMgt").getSetting("eno3dviewer_infrastructure_version"))},s=function(e,t,r="",n=1){a()?i.push({type:"WAfrDefaultHandlerItem",handlerId:e}):i.push({line:n,name:t,hdr_list:[r+e]})};return e.extend({getSharedContextualMenuCommandList:function(e){var t=[];if(e&&e.length&&e.forEach((function(e){-1===t.indexOf(e.getType())&&t.push(e.getType())})),1===t.length&&(-1!==t.indexOf("DMUSlide")||-1!==t.indexOf("DMUFormat"))){i=this.getContextualMenuCommandList();for(var r=0;r<e.length;r++)if(e[r].getObjectOverloads&&e[r].getObjectOverloads().length)return a()?i.unshift({type:"WAfrDefaultHandlerItem",handlerId:"DMURemoveOverloadHdr"}):i.unshift({line:1,name:"DMURemoveOverloadStr",hdr_list:["DMURemoveOverloadHdr"]}),i;return i}return[]},getContextualMenuCommandList:function(){if(i=[],"DMUSlide"===this.getType()||"DMUFormat"===this.getType()){if(this.getAttribute("sParentSlideID")||s("DMUSlide"===this.getType()?"slideCmdHdr":"DMUFormatCmdHdr","DMUSlideOrFormatStr"),this.isReadOnly()||s("DMUCutHdr","DMUCutStr","Format_"),s("DMUCopyHdr","DMUCopyStr","Format_"),s("DMUPasteHdr","DMUPasteStr","Format_"),s("DMUPasteSpecialHdr","DMUPasteSpecialStr","Format_"),"DMUSlide"===this.getType()&&((e=this).getParent()&&e.getParent().getParent()&&e.getParent().getParent().getValidation())){s("DMUCreateSlideReplyHdr","DMUCreateSlideReplyStr");if(this.getParent().getParent().getRestrictions().highlight.canCreate&&window.widget&&"ENOR3V_AP"===window.widget.getValue("appId")){const e=this.getAssociatedHighlightData();e&&e.length||s("DMUAddHighlightHdr","DMUAddHighlightStr"),function(e){let t=e.getAssociatedHighlightData(),r=n.getSlidePreferences({context:e.getFrameWindow()});return o=r&&r.highlightPreference,!((t&&!(t.length<2)||"highlightTypeIssue"!==o||t[0]&&t[0].hasIssue)&&("highlightTypeTask"!==o||t[0]&&t[0].hasTask))}(this)&&("highlightTypeIssue"===o?s("issueTemplate"===localStorage.getItem("issueCreationType")?"DMUGenerateIssueFromTemplateFromSelectionHdr":"DMUGenerateIssueFromSelectionHdr","DMUGenerateIssueFromSelectionStr"):s("DMUGenerateTaskFromSelectionHdr","DMUGenerateTaskFromSelectionStr"))}}this.isReadOnly()||s("DMUDeleteHdr","DMUDeleteStr","Format_")}var e;this.isReadOnly()||"DMUSlide"!==this.getType()||this.getAttribute("sParentSlideID")||(s("DMUFormatChooserHdr","DMUFormatChooserStr"),1===t.get().length&&this.getPointedFormats&&this.getPointedFormats().length&&s("DMUEditAssociatedFormatHdr","DMUEditAssociatedFormatStr"));return r.isCloud()&&!this.isReadOnly()&&"DMUSlide"===this.getType()&&this.isPreview&&!this.isPreview()&&s("DMUSetAsPreviewHdr","DMUSetAsPreviewStr"),i},register:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:"markup"===e.experience||"DMUFormat"===e.type?{type:e.type,module:"DMUFormatEdition",workbenchName:"DMUFormatContextHdr"}:{type:e.type,module:"DMUPersistence",workbenchName:"DMUPersistenceCtxCmds"}})},unregister:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:"markup"===e.experience||"DMUFormat"===e.type?{type:e.type,module:"DMUFormatEdition",workbenchName:"DMUFormatContextHdr"}:{type:e.type,module:"DMUPersistence",workbenchName:"DMUPersistenceCtxCmds"}})}})})),define("DS/DMUFormatEdition/DMUFormatExport",["require","exports","DS/DMUBaseExperience/EXPUtils"],(function(e,t,r){"use strict";return class{static getObjectDefinition(e){function t(e,t){let n={};if(e&&t){let i=e.getParameters(),o=i.length;for(let e=0;e<o;e++){let o=i[e];if(o.isOverloadable&&void 0!==t[o.name]){let e=n,i=o.JSONname.split(".");for(;i.length;){let n=i.shift();if(n){if(0===i.length){let i=r.typeToStr(t[o.name],o.type);null!=i&&""!==i&&(e[n]=i);break}void 0===e[n]&&(e[n]={}),e=e[n]}}}}}return n}let n={EnvironmentOverload:{},ObjectOverloads:[]},i=e.getEnvironmentOverload();if(i){let e={targetId:"environment",state:t(i.target,i.state)};n.EnvironmentOverload=e}let o=e.getObjectOverloads();return o&&o.forEach((function(e){let r={targetId:e.target._sID,state:t(e.target,e.state)};n.ObjectOverloads.push(r)})),e.getSlideApplicativeContext()&&(n.ApplicativeContext=e.getSlideApplicativeContext()),n}}})),define("DS/DMUFormatEdition/DMUFormatChooserCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUFormatEdition/DMUFormatChooserCtrl"],(function(e,t){"use strict";return e.extend({init:function(e){var r=e||{};r.mode="shared",this._parent(r);var n=this,i=t.getDMUFormatChooserCtrl({frmWindow:n.getFrameWindow()});this.beginExecute=function(){i&&!i.getActiveState()&&i.setActiveState(!0),n.end()};var o=this._destroy;this._destroy=function(){t.unreferenceDMUFormatChooserCtrl({frmWindow:n.getFrameWindow()}),i=null,o.call(n),n.done()}}})}));