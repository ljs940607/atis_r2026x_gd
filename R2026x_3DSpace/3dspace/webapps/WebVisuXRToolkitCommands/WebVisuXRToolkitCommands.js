define("DS/WebVisuXRToolkitCommands/WebVisuXRToolkitCommands",["require","exports","DS/WebVisuXRToolkit/WebVisuXRToolkitManager","UWA/Core","DS/Controls/Button","DS/Windows/Panel","DS/Controls/Tab","DS/Controls/SpinBox","DS/Controls/ComboBox","DS/Controls/ButtonGroup","DS/Controls/Toggle","DS/Selection/HSOManager","DS/CoreBase/WebUXGlobalEnums","DS/WebappsUtils/WebappsUtils","DS/WebVisuXRToolkit/WebVisuXRToolkitConfigManager","DS/WebVisuXRToolkit/Skills/WebVisuXRToolkitSkillsManager","DS/WebVisuXRToolkit/WebVisuXRToolkitHelpers","DS/WebVisuXRToolkit/WebVisuXRToolkit","DS/WebVisuXRToolkitNativeSkills/WebVisuXRToolkitPicking","DS/WebVisuXRToolkitNativeSkills/WebVisuXRToolkitControllerFlyNav","DS/WebVisuXRToolkitNativeSkills/WebVisuXRToolkitAirGrabNav","DS/WebVisuXRToolkitNativeSkills/WebVisuXRToolkitRealWorldPlacement","DS/WebVisuXRToolkitNativeSkills/WebVisuXRToolkitControllerTeleport","DS/WebVisuXRToolkitNativeSkills/WebVisuXRToolkitHandTeleport","DS/WebVisuXRToolkitNativeSkills/WebVisuXRToolkitMeasure","i18n!DS/WebVisuXRToolkit/assets/nls/WebVisuXRToolkitNativeSkills"],(function(e,t,n,i,o,s,l,a,r,c,u,d,m,g,p,S,v,b,k,w,f,h,y,x,T,C){"use strict";function R(e){const t=new Array;if(e.has(C.PickingName)){const e={settings:new b.SkillSettings([{name:C.PickingMode,values:["mesh","primitive"],current:"mesh"}])};t.push(new b.Skill(C.PickingName,(0,g.getWebappsAssetUrl)("WebVisuXRToolkitNativeSkills","quick_menu_skill_object_picking.png"),[new k.HandPicking,new k.ControllerPickingLaser,new k.ControllerPicking],e,[e=>new Promise((t=>{const n=document.createElement("p");n.textContent="Highlight an element with Picking",e.appendChild(n),d.empty(),d.onAdd((()=>{n.remove(),t()}))}))]))}if(e.has(C.FlyNavName)){const e={settings:new b.SkillSettings([{name:C.flySpeed,max:1e3,min:1,step:1,current:50},{name:"_followControllerOrientation",current:!0}])},n=new w.ControllerFlyNav;t.push(new b.Skill(C.FlyNavName,(0,g.getWebappsAssetUrl)("WebVisuXRToolkitNativeSkills","quick_menu_skill_fly_navigation.png"),[n],e,[e=>new Promise((t=>{const i=200*p.instance.getSkillInfos(C.FlyNavName).settings.getNumericalValue("flySpeed"),o=document.createElement("p");o.textContent="Move around with fly navigation",e.appendChild(o);const s=document.createElement("input");s.type="range",s.min="0",s.max=i.toString(),s.step="1",s.disabled=!0,s.setAttribute("value","0"),e.appendChild(s);let l=(0,b.getXRNode)().getMatrix().decompose()[0],a=0;const r=()=>{s.setAttribute("value",a.toString());const e=(0,b.getXRNode)().getMatrix().decompose()[0],c=e.distanceTo(l);a+=c,l.copy(e),a>=i&&(o.remove(),s.remove(),n.removeEventListener("FlyNavMovement",r),t())};n.addEventListener("FlyNavMovement",r)}))]))}if(e.has(C.AirGrabName)){const e={settings:new b.SkillSettings([{name:"_EnableAirGrabScaling",current:!1},{name:"_EnableAirGrabMonoInputRotation",current:!1}])},n=new f.ControllerAirGrab;t.push(new b.Skill(C.AirGrabName,(0,g.getWebappsAssetUrl)("WebVisuXRToolkitNativeSkills","quick_menu_skill_airgrab_navigation.png"),[n,new f.HandAirGrab],e,[e=>new Promise((t=>{const i=document.createElement("p");i.textContent="Move around with Air Grab navigation and only one controller",e.appendChild(i);const o=document.createElement("input");o.type="range",o.min="0",o.max=2500..toString(),o.step="1",o.disabled=!0,o.setAttribute("value","0"),e.appendChild(o);let s=(0,b.getXRNode)().getMatrix().decompose()[0],l=0;const a=()=>{o.setAttribute("value",l.toString());const e=(0,b.getXRNode)().getMatrix().decompose()[0],r=e.distanceTo(s);l+=r,s.copy(e),l>=2500&&(o.remove(),i.remove(),n.removeEventListener("OneInputAirGrab",a),t())};n.addEventListener("OneInputAirGrab",a)})),e=>new Promise((t=>{const i=document.createElement("p");i.textContent="Use both controllers now",e.appendChild(i);const o=document.createElement("input");o.type="range",o.min="0",o.max=2500..toString(),o.step="1",o.disabled=!0,o.setAttribute("value","0"),e.appendChild(o);let s=(0,b.getXRNode)().getMatrix().decompose()[0],l=0;const a=()=>{o.setAttribute("value",l.toString());const e=(0,b.getXRNode)().getMatrix().decompose()[0],r=e.distanceTo(s);l+=r,s.copy(e),l>=2500&&(i.remove(),o.remove(),n.removeEventListener("TwoInputsAirGrab",a),t())};n.addEventListener("TwoInputsAirGrab",a)}))]))}if(e.has(C.ObjectPlacementName)&&t.push(new b.Skill(C.ObjectPlacementName,(0,g.getWebappsAssetUrl)("WebVisuXRToolkitNativeSkills","quick_menu_skill_realworld_surface_snapping.png"),[new h.TouchScreenPlacement,new h.ControllerPlacementLaser,new h.ControllerPlacement,new h.HandPlacement])),e.has(C.TeleportName)){const e={settings:new b.SkillSettings([{name:"TeleportMode",values:["Arc","Line"],current:"Arc"},{name:C.CollisionsLineTeleport,current:!0}])},n=new y.Teleport,i=new x.HandTeleport,o=new x.HandTeleportRay,s=new x.HandTeleportCancel;o.HandTeleportSkill=i,s.HandTeleportSkill=i,t.push(new b.Skill(C.TeleportName,(0,g.getWebappsAssetUrl)("WebVisuXRToolkitNativeSkills","quick_menu_skill_teleport_navigation.png"),[n,i,o,s],e,[e=>new Promise((t=>{const i=document.createElement("p");i.textContent="Move around with Teleport",e.appendChild(i);const o=document.createElement("input");o.type="range",o.min="0",o.max="3",o.step="1",o.disabled=!0,o.setAttribute("value","0"),e.appendChild(o);let s=0;const l=e=>{s++,o.setAttribute("value",s.toString()),s>=3&&(i.remove(),o.remove(),n.removeEventListener("TeleportationDone",l),t())};n.addEventListener("TeleportationDone",l)}))]))}if(e.has(C.MeasureName)){const e=new T.ControllerMeasure,n=new T.ControllerMeasureDeleteAll,i={settings:new b.SkillSettings([{name:C.MeasureMode,values:[C.MeasureModeDefault,C.MeasureModeFree,C.MeasureModeNormal],current:C.MeasureModeDefault},{name:C.MeasureLabelRescaleSetting,current:!1}]),handMenuFunctions:(new Map).set("Remove all measures",(()=>{n.DeleteAllMeasures()}))};t.push(new b.Skill(C.MeasureName,(0,g.getWebappsAssetUrl)("WebVisuXRToolkitNativeSkills","VXRT_SkillIcon_Measure.png"),[e,new T.ControllerMeasureLaser,new T.ControllerMeasureDelete,n,new T.HandMeasure,new T.HandMeasureLaser,new T.HandMeasureDelete],i,[t=>new Promise((n=>{const i=document.createElement("p");i.textContent="Measure something",t.appendChild(i);const o=document.createElement("input");o.type="range",o.min="0",o.max="3",o.step="1",o.disabled=!0,o.setAttribute("value","0"),t.appendChild(o);let s=0;const l=t=>{s++,o.setAttribute("value",s.toString()),s>=3&&(i.remove(),o.remove(),e.removeEventListener("MeasureDone",l),n())};e.addEventListener("MeasureDone",l)}))]))}return t}async function M(e,t,i){if(!navigator.xr)throw console.error("WebVisuXRToolkit not available"),new Error("WebVisuXRToolkit not available");if(!await navigator.xr.isSessionSupported("immersive-ar")&&!await navigator.xr.isSessionSupported("immersive-vr"))throw console.error("neither AR nor VR are supported"),new Error("neither AR nor VR are supported");try{if(p.instance.dispatchConfigEvent(),void 0===i){const e=R(new Set(p.instance.settings.get("LoadNativeSkills")));i=new S.WebVisuXRToolkitSkillsManager([...e,...p.instance.custom_skills],p.instance.settings.get("StartInMixedReality")?b.InputAction.MixedReality:b.InputAction.FullImmersive)}return n.WebVisuXRToolkitManager.createWebVisuXRToolkitManager(e,t,i)}catch(e){throw console.error(e),e}}function V(e,t,n,o){o.setStyle("position","relative"),o.setStyle("padding","20px"),o.setStyle("margin","20px"),o.setStyle("outline","0.5px solid");const s=new i.Element("div");s.textContent=n,s.setStyle("position","absolute"),s.setStyle("top","-8px"),s.setStyle("left","20px"),s.setStyle("background-color","#f1f1f1"),s.setStyle("padding","0 5px"),s.setStyle("font-size","12px"),s.setStyle("color","black"),s.inject(o);const l=e.getPageContentFromValue(t);if(l)o.inject(l);else{const n=new i.Element("div");o.inject(n),n.setStyle("padding","20px"),n.setStyle("margin","18px 20px 20px 20px"),e.add({label:t,content:n,value:t})}}function E(e,t,n){const s=new i.Element("div"),l=new Array;for(const e of p.instance.settings)if("boolean"==typeof e[1]){const t=new u({type:"switch",label:e[0],checkFlag:e[1]});t.addEventListener("change",(function(){p.instance.settings.set(e[0],t.checkFlag),p.instance.settings.saveToLocalStorage(n)})),t.inject(s)}const a=new i.Element("div"),r=()=>{const e=new c({type:"checkbox"}),i=t.listSkills().skillList;for(const n of i){const i=new u({type:"checkbox",label:n.name,value:n.name,checkFlag:p.instance.settings.get("DefaultSkills").includes(n.name)});i.addEventListener("change",(function(){if(i.checkFlag){const o=new Set;t._selectSkill(n.name);const s=new Set([...o].map((e=>e.name)));for(let n=0;n<e.getButtonCount();n++){const o=e.getButton(n);if(o!==i){const e=o.elements.label.innerText.split("/")[0];s.has(e)&&o.checkFlag&&(o.checkFlag=!1,t._deSelectSkill(e),o.elements.label.style.color="",o.elements.label.innerText=e)}}}else t._deSelectSkill(n.name)})),i.addEventListener("mouseenter",(function(){const o=n.name,s=t.computeNotCompatibleSkillsWhenSelectingNew(o),l=new Map([...s].map((e=>[e[0].name,e[1]])));for(let t=0;t<e.getButtonCount();t++){const n=e.getButton(t);if(n!==i&&!0===n.checkFlag){const e=n.elements.label.innerText;if(l.has(e)){n.elements.label.style.color="red";const t=l.get(e);n.elements.label.innerText+="/ "+b.InputAction[t.action]+" on "+b.AbstractHandedness[t.handedness]+" handedness"}}}})),i.addEventListener("mouseleave",(function(){for(let t=0;t<e.getButtonCount();t++){const n=e.getButton(t);n.elements.label.style.color="",n.elements.label.innerText=n.elements.label.innerText.split("/")[0]}})),e.addChild(i)}return e.addEventListener("change",(function(){p.instance.settings.set("DefaultSkills",e.value),p.instance.settings.saveToLocalStorage(n)})),e.inject(a),e};let d=r();p.instance.addEventListener("XRSessionEnded",(()=>{const e=t.listSkills().chosenSkillsName;for(let t=0;t<d.getButtonCount();t++){const n=d.getButton(t);n.checkFlag=e.has(n.elements.label.innerText.split("/")[0])}})),V(e,"General","Default Skills",a),l.push(a);const m=new i.Element("div"),g=new c({type:"checkbox"});for(const e of p.instance.getNativeSkills()){const n=new u({type:"checkbox",label:e,value:e,checkFlag:p.instance.settings.get("LoadNativeSkills").includes(e)});n.addEventListener("change",(()=>{if(n.checkFlag){const n=Array.from(R((new Set).add(e)))[0];t.loadSkill(n)}else{for(let t=0;t<d.getButtonCount();t++){const n=d.getButton(t);n.elements.label.innerText.split("/")[0]===e&&(n.checkFlag=!1)}t.unLoadSkill(e)}d.remove(),d=r()})),g.addChild(n)}g.inject(m),g.addEventListener("change",(function(){p.instance.settings.set("LoadNativeSkills",g.value),p.instance.settings.saveToLocalStorage(n)})),V(e,"General","Load Native Skills",m),l.push(m),V(e,"Settings","General Settings",s);const S=new i.Element("div");new o({label:"Reset Settings",emphasize:"primary",onClick:function(){p.instance.resetSettings(n),s.remove(),S.remove();for(const e of l)e.remove();E(e,t,n)}}).inject(S),V(e,"Settings","Reset Settings",S)}function W(e){return e.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/^./,(e=>e.toUpperCase()))}Object.defineProperty(t,"__esModule",{value:!0}),t.start=M,t.StartWebVisuXRToolkitPanel=function(e,t){const n=t.executionContext.getComponent("Viewer");p.instance.settings.loadFromLocalStorage(t.executionContext.getSourceApp().options.id),p.instance.dispatchConfigEvent();const c=t.executionContext.getComponent(WAfrStandardComponentKey.UIFrame).getImmersiveFrame(),d=R(new Set(p.instance.settings.get("LoadNativeSkills"))),g=new S.WebVisuXRToolkitSkillsManager([...d,...p.instance.custom_skills],p.instance.settings.get("StartInMixedReality")?b.InputAction.MixedReality:b.InputAction.FullImmersive),v=new i.Element("div"),k=new i.Element("div");k.setStyle("text-align","right"),k.setStyle("bottom","0px"),k.setStyle("right","0px"),k.setStyle("position","sticky");const w=new i.Element("div");let f=!1;const h=setInterval((()=>{n.get3DViewer().getRootNode()._getTrianglesCount()>1e5?(f=!0,w.innerText="Warning: rendering the scene in VR might be slow because of the high number of draw calls or faces\nTriangles: "+n.get3DViewer().getRootNode()._getTrianglesCount(),y.elements.container.setStyle("height","90%")):f&&(f=!1,w.innerText="",y.elements.container.parentElement.setStyle("height",""),y.elements.container.setStyle("height","100%"))}),200),y=new l({displayStyle:["strip"]});y.inject(v);const x=function(e,t,n,o){const s=new i.Element("div"),l=e.add({label:"General",isSelected:!1,content:s,value:"General"});if(E(e,n,o),p.instance.devMode.active){const t=new i.Element("div"),n=new u({type:"switch",label:"Lock Camera on start",checkFlag:p.instance.devMode.options.get("lockCamera")});n.addEventListener("change",(function(){p.instance.devMode.options.set("lockCamera",n.checkFlag)})),n.inject(t);const o=new u({type:"switch",label:"Get FPS Counter",checkFlag:p.instance.devMode.options.get("fpsCounter")});o.addEventListener("change",(function(){p.instance.devMode.options.set("fpsCounter",o.checkFlag)})),o.inject(t);const s=new u({type:"switch",label:"Get debug Tooltip",checkFlag:p.instance.devMode.options.get("debugTooltip")});s.addEventListener("change",(function(){p.instance.devMode.options.set("debugTooltip",s.checkFlag)})),s.inject(t),V(e,"Dev Settings","Dev",t)}const a=new i.Element("div"),r=new i.Element("p"),c=setInterval((()=>{const e=t.get3DViewer().getRootNode().bBox;r.innerText="Scene Bbox: max["+e.max.x.toFixed(2)+", "+e.max.y.toFixed(2)+", "+e.max.z.toFixed(2)+"]\nmin["+e.min.x.toFixed(2)+", "+e.min.y.toFixed(2)+", "+e.min.z.toFixed(2)+"]\n\nViewpoint: ["+t._viewpoint.position.x.toFixed(2)+", "+t._viewpoint.position.y.toFixed(2)+", "+t._viewpoint.position.z.toFixed(2)+"]\n\nTriangle count: "+t.get3DViewer().getRootNode()._getTrianglesCount()}),200);return r.inject(a),V(e,"General","SceneGraph Infos",a),{intervalID:c,GeneralTabData:l}}(y,n,g,t.executionContext.getSourceApp().options.id);for(const e of g.listSkills().skillList){const t=p.instance.getSkillInfos(e.name);if(t&&(t.settings||t.handMenuFunctions)&&t.settings){const n=new i.Element("div");n.setStyle("display","flex"),n.setStyle("justify-content","space-between"),n.setStyle("align-items","center"),n.setStyle("flex-direction","column");const o=t.settings.listNumericalValues();for(const[e,s]of o){const o={units:"mm/s",value:s.current,minValue:1,maxValue:1e3,stepValue:1},l=new a(o),r=new i.Element("p");r.setStyle("display","flex"),r.setStyle("justify-content","space-between"),r.setStyle("align-items","center"),r.setStyle("flex-direction","column"),r.setStyle("margin","5px"),r.textContent=W(e),r.inject(n),l.inject(r),l.addEventListener("endEdit",(function(){t.settings.setNumericalValue(e,l.lastValueWhenEnter)}))}const s=t.settings.listBooleanValues();for(const[e,o]of s){const s=new u({type:"switch",checkFlag:o}),l=new i.Element("p");l.setStyle("display","flex"),l.setStyle("justify-content","space-between"),l.setStyle("align-items","center"),l.setStyle("flex-direction","column"),l.setStyle("margin","5px"),l.textContent=W(e),l.inject(n),s.inject(l),s.addEventListener("change",(function(){t.settings.setBooleanValue(e,s.checkFlag)}))}const l=t.settings.listStringValues();for(const[e,o]of l){const s=new r({elementsList:o.values,value:o.current,enableSearchFlag:!1}),l=new i.Element("p");l.setStyle("display","flex"),l.setStyle("justify-content","space-between"),l.setStyle("align-items","center"),l.setStyle("flex-direction","column"),l.setStyle("margin","5px"),l.textContent=W(e),l.inject(n),s.inject(l),s.addEventListener("change",(function(){t.settings.setStringValue(e,s.value)}))}V(y,"Skills Settings",e.name,n)}}new o({label:"Start AR/VR",emphasize:"primary",onClick:function(){clearInterval(h),clearInterval(x.intervalID),M(n.get3DViewer(),n._viewpoint,g)}}).inject(k).elements.button.setStyle("margin","5px");const T=new s({title:"Settings",icon:{iconName:"cog",fontIconFamily:m.WUXManagedFontIcons.Font3DS},content:v,immersiveFrame:c,header:w,width:400,height:550}),C=new i.Element("div",{html:"Just for your information, today is "+(new Date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}),D=new s({title:"App Settings",icon:"cog",position:{my:"center",at:"center",of:c},content:C,immersiveFrame:c,resizableFlag:!1,width:400,height:550});T.attachToWindow(D,WUXSnapAreaEnum.InsideArea,"before");new o({label:"Close",emphasize:"secondary",onClick:function(){T.destroy(),D.destroy()}}).inject(k).elements.button.setStyle("margin","5px"),x.GeneralTabData.button.elements.button.click(),k.inject(v),e()},t.QuickStartWebVisuXRToolkit=function(e,t){console.log("parameters",t,t.executionContext),p.instance.settings.loadFromLocalStorage(t.executionContext.getSourceApp().options.id);const n=t.executionContext.getComponent("Viewer");M(n.get3DViewer(),n._viewpoint).then(e())},t.DisplayWebXRCapabilities=function(e,t){const n=t.executionContext.getComponent(WAfrStandardComponentKey.UIFrame).getImmersiveFrame();(0,v.getWebXRCapabilities)().then((t=>{const o=new i.Element("pre");o.setStyle("background-color","#f4f4f4"),o.setStyle("padding","10px"),o.setStyle("border-radius","5px"),o.setStyle("overflow-x","auto"),o.innerText=JSON.stringify(t,null,2),new s({title:"Settings",icon:{iconName:"cog",fontIconFamily:m.WUXManagedFontIcons.Font3DS},content:o,immersiveFrame:n,width:300,height:200}),e()}))}})),define("DS/WebVisuXRToolkitCommands/WebVisuXRToolkitDeviceDetection",["require","exports"],(function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.WebVisuXRToolkitDevices=void 0,t.detectXRDevice=async function(){if(navigator.xr){const e=Object.getOwnPropertySymbols(navigator.xr);if(e)for(const t of e)if(t.description&&t.description.match(/polyfill/i))return n.Emulator;if(navigator.userAgentData){const e=await navigator.userAgentData.getHighEntropyValues(["platform","model"]);if(e.mobile)return n.Smartphone;if("Quest 3"===e.model)return n.MetaQuest3;if("Quest 2"===e.model)return n.MetaQuest2}else{if(navigator.userAgent.includes("Quest 3"))return n.MetaQuest3;if(navigator.userAgent.includes("Quest 2"))return n.MetaQuest2;if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&await navigator.xr.isSessionSupported("immersive-vr"))return n.AppleVisionPro;if(navigator.userAgent.includes("Mobile"))return n.Smartphone}return n.UnknownDevice}return n.NoDevice},function(e){e[e.MetaQuest3=1]="MetaQuest3",e[e.MetaQuest2=2]="MetaQuest2",e[e.Emulator=3]="Emulator",e[e.AppleVisionPro=4]="AppleVisionPro",e[e.Smartphone=5]="Smartphone",e[e.UnknownDevice=6]="UnknownDevice",e[e.NoDevice=7]="NoDevice"}(n||(t.WebVisuXRToolkitDevices=n={}))}));