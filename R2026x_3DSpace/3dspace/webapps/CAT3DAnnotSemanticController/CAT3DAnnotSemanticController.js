/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/CAT3DAnnotSemanticController/CAT3DAnnotSemanticController",[],(function(){})),define("DS/CAT3DAnnotSemanticController/CAT3DAnnotSemanticContInstance",["DS/CAT3DAnnotationExpController/CAT3DAnnotExpControllerInstance","DS/Selection/CSOManager","DS/CATWebUXSlideShow/CATWebUXSlideShowController"],(function(t,e,n){"use strict";return t.extend({init:function(t){var o=t||{};o.workbenchName="CAT3DAnnotSemanticWidgetWkb",o.moduleName="CAT3DAnnotSemanticWidget",this._parent(o);var a=this,i=o.ctxViewer;var r=this.setActiveState;this.setActiveState=function(t){r(t),t&&function(){if(!i)return;let t,e=i.getExecutionContext?i.getExecutionContext():void 0;e&&(t=e.getComponent(WAfrStandardComponentKey.HandlerComponent),t.hasCheckHandler("AnnotationSemanticBrowser")&&!t.isCheckExecutable("AnnotationSemanticBrowser")&&t.enableCheck("AnnotationSemanticBrowser"),t.setCheckState({id:"AnnotationSemanticBrowser",state:"false"!==localStorage.getItem("CAT3DAnnotSemanticAttrBrowserCmd")}))}();var e=n.giveSlideShowController({context:i.getFrameWindow(),id:"CAT3DAnnotationSlideShow"});e&&e.setListOfCommandsAllowed(["CAT3DAnnotInsightWidgetDefaultHdr","CAT3DAnnotationWidgetDefaultHdr"])},this.getAnnotationControllerType=function(){return"3DAnnotationInsight"};var l=this.clearController;this.clearController=function(){l(),i=a=null};var s=this._onCommandStartCB;this._onCommandStartCB=function(t){s(t);for(var e=["CAT3DAnnotSemanticShowGeomAttachHdr","CAT3DAnnotSemanticShowRelatedAnnotHdr"],n=function(){setTimeout(a._refreshContextualBar)},o=0;o<e.length;o++)t._id===e[o]&&t.onEnd(n)};var g=this.getAnnotControllerPrototype;this.getAnnotControllerPrototype=function(){var t=g();return t.getReferencedAnnotations=function(t){if(a)return a.getReferencedAnnotations(t)},t};var A=this.getContextualCommandList;this.getContextualCommandList=function(){if(!i)return[];var t,n,o,r=A(),l=[],s=e.get(),g=i.getRootBagPath(),h=!1,m=!0;for(t=0;t<s.length;t++)if(s[t].pathElement&&g.isAParentOf(s[t].pathElement)){l.push(s[t].pathElement);var f=s[t].pathElement.getLastElement(!0);if(!f.getAnnotationClassType){m=!1;break}if(h=!0,"tps"!==f.getAnnotationClassType()){m=!1;break}}if(m)for(o=!1,t=0;t<l.length&&!o;t++)if(l[t].getLastElement(!0).isVisible()){var c=l[t].getLastElement(!0),d=void 0!==c.getGeometricalAttachmentList?c.getGeometricalAttachmentList():null;if(d&&d.length){var C=l[t].getParentPath().getParentPath().getLastElement(!0).children;for(n=0;n<C.length;n++){if("RootViews"!==C[n].getAnnotationType()&&"RootCaptures"!==C[n].getAnnotationType()&&"RootGeometries"!==C[n].getAnnotationType())for(var u=C[n].children,S=0;S<u.length;S++){if(-1!==d.indexOf(u[S].getAnnotationID())&&!u[S].isVisible()){i.getExecutionContext?r.WAfrCtxBarRow1.model.unshift({name:"CAT3DAnnotInsightShowGeomAttachStr",line:1,hdr_list:["CAT3DAnnotSemanticShowGeomAttachHdr"],identifier:"CAT3DAnnotSemanticShowGeomAttachHdr",type:"handler"}):r.unshift({name:"CAT3DAnnotInsightShowGeomAttachStr",line:1,hdr_list:["CAT3DAnnotSemanticShowGeomAttachHdr"]}),o=!0;break}}if(o)break}}}if(!h)for(o=!1,t=0;t<l.length&&!o;t++){var p=a.getPontingAnnotations(l[t]);if(p&&p.length)for(n=0;n<p.length;n++)if(!p[n].getLastElement(!0).isVisible()){i.getExecutionContext?r.WAfrCtxBarRow1.model.unshift({name:"CAT3DAnnotInsightShowRelatedAnnotStr",line:1,hdr_list:["CAT3DAnnotSemanticShowRelatedAnnotHdr"],type:"handler",identifier:"CAT3DAnnotSemanticShowRelatedAnnotHdr"}):r.unshift({name:"CAT3DAnnotInsightShowRelatedAnnotStr",line:1,hdr_list:["CAT3DAnnotSemanticShowRelatedAnnotHdr"]}),o=!0;break}}return r},this.getReferencedAnnotations=function(t){var e=t.getLastElement(!0);if("tps"!==e.getAnnotationClassType())return[];var n,o,i=a._getParentAnnotationSetPath(t),r=void 0!==e.getAnnotationReferenceFrame?e.getAnnotationReferenceFrame():null,l=[];if(r||32===e.getAnnotationType()){var s,g=i.getLastElement(!0).getReferenceFrames();for(n=0;n<g.length;n++)if(g[n].tpsID===r||e.getAnnotationUuid()===g[n].uuid){s=g[n].datums;break}if(void 0!==s){var A=i.getLastElement(!0).getRootAnnotationNode("RootDatums"),h=A.children,m=i.clone();for(m.addElement(A),n=0;n<s.length;n++)for(o=0;o<h.length;o++)if(h[o].getAnnotationID()===s[n]){var f=m.clone();f.addElement(h[o]),l.push(f);break}}}return l};var h=function(t,e){return e&&e.length&&(t=t&&t.length?t.concat(e):e),t},m=a.getPointedPaths;this.getPointedPaths=function(t){var e=m(t);if(i.getRootBagPath().isAParentOf(t)){var n=t.getLastElement(!0);if(n.getAnnotationClassType&&"tps"===n.getAnnotationClassType())if(e=h(e,a.getRelatedGeometryPaths([t])),e=h(e,a.getReferencedAnnotations(t)),8===n.getAnnotationSupertype())e=h(e,a.getPontingAnnotations(t));else{var o=a._getParentAnnotationSetPath(t);o&&(e=h(e,function(t,e){var n,o=t.getLastElement(!0);if(o.getDatumTargetList&&o.getDatumTargetList()){var a=o.getDatumTargetList(),i=e.getLastElement(!0).getRootAnnotationNode("RootDatums"),r=e.clone();r.addElement(i);var l=r.getChildrenPathes();n=[];for(var s=0;s<l.length;s++)-1!==a.indexOf(l[s].getLastElement(!0).getAnnotationID())&&n.push(l[s].clone())}return n}(t,o)),e=h(e,function(t,e){var n,o=t.getLastElement(!0);if(o.getAssociatedBasicDims&&o.getAssociatedBasicDims()){var a=o.getAssociatedBasicDims(),i=e.getChildrenPathes();n=[];for(var r=0;r<i.length;r++){var l=i[r].getLastElement(!0);if("RootViews"!==l.getAnnotationType()&&"RootCaptures"!==l.getAnnotationType()&&"RootGeometries"!==l.getAnnotationType())for(var s=i[r].getChildrenPathes(),g=0;g<s.length;g++)-1!==a.indexOf(s[g].getLastElement(!0).getAnnotationID())&&n.push(s[g].clone())}}return n}(t,o)),e=h(e,function(t,e){var n,o=t.getLastElement(!0),a=o.getAuxiliaryFeatures?o.getAuxiliaryFeatures():null;if(a&&(a.annotations||a.cgs)){var i=e.getChildrenPathes();n=[];for(var r=0;r<i.length;r++){var l=i[r].getLastElement(!0);if("RootViews"!==l.getAnnotationType()&&"RootCaptures"!==l.getAnnotationType()){var s,g=0;if("RootGeometries"===l.getAnnotationType()&&a.cgs.length)for(s=i[r].getChildrenPathes(),g=0;g<s.length;g++)-1!==a.cgs.indexOf(s[g].getLastElement(!0).getAnnotationID())&&n.push(s[g].clone());else if("RootGeometries"!==l.getAnnotationType()&&a.annotations.length)for(s=i[r].getChildrenPathes(),g=0;g<s.length;g++)-1!==a.annotations.indexOf(s[g].getLastElement(!0).getAnnotationID())&&n.push(s[g].clone())}}}return n}(t,o)),e=h(e,function(t,e){var n=[];if(t&&t.getLastElement(!0).getAnnotationSCSReframeArea&&t.getLastElement(!0).getAnnotationSCSReframeArea()){let s=t.getLastElement(!0).getAnnotationSCSReframeArea(),g=[];s.upperLimit&&s.upperLimit.length&&(g=g.concat(s.upperLimit)),s.lowerLimit&&s.lowerLimit.length&&(g=g.concat(s.lowerLimit));for(var o=e.getChildrenPathes(),a=0;a<o.length;a++){var i=o[a].getLastElement(!0);if("RootViews"!==i.getAnnotationType()&&"RootCaptures"!==i.getAnnotationType()&&"RootGeometries"!==i.getAnnotationType())for(var r=o[a].getChildrenPathes(),l=0;l<r.length;l++)-1!==g.indexOf(r[l].getLastElement(!0).getAnnotationID())&&n.push(r[l].clone())}}return n}(t,o)))}else e=h(e,a.getPontingAnnotations(t))}return e}}})}));