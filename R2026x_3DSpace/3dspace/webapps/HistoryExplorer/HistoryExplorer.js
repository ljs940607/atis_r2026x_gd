define("DS/HistoryExplorer/HistoryExplorer",["css!DS/HistoryExplorer/HistoryExplorer"],(function(e){})),define("DS/HistoryExplorer/ExternalRefresh",["UWA/Core","UWA/Controls/Abstract","DS/PlatformAPI/PlatformAPI","DS/LifecycleServices/ArrayFunctions","DS/LifecycleServices/LifecycleServicesSettings"],(function(e,t,i,n,o){return t.extend({PADCommandProxy:null,tenant:null,init:function(e,t){this.views=[],this.views.push(this._revisonFamilyFacade(e)),this.hostContainer=t,this.refreshSub=i.subscribe("Lifecycle.Modification",this._externalRefresh.bind(this)),this._subscribeToPADEvents()},resetViews:function(e){this.views=[],this.views.push(this._revisonFamilyFacade(e))},done:function(){this.refreshSub&&(this.refreshSub.unsubscribe(),this.refreshSub=null),this.PADCommandProxy&&(this.PADCommandProxy.destroy(),this.PADCommandProxy=null)},_subscribeToPADEvents:function(){var e=this;require(["DS/PADUtils/PADCommandProxy"],(function(t){e.PADCommandProxy=t.create({events:{onRefresh:e._onPADEvent.bind(e)}})}))},_onPADEvent:function(t){if(this._handlePADEventDeleted(t),e.is(t.authored.modified,"array"))for(var i=0;i<t.authored.modified.length;i++){var n=null,o=!1;if(e.is(t.authored.modified[i],"string")?n=t.authored.modified[i]:e.is(t.authored.modified[i].physicalid,"string")&&(e.is(t.authored.modified[i].key,"string")&&e.is("ownerChanged"===t.authored.modified[i].key)&&(o=!0),n=t.authored.modified[i].physicalid),!n)return;var s={physicalid:n,tenant:this._getTenant()};this._reloadHost(s.physicalid,s,o)}},_handlePADEventDeleted:function(e){e.authored.deleted&&this._handleDeletedForRefresh(e.authored.deleted)},_revisonFamilyFacade:function(e){return{refresh:function(t){e.setObjects(t)},findObjects:function(t){return e.versionExplorer.getObjects().filter((function(i){var n=e.originalEBProduct&&e.originalEBProduct.id===t;return i.options.id===t||i.options.grid&&i.options.grid.contents&&i.options.grid.contents[0].id===t||n}))},getRelatedId:function(t){var i,n;return(n=e.versionExplorer.getObjects().find((function(i){var n=!e.originalEBProduct||e.originalEBProduct.id!==t;return(i.options.id!==t&&!(i.options.grid&&i.options.grid.contents)||i.options.grid&&i.options.grid.contents&&i.options.grid.contents[0].id!==t)&&n})))&&(i=n.options.grid&&n.options.grid.contents?n.options.grid.contents[0].id:n.options.id),i}}},_isObjectLoaded:function(e){var t=!1;return this.views.forEach((function(i){i.findObjects(e).length>0&&(t=!0)})),t},_reloadHost:function(e,t,i){if(!0===this._isObjectLoaded(e)){if(i){var n=this._getRelatedId(t.physicalid);n&&(t.physicalid=n)}this.hostContainer.load(t)}},_getRelatedId:function(e){var t=null;return this.views.forEach((function(i){t||(t=i.getRelatedId(e))})),t?t.id:null},_handleDeletedForRefresh:function(t){var i=this;if(e.is(t,"array")){var n=null;if(t.some((function(t){var o=null;return e.is(t,"string")?o=t:e.is(t.physicalid,"string")&&(o=t.physicalid),!(!o||!i._isObjectLoaded(o))&&(n=o,!0)})),!n)return;var o=null;this.views.forEach((function(e){if(e.findObjects(n).length>0){var t=e.getRelatedId(n);if(t&&!o){var s=i._getTenant();o={physicalid:t,tenant:s}}}})),o?this.hostContainer.load(o):this.hostContainer.clear()}},setTenant:function(e){this.tenant=e},_getTenant:function(){if(this.tenant)return this.tenant;var e=o.getTenant();return e||(e="undefined"!=typeof widget&&widget?widget.getValue("x3dPlatformId"):null),e},_externalRefresh:function(e){var t=null,i=null;try{var n=JSON.parse(e);if(null!=n&&n.hasOwnProperty("Refresh")){var o=n.Refresh;if(null!=o.created&&o.created.length>0)for(var s=0;s<o.created.length;s++){if(i=o.created[s].sourceObjectId,this._isObjectLoaded(i)){t={physicalid:o.created[s].physicalid,tenant:n.tenant,sourceObjectId:i,eventType:"created",operation:o.created[s].operation};break}}else null!=o.modified&&o.modified.length>0?(i=o.modified[0].physicalid,t={physicalid:o.modified[0].physicalid,tenant:n.tenant}):null!=o.deleted&&o.deleted.length>0&&this._handleDeletedForRefresh(o.deleted)}}catch(e){console.log(e)}t&&this._reloadHost(i,t)}})})),define("DS/HistoryExplorer/HistoryDialog",["UWA/Core","UWA/Controls/Abstract","DS/LifecycleControls/CommandDialog","DS/LifecycleCmd/MessageMediator","DS/HistoryExplorer/ExternalRefresh","DS/LifecycleServices/LifecycleAlert","DS/HistoryMultiPanel/HistoryMultiPanel","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],(function(e,t,i,n,o,s,r,a,l,d){return t.extend({displayNotification:function(e){s.displayNotification(e)},executeCmd:function(e,t,n){this.options=t,this.addEvent("onComplete",(function(e){n()}));var s=this;if(e.length>1)throw s._onComplete(),d.multipleSelection;var r=new i,a=this._renderDialogContent(),c=r.create(a,{className:"History_modal",closeButton:!0,title:d.revisions+" - "+e[0].displayName,buttonStyle:r.buttonStyle.none,resizable:!0,persistId:"historyDialogId",maximizable:!0,overlay:!1,onClose:h,events:{onResizeFloating:function(){var e=c.elements.container.getSize();s.historySizeInitialized||s.historySize&&(e=s.historySize,s.historySizeInitialized=!0,c.setNewSize(e)),s.historySize=e,s.historyMultiPanel.revisionFamily.onResize(e)}}},this);function h(){widget.previewComponent2&&"function"==typeof widget.previewComponent2.close&&widget.previewComponent2.close(),s.historyMultiPanel.revisionFamily.cleanup(),r.destroy(),s._onComplete()}this.dialog=c,this._createHistoryUI(a),this._setObjects(e,!1,!1);var u={load:function(e){"Duplicate"==e.operation&&"created"==e.eventType&&e.sourceObjectId&&(e.physicalid=e.sourceObjectId),s.historyMultiPanel.setObjects([e],!1,!1)},clear:h};this.externalRefresh=new o(this.historyMultiPanel.revisionFamily,u),this.externalRefresh&&e.length>0&&(this.externalRefresh.setTenant(e[0].tenant),l.setTenant(e[0].tenant)),c.inject(widget.body),this.dialog=c,n()},_onComplete:function(){this.externalRefresh&&this.externalRefresh.done(),this.dispatchEvent("onComplete",{})},_setObjects:function(e,t,i){i||(e.length>0&&l.setTenant(e[0].tenant),this.historyMultiPanel.revisionFamily.setObjects(e)),this.externalRefresh&&e.length>0&&(this.externalRefresh.setTenant(e[0].tenant),l.setTenant(e[0].tenant))},_createHistoryUI:function(e){var t=this,i={wintop:!1,includeMaturity:!0,getAllowedSemanticsResponse:this.options.getAllowedSemanticsResponse},n={setObjects:function(e,i,n){t._setObjects(e,i,n),t._reportSelection(e)},setTitleFromObject:function(e){t._setTitleFromObject(e)}};t.historyMultiPanel=new r(t,widget,t.dialog.elements.body,i,n),t.historyMultiPanel.inject(e)},_renderDialogContent:function(){var e=document.createElement("div");return e.className="history_popup",e},_setTitleFromObject:function(e){if(e&&e.displayName){var t="";e.cfgRevTitle?t=e.cfgRevTitle:(t=d.revisions+" - "+e.displayName,null!=e.revision&&t.indexOf(" "+e.revision)<0&&(t+=" "+e.revision)),this.dialog.setTitle(t)}},_reportSelection:function(e){if(e.length>0){var t=e[0].physicalid;a.getSecurityContextPromise(l.getTenant()).then((function(e){var i={objectId:t,metadata:{origin:"ENOLCMI_AP"},envId:l.getTenant(),contextId:e};require(["DS/i3DXCompassServices/i3DXCompassPubSub"],(function(e){e.publish("setObject",i)})),require(["DS/WidgetServices/commandProxy/CommandProxy"],(function(e){var i=[t];e.publishSelect({metadata:{},data:{metadata:{origin:"ENOLCMI_AP"},paths:[i]}})}))}),(function(e){console.log("reportSelection ",e)}))}}})}));