function mock(e,t){return this instanceof mock?(this.object=e,this.fn=t,this.orgFn=e[t],this):new mock(e,t)}mock.prototype={returnValue:function(e){return this.object[this.fn]=function(){return e},this},callFake:function(e){var t=this;this.object[this.fn]=function(){var i=Array.prototype.slice.call(arguments);return i.push(t),e.apply(this,i)}}},define("DS/LifecycleWidget/utils/LifecycleAlert",["DS/Logger/Logger","UWA/Class","css!DS/UIKIT/UIKIT.css","DS/UIKIT/Alert"],(function(e,t,i,n){var s=t.singleton({name:"lifecycle_alert",_logger:null,_alert:null,_error:null,init:function(){this._logger=e.getLogger(s),_alert=null,_error=null},resetContainer:function(e){if(this._logger.log("resetContainer"),!e)throw new Error("Invalid Container");this._alert=new n({className:this.name,closable:!0,visible:!0,autoHide:!0,hideDelay:3e3}).inject(e,"top"),this._error=new n({className:this.name,closable:!0,visible:!0,autoHide:!1}).inject(e,"top")},setContainer:function(e){if(this._logger.log("setContainer"),this._alert)throw new Error("LifecycleAlert Container already set");if(!e)throw new Error("Invalid Container");this.resetContainer(e)},displayNotification:function(e){if(this._logger.log("displayNotification"),null===this._alert)throw new Error("LifecycleAlert Container has not been set");if(e.msg){var t=e.msg;"function"==typeof t.replace&&(t=t.replace(/(?:\r\n|\r|\n)/g,"<br />")),"warning"===e.eventID?this._error.add({className:e.eventID,message:t}):this._alert.add({className:e.eventID?e.eventID:"primary",message:t})}else console.error("displayNotification: message has not been set")}});return s})),define("DS/LifecycleWidget/utils/LifecycleWidgetSearchUtil",["UWA/Core","UWA/Utils/InterCom"],(function(e,t){"use strict";return{initialize:function(){this.socketName="search_socket_"+(new Date).getTime(),this.socket=new t.Socket(this.socketName,{dispatchRetryInterval:5}),this.socket.subscribeServer("SearchComServer"),this.listener=this.objectsSelected.bind(this),this.socket.addListener("Selected_Objects_search",this.listener);var e=this.options();return this.socket.dispatchEvent("RegisterContext",e),this},options:function(e,t,i,n,s,o,a){var r={};return r.title=e,r.mode="furtive",r.app_socket_id=this.socketName,null!==widget&&void 0!==widget?r.widget_id=widget.id:r.widget_id="",r.default_with_precond=!0,r.show_precond=!1,r.idcard_activated=!1,r.multiSel=s,r.role=i,t&&(r.precond="",(t=t.split(",")).forEach((function(e,t){0!==t&&(r.precond+=" OR "),r.precond+='flattenedtaxonomies:"types/'+e+'"'}))),o&&(r.precond?r.precond="( "+r.precond+") AND "+o:r.precond=o),a&&a.length>0&&(r.columns=a),r},destroy:function(){var e={};e.widget_id=widget.id,this.socket.dispatchEvent("unregisterSearchContext",e),this.socket.unsubscribeServer("SearchComServer"),this.socket.removeListener("Selected_Objects_search",this.listener),this.socket.disconnect(),delete this.socket},activate:function(e,t,i,n,s,o,a,r){var l=this.options(e,t,i,n,s,a,r);this.callback=o,this.socket.dispatchEvent("InContextSearch",l)},isAvailable:function(){return e.is(this.socket)},configureSearch:function(e){this.isAvailable()||this.initialize(e)},launchSearch:function(e){this.initialize(),this.activate("",e.allowedTypes,e.role||"",e.criteria,e.bMultiSel,(function(t){e.in_apps_callback(t)}),e.additionalQuery,e.selectable)},objectsSelected:function(e){var t,i,n=[];if(this.callback){for(t=0,i=e.length;t<i;t++)n.push(e[t]);this.callback(n)}}}})),define("DS/LifecycleWidget/CommandRouter",["UWA/Class","DS/LifecycleCmd/DuplicateCmd","DS/LifecycleCmd/ReviseCmd","DS/LifecycleCmd/NewBranchCmd","DS/LifecycleCmd/ReviseFromCmd","DS/LifecycleCmd/DeleteCmd","DS/LifecycleCmd/IterationsCmd","DS/LifecycleCmd/MaturityCmd","DS/LifecycleCmd/HistoryCmd","DS/LifecycleCmd/DownloadCmd","DS/LifecycleCmd/PreviewCmd","DS/LifecycleCmd/ClearAllCmd","DS/LifecycleCmd/TilesLayoutCmd","DS/LifecycleCmd/LargeTilesLayoutCmd","DS/LifecycleCmd/ThumbnailsLayoutCmd"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,p,m){"use strict";return e.singleton({init:function(){this.router={DeleteHdr:{commandName:"Delete",oldPath:"DS/LifecycleWidget/LifecycleCmd",newPath:"DS/LifecycleCmd/DeleteCmd",cmd:null,factory:function(e){return new o(e)}},RevisionHdr:{commandName:"Revise",oldPath:"DS/LifecycleWidget/LifecycleCmd",newPath:"DS/LifecycleCmd/ReviseCmd",cmd:null,factory:function(e){return new i(e)}},NewBranchHdr:{commandName:"NewBranch",oldPath:"DS/LifecycleWidget/LifecycleCmd",newPath:"DS/LifecycleCmd/NewBranchCmd",cmd:null,factory:function(e){return new n(e)}},ReviseFromHdr:{commandName:"ReviseFrom",oldPath:"DS/LifecycleWidget/LifecycleCmd",newPath:"DS/LifecycleCmd/ReviseFromCmd",cmd:null,factory:function(e){return new s(e)}},DuplicateHdr:{commandName:"Duplicate",oldPath:"DS/LifecycleWidget/LifecycleCmd",newPath:"DS/LifecycleCmd/DuplicateCmd",cmd:null,factory:function(e){return new t(e)}},IterationsHdr:{commandName:"Iterations",oldPath:"DS/LifecycleWidget/LifecycleCmd",newPath:"DS/LifecycleCmd/IterationsCmd",cmd:null,factory:function(e){return new a(e)}},MaturityHdr:{commandName:"Maturity",oldPath:"DS/LifecycleWidget/LifecycleCmd",newPath:"DS/LifecycleCmd/MaturityCmd",cmd:null,factory:function(e){return new r(e)}},HistoryHdr:{commandName:"History",oldPath:"DS/LifecycleWidget/LifecycleCmd",newPath:"DS/LifecycleCmd/HistoryCmd",cmd:null,factory:function(e){return new l(e)}},DownloadHdr:{commandName:"Download",oldPath:"DS/LifecycleWidget/LifecycleCmd",newPath:"DS/LifecycleCmd/DownloadCmd",cmd:null,factory:function(e){return new c(e)}},PreviewHdr:{commandName:"Preview",oldPath:"DS/LifecycleWidget/LifecycleCmd",newPath:"DS/LifecycleCmd/PreviewCmd",cmd:null,factory:function(e){return new d(e)}},ClearAllHdr:{commandName:"ClearAll",oldPath:"DS/LifecycleWidget/LifecycleCmd",newPath:"DS/LifecycleCmd/ClearAllCmd",cmd:null,factory:function(e){return new u(e)}},TilesLayoutCmdHdr:{commandName:"TilesLayout",oldPath:"DS/LifecycleWidget/LifecycleCmd",newPath:"DS/LifecycleCmd/TilesLayoutCmd",cmd:null,factory:function(e){return new h(e)}},LargeTilesLayoutCmdHdr:{commandName:"LargeTilesLayout",oldPath:"DS/LifecycleWidget/LifecycleCmd",newPath:"DS/LifecycleCmd/LargeTilesLayoutCmd",cmd:null,factory:function(e){return new p(e)}},ThumbnailsLayoutCmdHdr:{commandName:"ThumbnailsLayout",oldPath:"DS/LifecycleWidget/LifecycleCmd",newPath:"DS/LifecycleCmd/ThumbnailsLayoutCmd",cmd:null,factory:function(e){return new m(e)}}}},isRoutedCommand:function(e){return this.router.hasOwnProperty(e)},initCommand:function(e){if(this.router.hasOwnProperty(e.ID)){var t=this.router[e.ID];t.cmd&&(t.cmd=null),console.warn("Deprecated command path for "+t.commandName+" command.",'Old deprecated path: "'+t.oldPath+'"','Use new path:  "'+t.newPath+'"'),t.cmd=t.factory(e)}else console.error("Invalid header sent to CommandRouter.initCommand")},execute:function(e){if(this.router.hasOwnProperty(e)){var t=this.router[e];t.cmd?t.cmd.execute():console.error("Command "+t.commandName+"is not initialized")}else console.error("Invalid header sent to CommandRouter.execute")}})})),define("DS/LifecycleWidget/LifecycleSelection",["UWA/Controls/Abstract"],(function(e){"use strict";return e.extend({init:function(e){this.object=e},getLabel:function(){return this.object.displayName},getDisplayName:function(){return this.object.displayName+" "+this.object.revision},getID:function(){return this.object.physicalid},getTenant:function(){return this.object.tenant}})})),define("DS/LifecycleWidget/SidePanel",["UWA/Class/View","DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropModel","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],(function(e,t,i,n,s){"use strict";var o=null;return e.extend({slideInContent:"",setup:function(){this.slideInContent=UWA.createElement("div",{id:"slideInPropertiesContent",styles:{height:"95%",width:"100%"}})},getPlatformId:function(){return"undefined"!=typeof widget&&widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"},buildSlideIn:function(e,a,r,l){var c=void 0;this.options&&(c=this.options);var d=new t({typeOfDisplay:i.ALL,displayType:i.STANDARD,readOnly:!1,extraNotif:!1,setEditButton:!0,readOnly:!1,context:c,appId:"ENOLCMI_AP"});d.addFacets([{position:1,require:"DS/ENORIPE_Relations/views/RelationsTab",facet:{name:"relations",text:s.get("relations_tab"),icon:"object-related"}},{require:"DS/ENOXVersionExplorerUtils/RevisionsTabFacet",facet:{name:"revisions",text:"Revisions",icon:"object-related"}}]);for(var u=e,h=this.getPlatformId(),p=[],m=0;m<u.length;m++){var f={metatype:"businessobject",tenant:h,objectId:u[m].object.physicalid};u[m].object.type&&null!=u[m].object.type&&""!=u[m].object.type&&(f.type=u[m].object.type);var g=new n(f);p.push(g)}d.initDatas(p),d.inject(this.slideInContent),o=UWA.extendElement(this.slideInContent);var y=r.getRightPanelContent();return o.inject(y),o}})})),define("DS/LifecycleWidget/DesignMode/mockRequest",["text!DS/LifecycleWidget/DesignMode/MockData/simpleAssy_part1/attributeList.json","text!DS/LifecycleWidget/DesignMode/MockData/simpleAssy_part1/attributeListNewRevFrom.json","text!DS/LifecycleWidget/DesignMode/MockData/simpleAssy_part1/navigate.json","text!DS/LifecycleWidget/DesignMode/MockData/simpleAssy_part1/navigateDup.json","text!DS/LifecycleWidget/DesignMode/MockData/simpleAssy_part1/state.json","text!DS/LifecycleWidget/DesignMode/MockData/simpleAssy_part1/family.json","text!DS/LifecycleWidget/DesignMode/MockData/simpleAssy_part1/links.json","text!DS/LifecycleWidget/DesignMode/MockData/simpleAssy_part1/dupOpts.json","text!DS/LifecycleWidget/DesignMode/MockData/simpleAssy_part1/deleteOpts.json","text!DS/LifecycleWidget/DesignMode/MockData/culasse110/attributeList.json","text!DS/LifecycleWidget/DesignMode/MockData/culasse110/state.json","text!DS/LifecycleWidget/DesignMode/MockData/culasse110/family.json","text!DS/LifecycleWidget/DesignMode/MockData/culasse110/links.json","text!DS/LifecycleWidget/DesignMode/MockData/culasse110/delOptions.json","text!DS/LifecycleWidget/DesignMode/MockData/culasse110/dupOptions.json","text!DS/LifecycleWidget/DesignMode/MockData/culasse110/expand.json","text!DS/LifecycleWidget/DesignMode/MockData/culasse110/expandDup.json","text!DS/LifecycleWidget/DesignMode/MockData/culasse110/expandDupAdvanced.json","text!DS/LifecycleWidget/DesignMode/MockData/culasse110/attributeListNewRevFrom.json","text!DS/LifecycleWidget/DesignMode/MockData/culbuteur/attListNewRevPick1.json","text!DS/LifecycleWidget/DesignMode/MockData/culbuteur/attListNewRevPick2.json","text!DS/LifecycleWidget/DesignMode/MockData/culbuteur/attributeList.json","text!DS/LifecycleWidget/DesignMode/MockData/culbuteur/family.json","text!DS/LifecycleWidget/DesignMode/MockData/culbuteur/links.json","text!DS/LifecycleWidget/DesignMode/MockData/culbuteur/state.json","text!DS/LifecycleWidget/DesignMode/MockData/culbuteur/expand.json","text!DS/LifecycleWidget/DesignMode/MockData/culbuteur/expandPick1.json","text!DS/LifecycleWidget/DesignMode/MockData/culbuteur/expandPick2.json","text!DS/LifecycleWidget/DesignMode/MockData/simpleAssy_part1/securityContext.json","text!DS/LifecycleWidget/DesignMode/MockData/common/enforceFolderLink.json"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,p,m,f,g,y,v,b,C,D,S,w,N,I,O,j,P,x){var E=function(e){var t,i,n=0;if(0===e.length)return n;for(t=0,i=e.length;t<i;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return n};function L(){this.map=[],this.add(-1580602268,e,!0),this.add(-1711554991,e,!0),this.add(-742845072,e,!0),this.add(1834356537,o,!1),this.add(684301714,s,!0),this.add(-499419683,a,!1),this.add(-2023735749,a,!1),this.add(716480295,i,!0),this.add(-368422264,r,!0),this.add(575246942,l,!0),this.add(1408127645,c,!0),this.add(-850201785,c,!0),this.add(1881182438,c,!0),this.add(-716167182,u,!1),this.add(1391380968,d,!0),this.add(-345377001,d,!0),this.add(1496977470,d,!0),this.add(-626771260,h,!1),this.add(-924744780,h,!1),this.add(-1550534267,p,!0),this.add(-223640063,m,!0),this.add(-525842663,f,!0),this.add(-1520147171,g,!0),this.add(1943635073,v,!0),this.add(654572325,y,!0),this.add(-1165212465,D,!0),this.add(-700969585,D,!0),this.add(2110900526,D,!0),this.add(-1698767068,S,!1),this.add(1148999378,w,!1),this.add(-1388157850,w,!1),this.add(929462890,N,!0),this.add(0,b,!0),this.add(0,C,!0),this.add(-460782979,I,!0),this.add(0,O,!0),this.add(0,j,!0),this.add(2011935415,P,!0),this.add(-1302739405,x,!0)}L.prototype={add:function(e,t,i){this.map.push({key:e,data:t,parseJson:i})},find:function(e){for(var t=this.map.length,i=0;i<t;++i)if(this.map[i].key===e)return this.map[i].parseJson?JSON.parse(this.map[i].data):this.map[i].data;return null}};var T={call:function(e,t,i){if(-1!=e.indexOf("mocked")){var n;n=void 0!==t.data?E(e+t.data):E(e),this.reqMap=this.reqMap||new L;var s=this.reqMap.find(n);if(null==s)return console.log("Missing mock data"),console.log("hash:",n),console.log("path:",e),console.log("data",t.data),void t.onFailure("Mock data not found!\nURL:"+e);window.setTimeout((function(){t.onComplete(s)}),0)}else i.orgFn.apply(this,arguments)}};return T})),define("DS/LifecycleWidget/sample/NewCmdOptions",[],(function(e){return{getNewTypeList:function(){return{typeList:["MockDocument","assembly","PhysicalProductCBDAssembly","PhysicalProductCBDBoard","PhysicalProductPLMPCBPhysicalComponent","component","drawing","Change Action","Change Order","Change Request","Change Analysis","Requirement Group","Requirement Specification","Requirement","Chapter","Comment","Terminology","Term","Workspace","Workspace Vault","Document"],showSubtype:!1,showAllTypes:!0}},getTypeFromApp:e=>"assembly",getCreateOptions:function(e){this.launcherOptions||(this.launcherOptions={}),this.launcherOptions[e.newType]||(this.launcherOptions[e.newType]={appName:"lifecycleWidgetApp",silentMode:!1,activatelock:{show:!0,preference:""},activateDraftMode:{show:!0,preference:""},events:this.getCallbackImplementation()});var t=this.launcherOptions[e.newType];if(e.type&&(t.type=e.type),t.options||(t.options={}),this.fillDetailsForType(e.newType,t),this.LCwidgetContext&&t){if(UWA.is(this.LCwidgetContext.getSelectedNodes,"function")){var i=this.LCwidgetContext.getSelectedNodes(),n=[];i.forEach((e=>{n.push(e.getID())})),t.options.parentPIDs=n}if(UWA.is(this.LCwidgetContext.getSecurityContext,"function")){var s=this.LCwidgetContext.getSecurityContext();t.context||(t.context={}),t.context.tenant=s.tenant.value,t.context.header||(t.context.header={}),this.preferedCredential?t.context.header.SecurityContext=this.preferedCredential:t.context.header.SecurityContext=s.SecurityContext,s.SecurityContext.contains("VPLMAdmin")&&"component"===e.newType&&(t.context.isAdminUser=!0)}}return t},fillDetailsForType(e,t){t.showCreateAnother=!0,t.activateCreateAnother=!!this.activateCreateAnother,"assembly"===e||"component"===e?t.type="VPMReference":"drawing"===e&&(t.type="Drawing"),"component"===e&&(t.options.attributes={policy:"VPLM_SMB_Definition"}),"assembly"===e&&(t.viewType="tabView",t.facets=[{name:"facet1",facetoptions:{facetError:!0}},{name:"classificationFacet",facetoptions:{isBookmark:!0,isLibrary:!0,isExportControl:!0}},{name:"facet3",facetoptions:{facetError:!0}},{name:"facet2",facetoptions:{facetError:!0}}])},getCallbackImplementation(){var e=this;return this.callbacks||(this.callbacks={onSuccess:function(t){console.log("ENONewSample LC Widget Creation Successful ");var i=t.result;if(i){var n=[];i.forEach((function(e){n.push({objectId:e.identifier})})),e.LCwidgetContext.addNewObject1({data:{items:n}}),e.LCwidgetContext.displayNotification({eventID:"success",msg:"Object creation successful"})}},onFailure:function(){console.log("ENONew LC Widget Creation Error")},onCancel:function(t){e.activateCreateAnother=t.activateCreateAnother,e.preferedCredential=t.preferedCredential,console.log("ENONew LC Widget Creation dialog closed")}}),this.callbacks}}})),define("DS/LifecycleWidget/DesignMode/setup",["DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData","DS/LifecycleWidget/DesignMode/mockRequest","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","text!DS/LifecycleWidget/DesignMode/MockData/simpleAssy_part1/platformSvc.json"],(function(e,t,i,n,s){return{init:function(){console.log("setup.init()"),designModeLC=!0,mock(n,"getPlatformServices").callFake((function(e){e.onComplete(JSON.parse(s))})),mock(UWA.Data,"request").callFake((function(e,t,n){i.call(e,t,n)})),mock(t,"authenticatedRequest").callFake((function(e,t,n){i.call(e,t,n)})),e.init(),mock(e,"get3DSpaceWSUrl").callFake((function(e,t){return"http://mocked"+t})),mock(e,"get3DSpaceBaseUrl").callFake((function(e){return"http://mocked"})),mock(e,"getCurrentFolderID").returnValue(42),mock(e,"hasPARRole").callFake((function(e){e(!0)}))},onLoaded:function(e){console.log("setup.onLoaded()"),e.uwaUrl="https://mocked/3DSpace/webapps/LifecycleWidget/LifecycleWidget.html",e.myLifecycleWidget.setObjects([{physicalid:"061AB556976F000053D3465784280A00"}])}}})),define("DS/LifecycleWidget/LifecycleCmd",["css!DS/LifecycleWidget/LifecycleWidget","DS/ApplicationFrame/Command","DS/LifecycleWidget/CommandRouter"],(function(e,t,i){"use strict";return t.extend({name:"lifecycle_actionbar",context:null,init:function(e){i.isRoutedCommand(e.ID)&&i.initCommand(e),this._parent(e,{mode:"exclusive",isAsynchronous:!1})},execute:function(){if(i.isRoutedCommand(this._id))i.execute(this._id);else try{commandHdr}catch(i){if("function"==typeof this.context.displayNotification){var e=i;i.hasOwnProperty("message")&&(e=i.message);var t={eventID:"warning",msg:e};this.context.displayNotification(t)}console.log(i.message)}}})})),define("DS/LifecycleWidget/LifecycleWidget",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Promise","DS/PlatformAPI/PlatformAPI","DS/MaturityWidget/MaturityWidget","DS/ApplicationFrame/ActionBar","DS/LifecycleWidget/LifecycleCmd","DS/HistoryMultiPanel/HistoryMultiPanel","DS/CollectionView/ResponsiveThumbnailsCollectionView","DS/CollectionView/ResponsiveTilesCollectionView","DS/CollectionView/ResponsiveLargeTilesCollectionView","DS/CollectionView/modelProviders/CollectionViewUWACollectionModelProvider","UWA/Class/Collection","UWA/Class/Model","DS/UIKIT/Mask","DS/LifecycleWidget/LifecycleSelection","DS/LifecycleServices/LifecycleAlert","DS/ApplicationFrame/CommandsManager","DS/LifecycleServices/WebReq","DS/WAFData/WAFData","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","UWA/Utils/InterCom","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/LifecycleServices","DS/LifecycleControls/CommandDialog","DS/LifecycleServices/LifecycleObjectBlacklist","DS/LifecycleCmd/MessageMediator","DS/HistoryExplorer/ExternalRefresh","DS/LifecycleWidget/utils/LifecycleWidgetSearchUtil","DS/UIKIT/Input/Button","WebappsUtils/WebappsUtils","DS/ENOXEmptyContent/js/ENOXEmptyContent","text!DS/LifecycleWidget/assets/search_config/search_config.json","DS/RuntimeView/NLSManager","css!DS/Core/wux-3ds-fonticons.css","css!DS/Core/wux.css","DS/ENOXTriptych/js/ENOXTriptych","DS/LifecycleWidget/SidePanel","DS/CoreEvents/ModelEvents","DS/Core/PointerEvents","css!DS/UIKIT/UIKIT.css","DS/LifecycleCmd/CommandAPI","DS/i3DXCompassPlatformServices/OpenWith","DS/UIKIT/Mask","DS/PubSub/PubSub","DS/LifecycleControls/CredentialList","DS/UIKIT/Tooltip","DS/ENOCollabToolsUI/tracker/ENOCollabTracker","i18n!DS/ENOXVersionExplorerController/assets/nls/NodeDropdownMenuNLS"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,p,m,f,g,y,v,b,C,D,S,w,N,I,O,j,P,x,E,L,T,A,M,_,k,W,R,V,F,H,B,U,q,X,J,z,K){"use strict";var G,Z,$,Q,Y;const ee="project.property[Title].value";var te,ie="PushItem";return t.extend({name:"Lifecycle-container",tenant:null,collabsharing:!1,addinmode:null,init:function(t,i,s){this.widget=t,this.widget.lifecycleWidget=this,this.parentWidget=i,this.addinmode=this.widget.getValue("addinmode");var o=this;this.widgetType="LifecycleWidget",(window.location.href.indexOf("ENOLCMS_AP")>-1||s.hasOwnProperty("forceCollabSharingMode"))&&(console.log("LifecycleWidget: In Collab Sharing App!!!"),o.collabsharing=!0),this.droppable=s.droppable,this.responsiveThumbOptions={height:"inherit",displayedOptionalCellProperties:["contextualMenu"],allowUnsafeHTMLContent:!1},this.autolaunch="",this.transientSearch=!1,this.fromSearch=!1,this.startAttributeIncrement=200,this.attributeIncrement=this.startAttributeIncrement,this.minimumAttributeIncrement=25,this.odtMode=!1,s.hasOwnProperty("odtMode")&&(this.odtMode=s.odtMode),void 0===s.droppable?this.droppable=!0:this.droppable=s.droppable,this._parent(s),this.objects=[],this.objectsPID=[],this.objectsLID=[],this.setTitle(C.lifecycleTitle),this.selectedNodes=[],this.selectedNodesPID=[],this.selectedNodesObjects=[],this.model=new h,this.modelPIDs=[],this.containerResponsiveThumbnailOrTile=null,this._actionBar=null,this.actionBarReady=!1,this.revisionsHistoryWidget=null,this.maturityWidget=null,this.ShareReportingCommandEnabled=!1,this.ShareReportingCommandEnabledChecked=!1,this.multiViewType=1,this.secretMultiViewFlag=!1,this.secretMultiViewFlagCheck=!0,this.stack=[],this.selectedObjIdFromSearch=null,this.refreshSub=n.subscribe("Lifecycle.Modification",this._processRefresh.bind(this)),require(["DS/PADUtils/PADCommandProxy"],(function(t){o.commandProxy=t.create({events:{onRefresh:function(t){e.is(t.authored.modified,"array")&&t.authored.modified.length>0&&o.updateObjectAtttributes(t.authored.modified),e.is(t.authored.deleted,"array")&&t.authored.deleted.length>0&&o.removeObjects(t.authored.deleted)}}})})),this.lifecycleDropArea=null,this.lifecycleDroppableArea=null,this.elements.container=null,this.setInfoIcon(),this.buildSkeleton();o=this;this.clearView=function(e){e.empty()},S.app_initialization((function(){o.tenant=S.getTenant();var e=[{platformId:o.tenant}];null!=e&&e.length>0&&Array.isArray(e)&&e.forEach((function(e){null!=e&&e.hasOwnProperty("platformId")&&(1==s.odtMode&&(o.reloadSavedObjects(),o.useCompassContent()),w.getSecurityContextList(e.platformId,(function(){0===e.platformId.localeCompare(o.tenant)&&(o.reloadSavedObjects(),o.useCompassContent()),o.getSecurityContext=w.getSecurityContextForCollaborativeSharingCommands,o.getExpressionofSharingReport()})))}))})),require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"]);require(["DS/LifecycleWidget/sample/NewCmdOptions","DS/ENONewWidget/command/NewContentAppOptions","DS/ENONewWidget/command/NewContentOptions"],(function(e,t,i){var n=i.singleton(e);n.LCwidgetContext=o,t.setAppContext(n)})),"solidworks"==this.addinmode&&t.addEvent("endEdit",(function(){o.useCompassContent()}))},_processRefresh:function(e){var t=this;try{var i=JSON.parse(e);if(null!=i&&i.hasOwnProperty("Refresh")&&i.hasOwnProperty("AppID")&&"ENOLCMI_AP"===i.AppID){var n=i.Refresh;Array.isArray(n.created)&&n.created.length>0&&n.created[0].forceLoad&&t.revisionsHistoryWidget&&t.revisionsHistoryWidget.revisionFamily&&t.revisionsHistoryWidget.revisionFamily.versionExplorer?t.revisionsHistoryWidget.revisionFamily.versionExplorer._forceLoad():null!=n.created&&n.created.length>0&&t.addObjects(n.created)}}catch(e){console.log(e)}},_subcribe:function(){this.modelEvents.subscribe({event:"LifecycleWidget-info-icon-close"},(function(){infoicon.classList.remove("selected")}))},setInfoIcon:function(){var e=new R;this.modelEvents=e,this.subscribeInfoEvents(e),this._subcribe()},subscribeInfoEvents:function(e){var t=this;e.subscribe({event:"LifecycleWidget-info-panel-open"},(function(){t._displayProperties()})),e.subscribe({event:"LifecycleWidget-info-panel-close"},(function(){t._hidePropertiesPanel()}))},_displayProperties:function(e){var t=this.selectedNodes;if(0!=t.length){var i=new W;i.options=this.getSecurityContext(),i.options.getSecurityContext=function(){var e=void 0;return this.hasOwnProperty("SecurityContext")&&(e=this.SecurityContext),{SecurityContext:e}},i.buildSlideIn(t,e,Z),Z._showPanel(" ")}else Z._showPanel(" ")},_hidePropertiesPanel:function(){if(!0===Z._isRightOpen){var e=document.getElementById("slideInPropertiesContent");null!=e&&e.destroy(),Z._hidePanel(" ")}},clearAllSelectedNodes:function(){var e=this;e.selectedNodes=[],e.selectedNodesPID=[],e.selectedNodesObjects=[],e.containerResponsiveThumbnailOrTile&&e.containerResponsiveThumbnailOrTile.unselectAll()},selectThisNode:function(e){var t=this;if(t.containerResponsiveThumbnailOrTile){var i=t.modelPIDs.indexOf(e);i>=0&&t.containerResponsiveThumbnailOrTile.selectCell(i,!0,!1,!1)}},selectNodes:function(e){var t=this;t.clearAllSelectedNodes();for(var i=0;i<e.length;i++){var n=new f(e[i]);t.selectedNodes.push(n),t.selectedNodesPID.push(e[i].physicalid),t.selectedNodesObjects.push(e[i]),t.selectThisNode(e[i].physicalid)}t.doPickContext(t.contextMenuObject,t.isOpenWithCatiaV5Available)},setCurrentWidgetPreferences:function(){var e=this.tenant?this.tenant:S.getTenant();widget.setValue("xPref_3DEXPERIENCE_PLATFORM",e)},largeTilesLayout:function(){this.multiViewType="LargeTiles",this.changeViewType()},tilesLayout:function(){this.multiViewType="Tiles",this.changeViewType()},thumbnailsLayout:function(){this.multiViewType="Thumbnails",this.changeViewType()},changeViewType:function(){var e=this;if(0!=e.isMultiView()&&(e.containerResponsiveThumbnailOrTile&&e.containerResponsiveThumbnailOrTile.destroy(),e.containerResponsiveThumbnailOrTile=null,e.buildCollectionView(e.lifecycleDiv),e.containerResponsiveThumbnailOrTile.loadApplicativeModel(e.model),e.selectedNodesPID&&e.selectedNodesPID.length>0))for(var t=0;t<e.selectedNodesPID.length;t++){var i=e.selectedNodesPID[t];e.selectThisNode(i)}},buildSkeleton:function(){var t=this;this.globalDropZone=e.createElement("div",{class:"lifecycle-welcome-panel-drop-zone",html:[{tag:"div",class:"lifecycle-welcome-panel-dropIconAndText",html:[{tag:"i",styles:{color:"#368EC4"},class:"lifecycle-welcome-panel_img wux-ui-3ds wux-ui-3ds-4x wux-ui-3ds-open"},{tag:"h5",class:"lifecycle-welcome-panel_txt",styles:{color:"#368EC4","font-size":"16px","margin-top":"5px"},html:K.open}]}]});var i=this.elements.container=e.createElement("div",{class:this.getClassNames()}).inject(widget.body);this.globalDropZone.hide(),this.globalDropZone.inject(i),1==this.droppable&&(this.elements.container.addEventListener("drop",(function(e){t.onDrop(e)})),this.elements.container.addEventListener("dragover",(function(e){t.onDragOver(e)})),this.elements.container.addEventListener("dragenter",(function(e){t.onDragEnter(e)})),this.elements.container.addEventListener("dragleave",(function(e){t.onDragLeave(e)})),this.elements.container.addEventListener("dragstart",(function(e){t.onDragStart(e)})));for(var s=this.parentWidget;document!=s;){if("onunload"in s){s.onunload=function(e){if(!0===t.fromSearch&&!0===t.transientSearch){n.publish("search.secondaryMenu:lastSearchResults",{})}};break}s=s.parentNode}this.searchView=e.createElement("div",{class:"searchView"}).inject(i);t=this;var o=new x({value:C.get("searchBtnLabel"),className:"primary"}),a=JSON.parse(T),r=Object.values(a).join(",");o.addEvent("onClick",(function(){P.launchSearch({allowedTypes:r,role:"",criteria:T.type_act_physical,additionalQuery:"",bMultiSel:!0,in_apps_callback:t.onSelectedFromSearch.bind(t)})})),this.dropArea=document.createElement("div"),this.dropArea.className="lifecycle-main",this.droppableArea=document.createElement("div"),this.droppableArea.className="lifecycle-filter fonticon fonticon-3x fonticon-drag-drop";var l=e.Element("div",{class:"font-3ds-regular"});l.innerHTML=C.dropHere,this.droppableArea.appendChild(l),this.dropArea.appendChild(this.droppableArea),this._LifecycleWidgetEmptyContent=new L({sentences:[{type:"drop",text:C.dropHere,DOMelement:t.dropArea},{type:"dom",DOMelement:o.getContent()}]}),this._LifecycleWidgetEmptyContent.inject(this.searchView),this.gotSavedObjects()&&this.searchView.hide(),widget.endEdit=this.changeCurrentCredential.bind(this)},changeCurrentCredential:function(e){if(null!=e&&e.hasOwnProperty("submitted")&&e.submitted&&widget.hasPreference("xPref_CREDENTIAL")){var t=widget.getPreference("xPref_CREDENTIAL");if(t.defaultValue=t.value,widget.addPreference(t),widget.hasPreference("xPref_3DEXPERIENCE_PLATFORM")){var i=widget.getPreference("xPref_3DEXPERIENCE_PLATFORM");i.defaultValue=i.value,widget.addPreference(i),this.setTenant(i.value)}S.setOption(S.getTenant(),{defaultValue:t.value})}},_updateUI:function(e){e?this.searchView&&this.searchView.hide():this.searchView&&this.searchView.show()},updateObjectTitle:function(e,t){0==this.isMultiView()&&this.revisionsHistoryWidget.updateObjectTitle(e,t)},refreshFromStack:function(e){var t=this;w.getSecurityContextPromise(this.tenant).then((function(i){t.refreshFromStackReq(e,i)}))},refreshFromStackReq:function(t,i){var n,s=this,o=S.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/product/getAllValidObjFromStack",null),a=this.getAttributesId(),r=null,l=[];if(null!=t&&t.length>0){for(n=0;n<t.length;n++){var c=t[n];null!=c&&c.hasOwnProperty("id")&&void 0!==c.id&&null!==c.id?l.push(c.id):l.push(c)}r={data:l,attributes:a}}b.authenticatedRequest(o,{type:"json",method:"POST",proxy:"passport",data:e.Json.encode(r),headers:S.getHeaders(i),onComplete:function(e){var t=e.results;if(null==t||0==t.length)s.empty();else{var n,o=[],a=!1,r=!0;for(n=0;n<t.length;n++)"#DENIED!"==t[n].owner?a=!0:(r=!1,t[n].tenant=s.tenant,o.push(t[n]),s.fixImagePath(t[n],s.tenant));var l={evintID:"warning",msg:C.someObjectsNotFound},c={evintID:"warning",msg:C.allObjectsNotFound};!0===r?(this.displayNotification(c),s.empty()):(!0===a&&this.displayNotification(l),s.objects=[],s.getThumbnailsFromFederated(i,o,s._getServiceIds(o)).then((e=>{s.updateObjects(e),s.updateCommands()})))}},onFailure:function(e){console.log("refreshFromStack: Failure..."+e)},onTimeout:function(){console.log("refreshFromStack: A connection timeout occured.")}})},getExtendedStack:function(){return this.isMultiView()||void 0!==this.modelPIDs&&0!=this.modelPIDs.length?(this.revisionsHistoryWidget&&(this.revisionsHistoryWidget.destroy(),this.revisionsHistoryWidget=null,this.externalRefresh&&(this.externalRefresh.done(),this.externalRefresh=null)),this.maturityWidget&&(this.maturityWidget.destroy(),this.maturityWidget=null),this.stack=this.modelPIDs):this.revisionsHistoryWidget&&(this.stack=[this.revisionsHistoryWidget.revisionFamily.currentObject]),this.stack},refresh:function(){var e=widget.getValue("Custo_roots_pids");widget.data&&(widget.data.appId="ENOLCMI_AP"),"[]"!=e&&this.refreshFromStack(this.getExtendedStack())},setTenant:function(e){if(this.tenant=e,widget.setValue("x3dPlatformId",e),S.setTenant(e),widget.hasPreference("xPref_3DEXPERIENCE_PLATFORM")){var t=widget.getPreference("xPref_3DEXPERIENCE_PLATFORM");t.defaultValue=e,t.value=e,widget.addPreference(t)}},removeContextMenu:function(e){var t=null;if(0!=this.objects.length){!1===this.isMultiView()?this.maturityWidget&&this.maturityWidget.elements&&(t=this.maturityWidget.elements.container):this.multiContent&&(t=this.multiContent);var i=document.createEvent("MouseEvents");i.initMouseEvent("mousedown",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),t&&t.dispatchEvent(i)}},onDrop:function(t){t.preventDefault(),this.globalDropZone.hide(),!this.searchView.isHidden()&&this.objects.length>0&&this.objectsPID.length>0&&this.empty(),this.removeContextMenu(t),this.selectedNodes=[],this.selectedNodesPID=[],this.selectedNodesObjects=[];for(var i=0,n=e.is(t.dataTransfer.types.indexOf,"function")?"indexOf":"contains",s="",o=["text/searchitems","text/plain","Text"],a=0;a<o.length&&""===s;a++){var r=t.dataTransfer.types[n](o[a]);(e.is(r,"number")&&r>=0||e.is(r,"boolean")&&!0===r)&&(s=o[a])}""!==s&&(i=t.dataTransfer.getData(s));var l,c,d,u=JSON.parse(i),h=S.getOption(u.data.items[0].envId,null),p=!1;if(S.getTenant()!=u.data.items[0].envId&&0===this.objects.length){if(h){this.setTenant(u.data.items[0].envId),this.setCurrentWidgetPreferences();var m={eventID:"info",msg:C.currentPlatformHasChanged+u.data.items[0].envId+".\n"+C.currentSecurityContextHasChanged+this.getNLSCredential(widget.getValue("xPref_CREDENTIAL"))}}else m={eventID:"warning",msg:C.NoAccessToTenant+u.data.items[0].envId};this.displayNotification(m)}else if(S.getTenant()!=u.data.items[0].envId&&this.objects.length>0){p=!0;m={eventID:"warning",title:C.multipleTenantSelectionTitle,subtitle:C.multipleTenantSelectionSubtitle};this.displayNotification(m)}this.externalRefresh&&this.externalRefresh.setTenant(this.tenant);var f=[],g=!1,y=!1;for(l=0;l<u.data.items.length;l++)c=u.data.items[l].serviceId,d=u.data.items[l].objectId,"3dplan"===c?g=!0:0===d.indexOf("swym:")?y=!0:p||f.push(u.data.items[l]);if(!0===g){m={eventID:"warning",msg:C.PlanNotSupported};this.displayNotification(m)}if(!0===y){m={eventID:"warning",msg:C.nonCollabSpaceObject};this.displayNotification(m)}if(h){var v,b=0;this.objects&&(b=this.objects.length);var D=[],w=this.objectsPID,N=new Set;for(v=0;v<f.length;v++){var I=f[v].objectId,O={physicalid:I,displayName:f[v].displayName,objectType:f[v].objectType,serviceId:c};b>0?-1==w.indexOf(I)&&1!=N.has(I)&&(N.add(I),D.push(O)):1!=N.has(I)&&(N.add(I),D.push(O))}var j=(D=this.removeBlacklistedTypes(D)).length;if(b<2&&j>0){if(this._actionBar){this.actionBarReady=!1;try{this._actionBar.destroy()}catch(e){console.error(e)}}this._actionBar=null}if(j>0){var P=this.isCID(this.objects)||this.isCID(D);this.buildDataPresenter(j+b,P,D,b?"setObjectsAdd":"setObjects")}}},addNewObject1:function(e){var t,i=0;this.objects&&(i=this.objects.length);var n=[],s=this.objectsPID,o=new Set,a=e.data.items;for(t=0;t<a.length;t++){var r=a[t],l=r.objectId,c={physicalid:l,displayName:r.displayName,objectType:r.objectType};i>0?-1==s.indexOf(l)&&1!=o.has(l)&&(o.add(l),n.push(c)):1!=o.has(l)&&(o.add(l),n.push(c))}var d=(n=this.removeBlacklistedTypes(n)).length;if(i<2&&d>0&&(this._actionBar=null),d>0){var u=this.isCID(this.objects)||this.isCID(n);this.buildDataPresenter(d+i,u,n,i?"setObjectsAdd":"setObjects")}},getNLSCredential:function(e){var t=e,i=widget.getPreference("xPref_CREDENTIAL");if(i&&i.options)for(var n=i.options,s=0;s<n.length;s++)if(n[s].value==e){t=n[s].label;break}return t},onDragOver:function(e){e.preventDefault()},onDragEnter:function(e){!this.dragFromLifecycleWidget&&this.globalDropZone.show(),e.preventDefault()},onDragStart:function(e){this.dragFromLifecycleWidget=!0},onDragLeave:function(e){null!=e.relatedTarget&&this.elements.container.contains(e.relatedTarget)||(this.globalDropZone.hide(),this.dragFromLifecycleWidget=!1)},removeBlacklistedTypes:function(e,t){var i,n=[],s=e.length,o=!1;for(i=0;i<s;i++)if(I.isBlacklisted(e[i].objectType))o=!0;else{var a=t?t[e[i].physicalid]:void 0;a&&(e[i].serviceId=a),n.push(e[i])}if(!0===o){if(1===s)var r={eventID:"warning",msg:C.objectTypeNotSupported};else r={eventID:"warning",msg:C.someObjectTypesNotSupported};this.displayNotification(r)}return n},incrementalValidObjAtt:function(e){var t=this;w.getSecurityContextPromise(this.tenant).then((function(i){t.incrementalValidObjAttReq(e,i)}))},fixImagePath:function(e,t){var i,n=S.get3DSpaceBaseUrl(t),s=e.options.icons,o=s.length,a=[];for(i=0;i<o;i++){var r=s[i];r&&r.startsWith("/")&&(r=n+r),a.push(r)}e.options.icons=a},incrementalValidObjAttReq:function(t,i){var n=this,s=S.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/product/getAllValidObjFromStack",null),o={data:t,attributes:n.getAttributesId()};b.authenticatedRequest(s,{type:"json",method:"POST",proxy:"passport",data:e.Json.encode(o),headers:S.getHeaders(i),onComplete:function(e){var t=e.results;if(null==t||0==t.length)n.empty();else{var i,s=[];for(i=0;i<t.length;i++)"#DENIED!"==t[i].owner||(t[i].tenant=n.tenant,s.push(t[i]),n.fixImagePath(t[i],n.tenant));n.incrementalValidObjectsAttributes(s)}},onFailure:function(e){console.log("incrementalValidObjAttReq: Failure..."+e)},onTimeout:function(){console.log("incrementalValidObjAttReq: A connection timeout occured.")}})},removeValidObj:function(e){var t,i=this,n=e.length,s=(S.get3DSpaceBaseUrl(i.tenant),[]);for(t=0;t<n;t++){var o=e[t],a=i.objectsPID.indexOf(o);if(a>=0){i.objects.splice(a,1),i.objectsPID.splice(a,1),i.objectsLID.splice(a,1);var r=i.stack.indexOf(o);r>=0&&i.stack.splice(r,1),i.removeSelectedPID(o);var l=i.modelPIDs.indexOf(o);s.push(l)}}for(t=0;t<n;t++){o=e[t],l=i.modelPIDs.indexOf(o);i.modelPIDs.splice(l,1)}i.removeModelObjects(o,s);var c=JSON.stringify(this.objects);widget.setValue("Custo_roots_pids",c),0==this.objects.length&&this.searchView.show()},updateValidObjAtt:function(e){var t=this;w.getSecurityContextPromise(this.tenant).then((function(i){t.updateValidObjAttReq(e,i)}))},updateValidObjAttReq:function(t,i){var n=this,s=S.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/product/getAllValidObjFromStack",null),o={data:t,attributes:n.getAttributesId()};b.authenticatedRequest(s,{type:"json",method:"POST",proxy:"passport",data:e.Json.encode(o),headers:S.getHeaders(i),onComplete:function(e){var t=[],i=e.results;if(null==i||0==i.length)n.empty();else{var s,o=[];for(s=0;s<i.length;s++)if("#DENIED!"==i[s].owner){if(!0!==n.isMultiView()){o=[],t=[];break}t.push(i[s].objectId)}else i[s].tenant=n.tenant,o.push(i[s]),n.fixImagePath(i[s],n.tenant);o.length+t.length>0?n.updateValidObjectsAttributes(o):n.empty()}t.length>0&&n.removeObjects(t)},onFailure:function(e){console.log("updateValidObjAttReq: Failure..."+e)},onTimeout:function(){console.log("updateValidObjAttReq: A connection timeout occured.")}})},updateValidObjectsAttributes(e){var t,i=this,n=e.length,s=S.get3DSpaceBaseUrl(i.tenant);for(t=0;t<n;t++){var o=e[t],a=o.physicalid,r=i.objectsPID.indexOf(a);r>=0&&(i.objects[r]=o);var l=i.selectedNodesPID.indexOf(a);if(l>=0){i.selectedNodesObjects[l]=o;var c=new f(o);i.selectedNodes[l]=c}var d=i.modelPIDs.indexOf(a);d>=0&&i.replaceModelObject(o,d,s)}var u=JSON.stringify(this.objects);widget.setValue("Custo_roots_pids",u)},incrementalValidObjectsAttributes(e){var t,i=this,n=e.length,s=S.get3DSpaceBaseUrl(i.tenant);for(t=0;t<n;t++){var o=e[t],a=o.physicalid;i.objects.push(o),i.objectsPID.push(a),i.objectsLID.push(o.logicalid),i.stack.push(a),o.tenant=this.tenant,i.addModelObject(o,s)}var r=JSON.stringify(this.objects);widget.setValue("Custo_roots_pids",r)},updateObjectAtttributes:function(e){var t=this;if(t.objects.length>1||0==t.isMultiView()){var i,n=[],s=e.length;for(i=0;i<s;i++){var o=e[i];t.objectsPID.indexOf(o)>=0&&n.push(o)}n.length>0&&t.updateValidObjAtt(n)}},removeObjects:function(e){var t=this;(t.objects.length>1||1==t.objects.length&&t.isMultiView())&&t.removeObjectsSingleOrMultiview(e)},removeObjectsSingleOrMultiview:function(e){var t,i=this,n=i.objects.length,s=[],o=e.length;for(t=0;t<o;t++){var a=e[t];i.objectsPID.indexOf(a)>=0&&s.push(a)}s.length>0&&i.removeValidObj(s),1==i.objects.length&&n>1?i.reloadSavedObjects():0==i.objects.length?i.empty():i.trackAppContent()},addObjects:function(e){var t=this;if(t.objects.length>1||!0===t.isMultiView()){var i,n=[],s=e.length;for(i=0;i<s;i++){var o=e[i];"Revise"!=o.operation&&"Branch"!=o.operation&&"Duplicate"!=o.operation||0<=t.objectsPID.indexOf(o.sourceObjectId)&&n.push(e[i].physicalid),"Restore"==o.operation&&n.push(e[i].physicalid)}n.length>0&&t.incrementalValidObjAtt(n)}},updateObjectsAdd:function(e,t,i){if(e&&0!==e.length){var n=!1;if(this.objects&&this.objects.length>0&&(n=!0),0!==(e=this.removeBlacklistedTypes(e)).length){if(e&&1==e.length&&!1===n&&!1===this.isMultiView()){try{this.revisionsHistoryWidget.setObjects(e,t,i)}catch(e){}try{this.maturityWidget.setObjects(e)}catch(e){console.log("updateObject Error: "+e)}this.updateLifecycleWidget(e)}else this.buildModel(this.objects,e),!0===n?this.updateLifecycleWidgetAdd(e):this.updateLifecycleWidget(e);var s=JSON.stringify(this.objects);widget.setValue("Custo_roots_pids",s)}}},updateObjects:function(e,t,i,n=!1){if(e&&0!==e.length&&0!==(e=this.removeBlacklistedTypes(e)).length){if(e&&1==e.length&&!1===this.isMultiView()){try{this.revisionsHistoryWidget.setObjects(e,t,i)}catch(e){}try{this.maturityWidget.setObjects(e)}catch(e){console.log("updateObject Error: "+e)}this.updateLifecycleWidget(e,n)}else this.buildModel(this.objects,e),this.updateLifecycleWidget(e,n);var s=JSON.stringify(this.objects);widget.setValue("Custo_roots_pids",s)}},updateLifecycleWidget:function(e,t=!1){var i,n=this;for(n.objects=e,n.objectsPID=[],i=0;i<e.length;i++)n.objectsPID.push(e[i].physicalid),n.objectsLID.push(e[i].logicalid);if(1!=e.length||n.isMultiView()||0!=t?0==t&&n.setTitle(C.lifecycleTitle):n.setTitleFromObject(e[0]),n.setSelectedNodes(e),-1===n.stack.indexOf(e[0].physicalid)){var s;n.stack=[].concat(n.objectsPID);var o=[];for(s=0;s<e.length;s++)o.push(e[s].physicalid);n.stack=o}if(0!=n.autolaunch.localeCompare(""))if(n.fromSearch=!0,"LifecycleDelete"===n.autolaunch)n._actionBar&&(n.actionBarReady?(n.runDeleteCommand(),n.autolaunch=""):n._actionBar.onActionBarReady((function(){var e=y.getCommand("MaturityHdr",n);e&&(0==n.isMultiView()?e.setShouldEnable(!1):e.setShouldEnable(!0)),(e=y.getCommand("HistoryHdr",n))&&(0==n.isMultiView()?e.setShouldEnable(!1):e.setShouldEnable(!0)),(e=y.getCommand("TilesLayoutCmdHdr",n))&&(0==n.isMultiView()?e.setShouldEnable(!1):e.setShouldEnable(!0)),(e=y.getCommand("LargeTilesLayoutCmdHdr",n))&&(0==n.isMultiView()?e.setShouldEnable(!1):e.setShouldEnable(!0)),(e=y.getCommand("ThumbnailsLayoutCmdHdr",n))&&(0==n.isMultiView()?e.setShouldEnable(!1):e.setShouldEnable(!0)),n.updateCommands(),n.runDeleteCommand(),n.autolaunch="",n.actionBarReady=!0,console.log("onActionBarReady called when trying to autolaunch, line 1453")})));else n.autolaunch="";n.showNotBusy(n.lifecycleDiv)},updateLifecycleWidgetAdd:function(e){var t=this;t.objects=[].concat(t.objects,e),t.setTitle(C.lifecycleTitle);var i,n=[],s=[];for(i=0;i<e.length;i++)n.push(e[i].physicalid),s.push(e[i].logicalid);t.objectsPID=[].concat(t.objectsPID,n),t.objectsLID=[].concat(t.objectsLID,s),t.setSelectedNodes(e),t.stack=[].concat(t.stack,n),t.showNotBusy(t.lifecycleDiv)},setTitleFromObject:function(e){var t=e.displayName||e["attribute[PLMEntity.V_Name]"];if(e["attribute[Marketing Name]"]&&(t=e["attribute[Marketing Name]"]),e&&t){if("OnPremise"==widget.getValue("x3dPlatformId")||void 0===widget.getValue("x3dPlatformId"))this.setTitle(t+" "+e.revision);else{var i=S.getOption("platform_services"),n=widget.getValue("x3dPlatformId"),s=n;if(null!=i&&Array.isArray(i)&&i.length>0)for(const e of i)if(null!=e&&e.hasOwnProperty("platformId")&&e.platformId===n){s=e.displayName;break}var o=widget.getPreference("xPref_CREDENTIAL").options,a="";if(e.hasOwnProperty(ee)&&"string"==typeof e[ee]&&e[ee].trim().length>0){var r=e[ee];if(null!=o&&Array.isArray(o))for(const e of o){var l=e.value;if(l.slice(l.lastIndexOf(".")+1)==r){a=e.label.substring(0,e.label.indexOf("â—")).trim();break}}}this.setTitle(a+" - "+t+" - "+e.revision+" ("+s+")")}this.selectedNodes&&this.selectedNodes[0]&&this.selectedNodes[0].object&&!this.selectedNodes[0].object.displayName&&(this.selectedNodes[0].object.displayName=t)}},setTitle:function(e){this.widget.setTitle(e)},updateIterationsCommand:function(e){var t=y.getCommand("IterationsHdr",this);if(null!=t)if(1==e.length){var i=e[0];"CATPart"==i.type||"3DShape"==i.type?t.enable():t.disable()}else t.disable()},updateCommands:function(){var e=this;this.app="lifecycle",(t=y.getCommand("MaturityHdr",i))&&(0==e.isMultiView()?t.setShouldEnable(!1):t.setShouldEnable(!0)),(t=y.getCommand("HistoryHdr",i))&&(0==e.isMultiView()?t.setShouldEnable(!1):t.setShouldEnable(!0)),(t=y.getCommand("TilesLayoutCmdHdr",i))&&(0==i.isMultiView()?t.setShouldEnable(!1):t.setShouldEnable(!0)),(t=y.getCommand("LargeTilesLayoutCmdHdr",i))&&(0==i.isMultiView()?t.setShouldEnable(!1):t.setShouldEnable(!0)),(t=y.getCommand("ThumbnailsLayoutCmdHdr",i))&&(0==i.isMultiView()?t.setShouldEnable(!1):t.setShouldEnable(!0)),O.dispatchEvent("LC_CmdMgr_UpdateUI",{getSelectedNodes:function(){var t,i=e.getSelectedNodes(),n=[];if(i.length>0)for(t=0;t<i.length;t++)i[t].object&&n.push(i[t].object);return n}});var t,i=this,n=i.getSelectedNodes(),s=i.isCID(n);if(1===n.length){var o=n[0].type;-1!==["Workspace","Workspace Vault","Personal Workspace","Folder"].indexOf(o)&&!0}(t=y.getCommand("CompareHdr",i))&&t.enable(),i.disableIfCID(t,s),(t=y.getCommand("ActionBar_Attributes",i))&&i.disableIfNoneSelected(t,n.length),(t=y.getCommand("Properties",i))&&t.setCommandAvailability(t.getEnableCmd()),(t=y.getCommand("CompareHdr",i))&&t.setCommandAvailability(t.getEnableCmd()),i.disableIfCID(t,s),(t=y.getCommand("ListSnapshotsHdr",i))&&t.setCommandAvailability(t.getEnableCmd()),i.disableIfCID(t,s),(t=y.getCommand("CreateSnapshotHdr",i))&&t.setCommandAvailability(t.getEnableCmd()),i.disableIfCID(t,s),(t=y.getCommand("ActionBar_ReserveCmd",i))&&i.disableIfNoneSelected(t,n.length),(t=y.getCommand("ActionBar_UnreserveCmd",i))&&i.disableIfNoneSelected(t,n.length),(t=y.getCommand("SubscribeHdr",i))&&i.disableIfNoneSelected(t,n.length),i.disableIfCID(t,s),(t=y.getCommand("UnSubscribeHdr",i))&&i.disableIfNoneSelected(t,n.length),i.disableIfCID(t,s),(t=y.getCommand("EditSubscribeHdr",i))&&i.disableIfNoneSelected(t,n.length),i.disableIfCID(t,s),(t=y.getCommand("ActionBar_ChangeOwner",i))&&i.disableIfNoneSelected(t,n.length),(t=y.getCommand("ActionBar_TransferOwnership",i))&&i.disableIfNoneSelected(t,n.length),(t=y.getCommand("ActionBar_AccessRightCmd",i))&&i.disableIfNoneSelected(t,n.length)},disableIfNoneSelected:function(e,t){e&&(0===t?e.disable():e.enable())},disableIfCID:function(e,t){t&&e&&e.disable()},reportSelection:function(e){if(e.length>0){var t,i=[],n=(e.length,[]),s={},o=S.getTenant();w.getSecurityContextPromise(S.getTenant()).then((function(a){for(t=0;t<e.length;t++){var r={type:e[t].type,label:e[t].displayName};s[e[t].physicalid]=r,n.push(e[t].physicalid),i.push({envId:o,serviceId:e[t].serviceId?e[t].serviceId:"3DSpace",contextId:a,objectId:e[t].physicalid,objectType:e[t].type,displayName:e[t].displayName,"ds6w:kind":e[t]["ds6w:kind"],"ds6w:policy":e[t].policy,"ds6w:reserved":null!=e[t].reservedby?"TRUE":"FALSE","ds6w:status":e[t].options["ds6w:status"],"ds6wg:revision":e[t].revision,displayType:e[t].options?e[t].options["ds6w:type"]:void 0,displayIcon:e[t].options&&e[t].options.icons&&e[t].options.icons.length>0?e[t].options.icons[0]:void 0,displayPreview:e[t].options&&e[t].options.icons&&e[t].options.icons.length>1?e[t].options.icons[1]:void 0,revisionModeInfo:e[t].revisionModeInfo})}var l={items:i},c={protocol:"3DXContent",version:"2.0",source:"ENOLCMI_AP",widgetId:widget.id,data:l},d=new D.Socket("compassPageSocket");d.subscribeServer("com.ds.compass",window.parent),c.data.items&&c.data.items.length>0&&d.dispatchEvent("onSetObject",c.data.items[0],"compassPageSocket"),d.dispatchEvent("onSetX3DContent",c,"compassPageSocket"),1!=Y&&1==e.length&&require(["DS/WidgetServices/commandProxy/CommandProxy"],(function(e){var t={paths:[],attributes:{},securityContext:""},i=n;t.paths=[i],t.attributes=s,t.securityContext=a,e.publishSelect({metadata:{},data:t})})),Y=!1}),(function(e){console.log("reportSelection ",e)}))}},setX3DContent:function(e){var t=[];e.length>0&&w.getSecurityContextPromise(S.getTenant()).then((function(i){var n;for(n=0;n<e.length;n++){var s="";e[n].hasOwnProperty("tenant")&&(s=e[n].tenant);var o="";e[n].hasOwnProperty("sourceid")&&(o=e[n].sourceid),""===o&&(o=e[n].serviceId?e[n].serviceId:"3DSpace"),t.push({envId:s,serviceId:o,contextId:i,objectId:e[n].physicalid,objectType:e[n].type,displayName:e[n].displayName})}}));var i={protocol:"3DXContent",version:"1.0",source:"ENOLCMI_AP",data:{items:t}},n=new D.Socket("compassPageSocket");n.subscribeServer("com.ds.compass",window.parent),n.dispatchEvent("onSetX3DContent",i,"compassPageSocket")},addSelectedNode:function(e){var t=this,i=e._attributes.physicalid;if(-1==t.selectedNodesPID.indexOf(i)){var n=t.objectsPID.indexOf(i),s=t.objects[n];t.selectedNodesObjects.push(s),t.selectedNodesPID.push(i),t.selectedNodes.push(new f(s)),t.reportSelection(t.selectedNodesObjects),t.setX3DContent(t.selectedNodesObjects),t.updateCommands(),t.doPickContext(t.contextMenuObject,t.isOpenWithCatiaV5Available)}},removeSelectedNode:function(e){var t=e._attributes.physicalid;this.removeSelectedPID(t)},removeSelectedPID:function(e){var t=this,i=t.selectedNodesPID.indexOf(e);i>=0&&(t.selectedNodesPID.splice(i,1),t.selectedNodes.splice(i,1),t.selectedNodesObjects.splice(i,1),t.reportSelection(t.selectedNodesObjects),t.setX3DContent(t.selectedNodesObjects),t.updateCommands(),t.doPickContext(t.contextMenuObject,t.isOpenWithCatiaV5Available))},setSelectedNodes:function(e){this.reportSelection(e),this.setX3DContent(e);var t=this;this.selectNodes(e),t._actionBar&&(t._actionBar.onActionBarReady((function(){var e=t.isMultiView(),i=y.getCommand("MaturityHdr",t);i&&(0==e?i.setShouldEnable(!1):i.setShouldEnable(!0)),(i=y.getCommand("HistoryHdr",t))&&(0==e?i.setShouldEnable(!1):i.setShouldEnable(!0)),(i=y.getCommand("TilesLayoutCmdHdr",t))&&(0==e?i.setShouldEnable(!1):i.setShouldEnable(!0)),(i=y.getCommand("LargeTilesLayoutCmdHdr",t))&&(0==e?i.setShouldEnable(!1):i.setShouldEnable(!0)),(i=y.getCommand("ThumbnailsLayoutCmdHdr",t))&&(0==e?i.setShouldEnable(!1):i.setShouldEnable(!0)),t.updateCommands(),"LifecycleDelete"===t.autolaunch&&(t.runDeleteCommand(),t.autolaunch=""),t.actionBarReady=!0,console.log("onActionBarReady called in setSelectedNodes, line 1775")})),t.updateCommands())},getSelectedNodes:function(){return this.selectedNodes},refreshView:function(e){},getObjectAttributes:function(t){var i=this,n=[];return i.attributeIncrement=i.startAttributeIncrement,new e.Class.Promise((function(e,s){w.getSecurityContextPromise(i.tenant).then((function(s){i.getObjectAttributesIncremental(t,n,s).then((function(n){i.getThumbnailsFromFederated(s,n,i._getServiceIds(t)).then(e)})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))}))},getObjectAttributesIncremental:function(t,i,n){var s=this;return new e.Class.Promise((function(e,o){s.getObjectAttributesRequest(t,i,n).then((function(i){i.length==t.length?e(i):s.getObjectAttributesIncremental(t,i,n).then((function(t){e(t)}))}))}))},_getServiceIds:function(e){return Array.from(new Set(e.map((e=>e.serviceId||e.sourceid))))},getThumbnailsFromFederated:async function(e,t,n){let s=t.reduce(((e,t)=>(t.tenant=t.tenant||"OnPremise",e[t.tenant]=e[t.tenant]||[],e[t.tenant].push(t),e)),{});function o(t,i,s){let o={with_indexing_date:!0,with_synthesis:!0,with_nls:!1,label:`3DSearch-${s.id}-LifecycleWidget-${Date.now()}`,locale:"en",select_exclude_synthesis:["ds6w:what/ds6w:topic"],select_predicate:["ds6w:label","ds6w:type","ds6w:description","ds6w:identifier","ds6w:modified","ds6w:created","ds6wg:revision","ds6w:status","ds6w:responsible","ds6wg:filesize","ds6w:i3dx","ds6w:project","ds6w:dataSource","ds6w:community","ds6w:originator","dsgeo:referential","ds6w:lastModifiedBy","ds6w:repository","dcterms:title","dcterms:description"],with_synthesis_hierarchical:!0,select_file:["icon","thumbnail_2d"],order_by:"asc",order_field:"ds6w:modified",nresults:40,start:"0",source:n.filter((e=>null!=e)).map((e=>e.toLowerCase())),tenant:t,login:n.filter((e=>null!=e)).reduce(((t,i)=>(t[i]={SecurityContext:e},t)),{})};return o.query=i.reduce(((e,t,n)=>e+=`[ds6w:resourceUid]:${t.objectId}`+(n<i.length-1?" OR ":"")),""),v.post(S.getPlatformWSUrl("3DSearch",t,"/search"),JSON.stringify(o),{params:{tenant:t,securityContext:e}})}let a=[];await S.getCurrentUserPromise();for(const[e,t]of Object.entries(s))a.push(o(e,t,n));return i.allSettled(a).then((e=>(e.forEach((e=>{"rejected"!==e.status&&e.value&&Array.isArray(e.value.results)&&e.value.results.length&&e.value.results.forEach((e=>{let i=e.attributes.find((e=>"resourceid"===e.name))?.value,n=e.attributes.find((e=>"preview_url"===e.name))?.value,s=e.attributes.find((e=>"type_icon_url"===e.name))?.value,o=null!=i&&t.find((e=>e.objectId===i));null!=o&&null!=s&&(o.options.icons[0]=s),null!=o&&null!=n&&(o.options.icons[1]=n)}))})),t)))},getObjectAttributesRequest:function(t,i,n){var s=this,o=i.length;return new e.Class.Promise((function(a,r){var l,c=s.getAttributesId(),d=t.length,u=d;d>o+s.attributeIncrement&&(u=o+s.attributeIncrement);var h=[];for(l=o;l<u;l++)h.push(t[l].physicalid);var p={data:h,attributes:c},m=S.get3DSpaceWSUrl(s.tenant,"/resources/lifecycle/product/getAllValidObjFromStack",null);b.authenticatedRequest(m,{type:"json",method:"POST",proxy:"passport",data:e.Json.encode(p),headers:S.getHeaders(n),onComplete:function(e){var t=e.results;if(t&&t.length>0){var n;for(n=0;n<t.length;n++)t[n].tenant=s.tenant,s.fixImagePath(t[n],s.tenant);i=i.concat(t),a(i)}else{var o={eventID:"error",msg:C.objectNotFound};s.displayNotification(o)}},onFailure:function(e,t,i){if(null!=t&&t.hasOwnProperty("error")&&void 0!==t.error&&null!==t.error&&t.error.trim().length>0){var n=t.error;if(n.contains("1501009")||n.contains("1500178")){var o={eventID:"error",msg:C.invalidCredential};s.displayNotification(o)}}r("getAttributeList:Failure..."+e)},onTimeout:function(){s.attributeIncrement>s.minimumAttributeIncrement&&(s.attributeIncrement=s.attributeIncrement/2,a(i)),r("getObjectAttributesReq: A connection timeout occured.")}})}))},getAttributesId:function(){var e=[];return e.push("owner"),e.push(ee),e.push("organization"),e.push("revision"),e.push("current"),e.push("physicalid"),e.push("logicalid"),e.push("type"),e.push("name"),e.push("locker"),e.push("reserved"),e.push("reservedby"),e.push("majorid"),e.push("minorrevision"),e.push("majorrevision"),e.push("versionid"),e.push("policy"),e.push("attribute[Marketing Name]"),e.push("attribute[Display Name]"),e.push("attribute[Synopsis]"),e.push("attribute[DOCUMENTS.Title]"),e.push("attribute[Title]"),e.push("attribute[PLMEntity.PLM_ExternalID]"),e.push("attribute[PLMEntity.V_usage]"),e.push("attribute[PLMEntity.V_Name]"),e.push("attribute[PLMReference.V_DerivedFrom]"),e.push("attribute[PLMReference.V_fromExternalID]"),e.push("attribute[PLMCoreRepReference.V_isOnceInstantiable]"),e.push("attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]"),e.push("tenant"),e},setObjects:function(e){return new i((t=>{var i={};if((e=this.removeBlacklistedTypes(e)).length>0){for(var n=0;n<e.length;n++)i[e[n].physicalid]=e[n].serviceId;this._updateUI(!0);var s=this;this.getObjectAttributes(e).then((function(n){var o=0,a=[],r=[];for(o=0;o<n.length;o++)"#DENIED!"==n[o].owner?a.push(n[o].objectId):r.push(n[o]);if(a.length>0&&0==s.isMultiView()&&(r=[]),null==r||0==r.length){var l,c=[];if(s.stack.length>0)for(l=0;l<s.stack.length;l++){var d=s.stack[l];d&&c.push(d)}if(c.length>0){if(s.refreshFromStack(c),a.length>0){var u={eventID:"warning",msg:1==a.length?C.objectNotFound:C.allObjectsNotFound};s.displayNotification(u)}}else{s.empty();u={eventID:"warning",msg:C.objectNotFound};s.displayNotification(u),s.clearView(s)}}else(e=s.removeBlacklistedTypes(n,i)).length>0&&(s.updateObjects(e,!1,!1),a.length>0&&s.removeObjects(a));s.trackAppContent(),"function"==typeof t&&t()}))}else"function"==typeof t&&t()}))},setObjectsAdd:function(e){return new i((t=>{if((e=this.removeBlacklistedTypes(e)).length){this._updateUI(!0);var i=this;this.getObjectAttributes(e).then((function(n){var s=0,o=[],a=[];for(s=0;s<n.length;s++)"#DENIED!"==n[s].owner?o.push(n[s].objectId):a.push(n[s]);if(null==a||0==a.length){var r,l=[];if(i.stack.length>0)for(r=0;r<i.stack.length;r++){var c=i.stack[r];c&&l.push(c)}if(l.length>0){if(i.refreshFromStack(l),o.length>0){var d={eventID:"warning",msg:1==o.length?C.objectNotFound:C.allObjectsNotFound};i.displayNotification(d)}}else{i.empty();d={eventID:"warning",msg:C.objectNotFound};i.displayNotification(d),i.clearView(i)}}else{if(0===(e=i.removeBlacklistedTypes(a)).length)return;if(i.updateObjectsAdd(e,!1,!1),o.length>0){d={eventID:"warning",msg:C.someObjectsNotIncluded};i.displayNotification(d)}}i.trackAppContent(),"function"==typeof t&&t()}))}else"function"==typeof t&&t()}))},setObjectsWithExceptions:function(e,t,i,n=!1){var s={},o={};e=this.removeBlacklistedTypes(e);for(var a=0;a<e.length;a++)s[e[a].physicalid]=e[a].serviceId,o[e[a].physicalid]=e[a]["ds6w:kind"];var r=e,l=this;this.getObjectAttributes(e).then((function(e){var a=0,c=[],d=[],u=[];for(a=0;a<e.length;a++){var h=e[a].objectId;e[a]["ds6w:kind"]=o[h],1==l.isMultiView()?l.objectsPID.indexOf(h)>=0&&(u.push(e[a]),"#DENIED!"==e[a].owner?c.push(h):d.push(e[a])):"#DENIED!"!=e[a].owner&&(d.push(e[a]),u.push(e[a]))}if(u.length>0&&0==d.length&&(u=[]),u.length>0)d.length>0&&("xRevisionElement"===(u=l.removeBlacklistedTypes(u,s))[0].policy&&(u[0].revisionModeInfo=r[0].revisionModeInfo),l.updateObjects(u,t,i,n)),c.length>0&&l.removeObjects(c);else if(c.length>0){p=1==c.length?{errorMsg:C.objectNotFound}:{errorMsg:C.allObjectsNotFound},l.maturityWidget.displayError(p),c.length>0&&l.empty()}else if(0==l.isMultiView()&&l.objectsPID.length>0){l.revisionsHistoryWidget.revisionFamily.displayError(C.noObject);var p={errorMsg:C.noObject};l.maturityWidget.displayError(p)}else if(0==l.isMultiView()){var m={eventID:"warning",msg:C.objectNotFound};l.displayNotification(m)}}))},displayNotification:function(e){g.displayNotification(e)},_renderClearAllModalContent:function(){var t=document.createElement("div");t.className="clearall_popup";var i,n=document.createElement("div"),s=document.createElement("div");s.className="delete_popup_warning";var o=e.createElement("div",{styles:{height:"100%"}}),a=S.get3DSpaceBaseUrl(widget.getValue("x3dPlatformId"))+"/webapps/IterationsWidget/assets/images/warning.png";return o.innerHTML='<img src="'+a+'"></img>',s.appendChild(o),t.appendChild(s),i=C.doCloseMessage+"<br><br>"+C.doCloseDetails,n.innerHTML=i,t.appendChild(n),t},ClearAllCmd:function(){var e=this;if(0===e.selectedNodesPID.length){var t=this._renderClearAllModalContent(),i=new N,n=i.create(t,{title:C.close_,OKBtnText:C.close_,closeButton:!0,imageUrl:"",onOk:function(){e.empty(),i.destroy()},onClose:function(){}});n.inject(widget.body),n.setNewSize({})}else e.removeObjectsSingleOrMultiview(e.selectedNodesPID)},empty:function(){var t=this;t.stack=[],t.selectedNodes=[],t.selectedNodesPID=[],t.selectedNodesObjects=[],t.objects=[],t.objectsPID=[],t.objectsLID=[],t.model=new h,t.modelPIDs=[],t.containerResponsiveThumbnailOrTile=null,require(["DS/i3DXCompassServices/i3DXCompassPubSub"],(function(t){t.publish("resetObject"),t.publish("resetX3DContent");var i=e.is(widget.getValue("X3DContentId"),"string")?JSON.parse(widget.getValue("X3DContentId")):null;e.is(i)&&e.is(i.data)&&(i.data.items=[],widget.setValue("X3DContentId",JSON.stringify(i))),widget.setValue("Custo_roots_pids","[]")})),require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],(function(e){if(t.CAJson={},e.get2((function(e){t.CAJson=e})),t.setTitle(C.lifecycleTitle),t.updateCommands(),t._actionBar&&(t._actionBar.destroy(),t._actionBar=null),t.actionBarReady=!1,0==t.isMultiView()&&(t.revisionsHistoryWidget&&(t.revisionsHistoryWidget.destroy(),t.revisionsHistoryWidget=null,t.externalRefresh&&(t.externalRefresh.done(),t.externalRefresh=null)),t.maturityWidget&&(t.maturityWidget.destroy(),t.maturityWidget=null)),t.elements.container){var i=t.elements.container.querySelector(".mainDiv_container");i&&i.parentNode.removeChild(i)}t.searchView&&t.searchView.show()})),t.trackAppContent()},gotSavedObjects:function(){if(widget.getValue("Custo_roots_pids")&&null==this.addinmode){var e=JSON.parse(widget.getValue("Custo_roots_pids"));if("undefined"!==e&&null!==e&&e.length>0)return!0}return!1},reloadSavedObjects:function(){if(this.gotSavedObjects()){var e,t;e=JSON.parse(widget.getValue("Custo_roots_pids"));var i=[];for(t=0;t<e.length;t++){var n=e[t].serviceId,s=e[t].type,o={physicalid:e[t].physicalid,displayName:e[t].displayName,serviceId:n,type:s,tenant:e[t].tenant};i.push(o)}var a=e[0].tenant;null!=a&&null!=a&&a.trim().length>0&&this.setTenant(e[0].tenant),this.externalRefresh&&this.externalRefresh.setTenant(this.tenant);var r=i.length;if(r>0){if(this._actionBar){this.actionBarReady=!1;try{this._actionBar.destroy()}catch(e){console.error(e)}}this._actionBar=null}this.buildDataPresenter(r,this.isCID(i),i)}else widget.addPreference({name:"Custo_roots_pids",type:"hidden",defaultValue:"[]"}),this.trackAppContent()},useCompassContent:function(){if(!this.gotSavedObjects()){var e=void 0!==this.widget.getValue("X3DContentId")?JSON.parse(widget.getValue("X3DContentId")):null;if(null!==e){var t=e.data;if(e.hasOwnProperty("commandId")&&(this.autolaunch=e.commandId),e.hasOwnProperty("widgetId")&&0===e.widgetId.indexOf("preview")&&(this.transientSearch=!0),null!==t){var i=[],n=[];if(t.items.length>0){var s,o=t.items.length;for(s=0;s<o;s++){null!==(a=t.items[s]).objectId&&void 0!==a.objectId&&n.push(a)}for(this.setTenant(n[0].envId),this.externalRefresh&&this.externalRefresh.setTenant(this.tenant),o=n.length,s=0;s<o;s++){var a,r={physicalid:(a=n[s]).objectId};null!==a.displayName&&void 0!==a.displayName&&(r.displayName=a.displayName),null!==a.objectType&&void 0!==a.objectType&&(r.objectType=a.objectType),i.push(r)}}if((i=this.removeBlacklistedTypes(i)).length>0){var l=i.length;this.buildDataPresenter(l,this.isCID(i),i)}}}}},onSelectedFromSearch:function(e){this.clearAllSelectedNodes();var t,i=0;this.objects&&(i=this.objects.length);var n=[],s=this.objectsPID,o=new Set;for(t=0;t<e.length;t++){var a=e[t].id,r={physicalid:a,type:e[t]["ds6w:type"],displayName:e[t]["ds6w:label"],sourceid:e[t].sourceid};i>0?-1==s.indexOf(a)&&1!=o.has(a)&&(o.add(a),n.push(r)):1!=o.has(a)&&(o.add(a),n.push(r))}var l=(n=this.removeBlacklistedTypes(n)).length;if(1==this.isMultiView()){if(this._actionBar){this.actionBarReady=!1;try{this._actionBar.destroy()}catch(e){console.error(e)}}this._actionBar=null}if(l>0){var c=this.isCID(this.objects)||this.isCID(n);this.buildDataPresenter(l+i,c,n,i?"setObjectsAdd":"setObjects")}},createLifecycleDiv:function(){var t,i=this,n=null;if(i.elements&&i.elements.container?n=i.elements.container.querySelector(".lifecycle"):i.buildSkeleton(),n){!function(e){for(var t=e;e.hasChildNodes();)t.hasChildNodes()?t=t.lastChild:(t=t.parentNode).removeChild(t.lastChild)}(n),n.parentNode.removeChild(n)}if(this.searchView&&this.searchView.hide(),n=i.elements.container.querySelector(".mainDiv_container"))(t=this.lifecycleDiv=document.createElement("div")).className="lifecycle",t.style.display="table";else{Q=e.createElement("div",{class:"mainDiv_container"}),(t=this.lifecycleDiv=document.createElement("div")).className="lifecycle",t.style.display="table",this.elements.container.appendChild(Q),$=e.createElement("div",{class:"rightPanelDiv_container"}),G=e.createElement("div",{class:"centerPanelDiv_container"});var s=e.createElement("div",{class:"toolbar"});Q.appendChild(s);var o=e.createElement("div",{class:"floatcontainer"});s.appendChild(o);var a=e.createElement("div",{class:"information-panel panel-icon-wrapper"});o.appendChild(a);var r=e.createElement("span",{class:"fonticon fonticon-2x fonticon-info"});a.appendChild(r),this.infoPanel=a,new J({target:r,body:"Information",position:"bottom"}).elements.container.style.zIndex=99999,a.addEventListener("click",(function(e){var t=i.infoPanel,n=!1;if(t){t=t.getElement(".fonticon");t.classList.contains("selected")?(n=!0,t.classList.remove("selected")):(n=!1,t.classList.add("selected"))}n?(!1,i.modelEvents.publish({event:"LifecycleWidget-info-panel-close"})):(!0,i.modelEvents.publish({event:"LifecycleWidget-info-panel-open"}))}))}(G.appendChild(t),n)||((Z=new k).init({left:{resizable:!0,originalSize:240,originalState:"close",overMobile:!0},right:{resizable:!0,originalState:"close",overMobile:!0,autoCloseFlag:!0},borderRight:!0,borderLeft:!0,withtransition:!0},null,G,$),Z.inject(Q),Z._container.getElementsByClassName("triptych-close-right fonticon fonticon-wrong")[0].hidden=!0);return t},isCID:function(e){var t=!1,i=e.length;if(i>0)if(e[0].physicalid){for(var n=0;n<i;n++)if(0===e[n].physicalid.indexOf("cid:")){t=!0;break}}else if(e[0].object&&e[0].object.physicalid)for(n=0;n<i;n++)if(0===e[n].object.physicalid.indexOf("cid:")){t=!0;break}return t},isCIDinPIDList:function(e){for(var t=!1,i=e.length,n=0;n<i;n++)if(0===e[n].indexOf("cid:")){t=!0;break}return t},isMultiView:function(){return this.objects.length>1||null!=this.addinmode},buildDataPresenter:function(t,i,n,s="setObjects"){var o=this;if(!1===o.secretMultiViewFlagCheck)return new e.Class.Promise((function(e,a){w.getSecurityContextPromise(o.tenant).then((function(e){o.getNoSingleObjectModePromise(t,i,e,n,s),["catch"]((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))}));o.buildDataPresenterReq(t,i,n,s)},appendMergeButtonToActionBar:function(e){e.loadModel({file:"lifecycle_merge.xml",merge:!0,module:"LifecycleWidget"})},appendMergeButtonIfEnabled:function(e){var t=this;null==t._mergeCommandIsEnabled?w.getSecurityContextPromise(t.tenant).then((function(i){t.getMergeEnabledFromExpression(i).then((function(i){t._mergeCommandIsEnabled=i,i&&t.appendMergeButtonToActionBar(e)}))}),(function(e){console.log(e)})):t._mergeCommandIsEnabled&&t.appendMergeButtonToActionBar(e)},getExpressionofSharingReport:function(){var t=this;return new e.Class.Promise((function(e,i){w.getSecurityContextPromise(t.tenant).then((function(e){t.getExprShareReport(e).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))}))},getExprShareReport:function(t){var i=this;return new e.Class.Promise((function(e,n){var s=S.get3DSpaceWSUrl(i.tenant,"/resources/lifecycle/util/getExpression",null);b.authenticatedRequest(s,{type:"json",method:"GET",proxy:"passport",headers:S.getHeaders(t),data:{expression:"ShareReportingCommandEnabled"},onComplete:function(t){t&&t.result&&(i.ShareReportingCommandEnabled="true"===t.result||"TRUE"===t.result),e(i.ShareReportingCommandEnabled)},onFailure:function(t,i,n){console.log("getMergeEnabledFromExpression:Failure..."+t),e(!1)},onTimeout:function(){console.log("getMergeEnabledFromExpression: A connection timeout occured."),e(!1)}})}))},getMergeEnabledFromExpression:function(t){var i=this;return new e.Class.Promise((function(e,n){var s=S.get3DSpaceWSUrl(i.tenant,"/resources/lifecycle/util/getExpression",null);b.authenticatedRequest(s,{type:"json",method:"GET",proxy:"passport",headers:S.getHeaders(t),data:{expression:"LifecycleMergeEnabled"},onComplete:function(t){var i=!1;t&&t.result&&(i="true"===t.result||"TRUE"===t.result||"WITHPUBSOPTION"===t.result),e(i)},onFailure:function(t,i,n){console.log("getMergeEnabledFromExpression:Failure..."+t),e(!1)},onTimeout:function(){console.log("getMergeEnabledFromExpression: A connection timeout occured."),e(!1)}})}))},getNoSingleObjectModePromise:function(t,i,n,s,o){var a=this;return new e.Class.Promise((function(e,r){var l=S.get3DSpaceWSUrl(a.tenant,"/resources/lifecycle/util/getExpression",null);b.authenticatedRequest(l,{type:"json",method:"GET",proxy:"passport",headers:S.getHeaders(n),data:{expression:"LifecycleExpressionNoSingleObjectMode"},onComplete:function(e){e.hasOwnProperty("result")?"true"===e.result?(a.secretMultiViewFlag=!0,a.secretMultiViewFlagCheck=!0):(a.secretMultiViewFlag=!1,a.secretMultiViewFlagCheck=!0):(a.secretMultiViewFlag=!1,a.secretMultiViewFlagCheck=!0);a.buildDataPresenterReq(t,i,s,o)},onFailure:function(e,n,r){if(null!=n&&n.hasOwnProperty("error")&&void 0!==n.error&&null!==n.error&&n.error.trim().length>0){var l=n.error;if(l.contains("1501009")||l.contains("1500178")){var c={eventID:"error",msg:C.invalidCredential};a.displayNotification(c)}}console.log("getNoSingleObjectModeReq:Failure..."+e),a.buildDataPresenterReq(t,i,s,o)},onTimeout:function(){console.log("getNoSingleObjectModeReq: A connection timeout occured."),a.buildDataPresenterReq(t,i,s,o)}})}))},enableRecycleBin:function(){var e=!1;return S.hasRole((function(t){!0===t&&(e=!0)}),["InternalDS","SSY","LUS","CYM","UIL"]),e},buildDataPresenterReq:function(t,n,s,a){var r=this,l=r.createLifecycleDiv();r.revisionsHistoryWidget&&(r.revisionsHistoryWidget.destroy(),r.revisionsHistoryWidget=null,this.externalRefresh&&(this.externalRefresh.done(),this.externalRefresh=null)),r.maturityWidget&&(r.maturityWidget.destroy(),r.maturityWidget=null);let c=Array.isArray(s)&&s.length?this[a](s):i.resolve(null);1===t?void 0!==r.addinmode||!0===r.secretMultiViewFlag?r.buildCollectionView(l):r.buildSingleObjectView(l):t>1&&(r.buildCollectionView(l),r.showBusy(l)),r._actionBar||(this.collabsharing?(this._actionBar=new o({context:r,file:"lifecycle_fromlifecycle_cs.xml",module:"LifecycleWidget"}).inject(globalDiv),this._actionBar&&(this._actionBar.elements.container.setStyle("position","sticky"),this._actionBar.elements.container.setStyle("z-index","4006")),this._actionBar.onActionBarReady((function(){c.then((()=>{var e=y.getCommand("MaturityHdr",r);e&&(0==r.isMultiView()?e.setShouldEnable(!1):e.setShouldEnable(!0)),(e=y.getCommand("HistoryHdr",r))&&(0==r.isMultiView()?e.setShouldEnable(!1):e.setShouldEnable(!0)),(e=y.getCommand("TilesLayoutCmdHdr",r))&&(0==r.isMultiView()?e.setShouldEnable(!1):e.setShouldEnable(!0)),(e=y.getCommand("LargeTilesLayoutCmdHdr",r))&&(0==r.isMultiView()?e.setShouldEnable(!1):e.setShouldEnable(!0)),(e=y.getCommand("ThumbnailsLayoutCmdHdr",r))&&(0==r.isMultiView()?e.setShouldEnable(!1):e.setShouldEnable(!0)),r.updateCommands(),"LifecycleDelete"===r.autolaunch&&(r.runDeleteCommand(),r.autolaunch=""),console.log("onActionBarReady called when building data presenter for Colaboration, line 3686"),r.actionBarReady=!0}))})),this.dispatchEvent("actionBarCreated",{})):w.getSecurityContextPromise(S.getTenant()).then((function(t){var i="lifecycle_fromlifecycle.xml";widget.getValue("debugMode")?i="lifecycle_fromlifecycle_debug.xml":t.indexOf(":VPLMAdmin.")>=0&&r.ShareReportingCommandEnabled?i="lifecycle_fromlifecycle_recyclebin_admin.xml":r.enableRecycleBin()&&(i="lifecycle_fromlifecycle_recyclebin.xml"),r._actionBar=new o({context:r,file:i,module:"LifecycleWidget"}),null!==r.lifecycleDiv&&void 0!==r.lifecycleDiv&&(r._actionBar.inject(Q),r._actionBar&&(r._actionBar.elements.container.setStyle("position","fixed"),r._actionBar.elements.container.setStyle("z-index","4006")));var n=0;r._actionBar.onActionBarReady((function(){c.then((()=>{0===n&&r.appendMergeButtonIfEnabled(r._actionBar);var t=y.getCommand("MaturityHdr",r);t&&(0==r.isMultiView()?t.setShouldEnable(!1):t.setShouldEnable(!0)),(t=y.getCommand("HistoryHdr",r))&&(0==r.isMultiView()?t.setShouldEnable(!1):t.setShouldEnable(!0)),(t=y.getCommand("TilesLayoutCmdHdr",r))&&(0==r.isMultiView()?t.setShouldEnable(!1):t.setShouldEnable(!0)),(t=y.getCommand("LargeTilesLayoutCmdHdr",r))&&(0==r.isMultiView()?t.setShouldEnable(!1):t.setShouldEnable(!0)),(t=y.getCommand("ThumbnailsLayoutCmdHdr",r))&&(0==r.isMultiView()?t.setShouldEnable(!1):t.setShouldEnable(!0)),r.updateCommands(),console.log("Activating PanelHelp MODE from buildDataPresenter : UAContainer = "+te),te?(te.inject(G),console.log("We already have the UAContainer")):((te=e.Element("div",{class:"ua-panel-help-container",styles:{position:"absolute",width:"100%",height:"100%","z-index":"2",left:"0px",top:"0px","pointer-events":"none"}})).inject(G),require(["DS/Windows/ImmersiveFrame"],(function(e){var t=new e;t.inject(te),require(["DS/WebUAUtils/WebUAUtils"],(function(e){e.setPanelHelpMode({immersiveFrame:t}),console.log("PanelHelp MODE ACTIVATED ! from buildDataPresenter")}))}))),console.log("onActionBarReady in buildDataPresenter, line 3800"),"LifecycleDelete"===r.autolaunch&&(r.runDeleteCommand(),r.autolaunch=""),r.actionBarReady=!0,n++}))})),r.dispatchEvent("actionBarCreated",{})}),(function(e){console.log("buildDataPresenterReq ",e)}))),1===t&&void 0===this.addinmode&&!1===r.secretMultiViewFlag?require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],(function(e){var t=r.elements.container.querySelector(".lifecycle-content.revision"),i=r.elements.container.querySelector("#BubbleContainer");if(null==i){e.initialize2(t,null,"show","bottom-right",(function(e){r.dispatchEvent("onAuthoringCtxAvailable",e)})),void 0===r.CAJson&&(r.CAJson={},e.get2((function(e){r.CAJson=e}))),void 0!==r.CAJson&&r.CAJson.version&&e.set2(r.CAJson,(function(e){console.log(e)}))}})):(t>1||null!=this.addinmode||!0===r.secretMultiViewFlag)&&require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],(function(e){var t=r.elements.container.querySelector(".lifecycle-content.multi"),i=r.elements.container.querySelector("#BubbleContainer");if(null==i){r.containerResponsiveThumbnailOrTile&&(e.initialize2(t,null,"show","bottom-right",(function(e){r.dispatchEvent("onAuthoringCtxAvailable",e)})),void 0===r.CAJson&&(r.CAJson={},e.get2((function(e){r.CAJson=e}))),void 0!==r.CAJson&&r.CAJson.version&&e.set2(r.CAJson,(function(e){console.log(e)})))}})),widget.endEdit=this.changeCurrentCredential.bind(this),this._updateUI(!0)},resolveIcon:function(e,t){return"url("+E.getWebappsBaseUrl()+(t||"HistoryExplorer")+"/assets/icons/32/"+e+")"},buildCollectionView:function(t){var i=this,n=i.widget.getValue("lang");i.widget.hasOwnProperty("lang")&&(n=i.widget.lang),A.DEFAULT_LANGUAGE=n,Y=!1,this.isOpenWithCatiaV5Available=!0,t||(t=i.createLifecycleDiv()),S.isOpenWithCATIAV5Available((function(e){i.isOpenWithCatiaV5Available=e}));var s=e.Element("div");s.className="lifecycle-content multi",t.appendChild(s),this.multiContent=s;switch(i.multiViewType){case"Tiles":default:i.containerResponsiveThumbnailOrTile=new c(i.responsiveThumbOptions).inject(s);break;case"LargeTiles":i.containerResponsiveThumbnailOrTile=new d(i.responsiveThumbOptions).inject(s);break;case"Thumbnails":i.containerResponsiveThumbnailOrTile=new l(i.responsiveThumbOptions).inject(s)}i.containerResponsiveThumbnailOrTile.useDragAndDrop=!0,i.containerResponsiveThumbnailOrTile.onDragStartCell=function(e){var t=[];w.getSecurityContextPromise(S.getTenant()).then((function(n){for(var s=0;s<i.selectedNodesPID.length;s++){var o={envId:S.getTenant(),serviceId:i.selectedNodesObjects[s].serviceId?i.selectedNodesObjects[s].serviceId:"3DSpace",contextId:n,objectId:i.selectedNodesObjects[s].physicalid,objectType:i.selectedNodesObjects[s].type,displayName:i.selectedNodesObjects[s].displayName,session_object:!1};t.push(o)}var a={protocol:"3DXContent",version:"1.0",source:"ENOSTDE_AP",data:{items:t}};try{e.dataTransfer.setData("Text",JSON.stringify(a)),console.log(e)}catch(t){e.dataTransfer.setData("Text",JSON.stringify(a)),console.log(e)}}))},i.containerResponsiveThumbnailOrTile.onSelectionAdd((function(e){i.addSelectedNode(e),i.dispatchEvent("objectSelectionChanged",{})})),i.containerResponsiveThumbnailOrTile.onSelectionRemove((function(e){i.removeSelectedNode(e),i.dispatchEvent("objectSelectionChanged",{})})),this.addEvent("objectSelectionChanged",(function(e){if(!0===Z._isRightOpen){Y=!0;var t=document.getElementById("slideInPropertiesContent");null!=t&&t.destroy();var i=this.selectedNodes;if(0!=i.length){var n=new W;n.buildSlideIn(i,e,Z)}}})),i.containerResponsiveThumbnailOrTile.modelProvider=new u,i.containerResponsiveThumbnailOrTile.selectionManagedByView=!0,i.containerResponsiveThumbnailOrTile.onContextualEvent={callback:function(e){return i._buildContextMenu(e)}}},_createMenuItemForSingleSelect:function(e){var t=this,i=e;return 0==e.localeCompare("Properties")&&(i="Information"),{type:"PushItem",title:H.getTitle(i),fonticon:H.getFontIcon(i),action:{callback:function(i){var n=[{physicalid:t.containerResponsiveThumbnailOrTile.activeNode._attributes.physicalid,id:t.containerResponsiveThumbnailOrTile.activeNode._attributes.physicalid,displayName:t.containerResponsiveThumbnailOrTile.activeNode._attributes.label,revision:t.containerResponsiveThumbnailOrTile.activeNode._attributes.subLabel,name:t.containerResponsiveThumbnailOrTile.activeNode._attributes.label,type:t.containerResponsiveThumbnailOrTile.activeNode._attributes.type,pos:[],selectedNodes:[]}];H.runCommand(e,n,t.widget,w.getSecurityContextPromise(t.tenant))}}}},_createMenuItemForMultiSelect:function(e){var t=this;return{type:"PushItem",title:H.getTitle(e),fonticon:H.getFontIcon(e),action:{callback:function(i){for(var n=[],s=0;s<t.selectedNodesPID.length;s++){var o={physicalid:t.selectedNodesObjects[s].physicalid,id:t.selectedNodesObjects[s].physicalid,displayName:t.selectedNodesObjects[s].displayName,revision:t.selectedNodesObjects[s].revision,name:t.selectedNodesObjects[s].displayName,type:t.selectedNodesObjects[s].type,pos:[],selectedNodes:[]};n.push(o)}H.runCommand(e,n,t.widget,w.getSecurityContextPromise(t.tenant))}}}},_buildContextMenu:function(e){var t=this,i=[];if(e.menu&&e.menu.length)if(1==t.selectedNodesPID.length){i.push(t.nodesCN[0]);var n=["PreviewHdr","RevisionHdr","ReviseFromHdr","NewBranchHdr","DuplicateHdr"];n.forEach((function(e){H.checkAvailability(e,[t.containerResponsiveThumbnailOrTile.activeNode._attributes],t.widget,null)&&i.push(t._createMenuItemForSingleSelect(e))})),i.push({type:"PushItem",title:C.whereUsed,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-object-related",family:WUXManagedFontIcons.Font3DS},action:{callback:function(e){var i=require("DS/PADUtils/PADCommandProxy").create();require(["DS/PADUtils/PADUtilsServices"],(function(){let e=t.objects.find((e=>e.objectId===t.containerResponsiveThumbnailOrTile.activeNode._attributes.physicalid));var n=[];n.push({envId:e.tenant,serviceId:e.serviceId,contextId:"",objectId:t.containerResponsiveThumbnailOrTile.activeNode._attributes.physicalid,objectType:t.containerResponsiveThumbnailOrTile.activeNode._attributes.type,displayName:t.containerResponsiveThumbnailOrTile.activeNode._attributes.label});var s={protocol:"3DXContent",version:"1.0",source:"ENOLCMI_AP",data:{items:n}},o={attributes:{},paths:[],version:"1.1"};o.attributes[t.containerResponsiveThumbnailOrTile.activeNode._attributes.physicalid]={label:t.containerResponsiveThumbnailOrTile.activeNode._attributes.label,type:t.containerResponsiveThumbnailOrTile.activeNode._attributes.type},o.paths.push([t.containerResponsiveThumbnailOrTile.activeNode._attributes.physicalid]);var a=new D.Socket("compassPageSocket");a.subscribeServer("com.ds.compass",window.parent),a.dispatchEvent("onSetX3DContent",s,"compassPageSocket"),a.addListener("launchApp",(function(e){i.select(o),i.destroy(),console.log("Response = "+JSON.stringify(e))})),a.dispatchEvent("onLaunchApp",{appId:"ENORIPE_AP"},"compassPageSocket")}))}}}),(n=["DownloadHdr","Properties","DeleteHdr"]).forEach((function(e){H.checkAvailability(e,[t.containerResponsiveThumbnailOrTile.activeNode._attributes],t.widget,null)&&i.push(t._createMenuItemForSingleSelect(e))}))}else{i.push(t.nodesCN[0]);var s=function(e,n){var s=t.selectedNodesObjects.length;e.forEach((function(e){var o,a=!0;if(s>1){var r=0;for(r=0;r<s;r++)n[r]===e&&(a=!1)}for(o=0;o<s;o++)if(!H.checkAvailability(e,[t.selectedNodesObjects[o]],t.widget,null)){a=!1;break}a&&i.push(t._createMenuItemForMultiSelect(e))}))};s(["RevisionHdr","ReviseFromHdr","NewBranchHdr","DuplicateHdr"],["ReviseFromHdr"]),t.isCID(t.selectedNodesObjects)||i.push({type:"PushItem",title:C.whereUsed,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-object-related",family:WUXManagedFontIcons.Font3DS},action:{callback:function(e){var i=require("DS/PADUtils/PADCommandProxy").create();require(["DS/PADUtils/PADUtilsServices"],(function(e){for(var n=[],s=0;s<t.selectedNodesPID.length;s++){var o={envId:"",serviceId:"",contextId:"",objectId:t.selectedNodesObjects[s].physicalid,objectType:t.selectedNodesObjects[s].type,displayName:t.selectedNodesObjects[s].displayName};n.push(o)}var a={protocol:"3DXContent",version:"1.0",source:"ENOLCMI_AP",data:{items:n}},r=[],l={attributes:{},paths:[],version:"1.1"};for(s=0;s<t.selectedNodesPID.length;s++)l.attributes[t.selectedNodesObjects[s].physicalid]={label:t.selectedNodesObjects[s].displayName,type:t.selectedNodesObjects[s].type},l.paths.push([t.selectedNodesObjects[s].physicalid]),r.push(l);var c=new D.Socket("compassPageSocket");c.subscribeServer("com.ds.compass",window.parent),c.dispatchEvent("onSetX3DContent",a,"compassPageSocket"),c.addListener("launchApp",(function(e){i.select(l),i.destroy(),console.log("Response = "+JSON.stringify(e))})),c.dispatchEvent("onLaunchApp",{appId:"ENORIPE_AP"},"compassPageSocket")}))}}}),s(["DownloadHdr"],["ReviseFromHdr"]),i.push({type:"PushItem",title:H.getTitle("Properties"),fonticon:H.getFontIcon("Properties"),action:{callback:function(e){for(var i=[],n=0;n<t.selectedNodesPID.length;n++){var s={getID:function(){return n-=1,t.selectedNodesPID[n]}};i.push(s)}var o={_context:w.getSecurityContextPromise(t.tenant),mergeSupport:!0,_selection:i,getSecurityContext:function(){return this._context},getSelectedNodes:function(){return this._selection},displayNotification:function(){}};require(["DS/LifecycleControls/EditPropDialog"],(function(e){(new e).launchProperties(o)}))}}}),s(["DeleteHdr"],["ReviseFromHdr"])}return i},runDeleteCommand:function(){var e=this,t=e.createContextMenuData(e.selectedNodesPID,e.selectedNodesObjects);H.runCommand("DeleteHdr",t,e.widget,w.getSecurityContextPromise(e.tenant))},createContextMenuData:function(e,t){for(var i=[],n=0;n<e.length;n++){var s=this.createContextMenuNode(t[n]);i.push(s)}return i},createContextMenuNode:function(e){var t="",i="",n="",s="",o="";if("options"in e){var a=e.options;"ds6w:status"in a&&(t=a["ds6w:status"]),"ds6w:type"in a&&(n=a["ds6w:type"]),"icons"in a&&(i=a.icons[0]),"ds6w:reserved"in a&&(s=a["ds6w:reserved"]),o="ds6w:reservedBy"in a?a["ds6w:reservedBy"]:e.reservedby}return o&&!s&&(s=!0),{physicalid:e.physicalid,id:e.physicalid,displayName:e.displayName,revision:e.revision,name:e.displayName,type:e.type,"ds6w:type":n,"ds6w:status":t,icon:i,pos:[],selectedNodes:[],"ds6w:reserved":s,"ds6w:reservedBy":o,policy:e.policy,current:e.current}},doPickContext:function(e,t){var i=this;if(this._getParentContainer=function(){return this.parentWidget?this.parentWidget:this.widget},1==i.options.wintop){i._doPickContext(e,t,undefined)}else{!0===i.isMultiView()&&w.getSecurityContextPromise(S.getTenant()).then((function(n){i._doPickContextWithOpen(n,e,t,S.getTenant())}),(function(e){console.error("_displayOpen",e)}))}},_doPickContextWithOpen:function(t,i,n,s,o,a,r){var l=this;if(!(l.selectedNodesPID.length<1)){for(var c=[],d=0;d<l.selectedNodesPID.length;d++){var u={envId:s,serviceId:"3DSpace",contextId:t,objectId:l.selectedNodesObjects[d].physicalid,objectType:l.selectedNodesObjects[d].type,pos:[],selectedNodes:[],displayName:l.selectedNodesObjects[d].displayName,"ds6w:kind":l.selectedNodesObjects[d]["ds6w:kind"]};c.push(u)}var h=[],p={protocol:"3DXContent",version:"1.0",source:"ENOLCMI_AP",data:{items:c}},m=new B;m.set3DXContent(p,!1),e.is(m.retrieveCompatibleApps,"function")&&m.retrieveCompatibleApps((function(e){e.forEach((function(e){h.push({type:"PushItem",title:e.text,fonticon:void 0!==e.fonticon&&null!==e.fonticon&&e.fonticon.length>0?{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon,family:WUXManagedFontIcons.Font3DS}:void 0,icon:void 0!==e.icon&&null!==e.icon&&e.icon.length>0?e.icon:"",action:{callback:e.handler}})})),0===h.length&&h.push({type:"PushItem",title:"CATIA V5",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-play",family:WUXManagedFontIcons.Font3DS},action:{callback:null}}),l._doPickContext(t,i,n,h)}))}},_doPickContext:function(t,i,n,s){this.nodesCN=[];var o=this,a=this,r=[];E.getWebappsBaseUrl();this.objectIds=[],this.selected_objects={version:"1",structures:{references:[],connections:[],trees:{}}},this.selectedItems=[];var l={attributes:{},paths:[],version:"1.1"};this.selected_nodes=[];for(var c=0;c<o.selectedNodesPID.length;c++){var d={physicalid:o.selectedNodesObjects[c].physicalid,id:o.selectedNodesObjects[c].physicalid,displayName:o.selectedNodesObjects[c].displayName,revision:o.selectedNodesObjects[c].revision,name:o.selectedNodesObjects[c].displayName,type:o.selectedNodesObjects[c].type,pos:[],selectedNodes:[]},u={objectId:o.selectedNodesObjects[c].physicalid,envId:S.getTenant(),contextId:t};o.selected_nodes.push(u),this.selected_objects.structures.references.push({localid:c,physicalid:o.selectedNodesObjects[c].physicalid,type:"CATProduct"}),this.selected_objects.structures.trees[c]={selected:!0},this.selectedItems.push(l),this.objectIds.push(d)}if(r.push({label:C.whereUsed,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-object-related",family:WUXManagedFontIcons.Font3DS},callback:function(){var e=require("DS/PADUtils/PADCommandProxy").create();require(["DS/PADUtils/PADUtilsServices"],(function(t){var i={protocol:"3DXContent",version:"1.0",source:"ENOLCMI_AP",data:{items:this.objectIds}},n=new D.Socket("compassPageSocket");n.subscribeServer("com.ds.compass",window.parent),n.dispatchEvent("onSetX3DContent",i,"compassPageSocket"),n.addListener("launchApp",(function(t){e.select(o.selectedItems),e.destroy(),console.log("Response = "+JSON.stringify(t))})),n.dispatchEvent("onLaunchApp",{appId:"ENORIPE_AP"},"compassPageSocket")}))}}),this._displayOpen(a,s)){var h={title:C.OpenWith,label:C.OpenWith,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-open-menu-dot",family:WUXManagedFontIcons.Font3DS},type:ie,callback:null,submenu:s};r.push(h)}for(var p=!1,m=[],f=(r=["OpenWith"].map((function(e){return"|"===e?{type:useNewMenu?"SeparatorItem":"separator"}:r.find((function(t){return C[e]===t.label}))})).filter((function(e){return e}))).length,g=0;g<f;g++)if("SeparatorItem"===r[g].type||"separator"===r[g].type){if(0===m.length||!0===p)continue;m.push(r[g]),p=!0}else m.push(r[g]),p=!1;r=(r=m).map((function(t){return"string"==typeof t.type?t:e.extend(t,{title:t.label,type:ie,action:{this:a,callback:t.callback}})}));this.nodesCN=r},_displayOpen:function(e,t){try{return!(!Array.isArray(t)||0==t.length)&&!e.options.wintop}catch(e){return!1}},replaceModelObject:function(e,t,i){var n=this.containerResponsiveThumbnailOrTile.model[t];this.updateModelObject(e,i,n)},removeModelObjects:function(e,t){var i=this;if(i.containerResponsiveThumbnailOrTile){var n,s=t.length,o=[];for(n=0;n<s;n++)o.push(i.model._models[t[n]]);var a={};i.model.remove(o,a);a={updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1};i.containerResponsiveThumbnailOrTile.invalidateLayout(a)}},updateModelObject:function(e,t,i){var n=e.options.icons[1];n&&n.startsWith("/")&&(n=t+n);var s,o=e.options.icons[0];o&&o.startsWith("/")&&(o=t+o),s=e["attribute[PLMEntity.V_Name]"]&&e["attribute[PLMEntity.V_Name]"].length>0?e["attribute[PLMEntity.V_Name]"]:e["attribute[DOCUMENTS.Title]"]&&e["attribute[DOCUMENTS.Title]"].length>0?e["attribute[DOCUMENTS.Title]"]:e["attribute[Title]"]&&e["attribute[Title]"].length>0?e["attribute[Title]"]:e.name;var a="",r="";null!=e.options&&null!=e.options&&null!=e.options["ds6w:type"]&&null!=e.options["ds6w:type"]&&(r=e.options["ds6w:type"]),""!=r&&(a=r);var l="";null!=e.revision&&null!=e.revision&&(l=e.revision),""!=l&&(a=a+"|"+l);var c="";null!=e.options&&null!=e.options&&null!=e.options["ds6w:status"]&&null!=e.options["ds6w:status"]&&(c=e.options["ds6w:status"]),""!=c&&(a=a+"|"+c);var d="";null!=e.ownerFullName&&null!=e.ownerFullName&&(d=e.ownerFullName),""!=d&&(a=a+"|"+d);var u="";null!=e[ee]&&null!=e[ee]&&(u=e[ee]),""!=u&&(a=a+"|"+u);var h={physicalid:e.physicalid,label:s,subLabel:a,picture:n,icon:o,type:e.type,multipleTitleLineNumber:!1,ownerFullName:e.ownerFullName,contextualMenu:["Properties","RevisionHdr","ReviseFromHdr","NewBranchHdr","DuplicateHdr","DeleteHdr"],activeFlag:!1};i.set(h)},addModelObject:function(e,t){var i=this,n=i.buildModelObject(e,t),s=[];s.push(n),i.model.push(s);var o=i.model.length-1,a=i.model._models;i.modelPIDs.push(a[o]._attributes.physicalid)},buildModelObject:function(e,t){var i,n;e.options&&e.options.icons&&((i=e.options.icons[1])&&i.startsWith("/")&&(i=t+i),(n=e.options.icons[0])&&n.startsWith("/")&&(n=t+n));var s=e.displayName,o="",a="";e.options&&(void 0!==e.options["ds6w:status"]&&(a=e.options["ds6w:status"]),void 0!==e.options["ds6w:type"]&&(o=e.options["ds6w:type"]));var r="";e.revision&&(r=e.revision);var l="";e.ownerFullName&&(l=e.ownerFullName);var c="";e[ee]&&(c=e[ee]);var d=o+"|"+r+"|"+a+"|"+l+"|"+c;return new p({physicalid:e.physicalid,label:s,subLabel:d,picture:i,icon:n,type:e.type,multipleTitleLineNumber:!1,ownerFullName:e.ownerFullName,contextualMenu:["Properties","RevisionHdr","ReviseFromHdr","NewBranchHdr","DuplicateHdr","DeleteHdr"],activeFlag:!1})},buildModel:function(e,t){var i,n=this;n.isMultiView();this.revisionsHistoryWidget&&(this.revisionsHistoryWidget.destroy(),this.revisionsHistoryWidget=null,this.externalRefresh&&(this.externalRefresh.done(),this.externalRefresh=null)),this.maturityWidget&&(this.maturityWidget.destroy(),this.maturityWidget=null);var s=[],o=t,a=e.length;1===a&&(o=[].concat(e,t));var r=o.length,l=S.get3DSpaceBaseUrl(n.tenant);for(i=0;i<r;i++){var c=this.buildModelObject(o[i],l);s.push(c)}a<=1&&n.model.reset(),n.model.push(s),n.containerResponsiveThumbnailOrTile&&n.containerResponsiveThumbnailOrTile.loadApplicativeModel(n.model);var d,u=n.model._models,h=u.length;for(n.modelPIDs=[],d=0;d<h;d++)n.modelPIDs.push(u[d]._attributes.physicalid);var p=a+r;if(h!==p&&(p=h),h>a)for(d=a;d<p;d++)n.modelPIDs[d]},buildSingleObjectView:function(t){var i=this;t||(t=i.createLifecycleDiv()),t.style.display="grid";var n=document.createElement("div");n.className="lifecycle-container",t.appendChild(n);var o=document.createElement("div");o.className="lifecycle-container-maturity",n.appendChild(o);var a=document.createElement("div");a.className="lifecycle-header maturity";var l=document.createElement("div");l.className="lifecycle-expand",a.appendChild(l),a.addEventListener("click",(function(e){var t=document.querySelector("div.lifecycle-content.maturity");"none"===t.style.display?(t.style.display="block",l.className=l.className.replace(" no","")):(t.style.display="none",l.className=l.className+" no")})),o.appendChild(a);var c=document.createTextNode("Maturity Graph");a.appendChild(c);var d=e.Element("div");d.className="lifecycle-content maturity",o.appendChild(d),this.maturityWidget=new s({context:i,type:"lifecycleWidget"}),this.maturityWidget.inject(d);var u=document.createElement("div");u.className="lifecycle-container-revision",n.appendChild(u);var h=document.createElement("div");h.className="lifecycle-header revision";var p=document.createElement("div");p.className="lifecycle-expand",h.appendChild(p),h.addEventListener("click",(function(e){var t=document.querySelector("div.lifecycle-content.revision");"none"===t.style.display?(t.style.display="block",p.className=p.className.replace(" no","")):(t.style.display="none",p.className=p.className+" no")})),u.appendChild(h);var m=document.createTextNode("History Explorer");h.appendChild(m);var f=document.createElement("div");f.className="lifecycle-content revision",u.appendChild(f);var g=this,y={setObjects:function(e,t,i,n=!1){g.setObjectsWithExceptions(e,t,i,n)},setTitleFromObject:function(e){g.setTitleFromObject(e)},onDropEvent:function(e){}};this.revisionsHistoryWidget=new r(this,this.widget,this.parentWidget,{wintop:!1,disableMaturityButton:!0},y);var v={load:function(e){!i.isMultiView()&&"Duplicate"==e.operation&&"created"==e.eventType&&e.sourceObjectId&&(e.physicalid=e.sourceObjectId),g.setObjectsWithExceptions([e],!1,!1)},clear:function(){g.empty()}};this.externalRefresh?this.externalRefresh.resetViews(this.revisionsHistoryWidget.revisionFamily):this.externalRefresh=new j(this.revisionsHistoryWidget.revisionFamily,v),this.revisionsHistoryWidget.inject(f),this.widget.onResize=function(){i.revisionsHistoryWidget&&i.revisionsHistoryWidget.revisionFamily&&i.revisionsHistoryWidget.revisionFamily.onResize()},this.revisionsHistoryWidget.revisionFamily.versionExplorer.addEventListener("ENOXVersionExplorerLoadCompleted",(function(){o.scrollIntoView();var e=i.revisionsHistoryWidget.revisionFamily.versionExplorer.getObjects(),t=document.querySelector(".subway-edge-view"),n=document.querySelector(".versionexplorer-toolbar"),s=document.querySelector(".wux-layouts-gridengine-columns-header-container");if(null!=s){var a=s.getBoundingClientRect().height,r="30";null!=t&&(r=t.getBoundingClientRect().height+15);var l=a+n.getBoundingClientRect().height+r*e.length+40;f.style.height=l+"px";for(var c=document.getElementsByClassName("wux-ui-state-focused"),d=0;d<c.length;d++)c[d].addEventListener("focus",(function(e){o.scrollIntoView()}))}}),!1),this.revisionsHistoryWidget.revisionFamily.versionExplorer.addEventListener("_ENOXVersionExplorerInternalRefreshCompleted",(function(){o.scrollIntoView()}),!1),this.revisionsHistoryWidget.revisionFamily.versionExplorer.addEventListener("_ENOXVersionExplorerViewChanged",(function(){o.scrollIntoView()}),!1);var b=i.widget.getValue("lang");i.widget.hasOwnProperty("lang")&&(b=i.widget.lang),A.DEFAULT_LANGUAGE=b},trackAppContent:function(){var e="EmptyView";this.objects.length>0&&(e=this.isMultiView()?"ListView":"ObjectView");var t={UXName:"CollaborativeLifecycle",models:this.objects,UXMode:e};this.trackerEvent=z.createInitActionEvent(t,this.trackerEvent),z.checkAndTrackPageEvent(this.trackerEvent)},showBusy:function(t){null!=t&&m.mask(e.extendElement(t))},showNotBusy:function(t){null!=t&&m.isMasked(e.extendElement(t))&&m.unmask(e.extendElement(t))}})}));