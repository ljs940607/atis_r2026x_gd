define("DS/3DPlayReviewExperience/3DPlayReviewExperience",["DS/Selection/PSOManager","DS/3DPlayExperienceModule/PlayExperience3D","DS/Visualization/ThreeJS_DS","DS/DMUReadPersistence/DMULoadMarkupServices","DS/DMUBaseUIServices/DMUSlidePreferences","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMU2DSheetManager","DS/DMUBaseExperience/EXPManagerSet","DS/DMUPlaySlide/controllers/DMUSlideShowController","DS/CATWebUXComponents/DMUCommandsManager","DS/DMUReadPersistence/DMUReviewPersistenceServicesSetting","DS/DMUBaseUIControllers/DMUReviewContextInitializer","DS/DMUBaseUIControllers/DMUSlidesController","DS/DMUBaseUIControllers/DMUCommentsController","DS/DMUBaseUIControllers/DMUApplicativeContextManager","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/CATWebUXSelectionManager/CATWebUXSelectionManager","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/CATWebUXComponents/CATWebUXUtils","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/PADUtils/views/PADProgressBar","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUReadPersistence/DMULoadingContextController","DS/3DPlay/3DPlay","DS/DMUBaseUIWafrComponents/DMUApplicativeManagerComponent","i18n!DS/3DPlayReviewExperience/assets/nls/3DPlayReviewExperience"],(function(e,t,n,i,r,a,o,l,s,c,d,p,g,D,u,m,C,f,h,w,P,v,S,V,y,x,M){"use strict";var R;return t.extend({init:function(t){var R,b,A,U,I,E,T,k,F,W,B=!1,L=this,_=!0,X={},O="";let N,H,G,j,q,z=null,J=!1,K="Perspective",Q=!1,Y=!1,Z="selectParentReference";function $(){(W=C.getSelectionManager({context:L.pad3DViewer})).setActiveState(!0),(F=m.getPreferenceManager({context:L.pad3DViewer.getFrameWindow()}))&&(F.setUnitsPreferencesDisplayFlag(!0),F.setDisplayPreferencesDisplayFlag(!0),F.set3DSelectionPreferencesDisplayFlag(!0),F.set2DSelectionPreferencesDisplayFlag(!0),F.setMeasurePreferencesDisplayFlag(!0),F.setClippingPreferencesDisplayFlag(!0),F.addPreferences([{nls:M.preferences.markupSectionTitle,id:"MarkupPreferences",type:"section",preferences:[{nls:M.preferences.SlideTitleDisplayLbl,id:"DisplaySlideTitle",type:"checkbox",getValue:function(){return"true"===localStorage.getItem("CATWebUXMePreferences_DisplaySlideTitle")},getDefaultValue:function(){return!1},setValue:function(e){e!==("true"===localStorage.getItem("CATWebUXMePreferences_DisplaySlideTitle"))&&localStorage.setItem("CATWebUXMePreferences_DisplaySlideTitle",e?"true":"false")}}]},{nls:M.preferences.compareSectionTitle,id:"ComparePreferences",type:"section",preferences:[{nls:M.preferences.firstProductColor,id:"CompareFirstColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_CompareFirstColor")?localStorage.getItem("CATWebUXMePreferences_CompareFirstColor"):"#CC092F"},getDefaultValue:function(){return"#CC092F"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_CompareFirstColor",e)}},{nls:M.preferences.secondProductColor,id:"CompareSecondColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_CompareSecondColor")?localStorage.getItem("CATWebUXMePreferences_CompareSecondColor"):"#6FBC4B"},getDefaultValue:function(){return"#6FBC4B"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_CompareSecondColor",e)}},{nls:M.preferences.compare3DCommonColor,id:"Compare3DCommonColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_Compare3DCommonColor")?localStorage.getItem("CATWebUXMePreferences_Compare3DCommonColor"):"#D3D3D3"},getDefaultValue:function(){return"#D3D3D3"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_Compare3DCommonColor",e)}},{nls:M.preferences.compare2DCommonColor,id:"Compare2DCommonColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_Compare2DCommonColor")?localStorage.getItem("CATWebUXMePreferences_Compare2DCommonColor"):"#000000"},getDefaultValue:function(){return"#000000"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_Compare2DCommonColor",e)}}]}]),F.setPreferredPreferenceContainersOrder(["MarkupPreferences","MeasurePreferences","SectionPreferences","ComparePreferences"]),j=F.subscribe("com.ds.mep:onPrefUpdate",(function(e){let t=JSON.parse(e[1].preferences);for(let e=0;e<t.repositories.length;e++)for(let n=0;n<t.repositories[e].preferences.length;n++)"SelectParentReferenceOr3DShape"===t.repositories[e].preferences[n].name?(Z=t.repositories[e].preferences[n].value,W&&W.selectParentReference("select3DShape"!==Z)):"Select3DGeometry"===t.repositories[e].preferences[n].name?(Q="true"===t.repositories[e].preferences[n].value,W&&W.setPicking(Q?0:1)):"Select2DGeometry"===t.repositories[e].preferences[n].name?(Y="true"===t.repositories[e].preferences[n].value,W&&L.pad3DViewer.getViewer().get2DMode()&&W.setPicking(Y?0:1)):"ProjectionType"===t.repositories[e].preferences[n].name?(K=t.repositories[e].preferences[n].value,L.pad3DViewer&&L.pad3DViewer.getViewer()&&L.pad3DViewer.getViewer().currentViewpoint&&L.pad3DViewer.getViewer().currentViewpoint.setProjectionType("Perspective"===K?0:1)):"Gravity"===t.repositories[e].preferences[n].name&&(J="true"===t.repositories[e].preferences[n].value,L.pad3DViewer&&L.pad3DViewer.getViewer()&&L.pad3DViewer.getViewer().currentViewpoint&&L.pad3DViewer.getViewer().currentViewpoint.control&&(L.pad3DViewer.getViewer().currentViewpoint.getControl().setRotationRolling(!J),L.pad3DViewer.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!J)))})),f.readPreferences([{Repository:"VisualizationRepository",PreferenceNames:["Gravity"]},{Repository:"FrameGeneral",PreferenceNames:["ProjectionType"]},{Repository:"SelectionRepository",PreferenceNames:["Select3DGeometry","SelectParentReferenceOr3DShape","Select2DGeometry"]}]).then((e=>{let t=e.repositories;for(let e=0;e<t.length;e++)if("VisualizationRepository"===t[e].name)J="true"===t[e].preferences[0].value;else if("FrameGeneral"===t[e].name)K=t[e].preferences[0].value;else if("SelectionRepository"===t[e].name){let n=t[e].preferences;for(let e=0;e<n.length;e++)"Select3DGeometry"===n[e].name?Q="true"===n[e].value:"Select2DGeometry"===n[e].name?Y=n[e].value:"SelectParentReferenceOr3DShape"===n[e].name&&(Z=n[e].value)}L.pad3DViewer.getViewer().get2DMode()?W&&W.setPicking(Y?0:1):("boolean"==typeof J&&(L.pad3DViewer.getViewer().currentViewpoint.getControl().setRotationRolling(!J),L.pad3DViewer.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!J)),"Perspective"!==K&&"Parallel"!==K||L.pad3DViewer.getViewer().currentViewpoint.setProjectionType("Perspective"===K?0:1),W&&W.setPicking(Q?0:1),W&&W.selectParentReference("select3DShape"!==Z))})).catch((e=>{L.pad3DViewer.getViewer().get2DMode()?(W&&W.setPicking(Y?0:1),window.console.warn("Could not get server value, default value set instead.",e)):("boolean"==typeof J&&(L.pad3DViewer.getViewer().currentViewpoint.getControl().setRotationRolling(!J),L.pad3DViewer.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!J)),"Perspective"!==K&&"Parallel"!==K||L.pad3DViewer.getViewer().currentViewpoint.setProjectionType("Perspective"===K?0:1),W&&W.setPicking(Q?0:1),W&&W.selectParentReference("select3DShape"!==Z),window.console.warn("Could not get server value, default value set instead.",e))}))),E||(E=new s({context:L.pad3DViewer})).subscribe("onActiveStateModified",(function(e){_=!e.state}))}function ee(e){var t={lastCommand:[],currentCommand:null,defaultCommand:null},n=L.pad3DViewer.getCommandContext();n?c._commandsState[n]=t:c._commandsState=t,c.resetDefaultCommand(n),c._isCommandEnding=!1,c._ignoreCommandBeginWhileEndingCommand=!1,["_commands","_cmdCheckHeader"].forEach((function(e){var t=n&&c[e]?c[e][n]:c[e];t&&Object.keys(t).forEach((function(e){var n=t[e];n&&n._destroy&&n._destroy(),delete t[e]}))}));var i=L.pad3DViewer.getFrameWindow().getActionBar(),r=i.onActionBarReady((function(){i.removeCallback(r),setTimeout(e.actionBarReadyCb,500)}));L.pad3DViewer.loadActionBar({file:e.file,module:e.module})}function te(e,t){var n=function(){if(L.pad3DViewer){var e=c.getCommandCheckHeader("WebDocumentBookmarksPanelCmdHdr",L.pad3DViewer.getCommandContext());if(e){let n=localStorage.getItem("DMUBookmarksPanelDisplayed");"true"!==n&&("false"===n||"Requirement"!==t&&"Requirement Specification"!==t)||e.setState(!0),A&&A.documentHasBookmarks()?e.enable():e.disable()}(e=c.getCommand("WebDocumentRotatePagesLeftCmdHdr",L.pad3DViewer.getCommandContext()))&&(A&&"Document"===A.getDocumentType()?e.enable():e.disable()),(e=c.getCommand("WebDocumentRotatePagesRightCmdHdr",L.pad3DViewer.getCommandContext()))&&(A&&"Document"===A.getDocumentType()?e.enable():e.disable()),(e=c.getCommand("DMUNextCommentCmdHdr",L.pad3DViewer.getCommandContext()))&&(k&&k.hasComments()?e.enable():e.disable()),(e=c.getCommand("DMUPreviousCommentCmdHdr",L.pad3DViewer.getCommandContext()))&&(k&&k.hasComments()?e.enable():e.disable());let l,s=a.getReviewContext({context:L.pad3DViewer}),d=s&&s.getCurrentSessionMarkup()||null,p=void 0!==R?JSON.parse(R):void 0;p&&p.asset&&p.asset.Play3DXContent&&p.asset.Play3DXContent.data&&p.asset.Play3DXContent.data.items[0]&&(l=p.asset.Play3DXContent.data.items[0].currentSlideId);var n=g.giveDMUSlidesController({context:L.frmWindow});if(d&&(!A||!A.isRunning()&&!A.isADocumentDisplayed())){var i=d.getSlides();!1===(l&&i.some((e=>e.getAttribute("sID")===l)))&&(l=void 0);var r=l||d.getAttribute("sCurrentSlideId");if(L.autoReframe=!1,n)if("string"==typeof r){for(var o=0;o<i.length;o++)if(i[o].getAttribute("sID")===r){n.setActiveSlide(i[o]);break}}else i.length&&n.setActiveSlide(i[0])}n&&n.updateHeaderCommandsAvailability(),k&&k.updateHeaderCommandsAvailability()}};O!==e?("ITF"===e?ee({file:"3DPlayReviewITFExperience.xml",module:"3DPlayReviewExperience",actionBarReadyCb:n}):"Document"===e?ee({file:"3DPlayReviewDocumentExperience.xml",module:"3DPlayReviewExperience",actionBarReadyCb:n}):"3D"===e?ee({file:"3DPlayReviewExperience.xml",module:"3DPlayReviewExperience",actionBarReadyCb:n}):"2D"===e?ee({file:"3DPlayReviewDrawingExperience.xml",module:"3DPlayReviewExperience",actionBarReadyCb:n}):"MSR"===e?ee({file:"3DPlayReviewMSRExperience.xml",module:"3DPlayReviewExperience",actionBarReadyCb:n}):"2DTable"===e&&ee({file:"3DPlayReviewFMEAExperience.xml",module:"3DPlayReviewExperience",actionBarReadyCb:n}),O=e):n()}function ne(e){b||(b=u.getDMUApplicativeContextManager({context:L.pad3DViewer})).initApplicativeContainer(e,{onReady:function(e){e&&e.length&&e.forEach((function(e){"POI"!==e.getApplicativeContainerID()&&e.setActiveState(!0)}))}})}function ie(e){A&&A.load2DDocument({phyID:e.phyID,serverUrl:w.get3DSpaceUrl(),securityContext:P.getSetting("pad_security_ctx"),dataType:e.dataType,is2DCompareActive:N,parentNode:L.pad3DViewer.getRootBagPath().getChildrenPathes()[L.pad3DViewer.getRootBagPath().getChildrenPathes().length-1].getLastElement(!0),onLoadingStarted:e.onLoadingStarted,onComplete:e.onComplete,onFailure:e.onFailure})}d.doInitialize(),this.getSlideIDToActivate=function(e){let t;if(e){var n=e.getLoadedRepRefs();return n.length>0&&n[0].getMarkupContent()&&n[0].getMarkupContent().getSlides()&&n[0].getMarkupContent().getSlides().length&&(t=n[0].getMarkupContent().getSlides()[0].getAttribute("sUuid")),t}},this.setReviewData=e=>{R=JSON.stringify(e)},this.internalLoad=function(e,t){if(a.removeReviewContext({context:L.pad3DViewer}),!e)return;R=JSON.stringify(e);var n=e.asset.physicalid;let s;if(e.asset&&e.asset.physicalid){var c=e.asset;let d,u;c.reviewId=e.asset.physicalid,c.context=L.pad3DViewer,e.asset.Play3DXContent&&e.asset.Play3DXContent.data&&e.asset.Play3DXContent.data.items&&e.asset.Play3DXContent.data.items.length>0&&(c.commentId=e.asset.Play3DXContent.data.items[0]?e.asset.Play3DXContent.data.items[0].commentId:null,s=e.asset.Play3DXContent.data.items[0].currentSlideId);let m,C=[],f=[],h=function(){if(d&&u&&C.length&&m){T||(T=g.giveDMUSlidesController({context:L.frmWindow}));let r,o=function(e,t){var n=a.giveEventsController({viewer:L.pad3DViewer.getViewer()});if(n){let i=n.addEvent("on2DDocumentLoadSuccess",(function(){k&&k.applyComment({commentId:t,markupId:e}),n.removeEvent(i)}))}};m&&s&&C?.forEach((e=>{e.getAttribute("sID")===s&&(r=e)})),r&&(m=r.getAttribute("sUuid"));for(var e=0;e<C.length;e++){let r=null;for(var t=0;t<f.length;t++)f[t].getAttribute("sPresentationSlideID")===C[e].getAttribute("sUuid")&&((i={highlight:f[t],slide:C[e]})&&i.slide&&i.slide.addAssociatedHighlightData&&i.highlight&&i.slide.addAssociatedHighlightData({id:i.highlight.getPlmID(),rating:i.highlight.getRating(),hasIssue:Boolean(i.highlight._lIssuesIDs.length),hasTask:Boolean(i.highlight._lTasksIDs.length),hasImpactedChecks:Boolean((i.highlight.getAssociatedCheck()||[]).length)}),C[e].getAttribute("sUuid")===m&&(r=f[t]));if(C[e].getAttribute("sUuid")===m)if(L.autoReframe=!1,"DMUSlide"===C[e].getType())T&&T.setActiveSlide(C[e]);else if("DMUComment"===C[e].getType()){var n=C[e].getAttribute("sUuid");if(r)o(r.getAttribute("sRepRefMarkupID"),n)}}}var i};c.cbRootAdded=function(){let e=a.giveEventsController({viewer:L.pad3DViewer.getViewer()}),t=e.addEvent("onDXFLoadSuccess",(function(){te("2D"),e.removeEvent(t)}));var n;d=!0,L.pad3DViewer.getRootBagPath().getChildrenPathes()[0]&&(n=S.getNodeType(L.pad3DViewer.getRootBagPath().getChildrenPathes()[0].getLastElement(!0)));var i=L.pad3DViewer.getApplicativeData().getLoadedItfData&&L.pad3DViewer.getApplicativeData().getLoadedItfData().data.length?"ITF":"Drawing"===n||"DIFLayout"===n||"DIFSheet"===n?"2D":"FailureModesEffectsAnalysis"===n?"2DTable":"Document"===n||"Specification Report"===n||"Requirement"===n||"Requirement Specification"===n?"Document":"DesignSight"===n?"MSR":"3D";if(!U||"DXF"!==U.getLoadMarkupCtxType()&&"DWG"!==U.getLoadMarkupCtxType()||(i="2D"),ne(i),te(i,n),"Drawing"===n){let e=S.getNodeID(L.pad3DViewer.getRootBagPath().getChildrenPathes()[0].getLastElement(!0)),t=0;ie({phyID:e,dataType:n,onLoadingStarted:function(){t++,1===t&&v.on()},onComplete:function(){N=!0,t--,t<=0&&(v.off(),t=0)},onFailure:function(){N=!0,L.pad3DViewer.removeRoots({pids:[e]}),t--,t<=0&&(v.off(),t=0)}}),H||(H=L.pad3DViewer.subscribe({event:"onRootAdded"},(function(n){ie({phyID:n.id,dataType:S.getNodeType(n.path.getLastElement(!0)),onLoadingStarted:function(){t++,1===t&&v.on()},onComplete:function(){t--,t<=0&&(v.off(),t=0)},onFailure:function(){L.pad3DViewer.removeRoots({pids:[e]}),t--,t<=0&&(v.off(),t=0)}})}))),G||(G=L.pad3DViewer.subscribe({event:"onRootRemoved"},(function(e){A&&A.clean2DDocument(e)})))}if("Document"===i&&(L.pad3DViewer.getViewpoint().setDefaultController(!0,"CATIA"),k||(k=D.giveDMUCommentsController({context:L.frmWindow,commandContext:L.pad3DViewer.getCommandContext()})),A&&!A.isADocumentDisplayed())){let t=e.addEvent("on2DDocumentLoadSuccess",(()=>{e.removeEvent(t),te(i,n)}))}$(),B||(r.setSlidePreferences({context:L.frmWindow,preferences:{playMode:!0,displayNominal:!1}}),B=!0),h()},c.cbOK=async function(){if(u=!0,!T||t){var e,i=await p.createReviewContext({context:L.pad3DViewer}),r=i.getValidation();let t=r.getHighlights();if(t&&t.length)for(e=0;e<t.length;e++)f.push(t[e]);if(i.getCurrentSessionMarkup()){if(r=i.getValidation()){var o=r.getLoadedRepRefs();for(e=0;e<o.length;e++)if(o[e].getMarkupContent()){C=C.concat(o[e].getMarkupContent().getSlides());for(let t=0;t<o[e].getMarkupContent().getSlides().length;t++){var l=o[e].getMarkupContent().getSlides()[t].getDMUObjects();for(let e=0;e<l.length;e++)l[e].getDMUComments&&(C=C.concat(l[e].getDMUComments()))}}}m=L.getSlideIDToActivate(r,n),h()}}let s=a.giveEventsController({viewer:L.pad3DViewer.getViewer()});s&&(q=s.addEvent("onDMUReviewRefreshRequest",(function(){L.internalRefresh()})),z=s.addEvent("onIssueOrCaSelected",(function(e){var t=e,n={mode:"shared",isAsynchronous:!0};require(["DS/ENOCollabSharingCmds/commands/EditPropCmd/EditPropCmdBase"],(function(e){(new e).launchProperties({options:n,getSecurityContext:function(){return{SecurityContext:P.getSetting("pad_security_ctx"),tenant:P.getSetting("x3dPlatformId")}},getSelectedNodes:function(){return[{id:t,getID:function(){return this.id},source:"3DSpace",tenant:P.getSetting("x3dPlatformId")}]}})}))})))},c.cbFailed=function(){L.clearView()},c.cbFmeaLoaderLoaded=function(e){(I=new x({applicativeCommentControllerIDs:["FMEALoaderForDesignValidation"]})).getExecutionContext=function(){let t={getComponent:function(t){switch(t){case"FMEALoaderForDesignValidation":return e;case"Viewer":return L.pad3DViewer}}};return t},I.initialize(),L.onModelLoadingStarted(),L.onModelLoadingCompleted()},(A=l.getManager({name:"DMU2DSheetManager",context:L.frmWindow}))||(A=new o({ctxViewer:L.pad3DViewer}),l.addManager({name:"DMU2DSheetManager",context:L.frmWindow,manager:A})),U||(U=V.getLoadingContextController({context:L.pad3DViewer})),function(e){let t=i.getLoadMarkupServices(e);t&&(delete e.context,e.readOnly=!0,e.editionMode=!1,r.setSlidePreferences({context:L.pad3DViewer.getFrameWindow(),preferences:{displayNominal:!1,displayInWork:!1}}),t.loadValidation(e))}(c)}},this.internalClear=function(e){if(L.pad3DViewer&&H&&L.pad3DViewer.unsubscribe(H),H=null,L.pad3DViewer&&G&&L.pad3DViewer.unsubscribe(G),G=null,F){F.removePreferences(["MarkupPreferences"]);var t=Object.keys(X);for(let e=0;e<t.length;e++)F.unsubscribe(X[t[e]]);X={},j&&(F.unsubscribe(j),j=null)}let n=a.giveEventsController({viewer:L.pad3DViewer.getViewer()});if(n&&q&&(n.removeEvent(q),q=null),n&&z&&(n.removeEvent(z),z=null),E&&(E.clean(),E=null),e){if(l.removeManager({name:"DMU2DSheetManager",context:L.frmWindow}),m.unreferencePreferenceManager({context:L.pad3DViewer.getFrameWindow()}),F=null,L.pad3DViewer.getRootBagPath().getChildrenPathes()[0]){var i=S.getNodeID(L.pad3DViewer.getRootBagPath().getChildrenPathes()[0].getLastElement(!0));if("FailureModesEffectsAnalysis"===S.getNodeType(L.pad3DViewer.getRootBagPath().getChildrenPathes()[0].getLastElement(!0))){let e=I.getExecutionContext().getComponent("FMEALoaderForDesignValidation");e&&e.remove&&e.remove().then((()=>{let e=L.pad3DViewer.getRootBagPath().externalPath[0].path.getChildrenPathes().length;if(e){let t=L.pad3DViewer.getRootBagPath().externalPath[0].path.getChildrenPathes()[e-1].externalPath.find((e=>"RootBag"===e.name));t&&(t.removeChildren(),t.remove())}}))}else L.pad3DViewer.getController().removeRoots({pids:[i]})}C.unreferenceSelectionManager({context:L.pad3DViewer}),W=null,a.removeReviewContext({context:L.pad3DViewer}),T=k=null}N=!1,I&&(I.clean(),I.destroy(),I=null)},this.internalDispose=function(e){const t=L.pad3DViewer&&L.pad3DViewer.getCommandContext(),n=y.getExperience(t);n&&n.executeScriptingFunction("showAll"),R=null,L.frmWindow.getContextualUIManager().unregister("3DPlayReviewExperience"),r.removeSlidePreferences({context:L.frmWindow}),L.internalClear&&L.internalClear("ENOR3V_AP"!==e&&"ENOR3R_AP"!==e),B=!1},this.internalRefresh=function(){R&&(L.internalClear(!0),L.internalLoad(JSON.parse(R),!0))},this.internalPostCreate=function(){this.frmWindow.getContextualUIManager().register({subscriberId:"3DPlayReviewExperience",workbenchName:"3DPlayReviewExperience",context:L.pad3DViewer.getCommandContext(),cmdPrefix:"",fileName:"3DPlayReviewExperience.xml",module:"3DPlayReviewExperience",onContextualMenuReady:function(t,i){var r=[];if(_&&i&&i.XmousePosition){var a=new n.Vector2(i.XmousePosition,i.YmousePosition),o=L.frmWindow.getViewer().getMousePosition(a);if(0===L.frmWindow.getViewer().pick(o,"mesh",!0).path.length){var l=e.get(),s=l&&l[0]&&l[0].pathElement?l[0].pathElement.getLastElement(!0):null,c=s&&s.getDMUType?s.getDMUType():"";if("Highlights"===c||"Checks"===c)return{cmdList:r};h.isMobile()||(r=[{line:1,name:"DMU3DReviewDisplaySubMenu",resourceFile:"DMUBaseCommands/3DPlayPro",hdr_list:["VisuQMCommand"]}]),r=r.concat([{line:1,name:"DMU3DReviewAmbiencesSubMenu",resourceFile:"DMUBaseCommands/3DPlayPro",hdr_list:["VisuPureWhiteOCACmd","VisuWhiteMirrorOCACmd","VisuWhiteReviewOCACmd","VisuWhiteExperienceOCACmd","VisuStudioOCACmd","VisuDarkMirrorOCACmd","VisuDarkReviewOCACmd","VisuWhiteDesignOCACmd","VisuBlueDesignOCACmd","VisuDarkDesignOCACmd","VisuIndoorOCACmd","VisuCityOCACmd","VisuRoadOCACmd","VisuOutdoorOCACmd","VisuBasicOCACmd"]}])}}return{cmdList:r}}})},this.onLightboxReady=function(){L.lightbox.useDefaultActions(!1),L.lightbox.addAction({name:M.publishToSwym,text:M.publishToSwym,fonticon:"share-alt",handler:function(){let e=c.getCommand("DMUPublishToSwymCmdHdr",L.pad3DViewer.getCommandContext());e&&e.begin()}}),L.lightbox.addAction({name:M.information,text:M.information,fonticon:"info",handler:function(){L.lightbox._lightbox.onClickInformation().execute()}}),L.lightbox.addAction({name:M.more,text:M.more,fonticon:"chevron-down",items:[{name:M.copyScreenshot,text:M.copyScreenshot,fonticon:"copy",handler:function(){let e=c.getCommand("DMUCaptureCmdHdr",L.pad3DViewer.getCommandContext());e&&e.begin()}},{name:M.saveScreenshot,text:M.saveScreenshot,fonticon:"picture-export",handler:function(){L.lightbox._lightbox.onClickSaveScreenshot()}},{name:M.printScreenshot,text:M.printScreenshot,fonticon:"print",handler:function(){L.lightbox._lightbox.onClickPrintScreenshot()}}]})},t.commandApplication=!1,t.workbenchs=t.workbenchs||[],t.options.pad3DViewer||t.workbenchs.push({name:"3DPlayReviewExperience",module:"3DPlayReviewExperience"}),t.input.asset&&t.options.pad3DViewer&&a.getReviewContext({context:t.options.pad3DViewer})&&a.getReviewContext({context:t.options.pad3DViewer}).getValidation()&&(t.input.asset.type=a.getReviewContext({context:t.options.pad3DViewer}).getValidation()._sValType,t.input.asset.physicalid=a.getReviewContext({context:t.options.pad3DViewer}).getValidation()._sPlmID,t.input.asset.Play3DXContent.data.items[0].objectId=a.getReviewContext({context:t.options.pad3DViewer}).getValidation()._sPlmID,t.input.asset.Play3DXContent.data.items[0].objectType=a.getReviewContext({context:t.options.pad3DViewer}).getValidation()._sValType),this._parent(t),this.subscribe("ASSET/LOADINGFINISHED",(()=>{var e;$(),L.pad3DViewer.getRootBagPath().getChildrenPathes()[0]&&(e=S.getNodeType(L.pad3DViewer.getRootBagPath().getChildrenPathes()[0].getLastElement(!0)));var t=L.pad3DViewer.getApplicativeData().getLoadedItfData&&L.pad3DViewer.getApplicativeData().getLoadedItfData().data.length?"ITF":"Drawing"===e||"DIFLayout"===e||"DIFSheet"===e?"2D":"FailureModesEffectsAnalysis"===e?"2DTable":"Document"===e||"Requirement"===e||"Requirement Specification"===e?"Document":"DesignSight"===e?"MSR":"3D";!U||"DXF"!==U.getLoadMarkupCtxType()&&"DWG"!==U.getLoadMarkupCtxType()||(t="2D"),ne(t),te(t)}),!0)},clearView:function(){this.internalClear&&this.internalClear(!0),this._parent()},onPreCreate:function(){this.args.visu={fetchMePreferenceSettings:!0}},onPostCreate:function(){this.pad3DViewer.getViewer().setPrePicking({activated:!0,displayHL:!0}),window.widget.setMetas({helpPath:"3DPlayReviewExperience/assets/help"}),window.widget.dispatchEvent("onPlayExperienceReady",[{pad3DViewer:this.pad3DViewer}]),this.internalPostCreate&&this.internalPostCreate();let e=a.getReviewContext({context:this.pad3DViewer});e&&e.getValidation()&&this.setReviewData({asset:{physicalid:e.getValidation()._sPlmID,type:e.getValidation()._sValType}})},dispose:function(e){window.widget.setMetas({helpPath:void 0}),this.internalDispose&&this.internalDispose(R),R=null,this._parent(e)},refresh:function(){return this.internalRefresh&&this.internalRefresh(),!0},loadAsset:function(e){e&&e.asset&&e.asset.physicalid&&this.internalLoad&&(this.clearView(),this.internalLoad(e))},acceptSwitch:function(e){var t=!1;return e&&e.options&&e.options.id&&("ENOR3V_AP"!==(R=e.options.id)&&"ENOR3R_AP"!==R||(t=!0)),t}})})),define("DS/3DPlayReviewExperience/3DPlayHighlightExperience",["DS/3DPlayReviewExperience/3DPlayReviewExperience"],(function(e){"use strict";return e.extend({init:function(e){this._parent(e);let t=this.getSlideIDToActivate;this.getSlideIDToActivate=function(e,n){let i;if(!e||!n)return;let r=e.getHighlights();if(r&&r.length)for(let e=0;e<r.length;e++)r[e].getPlmID()===n&&(i=r[e].getPresentationSlideID());return i||t(e,n)}}})}));