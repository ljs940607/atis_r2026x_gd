define("DS/3DPlayWidget/3DPlayWidgetProxyEnopad",["DS/3DPlayWidgetControllers/3DPlayWidgetProxyBase","DS/WebUtils/Tracker"],(function(e,t){"use strict";return e.extend({init:function(e,n){this._parent({prefix:"DS/PADUtils/PADCommandProxy"}),this.subscribe("select",function(e){if("undefined"!=typeof widget&&e&&e.metadata&&widget.id!==e.metadata.originWidgetId){for(var n=e.data.paths,i=n.length,r=[],a=0;a<i;a++)n[a].length>0&&r.push(n[a].join("/"));if(r.length){t.trackPageEvent("interactions","select",e.data.sharedID),t.pause(!0);try{this.setCurrentCSO(r)}catch(e){}t.pause(!1)}}}.bind(e))}})})),define("DS/3DPlayWidget/W3DPlayPrefsCtrl",["UWA/Class","DS/CoreEvents/Events"],(function(e,t){"use strict";var n,i,r={protocol:"3DXContent",version:"1.0",source:"X3DCSMA_AP",data:{items:[{envId:"defaultString",serviceId:"defaultString",contextId:"defaultString",objectId:"defaultString",objectType:"defaultString",displayName:"",displayType:"defaultString",displayIcon:"defaultStringUri",displayPreview:"defaultStringUri",selectedExperience:"defaultString"}]}};return e.extend({init:function(e,t,r){i=e,n=t,this.readAllPreferences()},dispose:function(){n=i=null},readAllPreferences:function(){var e,a=n.getSwymModelIdPref(),o=n.getSwymTenantIdPref(),s=n.getCollabSpacePref(),l=n.getX3dContentPref(),d=i.getValue("beInputs");if(d){var c=(d=JSON.parse(d)[0]).outputId;if(c&&c.indexOf("swym:")>-1){var u=c.split(":");(e=UWA.extend({},r)).data.items[0]={serviceId:"3DSwym",objectId:u[4],envId:u[2],objectType:"media"}}n.setW3DPlayContent(e),i.deleteValue("beInputs")}var f=n.getW3DPlayContentPref();this.isSwymIdValid(a)&&this.isW3DPlayContentEmpty()?(e=this.newSwymDataPreparation(a,o),n.setW3DPlayContent(e)):this.isCollabSpaceValid(s)&&this.isW3DPlayContentEmpty()?(e=this.newSpaceDataPreparation(s),n.setW3DPlayContent(e)):this.isX3DContentIdValid(l)&&(window.widget&&(widget.isTransientWidget=!0),e=JSON.parse(l),n.setW3DPlayContent(e),n.deleteX3dContentPref()),this.isW3DPlayContentEmpty()||(f=n.getW3DPlayContentPref(),n.setInitialContent(JSON.parse(f))),t.publish({event:"PrefsCtrl.PreferencesReady"})},isPreferencesEmpty:function(){var e=!0,t=n.getW3DPlayContentPref();return t&&null!=t&&(e=!1),e},isW3DPlayContentEmpty:function(){var e=!0,t=n.getW3DPlayContentPref();return t&&null!=t&&(e=!1),e},isSwymIdValid:function(e){return!(!UWA.is(e)||""==e||"false"==e||void 0===e)&&e},newSwymDataPreparation:function(e,t,n){var i=r.data.items[0];return i.envId=t,i.objectId=e,i.serviceId="3DSWYM",i.objectType="3DShape",n&&console.warn("wow very old ( <R416 ?) 3DPlay Widget Preferences!"),r},newSpaceDataPreparation:function(e){return JSON.parse(e)},isCollabSpaceValid:function(e){var t=!1;if(e&&"undefined"!==e){var n=JSON.parse(e);UWA.is(n,"object")&&n.hasOwnProperty("data")&&(t=!0)}return t},isX3DContentIdValid:function(e){var t=!1;if(e&&"undefined"!==e){var i=JSON.parse(e);UWA.is(i,"object")&&i.hasOwnProperty("data")&&(t=!0)}var r=n.getW3DPlayContentPref();return r&&null!=r&&(t=!1),t},deleteLegacyModelIdPref:function(){i.deleteValue("MODELID"),i.deleteValue("swymTenantId")},deleteLegacyPlatformdPref:function(){i.deleteValue("PLATFORM")},deleteAllLegacyPrefs:function(){this.deleteLegacyModelIdPref(),this.deleteLegacyPlatformdPref()},cleanCollabSpacePref:function(e){i.deleteValue("CollabSpacePref")}})})),define("DS/3DPlayWidget/3DPlayWidgetLinkManager",["DS/PADUtils/PADSettingsMgt"].concat(["DS/ENOXInterWdgCom/LinkManager"]),(function(e,t){"use strict";return{init:function(){return t.initializeWidgetLink(window.widget,{appIds:[],open:!1,uses:["3DPlayDummy"],implements:["3DPlayDummy"]})},update:function(n){let i=n?{appIds:[],open:!1,uses:["3DPlayDummy"],implements:["3DPlayDummy"]}:{};t.updateLinkability(i),e.setSetting("activateWidgetLink",n)}}})),define("DS/3DPlayWidget/W3DPlayModel",["UWA/Class","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/CoreEvents/Events","DS/WebSystem/Environment","i18n!DS/3DPlayWidget/assets/nls/3DPlayWidget","DS/3DPlayConnectors/3DPlayInputPreProcessor","DS/WebUtils/WebServices","DS/3DPlay/3DPlay","i18n!DS/3DPlay/assets/nls/3DPlay"],(function(e,t,n,i,r,a,o,s,l){"use strict";var d,c,u={protocol:"3DXContent",version:"1.0",source:"defaultString",data:{items:[{envId:"defaultString",serviceId:"defaultString",contextId:"defaultString",objectId:"defaultString",objectType:"defaultString",displayName:""}]}},f=e.extend({init:function(e){d=this,c=e||window.widget,this.boxMessage=this.constructBoxMessageData(),this.setBoxMessageText(),this.objIdx=0,this.availableExperiences=[],this.availableServices=[],this.currentContent=void 0,this.canvasDivRef=void 0,this.x3d=void 0,this.currentCSO=void 0,this.plateformPromise=this.getAllPlatformServices(),this.plateformPromise.then((function(e){var n=function(e){d.availableServices=e,i.set("3DPlay.Plateform.3DSpaceUrl",e);var r=i.get("x3dPlatformId");if(r){var a=!1;e.some((function(e){if(r==e.platformId&&e.url&&""!==e.url)return a=!0,!0})),a||setTimeout((function(){t.getServiceUrl({serviceName:"3DSpace",onComplete:n})}),5e3)}};n(e)}),(function(e){console.error("getAllPlatformServices Error!"),console.dir(e)}))},dispose:function(){c=null},getCollabSpacePref:function(){return c.getValue("CollabSpacePref")},getX3dContentPref:function(){return c.getValue("X3DContentId")},deleteX3dContentPref:function(){c.deleteValue("X3DContentId")},getSwymModelIdPref:function(){return c.getValue("MODELID")},getSwymTenantIdPref:function(){return c.getValue("swymTenantId")},getW3DPlayContentPref:function(){return c.getValue("W3DPlayContent")},getCurrentContent:function(){return this.currentContent},getCurrentData:function(e){return void 0!==this.currentContent&&(UWA.is(e)||(e=0),this.currentContent.data.items[e])},getCurrentProvider:function(){var e=this.getCurrentData();return e?e.serviceId:""},getWidgetMessage:function(e){if(UWA.is(e,"string")){if(r[e])return r[e];console.error("Unable to find Nls key for :",e)}else console.error("Invalid nls key > ",e)},getAllPlatformServices:function(){return new Promise((function(e,n){t.getServiceUrl({serviceName:"3DSpace",onComplete:e,onFailure:function(e){n(e),console.error("Error in i3DXCompassServices.getPlatformServices :",e)}})}))},get3DSpaceServiceUrl:function(e,t){var n;e&&UWA.is(e,"string")&&(this.availableServices.forEach((function(t){t.platformId===e&&(n=t.url)})),n?t(n):o.getServiceUrl({serviceName:"3DSpace",platformId:e,onSuccess:function(e){t(e.url)},onError:function(){t()}}))},constructBoxMessageData:function(){return{invite_msgDom:"",invite_imgDom:"",DEFAULT:{classIcon:"fonticon-block",msg:""},REPLACE:{classIcon:"fonticon-down-circled",msg:""},DROPIT:{classIcon:"fonticon-down-circled",msg:""},ERROR:{classIcon:"fonticon-block",msg:""}}},getBoxMessageData:function(){return this.boxMessage},getBoxClassIcon:function(e){return this.boxMessage[e].classIcon},getBoxMessageText:function(e){return this.boxMessage[e].msg},getCanvasDiv:function(){return this.canvasDivRef},getCurrentCSO:function(){return this.currentCSO},setInitialContent:function(e){this.currentContent=e},setInitialContent2:function(e){UWA.clone(u).data.items[0];var t=UWA.clone(u);t.data.items[0]=e,this.setInitialContent(t)},setCurrentContentFromPublishedFile:function(e){UWA.clone(u).data.items[0];var t=UWA.clone(u);t.data.items[0]=e,this.setCurrentContent(t,!0),e.displayName&&this.setCurrentTitle(e.displayName),this.getAssetFromProvider(e,(function(e){(new a).run(e,(function(e){var t=d.getPlayerRef().getExperience();t.args.input.asset=e.asset,t.loadAssetInfo=UWA.clone(t.args.input.asset,!0),t.publish("ASSET/LOADINGFINISHED",{model:t.modelName,time:0,ctx:t.args.ctx,loadAssetInfo:t.loadAssetInfo})}))}))},setCurrentContentFromSwitch:function(e){if(e&&e[0]){var t=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices").getNodeID(e[0]);if(t){var n=UWA.clone(u),i=n.data.items[0];i.displayName=c.getValue("afrProductTitle")||c.getValue("title"),i.objectId=t,i.serviceId="3DSPACE",i.envId=c.getValue("x3dPlatformId"),i.objectType="VPMReference",this.setCurrentContent(n,!0)}}},setCurrentContent:function(e,t){this.currentContent=e,t||this.update("Model.changeCurrent",e);try{"DMUSlideView"!=e.data.items[0].objectType&&this.setW3DPlayContent(this.currentContent)}catch(e){console.error(e),this.setW3DPlayContent(this.currentContent)}var n=this.getCurrentData();n.displayName&&c.setValue("afrProductTitle",n.displayName)},setCurrentTitle:function(e){""!==e&&void 0!==e&&this.currentContent&&(this.currentContent.data.items[0].displayName=e,this.update("Model.changeTitle"))},setCanvasDiv:function(e){this.canvasDivRef=e},setW3DPlayContent:function(e){c.setValue("W3DPlayContent",JSON.stringify(e))},setCurrentCSO:function(e){this.currentCSO=e,this.update("Model.changeCSO",this.currentCSO)},setPlayerRef:function(e){this.playerRef=e},getPlayerRef:function(){return this.playerRef},setBoxMessageText:function(){this.boxMessage.REPLACE.msg=this.getWidgetMessage("REPLACE_IT_MSG"),this.boxMessage.DROPIT.msg=this.getWidgetMessage("DROP_IT_MSG"),this.boxMessage.ERROR.msg=this.getWidgetMessage("DROP_ERROR_MSG")},isSwymIdValid:function(e){return!(!UWA.is(e)||""==e||"false"==e||void 0===e)&&e},isX3DContentIdValid:function(e){if(!e||"undefined"===e)return!1;var t=JSON.parse(e);return UWA.is(t,"object")?!!t.hasOwnProperty("data"):void 0},get3DPlayWebInputObject:function(e,t){if("DMUSlideView"==e.objectType)try{var n=this.playerRef.getExperience();if("getDropDelegations"in n){const t=n.getDropDelegations();if(`_${e.objectType}`in t)return void t[`_${e.objectType}`](e)}return void s.sendEvent(n.ctx,eventType.notif,"error",{msg:l.MarkupSlideWrongExp})}catch(t){console.error("Unable to process DMUSlideView"),console.error(t),e.error={NLS_ID:"BadUrl"}}var i={input:{},options:{loading:"autoplay",callbacks:{experience:{ExperienceReady:function(){if(d.isPendingLoadingCozNotReady)return d.isPendingLoadingCozNotReady=!1,void d.update("Model.changeCurrent")},dispose:function(){}},asset:{LoadingStarted:function(){d&&d.LoadingStartedCB.apply(d,arguments)},LoadingFinished:function(){d&&d.LoadingFinishedCB.apply(d,arguments)}}}}};e?d.getAssetFromProvider(e,(function(e){var n=d.getCurrentContent();d.drag&&n.source&&(e.asset.source=n.source),d.drag=!1,void 0!==e&&(i.input=e),t(i)})):t(i)},getAssetFromProvider:function(e,t){var n,i=e.serviceId.toUpperCase();switch(i){case"3DSWYM":n=this.get3DSwymInput(e);break;case"3DSPACE":return void(n=this.get3DSpaceInput(e,t));case"3DDRIVE":case"GOOGLE":case"DROPBOX":case"ONEDRIVE":n=this.getDriveInput(e);break;case"2DLAYOUT":n=this.get2DLayoutInput(e);break;case"FILE":n={asset:e};break;case"R2VSURVEY":n={asset:e},e.provider=e.serviceId,e.type=e.objectType,e.dtype=e.objectType;break;default:console.warn("Missing provider, this must be set! ",i)}e.displayPreview&&(n.asset.displayPreview=e.displayPreview),n.error=e.error,t(n)},isLoadingFinished:function(){var e=this.getPlayerRef();return!(!e||!e.instance)&&e.instance.isLoadingFinished()},loadMru:function(e){return new Promise((function(e){function t(t){var n;try{n=(n=JSON.parse(t)).reverse()}catch(e){n=[]}e(n)}o.myAppsPreference({preferenceName:"mru3dplay",onComplete:t,onFailure:function(){t(window.localStorage.getItem("3DPlay.Mru"))}})}))},saveMru:function(e){function t(e,t){var n=e?JSON.parse(e):[];return function(e){for(var t=0;t<n.length;t++)if(n[t].data.items[0].displayName===e.displayName&&n[t].data.items[0].serviceId===e.serviceId)return!0;return!1}(t.data.items[0])||(6===n.length&&n.shift(),n&&n.push&&n.push(t)),JSON.stringify(n)}o.myAppsPreference({preferenceName:"mru3dplay",onComplete:function(n){var i=t(n,e);o.myAppsPreference({preferenceName:"mru3dplay",value:i,onComplete:function(e){},onFailure:console.warn}),window.localStorage.setItem("3DPlay.Mru",i)},onFailure:console.warn}),window.localStorage.setItem("3DPlay.Mru",t(window.localStorage.getItem("3DPlay.Mru"),e))},LoadingStartedCB:function(e){this.preventeMultipleLoad=!1},LoadingFinishedCB:function(e){if(e&&e.loadAssetInfo&&e.loadAssetInfo.localFile&&-1===[].indexOf(e.loadAssetInfo.format.toUpperCase())){if(!0===this.preventeMultipleLoad)return;this.preventeMultipleLoad=!0;require(["DS/3DPlaySave/SaveServices","i18n!DS/3DPlaySave/assets/nls/SaveServices"],(function(t,n){var i=d.widgetHasLightbox?"":e.loadAssetInfo.localFile.name;c.setTitle(i+" ("+n.FileDnDFromDesktopNotif_PreviewTitle+")"),d.getPlayerRef().getExperience().args.input.asset=e.loadAssetInfo,d.setInitialContent2(e.loadAssetInfo),t(e,(function(t){d.setCurrentContentFromPublishedFile(t);var n=d.getCurrentContent();d.saveMru(n),c.setTitle(e.loadAssetInfo.localFile.name)}),d.getPlayerRef().getExperience())}))}else{if(this.isPendingLoadingCozNotReady)return this.isPendingLoadingCozNotReady=!1,void this.update("Model.changeCurrent",e);var t=this.getCurrentContent();this.setW3DPlayContent(t),t&&this.saveMru(t);var n=this.getCurrentData();n.displayName?c.setValue("afrProductTitle",n.displayName):this.playerRef.instance&&this.playerRef.instance.pad3DViewer&&this.playerRef.instance.pad3DViewer.getContentName({callbacks:{onComplete:function(e){d&&d.setCurrentTitle(e.contentName),c.setValue("afrProductTitle",e.contentName)},onFailure:function(){}}}),"3DSWYM"===this.getCurrentProvider().toUpperCase()&&(e&&e.loadAssetInfo&&e.loadAssetInfo.swymAttr&&e.loadAssetInfo.swymAttr.title?this.setCurrentTitle(e.loadAssetInfo.swymAttr.title):this.get3DSwymTitle(t))}},get3DSwymTitle:function(e){var t=this;if(this.x3d)this.x3d.get3DSwymMetaData(e,(function(e){t.setCurrentTitle(e.title),t=null}),console.error);else{require(["DS/3DPlayConnectors/3DSwymConnector"],(function(n){t.x3d=new n,t.get3DSwymTitle(e)}))}},get2DLayoutInput:function(e){var t={asset:e.asset};return t.asset.originalAsset={provider:"3DSPACE",type:"2DLayout"},t},get3DSwymInput:function(e){return{asset:{objectId:e.objectId,provider:"3DSwym",envId:e.envId,tenant:e.envId,type:"media"}}},getDriveInput:function(e){return{asset:{objectId:e.objectId,provider:e.serviceId.toUpperCase(),physicalid:e.objectId,requiredAuth:"passport",type:e.objectType,dtype:e.objectType,tenant:e.envId}}},get3DSpaceInput:function(e,t){this.get3DSpaceServiceUrl(e.envId,(function(n){n?o.getSecurityContext(e.envId,e.contextId).then((function(i){t({asset:{provider:"EV6",physicalid:e.objectId,serverurl:n,serviceId:e.serviceId,type:e.objectType,dtype:e.objectType,requiredAuth:"passport",tenant:e.envId,contextid:i||e.contextId,Play3DXContent:d.currentContent,error:e.error}})})):(console.warn("3DPlay WIDGET : Unable to find 3DSpace Service for Tenant > ",e.envId),t())}))},update:function(e,t){n.publish({event:e,data:t})}});return f})),
/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
define("DS/3DPlayWidget/Widget3DPlay",["DS/3DPlayWidget/W3DPlayModel","DS/3DPlayWidgetViews/W3DPlayMainView","DS/3DPlayWidgetViews/W3DPlayerView","DS/3DPlayWidget/W3DPlayPrefsCtrl","css!DS/3DPlayWidget/assets/3DPlayWidget","DS/CoreEvents/Events","DS/WebSystem/BrowserInfos","DS/WebSystem/Environment","DS/3DPlayWidget/3DPlayWidgetProxyEnopad","DS/WebUtils/Tracker"],(function(e,t,n,i,r,a,o,s,l,d){"use strict";var c,u,f,p,g={},y=function(){g.wModel=new e(c),g.wModel.applicationFrameOptions=u,g.wView=new t(c,g.wModel),g.wPlayer=new n(c,g.wModel),g.wPlayer.applicationFrameOptions=u,g.wPCtrl=new i(c,g.wModel,g.wView),g._3DPlayWidgetProxyEnopad=new l(g.wModel),u&&u.widgetCB&&u.widgetCB(g),g.dispose=function(e){e.appSpecializations||(c.removeEvent("onRefresh",P),c.removeEvent("onLoad",y),c.removeEvent("onHide",v),c.removeEvent("onShow",S),c.removeEvent("onViewChange",m),c.removeEvent("onFocus",C),f&&(c.removeEvent("onSearch",f),f=null),p&&(c.removeEvent("onResetSearch",p),p=null),c=null,u=null,D(e))}},D=function(e){e.appSpecializations||(g.wModel.dispose&&g.wModel.dispose(e),g.wModel=null,g.wView.dispose&&g.wView.dispose(e),g.wView=null,g.wPlayer.dispose&&g.wPlayer.dispose(e),g.wPlayer=null,g.wPCtrl.dispose&&g.wPCtrl.dispose(e),g.wPCtrl=null,g._3DPlayWidgetProxyEnopad.dispose(),g._3DPlayWidgetProxyEnopad=null)},P=function(){g.wPlayer.widgetRefreshHandler()||(g.wView.buildCanvas(),g.wView.removeDragAndDropZone(g.wView.canvasDiv),g.wView.createBlueBackground(),g.wPlayer.instantiate3DPlayWebPlayer())},v=function(){o.isMobile()&&g.wModel.isLoadingFinished()&&D()},S=function(){o.isMobile()&&(g.wModel||y())},m=function(e){"maximized"===e.type||"fullscreen"===e.type?(console.log("fullscreen"),a.publish({event:"3DPLAY/FULLSCREEN/ENABLE",data:{}})):"windowed"!==e.type&&"minimized"!==e.type||(this.fullscreen=!1,a.publish({event:"3DPLAY/FULLSCREEN/DISABLE",data:{}}))},C=function(e){1==e?a.publish({event:"3DPLAY/WIDGETFOCUS/ENABLE",data:{}}):a.publish({event:"3DPLAY/WIDGETFOCUS/DISABLE",data:{}})};return f=function(e){g.wPlayer.search(e)},p=function(e){g.wPlayer.resetsearch(e)},function(e){c=e.widget,u=e.applicationFrameOptions,e.appSpecializations||(c.setMetas({helpPath:"3DPlayWidget/assets/help"}),c.addEvent("onLoad",y),c.addEvent("onRefresh",P),c.addEvent("onHide",v),c.addEvent("onShow",S),c.addEvent("onViewChange",m),c.addEvent("onFocus",C),c.fullscreen=!1,f&&c.addEvent("onSearch",f),p&&c.addEvent("onResetSearch",p))}}));