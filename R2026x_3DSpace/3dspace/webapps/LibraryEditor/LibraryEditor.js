function LibraryEditor(e){"use strict";var t={leftPanelState:!0,isWelcomePanelCollapsed:!1},i={rightPanelState:!1,size:300},r={widget:null,filterFromWin:null,libraryContent_Cont:null,libraryContentController:null,libraryTree_div:null,libraryTreeDoc_div:null,libraryTree_Cont:null,libraryIdCard_div:null,libraryIdCard_Cont:null,core:null,widthToHideLeftPanel:300,_actionbar:null,libraryTree_W_NotLinked:!1,css_view_class:"windowed",_mouseEventsManager:{unlockMouseMove:!1,draggingXSlider:null,mouseStartXSlider:null,initialMouseStartXSlider:null,dragginDirection:null,cancelDragging:!1,spanPosition:null,widthLeftDiv:null,widthRightDiv:null,widthLeftDivSave:null,widthRightDivSave:null,widthGlobalDiv:null,newWidthGlobalDiv:null},init:function(e){var r=this;require(["DS/LibraryEditor/utils/LibraryEditorUtil"],(function(e){var r=e.getLeftPanelStatus(),n=e.getRightPanelStatus();Promise.all([r,n]).then((function(e){t=e[0],i=e[1]}))})),this.widget=e.widget,this.dataForActiveClassODT=e.dataForActiveClassODT,e.filter?this.filterFromWin=e.filter:this.filterFromWin=null,e.defaultSelectionPath&&(this.widget.defaultSelectionPathFromWin="root,LibrarySection_AllLibraries,"+e.defaultSelectionPath),this.widget.addEvent("onLoad",this.onLoad.bind(this)),this.widget.addEvent("onRefresh",this.onRefresh.bind(this)),this.widget.addEvent("onDestroy",this.onDestroy.bind(this)),this.widget.addEvent("onResize",this.onResize.bind(this)),this.widget.changeInPreference={};var n={},a={};this.widget.addEvent("onEdit",(function(){r.widget.preferences.forEach((function(e){"hidden"!==e.type&&(n[e.name]=r.widget.getValue(e.name))}))})),this.widget.addEvent("endEdit",(function(e){!(!e||!e.submitted&&!e.needRefresh)&&(r.widget.changeInPreference={},Object.keys(n).forEach((function(e){a[e]=r.widget.getValue(e),n[e]!==a[e]&&(r.widget.changeInPreference[e]=a[e])})))}))},onRefresh:function(e){var t=this;require(["DS/LibraryEditor/utils/Library_CSO","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/IPClassifyUtil/IPSettingsMgr","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/IPClassifyUtil/IPClassifyUtility"],(function(i,r,n,a,o,s){var l=[];l.push(s.initURLSAsync()),t.widget.changeInPreference.x3dPlatformId&&(t.widget.changeInPreference={}),Promise.all(l).then((function(){var a=s.isIndexedMode();if(o.getContent().updateFilterBI(a),o.getContent().updateComputedColumns(),t.libraryContent_Cont.addEvent("onCompleteRefreshNodes",(function(e){this.removeEvent("onCompleteRefreshNodes"),r.displayNotification({message:n.msg_info_refresh,className:"primary"})})),e&&UWA.is(e.authored.deleted,"array")){var l=i.getCurrentLibrary();l.getID()===e.authored.deleted[0]&&l.getParent().select(!0)}o.getTreeCont().refreshLibraryTree(),o.getContent().refreshLibraryContent()}))}))},setCtxMenu:function(e,t,i){this.libraryContentController&&this.libraryContentController.webInWinCtxMenu(e,t)},insertSelectedSearchObjs:function(e){var t=e[0].split(",");require(["DS/ApplicationFrame/CommandsManager","DS/IPClassifyUtil/IPContext"],(function(e,i){if(e)try{e.getCommand("AddExistingContent",i.get().toString())._processInsertOperation(t)}catch(e){console.error("Error trying to execute command","AddExistingContent",e)}}))},showMessage:function(e,t){require(["DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],(function(i,r){i.displayNotification({message:r.get(e),className:t})}))},onWebInWinFilterChange:function(e){this.libraryContentController&&this.libraryContentController.onWebInWinFilterChange(e)},onWebInWinTaggerVisChange:function(e){},onClearSelection:function(){require(["DS/LibraryEditor/utils/LibraryEditorcontrol"],(function(e){e.getContent().getView().getPADTreeDocument().getXSO().empty()}))},onDestroy:function(){},onResize:function(){var e=this;setTimeout((function(){e.libraryGlobal_div&&e.libraryIdCard_Cont&&0!==e.libraryGlobal_div.clientWidth&&e.libraryIdCard_Cont.updateDisplayPath()}),500)},preferenceIsNotSet:function(e){return void 0===widget.getValue(e)||null===widget.getValue(e)},migratePreferences:function(){return new Promise((function(e){require(["text!DS/LibraryEditor/assets/libraryVersion.json","DS/LibraryEditor/utils/LibraryMigration","DS/IPClassifyUtil/IPClassifyPreference"],(function(t,i,r){let n=JSON.parse(t);var a=[];let o=new Promise((function(e){r.get("LibraryFavPrefVersion",(function(t){!t||!t.version||t.version<n.LibraryFavPrefVersion?i.migrateFavPreferences(null,n.LibraryFavPrefVersion).then((function(){e()})):e()}),!1)}));a.push(o);let s=new Promise((function(e){r.get("LibraryTreeStrcutPrefVersion",(function(t){!t||!t.version||t.version<n.LibraryTreeStrcuturePrefVersion?i.migrateTreeStructurePreferences(null,n.LibraryTreeStrcuturePrefVersion).then((function(){e()})):e()}))}));a.push(s),Promise.all(a).then((function(){e()}))}))}))},onLoad:function(){this.probeHeader=this.widget.id+"_"+this.widget.getTitle()+"_",window.performance.mark("onLoad_begin"),window.performance.measure(this.probeHeader+"createToOnLoad","createWidget_begin","onLoad_begin");var e=this;require(["DS/IPClassifyUtil/IPClassifyUtility","DS/PADUtils/Configuration","text!DS/LibraryEditor/assets/LibraryEditorConf.json","DS/PADServices/utils/AttributesMgt"],(function(t,i,r,n){t.isCustomizedEnv(),t.initURLSAsync().then((function(){e.migratePreferences();var t=JSON.parse(r);i.mergeConfig(t),n.updateAttributesList(t.columnsCusto),require(["UWA/Core","DS/PADUtils/PADCommandProxy","DS/IPClassifyUtil/IPSettingsMgr","DS/IPClassifyUtil/IPServicesMgr","DS/IPClassifyUX/LibraryContent","DS/IPClassifyUtil/IPClassifyModelEvents","DS/LibraryEditor/dataProvider/LibraryContentDataProvider","DS/IPClassifyUX/LibraryIdCardCont","DS/LibraryEditor/dataProvider/LibraryIdCardDataProvider","DS/IPClassifyUX/LibraryTree","DS/LibraryEditor/dataProvider/LibraryTreeDataProvider","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/dataProvider/LibraryCSODataProvider","DS/LibraryEditor/dataProvider/LibraryDnDServiceProvider","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/service/LibraryServices","DS/LibraryEditor/service/LibraryTypeService","DS/IPClassifyUtil/IPClassifyAlert","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/UIKIT/Mask","UWA/Class/Events","DS/LibraryEditor/utils/LibraryEditorKeyboardListener","DS/LibraryEditor/utils/LibraryEditorUtil","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUtil/IPClassifyCommunication","DS/LibraryEditor/utils/FilterUtils","DS/WidgetServices/WidgetServices","DS/IPClassifyUXUtil/CredentialsView","text!DS/LibraryEditor/assets/library_settings.json","DS/IPClassifyUX/utils/IPClassifyModeManager","DS/IPClassifyUtil/IPContext","DS/Windows/ImmersiveFrame"],(function(t,i,r,a,o,s,l,d,c,u,f,g,p,y,m,b,h,v,C,_,S,L,E,D,A,w,I,T,P,x,U,N){var M=e.filterFromWin;M?UWA.is(M,"string")?w.setUQLFilter(M):w.setFilters(M):w.resetEndItemFilter(),window.performance.mark("loadRequire_end"),window.performance.measure(e.probeHeader+"loadRequire","createWidget_begin","loadRequire_end"),widget.setValue("tenantAware",!0),s.subscribe({event:"onPad_security_ctx"},(function(e){C.getContent()&&g.getCurrentLibrary()&&g.getCurrentLibrary()._options&&C.getContent().getView()&&C.getContent().getView().options&&C.getContent().getView().options.model&&C.getContent().getView().options.model.getModelEvents()&&C.getContent().getView().options.model.getModelEvents().publish({event:"titleRecalc",data:g.getCurrentLibrary()._options.label})})),widget.addPreference({name:"pad_security_ctx",type:"hidden"});var O=JSON.parse(P);widget.setValue("editProperties_readOnly",!1),widget&&widget.lang&&r.setSetting("lang",widget.lang),e.widget.addEvent("endEdit",r.updateWidgetPreferences.bind(r)),r.updateWidgetPreferences(),e.updateSecurityPreference();var F=e;if(F.options={},F.addEvent=()=>{},U.set(F),x.addModeIntervalPreferences({refreshView:function(){require(["DS/LibraryEditor/utils/LibraryEditorcontrol"],(function(e){e.getTreeCont().refreshLibraryTree(),e.getContent().refreshLibraryContent()}))},updateTaggerAndComputeColumns:function(e){require(["DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/utils/Library_CSO"],(function(t,i){t.getContent().updateComputedColumns(),"Library"===(i.getCurrentLibrary()&&i.getCurrentLibrary().getType())&&t.getContent().updateFilterBI(e)}))}}),e.widget.getValue("x3dSharedId")||e.widget.getValue("x3dAppId")||e.widget.addPreference({name:"x3dAppId",type:"hidden",defaultValue:"ENOCLRX_AP"}),e.widget.getValue("x3dSharedId")||e.widget.addPreference({name:"x3dSharedId",type:"hidden",defaultValue:"LibraryEditor_"+a.getWidgetId()}),T.render(),null===e.libraryTree_Cont||void 0===e.libraryTree_Cont){e.core=t,e.widget.body.empty(),e._buildSkeleton();e.widget.addEvent("endEdit",(function(){e.widget.getPreferences().forEach((function(t){var i="boolean"===t.type&&UWA.is(t.value,"string")?e.convertToBool(t.value):t.value;e.widget.setValue(t.name,i)}))})),e.libraryGlobal_div=e.widget.body.container,e.libraryTreeDoc_div=e.widget.body.right_side_div,e.libraryIdCard_div=e.widget.body.top_right_side_div,e.libraryContent_div=e.widget.body.bottom_right_side_div;var R=e._initializeLibraryEditorComponent.bind(e,u,f,C,o,l,L,a,p,y,m,h,A,I);if(null===e.libraryContent_Cont){var W={x3dAppId:e.widget.getValue("x3dAppId"),lang:e.widget.lang?e.widget.lang:e.widget.getValue("lang"),layout:{view_customization:null,css_view_class:e.css_view_class,store_roots_in_pref:!0,padshell:!0},authorize_setStructure:!0,settings:O},V=function(){try{JSON.parse(D.jsonUnzip(e.widget.getValue("LibraryCusto_treelistview_v1")))}catch(e){return!1}return!0}();e.widget.getValue("LibraryCusto_treelistview_v1")&&V?(W.layout.view_customization=JSON.parse(D.jsonUnzip(e.widget.getValue("LibraryCusto_treelistview_v1"))),W.layout&&W.layout.view_customization&&Array.isArray(W.layout.view_customization.selectedExtensions)&&Array.isArray(W.layout.view_customization.selectedTypes)&&n.updateSelectedParams({selectedExtensions:W.layout.view_customization.selectedExtensions,selectedTypes:W.layout.view_customization.selectedTypes}),R(W)):a.app_initialization((function(){require(["DS/IPClassifyUtil/service/IPClassifyUtilWebService"],(function(t){t.getUserPreferences({name:e.widget.getValue("x3dAppId")+"_Library_v1",onComplete:function(e){var t=null;e&&e.length>0&&(t=JSON.parse(JSON.stringify(D.jsonUnzip(e))));var i=function(){try{JSON.parse(t)}catch(e){return!1}return!0}();W.layout.view_customization=i?JSON.parse(t):t,W.layout&&W.layout.view_customization&&Array.isArray(W.layout.view_customization.selectedExtensions)&&Array.isArray(W.layout.view_customization.selectedTypes)&&n.updateSelectedParams({selectedExtensions:W.layout.view_customization.selectedExtensions,selectedTypes:W.layout.view_customization.selectedTypes}),R(W)},onFailure:function(e){R(W)}})}))})),e.getSelectedNodes=function(){return g.getSelectedNodes()},e.getCurrentLibrary=function(){var e=E.getCurrentSecurityContextAndLibraryData(!0);return JSON.stringify(e)},e.getSecurityContext=function(){return{SecurityContext:r.getSetting("pad_security_ctx"),tenant:widget.getValue("pad_tenant")}},e.beginBlockingTransaction=function(t){_.mask(e.libraryContent_div,t)},e.endBlockingTransaction=function(){_.unmask(e.libraryContent_div)},e.author=function(e){},e.displayNotification=function(e){v.displayNotification({message:e.msg,className:e.eventID})},e.getPADTreeDocument=function(){return C.getContent().getView()?C.getContent().getView().getPADTreeDocument():null},e.toggleView=function(e){UWA.is(C.getContent().getView().toggleView(e))&&C.getContent().getView().toggleView(e)},e.getPADTreeListView=function(){return C.getContent().getView().getPADTreeListView()},e.getContent=function(){return C.getContent()}}}}))}))}))},_slidderMoveEndCallback:function(){this.libraryIdCard_Cont&&this.libraryIdCard_Cont.updateDisplayPath()},_buildSkeleton:function(){if(!this.core.is(this.widget.body.container)){var e=require("DS/Windows/ImmersiveFrame"),t=require("DS/WebUAUtils/WebUAUtils"),i=new UWA.Element("div",{class:"LibraryEditor-widget-help",style:{"vertical-align":"top"}});if(i.inject(widget.body),this.widget.myImmersiveFrame){this.widget.bottom.destroy();var r=this.widget.myImmersiveFrame}else{r=new e;this.widget.myImmersiveFrame=r,t.setPanelHelpMode({immersiveFrame:this.widget.myImmersiveFrame})}try{t.closePanelHelp()}catch(e){console.log("UA Panel already closed")}r.inject(i),r.getFreeZone().replaceChildren(),this.widget.body.container=UWA.createElement("div",{class:"LibraryEditor_global_container"}).inject(r.getFreeZone(),"top"),this.widget.body.globalLoaderContainer=UWA.createElement("div",{class:"LibraryEditor_global_loader"}).inject(this.widget.body.container),this.widget.body.right_side_div=UWA.createElement("div",{class:"LibraryEditor_right_side_div"}).inject(this.widget.body.container),this.widget.body.top_right_side_div=UWA.createElement("div",{class:"LibraryEditor_top_right_side_div"}).inject(this.widget.body.right_side_div),this.widget.bottom=this.widget.body.bottom_right_side_div=UWA.createElement("div",{class:"LibraryEditor_bottom_right_side_div"}).inject(this.widget.body.right_side_div);var n=UWA.createElement("div",{class:"LibraryEditor_containerTools"});require(["DS/PADServices/utils/GlobalModelEvents"],(function(e){e.getModelEvents().subscribe({event:"IPClassifyColumnCusto/Views/showInWidgetBody"},(function(e){e.html?(n.empty(),e.html.inject(n),n.inject(widget.body)):!0===e.restore&&n.remove()}))}))}},convertToBool:function(e){return"true"===e.toLowerCase()},_initializeLibraryEditorComponent:function(e,t,i,r,n,a,o,s,l,d,c,u,f,g){var p=this;o.app_initialization((function(){if(null===p.libraryTree_Cont){var o=new e({lang:p.widget.lang?p.widget.lang:p.widget.getValue("lang"),css_view_class:p.css_view_class,dataProvider:t,CSOProvider:s,DnDProvider:l,LibraryTypeService:c,events:{onReady:function(){if(i.setTreeCont(this),p.libraryTree_Cont=this._libraryTreeView,null!==p.libraryTree_Cont)p.libraryTree_Cont.setOption("_libraryContentView",this._libraryTreeView);else{if(!0===p.libraryTree_W_NotLinked)throw"LibraryTree are not linked !!!";p.libraryTree_W_NotLinked=!0}var e=p._retrieveinitializationOpts(),t=UWA.extend(g,e);t.placeholderData={},t.placeholderData.multiplePlaceholders=!1,t.placeholderData.placeholders={},t.placeholderData.placeholders.addExistingCI={},t.placeholderData.placeholders.addExistingCI.labelNLS=d.placeholder_msg,t.placeholderData.placeholders.addExistingCI.commandNLS=d.placeholder_CMD1,t.placeholderData.placeholders.addExistingCI.command="AddExistingContent",t.leftTriptychElem=p.libraryTree_Cont.elements.container,t.dataProvider=n,t.CSOProvider=s,t.DnDProvider=l,t.thumbnailAttributeDelayed=!0,p.migrateContentPreferences(g.layout.view_customization).then((function(){p.libraryContentController=new r(t),i.setContent(p.libraryContentController),p.widget.dispatchEvent("onLibraryEditorReady"),f.isWebInWinEnvironment()&&u.publish("onLibraryEditorReady","")}))}}});i.setTreeCont(o)}p._keyboardListener||(p._keyboardListener=new a,p._keyboardListener.startObservingKeyboard())}))},migrateContentPreferences:function(e){return new Promise((function(t){e?require(["text!DS/LibraryEditor/assets/libraryVersion.json"],(function(i){var r=JSON.parse(i).LibraryContentViewVersion;r!==e.version?require(["DS/LibraryEditor/utils/LibraryMigration"],(function(i){i.migrateContentPreferences(e,r).then((function(){t()}))})):t()})):t()}))},updateSecurityPreference:function(){window.library&&require(["DS/IPClassifyUtil/IPSettingsMgr"],(function(e){var t="ctx::"+window.library.params.securityContext;e.setSetting("pad_security_ctx",t)}))},_retrieveinitializationOpts:function(){var e=this;return{renderTo:e.libraryContent_div,events:{onActionBarReadyToBuild:function(){var r=require("DS/IPClassifyUX/LibraryIdCardCont"),n=require("DS/PADServices/utils/GlobalModelEvents"),a=require("DS/LibraryEditor/dataProvider/LibraryCSODataProvider"),o=require("DS/LibraryEditor/dataProvider/LibraryIdCardDataProvider");window.DEBUG_ActionBar_Require=!0,window.DEBUG_ActionBar_CmdInstantiation=!0,window.DEBUG_ActionBar_Xml=!0,window.DEBUG_ActionBar_ProcessCommandHeader=!0,window.DEBUG_ActionBar_Init=!0,e.elements=this.elements,e.options=this.options,e.togglePanel=this.togglePanel,null===e.libraryIdCard_Cont&&(e.libraryIdCard_Cont=new r({lang:e.widget.lang?e.widget.lang:e.widget.getValue("lang"),css_view_class:e.css_view_class,parentDiv:e.libraryIdCard_div,leftState:t,rightState:i,modelEvents:n.getModelEvents(),libraryCSODataProvider:a,libraryDataProvider:o,events:{onReady:function(){e.libraryIdCard_Cont=this,e.libraryIdCard_Cont.render().inject(e.libraryIdCard_div)}}}))},onReady:function(){e.libraryContent_Cont=this,e.addEvent=e.libraryContent_Cont.addEvent.bind(e.libraryContent_Cont),e.libraryContent_Cont.dropInvitContainer&&(e.libraryContent_Cont._dropInvitContainer=e.libraryContent_Cont.dropInvitContainer),e.libraryContent_Cont.options.renderTo&&(e.libraryContent_Cont._dropInvitContainer.hide(),e.libraryContent_Cont.render().inject(e.libraryContent_Cont.options.renderTo)),e.updateSecurityPreference(),require(["DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/IPClassifyCommunication","DS/LibraryEditor/utils/LibraryEditorcontrol"],(function(e,t,i){e.isNatifEnvironnement()&&i.getContent().getView().getPADTreeDocument().getXSO().onChange((function(){var r=i.getContent().getView().getPADTreeDocument().getXSO().get(),n=[];r.forEach((function(t){if(e.isWebInWinEnvironment()){var i={};i.id=t.getID(),i.type=t._options.type,n.push(i)}else n.push(t.getID())})),t.publish("onObjectSelected",n)}))}));var t=e.widget.getValue("X3DContentId");if(t){var i=UWA.is(t,"string")?JSON.parse(t):t;if(i.data.items.length>0){var r=i.data.items[0].objectId;e.widget.setValue("X3DContentId","");var n=require("DS/LibraryEditor/utils/LibraryEditorcontrol"),a=require("DS/IPClassifyUtil/IPClassifyAlert");n.getTreeCont().expandTreeAndSelectLibrary({libraryToFindAndSelect:{id:r},onFailure:function(e){a.displayNotification({message:e instanceof Error?e.message:e,className:"error"})},isInvisible:!0})}}},onCustoViewChange:function(t){require(["DS/IPClassifyUtil/IPClassifyUtility","DS/PADServices/utils/AttributesMgtV2"],(function(i,r){try{t.selectedTypes=r.getSelectedTypes(),t.selectedExtensions=r.getSelectedExtensions()}catch(e){}e.widget.setValue("LibraryCusto_treelistview_v1",i.jsonZip(JSON.stringify(t)))}))},onSaveAsTemplate:function(t){require(["DS/IPClassifyUtil/service/IPClassifyUtilWebService","DS/IPClassifyUtil/IPClassifyUtility","DS/PADServices/utils/AttributesMgtV2"],(function(i,r,n){try{t.selectedTypes=n.getSelectedTypes(),t.selectedExtensions=n.getSelectedExtensions()}catch(e){}t.hasOwnProperty("columnsOptimized")&&t.columnsOptimized.forEach((function(e){e.hasOwnProperty("label")&&delete e.label})),e.widget.setValue("LibraryCusto_treelistview_v1",r.jsonZip(JSON.stringify(t))),i.saveUserPreferences({name:e.widget.getValue("x3dAppId")+"_Library_v1",value:r.jsonZip(JSON.stringify(t)),onComplete:function(e){console.log("Saved as template")},onFailure:function(e){console.warn("Cannot save customization template")}})}))},onSwitchView:function(){var e=require("DS/LibraryEditor/ActionBar/LibraryCommandManager");console.log("sentinels: on Switch view update commands"),e.updateCommands()},onToggleView:function(){var e=require("DS/LibraryEditor/ActionBar/LibraryCommandManager");console.log("sentinels: on toggle view update commands"),e.updateCommands()}}}}};return r.init(e),r}define("DS/LibraryEditor/service/LibraryServices",["DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/service/LibraryTypeService","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],(function(e,t,i,r,n){"use strict";return{AddContent:function(i){if(!UWA.is(i.callbacks,"object"))throw new Error("No callbacks function defined");if(!UWA.is(i.callbacks.onComplete,"function"))throw new Error("No onComplete callback function defined");if(!UWA.is(i.callbacks.onFailure,"function"))throw new Error("No onFailure callback function defined");if(i.IDs.length>0){var r,n=i.library,a=(r=n||e.getCurrentLibrary())?r.id||r.getID():"";a&&a.length?t.addcontent({pid:a,IDs:i.IDs,onComplete:function(e){var t=e?JSON.parse(e):void 0;if(t&&t.error){var r=t.error;console.log("AddContent WebService Err : "+r),r.length>200&&(r=null),i.callbacks.onFailure(r)}else i.callbacks.onComplete(e)},onFailure:i.callbacks.onFailure,onTimeout:i.callbacks.onTimeout}):i.callbacks.onFailure(i)}else i.callbacks.onFailure(i)},RemoveContent:function(i){if(!UWA.is(i.callbacks,"object"))throw new Error("No callbacks function defined");if(!UWA.is(i.callbacks.onComplete,"function"))throw new Error("No onComplete callback function defined");if(!UWA.is(i.callbacks.onFailure,"function"))throw new Error("No onFailure callback function defined");if(i.IDs.length>0){var r,n=i.library,a=(r=n||e.getCurrentLibrary())?r.id||r.getID():"";a&&a.length?t.removecontent({pid:a,IDs:i.IDs,onComplete:function(e){var t=e?JSON.parse(e):void 0;if(t&&t.error){var r=t.error;console.log("Remove WebService Err : "+r),r.length>200&&(r=null),i.callbacks.onFailure(r)}else i.callbacks.onComplete(e)},onFailure:i.callbacks.onFailure,onTimeout:i.callbacks.onTimeout}):i.callbacks.onFailure(i)}else i.callbacks.onFailure(i)},getLatestRevision:function(e){if(!UWA.is(e.callbacks,"object"))throw new Error("No callbacks function defined");if(!UWA.is(e.callbacks.onComplete,"function"))throw new Error("No onComplete callback function defined");if(!UWA.is(e.callbacks.onFailure,"function"))throw new Error("No onFailure callback function defined");var i=e.objectsToTreat;t.getLatestRevision({objectsToTreat:i,onComplete:function(t){var i=t?JSON.parse(t):void 0;if(i&&i.error){var n=i.error;console.log("getLatestRevision WebService Err : "+n),n.length>200&&(n=null),i.information&&r.displayNotification({message:i.information,className:"primary"}),e.callbacks.onFailure(n)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure})},replaceContent:function(i){if(!UWA.is(i.callbacks,"object"))throw new Error("No callbacks function defined");if(!UWA.is(i.callbacks.onComplete,"function"))throw new Error("No onComplete callback function defined");if(!UWA.is(i.callbacks.onFailure,"function"))throw new Error("No onFailure callback function defined");var r=i.IDsRemoved.length;if(r===i.IDsAdded.length&&r>0){var n=e.getCurrentLibrary(),a=n?n.id||n.getID():"";a&&a.length?t.replaceContent({pid:a,IDsRemoved:i.IDsRemoved,IDsAdded:i.IDsAdded,onComplete:function(e){var t=e?JSON.parse(e):void 0;if(t&&t.error){var r=t.error;console.log("ReplaceContent WebService Err : "+r),r.length>200&&(r=null),i.callbacks.onFailure(r)}else i.callbacks.onComplete(e)},onFailure:i.callbacks.onFailure}):i.callbacks.onFailure(i)}else i.callbacks.onFailure(i)}}})),define("DS/LibraryEditor/commands/ActionBar_ExpandNCmd",["UWA/Core","DS/ApplicationFrame/Command"],(function(e,t){"use strict";return t.extend({labelTopBar:e.i18n("Expand N levels"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/IPClassifyUtil/IPClassifyAlert","DS/PADUtils/views/PADLevelSel","DS/LibraryEditor/utils/Library_CSO","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],(function(e,t,i,r){}))},beginExecute:function(){},execute:function(){var e=require("DS/IPClassifyUtil/IPClassifyAlert"),t=require("DS/PADUtils/views/PADLevelSel"),i=require("DS/LibraryEditor/utils/Library_CSO"),r=require("i18n!DS/LibraryEditor/assets/nls/LibraryEditor"),n=null;null===(n=i.getCurrentLibrary())?e.displayNotification({message:r.msg_warning_noselection,className:"warning"}):new t({css_style:"",events:{onApply:function(e){n.expandNLevels({numberOfLevelsToExpand:parseInt(e),initialLevel:n.getNodeDepth()})}}})},endExecute:function(){}})})),define("DS/LibraryEditor/utils/FilterUtils",["UWA/Class"],(function(e){"use strict";return e.singleton({init:function(e){this.libraryFilter='flattenedtaxonomies:"types/General Library"',this.classFilter=["General Class"],this.classTreeFilter='flattenedtaxonomies:"types/General Class"',this.endItemFilter=null,this.excludeBOTypesFromContentView=["Document Family","Part Family"]},setUQLFilter:function(e){this.endItemFilter=e},setFilters:function(e){for(var t,i=0;i<e.length;i++){var r,n,a=null,o=null;try{if((r=(a=e[i]).values)&&r.length>0){for(var s=0;s<r.length;s++)o=o&&null!=o?o+' OR "'+r[s]+'"':'"'+r[s]+'"';n="("+a.name+": ("+o+"))",t=t?t+" AND "+n:n}}catch(t){console.warn("Failed to decode","",e[i],t)}}this.endItemFilter=t},resetLibraryFilter:function(){this.libraryFilter=null},resetClassFilter:function(){this.classFilter=null},resetEndItemFilter:function(){this.endItemFilter=null}})})),define("DS/LibraryEditor/service/LibraryTypeService",["UWA/Controls/Abstract","text!DS/PADUtils/assets/PADOpenCommandsSettings.json"],(function(e,t){return e.singleton({TYPE_ROOT_LIBRARY_1:"General Library",TYPE_ROOT_LIBRARY_2:"Part Library",TYPE_ROOT_LIBRARY_3:"RootLibrary",TYPE_LIBRARY_1:"General Class",TYPE_LIBRARY_2:"Library",TYPE_LIBRARIES_SECTION:"LibrarySection_AllLibraries",TYPE_FAVORITES_SECTION:"LibrarySection_favorite",STANDARD_USAGE:"Standard",RELATIONSHIP_STANDARD_CLASSIFIED_ITEM:"Standard Classified Item",RELATIONSHIP_CLASSIFIED_ITEM:"Classified Item",RELATIONSHIP_SUBCLASS:"Subclass",TYPE_CONTENT:"Content",openTypes:[],getOpenAvailableForTypes:function(e){if(0==this.openTypes.length&&e){var i=JSON.parse(t);i["openInCAD_"+e+"_supported_types"]&&(this.openTypes=i["openInCAD_"+e+"_supported_types"])}return this.openTypes},init:function(){},isRootLibrary:function(e){return e===this.TYPE_ROOT_LIBRARY_1||e===this.TYPE_ROOT_LIBRARY_2||e===this.TYPE_ROOT_LIBRARY_3},isLibrary:function(e){return e===this.TYPE_LIBRARY_1||e===this.TYPE_LIBRARY_2},isContent:function(e){return e===this.TYPE_CONTENT},inFamilyLibrary:function(e){return this.isRootLibrary(e)||this.isLibrary(e)},isSection:function(e){return e===this.TYPE_LIBRARIES_SECTION||e===this.TYPE_FAVORITES_SECTION},getPlmTypeFromContentDetails:function(e){if(e&&!(e.length<1)){for(var t,i,r,n,a="Content",o=0,s=e.length;o<s;++o)if("flattenedtaxonomies"===e[o].name){if("types/Classification"===e[o].value?t=!0:"types/General Class"===e[o].value?i=!0:"types/Libraries"===e[o].value?r=!0:"types/General Library"===e[o].value&&(n=!0),"types/Classification"===e[o].value[0]&&"types/General Class"===e[o].value[1]){a="Library";break}if("types/Libraries"===e[o].value[0]&&"types/General Library"===e[o].value[1]){a="RootLibrary";break}}return t&&i&&(a="Library"),r&&n&&(a="RootLibrary"),a}},getPLMTypeOfLibraryTreeNode:function(e){var t="";if(e){var i=e.plmType;t="Library"==i?"General Class":"RootLibrary"==i?"General Library":i}return t}})})),define("DS/LibraryEditor/utils/LibraryEditorcontrol",["UWA/Controls/Abstract"],(function(e){return e.singleton({_Content:null,_TreeCont:null,_IdCardCont:null,_widgetOptions:{},getContent:function(){return this._Content},setContent:function(e){this._Content=e},getTreeCont:function(){return this._TreeCont},setTreeCont:function(e){this._TreeCont=e},getIdCardCont:function(){return this._IdCardCont},setIdCardCont:function(e){this._IdCardCont=e},setWidgetOptions:function(e){this._widgetOptions=e},getWidgetOptions:function(){return this._widgetOptions}})})),define("DS/LibraryEditor/LibraryWebInWin",["UWA/Widget","DS/i3DXCompass/Data","DS/WAFData/WAFData","DS/IPClassifyUtil/IPSettingsMgr","DS/IPClassifyUtil/IPClassifyUtility","DS/WidgetServices/WidgetServices","DS/PADServices/utils/WidgetProxy","UWA/Drivers/Alone"],(function(e,t,i,r,n,a,o){var s=window.library.params;s.userId&&(window.dsUserLogin=s.userId);var l=s.tenantId||s.tenant;function d(){return new Promise((async e=>{var t=await new Promise((e=>{a.get3DSpaceUrlAsync({onComplete:e,withoutTimeout:!0})}));if(t){var r=t+"/resources/modeler/pno/person?current=true&select=firstname&select=lastname",n={type:"json",method:"GET",headers:{Accept:"application/json"}};n.onComplete=e,n.onFailure=e.bind(null,!1),n.onTimeout=e.bind(null,!1),i.authenticatedRequest(r,n)}else e(null)}))}return new Promise((async i=>{window.widget=new e,console.log("Inside LibraryWebInWin"),widget.setValue("noCompass",!0),(l=l||n.getTenantId())&&(widget.setValue("x3dPlatformId",l),r.setSetting("x3dPlatformId",l),o.setValue("x3dPlatformId",l)),widget.body=UWA.createElement("div",{class:"libraryEditor",styles:{height:"100%",width:"100%"}}),window.COMPASS_CONFIG=window.COMPASS_CONFIG?window.COMPASS_CONFIG:{myAppsBaseUrl:s.myAppsUrl,userId:s.userId,lang:s.lang},t.initialize({myAppsBaseUrl:s.myAppsUrl,userId:s.userId,passportUrl:"",proxyTicketUrl:""}),document.body.getElement("#libTempDiv")&&document.body.getElement("#libTempDiv").remove(),widget.body.inject(document.body,"top");let a=await d();widget.userId=a.userId||a.name,widget.fullName=a.firstname+" "+a.lastname,widget.userId&&(window.dsUserLogin=widget.userId),window.performance.mark("createWidget_begin");var c=new LibraryEditor({widget:widget,filter:window.library.filter||window.library.UQLFilter,defaultSelectionPath:s.defaultSelectionPath,contextID:s.contextID});widget.dispatchEvent("onLoad"),widget.dispatchEvent("onRefresh"),widget.dispatchEvent("onDestroy"),widget.dispatchEvent("onResize"),i(c)}))})),define("DS/LibraryEditor/utils/LibrarySearch",["UWA/Class","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","text!DS/LibraryEditor/assets/library_exclude_columns.json"],(function(e,t,i){"use strict";return e.singleton({init:function(e){this._parent(e),this._predicateToHeaderMap=null,this._dynamicHeaderMap=[],this._dynamicMapSorted=!1,this._searchInfo=null,this._predAttrMap=new Map,this._attrPredicateMap=new Map,this._defaultPredicates=["ds6w:label","physicalid","mxid","owner","ds6w:classificationUsage","ds6w:status"],this._authModePredicates=["ds6w:label","physicalid","mxid","ds6w:description","ds6w:modified","ds6w:created","ds6w:responsible","ds6wg:revision","ds6w:type","ds6w:identifier","ds6w:status","ds6w:reservedBy","policy","owner","ds6w:classificationUsage"],this._authPersonAttributes=["ds6w:reservedby","ds6w:responsible"];this._searchInfo={with_indexing_date:!0,select_predicate:this._defaultPredicates.slice(0),select_file:["icon","thumbnail_2d"],order_field:"ds6w:modified",order_by:"desc",nresults:25}},getAuthModeNoSortColumns:function(e,t){var i=[],r=this;return Array.isArray(e)&&e.forEach((function(e){var n=e.ds6w||e.dataIndex;if(-1==r._authModePredicates.indexOf(n)){var a=e.attrDBName;a&&1==a.length?t&&i.push(e):t?(e.sortableFlag=!1,i.push(e)):i.push(n)}else t&&("ds6w:description"===e.ds6w&&(e.sortableFlag=!1),i.push(e))})),i},getOrderFiledForAuthMode:function(e){return-1==this._authModePredicates.indexOf(e)&&this._predAttrMap.get(e)?this._predAttrMap.get(e)[0]||"ds6w:modified":e},getSearchInfo:function(e,t){var i=Object.assign({},this._searchInfo);return!0===e?i.select_predicate=this._authModePredicates:t&&(i.select_predicate=this._authModePredicates.concat(this.getAuthAttributes())),i},filterExcludeListColumns:function(e){var t=[],r=JSON.parse(i);if(r){r=r.columnToExclude;for(var n=0;n<e.length;++n)-1==r.indexOf(e[n].dataIndex)&&t.push(e[n])}return t},getAuthAttributes:function(){var e=Array.from(this._predAttrMap.values());return e=e.filter((function(e){return null!=e})),[].concat.apply([],e)},setPredicates:function(e,t){var r=this,n=JSON.parse(i),a=[];n&&(a=n.predicateToExclude,n=n.columnToExclude),Array.isArray(e)&&e.forEach((function(e){if(e){var t=e.ds6w;t||(t=e.dataIndex),"tree"===t||e.isDynamic||-1===r._searchInfo.select_predicate.indexOf(t)&&-1===n.indexOf(t)&&-1===a.indexOf(t)&&r._searchInfo.select_predicate.push(t);var i=e.attrDBName;if(i)for(var o in r._predAttrMap.set(t,i),i)r._attrPredicateMap.set(i[o],t)}}))},removeAllPredicates:function(){this._searchInfo.select_predicate=[],this._predAttrMap=new Map,this._attrPredicateMap=new Map,this._searchInfo.select_predicate=this._searchInfo.select_predicate.concat(this._defaultPredicates)},removePredicates:function(e){for(var t=[],i=[],r=0;r<e.length;++r){i.push(e[r].dataIndex),this._predAttrMap.delete(e[r].dataIndex);var n=e[r].attrDBName||[];for(var a in n)this._attrPredicateMap.delete(n[a])}this._searchInfo.select_predicate.forEach((function(e){-1===i.indexOf(e)&&t.push(e)})),this._searchInfo.select_predicate=t},getPersonPredicatesForAuth:function(){return this._authPersonAttributes},setAttrNameToPredMapping:function(e){this._attrNameToPredMapping||(this._attrNameToPredMapping={}),this._attrNameToPredMapping&&e&&(this._attrNameToPredMapping[e.key]=e.value)},getAttrNameToPredMapping:function(){return this._attrNameToPredMapping||(this._attrNameToPredMapping={}),this._attrPredicateMap.forEach(((e,t)=>{this._attrNameToPredMapping[t]=e})),this._attrNameToPredMapping},resetAttrNameToPredMapping:function(){this._attrNameToPredMapping=null},setPredicateUnitMapping:function(e){UWA.extend(this.getPredicateUnitMapping(),e,!0)},getPredicateUnitMapping:function(){return this._predicateUnitMapping||(this._predicateUnitMapping={}),this._predicateUnitMapping},initPredicateToHeaderMap:function(e){if(!this._predicateToHeaderMap){this._predicateToHeaderMap=[];for(var t=0;t<e.length;t++){var i=e[t],r=i.text?i.text.toLowerCase():null;if(r&&i.ds6w){var n={header:r,predicate:i.ds6w};this._predicateToHeaderMap.push(n)}}}},addToPredicateHeaderMap:function(e){for(var t=0;t<e.length;++t){var i=e[t],r=i.text?i.text.toLowerCase():null;if(r&&i.ds6w){var n={header:r,predicate:i.ds6w};this._predicateToHeaderMap.push(n)}}},removeFromPredicateHeaderMap:function(e){this._predicateToHeaderMap=this._predicateToHeaderMap.filter((function(e){for(var t=0;t<this.length;++t)if(this[t].ds6w==e.predicate)return!1;return!0}),e)},addToDynamicHeaderMap:function(e){var t=e.text?e.text.toLowerCase():null;if(t&&e.dataIndex){var i={toolTip:e.text,header:t,dataIndex:e.dataIndex,dbAttribute:e.dbAttribute};this._dynamicHeaderMap.push(i)}},resetDynamicHeaderMap:function(){this._dynamicHeaderMap=[],this._dynamicMapSorted=!1},getDynamicHeaderMap:function(){return this._dynamicHeaderMap},convertSearchQueryToFederated:function(e){for(var t=e.split(""),i="",r="",n=0;n<t.length;n++)if(i+=t[n],":"==t[n]||"="==t[n]||">"==t[n]||"<"==t[n]){r=r.concat(this.replaceHeader(i));var a=e.substring(n+1).trim();if(a.startsWith("=")&&(r=r.concat("="),a=a.substring(1).trim()),a.startsWith('"')){r=r.concat('"');var o=(a=a.substring(1)).indexOf('"'),s=a.substring(0,o),l=s.trim().split(" ");if(2==l.length&&this._nlsUnitData&&this._nlsUnitData[l[1]]&&this._nlsUnitData[l[1]].factor){var d=l[0]*this._nlsUnitData[l[1]].factor+parseFloat(this._nlsUnitData[l[1]].offset);r=r.concat(d),this._nlsUnitData=null}else r=r.concat(s);r=r.concat('"'),a=a.substring(o+1)}else if(a.startsWith("(")){r=r.concat("(");var o=(a=a.substring(1)).indexOf(")");r=r.concat(a.substring(0,o+1)),a=a.substring(o+1)}-1!=(o=a.indexOf(" "))?(r=r.concat(a.substring(0,o+1)),a=a.substring(o+1),r=r.concat(this.convertSearchQueryToFederated(a))):r=r.concat(a);break}return""===r?e:r},replaceHeader:function(e){var t=e,i=this._predicateToHeaderMap;this._dynamicMapSorted||(this._dynamicHeaderMap=this._dynamicHeaderMap.sort((function(e,t){return t.header.length-e.header.length})),this._dynamicMapSorted=!0),i=i.concat(this._dynamicHeaderMap);for(var r=0;r<i.length;r++){var n=i[r].header,a=i[r].predicate?i[r].predicate:i[r].dataIndex,o=e.toLowerCase().indexOf(n);if(-1!=o){t=(t=(t=(t="").concat(e.substring(0,o))).concat("["+a+"]")).concat(e.substring(o+n.length)),this._predicateUnitMapping[a]&&(this._nlsUnitData=this._predicateUnitMapping[a].nlsToUnits);break}}return t}})})),define("DS/LibraryEditor/utils/LibraryEditorDataConversion",["DS/WebappsUtils/WebappsUtils","DS/LibraryEditor/service/LibraryTypeService","DS/PADServices/utils/AttributesMgt","DS/LibraryEditor/utils/LibrarySearch","DS/IPClassifyUtil/IPClassifyUtility"],(function(e,t,i,r,n){var a=function(e){var t=e.toLowerCase(),r=null;i.getAvailableColumns()&&(r=i.getAvailableColumns());var n=i.getTreeColumn(),a=null;return Array.isArray(r)&&r.every((function(e){return"tree"===e&&(e=n),t==e.toLowerCase()&&(a=e),null===a})),a=a||e},o={convertToExaleadDataFormatFederated:function(e){var t={children:null},i=e.attributes,o=r.getAttrNameToPredMapping(),s=r.getPredicateUnitMapping(),l={"ds6w:type":"type","ds6w:label":"label"},d={},c={};for(var u in i.forEach((function(e){if("resourceid"==e.name||"physicalid"==e.name)t.physicalid=e.value,t.resourceid=e.value;else if("mxid"==e.name)t.mxid=e.value;else if("nonNlsStatus"==e.name)t.status=e.value;else if("type_icon_url"===e.name)t.icons=[e.value];else if("preview_url"===e.name)t.thumbnail=e.value;else if(e.name.endsWith("inputunit")){if((f=e.name.substring(0,e.name.length-9)).startsWith("attribute["))f=f.substring(0,f.length-1);else(g=s.generatedPredicates)&&g[f]&&(f=g[f]);var i=c[a(f)];o[h=f]&&(h=o[f]);var r=s[f],u=e.value;r&&r[e.value]&&(u=r[e.value]),i?(c[a(f)]=i+" "+u,c[h]=i+" "+u):(c[a(f)]=u,c[h]=u)}else if(e.name.endsWith("inputvalue")){var f,g;if((f=e.name.substring(0,e.name.length-10)).startsWith("attribute["))f=f.substring(0,f.length-1);else(g=s.generatedPredicates)&&g[f]&&(f=g[f]);i=c[a(f)];o[h=f]&&(h=o[f]);u=e.value;i?(c[a(f)]=u+" "+i,c[h]=u+" "+i):(c[a(f)]=u,c[h]=u)}else if(e.name.startsWith("ds6w")){var p=e.name.split("/");if("ds6w:type"===(h=p[p.length-1])&&(S=e.value,["CATIA Embedded Component","CATPart","CATProduct","CATProcess","CATDrawing","CATAnalysis","CATShape"].indexOf(S)>=0)?t.children=[]:"ds6w:created"===h&&(t.created=e.value),(u=e.object?e.object:e.dispValue)&&"boolean"!==e.type||(u=e.value),o[h]&&(h=o[h]),d[h]){u=[u];var y=d[h];Array.isArray(y)||(y=[y]),u=u.concat(y)}if("ds6w:created"===h||"ds6w:modified"===h)if(u.indexOf("T")<0&&(!n.isOnPremise()||n.isOnPremise()&&!0===n.isIndexedMode())){u=new Date(u);var m=new Date(u).getTimezoneOffset();u=new Date(new Date(u).getTime()+Math.abs(60*m*1e3))}else u=new Date(u);d[h]=u,d[e.name]=u;var b=l[h];b&&(t[b]=u,"ds6w:type"===h&&e.value&&(t[b]=e.value))}else if(e.value&&e.value.length>0){var h=e.name;o[h]&&(h=o[h]);var v=d[a(e.name)]||d[h];if(v)if(Array.isArray(v))v.push(e.value);else{var C=[v,e.value];d[a(e.name)]=C,d[h]=C}else{var _=e.value;-1!=_.indexOf(",")&&(_=_.split(",")),d[a(e.name)]=_,d[h]=_}}var S})),e.id||(e.id=t.resourceid),s)if(d[u+"_mksvalue"]=d[u],c[u])d[u]=c[u];else if(d[u]&&s[u]){var f=d[u];if(Array.isArray(f)){var g=[];f.forEach((function(e){if(e){var t=+e;t=t.toString().indexOf(".")>-1?t:t+".0",g.push(t+" "+s[u].defaultUnit)}})),d[u]=g}else{var p=+f;p=p.toString().indexOf(".")>-1?p:p+".0",d[u]=p+" "+s[u].defaultUnit}}return t.grid=d,t.padgrid={"ds6w:leaf":"False","ds6w:root":"True"},t},convertExpandToSearchFormat:function(e,t){var i=[];return t.forEach((function(t){var r=!1;t.attributes&&t.attributes.forEach((function(t){"physicalid"===t.name&&t.value!=e&&(r=!0)})),r&&i.push(t)})),i},convertNavigateToSearchFormat:function(e){var t=[],i=e[0].outputs.GET_CONTENT;return i&&i.forEach((function(e){var i=[];for(var r in e)i.push({name:r,value:e[r]});t.push({attributes:i})})),t},convertNavigateToFlatFormat:function(e,t){var i=[];if(t.length<=0)return i;for(var r=t[0],n=r.input_object,a=r.outputs,o=e,s=0;o>0;o--){var l=a["GET_PARENT_"+o+"_LIBRARY"];l&&((l=l[0]).level=s++,i.push(l))}return i.push(n),i},getLibraryDepth:function(e){var t=e.results[0].attributes,i=[];return t.forEach((function(e){"classification"===e.name&&i.push(e.value)})),i.length+1},getPathsAndObjectsFromExpand:function(e){if(e&&!(e.length<=0)){for(var t=[],i={},r={},n={},a=0,s=e.length;a<s;++a){var l=e[a];if(l.attributes){for(var d,c,u=!0,f=0,g=l.attributes.length;f<g;++f)"physicalid"===l.attributes[f].name?(u=!1,c=l.attributes[f].value):"did"===l.attributes[f].name&&(d=l.attributes[f].value);u||(i[c]=l,r[d]=c)}else if(l.path)t.push(l.path);else if(l.Path)t.push(l.Path);else if(l.icon__default_thumbnail_2d)for(var p=0;p<l.icon__default_thumbnail_2d.length;p++)for(var y=l.icon__default_thumbnail_2d[p].did,m=0;m<y.length;m++){var b=[];b.push(l.icon__default_thumbnail_2d[p].icon),b.push(l.icon__default_thumbnail_2d[p].thumbnail_2d),n[y[m]]=b}}for(var h in i)for(var v,C=i[h],_=0;_<C.attributes.length;_++)if("did"===C.attributes[_].name){v=C.attributes[_].value,C.attributes.push({name:"icons",value:n[v]});break}for(var S in i){var L=i[S],E=o.convertToExaleadDataFormatFederated(L);i[S]=E}var D=[];for(a=0;a<t.length;++a){var A=t[a],w=[];for(f=0;f<A.length;f+=2)w.push(r[A[f]]);D.push(w)}return{paths:D,objects:i}}}};return o})),define("DS/LibraryEditor/commands/ChangeMaturityFilterCmd",["i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/service/LibraryTypeService"],(function(e,t,i){"use strict";return{applyMaturityFilter:function(e){var i=widget.getValue("filteredStates"),r=e.context;if("AllMaturityStates"!=r||"selected"!==i[r]){var n=function(e,t){var i=!0;if("selected"===e[t])for(const r in e)r!=t&&"selected"==e[r]&&(i=!1);else i=!1;return i}(i,r);if(!n){var a=[];for(const e in i)if("AllMaturityStates"!=e&&"selected"==i[e]){if(e==r)continue;a.push(e)}"unselected"==i[r]&&a.push(r),function(e,i){var r,n=t.getIdCardCont()._libraryCSO.getCurrentObject().plmType;if("LibrarySection_AllLibraries"!=n&&"LibrarySection_favorite"!=n&&"AllMaturityStates"!=e){r=t.getIdCardCont()._libraryCSO.getCurrentObject().options.grid["ds6w:status"];var a=!0;for(const e of i)if(r=="Classification."+e||r=="Libraries."+e){a=!1;break}if(a){var o=t.getTreeCont().getView()._rootNodeLibraries;o.getID||(o.getID=function(){return this.id}),o.getType||(o.getType=function(){return this.plmType}),t.getIdCardCont()._libraryCSO.addInCSO(o,"TREE")}}}(r,a),t.getTreeCont().dataProvider.updateMenuForStatesFilter(r),console.log("states applied "+a.toString())}}},switchToAllMaturityFilterIfPathNotCompliant:function(e){var i=widget.getValue("filteredStates");if("selected"!=i.AllMaturityStates){var r=[];for(const e in i)"AllMaturityStates"!=e&&"selected"==i[e]&&r.push(e);var n="";if(Array.isArray(e))for(var a=0;a<e.length;a++){n=e[a]._options?e[a]._options.grid["ds6w:status"]?e[a]._options.grid["ds6w:status"]:e[a]._options.status:e[a]["ds6w:status"];var o=!0;for(const e of r)n!="Classification."+e&&n!="Libraries."+e||(o=!1);if(o)break}else{n=e._options?e._options.grid["ds6w:status"]?e._options.grid["ds6w:status"]:e._options.status:e["ds6w:status"];o=!0;for(const e of r)if(n=="Classification."+e||n=="Libraries."+e){o=!1;break}}o&&t.getTreeCont().dataProvider.updateMenuForStatesFilter("AllMaturityStates",!0)}}}})),define("DS/LibraryEditor/commands/ChangeMaturityFilterCmdUtil",["i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/service/LibraryTypeService"],(function(e,t,i){"use strict";return{getMaturityFilterForIndexedSearch:function(e){var t=widget.getValue("filteredStates");e||(e={});var i={"ds6w:what/ds6w:status":[]},r=[];if("selected"==t.AllMaturityStates)return e;for(const e in t)"AllMaturityStates"!=e&&"unselected"==t[e]&&r.push(e);if(0==r.length)return e;if(r.forEach((e=>{let t={object:"Classification."+e,type:"string",field:"internal",excluded:"true"},r={object:"Libraries."+e,type:"string",field:"internal",excluded:"true"};i["ds6w:what/ds6w:status"].push(t),i["ds6w:what/ds6w:status"].push(r)})),e)for(const t in e)"ds6w:what/ds6w:status"==t?i["ds6w:what/ds6w:status"]=i["ds6w:what/ds6w:status"].concat(e[t]):i[t]=e[t];return i},getFiltersForExpand:function(){var e=widget.getValue("filteredStates"),t="";if("selected"==e.AllMaturityStates)return t;for(const i in e)"AllMaturityStates"!=i&&"selected"==e[i]&&("Private"==i?(""!=t&&(t+=" OR "),t+="([ds6w:status]:Classification.Inactive) OR ([ds6w:status]:Libraries.Inactive)"):(""!=t&&(t+=" OR "),t=t+"([ds6w:status]:Classification."+i+") OR ([ds6w:status]:Libraries."+i+")"));return"AND ("+t+")"},getMaturityFilterForAuthSearch:function(){var e=widget.getValue("filteredStates"),t=[];if("selected"==e.AllMaturityStates)return t;for(const i in e)"AllMaturityStates"!=i&&"selected"==e[i]&&t.push(i);return t}}})),define("DS/LibraryEditor/service/LibraryEditorWebService",["UWA/Core","DS/WAFData/WAFData","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/IPClassifyUtil/IPSettingsMgr","DS/LibraryEditor/utils/LibrarySearch","DS/LibraryEditor/utils/FilterUtils","DS/IPClassifyUtil/IPClassifyUtility","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/commands/ChangeMaturityFilterCmdUtil"],(function(e,t,i,r,n,a,o,s,l){"use strict";function d(e){return UWA.is(e,"array")?e.toString():e}return{_pageCount:50,content:function(e){var t={};UWA.extend(t,e);var i=a.endItemFilter,r=!1;i&&null!=i?("Library"==t.selectedType&&(r=!0),i=" AND ("+i+")"):i="";var o="";if(t.searchQuery)t.isSearchWithin=!0,e.isExactSearch?(o=n.convertSearchQueryToFederated(e.searchQuery),o="classification: "+e.mxid+' AND NOT (flattenedtaxonomies: ("types/Part Family" OR "types/Document Family"))'+i+" AND ("+o+")"):o="("+e.searchQuery.trim()+") AND classification: "+e.mxid+' AND NOT (flattenedtaxonomies: ("types/Part Family" OR "types/Document Family"))'+i;else if(r)1==e.isAuthoringMode||(o='flattenedtaxonomies:"types/General Class" OR ('+a.endItemFilter+")",t.isExpand=!0);else{o=function(e,t,i){if(t&&t.length>0){var r="";!0===i&&(r="NOT");for(var n=0,a=t.length;n<a;++n)e=e?e+" AND "+r+'(type == "'+t[n]+'" )':r+'( type == "'+t[n]+'" )'}return e}(o,a.excludeBOTypesFromContentView,!0),t.isExpand=!0}!0===t.isExpand&&t.pid&&(o=o+" AND NOT( physicalid == "+t.pid+")"),e.dateUqlQuery&&(o=o+" AND "+e.dateUqlQuery),"Library"==t.selectedType&&(t.dynamicattrs=t.dynamicattributes),t.searchPageCount=this._pageCount,this._performSearchQuery(t,o,"content")},roots:function(e){var t='flattenedtaxonomies:"types/Libraries"',i=a.libraryFilter;i&&null!=i&&(t=i),!0!==e.fetchAll&&(e.searchPageCount=this._pageCount),e.searchQuery&&(t=t+" AND "+e.searchQuery),this._performSearchQuery(e,t,"roots")},favourites:function(e){this._performFetchQuery(e,"favourites")},libraries:function(e){var t={};UWA.extend(t,e),t.expand_iter="1",e.isExpandAll&&(t.expand_iter="-1");var i=a.classTreeFilter;t.filter=i,this._performExpandQuery(t,"libraries")},checkModifyAccessOnItems:function(e){var t=e;if(!UWA.is(t,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.addcontent");var i=o.get3DSpaceUrl()+"/resources/IPClassificationReuse/classifiedItem/checkModifyAccess";if(t.headers={"content-type":"application/json"},t.informationPanelContext){let e=t.informationPanelContext?encodeURIComponent(t.informationPanelContext):t.informationPanelContext;t.headers.SecurityContext=e}1==e.withChangeCtx&&(t.headers=Object.assign(t.headers,o.getWorkUnderHeaders())),t.data={objectIds:e.objectIds},t.data=UWA.Json.encode(t.data),t.method="POST",t.timeout=12e4,this._executeRequest(i,t,"checkModifyAccess")},addcontent:function(e){var t=e;if(!UWA.is(t,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.addcontent");var i=o.get3DSpaceUrl()+"/resources/IPClassificationReuse/class/"+t.pid+"/addItemsV2";if(t.headers={"content-type":"application/json"},t.IDs){var r=t.IDs,n=[];r.forEach((function(e){n.push({id:e})})),t.data={objectId:n},t.data=UWA.Json.encode(t.data)}t.method="POST",t.timeout=12e4,this._executeRequest(i,t,"addContent")},replaceContent:function(e){var t=e;if(!UWA.is(t,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.replaceContent");var i=o.get3DSpaceUrl()+"/resources/IPClassificationReuse/class/"+t.pid+"/replaceByRevision";t.headers={"content-type":"application/json"},t.IDsRemoved&&t.IDsAdded&&(t.data={IDsRemoved:d(t.IDsRemoved),IDsAdded:d(t.IDsAdded)},t.data=UWA.Json.encode(t.data)),t.method="POST",t.timeout=12e4,this._executeRequest(i,t,"replaceContent")},getLatestRevision:function(e){var t=e;if(!UWA.is(t,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.getLatestRevision");var i=o.get3DSpaceUrl()+"/resources/v1/dslc/getlastversions?validIntents=E&";t.headers={"content-type":"application/json"};var r=t.objectsToTreat;r&&(t.data=r),t.data=UWA.Json.encode(t.data),t.method="POST",t.timeout=12e4,this._executeRequest(i,t,"getLatestRevision")},removecontent:function(e){var t=e;if(!UWA.is(t,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.removecontent");var i=o.get3DSpaceUrl()+"/resources/IPClassificationReuse/class/"+t.pid+"/removeClassifiedItems";if(t.headers={"content-type":"application/json"},t.IDs){var r=[];t.IDs.forEach((function(e){r.push({id:e})})),t.data={objectId:r},t.data=UWA.Json.encode(t.data)}t.method="POST",t.timeout=12e4,this._executeRequest(i,t,"removeContent")},getLibraryPathLength:function(e){e.fetchClassification=!0,this._performFetchQuery(e,"getLibraryPathLength")},getLibraryPath:function(e){var t={};UWA.extend(t,e);for(var i={},r=t.depth,n=1;n<=r;n++)i["GET_PARENT_"+n+"_LIBRARY"]=[{id:2,iter:n}];t.patterns=i,this._performNavigateQuery(t,"getLibraryPath")},_performNavigateQuery:function(e){if(!UWA.is(e,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.content");var t={};UWA.extend(t,e);var i=r.getSetting("pad_security_ctx"),s=o.get3DSpaceUrl()+"/cvservlet/navigate";s+="?SecurityContext="+encodeURIComponent(i);var l=widget.lang?widget.lang:widget.getValue("lang"),d=[];d.push(e.pid),t.payload={},t.payload.input_physical_ids=d;var c=a.classFilter;c&&null!=c&&"RootLibrary"==e.selectedType?t.payload.primitives=[{navigate_to_rel:{id:1,filter:{bo_type:c}},navigate_from_rel:{id:2}}]:t.payload.primitives=[{navigate_to_rel:{id:1},navigate_from_rel:{id:2}}],t.payload.patterns=t.patterns;var u=n.getSearchInfo(!0).select_predicate;if(u=u.concat(["flattenedtaxonomies"]),e.dynamicattrs&&e.dynamicattrs.length>0){var f=u.concat(e.dynamicattrs);t.payload.attributes=f}else t.payload.attributes=u;t.payload.version=3;var g=new Date;return t.payload.label=("LibraryWidgetNavigate_"+g.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":l},t.type="json",t.data=UWA.Json.encode(t.payload),this._executeRequest(s,t,"searchInLibrary")},_performExpandQueryIndex:function(e,t,i){var n={};UWA.extend(n,e);let a=o.get3DSpaceUrl()+"/cvservlet/progressiveexpand/v2?output_format=cvjson",s=[];n.pid&&(n.children||(n.children=[]),n.children.push(n.pid));var d='((flattenedtaxonomies:"types/General Class")OR (flattenedtaxonomies:"types/General Library")) '+l.getFiltersForExpand();return n.children.forEach(((e,i)=>{let r={label:t+"_"+i,root:{physical_id:e},parameters:{graph_advise:1,limit_max_path:1e4},graph:{descending_condition_object:{uql:d}},filter:{all:1}};n.expand_iter>=0&&(r.aggregation_processors=[{truncate:{max_distance_from_prefix:n.expand_iter,prefix_filter:{prefix_path:[{physical_id_path:[e]}]}}}]),s.push(r)})),n.payload={batch:{expands:s},outputs:{select_object:i,format:"entity_relation_occurrence",hits:{predefined_computation:["mythumbnail2d","icons"]}}},n.headers={"content-type":"application/json",SecurityToken:o.getUserLogin()+"|"+r.getSetting("pad_security_ctx")+"|preferred"},n.type="json",n.data=UWA.Json.encode(n.payload),n.method="POST",this._executeRequest(a,n,"expandFolder")},_performExpandQuery:function(e){if(!UWA.is(e,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.content");var t=n.getSearchInfo(!0).select_predicate;t=t.concat(["flattenedtaxonomies"]);var i=["svg","bi_color"],r=t.filter((function(e){return i.indexOf(e)<0}));let a=("LibraryWidgetExpand_"+(new Date).getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-");return e.dynamicattrs&&e.dynamicattrs.length>0&&(r=r.concat(e.dynamicattrs)),this._performExpandQueryIndex(e,a,r)},_performFetchQuery:function(e){if(!UWA.is(e,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.content");var t={};UWA.extend(t,e);var i=r.getSetting("pad_security_ctx"),a=o.get3DSpaceUrl()+"/cvservlet/fetch/v2",s=widget.lang?widget.lang:widget.getValue("lang"),l=n.getSearchInfo(!1,e.isAuthoringMode).select_predicate;l=l.concat(["flattenedtaxonomies"]),t.payload={},e.dynamicAttrs&&e.dynamicAttrs.length>0&&(t.payload.classification_attribute=e.dynamicAttrs,e.dynamicAttrs.forEach((function(e){-1===l.indexOf(e)&&l.push(e)})));var d=["svg","bi_color"],c=l.filter((function(e){return d.indexOf(e)<0}));!0===e.fetchClassification&&c.push("classification"),t.payload.physicalid=t.ids,t.payload.select_predicate=c,!0===e.isAuthoringMode&&(a=o.get3DSpaceUrl()+"/resources/IPClassificationReuse/classifiedItem/getContentDetails",t.payload.person_predicate=n.getPersonPredicatesForAuth(),t.payload.compute_select_bo=["icon","thumbnail_2d"]);var u=new Date;return t.payload.label=("LibraryWidgetFetch_"+u.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":s,SecurityToken:o.getUserLogin()+"|"+i+"|preferred"},t.type="json",t.data=UWA.Json.encode(t.payload),this._executeRequest(a,t,"Fetch")},_performSearchQuery:function(e,t){var i;if(e&&e.grid&&(i=e.grid["ds6w:classificationUsage"]),!UWA.is(e,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.content");var a={};UWA.extend(a,e);var s=o.get3DSearchUrl()+"/search",d=widget.lang?widget.lang:widget.getValue("lang");a.payload=Object.assign({},n.getSearchInfo(!1,e.isAuthoringMode));var c=a.payload.select_predicate;if(a.securityContextRequired=!1,!0===e.isAuthoringMode){a.securityContextRequired=!0,s=o.get3DSpaceUrl()+"/resources/IPClassificationReuse/Search/search",a.payload.person_predicate=n.getPersonPredicatesForAuth(),a.payload.root_physicalid=e.pid;var u=l.getMaturityFilterForAuthSearch();u.length&&(a.payload.states_to_fetch=u)}c=c.concat(["flattenedtaxonomies"]),e.dynamicattributes&&e.dynamicattributes.length>0&&(c=c.concat(e.dynamicattributes)),a.payload.select_predicate=c;var f=new Date,g=Math.random();g.toString(36);var p=this.getRelationsByUsage(i),y=g.toString(36).substr(2,9);return a.payload.label=("LibraryWidgetSearch_"+y+"_"+f.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),a.payload.locale=d,a.payload.query=t,a.payload.tenant=o.getTenantId(),a.payload.next_start=e.next_start,a.payload.start=e.start,a.method="POST",a.headers={Accept:"application/json","content-type":"application/json","Accept-Language":d,SecurityContext:encodeURIComponent(r.getSetting("pad_security_ctx"))},a.type="json",e.order_field&&(e.isAuthoringMode?a.payload.order_field=n.getOrderFiledForAuthMode(e.order_field):a.payload.order_field=e.order_field,a.payload.order_by=e.order_by),e.searchPageCount&&(a.payload.nresults=e.searchPageCount),!0===e.fetchAll&&(a.payload.nresults=1e3),i&&(a.payload.usage=i),e.isAuthoringMode||(a.payload.source=["3dspace"],a.payload.login={"3dspace":{SecurityContext:r.getSetting("pad_security_ctx")}},e.isExpand?a.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_physicalid:e.pid,expand_iter:"1",type_filter_rel:p}},option:{with_Idx_Search:!0,with_synthesis_ranged:!0}}}:e.isSearchWithin&&(a.payload.specific_source_parameter={"3dspace":{option:{with_Idx_Search:!0}}}),e.filters&&(a.payload.refine=e.filters),a.payload.refine=l.getMaturityFilterForIndexedSearch(e.filters)),a.data=UWA.Json.encode(a.payload),this._executeRequest(s,a,"searchInLibrary")},_executeRequest:function(e,n,a){var o=Math.round(1e3*Math.random()).toString(),s=widget.id+"_"+widget.getTitle()+"_";window.performance.mark("libraryRequest_begin"+o);var l={};if(UWA.extend(l,n),!l.payload&&e.indexOf("cvservlet")>-1){l.payload={};var d=new Date;l.payload.label=("LibraryWidgetExecute_"+d.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-")}UWA.is(l.onTimeout,"function")||(l.onTimeout=function(){var e={type:"timeout",toString:function(){return i.msg_InfoAction_Timeout}};l.onFailure(e)},l.onComplete=function(e){window.performance.mark("libraryRequest_end"+o);var t=window.performance.getEntriesByName("libraryRequest_begin"+o);t&&1===t.length&&(window.performance.measure(s+"_Request"+a,"libraryRequest_begin"+o,"libraryRequest_end"+o),window.performance.clearMarks("libraryRequest_end"+o),window.performance.clearMarks("libraryRequest_begin"+o)),n.onComplete(e)});var c={Accept:"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang")};let u=r.getSetting("pad_security_ctx");if(!1!==l.securityContextRequired){let e=u?encodeURIComponent(u):u;c.SecurityContext=e}if(l.informationPanelContext){let e=l.informationPanelContext?encodeURIComponent(l.informationPanelContext):l.informationPanelContext;c.SecurityContext=e}return n.headers?l.headers=UWA.extend(c,n.headers):l.headers=c,(l.timeout||l.timeout<12e4)&&(l.timeout=12e4),t.authenticatedRequest(e,l)},getClassificationAttributes:function(e){var t=e;if(!UWA.is(t,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.getClassificationAttributes");var i=o.get3DSpaceUrl()+"/resources/IPClassificationReuse/class/"+t.classid+"/getclassificationattributes?timezoneOffset="+(new Date).getTimezoneOffset()/60;return t.method="GET",this._executeRequest(i,t,"getClassificationAttributes")},getDimensionsInfos:function(e){return this._executeRequest(o.get3DSpaceUrl()+"/resources/dictionary/dimensions",e,"getDimensionsInfos")},convertDimensionUnits:function(e){if(!UWA.is(e,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.convertDimensionUnits");var t=o.get3DSpaceUrl()+"/resources/dictionary/dimensions/convertValues",i={};return UWA.extend(i,e),i.payload=e.data,i.method="POST",i.headers={Accept:"application/json","content-type":"application/json"},i.data=UWA.Json.encode(i.payload),this._executeRequest(t,i,"convertToPreferedUnit")},getRelationsByUsage:function(e){var t=[s.RELATIONSHIP_SUBCLASS];return e===s.STANDARD_USAGE?t.push(s.RELATIONSHIP_STANDARD_CLASSIFIED_ITEM):t.push(s.RELATIONSHIP_CLASSIFIED_ITEM),t},fetchExistingClassesAndAttributes:async function(e){var t,i=e;if(!UWA.is(i,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.getClassificationAttributes");return t=o.get3DSpaceUrl()+"/resources/IPClassificationReuse/classifiedItem/"+e.objectId+"/getAllClassesAndAttributes",i.method="GET",this._executeRequest(t,i,"fetchExistingClassesAndAttributes")},getClassificationAttributesForClassifedObjectOnOneClass:function(e){if(!UWA.is(e,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.convertDimensionUnits");var t=o.get3DSpaceUrl()+"/resources/IPClassificationReuse/classifiedItem/getAttributesOfObjectForClass",i={};return UWA.extend(i,e),i.payload=e.data,i.method="POST",i.headers={Accept:"application/json","content-type":"application/json"},i.data=UWA.Json.encode(i.payload),this._executeRequest(t,i,"getClassificationAttributesForClassifedObjectOnOneClass")},updateAttributesFromInformationPanel:function(e){console.log("Calls Libraryeditorwebservice",e);var t={};UWA.extend(t,e);var i={requests:[]};(new Date).getTime();var r={method:"PATCH",body:[],queryParams:{select:["physicalid","modified"]}};r.path="model/bus/"+e.pid,r.classUsage=e.classUsage,r.classId=e.classId,r.body=[];var n={op:"replace"};n.path=e.attributeName,Array.isArray(e.value)?n.value=e.value.slice():n.value=e.value,null!=e.unit&&(n.unitName=e.unit,n.dimensionType=e.dimension),r.body.push(n),r.queryParams.select.push("attribute["+e.attributeName+"]"),i.requests.push(r),t.method="POST",t.headers={Accept:"application/json","content-type":"application/json"},t.type="json",t.payload=i,t.data=UWA.Json.encode(t.payload);var a=o.get3DSpaceUrl()+"/resources/IPClassificationReuse/classifiedItem/attributes/update",s=this._executeRequest(a,t,"updateAttributes");return console.log(s),s}}})),define("DS/LibraryEditor/utils/Library_CSO",["DS/Selection/XSO","DS/Logger/Logger","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/commands/ChangeMaturityFilterCmd","DS/IPClassifyUX/IPClassifyUXEvents","DS/LibraryEditor/utils/LibraryEditorDataConversion","DS/PADUtils/PADProbes"],(function(e,t,i,r,n,a,o,s){"use strict";var l=e.singleton({name:"library_cso",_logger:null,_currentLibrary:null,init:function(e){var i={areEquals:function(e,t){return e===t}};UWA.extend(i,e),this._parent(i),this._logger=t.getLogger(l);var r=this;this.onPostAdd((function(e){var t="CONTENT";UWA.is(e,"array")&&(e=e[0]),e&&UWA.is(e.getID,"function")&&e.getID()==r.getCurrentLibraryID()&&(t="TREE"),UWA.is(e)&&a.notifyLibrarySelected({context:t,selectedNode:e})}))},addInLibraryCSO:function(e,t){if(!UWA.is(e))throw new Error("No libraryNode specified");if(!UWA.is(t))throw new Error("No context specified");if("TREE"==(t=t.toUpperCase())){var s=this;this.empty(!1);var l=this._currentLibrary;this._currentLibrary=e;var d=function(e,t){a.notifyCurrentLibraryChange({previousNode:e,currentNode:t}),s.add(t)};this._currentLibraryPath=[{id:e.id,type:i.getPLMTypeOfLibraryTreeNode(e),label:e.getLabel(),mxid:e.options.mxid}];var c=!1;if(i.inFamilyLibrary(e.plmType)){if(e.isVisible&&e.isVisible()&&e.getPath){var u=e.getPath();if(Array.isArray(u)&&u.length>=2&&u[0]&&"LibrarySection_AllLibraries"===u[0].plmType){this._currentLibraryPath=[];for(var f=1;f<u.length;f++){var g=u[f];this._currentLibraryPath.push({id:g.id,type:i.getPLMTypeOfLibraryTreeNode(g),label:g.getLabel()})}c=!0}}}else c=!0;c?d(l,e):r.getLibraryPathLength({ids:[e.id],onComplete:function(t){!t.results&&t.error&&(s._logger.warn("Unable to retrieve LibraryPath using Index/Search"),d(l,s._currentLibrary));var i=o.getLibraryDepth(t);if(1===i){var a={};a.id=e.id,a.type=e.plmType,a.label=e.options.label,n.switchToAllMaturityFilterIfPathNotCompliant(e),s._currentLibrary&&a.id==s._currentLibrary.id?(s._currentLibraryPath=[],s._currentLibraryPath.push({id:a.id,type:a.type,label:a.label}),d(l,s._currentLibrary)):s._logger.log("LibraryPath returned by Index do not corresponds to the current Library")}else if(i>1){var c=i-1;r.getLibraryPath({depth:c,pid:e.id,onComplete:function(e){var t=o.convertNavigateToFlatFormat(c,e.result);n.switchToAllMaturityFilterIfPathNotCompliant(t),s._currentLibrary&&t[i-1].physicalid==s._currentLibrary.id&&(s._currentLibraryPath=[],t.forEach((function(e){s._currentLibraryPath.push({id:e.physicalid,type:e["ds6w:type"],label:e["ds6w:label"]})})),d(l,s._currentLibrary))},onFailure:function(e){s._logger.warn("Unable to retrieve LibraryPath using Index/Navigate"),d(l,s._currentLibrary)}})}},onFailure:function(e){s._logger.warn("Unable to retrieve LibraryPathLength using Index/Search"),d(l,s._currentLibrary)}})}else{this.empty(!1);var p=null;0===(p="array"==UWA.typeOf(e)?e:[e]).length?this.add(this._currentLibrary):this.add(p)}},removeFromLibraryCSO:function(e){if(!UWA.is(e))throw new Error("No libraryNode specified");this.remove(e),0===this.getSelectedNodes().length&&e!=this._currentLibrary&&this.add(this._currentLibrary)},removeAllFromLibraryCSO:function(){this.empty(!0)},getCurrentLibrary:function(){return this._currentLibrary},getCurrentLibraryID:function(){var e=null;return this._currentLibrary&&this._currentLibrary.getID&&(e=this._currentLibrary.getID()),e},getCurrentLibraryPath:function(){var e=[];return this._currentLibraryPath&&this._currentLibraryPath.forEach((function(t){e.push({id:t.id,type:t.type,label:t.label})})),e},getSelectedNodes:function(){var e=[];return this.get()&&this.get().forEach((function(t){e.push(t)})),e},getSelectedNodesID:function(){var e=[];return this.get()&&this.get().forEach((function(t){e.push(t.getID())})),e}});return l})),define("DS/LibraryEditor/commands/ActionBar_ReplaceByRevision",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/IPClassifyUtility","DS/LibraryEditor/utils/Library_CSO","DS/PADUtils/PADUtilsServices","DS/IPClassifyUtil/IPSettingsMgr","DS/ENOXVersionExplorerController/VersionExplorerController","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerViews/VersionExplorerModal","DS/IPClassifyUtil/IPClassifyAlert","DS/LibraryEditor/service/LibraryServices","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/IPClassifyUX/utils/IPClassifyModeManager"],(function(e,t,i,r,n,a,o,s,l,d,c,u,f,g){"use strict";return t.extend({labelTopBar:e.i18n("Replace By Revision"),isInsert:!0,_selectedNodes:null,init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},execute:function(){var e=null;if(1==(e=null===this._selectedNodes?r.getSelectedNodes():this._selectedNodes).length){var t=this.validPhysicalIDtobeReplaced=e[0].getID();this._launchVersionExplorer(t),this.end()}else c.displayNotification({message:f.msg_warning_replaceByRevision_MultiObject,className:"warning"})},endExecute:function(){this._selectedNodes=null},_launchVersionExplorer:function(t){var i=this,r=e.createElement("div",{class:"revisionUpdate-dialog-versionexplorer"}).inject(document.body);this._myVersionExplorer=new o({versionGraphContainer:null,selectionMode:l.SELECTION_MODES.SINGLE_SELECT_ONLY,widget:widget}),this._myVersionExplorer.disableDrag(),this._myVersionExplorer.showDialog({x:100,y:100},r,!0),s.loadUserSettingsPromise({displayMode:l.DISPLAY_MODES.SUBWAY_VIEW,displayLegend:!0},!0),this._myVersionExplorer.publishEvent("ENOXVersionExplorerLoadVersionModel",{id:i.validPhysicalIDtobeReplaced,tenantId:n.getPlatformId()?n.getPlatformId():"",securityContext:a.getSetting("pad_security_ctx"),onComplete:function(){},dataModelType:l.DATA_MODEL_TYPES.MODEL_HISTORY}),this._myVersionExplorer.subscribeEvent("ENOXVersionExplorerModalOK",this._onVersionExplorerModalOK.bind(this,t),!1),this._myVersionExplorer.subscribeEvent("ENOXVersionExplorerModalCancel",this._onVersionExplorerModalCancel.bind(this,t),!1),this._dlgVersionExplorer=d._dlg,d._dlg&&d._dlg.rightButtons&&d._dlg.rightButtons.addEventListener("click",this._onVersionExplorerModalCancel.bind(this,t)),this._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!0,this._myVersionExplorer.subscribeEvent("select",(function(e){i._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!1})),this._myVersionExplorer.subscribeEvent("unselect",(function(e){i._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!0}))},_onVersionExplorerModalCancel:function(e){this._myVersionExplorer.unsubscribeAll()},_onVersionExplorerModalOK:function(t){var i=require("DS/LibraryEditor/commands/LibraryCommands"),n=require("DS/LibraryEditor/utils/LibraryEditorcontrol");this._myVersionExplorer.unsubscribeAll();var a=this._myVersionExplorer.getSelectedNodes().shift().getAttribute("id"),o=r.getCurrentLibrary();if(a!==this.validPhysicalIDtobeReplaced){i._startProgressBar(f.ReplaceByRevision_content_loading);var s=[],l=[];s.push(this.validPhysicalIDtobeReplaced),l.push(a),u.replaceContent({IDsRemoved:s,IDsAdded:l,callbacks:{onComplete:function(t){i._offProgressBar();var r="",a=l.length;if(t){var s=JSON.parse(t);r=s.information?" ("+s.information+")":r}g.setAuthoringMode("authoring",f.replace(f.msg_info_Replaceinlibrary,{number:a,libraryname:o.options.label})+r),e.is(n.getContent())&&n.getContent().loadContentAndSelect(o)},onFailure:function(e){i._offProgressBar(),function(e,t,i){var r=t;!UWA.is(i)||i instanceof Error||(r+="<br>"+i),c.displayNotification({message:r,className:"error"})}(0,f.msg_error_ReplaceByRevision,e)}}})}else c.displayNotification({message:f.msg_warning_replaceByRevision_sameObject,className:"warning"})},_getVersionExploreforODT:function(){return this._myVersionExplorer?this._myVersionExplorer:null},setNode:function(e){this._selectedNodes=[e]}})})),define("DS/LibraryEditor/commands/ActionBar_AddExistingContentCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUX/utils/IPClassifyModeManager","DS/IPClassifyUtil/IPClassifyCommunication","UWA/Utils/InterCom","DS/TopBarProxy/TopBarProxy","DS/TopBarProxy/Menu","DS/TopBarProxy/MenuItem","DS/IPClassifyUX/models/LibrarySearchModel","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/Library_CSO","DS/IPClassifyUtil/IPClassifyAlert"],(function(e,t,i,r,n,a,o,s,l,d,c,u,f){"use strict";var g=t.extend({labelTopBar:e.i18n("Add Content"),isInsert:!0,data:{},_modalChooser:null,init:function(e){var t=this;this._parent(e,{mode:"exclusive",isAsynchronous:!1}),this._menuItem=null;try{var i=new o({id:widget.id}),r=new l({label:c.AddExisting_content_loading,onExecute:function(){d.isSearchActive()||"General Class"!=u.getCurrentLibrary().systemType?f.displayNotification({title:c.msg_error_topbar_add_existing_error,className:"error"}):t.executeTopBar()}});t._menuItem=r,i.addContent({add:t._menuItem})}catch(e){console.log("can't load top bar")}t=this;widget.addEvent("onRefresh",(function(){UWA.is(t._modalChooser)&&(t._modalChooser.close(),t._modalChooser=null)}))},executeTopBar:function(){this.execute()},beginExecute:function(){this._buildCellSkeleton()},initialize:function(){this.socketName="search_socket_"+(new Date).getTime(),this.socket=new a.Socket(this.socketName,{dispatchRetryInterval:5}),this.socket.subscribeServer("SearchComServer"),this.listener=this.selected.bind(this),this.socket.addListener("Selected_Objects_search",this.listener);var e=this.option_s();return this.socket.dispatchEvent("RegisterContext",e),this},selected:function(e){var t,i,r=[];if(this.callback){for(t=0,i=e.length;t<i;t++)r.push(e[t]);this.callback(r)}},option_s:function(e,t,i,r,n,a,o){var s=require("DS/LibraryEditor/utils/Library_CSO")._currentLibrary.id,l={};return l.title=e,l.mode="furtive",l.app_socket_id=this.socketName,null!==widget&&void 0!==widget?l.widget_id=widget.id:l.widget_id="",l.default_with_precond=!0,l.show_precond=!0,l.idcard_activated=!1,l.multiSel=n,l.role=i,l.precond="",l.specific_source_parameter={"3dspace":{additional_query:"NOT (interface:"+s+")"}},t&&(t=t.split(",")).forEach((function(e,t){0!==t&&(l.precond+=" OR "),l.precond+=e})),o&&o.length>0&&(l.columns=o),l},activate:function(e,t,i,r,a,o,s,l){var d=this.option_s(e,t,i,r,a,s,l);this.callback=o,!0===widget.getValue("noCompass")?n.publish("SelectFromSearch",d.specific_source_parameter["3dspace"].additional_query+" AND NOT (flattenedtaxonomies:(types/Libraries)) AND NOT (flattenedtaxonomies:(types/Classification))"):this.socket.dispatchEvent("InContextSearch",d)},launchSearch:function(e){e.additionalQuery="",this.initialize(),this.activate("Add Existing Item",e.allowedTypes,e.role||"",e.criteria,e.bMultiSel,(function(e){this._objects_selected(e)}),e.additionalQuery,e.selectable)},execute:function(){var e=this,t=require("DS/LibraryEditor/utils/Library_CSO"),i=require("DS/IPClassifyUtil/IPClassifyAlert"),r=require("i18n!DS/LibraryEditor/assets/nls/LibraryEditor"),n="";t.getCurrentLibrary()&&(n=t.getCurrentLibrary().getID()),n.length?(UWA.is(this._modalChooser)&&this._modalChooser.close(),setTimeout((function(){e.launchSearch({allowedTypes:"",role:"",criteria:"",additionalQuery:"",bMultiSel:!0,dg:e})}))):i.displayNotification({message:r.msg_warning_nocurrentlibrary,className:"warning"})},_objects_selected:function(e){var t=i.getTenantId(),r=[],n=!1;e.forEach((function(e){var i=e.resourceid,a=e.sourceid,o=null;if(a){var s=a.split(":");s.length>0&&(o=s[1])}o&&o!==t?n=!0:r.push(i)})),!0===n?f.displayNotification({message:c.msg_warning_addnotsupported_from_different_tenant,className:"warning"}):this._processInsertOperation(r,e)},_processInsertOperation:function(t,i){var n=require("DS/LibraryEditor/utils/Library_CSO"),a=require("DS/IPClassifyUtil/IPClassifyAlert"),o=require("i18n!DS/LibraryEditor/assets/nls/LibraryEditor"),s=require("DS/LibraryEditor/utils/LibraryEditorcontrol"),l=require("DS/LibraryEditor/service/LibraryServices"),d=require("DS/IPClassifyUXUtil/IPClassifyConfirmation"),c=require("DS/LibraryEditor/service/LibraryEditorWebService"),u=require("DS/Controls/Loader"),f=require("DS/Controls/ModalContainer"),g=n.getCurrentLibrary();if(t.length>0){var p={},y=t.length,m=!1;if(p.deleteButtonLabel=o.title_Add,p.buttonColor="blue",y>1)m=!0,p.titleLabel=o.title_Add+" "+y+" classified items",p.warningMessage=o.replace(o.msg_addContents,{className:g._options.label});else{var b=i?i[0]["ds6w:label"]:"Item";p.titleLabel=o.title_Add+" - "+b,p.warningMessage=o.replace(o.msg_addContent,{objectLabel:b,className:g._options.label})}function h(i){var d=n.getCurrentLibrary(),c=new u({text:o.Loading,showButtonFlag:!1});f.createModal(widget.body.globalLoaderContainer,c),c.on(o.Loading),l.AddContent({IDs:t,callbacks:{onComplete:function(n){f.removeModal(widget.body.globalLoaderContainer),c.off(o.Loading);var l="",u=!1,g=(t.length,l=o.replace(o.add_in_class,{libraryname:d.options.label}));if(n){var p,y,m=JSON.parse(n),b=m.totalCount,h=m.failedCount,v=m.alreadyExistCount,C=m.errorMsg;if(h>0?(v>0?h==v?b==h?(l=o.all_in_class,p="info"):b>h&&(l=o.replace(o.few_added_few_exist,{OK:b-h,exist:v}),u=!0):h>v&&(b==h?l=o.replace(o.few_exist_few_failed,{exist:v,KO:h-v}):b>h&&(l=o.replace(o.few_added_few_exist,{OK:b-h,exist:v}),u=!0,y=o.replace(o.few_failed,{KO:h-v}),p="error")):h==b?l=o.all_failed:h<b&&(l=o.replace(o.few_added,{OK:b-h}),u=!0,y=o.replace(o.few_failed,{KO:h}),p="error"),l&&(l=g+": "+l)):(l=o.replace(o.msg_info_Addinlibrary,{number:b,libraryname:d.options.label}),u=!0),1==u)r.setAuthoringMode("authoring",l),e.is(s.getContent())&&s.getContent().loadContentAndSelect(d),y&&(C&&(y=C),a.displayNotification({title:g,subtitle:y,className:p}));else{C?(l=C,C.contains("ClassNotActiveError")&&(l=o.AddExistingClassNotActive.subtitle+o.AddExistingClassNotActive.message)):i&&i.length>0&&(l=o.replace(o.noAccess_Error,{className:d.options.label})),p||(p="error"),a.displayNotification({title:g,subtitle:l,className:p})}}},onFailure:function(e){f.removeModal(widget.body.globalLoaderContainer),c.off(o.Loading),a.displayNotification({title:o.msg_error_Addinlibrary,subtitle:e?o.msg_error_Addinlibrary+"<br>"+e:"",className:"error"})},onTimeout:function(e){f.removeModal(widget.body.globalLoaderContainer),c.off(o.Loading),a.displayNotification({title:o.addExistingContentTimeout.title,subtitle:o.addExistingContentTimeout.subtitle,className:"warning"})}}})}function v(e,t,i){var r=[],n=[{dataIndex:"Tree",text:o.Title},{dataIndex:"Type",text:o.Type},{dataIndex:"Revision",text:o.Revision},{dataIndex:"modifyAccess",text:o.CanBeModified,alignment:"center",typeRepresentation:"url",getCellValue:function(e){if(e.nodeModel)return"true"==e.nodeModel.getAttributeValue("modifyAccess")?{icon:"check"}:{icon:"wrong"}}}];t.forEach((function(e){var t={};t.Tree=(UWA.is(e["ds6w:label"]),e["ds6w:label"]),t.Type=e["ds6w:type"],t.Revision=e["ds6wg:revision"],t.modifyAccess=i&&i.includes(e.resourceid)?"false":"true",r.push(t)})),e.cols=n,e.data=r}g._options&&g._options.grid&&"Definition"==g._options.grid["ds6w:classificationUsage"]?c.checkModifyAccessOnItems({objectIds:t,onComplete:function(e){var t=e?JSON.parse(e):void 0;m&&i&&(p.showDGV=!0,v(p,i,t.unModifiableIds)),m&&t.unModifiableIds.length>0&&(p.moreInfo=o.msg_addContentsMoreInfo,i&&(p.showDGV=!0,v(p,i,t.unModifiableIds))),t.unModifiableIds.length>0?(p.moreInfo=o.msg_addContentMoreInfo,d.confirmDialog(p,h,void 0,t.unModifiableIds)):h()},onFailure:function(e){console.log(" Error while fetching modify access on items"),h()}}):h()}},_buildCellSkeleton:function(){var t=require("DS/LibraryEditor/utils/LibraryEditorcontrol");e.is(t.getContent()._libraryContentView.elements.container)||(t.getContent().elements.container=e.createElement("span",{class:"fonticon fonticon-1x fonticon-search",title:"Find in Context"}))},endExecute:function(){}});return g})),define("DS/LibraryEditor/dataProvider/LibraryCSODataProvider",["UWA/Class","DS/LibraryEditor/utils/Library_CSO"],(function(e,t){"use strict";return e.singleton({getCurrentObject:function(){return t.getCurrentLibrary()},getCurrentObjectPath:function(){return t.getCurrentLibraryPath()},addInCSO:function(e,i){t.addInLibraryCSO(e,i)},getSelectedNodes:function(){return t.getSelectedNodes()},getSelectedNodesID:function(){return t.getSelectedNodesID()}})})),define("DS/LibraryEditor/commands/ActionBar_AddFeatureCmd",["DS/ApplicationFrame/Command","DS/LibraryEditor/utils/Library_CSO","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],(function(e,t,i){"use strict";return e.extend({labelTopBar:i.label_ActionBar_AddToFavorites,isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},execute:function(){var e=!0===widget.getValue("noCompass");if(t.getCurrentLibrary())var i=t.getCurrentLibrary().getID();e&&function(e,t){var i=JSON.stringify(t);dscef.sendString(e+"="+i)}("launchAddFeature",i)}})})),define("DS/LibraryEditor/commands/ActionBar_AddToFavoritesCmd",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/LibraryEditor/utils/Library_CSO","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/service/LibraryTypeService"],(function(e,t,i,r,n,a){"use strict";return t.extend({labelTopBar:r.label_ActionBar_AddToFavorites,isInsert:!0,datas:{},init:function(t){this._parent(t,{});var o=this;i.onChange((function(){o._adaptStateToCurrentLibrary()})),this.onStateChange((function(){if(o.getState()){if(t=i.getCurrentLibrary()){s=t.getID(),l=t.getType(),d=t.options.label;if(s&&a.inFamilyLibrary(l))if(e.is(n.getTreeCont()))0==n.getTreeCont().isLibraryAmongFavoriteLibraries(s)&&n.getTreeCont().addFavorite({id:s,name:d})}o.labelTopBar=r.label_ActionBar_RemoveFromFavorites}else{var t;if(t=i.getCurrentLibrary()){var s=t.getID(),l=t.getType(),d=t.options.label;if(s&&a.inFamilyLibrary(l))if(e.is(n.getTreeCont()))if(1==n.getTreeCont().isLibraryAmongFavoriteLibraries(s))!1===n.getTreeCont().removeFavorite({id:s,name:d})&&o.setState(!0,!1)}o.labelTopBar=r.label_ActionBar_AddToFavorites}}))},_adaptStateToCurrentLibrary:function(){var t=i.getCurrentLibrary();if(t&&t.getID){var r=t.getID();if(e.is(n.getTreeCont())){var a=!1;n.getTreeCont().isLibraryAmongFavoriteLibraries(r)&&(a=!0),this.setState(a,!1)}}}})})),define("DS/LibraryEditor/commands/ActionBar_ReplaceByLatestRevision",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/IPClassifyUtility","DS/LibraryEditor/utils/Library_CSO","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/IPClassifyUtil/IPClassifyAlert","DS/LibraryEditor/service/LibraryServices","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/IPClassifyUX/utils/IPClassifyModeManager"],(function(e,t,i,r,n,a,o,s,l,d){"use strict";var c=[];function u(e,t,i){var r=t;!UWA.is(i)||i instanceof Error||(r+="<br>"+i),o.displayNotification({message:r,className:"error"})}return t.extend({labelTopBar:e.i18n("Replace By Latest Revision"),isInsert:!0,init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},execute:function(){var e={},t=[],i=r.getSelectedNodes(),n=i.length;i&&i.length<101?(i.forEach((function(e){var i={id:e.id};t.push(i)})),e={lastVersionRequests:t},s.getLatestRevision({objectsToTreat:e,callbacks:this._treatLatestRevision(n,i)})):o.displayNotification({message:l.msg_warning_replaceByLatestRevision_NotMorethan100Objects,className:"warning"}),this.end()},_treatLatestRevision:function(t,i){return{onComplete:function(t){var n=[],a=[],f=JSON.parse(t);f.lastVersionRequests.length>0&&f.lastVersionRequests.forEach((function(e){if(e.islast){var t=i.find((function(t){return t.id===e.id})),r={};r[t.options.label+" "+t.options.grid["ds6wg:revision"]]="isLatestRevision",c.push(r)}else n.push(e.id),a.push(e.candidates[0])}));var g=n.length,p=require("DS/LibraryEditor/utils/LibraryEditorcontrol"),y=require("DS/LibraryEditor/commands/LibraryCommands"),m=r.getCurrentLibrary();if(g>0){n.length;y._startProgressBar(l.ReplaceByRevision_content_loading),s.replaceContent({IDsRemoved:n,IDsAdded:a,callbacks:{onComplete:function(t){y._offProgressBar();var i="",r=n.length;if(t){var a=JSON.parse(t);i=a.information?" ("+a.information+")":i}var o=l.replace(l.msg_warning_replaceByLatestRevision_MultiObject_AlreadyLatest,{number:c.length}),s=l.replace(l.msg_info_ReplaceByLatestRevision,{number:r,libraryname:m.options.label}),u=c.length?s+"\n"+o+i:s+i;d.setAuthoringMode("authoring",u),e.is(p.getContent())&&p.getContent().loadContentAndSelect(m)},onFailure:function(e){y._offProgressBar(),u(0,l.msg_error_ReplaceBylatestRevision,e)}}})}else o.displayNotification({message:l.msg_warning_replaceByLatestRevision_sameObject,className:"warning"})},onFailure:function(e){LibraryCommands._offProgressBar(),u(0,l.msg_error_ReplaceBylatestRevision,e)}}},endExecute:function(){c=[]}})})),define("DS/LibraryEditor/utils/LibraryEditorUtil",["UWA/Utils","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/service/LibraryTypeService","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUX/events/IPClassifyEvents","DS/IPClassifyUX/utils/IPClassifyModeManager","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/utils/Library_CSO","DS/IPClassifyUX/IPClassifyUXEvents","DS/IPClassifyUtil/IPSettingsMgr","DS/IPClassifyUtil/IPClassifyPreference","DS/IPClassifyUtil/IPClassifyUtility","UWA/Utils/Client"],(function(e,t,i,r,n,a,o,s,l,d,c,u,f,g){var p=null;getStatusPref=function(){if(!p){var e=widget.getValue("view_status");p={},e&&(p=function(e){var t=f.jsonUnzip(e),i=null;try{i=JSON.parse(t)}catch(e){i=null}return i}(e))}return p||{}},saveStatus=function(e,t){var i,r=getStatusPref();r[e]=t,widget.setValue("view_status",(i=r,f.jsonZip(JSON.stringify(i))))},getStatus=function(e){return getStatusPref()[e]},splitNumberAndUnit=function(e){const t=e.match(/^(\d+(?:\.\d+)?)(\s*[a-zA-Z]*)$/);if(t){return{value:t[1],unit:t[2].trim()}}return{value:null,CSSUnitValue:null}};var y={CURRENT_TAB_VALUE:null,nameRules:{notAllowedChars:["/",'"',"#","$","@","%","*",",","?","\\","<",">","[","]","|",":"],maxLength:127},shouldBeEditable:function(e){return!1},onNodeModelUpdate:function(e){var t=e.data.nodeModel;if(i.inFamilyLibrary(t.plmType)){var n=t._lastUpdateTime?t._lastUpdateTime:0,a=Date.now()-n;if(t._lastUpdateTime=Date.now(),console.log("lastUpdateTime : "+n+", elapsedTime : "+a),!(0!==n&&a<300))if(t._resetting)t._resetting=!1;else{var l=t.getID(),d=t.options.label,c=t.options.oldLabel;if(void 0===c&&(c=""),d!==c){d&&d.trim&&(d=d.trim());var u=!0;d.length>y.nameRules.maxLength&&(r.displayNotification({message:o.replace(o.get("msg_error_name_maxlength"),{name:d,maxLength:y.nameRules.maxLength}),className:"error"}),u=!1),0==d.trim().length&&(r.displayNotification({message:o.get("msg_error_name_empty"),className:"error"}),u=!1);for(var f=y.nameRules.notAllowedChars,g=0;g<f.length;g++){var p=f[g];if(-1!=d.indexOf(p)){r.displayNotification({message:o.replace(o.get("msg_error_name_badchars"),{name:d,badChars:y.nameRules.notAllowedChars.join(", ")}),className:"error"}),u=!1;break}}if(u){if(t.isFavorite&&UWA.is(s.getTreeCont())){var m={id:l,name:c};s.getTreeCont().renameFavorite(m,d,t)}}else t.withTransactionUpdate((function(){this.setLabel(c)}))}}}},getCurrentSecurityContextAndLibraryData:function(e){var t=l.getCurrentLibrary(),r=c.getSetting("pad_security_ctx"),n=widget.getValue("pad_tenant"),a={From:"LibraryEditor",LibraryID:null,LibraryType:null,IsInDeletedItems:!1,Timestamp:Date.now(),Tenant:n,SecurityContext:r};return t&&(i.inFamilyLibrary(t.plmType)||e)&&(a.LibraryID=t.getID(),a.LibraryType=t.getType()),a},setAuthoringAndReloadContentView:function(){var e=require("UWA/Core"),t=l.getCurrentLibrary();a.setAuthoringMode("authoring",o.msg_addFeature),e.is(s.getContent())&&s.getContent().loadContentAndSelect(t)},sortColumn:function(e,t){var r=i.inFamilyLibrary(e.plmType),n=i.inFamilyLibrary(t.plmType);return r&&!n?-1:!r&&n?1:0},_repeatMode:0,getRepeatMode:function(){return this._repeatMode},setRepeatMode:function(e){this._repeatMode=e?1:0},setContentViewPreference:function(e,t){return new Promise((function(i){require(["DS/IPClassifyUtil/service/IPClassifyUtilWebService","DS/IPClassifyUtil/IPClassifyUtility"],(function(r,n){widget.setValue("LibraryCusto_treelistview_v1",n.jsonZip(JSON.stringify(e))),t?r.saveUserPreferences({name:self.widget.getValue("x3dAppId")+"_Library_v1",value:n.jsonZip(JSON.stringify(e)),onComplete:function(e){i()},onFailure:function(e){i()}}):i()}))}))},getClassAttrPos:function(){return new Promise((function(e){u.get("LibraryEditor_v1_ClassAttrsToLeft",(function(t){t&&t.hasOwnProperty("dynamicAttributesTop")?e(t.dynamicAttributesTop):u.get("LibraryEditor_v1_ClassAttrsToLeft",(function(t){t&&t.hasOwnProperty("dynamicAttributesTop")?e(t.dynamicAttributesTop):e(!1)}),!1)}),!0)}))},setClassAttrPos:function(e,t){var i={dynamicAttributesTop:e};u.set("LibraryEditor_v1_ClassAttrsToLeft",i),t||u.set("LibraryEditor_v1_ClassAttrsToLeft",i,!t)},setRightPanelStatus:function(e){saveStatus("rightPanel",e)},setLeftPanelStatus:function(e){saveStatus("leftPanel",e)},getRightPanelStatus:function(){var e={rightPanelState:!1,size:300},t=getStatus("rightPanel");return new Promise((function(i){i(t||e)}))},getLeftPanelStatus:function(){var e={leftPanelState:!0,isWelcomePanelCollapsed:!1},t=getStatus("leftPanel");return new Promise((function(i){i(t||e)}))},copyUrlToCLipboard:function(e){var t="";return new Promise(((i,r)=>{!navigator.clipboard||g.Platform.hasOwnProperty("ios")&&!0===g.Platform.ios?(!function(e){var i=document.createElement("textarea");if(i.value=e,document.body.appendChild(i),g.Platform.hasOwnProperty("ios")&&!0===g.Platform.ios){i.contentEditable=!0,i.readOnly=!0;var r=document.createRange();r.selectNodeContents(i);var n=window.getSelection();n.removeAllRanges(),n.addRange(r),i.setSelectionRange(0,i.value.length)}else i.select();try{t=document.execCommand("copy")}catch(e){}document.body.removeChild(i)}(e),t?i([""]):r([""])):navigator.clipboard.writeText(e).then((function(){i([""])}),(function(e){r([""])}))}))}};return y})),define("DS/LibraryEditor/commands/ActionBar_RepeatModeCmd",["DS/ApplicationFrame/CommandCheckHeader","DS/LibraryEditor/utils/LibraryEditorUtil","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],(function(e,t,i,r){"use strict";return e.extend({labelTopBar:r.label_ActionBar_AddToFavorites,isInsert:!0,datas:{},init:function(e){this._parent(e,{}),this.onStateChange((function(){var e=this.getState();t.setRepeatMode(e);var n=r.msg_info_repeatModeDisabled;e&&(n=r.msg_info_repeatModeEnabled),i.displayNotification({message:n,className:"primary"})}))}})})),define("DS/LibraryEditor/commands/ActionBar_ColumnVisibilityCmd",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/IPClassifyUtil/IPContext","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/WidgetServices/WidgetServices","DS/LibraryEditor/utils/LibrarySearch","DS/IPClassifyUtil/IPClassifyUtility","text!DS/LibraryEditor/assets/library_exclude_columns.json","DS/LibraryEditor/utils/LibraryEditorUtil"],(function(e,t,i,r,n,a,o,s,l){"use strict";var d=JSON.parse(s).columnToExclude;return e.extend({labelTopBar:r.label_ActionBar_AddToFavorites,isInsert:!0,datas:{},init:function(e){this._parent(e,{});var r=i.get()?i.get():t.get();UWA.is(r.addEvent,"function")&&r.addEvent("onToggleView",this._check_if_treeview.bind(this))},execute:function(){var e=this;l.getClassAttrPos().then((function(s){require(["DS/IPClassifyColumnCusto/IPClassifyColumnCusto","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/AttributesMgtV2"],(function(d,c,u){var f=i.get()?i.get():t.get(),g=f.options.views?f.options.views.datagridview:void 0;if(g){for(var p=c.getModelEvents(),y=[],m=g.options.dgvLayout.getOrderedColumnsIndexes(),b=0;b<m.length;++b){var h=g.options.dgv.getColumnOrGroup(m[b]);y.push(h)}var v=g.options.viewMode,C=g.options.dgvLayout.rowsHeader,_=u.getDefaultTypesAndExtensions();_.defaultTypes.push("General Class"),_.defaultTypes.push("General Library"),g.columnOrdering=!0;let t=u.getSelectedTypes();t.push("General Class"),t.push("General Library"),e.columnCusto=new d({modelEvents:p,viewMode:v,appColumns:y,baseInstanceTypes:[],selectedTypes:t,selectedExtensions:u.getSelectedExtensions(),defaultTypes:_.defaultTypes,defaultExtensions:_.defaultExtensions,fetchTypesFromDictionary:!1,withDgv:!0,dgvInfo:g,rowHeaderActivated:C,manageAttrFromInstance:!1,dbOnlyAttributes:!0,showNonDBAttributesAsWell:!0,addValueInAuthoringColumn:!n.isNatifEnvironnement(),preMappedAttriForAuthoring:{"ds6w:description":!0,"ds6w:label":!0,"ds6w:type":!0,"ds6w:responsible":!0,"ds6w:reservedBy":!0},enableDynamicAttributesPos:!0,dynamicAttrCheckBoxName:r.dynamicAttrCheckBoxName,dynamicAttrCheckBoxValue:s});var S=[];S.push(p.subscribe({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification"},(function(t){switch(t.what){case"addRemoveColumns":if(t.removedColumns&&g.removeColumnCB(t.removedColumns),t.addedColumns){var i=e._filterExcludeColumns(t.addedColumns),r=i.filter((function(e){return g.options.dgv.getColumnOrGroup(e.dataIndex)}));g&&r.length>0&&g.changeDBAttributeCB(r),(i=i.filter((function(e){return!g.options.dgv.getColumnOrGroup(e.dataIndex)})))&&i.length>0&&(o.isIndexedMode()||(i=a.getAuthModeNoSortColumns(i,!0)),g.addColumnCB(i))}break;case"visibilityColumn":g.changeVisibilityCB(t.modifiedColumn,t.visibilityFlag);break;case"moveColumn":if(t.move2perform){var n=g.options.dgvLayout.getVisibleOrderedLeafColumns();if(n&&n.length>0){var s=t.move2perform.fromIndex?t.move2perform.fromIndex:n[g.options.dgvLayout.getColumnIndex(t.move2perform.fromID)].dataIndex,d=t.move2perform.toIndex?t.move2perform.toIndex:n[g.options.dgvLayout.getColumnIndex(t.move2perform.toID)].dataIndex;g.options.dgvLayout.moveColumn(s,d,{isUserInteraction:!0}),g.columnOrdering=!0}}void 0!==t.dynamicAttributesTop&&l.setClassAttrPos(t.dynamicAttributesTop,!0);break;case"changeTitle":g.changeTitleCB(t.modifiedColumn,t.newTitle);break;case"pinChange":g.changePinCB(t.modifiedColumn,t.pin);break;case"rowsHeaderModification":g.changeDgvLayout({rowsHeader:t.rowsHeader});break;case"changeViewMode":g.compactMode(t);break;case"close":t.selectedExtensions&&t.selectedTypes&&u.updateSelectedParams({selectedExtensions:t.selectedExtensions,selectedTypes:t.selectedTypes}),g.saveCustoView(t.applyOnlyToThisApp),void 0!==t.dynamicAttributesTop&&l.setClassAttrPos(t.dynamicAttributesTop,t.applyOnlyToThisApp),S.forEach((function(e){p.unsubscribe(e)}));break;case"reset":u.resetSelectedParams(),g.options.dgvLayout.deleteDataGridViewPreferences(),g.reset(t.parameters),l.setClassAttrPos(!1,!0),S.forEach((function(e){p.unsubscribe(e)}));break;default:console.warn("Unknown column modification kind:"+t.what)}})))}}))}))},_filterExcludeColumns:function(e){var t=[];return e.forEach((function(e){-1===d.indexOf(e.dataIndex)&&t.push(e)})),t},_check_if_treeview:function(){"datagridview"===(i.get()?i.get():t.get()).getPADTreeDocument().options.active_view?this.enable():this.disable()},_getColumnCusto:function(){return this.columnCusto}})})),define("DS/LibraryEditor/utils/LibraryMigration",["DS/LibraryEditor/utils/LibraryEditorUtil","DS/IPClassifyNav/views/customize_views/_xNavDGVUtils","DS/IPClassifyUtil/IPClassifyPreference","DS/IPClassifyUtil/IPClassifyUtility"],(function(e,t,i,r){return{migrateContentPreferences:function(i,r){var n=[];if((!i.version||i.version<1)&&r>=1){var a=new Promise((function(n){i.columnsOptimized?(new t).buildColumns("datagridview").then((function(t){for(var a=t.columns,o=0;o<a.length;++o){var s=a[o].dataIndex;if("ds6w:status"===s){for(var l=!1,d=0;d<i.columnsOptimized.length;++d)if(i.columnsOptimized[d].dataIndex===s){l=!0;break}if(!l){var c=a[o];c.visibleFlag=!1,i.columnsOptimized.push(c)}}}i.version=r,e.setContentViewPreference(i,!0).then((function(){n()}))})):n()}));n.push(a)}return Promise.all(n)},migrateFavPreferences:function(e,t){return new Promise((function(e){1==t?i.get("ipcFavoriteList_v1",(function(n){i.set(r.getTenantAwarePreferenceName("ipcFavoriteList_v1"),n,!1,!1),i.set("LibraryFavPrefVersion",{version:t},!1),e()}),!1):e()}))},migrateTreeStructurePreferences:function(e,t){return new Promise((function(e){1==t?i.get("ipcTreeStrucure_v1",(function(n){i.set(r.getTenantAwarePreferenceName("ipcTreeStrucure_v1"),n),i.get("ipcTreeSelectedNode_v1",(function(n){i.set(r.getTenantAwarePreferenceName("ipcTreeSelectedNode_v1"),n),i.set("LibraryTreeStrcutPrefVersion",{version:t}),e()}))})):e()}))}}})),define("DS/LibraryEditor/ActionBar/LibraryCommandManager",["UWA/Class","DS/ApplicationFrame/CommandsManager","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/utils/Library_CSO","DS/IPClassifyUtil/IPContext","DS/IPClassifyUX/IPClassifyUXEvents","DS/IPClassifyUXUtil/ActionBar/IPCommandManager","DS/PADServices/utils/GlobalModelEvents","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/IPClassifyUtility","text!DS/LibraryEditor/assets/LibraryProbesCommandMapping.json"],(function(e,t,i,r,n,a,o,s,l,d,c,u,f){"use strict";var g={},p=JSON.parse(f);function y(){return a.get()?a.get():null}function m(){return y()?y().toString():null}var b=e.singleton(s,{noSizeToFit:["libraryLocation"],initialize:function(){n.onEmpty((()=>{this.enableAllCommands(!1)})),t.onCommandStart((e=>{var t=g[e.getId()];t&&!0===t.author&&this.getModelEvents().publish({event:"switch_to_author"})}));var e=new Promise((e=>{require(["text!DS/LibraryEditor/assets/afr/LibraryEditor.json"],e)}));return new Promise((t=>{e.then((e=>{var i={};if(e)for(var r in(i=JSON.parse(e)).headers){i.headers[r].ID=r}g=i.Rules,t(i)}))}))},revaluateContentValue:function(e,t){if(!0===e.CONTENT)return!0;if(!t.checkWhiteClick&&!t.isFavoriteNode&&t.isCtxMenu&&!1===e.CONTENT.ctxMenu)return!1;var i=!0;return!0===e.CONTENT.Libraries?i=t.isLibrary||t.isRoot:!1===e.CONTENT.Libraries&&(i=!t.isLibrary&&!t.isRoot),!1!==i&&1==e.CONTENT.favCtxMenuOnly&&(i=t.isCtxMenu&&!t.isMultiSelect&&t.isFavoriteNode),!1!==i&&(!0===e.CONTENT.classifiedItem?i=t.isclassifiedItem:!1===e.CONTENT.classifiedItem&&(i=!1)),!1!==i&&1==t.isCtxMenu&&t.isFavoriteNode&&e.CONTENT&&!0===e.CONTENT.ctxFavOnMultiSel&&(i=!0),i},revaluateTreeValue:function(e,t){if(!0===e.TREE)return!0;if(!t.checkWhiteClick&&!t.isFavoriteNode&&t.isCtxMenu&&!1===e.TREE.ctxMenu)return!1;var i=!0;return!0===e.TREE.Sections?i=t.isSection:!1===e.TREE.Sections&&(i=!t.isSection),!1!==i&&(!0===e.TREE.RootLibraries?i=t.isRoot:!1===e.TREE.RootLibraries&&(i=!t.isRoot)),!1!==i&&(!0===e.TREE.Libraries?i=t.isLibrary||t.isRoot:!1===e.TREE.Libraries&&(i=!t.isLibrary&&!t.isRoot)),i},getToolTipFromNls:function(e){return d.get("menuTitle_"+e)?d.get("menuTitle_"+e):e},_manageSwitchOfCommands:function(e,t,n,a){var o=!1,s=n&&!!t&&0===t.length;e&&!s?o=e.isFavorite:t&&t.length>0&&(o=t[0].isFavorite);var l=!1,d=!1,f=!1,p=!1,y=!1,m=!1,b=!1;e&&(m="LibrarySection_favorite"==e.plmType,b="LibrarySection_AllLibraries"==e.plmType,p=r.isRootLibrary(e.plmType),y=r.isLibrary(e.plmType));var h=m||b,v=!1;t&&t.every((function(e){return l=l||r.isRootLibrary(e.plmType),d=d||r.isLibrary(e.plmType),v=v||"Busy"===e.plmType,f=f||r.isContent(e.plmType),!l||!d||!v}));var C=!0;if((m||v||(b||!e)&&t&&0===t.length)&&(C=!1),n||this.enableAllCommands(C),!v){var _={},S=Object.keys(g);a&&(S=a);var L={};return L.isCtxMenu=n,L.isFavoriteNode=o,L.checkWhiteClick=s,S.forEach((r=>{var a=g[r];if(a){var m=t&&t.length>0,b=e&&(!m||void 0===a.CONTENT),v=!0;"object"==typeof a&&(a.isContentItem&&m&&"Content"==t[0].plmType&&(v=!1),a.isContentItem&&c.isNatifEnvironnement()&&(v=!1),(v&&!1===a.TREE&&b||!1===a.CONTENT&&m)&&(v=!1),v&&s&&!0!==a.white_click&&(v=!1),v&&void 0!==a.multisel&&(v=!t||t.length<=1),v&&!1===a.NoSelection&&(v=t&&t.length>0),v&&a.views&&(v=a.views.indexOf(i.getContent().getView().getActiveView())>=0),v&&!1===a.DBMode&&!1===(v=u.isIndexedMode())&&"ContentSortByTitle"===r&&this.getCommands().ContentSortByModifiedDate.setLastSortOnCommandHide(),v&&n&&o&&!0!==a.ctxFavorite&&!a.isContentItem&&(v=t&&t.length>1&&1==a.CONTENT.ctxFavOnMultiSel),v&&!1===a.CATIAV6&&(v=!0!==widget.getValue("noCompass")),v&&!1===a.NOT_WEBInWin&&(v=!0===widget.getValue("noCompass")),v&&a.TREE&&b&&(L.isSection=h,L.isRoot=p,L.isLibrary=y,b=this.revaluateTreeValue(a,L)),v&&a.CONTENT&&m&&(L.isRoot=l,L.isLibrary=d,L.isclassifiedItem=f,L.isMultiSelect=t&&t.length>1,m=this.revaluateContentValue(a,L)),v=v&&(!0===m||!0===b||null===m&&null===b)),_[r]=v,n&&!s||this._switchCommand(r,v,a.type),n||"openWith"!==r||this.getModelEvents().publish({event:"build_openwith",data:{visible:v,nodes:m?t:[e]}})}})),_}},getCommands:function(){let e,i=m();return e=t.getCommands()[i],e},getCommandByContext:function(e){let i,r=m(),n=t.getCommands()[r];return i=n&&e?t.getCommands()[r][e]:n,i},getCommandCheckHeader:function(e){return this.getCmdCheckHeaderByContext(e)},getCmdCheckHeaderByContext:function(e){let i=m();return i?t.getCommandCheckHeader(e,i):t.getCommandCheckHeader(e)},getCommand:function(e){var t=this.getCommandByContext(e);return t=t||this.getCmdCheckHeaderByContext(e)},enableAllCommands:function(e){var i=t.getCommands();for(var r in i){var n=t.getCommand(r);UWA.is(n)&&n.enable&&(e?this._switchCommand(r,!0):this._switchCommand(r,!1))}},getModelEvents:function(){return l.getModelEvents()},updateCommands:function(e,t){if(t||(t=n.getCurrentLibrary()),i.getContent().getView().getPADTreeDocument()){var r=i.getContent().getView().getPADTreeDocument().getSelectedNodes();r=r||(e?[e]:[]),this._parent(t,r)}},launchCommand:function(e,t,i,r){let n=e;p&&p[e]&&(n=p[e]),"ContextualMenu"===r?u.sendTrackerPageEvent("LibraryWidget_contextual",n):u.sendTrackerPageEvent("LibraryWidget_iconBar",n),this._parent.apply(this,arguments)}});return b})),define("DS/LibraryEditor/dataProvider/LibraryIdCardDataProvider",["UWA/Class","UWA/Class/Promise","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/utils/LibraryEditorDataConversion","DS/LibraryEditor/ActionBar/LibraryCommandManager","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/service/LibraryTypeService","DS/IPClassifyUX/LibrarySearchWithinController"],(function(e,t,i,r,n,a,o,s,l){"use strict";return e.singleton({getChildrenInfos:function(e){return new t((function(t){var a=i.getTreeCont()._getVisibleNodeById(e);if(a){var o=a.getChildren();t(o)}else r.libraries({pid:e,onComplete:function(i){var r=[];i.results?r=n.convertExpandToSearchFormat(e,i.results):i.result&&(r=n.convertNavigateToSearchFormat(i.result)),r.forEach((function(e){e.plmType=e.plmType||"Library"})),t(r)},onFailure:function(e){console.warn("WebService libraries Err : "+e),t([])}})}))},isSection:function(e){return"LibrarySection_favorite"==e||"LibrarySection_AllLibraries"==e},getStableAreaWidth:function(e,t,r){if(r)return r+5;try{var n=[],a=s.isSection(t.getType());return n=(n=i.getContent().getView().getPADTreeDocument().getSelectedNodes())||(iData?[iData]:[]),a&&0==n.length?167:e?207:175}catch(e){}},getLibraryControl:function(){return i},getSearchWithinController:function(){return l},getCommandManager:function(){return a},getLibraryTypeService:function(){return s},advanceSearchWithinWidget:function(){return!0},getIndexModePanelHelp:function(){return"Lib3DDashUAPanelMap/lib3ddash-c-index-database-mode.htm"},getSearchTooltip:function(){let e={title:o.searchTooltip.title,shortHelp:o.searchTooltip.shortHelp,longHelp:o.searchTooltip.longHelp};var t={helpid:"search",content:{"search.PanelHelp":"Lib3DDashUAPanelMap/lib3ddash-r-SearchingContent.htm"}},i=require("DS/WebUAUtils/WebUAUtils").getMoreHelpCallback(t);return e.moreHelpCB=i,e},getAdvanceSearchTooltip:function(){let e={title:o.advanceSearchTooltip.title,shortHelp:o.advanceSearchTooltip.shortHelp,longHelp:o.advanceSearchTooltip.longHelp};var t={helpid:"advanceSearch",content:{"advanceSearch.PanelHelp":"Lib3DDashUAPanelMap/lib3ddash-r-SearchingContent.htm"}},i=require("DS/WebUAUtils/WebUAUtils").getMoreHelpCallback(t);return e.moreHelpCB=i,e}})})),define("DS/LibraryEditor/commands/LibraryCommands",["DS/IPClassifyUtil/IPClassifyAlert","DS/LibraryEditor/utils/Library_CSO","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/WebappsUtils/WebappsUtils","DS/IPClassifyUtil/IPContext","DS/ApplicationFrame/CommandsManager","DS/PADUtils/views/PADProgressBar","DS/WidgetServices/WidgetServices","DS/IPClassifyUXUtil/OpenWithMenuBuilder","DS/IPClassifyUtil/IPClassifyUtility","text!DS/LibraryEditor/assets/LibraryProbesCommandMapping.json","DS/LibraryEditor/ActionBar/LibraryCommandManager"],(function(e,t,i,r,n,a,o,s,l,d,c,u,f,g){"use strict";JSON.parse(f);return{_endProgressBarListener:function(){var e=this;n.getContent().getView().addEvent("onCompleteRefreshNodes",(function(t){this.removeEvent("onCompleteRefreshNodes"),e._offProgressBar()}))},_offProgressBar:function(){if(0===l._counter)return null;l.off()},_commonError:function(t,i,r){console.error(t,r);var n=i;!UWA.is(r)||r instanceof Error||(n+="<br>"+r),e.displayNotification({message:n,className:"error"})},_startProgressBar:function(e){1===l._counter&&l.off(),l.on(e)},_nbItemsNotNull:function(e){var t,i=e.length,r=0;for(t=0;t<i;++t)e&&r++;return r},RenameCmd:function(e,t){if("CONTENT"==t){var i=e.manager.layout.getColumnIndex("tree"),r=e.manager.layout.getCellsFromNodeModel(e.nodeModel)[i];(n=e.manager.getEditionManager(r)).onF2&&(e.manager.setActiveCell(r),n.onF2(r))}else{var n;i=e.manager.layout.getColumnIndex("tree"),r=e.manager.layout.getCellsFromNodeModel(e.nodeModel)[i];(n=e.manager.getEditionManager(r)).onF2&&(e.manager.setActiveCell(r),n.onF2(r))}},RemoveContentCmd:function(e,t){let i=o.get()?o.get().toString():void 0;var r=s.getCommand("RemoveContent",i);r&&r.begin()},ExpandAllCmd:function(r,n){r.plmType;var a=[];"TREE"===n&&r?a.push(r):a=t.getSelectedNodes();var o=null;o=t.getCurrentLibrary(),a.length?a.forEach((function(e){null===e.options.children||e.expandAll()})):null===o?e.displayNotification({message:i.msg_warning_nocurrentlibrary,className:"warning"}):o.expandAll()},CollapseAllCmd:function(r,n){r.plmType;var a=[],o=t.getCurrentLibrary();"TREE"===n&&r?a.push(r):a=t.getSelectedNodes(),a.length?a.forEach((function(e){e.collapseAll()})):null===o?e.displayNotification({message:i.msg_warning_noselection,className:"warning"}):o.collapseAll()},Information:function(){var e=n.getContent()._infoPanelView;e._context.elements.padshell._isRightOpen||e._modelEv.publish({event:"information-panel-open"})},RemoveFavoriteCmd:function(e,t){var i=e;if(console.log("  RemoveFavoriteCmd currentFavoriteTreeNode : ",i),i&&i.isFavorite){var r=i.getID(),a=i.options.label;console.log("  currentLibrary Id : ",r),r&&UWA.is(n.getTreeCont())&&n.getTreeCont().removeFavorite({id:r,name:a})}},AddExistingCmd:function(e,t){let i=o.get()?o.get().toString():void 0;var r=s.getCommand("AddExistingContent",n.getContent(),i);r&&r.begin()},CreateLink:function(e,t){let i=o.get()?o.get().toString():void 0;var r=s.getCommand("CreateLink",n.getContent(),i);openInCADCmd&&r.begin()},OpenInCADCmd:function(e,t){let i=o.get()?o.get().toString():void 0;var r=s.getCommand("OpenInCADHdr",n.getContent(),i);r&&r.begin()},GetContextualMenu:function(e,i,r){var a,o=!!e.white_Click&&e.white_Click,s=r?n.getContent().getView().getPADTreeDocument().getSelectedNodes():[];if(void 0===(a=!0===o?a=t.getCurrentLibrary():s&&s.length>0?s:e.nodeModel)&&(a=e),a&&!Array.isArray(a)&&(a=[a]),!r)r={cellInfos:e,data:{event:{pageX:0,pageY:0}}};return g.getContextualMenu(a,"TREE"===i,r)},_addHiddenInput:function(e){var t=n.getContent().getView();UWA.createElement("a",{href:e,styles:{display:"hidden"}}).inject(t.elements.container).click()}}})),define("DS/LibraryEditor/commands/CtxCommands",["DS/ApplicationFrame/Command","DS/LibraryEditor/commands/LibraryCommands","DS/PADUtils/PADContext","DS/IPClassifyUtil/IPContext"],(function(e,t,i,r){"use strict";return e.extend({execute:function(){var e=(r.get()?r.get():i.get()).ctxInfo;switch(this.options.ID){case"RenameCmd":!function(e){var i=e.options.cellInfos,r=e.options.isTree;t.RenameCmd(i,r?"TREE":"CONTENT")}(e);break;case"Information":t.Information()}}})})),define("DS/LibraryEditor/commands/ActionBar_CollapseAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/LibraryEditor/commands/LibraryCommands","DS/LibraryEditor/utils/Library_CSO"],(function(e,t,i,r){"use strict";return t.extend({labelTopBar:e.i18n("Collase All"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){var e=r.getSelectedNodes();if(e.length){var t=e[0];i.CollapseAllCmd(t,"CONTENT")}else{var n=r.getCurrentLibrary();i.CollapseAllCmd(n,"TREE")}},endExecute:function(){}})})),define("DS/LibraryEditor/utils/LibraryEditorKeyboardListener",["UWA/Core","UWA/Class","UWA/Event","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/commands/LibraryCommands","DS/LibraryEditor/ActionBar/LibraryCommandManager","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/service/LibraryTypeService","DS/IPClassifyUX/events/IPClassifyEvents","DS/Logger/Logger"],(function(e,t,i,r,n,a,o,s,l,d){var c=t.extend({name:"LibraryEditorKeyboardListener",init:function(e){this._parent(e),this._logger=d.getLogger(c),this._onKeyDown_binded=this._onKeyDown.bind(this)},startObservingKeyboard:function(){e.Element.addEvent.call(document,"keydown",this._onKeyDown_binded)},_onKeyDown:function(e){var t=this,n=i.whichKey(e);e.ODTENVKeyName&&(n=e.ODTENVKeyName);var d,c,u,f=function(){var e=document.activeElement;return!(!e||"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName)};switch(n){case"ctrl+a":d=n,c="SelectAll",(u=a.getCommand(c))&&u.isEnabled()?f()?t._logger.log("Info : '"+d+"' key pressed in INPUT field, no command launched"):(u.begin(),i.stop(e)):t._logger.log("Info : '"+d+"' key pressed, but command '"+c+"' is disabled");break;case"alt+return":l.notifyInfoExpand();break;case"ctrl+f":var g=r.getIdCardCont();g._isSearchAvailable()&&(g.switchSearch(!0),i.stop(e));break;case"f2":if(f())t._logger.log("Info : '"+n+"' key pressed in INPUT field, no command launched");else{var p=o.getSelectedNodes(),y=o.getCurrentLibrary();if(y.pathId&&!y.pathId.includes("LibrarySection_favorite"))break;if((Array.isArray(p)?p.length:0)>=1){var m=p[0];if(m&&s.inFamilyLibrary(m.plmType)&&r.getTreeCont().getView().isTreeNodeModelInstance(m))if(y.getID()==m.getID()){var b=r.getTreeCont();b&&b.switchLibraryTreeNodeLabelToWriteView&&b.switchLibraryTreeNodeLabelToWriteView(y)}else{var h=r.getContent();h&&h.switchLibraryTreeNodeLabelToWriteView&&h.switchLibraryTreeNodeLabelToWriteView(m)}else t._logger.log("Info : '"+n+"' key pressed but selected element is not a Library, no command launched")}else t._logger.log("Info : '"+n+"' key pressed when no element selected, no command launched")}}}});return c})),define("DS/LibraryEditor/commands/ActionBar_CreateLinkCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/LibraryEditor/service/LibraryEditorWebService","DS/IPClassifyUtil/IPClassifyAlert","DS/LibraryEditor/commands/LibraryCommands","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/WidgetServices/WidgetServices","DS/PADUtils/PADUtilsServices","DS/LibraryEditor/utils/LibraryEditorUtil"],(function(e,t,i,r,n,a,o,s,l){"use strict";return t.extend({labelTopBar:e.i18n("Copy Link"),init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},execute:function(){require(["DS/LibraryEditor/utils/Library_CSO"],(function(e){var t=e.getSelectedNodes(),i=null,n=t[0].getID(),s=t[0].getLabel();null!=n&&o.getSourceUrlAsync({platformId:o.getTenantID(),source:"3DDashboard",onComplete:function(e){var t={data:{items:[{objectId:n,envId:widget.getValue("x3dPlatformId")}]}};i=e+"#app:ENOCLRX_AP/content:X3DContentId="+encodeURIComponent(JSON.stringify(t)),l.copyUrlToCLipboard(i).then((e=>{r.displayNotification({message:a.replace(a.msg_success_copyLink,{libraryname:s}),className:"success"})})).catch((e=>{r.displayNotification({message:a.msg_error_copyLink,className:"error"})}))}})}))},endExecute:function(){}})})),define("DS/LibraryEditor/dataProvider/LibraryTreeDataProvider",["UWA/Class","UWA/Class/Promise","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/utils/LibraryEditorUtil","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/utils/LibraryEditorDataConversion","DS/LibraryEditor/commands/LibraryCommands","DS/WebappsUtils/WebappsUtils","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/commands/ChangeMaturityFilterCmd","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUtil/IPClassifyAlert"],(function(e,t,i,r,n,a,o,s,l,d,c,u,f){"use strict";var g={AllMaturityStates:"unselected",Inactive:"unselected",InWork:"unselected",Active:"selected",Obsolete:"unselected"},p="",y={FAVORITES:"ipcFavoriteList_v1",getFavorites:function(){return u.getTenantAwarePreferenceName(this.FAVORITES)}};return e.singleton({expandObject:function(e){return new t((function(t,i){n.libraries({pid:e.pid,mxid:e.mxid,children:e.children,isExpandAll:e.isExpandAll,onComplete:function(r){try{(r="string"==typeof r?JSON.parse(r):r).results=u.convertExpandV2toV1(r.results)}catch(e){i(e)}var n=a.getPathsAndObjectsFromExpand(r.results);if(null==n)t({paths:[],objects:[]});else if(n.paths&&n.paths.length<=0){var o=[];r.results&&(o=a.convertExpandToSearchFormat(e.pid,r.results));var s=[];for(var l in n.objects)n.objects.hasOwnProperty(l)&&l!==e.pid&&s.push(l);t({objects:function(e){var t=[];e&&e.length>0&&e.forEach((function(e){var i=a.convertToExaleadDataFormatFederated(e);"Standard"==i.grid["ds6w:classificationUsage"]?i.icons=[{iconName:"library-class"}]:i.icons=[{iconName:"library-class-filled"}],i.plmType="Library",t.push(i)}));return t}(o),childIds:s,paths:n.paths})}else{for(var l in n.objects)n.objects.hasOwnProperty(l)&&("Standard"==n.objects[l].grid["ds6w:classificationUsage"]?n.objects[l].icons=[{iconName:"library-class"}]:n.objects[l].icons=[{iconName:"library-class-filled"}],n.objects[l].plmType="Library");t({paths:n.paths,objects:n.objects})}},onFailure:function(e){i(e)}})}))},getRootSectionContents:function(e){return new t((function(e,t){n.roots({fetchAll:!0,onComplete:function(t){var i=(t="string"==typeof t?JSON.parse(t):t).results?t.results:[],r=[],n=[];i.forEach((function(e){var t=a.convertToExaleadDataFormatFederated(e);"Standard"==t.grid["ds6w:classificationUsage"]?t.icons=[{iconName:"library-lined"}]:t.icons=[{iconName:"library"}],t.plmType="RootLibrary",n.push(t),r.push(t.physicalid)})),e({objects:n,ids:r,infos:t.infos})},onFailure:function(e){t(e)}})}))},getObjectPathLength:function(e){return new t((function(t,i){n.getLibraryPathLength({ids:e.ids,onComplete:function(e){if(e.results){var r=a.getLibraryDepth(e);t(r)}else f.displayNotification({message:l.msg_error_BOdeleted,className:"error"}),i()},onFailure:function(e){console.log("WebService getObjectPathLength Err : "+e),i(e)}})}))},getObjectPath:function(e){return new t((function(t,i){n.getLibraryPath({depth:e.depth,pid:e.pid,onComplete:function(i){var r=a.convertNavigateToFlatFormat(e.depth,i.result);t(r)},onFailure:function(e){that._logger.log("WebService getObjectPath Err : "+e),i(e)}})}))},getPreferenceSectionContents:function(e){return new t((function(t,r){n.favourites({ids:e.ids,onComplete:function(r){for(var n=(r="string"==typeof r?JSON.parse(r):r).results?r.results:[],o={},s=0;s<n.length;++s){var l=i.getPlmTypeFromContentDetails(n[s].attributes),d=a.convertToExaleadDataFormatFederated(n[s]);d.plmType=l,"RootLibrary"===d.plmType?"Standard"==d.grid["ds6w:classificationUsage"]?d.icons=[{iconName:"library-lined"}]:d.icons=[{iconName:"library"}]:"Standard"==d.grid["ds6w:classificationUsage"]?d.icons=[{iconName:"library-class"}]:d.icons=[{iconName:"library-class-filled"}],o[d.physicalid]=d}var c=[];e.ids.forEach((e=>{o[e]&&c.push(o[e])})),t(c)},onFailure:function(e){r(e)}})}))},comparator:function(e,t){var i,r="LibrarySection_favorite"===e.getParent().plmType;if(r)return null;if(e.isRoot()&&t.isRoot()||r)return null;if("date"!==widget.getValue("sortMode"))return e.options.label.localeCompare(t.options.label);try{i=new Date(e.options.created)>new Date(t.options.created)?1:new Date(e.options.created)<new Date(t.options.created)?-1:0}catch(r){i=e.options.created<t.options.created?-1:1}finally{return i}},shouldBeEditable:function(e){return r.shouldBeEditable(e)},getContextualMenu:function(e){return!1===d.getWidgetOptions().enableTreeCtxMenu?[]:o.GetContextualMenu(e,"TREE")},onContentUpdate:function(e){return r.onNodeModelUpdate(e)},isValidType:function(e){return i.inFamilyLibrary(e)},isSection:function(e){return"LibrarySection_favorite"==e||"LibrarySection_AllLibraries"==e},isTreeNodeEditable:function(e){return!!(e&&e.nodeModel&&e.nodeModel.getParent())&&"LibrarySection_favorite"===e.nodeModel.getParent().plmType},isPreferenceSection:function(e){return"LibrarySection_favorite"==e},getSectionsData:function(){var e=[],t={};t.label=l.name_Section_FavoriteLibraries,t.icon=s.getWebappsAssetUrl("LibraryEditor","icons/libraryfavorites.png"),t.plmType="LibrarySection_favorite",e.push(t);var i={};return i.label=l.name_Section_AllLibraries,i.icon=s.getWebappsAssetUrl("LibraryEditor","icons/librarysectionall.png"),i.plmType="LibrarySection_AllLibraries",i.defaultSelectedSection=!0,e.push(i),e},getPreferenceSectionName:function(){return y.getFavorites()},getSecurityContextAndData:function(){return r.getCurrentSecurityContextAndLibraryData()},getObjectNotVisiblemessage:function(){return l.msg_error_NoVisibleRootLibrary},isDNDSupported:function(){return!1!==d.getWidgetOptions().enableDnd},isRoot:function(e){return!(!e||!e.flattenedtaxonomies||"types/Libraries"!==e.flattenedtaxonomies[0]||"types/General Library"!==e.flattenedtaxonomies[1])},getStatesFilterModel:function(){var e={id:"filterByStates",dataElements:{typeRepresentation:"functionMenuIcon",value:{menu:[]},tooltip:{title:l.CMDMaturityStates_label,shortHelp:l.CMDMaturityStates_shortHelp},label:l.CMDMaturityStates_longTitle,icon:{},position:"far",category:"1"}};return e.dataElements.value.menu=this.getMenuForStatesFilter(),e.dataElements.icon={iconName:"filter",className:p,fontIconFamily:1},e},getMenuForStatesFilter:function(){widget.getValue("filteredStates")?(g=null,g=UWA.clone(widget.getValue("filteredStates"))):widget.setValue("filteredStates",UWA.clone(g)),p="selected"==g.AllMaturityStates?"":"filter-active";var e=Object.keys(g),t=[];return e.forEach((e=>{var i={type:"CheckItem",state:g[e]};i.action={callback:function(e){c.applyMaturityFilter(e)},context:e},i.title=l["state_"+e],t.push(i)})),t},updateMenuForStatesFilter:function(e,t){if("AllMaturityStates"==e){for(const e in g)g[e]="unselected";g.AllMaturityStates="selected"}else g.AllMaturityStates="unselected","unselected"==g[e]?g[e]="selected":g[e]="unselected";widget.setValue("filteredStates",UWA.clone(g));var i=this.getMenuForStatesFilter(),r={iconName:"filter",className:p,fontIconFamily:1};d.getTreeCont().getView().leftToolbar.updateNodeModel("filterByStates",{grid:{data:{menu:i}},icon:r}),d.getTreeCont().refreshLibraryTree(),d.getContent().refreshLibraryContent(),t&&f.displayNotification({message:l.msg_info_stateSwitch,className:"primary"})},getCurrentFilteredStates:function(){return g},setCurrentFilteredStates:function(e){g=null,g=e},resetFilterIfNodeIsNotCompliant:function(e){c.switchToAllMaturityFilterIfPathNotCompliant(e)}})})),define("DS/LibraryEditor/commands/ActionBar_RemoveContentCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUX/utils/IPClassifyModeManager","DS/IPClassifyUtil/IPContext","DS/LibraryEditor/commands/LibraryCommands","DS/WidgetServices/WidgetServices"],(function(e,t,i,r,n,a,o){"use strict";return t.extend({labelTopBar:e.i18n("Remove Content"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/LibraryEditor/commands/LibraryCommands"],(function(e){}))},beginExecute:function(){},execute:function(){require(["DS/LibraryEditor/utils/Library_CSO","DS/IPClassifyUXUtil/IPClassifyConfirmation","DS/IPClassifyUtil/IPClassifyAlert","DS/ApplicationFrame/CommandsManager","DS/LibraryEditor/service/LibraryServices","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/service/LibraryEditorWebService","DS/Controls/Loader","DS/Controls/ModalContainer","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],(function(t,i,o,s,l,d,c,u,f,g){var p=t.getCurrentLibrary();if(p){var y={},m=[],b=t.getSelectedNodes(),h=b.length;if(h>0){m=[];b.forEach((function(t){m.push(e.is(t.id)?t.id:t.options.resourceid)}))}var v=!1;function C(c){i.confirmDialog(c,(function(){p.getType();var i=t.getSelectedNodes(),c=i.length;let y=n.get()?n.get().toString():void 0;if(c>0){var m=new u({text:g.Loading,showButtonFlag:!1});f.createModal(widget.body.globalLoaderContainer,m.elements.container),m.on(g.Loading);var b=s.getCommand("RemoveContent",y);b.disable();var h=[],v=null;i.forEach((function(t){null===v&&"noExpandState"!==t._expandState&&!0===widget.getBool("filtered-content")&&(v=!0),h.push(e.is(t.id)?t.id:t.options.resourceid)})),l.RemoveContent({IDs:h,callbacks:{onComplete:function(e){if(r.setAuthoringMode("authoring",g.replace(g.msg_info_objetremoved,{number:h.length,libraryname:p.options.label})),v||h.length>10)d.getContent().RefreshProductStructure=!0,d.getContent().loadContentAndSelect(p);else{for(var t=0;t<h.length;t++){var i=h[t];d.getContent()._libraryContentView.removeNodeInContent(i)}r.updateRefreshTime()}0===d.getContent()._libraryContentView.options.model.getAllDescendants().length&&d.getContent().getView()._addPlaceHolder(),f.removeModal(widget.body.globalLoaderContainer),m.off(g.Loading)},onFailure:function(e){if(f.removeModal(widget.body.globalLoaderContainer),m.off(g.Loading),b.enable(),"string"==typeof e)a._commonError("RemoveContentCmd",g.msg_error_Removefromlibrary,e);else{var t=e.errorMsg;e.itemsNotRemovedCount>1&&(t=t||g.msg_error_itemsNotRemoved+" \n "+e.itemsNotRemovedCount),o.displayNotification({message:t||g.msg_error_Removefromlibrary,className:"warning"}),e.itemsNotRemovedCount&&e.itemsNotRemovedCount<h.length&&(r.setAuthoringMode("authoring","none"),d.getContent().RefreshProductStructure=!0,d.getContent().loadContentAndSelect(p))}},onTimeout:function(e){f.removeModal(widget.body.globalLoaderContainer),m.off(g.Loading),o.displayNotification({title:g.removeContentTimeout.title,subtitle:g.removeContentTimeout.subtitle,className:"warning"})}}})}else o.displayNotification({message:g.msg_warning_nocontent,className:"warning"})}))}function _(t,i,r){var n=[],a=[{dataIndex:"Tree",text:g.Title},{dataIndex:"Type",text:g.Type},{dataIndex:"Revision",text:g.Revision},{dataIndex:"modifyAccess",text:g.CanBeModified,alignment:"center",typeRepresentation:"url",getCellValue:function(e){if(e.nodeModel)return"true"==e.nodeModel.getAttributeValue("modifyAccess")?{icon:"check"}:{icon:"wrong"}}}];i.forEach((function(t){var i={};i.Tree=e.is(t.options.label)?t.options.label:t.options.grid.Name,i.Type=t._options.grid["ds6w:type"],i.Revision=t._options.grid["ds6wg:revision"],i.modifyAccess=r&&r.includes(t.id)?"false":"true",n.push(i)})),t.cols=a,t.data=n}y.deleteButtonLabel=g.title_remove,y.warningInfo=g.msg_removeContentInfo,y.buttonColor="blue",h>1?(v=!0,y.titleLabel=g.replace(g.titleRemoveContent,{number:h}),y.warningMessage=g.replace(g.msg_removeContents,{className:p._options.label})):(y.titleLabel=g.title_remove+" - "+b[0]._options.label,y.warningMessage=g.replace(g.msg_removeContent,{objectLabel:b[0]._options.label,className:p._options.label})),p._options&&p._options.grid&&"Definition"==p._options.grid["ds6w:classificationUsage"]?c.checkModifyAccessOnItems({objectIds:m,onComplete:function(e){var t=e?JSON.parse(e):void 0;v&&_(y,b,t.unModifiableIds),v&&t.unModifiableIds.length>0&&(y.confirmationBoxText=g.confirmationMsgMultiple,y.showDGV=!0,y.enableConfirmationBox=!0,y.buttonColor="red",y.moreInfo=g.msg_removeContentsMoreInfo,_(y,b,t.unModifiableIds)),t.unModifiableIds.length>0&&(y.confirmationBoxText=g.confirmationMsg,y.moreInfo=g.msg_removeContentMoreInfo,y.enableConfirmationBox=!0,y.buttonColor="red"),C(y)},onFailure:function(e){console.log(" Error while fetching modify access on items")}}):(v&&(y.showDGV=!0,_(y,b,[])),C(y))}else o.displayNotification({message:g.msg_warning_nocurrentlibrary,className:"warning"})}))},endExecute:function(){}})})),define("DS/LibraryEditor/dataProvider/LibraryDnDServiceProvider",["UWA/Class","DS/IPClassifyUtil/IPClassifyAlert","DS/LibraryEditor/commands/LibraryCommands","DS/LibraryEditor/service/LibraryServices","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/service/LibraryTypeService","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUX/utils/IPClassifyModeManager","DS/LibraryEditor/service/LibraryEditorWebService","DS/IPClassifyUXUtil/IPClassifyConfirmation","DS/Controls/Loader","DS/Controls/ModalContainer","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],(function(e,t,i,r,n,a,o,s,l,d,c,u,f,g){"use strict";return e.singleton({shouldAcceptDrag:function(){var e=!0,t=a.getSelectedNodes();if(t.length>0){for(var i=0;i<t.length;++i)if("Content"!==t[i].plmType&&"Library"!==t[i].plmType){e=!1;break}}else e=!1;return e},shouldAcceptDrop:function(e){var t=!1;return e||(e=a.getCurrentLibrary()),"RootLibrary"!==e.plmType&&o.inFamilyLibrary(e.plmType)&&(t=!0),t},addContentInObject:function(e,s,p,y,m){if(e&&e.plmType&&o.inFamilyLibrary(e.plmType)&&p){if(e.id===s)return void t.displayNotification({message:g.msg_error_MoveInSamelibrary,className:"error"});var b=p,h=b.length;if(h<1)return void console.log("  Error in LibraryDnDService.addContentInLibrary, lContentId list is empty");var v=p,C=e,_={},S=v.length,L=!1;function E(o){var s=new u({text:g.Loading,showButtonFlag:!1});f.createModal(widget.body.globalLoaderContainer,s.elements.container),s.on(g.Loading);var d=a.getCurrentLibrary();r.AddContent({IDs:b,library:e,callbacks:{onComplete:function(r){var c,u,p;f.removeModal(widget.body.globalLoaderContainer),s.off(g.Loading);var y=!1,m=(b.length,c=g.replace(g.add_in_class,{libraryname:e.options.label}));if(r){var v=JSON.parse(r),C=v.totalCount,_=v.failedCount,S=v.alreadyExistCount,L=v.errorMsg;_>0?(S>0?_==S?C==_?(c=g.all_in_class,p="info"):C>_&&(c=g.replace(g.few_added_few_exist,{OK:C-_,exist:S}),y=!0):_>S&&(C==_?c=g.replace(g.few_exist_few_failed,{exist:S,KO:_-S}):C>_&&(c=g.replace(g.few_added_few_exist,{OK:C-_,exist:S}),y=!0,u=g.replace(g.few_failed,{KO:_-S}),p="error")):_==C?c=g.all_failed:_<C&&(c=g.replace(g.few_added,{OK:C-_}),y=!0,u=g.replace(g.few_failed,{KO:_}),p="error"),c&&(c=m+": "+c)):(c=g.replace(g.msg_info_Addinlibrary,{number:C,libraryname:e.options.label}),y=!0)}if(1==y){l.setAuthoringMode("authoring",c);var E=n.getContent(),D=a.getCurrentLibrary();if(E&&D&&D.id===e.id){i._endProgressBarListener();var A=E._libraryContentView.getPADTreeDocument();A&&A.keepExpandedState(),E.loadContentAndSelect(D,b[h-1]),E.getView().maskContentDiv(!1)}u&&(L&&(u=L),t.displayNotification({title:m,subtitle:u,className:p}))}else L?(c=L,L.contains("ClassNotActiveError")&&(c=g.AddExistingClassNotActive.subtitle+g.AddExistingClassNotActive.message)):o&&o.length>0&&(c=g.replace(g.noAccess_Error,{className:d.options.label})),p||(p="error"),t.displayNotification({title:m,subtitle:c,className:p})},onFailure:function(i){var r=n.getContent(),o=a.getCurrentLibrary();f.removeModal(widget.body.globalLoaderContainer),s.off(g.Loading),r&&o&&o.id===e.id&&r.getView().maskContentDiv(!1),t.displayNotification({message:i?g.msg_error_Addinlibrary+"<br>"+i:g.msg_error_Addinlibrary,className:"error"})},onTimeout:function(e){f.removeModal(widget.body.globalLoaderContainer),s.off(g.Loading),t.displayNotification({title:g.addExistingContentTimeout.title,subtitle:g.addExistingContentTimeout.subtitle,className:"warning"})}}})}function D(e,t,i){var r=[],n=[{dataIndex:"Tree",text:g.Title},{dataIndex:"modifyAccess",text:g.Access,alignment:"center",typeRepresentation:"url",getCellValue:function(e){if(e.nodeModel)return"true"==e.nodeModel.getAttributeValue("modifyAccess")?{icon:"check"}:{icon:"wrong"}}},{dataIndex:"Type",text:g.Type}];t.forEach((function(e){var t={};t.Tree=e.droppedItem_name,t.Type=e.droppedItem_type,t.modifyAccess=i&&i.includes(e.droppedItem_id)?"false":"true",r.push(t)})),e.cols=n,e.data=r}_.deleteButtonLabel=g.title_Add,_.buttonColor="blue",S>1?(L=!0,_.titleLabel=g.title_Add+" "+S+" classified items",_.warningMessage=g.replace(g.msg_addContents,{className:C._options.label})):(_.titleLabel=g.title_Add+" - "+m[0].droppedItem_name,_.warningMessage=g.replace(g.msg_addContent,{objectLabel:m[0].droppedItem_name,className:C._options.label})),C._options&&C._options.grid&&"Definition"==C._options.grid["ds6w:classificationUsage"]?d.checkModifyAccessOnItems({objectIds:v,onComplete:function(e){var t=e?JSON.parse(e):void 0;L&&(_.showDGV=!0,D(_,m,t.unModifiableIds)),L&&t.unModifiableIds.length>0&&(_.showDGV=!0,_.moreInfo=g.msg_addContentsMoreInfo,D(_,m,t.unModifiableIds)),t.unModifiableIds.length>0?(_.moreInfo=g.msg_addContentMoreInfo,c.confirmDialog(_,E,void 0,t.unModifiableIds)):E()},onFailure:function(e){console.log(" Error while fetching modify access on items"),E()}}):E()}else console.log("  Error in LibraryDnDService.addContentInLibrary, dropTarget_LibraryNodeModel is not a Library")},addClassesInLibrary:function(){t.displayNotification({message:g.msg_warning_dndnotsupported,className:"warning"})},getDroppedData:function(e){var t=[],i=[],r=[];if(e&&e.data&&e.data.items&&Array.isArray(e.data.items)){for(var n=0;n<e.data.items.length;n++){var a=e.data.items[n],s=a.objectId,l=a.objectType_Internal;if(l||(l=a.objectType),Array.isArray(l)){for(var d=l.length,c=d>0?l[d-1]:void 0,u=0;u<d;++u)if(o.inFamilyLibrary(l[u])){c=l[u];break}l=c}var f=a.displayName;f||(f=l),f||(f=s);var g={droppedItem_id:s,droppedItem_type:l,droppedItem_name:f,droppedSourceLibrary_id:a.libraryId,droppedItem_tenantId:a.envId};o.isRootLibrary(l)?t.push(g):o.isLibrary(l)?i.push(g):r.push(g)}var p={};return p.RootLibrary_itemList=t,p.Library_itemList=i,p.Content_itemList=r,p}},inFamilyLibrary:function(e){return o.inFamilyLibrary(e)}})})),define("DS/LibraryEditor/commands/ActionBar_ExpandAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/LibraryEditor/commands/LibraryCommands","DS/LibraryEditor/utils/Library_CSO"],(function(e,t,i,r){"use strict";return t.extend({labelTopBar:e.i18n("Expand All"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){var e=r.getSelectedNodes();if(e.length){var t=e[0];i.ExpandAllCmd(t,"CONTENT")}else{var n=r.getCurrentLibrary();i.ExpandAllCmd(n,"TREE")}},endExecute:function(){}})})),define("DS/LibraryEditor/utils/DimensionUtils",["UWA/Class","DS/LibraryEditor/service/LibraryEditorWebService"],(function(e,t){"use strict";return e.singleton({init:function(e){},setUnitPreferedMe:function(e){this.unitPreferedMe=e},getUnitPreferedMe:function(e){return this.unitPreferedMe[e]},getDimensions:function(){var e=this;return new Promise((function(i){e._dimensions?i(e._dimensions):t.getDimensionsInfos({method:"GET",Accept:"application/json","content-type":"application/json",onComplete:function(t){try{t="string"==typeof t?JSON.parse(t):t;var r={};t.results.forEach((function(e){var t={};t.mksUnitDBName=e.MKSUnit;e.Units.forEach((function(e){t[e.Name]=e.NLSName,t.mksUnitDBName==e.Name&&(t.defaultUnit=e.NLSName)})),r[e.Name]=t})),e._dimensions=r,console.info("Dimensions Loaded ..."),i(e._dimensions)}catch(e){console.error("Unexpected error when fetching dimensions"),console.error(e),i(null)}},onFailure:function(e){console.error("Unable to get dimentions : "),console.error(e),i(null)}})}))}})})),define("DS/LibraryEditor/dataProvider/LibraryContentDataProvider",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/PADUtils/PADProbes","DS/WebappsUtils/WebappsUtils","DS/LibraryEditor/utils/LibraryEditorDataConversion","DS/LibraryEditor/service/LibraryEditorWebService","DS/IPClassifyUtil/service/IPClassifyUtilWebService","DS/LibraryEditor/service/LibraryTypeService","DS/IPClassifyUtil/IPClassifyPreference","DS/IPClassifyUXUtil/IPClassifyConfirmation","DS/LibraryEditor/utils/LibraryEditorUtil","DS/IPClassifyUX/utils/IPClassifyModeManager","DS/LibraryEditor/utils/LibrarySearch","DS/LibraryEditor/commands/LibraryCommands","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/IPClassifyUtil/IPClassifyUtility","DS/LibraryEditor/utils/DimensionUtils","DS/LibraryEditor/utils/Library_CSO","DS/WidgetServices/WidgetServices","DS/IPClassifyUX/LibrarySearchWithinController"],(function(e,t,i,r,n,a,o,s,l,d,c,u,f,g,p,y,m,b,h,v,C,_,S){"use strict";var L={datePredicateForTagger:[],dimensions:[],integers:[],predicates:{},rangeAttributes:{},attributeTitle:{}},E={FAVORITES:"ipcFavoriteList_v1",getFavorites:function(){return h.getTenantAwarePreferenceName(this.FAVORITES)}};function D(e){const t=e.split("/");return t.length>1?t[1]:null}var A=t.singleton({dateRangePredsList:[],getDeprecatedRangeValues:{},addedrangesForAttributes:{},dynamicAttributeRangeNlsMap:{},getObjectsForRefresh:function(e,t){var r=this;return new i((function(i){var n=[],s=g.getPredicateUnitMapping();t.forEach((function(e){e.isDynamic?(-1===n.indexOf(e.dbAttribute)&&n.push(e.dbAttribute),s[e.dbAttribute]&&(s[e.dbAttribute].fetchInputUnit||s[e.dbAttribute].displayAsEntered)&&(n.push(e.dbAttribute+".inputunit"),n.push(e.dbAttribute+".inputvalue"))):e.attrDBName&&e.attrDBName.length>0&&e.attrDBName.forEach((function(e){e.startsWith("attribute[")&&n.push(e)}))})),o._performFetchQuery({ids:e,dynamicAttrs:n,isAuthoringMode:!0,onComplete:function(e){var n=[];e.results&&e.results.length>0&&e.results.forEach((function(e){n.push(a.convertToExaleadDataFormatFederated(e))})),L.rangeAttributes&&n.forEach((e=>{for(const n in L.rangeAttributes){var t=Object.keys(L.predicates).find((e=>L.predicates[e]===n)),i=e.grid[t];if(Array.isArray(i))for(var r=0;r<i.length;r++)e.grid[t][r]=L.rangeAttributes[n][i[r]];else e.grid[t]=L.rangeAttributes[n][i]}})),r.getInputWSConvsionUnits(t,n,!0).then((function(e){var t=e.mapping,a=e.data;a.Data&&a.Data.length>0?r.convertToPreferdUnits(a).then((function(e){null!==e&&(e="string"==typeof e?JSON.parse(e):e,t.forEach((function(t){e.forEach((function(e){if(t.UnitFrom===e.UnitFrom&&t.UnitTo===e.UnitTo){var i=r.formatResult(t.isMultiVal,t.mksValue,e.ValuesToConvert,e.ConvertedValues);i.length>0&&(n[t.rowIdx].grid[t.dataIndex]=i.join(",")+" "+t.UnitTo_nls)}}))}))),i(n)})):i(n)}))},onFailure:function(){console.error("Unable to update Content root node, Error in getting content Properties"),i(null)}})}))},setIconsForLibraries:function(e,t){var i,r=e.options.thumbnail;"General Class"==e.options.type&&"Definition"==e.options.grid["ds6w:classificationUsage"]&&((i=[]).push(n.getWebappsAssetUrl("LibraryEditor","icons/categorizationIcons/GeneralClass_small.png")),r.includes("I_GeneralClass")&&(e.options.thumbnail=n.getWebappsAssetUrl("LibraryEditor","icons/categorizationIcons/GeneralClass_Tile.png")),e.options.icons=i);"General Library"==e.options.type&&"Standard"==e.options.grid["ds6w:classificationUsage"]&&((i=[]).push(n.getWebappsAssetUrl("LibraryEditor","icons/categorizationIcons/GeneralLibrary_small.png")),r.includes("I_GeneralLibrary")&&(e.options.thumbnail=n.getWebappsAssetUrl("LibraryEditor","icons/categorizationIcons/GeneralLibrary_Tile.png")),e.options.icons=i)},convertDateFilterToUQL:function(t){var i,r,n,a,o="",s=0,l=null,d=null,c=null,u=null,f=this;if(t.isSimplified&&t.condition){var g={};t.condition.forEach((function(e){Object.keys(e).forEach((function(t){0===t.indexOf("sixw:")&&(g[t]=e[t])}))})),t=g}var p={},y=null;for(var m in t)y={sixw:!1},0===m.indexOf("sixw:")&&(l=m.replace("sixw:",""),y.sixw=!0),e.is(p[m],"array")||(p[m]=[]),p[m].push(t[m]);for(var b in t)if(0===b.indexOf("sixw:")){if("ds6w:dataSource"===(l=(l=b.replace("sixw:","")).split("/").pop()))continue;l="["+l+"]",i=t[b],d="",0<s&&(d=" AND "),s++;var h=!1;for(n=0;n<i.length;n++)if(r=i[n],e.is(r.type)){if(0===n&&1<i.length&&(d+="( ",h=!0),0<n&&h&&(d=" OR "),"date"===r.type){if(!e.is(r.object))continue;e.is(r.object.from)&&(c=new Date(r.object.from+" 00:00:00"),a=l+'>="'+new Date(c).toISOString()+'"',a=A._checkExclude(r,a),o=A._checkExcludeRangeStart(r,o),o+=d+a,e.is(r.object.to)&&(d=" AND ")),e.is(r.object.to)&&(u=new Date(r.object.to+" 23:59:59"),a=l+'<="'+new Date(u).toISOString()+'"',a=A._checkExclude(r,a),o=A._checkExcludeRangeEnd(r,o),o+=d+a)}else if("double"===r.type){if(!e.is(r.object))continue;e.is(r.object.from)&&(a=l+">="+r.object.from,a=f._checkExclude(r,a),o=f._checkExcludeRangeStart(r,o),o+=d+a,e.is(r.object.to)&&(d=" AND ")),e.is(r.object.to)&&(a=l+"<="+r.object.to,a=f._checkExclude(r,a),o=f._checkExcludeRangeEnd(r,o),o+=d+a)}h&&i.length===n+1&&(o+=" )")}}return o},getConfigurePredicates:function(e){var t={};this.dateRangePredsList=[];let i=new Set;if(e)return e.forEach((e=>{if("daterange"===e.type||"real"===e.type){const r=e.sixw.split("/")[1];i.add(r),t[r]={freeInputOnly:!0}}})),this.dateRangePredsList=Array.from(i),t},_checkExclude:function(t,i){return!0!==t.excluded||e.is(t.object.to)&&e.is(t.object.from)||(i=" NOT ("+i+")"),i},_checkExcludeRangeStart:function(t,i){return!0===t.excluded&&e.is(t.object.to)&&e.is(t.object.from)&&(i+=" NOT ("+i),i},_checkExcludeRangeEnd:function(t,i){return!0===t.excluded&&e.is(t.object.to)&&e.is(t.object.from)&&(i+=")"),i},getNlsForAttributes:function(){},getObjectDynamicAttributes:function(e,t){var r=this,n=[],a=[],s=[],l=[],d={generatedPredicates:{}},c=[],f=[],p=[],y=[],b=[],h={};return new i((function(i,v){"RootLibrary"!==e.type?u.getClassAttrPos().then((function(u){o.getClassificationAttributes({classid:e.id,onComplete:function(e){L={datePredicateForTagger:[],dimensions:[],integers:[],predicates:{},rangeAttributes:{},attributeTitle:{}};var o=JSON.parse(e),m=o.attribute;m||(m=o.Attribute);var v=m;if(m.forEach((function(e){e.classAttributeOrder=parseInt(e.classAttributeOrder)})),m.sort(((e,t)=>e.classAttributeOrder-t.classAttributeOrder)),m.length>0){for(var C=[],E=0,D=m.length;E<D;++E){var A=m[E].predicate,w=m[E].name,I=!1;n[E]=m[E].nls_label||w,L.attributeTitle[w]=n[E];let e=m[E].type;if(A||(A="ds6wg:"+w.replace(new RegExp(" ","g"),"_")),a[E]=A,s[E]="attribute["+w+"]",c[E]=e,p[E]=m[E].valuetype,b[E]=[],m[E].range&&Array.isArray(m[E].range)&&m[E].range.length>0&&(1==m[E].range.length&&"between"==m[E].range[0].operator||(L.rangeAttributes[w]=[],r.dynamicAttributeRangeNlsMap[A]=[],m[E].range.forEach((e=>{let t=e.value;m[E].nls_range&&m[E].nls_range[t]?(L.rangeAttributes[w][t]=m[E].nls_range[t],r.dynamicAttributeRangeNlsMap[A].push({value:t,label:m[E].nls_range[t]}),b[E].push(m[E].nls_range[t])):(L.rangeAttributes[w][t]=t,r.dynamicAttributeRangeNlsMap[A].push({value:t,label:t}),b[E].push(t))})),v[E].authRange=b[E])),y[E]=m[E].manipulationUnit,m[E].dimension){var T=!0,P=null;y[E]&&(P=m[E].dimensionUnits[y[E]]);var x="";m[E].dimensionUnits&&m[E].dimensionUnits.defaultUnit&&(x=m[E].dimensionUnits.defaultUnit),x==P&&(T=!1);let e={preferredUnit:T,unit:P||x,predicate:a[E],dimension:m[E].dimension,unitName:m[E].manipulationUnit,unitMap:m[E].dimensionUnits?m[E].dimensionUnits.nlsToUnits:{},displayAsEntered:"Yes"==m[E].displayAsEntered};L.dimensions[a[E]]=e}if("multival"==m[E].valuetype&&"timestamp"==c[E]&&(y[E]="multivalueTimestamp"),L.predicates[a[E]]=w,"integer"==c[E]){let e={predicate:a[E]};L.integers.push(e)}if("real"==c[E]&&m[E].dimension||m[E].valuetype&&"multival"==m[E].valuetype?c[E]="string":"timestamp"==c[E]?c[E]="date":"real"==c[E]?c[E]="float":"TRUE"==m[E].multiline&&(c[E]="multiline"),"multival"==m[E].valuetype&&"timestamp"==e&&(c[E]="date"),f[E]=u?E:void 0,m[E].dimension){var U=m[E].manipulationUnit;if(U&&U.length>0&&"Yes"!=m[E].displayAsEntered)h["attribute["+w+"].manipulationUnit"]=U;else if(m[E].valuetype&&"multival"!=m[E].valuetype&&!_.isNatifEnvironnement()){if(t)l.push("attribute["+w+"].inputunit"),l.push("attribute["+w+"].inputvalue");else if(A)if(A.startsWith("ds6wg:"))l.push(A+"inputunit"),l.push(A+"inputvalue");else{var N="ds6wg:"+w.replace(new RegExp(" ","g"),"_");l.push(N+"inputunit"),l.push(N+"inputvalue"),d.generatedPredicates[N]=A}I=!0}A&&(d[A]=m[E].dimensionUnits),d["attribute["+w+"]"]=m[E].dimensionUnits,"Yes"==m[E].displayAsEntered&&(d["attribute["+w+"]"].displayAsEntered=!0),I&&(d["attribute["+w+"]"].fetchInputUnit=!0),h["attribute["+w+"].dimension"]=m[E].dimension.substring(m[E].dimension.indexOf("_")+1),C.push("attribute["+w+"]")}}h.attrsToConvert=C}g.resetAttrNameToPredMapping(),g.setPredicateUnitMapping(d),g.resetDynamicHeaderMap();for(E=0;E<s.length;++E)g.addToDynamicHeaderMap({text:n[E],dataIndex:a[E],dbAttribute:s[E]}),g.setAttrNameToPredMapping({key:s[E],value:a[E]});v._attributesInfo=L,S.feedClassificationAttributes(v),S.feedUnitManipulationDatas(d),i({dynamicattributes:a,dynamicattributesForUIView:n,dynamicattributesName:s,unitPredicates:l,unitData:d,dynamicattributesType:c,dynamicattributesValueType:p,dynamicattributesIndex:f,convUnitInfos:h,dynamicattributesRange:b,dynamicattributesUnit:y,dynamicAttributeRangeNlsMap:r.dynamicAttributeRangeNlsMap})},onFailure:function(){console.log(m.get("msg_classificationattributes_webservicefailed")),v()}})})):i()}))},getTooltipIfDynamicColumn:function(e,t){if(t&&t.isDynamic){e.dataIndex=t.dataIndex;for(var i=g.getDynamicHeaderMap(),r=0;r<i.length;r++)if(e.dataIndex==i[r].dataIndex)return i[r].toolTip}return null},getObjectContents:function(e){let t="",r={};if(e.filters){if(A.dateRangePredsList.length>0)for(const t in e.filters)A.dateRangePredsList.includes(D(t))&&(r[t]=e.filters[t],delete e.filters[t]);Object.keys(r).length>0&&(t=A.convertDateFilterToUQL(r))}return new i((function(i,r){o.content({pid:e.pid,mxid:e.mxid,searchQuery:e.searchQuery,isExactSearch:e.isExactSearch,selectedType:e.selectedType,dynamicattributes:e.dynamicattributes,filters:e.filters,dateUqlQuery:t,start:e.start,next_start:e.next_start,order_field:e.order_field,order_by:e.order_by,isAuthoringMode:e.isAuthoringMode,grid:e.grid,onComplete:function(t){if((t="string"==typeof t?JSON.parse(t):t).result)return r=a.convertNavigateToSearchFormat(t.result),void i({contents:n(r),infos:t.infos,facets:t.facets});var r=function(e,t){var i=[];null!=e&&e.forEach((function(e){var r=!1;e.attributes&&e.attributes.forEach((function(e){"physicalid"===e.name&&e.value!=t&&(r=!0)})),r&&i.push(e)}));return i}(t.results,e.pid);function n(e){var t=[];return e.forEach((function(e){var i=a.convertToExaleadDataFormatFederated(e),r=e.attributes;i.plmType=l.getPlmTypeFromContentDetails(r),i.Documentlocked=e.Documentlocked,i.publishOnConnect=e.publishOnConnect,t.push(i)})),t}A.loadDimensions(e.attributesDimMap).then((function(){i({contents:n(r),infos:t.infos,facets:t.facets})}))},onFailure:function(e,t){r({err:e,serverErr:t,msg:m.msg_error_contentnotavailable})}})}))},getInputWSConvsionUnits:function(e,t,r){return new i((function(i){var n=[],a=[];v.getDimensions().then((function(o){for(var s=0;e&&s<e.length;++s){var l={},d=e[s];try{var c=o[d.convertInfos.dimension],u=c.mksUnitDBName,f=d.convertInfos.manipulationUnit;!f&&_.isNatifEnvironnement()&&(f=v.getUnitPreferedMe(d.convertInfos.dimension));var g=c[f];if(g&&g.length>0&&u!==f){var p=d.dataIndex,y=u+":"+f+":"+d.convertInfos.dimension;a[y]?l=a[y]:(l.UnitFrom=u,l.UnitTo=f,l.Dimension=d.convertInfos.dimension);for(var m=0;m<t.length;m++){var b=t[m],h=b.grid||b.options.grid;if(h[p+"_mksvalue"]&&h[p+"_mksvalue"].length>0&&("Content"===b.plmType||r)){var C=h[p+"_mksvalue"],S=Array.isArray(C)||C.indexOf(",")>-1;(S&&!Array.isArray(C)||!S)&&(C=C.trim().split(","));var L=C.join(";");try{var E=l.Values.split(";");C.forEach((function(e){-1==E.indexOf(e)&&E.push(e)})),l.Values=E.join(";")}catch(e){l.Values=L}l.Values&&l.Values.length>0&&(a[y]=l,n.push({modelId:b._id,rowIdx:r?m:b._getRowID(),dataIndex:d.dataIndex,mksValue:L,UnitFrom:u,UnitTo:f,UnitTo_nls:g,isMultiVal:S}))}}}}catch(e){}}var D={Data:[]};for(var A in a)D.Data.push(a[A]);i({mapping:n,data:D})}))}))},updateAttributesDelayedForUnits:function(e,t){if("OnSyncModel"===e.context||"OnScrollEnd"===e.context){var i=this;if(t){var r=t.layout.getLeafColumns(),n=e.collectionView;i.getInputWSConvsionUnits(r,n.model,!1).then((function(e){var t=e.mapping,r=e.data;r.Data&&r.Data.length>0&&i.convertToPreferdUnits(r).then((function(e){null!==e&&(e="string"==typeof e?JSON.parse(e):e,t.forEach((function(t){var r=n.model[t.rowIdx];e.forEach((function(e){if(t.modelId==r._id&&"Content"===r.plmType&&t.UnitFrom===e.UnitFrom&&t.UnitTo===e.UnitTo){var a=i.formatResult(t.isMultiVal,t.mksValue,e.ValuesToConvert,e.ConvertedValues);if(a&&a.length>0){var o=[];a.forEach((e=>{o.push(e+" "+t.UnitTo_nls)})),r.prepareUpdate(),r._resetting=!0,r.setAttribute(t.dataIndex,o),r.pushUpdate(),r._resetting=!0,n.setNodeModelValue(r,t.dataIndex,o),r._resetting=!0,n.setNodeModelValue(r,t.dataIndex+"_mksvalue",void 0),r._resetting=!1}}}))})))}))}))}}},formatResult:function(e,t,i,r){var n=[],a=i.split(";"),o=r.split(";");if(e)for(var s=t.split(";"),l=0;l<s.length;l++){if((c=a.indexOf(s[l]))>-1){var d=+o[c];if(isNaN(d))return;n.push(d.toString().indexOf(".")>-1?d:d+".0")}}else{var c;d=+o[c=a.indexOf(t)];if(isNaN(d))return;n.push(d.toString().indexOf(".")>-1?d:d+".0")}return n},hasWelcomePanel:function(){return!0},convertToPreferdUnits:function(e){return new i((function(t){o.convertDimensionUnits({data:e,onComplete:function(e){var i=(e="string"==typeof e?JSON.parse(e):e).Response?e.Response:[];t(i)},onFailure:function(e){console.error("Unable to convert dimentions units : "),console.error(e),t(null)}})}))},getPaginatedSectionContents:function(e){return new i((function(t,i){o.roots({filters:e.filters,start:e.start,next_start:e.next_start,order_field:e.order_field,order_by:e.order_by,searchQuery:e.searchQuery,onComplete:function(e){var i=[];e.results&&e.results.forEach((function(e){var t=a.convertToExaleadDataFormatFederated(e),r=e.attributes;t.plmType=l.getPlmTypeFromContentDetails(r),t.Documentlocked=e.Documentlocked,t.publishOnConnect=e.publishOnConnect,i.push(t)})),t({results:i,infos:e.infos,facets:e.facets})},onFailure:function(){i()}})}))},loadDimensions:function(e){return new i((function(t){v.getDimensions().then((function(i){if(null!=i){var r={},n=g.getPredicateUnitMapping();for(var a in e)if(i[e[a]]&&!n[a]){var o={};o[a]=i[e[a]],UWA.extend(r,o,!0)}g.setPredicateUnitMapping(r)}t()}))}))},getPreferenceSectionContents:function(e){return new i((function(t,i){o.favourites({ids:e.ids,onComplete:function(e){for(var i=(e="string"==typeof e?JSON.parse(e):e).results?e.results:[],r=[],n=0;n<i.length;++n){var o=l.getPlmTypeFromContentDetails(i[n].attributes),s=a.convertToExaleadDataFormatFederated(i[n]);s.plmType=o,r.push(s)}t(r)},onFailure:function(e){i(e)}})}))},checkEditable:function(e,t){return"Content"==e&&("FALSE"==t||!1===t)},getAttributesInfo:function(){return L},getContextualMenu:function(e,t,i,r){return!1===b.getWidgetOptions().enableCtxMenu?[]:p.GetContextualMenu(e,t,r)},comparator:function(e,t){return u.sortColumn(e,t)},getPreferenceSectionName:function(){return E.getFavorites()},isValidType:function(e){return l.inFamilyLibrary(e)},isValidTypeForPlaceholder:function(e){return!this.isSection(e)&&"RootLibrary"!==e},isSection:function(e){return"LibrarySection_favorite"==e||"LibrarySection_AllLibraries"==e},isPreferenceSection:function(e){return"LibrarySection_favorite"==e},toEnableTreeColumnEdit:function(e){return this.isPreferenceSection(e)},isPaginatedSection:function(e){return"LibrarySection_AllLibraries"==e},shouldBeEditable:function(e){return u.shouldBeEditable(e)},onContentUpdate:function(e){var t=e.data.nodeModel;return l.inFamilyLibrary(t.plmType)?u.onNodeModelUpdate(e):void A.updateClassificationAttributes(e,t)},updateClassificationAttributes:function(e,t){var i=this,r=t.id,n=e.data.attributes,a=Object.keys(n).toString(),s=L.predicates;if(Object.keys(s).includes(a)&&!(Object.keys(n).length>1)){if(t._resetting)return void(t._resetting=!1);var l=a.split(":")[1];l!==s[a]&&(l=s[a]);var d=l;if(l=l.replace(/_/g," "),void 0===n[a])return;var u=t.attributeValue[a],g="",p=null,b=null,h=null,v=L.dimensions,_=!1,S=!1,E=L.rangeAttributes,D=!1,A=!1,w=null,I=L.attributeTitle[l];Array.isArray(n[a])?(h=[],h=n[a].slice(),S=!0):(w=h=n[a].toString(),h=h.trim());var T=!1;function G(){t._resetting=!0,t.prepareUpdate(),t.setAttribute(a,u),t.pushUpdate()}function J(e){const t=(e=e.trim()).match(/^([-+]?\d*\.?\d+)\s*(\S*)$/);if(t){return{value:t[1],unit:t[2]||""}}return console.log("No match found"),null}var P=null;if(E[l]){if(A=!0,i.getDeprecatedRangeValues&&i.getDeprecatedRangeValues[r]&&i.getDeprecatedRangeValues[r][a]){var x=null,U=null;if(S){for(let X=0;X<h.length&&!(U=i.getDeprecatedRangeValues[r][a].find((e=>e.value===h[X])));X++);if(U)return void G();x=!0}else x=i.getDeprecatedRangeValues[r][a].find((e=>e.value===u));if(x){T=!0;var N={attributeNameToSend:d,value:h,pid:r,unit:p,asEnteredDimAttr:R,dimension:b,nodeModel:t,isRangeAttr:A,attributePredicate:a,oldValue:u},M={titleLabel:m.replace(m.deprecatedValueUpdate.title,{attrName:I}),moreInfo:m.deprecatedValueUpdate.moreInfo,deleteButtonLabel:m.deprecatedValueUpdate.buttonLabel,warningMessage:m.deprecatedValueUpdate.warningMessage,buttonColor:"blue"};c.confirmDialog(M,z,G,N,N)}}}else{if(u&&w&&(u==h||u==w))return;var O,F;void 0!==L.integers&&L.integers.length>0&&!A&&L.integers.forEach((e=>{if(e.predicate==a&&1!=t._resetting)if(D=!0,S){for(var i=0;i<h.length;i++)if(isNaN(h[i]))t._resetting=!0;else if(!Number.isInteger(parseFloat(h[i]))){t._resetting=!0;var r=m.replace(m.get("msg_warning_attributeValue"),{value:h[i],attributeName:I});y.displayNotification({message:r,className:"warning"});break}}else if(isNaN(n[a]))t._resetting=!0;else if(!Number.isInteger(parseFloat(n[a]))){t._resetting=!0;r=m.replace(m.get("msg_warning_attributeValue"),{value:h,attributeName:I});y.displayNotification({message:r,className:"warning"})}}));var R=!1;if(v&&v[a]){let Y=v[a];if(void 0!==Y.unit)if(_=!0,g=Y.unit,b=Y.dimension,p=Y.unitName,Array.isArray(h)){h.length<1&&(h=[]),_=!1,F=!0;var W=[];O=[],h.forEach((e=>{let t=(e=e.replace(" "+g,""))+" "+g;O.push(t),W.push(e)})),h=W}else{let Q=!0;if(h){if(Y.displayAsEntered){Q=!1,R=!0,_=!0;let K=J(h);if(K&&K.unit){if(h=K.value,!Y.unitMap[K.unit]||isNaN(h)&&""!==h.trim())return y.displayNotification({message:m.get("invalidUnit"),className:"warning"}),void G();p=Y.unitMap[K.unit].name,g=K.unit}else Q=!0}}else h="";if(Q){if(isNaN(h)&&""!==h.trim())return y.displayNotification({message:m.get("invalidUnit"),className:"warning"}),void G();h=h.replace(" "+g,"")}}}_&&(Number.isInteger(Number(h))&&(h=parseFloat(h).toFixed(1).toString()),O=h+" "+g,t._resetting=!0,t.prepareUpdate(),t.setAttribute(a,O),t.pushUpdate(),t._resetting=!1);var V=n[a],k=!1,B=function(e){return parseInt(e)<9?"0"+e:e};if(S){let Z=[];h.forEach((e=>{if(Date.parse(e)&&"function"==typeof e.getMonth){k=!0;var t=e.getUTCFullYear()+"/"+(parseInt(B(e.getUTCMonth()))+1)+"/"+B(e.getUTCDate())+"@"+B(e.getUTCHours())+":"+B(e.getUTCMinutes())+":"+B(e.getUTCSeconds())+":GMT";console.log("Converted to GMT date: "+t),Z.push(t)}})),k&&(h=Z)}else if(Date.parse(h)&&"function"==typeof V.getMonth){k=!0;var j=V.getUTCFullYear()+"/"+(parseInt(B(V.getUTCMonth()))+1)+"/"+B(V.getUTCDate())+"@"+B(V.getUTCHours())+":"+B(V.getUTCMinutes())+":"+B(V.getUTCSeconds())+":GMT";console.log("Converted to GMT date: "+j),h=j}}var q=t._lastUpdateTime?t._lastUpdateTime:0,H=Date.now()-q;if(t._lastUpdateTime=Date.now(),0!==q&&H<300)return;if(t._resetting)return t.prepareUpdate(),t.setAttribute(a,u),void t.pushUpdate();N={attributeNameToSend:d,value:h,pid:r,unit:p,asEnteredDimAttr:R,dimension:b,nodeModel:t,isRangeAttr:A};function z(e){var n=C.getCurrentLibrary().id,s=C.getCurrentLibrary()._options.usage;o.updateAttributesFromInformationPanel({attributeName:d,value:h,pid:r,unit:p,asEntered:R,dimension:b,classId:n,classUsage:s,onComplete:function(e){var n=m.replace(m.get("msg_warning_attributeValue"),{value:h,attributeName:I});if(D&&(n=m.get("msg_warning_integer")),e&&e.errors){e.errors=e.errors.replace(l,I);var o=e.errors.split("\n");n=o[0],o[1]&&(n=o[1]),y.displayNotification({message:n,className:"warning"}),t._resetting=!0,t.prepareUpdate(),t.setAttribute(a,u),t.pushUpdate()}else{if(_?t.attributeValue[a]=O:F?(t._resetting=!0,t.prepareUpdate(),t.setAttribute(a,O),t.pushUpdate(),P=O,t.attributeValue[a]=O):t.attributeValue[a]=h,n=k?m.replace(m.get("msg_info_updateAttribute"),{attribute:I,value:h}):m.replace(m.get("msg_info_updateAttribute"),{attribute:I,value:P||h}),A&&i.getDeprecatedRangeValues&&i.getDeprecatedRangeValues[r]&&i.getDeprecatedRangeValues[r][a]){var s=[];s=S?i.getDeprecatedRangeValues[r][a].filter((e=>!!h.includes(e.value))):i.getDeprecatedRangeValues[r][a].filter((e=>e.value==h)),i.getDeprecatedRangeValues[r][a]=s}console.log("Updated the attribute : ",I),f.setAuthoringMode("authoring",n),f.updateRefreshTime();var d={},c=[];c.push(r),d.modified=c,d.fromRenameOp=!1}},onFailure:function(e,i,r,n){var o=m.replace(m.get("msg_error_update"),{attribute:I});i&&i.contains("NumberFormatException")?(o=m.replace(m.get("msg_error_validNumber"),{attributeName:I}),y.displayNotification({message:o,className:"warning"})):y.displayNotification({message:o,className:"error"}),console.log("Error while updating the attribute :"+e),t._resetting=!0,t.prepareUpdate(),t.setAttribute(a,u),t.pushUpdate()}})}0==T&&z(N)}},getRepeatMode:function(){return u.getRepeatMode()},onAddColumn:function(e){g.filterExcludeListColumns(e).length>0&&(g.setPredicates(e),g.addToPredicateHeaderMap(e))},onRemoveColumn:function(e){g.removePredicates(e),g.removeFromPredicateHeaderMap(e)},onResetColumn:function(e,t){g.removeAllPredicates(),g.setPredicates(e,t)},setColumnNames:function(e,t){g.setPredicates(e,t)},initColumns:function(e){g.initPredicateToHeaderMap(e)},showContentPlaceholder:function(){return!0},isDNDSupported:function(){return!1!==b.getWidgetOptions().enableDnd},getAuthModeNoSortColumns:function(e){return g.getAuthModeNoSortColumns(e)},hasLibrarianRole:function(){return new i((function(e,t){e({readOnly:!0})}))},getLibraryControl:function(){return b},getLibraryEditorUtil:function(){return u},getLibraryTypeService:function(){return l},getAdditionalTooltipAttribute:function(){return[{label:"ds6w:classificationUsage",order:2}]},getStatus:function(e,t){return!1===e.contains(".")&&(e=t&&t.contains(" ")?t+"."+e.toUpperCase():t&&t.contains("_")?t+"."+(e=e.replace(" ","_")).toUpperCase():t&&e.contains(" ")?t+"."+(e=e.replace(" ","")):t+"."+e),e},setSortByCommandData:function(e){this.sortData=e},getSortByCommandData:function(){return this.sortData}});return A})),define("DS/LibraryEditor/commands/ActionBar_ContentSortCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/ApplicationFrame/CommandsManager","DS/LibraryEditor/dataProvider/LibraryContentDataProvider","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],(function(e,t,i,r,n,a){"use strict";return t.extend({init:function(e){this._parent(e,{}),this.options={},this.sortConfig={ContentSortByTitle:{order:"asc",field:"ds6w:label",flag:!1},ContentSortByModifiedDate:{order:"desc",field:"ds6w:modified"}},this.setdefaultSort()},beginExecute:function(){},execute:function(){const e=r.getCurrentCmdId();this.changeSortCommandIcon(e);const t=this.sortConfig[e],a={};t&&(a.sortOrder=t.order,a.sortField=t.field),n.setSortByCommandData(a),i.getContent().loadContentAndSelect()},setdefaultSort:function(){const e=this.sortConfig.ContentSortByModifiedDate,t={sortOrder:e.order,sortField:e.field};n.setSortByCommandData(t)},setLastSortOnCommandHide:function(){n.setSortByCommandData({sortOrder:this.sortConfig.ContentSortByModifiedDate.order,sortField:this.sortConfig.ContentSortByModifiedDate.field})},changeSortCommandIcon:function(e){switch(e){case"ContentSortByTitle":if(!this.sortTitleFlag){const t={title:a.ContentSortTitleTooltip,shortHelp:a.ContentSortTitleTooltipAsc};i.getIdCardCont().toolbars.stable.updateNodeModel(e,{tooltip:t})}this.sortTitleFlag?this.changeTitleIcon(e):this.sortTitleFlag=!0;break;case"ContentSortByModifiedDate":this.changeModifiedDateIcon(e)}},changeTitleIcon:function(e){this.toggleTitleButton(e);const t=this._titleIcon(e),r={title:a.ContentSortTitleTooltip,shortHelp:this._titleTooltip(e)};i.getIdCardCont().toolbars.stable.updateNodeModel(e,{icon:t}),i.getIdCardCont().toolbars.stable.updateNodeModel(e,{tooltip:r})},_titleIcon:function(e){const t=this.sortConfig[e];return{iconName:t&&"desc"===t.order?"alpha-sorting-z-a":"alpha-sorting-a-z",fontIconFamily:1}},_titleTooltip:function(e){const t=this.sortConfig[e];return t&&"desc"===t.order?a.ContentSortTitleTooltipDesc:a.ContentSortTitleTooltipAsc},toggleTitleButton:function(e){const t=this.sortConfig[e];t&&t.order&&(t.order="asc"===t.order?"desc":"asc")},changeModifiedDateIcon:function(e){this.toggleModifiedDateButton(e);const t=this._modifiedDateIcon(e),r={title:a.ContentSortModifiedDateTooltip,shortHelp:this._modifiedDateTooltip(e)};i.getIdCardCont().toolbars.stable.updateNodeModel(e,{icon:t}),i.getIdCardCont().toolbars.stable.updateNodeModel(e,{tooltip:r})},_modifiedDateIcon:function(e){let t="";return t="desc"===this.sortConfig[e].order?"date-sorting-31-1":"date-sorting-1-31",{iconName:t,fontIconFamily:1}},_modifiedDateTooltip:function(e){let t="";return t="desc"===this.sortConfig[e].order?a.ContentSortModifiedDateTooltipDesc:a.ContentSortModifiedDateTooltipAsc,t},toggleModifiedDateButton:function(e){const t=this.sortConfig[e];t&&t.order&&(t.order="asc"===t.order?"desc":"asc")},endExecute:function(){}})}));