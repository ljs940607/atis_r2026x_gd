define("DS/DELPPWLinksModule_FD02/LinksUI",["UWA/Core"],(function(e){"use strict";return function(t,n,o,s,r,a,l){var c,d,u,f,g,h,p,m,I,P,b,y,v,R,C,L,S,A,D,E,k,T,w,U,M={className:"Links MGA-linksUIContainer disableContentselection"},O=o.getNLSValue("LinksUI.PanelTitle"),N={},F=null,V={title:"",labelAttribute:"V_Name",reference:{model:null},instance:{model:null,absPath:""},whereUsed:{isFetched:!1,references:[],instances:[]}};return b=function(){e.is(F)&&(F.title=O+V.title)},y=function(){var i,o,s,r,a=n.getComponent("WUXFrameWindowsManager").getFrameWindow(t.getAppContext());(F=n.create("Panel",{position:{my:"center",at:"center"},domId:"RelationsPanel",immersiveFrame:a.getImmersiveFrame(),resizableFlag:!0,visibleFlag:!1})).close=function(){e.is(d)?t.notify("toggleCmdCheckHeaderState",{cmdName:d,cmdState:!1}):S()},p=n.create("Element","div",{class:M.className}),i=n.create("Element","div",{class:"linksPanel-Container"}),o=n.create("Element","div",{class:"module-messages"}),s=v(),r=R(),o.inject(i),s.inject(i),r.inject(i),i.inject(p)},v=function(){var t;return t=n.create("Element","div",{class:"linkView-toolbar"}),(m=n.create("Filter",{filterToolbarSections:g})).inject(t),m.addEvent("onChange",(function(t,n){var i,o;for(i in o=this.getSelectedItems(),N)N.hasOwnProperty(i)&&(-1===o.indexOf(i)?N[i].pprTypeDiv.hide():(e.is(t,"string")&&"PARENT"===t&&!0===n&&!1===V.whereUsed.isFetched&&A(),N[i].pprTypeDiv.show()))})),t},R=function(){var t,i;for(i in t=n.create("Element","div",{class:"LinksUI-menuDiv"}),(h=n.create("WUXLoader")).inject(t),N)N.hasOwnProperty(i)&&(N[i].pprTypeDiv=new e.Element("div",{class:"pprTypeDiv"}).inject(t));return t},C=function(t,i,r,a,l){var c,d=o.getNLSValue("LinksUI.ConfirmationDialog.Header"),u=o.getNLSValue("LinksUI.ConfirmationDialog.Text");c=function(n){e.is(n,"boolean")&&n&&s.switchScope(t,i,r,a,l)},n.showConfirmation(d,u,null,c)},L=function(t,s){var r,a,l=n.createElement("div",{class:"selectInstance-dialog-container"}),c=[],d=n.getComponent("ComboBox"),u=n.getComponent("Button"),f=o.getNLSValue("LinksUI.SelectInstanceDialog.Header");for(i=0;i<t.length;i++)c.push({label:t[i].get("PLM_ExternalID"),value:t[i]});(a=new d({elementsList:c,enableSearchFlag:!1,actionOnClickFlag:!1})).inject(l),(r=n.create("Dialog",{domId:"selectInstance-dialog",title:f,content:l,resizableFlag:!0,modalFlag:!0,width:400,minWidth:290,buttons:{Cancel:new u({onClick:function(){r.close()}}),Ok:new u({disabled:!1,emphasize:"primary",onClick:function(){r.close(),e.is(s,"function")&&s(a.currentValue)}})}})).close=function(){this.destroy()}},S=function(){F.hide()},A=function(){var n,i=!1,o=!1,a=[],l=[],c=[],d=V.reference.model,u=V.instance.model,f=V.labelAttribute,g=!1,p=null,I=[],P=function(){var e,n,s,r;i&&o&&(e=a,n=l,s=c,r={PRODUCT:[],PROCESS:[],SYSTEM:[],RESOURCE:[],PART:[],PARENT:[],SERVICE:[]},U(),r=E(e,d,u,f,r),r=k(n,s,d,u,f,r),D(r),h.hide(),t.notify("RelationsPanelLoaded")),g&&t.notify("updateRelationsColumn",p)},b=function(e){i=!0,a=e,P()};n=m.getSelectedItems(),!0!==V.whereUsed.isFetched?e.is(d)&&-1!==n.indexOf("PARENT")?(r.getWhereUsedReferences(d,(function(t,n){o=!0,e.is(V.whereUsed)&&(V.whereUsed.isFetched=!0,V.whereUsed.references=t,V.whereUsed.instances=n),l=t,c=n,P()})),V.whereUsed.isFetched=!0):o=!0:(e.is(d)&&-1!==n.indexOf("PARENT")&&(l=V.whereUsed.references||[],c=V.whereUsed.instances||[]),o=!0),U(),e.is(u)&&(g=g||r.needToQueryForConnections(u),e.is(p)||(p=u.get("PID"))),e.is(d)&&(g=g||r.needToQueryForConnections(d),e.is(p)||(p=d.get("PID"))),h.show(),r.isNavigateOnDemand()?(e.is(u)?I.push({id:u.get("PID"),path:V.instance.absPath}):e.is(d)&&I.push({id:d.get("PID"),path:[]}),I.length>0&&s.getRelations(I).then((function(t){var n,i;i=e.is(u)?u.get("PID"):d.get("PID"),n=s.getImpactedConnections(i),b(n)}))):s.getConnectionsByModel(d,u,{silentMode:!0,onComplete:b})},D=function(t){var i,s,a,l,c,d,u,f,g,h,p,I,P;for(a in p=m.getSelectedItems(),t)if(t.hasOwnProperty(a)&&N.hasOwnProperty(a)){if(l=t[a],s=N[a].pprTypeDiv,0===l.length){s.setStyle("display","none");continue}for(p.indexOf(a)>-1?s.show():s.hide(),s.addClassName("pprTypeMarg"),new e.Element("div",{class:"pprTypeTitleDiv",text:N[a].title}).inject(s),i=0;i<t[a].length;i++){if(u=n.create("Element","div",{class:"connectionDiv default"}),h=(c=t[a][i]).type,e.is(h)&&("SecondaryCandidateResourceLink"===h&&(u.className="connectionDiv secondaryRecource"),g=c.iconDirection,e.is(g)&&(-1!==h.indexOf("_inverse")?g.tooltipInfos=n.create("TooltipModel",{shortHelp:o.getNLSValue("LinksUI.BackwardIcon")}):g.tooltipInfos=n.create("TooltipModel",{shortHelp:o.getNLSValue("LinksUI.ForwardIcon")}),g.inject(u)),f=c.icon,e.is(f)&&(f.tooltipInfos=n.create("TooltipModel",{shortHelp:o.getNLSValue(h)}),f.inject(u))),(d=n.create("Element","div",{class:"connectionLabel",text:c.label,styles:{display:"inline-block"}})).tooltipInfos=n.create("TooltipModel",{shortHelp:c.label}),d.inject(u),e.is(V.reference)&&e.is(V.reference.model)){const e=V.reference.model;I=r.isReferencesHasReadOnlyType(e)}I||((P=n.create("Button",{label:"",icon:"bars",iconSize:"2x",displayStyle:"lite",onClick:T}).inject(u)).getContent().setStyles({float:"right"}),P.getContent().setData("pid",c.pid),P.getContent().setData("linkedReferencePID",c.linkedReferencePID)),u.inject(s)}}},E=function(n,i,a,d,u){var f,g,h,p,m,I,P,b,y,v,R,C,L,S,A,D,E,k=c,T=e.is(i)?i.id:"",w=e.is(a)?a.id:"";for(f=0;f<n.length;f++){switch(g=(P=n[f]._attributes).type){case"DELLmiTimeConstraintCnx":g=s.getLinkInfo(n[f]).subType;break;case"DELAsmProcessCanUseCnx":s.getSecondaryRscLinksFromPrimaryLink(n[f]).forEach((function(e){(E=e.clone()).set("from",P.from),n.splice(f+1,0,E)}));break;case"SecondaryCandidateResourceLink":if(D=s.getConnection(P.from),e.is(D)){(E=n[f].clone()).set("from",D.get("from")),n.splice(f+1,0,E),(E=n[f].clone()).set("from",D.get("to")),n.splice(f+1,0,E);continue}}if(R=P.to,!("ProcessImplementLinkOcc"===P.type&&e.is(P.from,"array")&&e.is(P.to,"array")&&e.is(V.instance.absPath))||l.isImplementLinkValidForOccPath(P.from,P.to,V.instance.absPath))if(A=e.is(P.to,"array")&&"ProcessImplementLink"===g?w===P.to[P.to.length-2]:!!e.is(P.to,"array")&&w===P.to[P.to.length-1],T===P.to||w===P.to||A?(R=P.from,g+="_inverse",y=o.getIconElem("LinkInverse")):y=o.getIconElem("Link"),C=r.getReference(R),e.is(C)||((v=e.is(R,"array")?"ProcessImplementLink"===g?r.getInstance(R[R.length-2]):r.getInstance(R[R.length-1]):r.getInstance(R))?C=r.getReference(v.get("isInstanceOf")||v.get("to")):t.debug("No linked instance !!!")),e.is(C)){if(I=C.get("type"),e.is(k[I])&&e.is(k[I].Attribute)){L=k[I].Attribute,L=e.is(L,"array")?L:[L];const t=k[I].separator||" ";e.is(v)&&"ProcessImplementLink"===g&&(e.is(P.to,"array")||v.id===P.to)?(p="("+v.get("PLM_ExternalID")+") ",p+=L.map((e=>C.get(e.name))).join(t)):p=L.map((e=>C.get(e.name))).join(t)}else p=C.get(d);if(e.is(k[g])&&e.is(k[g].Attribute)){L=k[g].Attribute,L=e.is(L,"array")?L:[L];const t=k[g].separator||" ";for(m="",S=0;S<L.length;S++)if(0!==S&&(m+=t),"ProcessImplementLinkOcc"!==g&&"ProcessImplementLinkOcc_inverse"!==g||"V_usage"!==L[S].name)m+=P[L[S].name];else{m+=l.getRoleFromModelOrComputed(P.PID).nlsText}p="("+m+")"+p}b=C.get("PPRTYPE"),e.is(b,"string")?("OPERATION"===b&&(b="SYSTEM"),h=o.getIconElem(g),u[b].push({label:p,icon:h,iconDirection:y,pid:P.PID,linkedReferencePID:C.get("PID"),type:g})):t.debug("PPRTYPE is not available for object type:"+I)}else t.debug("No linked reference !!!")}return u},k=function(n,i,s,r,a,l){var d,u,f,g,h,p,m,I,P,b,y=c;for(d=0;d<n.length;d++){if(p=(I=n[d]).get("type"),e.is(y[p])&&e.is(y[p].Attribute))for(b=y[p].Attribute,b=e.is(b,"array")?b:[b],m=y[p].separator||" ",g="",u=0;u<b.length;u++)0!==u&&(g+=m),g+=I.get(b[u].name);else g=I.get(a);for(f=o.getIconElem(p),h="Type."+p,u=0;u<i.length;u++)if(i[u].get("isAggregatedBy")===I.get("PID")){P=i[u];break}e.is(P)?l.PARENT.push({label:g,icon:f,pid:P.get("PID"),linkedReferencePID:I.get("PID"),type:h}):t.debug("Instance of reference id:"+I.get("PID")+" not found.")}return l},I=function(t){var n,i;n=s.getConnection(t),e.is(n)?s.deleteConnection(t):(i=r.getInstance(t),e.is(i)&&r.deleteInstance([i],{askDeleteConfirmation:!1}))},P=function(n){var i,a,l,c,d,u;i=s.getConnection(n),a=!(Array.isArray(i.get("to"))||!e.is(r.getInstance(i.get("to")))),e.is(i)&&(Array.isArray(i.get("to"))?(u=!0,l=i.get("to")[i.get("to").length-1],c=i.get("to")[i.get("to").length-2],l&&c&&C(i.get("from"),l,c,u,i)):a?(u=!0,l=r.getInstance(i.get("to")).get("isInstanceOf"),c=i.get("to"),l&&c&&C(i.get("from"),l,c,u,i)):(u=!1,l=i.get("to"),0!==(d=r.getParentInstancesFromCollection(l)).length?d.length>1?L(d,(function(e){e&&(c=e.get("PID"),l&&c&&s.switchScope(i.get("from"),l,c,u,i))})):d[0].get("isInstanceOf")===l&&(c=d[0].get("PID"),l&&c&&s.switchScope(i.get("from"),l,c,u,i)):t.warn(o.getNLSValue("LinksUI.SwitchScopeCallback.Warn"))))},T=function(i){var l,c,d,g,h,p,m,b=[],y=this.getData("pid"),v=this.getData("linkedReferencePID"),R=r.getReference(v),C=R.get("PPRTYPE"),L=i.currentTarget.getOffsets().x,S=i.currentTarget.getOffsets().y+25;c=e.is(s.getConnection(y)),d={icon:"url("+o.getIconURLFromKey("GeneralDelete")+")",label:o.getNLSValue("LinksUI.DeleteLink"),sensitivity:c?s.canDeleteRelation(y)?"enabled":"disabled":"enabled",callback:function(){I(y)}},g={icon:"url("+o.getIconURLFromKey("SwitchScope")+")",label:o.getNLSValue("LinksUI.SwitchScope"),sensitivity:"enabled",callback:function(){P(y)}},l={icon:"url("+o.getIconURLFromKey("EditAttribute")+")",label:o.getNLSValue("LinksUI.EditAttribute"),sensitivity:a.hasEditConfiguration(y)?"enabled":"disabled",callback:function(){a.editConfiguredAttributes(y)}},h={icon:"url("+o.getIconURLFromKey("showAuxiliaryView")+")",label:o.getNLSValue("LinksUI.ShowInAuxiliaryView"),sensitivity:"enabled",callback:function(){t.notify("addToAuxiliaryView",R)}},Object.keys(u).indexOf(C)>-1&&(p={icon:"url("+o.getIconURLFromKey(u[C].icon)+")",label:o.getNLSValue("LinksUI.ShowInNaturalView",{view:o.getNLSValue(u[C].view)}),sensitivity:"enabled",callback:function(){t.notify("addReference",[R,null,{withLinksResolved:!0}])}}),m={icon:"url("+o.getIconURLFromKey("ExploreInWebApp")+")",label:o.getNLSValue("ExploreInWebApp",null,"Cmd","Title"),sensitivity:"enabled",callback:function(){t.notify("ExploreInWebApp",[[{referencePID:v}]])}},e.is(s.getConnection(y))?(b.push(d),b.push(l)):e.is(V.reference.model)&&"PRODUCT"!==V.reference.model.get("PPRTYPE")&&b.push(d),"Installation"!==R.get("V_discipline")&&"Transform"!==R.get("V_discipline")||b.push(g),b.push(h),e.is(p,"object")&&b.push(p),s.isExploreWebAppEnabled()&&f&&b.push(m),n.getComponent("ContextualMenuManager").show({nodes:b},[L,S])},w=function(){var e;for(e in N)N.hasOwnProperty(e)&&("PARENT"===e?m.unselectItem(e,!0):m.selectItem(e,!0))},U=function(){Object.values(N).forEach((function(e){e.pprTypeDiv.empty()}))},{init:function(t){M=e.extend(M,t),c=t.relAttributeConfig,d=e.is(t.relatedCmdId)?t.relatedCmdId:null,u=e.is(t.acceptedTypes)?t.acceptedTypes:null,f=!e.is(t.exploreInWebApp)||t.exploreInWebApp,g=e.is(t.filterToolbarSections)?t.filterToolbarSections:null,Array.isArray(g)?g.forEach((function(e){N[e]={title:o.getNLSValue("PPRTYPE."+e)}})):N={PRODUCT:{title:o.getNLSValue("PPRTYPE.PRODUCT")},PROCESS:{title:o.getNLSValue("PPRTYPE.PROCESS")},SYSTEM:{title:o.getNLSValue("PPRTYPE.SYSTEM")},RESOURCE:{title:o.getNLSValue("PPRTYPE.RESOURCE")},PART:{title:o.getNLSValue("PPRTYPE.PART")},SERVICE:{title:o.getNLSValue("PPRTYPE.SERVICE")},PARENT:{title:o.getNLSValue("PPRTYPE.PARENT")}},y()},destroy:function(){this.isActive()&&S(),e.is(F)&&(F.destroy(),F=void 0)},showModal:function(t){V=e.extend(V,t),A(),F.show(),b(),F.content=p},isActive:function(){return!!e.is(F)&&F.visibleFlag},clear:function(){V={title:"",reference:{model:null},instance:{model:null,absPath:""},whereUsed:{isFetched:!1,references:[],instances:[]}},b(),U()},hideUI:function(){F.hide()},updateWhereUsed:function(t){var n,i,o=-1;if(e.is(t)&&(n=t.isInstance()?t.get("isAggregatedBy"):t.get("PID"),e.is(V.whereUsed.references,"array"))){for(i=0;i<V.whereUsed.references.length;++i)if(V.whereUsed.references[i].id===n){o=i;break}-1!==o?V.whereUsed.references.splice(o,1):t.isInstance()&&(V.whereUsed.instances.push(t),V.whereUsed.references.push(r.getReference(n))),A()}},getCurrentModel:function(){return V},updateTitle:function(e){V.title=e,b()},resetFilter:function(){w()}}}})),define("DS/DELPPWLinksModule_FD02/LinksModule",["UWA/Core","DS/DELPPWLinksModule_FD02/LinksUI"],(function(e,t){"use strict";return{behaviors:["UXFactoryBehavior","ResourceBehavior","SelectionBehavior","LinkBehavior","ModelBehavior","EditAttributeBehavior","ImplementBehavior","ProductFlowLinkBehavior"],creator:function(n,i,o,s,r,a,l,c){var d,u,f,g,h,p,m,I=null,P="V_Name";return g=function(t,n){r.getXMLValues(d.relationsDialogDisplayAttributeConfigXML,(function(n){var i=n.convert("DisplayAttributeDescriptionList.Type","name")||{},o=n.convert("DisplayAttributeDescriptionList.Relation","linkName")||{};u=e.merge(i,o),t()}),(function(e){n(e)}))},h=function(t){var n=!1,i=I.getCurrentModel(),o=e.is(i.reference.model)?i.reference.model.id:"",s=e.is(i.instance.model)?i.instance.model.id:"";return t!==o&&t!==s||(n=!0),n},p=function(t){var i={instModel:{},refModel:{},absPath:""},o=t.id?t.id:t.instancePID,s=t.id?t.id:t.referencePID;return i.instModel=a.getInstance(o),e.is(i.instModel)?(i.absPath=t.path?t.path:t.absPath,i.refModel=a.getReferenceModelFromInstance(i.instModel)):(i.refModel=a.getReference(s),e.is(i.refModel)||n.debug("Object with reference PID:"+o+" and instance PID:"+s+" not found.")),i},f=function(t){var n,i,o,r,a={title:"",reference:{model:null},instance:{model:null,absPath:""},whereUsed:{isFetched:!1,references:[],instances:[]}};return e.is(t)?(n=p(t),i=n.refModel,o=n.instModel,r=n.absPath):1===s.getSelectedNodesCount()&&s.getSelectionsWithPaths().forEach((function(t){e.is(t)&&1===t.length&&t.forEach((function(e){n=p(e),i=n.refModel,o=n.instModel,r=n.absPath}))})),a.title=e.is(i)?i.get(P):"",a.reference.model=i,a.instance.model=o,a.instance.absPath=r,a},m=function(){I.isActive()&&(I.resetFilter(),I.showModal(f()))},{name:"LinksModule",listenTo:function(){return{select:this.onSelect,Relations:this.onShowRelations,addInstance:this.onAddInstance,addConnection:this.onAddConnections,removeConnection:this.onRemoveConnections,removeReference:this.onRemoveRefOrInst,changeReference:this.onChangeRefOrInst,removeInstance:this.onRemoveRefOrInst,refreshImpacted:this.relaodUI,changeConnection:this.relaodUI}},onStart:function(s,h){if(d=s||{},!e.is(d.relationsDialogDisplayAttributeConfigXML))return n.debug("LinksModule loading failed : relationsDialogDisplayAttributeConfigXML options are undefined"),void h();Promise.all([new Promise(g.bind(this))]).then((function(){(I=new t(n,i,o,r,a,l,c)).init({relAttributeConfig:u,relatedCmdId:d.relatedCmdId,acceptedTypes:d.pprTypes,exploreInWebApp:d.exploreInWebApp,filterToolbarSections:d.filterToolbarSections}),I.showModal(f(d.node)),h()}),(function(e){n.debug("LinksModule loading failed :"+e),h()}))},onStop:function(){I.destroy(),I=void 0},onRemoveRefOrInst:function(t){(t=Array.isArray(t)?t:[t]).forEach((function(t){e.is(t)&&I.isActive()&&(h(t.id)?I.clear():I.updateWhereUsed(t))}))},onChangeRefOrInst:function(t){var n;(t=Array.isArray(t)?t:[t]).forEach((function(t){I.isActive()&&e.is(t)&&t.isReference()&&h(t.id)&&(n=t.changedAttributes(),e.is(n)&&n.hasOwnProperty(P)&&I.updateTitle(n[P]))}))},onShowRelations:function(t){var n;n=e.is(t)?e.is(t,"array")?t[0]:t:null,e.is(n)&&I.isActive()&&I.showModal(f(n))},onSelect:function(){m()},onAddConnections:function(t){var n,i,o;I.isActive()&&(o=function(t){return!!(e.is(t)&&(n=t.getAttribute("from"),i=t.getAttribute("to"),h(n)&&h(i)))},(e.is(t,"array")?t.some(o):o(t))&&I.showModal(I.getCurrentModel()))},onRemoveConnections:function(t){var n,i,o;I.isActive()&&(o=function(t){var o,s,a,l;if(e.is(t))if(n=t.getAttribute("from"),i=t.getAttribute("to"),"SecondaryCandidateResourceLink"===t.get("type")){if(o=r.getConnection(n),!e.is(o))return!1;if(s=o.getAttribute("from"),a=o.getAttribute("to"),l=i,h(s)||h(a)||h(l))return!0}else if(h(n)||h(i))return!0;return!1},(e.is(t,"array")?t.some(o):o(t))&&I.showModal(I.getCurrentModel()))},onAddInstance:function(t){e.is(t)&&I.isActive()&&h(t.get("isInstanceOf"))&&I.updateWhereUsed(t)},relaodUI:function(){m()}}}}}));