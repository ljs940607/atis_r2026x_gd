define("DS/ReviseFromWidget/ReviseFromPrefsDlg",["UWA/Class","UWA/Core","DS/UIKIT/SuperModal","DS/Controls/Toggle","DS/Controls/ButtonGroup","i18n!DS/ReviseFromWidget/assets/nls/ReviseFromPrefsDlg","i18n!DS/Windows/assets/nls/translation","css!DS/LifecycleControls/assets/styles/LifecycleModals"],(function(e,t,i,n,s,r,o,a){"use strict";return e.singleton({init:function(){this._parent({})},showDialog:function(e){var t=this,n=e.onOk,s=e.onShow,r=new i({closable:!0,className:"Lifecycle_Modals",events:{onShow:function(){null!=s&&s(this)}},renderTo:e.parent}),a=this.buildDialogBody(e);r.dialog({body:a,title:e.title,buttons:[{className:"primary",value:o.save,action:function(e){var i={};t.titleFromSourceToggle&&(i.titleFromSource=t.titleFromSourceToggle.checkFlag),t.warningNoReviseToggle&&(i.warningNoRevise=t.warningNoReviseToggle.checkFlag),e.hide(),n(i)}},{value:o.cancel,action:function(e){e.hide()}}]})},buildDialogBody:function(e){var i=t.createElement("div",{styles:{position:"relative",height:"100%",overflow:"auto"}}),o=new s({type:"checkbox"});return this.titleFromSourceToggle=new n({type:"checkbox",label:r.CopyTitleFromSource,value:0,checkFlag:e.titleFromSource}),o.addChild(this.titleFromSourceToggle),this.warningNoReviseToggle=new n({type:"checkbox",label:r.WarningNoRevise,value:1,checkFlag:e.warningNoRevise}),o.addChild(this.warningNoReviseToggle),o.inject(i),i}})})),define("DS/ReviseFromWidget/util/TreeSyncMgr",["UWA/Controls/Abstract","DS/LifecycleServices/Utils"],(function(e,t){"use strict";return e.extend({nextId:1,syncing:!1,add:function(e,i){var n=this,s=i||!1;this.trees=this.trees||[],this.debouncedSyncScroll=this.debouncedSyncScroll||t.debounce(this.syncScrollTo.bind(this),25);var r=n.nextId++;return e.getManager().onReady((function(){var t=0;s&&n.trees.length>0&&(t=n.trees[0].id),n.trees.push({id:r,tree:e}),e.getManager().getScroller().onScroll((function(){n.debouncedSyncScroll(r)})),0!==t&&n.syncScrollTo(t),e.onExpand((function(e){n.syncNodes(r,e.data.nodeModel._rowID,(function(e){e.expand()}))})),e.onCollapse((function(e){n.syncNodes(r,e.data.nodeModel._rowID,(function(e){e.collapse()}))}))})),r},remove:function(e){},syncScrollTo:function(e){var t=this.trees.find((function(t){return t.id===e}));if(t){var i=t.tree.getManager().getScrollerPosition(),n=this;this.trees.forEach((function(t){t.id!==e&&(n.syncing=!0,t.tree.getManager().setScrollerPosition(i),n.syncing=!1)}))}},syncNodes:function(e,t,i){var n=this;n.syncing||(n.syncing=!0,this.trees.forEach((function(n){if(n.id!==e){var s=n.tree.getManager().getTreeNodeModelFromRowID(t);s&&i(s)}})),n.syncing=!1)}})})),define("DS/ReviseFromWidget/controls/TreesContainer",["UWA/Controls/Abstract"],(function(e){"use strict";return e.extend({name:"treesContainer",init:function(e){this._panels=[],this._parent(e),this._buildLayout()},addPanel:function(e){e.inject(this.getContent()),this._panels.push(e),e.addEvent("collapseChange",this._updateLayout.bind(this))},_updateLayout:function(){var e=this._panels.reduce((function(e,t){return e+(t.isCollapsed()?0:1)}),0);2!==e&&3!==e||this._panels.forEach((function(t){t.isCollapseable()&&(2===e?t.setSize50pct():t.setSize33pct())}))},_buildLayout:function(){var e={class:this.getClassNames("-root")};this.elements.container=new UWA.Element("div",UWA.merge(this.options,e)),this._render()},_render:function(){}})})),define("DS/ReviseFromWidget/ReviseFromConstants",[],(function(){"use strict";return{ActionOption:{Revise:"revise",ReviseTree:"revisetree",Reuse:"reuse",Exclude:"exclude",InsertNew:"insertnew",ReuseReference:"reuse_reference"}}})),define("DS/ReviseFromWidget/controls/TreePanel",["UWA/Controls/Abstract"],(function(e){"use strict";return e.extend({name:"treePanel",defaultOptions:{caption:"-",addClass:"",collapseable:!1,UIcollapseable:!0},init:function(e){this._parent(e),this._isCollapsed=!1,this._isMaximized=!1,this.setSize33pct(),this._buildLayout()},_buildLayout:function(){var e=this,t=" ";this.options.collapseable&&(t+=this.expandClass);var i={class:this.getClassNames("-root")+t+" "+this.options.addClass};this.elements.container=new UWA.Element("div",i);var n=new UWA.Element("div",{class:this.getClassNames("-panelHeader")});n.inject(this.elements.container),this.elements.headerText=new UWA.Element("span",{class:this.getClassNames("-headerText"),html:this.options.caption}),this.elements.headerText.inject(n),this.elements.contentContainer=new UWA.Element("div",{class:this.getClassNames("-contentContainer")}),this.elements.contentContainer.inject(this.elements.container);var s="";this.options.collapseable&&(s="treePanel-content-hide-expander"),this.elements.contentHide=new UWA.Element("div",{class:this.getClassNames("-content-hide")+" "+s,events:{click:function(){e.options.UIcollapseable&&e.options.collapseable&&e.toggleCollapsed()}}}),this.elements.contentHide.inject(this.elements.contentContainer),this.elements.captionCollapsed=new UWA.Element("span",{class:this.getClassNames("-caption-collapsed"),html:this.options.caption}),this.elements.captionCollapsed.inject(this.elements.contentHide),this.elements.content=new UWA.Element("div",{class:this.getClassNames("-content")}),this.elements.content.inject(this.elements.contentContainer),this.options.collapseable&&(this.elements.headerBtn=new UWA.Element("div",{class:this.getClassNames("-headerButton"),events:{click:function(){e.toggleCollapsed()}}}),this.elements.headerBtnIcon=new UWA.Element("div",{class:"fonticon fonticon-double-chevron-left treePanel-headerButtonIcon"}),this.elements.headerBtnIcon.inject(this.elements.headerBtn),this.elements.headerBtn.inject(n)),this._render()},_render:function(){},isCollapsed:function(){return this._isCollapsed},isCollapseable:function(){return this.options.collapseable},setUICollapseable:function(e){this.options.UIcollapseable!==e&&((this.options.UIcollapseable=e)?(this.elements.headerBtn.removeClassName("treePanel-hidden"),this.elements.contentHide.addClassName("treePanel-content-hide-expander")):(this.elements.headerBtn.addClassName("treePanel-hidden"),this.elements.contentHide.removeClassName("treePanel-content-hide-expander")))},hide:function(){this.elements.container.addClassName("treePanel-hidden")},show:function(){this.elements.container.removeClassName("treePanel-hidden")},_setCollapsed:function(e){this._isCollapsed=e,this.dispatchEvent("collapseChange",{isCollapsed:e})},setSize33pct:function(){this._setSizepct("treePanel-expandedPanel33")},setSize50pct:function(){this._setSizepct("treePanel-expandedPanel50")},_setSizepct:function(e){this.expandClass!==e&&(!this.isCollapsed()&&this.elements.container&&this.elements.container.removeClassName(this.expandClass),this.expandClass=e,!this.isCollapsed()&&this.elements.container&&this.elements.container.addClassName(this.expandClass))},collapse:function(){this.isCollapseable()&&(this.isCollapsed()||(this.elements.container.removeClassName(this.expandClass),this.elements.container.addClassName("treePanel-collapsedPanel"),this.elements.contentHide.style.display="block",this.elements.headerText.style.display="none",this.elements.headerBtnIcon.removeClassName("fonticon-double-chevron-left"),this.elements.headerBtnIcon.addClassName("fonticon-double-chevron-right"),this._setCollapsed(!0)))},expand:function(){this.isCollapseable()&&this.isCollapsed()&&(this.elements.container.addClassName(this.expandClass),this.elements.container.removeClassName("treePanel-collapsedPanel"),this.elements.contentHide.style.display="none",this.elements.headerText.style.display="block",this.elements.headerBtnIcon.addClassName("fonticon-double-chevron-left"),this.elements.headerBtnIcon.removeClassName("fonticon-double-chevron-right"),this._setCollapsed(!1))},toggleCollapsed:function(){this.isCollapsed()?this.expand():this.collapse()},maximize:function(){this._isMaximized||(this._isMaximized=!0,this.elements.container.addClassName("treePanel-maximized"))},restore:function(){this._isMaximized&&(this._isMaximized=!1,this.elements.container.removeClassName("treePanel-maximized"))}})})),define("DS/ReviseFromWidget/ReviseFromModel",["UWA/Controls/Abstract"],(function(e){"use strict";return e.extend({init:function(){this.histLinksNodes={},this.histLinksConnections={},this.graphs=[]},setHistLinksData:function(e){var t=e;t.hasOwnProperty("nodes")&&(this.histLinksNodes=t.nodes),t.hasOwnProperty("connections")&&(this.histLinksConnections=t.connections)},getVersionGraphData:function(){return this.graphs},setVersionGraphData:function(e){var t=e;t.hasOwnProperty("graphs")&&(this.graphs=t.graphs)},getHistLinksNodes:function(){return this.histLinksNodes},getHistLinksConnections:function(){return this.histLinksConnections},getSources:function(e,t){var i=[],n=null;return t&&this.graphs.some((function(t){return t.versions.some((function(t){return t.id===e&&(n=t.copyFrom,!0)}))})),this.graphs.forEach((function(s){s.versions.forEach((function(s){if(s.id!==e){if(t&&(s.copyFrom!==e&&s.id!==n||s.logicalid===e))return;i.push(s)}}))})),i},getDuplicates:function(e,t){for(var i,n=[],s=[],r=0;r<this.histLinksNodes.length;++r)if(this.histLinksNodes[r].id===e){i=this.histLinksNodes[r].nId;break}for(var o=0;o<this.histLinksConnections.length;++o){var a=(d=this.histLinksConnections[o]).typ;d.src===i?("duplicate"===a||t&&("evolution"===a||"revision"===a||"revisionFrom"===a))&&s.push(d.trg):t&&d.trg===i&&("duplicate"!==a&&"evolution"!==a&&"revision"!==a&&"revisionFrom"!==a||s.push(d.src))}for(var c=0;c<s.length;++c)for(var l=0;l<this.histLinksConnections.length;++l){var d;a=(d=this.histLinksConnections[l]).typ;d.src===s[c]?("revision"===a||"revisionFrom"===a||t&&("duplicate"===a||"evolution"===a))&&d.trg!=i&&s.indexOf(d.trg)<0&&s.push(d.trg):t&&d.trg===s[c]&&("duplicate"!==a&&"evolution"!==a&&"revision"!==a&&"revisionFrom"!==a||d.src!=i&&s.indexOf(d.src)<0&&s.push(d.src))}return s.length>0&&(n=this.histLinksNodes.filter((function(e){for(var t=0;t<s.length;++t)if(s[t]===e.nId)return!0;return!1}))),n}})})),define("DS/ReviseFromWidget/PickDialog/PickDialogView",["UWA/Core","UWA/Class/View","UWA/Class/Model","UWA/Class/Collection","UWA/Drivers/Alone","DS/UIKIT/Input/Button","DS/WAFData/WAFData","DS/W3DXComponents/Skeleton","DS/LifecycleServices/CompareImgSrc","DS/ENOXVersionExplorerController/VersionExplorerController","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/LifecycleServices/LifecycleServices","i18n!DS/ReviseFromWidget/assets/nls/PickDialog"],(function(e,t,i,n,s,r,o,a,c,l,d,u,h,p){"use strict";var v=null,f=c.defaultThumbnailPath,m=c.getObjTypeIconPath("Default"),g=c.thumbnailUrlPath,y=c.iconUrlPath,R="revisionsFacet",I="alternateDesignsFacet",b="historyGraphFacet",T="filtersFacet",S="",C="",F=-1,O="",N="",E="",D="",A=null,w=null;function x(e,t,i,n,s,r){if("3DSpace"===i.serviceId){var a=i.physicalid,l="undefined"!=typeof widget&&widget?widget.getValue("x3dPlatformId"):null;null!=l&&""!=l||(l="OnPremise");var d=e+g+a+"/?tenant="+l+"&root3DSpaceUrl="+e,u=e+f;o.authenticatedRequest(d,{ndx:0,proxy:t,onComplete:function(t){if(t.endsWith("iconLargeDefault.png")){var i=c.getObjTypeLargeIconPath(r);null!=i&&(t=e+"/"+i)}jQuery(s).find(n).attr("src",t)},onFailure:function(){jQuery(s).find(n).attr("src",u)}})}else jQuery(s).find(n).attr("src",i.preview_url)}function P(e,t,i,n,s,r){if("3DSpace"===i.serviceId){var a=i.physicalid,l="undefined"!=typeof widget&&widget?widget.getValue("x3dPlatformId"):null;null!=l&&""!=l||(l="OnPremise");var d=e+y+a+"/?tenant="+l+"&root3DSpaceUrl="+e,u=e+m;o.authenticatedRequest(d,{ndx:0,proxy:t,onComplete:function(t){if(t.endsWith("iconLargeDefault.png")){var i=c.getObjTypeIconPath(r);null!=i&&(t=e+"/"+i)}jQuery(s).find(n).attr("src",t)},onFailure:function(){jQuery(s).find(n).attr("src",u)}})}else jQuery(s).find(n).attr("src",i.type_icon_url)}function _(e,t,i,n){if(t.physicalid!=O||null===e.getElement(".picked-tile-sub-container")){var s=i+f,r=i+m,o="#"+e.id,a=t["PLMEntity.V_Name"];null!=a&&""!=a||(a=t.Title),null!=a&&""!=a||(a=t.name),e.setContent(jQuery('<div class="picked-tile-sub-container" id="'+t.physicalid+'"><div class = "picked-tile-header"><img class = "picked-tile-image"  alt="[img missing]" id="picked-thumb" src="'+s+'" draggable="false"></div><div class = "picked-tile-body"><img class = "picked-tile-icon" id="picked-icon"  src="'+r+'" draggable="false" onError="this.onerror=null;this.src=\''+r+'\';"><div class = "picked-tile-title">'+a+'</div><div class = "picked-tile-subtitle">'+t.type+'</div><div class = "picked-tile-content">'+t.revision+"</div></div></div>")),x(i,n,t,"#picked-thumb",o,t.internalType),P(i,n,t,"#picked-icon",o,t.internalType),O=t.physicalid,N=t.isFilter?t.revision:t.name+" "+t.revision,E=t.type,D=t.internalType}}var k=i.extend({idAttribute:"physicalid",sync:function(t,i,n){return this._parent(t,i,e.merge({ajax:o.authenticatedRequest,headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:encodeURIComponent(this.securityContext)},onFailure:n.onComplete,type:"json",proxy:i.proxyType,timeout:12e4},n))}}),L=i.extend({sync:function(t,i,n){return this._parent(t,i,e.merge({ajax:o.authenticatedRequest,headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:encodeURIComponent(this.securityContext)},onFailure:n.onComplete,type:"json",proxy:i.proxyType,timeout:12e4},n))}}),j=i.extend({sync:function(t,i,n){return this._parent(t,i,e.merge({ajax:o.authenticatedRequest,headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:encodeURIComponent(this.securityContext)},onFailure:n.onComplete,type:"json",proxy:i.proxyType,timeout:12e4},n))}}),U=i.extend({sync:function(t,i,n){return this._parent(t,i,e.merge({ajax:o.authenticatedRequest,headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:encodeURIComponent(this.securityContext)},method:"POST",onFailure:n.onComplete,type:"json",data:JSON.stringify([i.droppedId]),proxy:i.proxyType,timeout:12e4},n))}});function M(e,t,i){for(var n=!1,s=0;s<i.length&&!n;s++){var r=i[s];r.trg===e&&(n=t.indexOf(r.src)>=0||M(r.src,t,i))}return n}function W(e,t,i,n){for(var s=0;s<t.length;s++){var r=t[s];r.typ.contains("revision")&&("earlier"!==i&&r.src===e&&(n.push(r.trg),W(r.trg,t,"later",n)),"later"!==i&&r.trg===e&&(n.push(r.src),W(r.src,t,"earlier",n)))}}function H(t){var i=n.extend({nameSelFacet:t,setup:function(e,i){this.url=i.baseURL,this.tenant="undefined"!=typeof widget&&widget?widget.getValue("x3dPlatformId"):null,null!=this.tenant&&""!=this.tenant||(this.tenant="OnPremise"),this.errorMngt=i.errorMngt,this.oId=i.rootObj.physicalid,this.objType=i.rootObj.internalType,this.droppedId=i.droppedObj.physicalid,this.isFilter=i.droppedObj.isFilter,this.securityContext=i.securityContext,this.proxyType=i.proxyType,this.container=i.container,this.baseContainer=i.baseContainer,this.callbackFn=i.callbackFn,this.dataSetRev=i.dataSetRev,this.dataSetAlt=i.dataSetAlt,this.isOdt=i.isOdt,this.isHistoryEmbedded=i.isHistoryEmbedded,this.isCompare=i.isCompare;var n=this.container.getElements(".facetviews > .set-container");n.length;t===R?this.model=k:t===I?(this.model=L,void 0===i.dupFiltering||null===i.dupFiltering?this.dupFiltering="all":this.dupFiltering=i.dupFiltering,void 0===i.dupRevsFiltering||null===i.dupRevsFiltering?this.dupRevsFiltering="all":this.dupRevsFiltering=i.dupRevsFiltering,F=n.length):this.model=t===b?j:U},parse:function(e){var i,n=this,s=[];if(!0===this.isOdt()&&(e=t===R?this.dataSetRev:this.dataSetAlt),t===R)if("SoftwareLogicalItem"===D){var o=0;if(e.graphs.length>0){o=e.graphs[0].versions.length;var a="";for(J=0;J<o;++J){e.graphs[0].versions[J].codeForThisBranch="";var c=e.graphs[0].versions[J].code.lastIndexOf("_");c>-1&&(e.graphs[0].versions[J].id===this.oId?a=e.graphs[0].versions[J].code.slice(0,c):e.graphs[0].versions[J].codeForThisBranch=e.graphs[0].versions[J].code.slice(0,c))}for(J=0;J<o;++J)e.graphs[0].versions[J].id!=this.oId&&e.graphs[0].versions[J].codeForThisBranch===a&&(e.graphs[0].versions[J].physicalid=e.graphs[0].versions[J].id,e.graphs[0].versions[J].internalType=e.graphs[0].versions[J].type,e.graphs[0].versions[J].name=e.graphs[0].versions[J].label,e.graphs[0].versions[J].revision=e.graphs[0].versions[J].code,""!==E&&(e.graphs[0].versions[J].type=E),s.push(e.graphs[0].versions[J]))}}else{for(var l=e.results,d=(o=l?l.length:0,0);d<o;d++){var u=(P=l[d])["PLMEntity.V_Name"];u||(u=P.Title)||(u=P.name),P.name=u}if(e.results)for(i=0;i<e.results.length;i++)(e.results[i].physicalid!=this.oId||this.isFilter)&&s.push(e.results[i])}else if(t===I){var h=this.container.getElements(".facetviews > .set-container"),v=h.length;if(F>=0&&F<v){var f=h[F];if(""==f.style.display){var m=f.getElement(".set-header");m.style.display="flex",f.getElement(".set-contents").style.height="calc(100% - 52px)",m.getElement(".set-switcher").hide();var g=m.getElement(".set-actions");if(null===g.getElement("#selDuplicate")){S=n.dupFiltering;var y="";y="direct"===n.dupFiltering?p.get("displayAlternateDepthDirect"):"origin"===n.dupFiltering?p.get("displayAlternateDepthOrigin"):p.get("displayAlternateDepthAll");var T=new r({value:y,id:"selDuplicate",icon:"fonticon-doc-text",attributes:{title:y},dropdown:{items:[{text:p.get("displayAlternateDepthDirect"),value:"DUP_IMM"},{text:p.get("displayAlternateDepthOrigin"),value:"DUP_DESC"},{text:p.get("displayAlternateDepthAll"),value:"DUP_ALL"}]}}).inject(g);T.elements.container.style.marginRight="4px",T.elements.container.style.maxWidth="48%",T.addEvent("onDropdownClick",(function(e,t){var i=t.value;if(""!==i&&i!==n.dupFiltering){var s="";"DUP_IMM"===i?(n.dupFiltering="direct",s=p.get("displayAlternateDepthDirect")):"DUP_DESC"===i?(n.dupFiltering="origin",s=p.get("displayAlternateDepthOrigin")):"DUP_ALL"===i&&(n.dupFiltering="all",s=p.get("displayAlternateDepthAll")),this.setValue(s),this.elements.container.title=s,S=n.dupFiltering,require(["DS/UIKIT/Mask"],(function(e){var t=n.container.getElement(".facetviews");e.mask(t)})),n.fetch()}}))}if(null===g.getElement("#selRevOfDuplicate")){C=n.dupRevsFiltering;var O="";O="top"===n.dupRevsFiltering?p.get("displayAlternateRevisionTop"):"latest"===n.dupRevsFiltering?p.get("displayAlternateRevisionLatest"):"latestPublished"===n.dupRevsFiltering?p.get("displayAlternateRevisionLatestPublished"):p.get("displayAlternateRevisionAll");var A=new r({value:O,id:"selRevOfDuplicate",icon:"fonticon-picture",attributes:{title:O},dropdown:{items:[{text:p.get("displayAlternateRevisionTop"),value:"REV_FIRST"},{text:p.get("displayAlternateRevisionLatest"),value:"REV_LAST"},{text:p.get("displayAlternateRevisionLatestPublished"),value:"REV_LAST_PUB"},{text:p.get("displayAlternateRevisionAll"),value:"REV_ALL"}]}}).inject(g);A.elements.container.style.marginLeft="4px",A.elements.container.style.maxWidth="48%",A.addEvent("onDropdownClick",(function(e,t){var i=t.value;if(""!==i&&i!==n.dupRevsFiltering){var s="";"REV_FIRST"===i?(n.dupRevsFiltering="top",s=p.get("displayAlternateRevisionTop")):"REV_LAST"===i?(n.dupRevsFiltering="latest",s=p.get("displayAlternateRevisionLatest")):"REV_LAST_PUB"===i?(n.dupRevsFiltering="latestPublished",s=p.get("displayAlternateRevisionLatestPublished")):"REV_ALL"===i&&(n.dupRevsFiltering="all",s=p.get("displayAlternateRevisionAll")),this.setValue(s),this.elements.container.title=s,C=n.dupRevsFiltering,require(["DS/UIKIT/Mask"],(function(e){var t=n.container.getElement(".facetviews");e.mask(t)})),n.fetch()}}))}}}if(e.nodes){var w=-1;for(i=0;i<e.nodes.length;i++)if(e.nodes[i].id===this.oId){w=e.nodes[i].nId;break}var x=new Array;for(x.push(w),W(w,e.connections,"both",x),i=0;i<e.nodes.length;i++){var P;if((P=e.nodes[i]).physicalid=P.id,P.name=P.displayName,P.physicalid===this.oId);else if(x.indexOf(P.nId)>=0);else{var _=!1;if("top"===n.dupRevsFiltering){for(var k=!1,L=0;L<e.connections.length;L++){if((V=e.connections[L]).typ.contains("revision")&&V.trg===P.nId){k=!0;break}}0==k&&(_=!0)}else if("latest"===n.dupRevsFiltering||"latestPublished"===n.dupRevsFiltering&&!0===e.nodes[i].ispublished){var j=!1;for(L=0;L<e.connections.length;L++){if((V=e.connections[L]).typ.contains("revision")&&V.src===P.nId){if("latest"===n.dupRevsFiltering){j=!0;break}for(var U=0;U<e.nodes.length;U++)if(e.nodes[U].nId===V.trg&&!0===e.nodes[U].ispublished){j=!0;break}if(1==j)break}}0==j&&(_=!0)}else _=!0;if(_){var H=!1;if("direct"===n.dupFiltering){var B=new Array;B.push(P.nId),W(P.nId,e.connections,"both",B);for(L=0;L<e.connections.length;L++){var V;"duplicate"===(V=e.connections[L]).typ&&V.src===w&&B.indexOf(V.trg)>=0&&(H=!0)}}else if("origin"===n.dupFiltering){var G=new Array;G.push(w),H=M(P.nId,G,e.connections)}else H=!0;H&&s.push(P)}}}}}else if(t===b)this.isHistoryEmbedded&&n.container.getElement(".versionexplorer-toolbar")&&null!=n.container.getElements(".root-skeleton-container")&&(null!=n.container.getElements(".root-skeleton-container")[0]&&n.container.getElements(".root-skeleton-container")[0].setStyle("display","none"),null!=n.container.getElements(".root-skeleton-container")[1]&&n.container.getElements(".root-skeleton-container")[1].setStyle("display","none"));else{var q=[],z=e.success;if(z)for(var K=z.length,J=0;J<K;J++){z[J][this.oId].forEach((function(e){q.push(e)}))}for(J=0;J<q.length;J++){var X=q[J],Q=X.filterId,Y={physicalid:Q,id:Q,name:X.filterTitle,internalType:"ENOStrRefinementSpecification",type:p.get("filterType"),revision:N,isFilter:!0,filter:X};Y.physicalid!=this.droppedId&&s.push(Y)}}require(["DS/UIKIT/Mask"],(function(e){var t=n.container.getElement(".facetviews");e.unmask(t)})),jQuery('*[data-name="Refresh"]').removeClass("wux-ui-state-disabled"),jQuery('*[data-name="RemoveAll"]').removeClass("wux-ui-state-disabled");var Z=this.container.getElement(".facets-list > .facet.interactive.tab-behavior.selected");if(this.nameSelFacet===Z.dataset.name&&(se(),0===s.length)){var $="";if($=this.nameSelFacet===R?p.get("noRevision"):this.nameSelFacet===I?p.get("noAlternateDesign"):p.get("noFilters"),!this.isHistoryEmbedded){var ee=this.container.getElement(".facetviews"),te=UWA.createElement("div",{id:"empty-msg",html:$});ee.appendChild(te)}var ie=n.container.getElements(".facets-list > .facet.interactive.tab-behavior");for(J=0;J<ie.length;++J){var ne=ie[J];ne.hasClassName("selected")||ne.addEventListener("click",se)}}function se(){for(var e=n.container.getElements(".facets-list > .facet.interactive.tab-behavior"),t=0;t<e.length;++t){var i=e[t];i.hasClassName("selected")||i.removeEventListener("click",se)}n.container.getElement("#empty-msg")&&n.container.getElement("#empty-msg").remove()}return s.sort((function(e,t){return e.nId-t.nId})),require(["DS/UIKIT/Mask"],(function(e){e.unmask(n.container)})),s},sync:function(){return this.model.prototype.sync.apply(this,arguments)},fetch:function(){var t;this.isHistoryEmbedded?null!=(t=this.container.getElement(".version-global-div"))&&t.setStyle("display","none"):(t=jQuery('*[data-name="'+this.nameSelFacet+'"]'))[0].hasClassName("selected")&&this.closeHistoryGraphDialog();var i="";if(this.nameSelFacet===R)n="SoftwareLogicalItem"===D?"/resources/v1/dslc/versiongraph/"+this.oId+"?withAttributes=1":"/resources/compare/revisions2?tenant="+this.tenant+"&objectId="+this.oId,i=this.url+n;else if(this.nameSelFacet===I){n="/resources/lifecycle/history/links?tenant="+this.tenant+"&physicalid="+this.oId+"&depth=100&type=all",i=this.url+n}else if(this.nameSelFacet===b)A=this,this.displayHistoryGraph(),A.isHistoryEmbedded&&(i=this.url);else{var n="/resources/FilterBIAPI/Filter/retrieveFiltersForRoots?tenant="+this.tenant;i=this.url+n}return""!=i?this._parent(e.merge({url:i})):i},displayHistoryGraph:function(){var e=this,t=null;e.isHistoryEmbedded&&(t=e.container.getChildren()[0].getChildren()[0].getChildren()[1].getChildren()[1]),e.versionExplorer=new l({versionGraphContainer:t,widget:widget,autoUpdate:!1,useGlobalStorage:e.isCompare,globalStorageName:"historyUserSettings"}),e.versionExplorer.setSingleSelectionMode(),e.versionExplorer.disableCommands(),e.isHistoryEmbedded||e.versionExplorer.showDialog({className:"VEPickDialogModal"},void 0,!0),w=e.versionExplorer;var i={displayLegend:!1};if(h.getHistoryConfigPromise().then((function(e){u.historyConfig=e,u.historyConfig&&u.historyConfig.settings&&(u.historyConfig.settings.defaultView&&(i.displayMode=d.DISPLAY_MODES[u.historyConfig.settings.defaultView]),u.historyConfig.settings.thumbnailGraph&&(u.historyConfig.settings.thumbnailGraph.thumbnailGraphLayout&&(i.thumbnailGraphLayout=u.historyConfig.settings.thumbnailGraph.thumbnailGraphLayout),u.historyConfig.settings.thumbnailGraph.displayThumbnailOverview&&(i.displayThumbnailOverview="true"===u.historyConfig.settings.thumbnailGraph.displayThumbnailOverview)),u.historyConfig.settings.subwayGraph&&(u.historyConfig.settings.subwayGraph.subwaySort&&(i.subwaySortAscending="asc"===u.historyConfig.settings.subwayGraph.subwaySort),"SUBWAY_COMPACT_VIEW"!==u.historyConfig.settings.subwayGraph.viewMode&&"SUBWAY_COMFORTABLE_VIEW"!==u.historyConfig.settings.subwayGraph.viewMode||(i.subwayViewMode=u.historyConfig.settings.subwayGraph.viewMode)))}),(function(){})).finally((function(){u.loadUserSettingsPromise(i,!1,e.isCompare,"historyUserSettings").then((function(){e.versionExplorer.publishEvent("ENOXVersionExplorerLoadVersionModel",{id:A.oId,type:A.objType,tenantId:A.tenant,securityContext:A.securityContext,onComplete:function(){e.versionExplorer.applyFilter((function(e){return A.oId!==e._options.id}))},dataModelType:d.DATA_MODEL_TYPES.MODEL_HISTORY})}))})),A.container.getElement("#empty-msg")&&A.container.getElement("#empty-msg").remove(),!e.isHistoryEmbedded){var n=jQuery('*[data-name="historyGraphFacet"]');null!=n&&n.length>0&&n[0].removeEventListener("click",A.displayHistoryGraph)}e.versionExplorer.subscribeEvent("ENOXVersionExplorerModalCancel",(function(t){w=null,A.processEmptyHistoryGraphResults(p.get("noHistoryGraphSelection")),e.versionExplorer.cleanup()}),!1),e.versionExplorer.subscribeEvent("ENOXVersionExplorerModalOK",(function(t){w=null;var i=e.versionExplorer.getSelectedNodes(),n=i.length;if(n>0){for(var s,r=0;r<n;++r)i[r].options.data.physicalid!==A.oId&&void 0===s&&(s=i[r].options.data);void 0!==s?A.callbackFn(s):A.processEmptyHistoryGraphResults(p.get("rootHistoryGraphSelection"))}else A.processEmptyHistoryGraphResults(p.get("noHistoryGraphSelection"));e.versionExplorer.cleanup()}),!1),e.versionExplorer.subscribeEvent("select",(function(t){if(e.isHistoryEmbedded){w=null;var i=e.versionExplorer.getSelectedNodes(),n=i.length;if(n>0){for(var s,r=0;r<n;++r)i[r].options.data.physicalid!==A.oId&&void 0===s&&(s=i[r].options.data);void 0!==s?A.callbackFn(s):A.processEmptyHistoryGraphResults(p.get("rootHistoryGraphSelection"))}else A.processEmptyHistoryGraphResults(p.get("noHistoryGraphSelection"))}}),!1)},processEmptyHistoryGraphResults:function(e){var t=A.container.getElement(".facetviews"),i=UWA.createElement("div",{id:"empty-msg",html:e});t.appendChild(i);var n=jQuery('*[data-name="historyGraphFacet"]');null!=n&&n.length>0&&n[0].addEventListener("click",A.displayHistoryGraph)},closeHistoryGraphDialog:function(){null!==w&&w.hideDialog(),w=null},refreshOptions:function(e,t){this.oId=e.physicalid,this.droppedId=t.physicalid,this.isFilter=t.isFilter}});return i}function B(e){return{baseURL:e.revServiceURL,droppedObj:e.droppedObj,rootObj:e.rootObj,securityContext:e.securityContext,container:e.listContainer,baseContainer:e.baseContainer,proxyType:e.proxyType,callbackFn:e.callbackFn,dataSetRev:e.dataSetRev,dataSetAlt:e.dataSetAlt,isOdt:function(){return"object"==typeof e.dataSetRev},duplicateOnly:e.duplicateOnly,dupFiltering:e.dupFiltering,dupRevsFiltering:e.dupRevsFiltering,bHistoryGraphSelector:e.bHistoryGraphSelector,isHistoryEmbedded:e.isHistoryEmbedded,isCompare:e.isCompare}}function V(e,t,n,s){var r=1==s?{selectedFacet:t,facets:[{name:b,text:p.get("revisions"),icon:"flow-branch-list",handler:a.getRendererHandler("historyGraph")}]}:{selectedFacet:t,facets:[{name:R,text:p.get("revisions"),icon:"picture",handler:a.getRendererHandler("revisions")},{name:I,text:p.get("alternateDesigns"),icon:"doc-text",handler:a.getRendererHandler("alternateDesigns")}]};return widget.getBool("useIndex")&&r.facets.push({name:T,text:p.get("filters"),icon:"filter",handler:a.getRendererHandler("filters")}),null!=n&&1==n&&r.facets.splice(0,1),r.model=new i,r}var G=t.extend({setup:function(t){var i={useInfiniteScroll:!1,usePullToRefresh:!1},n={useInfiniteScroll:!1,usePullToRefresh:!1,itemViewOptions:{mapping:{subtitle:"type",image:function(){x(this.model.collection.url,this.model.collection.proxyType,this.model._attributes.physicalid,".tile-image",this.container,this.model._attributes.internalType);return this.model.collection.url+f},content:"revision",title:"name",icon:function(){var e;P(this.model.collection.url,this.model.collection.proxyType,this.model._attributes.physicalid,".tile-icon",this.container,this.model._attributes.internalType);return e=this.model._attributes.internalType,this.model.collection.url+"/"+c.getObjTypeIconPath(e)},Nodeid:"physicalid"}},events:{onItemViewSelect:function(e){var t=arguments[arguments.length-1],i=t.model||t;e.collection.callbackFn(i._attributes)},onItemViewDrag:function(e,t,i){var n="undefined"!=typeof widget&&widget?widget.getValue("x3dPlatformId"):null;null!=n&&""!=n||(n="OnPremise");var s=t.model._attributes.internalType;null!=s&&""!=s||(s=t.model._attributes.typeUntranslated);var r={protocol:"3DXContent",version:"0.1",source:"FBS_BIP_LIST",data:{items:[{envId:n,serviceId:"3DSpace",subtitle:t.model._attributes.type,content:t.model._attributes.revision,contextId:"_Local",objectId:t.model._attributes.physicalid,objectType:s,displayType:t.model._attributes.type,displayName:t.model._attributes.name}]}};i.dataTransfer.setData("text",JSON.stringify(r))}}};i.contents=e.clone(n);var s={revisions:{collection:H(R),collectionOptions:B(t),view:null,viewOptions:i,idCardOptions:V(0,R,t.duplicateOnly,t.bHistoryGraphSelector)},alternateDesigns:{collection:H(I),collectionOptions:B(t),view:null,viewOptions:i,idCardOptions:V(0,I,t.duplicateOnly,t.bHistoryGraphSelector)},historyGraph:{collection:H(b),collectionOptions:B(t),view:null,viewOptions:i,idCardOptions:V(0,b,t.duplicateOnly,t.bHistoryGraphSelector)},filters:{collection:H(T),collectionOptions:B(t),view:null,viewOptions:i,idCardOptions:V(0,T,t.duplicateOnly,t.bHistoryGraphSelector)}};if(null!=t.duplicateOnly&&1==t.duplicateOnly){t={rootIdCardOptions:V(0,I,t.duplicateOnly,t.bHistoryGraphSelector)};delete s.revisions,delete s.historyGraph,delete s.filters}else t={rootIdCardOptions:V(0,R,t.duplicateOnly,t.bHistoryGraphSelector)};v=new a(s,t),F=-1;var r=this;v.addEvent("onRouteChange",(function(){void 0!==r.options.facetToSelect&&null!==r.options.facetToSelect&&""!==r.options.facetToSelect&&(jQuery('*[data-name="'+r.options.facetToSelect+'"]').trigger("click"),r.options.facetToSelect=null),r.dispatchEvent("onRouteChange")}))},render:function(){var e;return(e=s.extendElement(this.container)).empty(),_(this.options.baseContainer,this.options.droppedObj,this.options.revServiceURL,this.options.proxyType),v.render().inject(e),this},refresh:function(e,t,i,n){_(this.options.baseContainer,e,this.options.revServiceURL,this.options.proxyType);for(var s,r,o=0,a=v.getNodeAt(o);a;){for(s=0;s<a.get("facets").length;s++)(r=a.get("facets")[s]).collection&&(r.collection.nameSelFacet===I&&(void 0!==i&&(r.collection.dupFiltering=i),void 0!==n&&(r.collection.dupRevsFiltering=n)),r.collection.refreshOptions(t,e),r.reference==a._changed.activeFacet.reference&&r.collection.fetch());o++,a=v.getNodeAt(o)}},getDupFilteringValues:function(){return{duplicates:S,revsOfDuplicates:C}},closeHistoryGraphDialog:function(){null!==A&&A.closeHistoryGraphDialog()}});return G})),define("DS/ReviseFromWidget/PickDialog/PickDialog",["DS/ENOjquery/ENOjquery","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/LifecycleServices","DS/ReviseFromWidget/PickDialog/PickDialogView","i18n!DS/ReviseFromWidget/assets/nls/PickDialog"],(function(e,t,i,n,s){"use strict";var r=null,o=null,a=null,c=null,l=null,d=null,u=null,h=null,p=function(e,t,i,n,s){o=t,a=i,c=n,(d=UWA.createElement("div",{id:"pick-dialog-container",html:[{tag:"div",id:"pick-dialog-header"},{tag:"div",id:"pick-dialog-content"}]})).inject(e),(r=e.getElement("#pick-dialog-content")).style.height="calc(100% - 29px)",require(["DS/UIKIT/Mask"],(function(e){e.mask(r)})),s&&e.getElement("#pick-dialog-header").hide()};return p.prototype.load=function(p,v,f,m,g,y,R,I,b,T,S,C,F){h=null==I?null:I;var O=null==R?null:R;t.app_initialization((function(){i.getSecurityContextPromise(I,O).then((function(t){require(["DS/CompareCommon/Utils"],(function(i){l=t,d.getElement("#pick-dialog-header").setContent(e('<span id="pick-header">'+s.chooseObject+"</span>")),i.augDroppedObject(p,{tenant:I,securityContext:l,url3DSpace:a},(function(e){(u=new n({container:r,listContainer:r,baseContainer:o,revServiceURL:a,droppedObj:p,rootObj:e,proxyType:c,callbackFn:v,dataSetRev:C,dataSetAlt:F,duplicateOnly:m||!1,dupFiltering:g,dupRevsFiltering:y,bHistoryGraphSelector:b,isHistoryEmbedded:T,isCompare:S,facetToSelect:f,securityContext:t})).render()}),(function(e){console.log("augDroppedObject error: "+e)}))}))}))}))},p.prototype.refresh=function(e){require(["DS/CompareCommon/Utils"],(function(t){t.augDroppedObject(e,{tenant:h,securityContext:l,url3DSpace:a},(function(t){u.refresh(e,t)}))}))},p.prototype.getDupFilteringValues=function(){return null!==u?u.getDupFilteringValues():void 0},p.prototype.closeHistoryGraphDialog=function(){null!==u&&u.closeHistoryGraphDialog()},p})),define("DS/ReviseFromWidget/NewRevisionFromTree",["UWA/Class","UWA/Class/Events","DS/UIKIT/Mask","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/LifecycleServices","DS/WAFData/WAFData","DS/LifecycleControls/AssemblyTreeList","DS/UIKIT/Input/Select","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","DS/LifecycleServices/AssemblyJson","DS/LifecycleServices/ArrayFunctions","DS/ReviseFromWidget/ReviseFromConstants"],(function(e,t,i,n,s,r,o,a,c,l,d,u){"use strict";return e.extend(t,{init:function(e,t,i,n){this.roots=[],this.tenant=t,this.context=i;for(var s=0;s<e.length;++s)this.roots.push({id:e[s]});this.filterDuplicateInstances=n},openAdvancedTree:function(e,t,n){this.container||(this.container=e,i.mask(this.container),n?this.createTree(n,t):this.createExpandedTree(t))},getAssembly:function(){return this.assembly},getAssemblyHelper:function(){return this.assemblyHelper},getInstances:function(e){return this.treeList.getSameNodes(e)},getNewRevFromData:function(e,t,i){var n=this.treeList.tree.getDocument().getNthRoot(0),s=[];this.addNodeData(s,n,[],0,e,t);var r={physicalid:n.options.physicalId,treeData:s,useSourceTitle:i};document.debugNRF&&(r.Dbg_label=n.options.label);var o=[];return o.push(r),o},addNodeData:function(e,t,i,n,s,r){if(-1===i.indexOf(t.options.nodeId)){i.push(t.options.nodeId);var o={occId:t.options.occId},a=t.dropdownListSelectedIndex,c=a?a.action:this.getDefSelIndex(o,t),l=this.getOptions(o,t).options[c];if(l!==u.ActionOption.Exclude){var d=this.assemblyHelper.getNode(t.options.nodeId);l!==u.ActionOption.ReuseReference||d.clonedFromPhysicalid&&d.clonedFromPhysicalid!==t.options.physicalId||(l=u.ActionOption.Reuse);var h=l===u.ActionOption.InsertNew,p=l===u.ActionOption.Reuse,v=l===u.ActionOption.ReuseReference,f=this.assemblyHelper.getOccurence(t.options.occId);if(!(h&&r&&f.insertedInstance)){var m={physicalid:h?"":d.clonedFromPhysicalid?d.clonedFromPhysicalid:t.options.physicalId,operation:l,physicalid_dup:t.options.physicalId,level:n};if(document.debugNRF&&(m.Dbg_label=t.options.label),!p&&!v&&t.hasChildren()){m.children=[];var g=t.getChildren(),y=g.length,R=0;for(R=0;R<y;R++){var I=g[R],b=this.assemblyHelper.getNode(I.options.nodeId),T={occId:I.options.occId},S=I.dropdownListSelectedIndex,C=S?S.action:this.getDefSelIndex(T,I),F=this.getOptions(T,I).options[C];if(F!==u.ActionOption.Exclude){F!==u.ActionOption.ReuseReference||b.clonedFromPhysicalid&&b.clonedFromPhysicalid!==I.options.physicalId||(F=u.ActionOption.Reuse);var O=F===u.ActionOption.InsertNew,N=F===u.ActionOption.Reuse,E=F===u.ActionOption.ReuseReference,D=this.assemblyHelper.getOccurence(I.options.occId);if(!(O&&r&&D.insertedInstance)){var A={physicalid:O?"":b.clonedFromPhysicalid?b.clonedFromPhysicalid:I.options.physicalId,operation:F,physicalid_dup:I.options.physicalId};document.debugNRF&&(A.Dbg_label=I.options.label),s&&(D.refOccRelId&&(A.rel_physicalid=D.refOccRelId),D.relId&&(A.rel_physicalid_dup=D.relId)),m.children.push(A),N&&E||O&&!r||!I.hasChildren()||this.addNodeData(e,I,i,n+1,s,r)}}}}e.push(m)}}}},hideNodes:function(e){var t=this.treeList.getNodes((function(t){if(e.includes(t.options.nodeId))return!0}));this.treeList.tree.getDocument().prepareUpdate(),t.forEach((function(e){e._treeNode.hide()})),this.treeList.tree.getDocument().pushUpdate()},getOptions:function(e,t){var i=this.assemblyHelper.getOccurence(e.occId),n=[],s=[];if(i.actionInfo){if(i.actionInfo.revise){n.push(u.ActionOption.Revise),s.push(c.revise);var r=!1,o=t&&t.options&&t.options.nodeId,a=o?this.assemblyHelper.getNode(o):null;if(!(!!a&&a.followsParent))r=this.treeList.getSameNodes(o).some((function(e){var t=e._options&&e._options.children?e._options.children:[];return t.length>0&&!t[0]._isHidden}));r&&(n.push(u.ActionOption.ReviseTree),s.push(c.reviseTree))}i.actionInfo.reuse&&(n.push(u.ActionOption.Reuse),s.push({text:c.reuse,disabled:!!i.actionInfo.disableReuse})),i.actionInfo.reuseref&&(n.push(u.ActionOption.ReuseReference),s.push({text:c.reuseReference,disabled:!!i.actionInfo.disableReuseref})),i.actionInfo.insertnew&&(n.push(u.ActionOption.InsertNew),s.push(c.insert)),i.actionInfo.exclude&&(n.push(u.ActionOption.Exclude),s.push(c.exclude))}else n.push(""),s.push("");return{options:n,translated:s}},getDefSelIndex:function(e,t){var i=0,n=this.assemblyHelper.getOccurence(e.occId);if(n.actionInfo&&n.actionInfo.defAction){var s=this.getOptions(e,t).options.indexOf(n.actionInfo.defAction);s>-1&&(i=s)}return i},createExpandedTree:function(e){var t=this;s.getSecurityContextPromise(this.tenant,this.context).then((function(n){t.expandStructure(n,(function(n){i.unmask(t.container),t.assembly=l.convertFromExpandFormat(n),t.updateAssemblyNodesWithParentInfo(),t.createAdvancedTree(e);t.dispatchEvent("onTreeCreated",{})}))}))},createTree:function(e,t){var n=this;i.unmask(n.container),n.assembly=e,n.createAdvancedTree(t);n.dispatchEvent("onTreeCreated",{})},createAdvancedTree:function(e){var t=["revision"];e.addActionCol&&t.push("action"),this.treeList=new o({getChildrenInTreeOrder:e.getChildrenInTreeOrder,allCols:t});var n={filterDuplicates:this.filterDuplicateInstances};this.container.setContent(this.treeList);var s=this;if(e.addActionCol){var r={column:"action",translated:c.action};this.treeList.insertDropdownListCol(0,r.column,r.translated,(function(e,t){return s.getOptions(e,t).translated}),(function(e,t,n){var o={occId:n.options.occId},a=s.getOptions(o,n).options,l=a[t],d=a[e];i.mask(s.container,c.updatingMessage);var h=s.treeList.getSameNodes(n.options.nodeId);setTimeout((function(){h.forEach((function(e){e.getAllDescendants().forEach((function(e){var t=s.treeList.getSameNodes(e.options.nodeId);s.treeList.setDropdownSelectionIf(t,0,r.column)}))}));var n={preSelIdx:e,selIdx:t,prevSelOp:d,selOp:l,selNodes:h};s.dispatchEvent("onDropdownListChange",n),s.treeList.tree.getManager().updateView(),i.unmask(s.container)}),50),l===u.ActionOption.ReviseTree&&s.treeList.setDropdownSelectionIf(h,0,"action")}),void 0,void 0,(function(e,t){return s.getDefSelIndex(e,t)}))}!0===e.filter3DShapes&&(n.loadFilter=function(e){return"3DShape"===e.type}),this.assemblyHelper=l.AssemblyHelper(this.assembly),this.treeList.load(this.assembly,t,n),this.treeList.tree.getManager().onReady((function(){s.dispatchEvent("onTreeReady"),s._sortColumn&&s.treeList.tree.getManager().sortColumnContent(s._sortColumn.sortColumnID,{sortOrder:s._sortColumn.sort})})),this.treeList.tree.getManager().onSortColumnContent((function(e){s._sortColumn={sortColumnID:e.columnDataIndex,sort:e.sortOrder}})),this.treeList.tree.getDocument().expandAll()},setTreeNodeChildrenToAction:function(e,t,i){var n=this;e.hasChildren()&&e.getChildren().forEach((function(e){n.treeList.getSameNodes(e.options.nodeId).forEach((function(s){var r,o=s.options.occId,a=n.assemblyHelper.getOccurence(o);if(a.actionInfo.revise&&(a.actionInfo.reuse||a.actionInfo.reuseref)){var c=e._options&&e._options.children?e._options.children:[];r=c.length>0&&!c[0]._isHidden?i===u.ActionOption.Reuse?2:3:i===u.ActionOption.Reuse?1:2,n.treeList.setDropdownSelectionIf([s],r,"action")}else a.actionInfo.insertnew&&a.actionInfo.reuse&&(r=i===u.ActionOption.Reuse?0:1,n.treeList.setDropdownSelectionIf([s],r,"action"),n.setTreeNodeChildrenToAction(e,t,i))}))}))},updateAssemblyNodesWithParentInfo:function(){this.assembly.nodes.forEach((function(e){void 0===e.followsParent&&(e.followsParent="CATIA Embedded Component"===e.type||"3DShape"===e.type||"BundleFastener"===e.type)}))},adjustHeight:function(){},sortOccRelsOnOrder:function(){this.assembly&&this.assembly.occurrencerelationships&&this.assembly.occurrencerelationships.sort((function(e,t){if(e.parent>t.parent)return 1;if(e.parent<t.parent)return-1;if(e.order&&t.order){if(e.order>t.order)return 1;if(e.order<t.order)return-1}return 0}))},collapsedNodes:[],isNodeCollapsed:function(e){if(e.isExpanded())return!1;var t=e.getChildren();return!!t&&(t.length>1||0==t[0].isHidden())},storeAllCollapsed:function(){this.treeList&&this.treeList.tree&&this.treeList.tree.getDocument().getAllDescendants().forEach((function(e){this.isNodeCollapsed(e)&&this.collapsedNodes.push(e._options.occId)}),this)},restoreAllCollapsed:function(){this.treeList&&this.treeList.tree&&(this.treeList.tree.getDocument().getAllDescendants().forEach((function(e){this.collapsedNodes.includes(e._options.occId)&&e.collapse()}),this),this.collapsedNodes=[])},expandStructure:function(e,t){var i=this,s={intent:"explore_2D",debug:!1,type_filter_bo:["CATProduct","CATProcess","CATPart","CATDrawing","CATAnalysis","CATIA Embedded Component","CATIA CGR","CATShape","CATIA V4 Model","CATIA Design Table","VPMReference","VPMRepReference","3DShape"],roots:this.roots,level:"-1",source:"cstorage",authored:!0,root_physicalid:this.roots[0].id},o=n.get3DSpaceWSUrl(this.tenant,"/resources/enopad/lwc/expand",null);r.authenticatedRequest(o,{method:"POST",headers:n.getHeaders(e),timeout:6e5,data:JSON.stringify(s),type:"json",onComplete:function(e){t(e)},onFailure:function(e){var t=e;e.hasOwnProperty("error")?t=e.error:e.hasOwnProperty("message")&&(t=e.message),i.dispatchEvent("onError",{message:t}),console.error("NewRevisionFromTree.expandStructure: onFailure -> "+e)},onTimeout:function(e){i.dispatchEvent("onError",{message:c.connectionTimeout}),console.log("NewRevisionFromTree.expandStructure timeout error -> "+e)}})}})})),define("DS/ReviseFromWidget/ReviseFromPrefs",["UWA/Class","UWA/Promise","DS/ReviseFromWidget/ReviseFromPrefsDlg","DS/LifecycleServices/LifecycleServices","i18n!DS/ReviseFromWidget/assets/nls/ReviseFromPrefsDlg","DS/WidgetServices/WidgetServices","DS/WAFData/WAFData"],(function(e,t,i,n,s,r,o){"use strict";return e.extend({init:function(e,t){this._parent({}),this._hWidget=e,this._appId=t,this._globalStorageName="NewRevisionFromSettings",this._useSourceTitle=!1,this._showWarningNoRevise=!1,this._defaultSettings={useSourceTitle:this._useSourceTitle,showWarningNoRevise:this._showWarningNoRevise}},_updateSettings:function(e){this._useSourceTitle=e.titleFromSource,this._showWarningNoRevise=e.warningNoRevise},_getPreferenceName:function(){return this._appId.slice(0,this._appId.length-1)+"_"+this._globalStorageName},getUseSourceTitle:function(){return this._useSourceTitle},getShowWarningNoRevise:function(){return this._showWarningNoRevise},loadSettingsPromise:function(){var e=this,i=this._getPreferenceName();return new t((function(t,n){r.getCompassUrlAsync({onComplete:function(n){var s=encodeURI(n+"/resources/AppsMngt/user/getPreferences?name="+i);o.authenticatedRequest(s,{method:"GET",timeout:5e3,headers:{Accept:"application/json",SecurityContext:void 0},cache:!1,onComplete:function(i){var n=null;n=null!=i&&""!=i?JSON.parse(i):e._defaultSettings,e._updateSettings(n),t(e)},onFailure:function(e){console.log("NRFSettings: failed getting value")}})}})}))},save:function(e){this._updateSettings(e);var t=this._getPreferenceName();r.getCompassUrlAsync({onComplete:function(i){var n=encodeURI(i+"/resources/AppsMngt/user/setPreferences?name="+t+"&value="+JSON.stringify(e));o.authenticatedRequest(n,{method:"GET",timeout:5e3,headers:{Accept:"application/json",SecurityContext:void 0},cache:!1,onComplete:function(e){},onFailure:function(e){console.log("NRFSettings: failed setting ")}})}})},showPreferencesDlg:function(e){var t=this;i.showDialog({title:s.SettingsTitle,parent:document.body,titleFromSource:this.getUseSourceTitle(),warningNoRevise:this.getShowWarningNoRevise(),onShow:function(t){e&&e.onShow&&e.onShow(t)},onOk:function(i){var n={};void 0!==i.titleFromSource&&(n.titleFromSource=i.titleFromSource),void 0!==i.warningNoRevise&&(n.warningNoRevise=i.warningNoRevise),t.save(n),e&&e.onOk&&e.onOk(t)}})}})})),define("DS/ReviseFromWidget/ReviseFromController",["UWA/Controls/Abstract","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/ReviseFromWidget/ReviseFromModel","DS/WAFData/WAFData","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","DS/LifecycleServices/LifecycleCommandManager","DS/LifecycleCmd/MessageMediator","DS/ENOCollabToolsUI/tracker/ENOCollabTracker","DS/ENOCollabToolsUI/tracker/ENOCollabTrackerBackEnd","i18n!DS/LifecycleServices/assets/nls/LifecycleServicesNls"],(function(e,t,i,n,s,r,o,a,c,l,d){"use strict";return e.extend({tenant:null,context:null,init:function(){this.model=new n,this.commandManager=new o},setContext:function(e){this.context=e},_dispatchError:function(e,t){this.dispatchEvent("onError",{message:e,options:t})},_dispatchNotification:function(e,t){this.dispatchEvent("onNotification",{message:e,options:t})},_onFailure:function(e,i,n){var s=this;t.showWebServiceError(i,n,(function(e,t,i,n,r){if(t?s._dispatchNotification(d.reviseTimeoutInfo,{sticky:!0,hasHtml:!0}):s._dispatchError(e,{title:i,subtitle:n,submessage:r}),s.trackerEvent){let e=s.trackerEventBeginTime?Date.now()-s.trackerEventBeginTime:0,i={numberObjects:s.trackerNumberObjects,actionStatus:t?"running_on_backend":"failure",actionTime:e};s.trackerEvent=c.createValidationEventFromEvent(i,s.trackerEvent),c.checkAndTrackPageEvent(s.trackerEvent)}}),e),console.log("Failed to retrive data from the server")},_onTimeout:function(e,t){var i=this;if(e?this._dispatchNotification(d.reviseTimeoutInfo,{sticky:!0,hasHtml:!0}):this._dispatchError(r.timeout),i.trackerEvent){let t=i.trackerEventBeginTime?Date.now()-i.trackerEventBeginTime:0,n={numberObjects:i.trackerNumberObjects,actionStatus:e?"running_on_backend":"failure",actionTime:t};i.trackerEvent=c.createValidationEventFromEvent(n,i.trackerEvent),c.checkAndTrackPageEvent(i.trackerEvent)}console.log("Timeout error")},getDuplicates:function(e){var i=this;t.getSecurityContextPromise(this.tenant,this.context).then((function(t){i.getRevisionHistory(e,t)}))},getSources:function(e){var i=this;t.getSecurityContextPromise(this.tenant,this.context).then((function(t){i.getVersionGraph(e,t)}))},getObjectInfo:function(e,i){var n=this;t.getSecurityContextPromise(this.tenant,this.context).then((function(t){n.getAttributes(e,t,i)}))},getNextRevisionInfo:function(e){var i=this;return new UWA.Class.Promise((function(n,s){t.getSecurityContextPromise(i.tenant,i.context).then((t=>i.getVersionNumberProposal(e,t))).then((e=>{n(e)})).catch((e=>{i._dispatchError(t.parseWebServiceError(e).toString())}))}))},getVersionNumberProposal:function(e,t){var n=this;return new UWA.Class.Promise((function(r,o){var a=[],c=[];e.forEach((function(e){(c=[]).push({semantic:"LAST",id:e}),a.push({copyId:e,ancestors:c})}));var l=i.get3DSpaceWSUrl(n.tenant,"/resources/v1/dslc/getversionnumberproposal",null);s.authenticatedRequest(l,{type:"json",method:"POST",headers:i.getHeaders(encodeURIComponent(t)),timeout:6e5,data:JSON.stringify({addRequests:a}),onComplete:function(e){var t="string"==typeof e?JSON.parse(e):e;r(t)},onTimeout:n._onTimeout.bind(n,!1),onFailure:n._onFailure.bind(n,!1)})}))},getReviseAccessInfo:function(e){var i=this,n=["majorid.lastmajorid.bestsofar.current.access[majorrevise]","majorid.lastmajorid.bestsofar.physicalid","last.current.majorrevisionable","last.current.revisionable","isConfigured"];return new UWA.Class.Promise((function(s,r){t.getSecurityContextPromise(i.tenant,i.context).then((t=>i.getAttributesPromise(e,n,t))).then((e=>{s(e)})).catch((e=>{i._dispatchError(t.parseWebServiceError(e).toString())}))}))},getAttributesPromise:function(e,t,n){var r=this;return new UWA.Class.Promise((function(o,a){var c={data:[],attributes:t};e.forEach((function(e){if(-1===c.data.findIndex((t=>t.physicalid===e))){var t={physicalid:e};c.data.push(t)}}));var l=i.get3DSpaceWSUrl(r.tenant,"/resources/lifecycle/product/attributeList",null);s.authenticatedRequest(l,{type:"json",method:"POST",headers:i.getHeaders(encodeURIComponent(n)),timeout:6e5,data:JSON.stringify(c),onComplete:function(e){var t="string"==typeof e?JSON.parse(e):e;o(t)},onTimeout:r._onTimeout.bind(r,!1),onFailure:r._onFailure.bind(r,!1)})}))},createNewRevisionFrom:function(e,i){var n=this;t.getSecurityContextPromise(this.tenant,this.context).then((function(t){n.reviseFromServiceRequest(e,t,i)}))},getRevisionHistory:function(e,t){var n=this,r=i.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/history/links",null);e.hasOwnProperty("physicalid")&&s.authenticatedRequest(r,{method:"GET",headers:i.getHeaders(t),timeout:6e5,onComplete:function(e){console.log("getRevisionHistory: COMPLETED"),n.onObjectLinksDownloaded(e)},data:"physicalid="+e.physicalid+"&depth=100",onTimeout:this._onTimeout.bind(this,!1),onFailure:this._onFailure.bind(this,!1),type:"json"})},getVersionGraph:function(e,t){var n=this,r=[];r.push({id:e.physicalid});var o=i.get3DSpaceWSUrl(this.tenant,"/resources/v1/dslc/versiongraph","withIsLastVersion=1&withCopyFrom=1&withAdjacentVersion=1");e.hasOwnProperty("physicalid")&&s.authenticatedRequest(o,{method:"POST",headers:i.getHeaders(t),timeout:6e5,onComplete:function(t){n.onVersionGraphDownloaded(e,t)},data:JSON.stringify({graphRequests:r}),onTimeout:this._onTimeout.bind(this,!1),onFailure:this._onFailure.bind(this,!1),type:"json"})},onObjectLinksDownloaded:function(e){this.model.setHistLinksData(e),this.dispatchEvent("onDuplicatesRetrieved")},isRootAccessible:function(e,t){var i=!0;for(const n of t.graphs)if(n.item.vid===e){"#DENIED!"===n.item.code&&(i=!1);break}return i},onVersionGraphDownloaded:function(e,t){if(t.errorID){console.log("Version graph service error:"+t.errorID+" key:"+t.key),console.log("Version graph service error message:"+t.errorMessage);var i=t.errorMessage,n=e.displayName?e.displayName:e.name,s=r.replace(r.get("noReviseOfName"),{dispName:n});return 101!=t.errorID&&i||(i=r.objectNotFound),void this._dispatchError(i,{title:s,subtitle:i})}var o=!0,a=0===this.model.getVersionGraphData().length;if(!a||this.isRootAccessible(e.physicalid,t)){if(this.model.setVersionGraphData(t),a&&1===this.model.getSources(e.physicalid,!1).length){var c=this.model.getSources(e.physicalid,!0);if(1===c.length){o=!1;var l={physicalid:c[0].id};this.getSources(l)}}o&&this.dispatchEvent("onSourcesRetrieved")}else{i=r.objectNotFound,n=e.displayName?e.displayName:e.name,s=r.replace(r.get("noReviseOfName"),{dispName:n});this._dispatchError(i,{title:s,subtitle:i})}},getAttributes:function(e,t,n){var r=JSON.stringify(e),o=i.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/product/attributeList",null);s.authenticatedRequest(o,{method:"POST",headers:i.getHeaders(t),timeout:6e5,onComplete:n,data:r,onTimeout:this._onTimeout.bind(this,!1),onFailure:this._onFailure.bind(this,!1),type:"json"})},reviseFromServiceRequest:function(e,t,n){var o=this;console.log("reviseFrom:");var d=6e5;if(e.notificationTimeout=600,this.trackerEventBeginTime=Date.now(),this.trackerNumberObjects=e.data?e.data.length:0,!n){let e={UXName:"NewRevisionFrom",numberObjects:this.trackerNumberObjects};n=c.createInitActionEvent(e)}this.trackerEvent=n;l.enrichRequestWithMetrics(e,{UXName:"NewRevisionFrom "});var u=JSON.stringify(e),h=i.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/revise/from",null);s.authenticatedRequest(h,{method:"POST",headers:i.getHeaders(t),timeout:d,onComplete:function(t){if(console.log("reviseFrom: COMPLETED"),null!=t&&t.hasOwnProperty("status")&&t.hasOwnProperty("report")&&"failure"===t.status){for(var i=r.reviseFailed,n=null,s=0;s<t.report.length;s++){var l=t.report[s];if(l.ENOVersioningErrorKey&&("NonLinearVersioning.Error.NoReviseAccess"===l.ENOVersioningErrorKey||"NonLinearVersioning.Error.AccessRights"===l.ENOVersioningErrorKey||"NonLinearVersioning.Error.POVCarryOver"===l.ENOVersioningErrorKey)){n={title:r.reviseFailed,subtitle:r.get("verifyCredentials"),submessage:r.get("lackingReviseAccessRole")},console.log("Revise from failed with error: "+l.error);break}if(l.error&&l.error!==i){i=l.error;break}}let e=o.trackerEventBeginTime?Date.now()-o.trackerEventBeginTime:0,a={numberObjects:o.trackerNumberObjects,actionStatus:"failure",actionTime:e};return o.trackerEvent=c.createValidationEventFromEvent(a,o.trackerEvent),c.checkAndTrackPageEvent(o.trackerEvent),void o._dispatchError(i,n)}var d={created:[],deleted:[],modified:[]};d.context=o.context;var u=t.results;var h=e.data[0].treeData.findIndex((function(e){return 0==e.level})),p=e.data[0].treeData[h],v=[];v.push(p),o.commandManager.findObjectDerivedFromSelection(u,v).forEach((function(e){var t=!1;e.hasOwnProperty("derivedfromphysicalid")&&(t=!0);var i={physicalid:e.physicalid,sourceObjectId:e.derivedfromphysicalid,sourceContentObjectId:p.physicalid_dup,operation:"Revise",refreshPSD:t};e.hasOwnProperty("folders")&&(d.refreshFolder=!0,i.folders=e.folders),d.created.push(i),u.forEach((function(e){var t={physicalid:e.derivedfromphysicalid,operation:"Revise"};d.modified.push(t)}))})),a.dispatchEvent("onModification",d);let f=o.trackerEventBeginTime?Date.now()-o.trackerEventBeginTime:0,m={numberObjects:o.trackerNumberObjects,actionStatus:"success",actionTime:f};o.trackerEvent=c.createValidationEventFromEvent(m,o.trackerEvent),c.checkAndTrackPageEvent(o.trackerEvent),o.dispatchEvent("onReviseSuccess")},data:u,onTimeout:this._onTimeout.bind(this,!0),onFailure:this._onFailure.bind(this,!0),type:"json"})},setTenant:function(e){this.tenant=e}})})),define("DS/ReviseFromWidget/ReviseFromWidget",["css!DS/ReviseFromWidget/ReviseFromWidget","UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Mask","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleCommandManager","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/LifecycleAlert","DS/ReviseFromWidget/ReviseFromController","DS/ReviseFromWidget/util/TreeSyncMgr","DS/WAFData/WAFData","DS/ReviseFromWidget/NewRevisionFromTree","DS/LifecycleServices/AssemblyJson","DS/LifecycleControls/CommandDialog","DS/LifecycleServices/DictionaryServices","DS/ReviseFromWidget/controls/TreesContainer","DS/ReviseFromWidget/controls/TreePanel","DS/ReviseFromWidget/ReviseFromConstants","DS/ReviseFromWidget/ReviseFromPrefs","DS/ReportingPanel/ReportingPanel","DS/ENOCollabToolsUI/tracker/ENOCollabTracker"],(function(e,t,i,n,s,r,o,a,c,l,d,u,h,p,v,f,m,g,y,R,I,b){"use strict";return i.extend({securityContext:null,context:null,tenant:null,sources:null,pickDialog:null,refReviseFromTree:null,srcReviseFromTree:null,resReviseFromTree:null,newTreeResult:null,folderId:null,filterDuplicateInstances:!1,irpcBehavior:!1,activePDTabElPath:".facets-list > .facet.interactive.tab-behavior.selected",activePDTabName:null,activePDTabNameWidgetPref:"LCS_NRF_LastPDActiveTabName",reuseReferenceEnabled:!1,reuseReferenceEnabledExpr:"ReuseReferenceEnabled",init:function(){this.physicalIds=[],this.onCompleteFnArr=[],this.resultRevisionCalculated=!1,this.everythingIsRevisionable=!1,this.commandManager=new o,this.controller=new l,this.settings=new R(widget,"ENOLCMI_AP")},executeCmd:function(e,t,i){var n=this;this._setupEventHandlers(e,i),this.context=t.context||{},this.folderId=t.targetFolderId,this.trackerEventBeginTime=Date.now(),this.context.displayNotification=e=>{this._displayNotification(e)};try{if(void 0!==a.getActiveFolder){var s=a.getActiveFolder();void 0!==s.id&&null!==s.id&&""!==s.id&&(this.folderId=s.id,this.securityContex=""!==s.sc&&void 0!==s.sc?s.sc:this.securityContex,require(["DS/PlatformAPI/PlatformAPI"],(function(e){e.publish("FolderEditor.ActiveFolderCallBack",{id:s.id,label:s.label})})))}}catch(e){this.folderId=t.targetFolderId,this.securityContex=a.getCurrentFolderSecurityContext()}this.controller.setContext(this.context),this.settings.loadSettingsPromise().then((function(t){n.setObjects(e)}))},_handleError:function(e){document.body.style.cursor="default",this.showError(e.message,e.options),this._onComplete()},_handleNotification:function(e){document.body.style.cursor="default",this.showNotification(e.message,e.options),this._onComplete()},_storePickdialogTab:function(){this.activePDTabName&&widget.setValue(this.activePDTabNameWidgetPref,this.activePDTabName)},_verifySources:function(e,t){if(e.length<1){var i=s.replace(s.get("noReviseOfName"),{dispName:t[0].displayName?t[0].displayName:t[0].name}),n={title:i,subtitle:s.get("noSourcesAvailable"),submessage:s.get("sourceTypes"),hasHtml:!0};this.showError(i,n),this._onComplete()}else this.sources=e,this.dispatchEvent("onReady")},_setupEventHandlers:function(e,t){this.addEvent("onReady",(function(){this._showCommandUI(e)}),this),this.addEvent("onComplete",(function(){this._storePickdialogTab(),this.onCompleteFnArr.forEach((function(e){e.apply(this)}),this),t()}),this),this.controller.addEvent("onDuplicatesRetrieved",(function(){document.body.style.cursor="default";var t=this.controller.model.getDuplicates(this.physicalIds[0],this.irpcBehavior);this._verifySources(t,e)}),this),this.controller.addEvent("onSourcesRetrieved",(function(){document.body.style.cursor="default";var t=this.controller.model.getSources(this.physicalIds[0]);this._verifySources(t,e)}),this),this.controller.addEvent("onError",this._handleError.bind(this)),this.controller.addEvent("onNotification",this._handleNotification.bind(this)),this.controller.addEvent("onReviseSuccess",(function(e){document.body.style.cursor="default",this.commandDialog&&this.commandDialog.unmaskBody(),this.showNotification(s.reviseSuccessful,{type:"success"}),this._onComplete()}),this)},_showCommandUI:function(e){var t=this,i="";if(Array.isArray(e)&&e.length&&e[0].name){i=" - "+e[0].name+(e[0].revision?" "+e[0].revision:"")}this.refReviseFromTree=new h([this.physicalIds[0]],this.tenant,this.context,this.filterDuplicateInstances),this.refReviseFromTree.addEvent("onTreeCreated",this._handleRefTreeCreated.bind(this)),this.refReviseFromTree.addEvent("onError",this._handleError.bind(this)),this.resReviseFromTree=new h([this.physicalIds[0]],this.tenant,this.context,this.filterDuplicateInstances);var r=this._renderDialogContent(e[0].displayName),o=new v,a=o.create(r,{title:s.newRevisionFrom+i,OKBtnText:s.NRFOK,imageUrl:e[0].imageUrl||"",resizable:!0,powerMaximize:!0,closeButton:!0,settingsButton:!0,settingsCallback:function(){t.showSettings()},onOk:function(){this.createNewRevision()},onClose:function(){this._onComplete()},enableCmd:function(){return this.resultRevisionCalculated&&this.everythingIsRevisionable},events:{onResizeFloating:function(){}}},this);o.setPowermaximizeVisibility(!1),o.addEvent("widget-maxmized-changed",(function(e){e&&o.maximize(!0)})),this.commandDialog=o,a.inject(widget.body),a.setNewSize({width:900,height:500}),o.isWidgetMaximized()&&o.maximize(!0),this.onCompleteFnArr.push((function(){o.destroy()})),this.addEvent("ResultRevisionCalculated",(function(){this.createResultTree(),t.everythingIsRevisionable=this.verifyEverythingIsRevisionable(),o.updateUI(),this.treeSyncMgr=new d,this.treeSyncMgr.add(this.refReviseFromTree.treeList.tree),this.treeSyncMgr.add(this.srcReviseFromTree.treeList.tree),this.resTreeSyncId=this.treeSyncMgr.add(this.resReviseFromTree.treeList.tree);let e={UXName:"NewRevisionFrom",UXMode:"Advanced",numberObjects:t.srcReviseFromTree.getAssembly().occurrences.length,actionStatus:"success",actionTime:t.trackerEventBeginTime?Date.now()-t.trackerEventBeginTime:0};t.trackerEvent=b.createInitActionEvent(e),b.checkAndTrackPageEvent(t.trackerEvent),this.dispatchEvent("ResultCreated")}),this),this.resReviseFromTree.addEvent("onTreeReady",(function(){var e=t.resPanel.elements.contentContainer;e&&n.isMasked(e)&&n.unmask(e)}))},_renderDialogContent:function(e){var i=document.createElement("div");i.className="reviseFrom_popup";var n=t.createElement("div",{class:"mainDiv",styles:{height:"100%"}});return this.treesContainer=new m,this.refPanel=new g({caption:s.refStructure,addClass:"treePanel-ref ",collapseable:!0}),this.srcPanel=new g({caption:s.srcStructure,addClass:"treePanel-src ",collapseable:!0}),this.resPanel=new g({caption:s.resPreview,addClass:"treePanel-res"}),this.treesContainer.addPanel(this.refPanel),this.treesContainer.addPanel(this.srcPanel),this.treesContainer.addPanel(this.resPanel),this.treesContainer.inject(n),this.pickHiddenEl=UWA.createElement("div",{id:42,styles:{display:"none"}}),this.pickHiddenEl.inject(n),this.refReviseFromTree.openAdvancedTree(this.refPanel.elements.content,{addActionCol:!1,getChildrenInTreeOrder:!0,filter3DShapes:!0}),i.appendChild(n),i},_onComplete:function(){this.dispatchEvent("onComplete")},setObjects:function(e){var t=this;if(!e||0===e.length)throw s.noObject;if(e.length>1)throw s.multipleSelection;var i=e[0];if(i.hasOwnProperty("physicalid")&&""===i.physicalid)throw s.epmtyPhysicalId;this.physicalIds.push(i.physicalid),this.tenant=i.tenant,void 0!==this.tenant&&null!==this.tenant||(this.tenant="OnPremise"),this.commandManager.setTenant(this.tenant),this.controller.setTenant(this.tenant),r.getAllowedSemanticsPromise(this.physicalIds,this.context).then((function(e){if(r.isBaselineMode(i.physicalid,e))t._handleError({message:s.objectTypeNotSupported});else if(r.isEffectivityBasedOrEffectivityBasedReuseMode(i.physicalid,e)){var n=r.getRevisionMode(i.physicalid,e),o=s.effectivity_based;"effectivity_based_reused"===n?o=s.effectivity_based_reused:"effectivity_based_model"===n&&(o=s.effectivity_based_model);var a=i.name?i.name:i.displayName,c={title:s.replace(s.noReviseFromOfName,{dispName:a}),subtitle:s.replace(s.objectUseRevisionMode,{revisionModeName:o})};t._handleError({message:s.revisionModeNotSupported,options:c})}else i.hasOwnProperty("type")&&f.getIsKindOfPromise(t.tenant,["CATPart","CATProduct","VPMReference","SoftwareLogicalItem"],i.type).then((function(e){e?f.getIsKindOfPromise(t.tenant,["PLMReference"],i.type).then((function(e){t.irpcBehavior=e,document.body.style.cursor="wait",t.irpcBehavior?t.controller.getSources(i):t.controller.getDuplicates(i)})):t._handleError({message:s.objectTypeNotSupported})}))}),(function(e){t._handleError({message:s.serviceError})}))},_handleRefTreeCreated:function(e){1===this.sources.length?this._renderDuplicateTree(this.sources[0].id,this.srcPanel.elements.content):this._renderSelectionList(this.srcPanel.elements.content,this.pickHiddenEl);var t=this.refReviseFromTree.getAssembly(),i=[];t.nodes.forEach((function(e){i.push(e.physicalid)})),this.nextRevInfoPromise=this.controller.getNextRevisionInfo(i),this.reviseAccessInfoPromise=this.controller.getReviseAccessInfo(i)},_handleSrcTreeCreated:function(e){this.getObjectInfo()},addPhysIdsToData:function(e,t){for(var i=e.nodes,n=i.length,s=0;s<n;s++){var r=i[s];function a(e){return e.physicalid===r.physicalid}if(-1===t.findIndex(a)){var o={physicalid:r.physicalid};t.push(o)}}},getObjectInfo:function(){document.body.style.cursor="wait";var e={data:[],attributes:["physicalid","attribute[MCADInteg-ClonedFrom]","attribute[PLMReference.V_DerivedFrom]","attribute[PLMEntity.V_usage]","attribute[PLMCoreRepReference.V_isOnceInstantiable]","firstRevision","displayType","last.current","last.attribute[Title]","last.attribute[PLMEntity.V_Name]","logicalid","attribute[PLMReference.V_fromExternalID]","attribute[PLMEntity.PLM_ExternalID]","revision","attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]","type.kindof[BundleFastenerAbstract]","majorids.bestsofar.physicalid","majorids.bestsofar.revision","majorid.lastmajorid.bestsofar.physicalid","majorid.lastmajorid.bestsofar.revision"],expressions:[this.reuseReferenceEnabledExpr]};this.irpcBehavior&&(e.attributes.push("majorids.bestsofar.attribute[PLMReference.V_DerivedFrom]"),e.attributes.push("majorid.lastmajorid.bestsofar.attribute[PLMEntity.V_Name]"));var t=this.srcReviseFromTree.getAssembly();this.addPhysIdsToData(t,e.data);var i=this.refReviseFromTree.getAssembly();this.addPhysIdsToData(i,e.data);var n=this;this.controller.getObjectInfo(e,(function(e){document.body.style.cursor="default",n.onCompleteGetObjectInfo(e)}))},addObjectInfo:function(e,t,i,n,s){var r=t.nodes,o=new Set;r.forEach((function(e){o.add(e.physicalid)}));for(var a=e.filter((function(e){return!o.has(e.physicalid)})),c=r.length,l=e.length,d=a.length,u=[],h=0;h<l;h++)for(var p=e[h],v=0;v<c;v++){var f=r[v];if(p.physicalid===f.physicalid){if(i.addClonedFrom){var m=!1,g=null,y=p["attribute[MCADInteg-ClonedFrom]"];if(y)m=!0;else{for(var R,I=p.logicalid,b=0;b<d;b++){if((N=a[b]).physicalid!=p.physicalid&&N.logicalid===I){y=N.physicalid,m=!0;break}}if(!m&&(y=p["attribute[PLMReference.V_DerivedFrom]"]))for(b=0;b<d;b++){if((N=a[b]).physicalid===y){m=!0;break}}if(!m)for(b=0;b<d;b++){var T=(N=a[b])["attribute[PLMReference.V_DerivedFrom]"];if(T&&T===p.physicalid){y=N.physicalid,m=!0;break}}if(!m){var S=p["majorids.bestsofar.physicalid"];if(S){var C=S.split("");for(b=0;b<d;b++){if((N=a[b]).physicalid!==p.physicalid){var F=N["majorids.bestsofar.attribute[PLMReference.V_DerivedFrom]"];if(F)if(F.split("").some((function(e){return C.indexOf(e)>=0}))){y=N.physicalid,m=!0;break}}}}}if(!m)if(R=p["attribute[PLMReference.V_fromExternalID]"])for(b=0;b<d;b++){var O=(N=a[b])["attribute[PLMEntity.PLM_ExternalID]"];if((O+=" "+N.revision)===R){y=N.physicalid,m=!0;break}}if(!m)if(R=p["attribute[PLMReference.V_fromExternalID]"])for(b=0;b<d;b++){var N;O=(N=a[b])["attribute[PLMEntity.PLM_ExternalID]"];if(N.physicalid!=p.physicalid&&R.startsWith(O)){y=N.physicalid,m=!0;break}}}if(m&&y)g=y.split("|")[0];f.clonedFromPhysicalid=g}i.addFirstRevision&&(f.firstRevision=p.firstRevision),i.addNextRevision&&(f.nextRevision=n.getNextRev(p.physicalid)),i.addIsRevisionable&&(f.isRevisionable=s.isRevisionable(p.physicalid),f.hasReviseAccess=s.hasReviseAccess(p.physicalid),f.hasAccess=s.hasAccess(p.physicalid),f.isLatestRevision=s.isLatestRevision(p.physicalid),f.isConfigured=s.isConfigured(p.physicalid)),i.addLatestRevTitle&&(f.latestRevTitle=p["last.attribute[Title]"],f.latestRevTitle||(f.latestRevTitle=p["last.attribute[PLMEntity.V_Name]"],f.bsfRevTitle=p["majorid.lastmajorid.bestsofar.attribute[PLMEntity.V_Name]"]),f.latestPhysicalid=p["majorid.lastmajorid.bestsofar.physicalid"],f.latestRevision=p["majorid.lastmajorid.bestsofar.revision"]);var E="TRUE"===p["attribute[PLMCoreRepReference.V_isOnceInstantiable]"];if("3DShape"===f.type){var D=p["attribute[PLMEntity.V_usage]"];D&&("3DPart"===D?(E&&(f.onceInstantiable3DShape=!0),f.followsParent=!0):"3DShape"===D&&E?(f.followsParent=!0,f.onceInstantiable3DShape=!0):f.followsParent=!1)}var A="TRUE"===p["attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]"],w="TRUE"===p["type.kindof[BundleFastenerAbstract]"];(E||A||w)&&(f.followsParent=!0),f.onceInstantiable3DShape&&u.push(f.nodeid),f.displayType=p.displayType;break}}return{shapeNodes:u}},getNodeFromPhysicalId:function(e,t){for(var i=e.nodes,n=i.length,s=0;s<n;s++){var r=i[s];if(r.physicalid===t)return r}return null},verifyRootIsRevisionable:function(e){var t=p.getRootOccurenceId(e),i=p.getNodeIdFromOccurenceId(e,t),n=p.getNode(e,i);return!(!n.isRevisionable||!n.hasReviseAccess||n.followsParent)||(n.followsParent?this.showError(s.selectParentToPerformOperation):this.showRootNotRevisionableErrMsg(n),!1)},showRootNotRevisionableErrMsg:function(e){var t,i=e.Title,n="<b>"+i+"</b>",r=e.revision,o=null;if(e.isRevisionable)if(e.hasAccess||e.isLatestRevision)if(!e.hasReviseAccess&&e.isConfigured){t="noReviseAccess",o={title:s.replace(s.get("noReviseOfName"),{dispName:i}),subtitle:s.replace(s.get("noReviseOfConfiguredRevision"),{dispName:i,dispRevision:r}),hasHtml:!0}}else{t="noReviseAccess",o={title:s.replace(s.get("noReviseOfType"),{dispType:e.displayType}),subtitle:s.get("verifyCredentials"),submessage:s.get("lackingReviseAccessRole"),hasHtml:!0}}else{t="noReviseAccess",o={title:s.replace(s.get("noReviseOfName"),{dispName:i}),subtitle:s.replace(s.get("noPermissionToLatestRevision"),{dispName:i}),hasHtml:!0}}else t="cannotBeRevised",o={hasHtml:!0};var a=s.replace(s.get(t),{dispName:n});this.showError(a,o)},verifyEverythingIsRevisionable:function(){if(!this.settings.getShowWarningNoRevise())return!0;var e=this.refReviseFromTree.getAssembly(),t=[];return e.nodes.forEach((function(e){e.isRevisionable&&e.hasReviseAccess||e.followsParent||e.isExcluded||"0"===e.physicalid||t.push(e)})),0==t.length||(this.launchReportingPanel(t),!1)},verifyNoMultipleDuplicates:function(e,t){for(var i={},n=e.nodes,s=n.length,r=0;r<s;r++){var o=n[r];if(o.clonedFromPhysicalid){var a=i[o.clonedFromPhysicalid];if(a){if(o.physicalid!==a){var c=this.getNodeFromPhysicalId(t,o.clonedFromPhysicalid),l=this.getNodeFromPhysicalId(e,a);return this.showMultiDupeErrMsg(c,o,l),!1}}else i[o.clonedFromPhysicalid]=o.physicalid}}return!0},showMultiDupeErrMsg:function(e,t,i){var n=e.Title+" "+e.revision,r=t.Title+" "+t.revision,o=i.Title+" "+i.revision,a="<b>"+n+"</b>",c=s.replace(s.get("multipleDuplicates"),{dupeSource:a});c=(c=(c+="<br>")+"&nbsp;&nbsp;<b>"+r+"</b><br>")+"&nbsp;&nbsp;<b>"+o+"</b><br>",c+=s.pleaseUpdateStruct;this.showError(c,{hasHtml:!0})},onCompleteGetObjectInfo:function(e){var t=this,i=e.expressions;i&&Array.isArray(i)&&i.forEach((function(e){e.name===t.reuseReferenceEnabledExpr&&(t.reuseReferenceEnabled=e.value)})),UWA.Promise.all([this.nextRevInfoPromise,this.reviseAccessInfoPromise]).then((i=>{var n=i[0],s=i[1];n.getNextRev=function(e){return this.addRequests.find((t=>t.copyId===e)).code},s.isLatestRevision=function(e){return this.results.find((t=>t.physicalid===e))["majorid.lastmajorid.bestsofar.physicalid"]===e},s.hasAccess=function(e){return"#DENIED!"!==this.results.find((t=>t.physicalid===e))["majorid.lastmajorid.bestsofar.current.access[majorrevise]"]},s.hasReviseAccess=function(e){return"TRUE"===this.results.find((t=>t.physicalid===e))["majorid.lastmajorid.bestsofar.current.access[majorrevise]"]},s.isConfigured=function(e){return 1==this.results.find((t=>t.physicalid===e)).isConfigured},s.isRevisionable=function(e){var t=this.results.find((t=>t.physicalid===e)),i=t["last.current.majorrevisionable"];return void 0===i&&(i=t["last.current.revisionable"]),"TRUE"===i};var r=e.results,o=t.srcReviseFromTree.getAssembly(),a=t.addObjectInfo(r,o,{addClonedFrom:!0,addFirstRevision:!0,addNextRevision:!1,addIsRevisionable:!1,addLatestRevTitle:!1},n,s);t.srcReviseFromTree.shapeNodes=a.shapeNodes;var c=t.refReviseFromTree.getAssembly();a=t.addObjectInfo(r,c,{addClonedFrom:!1,addFirstRevision:!1,addNextRevision:!0,addIsRevisionable:!0,addLatestRevTitle:!0},n,s),t.refReviseFromTree.shapeNodes=a.shapeNodes;var l=p.getRootOccurenceId(o),d=p.getNodeIdFromOccurenceId(o,l),u=p.getNode(o,d);if(!u.clonedFromPhysicalid){var h=p.getRootOccurenceId(c),v=p.getNodeIdFromOccurenceId(c,h),f=p.getNode(c,v);u.clonedFromPhysicalid=f.physicalid}t.verifyRootIsRevisionable(c)?!0===t.verifyNoMultipleDuplicates(o,c)?(t.resultRevisionCalculated=!0,t.dispatchEvent("ResultRevisionCalculated")):t._onComplete():t._onComplete()}))},createResultTree:function(){var e=this,t=this.refReviseFromTree.getAssembly(),i=this.srcReviseFromTree.getAssembly(),n={uicontroltype:"piecewisecgrviewer",version:2,rootoccurrence:0,nodes:[],occurrences:[],occurrencerelationships:[]},s=function(e){return 1e3*Math.ceil(e/1e3)},r={resOccId:0,resNodeId:0,refOccId:s(t.occurrences.length),refNodeId:s(t.nodes.length),srcOccId:s(i.occurrences.length),srcNodeId:s(i.nodes.length)},o=p.getRootOccurenceId(t),a=p.getRootOccurenceId(i);this.newTreeResult=this.addNode(n,r,t,o,i,a,null,null,null,1),this.srcReviseFromTree.sortOccRelsOnOrder(),this.refReviseFromTree.createAdvancedTree({addActionCol:!1,getChildrenInTreeOrder:!0}),this.refReviseFromTree.hideNodes(this.refReviseFromTree.shapeNodes),this.srcReviseFromTree.createAdvancedTree({addActionCol:!0,getChildrenInTreeOrder:!1}),this.srcReviseFromTree.hideNodes(this.srcReviseFromTree.shapeNodes),this.resReviseFromTree.openAdvancedTree(this.resPanel.elements.content,{addActionCol:!1,getChildrenInTreeOrder:!1},n),this.resReviseFromTree.hideNodes(this.newTreeResult.shapeNodes),this.srcReviseFromTree.addEvent("onDropdownListChange",(function(t){e.resReviseFromTree.storeAllCollapsed();var i=e.refReviseFromTree.getAssemblyHelper(),n=e.srcReviseFromTree.getAssemblyHelper(),s=e.resReviseFromTree.getAssemblyHelper(),r=e.settings.getUseSourceTitle(),o=new Set;t.selNodes.forEach((function(a){var c=a.options.occId,l=n.getOccurence(c),d=s.getNodeIdFromOccurenceId(l.resOccId),u=s.getNode(d),h=l.actionInfo.insertnew,p=t.selOp===y.ActionOption.Revise,v=t.selOp===y.ActionOption.ReviseTree,f=t.selOp===y.ActionOption.InsertNew,m=t.selOp===y.ActionOption.Reuse,g=t.selOp===y.ActionOption.ReuseReference;p||v?(u.revision=u.nextRevision,u.Title=u.latestRevTitle):m?(u.revision=u.currentRevision,h?l.canBeInsertedNew=!0:u.Title=r?u.latestRevTitle:u.currentRevTitle):g&&!h?(u.revision=u.refRevision,u.Title=u.refTitle):f&&(u.revision=u.firstRevision,l.canBeInsertedNew=!1);var R=p?y.ActionOption.Revise:v?y.ActionOption.ReviseTree:m?y.ActionOption.Reuse:g?y.ActionOption.ReuseReference:f?y.ActionOption.InsertNew:null;e.setChildrenToAction(R,i,n,s,c,o),p&&e.srcReviseFromTree.setTreeNodeChildrenToAction(a,t.selOp,t.prevSelOp)})),e.resReviseFromTree.createAdvancedTree({addActionCol:!1,getChildrenInTreeOrder:!1}),e.resReviseFromTree.hideNodes(e.newTreeResult.shapeNodes),e.resReviseFromTree.restoreAllCollapsed(),e.treeSyncMgr.remove(e.resTreeSyncId),e.resTreeSyncId=e.treeSyncMgr.add(e.resReviseFromTree.treeList.tree,!0),e.dispatchEvent("DropDownRebuildComplete")}))},updateInsertNewResNodeForReviseOrReuse:function(e,t,i){var n=p.getNodeIdFromOccurenceId(t,i),s=p.getNode(t,n);this.irpcBehavior||e?(delete s.revision,delete s.Title,delete s.type_icon_url):(s.revision="",s.Title="",s.type_icon_url="");for(var r=p.getChildOccurenceIds(t,i,this.filterDuplicateInstances),o=r.length,a=0;a<o;a++){var c=r[a];this.updateInsertNewResNodeForReviseOrReuse(e,t,c)}},updateExcludeResNodeForReviseOrReuse:function(e,t,i,n,s,r,o){var a=o.resOccId,c=r.getNodeIdFromOccurenceId(a),l=r.getNode(c),d=r.getOccurence(a),u=n.getNodeIdFromOccurenceId(d.refOccId),h=n.getNode(u);this.irpcBehavior?e||t?(o.actionInfo.exclude=!0,o.actionInfo.reuseref=!1,l.revision="",l.Title="",l.type_icon_url=""):(o.actionInfo.exclude=!1,o.actionInfo.reuseref=!0,o.canBeExcluded=!0,l.revision=h.revision,l.Title=h.Title,l.type_icon_url=h.attributes.type_icon_url):e?(delete l.revision,delete l.Title,delete l.type_icon_url):(l.revision=h.revision,l.Title=h.Title,l.type_icon_url=h.attributes.type_icon_url);for(var p=s.getChildOccurenceIds(o.occurrenceid,this.filterDuplicateInstances),v=p.length,f=0;f<v;f++){var m=p[f],g=s.getOccurence(m);this.updateExcludeResNodeForReviseOrReuse(e,t,i,n,s,r,g)}},setChildrenToAction:function(e,t,i,n,s,r){for(var o=this,a=o.settings.getUseSourceTitle(),c=e===y.ActionOption.Revise,l=e===y.ActionOption.ReviseTree,d=e===y.ActionOption.Reuse,u=e===y.ActionOption.ReuseReference,h=e===y.ActionOption.InsertNew,p=i.getNodeIdFromOccurenceId(s),v=i.getChildOccurenceIds(s,this.filterDuplicateInstances),f=v.length,m=e,g=function(e){var v=e.options.occId,f=i.getNodeIdFromOccurenceId(v),g=i.getNode(f),R=i.getOccurence(v);if(r.add(v),R.actionInfo){var I=i.getParentOccurence(v);if(R.actionInfo.exclude||R.canBeExcluded)o.updateExcludeResNodeForReviseOrReuse(c||l,d,u,t,i,n,R);else{var b,T=n.getNodeIdFromOccurenceId(R.resOccId),S=n.getNode(T),C=!1,F=d||u||l;if((d||u)&&R.actionInfo.revise)R.actionInfo.revise=!1,d?(S.revision=S.currentRevision,S.Title=a?S.latestRevTitle:S.currentRevTitle):u&&(S.revision=S.refRevision,S.Title=S.refTitle),R.canBeRevised=!0,g.followsParent?(R.actionInfo.reuse=d,R.actionInfo.reuseref=u):d?R.actionInfo.reuseref=!1:u&&(R.actionInfo.reuseref=!0,R.actionInfo.reuse=!1),I.nodeid!==p&&(d?I.actionInfo.disableReuseref=!0:u&&(I.actionInfo.disableReuse=!0)),C=!0;else if((d||u)&&R.actionInfo.insertnew)S.revision=S.currentRevision,S.currentRevTitle=S.srcTitle,R.actionInfo.insertnew=!1,R.canBeInsertedNew=!0,g.followsParent?(R.actionInfo.reuse=d,R.actionInfo.reuseref=u):d?R.actionInfo.reuseref=!1:u&&(R.actionInfo.reuse=!1,R.actionInfo.reuseref=!0,S.revision="",S.Title="",S.type_icon_url=""),C=!0;else if(d||u)d?(S.revision=S.currentRevision?S.currentRevision:S.revision,S.Title=a?S.latestRevTitle:S.currentRevTitle,S.type_icon_url=S.attributes.type_icon_url):u&&(R.canBeInsertedNew?(R.actionInfo.reuseref=!0,S.revision="",S.Title="",S.type_icon_url=""):(S.revision=S.refRevision,S.Title=S.refTitle)),R.canBeReused=R.actionInfo.reuse,R.actionInfo.reuse=d,R.actionInfo.reuseref=u,I.nodeid!==p&&I.actionInfo.revise&&(d?(I.actionInfo.disableReuseref=!0,I.actionInfo.disableReuse=!1):u&&(I.actionInfo.disableReuseref=!1,I.actionInfo.disableReuse=!0)),C=!0;else if(h&&!R.actionInfo.insertnew&&R.canBeInsertedNew)R.actionInfo.insertnew=!0,R.canBeInsertedNew=!0,R.actionInfo.reuse=!0,R.actionInfo.reuseref=!1,S.revision=S.currentRevision,S.Title=S.currentRevTitle,S.type_icon_url=S.attributes.type_icon_url,F=!0,m=y.ActionOption.InsertNew,g.followsParent&&(R.actionInfo.reuse=!1),C=!0;else if(!c&&!h||R.actionInfo.revise)l&&(R.canBeRevised?(R.actionInfo.revise=!0,R.actionInfo.reuse=!0,R.actionInfo.reuseref=0===I.occurrenceid?R.actionInfo.reuseref:I.actionInfo.reuseref,S.revision=S.nextRevision,S.Title=S.latestRevTitle,g.followsParent&&(R.actionInfo.reuse=!1,R.actionInfo.reuseref=!1)):R.actionInfo.insertnew?R.canBeInsertedNew?F=!1:(R.actionInfo.reuse&&e.dropdownList&&(e.dropdownList.action.selectedIndex=1)&&(e.dropdownListSelectedIndex.action=1),R.canBeInsertedNew=!1,F=!0):R.canBeInsertedNew?(R.actionInfo.insertnew=!0,R.actionInfo.reuse=!0,S.revision=S.currentRevision,S.Title=S.currentRevTitle,S.type_icon_url=S.attributes.type_icon_url,R.actionInfo.reuseref?(e.dropdownList&&(e.dropdownList.action.selectedIndex=1)&&(e.dropdownListSelectedIndex.action=1),R.canBeInsertedNew=!1,R.actionInfo.reuseref=!1):F=!1):R.canBeReused&&(R.actionInfo.insertnew=!1,R.actionInfo.reuse=!0,R.actionInfo.reuseref=!1,S.revision=S.currentRevision,S.Title=a?S.latestRevTitle:S.currentRevTitle),C=!0);else{if(R.canBeRevised||R.canBeInsertedNew||R.canBeReused)(b=e.options.nodeId,o.srcReviseFromTree.getInstances(b).every((function(e){var t=e.getParent();if(t.options.occId===s||t.options.nodeId===p)return!0;var i={occId:t.options.occId},n=t.dropdownListSelectedIndex,r=n?n.action:o.srcReviseFromTree.getDefSelIndex(i);return o.srcReviseFromTree.getOptions(i).options[r]===y.ActionOption.Revise})))&&(R.canBeRevised?(R.actionInfo.revise=!0,R.actionInfo.reuse=!0,R.actionInfo.reuseref=I.actionInfo.reuseref):R.canBeInsertedNew?(F=h||c&&R.actionInfo.reuseref,R.actionInfo.insertnew=!0,R.actionInfo.reuse=!0,R.actionInfo.reuseref=!1,S.revision=S.currentRevision,S.Title=S.currentRevTitle,S.type_icon_url=S.attributes.type_icon_url,m=y.ActionOption.InsertNew):R.canBeReused&&(R.actionInfo.insertnew=!1,R.actionInfo.reuse=!0,R.actionInfo.reuseref=!1,S.revision=S.currentRevision,S.Title=a?S.latestRevTitle:S.currentRevTitle,F=!0,m=y.ActionOption.Reuse),g.followsParent&&(R.actionInfo.reuse=!1,R.actionInfo.reuseref=!1,S.revision=S.nextRevision,S.Title=S.latestRevTitle),I.nodeid!==p&&I.actionInfo.revise&&(I.actionInfo.disableReuseref=!1,I.actionInfo.disableReuse=!1),C=!0)}C&&(F||g.followsParent)&&o.setChildrenToAction(m,t,i,n,v,r)}}},R=0;R<f;R++){var I=v[R];if(!r.has(I)){var b=i.getNodeIdFromOccurenceId(I);this.srcReviseFromTree.getInstances(b).forEach(g)}}},addNode:function(e,t,i,n,s,r,o,a,c,l,d){var u=this.settings.getUseSourceTitle(),h=null,v=null,f={revise:!1,reuse:!1,insertnew:!1,exclude:!1,reuseref:!1},m=d||{shapeNodes:[]};if(null===r){f.exclude=!0;var g={nodeid:t.srcNodeId,physicalid:"0",Title:"",mod:"",type:"",cgrurl:"",attributes:{type_icon_url:""}};s.nodes.push(g),t.srcNodeId=t.srcNodeId+1;var R={occurrenceid:t.srcOccId,nodeid:g.nodeid,actionInfo:f};if(r=t.srcOccId,t.srcOccId=t.srcOccId+1,s.occurrences.push(R),null!==c){var I={parent:c,child:R.occurrenceid,order:l};s.occurrencerelationships.push(I)}null!==a&&(R.refOccRelId=p.getRelationshipId(i,a,n));var b={nodeid:t.resNodeId,physicalid:"0",Title:"",mod:"",type:"",cgrurl:"",attributes:{type_icon_url:""}};if(e.nodes.push(b),t.resNodeId=t.resNodeId+1,(v={occurrenceid:t.resOccId,nodeid:b.nodeid}).refOccId=n,R.resOccId=t.resOccId,h=t.resOccId,t.resOccId=t.resOccId+1,e.occurrences.push(v),null!==o){var T={parent:o,child:v.occurrenceid,order:l};e.occurrencerelationships.push(T)}var S=p.getNodeIdFromOccurenceId(i,n);(C=p.getNode(i,S))&&!0===C.onceInstantiable3DShape&&(m.shapeNodes.push(b.nodeid),this.srcReviseFromTree.shapeNodes.push(g.nodeid)),C&&!UWA.is(C.isExcluded)&&(C.isExcluded=!0)}else{var C;S=p.getNodeIdFromOccurenceId(i,n);(C=p.getNode(i,S)).isExcluded=!1;var F=Object.create(C);F.nodeid=t.resNodeId,e.nodes.push(F);var O={occurrenceid:h=t.resOccId,nodeid:F.nodeid};if(O.refOccId=n,e.occurrences.push(O),t.resNodeId=t.resNodeId+1,t.resOccId=t.resOccId+1,null!==o){var N={parent:o,child:O.occurrenceid,order:l};e.occurrencerelationships.push(N)}var E=p.getNodeIdFromOccurenceId(s,r),D=p.getNode(s,E),A=p.getOccurence(s,r),w=!1,x=!1,P=!1;if(null!==a){var _=p.getNodeIdFromOccurenceId(i,a),k=p.getNode(i,_);k.followsParent&&(C.followsParent=k.followsParent);var L=p.getOccurence(s,c);w=L.actionInfo.reuse&&!L.actionInfo.revise,x=L.actionInfo.reuse&&L.actionInfo.revise&&L.actionInfo.defAction===y.ActionOption.Reuse,P=L.canBeRevised}if(D.followsParent=C.followsParent,D.onceInstantiable3DShape=C.onceInstantiable3DShape,F.currentRevision=this.irpcBehavior?D.revision:F.revision,F.nextRevision=C.nextRevision,F.currentRevTitle=this.irpcBehavior&&!u?D.Title:F.Title,F.latestRevTitle=u?D.Title:C.latestRevTitle,F.refTitle=C.Title,F.refLatestRevTitle=C.latestRevTitle,F.refRevision=C.revision,F.srcTitle=D.Title,F.srcRevision=D.revision,!C.isRevisionable||!C.hasReviseAccess||w&&!P||!this.irpcBehavior&&C.physicalid===D.physicalid)f.reuse=!0,this.irpcBehavior&&(F.revision=D.revision,F.Title=D.Title);else{A.canBeRevised=!0,x||w||(f.revise=!0,C.physicalid===D.physicalid&&(f.defAction=y.ActionOption.Reuse));var j=p.getRootOccurenceId(s);r===j||C.followsParent||(f.reuse=!0),!this.reuseReferenceEnabled||x||w||r===j||C.followsParent||(f.reuseref=!0),!0===f.revise&&f.defAction!==y.ActionOption.Reuse&&(F.revision=F.nextRevision,F.Title=F.latestRevTitle)}A.actionInfo=f,A.resOccId=h,null!==c&&(A.relId=p.getRelationshipId(s,c,r)),null!==a&&(A.refOccRelId=p.getRelationshipId(i,a,n))}var U=p.getChildOccurenceIdsTreeOrder(i,n,this.filterDuplicateInstances),M=U.length,W=[];null!==s&&null!==r&&(W=p.getChildOccurenceIdsTreeOrder(s,r,this.filterDuplicateInstances));for(var H=W.length,B=[],V=0;V<M;V++){for(var G=U[V],q=p.getNodeIdFromOccurenceId(i,G),z=p.getNode(i,q),K=null,J=0;J<H;J++){var X=W[J];if(-1===B.indexOf(X)){var Q=p.getNodeIdFromOccurenceId(s,X),Y=p.getNode(s,Q);if(Y.clonedFromPhysicalid&&Y.clonedFromPhysicalid===z.physicalid||Y.physicalid===z.physicalid){K=X,B.push(K);break}}}var Z=V+1;this.addNode(e,t,i,G,s,K,h,n,r,Z,m),p.setOccurenceRelationshipOrder(i,n,G,Z),null!==K&&(p.setOccurenceRelationshipOrder(s,r,K,Z),this.filterDuplicateInstances&&this.updateMatchingChildOccurrenceData(s,r,K,Z))}var $=B.length;if($<H)for(var ee=M,te=0;te<H;te++){for(var ie=W[te],ne=!1,se=0;se<$;se++){if(ie===B[se]){ne=!0;break}}ne||this.addNodeForInsertNew(i,s,e,t,r,ie,n,h,ee,m)}return F&&F.onceInstantiable3DShape&&m.shapeNodes.push(F.nodeid),m},updateMatchingChildOccurrenceData:function(e,t,i,n){var s=p.getOccurence(e,i);p.getChildOccurenceIds(e,t,!1).forEach((function(r){if(r!==i){var o=p.getOccurence(e,r);o.nodeid===s.nodeid&&(o.actionInfo=s.actionInfo,o.canBeRevised=s.canBeRevised,o.resOccId=s.resOccId,p.setOccurenceRelationshipOrder(e,t,r,n))}}))},addNodeForInsertNew:function(e,t,i,n,s,r,o,a,c,l){var d=this.settings.getUseSourceTitle(),u=p.getNodeIdFromOccurenceId(t,r),h=p.getNode(t,u),v={revise:!1,reuse:!1,insertnew:!0,exclude:!1,reuseref:!1};this.irpcBehavior&&(h.followsParent||(v.reuse=!0),v.defAction=y.ActionOption.InsertNew);var f=p.getOccurence(t,r);f.actionInfo=v,null!==s&&(f.relId=p.getRelationshipId(t,s,r)),c+=1;var m={nodeid:n.refNodeId,physicalid:"0",Title:"",mod:"",type:"",cgrurl:"",attributes:{type_icon_url:""}};e.nodes.push(m),n.refNodeId=n.refNodeId+1;var g={occurrenceid:n.refOccId,nodeid:m.nodeid};if(n.refOccId=n.refOccId+1,e.occurrences.push(g),null!==o){var R={parent:o,child:g.occurrenceid,order:c};e.occurrencerelationships.push(R)}var I=Object.create(h);I.srcTitle=h.Title,I.srcRevision=h.revision;var b=null,T=!1;h.clonedFromPhysicalid&&h.clonedFromPhysicalid.length>0&&(b=p.getNodeFromPhysicalId(e,h.clonedFromPhysicalid)),b?T=!0:b=p.getNodeFromPhysicalId(e,h.physicalid);let S=!1;if(b&&!T){let e=this.srcReviseFromTree.getInstances(u);for(const i of e){let e=i.options.occId;if(e===r)continue;let n=p.getOccurence(t,e);if(n.actionInfo.reuse&&n.actionInfo.defAction===y.ActionOption.Reuse){T=S=!0;break}}}if(this.irpcBehavior)if(b){I.currentRevision=T?h.revision:b.revision,I.nextRevision=b.nextRevision,I.currentRevTitle=T&&!d?h.Title:b.Title,I.latestRevTitle=d?h.Title:b.latestRevTitle,I.refTitle=b.Title,I.refLatestRevTitle=b.latestRevTitle,I.refRevision=b.revision;var C=p.getOccurence(t,s),F=C.actionInfo.reuse&&C.actionInfo.defAction===y.ActionOption.Reuse;T?(S?(I.revision=b.revision,I.Title=b.Title,f.actionInfo.defAction=y.ActionOption.Reuse):(I.revision=b.nextRevision,I.Title=d?h.Title:b.latestRevTitle),f.insertedInstance=!0,f.actionInfo.insertnew=!1,f.actionInfo.revise=!0,f.actionInfo.reuse=!b.followsParent,f.actionInfo.reuseref=!(b.followsParent||!this.reuseReferenceEnabled)):f.actionInfo.reuse&&(I.revision=b.revision,I.Title=b.Title,F&&(f.actionInfo.insertnew=!1,f.canBeInsertedNew=!0),f.actionInfo.defAction=y.ActionOption.Reuse)}else I.currentRevision=I.revision,I.firstRevision=h.firstRevision,I.revision=I.firstRevision;I.nodeid=n.resNodeId,i.nodes.push(I);var O={occurrenceid:n.resOccId,nodeid:I.nodeid};if(O.refOccId=g.occurrenceid,i.occurrences.push(O),f.resOccId=n.resOccId,n.resNodeId=n.resNodeId+1,n.resOccId=n.resOccId+1,null!==a){var N={parent:a,child:O.occurrenceid,order:c};i.occurrencerelationships.push(N)}h.onceInstantiable3DShape&&(I.onceInstantiable3DShape=m.onceInstantiable3DShape=h.onceInstantiable3DShape,l.shapeNodes.push(I.nodeid),this.refReviseFromTree.shapeNodes.push(m.nodeid)),p.setOccurenceRelationshipOrder(t,s,r,c),this.filterDuplicateInstances&&this.updateMatchingChildOccurrenceData(t,s,r,c);for(var E=p.getChildOccurenceIdsTreeOrder(t,r,this.filterDuplicateInstances),D=E.length,A=0;A<D;A++){var w=E[A];this.addNodeForInsertNew(e,t,i,n,r,w,g.occurrenceid,O.occurrenceid,c,l)}},_renderDuplicateTree:function(e,t){this.srcReviseFromTree=new h([e],this.tenant,this.context,this.filterDuplicateInstances),this.srcReviseFromTree.addEvent("onTreeCreated",this._handleSrcTreeCreated.bind(this)),this.srcReviseFromTree.openAdvancedTree(t,{addActionCol:!0,getChildrenInTreeOrder:!0,filter3DShapes:!0})},_expandSourceContainer:function(){this.resPanel.hide(),this.refPanel.collapse(),this.refPanel.setUICollapseable(!1),this.srcPanel.setUICollapseable(!1),this.srcPanel.maximize()},_restoreSourceContainer:function(){this.resPanel.show(),this.refPanel.expand(),this.refPanel.setUICollapseable(!0),this.srcPanel.setUICollapseable(!0),this.srcPanel.restore()},_renderSelectionList:function(e,t){var i=this,n=null;this._expandSourceContainer();var r=a.get3DSpaceBaseUrl(i.tenant);document.body.style.cursor="wait";require(["DS/ReviseFromWidget/PickDialog/PickDialog","i18n!DS/ReviseFromWidget/assets/nls/PickDialog"],(function(o,a){var c=a.noRevision,l=a.noAlternateDesign;a.noRevision=s.noRevisions,a.noAlternateDesign=s.noDuplicates,document.body.style.cursor="default",n=new o(e,t,r,"passport",!i.irpcBehavior),i.onCompleteFnArr.push((function(){a.noRevision=c,a.noAlternateDesign=l}));var d=widget.getValue(i.activePDTabNameWidgetPref);if(d||(d="historyGraphFacet"),null===i.pickDialog){var u={physicalid:i.physicalIds[0]};n.load(u,(function(t){var n=e.getElement(i.activePDTabElPath);n&&(i.activePDTabName=n.dataset.name),i._restoreSourceContainer(),i._renderDuplicateTree(t.physicalid,e)}),d,!i.irpcBehavior,i.irpcBehavior?"all":"direct",i.irpcBehavior?"all":"derivedFrom",i.context,i.tenant,!0,!0),i.pickDialog=n}}),(function(e){document.body.style.cursor="default",i.showError(s.commandNotSupported),i._onComplete()}))},clone:function(e){return JSON.parse(JSON.stringify(e))},addRelationsAndAppendInstances:function(e,t,i,n){i.sort(),n.sort();for(var s=Math.max(i.length,n.length),r=0;r<s;++r){var o=t;r>0&&(o=this.clone(t),e.push(o)),o.rel_physicalid=i.length>r?i[r]:null,o.rel_physicalid_dup=n.length>r?n[r]:null}},attachRelationships:function(e){for(var t=e.length,i=0;i<t;++i){var n=p.getNodeFromPhysicalId(this.refReviseFromTree.assembly,e[i].physicalid),s=p.getNodeFromPhysicalId(this.srcReviseFromTree.assembly,e[i].physicalid_dup);if(e[i].hasOwnProperty("children"))for(var r=e[i].children.length,o=0;o<r;++o){var a=p.getNodeFromPhysicalId(this.refReviseFromTree.assembly,e[i].children[o].physicalid),c=p.getNodeFromPhysicalId(this.srcReviseFromTree.assembly,e[i].children[o].physicalid_dup),l=[],d=[];null!==n&&null!==a&&(l=p.getRelationships(this.refReviseFromTree.assembly,n.nodeid,a.nodeid)),null!==s&&null!==c&&(d=p.getRelationships(this.srcReviseFromTree.assembly,s.nodeid,c.nodeid)),this.addRelationsAndAppendInstances(e[i].children,e[i].children[o],l,d)}}},updateTitleInResultAssembly:function(){n.mask(this.resPanel.elements.contentContainer);var e=this.resReviseFromTree.getAssembly();this.resReviseFromTree.storeAllCollapsed();var t=this.settings.getUseSourceTitle();e.nodes.forEach((function(e){if(e.Title&&e.currentRevTitle&&e.latestRevTitle&&e.Title.length>0){var i=e.Title==e.latestRevTitle,n=e.Title==e.refTitle,s=!t&&i&&e.currentRevision==e.revision,r=n&&e.revision==e.refRevision,o=e.currentRevTitle;e.currentRevTitle=e.latestRevTitle,e.latestRevTitle=o,r||(e.Title=s?e.currentRevTitle:e.latestRevTitle)}})),this.resReviseFromTree.createAdvancedTree({addActionCol:!1,getChildrenInTreeOrder:!1}),this.resReviseFromTree.hideNodes(this.newTreeResult.shapeNodes),this.resReviseFromTree.restoreAllCollapsed(),this.treeSyncMgr.remove(this.resTreeSyncId),this.resTreeSyncId=this.treeSyncMgr.add(this.resReviseFromTree.treeList.tree,!0)},createNewRevision:function(){var e={};e.data=this.srcReviseFromTree.getNewRevFromData(!this.filterDuplicateInstances,this.irpcBehavior,this.settings.getUseSourceTitle()),e.folderid=this.folderId,this.filterDuplicateInstances&&this.attachRelationships(e.data[0].treeData),document.body.style.cursor="wait",this.commandDialog&&this.commandDialog.maskBody(s.revisingText),this.controller.createNewRevisionFrom(e,this.trackerEvent)},showNotification:function(e,t){if("function"==typeof this.context.displayNotification){var i={eventID:"string"==typeof t.type?t.type:"primary",msg:e,sticky:t.sticky||!1,hasHtml:t.hasHtml||!1};this.context.displayNotification(i)}else alert(e)},showError:function(e,t){if(t=t||{},"function"==typeof this.context.displayNotification){var i={eventID:"error",msg:t.title||t.subtitle?t.submessage:e,title:t.title,subtitle:t.subtitle,sticky:t.sticky||!1,hasHtml:t.hasHtml||!1};this.context.displayNotification(i)}else alert(e)},_displayNotification:function(e){c.displayNotification(e)},showSettings:function(e){var t=this,i=this.settings.getUseSourceTitle(),n=this.settings.getShowWarningNoRevise();this.settings.showPreferencesDlg({onOk:function(e){t.resTreeSyncId&&(e.getUseSourceTitle()!=i&&t.updateTitleInResultAssembly(),n!=e.getShowWarningNoRevise()&&(t.everythingIsRevisionable=t.verifyEverythingIsRevisionable(),t.commandDialog&&t.commandDialog.updateUI()))},onShow:e&&e.onShow?e.onShow:null})},launchReportingPanel:function(e){var t=[];e.forEach((function(e){var i=[];i.push(e.latestPhysicalid?e.latestPhysicalid:e.physicalid),i.push(s.deleteFailedShort),i.push("Failed"),i.push(e.bsfRevTitle?e.bsfRevTitle:e.Title),i.push(e.displayType?e.displayType:e.type),i.push(e.latestRevision?e.latestRevision:e.revision);var n,r="";e.attributes&&e.attributes.locker&&(r=e.attributes.locker),i.push(r),n=e.isRevisionable?"noReviseAccess":"cannotBeRevised";var o=s.replace(s.get(n),{dispName:e.latestRevTitle?e.latestRevTitle:e.Title});i.push(o),t.push(i)}));var i=[{text:"ID",dataIndex:"ID",isHidden:!0},{text:"StatusToolTipColumn",dataIndex:"statusTooltip",isHidden:!0,tooltipColumn:"Status"},{text:s.status,dataIndex:"Status",typeRepresentation:"icon"},{text:s.title,dataIndex:"Title"},{text:s.type,dataIndex:"Type"},{text:s.revision,dataIndex:"Revision"},{text:r.getAttributeDisplayName("locker"),dataIndex:"Locker"},{text:s.message,dataIndex:"Message"}];I.launchReportingPanel(t,i,null)}})}));