define("DS/ENODOGridColumn/utils/Constants",["UWA/Core","UWA/Controls/Abstract"],(function(t,e){"use strict";return{EMPTY_JSON_OBJECT:{},PLATFORM_SERVICES:"platformServices",PLATFORM_ID:"platformid",SEC_CTX:"xPref_CREDENTIAL",URL_3DSPACE:"url3dspace",URL_3DCOMPASS:"url3dcompass",CADORIGIN_CATIAV5:"CATIAV5",CADORIGIN_3DEXP:"3DEXPERIENCE",STATUS_JOBFAIL:"JobFail",STATUS_UNSYNC:"Unsync",STATUS_NA:"NA",PSE_CONTEXT_REFRESH:"SyncModelRefresh"}})),define("DS/ENODOGridColumn/cmd/DOModelEvents",["DS/CoreEvents/ModelEvents"],(function(t){"use strict";var e=new t;return{getModelEvents:function(){return e},publish:function(t){return e.publish(t)},subscribe:function(t,n){return e.subscribe(t,n)},unsubscribe:function(t){return e.unsubscribe(t)},unsubscribeAll:function(t){return e.unsubscribeAll(t)}}})),define("DS/ENODOGridColumn/utils/DONotification",["DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],(function(t,e){"use strict";return{_notif_manager:null,init:function(n){null===this._notif_manager&&(this._notif_manager=t,e.setNotificationManager(this._notif_manager),e.setStackingPolicy(5),e.setRemoveStackOnFirstTimeoutFlag(!0),e.setFadeOutPolicy(2))},sucessMsg:function(t){this._notif_manager||this.init(),this._notif_manager.addNotif({level:"success",message:t,sticky:!1})},infoMsg:function(t){this._notif_manager||this.init(),this._notif_manager.addNotif({level:"info",message:t,sticky:!1})},warningMsg:function(t){this._notif_manager||this.init(),this._notif_manager.addNotif({level:"warning",message:t,sticky:!1})},errorMsg:function(t){this._notif_manager||this.init(),this._notif_manager.addNotif({level:"error",message:t,sticky:!1})}}})),define("DS/ENODOGridColumn/utils/SettingsManagement",["UWA/Class","DS/ENODOGridColumn/utils/Constants"],(function(t,e){"use strict";return t.singleton({init:function(){this.isPlatformInitialized=!0},addSetting:function(t,e){if(!this.isPlatformInitialized)throw new Error("Platformservices not initialized");widget[t]&&console.log("Setting is already in use"),widget[t]=e},getSetting:function(t){return widget[t]||""},getPlatformURLs:function(){return this.getSetting(e.PLATFORM_SERVICES)},getPlatformId:function(){return this.getSetting(e.PLATFORM_ID)},getSecCtx:function(){var t=this.getSetting(e.SEC_CTX);return t.startsWith("ctx::")||(t="ctx::"+t),t=encodeURIComponent(t)},get3DSpaceURL:function(){return this.getSetting(e.URL_3DSPACE)},get3DCompassURL:function(){return this.getSetting(e.URL_3DCOMPASS)},getLang:function(){return"undefined"!=typeof widget?widget.lang:"en"},getWidgetId:function(){return"undefined"!=typeof widget?widget.id:-1}})})),define("DS/ENODOGridColumn/DOWSProxy",["UWA/Core","DS/WAFData/WAFData","DS/ENODOGridColumn/utils/SettingsManagement"],(function(t,e,n){let o=function(t){try{return JSON.parse(t),!0}catch(t){return!1}},a=function(t,n,a){return new Promise((function(i,s){n.onComplete=function(t){let e=function(t){return o(t)&&"string"==typeof t?JSON.parse(t):t}(t),n=e;a&&"savePref"!=a&&(n=a(e)),i(n)},n.onFailure=function(t){s(t)},n.data&&(n.data=JSON.stringify(n.data)),a&&"savePref"==a&&(n.data=JSON.parse(n.data)),function(t,n,o){let a=null;a=e.authenticatedRequest(t,n)}(t,n)}))};return{getAdditionalCtxMenu:function(){let t=n.get3DSpaceURL(),e=n.getSecCtx(),o={};return t+="/resources/v1/derivedoutput/derivedoutputrules/getconversionformats",o.method="GET",o.headers={Accept:"application/json",SecurityContext:e},a(t,o)},getDOStatus:function(t){console.log("---DOStatus calling getDOStatus WS.......");let e=n.get3DSpaceURL(),o=n.getSecCtx(),i={};return e=e+"/resources/PLMDerivedOutputWSAPI/derivedoutputonIndex_services/getDOStatusForRep?tenant="+n.getPlatformId(),i.type="json",i.proxy="passport",i.method="POST",i.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:o},i.data={ids:t.ids,format:t.format,withjobs:!0},a(e,i)},getDOStatistic:function(t){console.log("---DOStatus calling getDOStatistic WS.......");let e=n.get3DSpaceURL(),o=n.getSecCtx(),i={};return e=e+"/resources/PLMDerivedOutputWSAPI/derivedoutputonIndex_services/getNodeSynchroStatistics?tenant="+n.getPlatformId(),i.type="json",i.proxy="passport",i.method="POST",i.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:o},i.data={selection:{path:t.occurrencepath,filter:t.hasOwnProperty("filter")?t.filter:{}},format:t.format},a(e,i)},saveDOFormatPreference:function(t){var e=n.get3DCompassURL()+"/resources/AppsMngt/user/preference",o={method:"PUT",mustEmbedInBody:!0,onComplete:function(t){},onFailure:function(t){console.log("Error = "+t)}};return o.data=t.data,o.headers={Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"},a(e,o,"savePref")},getDOFormatPreference:function(){var t={},e=n.get3DCompassURL()+"/resources/AppsMngt/user/getPreferences";return e+="?name=FormatDOStatusColumn",t.method="GET",t.onComplete=function(t){},t.onFailure=function(t){console.log("Error = "+t)},t.headers={Accept:"application/json"},a(e,t)}}})),define("DS/ENODOGridColumn/utils/PlatformServices",["UWA/Class","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/ENODOGridColumn/utils/SettingsManagement","DS/ENODOGridColumn/utils/Constants","DS/WAFData/WAFData"],(function(t,e,n,o,a){"use strict";return t.extend({initializePlatform:function(t){var a=this;e.getPlatformServices({onComplete:function(e){if(null===e){e.options=t,(0,t.onFailure)("cannot retrieve platform data")}else{var i=o.EMPTY_JSON_OBJECT,s="OnPremise";null!=widget.getValue&&(s=widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise");for(var r=0;r<e.length;r++)e[r].platformId===s&&(a.platformurls=i.platformurls=e[r]);n.addSetting(o.PLATFORM_SERVICES,a),n.addSetting(o.PLATFORM_ID,s);let l=i.platformurls["3DSpace"],c=i.platformurls["3DCompass"];n.addSetting(o.URL_3DSPACE,l),n.addSetting(o.URL_3DCOMPASS,c),i.options,(0,t.onComplete)(i)}},onFailure:function(e){(0,t.onFailure)(e)}})},setSecurityContext:function(){let t=n.get3DSpaceURL()+"/resources/pno/person/getsecuritycontext?tenant="+n.getPlatformId();return new Promise((function(e,i){a.authenticatedRequest(t,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"GET",onComplete:function(t){var a=JSON.parse(t);if(a&&a.SecurityContext){let e=a.SecurityContext,n="";0!==e.indexOf("ctx::")&&(n="ctx::"),t=n+e}else t=widget.getValue("pad_security_ctx");n.addSetting(o.SEC_CTX,t),e(t)},onFailure:function(t){console.log("Get SecurityContext Error"+t),i(t)}})}))},get3DSpaceURL:function(){return this.getURL("3DSpace")},getURL:function(t){return this.platformurls[t]||""}})})),define("DS/ENODOGridColumn/AdditionalColumns",["i18n!DS/ENODOGridColumn/assets/nls/ENODOStatus.json","UWA/Core","UWA/Class","DS/PADUtils/PADContext","DS/ENODOGridColumn/utils/PlatformServices","DS/ENODOGridColumn/DOWSProxy","DS/WebappsUtils/WebappsUtils","DS/ENODOGridColumn/cmd/DOModelEvents","DS/ENODOGridColumn/utils/Constants","css!DS/ENODOGridColumn/ENODOGridColumn"],(function(t,e,n,o,a,i,s,r,l){"use strict";return n.singleton({_columnDataIndex:["hasDO"],_columnDefDGV:{hasDO:{dataIndex:"hasDO",alignmentValue:"center",editableFlag:!1,sortableFlag:!1,width:50,minWidth:50,visibleFlag:!1,isAdditionalColumn:!0,_selectedFormat:null,formatAndNls:null,_processedPids:null,_widgetFormatPreference:null,_localFormatPreference:null,getCellTypeRepresentation:function(t){if(t.nodeModel){let e=t.nodeModel.options.grid.hasDO;if(void 0===e||""===e)return"status_LOADING";return"status_"+e}},getCellSemantics:function(t){if(t.nodeModel){let e=t.nodeModel.options.grid.hasDO;if(void 0===e||""===e||"INTERMEDIATE"!==e)return{disabled:!0}}},getCellValueForExport:function(e){let n="";if(-1===e.rowID)n=e.cellModel;else if(e&&e.nodeModel&&e.nodeModel.options.grid&&e.nodeModel.options.grid.hasDO){let o="status_"+e.nodeModel.options.grid.hasDO,a=e.nodeModel.options.grid.hasDONewnls;n=null!=a?""+a:""+t[o]}return n},customisation:{dataIndex:"hasDO",exportable:{lock:!1,value:!1},layout:{removable:!1}}}},init:function(e){this._parent(e);var n=this;n._processedPids=[],r.subscribe({event:"updateHasDOcolumnName"},(function(e){var a=o.get();if(a){var s=a.getPADTreeDocument(),r=a.options.views?a.options.views.datagridview:void 0;if(r&&!r.isColumnHidden("hasDO")){let o=n.formatAndNls.find((t=>t.format===e));n._selectedFormat!==o.format&&(n._selectedFormat=o.format,widget.setValue("formatForDOColumn",n._selectedFormat),localStorage.setItem("formatForDOColumn",n._selectedFormat),i.saveDOFormatPreference({data:{name:"FormatDOStatusColumn",value:n._selectedFormat}}).then((function(t){console.log("Response of save ",t)})),r.changeColumnTitle("hasDO",t.hasDO+"["+o.nls+"]"),r.hideColumn("hasDO"),r.showColumn("hasDO"),n._processedPids.forEach((function(t){let e=s.getNodesById(t);0==e.length?n._processedPids.splice(n._processedPids.indexOf(t),1):e.forEach((function(t){t.updateOptions({grid:{hasDO:"LOADING"}})}))})),n.updateAttributes({pids:n._processedPids,relids:[]},(function(t){n._processedPids.forEach((function(e){null!=t.pids[e]&&s.getNodesById(e).forEach((function(n){n.updateOptions({grid:{hasDO:t.pids[e].hasDO,hasDONewnls:t.pids[e].hasDONewnls}})}))}))})))}}}))},updateHasDoCellValue_bis:function(t){this._processedPids.forEach((function(e){if(null!=t.pids[e]){model.getNodesById(e).forEach((function(n){n.updateOptions({grid:{hasDO:t.pids[e].hasDO,hasDONewnls:t.pids[e].hasDONewnls}})}))}}))},isAdditionalColumnsAvailable:function(t){var e=this;if(console.log("DO status--isAdditionalColumnAvailable Enter--\x3e"),"function"!=typeof t)throw new Error("A callback function should be defined");const n=new a;new Promise((function(t,e){var o={onComplete:t,onFailure:e};n.initializePlatform(o)})).then((function(t){return n.setSecurityContext()}),(function(t){console.log(t)})).then((function(n){i.getAdditionalCtxMenu().then((function(n){if(console.log("WS Results->"+n),n.derivedOutputFormats.length>0){let o;t(!0),e.formatAndNls=[];try{o=widget.getValue("formatForDOColumn")}catch(t){console.error("Error fetching formatForDOColumn:",t)}e._widgetFormatPreference=o||"undefined",e._localFormatPreference=localStorage.getItem("formatForDOColumn"),e._widgetFormatPreference&&e._localFormatPreference&&e._widgetFormatPreference===e._localFormatPreference||i.getDOFormatPreference().then((function(t){t&&(e._selectedFormat=t,widget.setValue("formatForDOColumn",e._selectedFormat),localStorage.setItem("formatForDOColumn",e._selectedFormat),e._widgetFormatPreference=widget.getValue("formatForDOColumn"),e._localFormatPreference=localStorage.getItem("formatForDOColumn"))}));const a=new Set;n.derivedOutputFormats.forEach((function(t){if(!a.has(t.outputStreamId)){a.add(t.outputStreamId);var n=t.outputStreamId;"ExactGeometry"==t.format&&(t.outputStreamId=t.outputStreamId+" ("+t.format+")"),e.formatAndNls.push({format:n,nls:t.outputStreamId}),e._widgetFormatPreference==e._localFormatPreference&&t.format==e._localFormatPreference&&(e._selectedFormat=e._localFormatPreference)}})),null!=e._selectedFormat&&null!=e._localFormatPreference||(e._selectedFormat=e.formatAndNls[0].format)}else t(!1)})).catch((function(e){console.error(e),t(!1)}))}))},getName:function(){return"ENODOFormatStatus_Col"},_getColumnName:function(){var e;this._widgetFormatPreference&&this._localFormatPreference&&this._widgetFormatPreference==this._localFormatPreference?e=this._widgetFormatPreference:i.getDOFormatPreference().then((function(t){t&&(e=t)}));var n=t.hasDO+"["+this.formatAndNls[0].nls+"]";return null!==e&&this.formatAndNls.forEach((function(o){var a=o.format;console.log(a),o.format===e&&(n=t.hasDO+"["+o.nls+"]")})),n},getManagedColumnNames:function(){return this._columnDataIndex},getAutoReloadNames:function(){let t=[];return t.push("ds6w:cadMaster"),t},toBeUpdated:function(t,e){let n=!1,o=t.hasDO;return e!==l.PSE_CONTEXT_REFRESH&&void 0!==o&&""!==o||(n=!0),n},updateAttributes:function(t,e){console.log("DO Status-updateAttrs Entry--\x3e");var n=this;if("object"!=typeof t)throw new Error("The object ids to modify must be specify");if("function"!=typeof e)throw new Error("A callback function should be defined");var o={pids:{},relids:{}};t.pids.forEach((function(t){n._processedPids.includes(t)||n._processedPids.push(t),o.pids[t]={hasDO:void 0,hasDONewnls:void 0}})),null!=n._selectedFormat&&i.getDOStatus({ids:t.pids,format:n._selectedFormat}).then((function(n){console.log("DO status WS Results->"+n);let a=new Map;n.ids.forEach((function(t){let e,n=t.id;t.streams.forEach((function(t){e=t.status})),a.set(n,e)})),t.pids.forEach((function(t){let e="";a.has(t)&&(e=a.get(t)),o.pids[t]={hasDO:e}})),e(o)})).catch((function(n){console.error(n),t.pids.forEach((function(t){o.pids[t]={hasDO:"ERROR"}})),e(o)}))},getAdditionalColumnsUXDGV:function(t){let n=[];for(let e=0;e<t.length;e++)n.push(t[e].dataIndex);for(let o=0;o<this._columnDataIndex.length;o++){let a=this._columnDataIndex[o],i=e.clone(this._columnDefDGV[a]),s=n.indexOf(a);-1===s?(i.text=this._getColumnName(),t.push(i)):(t[s]=e.extend(t[s],i,!0),t[s].text=this._getColumnName())}},provideDisplayTooltip:function(e){let n=null;if(e.nodeModel&&"hasDO"===e.dataIndex){let o=e.nodeModel.options.grid.hasDO;if(""!=o&&"NA"!=o){let a="status_"+o,i=e.nodeModel.options.grid.hasDONewnls;n=null!=i?""+i:""+t[a]}}return n},getTypeRepresentations:function(){return{status_SYNC:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"status-ok dgv-hasDO-status-ok",fontIconFamily:WUXManagedFontIcons.Font3DS}}},status_NOTSYNC:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"status-ko dgv-hasDO-status-ko",fontIconFamily:WUXManagedFontIcons.Font3DS}}},status_JOBSUBMITTED:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"hourglass dgv-hasDO-hourglass",fontIconFamily:WUXManagedFontIcons.Font3DS}}},status_JOBRUNNING:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"clock dgv-hasDO-clock",fontIconFamily:WUXManagedFontIcons.Font3DS}}},status_JOBFAILED:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"attention dgv-hasDO-attention",fontIconFamily:WUXManagedFontIcons.Font3DS}}},status_INTERMEDIATE:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"i-question",fontIconFamily:WUXManagedFontIcons.Font3DS}}},status_NA:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"",fontIconFamily:WUXManagedFontIcons.Font3DS}}},status_LOADING:{stdTemplate:"functionIcon",semantics:{className:"relationRefresh",icon:{iconName:"reload wux-ui-3ds-spin dgv-hasDO-reload",fontIconFamily:WUXManagedFontIcons.Font3DS}}},status_ERROR:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"attention dgv-hasDO-attention",fontIconFamily:WUXManagedFontIcons.Font3DS}}}}},getOnCellClickCB:function(e){var n=this;if(0===this._columnDataIndex.indexOf(e))return function(e){if(e.nodeModel&&"INTERMEDIATE"===e.nodeModel.options.grid.hasDO){e.nodeModel.updateOptions({grid:{hasDO:""}});var a=e.nodeModel,s=e.nodeModel.getOccurencePath(),r=a.getRoot().getID(),l=o.get(),c={};if(l.GetFilterSpec){var u=n.prefixPath([s]);c=l.GetFilterSpec(r,{V2:{prefixPathArray:u}}).filter}i.getDOStatistic({occurrencepath:e.nodeModel.getOccurencePath(),format:n._selectedFormat,filter:c}).then((function(n){console.log("DO Statistic status WS Results->"+n);let o=n.sync_do_count,a=n.rep_count,i="SYNC";(0==o&&0==a||o!=a)&&(i="NOTSYNC");let s=t.replace(t.nls_nonleaf,{syncDo:o,leafnumber:a});e.nodeModel.updateOptions({grid:{hasDO:i,hasDONewnls:s}}),e.cellView._updateTooltip({longHelp:s})})).catch((function(t){console.error(t)}))}}},prefixPath:function(t){return t.map((t=>({physical_id_path:t})))},getAdditionalCtxMenu:function(e){let n,o=!1;e.ctxParams.treeview?(o=e.ctxParams.treeview.isHeader,n=e.ctxParams.treeview.dataIndex):"datagridview"===e.view&&(o=-1===e.ctxParams.cellInfos.rowID,n=e.ctxParams.collectionView.getColumnOrGroup(e.ctxParams.cellInfos.columnID).dataIndex);let a=[];if(!0===o&&"hasDO"===n){a={type:"PushItem",icon:{iconName:"list",fontIconFamily:WUXManagedFontIcons.Font3DS},title:t.select_format,submenu:[]};for(let t=0;t<this.formatAndNls.length;t++){let e=this.formatAndNls[t];a.submenu.push({type:"RadioItem",title:e.nls,state:e.format===this._selectedFormat?"selected":"",action:{context:e.format,callback:function(t){r.publish({event:"updateHasDOcolumnName",data:t.context})}}})}e.callback("cmdReqDOStatus",a)}else e.callback(null)}})}));