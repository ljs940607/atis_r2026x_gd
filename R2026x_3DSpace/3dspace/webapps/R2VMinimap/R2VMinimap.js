define("DS/R2VMinimap/R2VMinimapServices",["DS/WAFData/WAFData"],(function(i){"use strict";const t="/enovia/resources/r2v/modeler/v2";function e(i){this.options=i||{},this.options=Object.assign({isInitialize:!1,subs:[]},this.options),this.assets={},this.tileSets={},this.acquisitionPoints={},this.minimapActivity=null,this.minimapInfo={}}function n(i){return"string"==typeof i&&"{"===i.charAt(0)?JSON.parse(i):i}return e.prototype.initialize=async function(i){void 0===i&&reject("R2VMinimapServices## Activity Id not set"),this.options.r2vsurveyURL=await i.getURL("r2vsurvey");let e=i.psId,n=this.options.r2vsurveyURL+`${t}/ingest/${e}/assets`,o={method:"GET",headers:{"Content-Type":"application/json"}};try{this.assets=JSON.parse(await this.__executeRequest(n,o))}catch(i){console.error("Error in assets retrieving:",i)}const s=this.__getPointCloudId();if(null!==s&&s.length>0){const i=this.options.r2vsurveyURL+`${t}/featureofinterest/${s}/activities?type=MINIMAP&status=RELEASE`;o={method:"GET",headers:{"Content-Type":"application/json"}};try{let t=await this.__executeRequest(i,o);null!=t&&t.result.length>0&&(this.minimapActivity=t.result[0])}catch(i){console.error("Error in getting minimap activity:",i)}if(null!=this.minimapActivity){const i=this.options.r2vsurveyURL+`${t}/activity/${this.minimapActivity.resourceid}/samples`;o={method:"GET",headers:{"Content-Type":"application/json"}};try{let t=JSON.parse(await this.__executeRequest(i,o));t.length>0&&(this.minimapInfo=t[0])}catch(i){console.error("Error in getting minimap info:",i)}}}let a=this.options.r2vsurveyURL+`${t}/ingest/${e}/tileset`;o={method:"GET",headers:{"Content-Type":"application/json"}};try{this.tileSets=(await this.__executeRequest(a,o)).tileSets}catch(i){console.error("Error in tileSets retrieving:",i)}if(this.hasAcquisitionPoints())for(let i=0;i<this.tileSets.length;i++)if("360"==this.tileSets[i].contentTypes[0]){let t=this.tileSets[i].baseTileURL+this.tileSets[i].rootURI;o={method:"GET",headers:{"Content-Type":"application/json"}};try{let i=JSON.parse(await this.__executeRequest(t,o));for(let t=1;t<i.length;++t){let e=i[t].json.matrix,n=e[12],o=e[13],s=e[14],a={};a.x=n,a.y=o,a.z=s;let r=this.getPositionOnMinimap(a),h="floor"+r.idLevel;this.acquisitionPoints.hasOwnProperty(h)||(this.acquisitionPoints[h]=[]);let p=this.acquisitionPoints[h].length+1,m={};m.id=p,m.coord=r.pointInMap,m.color="#EA4F37",this.acquisitionPoints[h].push(m)}}catch(i){console.error("Error while retrieving acquisitions points",i)}}this.options.isInitialize=!0},e.prototype.hasMinimap=function(){return null!==this.minimapInfo&&"object"==typeof this.minimapInfo&&Object.keys(this.minimapInfo).length>0},e.prototype.__getPointCloudId=function(){let i="";for(let t=0;t<this.assets.length;t++){let e=this.assets[t];if("PointCloud"==e.type){i=e.resourceid;break}}return i},e.prototype.hasAcquisitionPoints=function(){let i=!1;for(let t=0;t<this.assets.length;t++){let e=this.assets[t];if("360Image"==e.type||"Image360"==e.type){i=!0;break}}return i},e.prototype.getNumberOfLevel=function(){return!0!==this.options.isInitialize&&console.warn("R2VMinimapServices## Not initialize"),this.minimapInfo.floorNumbers},e.prototype.getInformationForLevel=function(i){let t="floor"+i;return{id:i,url:this.minimapInfo.colorUrls[i],acquisitionPoints:this.acquisitionPoints[t]}},e.prototype.getPositionOnMinimap=function(i){if(null==i||0==Object.keys(this.minimapInfo).length)return{idLevel:0,pointInMap:{x:Math.floor(this.minimapInfo.width/2),y:Math.floor(this.minimapInfo.height/2)}};let t=i.x,e=i.y,n=i.z,o=this.minimapInfo.width,s=this.minimapInfo.height,a=Math.floor(o*(t-this.minimapInfo.bboxMinX)/(this.minimapInfo.bboxMaxX-this.minimapInfo.bboxMinX)),r=Math.floor(s*(e-this.minimapInfo.bboxMinY)/(this.minimapInfo.bboxMaxY-this.minimapInfo.bboxMinY));a<0?a=0:a>o&&(a=o-1),r<0?r=0:r>s&&(r=s-1);let h=0;for(var p=this.minimapInfo.minHeights.length-1;p>=0;p--)if(n>this.minimapInfo.minHeights[p]){h=p;break}return{idLevel:h,pointInMap:{x:a,y:r}}},e.prototype.getViewpointFromPosition=function(i,t,e){var n={};return n.x=this.minimapInfo.bboxMinX+t/this.minimapInfo.width*(this.minimapInfo.bboxMaxX-this.minimapInfo.bboxMinX),n.y=this.minimapInfo.bboxMinY+e/this.minimapInfo.height*(this.minimapInfo.bboxMaxY-this.minimapInfo.bboxMinY),n.z=this.minimapInfo.maxHeights[i],n},e.prototype.__executeRequest=async function(t,e){return new Promise(((o,s)=>{e.onComplete=function(i){var t={success:!0};i&&(t=n(i)),o(t)},e.onFailure=function(i,t){t&&(t=n(t)),s(t)},e.onTimeout=function(i,t){t&&(t=n(t)),s(t)},"POST"!==e.method||"string"==typeof e.data||e.data instanceof Blob||e.data instanceof FormData||(e.data=JSON.stringify(e.data)),i.authenticatedRequest(t,e)}))},e})),define("DS/R2VMinimap/R2VMinimapServicesV2",["DS/WAFData/WAFData"],(function(i){"use strict";const t="/enovia/resources/r2v/modeler/v2";function e(i){this.options=i||{},this.options=Object.assign({isInitialize:!1,subs:[]},this.options),this.assets={},this.tileSets={},this.acquisitionPoints={},this.minimapActivity=null,this.minimapInfo={}}function n(i){return"string"==typeof i&&"{"===i.charAt(0)?JSON.parse(i):i}return e.prototype.initialize=async function(i){void 0===i&&reject("R2VMinimapServices## Activity Id not set"),this.options.r2vsurveyURL=await i.getURL("r2vsurvey");let e=i.psId,n=this.options.r2vsurveyURL+`${t}/ingest/${e}/assets`,o={method:"GET",headers:{"Content-Type":"application/json"}};try{this.assets=JSON.parse(await this.__executeRequest(n,o))}catch(i){console.error("Error in assets retrieving:",i)}const s=this.__getPointCloudId();if(null!==s&&s.length>0){const i=this.options.r2vsurveyURL+`${t}/featureofinterest/${s}/activities?type=MINIMAP&status=RELEASE`;o={method:"GET",headers:{"Content-Type":"application/json"}};try{let t=await this.__executeRequest(i,o);null!=t&&t.result.length>0&&(this.minimapActivity=t.result[0])}catch(i){console.error("Error in getting minimap activity:",i)}if(null!=this.minimapActivity){const i=this.options.r2vsurveyURL+`${t}/activity/${this.minimapActivity.resourceid}/samples`;o={method:"GET",headers:{"Content-Type":"application/json"}};try{let t=JSON.parse(await this.__executeRequest(i,o));t.length>0&&(this.minimapInfo=t[0])}catch(i){console.error("Error in getting minimap info:",i)}}}let a=this.options.r2vsurveyURL+`${t}/ingest/${e}/tileset`;o={method:"GET",headers:{"Content-Type":"application/json"}};try{this.tileSets=(await this.__executeRequest(a,o)).tileSets}catch(i){console.error("Error in tileSets retrieving:",i)}if(this.hasAcquisitionPoints())for(let i=0;i<this.tileSets.length;i++)if("360"==this.tileSets[i].contentTypes[0]){let t=this.tileSets[i].baseTileURL+this.tileSets[i].rootURI;o={method:"GET",headers:{"Content-Type":"application/json"}};try{let i=JSON.parse(await this.__executeRequest(t,o));for(let t=1;t<i.length;++t){let e=i[t].json.matrix,n=e[12],o=e[13],s=e[14],a={};a.x=n,a.y=o,a.z=s;let r=this.getPositionOnMinimap(a),h="floor"+r.idLevel;this.acquisitionPoints.hasOwnProperty(h)||(this.acquisitionPoints[h]=[]);let p=this.acquisitionPoints[h].length+1,m={};m.id=p,m.coord=r.pointInMap,m.color="#EA4F37",this.acquisitionPoints[h].push(m)}}catch(i){console.error("Error while retrieving acquisitions points",i)}}this.options.isInitialize=!0},e.prototype.hasMinimap=function(){return null!==this.minimapInfo&&"object"==typeof this.minimapInfo&&Object.keys(this.minimapInfo).length>0},e.prototype.__getPointCloudId=function(){let i="";for(let t=0;t<this.assets.length;t++){let e=this.assets[t];if("PointCloud"==e.type){i=e.resourceid;break}}return i},e.prototype.hasAcquisitionPoints=function(){let i=!1;for(let t=0;t<this.assets.length;t++){let e=this.assets[t];if("360Image"==e.type||"Image360"==e.type){i=!0;break}}return i},e.prototype.getNumberOfLevel=function(){return!0!==this.options.isInitialize&&console.warn("R2VMinimapServices## Not initialize"),this.minimapInfo.floorNumbers},e.prototype.getInformationForLevel=function(i){let t="floor"+i;return{id:i,url:this.minimapInfo.colorUrls[i],acquisitionPoints:this.acquisitionPoints[t]}},e.prototype.getPositionOnMinimap=function(i){if(null==i||0==Object.keys(this.minimapInfo).length)return{idLevel:0,pointInMap:{x:Math.floor(this.minimapInfo.width/2),y:Math.floor(this.minimapInfo.height/2)}};let t=i.x,e=i.y,n=i.z,o=this.minimapInfo.width,s=this.minimapInfo.height,a=Math.floor(o*(t-this.minimapInfo.bboxMinX)/(this.minimapInfo.bboxMaxX-this.minimapInfo.bboxMinX)),r=Math.floor(s*(e-this.minimapInfo.bboxMinY)/(this.minimapInfo.bboxMaxY-this.minimapInfo.bboxMinY));a<0?a=0:a>o&&(a=o-1),r<0?r=0:r>s&&(r=s-1);let h=0;for(var p=this.minimapInfo.minHeights.length-1;p>=0;p--)if(n>this.minimapInfo.minHeights[p]){h=p;break}return{idLevel:h,pointInMap:{x:a,y:r}}},e.prototype.getViewpointFromPosition=function(i,t,e){var n={};return n.x=this.minimapInfo.bboxMinX+t/this.minimapInfo.width*(this.minimapInfo.bboxMaxX-this.minimapInfo.bboxMinX),n.y=this.minimapInfo.bboxMinY+e/this.minimapInfo.height*(this.minimapInfo.bboxMaxY-this.minimapInfo.bboxMinY),n.z=this.minimapInfo.maxHeights[i],n},e.prototype.__executeRequest=async function(t,e){return new Promise(((o,s)=>{e.onComplete=function(i){var t={success:!0};i&&(t=n(i)),o(t)},e.onFailure=function(i,t){t&&(t=n(t)),s(t)},e.onTimeout=function(i,t){t&&(t=n(t)),s(t)},"POST"!==e.method||"string"==typeof e.data||e.data instanceof Blob||e.data instanceof FormData||(e.data=JSON.stringify(e.data)),i.authenticatedRequest(t,e)}))},e}));