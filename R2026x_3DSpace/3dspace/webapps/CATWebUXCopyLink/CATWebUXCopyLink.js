/*!  Copyright 2019 Dassault Systemes. All rights reserved. */
define("DS/CATWebUXCopyLink/CATWebUXCopyLinkCmdAdapt",["UWA/Core","DS/CATWebUXComponents/DMUCommand","UWA/Utils/Client","DS/CATWebUXComponents/CATWebUXNotification","i18n!DS/CATWebUXCopyLink/assets/nls/CATWebUXCopyLinkCmdAdapt"],(function(e,t,n,o,i){"use strict";return t.extend({init:function(t){this._parent(t,{isAsynchronous:!0}),this._options=t;var d,a=this,r=require("DS/PADUtils/PADContext").get();delete t.pad3DViewer;var c=t.ID;this.beginExecute=function(){a.getParameters({cmdType:c,onComplete:function(e){a.copyLink(e),a.done()},onFailure:function(){d||(d=new o),d.build({type:"error",autoHide:!0,message:i.copyLinkError,body:r.getFrameWindow().getUIFrame()}),a.end(),a.done()}})},this.copyLink=function(t){var c;return new Promise((function(t,n){require("DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices").getPlatformServices({onComplete:function(n){var o=function(){var t=window.widget.getValue("x3dPlatformId");if(e.is(t))return e.is(t.value)?t.value:t}();n.forEach((function(e){e.platformId===o&&t(e["3DDashboard"])}))},onFailure:n})})).then((function(e){if(t&&t.content){t.content.source=window.widget&&window.widget.getValue("x3dAppId")?window.widget.getValue("x3dAppId"):"ENOI3D_AP",t.content.widgetId=window.widget?window.widget.id:void 0,t.content.data.items[0].envId=require("DS/PADUtils/PADUtilsServices").getPlatformId(),t.content.data.items[0].serviceId="3DSpace",t.content.data.items[0].contextId=require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx").replace("ctx::","");var s=void 0!==window.widget&&window.widget.getValue("x3dAppId")?window.widget.getValue("x3dAppId"):window.widget.getValue("appId");c=function(e){var t,o=document.createElement("textarea");if(o.classList.add("bookmark-txt-link"),o.value=e,document.body.appendChild(o),n.Platform.hasOwnProperty("ios")&&!0===n.Platform.ios){o.contentEditable=!0,o.readOnly=!0;var i=document.createRange();i.selectNodeContents(o);var d=window.getSelection();d.removeAllRanges(),d.addRange(i),o.setSelectionRange(0,o.value.length)}else o.select();try{t=document.execCommand("copy")}catch(e){window.console.log(e)}return document.body.removeChild(o),t?1:0}(e+("#app:"+s+"/content:X3DContentId=")+encodeURIComponent(JSON.stringify(t.content))),d||(d=new o),d.build(c?{type:"success",autoHide:!0,message:i.replace(i.copyLinkSuccess,{label:t.label}).replace(/"/g,"'"),body:r.getFrameWindow().getUIFrame()}:{type:"error",autoHide:!0,message:i.copyLinkError,body:r.getFrameWindow().getUIFrame()}),a.end()}}))}}})}));