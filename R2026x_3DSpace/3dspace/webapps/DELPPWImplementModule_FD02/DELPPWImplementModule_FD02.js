define("DS/DELPPWImplementModule_FD02/ImplementModule",["UWA/Core"],(function(e){"use strict";return{behaviors:["UXFactoryBehavior","ResourceBehavior","ModelBehavior","SelectionBehavior","ImplementBehavior","AssignProductBehavior","WUXNodeModelBehavior","TreeListViewBehavior","ViewBehavior","LinkBehavior"],creator:function(t,n,i,o,l,c,m,a,s,r,d){var p,g,u,S,I,h,f,P,L,v,A,C,b,R,T,D,N,O,k,w,E,U,V,F,y,M,W,B,j,_,x,H="ReconnectScope",K="ReviseAndReconnectScope",X="AssignProductUI",q="CreateMfgItemAndScope",Q=null,z=null,G=null,J={};return S=function(t,n){if(J={},!e.is(t))throw new Error("Command ID is null");J.cmdId=t,J.onOKCallBack=n,J.onCancelCallback=E,J.newObjType=p,J.isInstancePossible=null},h=function(n,o){var l;if(p=null,g=null,z=null,e.is(o,"array")&&0<o.length&&o.forEach((function(t){e.is(t)&&e.is(t.ID,"string")&&e.is(t.Value,"string")&&("ReferenceType"===t.ID&&(p=t.Value),"V_DimensionType"===t.ID&&(z=t.Value))}),this),!e.is(p))throw l=i.getNLSValue("Error.CommandConfigNotValid",{cmdName:n}),t.warn(l),new Error(l);g=p.split("/")[1]},f=function(t){var n,l,c=!1,m=i.getNLSValue("ImplementUI.SelectedMultiObjectsForProvide");!0===t.bUpdateImplemented?Q.updateImplemented(t.selNodes):!0===t.bUpdateImplementing&&Q.updateImplementing(t.selNodes),e.is(g)&&(n=Q.getImplementingID(),e.is(n)&&(l={parent:o.getReferenceModel(n),child:g},c=o.isInstancePossible(l),Q.showDCFormForAssign(c),!1===c&&Q.getImplementedIDs().length>1&&Q.showErrorMultipleImplementedSelected(m)))},P=function(e){!0===e.bUpdateImplemented&&(Q.updateImplemented(e.selNodes),Q.showDCFormForCreate(true))},L=function(e){var t=!0,n=r.getActiveView();return!1===e.changed.isSelected&&e.sourceId!==n&&(t=!1),t},I=function(){e.is(Q)&&(Q.isVisible()&&Q.destroyUI(),Q=void 0)},v=function(t,n){if(J={},!e.is(t))throw new Error("Command ID is null");J.cmdId=t,J.moduleOptions=u,J.onOKCallBack=n,J.onCancelCallback=E},C=function(t){var n,l,m,a,s,r,d=!1,p=i.getNLSValue("ImplementUI.Implementing"),g=function(){A()},u=function(e){G.updateImplementedRevnList(l,e,!0,d)},S=function(e){G.showMessages(e,"error")};e.is(t)&&(s=function(){a=o.getInstancesFromCollection(m),e.is(a)&&a.length>0&&(d=!0),G.updateImplementingLabel(m),(n=c.getScopeLinksOfImplementing(m)).length<=0?G.showMessages(i.getNLSValue("ImplementBehavior.Validation.NoScopeExist"),"error"):(l=n[0].get("to"),r=function(t){e.is(t)?G.showMessages(t,"error"):o.getMajorRevisions(l,u,S)},c.prereqChecksForReconnectScope(J.cmdId,m,p,r,g))},m=o.getReferenceId(t),o.needToQueryForChildren(m)?o.getDescendantsFromServer([m],s,{expandLevel:1,forceDBMode:!0}):s())},A=function(){e.is(G)&&(G.isVisible()&&G.destroyUI(),G=void 0)},E=function(){I(),A()},U=function(t){var n=t.implementingId,i=t.implementedIDs[0],o=t.implementingPaths[0],l=t.implementedPaths[0];(e.is(n)&&e.is(i)||e.is(o)&&e.is(l))&&c.createScopeLink([{implementingPID:n,implementedPID:i,implementingAbsPath:o,implementedAbsPath:l}]),I()},M=function(t){const{implementingPaths:n,implementedPaths:i,cmdAction:o}=t,[l]=n,[m]=i;e.is(l)&&e.is(m)&&c.managePartialScopeLink({implementingAbsPath:l,implementedAbsPath:m,cmdAction:o}),I()},F=function(t){var n,i,l;e.is(t)&&(n=t.implementingId),o.isInstance(n)?(l=n,i=o.getReferenceIdFromInstance(l)):i=n,m.assignProduct({mbomReferenceId:i,mbomInstanceId:l,bodyInstanceIds:t.implementedIDs,bodyAbsolutePaths:t.implementedPaths,mbomAbsolutePaths:t.implementingPaths,newMfgAttributes:t.newObjAttributes,isInstancePossible:t.isInstancePossible,securityContextOverride:t.securityContextOverride}),I()},y=function(e){var t=i.getNLSValue(J.cmdTitle,{type:i.getNLSValue(g||"",null,"Type")}),n=e.implementedIDs,o=e.newObjAttributes,l={securityContextOverride:e.securityContextOverride};o[0].V_Type=p,m.createMfgItemAndScopeLink(n,o,t,l),I()},V=function(t){var n={logMessage:e.is(J.cmdTitle)?i.getNLSValue(J.cmdTitle):"Reconnect Scope command"};e.is(t)&&(J.cmdId===H?c.reconnectScope(t.implementedId,t.implementingId,n,A):J.cmdId===K&&c.reviseAndReconnectScope(t.implementedId,t.implementingId,n,A))},b=function(){E(),d.getRelations().then((function(e){e.isRelationsLoaded&&(p=null,g=null,S("CreateScopeLink",U),J.cmdTitle="ImplementUI.CreateScope",J.implementingSection=!0,J.implementedSection=!0,J.optionsSection=!1,J.checkForImplementingScope=!0,J.modalFlag=!1,J.multiSelectionOfImplementing=!1,J.multiSelectionOfImplemented=!1,Q=n.create("ImplementUI",J),f(Q.getSelectionsWithPaths()))}))},W=function(){E(),d.getRelations().then((function(e){e.isRelationsLoaded&&(p=null,g=null,S("CreatePartialScopeLink",M),J.cmdTitle="ImplementUI.CreatePartialScope",J.implementingSection=!0,J.implementedSection=!0,J.optionsSection=!1,J.checkForImplementingScope=!0,J.modalFlag=!1,J.multiSelectionOfImplementing=!1,J.multiSelectionOfImplemented=!1,J.cmdAction=c.PartialScopeAction.CREATE_PARTIALSCOPE,Q=n.create("ImplementUI",J),f(Q.getSelectionsWithPaths()))}))},j=function(){E(),d.getRelations().then((function(e){e.isRelationsLoaded&&(p=null,g=null,S("StretchPartialScopeLink",M),J.cmdTitle="ImplementUI.StretchPartialScope",J.implementingSection=!0,J.implementedSection=!0,J.optionsSection=!1,J.checkForImplementingScope=!0,J.modalFlag=!1,J.multiSelectionOfImplementing=!1,J.multiSelectionOfImplemented=!1,J.cmdAction=c.PartialScopeAction.STRETCH_PARTIALSCOPE,Q=n.create("ImplementUI",J),f(Q.getSelectionsWithPaths()))}))},B=function(){var n,o=[],m=i.getNLSValue("ImplementUI.Implementing");if(E(),n=l.getSelectionsWithPaths()[1],e.is(n,"array")&&n.length>0){const t=n,i=t[0].path,l=e.is(i)&&i.length>0?i:t.id;c.isPartialScoped(l)&&(e.is(l,"array")&&l.length>0?o=l:o.push(l))}e.is(o,"array")&&o.length>0?c.managePartialScopeLink({implementingAbsPath:o,cmdAction:c.PartialScopeAction.DELETE_PARTIALSCOPE}):t.warn(i.getNLSValue("Error.PartialScopeDeletion",{objectName:m}))},_=function(){var n,o=[],m=i.getNLSValue("ImplementUI.Implementing");if(E(),n=l.getSelectionsWithPaths()[1],e.is(n,"array")&&n.length>0){const t=n,i=t[0].path,l=e.is(i)&&i.length>0?i:t.id;c.isPartialScoped(l)&&(e.is(l,"array")&&l.length>0?o=l:o.push(l))}e.is(o,"array")&&o.length>0?c.managePartialScopeLink({implementingAbsPath:o,cmdAction:c.PartialScopeAction.SWITCH_TO_FULLSCOPE}):t.warn(i.getNLSValue("Error.SwitchPartialScope",{objectName:m}))},O=function(e){E(),d.getRelations().then((function(t){t.isRelationsLoaded&&(h(X,e.arguments),S(X,F),J.cmdTitle="ImplementUI.AssignImplemented",J.implementingSection=!0,J.implementedSection=!0,J.optionsSection=!1,J.checkForImplementingScope=!1,J.modalFlag=!1,J.multiSelectionOfImplementing=!1,J.multiSelectionOfImplemented=!0,Q=n.create("ImplementUI",J),f(Q.getSelectionsWithPaths()))}))},k=function(){var t,n,i=l.getSelectionsWithPaths()[1],o=[];E(),i.forEach((function(i){t=i.path,n=e.is(t)&&t.length>0?t:i.id,o.push(n)})),m.unassignProduct(o)},w=function(t){E(),h(q,t.arguments),S(q,y),J.cmdTitle="ImplementUI.CreateImplementingAndScope",J.implementingSection=!1,J.implementedSection=!0,J.optionsSection=!1,J.checkForImplementingScope=!1,J.modalFlag=!0,J.multiSelectionOfImplementing=!1,J.multiSelectionOfImplemented=!0,e.is(z)&&(J.cmdTitle="ImplementUI.ContinuousProvidedMaterialAndScope",J.newObjDimensionType=z),Q=n.create("ImplementUI",J),P(Q.getSelectionsWithPaths())},R=function(){var n,o,m,a=[],s=i.getNLSValue("ImplementUI.Implementing");E(),n=l.getSelectionsWithPaths()[1],e.is(n,"array")&&n.length>0&&n.forEach((function(t){o=t.path,m=e.is(o)&&o.length>0?o:t.id,c.isScoped(m)&&a.push(m)})),a.length>0?c.deleteScopeLink(a):t.warn(i.getNLSValue("Error.ScopeDeletion",{objectName:s}))},T=function(t,i){E(),v(t,V),J.cmdTitle=e.is(i)?i:"",J.implementedRevTreeListCSSStyle="implementedSection-container",J.optionsSection=!1,J.modalFlag=!1,G=n.create("ImplementedRevChooserUI",J),C(l.getSelections()[1][0])},D=function(){T(H,"Dialog.ReconnectScope.Title")},N=function(){T(K,"Dialog.ReviseAndReconnectScope.Title")},x=function n(){var m,a,s,r=l.getSelectionsWithPaths()[1][0].id,d=o.getReferenceModel(r);e.is(d)?(m=d.get("PID"),(a=c.getScopeLinksOfImplementing(m)).length<=0?t.warn(i.getNLSValue("Error.NoProductScopeExists.Title")):(s=a[0].get("to"),e.is(undefined)&&t.warn(s),c.createEngMadeFromItem(s,d))):t.debug(n+": Reference Model not found for pid:"+r)},{listenTo:function(){return{select:this.onSelect,CreateScopeLink:b,DeleteScopeLink:R,ReconnectScope:D,ReviseAndReconnectScope:N,AssignProduct:O,UnassignProduct:k,CreateMfgItemAndScope:w,CreatePartialScopeLink:W,DeletePartialScopeLink:B,StretchPartialScopeLink:j,SwitchToFullScopeLink:_,DELCreateEngineeringMadeFromItem:x}},onStart:function(e){u=e},onStop:function(){I(),A()},onSelect:function(t){var n;if(e.is(Q)&&Q.isVisible()){if(e.is(t)){if(!1===L(t))return;e.is(t.selectedNodeIds)&&t.selectedNodeIds.length>0&&(n=Q.getSelectionsWithPaths())}e.is(n)&&n.selNodes.length>0&&(!0===J.implementingSection?f(n):P(n))}else e.is(G)&&G.isVisible()&&e.is(t.selectedNodeIds)&&t.selectedNodeIds.length>0&&C(l.getSelections()[1][0])}}}}}));