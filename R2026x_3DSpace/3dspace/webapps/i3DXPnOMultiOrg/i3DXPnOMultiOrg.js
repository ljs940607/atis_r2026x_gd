"use strict";define("DS/i3DXPnOMultiOrg/DataProxy",["DS/WAFData/WAFData"],(function(e){var t,n,o,r,l,i={};return{setParams:function(e,l,i,s){t=e,n=l,o=i,r=s||"en"},setServicesMap:function(e){i={"3DSpace":e["3DSpace"],"3DSwym":e["3DSwym"],"3DSearch":e["3DSearch"]}},setIsOnPremise:function(e){l=e},isOnPremise:function(){return l},getSpaceURL:function(){return i["3DSpace"]||""},getSwymURL:function(){return i["3DSwym"]||""},getSearchURL:function(){return i["3DSearch"]||""},getTenantId:function(){return n},getCurrentUser:function(){return o},getCurrentLanguage:function(){return r},request:function(o,l){o+=-1===o.indexOf("?")?"?":"&",o+="tenant="+n;var i=l.headers||{};return i["Accept-Language"]=r,i.SecurityContext=t,l.headers=i,e.authenticatedRequest(o,l)}}})),define("DS/i3DXPnOMultiOrg/OrganisationsOperator/Models/Org",["UWA/Class/Model"],(function(e){var t=e.extend({idAttribute:"pid",defaults:{pid:"",name:"",title:"",type:"",host:"false",visible:"true",children:[],color:""},setup:function(){this.visibleChildren=null},sync:function(e){"delete"!==e&&this._parent.apply(this,arguments)},getId:function(){return this.get("pid")||""},getName:function(){return this.get("name")||""},getTitle:function(){return this.get("title")||this.getName()},getChildren:function(){return this.get("children")||[]},getColor:function(){return this.get("color")},setColor:function(e,t){this.set("color",e,{silent:t})},isRoot:function(){return"Company"===this.get("type")},isVisible:function(){return"true"===this.get("visible")},destroy:function(){this._parent.apply(this,arguments)}});return t})),define("DS/i3DXPnOMultiOrg/OrganisationsOperator/Collections/Orgs",["UWA/Class/Collection","DS/i3DXPnOMultiOrg/DataProxy","DS/i3DXPnOMultiOrg/OrganisationsOperator/Models/Org"],(function(e,t,n){return e.extend({model:n,rootColor:["blue-root","yellow-root","red-root","orange-root","green-root","purple-root","pink-root","grey-root","black-root"],hostRootColor:"host-color-root",rootColorIndex:0,setup:function(e,t){this._parent(e,t),this.roots=[],this.state={hasNextPage:!0,pagenumber:0,pagesize:25},this._pattern="",this._peopleId="",this._originURL=this.url},sync:function(e,n,o){o.ajax=t.request,o.data.pagenumber||(o.data.pagenumber=this.state.pagenumber),o.data.pagesize||(o.data.pagesize=this.state.pagesize),this._parent.apply(this,[e,n,o])},parse:function(e,t){var n=e.organizations;return n&&n.length||(this.state.hasNextPage=!1),n},fetch:function(e){e.getNextPage?e.getNextPage&&(this.state.pagenumber+=1):(this.state.pagenumber=0,this.state.hasNextPage=!0),e.data={pagenumber:this.state.pagenumber,pagesize:this.state.pagesize},e.pattern?(this._pattern=e.pattern,e.data={pattern:this._pattern}):this._pattern="",e.peopleId?(this._peopleId=e.peopleId,this.url=`${this._originURL.substring(0,this._originURL.indexOf("organizations"))}members/pid:${e.peopleId}/organizations`):(this._peopleId="",this.url!=this._originURL&&(this.url=this._originURL)),this._parent(e)},setView:function(e){var t=this;t.view=e,t.addEvent("onScrollHorizontalEnd",(function(e){t.view.dispatchEvent("onScrollHorizontalEnd",e)})),t.addEvent("onScrollHorizontalFailure",(function(){t.view.dispatchEvent("onScrollHorizontalFailure")}))},parseCollection:function(){var e=this;e.roots=[],e.rootColorIndex=0;var t=e.rootColor;e.forEach((function(n){if(n.visibleChildren=null,n.isRoot()){"true"===n.get("host")?e.roots.unshift(n):e.roots.push(n),n.setColor("true"===n.get("host")?e.hostRootColor:t[e.rootColorIndex%t.length]);var o=n.getColor();e.getVisibleChildrenOf(n).forEach((function(e){e.setColor(o)})),e.rootColorIndex++}}))},handleScroll:function(){if(!this.isAlreadyHandling){this.isAlreadyHandling=!0;var e=this;if(this.state.hasNextPage){let t={getNextPage:!0,remove:!1,onComplete:function(t,n,o){e.isAlreadyHandling=!1,e.dispatchEvent("onScrollHorizontalEnd",n.organizations.length)},onFailure:function(){e.state.hasNextPage=!1,e.dispatchEvent("onScrollHorizontalFailure")}};this._pattern&&(t.pattern=this._pattern),this._peopleId&&(t.peopleId=this._peopleId),this.fetch(t)}}},getRoots:function(){return this.roots},getChildrenOf:function(e){var t=[],n=this;return function e(o){o&&o.getChildren().forEach((function(r){r=n.get(r),t.splice(-1!==t.indexOf(o)?t.indexOf(o)+1:0,0,r),e(r)}))}(e),t},getVisibleChildrenOf:function(e){var t=e.visibleChildren;return t||(e.visibleChildren=this.getChildrenOf(e).filter((function(e){return!!e&&e.isVisible()})),e.visibleChildren)},getPeopleColor:function(e){var t,n=e.getMemberOfIds();return n.length?(t=this.get(n[0]))&&t.getColor():""}})})),define("DS/i3DXPnOMultiOrg/OrganisationsOperator/Models/People",["UWA/Core","UWA/Class/Model","UWA/String","DS/i3DXPnOMultiOrg/DataProxy","i18n!DS/i3DXPnOMultiOrg/assets/nls/OrganisationsOperator"],(function(e,t,n,o,r){var l=t.extend({idAttribute:"pid",defaults:{pid:"",name:"",firstname:"",lastname:"",email:"",couples:[],organizations:[],assignmentOverflow:!1,group:!1},setup:function(e){this.set("couples",e.couples||[],{silent:!0}),this.set("organizations",e.organizations||[],{silent:!0})},sync:function(e,t,n){n.ajax=o.request,this._parent(e,t,n)},isGroup:function(){return this.get("group")},getNLSType:function(){return this.isGroup()?"groupType":"userType"},getId:function(){return this.get("pid")||""},getName:function(){return this.isGroup()?this.get("name"):""==this.get("firstname")&&""==this.get("lastname")?this.get("email")+" ("+r.get("pending")+")":n.ucfirst(this.get("firstname"))+" "+this.get("lastname").toUpperCase()},getMemberOfIds:function(){return this.get("organizations")||[]},getAssignments:function(){return this.get("couples")||[]},getNumberOfOwnerAssignments:function(){return this.getAssignments().filter((function(e){return"VPLMProjectAdministrator"===e.role})).length},hasOnlyOneAssignment:function(){var e=this.getAssignments();return e.length<2||2===e.length&&e[0].organization===e[1].organization},canOwnerRoleBeRemoved:function(e,t){return 1!==this.getNumberOfOwnerAssignments()||this.get("name")!==e&&e===t},canBeRemovedfromCS:function(e,t){return this.get("name")!==e&&!(this.getNumberOfOwnerAssignments()>0&&e!==t)},_removeAssignmentImpl:function(e){var t,n,o=this.getAssignments(),r=[];for(n=0;n<o.length;n++)(t=o[n]).organization!==e&&r.push(t);return r},setAssignment:function(t,o,r){var l=e.clone(this._removeAssignmentImpl(o));"VPLMProjectLeader&VPLMProjectAdministrator"===t?(l.push({role:"VPLMProjectAdministrator",organization:o}),l.push({role:"VPLMProjectLeader",organization:o})):"3DSRestrictedLeader&3DSRestrictedOwner"===t?(l.push({role:"3DSRestrictedOwner",organization:o}),l.push({role:"3DSRestrictedLeader",organization:o})):l.push({role:n.ucfirst(t),organization:o}),this.save({couples:l},{headers:{"Content-Type":"application/json"},wait:!0,onComplete:r.onComplete,onFailure:r.onFailure})},removeAssignment:function(e,t){this.save({couples:this._removeAssignmentImpl(e)},{headers:{"Content-Type":"application/json"},wait:!0,onComplete:t.onComplete,onFailure:t.onFailure})},destroy:function(){this._parent.apply(this,arguments)}});return l})),define("DS/i3DXPnOMultiOrg/OrganisationsOperator/Views/OrganisationsOperator",["UWA/Core","UWA/Class/View","UWA/Utils","UWA/String","DS/UIKIT/SuperModal","DS/UIKIT/Input/Text","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/UIKIT/Mask","DS/i3DXPnOMultiOrg/DataProxy","i18n!DS/i3DXPnOMultiOrg/assets/nls/OrganisationsOperator","css!DS/i3DXPnOMultiOrg/i3DXPnOMultiOrg.css"],(function(e,t,n,o,r,l,i,s,a,c,d){var u=!1,g=!1,m=0,h=0,p=null,f=null;function v(e,t,n){var o,r,l,i=0;function s(){i=(new Date).getTime(),r=null,l=e.apply(n,o)}return function(){var a=(new Date).getTime(),c=t-(a-i);return n=n||this,o=arguments,c<=0?(clearTimeout(r),r=null,i=a,l=e.apply(n,o)):r||(r=setTimeout(s,c)),l}}function C(e,t){var n,o,r,l,i,s;return o=(n=t.getDimensions()).width,l=(r=e.getOffsets().x-t.getOffsets().x)+e.getDimensions().width,{totally:i=r>=0&&l<=o,partially:s=r<0&&l>0||r>=0&&r<=n.width,visible:i||s}}function b(e,t){e.scroll?e.scroll(t):(t.top&&(e.scrollTop=t.top),t.left&&(e.scrollLeft=t.left))}var O=t.extend({tagName:"div",className:"orgsop-view",domEvents:{"click .content-line .suborg-cell":"_clickOnCell","click .add-people-btn":"_clickOnAddUsersBtn","click .close-view-btn":"_clickOnCloseViewBtn","click .people-trash-ctn":"_clickOnTrashBtn","click .zoom-btn":"_clickOnZoomBtn"},events:{onAddUsers:null,onRemoveUser:null},currentUser:"",swymURL:null,peoplesCollection:null,orgsCollection:null,roleIcons:{VPLMProjectLeader:"fonticon fonticon-favorite-on","3DSRestrictedLeader":"fonticon fonticon-favorite-on",VPLMProjectAdministrator:"fonticon fonticon-key","3DSRestrictedOwner":"fonticon fonticon-key",VPLMCreator:"fonticon fonticon-feather","3DSRestrictedAuthor":"fonticon fonticon-feather",VPLMExperimenter:"fonticon fonticon-chat","3DSRestrictedContributor":"fonticon fonticon-chat",VPLMViewer:"fonticon fonticon-eye","3DSRestrictedReader":"fonticon fonticon-eye",VPLMSecuredCrossAccess:"fonticon fonticon-eye"},rolesDDMenu:null,selectedCell:null,hoverPeopleCell:null,hoverContentCell:null,setup:function(t){var n=t||{};this.readOnly=n.readOnly,this.restrictedOrg=n.restrictedOrg,this.currentUser=n.currentUser||"",this.swymURL=c.getSwymURL(),this.roles=n.roles,this.mainOwner=n.mainOwner,this.peoplesCollection=n.peopleCollection,this.peoplesCollection.setView(this),this.orgsCollection=n.orgsCollection,this.orgsCollection.setView(this),this.orgsCollection.parseCollection(),this.peopleSelected="",this.successAlert=n.successAlert,this.errorAlert=n.errorAlert,e.merge(this.events,n.events||{})},render:function(){var t,o,r,i,c,u,g,m,h,p,f,v,C,b,O,P,S,y,w,_=this,D=n.Client.getScrollbarWidth();r=e.createElement("div",{class:"buttons-row-ctn",html:[_.readOnly&&!_.restrictedOrg?null:t=e.createElement("div",{class:"fonticon fonticon-user-add action-btn add-people-btn"}),o=e.createElement("div",{class:"fonticon fonticon-close action-btn close-view-btn"})]}),t&&new s({target:t,body:d.addNewUser,position:"bottom"}),new s({target:o,body:d.closeAdvView,position:"bottom"});var L=e.createElement("div",{class:"header-ctn",html:[e.createElement("div",{class:"csadv-title",text:this.options.collabSpace}),r]});if(i=e.createElement("div",{class:"table-ctn"}),_.container.addContent(L,i),_.orgsCollection.isEmpty())return i.addContent(e.createElement("div",{class:"empty-table",text:d.emptyTable})),_;b=new l({className:"search-user-filter",placeholder:d.searchPlaceHolder,events:{onKeyDown:function(){clearTimeout(y);y=setTimeout((function(){var e=_.elements.searchCollaborator.getValue().trim();if(e.length>=3)_.elements.clearCollaboratorBtn.removeClassName("hide");else{if(0!==e.length)return;_.elements.clearCollaboratorBtn.addClassName("hide")}_._resetPositionScrollbar(),a.mask(_.container),_.peoplesCollection.fetch({pattern:e,onComplete:function(){_._resetPeopleView(),_._buildPeopleView(),_.peoplesCollection.isAlreadyHandling=!1,a.unmask(_.container)},onFailure:function(){_.peoplesCollection.isAlreadyHandling=!1,a.unmask(_.container),_.errorAlert.add({message:d.get("error.fetchMembers")})}})}),1e3)}}}),O=e.createElement("span",{class:"clear-collaborator-btn fonticon fonticon-2x fonticon-cancel-squared hide",events:{click:function(){this.addClassName("hide"),_.elements.searchCollaborator.setValue(""),_._resetPositionScrollbar(),a.mask(_.container),_.peoplesCollection.fetch({onComplete:function(){_._resetPeopleView(),_._buildPeopleView(),_.peoplesCollection.isAlreadyHandling=!1,a.unmask(_.container)},onFailure:function(){_.peoplesCollection.isAlreadyHandling=!1,a.unmask(_.container),_.errorAlert.add({message:d.get("error.fetchMembers")})}})}}}),new s({target:O,position:"bottom",body:d.clear}),P=new l({className:"search-organization-filter",placeholder:d.searchOrganizationPlaceHolder,events:{onKeyDown:function(){clearTimeout(w);w=setTimeout((function(){var e=_.elements.searchOrganization.getValue().trim(),t=e.length;if(t>=3)_.elements.clearOrganizationBtn.removeClassName("hide");else{if(0!==t)return;_.elements.clearOrganizationBtn.addClassName("hide")}_._resetPositionScrollbar(),a.mask(_.container);var n={onComplete:function(){_._resetOrganizationView(),_._buildOrganizationView(),_.elements.orgsLine.addContent(_.elements.scrollXElement),_._resetPeopleView(),_.peopleSelected?(_.elements.peoplesCol.addContent(_._buildPeopleCell(_.peopleSelected)),_.elements.contentsCtn.addContent(_._buildContentLine(_.peopleSelected))):_._buildPeopleView(),_.orgsCollection.isAlreadyHandling=!1,a.unmask(_.container)},onFailure:function(){_.orgsCollection.isAlreadyHandling=!1,a.unmask(_.container),_.errorAlert.add({message:d.get("error.fetchOrganisations")})}};t>=3&&(n.pattern=e),_.peopleSelected&&(n.peopleId=_.peopleSelected.id),_.orgsCollection.fetch(n)}),1e3)}}}),S=e.createElement("span",{class:"clear-organization-btn fonticon fonticon-2x fonticon-cancel-squared hide",events:{click:function(){this.addClassName("hide"),_.elements.searchOrganization.setValue(""),_._resetPositionScrollbar(),a.mask(_.container);var e={onComplete:function(){_._resetOrganizationView(),_._buildOrganizationView(),_.elements.orgsLine.addContent(_.elements.scrollXElement),_._resetPeopleView(),_.peopleSelected?(_.elements.peoplesCol.addContent(_._buildPeopleCell(_.peopleSelected)),_.elements.contentsCtn.addContent(_._buildContentLine(_.peopleSelected))):_._buildPeopleView(),_.orgsCollection.isAlreadyHandling=!1,a.unmask(_.container)},onFailure:function(){_.orgsCollection.isAlreadyHandling=!1,a.unmask(_.container),_.errorAlert.add({message:d.get("error.fetchOrganisations")})}};_.peopleSelected&&(e.peopleId=_.peopleSelected.id),_.orgsCollection.fetch(e)}}}),new s({target:S,position:"bottom",body:d.clear}),i.addContent(c=e.createElement("div",{class:"header-line",html:[e.createElement("div",{class:"filter-cell",html:[e.createElement("div",{class:"filter-ctn",html:[b,O]})]}),e.createElement("div",{class:"orgs-col",html:[e.createElement("div",{class:"orgs-filter",html:[P,S]}),h=e.createElement("div",{class:"orgs-line"})]})]}),u=e.createElement("div",{class:"contents-line",html:[g=e.createElement("div",{class:"peoples-col",styles:{"padding-bottom":D}}),m=e.createElement("div",{class:"contents-col",html:[p=e.createElement("div",{class:"contents-ctn"})],events:{scroll:_._onScroll.bind(_)}}),C=e.createElement("div",{class:"action-overlay"})]}),f=e.createElement("div",{class:"horizontal-highlight"}),v=e.createElement("div",{class:"vertical-highlight"})),_.orgsCollection.getRoots().forEach((function(t){var n=t.getTitle();h.addContent(e.createElement("div",{class:"org-cell",html:[e.createElement("div",{class:"rootorg-cell",html:[e.createElement("div",{class:"rootorg-ctn",html:[e.createElement("div",{class:"rootorg-name",text:n.toUpperCase(),title:n,styles:{width:138*((t.isVisible()?1:0)+_.orgsCollection.getVisibleChildrenOf(t).length)-5+"px",overflow:"hidden","text-overflow":"ellipsis"}}),e.createElement("div",{class:"rootorg-color "+t.getColor()})]})]}),e.createElement("div",{class:"subsorg-cell",html:_._buildSubOrgCell(t)})]}));var o=h.getElement('div[title="'+t.getTitle()+'"]');new s({target:o,body:n,position:"top"})}));var A=e.createElement("div",{html:'<div style="width: 138px"></div>'});return h.addContent(A),_.peoplesCollection.forEach((function(e){g.addContent(_._buildPeopleCell(e)),p.addContent(_._buildContentLine(e))})),_.elements={horizontalHighlight:f,verticalHighlight:v,headerLine:c,orgsLine:h,peoplesCol:g,contentsCol:m,contentsCtn:p,contentsLine:u,actionOverlay:C,searchCollaborator:b,searchOrganization:P,scrollXElement:A,clearCollaboratorBtn:O,clearOrganizationBtn:S},_},onPostInject:function(){var e=this.elements,t=e.contentsCtn,o=e.orgsLine,r=n.Client.getScrollbarWidth();t.setStyles({width:o.scrollWidth-r+"px"}),e.verticalHighlight.setStyles({top:t.getPosition().y}),this._addEvents()},onFacetSelect:function(){},onPositionChange:function(){this.onResize()},onResize:function(){},destroy:function(){var e=this;e.peoplesCollection&&(e.peoplesCollection=null),e.orgsCollection&&(e.orgsCollection=null),e._parent.apply(e,arguments),e.elements=null},_buildSubOrgCell:function(t){function n(t){return e.createElement("div",{class:"suborg-cell",html:[e.createElement("div",{class:"suborg-ctn",html:[e.createElement("div",{class:"suborg-name",text:t.getTitle()})]})]})}return(t.isVisible()?[n(t)]:[]).concat(this.orgsCollection.getVisibleChildrenOf(t).map(n))},_buildOrganizationCell:function(t){var n=this.orgsCollection,o=t.getTitle();return e.createElement("div",{class:"org-cell",html:[e.createElement("div",{class:"rootorg-cell",html:[e.createElement("div",{class:"rootorg-ctn",html:[e.createElement("div",{class:"rootorg-name",text:o.toUpperCase(),title:o,styles:{width:138*((t.isVisible()?1:0)+n.getVisibleChildrenOf(t).length)-5+"px",overflow:"hidden","text-overflow":"ellipsis"}}),e.createElement("div",{class:"rootorg-color "+t.getColor()})]})]}),e.createElement("div",{class:"subsorg-cell",html:this._buildSubOrgCell(t)})]})},_buildPeopleCell:function(t){var r=this,l=r.orgsCollection,i="",a=t.getId();if(r.swymURL&&!t.isGroup()){var c=n.parseUrl(r.swymURL);c.authority&&(i=o.format("{0}://{1}{2}api/user/getpicture/login/{3}/format/normal",c.protocol||"https",c.authority,c.directoryPath||"/",t.get("name")))}var u=r.readOnly?null:e.createElement("div",{class:"separator"});return e.createElement("div",{class:"people-cell people-id-"+a,html:[e.createElement("div",{class:"peopleorg-color "+l.getPeopleColor(t)}),e.createElement("div",{class:"people-ctn",html:[e.createElement("div",{class:t.isGroup()?"profile-pic-ctn fonticon fonticon-users":"profile-pic-ctn fonticon fonticon-user",html:e.createElement("div",{class:"profile-pic",styles:{"background-image":'url("'+i+'")'}})}),e.createElement("div",{class:"people-info-ctn",html:[e.createElement("div",{class:"name-ctn",text:t.getName()}),t.isGroup()?null:e.createElement("div",{class:"memberof-org-ctn",html:r._buildPeopleMemberOfInfo(t)})]}),r.readOnly?null:e.createElement("div",{class:"people-zoom-ctn",title:d.get("infoBtn"),html:[e.createElement("div",{class:r.peopleSelected?"fonticon fonticon-eye-off zoom-btn primary":"fonticon fonticon-eye zoom-btn"})]}),u,r.readOnly?null:e.createElement("div",{class:"people-trash-ctn "+(t.canBeRemovedfromCS(r.currentUser,r.mainOwner)?"":"disabled"),title:d.replace(d.get("trashBtn"),{type:d.get(t.getNLSType())}),html:[e.createElement("div",{class:"fonticon fonticon-trash trash-btn"})]})],events:{mouseenter:e=>{let t=e.target.getElement("div.name-ctn");new s({target:t,body:t.innerHTML,position:"right"})}}})]}).setData("people",{id:a})},_buildPeopleMemberOfInfo:function(t){var n=this,o=t.getAssignments(),r=t.getMemberOfIds().reduce((function(e,t){var r=n.orgsCollection.get(t);if(!r)return e;o.filter((function(e){return t===e.organization})).length;var l=r.getTitle();return e.push(l),e}),[]),l=e.createElement("div",{class:"memberof-names",html:r.join(" - ")});return l.textContent.length>37&&new s({target:l,className:"memberof-tooltip",body:l.innerHTML,position:"right"}),l},_buildContentLine:function(t){var n=this,o=t.getId();function r(e){return(e.isVisible()?[n._buildCell(t,e)]:[]).concat(n.orgsCollection.getVisibleChildrenOf(e).map((function(e){return n._buildCell(t,e)})))}return e.createElement("div",{class:"content-line people-id-"+o,html:n.orgsCollection.getRoots().map((function(t){return e.createElement("div",{class:"subsorg-cell"+(n.readOnly?" read-only":""),html:r(t)})}))}).setData("people",{id:o})},_buildContentCol:function(t){var n=this;function o(e,t){return(e.isVisible()?[n._buildCell(t,e)]:[]).concat(n.orgsCollection.getVisibleChildrenOf(e).map((function(e){return n._buildCell(t,e)})))}n.peoplesCollection.map((r=>{let l=r.getId(),i=n.elements.contentsCtn.getElement(".content-line.people-id-"+l),s=e.createElement("div",{class:"subsorg-cell"+(n.readOnly?" read-only":""),html:o(t,r)});i.addContent(s)}))},_buildContentColWithPeopleSelected:function(t){var n=this;let o=n.peopleSelected.getId(),r=n.elements.contentsCtn.getElement(".content-line.people-id-"+o),l=e.createElement("div",{class:"subsorg-cell"+(n.readOnly?" read-only":""),html:function(e,t){return(e.isVisible()?[n._buildCell(t,e)]:[]).concat(n.orgsCollection.getVisibleChildrenOf(e).map((function(e){return n._buildCell(t,e)})))}(t,n.peopleSelected)});r.addContent(l)},_buildCell:function(t,n){var o,r,l=this,i=n.getId(),s=n.getName(),a=t.getMemberOfIds(),c=t.getAssignments().filter((function(e){return e.organization===i})),u={orgId:i,peopleId:t.getId()},g=[];return(r=a.indexOf(i)>=0)&&(u.isMemberOf=r),c.length&&(2===c.length&&"VPLMProjectLeader"!==c[0].role&&"3DSRestrictedLeader"!==c[0].role&&c.reverse(),c=c.map((function(n,o){var i=n.role||"",s=r&&!t.isGroup()?l.roleIcons[i]:"";return g.push(i),i=d[i],e.createElement("div",{class:"role-ctn "+s,html:e.createElement("div",{class:"role-name",text:o?d.get("ANDRoleTxt")+" "+i:i})})})),o=e.createElement("div",{class:"assignments-ctn",html:c}),u.roles=g),e.createElement("div",{class:"content-cell suborg-cell "+(l.readOnly&&s===this.restrictedOrg?"restrictedOrg":""),html:[e.createElement("div",{class:"suborg-ctn "+(r&&o&&!t.isGroup()?"memberof":""),html:[o,e.createElement("div",{class:"fonticon fonticon-chevron-down menu-icon "+(!o||l.readOnly&&s!==this.restrictedOrg?"has-no-role":"")})]})],events:{mouseenter:l._onMouseEnterCell.bind(l)}}).setData("data",u)},_addEvents:function(){var e=this,t=e.elements,n=t.contentsCol,o=t.orgsLine,r=t.peoplesCol,l=(t.horizontalHighlight,t.verticalHighlight);e.addEvent("onAssignmentsChange",e._onAssignmentsChange.bind(e)),e.addEvent("onScrollEnd",e._onScrollEnd.bind(e)),e.addEvent("onScrollFailure",e._onScrollFailure.bind(e)),e.addEvent("onScrollHorizontalEnd",e._onScrollHorizontalEnd.bind(e)),e.addEvent("onScrolllHorizontalFailure",e._onScrollHorizontalFailure.bind(e)),n.addEvent("mouseenter",(function(){l.addClassName("show")})),n.addEvent("mouseleave",(function(){(e.rolesDDMenu||{}).isVisible||l.removeClassName("show")})),e.container.addEvent("mousewheel",(function(e){if(u||g)return e.preventDefault&&e.preventDefault(),e.returnValue=!1,!1})),r.addEvent("mouseenter",(function(){u=!0})),r.addEvent("mouseleave",(function(){u=!1})),o.addEvent("mouseenter",(function(){g=!0})),o.addEvent("mouseleave",(function(){g=!1})),r.addEvent("mousewheel",v((function(t){var n=t.wheelDelta;e._scrollContent({way:n>0?"up":"down",delta:n,behavior:"smooth"})}),200)),o.addEvent("mousewheel",v((function(t){var n=t.wheelDelta;e._scrollContent({way:n>0?"right":"left",delta:n,behavior:"smooth"})}),200))},selectCell:function(e){e.addClassName("selected"),this.selectedCell=e},_unSelectCell:function(e){(e=e||this.selectedCell)&&(e.removeClassName("selected"),this.selectedCell=null)},_hoverPeopleCell:function(e){e.addClassName("hover"),this.hoverPeopleCell=e},_hoverContentCell:function(e){e.addClassName("hover"),this.hoverContentCell=e},_unHoverPeopleCell:function(e){(e=e||this.hoverPeopleCell)&&(e.removeClassName("hover"),this.hoverPeopleCell=null)},_unHoverContentCell:function(e){(e=e||this.hoverContentCell)&&(e.removeClassName("hover"),this.hoverContentCell=null)},_showActionOverlay:function(){this.elements.actionOverlay.addClassName("show")},_hideActionOverlay:function(){this.elements.actionOverlay.removeClassName("show")},_clickOnCell:function(e){var t,n,o,r,l,s,a,c=this,u=e.target;a=u.hasClassName("content-cell")?u:u.getParent(".content-cell"),r=a.getData("data");var g=this.orgsCollection.get(r.orgId).getName();if(!c.readOnly||this.restrictedOrg===g){c._unSelectCell(),o=a.getParent(".content-line"),s=0===(l=r.roles||[]).length,t=o.getData("people").id,n=c.peoplesCollection.get(t);for(var m,h=P("VPLMProjectAdministrator")&&!n.canOwnerRoleBeRemoved(this.currentUser,this.mainOwner),p=d.replace(d.get("lastOwnerRole"),{type:d.get(n.getNLSType())}),f=this.roles||[],v=!1,C=!1,b=!1,O=0;O<f.length;O++)"PublicReader"===f[O]?C=!0:"Reader"===f[O]?v=!0:"Contributorrestricted"===f[O]&&(b=!0);m=f.indexOf("Leader")>=0&&f.indexOf("Owner")>=0,c.rolesDDMenu&&c.rolesDDMenu.destroy(),c.rolesDDMenu=new i({target:a.getElement(".menu-icon"),items:this._buildRolesMenu(n,h,p,P,s,v,C,b,m),closeOnClick:!1,events:{onClick:function(e,t){t.items||(c.rolesDDMenu.hide(),c._clickOnRoleDDMenu(e,t,a,r,l,n))},onHide:function(){c._unSelectCell()}}}),c.selectCell(a),c.rolesDDMenu.show()}function P(e){return l.indexOf(e)>=0}},_buildBasicItems:function(e,t,n,o,r){var l,i,s=[l={text:d.VPLMExperimenter,name:"VPLMExperimenter",selectable:!e,disabled:t||!e&&this.restrictedOrg,attributes:t?{title:n}:{},selected:o("VPLMExperimenter")||o("3DSRestrictedContributor")},i={text:d.VPLMCreator,name:"VPLMCreator",selectable:!e,disabled:t||!e&&this.restrictedOrg,attributes:t?{title:n}:{},selected:o("VPLMCreator")||o("3DSRestrictedAuthor")}];if(r){var a={text:d.VPLMProjectLeader,name:"VPLMProjectLeader",selectable:!e,disabled:t||!e&&this.restrictedOrg,selected:o("VPLMProjectLeader")&&!o("VPLMProjectAdministrator")||o("3DSRestrictedLeader")&&!o("3DSRestrictedOwner")},c={text:d.VPLMProjectAdministrator,name:"VPLMProjectAdministrator",selectable:!e,disabled:!e&&this.restrictedOrg,selected:o("VPLMProjectAdministrator")&&!o("VPLMProjectLeader")||o("3DSRestrictedOwner")&&!o("3DSRestrictedLeader")};s.push(a),s.push(c)}var u={text:d.VPLMProjectLeader+" "+d.ANDRoleTxt+" "+d.VPLMProjectAdministrator,name:"VPLMProjectLeader&VPLMProjectAdministrator",selectable:!e,disabled:!e&&this.restrictedOrg,selected:o("VPLMProjectLeader")&&o("VPLMProjectAdministrator")||o("3DSRestrictedLeader")&&o("3DSRestrictedOwner")};return s.push(u),e&&(t||(l.items=[{text:d.get("VPLMExperimenter"),name:"VPLMExperimenter",selectable:!0,disabled:this.restrictedOrg,selected:o("VPLMExperimenter")},{text:d.get("3DSRestrictedContributor"),name:"3DSRestrictedContributor",selectable:!0,selected:o("3DSRestrictedContributor")}],i.items=[{text:d.get("VPLMCreator"),name:"VPLMCreator",selectable:!0,disabled:this.restrictedOrg,selected:o("VPLMCreator")},{text:d.get("3DSRestrictedAuthor"),name:"3DSRestrictedAuthor",selectable:!0,selected:o("3DSRestrictedAuthor")}]),r&&(a.items=[{text:d.get("VPLMProjectLeader"),name:"VPLMProjectLeader",selectable:!0,disabled:t||this.restrictedOrg,selected:o("VPLMProjectLeader")&&!o("VPLMProjectAdministrator")},{text:d.get("3DSRestrictedLeader"),name:"3DSRestrictedLeader",selectable:!0,disabled:t,attributes:t?{title:n}:{},selected:o("3DSRestrictedLeader")&&!o("3DSRestrictedOwner")}],c.items=[{text:d.get("VPLMProjectAdministrator"),name:"VPLMProjectAdministrator",selectable:!0,disabled:this.restrictedOrg,selected:o("VPLMProjectAdministrator")&&!o("VPLMProjectLeader")},{text:d.get("3DSRestrictedOwner"),name:"3DSRestrictedOwner",selectable:!0,disabled:t,attributes:t?{title:n}:{},selected:o("3DSRestrictedOwner")&&o("3DSRestrictedLeader")}]),u.items=[{text:d.get("VPLMProjectLeader")+" "+d.get("ANDRoleTxt")+" "+d.get("VPLMProjectAdministrator"),name:"VPLMProjectLeader&VPLMProjectAdministrator",selectable:!0,disabled:this.restrictedOrg,selected:o("VPLMProjectLeader")&&o("VPLMProjectAdministrator")},{text:d.get("3DSRestrictedLeader")+" "+d.get("ANDRoleTxt")+" "+d.get("3DSRestrictedOwner"),name:"3DSRestrictedLeader&3DSRestrictedOwner",selectable:!0,disabled:t,attributes:t?{title:n}:{},selected:o("3DSRestrictedLeader")&&o("3DSRestrictedOwner")}]),s},_buildAdditionalItems:function(e,t,n,o,r,l,i){if(t){var s={text:d.VPLMViewer,name:"VPLMViewer",selectable:!0,disabled:o||!i&&this.restrictedOrg,attributes:o?{title:r}:{},selected:l("VPLMViewer")||l("3DSRestrictedReader")};i&&!o&&(s.items=[{text:d.get("VPLMViewer"),name:"VPLMViewer",selectable:!0,disabled:this.restrictedOrg,selected:l("VPLMViewer")},{text:d.get("3DSRestrictedReader"),name:"3DSRestrictedReader",selectable:!0,selected:l("3DSRestrictedReader")}]),e.unshift(s)}n&&e.unshift({text:d.VPLMSecuredCrossAccess,name:"VPLMSecuredCrossAccess",selectable:!0,disabled:o||this.restrictedOrg,attributes:o?{title:r}:{},selected:l("VPLMSecuredCrossAccess")})},_buildRolesMenu:function(e,t,n,o,r,l,i,s,a){var c=this._buildBasicItems(s,t,n,o,a);if(this._buildAdditionalItems(c,l,i,t,n,o,s),!r){var u={text:d.revoke,name:"revoke",fonticon:"block",selectable:!1,disabled:t,attributes:t?{title:n}:{}};e.hasOnlyOneAssignment()&&(u.disabled=!0,u.attributes.title=u.attributes.title||d.replace(d.get("unableToRevoke"),{type:d.get(e.getNLSType())})),c.unshift(u)}return c},_clickOnRoleDDMenu:function(e,t,n,o,r,l){var i,s=this,a=t.name;if(function(e,t){return-1===t.indexOf(e)||t.length>1&&"VPLMProjectLeader&VPLMProjectAdministrator"!==e}(a,r)){i=o.orgId;var c=function(e){s._hideActionOverlay();var t=[{message:d.replace(d.get("success.changeAssignment"),{type:d.get(l.getNLSType())})}];e.get("assignmentOverflow")&&t.push({message:d.replace(d.get("warning.assignmentOverflow"),{type:d.get(l.getNLSType())}),className:"warning"}),s.successAlert.add(t),s._buildCell(l,s.orgsCollection.get(i)).inject(n,"after"),n.remove(),n=null},u=function(){s._hideActionOverlay(),s.errorAlert.add({message:d.replace(d.get("error.changeAssignment"),{type:d.get(l.getNLSType())})})};s._showActionOverlay(),"revoke"===a?l.removeAssignment(i,{onComplete:c,onFailure:u}):l.setAssignment(a,i,{onComplete:c,onFailure:u})}},_clickOnTrashBtn:function(e){var t,n,o,l,i,s,a=this,c=e.target;(c.hasClassName("people-trash-ctn")?c:c.getParent(".people-trash-ctn")).hasClassName("disabled")||(t=c.getParent(".people-cell"),n=t.getData("people").id,l=(o=a.peoplesCollection.get(n)).getName(),new r({closable:!0}).confirm((i=d.removeUserMsg,s={name:l},i.replace(/\{([\w\-]+)\}/g,(function(e,t){return void 0!==s[t]?s[t]:""}))),d.removeUserTitle,(function(e){var r;if(e){a._showActionOverlay(),o.destroy({wait:!0,onComplete:function(){a._hideActionOverlay(),a.successAlert.add({message:d.replace(d.get("success.removeUser"),{type:d.get(o.getNLSType())})}),(r=a.elements.contentsCtn.getElement(".content-line.people-id-"+n)).addClassName("removed"),t.addClassName("removed"),setTimeout((function(){t&&t.remove(),t=null,r&&r.remove(),r=null}),750),a.events.onRemoveUser(o.get("pid"))},onFailure:function(){a._hideActionOverlay(),a.errorAlert.add({message:d.replace(d.get("error.removeUser"),{type:d.get(o.getNLSType())})})}})}})))},_clickOnZoomBtn:function(e){var t,n,o,r=this,l=e.target;n=l.getParent(".people-cell").getData("people").id,o=r.peoplesCollection.get(n),t=r.elements.searchCollaborator.elements.container.getParent(),a.mask(r.container);let i={pattern:r.elements.searchOrganization.elements.input.value,onComplete:function(){r._resetPositionScrollbar(),r._resetOrganizationView(),r._buildOrganizationView(),r.elements.orgsLine.addContent(r.elements.scrollXElement),r._resetPeopleView(),r.peopleSelected?(r.elements.peoplesCol.addContent(r._buildPeopleCell(o)),r.elements.contentsCtn.addContent(r._buildContentLine(o))):r._buildPeopleView(),r.orgsCollection.isAlreadyHandling=!1,"fix-content"!==r.elements.contentsCtn.style.width&&(r.elements.contentsCtn.style.width="fit-content"),a.unmask(r.container)},onFailure:function(){r._resetPositionScrollbar(),r.orgsCollection.isAlreadyHandling=!1,a.unmask(r.container),r.errorAlert.add({message:d.get("error.fetchOrganisations")})}};l.classList.contains("primary")?(l.removeClassName("primary"),r.peopleSelected="",t.removeClassName("disabled")):(l.addClassName("primary"),r.peopleSelected=o,i.peopleId=n,t.addClassName("disabled")),r.orgsCollection.fetch(i)},_clickOnAddUsersBtn:function(){var t,n,o,r;t=this.events.onAddUsers,n=this,e.is(t,"function")&&(r?setTimeout((function(){t.apply(n,o)})):t.apply(n,o))},_clickOnCloseViewBtn:function(){this.events.onCloseView()},_getPeopleCell:function(e){return this.elements.peoplesCol.getElement(".people-id-"+e)},_onMouseEnterCell:function(e){var t=this,n=e.target,o=n.getPosition(),r=t.elements,l=n.getData("data");t._unHoverPeopleCell(),t._unHoverContentCell(),r.horizontalHighlight.setStyles({transform:"translateY("+o.y+"px)"}),r.verticalHighlight.setStyles({transform:"translateX("+o.x+"px)"}),t._hoverPeopleCell(t._getPeopleCell(l.peopleId)),t._hoverContentCell(n)},_onScroll:function(){var e=this,t=e.elements.contentsCol,n=t.scrollTop,o=t.scrollLeft;e.rolesDDMenu&&e.rolesDDMenu.destroy(),e._unSelectCell(),n>m?e._onScrollV("down"):n<m&&e._onScrollV("up"),m=n,o>h?e._onScrollH("right"):o<h&&e._onScrollH("left"),h=o},_onScrollV:function(e,t){t=t||{};var n=this.elements,o=n.peoplesCol,r=n.headerLine,l=n.contentsCol;b(o,{top:t.top||l.scrollTop-(t.delta||0),behavior:t.behavior}),r.addClassName("scrolling"),clearTimeout(p),p=setTimeout((function(){r.removeClassName("scrolling")}),750),m=l.scrollTop;var i=l.scrollHeight-l.clientHeight;m/i>.85&&this.peoplesCollection.handleScroll()},_onScrollH:function(e,t){t=t||{};var n,o,r=this.elements,l=r.peoplesCol,i=r.orgsLine,s=r.contentsCol;b(i,{left:t.left||s.scrollLeft-(t.delta||0),behavior:t.behavior}),"left"===e&&l.addClassName("scrolling"),"right"===e&&s.addClassName("scrolling"),clearTimeout(f),f=setTimeout((function(){l.removeClassName("scrolling"),s.removeClassName("scrolling")}),750),n=s.scrollLeft,h=n,(o=i.getElements(".org-cell")).length>1&&(C(o[o.length-2],i),C(o[o.length-1],i));var a=s.scrollWidth-s.clientWidth;h/a>.85&&this.orgsCollection.handleScroll()},_scrollContent:function(t){t=t||{};var n,o,r=this,l=r.elements.contentsCol,i=e.is(t.top,"number")?t.top:void 0,s=e.is(t.left,"number")?t.left:void 0,a=t.behavior,c=e.is(t.delta)?t.delta:void 0,d=t.way,u=c&&("up"===d||"down"===d),g=c&&("right"===d||"left"===d);b(l,{top:n=u&&c?l.scrollTop-c:i,left:o=g&&c?l.scrollLeft-c:s,behavior:a}),(i||u)&&r._onScrollV(d,{top:n,behavior:a}),(s||g)&&r._onScrollH(d,{left:o,behavior:a})},_onAssignmentsChange:function(e){var t=this,n=e.getId(),o=t._getPeopleCell(n);if(e.isGroup()||o.getElement(".memberof-org-ctn").empty().addContent(t._buildPeopleMemberOfInfo(e)),!e.canBeRemovedfromCS(t.currentUser,t.mainOwner)){var r=o.getElement(".people-trash-ctn");r.hasClassName("disabled")||r.addClassName("disabled")}},_onScrollEnd:function(e){for(var t=this.peoplesCollection,n=t.slice(t.length-e),o=0;o<n.length;o++)this.elements.peoplesCol.addContent(this._buildPeopleCell(n[o])),this.elements.contentsCtn.addContent(this._buildContentLine(n[o]))},_onScrollHorizontalEnd:function(e){var t=this.orgsCollection;this.orgsCollection.parseCollection();var n=t.slice(t.length-e);this.elements.scrollXElement.remove();for(var o=0;o<n.length;o++){let e=n[o],t=e.getTitle();this.elements.orgsLine.addContent(this._buildOrganizationCell(e));let r=this.elements.orgsLine.getElement('div[title="'+t+'"]');new s({target:r,body:t,position:"top"}),this.peopleSelected?this._buildContentColWithPeopleSelected(e):this._buildContentCol(e)}"fix-content"!==this.elements.contentsCtn.style.width&&(this.elements.contentsCtn.style.width="fit-content"),this.elements.orgsLine.addContent(this.elements.scrollXElement)},_onScrollFailure:function(){this.errorAlert.add({message:d.get("error.fetchMembers")})},_onScrollHorizontalFailure:function(){this.errorAlert.add({message:d.get("error.fetchOrganisations")})},_resetPeopleView:function(){this.elements.peoplesCol.empty(),this.elements.contentsCtn.empty()},_resetOrganizationView:function(){this.elements.orgsLine.empty(),this.elements.contentsCtn.empty()},_buildOrganizationView:function(){var t=this;t.orgsCollection.parseCollection(),t.orgsCollection.getRoots().forEach((function(n){var o=n.getTitle();t.elements.orgsLine.addContent(e.createElement("div",{class:"org-cell",html:[e.createElement("div",{class:"rootorg-cell",html:[e.createElement("div",{class:"rootorg-ctn",html:[e.createElement("div",{class:"rootorg-name",text:o.toUpperCase(),title:o,styles:{width:138*((n.isVisible()?1:0)+t.orgsCollection.getVisibleChildrenOf(n).length)-5+"px",overflow:"hidden","text-overflow":"ellipsis"}}),e.createElement("div",{class:"rootorg-color "+n.getColor()})]})]}),e.createElement("div",{class:"subsorg-cell",html:t._buildSubOrgCell(n)})]}));var r=t.elements.orgsLine.getElement('div[title="'+n.getTitle()+'"]');new s({target:r,body:o,position:"top"})}))},_buildPeopleView:function(){var e=this;e.peoplesCollection.forEach((function(t){e.elements.peoplesCol.addContent(e._buildPeopleCell(t)),e.elements.contentsCtn.addContent(e._buildContentLine(t))}))},_resetPositionScrollbar:function(){this.elements.contentsCol.scrollTop=0,this.elements.contentsCol.scrollLeft=0}});return O})),define("DS/i3DXPnOMultiOrg/OrganisationsOperator/Collections/Peoples",["UWA/Class/Collection","DS/i3DXPnOMultiOrg/DataProxy","DS/i3DXPnOMultiOrg/OrganisationsOperator/Models/People"],(function(e,t,n){return e.extend({model:n,setup:function(e,t){this._parent(e,t),this.state={hasNextPage:!0,pagenumber:0,pagesize:50},this._pattern=""},setView:function(e){var t=this;t.view=e,t.addEvent("onChange:couples",(function(e){t.view.dispatchEvent("onAssignmentsChange",e)})),t.addEvent("onScrollEnd",(function(e){t.view.dispatchEvent("onScrollEnd",e)})),t.addEvent("onScrollFailure",(function(){t.view.dispatchEvent("onScrollFailure")}))},sync:function(e,n,o){o.ajax=t.request,this._parent.apply(this,[e,n,o])},fetch:function(e){e.getNextPage?e.getNextPage&&(this.state.pagenumber+=1):(this.state.pagenumber=0,this.state.hasNextPage=!0),e.data={pagenumber:this.state.pagenumber,pagesize:this.state.pagesize},e.pattern?(this._pattern=e.pattern,e.data.pattern=this._pattern):this._pattern="",this._parent(e)},parse:function(e,n){var o=e.members;return t.setIsOnPremise(e.isOnPremise),o&&o.length||(this.state.hasNextPage=!1),o},handleScroll:function(){if(!this.isAlreadyHandling){this.isAlreadyHandling=!0;var e=this;if(this.state.hasNextPage){let n={getNextPage:!0,remove:!1,onComplete:function(n,o,r){if(t.isOnPremise())e.isAlreadyHandling=!1,e.dispatchEvent("onScrollEnd",o.members.length);else{e.filterPrivateGroups(o,(function(t){e.isAlreadyHandling=!1,e.dispatchEvent("onScrollEnd",t)}),(function(){e.state.hasNextPage=!1,e.dispatchEvent("onScrollFailure")}))}},onFailure:function(){e.state.hasNextPage=!1,e.dispatchEvent("onScrollFailure")}};this._pattern&&(n.pattern=this._pattern),this.fetch(n)}}},filterPrivateGroups:function(e,n,o){for(var r=[],l=0;l<e.members.length;l++){var i=e.members[l];if(i.group){var s=i.uri;r.push(s)}}if(0===r.length)n(e.members.length);else{var a=this,c={type:"json",method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify({source:["usersgroup"],nresults:50,order_by:"desc",order_field:"relevance",tenant:t.getTenantId(),select_predicate:["ds6w:resourceUid","ds6w:label"],label:"3DSpaceAdv-"+t.getCurrentUser()+"-"+Date.now(),query:'[ds6w:resourceUid]:("'+r.join('" OR "')+'")',with_synthesis:!1,with_synthesis_attribute:!1,locale:t.getCurrentLanguage()}),onComplete:function(t){var o=a._parseSearchResponse(t),l=Object.keys(o);a.map((function(e){var t=e.get("uri");o[t]&&e.set("name",o[t])}));var i=r.filter((function(e){return!l.includes(e)})),s=a.filter((function(e){return i.includes(e.get("uri"))}));a.remove(s),n(e.members.length-s.length)},onFailure:function(){var e=a.filter((function(e){return r.includes(e.get("uri"))}));a.remove(e),o()}};t.request(t.getSearchURL()+"/search",c)}},_parseSearchResponse:function(e){for(var t=e.results||[],n={},o=0;o<t.length;o++){for(var r=t[o].attributes,l="",i="",s=0;s<r.length;s++){var a=r[s];"ds6w:resourceUid"===a.name?(l=a.value)&&-1===l.indexOf("uuid:")&&-1===l.indexOf("dsaccess:")&&(l="<"+(l="uuid:"+l)+">"):"ds6w:label"===a.name&&(i=a.value)}n[l]=i}return n}})})),define("DS/i3DXPnOMultiOrg/OrgOperatorController",["UWA/Core","UWA/Class","UWA/Class/Events","DS/UIKIT/Alert","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/i3DXPnOMultiOrg/OrganisationsOperator/Collections/Orgs","DS/i3DXPnOMultiOrg/OrganisationsOperator/Collections/Peoples","DS/i3DXPnOMultiOrg/OrganisationsOperator/Views/OrganisationsOperator","DS/i3DXPnOMultiOrg/DataProxy","i18n!DS/i3DXPnOMultiOrg/assets/nls/OrganisationsOperator"],(function(e,t,n,o,r,l,i,s,a,c){return t.extend(n,{options:{},container:null,orgsOpView:null,buildSkeleton:function(){var e=this.options;this.container.empty();var t="";e.ownerRestricted&&(t=e.securityContext.split(".")[1]),this.orgsOpView=new s({currentUser:e.currentUser,readOnly:!e.owner,restrictedOrg:t,roles:e.roles,mainOwner:e.mainOwner,collabSpace:e.collabSpaceTitle?e.collabSpaceTitle:e.collabSpace,orgsCollection:e.orgsCollection,peopleCollection:e.peopleCollection,successAlert:this.successAlert,errorAlert:this.errorAlert,events:{onAddUsers:e.onAddUsers||function(){},onRemoveUser:function(e){this.dispatchEvent("onRemoveUser",[e])}.bind(this),onCloseView:e.onCloseView||this.destroy.bind(this)}}),this.orgsOpView.render().inject(this.container),this.successAlert.inject(this.container),this.errorAlert.inject(this.container)},init:function(t){this.options=e.clone(t,!1)||{},this.container=e.extendElement(t.container)},load:function(){var e=this,t=this.options,n=t.collabSpace,s=t.securityContext,d=t.tenantId,u=t.currentUser,g=widget.lang;this.successAlert=new o({className:"message-alert",closable:!0,visible:!0,autoHide:!0,messageClassName:"success"}),this.errorAlert=new o({className:"message-alert",closable:!0,visible:!0,autoHide:!0,messageClassName:"error"}),a.setParams(s,d,u,g),r.getPlatformServices({platformId:d,onComplete:function(o){a.setServicesMap(o);var r=new l([],{url:a.getSpaceURL()+"/resources/pno/collaborativespace/"+n+"/organizations"}),s=new i([],{url:a.getSpaceURL()+"/resources/pno/collaborativespace/"+n+"/members"});r.fetch({onComplete:function(){s.fetch({onComplete:function(n,o){if(a.isOnPremise())t.orgsCollection=r,t.peopleCollection=s,e.buildSkeleton();else{s.filterPrivateGroups(o,(function(){t.orgsCollection=r,t.peopleCollection=s,e.buildSkeleton()}),(function(){e.errorAlert.inject(e.container),e.errorAlert.add({message:c.get("error.fetchMembers")})}))}},onFailure:function(){e.errorAlert.inject(e.container),e.errorAlert.add({message:c.get("error.fetchMembers")})}})},onFailure:function(){e.errorAlert.inject(e.container),e.errorAlert.add({message:c.get("error.fetchOrganisations")})}})},onFailure:function(){e.errorAlert.inject(e.container),e.errorAlert.add({message:c.get("compassError")})}})},refresh:function(){var e=this;e.orgsOpView&&e.orgsOpView.destroy(),e.successAlert&&e.successAlert.destroy(),e.errorAlert&&e.errorAlert.destroy(),e.orgsOpView=null,e.successAlert=null,e.errorAlert=null,e.load()},destroy:function(){var e=this;e.container=null,e.orgsOpView&&e.orgsOpView.destroy(),e.successAlert&&e.successAlert.destroy(),e.errorAlert&&e.errorAlert.destroy(),e.orgsOpView=null,e.successAlert=null,e.errorAlert=null,e.removeEvents()},onAddUsersEnd:function(){this.refresh()}})}));