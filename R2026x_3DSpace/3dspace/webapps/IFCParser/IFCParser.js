define("DS/IFCParser/IFCParser",["DS/CoreEvents/ModelEvents","UWA/Core","DS/Tweakers/TypeRepresentationFactory","DS/XCADLoader/XCADModelLoaderPlug","DS/XCADLoader/XCADError","DS/ZipJS2/ZipJS2","text!DS/IFCParser/assets/IFCEntity.json","i18n!DS/IFCParser/assets/nls/IFCParserNLS"],(function(e,t,r,n,s,i,o,c){let A;const a=["ForLifecycle","ForDesign","ForCoordination"],l=[c.IFC_PARSER_ProfileEnum_ForLifecycle,c.IFC_PARSER_ProfileEnum_ForDesign,c.IFC_PARSER_ProfileEnum_ForCoordination],d=[c.IFC_PARSER_ProfileEnum_ForDesign,c.IFC_PARSER_ProfileEnum_ForCoordination];let E,p=0,u=new Map,f=new i.fs.FS;var P={loadIFC_PLM_Entity:function(){void 0===A&&(A=JSON.parse(o))},getViewAndData:function(e){P.loadIFC_PLM_Entity(),E=!0;var n=new r;n.registerEnum("ifcProfileEnumFull",l),n.registerEnum("ifcProfileEnumLite",d);var s=P.view();return new t.Promise((function(r,n){try{P.results(e).then((function(e){r(t.merge(s,e))})).fail(n)}catch(e){n(e)}}))},updateJsonData:function(e,t){let r=[];for(var n=e.getAllDescendants(),s=0;s<n.length;s++){var i={};for(var o in n[s].options.grid)n[s].options.grid.hasOwnProperty(o)&&(i[o]=n[s].options.grid[o]);r.push(i)}r.forEach((e=>{t.forEach((t=>{t.resourceid===e.resourceid&&Object.assign(t,e)}))}))},results:function(e){return new t.Promise((function(t,r){try{var i,o=void 0;if(i=function(e){r(e)},null!=e.files)if(null!=e.files[0]&&null!=e.files[0].name&&e.files[0].name.toLowerCase().endsWith("ifc")){var c=new FileReader;c.onload=function(){(new n).getProductStructure("ifc",this.result,void 0,i).then((function(e){let r=[];P.fillResults(r,e,i),t({data:{results:r}})}))},c.readAsArrayBuffer(e.files[0])}else{if(null==e.files[0]||null==e.files[0].name||!e.files[0].name.toLowerCase().endsWith("ifczip")){var A=new s;return A.setError("XCADLoader/XCADLoader","error.IFC_UNSUPPORT",null),void(i&&i(A))}f.importBlob(e.files[0]).then((function(){let r=e.files[0].name.substring(e.files[0].name.lastIndexOf("/")+1,e.files[0].name.lenght);r=r.replace(new RegExp("ifcZIP","gi"),"ifc");let s=f.find(r);null==s&&f.entries.length>1&&(s=f.entries[1]),s&&s.getUint8Array().then((e=>{(new n).getProductStructure("ifc",e,void 0,i).then((function(e){let r=[];P.fillResults(r,e,i),t({data:{results:r}})}))}))}))}else if(void 0!==e.arrayBuffer){(new n).getProductStructure("ifc",e.arrayBuffer,void 0,i).then((function(e){let r=[];P.fillResults(r,e,i),t({data:{results:r}})}))}else o=P.sampleresults(),t({data:{results:o}})}catch(e){r(e)}}))},fillResults:function(e,t,r){if(t.rootProducts2.length>0)for(var n=t.rootProducts2.length-1;n>=0;n--){var s=t.rootProducts2[n];P.fillResult(e,s.substring(1),t,r)}},fillResult:function(e,t,r,n){try{var i=void 0,o={};let s=r.ifcEntities[t],d=s.substring(0,s.indexOf("(")),E=s.split("'"),p="";if(E.length>1&&null!=E[1]&&(p=E[1]),"IFCPROJECT"===d){if(r.assyProducts2[t].childrenList.length>0){let s=r.assyProducts2[t].childrenList[0].productReferenceIdx;i=P.fillResult(e,s.substring(1),r,n)}}else{o.resourceid=p,o["ds6w:label"]=d,o.ImportObject=!0,o.name=r.assyProducts2[t].referenceName,"$"===o.name&&(o.name="");let s=!1;s=A.IfcProduct.SPATIAL.includes(d),s&&(o.ConversionStructureNLS=l[0],o.ConversionStructure=a[0]),"IFCALIGNMENT"===d&&(o.ConversionStructureNLS=l[1],o.ConversionStructure=a[1]),"IFCGRID"===d&&(o.ImportObject=!1),e.push(o);let E=0;if(E=r.assyProducts2[t].childrenList.length,E>0){let i=[],d=!1;for(var c=0;c<E;c++){let E,p,u=r.assyProducts2[t].childrenList[c].productReferenceIdx.substring(1),f=r.ifcEntities[u];if(null!=f)if(p=f.substring(0,f.indexOf("(")),s&&null!=p&&!A.IfcProduct.SPATIAL.includes(p)){let s;if(A.IfcProduct.IfcBuildingElements.includes(p))s="IfcBuildingElements";else if(A.IfcProduct.IfcElectricalDomain.includes(p))s="IfcElectricalDomain";else if(A.IfcProduct.IfcHvacDomain.includes(p))s="IfcHvacDomain";else if(A.IfcProduct.OtherDiscipline.includes(p)){let e=r.productTypeMapping[u];s=A.IfcTypeProduct.IfcBuildingElements.includes(e)?"IfcBuildingElements":A.IfcTypeProduct.IfcElectricalDomain.includes(e)?"IfcElectricalDomain":A.IfcTypeProduct.IfcHvacDomain.includes(e)?"IfcHvacDomain":"Other Discipline"}else s="Other Discipline";let f=o;null==i[s]&&(i[s]=P.createFakeRoot(e,s),P.createLink(e,o.resourceid,i[s].resourceid)),f=i[s],0==d&&(o.ConversionStructureNLS=l[1],o.ConversionStructure=a[1]),null==i[s+"_"+p+"S"]&&(i[s+"_"+p+"S"]=P.createFakeRoot(e,p+"S"),P.createLink(e,f.resourceid,i[s+"_"+p+"S"].resourceid)),f=i[s+"_"+p+"S"],E=P.fillResult(e,r.assyProducts2[t].childrenList[c].productReferenceIdx.substring(1),r,n),P.createLink(e,f.resourceid,E.resourceid)}else d=!0,E=P.fillResult(e,r.assyProducts2[t].childrenList[c].productReferenceIdx.substring(1),r,n),P.createLink(e,o.resourceid,E.resourceid);else console.warn("ID: "+u+" not found in file")}}else s&&(o.ConversionStructureNLS=l[1],o.ConversionStructure=a[1]);null==i&&(i=o)}return i}catch(e){var d=new s;return d.setError("XCADLoader/XCADLoader","error.IFC_UNSUPPORT",null),void(n&&n(d))}},createLink:function(e,t,r){var n={resourceid:"LINK_ENTITY"};n.from=t,n.to=r,e.push(n)},createFakeRoot:function(e,t){var r={};let n="FAKE_ENTITIY_"+p++;return r.resourceid=n,r["ds6w:label"]=t,r.ImportObject=!0,r.previewObject=!0,e.push(r),r},sampleresults:function(){var e=[{resourceid:"58DA7E4AE2BE0800665A8BA9001A95E1",type:"AecSite",interface:"XP_VPMReference_Ext,IfcSite,EnterpriseExtension","ds6w:cadMaster":"3DEXPERIENCE",flattenedtaxonomies:"types/PLMEntity,types/PLMReference,types/PLMCoreReference,types/LPAbstractReference,types/PHYSICALAbstractReference,types/VPMReference,types/AecBOAbstract,types/AecSpatialStructureElement,types/AecCommonSpatialStructureElement,types/AecSite,interfaces/XP_VPMReference_Ext,interfaces/IfcSite,interfaces/EnterpriseExtension","ds6w:label":"Baufeld J","ds6w:identifier":"sit-DSQAL050-00000001"},{resourceid:"58DA7E4AE2BE0800665A8BAA001A95E5",type:"Building",interface:"XP_VPMReference_Ext,IfcBuilding,EnterpriseExtension","ds6w:cadMaster":"3DEXPERIENCE",flattenedtaxonomies:"types/PLMEntity,types/PLMReference,types/PLMCoreReference,types/LPAbstractReference,types/PHYSICALAbstractReference,types/VPMReference,types/AecBOAbstract,types/AecSpatialStructureElement,types/BuildingSpatialStructureElement,types/Building,interfaces/XP_VPMReference_Ext,interfaces/IfcBuilding,interfaces/EnterpriseExtension","ds6w:label":"NBH-Haus-J.1","ds6w:identifier":"bld-DSQAL050-00000001"},{resourceid:"58DA7E4AE2BE0800665A8BAA001A95E9",type:"BuildingStorey",interface:"XP_VPMReference_Ext,IfcBuildingStorey,EnterpriseExtension","ds6w:cadMaster":"3DEXPERIENCE",flattenedtaxonomies:"types/PLMEntity,types/PLMReference,types/PLMCoreReference,types/LPAbstractReference,types/PHYSICALAbstractReference,types/VPMReference,types/AecBOAbstract,types/AecSpatialStructureElement,types/BuildingSpatialStructureElement,types/BuildingStorey,interfaces/XP_VPMReference_Ext,interfaces/IfcBuildingStorey,interfaces/EnterpriseExtension","ds6w:label":"Erdgeschoss","ds6w:identifier":"sto-DSQAL050-00000003"},{resourceid:"58DA7E4AE2BE0800665A8BAB001A961F",type:"3DShape",interface:"XCADRepExtension","ds6w:cadMaster":"CATIAV5",flattenedtaxonomies:"types/PLMEntity,types/PLMReference,types/PLMCoreRepReference,types/LPAbstractRepReference,types/LPAbstract3DRepReference,types/PHYSICALAbstract3DRepReference,types/VPMRepReference,types/3DShape,interfaces/XCADRepExtension","ds6w:label":"Subassemblypart1372","ds6w:identifier":"3sh-DSQAL050-00017341"},{resourceid:"58DA7E4AE2BE0800665A8BA9001A95E3",type:"BuildingStorey",interface:"XP_VPMReference_Ext,IfcBuildingStorey,EnterpriseExtension","ds6w:cadMaster":"3DEXPERIENCE",flattenedtaxonomies:"types/PLMEntity,types/PLMReference,types/PLMCoreReference,types/LPAbstractReference,types/PHYSICALAbstractReference,types/VPMReference,types/AecBOAbstract,types/AecSpatialStructureElement,types/BuildingSpatialStructureElement,types/BuildingStorey,interfaces/XP_VPMReference_Ext,interfaces/IfcBuildingStorey,interfaces/EnterpriseExtension","ds6w:label":"Dach","ds6w:identifier":"sto-DSQAL050-00000001"},{resourceid:"58DA7E4AE2BE0800665A8BAB001A9627",type:"3DShape",interface:"XCADRepExtension","ds6w:cadMaster":"CATIAV5",flattenedtaxonomies:"types/PLMEntity,types/PLMReference,types/PLMCoreRepReference,types/LPAbstractRepReference,types/LPAbstract3DRepReference,types/PHYSICALAbstract3DRepReference,types/VPMRepReference,types/3DShape,interfaces/XCADRepExtension","ds6w:label":"Subassemblypart186240","ds6w:identifier":"3sh-DSQAL050-00017342"},{resourceid:"58DA7E4AE2BE0800665A8BAA001A95E7",type:"BuildingStorey",interface:"XP_VPMReference_Ext,IfcBuildingStorey,EnterpriseExtension","ds6w:cadMaster":"3DEXPERIENCE",flattenedtaxonomies:"types/PLMEntity,types/PLMReference,types/PLMCoreReference,types/LPAbstractReference,types/PHYSICALAbstractReference,types/VPMReference,types/AecBOAbstract,types/AecSpatialStructureElement,types/BuildingSpatialStructureElement,types/BuildingStorey,interfaces/XP_VPMReference_Ext,interfaces/IfcBuildingStorey,interfaces/EnterpriseExtension","ds6w:label":"Obergeschoss","ds6w:identifier":"sto-DSQAL050-00000002"},{resourceid:"58DA7E4AE2BE0800665A8BAB001A9607",type:"3DShape",interface:"XCADRepExtension","ds6w:cadMaster":"CATIAV5",flattenedtaxonomies:"types/PLMEntity,types/PLMReference,types/PLMCoreRepReference,types/LPAbstractRepReference,types/LPAbstract3DRepReference,types/PHYSICALAbstract3DRepReference,types/VPMRepReference,types/3DShape,interfaces/XCADRepExtension","ds6w:label":"Subassemblypart126044","ds6w:identifier":"3sh-DSQAL050-00017339"},{resourceid:"58DA7E4AE2BE0800665A8BAA001A95EB",type:"BuildingStorey",interface:"XP_VPMReference_Ext,IfcBuildingStorey,EnterpriseExtension","ds6w:cadMaster":"3DEXPERIENCE",flattenedtaxonomies:"types/PLMEntity,types/PLMReference,types/PLMCoreReference,types/LPAbstractReference,types/PHYSICALAbstractReference,types/VPMReference,types/AecBOAbstract,types/AecSpatialStructureElement,types/BuildingSpatialStructureElement,types/BuildingStorey,interfaces/XP_VPMReference_Ext,interfaces/IfcBuildingStorey,interfaces/EnterpriseExtension","ds6w:label":"Fundament","ds6w:identifier":"sto-DSQAL050-00000004"},{resourceid:"58DA7E4AE2BE0800665A8BAB001A9617",type:"3DShape",interface:"XCADRepExtension","ds6w:cadMaster":"CATIAV5",flattenedtaxonomies:"types/PLMEntity,types/PLMReference,types/PLMCoreRepReference,types/LPAbstractRepReference,types/LPAbstract3DRepReference,types/PHYSICALAbstract3DRepReference,types/VPMRepReference,types/3DShape,interfaces/XCADRepExtension","ds6w:label":"Subassemblypart99","ds6w:identifier":"3sh-DSQAL050-00017340"},{resourceid:"58DA7E4AE2BE0800665A8BB4001A9663",type:"VPMInstance",flattenedtaxonomies:"reltypes/PLMInstance,reltypes/PLMCoreInstance,reltypes/LPAbstractInstance,reltypes/PHYSICALAbstractInstance,reltypes/VPMInstance",from:"58DA7E4AE2BE0800665A8BA9001A95E1",to:"58DA7E4AE2BE0800665A8BAA001A95E5"},{resourceid:"58DA7E4AE2BE0800665A8BB5001A966B",type:"VPMInstance",flattenedtaxonomies:"reltypes/PLMInstance,reltypes/PLMCoreInstance,reltypes/LPAbstractInstance,reltypes/PHYSICALAbstractInstance,reltypes/VPMInstance",from:"58DA7E4AE2BE0800665A8BAA001A95E5",to:"58DA7E4AE2BE0800665A8BAA001A95E9"},{resourceid:"58DA7E4AE2BE0800665A8BB4001A9651",type:"VPMRepInstance",flattenedtaxonomies:"reltypes/PLMInstance,reltypes/PLMCoreRepInstance,reltypes/LPAbstractRepInstance,reltypes/LPAbstract3DRepInstance,reltypes/PHYSICALAbstract3DRepInstance,reltypes/VPMRepInstance",from:"58DA7E4AE2BE0800665A8BAA001A95E9",to:"58DA7E4AE2BE0800665A8BAB001A961F"},{resourceid:"58DA7E4AE2BE0800665A8BB5001A9673",type:"VPMInstance",flattenedtaxonomies:"reltypes/PLMInstance,reltypes/PLMCoreInstance,reltypes/LPAbstractInstance,reltypes/PHYSICALAbstractInstance,reltypes/VPMInstance",from:"58DA7E4AE2BE0800665A8BAA001A95E5",to:"58DA7E4AE2BE0800665A8BA9001A95E3"},{resourceid:"58DA7E4AE2BE0800665A8BB4001A965D",type:"VPMRepInstance",flattenedtaxonomies:"reltypes/PLMInstance,reltypes/PLMCoreRepInstance,reltypes/LPAbstractRepInstance,reltypes/LPAbstract3DRepInstance,reltypes/PHYSICALAbstract3DRepInstance,reltypes/VPMRepInstance",from:"58DA7E4AE2BE0800665A8BA9001A95E3",to:"58DA7E4AE2BE0800665A8BAB001A9627"},{resourceid:"58DA7E4AE2BE0800665A8BB5001A967B",type:"VPMInstance",flattenedtaxonomies:"reltypes/PLMInstance,reltypes/PLMCoreInstance,reltypes/LPAbstractInstance,reltypes/PHYSICALAbstractInstance,reltypes/VPMInstance",from:"58DA7E4AE2BE0800665A8BAA001A95E5",to:"58DA7E4AE2BE0800665A8BAA001A95E7"},{resourceid:"58DA7E4AE2BE0800665A8BB4001A9657",type:"VPMRepInstance",flattenedtaxonomies:"reltypes/PLMInstance,reltypes/PLMCoreRepInstance,reltypes/LPAbstractRepInstance,reltypes/LPAbstract3DRepInstance,reltypes/PHYSICALAbstract3DRepInstance,reltypes/VPMRepInstance",from:"58DA7E4AE2BE0800665A8BAA001A95E7",to:"58DA7E4AE2BE0800665A8BAB001A9607"},{resourceid:"58DA7E4AE2BE0800665A8BB5001A9683",type:"VPMInstance",flattenedtaxonomies:"reltypes/PLMInstance,reltypes/PLMCoreInstance,reltypes/LPAbstractInstance,reltypes/PHYSICALAbstractInstance,reltypes/VPMInstance",from:"58DA7E4AE2BE0800665A8BAA001A95E5",to:"58DA7E4AE2BE0800665A8BAA001A95EB"},{resourceid:"58DA7E4AE2BE0800665A8BB4001A964B",type:"VPMRepInstance",flattenedtaxonomies:"reltypes/PLMInstance,reltypes/PLMCoreRepInstance,reltypes/LPAbstractRepInstance,reltypes/LPAbstract3DRepInstance,reltypes/PHYSICALAbstract3DRepInstance,reltypes/VPMRepInstance",from:"58DA7E4AE2BE0800665A8BAA001A95EB",to:"58DA7E4AE2BE0800665A8BAB001A9617"},{Path:["58DA7E4AE2BE0800665A8BA9001A95E1","58DA7E4AE2BE0800665A8BB4001A9663","58DA7E4AE2BE0800665A8BAA001A95E5","58DA7E4AE2BE0800665A8BB5001A966B","58DA7E4AE2BE0800665A8BAA001A95E9","58DA7E4AE2BE0800665A8BB4001A9651","58DA7E4AE2BE0800665A8BAB001A961F"]},{Path:["58DA7E4AE2BE0800665A8BA9001A95E1","58DA7E4AE2BE0800665A8BB4001A9663","58DA7E4AE2BE0800665A8BAA001A95E5","58DA7E4AE2BE0800665A8BB5001A9673","58DA7E4AE2BE0800665A8BA9001A95E3","58DA7E4AE2BE0800665A8BB4001A965D","58DA7E4AE2BE0800665A8BAB001A9627"]},{Path:["58DA7E4AE2BE0800665A8BA9001A95E1","58DA7E4AE2BE0800665A8BB4001A9663","58DA7E4AE2BE0800665A8BAA001A95E5","58DA7E4AE2BE0800665A8BB5001A967B","58DA7E4AE2BE0800665A8BAA001A95E7","58DA7E4AE2BE0800665A8BB4001A9657","58DA7E4AE2BE0800665A8BAB001A9607"]},{Path:["58DA7E4AE2BE0800665A8BA9001A95E1","58DA7E4AE2BE0800665A8BB4001A9663","58DA7E4AE2BE0800665A8BAA001A95E5","58DA7E4AE2BE0800665A8BB5001A9683","58DA7E4AE2BE0800665A8BAA001A95EB","58DA7E4AE2BE0800665A8BB4001A964B","58DA7E4AE2BE0800665A8BAB001A9617"]}],t=["For ForCoordination","For Design"];return e.forEach((e=>{e.from||e.Path||(e.ImportObject=!0,e.ConversionStructure=t[Math.floor(t.length*Math.random(t.length))])})),e},getCSFromNLS:function(e){return e===l[0]?a[0]:e==l[1]?a[1]:a[2]},onNodeModelUpdate:function(e){if(!e||!e.attributes)return;e.nodeModel.options.grid.ConversionStructure=P.getCSFromNLS(e.nodeModel.options.grid.ConversionStructureNLS);let t=e.nodeModel;var r;if(null!=e.attributes.ImportObject&&null!=(r=t.getChildren()))for(var n=0;n<r.length;n++){var s=void 0;"IFCGRID"!==r[n].options.grid["ds6w:label"]&&(s=void 0===r[n].options.grid.ConversionStructureNLS?{grid:{ImportObject:t.options.grid.ImportObject}}:{grid:{ImportObject:t.options.grid.ImportObject,ConversionStructureNLS:t.options.grid.ConversionStructureNLS,ConversionStructure:t.options.grid.ConversionStructure}},r[n].updateOptions(s))}if(null!=e.attributes.ConversionStructureNLS&&null!=(r=t.getChildren()))for(n=0;n<r.length;n++)if(null!=r[n].options.grid.ConversionStructureNLS){let o,c,A=!1;if(e.attributes.ConversionStructureNLS===l[0]){var i=r[n].getChildren();if(null!=i&&i.length>0){let e=0;for(;e<i.length&&null!=i[e].options.grid.ConversionStructureNLS;)e++;0==e&&(A=!0)}}A?(o=a[1],c=l[1]):(o=t.options.grid.ConversionStructure,c=t.options.grid.ConversionStructureNLS),s={grid:{ConversionStructure:o,ConversionStructureNLS:c}},r[n].updateOptions(s)}},view:function(){var t=new e;return t.subscribe({event:"nodeModelUpdate"},(function(e){"nodeModelUpdate"===e.event&&e.data&&e.data.nodeModel&&P.onNodeModelUpdate(e.data)})),{modelEvents:t,view:{datagrid:{columns:[{dataIndex:"tree",text:c.IFC_PARSER_DataGrid_Column_Tree},{dataIndex:"name",text:c.IFC_PARSER_DataGrid_Column_Name,typeRepresentation:"string",getCellSemantics:function(e){0==u.has(e.nodeModel.options.grid.resourceid)&&e.nodeModel.options.grid.ConversionStructureNLS!==l[1]?(u.set(e.nodeModel.options.grid.resourceid,1),e.nodeModel.expand()):u.set(e.nodeModel.options.grid.resourceid,2)}},{dataIndex:"ImportObject",text:c.IFC_PARSER_DataGrid_Column_ImportObject,editableFlag:!0,editionPolicy:"EditionInPlace",typeRepresentation:"boolean",getCellSemantics:function(e){return"IFCSITE"===e.nodeModel.options.grid["ds6w:label"]||"IFCGRID"===e.nodeModel.options.grid["ds6w:label"]?{disabled:!0}:{disabled:!e.nodeModel._parentNode.options.grid.ImportObject}}},{dataIndex:"ConversionStructureNLS",text:c.IFC_PARSER_DataGrid_Column_ConversionStructure,editableFlag:!0,editionPolicy:"EditionInPlace",massUpdateAllowedFlag:!1,getCellTypeRepresentation(e){let t="ifcProfileEnumLite";if(null!=e.nodeModel&&("IFCALIGNMENT"===e.nodeModel.options.grid["ds6w:label"]&&(t="ifcProfileEnumFull"),A.IfcProduct.SPATIAL.includes(e.nodeModel.options.grid["ds6w:label"])&&null!=e.nodeModel.options.children))for(var r=0;r<e.nodeModel.options.children.length;r++)A.IfcProduct.SPATIAL.includes(e.nodeModel.options.children[r]._options.label)&&(t="ifcProfileEnumFull");return t},getCellSemantics:function(e){return e.nodeModel.options.grid.ConversionStructureNLS===d[0]&&e.nodeModel._parentNode.options.grid.ConversionStructureNLS===d[0]||e.nodeModel.options.grid.ConversionStructureNLS===d[1]&&e.nodeModel._parentNode.options.grid.ConversionStructureNLS===d[1]?{disabled:!0}:A.IfcProduct.SPATIAL.includes(e.nodeModel.options.grid["ds6w:label"])?{disabled:!1}:void 0}}]}}}}};return P}));