define("DS/AccessRightWidget/AccessRightModel",["UWA/Controls/Abstract"],(function(e){return e.extend({init:function(e){this._RightList=[],this._DataList=[],this._ObjectId=e,this._ownerId="",this._projId="",this._orgId="",this._userGrpId="",this._objectType=""},setPOV:function(e,t,n,r){this._ownerId=e,this._projId=t,this._orgId=n,this._userGrpId=r},getOwnerId:function(){return this._ownerId},getProjId:function(){return this._projId},getOrgId:function(){return this._orgId},getUserGrpId:function(){return this._userGrpId},getObjectType:function(){return this._objectType},setRightList:function(e){this._RightList=e},setDataList:function(e){this._DataList=e},setObjectId:function(e){this._ObjectId=e},setObjectType:function(e){this._objectType=e},getRightList:function(){return this._RightList},getDataList:function(){return this._DataList},getObjectId:function(){return this._ObjectId}})})),define("DS/AccessRightWidget/AccessRightController",["UWA/Controls/Abstract","UWA/Json","DS/AccessRightWidget/AccessRightModel","DS/WidgetServices/WidgetServices","DS/WAFData/WAFData","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/ENOCollabToolsUI/tracker/ENOCollabTrackerBackEnd","i18n!DS/AccessRightWidget/assets/nls/langAR"],(function(e,t,n,r,i,o,s,a){var c=r.getProdLevel();return e.extend({defaultOptions:{uniqueRightList:!1,wintop:!1,client_app_domain:null,client_app_name:null,serverName:"",serverUri:"",isReadOnly:!1,odtMode:!1,parent:null},init:function(e,t){c=r.getProdLevel(),this.widget=e,this.AccessRightModelList=[],this.ECToParentMap=JSON.parse("[]"),this.IdToECMap=JSON.parse("[]"),this.SelectedItemsMap=JSON.parse("[]"),this.ExistingECItemsMap=JSON.parse("[]"),this.AggrItemsMap=JSON.parse("[]"),this.ErrorExistingECAndAggrItemsMap=JSON.parse("[]"),this.SelectedItems=[],this.SelectedItemsTypeMap=JSON.parse("[]"),this.NonEmbeddedComponentList=[],this._bInitDatas=!1,this._options=t,this._parent(t),this.accessLogicalNlsMap={},this.listOfInvalidIDs=[],this.LifecycleConfidentialityEnabled=!1},getRightList:function(e){var t=[];return 1==this.options.uniqueRightList?this.AccessRightModelList.length>0&&(t=this.AccessRightModelList[0].getRightList()):this.AccessRightModelList.every((function(n){return n.getObjectId()!=e||(t=n.getRightList(),!1)})),t},getFormattedRightList:function(e){var t=this.getRightList(e),n=[];return t.forEach((function(e,t){var r={label:e.nls,value:e.logical};n.push(r)})),n},getAccessNls:function(e){return this.accessLogicalNlsMap[e]},getOwnership:function(e){var t=[];return this.AccessRightModelList.every((function(n){return n.getObjectId()!=e||(t=n.getDataList(),!1)})),t},isInherited:function(e,t){var n=this.getOwnershipFromOwner(e,t),r=!1;return null!=n&&n.hasOwnProperty("inheritedPath")&&n.inheritedPath.length>0&&(r=!0),r},getOwner:function(e,t){var n=this.getOwnershipFromOwner(e,t);return null==n?null:n.owner},getOwnershipFromOwner:function(e,t){var n=this.getOwnership(e),r=null,i=this;return n.every((function(e){return 1!=i.ownerAreSame(e.owner,t).same||(r=e,!1)})),r},getFusionOwnership:function(){var e=this,t=[];return e.options.odtMode&&this.AccessRightModelList.length>0&&(this.AccessRightModelList[0]._DataList[0]={owner:{comment:"-",person:{personID:"svc_qauser1_PRJ",personFullName:"Mr svc_qauser1",personFirstName:"Mr",personLastName:"svc_qauser1"},collabSpace:{collabSpaceID:"TestCollabSpace1"},organization:{orgID:"Company Name"}},access:{logical:"Basic"},inheritedPath:[]}),this.AccessRightModelList.forEach((function(n,r){var i=n.getDataList();if(0==r)i.forEach((function(e){t.push({ownership:e,isTrueComment:!0,inheritedPath:!0})}));else{var o=[];t.forEach((function(t){element=t.ownership,i.every((function(n){if(element.access.logical==n.access.logical){var r=e.ownerAreSame(element.owner,n.owner);if(1==r.same){if(0==t.hasOwnProperty("isTrueComment")&&(t.isTrueComment=!0),0==r.sameComment&&(element.owner.comment=UWA.i18n("DifferentFromItem"),t.isTrueComment=!1),0==t.hasOwnProperty("isTrueInheritedPath")&&(t.isTrueInheritedPath=!0),1==t.isTrueInheritedPath){var i=!0;if(1==element.hasOwnProperty("inheritedPath")||1==n.hasOwnProperty("inheritedPath")?1==element.hasOwnProperty("inheritedPath")&&1==n.hasOwnProperty("inheritedPath")?((element.inheritedPath.length<=0||n.inheritedPath.length<=0)&&(t.isAllInherit=!1),i=e.inheritedPathAreSame(element.inheritedPath,n.inheritedPath)):i=!1:element.isAllInherit=!1,0==i){var s=[{inheritedFrom:{objectID:"undefined",objectTNR:UWA.i18n("DifferentFromItem")},inheritedAccess:{logical:UWA.i18n("DifferentFromItem")}}];element.inheritedPath=s}}return o.push(t),!1}}return!0}))})),t=o}})),t},inheritedPathAreSame:function(e,t){var n=!0;if(e.length==t.length){var r=t.slice();e.every((function(e){var t=!1;return r.every((function(n,i){return e.inheritedFrom.objectID!=n.inheritedFrom.objectID||(r.splice(i,1),t=!0,!1)})),0!=t||(n=!1,!1)}))}else n=!1;return n},ownerAreSame:function(e,t){var n=!0,r=!1;return(e.hasOwnProperty("person")||t.hasOwnProperty("person"))&&(e.hasOwnProperty("person")&&t.hasOwnProperty("person")?e.person.personID!=t.person.personID&&(n=!1):n=!1),(1==n&&e.hasOwnProperty("collabSpace")||t.hasOwnProperty("collabSpace"))&&(e.hasOwnProperty("collabSpace")&&t.hasOwnProperty("collabSpace")?e.collabSpace.collabSpaceID!=t.collabSpace.collabSpaceID&&(n=!1):n=!1),(1==n&&e.hasOwnProperty("organization")||t.hasOwnProperty("organization"))&&(e.hasOwnProperty("organization")&&t.hasOwnProperty("organization")?e.organization.orgID!=t.organization.orgID&&(n=!1):n=!1),(1==n&&e.hasOwnProperty("userGrp")||t.hasOwnProperty("userGrp"))&&(e.hasOwnProperty("userGrp")&&t.hasOwnProperty("userGrp")?e.userGrp.userGrpID!=t.userGrp.userGrpID&&(n=!1):n=!1),(1==n&&e.hasOwnProperty("group")||t.hasOwnProperty("group"))&&(e.hasOwnProperty("group")&&t.hasOwnProperty("group")?e.group.groupURI!=t.group.groupURI&&(n=!1):n=!1),(e.hasOwnProperty("comment")||t.hasOwnProperty("comment"))&&e.hasOwnProperty("comment")&&t.hasOwnProperty("comment")&&e.comment==t.comment&&(r=!0),{same:n,sameComment:r}},_accessListSame:function(e,t){if(returnedValue=!0,e.length!=t.length)returnedValue=!1;else{var n=t.slice(),r=!0;e.every((function(e){var t=!1;return n.every((function(r,i){return e.logical!=r.logical||(t=!0,n.splice(i,1),!1)})),0!=t||(r=!1,!1)})),0==r&&(returnedValue=!1)}return returnedValue},onLoad:function(){this.AccessRightModelList=[],this.widget=widget,this.AccessRightModelList=[],this.ECToParentMap=JSON.parse("[]"),this.IdToECMap=JSON.parse("[]"),this.SelectedItemsMap=JSON.parse("[]"),this.ExistingECItemsMap=JSON.parse("[]"),this.AggrItemsMap=JSON.parse("[]"),this.ErrorExistingECAndAggrItemsMap=JSON.parse("[]"),this.SelectedItems=[],this.SelectedItemsTypeMap=JSON.parse("[]"),this.NonEmbeddedComponentList=[],this._bInitDatas=!1},getCurrentSelectedItems:function(){var e=[];return this.AccessRightModelList.forEach((function(t){e.push({objectID:t.getObjectId()})})),e},isPovOwner:function(e,t){var n=this._getModel(e);return null!=n&&n.getOwnerId()==t},isPovCollabSpace:function(e,t,n){var r=this._getModel(e);return null!=r&&(r.getProjId()==t&&r.getOrgId()==n)},isPovUserGroup:function(e,t){var n=this._getModel(e);return null!=n&&n.getUserGrpId()==t},_getModel:function(e){for(var t=0;t<this.AccessRightModelList.length;t++){var r=this.AccessRightModelList[t];if(r.getObjectId()==e)return r}var i=new n(e);return this.AccessRightModelList.push(i),i},flatten:function(e){var t=this;return e.reduce((function(e,n){return e.concat(Array.isArray(n)?t.flatten(n):n)}),[])},parseResponse:function(e){let t=[];if(!UWA.is(e.collabspaces,"array"))return t;let n=[...new Set(this.flatten(e.collabspaces.map((e=>e.couples.map((e=>e.organization.name))))))].length>1;return e.collabspaces.forEach((e=>{e.couples.forEach((r=>{var i=null==r.role.nls||""==r.role.nls?r.role.name:r.role.nls,o=r.role.name,s=r.organization.name,a=r.organization.title,c=e.name,l=e.title?e.title:e.name;let d=n?l+" ● "+a+" ● "+i:l+" ● "+i,h="ctx::"+o+"."+s+"."+c;t.push({displayName:d,ctx:h})}))})),t.sort(((e,t)=>e.displayName.localeCompare(t.displayName,void 0,{numeric:!0,sensitivity:"base"})))},_fillAttributesOfSelectedItems:function(e,t,n){for(var r=[],i=e.length,o=[],s=0;s<i;s++)o.push(e[s].physicalId);for(var a=o.length,c=0;c<a;c++){var l=o[c];r.push(l)}var d=r;this._post2("/resources/accessRightServices/ar/getAttributesForAccessRights",d,(function(e,n){t(e,n)}),(function(e){n(e)}))},_fillModels:function(e){for(var t=this,n=e.length,r=0;r<n;r++){var i=e[r];if(null!==i){var o=t._getModel(i.physicalId);null!=o&&(t.IdToECMap[i.physicalId]=i.v_IsEmbeddedComponent,t.SelectedItemsMap[i.physicalId]=i,t.SelectedItemsTypeMap[i.type]=i,o.setPOV(i.owner+"_PRJ",i.project,i.organization),o.setObjectType(i.type))}}if(t.SelectedItems=e.splice(0),0==t._bInitDatas){var s=[];t._bInitDatas=!0,t.AccessRightModelList.forEach((function(e){t.NonEmbeddedComponentList.push(e.getObjectId()),s.push({objectID:e.getObjectId()})})),t._getAccessListForIds(s)}},_getSecurityContext:function(e,t){o.getInstance().getSecurityContext({onSuccess:function(t){var n="";null!=t&&null!=t.SecurityContext&&0!=(n=t.SecurityContext).indexOf("ctx::")&&(n="ctx::"+n),e(n)},onFailure:function(e){t(e)}})},_post2:function(e,n,i,o){var s=this;datasString=t.encode({requests:n}),this._getSecurityContext((function(t){r.get3DSpaceUrlAsync({onComplete:function(n){var c=n+e,l={Accept:"application/json","Content-Type":"application/json"};l.SecurityContext=encodeURIComponent(t),l["Accept-Language"]=widget.lang;var d=r.getTenantID();d&&0!=d.length?c+="?tenant="+d:c+="?tenant=OnPremise",r.partitionedAuthenticatedRequest(c,{method:"POST",headers:l,timeout:864e5,cancelCallback:function(){return!1},partisionedProgressLabel:a.get("AR_FilteringAttributes"),progressBarContext:s.options.contextArea1,progressBarWaitContext:s.options.progressBarWaitContext,data:datasString,type:"json",onComplete:function(e){i(e,n)},onFailure:function(e){o(e)},onTimeout:function(){o("timeout")}})},serverUrl:s.options.serverUrl,wintop:s.options.wintop})}),(function(e){o(e)}))},_post3:function(e,t,n,i){var o=this;this._getSecurityContext((function(s){r.get3DSpaceUrlAsync({onComplete:function(c){var l=c+e,d={Accept:"application/json","Content-Type":"application/json"};d.SecurityContext=encodeURIComponent(s);var h=r.getTenantID();h&&0!=h.length?l+="?tenant="+h:l+="?tenant=OnPremise",r.partitionedAuthenticatedRequest(l,{method:"POST",headers:d,timeout:864e5,cancelCallback:function(){return!1},partisionedProgressLabel:a.get(""),progressBarContext:o.options.contextArea1,progressBarWaitContext:o.options.progressBarWaitContext,data:t,type:"json",onComplete:function(e){n(e)},onFailure:function(e){i(e)},onTimeout:function(){i("timeout")}})},serverUrl:o.options.serverUrl,wintop:o.options.wintop})}),(function(e){i(e)}))},_get:function(e,t,n,o){var s=this;this._getSecurityContext((function(o){r.get3DSpaceUrlAsync({onComplete:function(a){var l=a+e,d={Accept:"application/json","Content-Type":"application/json"};d.SecurityContext=encodeURIComponent(o);var h=r.getTenantID();h&&0!=h.length?l+="?tenant="+h:l+="?tenant=OnPremise",t.hasOwnProperty("current")&&t.hasOwnProperty("select")&&(l+="&current="+t.current+"&select="+t.select);var p="";2==c&&(p="passport"),i.authenticatedRequest(l,{type:"json",method:"GET",headers:d,proxy:p,data:"",onComplete:function(e){n(e)},onFailure:function(e,t,n){s._onFailure(e,t,n)},onTimeout:function(){s._onTimeoutAvailability(items)}})},serverUrl:s.options.serverUrl,wintop:s.options.wintop})}),(function(e){o(e)}))},_onFailure:function(e,t,n){var r={};r=null!=t&&t.hasOwnProperty("error")?t.error:{message:UWA.i18n("UnknownError"),code:"ERROR"},this.dispatchEvent("onError",r)},_onTimeout:function(){var e={message:UWA.i18n("ErrorTimeOut"),code:"TO"};this.dispatchEvent("onError",e)},_getAccessListForIds:function(e){var n=this,i=[];if(null!=n.SelectedItemsTypeMap){Object.keys(n.SelectedItemsTypeMap).map((function(e){return n.SelectedItemsTypeMap[e]})).forEach((function(e){null!=e&&i.push({objectID:e.physicalId})}))}this.options.serverName,this.options.serverUri;this._getSecurityContext((function(o){r.get3DSpaceUrlAsync({onComplete:function(s){var l="",d=r.getRealPath("assets/dataRightList.json",n.widget),h="GET",p="";2==c&&(p="passport"),2==c&&(l='{ "businessObject": '+t.encode(i)+"}",d=s+"/resources/pno/ownership/logicalaccess",h="POST"),headers={Accept:"application/json"},headers["Content-Type"]="application/json",headers["Accept-Language"]=widget.lang,headers.SecurityContext=encodeURIComponent(o),n.RightList=[];var u=r.getTenantID();u&&0!=u.length?d+="?tenant="+u:d+="?tenant=OnPremise",r.partitionedAuthenticatedRequest(d,{type:"json",method:h,headers:headers,proxy:p,cancelCallback:function(){return!1},partisionedProgressLabel:a.get("AR_DeterminingAccessRights"),progressBarContext:n.options.contextArea1,progressBarWaitContext:n.options.progressBarWaitContext,data:l,timeout:864e5,onComplete:function(t){n._onCompleteGetAccessListForIds(t,e)},onFailure:function(e,t,r){n._onFailure(e,t,r)},onTimeout:function(){n._onTimeout()}})},serverUrl:n.options.serverUrl,wintop:n.options.wintop})}),(function(e){onError(e)}))},_onCompleteGetAccessListForIds:function(e,n){var i=this;if(1==e.success){var o={Accept:"application/json","Content-Type":"application/json"};i.RightList=[];var s=r.getRealPath("assets/dataUserStandAlone.json",i.widget),l="GET",d="",h="";2==c&&(d="passport"),this._getSecurityContext((function(p){r.get3DSpaceUrlAsync({onComplete:function(u){if(2==c){i.options.serverName,i.options.serverUri;h='{ "businessObject": '+t.encode(n)+"}",s=u+"/resources/pno/ownership",l="POST"}var g=e.accessList,m=null,f=[],v=-1,I=-1;if(g.every((function(e,t,n){e.access.forEach((function(e){(0==i.LifecycleConfidentialityEnabled&&"ReaderR"!=e.logical||i.LifecycleConfidentialityEnabled)&&(i.accessLogicalNlsMap[e.logical]=e.nls)})),e.access.forEach((function(t){0!=i.LifecycleConfidentialityEnabled||"ReaderR"!==t.logical||e.access.erase(t)}));var r=e.objectID,o=i.SelectedItemsMap[r],s=null;if(null!=o&&(s=o.type),i.AccessRightModelList.every((function(t,n){return I=n,t.getObjectType()!=s||(t.setRightList(e.access),itemFound=!0,!1)})),1==itemFound&&1==i.options.uniqueRightList){var a=!0;if(0==i.AccessRightModelList.length&&t>0&&v>=0?a=i._accessListSame(f[v].getRightList(),e.access):i.AccessRightModelList.length>0&&(a=i._accessListSame(i.AccessRightModelList[0].getRightList(),e.access)),0==a)return m={message:UWA.i18n("ErrorDismatchAccessList"),code:""},i.dispatchEvent("onError",m),i.dispatchEvent("onDataLoaded"),!1;v=I}return!0})),null==m){o["Accept-Language"]=widget.lang,o.SecurityContext=encodeURIComponent(p);var A=r.getTenantID();A&&0!=A.length?s+="?tenant="+A:s+="?tenant=OnPremise",r.partitionedAuthenticatedRequest(s,{type:"json",method:l,headers:o,proxy:d,cancelCallback:function(){return!1},partisionedProgressLabel:a.get("AR_RetrievingOwnershipInformation"),progressBarContext:i.options.contextArea1,progressBarWaitContext:i.options.progressBarWaitContext,data:h,timeout:864e5,onComplete:function(e){i._onCompleteDataList(e)},onFailure:function(e,t,n){i._onFailure(e,t,n)},onTimeout:function(){i._onTimeout()}})}},serverUrl:i.options.serverUrl,wintop:i.options.wintop})}),(function(e){onError(e)}))}else e.hasOwnProperty("error")&&i.dispatchEvent("onError",e.error)},_onCompleteDataList:function(e){var t=this;1==e.success?(e.ownershipVector.forEach((function(e){t.AccessRightModelList.every((function(t){return t.getObjectId()!=e.objectID||(t.setDataList(e.ownership),!1)}))})),t.dispatchEvent("onDataLoaded")):e.hasOwnProperty("error")&&t.dispatchEvent("onError",e.error)},modifyDataWithSC:function(e,n,i){var o=this,l={Accept:"application/json","Content-Type":"application/json"};if(null!=i&&""!=i&&i.hasOwnProperty("SecurityContext")){0!=i.SecurityContext.indexOf("ctx::")&&"ctx::",l.SecurityContext=encodeURIComponent(i.SecurityContext);var d=o.getAggrItemList();if(e.length>0&&null!=d){var h=[],p=Object.keys(d);e.length>0&&p.forEach((function(t){var n={objectID:t,ownership:e[0].ownership};h.push(n),e.push(n)}))}this.options.serverName,this.options.serverUri;for(var u=[],g=0;g<n.length;g++)u.indexOf(n[g])<0&&u.push(n[g]);r.get3DSpaceUrlAsync({onComplete:function(n){var d="POST",h="",p=r.getRealPath("assets/validModification.json",o.widget),g={requests:u},m={UXName:"Share",UXSub:"WebInWin",isWebInWin:o.options.wintop,client_app_domain:o.options.client_app_domain,client_app_name:o.options.client_app_name};s.enrichRequestWithMetricsWebInWin(g,m);var f=t.encode(g);2==c&&(h="passport");2==c&&(p=n+"/resources/accessRightServices/ar/getCompletedData",d="POST"),l["Accept-Language"]=widget.lang;var v=r.getTenantID();v&&0!=v.length?p+="?tenant="+v:p+="?tenant=OnPremise",r.partitionedAuthenticatedRequest(p,{type:"json",method:d,proxy:h,headers:l,cancelCallback:function(){return!1},partisionedProgressLabel:a.get("AR_FindingRelatedObjects"),progressBarContext:o.options.contextArea2,progressBarWaitContext:o.options.progressBarWaitContext,data:f,timeout:864e5,onComplete:function(t){for(var n=0;n<t.results.length;n++)if(null!=t.results[n].invalidList&&t.results[n].invalidList.length>0){t.results[n].invalidList.forEach((function(t){void 0!==o.SelectedItemsMap[t]&&null!==o.SelectedItemsMap[t]&&(o.ErrorExistingECAndAggrItemsMap[t]=o.SelectedItemsMap[t]);for(var n=0;n<e.length;n++)e[n].objectID===t&&e.splice(n,1)}))}else if(null!=t.results[n].validList&&t.results[n].validList.length>0){var r=[];r=t.results[n].validList,expandedOwnershipItems=[],r.forEach((function(t){null!=o.SelectedItemsMap[t]&&null!==o.SelectedItemsMap[t]||null!=o.AggrItemsMap[t]&&null!==o.AggrItemsMap[t]||e.length>0&&expandedOwnershipItems.push({objectID:t,ownership:e[0].ownership})})),expandedOwnershipItems.forEach((function(t){e.push(t)}))}o.getAndAddAggregatedItemsForUpdate(e,i)},onFailure:function(e,t,n){o._onFailure(e,t,n)},onTimeout:function(){o._onTimeout()}})},serverUrl:o.options.serverUrl,wintop:o.options.wintop})}else{var m={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};o.dispatchEvent("onError",m)}},getAndAddAggregatedItemsForUpdate:function(e,n){for(var i=this,o=[],s=0;s<i.NonEmbeddedComponentList.length;s++)o.indexOf(i.NonEmbeddedComponentList[s])<0&&o.push(i.NonEmbeddedComponentList[s]);var l={Accept:"application/json","Content-Type":"application/json"};if(null!=n&&""!=n&&n.hasOwnProperty("SecurityContext")){0!=n.SecurityContext.indexOf("ctx::")&&"ctx::",l.SecurityContext=encodeURIComponent(n.SecurityContext);this.options.serverName,this.options.serverUri;r.get3DSpaceUrlAsync({onComplete:function(s){var d="GET",h="",p=r.getRealPath("assets/validModification.json",i.widget);2==c&&(h="passport");2==c&&(p=s+"/resources/accessRightServices/ar/getAggrList",d="PUT");var u=t.encode({requests:o});l["Accept-Language"]=widget.lang;var g=r.getTenantID();g&&0!=g.length?p+="?tenant="+g:p+="?tenant=OnPremise",r.partitionedAuthenticatedRequest(p,{type:"json",method:d,proxy:h,headers:l,cancelCallback:function(){return!1},responseArray:function(e){return e.results.aggrItems},responseArrayMerge:function(e,t){return e.results.aggrItems=t,e},partisionedProgressLabel:a.get("AR_FindingAgregateItems"),progressBarContext:i.options.contextArea2,progressBarWaitContext:i.options.progressBarWaitContext,data:u,timeout:864e5,onComplete:function(t){var r={};if(null!==t.results.aggrItems&&t.results.aggrItems.length>0){var o=[];o=t.results.aggrItems,expandedOwnershipItems=[],o.forEach((function(t){null!=i.SelectedItemsMap[t.physicalId]&&null!==i.SelectedItemsMap[t.physicalId]||(t.hasOwnProperty("relatedSelectedObj")&&(r[t.physicalId]=t.relatedSelectedObj),e.length>0&&expandedOwnershipItems.push({objectID:t.physicalId,ownership:e[0].ownership}))})),expandedOwnershipItems.forEach((function(t){e.push(t)}))}for(var s=!1,a=0;a<e.length;a++){for(var c=0;c<e[a].ownership.length;c++)if(e[a].ownership[c].hasOwnProperty("access")&&"ReaderR"===e[a].ownership[c].access.logical){s=!0;break}if(s)break}s?i.targetAlreadyHasAccess(e,n,r):i.commitWithSCPCS(e,n)},onFailure:function(e,t,n){i._onFailure(e,t,n)},onTimeout:function(){i._onTimeout()}})},serverUrl:i.options.serverUrl,wintop:i.options.wintop})}else{var d={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};this.setError(d)}},targetAlreadyHasAccess:function(e,t,n){for(var r=this,i=[],o=0;o<e.length;o++){for(var s=[],a=0;a<e[o].ownership.length;a++)if(e[o].ownership[a].owner.hasOwnProperty("person")){var c=e[o].ownership[a].owner.person.personID;"_PRJ"===c.substring(c.length-4,c.length)&&(c=c.substring(0,c.length-4)),s.push(c)}var l=r.SelectedItemsMap[e[o].objectID],d="",h="";if(null!=l&&(d=l.organization,h=l.project),void 0===r.SelectedItemsMap[e[o].objectID]&&void 0!==n[e[o].objectID]){var p=n[e[o].objectID];l=r.SelectedItemsMap[p]}var u={objectid:e[o].objectID,organization:d,project:h,users:s};i.push(u)}this._post2("/resources/accessRightServices/ar/alreadyHasAccess",i,(function(n,i){for(var o=[],s=0;s<e.length;s++)if(n.results.hasOwnProperty(e[s].objectID)){o=n.results[e[s].objectID];for(var a=0;a<e[s].ownership.length;a++)if(e[s].ownership[a].owner.hasOwnProperty("person"))for(var c=0;c<o.length;c++){o[c]+"_PRJ"==e[s].ownership[a].owner.person.personID&&"ADD"==e[s].ownership[a].operation&&"ReaderR"==e[s].ownership[a].access.logical&&r.LifecycleConfidentialityEnabled&&(e[s].ownership[a].access.logical="Reader")}}r.commitWithSCPCS(e,t)}),(function(e){onError(e)}))},commitWithSCPCS:function(e,n){var i=this,o={Accept:"application/json","Content-Type":"application/json"};if(null!=n&&""!=n&&n.hasOwnProperty("SecurityContext")){0!=n.SecurityContext.indexOf("ctx::")&&"ctx::",o.SecurityContext=encodeURIComponent(n.SecurityContext);this.options.serverName,this.options.serverUri;this._getSecurityContext((function(n){r.get3DSpaceUrlAsync({onComplete:function(s){var l="",d=r.getRealPath("assets/validModification.json",i.widget);2==c&&(l="passport"),2==c&&(d=s+"/resources/pno/ownership/update");var h='{ "ownershipVector": '+t.encode(e)+"}";console.log("<<<<<<<<<<< Data to send = "+h);o["Accept-Language"]=widget.lang,o.SecurityContext=encodeURIComponent(n);var p=r.getTenantID();p&&0!=p.length?d+="?tenant="+p:d+="?tenant=OnPremise",r.partitionedAuthenticatedRequest(d,{type:"json",method:"POST",proxy:l,headers:o,cancelCallback:function(){return!1},partisionedProgressLabel:a.get("AR_UpdatingAccessRights"),progressBarContext:i.options.contextArea2,progressBarWaitContext:i.options.progressBarWaitContext,data:h,timeout:864e5,onComplete:function(t){!0===i._options.odtMode?null!==i.options.parent&&i.options.parent.ODTModificationComplete(t):i.dispatchEvent("onModificationComplete",t);var n={ov:e};i.dispatchEvent("fireWintopNotif",n)},onFailure:function(e,t,n){i._onFailure(e,t,n)},onTimeout:function(){i._onTimeout()}})},serverUrl:i.options.serverUrl,wintop:i.options.wintop})}),(function(e){onError(e)}))}else{var s={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};this.setError(s)}},getSelectedItemList:function(){return this.SelectedItems},getSelectedItemsMap:function(){return this.SelectedItemsMap},getErrorSelectedItemList:function(){return this.ErrorExistingECAndAggrItemsMap},getAggrItemList:function(){return this.AggrItemsMap},fillInvalidList:function(e){for(var t=e.length,n=0;n<t;n++){var r=e[n];this.listOfInvalidIDs[n]=r}},getShareCheckerInvalidList:function(){return this.listOfInvalidIDs},send3DNotification:function(e,n){var o=this,s={Accept:"application/json","Content-Type":"application/json"};if(null!=n&&""!=n&&n.hasOwnProperty("SecurityContext")){0!=n.SecurityContext.indexOf("ctx::")&&"ctx::",s.SecurityContext=encodeURIComponent(n.SecurityContext),r.get3DSpaceUrlAsync({onComplete:function(n){var a=r.getRealPath("assets/transferOwnership.json",widget),l="",d="PUT",h="",p=o.parseDataFor3DNotification(e);if(2==c){a=n+"/resources/lifecycle/3dnotification/notifymoveshare";a+="?command=share&",h="passport",d="PUT",l=t.encode({requests:p})}var u=r.getTenantID();u&&(a+="tenant="+u),s["Accept-Language"]=widget.lang,i.authenticatedRequest(a,{method:d,proxy:h,type:"json",timeout:108e5,data:l,headers:s,onComplete:function(e){},onFailure:function(e,t,n){},onTimeout:function(){}})}})}else{var a={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};this.setError(a)}},parseDataFor3DNotification:function(e){for(var t=[],n=0;n<e.length;n++)t.push({objectID:e[n].objectID,objectName:e[n].objectName,userID:e[n].userID,CSID:e[n].csID,OrgID:e[n].orgID,CSTitle:e[n].csTitle,OrgTitle:e[n].orgTitle,GrpID:e[n].grpID,GrpTitle:e[n].grpTitle,nlsAccess:e[n].nlsAccess,cestamp:e[n].cestamp});return t}})})),define("DS/AccessRightWidget/AccessRightWidget",["UWA/Core","UWA/Controls/Input","UWA/Controls/Abstract","UWA/Json","DS/WAFData/WAFData","DS/SearchWidget/SearchWidget","DS/SearchWidget/SearchWidgetConstant","DS/ErrorWidget/ErrorWidget","DS/DataGridWidget/DataGridWidget","DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WarningWidget/WarningWidget","DS/AccessRightWidget/AccessRightController","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Spinner","DS/UIKIT/Input/ButtonGroup","DS/Logger/Logger","DS/WebToWinInfra/WebToWinCom","DS/Controls/Toggle","DS/UIKIT/Input/Text","DS/ShareWidget/ShareController","css!DS/AccessRightWidget/AccessRightWidget.css","i18n!DS/AccessRightWidget/assets/nls/langAR"],(function(e,t,n,r,i,o,s,a,c,l,d,h,p,u,g,m,f,v,I,A,y,S,b,C){"use strict";UWA.debug=!0;var R=l.getProdLevel(),w="AR_MasterContain";return n.extend({defaultOptions:{className:"",ForbiddenChar:'"#$@%*,?\\<>[]|:',setValidButton:!0,setCloseButton:!0,showTopBar:!0,wintop:!1,topClassHeight:w,readOnly:"auto",displayWarningForAutoRO:!1,serverName:"",serverUri:"",activeMultisel:!0,activeComment:!1,serverUrl:""},init:function(e,t,n){if(this._parent(n),1==this.options.wintop&&(this.webToWinCom_Socket=I.createSocket({socket_id:"webinwinAccessRights_socket_"+Math.floor(1e5*Math.random()+1)}),void 0!==this.options.serverUrl&&this.options.serverUrl.length>0&&void 0!==this.options.serverUrl[0].platformId)){var r=this.options.serverUrl[0].platformId;l.setTenantID(r)}this.isODT=!1,void 0!==typeof this.options&&null!==this.options&&this.options.hasOwnProperty("odtmode")&&(this.isODT=this.options.odtmode),R=l.getProdLevel(),this.options.activeMultisel=this.options.activeMultisel||l.isMultiSelODT(),this.options.activeComment=this.options.activeComment||l.isCommentODT(),this._initDataStructures(),this.isReadOnly=!1,this.listID=[],this.listOfIds=[],this.arDone=!1,!0===this.options.readOnly&&(this.isReadOnly=!0),this.widget=e,this.parentWidget=t,this.initUI()},_initDataStructures:function(){this.objectIds={},this.listOfError=[],this.SelectedItemsWithEC=[],this.ctxObjectIds=[],this.SelectedItems=[],this.dumpSection=null,this.firstInit=!0,this.addUserMultipleSelection=!1,this.arDone=!1,this._bAddUserError=!1,this.listInputErrors=[],this.listInvalidPovOwnerErrorMsg=[],this.listInvalidPovCollabSpaceErrorMsg=[],this.containsInheritedAccess=!1,this.csoTableLines=[],this.LifecycleConfidentialityEnabled=!1,this.timeStamp=this._create_UUID()},createWebInWinSocket:function(e){return I.createSocket({socket_id:e+Math.floor(1e5*Math.random()+1)})},fireWintopCommand:function(e,t,n){var r=[],i=n+"\n",o=[];if("onModificationAccessRights"===n){var s=null;t.hasOwnProperty("ov")&&(s=t.ov),s.forEach((function(e,t){e.hasOwnProperty("ownership")&&(o.indexOf(e.objectID)<0&&(o.push(e.objectID),e.ownership.forEach((function(e,t){var n,r=e.operation,o=e.access.logical;e.owner.hasOwnProperty("person")?n=e.owner.person.personID:e.owner.hasOwnProperty("collabSpace")&&(n=e.owner.collabSpace.collabSpaceID),i=i+" "+r+" "+o+" "+n+"\n"})),r.push(i)))}))}var a={severity:"warning",ID:o,message:r},c=I.createJSONArrayMessage(n,a);c.length>0&&e.dispatchEvent("onDispatchToWin",{notif_name:"onDisplayMessageODT",notif_parameters:c},"lf_web_in_win")},onResize:function(){this.resizeSearchLine(),this.csoTable.resizeTable(),this.table.resizeTable()},initData:function(e){var t={wintop:this.options.wintop,serverUrl:this.options.serverUrl};d.getInstance(t).getSecurityContext(),this.SelectedItems=[],this._initDataStructures(),this.AccessRightController.onLoad(),1==this.options.wintop&&this.options.readOnly,this.addDataPCS(e)},initDatafromWin:function(e){this.initData(e)},getBottomBar:function(){return this.getTopBar()},isPovOwner:function(e,t){if(t.hasOwnProperty("person")){var n=t.person.personID,r=this.AccessRightController.isPovOwner(e,n);return console.log("IsPovOwner.... of "+e+"---- Selected Person "+n+"/n"),r}return!1},isPovCollabSpace:function(e,t){if(t.hasOwnProperty("collabSpace")&&t.hasOwnProperty("organization")){var n=t.collabSpace.collabSpaceID,r=t.organization.orgID;return this.AccessRightController.isPovCollabSpace(e,n,r)}return!1},isPovUserGrp:function(e,t){if(t.hasOwnProperty("group")){var n=t.group.groupURI;return r=this.AccessRightController.isPovUserGroup(e,n)}if(null!==t&&t.hasOwnProperty("userGrp")){n=t.userGrp.id;var r=this.AccessRightController.isPovUserGroup(e,n)}return r},validateNotPovOwner:function(e,t,n,r){if(this.isPovOwner(e,t)){var i=t.person.personFullName;r(UWA.i18n("povOwner").format(i))}else n()},validateNotPovCollabSpace:function(e,t,n,r){if(this.isPovCollabSpace(e,t)){var i=t.organization.orgID+" / "+t.collabSpace.collabSpaceID;r(UWA.i18n("povCollabSpace").format(i))}else{if(this.isPovUserGrp(e,t))r(UWA.i18n("povCollabSpace").format(i));else n()}},validateInput:function(e,t){var n=this;n._bAddUserError=!1,n.listInputErrors=[],n.listInvalidPovOwnerErrorMsg=[],n.listInvalidPovCollabSpaceErrorMsg=[];for(var r=n.searchWidget.getNewOwner(),i=n.AccessRightController.getSelectedItemList(),o=i.length,s=0;s<o&&!1===n._bAddUserError;s++){var a=i[s].physicalId;n.validateNotPovOwner(a,r,(function(){n.validateNotPovCollabSpace(a,r,(function(){e()}),t)}),t)}null!=n.listInputErrors&&n.listInputErrors.length>0&&n.listInputErrors.length>0&&n.listInputErrors.length===o&&n.setError(n.listInputErrors[0])},addDataPCS:function(e){var t=this;if(null==e&&(e=this.SelectedItems),"auto"==this.options.readOnly){var n={wintop:t.options.wintop,serverUrl:t.options.serverUrl};d.getInstance(n).getSecurityContext({onSuccess:function(n){t._doShareChecker(e,n)},onFailure:function(e){t.setError(e)}})}else this._addDataPCS(e)},_addDataPCS:function(e){this._ManageValidButton(!1),this.hideMainErrorArea();var t=[],n=this;if(1==this.options.activeMultisel?(null!=e&&(t=e.slice()),l.removeDuplicate(t,(function(e){return e.physicalId})),t.forEach((function(e){l.arrayContains(n.SelectedItems,e,(function(e){return e.physicalId}))<0&&n.SelectedItems.push(e)}))):null!=e&&e.length>0&&(n.SelectedItems=[],n.SelectedItems.push(e[0]),t.push(e[0])),n.SelectedItems.length<=0)return n.table.clearAllLine(),1==this.options.wintop?this.showMainErrorArea(UWA.i18n("NoItemToDisplay")):this.showMainErrorArea(UWA.i18n("NoItemSelected")),this.hideMainLoadingArea(),this.hideMainComponent(),void n.dispatchEvent("onChangeSize");this.csoTable.clearAllLine();if(n.SelectedItems.length>0){this.AccessRightController._get("/resources/accessRightServices/ar/getExpressions",{current:"true",select:"collabspaces&select=preferredcredentials"},(function(e){e.hasOwnProperty("LifecycleConfidentialityEnabled")&&(n.LifecycleConfidentialityEnabled=e.LifecycleConfidentialityEnabled,n.AccessRightController.LifecycleConfidentialityEnabled=e.LifecycleConfidentialityEnabled),e.hasOwnProperty("CommandAvailability")&&!1===e.CommandAvailability&&(n.isReadOnly=!0,n.addError(UWA.i18n("SH_PLM_SecurityDenied")),n._updateReadOnlyDisplay()),n.AccessRightController._fillAttributesOfSelectedItems(n.SelectedItems,(function(e,t){if(0==e.completionData.validList.length)n.isReadOnly=!0,n.addError(UWA.i18n("ShareNotSupported")),n._updateReadOnlyDisplay();else{for(var r=0,i=0;i<e.results.length;i++)for(var o=e.results[i],s=0;s<n.SelectedItems.length;s++)o.physicalId===n.SelectedItems[s].physicalId&&(o.isPortConnection&&(r+=1),n.SelectedItems[s].owner=o.owner,n.SelectedItems[s].responsibleName=o.responsibleName,n.SelectedItems[s].Revision=o.Revision,n.SelectedItems[s].project=o.project,null==o.collabSpaceTitle?n.SelectedItems[s].collabSpaceTitle=o.project:n.SelectedItems[s].collabSpaceTitle=o.collabSpaceTitle,n.SelectedItems[s].organization=o.organization,n.SelectedItems[s].organizationTitle=o.orgTitle,n.SelectedItems[s].type=o.type,n.SelectedItems[s].typeDisplayName=o.typeDisplayName,n.SelectedItems[s].urlIcon=t+o.typeIcon,"gif"===n.SelectedItems[s].urlIcon.substr(n.SelectedItems[s].urlIcon.length-3,n.SelectedItems[s].urlIcon.length)&&(n.SelectedItems[s].urlIcon=n.SelectedItems[s].urlIcon.substr(0,n.SelectedItems[s].urlIcon.length-3)+"png"),n.SelectedItems[s].v_IsEmbeddedComponent=o["attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]"]);r===n.SelectedItems.length&&(n.isReadOnly=!0,n.addError(UWA.i18n("ShareNotSupported")),n._updateReadOnlyDisplay()),n.AccessRightController._fillModels(n.SelectedItems)}}),(function(e){}))}),(function(e){onError(e)}))}n.csoTable.clearAllLine()},hideElements:function(e,t){for(var n=e.getElements(t),r=n.length,i=0;i<r;i++){n[i].hide()}},showElements:function(e,t){for(var n=e.getElements(t),r=n.length,i=0;i<r;i++){n[i].show()}},destroy:function(){this.searchWidget&&this.searchWidget.destroy(),this._parent()},initUI:function(){var e=this,n=this.container=UWA.createElement("div",{name:w,"data-rec-id":w,class:w+" "+e.options.className});this.globalDiv=UWA.createElement("div",{class:"AR_GlobalContain","data-rec-id":"datarecGlobalContain"}).inject(n);var r="AR_ManageButtonDiv";this.options.wintop&&(r="AR_ManageButtonDivWintop"),this.ManageButtonDiv=UWA.createElement("table",{class:r,"data-rec-id":"datarecManageButtonDiv",html:{}}),e.ManageButtonRight=UWA.createElement("td",{class:"AR_ManageButtonRight","data-rec-id":"datarecManageButtonRight"}),e.ManageButtonLeft=UWA.createElement("td",{class:"AR_ManageButtonLeft","data-rec-id":"datarecManageButtonLeft"});var i=null;e.boutonValid=new u({attributes:{title:UWA.i18n("")},name:"TopButtonValid",value:UWA.i18n("AR_Valid"),className:"default medium AR_buttonTop primary",disabled:!0});var c=e.boutonValid.getContent();null!=c&&c.setAttribute("data-rec-id","boutonValid"),i=new u({attributes:{title:UWA.i18n(""),"data-rec-id":"datarecButtonCancel"},name:"TopButtonCancel",value:UWA.i18n("AR_CloseOverlay"),className:"default medium AR_buttonTop"}),e.boutonValid.addEvents({onClick:function(){e._ManageValidButton(!1),e.modifyDataPCS(),i.setValue(UWA.i18n("AR_Close"))}}),i.addEvents({onClick:function(){e.table.clearAllLine(),e._ManageValidButton(!1),e.dispatchEvent("onCancel")}}),0==this.isReadOnly&&1==e.options.setValidButton&&e.boutonValid.inject(e.ManageButtonRight),1==e.options.setCloseButton&&i.inject(e.ManageButtonRight),e.ManageButtonLeft.inject(this.ManageButtonDiv),e.ManageButtonRight.inject(this.ManageButtonDiv),e.options.showTopBar&&this.ManageButtonDiv.inject(e.globalDiv),e.options.odtmode&&this.ManageButtonDiv.inject(e.globalDiv),e.mainInterface=UWA.createElement("div",{class:"AR_MainInterface","data-rec-id":"datarecMainInterface"}).inject(this.globalDiv).hide(),e.mainLoading=UWA.createElement("div",{class:"AR_MainLoading","data-rec-id":"datarecMainLoading"}).inject(this.globalDiv),e.mainError=UWA.createElement("div",{class:"AR_MainError","data-rec-id":"datarecMainError"}).inject(this.globalDiv).hide(),e.csoTableContainer=UWA.createElement("div",{class:"AR_CSOTableContainer","data-rec-id":"datarecinitialItemsList"}),e.csoTableContainer.inject(e.mainInterface),e.csoTable=this.createInitialSelectedTable(),e.csoTable.inject(this.csoTableContainer),e.loadingArea32=UWA.createElement("div",{class:"AR_MAINProgressBar","data-rec-id":"datarecidmainprogress"}),e.loadingArea32.inject(e.mainLoading);var l=null;(l=new u({attributes:{title:UWA.i18n("AR_AddUser")},value:"",name:"addUserButton",className:"default medium AR_addUser",icon:"user-add"})).getContent().setAttribute("data-rec-id","dataRecAddUser"),l.elements.icon.setAttribute("data-rec-id","dataRecAddUserIcon"),l.addEvents({onClick:function(){e.validateInput((function(){e.AddUser(),e._bAddUserError=!1,e.dispatchEvent("onChangeSize"),e._ManageValidButton(!0)}),(function(t){if(e.searchWidget.clearInput(),!1===e._bAddUserError){var n={code:"",message:t};e.setError(n)}!1===e._bAddUserError&&(e._bAddUserError=!0)})),e.searchWidget.clearInput()}});e.selectRightNewUser=new g({nativeSelect:!0,placeholder:!1}),e.selectRightNewUser.elements.container.setAttribute("data-rec-id","dataRecselectRightNewUserContainer"),e.selectRightNewUser.elements.content.setAttribute("data-rec-id","dataRecselectRightNewUser"),e.TextComment=new t.Text({text:"",className:"AR_commentText",attributes:{placeholder:UWA.i18n("PutComments")}}),e.TextComment.elements.container.setAttribute("data-rec-id","dataRecComments");var d=e.options.ForbiddenChar;e.searchWidget=o.getSearchWidget(o.RESTRICTED,{className:"searchPeople_AccessRights",ForbiddenChar:d,MaxNumber:"5",MaxSize:"300",topClassHeight:e.options.topClassHeight,position:"auto",serverName:this.options.serverName,serverUri:this.options.serverUri,serverUrl:this.options.serverUrl,exttype:s.EXTTYPE_USERGRP,showEmptyCategory:!1,odtmode:this.options.odtmode,events:{onValid:function(){e.searchRight.show(),e.searchAdd.show(),e.boutonAddUser&&e.boutonAddUser.setDisabled(!1),1==e.options.activeComment&&e.searchComment.show(),e.dispatchEvent("onChangeSize"),e.resizeSearchLine()},onUnvalid:function(){e.searchRight.hide(),e.searchAdd.hide(),e.boutonAddUser&&e.boutonAddUser.setDisabled(!0),1==e.options.activeComment&&e.searchComment.hide(),e.dispatchEvent("onChangeSize"),e.resizeSearchLine()},onError:function(t){e.setError(t)}}}),e.tableSearch=UWA.createElement("table",{name:"AR_TableSearch",class:"AR_TableSearch table","data-rec-id":"datarecTableSearch",html:""});var h=new UWA.createElement("tbody").inject(e.tableSearch),m=UWA.createElement("tr",{class:"AR_DivSearch","data-rec-id":"datarecDivSearch"}),f=UWA.createElement("td",{name:"SearchInputCell",class:"AR_SearchInputColumn AR_SpanNew","data-rec-id":"datarecSearchInputCell",html:""});e.searchWidget.inject(f),e.searchRight=UWA.createElement("td",{class:"AR_NewSelectRightColumn AR_SpanNew","data-rec-id":"datarecSelectRightColumnSpanNew",html:""}).hide(),e.selectRightNewUser.inject(e.searchRight),e.searchAdd=UWA.createElement("td",{class:"AR_AddUserColumn AR_SpanNew","data-rec-id":"datarecAddUserColumnSpanNew",html:""}).hide(),l.inject(e.searchAdd),1==e.options.activeComment&&(e.searchComment=UWA.createElement("td",{class:"AR_NewComment AR_SpanNew","data-rec-id":"datarecNewCommentColumnSpanNew",html:""}).hide(),e.TextComment.inject(e.searchComment)),f.inject(m),e.searchRight.inject(m),1==e.options.activeComment&&e.searchComment.inject(m),e.searchAdd.inject(m),m.inject(h),this.moreButton=new UWA.createElement("a",{html:UWA.i18n("More")+"&rsaquo;",class:"AR_advancedSwitch","data-rec-id":"datarecMoreAdvancedSwitchSpanNew",name:"AR_AdvButton",events:{click:function(t){e.moreButton.hide(),e.lessButton.show(),e.currentMode=e.lessButton,e.manageAdvancedMode()}}}),this.lessButton=new UWA.createElement("a",{html:"&lsaquo;"+UWA.i18n("Less"),class:"AR_advancedSwitch","data-rec-id":"datarecLessAdvancedSwitchSpanNew",name:"AR_SimpleButton",events:{click:function(t){e.lessButton.hide(),e.moreButton.show(),e.currentMode=e.moreButton,e.manageAdvancedMode()}}}).hide(),0==this.isReadOnly&&e.tableSearch.inject(e.mainInterface),this.tableContainer=UWA.createElement("div",{class:"AR_tableContainer","data-rec-id":"datarectableContainer"}),e.table=e.createTable(),e.table.inject(this.tableContainer),this.tableContainer.inject(e.mainInterface),e.errorOverlay=new a(e.widget,e.container,{className:"errorComponent_AccessRight","data-rec-id":"datarecErrorComponentAccessRight"}),this.AccessRightController=new p(e.widget,{uniqueRightList:!this.isReadOnly,serverName:this.options.serverName,wintop:this.options.wintop,client_app_domain:this.options.client_app_domain?this.options.client_app_domain:null,client_app_name:this.options.client_app_name?this.options.client_app_name:null,serverUri:this.options.serverUri,serverUrl:this.options.serverUrl,isReadOnly:this.isReadOnly,odtMode:this.isODT,parent:this,contextArea1:this.loadingArea32,contextArea2:this.ManageButtonLeft,progressBarWaitContext:e.container,events:{onError:function(t){e.hideFailMainLoadingArea(),e.addError(t)},onDataLoaded:function(){if(null!=e.container.getParent()){e.hideMainLoadingArea();var t=e.AccessRightController.getFormattedRightList();e.selectRightNewUser.add(t,!0),t.length>0&&e.selectRightNewUser.setValue(t[0]);var n=e.selectRightNewUser.elements.container.childNodes[0].childNodes;if(n.forEach)n.forEach((function(e,t){e.setAttribute("data-rec-id","dataRecComboRightsValue"+t)}));else Array.prototype.slice.call(n).forEach((function(e,t){e.setAttribute("data-rec-id","dataRecComboRightsValue"+t)}));var r=e.AccessRightController.getFusionOwnership();e.AddDataInTable(r),e.AddSelectedItemsInTable(),e.searchWidget.setSelectedItemList(e.AccessRightController.getCurrentSelectedItems()),!0===e.firstInit&&(e.dispatchEvent("onFirstBuild"),e.firstInit=!1),e.onResize()}},onModificationComplete:function(t){for(var n=e.table.getAllLine(),r=0;r<n.length;r++){var i=n[r],o=e.table.getCellContent(i,"Id");if(null!=o&&""!=o){var s=e.table.getCellValue(i,"ComboRights");e.getOwnerElementFromID(o).InitRights=s}}e.showNotificationInTable(t),e.addErrorAfterOperation(e,t),e._ManageValidButton(!1)},fireWintopNotif:function(t){!0===e.options.wintop&&e.fireWintopCommand(e.webToWinCom_Socket,t,"onModificationAccessRights")}}}),this._ManageValidButton()},_updateReadOnlyDisplay:function(){1==this.isReadOnly?(null!=this.tableSearch&&this.tableSearch.hide(),null!=this.boutonValid&&this.boutonValid.hide()):(null!=this.tableSearch&&this.tableSearch.show(),null!=this.boutonValid&&this.boutonValid.show())},_ManageValidButton:function(e){var t=this.createJSONArrayModif(),n=e;null!=e&&void 0!==typeof e||(n=t.length>0),n?this.boutonValid.setDisabled(!1):this.boutonValid.setDisabled(!0)},getTopBar:function(){return this.ManageButtonDiv},resizeSearchLine:function(){if(null!=this.tableSearch){var e=this.tableSearch.getElements("td");e.forEach((function(e){"none"!=e.getStyle("display")&&e.setStyle("display","table-cell")}));var t=this.tableSearch.getSize(),n=this.globalDiv.getSize();t.width>n.width&&e.forEach((function(e){"none"!=e.getStyle("display")&&e.setStyle("display","inline-block")}))}},getNewIDLine:function(){for(var e=!0,t=this.listID.length;1==e;)t++,e=!1,this.listID.forEach((function(n){t==n.Id&&(e=!0)}));return t},getOwnershipContainerFromID:function(e){var t=null;return this.listID.forEach((function(n){e==n.Id&&(t=n.OwnershipContainer)})),t},getOwnerElementFromID:function(e){for(var t=0;t<this.listID.length;t++){var n=this.listID[t];if(n.Id==e)return n}return null},getPositionFromId:function(e){var t=null;return this.listID.forEach((function(n,r){e==n.Id&&(t=r)})),t},showNotificationInTable:function(e){for(var t=this,n=JSON.parse("[]"),r=this.csoTable.getAllLine(),i=r.length,o=0;o<i;o++)null!=r[o]&&(n[r[o].getElementsByClassName("Id")[0].innerHTML]=r[o]);var s=t.AccessRightController.getErrorSelectedItemList(),a=(JSON.parse("[]"),[]),c=t.AccessRightController.getSelectedItemsMap();if(e&&e.ownershipVector)for(var l=e.ownershipVector.length,d=0;d<l;d++){var h=e.ownershipVector[d];if(h){var p=h.ownership,u="access right success",g=!1;0==t.isODT&&(u=C.get("accessRightSuccess"));for(var m=0;m<p.length;m++){var f=p[m];if(f.hasOwnProperty("result")){u="access right failure",0==t.isODT&&(u=f.result.message),g=!0;break}f.objectID;var v={},I="",A="",y="",S="",b="",R="",w="",O="",E=t.timeStamp;if(null!=n[e.ownershipVector[d].objectID]){if(f.access&&f.access.logical){var D=f.access.logical;O=t.AccessRightController.getAccessNls(D)}f.owner.person&&(I=(I=f.owner.person.personID).replace("_PRJ","")),f.owner.collabSpace&&(A=f.owner.collabSpace.collabSpaceID,y=f.owner.collabSpace.collabSpaceTitle,f.owner.organization&&(S=f.owner.organization.orgID,b=f.owner.organization.orgTitle)),f.owner.group&&(R=f.owner.group.groupURI,w=f.owner.group.groupTitle);var _=c[e.ownershipVector[d].objectID],U="",T="";null!=_&&(U=_.name,T=_.Revision,U&&T&&(U=U.split(T).join(""))),v.objectID=e.ownershipVector[d].objectID,v.objectName=U,v.userID=I,v.csID=A,v.csTitle=y,v.orgID=S,v.orgTitle=b,v.grpID=R,v.grpTitle=w,v.nlsAccess=O,v.cestamp=E,a.push(v)}}g||null!=s[e.ownershipVector[d].objectID]&&null!=n[e.ownershipVector[d].objectID]&&(u="access right failure",0==t.isODT&&(u=C.get("accessRightFailure")));var x="syc-green-circle-symbol";g&&(x="syc-red-circle-symbol");var P=UWA.createElement("div",{class:x}),W=n[e.ownershipVector[d].objectID];null!=W&&(W.getElementsByClassName("Symbol")[0].appendChild(P),W.getElementsByClassName("Result")[0].innerHTML=u)}}t.send3DNotification(a);var M=t.AccessRightController.getShareCheckerInvalidList(),L=Object.keys(n);M.forEach((function(e){if(-1!=L.indexOf(e)){u="access right failure",0==t.isODT&&(u=C.get("ShareCheckerBlockedMessage"));var r=UWA.createElement("div",{class:"syc-red-circle-symbol"}),i=n[e];null!=i&&(i.getElementsByClassName("Symbol")[0].appendChild(r),i.getElementsByClassName("Result")[0].innerHTML=u)}}))},setError:function(e){var t={};"object"==typeof e?"1500028"===e.code?(e.message=UWA.i18n("ErrorNotAccessRight"),t=e):e.hasOwnProperty("errorCode")&&"FS_INVALID_QUERY__NOT_AUTHORIZED_QUERY__WILDCARD"===e.errorCode?(t.code=e.errorCode,t.message=C.get("FS_INVALID_QUERY__NOT_AUTHORIZED_QUERY__WILDCARD")):t=e:t=e,this.addError(t)},addError:function(e){this.errorOverlay.displayJSONError(r.encode(e))},hideMainComponent:function(){this.mainInterface.hide(),this.boutonValid.hide()},hideMainLoadingArea:function(){this.mainInterface.show(),this.boutonValid.show(),this.mainLoading.hide(),this._updateReadOnlyDisplay()},hideFailMainLoadingArea:function(){this.loadingArea32.hide(),this.mainLoading.hide()},hideMainErrorArea:function(){this.mainError.hide()},showMainErrorArea:function(e){null!=e&&""!=e&&(this.clearAllMainError(),this.addMainError(e)),this.mainError.show()},addMainError:function(e){new UWA.createElement("div",{text:e}).inject(this.mainError)},clearAllMainError:function(){this.mainError.setContent("")},manageAdvancedMode:function(e){var t=this;t.currentMode==t.lessButton?(t.showElements(t.mainInterface,".inherit_From"),t.showElements(t.mainInterface,".inherit_Access"),1==t.options.activeComment&&t.showElements(t.mainInterface,".Comments")):(t.hideElements(t.mainInterface,".inherit_From"),t.hideElements(t.mainInterface,".inherit_Access"),1==t.options.activeComment&&t.hideElements(t.mainInterface,".Comments")),t.resizeTable()},addErrorAfterOperation:function(e,t){t.hasOwnProperty("error")&&e.setError(t.error),t.ownershipVector.forEach((function(t,n){t.hasOwnProperty("ownership")&&t.ownership.forEach((function(t,n){t.hasOwnProperty("result")&&e.setError(t.result)}))}))},ownerAlreadyExist:function(e){var t=[],n=!1;return this.listID.every((function(r,i){var o=r.OwnershipContainer.ownership.owner,s=r.Id;if(o.hasOwnProperty("person")||e.hasOwnProperty("person")){if(!o.hasOwnProperty("person")||!e.hasOwnProperty("person"))return!0;if(o.person.personID!=e.person.personID)return!0}if(o.hasOwnProperty("collabSpace")||e.hasOwnProperty("collabSpace")){if(!o.hasOwnProperty("collabSpace")||!e.hasOwnProperty("collabSpace"))return!0;if(o.collabSpace.collabSpaceID!=e.collabSpace.collabSpaceID)return!0}if(o.hasOwnProperty("organization")||e.hasOwnProperty("organization")){if(!o.hasOwnProperty("organization")||!e.hasOwnProperty("organization"))return!0;if(o.organization.orgID!=e.organization.orgID)return!0}if(o.hasOwnProperty("group")||e.hasOwnProperty("group")){if(!o.hasOwnProperty("group")||!e.hasOwnProperty("group"))return!0;if(o.group.groupURI!=e.group.groupURI)return!0}return(o.hasOwnProperty("comment")||e.hasOwnProperty("comment"))&&o.hasOwnProperty("comment")&&e.hasOwnProperty("comment")&&o.comment==e.comment&&(n=!0),t.push({Index:i,Id:s,IsSame:n}),!0})),t},modifyDataPCS:function(){var e=this,t=e.createJSONArrayModif(),n=[],r=new Array,i=e.AccessRightController.getSelectedItemList(),o=e.AccessRightController.getErrorSelectedItemList();if(o.length!==i.length){var s=e.AccessRightController.getShareCheckerInvalidList();if(s.length!=i.length){var a=[];i.forEach((function(e){null==o[e]&&-1==s.indexOf(e.physicalId)&&a.push(e)})),a.forEach((function(i,o){var s=new Array;i.hasOwnProperty("embeddedComp")&&!0===i.embeddedComp||(t.forEach((function(t){var n=t.operation,r=e.AccessRightController.getOwner(i.physicalId,n.owner),o=e.AccessRightController.isInherited(i.physicalId,n.owner),a=e.isPovOwner(i.physicalId,n.owner);o||a||(null!=r&&("MODIFY"==t.action?0==t.isTrueComment&&(n.owner=r):"ADD"==t.action?n.owner.comment!=r.comment&&s.push({operation:"REMOVE",owner:r,access:{logical:"empty"}}):"REMOVE"==t.action&&"REMOVE"==t.action&&0==t.isTrueComment&&(n.owner=r)),s.push(n))})),r.push(i.physicalId),n.push({objectID:i.physicalId,ownership:s}))}));var c={wintop:e.options.wintop,serverUrl:e.options.serverUrl};d.getInstance(c).getSecurityContext({onSuccess:function(t){e.AccessRightController.modifyDataWithSC(n,r,t)},onFailure:function(t){e.setError(t)}})}}},_onFailure:function(e,t,n,i,o,s){r.isJson(t)&&(t=r.decode(t));var a={};a=null!=t&&t.hasOwnProperty("error")?t.error:{message:UWA.i18n("AR_ErrorModification"),code:"ERROR"},this.setError(a)},_onTimeout:function(){var e={message:UWA.i18n("ErrorTimeOut"),code:"TO"};this.setError(e)},_doShareChecker:function(e,t){var n=this,i=e,o={Accept:"application/json","Content-Type":"application/json"};if(null==t||""==t||!t.hasOwnProperty("SecurityContext")){var s={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};return this.setError(s),this.isReadOnly=!0,this._updateReadOnlyDisplay(),void this._addDataPCS(e)}t.SecurityContext.indexOf("ctx::"),o.SecurityContext=encodeURIComponent(t.SecurityContext);var a=[],c=e.length;c>10&&(c=10);for(var d=0;d<c;d++){var h=e[d];a.push({objectID:h.physicalId})}this.options.serverName,this.options.serverUri;l.get3DSpaceUrlAsync({onComplete:function(s){var c="",d="GET",h="",p=l.getRealPath("assets/availability.json",n.widget);2==R&&(h="passport"),2==R&&(p=n.options.hasOwnProperty("odtmode")&&n.options.odtmode?s+"/resources/accessRightServices/ar/shareChecker":0===a[0].objectID.indexOf("cid:")?s+"/resources/lifecycle/ownership/checkaccess":s+"/resources/accessRightServices/ar/shareChecker",d="POST",c=r.encode({requests:a})),o["Accept-Language"]=widget.lang;var u=l.getTenantID();u&&0!=u.length?p+="?tenant="+u:p+="?tenant=OnPremise";l.partitionedAuthenticatedRequest(p,{type:"json",method:d,proxy:h,progressBarWaitContext:n.container,data:c,headers:o,onComplete:function(r){if(null!=r.results[0].invalidList&&r.results[0].invalidList.length>0){var o;if((o=r.results[0].invalidList).length==e.length){n.isReadOnly=!0;var s={message:UWA.i18n("ShareCheckerBlockedMessage"),code:"TO"};n.setError(s),n._updateReadOnlyDisplay()}n.AccessRightController.fillInvalidList(o),n._testAvailability(i,t)}else n._testAvailability(i,t)},onFailure:function(t,r,i){n._onFailureAvailability(t,r,i,e)},onTimeout:function(){n._onTimeoutAvailability(e)}})},serverUrl:n.options.serverUrl,wintop:n.options.wintop})},_testAvailability:function(e,t){var n=this,i={Accept:"application/json","Content-Type":"application/json"};if(null==t||""==t||!t.hasOwnProperty("SecurityContext")){var o={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};return this.setError(o),this.isReadOnly=!0,this._updateReadOnlyDisplay(),void this._addDataPCS(e)}t.SecurityContext.indexOf("ctx::"),i.SecurityContext=encodeURIComponent(t.SecurityContext);var s=[],a=e.length;a>10&&(a=10);for(var c=0;c<a;c++){var d=e[c];s.push({objectID:d.physicalId,accessRight:[{access:{physical:"changesov"}}]})}this.options.serverName,this.options.serverUri;l.get3DSpaceUrlAsync({onComplete:function(t){var o="",a="GET",c="",d=l.getRealPath("assets/availability.json",n.widget);2==R&&(c="passport"),2==R&&(d=t+"/resources/pno/ownership/checkaccess",a="POST",o='{ "boAccessRights": '+r.encode(s)+"}"),i["Accept-Language"]=widget.lang;var h=l.getTenantID();h&&0!=h.length?d+="?tenant="+h:d+="?tenant=OnPremise";l.partitionedAuthenticatedRequest(d,{type:"json",method:a,proxy:c,partisionedProgressLabel:C.get("AR_CheckingAccess"),progressBarContext:n.loadingArea32,progressBarWaitContext:n.container,data:o,headers:i,onComplete:function(t){n.reponse=t,n._onCompleteAvailability(t,e)},onFailure:function(t,r,i){n._onFailureAvailability(t,r,i,e)},onTimeout:function(){n._onTimeoutAvailability(e)}})},serverUrl:n.options.serverUrl,wintop:n.options.wintop})},_onTimeoutAvailability:function(e){this.isReadOnly=!0;var t={message:UWA.i18n("ErrorTimeOut"),code:"TO"};this.setError(t),this._updateReadOnlyDisplay(),this._addDataPCS(e)},_onFailureAvailability:function(e,t,n,i){this.isReadOnly=!0;var o={};r.isJson(t)&&(t=r.decode(t)),o=null!=t&&t.hasOwnProperty("error")?t.error:{message:UWA.i18n("UnknownError"),code:"ERROR"},this.setError(o),this._updateReadOnlyDisplay(),this._addDataPCS(i)},_onCompleteAvailability:function(e,t){var n=this;if(1==e.success){this.isReadOnly=!1;var r=0;if(e.hasOwnProperty("boAccessRights")){var i=e.boAccessRights;i.forEach((function(e){e.hasOwnProperty("accessRight")&&e.accessRight.forEach((function(i){if(i.hasOwnProperty("error")){r++;var o=i.error;o.type="warning";var s=UWA.i18n("an object");switch(t.every((function(t){t.physicalId==e.objectID&&t.hasOwnProperty("name")&&(s=t.name)})),o.code+""){case"1501603":o.message=UWA.i18n("Bad credential for {0}").format(s);break;case"1501601":o.message=UWA.i18n("Not the owner of {0}").format(s);break;case"1501602":o.message=UWA.i18n("No right on {0}").format(s);break;case"0000000":o.message=UWA.i18n("ShareNotSupported")}!0===n.options.displayWarningForAutoRO&&n.addError(o),v.warn("Access right : "+o.message)}}))}));var o=i.length;o==r&&(n.isReadOnly=!0,t.length>o&&(n.isReadOnly=!1,n.addError(UWA.i18n("ErrorNoAccessToAtLeast10"))))}n._updateReadOnlyDisplay(),n._addDataPCS(t)}else{if(this.isReadOnly=!0,e.hasOwnProperty("error")){var s=e.error;s.message.contains("does not exist")?n.addError(UWA.i18n("AR_ObjectDoesNotExist")):n.addError(s)}this.hideMainLoadingArea()}},_manageTableHeader:function(){var e=this.tableContainer.getElement(".AR_mainTableHeader");null!==e&&(this.table.allIsHidden()?e.hide():e.show())},AddUser:function(){var e=this;if(!l.isProgressBusy()){var t=e.searchWidget.getNewOwner();if(null!==t&&""!==t){t.hasOwnProperty("userGrp")&&(t.group={groupURI:t.userGrp.id,groupTitle:t.userGrp.label},delete t.userGrp);e.SelectedItems.length;var n=e.selectRightNewUser.getValue(),r="";if(n.length>0){r=n[0];var i=e.TextComment.getValue();null!=i&&""!=i&&(t.comment=i);var o=this.ownerAlreadyExist(t),s="";if(o.length>0){var a=!0,c=!1,d=o[0],h=!1;if(o.forEach((function(t){var n=e.table.getCellsContent({Id:t.Id},"ComboRights");0!=n.length&&null!=n[0]&&""!=n[0]&&(h=!0),1==t.IsSame&&(d=t)})),0==h){c=!0;var p=this.getOwnerElementFromID(d.Id).InitRights;0==d.IsSame?(c=!1,0!=p.length&&null!=p[0]&&""!=p[0]||(c=!0),a=!1):0!=p.length&&null!=p[0]&&""!=p[0]&&(s=p[0])}if(1==c&&(this.table.removeLine({Id:d.Id}),this.listID.splice(d.Index,1),a=!1),1==a){var u={code:"",message:e.getNameUserFromOwner(t).name+" "+UWA.i18n("alreadyExists")};return void this.listInputErrors.push(u)}if(t.hasOwnProperty("collabSpace")&&t.hasOwnProperty("organization")&&"ReaderR"===r){u={code:"",message:UWA.i18n("ReaderRAccessToGrpsCSORG")};return void this.listInputErrors.push(u)}}if(t.hasOwnProperty("collabSpace")&&t.hasOwnProperty("organization")&&"ReaderR"===r){u={code:"",message:UWA.i18n("ReaderRAccessToGrpsCSORG")};this.listInputErrors.push(u)}else{var g={ownership:{InitRights:s,operation:"ADD",owner:t,access:{logical:r}},isTrueComment:!0,isTrueInheritedPath:!0},m=e.AddOwnershipInTable(g);null!=m&&(e.table.AddDataInTable(m),e.manageAdvancedMode()),this._manageTableHeader(),this._ManageValidButton(),this.onResize()}}}}},DeleteUser:function(e){if(!l.isProgressBusy()){var t=parseInt(e),n=this.getOwnerElementFromID(t).InitRights;if(0==n.length||null==n[0]||""==n[0]){this.table.removeLine({Id:t});var r=this.getPositionFromId(t);this.listID.splice(r,1)}else this.table.HideLine({Id:t},!0),this.table.clearCell({Id:t},"ComboRights");this._manageTableHeader(),this._ManageValidButton()}},getNameUserFromOwner:function(e){var t=null,n="",r=-1;if(e.hasOwnProperty("person"))n=e.person.personLastName+" "+e.person.personFirstName,r=1;else{var i=!1;e.hasOwnProperty("organization")&&(i=!0,n=e.organization.orgTitle),e.hasOwnProperty("collabSpace")&&(1==i&&(n+=" / "),n+=e.collabSpace.collabSpaceTitle),e.hasOwnProperty("group")&&(n=e.group.groupTitle),r=2}return r>0&&(t={name:n,type:r}),t},createInitialSelectedTable:function(){var e;return 1==this.isODT?("Title","Revision","Organization","Collaborative Space","Responsible","Result",(e=new c([{text:"PhysicalID",dataIndex:"Id",sortKey:function(e){return e},sortable:!0},{text:"",dataIndex:"Symbol",sortKey:function(e){return e},sortable:!0},{text:"Title",dataIndex:"Title",sortKey:function(e){return e},sortable:!0},{text:"Revision",dataIndex:"Revision",sortKey:function(e){return e},sortable:!0},{text:"Organization",dataIndex:"Organization",sortKey:function(e){return e},defaultSort:!0,sortable:!0},{text:"Collaborative Space",dataIndex:"CollaborativeSpace",sortKey:function(e){return e},defaultSort:!0,sortable:!0},{text:"Responsible",dataIndex:"Responsible",sortKey:function(e){return e},defaultSort:!0,sortable:!0},{text:"Result",dataIndex:"Result",sortKey:function(e){return e},sortable:!0}],{className:"AR_csoTable",activeSelection:!1,setScroller:!0,useNativeScroller:!0,maxHeightScroller:""})).getContent().setAttribute("data-rec-id","dataRecInitialSelectedGridAccess"),e):((e=new c([{text:"PhysicalID",dataIndex:"Id",sortKey:function(e){return e},sortable:!0},{text:"",dataIndex:"Symbol",sortKey:function(e){return e},sortable:!0},{text:UWA.i18n("AR_Title"),dataIndex:"Title",sortKey:function(e){return e},sortable:!0},{text:UWA.i18n("AR_Type"),dataIndex:"Type",sortKey:function(e){return e},sortable:!0},{text:UWA.i18n("AR_Revision"),dataIndex:"Revision",sortKey:function(e){return e},sortable:!0},{text:UWA.i18n("AR_Sum_Org"),dataIndex:"Organization",sortKey:function(e){return e},defaultSort:!0,sortable:!0},{text:UWA.i18n("AR_Sum_Collab"),dataIndex:"CollaborativeSpace",sortKey:function(e){return e},defaultSort:!0,sortable:!0},{text:UWA.i18n("AR_Sum_Resp"),dataIndex:"Responsible",sortKey:function(e){return e},defaultSort:!0,sortable:!0},{text:UWA.i18n("AR_Result"),dataIndex:"Result",sortKey:function(e){return e},sortable:!0}],{className:"AR_csoTable",activeSelection:!1,setScroller:!0,useNativeScroller:!0,maxHeightScroller:""})).getContent().setAttribute("data-rec-id","dataRecInitialSelectedGridAccess"),e)},createTable:function(){var e=this,t="",n="";1==this.isReadOnly&&(t=this.moreButton,n=this.lessButton);var r="User_CS";this.options.wintop&&(r="User_only");var i=new c([{text:UWA.i18n("Id"),dataIndex:"Id",sortKey:function(e){return e}},{text:UWA.i18n(r),dataIndex:"UserName",sortKey:function(e){return e.getElement(".AR_UserName").getText()},defaultSort:!0,sortable:!0},{text:UWA.i18n("AR_Rights"),html:t,dataIndex:"ComboRights",sortKey:function(t){if(1==e.isReadOnly)return t;var n="";if("object"==typeof t)if(3===t.nodeType)n=t.textContent;else{var r=t.getSelection(!1);r.length>0&&("Can Edit"==(n=r[0].attributes[0].value)?n="Author":"Can Read"==n?n="Reader":"Can Manage"==n&&(n="Owner"))}return n},sortable:!0},{text:UWA.i18n("InheritedFrom"),dataIndex:"inherit_From",sortKey:function(e){return e},sortable:!0},{text:UWA.i18n("InheritedAccess"),html:n,dataIndex:"inherit_Access",sortKey:function(e){return e},sortable:!0}],{className:"AR_mainTable",maxHeightScroller:"",setScroller:!0});if(1==e.options.activeComment&&i.addHeader([{text:UWA.i18n("Comments"),dataIndex:"Comments",sortKey:function(t){return 1==e.isReadOnly?t:t.getValue()},sortable:!0}]),0==e.isReadOnly){var o=new UWA.createElement("span");this.moreButton.inject(o),this.lessButton.inject(o),i.addHeader([{html:o,dataIndex:"Delete",sortKey:function(e){return e}}])}return i},resizeTable:function(){this.table.resizeTable()},createJSONArrayModif:function(){var e=[];if(1==this.isReadOnly)return e;for(var t=this,n=t.table.getAllLine(),i=n.length,o=0;o<i;o++){var s=null,a=t.table.getCellContent(n[o],"Id");if(null!=a&&""!=a){var c=t.getOwnershipContainerFromID(a);s=c.ownership.owner;var l=!0,d=!0;c.hasOwnProperty("isTrueComment")&&(l=c.isTrueComment),c.hasOwnProperty("isTrueInheritedPath")&&(d=c.isTrueInheritedPath);var h="";1==t.options.activeComment&&(h=t.table.getCellValue(n[o],"Comments"));var p=t.getOwnerElementFromID(a).InitRights,u=t.table.getCellValue(n[o],"ComboRights"),g=!1;null!=u&&""!=u||(g=!0);var m=!1;null!=p&&""!=p||(m=!0);var f=!1;if(""!=h&&h!=s.comment&&(f=!0),1==m&&0==g&&(1==f&&(s.comment=h),e.push({operation:{operation:"ADD",owner:s,access:{logical:u}},isTrueComment:!0,isTrueInheritedPath:!0,action:"ADD"})),0==m&&1==g&&e.push({operation:{operation:"REMOVE",owner:s,access:{logical:"Empty"}},isTrueComment:l,isTrueInheritedPath:d,action:"REMOVE"}),0==m&&0==g)if(1==f){var v=r.decode(r.encode(s));v.comment=h,e.push({operation:{operation:"ADD",owner:v,access:{logical:u}},isTrueComment:!0,isTrueInheritedPath:!0,action:"ADD"})}else if(u!=p)if(s.hasOwnProperty("collabSpace")&&s.hasOwnProperty("organization")&&"ReaderR"===u){var I={code:"",message:UWA.i18n("ReaderRAccessToGrpsCSORG")};this.listInputErrors.push(I)}else e.push({operation:{operation:"ADD",owner:s,access:{logical:u}},isTrueComment:l,isTrueInheritedPath:d,action:"MODIFY"})}}return e},AddDataInTable:function(e){var t=this;t.table.clearAllLine(),t.listID=[];var n=[];e.forEach((function(e,r){var i=t.AddOwnershipInTable(e);null!=i&&n.push(i)})),t.table.AddDatasInTable(n),this.containsInheritedAccess&&(this.moreButton.click(),this.currentMode=t.lessButton),t._manageTableHeader(),t.manageAdvancedMode()},AddOwnershipInTable:function(e){var n=r.decode(r.encode(e)),i=n.ownership,o=this,s="",a=this.getNewIDLine(),c=null,d=o.getNameUserFromOwner(i.owner);null!=d&&(c=l.getImageUser(d.type,"medium",o.widget),s=d.name);var h=UWA.createElement("div",{html:[c,{tag:"span",class:"AR_UserName",text:s}]}),p=UWA.createElement("div"),m=UWA.createElement("div");if(i.hasOwnProperty("inheritedPath")){var f=i.inheritedPath;null!==f&&void 0!==typeof f&&f.length>0&&(this.containsInheritedAccess=!0),f.forEach((function(e,t){UWA.createElement("div",{html:" -&nbsp;"+e.inheritedFrom.objectTNR}).inject(p);var n="";e.inheritedAccess.hasOwnProperty("logical")?n=o.AccessRightController.getAccessNls(e.inheritedAccess.logical):e.inheritedAccess.hasOwnProperty("physical")&&(n=e.inheritedAccess.physical),UWA.createElement("div",{html:n}).inject(m)}))}var v="";i.owner.hasOwnProperty("comment")&&(v=i.owner.comment);var I=v;0==this.isReadOnly&&(I=new t.Text({value:v,className:"input-tree-label"}));var A=!0;n.hasOwnProperty("isAllInherit")?A=n.isAllInherit:""==p.getText()&&(A=!1);for(var y=!1,S=o.AccessRightController.getSelectedItemList(),b=S.length,R=0;R<b;R++)if(this.isPovOwner(S[R].physicalId,i.owner)){y=!0;break}var w="";A||0!=this.isReadOnly||y||((w=new u({attributes:{title:UWA.i18n("RemoveAccess")},value:"",className:"default medium AR_DeleteUser",icon:"cancel"})).getContent().setAttribute("data-rec-id","DeleteButton"+a),w.elements.icon.setAttribute("data-rec-id","DeleteButtonicon"+a),w.addEvents({onClick:function(){o.DeleteUser(a),o.onResize(),o.dispatchEvent("onChangeSize")}}));var O=i.access.logical,E=i.access.logical,D=O,_=this.AccessRightController.getFormattedRightList();if(0==this.isReadOnly&&!A&&!y){o=this;_.forEach((function(e,t,n){e.label==O&&t,o.LifecycleConfidentialityEnabled||"ReaderR"==e.value&&"ReaderR"!=O&&n.erase(e)})),(D=new g({nativeSelect:!0,placeholder:!1,options:_,events:{onChange:function(){o._ManageValidButton(),o.listInputErrors.length>0&&o.setError(o.listInputErrors[0])}}})).elements.container.setAttribute("data-rec-id","dataRecComboRightsContainer"+a),D.elements.content.setAttribute("data-rec-id","dataRecComboRights"+a),D.select(O),i.hasOwnProperty("InitRights")&&(E=i.InitRights)}if(A)D=C.get("AR_Inherited_Message");else if(y){D=UWA.i18n("povOwner").format(s)}else if(this.isReadOnly){i.access.nls;D=o.AccessRightController.getAccessNls(i.access.logical)}var U={OwnershipContainer:n,InitRights:E,Id:a};return o.listID.push(U),{Id:a,InitRights:E,UserName:h,ComboRights:D,inherit_From:p.getText(),inherit_Access:m.getText(),Comments:I,Delete:w}},AddSelectedItemsInTable:function(){var e=this,t=[],n=[];t=e.AccessRightController.getSelectedItemList();var r=e.AccessRightController.getErrorSelectedItemList();JSON.parse("[]");t.forEach((function(t){var i=!1;if(null!=t&&null!=t.physicalId){null!=r[t.physicalId]&&(i=!0);var o="",s=null,a="";0==e.isODT&&i&&(o=C.get("accessRightFailure")),!0===e.isODT&&i&&(o="access right failure"),0==e.isODT&&i&&(s="syc-red-circle-symbol",a=UWA.createElement("div",{class:s}));var c=UWA.createElement("img",{src:t.urlIcon}),l=UWA.createElement("div",{text:t.name}),d=UWA.createElement("div",{class:"TitleDiv"});l.setStyles({display:"inline-block","padding-left":"6px"}),d.appendChild(c),d.appendChild(l);var h={Id:t.physicalId,Title:d,Type:t.typeDisplayName,Symbol:a,Revision:t.Revision,Organization:t.organizationTitle,CollaborativeSpace:t.collabSpaceTitle,Responsible:t.responsibleName,Result:o};n.push(h)}})),e.csoTable.AddDatasInTable(n)},ODTModificationComplete:function(e){var t=this;1==e.success?t.showNotificationInTable(e):t.addErrorAfterOperation(t,e),t._ManageValidButton(!1)},ODTGetListOfItemsInTable:function(){return this.AccessRightController.getSelectedItemList().length},ODTGetListOfUserItemsInTable:function(){return this.table.getAllLine().length},send3DNotification:function(e){var t=this,n={wintop:t.options.wintop,serverUrl:t.options.serverUrl};d.getInstance(n).getSecurityContext({onSuccess:function(n){t.AccessRightController.send3DNotification(e,n)},onFailure:function(e){t.setError(e)}})},_create_UUID:function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)}))}})}));