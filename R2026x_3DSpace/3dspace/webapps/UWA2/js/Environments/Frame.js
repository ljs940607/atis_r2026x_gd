define("UWA/Environments/Frame",["UWA/Core","UWA/Utils","UWA/Utils/Client","UWA/Utils/InterCom","UWA/Element","UWA/Event","UWA/Environment","UWA/Controls/Scroller","UWA/Storage/Adapter/Object"],(function(e,t,n,i,o,s,r,a){"use strict";var d=r.extend({name:"frame",init:function(e){this._remoteQueue=[],this._parent(e)},getOption:function(e){var t=document.querySelector("body");return t.hasAttribute(e)&&t.getAttribute(e)},onInit:function(){var e=document.querySelector("body"),t=o.getElement.bind(e);t(".moduleFrame")||this.buildSkeleton(e),this.html={wrapper:t(".module"),header:t(".moduleHeader"),content:t(".moduleWrapper"),body:t(".moduleContent"),edit:t(".moduleEdit"),menus:t(".moduleHeader > menu"),footer:t(".moduleFooter"),counter:t(".counter"),title:t(".title"),icon:t(".icon"),shareAction:t(".share"),refreshAction:t(".refresh"),editAction:t(".edit")},!this.scroller&&Number(this.getOption("displayScroller"))&&(this.scroller=new a(this.html.content,{snap:!1,bounce:!0,momentum:!0,lockDirection:!0})),this.onResize()},buildSkeleton:function(t){var n=e.hosts,i=e.i18n,s=n.uwa+e.paths.img+"icon.png",r=["module moduleUwa"],a=this.getOption("chromeColor"),d=Number(this.getOption("displayHeader")),h=Number(this.getOption("displayFooter")),u=Number(this.getOption("displayEdit")),l=[];a&&r.push(a+"-module"),d&&l.push({tag:"div",class:"moduleHeader",html:[{tag:"span",class:"icon",html:{tag:"img",height:16,width:16,src:s}},{tag:"span",class:"counter"},{tag:"span",class:"title",text:i(document.title)||i("Loading...")},{tag:"menu",type:"toolbar",class:"menus"}]}),l.push({tag:"div",class:"moduleWrapper",html:[u&&{tag:"div",class:"moduleEdit"},{tag:"div",class:"moduleContent",html:i("Loading...")}]}),h&&l.push({tag:"div",class:"moduleFooter",html:[{tag:"a",class:"powered",href:n.netvibes,text:i("Â© Netvibes")},{tag:"a",class:"share",href:n.ecosystem,text:i("Subscribe to this app")}]}),o.setContent.call(t,{tag:"div",class:r.join(" "),html:l})},onResize:function(){var e=this,t=e.html,i=t.wrapper.getScrolls(),o=e.scroller?n.getSize():i,s=o.width,r=o.height;if(r>0&&r!==e.prevHeight&&(this.sendRemote("onResizeHeight",r),this.scroller&&(["header","footer"].forEach((function(e){r-=t[e]?t[e].offsetHeight:0})),this.scroller.setOptions({height:r}),this.scroller.onRefresh()),this.prevHeight=r),this.prevWidth===s)return!1;n.Engine.safari&&this.html.wrapper.setStyle("width",s+"px"),this.prevWidth=s},onRegisterWidget:function(){this._parent(),this.sendRemote("onRegisterWidget"),s.onDomReady((function(){this.initRemote()}),this)},onLoad:function(){this._parent(),this.sendRemote("onLoad")},onInitConfig:function(e){this._parent(),this.sendRemote("onInitConfig",e)},onUpdateCounter:function(e,t){this._parent(e,t),this.sendRemote("onUpdateCounter",e,t)},onUpdateTitle:function(e){this._parent(e),this.sendRemote("onUpdateTitle",e)},onUpdateIcon:function(e){this._parent(e),this.sendRemote("onUpdateIcon",e)},onUpdateValue:function(e,t){this.widget?this.widget.setValue(e,t):this.setData(e,t),this.sendRemote("onUpdateValue",e,t)},onUpdatePreferences:function(e){this._parent(e),this.sendRemote("onUpdatePreferences",e)},onSearch:function(e){this._parent(e),this.sendRemote("onSearch",e)},onResetSearch:function(){this._parent(),this.sendRemote("onResetSearch")},onViewRequest:function(e){this.sendRemote("onViewRequest",e)},initRemote:function(){if("false"!==t.parseQuery(window.location.search).remote){var e,n=this,o=n.widget;n.socket||(n.remoteCallbacks={},(e=new i.Socket(o.id+"-slave")).subscribeServer("uwa.embedded",window.parent,o.widgetDomain),e.addListener("environmentMessage",(function(e){var t=e.args,i=t.shift();n.disableRemote=i,n.dispatchEvent(i,t),n.disableRemote=!1})),n.socket=e,n._runRemoteQueue())}},_runRemoteQueue:function(){var e,t,n=this;n.socket&&0!==n._remoteQueue.length&&(t=n._remoteQueue.shift(),!0===n.disableRemote||n.disableRemote===t[0]?n.log("sendRemote message ignored: "+t):(e={id:n.widget.id,args:t},n.log("sendRemote message: "+t),n.socket.dispatchEvent("widgetMessage",e,[e.id+"-master"])),n._runRemoteQueue())},sendRemote:function(){this._remoteQueue.push(t.toArray(arguments)),this._runRemoteQueue()}});return e.namespace("Environments/Frame",d,e)}));