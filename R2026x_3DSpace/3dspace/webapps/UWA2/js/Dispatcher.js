define("UWA/Dispatcher",["UWA/Core","UWA/Utils","UWA/Class"],(function(e,i,n){"use strict";var t=e.Class.extend({Binding:null,bindings:null,shouldPropagate:!0,active:!0,dispatching:0,init:function(){this.bindings=[]},registerListener:function(i,n,t,r){if(!(e.is(i,"function")||e.is(i,"object")&&e.is(i.handleEvent,"function")))throw new Error("listener is a required param of add() and addOnce() and should be a Function or an object implementing the EventListener interface.");var s,o,d=this;if(s=d.indexOfListener(i,t),o=d.bindings[s]){if(o.isOnce!==n)throw new Error("You cannot add"+(n?"":"Once")+"() then add"+(n?"Once":"")+"() the same listener without removing the relationship first.")}else o=new this.Binding(d,i,n,t,r),d.addBinding(o);return o},addBinding:function(e){var i=this.bindings,n=i.length;do{--n}while(i[n]&&e.priority<=i[n].priority);i.splice(n+1,0,e)},indexOfListener:function(e,i){for(var n=this.bindings,t=n.length;t--;)if(n[t].listener===e&&(void 0===i||n[t].context===i))return t;return-1},add:function(e,i,n){return this.registerListener(e,!1,i,n)},addOnce:function(e,i,n){return this.registerListener(e,!0,i,n)},remove:function(i,n){var t,r,s=this;if(!(e.is(i,"function")||e.is(i,"object")&&e.is(i.handleEvent,"function")))throw new Error("listener is a required param of remove() and should be a Function or an object implementing the EventListener interface.");if(-1!==(t=s.indexOfListener(i,n)))if(r=s.bindings[t],s.dispatching&&!r.isOnce){var o=s.bindings.indexOf(r);-1!==o&&s.bindings.splice(o,1)}else r.destroy();return i},removeAll:function(e){var i,n=this.bindings,t=n.length;if(e)for(;t--;)(i=n[t]).context===e&&i.destroy();else{for(;t--;)n[t].destroy();n.length=0}},getNumListeners:function(){return this.bindings.length},getListeners:function(){return this.bindings.map((function(e){return e.listener}))},halt:function(){this.shouldPropagate=!1},dispatch:function(e,n){var t,r,s=this;if(s.active){e=i.toArray(e),r=s.bindings.slice(),s.shouldPropagate=!0,s.dispatching++;try{for(t=r.length-1;t>=0&&!1!==r[t].execute(e,n)&&s.shouldPropagate;t--);}finally{if(s.dispatching--,s.bindings)for(t=0;t<r.length;t++)s.bindings.indexOf(r[t])<0&&r[t].destroy()}}},dispose:function(){var e=this;e.removeAll(),e.active=!1,delete e.bindings},toString:function(){return"[Dispatcher active: "+this.active+" numListeners: "+this.getNumListeners()+"]"}});return t.Binding=t.prototype.Binding=n.extend({listener:null,isOnce:!1,context:null,dispatcher:null,priority:0,active:!0,init:function(e,i,n,t,r){var s=this;s.listener=i,s.isOnce=n,s.context=t,s.dispatcher=e,s.priority=r||0},execute:function(i,n){var t,r=this,s=r.listener,o=e.is(r.context)?r.context:n;return r.active&&(r.isOnce&&r.detach(),t="function"==typeof s.handleEvent?s.handleEvent.apply(void 0===o?s:o,i||[]):s.apply(o,i||[])),t},detach:function(){var e=this;return e.dispatcher&&e.dispatcher.remove(e.listener,e.context),e.listener},getListener:function(){return this.listener},dispose:function(){this.destroy()},destroy:function(){var e,i=this,n=i.dispatcher;n&&(e=n.bindings.indexOf(i),i.active=!1,-1!==e&&n.bindings.splice(e,1),delete i.dispatcher),delete i.isOnce,delete i.listener,delete i.context},toString:function(){return"[Dispatcher.Binding isOnce: "+this.isOnce+", active: "+this.active+"]"}}),e.namespace("Dispatcher",t,e)}));