define("UWA/Data",["UWA/Core","UWA/Utils","UWA/Utils/Client","UWA/Ajax","UWA/Json","UWA/Internal/StringMap","UWA/Class/Events"],(function(e,t,r,o,n,a,s){"use strict";var i,u,d,c,p,h,l,f=new a,m={proxies:(h=e.hosts,l=h.exposition+"/proxy/",e.merge(h.proxies||{},{ajax:l+"ajax",resolve:l+"resolve",xml:l+"xml",spreadsheet:l+"spreadsheet",soap:l+"soap",feed:l+"feed",icon:l+"icon",richIcon:l+"richIcon",rss:l+"feed"})),useJsonpRequest:!0,allowCrossOriginRequest:!1,useOfflineCache:!1,request:(i=/OPTIONS|GET|HEAD|POST|PUT|DELETE|TRACE|CONNECT/i,u=/json|document|blob|arraybuffer|text/,d=/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{4}|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)$/,c=r.isOnline,p={text:function(e){return"string"!=typeof e&&(e=n.encode(e)),e},json:function(t){if("string"==typeof t&&(t=n.decode(t)),!e.is(t,["object","array"]))throw new Error('Invalid JSON Response: "'+String(t)+'"');return t},xml:function(e){return"string"==typeof e&&(e=t.loadXml(e)),e},document:function(e){return"string"==typeof e&&(e=t.loadHtml(e)),e},blob:function(e,r){var o=t.getOwnPropertyMatchValue(r,"Content-Type")||"text/plain";return"string"==typeof e&&(e=d.test(e)?function(e,t){var r,o,n=";base64,",a=e.indexOf(n)+8,s=e.substring(a),i=window.atob(s),u=i.length,d=new Uint8Array(u);for(r=0;r<u;++r)d[r]=i.charCodeAt(r);return(o=new BlobBuilder).append(d.buffer),o.getBlob(t)}(e,o):new Blob([e],{type:o})),e},arraybuffer:function(e){return"string"==typeof e&&(e=new ArrayBuffer(12)),e}},function(r,a){if(!r)throw new Error("Bad or missing url argument.");a=a||{};var h,l,f,y,g,C,x,w,q,O,T,E,U=window.location,v="ajax",A={timeout:25e3,method:"GET",type:"text",proxy:!1,async:!0,headers:{},useMergeRequest:!0,useOfflineCache:m.useOfflineCache,allowCrossOriginRequest:m.allowCrossOriginRequest,useJsonpRequest:m.useJsonpRequest,onComplete:function(){},onCancel:function(){},onFailure:function(e){throw e}};return a.requestHeaders&&(a.headers=a.requestHeaders,delete a.requestHeaders),a.postBody?(a.method="POST",a.data=a.postBody,delete a.postBody):a.parameters&&(a.method="POST",a.data=a.parameters,delete a.parameters),a.auth&&(a.authentication=a.auth,delete a.auth),"html"===a.type?a.type="document":"feed"===a.type&&(a.type="json"),(a=e.merge(a,A)).type=p[a.type]?a.type:A.type,a.timeout=parseInt(a.timeout,10),i.test(a.method)&&(a.method=a.method.toUpperCase()),"json"===a.type&&(t.getOwnPropertyMatchName(a.headers,"Accept")||(a.headers.Accept="application/json,text/javascript,*/*"),t.getOwnPropertyMatchName(a.headers,"X-Request")||(a.headers["X-Request"]="JSON")),w=a.type,q=a.useOfflineCache,O=a.allowCrossOriginRequest,T=a.useJsonpRequest,E=r,a.proxy?(r=m.proxifyUrl(r,a),T=T&&!1===t.matchUrl(r,U)&&!1===O):!1===t.matchUrl(r,U)&&!1===O?(T=T&&!1===t.matchUrl(m.proxies[v],U),r=m.proxifyUrl(r,e.extend(a,{proxy:v}))):T=!1,m.requests=m.requests||{},g=function(r,o){var n={url:r,timeout:o.timeout,method:o.method,type:o.type,proxy:o.proxy,async:o.async,data:o.data,headers:o.headers};return"GET"===o.method&&!1!==o.useMergeRequest||(n.uuid=t.getUUID()),e.Json.encode(n)}(r,a),l={onComplete:a.onComplete,onFailure:a.onFailure,onCancel:a.onCancel,onTimeout:a.onTimeout||a.onFailure},m.requests[g]?(h=m.requests[g]).addEvents(l):((h=m.requests[g]=new s).addEvents(l),C=function(e,r){var o,n=e;delete m.requests[g],o=t.attempt((function(){var o;return T&&(r=e.headers,o=e.body,d.test(o)&&(o=t.base64Decode(o)),e=o),e=p[w](e,r),q&&m.storeInCache(E,n),!0}),(function(){return x("onFailure",arguments),!1})),o&&h.dispatchEvent("onComplete",[e,r])},x=function(t,r){var o,n,a=!0;delete m.requests[g],q&&(o=m.getFromCache(E),e.is(o)&&(a=!1,c()&&c(!1,n||5e3),C(o))),a&&h.dispatchEvent(t,r)},f={method:a.method,data:a.data,headers:a.headers,fromDataRequest:E,timeout:a.timeout,async:a.async,withCredentials:a.withCredentials,onComplete:function(e,t){C(e,t)},onFailure:function(){x("onFailure",arguments)},onCancel:function(){x("onCancel",arguments)},onTimeout:function(){x("onTimeout",arguments)},onProgress:a.onProgress},q&&!1===c()?f.onFailure(new Error("Network is Offline")):T?(a.data&&a.data.length>0&&-1!==["POST","PUT"].indexOf(a.method)&&(r+=-1!==r.indexOf("?")?"&":"?","POST"===a.method?r+=t.toQueryString(a.data,"postData"):"PUT"===a.method&&(r+=t.toQueryString(a.data,"rawData")),delete f.data,delete f.method),y=n.request(r,f)):(w&&u.test(w)&&(f.responseType=w),h.xhr=y=o.request(r,f)),h.url=E,h.options=a,h.cancel=y.cancel),h}),proxifyUrl:function(e,r){if(!e)throw new Error("Bad or missing url argument.");var o,n=[],a=r.proxy,s=t.toQueryString,i=m.proxies;if(!a||!i[a])throw new Error("Invalid proxy");if(o=i[a],0===e.indexOf(o))return e;if(r.data&&r.method&&"GET"===r.method.toUpperCase()&&(e+=(e.indexOf("?")>-1?"&":"?")+s(r.data),delete r.data),"object"==typeof r[a]&&(n.push(s(r[a])),delete r[a]),r.type&&(n.push(s({type:r.type})),delete r.type),"object"==typeof r.authentication&&n.push(s(r.authentication)),r.cache&&(n.push(s({cache:parseInt(r.cache,10)})),r.cache<0&&n.push(Date.now())),r.headers&&(n.push(s(r.headers,"headers")),delete r.headers),r.connect&&n.push(s({connect:r.connect})),r.service&&n.push(s({service:r.service})),r.wid&&n.push(s({wid:r.wid})),r.method&&n.push(s({method:r.method})),n.push(s({url:e})),(e=o+"?"+n.join("&")).length>8192)throw new Error("Proxified url is more than 8192 characters, that is the limit for most of the browsers.");return e},getFeed:function(e,t){return m.request(e,{method:"GET",proxy:"feed",type:"json",onComplete:t})},getXml:function(e,t){return m.request(e,{method:"GET",type:"xml",onComplete:t})},getText:function(e,t){return m.request(e,{method:"GET",type:"text",onComplete:t})},getJson:function(e,t){return m.request(e,{method:"GET",type:"json",onComplete:t})},getCache:function(){return f},storeInCache:function(r,o){o=t.toArray(o).filter((function(t){return e.is(t)&&!t.nodeType})),m.getCache().set(t.getCheckSum(r),o)},getFromCache:function(e){return m.getCache().get(t.getCheckSum(e))}};return e.namespace("Data",m,e)}));