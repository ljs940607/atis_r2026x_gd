define("UWA/Controls/Pager",["UWA/Core","UWA/Event","UWA/Controls/Abstract"],(function(e,t,n){"use strict";var i=n.extend({offset:0,limit:0,max:0,length:0,loadingData:!1,defaultOptions:{className:"uwa-pager nv-pager",type:0,showPageLinks:!1,showMoreLink:!1,pageLinks:5,length:0,offset:0,limit:10,max:0,loadNext:null,prevLabel:"prev",nextLabel:"next",moreLabel:"more"},init:function(e){this._parent(e),e=this.options,this.offset=parseInt(e.offset,10),this.limit=parseInt(e.limit,10),this.max=parseInt(e.max,10),this.length=parseInt(e.length,10),this.buildSkeleton()},setOptions:function(e){return this._parent(e),(e=this.options).dataLength?e.length=e.dataLength:e.dataArray&&(e.length=e.dataArray.length),e.onChange&&this.addEvent("onOffsetChange",e.onChange),e.onMoreClick&&this.addEvent("onMoreClick",e.onMoreClick),(e.showPageLinks||e.pageLinks&&!e.type)&&(this.type=1),this},setLength:function(e){this.length=parseInt(e,10),this.setOffset(this.offset)},setOffset:function(e){var t=this,n=t.offset;return e=e<0?0:e,t.offset=Math.min(parseInt(e,10),t.max||t.length),n!==t.offset&&t.dispatchEvent("onOffsetChange",[t.offset]),t},setLimit:function(e){return this.limit=parseInt(e,10),this},getPageOffset:function(e){return Math.ceil((parseInt(e,10)||this.offset)/this.limit)},getPages:function(){return Math.ceil((this.max||this.length||1)/this.limit)},isLastPage:function(){var e=this,t=!e.max||e.length>=e.max,n=e.offset+e.limit>=e.length;return t&&n},buildSkeleton:function(){this.elements.container=e.createElement("div",{class:this.options.className}),this.dispatchEvent("onRefresh")},buildPageInfos:function(){var t=this.elements;t.pageInfos=e.createElement("span",{class:"pageInfos",html:e.createElement("span",{text:this.getPageOffset()+1+" / "+this.getPages()})}).inject(t.subContainer)},buildPageLinks:function(){var t,n,i=this.elements,s=this.options,a=this.injectPageLink.bind(this),o=this.injectPageSeparator.bind(this),l=s.pageLinks,r=this.getPages(),h=this.getPageOffset(),c=0,f=Math.round(l/2),g=h>=f&&r>=l?h-f+1:0;if(i.pageContainer=e.createElement("span",{class:"pageLinks"}),g<r)for(t=g;t<r&&c<l;t++)g>=1&&0===c&&(a(c),t>1&&o()),n=a(t),t===h&&n.addClassName("selected"),t<r-1&&c===l-1&&(t<r-2&&o(),a(r-1)),c++;i.pageContainer.inject(i.subContainer)},injectPageLink:function(t){var n=parseInt(t+1,10);return e.createElement("a",{class:"pageLink",href:"#page_"+n,text:n,events:{click:this.dispatchAsEventListener("onPageClick",t)}}).inject(this.elements.pageContainer)},injectPageSeparator:function(){return e.createElement("span",{class:"comas",text:" ... "}).inject(this.elements.pageContainer)},onRefresh:function(){var t=this.elements,n=this.options,i=this.isLastPage();t.container.empty(),t.subContainer=e.createElement("div"),t.prev=e.createElement("a",{class:"prev"+(0===this.offset?" disabled":""),href:"#prev",html:e.createElement("span",{text:e.i18n(n.prevLabel)}),events:{click:this.dispatchAsEventListener("onPrevClick")}}).inject(t.subContainer),i&&(n.showMoreLink||n.moreLink)?t.next=e.createElement("a",{class:"more",href:n.moreLink||"#more",html:e.createElement("span",{text:e.i18n(n.moreLabel)}),events:{click:this.dispatchAsEventListener("onMoreClick")}}).inject(t.subContainer):t.next=e.createElement("a",{class:"next"+(i?" disabled":""),href:"#next",html:e.createElement("span",{text:e.i18n(n.nextLabel)}),events:{click:this.dispatchAsEventListener("onNextClick")}}).inject(t.subContainer),1===n.type?this.buildPageLinks():2===n.type&&this.buildPageInfos(),t.subContainer.inject(t.container)},onOffsetChange:function(e){this.offset=e,this.dispatchEvent("onRefresh"),this.dispatchEvent("onChange",[e])},onPageClick:function(t,n){e.Event.preventDefault(t),this.loadingData||this.setOffset(this.limit*n)},onPrevClick:function(e){t.preventDefault(e);var n=t.findElement(e,"a");this.loadingData||n.hasClassName("disabled")||this.setOffset(this.offset-this.limit)},onNextClick:function(e){t.preventDefault(e);var n=this,i=n.options.loadNext,s=t.findElement(e,"a"),a=n.offset+n.limit,o=a+n.limit<=n.length;function l(){n.setOffset(a)}n.loadingData||n.isLastPage()||s.hasClassName("disabled")||(!i&&n.onNeedMoreData&&(i=function(e,t){n.onNeedMoreData(e),setTimeout(t.bind(null,null),6e4)}),!o&&i?(n.dispatchEvent("onLoadingStart"),i(n.length,(function(e){e&&(n.length=e),l(),n.dispatchEvent("onLoadingEnd")}))):l())},onMoreClick:function(){},onLoadingStart:function(){this.loadingData=!0,this.elements.subContainer.addClassName("loading")},onLoadingEnd:function(){this.loadingData=!1,this.elements.subContainer.removeClassName("loading")}});return e.namespace("Controls/Pager",i,e)}));