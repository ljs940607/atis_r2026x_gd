define("UWA/Controls/SearchForm",["UWA/Core","UWA/Utils/Client","UWA/Json","UWA/Event","UWA/Class/Timed","UWA/Controls/Abstract"],(function(t,e,i,s,n,o){"use strict";var r=o.extend(n,{name:"uwa-searchform",defaultOptions:{searchText:"",faviconUrl:"",submitButton:"button",className:"nv-search",showCheckbox:!1,showHistory:!1,allowEmpty:!1,dir:"ltr",limit:10},init:function(t){this.historyList=[],this._parent(t),this.buildSkeleton(),this.options.faviconUrl&&this.setFavicon(t.faviconUrl),this.options.searchText&&this.setSearchText(t.searchText)},setOptions:function(t){(t=t||{}).searchHistory&&(t.showHistory=!0),this._parent(t)},setInitialState:function(t,e){var i=this;i.setFavicon(t),i.setSearchText(e),i.setCheckboxState(e)},buildSkeleton:function(){var e,i,s=t.i18n,n=this,o=n.options,r=n.elements;e=t.createElement("div",{class:"search "+this.getClassNames()}),r.form=t.createElement("form",{events:{submit:this.dispatchAsEventListener("onSubmitByHistoryLink")}}).inject(e),r.favicon=t.createElement("img",{class:"favicon",src:t.hosts.uwa+t.paths.css+"base/img/s.gif",width:16,height:16,styles:{display:"none"}}).inject(r.form),r.inputWrapper=t.createElement("span",{class:"input-wrapper"}).inject(r.form),r.inputSearch=t.createElement("input",{class:"search",type:"text",value:"",events:{focus:this.dispatchAsEventListener("onFocusSearch"),blur:this.dispatchAsEventListener("onBlurSearch"),click:this.dispatchAsEventListener("onClickSearch"),keypress:this.dispatchAsEventListener("onSearchKeyPress")}}).inject(r.inputWrapper),r.resetButton=t.createElement("img",{class:"clear",alt:s("Clear"),title:s("Clear"),src:t.hosts.uwa+t.paths.css+"base/img/clear.gif",events:{click:this.dispatchAsEventListener("onResetSearch")},styles:{display:"none"}}).inject(r.inputWrapper),i=o.submitButton&&"string"!=typeof o.submitButton?o.submitButton:"icon"===o.submitButton?t.createElement("a",{"data-icon":"U",class:"uwa-icon uwa-icon-only",alt:t.i18n("Search"),events:{click:this.dispatchAsEventListener("onSubmitByHistoryLink")}}):t.createElement("input",{type:"submit",value:t.i18n("Search")}),r.inputWrapper.addContent(i),r.inputWrapper.lastChild.addClassName("submit"),o.showCheckbox&&(r.checkbox=t.createElement("input",{class:"check",type:"checkbox",title:o.checkboxTitle||"",value:"",events:{click:this.dispatchAsEventListener("onToggleSearch")}}).inject(r.form),"rtl"===o.dir?r.checkbox.setStyle("left","5px"):r.checkbox.setStyle("right","5px")),n.inputSearch=r.inputSearch,n.form=r.form,this.container=e},buildHistoryBox:function(){this.hideHistory();var e=this,i=e.elements,n=i.inputSearch,o=n.getSize(),r=e.getSearchText(),c=e.historyList,h=t.createElement("ul",{class:"uwa-popup-menu",events:{click:function(i){s.stop(i);var n=t.Event.getElement(i).getText();e.setSearchText(n),e.dispatchEvent("onSubmitByHistoryLink",[i])}}});c.forEach((function(t){r!==t&&e.getHistoryBoxItem(t).inject(h)})),t.createElement("li",{class:"uwa-popup-menu-item action",html:{tag:"a",text:t.i18n("Clear recent searches"),events:{click:function(t){s.stop(t),e.clearHistory()}}}}).inject(h),h.inject(i.form),h.setStyles({width:o.width-n.getComputedSize("borderWidth")+"px"}),h.setPosition({x:0,y:o.height-n.getComputedSize("borderWidth")},{relative:n}),i.historyBox=h},getHistoryBoxItem:function(e){return t.createElement("li",{class:"uwa-popup-menu-item",html:{tag:"a",href:"#history:"+e,html:{tag:"span",text:e}}})},setFavicon:function(t,e){var i=this.elements.favicon;i.src=t,i.alt=i.title=e,i[t&&t.length?"show":"hide"]()},setSearchText:function(t){var e=this.elements,i=e.inputSearch,s=e.resetButton;i.value=t||"",s[t&&t.length?"show":"hide"](),this.addHistory(t)},getSearchText:function(){return this.elements.inputSearch.value},setCheckboxState:function(t){var e=this.elements.checkbox;e&&(t?(e.setAttribute("checked","checked"),e.defaultChecked=!0):(e.setAttribute("checked",""),e.defaultChecked=!1))},getCheckboxState:function(){var t=this.elements.checkbox;return t&&"checked"===t.getAttribute("checked")},setHistoryString:function(e){var s=[];t.is(e,"string")&&i.isJson(e)&&(e=i.decode(e)),t.is(e,"array")?s=e:t.is(e)&&(s=String(e).split(":")),s.forEach(this.addHistory,this)},getHistoryString:function(){return i.encode(this.historyList)},addHistory:function(e){var i=this,s=i.historyList,n=s.indexOf(e);t.is(e,"string")&&e.length>0&&(n>-1&&s.splice(n,1),s.unshift(e),s.length>i.options.limit&&s.pop(),i.dispatchEvent("updateHistory"))},clearHistory:function(){var t=this;t.historyList=[],t.dispatchEvent("updateHistory"),t.hideHistory()},hideHistory:function(){var t=this;t.elements.historyBox&&t.elements.historyBox.destroy(),t.elements.historyBox=null},showHistory:function(){var t=this,e=t.historyList,i=t.getSearchText();t.options.showHistory&&(e.length>1||1===e.length&&e[0]!==i)&&t.buildHistoryBox()},toggleHistory:function(){var t=this;t.options.showHistory&&(t.elements.historyList?t.hideHistory():t.showHistory())},onSubmitSearch:function(t,e){var i=this;i.hideHistory(),i.setSearchText(t),i.dispatchEvent("submit",[t,e])},onSubmitByHistoryLink:function(t){s.stop(t);var e=this.getSearchText(),i="onSubmitSearch";0!==e.trim().length||this.options.allowEmpty||(i="onResetSearch"),this.dispatchEvent(i,[e,this.getCheckboxState()])},onResetSearch:function(){var t=this;t.hideHistory(),t.setSearchText(""),t.dispatchEvent("reset")},onToggleSearch:function(){this.dispatchEvent("toggle")},onFocusSearch:function(){this.dispatchEvent("focus"),this.clearDelayed("onBlurSearch")},onBlurSearch:function(){this.options.showHistory&&this.setDelayed("onBlurSearch",this.hideHistory,500,!1,this),this.dispatchEvent("blur")},onClickSearch:function(){this.options.showHistory&&this.toggleHistory()},onSearchKeyPress:function(){this.options.showHistory&&this.hideHistory()}});return t.namespace("Controls/SearchForm",r,t)}));