/*!  COPYRIGHT DASSAULT SYSTEMES 2015   */
define("DS/SNNavigationMap/utils/PromisesManager",["UWA/Class","DS/WAFData/WAFData","DS/ENORIPE_Common/utils/CommonAlert","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n){"use strict";return e.extend({init:function(e){this._debug=e.debugMode||!1},createPromise:function(s,o){var a={},r={};return this._debug&&s.params&&(s.params.debug=!0),o||(o="POST"),s.params&&(s.params.label="RelationalExplorer",a=JSON.stringify(s.params)),new e.Promise((function(e,l){t.authenticatedRequest(s.url,{headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:s.xPrefCredential},method:o,data:a,onComplete:function(t){s.onComplete?s.onComplete(t).then((function(t){e(t)})):e(t)},timeout:s.timeout,onFailure:function(e){r=s.failureParams?s.failureParams:{level:"error",msg:n.get("generic"),sticky:!0},console.log(e),s.noErrorMsg||i.showNotif(r),l(e)},onTimeout:function(e){console.log(e),i.showNotif({level:"error",msg:n.get("timeout"),subtitle:n.get("verifyConnection"),sticky:!0}),l(e)}})}))}})})),define("DS/SNNavigationMap/utils/MapSecurityCtxConverter",["UWA/Class","UWA/Promise"],(function(e,t){"use strict";return e.singleton({init:function(){},buildSecurityContext:function(e,t,i){return"ctx::"+i+"."+t+"."+e},buildDisplayString:function(e,t,i,n){var s=" ‚óè ";return n?e+s+i:e+s+t+s+i},extractCouple:function(e){var t="",i="",n="",s="";for(var o in e){var a=e[o];switch(o){case"organization":i=a.title?a.title:a.name,t=a.name;break;case"role":n=a.name,s=a.nls?a.nls:n}}return{org:t,orgLabel:i,role:n,roleNls:s}},prepareForStorage:function(e){var t,i,n,s,o=e.pid,a=[],r=null,l=!0;for(var c in e.preferredcredentials){var d=e.preferredcredentials[c];switch(c){case"collabspace":i=d.name;break;case"organization":n=d.name;break;case"role":s=d.name}}for(var h in t=this.buildSecurityContext(i,n,s),e.collabspaces){if((p=e.collabspaces[h]).couples&&p.couples.length)for(var u=0;u<p.couples.length;u++){var g=this.extractCouple(p.couples[u]);if(null===r)r=g.org;else if(r!=g.org){l=!1;break}}}for(var h in e.collabspaces){var p;if((p=e.collabspaces[h]).couples&&p.couples.length)for(u=0;u<p.couples.length;u++){g=this.extractCouple(p.couples[u]);var f=this.buildSecurityContext(p.name,g.org,g.role),m=p.title?p.title:p.name,v={csName:m,label:this.buildDisplayString(m,g.orgLabel,g.roleNls,l),value:f};t===f&&(v.isDefault=!0),a.push(v)}}return{userId:o,securityContext:t,cspaces:a}},getSecurityContext:function(e){var t="string"==typeof e?JSON.parse(e):e,i=this.prepareForStorage(t),n=i.securityContext;return void 0!==i.cspaces.find((e=>e.value===n))||(i.cspaces&&i.cspaces.length>0?i.securityContext=i.cspaces[0].value:i.securityContext=void 0),i}})})),define("DS/SNNavigationMap/models/Count",["UWA/Class/Model","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t){"use strict";return e.extend({defaults:{id:"",count:0,cslCount:0,name:"",direction:"",source:"",relationName:""},setup:function(e,i){this._parent(e,i),e.name&&this.set("relationName",t[e.name+"_short"]||t[e.name])},parse:function(e){return count=UWA.extend(count,{id:e.id,count:e.count,cslCount:e.cslCount,name:e.name,direction:e.direction,source:e.source,relationName:t[e.name+"_short"]||t[e.name]}),count}})})),define("DS/SNNavigationMap/views/NavigationPager",["UWA/Core","UWA/Class/View","DS/Handlebars/Handlebars4","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","text!DS/SNNavigationMap/assets/templates/pager.html"],(function(e,t,i,n,s){"use strict";return t.extend({name:"navigationapp-homepage-view",_matchedNodes:[],_selectedIndex:0,className:function(){return this.getClassNames("-container")},setup:function(t){this._debug=t.debugMode,this._widgetId=t.widgetId||null,this._isWebInWin=t.isWebInWin;var o=i.compile(s),a={previousTitle:n.get("Pager-Previous"),nextTitle:n.get("Pager-Next"),closeTitle:n.get("Pager-Close")},r=o.call(null,a);e.createElement("div",{class:"ENORIPE-pager-container",html:r}).inject(this.container);this._isWebInWin&&this.container.addClassName("enoripe-pager-native"),this._setUpEvents()},render:function(e){if(e&&e.result&&e.result.length&&e.result.length>0){if(this.container.show(),this._matchedNodes=[...new Set(e.result)],this._matchedNodes.push("All"),this._selectedIndex=0,this._setCount(this._matchedNodes.length),!e.noChangeFocus){var t=this._matchedNodes[this._selectedIndex];t&&this.dispatchEvent("ENORIPE_HighlightNode",t)}}else this.container.hide()},_setCount:function(e){var t=this._selectedIndex+1,i=this._selectedIndex+1+"/"+(e-1),n=this.getElement(".ENORIPEPagerLabel");t===e&&(i="All"),n&&n.setContent(i)},_clearCount:function(){var e=this.getElement(".ENORIPEPagerLabel");e&&e.empty()},_setUpEvents:function(){var e=this;this.getElement(".ENORIPEPagerPreviousButton").addEventListener("click",e._prevClick.bind(e)),this.getElement(".ENORIPEPagerNextButton").addEventListener("click",e._nextClick.bind(e)),this.getElement(".ENORIPEPagerCloseButton").addEventListener("click",e._closeClick.bind(e))},_nextClick:function(){if(this._matchedNodes&&this._matchedNodes.length>0){this._selectedIndex===this._matchedNodes.length-1?this._selectedIndex=0:this._selectedIndex++,this._setCount(this._matchedNodes.length);var e=this._matchedNodes[this._selectedIndex];e&&this.dispatchEvent("ENORIPE_HighlightNode",e)}},_prevClick:function(){if(this._matchedNodes&&this._matchedNodes.length>0){0===this._selectedIndex?this._selectedIndex=this._matchedNodes.length-1:this._selectedIndex--,this._setCount(this._matchedNodes.length);var e=this._matchedNodes[this._selectedIndex];e&&this.dispatchEvent("ENORIPE_HighlightNode",e)}},_closeClick:function(){this.closePager(),this.dispatchEvent("ENORIPE_NavPagerClose")},closePager:function(){this._selectedIndex=0,this._matchedNodes=[],this._clearCount(),this.container.hide()},destroy:function(){this._parent(),this.container.destroy(),this.container=null}})})),define("DS/SNNavigationMap/views/SearchViewForNative",["UWA/Core","UWA/Class/View","DS/UIKIT/Autocomplete","DS/Handlebars/Handlebars4","text!DS/SNNavigationMap/assets/templates/searchview.html","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n,s,o){"use strict";return t.extend({name:"search-native-view",className:function(){return this.getClassNames("-container")},setup:function(e){this._template=n.compile(s),this.container.inject(e.renderTo)},render:function(){var t=this._template.call(null,{clearSearch:o.get("SNNFind_clearSearch"),runSearch:o.get("MapSearchView_search")});return e.createElement("div",{class:"enoripe_search_container",html:t}).inject(this.container),this._setupSearchInput(this.getElement(".enoripe_search_autocomplete_container")),this._setUpEvents(),this},_setUpEvents:function(){var e=this.getElement("#enoripe_clear_search"),t=this.getElement("#enoripe_run_search");e.addEventListener("click",this.clearSearch.bind(this)),t.addEventListener("click",this._performSearch.bind(this)),e.hide()},_onKeyUp:function(e){this._delayTimer&&clearTimeout(this._delayTimer);var t=this;this._delayTimer=setTimeout((function(){var i;i=(e.srcElement||e.target).value,t._handleInput(i),"Enter"!==e.key&&13!==e.keyCode||""!==i&&t._performSearch()}),500)},_performSearch:function(){var e=this._autocompleteInput.getSelection();this.dispatchEvent("ENORIPE_performSearch_native",e)},_setupSearchInput:function(e){if(e){this._autocompleteInput=new i({noResultsMessage:!1,showSuggestsOnFocus:!0,closableItems:!1,allowFreeInput:!0,events:{onKeyUp:this._onKeyUp.bind(this)},placeholder:o.get("MapSearchView_search")}).inject(e)}},_handleInput:function(e){var t=this.getElement("#enoripe_clear_search");e.length>0?t.show():t.hide()},clearSearch:function(){this.getElement("#enoripe_clear_search").hide(),this._autocompleteInput.reset(),this.dispatchEvent("ENORIPE_resetSearch_native")},_close:function(){},destroy:function(){this.container=null,this._parent()}})})),define("DS/SNNavigationMap/utils/AdditionalColumnsUtils",["UWA/Class","UWA/Class/Options"],(function(e,t){"use strict";return e.singleton(t,{init:function(){},getConfigurationColumns:function(){let e=[],t=[];var i=new Promise((function(t){require(["DS/CfgWebAppEffectivityUX/scripts/CfgEffectivityColumns"],(function(n){n.isAdditionalColumnsAvailable((function(i){if(!0===i){let t=[];n.getAdditionalColumnsUXDGV(t),t.forEach((t=>{t.columnModule="cfgEffectivty",e.push(t)}))}t()})),i.name="Add "+n.getName()}))}));return t.push(i),Promise.all(t).then((function(){return e}))}})})),define("DS/SNNavigationMap/utils/NlsManager",["UWA/Class","UWA/Core","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_DEC","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_V6Design","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_V6Manufacturing","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Customer","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Simulation","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_DBM","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_V6Knowledgeware","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Material","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_GEBOM","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_ReviewInterference","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_SimulationProcess","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_ECM","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_DPM","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_AER","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Issue","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_ModelDefinition","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_RFL","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_PowerBySolidworks","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_PowerByCATIAV5","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Electronic","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_SystemsArchitecture","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_RequirementManager","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_RTEXP","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_EngineeringDefinition","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_XSourcingApps","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_AnalyticsCase","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_RAMS","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Fastener","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_VRP","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_RouteManagement","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_EngineeringConnection","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Deformability","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_IPClassification","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Meeting.json","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_RelativePosition","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_DataSetup","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_PerformanceSpec","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_V6PLMTranslation","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_DIF","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Report","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_XTDPApp","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_XLC","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_EngineeringInstructions","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_ElecMfgPreparationRelations","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_DesignExperience","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_SpecificationMgmt","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_SystemModeler","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Electrical","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Sustainability","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_CPY"],(function(e,t,i,n,s,o,a,r,l,c,d,h,u,g,p,f,m,v,_,S,b,N,w,C,I,E,y,D,P,O,M,x,A,T,R,k,V,L,F,U,j,W,B,z,H,G,X,q,J,K,Y,Z,Q){"use strict";return e.singleton({name:"navigation_relset_nls",getNls:function(){return t.merge(n,n),t.merge(n,s),t.merge(n,o),t.merge(n,a),t.merge(n,r),t.merge(n,l),t.merge(n,c),t.merge(n,d),t.merge(n,h),t.merge(n,u),t.merge(n,g),t.merge(n,p),t.merge(n,f),t.merge(n,m),t.merge(n,v),t.merge(n,_),t.merge(n,S),t.merge(n,b),t.merge(n,N),t.merge(n,w),t.merge(n,C),t.merge(n,I),t.merge(n,E),t.merge(n,y),t.merge(n,D),t.merge(n,P),t.merge(n,O),t.merge(n,M),t.merge(n,x),t.merge(n,A),t.merge(n,T),t.merge(n,R),t.merge(n,k),t.merge(n,V),t.merge(n,L),t.merge(n,F),t.merge(n,U),t.merge(n,j),t.merge(n,W),t.merge(n,B),t.merge(n,z),t.merge(n,H),t.merge(n,G),t.merge(n,X),t.merge(n,q),t.merge(n,J),t.merge(n,K),t.merge(n,Y),t.merge(n,Z),t.merge(n,Q),n}})})),define("DS/SNNavigationMap/collections/MappingSourcesServices",["UWA/Class","UWA/Core","UWA/Class/Options","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n){"use strict";return e.singleton(i,{name:"navigation_mapping_sourcesservices",requestDone:!1,options:{},init:function(){},setMapping:function(){return new e.Promise(function(e,t){this.isRequestDone()||require(["DS/SNNavigationMap/utils/RelationsServices"],function(i){i.getMappingSourcesServices().then(function(i){this.requestDone=!0,(i=JSON.parse(i)).infos.sources?(i.infos.sources.forEach(function(e){e.name&&e.service&&this.setOption(e.name,e.service)}.bind(this)),e()):t()}.bind(this)).catch(function(e){t(e)}.bind(this))}.bind(this))}.bind(this))},getMapping:async function(e,t){this.isRequestDone()||await this.setMapping();let i=t.split(":");return i.length>1&&(t=i[0]),{referenceId:e,service:this.getOption(t)||"3DSpace"}},isRequestDone:function(){return this.requestDone}})})),define("DS/SNNavigationMap/MapSettings",["text!DS/SNNavigationMap/assets/SNNavigationMap.settings.json","UWA/Class","UWA/Core","UWA/Class/Options","UWA/Promise","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNNavigationMap/utils/MapSecurityCtxConverter","DS/ENOXWidgetPreferences/js/ENOXWidgetPreferences","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n,s,o,a,r,l,c,d){"use strict";return t.singleton(n,{name:"navigation_map_settings",options:{},init:function(){var t=JSON.parse(e);this.setOptions(t);var i=window.location.search.substring(1);this._updateSettingsFromURLParameters(i);var n=this.getOption("widgetDomain");if(void 0!==n){var s=new URL(decodeURIComponent(n)).search.substring(1);this._updateSettingsFromURLParameters(s)}},getLang:function(){return this.getOption("lang")},getAddinMode:function(){return this.getOption("addinmode")},getOpenWithMode:function(){let e=this.getOption("showopenwith");return!0===e||"true"===e},getYOffset:function(){return"x"===this.getLayoutAxis()?"thumbnailsMode"===this.getThumbnailsMode()?150:75:250},getNodesWidth:function(){return 170},getNodesHeight:function(){return"thumbnailsMode"===this.getThumbnailsMode()?130:65},getExpendHeight:function(){return 23},getLayoutMode:function(){return this.getOption("layoutMode")},getRootIds:function(){return this.getOption("rootIds")},setRootIds:function(e){this.setOption("rootIds",e)},setTypeLayoutView:function(e){e&&null!=e&&this.setOption("typeLayoutView",e)},setLayoutMode:function(e){"true"===e||"recompute"===e||!0===e?this.setOption("layoutMode","recompute"):this.setOption("layoutMode",!1)},getLayoutType:function(){return this.getOption("layoutType")},setLayoutType:function(e){e&&this.setOption("layoutType",e)},getThumbnailsMode:function(){return this.getOption("thumbnails2d")},setThumbnailsMode:function(e){"true"===e||"thumbnailsMode"===e||!0===e||void 0===e?this.setOption("thumbnails2d","thumbnailsMode"):this.setOption("thumbnails2d",!1)},getInstancesMode:function(){return this.getOption("showInstances")},setInstancesMode:function(e){"true"===e||"showInstance"===e||!0===e?this.setOption("showInstances",!0):this.setOption("showInstances",!1)},getPublicationsMode:function(){return this.getOption("showPublications")},setPublicationsMode:function(e){"true"===e||"showPublications"===e||!0===e?this.setOption("showPublications",!0):this.setOption("showPublications",!1)},getGhostMode:function(){return this.getOption("showGhost")},setGhostMode:function(e){"true"===e||"showGhost"===e||!0===e?this.setOption("showGhost",!0):this.setOption("showGhost",!1)},setIs3DSpaceIUExistingAndTenantAllowed:function(e){this.setOption("isAlive_Is3DSpaceIUExistingAndTenantAllowed",e)},is3DSpaceIUExistingAndTenantAllowed:function(){return this.getOption("isAlive_Is3DSpaceIUExistingAndTenantAllowed")},getActivateOptimizedIndexNavigation:function(){return this.getOption("activateOptimizedIndexNavigation")},setActivateOptimizedIndexNavigation:function(e){this.setOption("activateOptimizedIndexNavigation",e)},getWhatsNewDoNotShowAgain:function(){return this.getOption("whatsNewDoNotShowAgain")},setWhatsNewDoNotShowAgain:function(e){this.setOption("whatsNewDoNotShowAgain",e)},getRedirectQueryToSGI:function(){let e=this.getOption("redirectQueryToSGI");return"true"===e||!0===e},getSGINavigation:function(){let e=this.getOption("SGINavigation");return"true"===e||!0===e},getListViewPanelWidth:function(){return this.getOption("listViewPanelWidth")},setListViewPanelWidth:function(e){e&&e>0&&this.setOption("listViewPanelWidth",e)},setInformationPanelStatus:function(e){"true"===e.isInformationPanelVisible||!0===e.isInformationPanelVisible?this.setOption("isInformationPanelVisible",!0):this.setOption("isInformationPanelVisible",!1)},setLastUsedProfile:function(e){""!==e&&this.setOption("LastUsedProfile",e)},getLastUsedProfile:function(){return this.getOption("LastUsedProfile")},setDefaultAttributesInit:function(e){for(var t=this.getOption("attributes"),i=[],n=0;n<t.length;n++)i.push({uri:t[n],label:d.get(t[n])});var s={AllTypes:{name:"AllTypes",nlsLabel:d.get("AllTypes"),attributes:i},EnoripeColumns:{name:"EnoripeColumns",nlsLabel:d.get("DatagridColumns"),attributes:i}};this.setJSONAttributes(s),e&&0!==Object.keys(e).length||(e=s),this.setDefaultAttributes(e)},setDefaultAttributes:function(e){this.setOption("defaultAttributes"),this.setOption("defaultAttributes",e)},getDefaultAttributes:function(){return this.getOption("defaultAttributes")},setJSONAttributes:function(e){this.setOption("attributesFromJSON"),this.setOption("attributesFromJSON",e)},getJSONAttributes:function(){return this.getOption("attributesFromJSON")},getInformationPanelVisibility:function(){return this.getOption("isInformationPanelVisible")},getLayoutAxis:function(){return this.getOption("layoutAxis")},getLayoutDirection:function(){return this.getOption("layoutDirection")},getLabelPredicates:function(){return this.getOption("labelPredicates")},getDetailPredicates:function(){return this.getOption("detailPredicates")},getExportLimit:function(){return this.getOption("exportLimit")},getAppId:function(){return"undefined"!=typeof widget&&widget.getValue("appId")||"ENORIPE_AP"},getWidgetId:function(){return this.getOption("widgetId")?this.getOption("widgetId"):"undefined"==typeof widget||this.isWebInWin()?"WebInWinId":widget.id},getExcludedAttributes:function(){return this.getOption("excludedAttributes")},getFetchAttributes:function(){return this.getOption("fetchAttributes")},getFedSearchAttributes:function(){return this.getOption("fedSearchAttributes")},setWidgetId:function(e){this.setOption("widgetId",e)},_getListOfSecurityContextAndPreferredOne:function(){var e,t,i=this;return new s((function(n,s){i.getAllSecurityContexts().then((function(o){var a=[];if(o&&o.cspaces){var r=o.cspaces;(!Array.isArray(r)||r.length<=0)&&s("collabspaces not found");for(var l=0;l<r.length;l++)a[l]={label:r[l].label,value:r[l].value};e=JSON.stringify(a),o.securityContext?(i.setSelectedSC(o.securityContext),t=o.securityContext):(i.setSelectedSC(a[0].value),t=a[0].value),n({securityContexts:e,preferredSecurityContext:t})}else s("collabspaces not found")}))}))},_getListOfSecurityContext:function(){var e=this;return new s((function(t,i){e.getAllSecurityContexts().then((function(n){var s=[];if(n&&n.cspaces){var o=n.cspaces;if(Array.isArray(o))for(var a=0;a<o.length;a++)s[a]={label:o[a].label,value:o[a].value};JSON.stringify(s),s.length>0&&e.setSelectedSC(s[0].value),t(s)}else i("collabspaces not found")}))}))},setSelectedSC:function(e){sessionStorage.setItem("Map_selectedSecurityContext",JSON.stringify(e))},getRoles:function(){var e=this.getOption("user_granted_roles"),t=[];if(e&&("string"!=typeof e||"{"!==e[0]&&"["!==e[0]||(e=JSON.parse(e)),i.is(e,"array")))for(var n=0;n<e.length;n++)t.push(e[n].id);return t},getPlatformId:function(){return this.getCurrentTenantName()},get3DSpaceUrl:function(){if(!i.is(this.getOption("platform_services"),"array")&&"ODT_MODE"!==this.getOption("platform_services"))throw new Error("Platform services not initialize yet");var e=this.getCurrentTenantId();return this.getOption("platform_services")[e]["3DSpace"]},get3DSwymUrl:function(){if(!i.is(this.getOption("platform_services"),"array")&&"ODT_MODE"!==this.getOption("platform_services"))throw new Error("Platform services not initialize yet");var e=this.getCurrentTenantId();return this.getOption("platform_services")[e]["3DSwym"]},get3DAppsUrl:function(){if(!i.is(this.getOption("platform_services"),"array")&&"ODT_MODE"!==this.getOption("platform_services"))throw new Error("Platform services not initialize yet");const e=this.getCurrentTenantId();return this.getOption("platform_services")[e]["3DCompass"]},get3DSearchUrl:function(){if(!i.is(this.getOption("platform_services"),"array")&&"ODT_MODE"!==this.getOption("platform_services"))throw new Error("Platform services not initialize yet");var e=this.getCurrentTenantId();return this.isWebInWin()?this.getOption("platform_services")[e].Federated:this.getOption("platform_services")[e]["3DSearch"]},getMyAppsUrl:function(){return this.getOption("myappsurl")?this.getOption("myappsurl"):(console.warn("myappsurl value empty"),"")},setMyAppsUrl:function(e){var t=this;e&&this.setOption("myappsurl",e),this.getOption("myappsurl")||window&&window.dscef&&window.dscef.getMyAppsURL&&window.dscef.getMyAppsURL().then((function(e){t.setOption("myappsurl",e)}))},setLang:function(e){this.setOption("lang",e)},getCurrentTenantName:function(){return this._currentTenant},getCurrentTenantLabel:function(){for(var e=this.getCurrentTenantName(),t=this.getTenantsPreference(),i=0;i<t.length;i++)if(e===t[i].value&&void 0!==t[i].label){e=t[i].label;break}return e},get_current_tenant_idx:function(){if(null!=current_tenant&&"undefined"!=typeof current_tenant&&!Number.isNaN(current_tenant)){var e=current_tenant;if(null===current_tenant_idx||"undefined"==typeof current_tenant_idx||Number.isNaN(current_tenant_idx)||platform_services[current_tenant_idx].displayName!==e)for(var t=0;t<platform_services.length&&(null===current_tenant_idx||"undefined"==typeof current_tenant_idx||Number.isNaN(current_tenant_idx));t++)platform_services[t].displayName===e&&(current_tenant_idx=t)}return(null===current_tenant_idx||"undefined"==typeof current_tenant_idx||Number.isNaN(current_tenant_idx))&&(console.log("Share current tenant and security context thru PADCommandProxy"),current_tenant_idx=0),current_tenant_idx},getCurrentTenantId_:function(){var e=this.getOption("platform_services");if(i.is(this._currentTenant)){var t=this._currentTenant;if(!i.is(this._currentTenantIdx)||e[this._currentTenantIdx].platformId!==t)for(var n=0;n<e.length&&!i.is(this._currentTenantIdx);n++)e[n].platformId===t&&(this._currentTenantIdx=n)}return i.is(this._currentTenantIdx)||(this._currentTenantIdx=0),this._currentTenantIdx},getCurrentTenantId:function(){var e=this.getOption("platform_services");if(i.is(this._currentTenant)){var t=this._currentTenant;if(!i.is(this._currentTenantIdx)||e[this._currentTenantIdx].platformId!==t)for(var n=0;n<e.length;n++)e[n].platformId===t&&(this._currentTenantIdx=n)}return i.is(this._currentTenantIdx)||(this._currentTenantIdx=0),this._currentTenantIdx},getTenantsPreference:function(e){var t=this,n=[],s=this.getOption("user_granted_roles"),o=!1,a=[],r=this.getOption("platform_services");if("ODT_MODE"===r)return["OnPremise"];if(!i.is(r,"array"))throw new Error("Platform services not initialize yet");if("string"==typeof s)try{s=JSON.parse(s)}catch(e){console.log(e)}for(var l=0;l<s.length;l++)"CSV"===s[l].id&&s[l].platforms&&(a=s[l].platforms),"InternalDS"===s[l].id&&(o=!0);return this.getOption("csvTenants")||this.setOption("csvTenants",a),r.forEach((function(e){(t.isWebInWin()||-1!==a.indexOf(e.platformId)||o)&&n.push({label:e.displayName,value:e.platformId})})),n},getSecurityContext:function(){var e=this;return new s((function(t,i){if(e.getOption("Map_SecurityContext"))t(e.getOption("Map_SecurityContext"));else{var n=e.get3DSpaceUrl()+"/resources/pno/person/getsecuritycontext?tenant="+e.getCurrentTenantName();o.authenticatedRequest(n,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"GET",onComplete:function(i){var n=JSON.parse(i);if(n&&n.SecurityContext){var s=n.SecurityContext,o="";0!==s.indexOf("ctx::")&&(o="ctx::"),s=o+s,e.setOption("Map_SecurityContext",s),t(s)}},onFailure:function(e){console.log(e),e.type="generic",i(e)},onTimeout:function(e){console.log(e),e.type="timeout",i(e)}})}}))},getAllSecurityContextsUrl:function(){if(!i.is(this.getOption("platform_services"),"array")&&"ODT_MODE"!==this.getOption("platform_services"))throw new Error("Platform services not initialize yet");return this.get3DSpaceUrl()+"/resources/modeler/pno/person?current=true&select=preferredcredentials&select=collabspaces&tenant="+this.getCurrentTenantName()},getAllSecurityContexts:function(){var e=this;return new s((function(t,i){e.getOption("Map_AllSecurityContexts")?t(e.getOption("Map_AllSecurityContexts")):o.authenticatedRequest(e.getAllSecurityContextsUrl(),{headers:{Accept:"application/json","Content-Type":"application/json"},method:"GET",type:"json",proxy:"passport",onComplete:function(i){if(null!==i){var n=l.getSecurityContext(i);e.setOption("Map_AllSecurityContexts",n),t(n)}},onFailure:function(e){i(e)}})}))},getUserID:function(){return"ODT_MODE"===this.getOption("platform_services")?"TEST_USER":(t=this.getOption("userId"))&&""!==t?t:t=null!=(e=a.getUser())&&void 0!==e.login?a.getUser().login:"";var e,t},getLabelAPI:function(){return this.getAppId()+"-"+this.getUserID()+"-"+Date.now()},getXPrefCredential:function(){return 0!==this._xPrefCredential.indexOf("ctx::")&&(this._xPrefCredential="ctx::"+this._xPrefCredential),this._xPrefCredential},setXPrefCredential:function(e){this._xPrefCredential=e},isWebInWin:function(){var e=!1;return this.getOption("iswebinwin")&&(e=!0),e},addCredentialPreferenceToWidget:function(){var e=this;return new s((function(t,i){e.isWebInWin()?e._getListOfSecurityContext().then((function(i){e.setXPrefCredential(i[0].value),t()})):c.addCredentialPreferenceToWidget({usePreferredCredentials:!0}).then((function(){let i=widget.getValue("xPref_CREDENTIAL");i||(i=widget.getPreference("xPref_CREDENTIAL").options[0].value,widget.setValue("xPref_CREDENTIAL",i)),e.setXPrefCredential(i),t()}))}))},appInitializationPromised:function(e,t,i){var n=this,o=new s((function(t,i){e?(n.setOption("platform_services",e.platform_services),n.setMyAppsUrl(e.myAppsURL),e.noautomode&&n.setOption("noautomode",!0),e.userId?n.setOption("userId",e.userId):n.setOption("userId",""),t()):r.getPlatformServices({onComplete:function(e){n.setOption("platform_services",e),t()},onFailure:function(e){i(e),console.error(e)}})})),a=new s((function(t,i){e?(n.setOption("user_granted_roles",e.user_granted_roles),t()):r.getGrantedRoles((function(e){if(n._checkRoles(e)){for(var s=[],o=0;o<e.length;o++)void 0!==e[o].id&&null!==e[o].id&&s.push(e[o]);n.setOption("user_granted_roles",s),t()}else i({errType:"NoValidRoles"})}))}));return new s((function(r,l){s.all([o,a]).then((function(){t&&(n._currentTenant=t);var s=n.getTenantsPreference(e);e?!n._currentTenant&&s[0]&&(n._currentTenant=s[0].value):(n._currentTenant||(n._currentTenant=n._isValidTenant(widget.getValue("x3dPlatformId"))||n._isValidTenant(n._defaultTenant)||n._getDefaultTenant()),n._checkRolesOnTenant(n.getOption("user_granted_roles"),n._currentTenant)?"ENORIPE_AP"===widget.getValue("appId")&&n._updateWidgetPref():l({showMsg:!0,msg:d.get("NoValidRolesOnTenant")}));n.setDefaultAttributesInit(i),r()}),(function(e){"NoValidRoles"===e.errType&&l({showMsg:!0,msg:d.get("NoValidRoles")})}))}))},_checkRoles:function(e){for(var t=!1,i=0;i<e.length;i++)"CSV"!==e[i].id&&"InternalDS"!==e[i].id||(t=!0);return t},_checkRolesOnTenant:function(e,t){if(null==t)return!1;for(var i=0;i<e.length;i++){if("InternalDS"===e[i].id)return!0;if("CSV"===e[i].id)for(var n=e[i].platforms,s=0;s<n.length;s++)if(n[s]===t)return!0}return!1},_isValidTenant:function(e){var t=!1,i=this.getOption("platform_services");if(e&&i&&i.length)for(var n=0;n<i.length;n++)if(i[n].platformId&&i[n].platformId===e){i[n].hasOwnProperty("3DSpace")&&(t=!0);break}return!0===t&&e},_getDefaultTenant:function(){var e=this.getOption("platform_services"),t="";if(e&&e.length)for(var i=0;i<e.length;i++)if(e[i].hasOwnProperty("platformId")&&e[i].hasOwnProperty("3DSpace")){t=e[i].platformId;break}return t},_updateWidgetPref:function(){if(!this.isWebInWin()){var e=this.getTenantsPreference(),t={name:"selected_tenant",type:"list",label:d.get("tentantPreferenceLabel"),defaultValue:this._currentTenant,options:e};e.length<2&&(t.disabled=!0),widget.addPreference(t)}},setCurrentTenant:function(e){this._currentTenant=e},setDefaultTenant:function(e){this._defaultTenant=e},_updateSettingsFromURLParameters:function(e){for(var t=e.split("&"),i={},n=0;n<t.length;n++){var s=t[n].split("=");1===s.length&&""!==s[0]?i[s[0]]=!0:2===s.length&&s[0].length>0&&(i[s[0]]=s[1])}this.setOptions(i)},getTimeout:function(){var e=this.getOption("timeout");return Math.min(e,18e4)},getnav_history:function(){return this.getOption("nav_history")},getUniqueId:function(){return(Date.now()+Math.random()).toString().replace(".","").substring(0,35)},getValuesInPref:function(e){var t;if(e&&(e+="-ENORIPE_AP"),e&&(t=widget?widget.getValue(e):localStorage.getItem(e)))try{return JSON.parse(t)}catch{return t}},saveValuesInPref:function(e,t){e&&(e+="-ENORIPE_AP"),t=JSON.stringify(t),e&&t&&(widget?widget.setValue(e,t):localStorage.setItem(e,t))}})})),define("DS/SNNavigationMap/utils/MapFileUtils",["UWA/Class","DS/SNNavigationMap/MapSettings","DS/ENORIPE_Common/utils/CommonAlert","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n){return e.extend({init:function(e){this.spinner=e.spinner},handleDownload:function(e,s){this._showSpinner();var o=this,a={tenant:t.getPlatformId(),tenantUrl:t.get3DSpaceUrl(),autoDownload:!0,onComplete:function(e){o._hideSpinner()},onFailure:function(){i.showNotif({level:"error",msg:n.get("DownloadFailure")}),o._hideSpinner()}};require(["DS/DocumentManagement/DocumentManagement","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],(function(s,r){if(r){var l=r.get();l&&l.change&&""!==l.change.id&&(a.additionalHeaders={"DS-Change-Authoring-Context":"pid:"+l.change.id})}t.getSecurityContext().then((function(t){a.securityContext=t,s.downloadDocument(e,void 0,!1,a)}),(function(e){var t={level:"error",msg:n.get(e.type)};i.showNotif(t),o._hideSpinner()}))}),(function(){o._hideSpinner(),console.log("DocumentManagementAMD not found")}))},_hideSpinner:function(){this.spinner&&this.spinner.hide()},_showSpinner:function(){this.spinner&&this.spinner.show()},getFileType:function(){}})})),define("DS/SNNavigationMap/utils/SNNavigationServices",["UWA/Core","UWA/Class/View","DS/SNNavigationMap/MapSettings","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n){"use strict";return{isWebInWin:function(){var e="undefined"!=typeof dscef||"undefined"!=typeof CATCefSendString,t=void 0!==i.getAddinMode();return e&&!t},sendToMapWebInWin:function(e,t,i){var n=!1;if(this.isWebInWin()){n=!0;var s={action:"string"==typeof i?i:"",id:Array.isArray(t)?t:[t]};this.sendStringRelationsToWebInWin(e,JSON.stringify(s))}return n},sendStringRelationsToWebInWin:function(e,t){dscef.sendString(e+"="+t)},ComputeContextualMenu:function(e,t){var i=[];if(null!=t&&void 0!==t&&!Number.isNaN(t)){var n=JSON.parse(t.actions),s=this._parseContextualMenu(e,n.actions);i=1==s.length?s[0]:this._menusIntersection(n.actions,s)}return i},_parseContextualMenu:function(e,t){for(var i=[],n=t.length,s=0;s<n;s++)i[s]=this._getActionsForOneObject(e,t[s],t[s].actions,"");return i},_getActionsForOneObject:function(e,t,i,n){for(var s=[],o=i.length,a=0;a<o;a++)s[a]=this._getOneActionForOneObject(e,t,i[a],n);return s},_getOneActionForOneObject:function(e,t,i,n){var s;if(null==i.items||void 0===i.items||Number.isNaN(i.items)){s={text:i.title,icon:i.image,multisel:i.multisel},void 0!==i.availabilityMode&&(s.availabilityMode=i.availabilityMode),void 0!==i.id&&(s.actionId=i.id,s.id=i.id,s.data=i.id),void 0!==i.accelerator&&(s.accelerator=i.accelerator),null==i.disabled||void 0===i.disabled||Number.isNaN(i.disabled)||(s.disabled=i.disabled),s.handler=function(n){var s={action:i.id,id:[t.id]};e._onCtxMenuItem(s)},null==n||void 0===n||Number.isNaN(n)||(s.menu=n)}else s={text:i.title},void 0!==i.id&&null!==i.id&&(s.actionId=i.id),s.items=this._getActionsForOneObject(e,t,i.items,i.title);return s},_menusIntersection:function(e,t){var i=[],n=t.length;if(0===n)return i;i=t[0];for(var s=[],o=1;o<n;o++){for(var a=t[o],r=a.length,l=0;l<r;l++){for(var c=i.length,d=!1,h=0;h<c;h++)if(null!=a[l].actionId&&null!=a[l].actionId&&null!=i[h].actionId&&null!=i[h].actionId){if(a[l].actionId===i[h].actionId){d=!0;break}}else if((void 0===a[l].actionId&&void 0===i[h].actionId||null===a[l].actionId&&null===i[h].actionId)&&a[l].text===i[h].text){d=!0;break}!0===d&&s.push(a[l])}i=s,s=[]}return i}}})),define("DS/SNNavigationMap/utils/ProbesUtils",["UWA/Class","UWA/Class/Options","DS/WAFData/WAFData","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/SNNavigationServices","DS/PADServices/utils/PADTrackerManager","DS/Usage/TrackerAPI","text!DS/SNNavigationMap/assets/NavigationTrackerMetrics.json"],(function(e,t,i,n,s,o,a,r){"use strict";return e.singleton(t,{options:{},PERFORMANCELABEL:"enoripe_",TIMELABEL:"ENORIPE-",APPID:"ENORIPE_AP",lastStepObjectsInSession:0,init:function(e){},getTracker:function(e,t,i){let s,a={eventCategory:e,eventAction:t,tenant:n.getCurrentTenantName(),appID:this.APPID};return i&&(i.tenant&&""!=i.tenant&&(a.tenant=i.tenant),i.appID&&""!=i.appID&&(a.appID=i.appID)),"performance"===e?s=o.getPADTracker(a,r):"usage"===e&&(s=o.getPADTracker(a)),s},trackUsage:function(e,t,i,n){if(s.isWebInWin()){let o={appId:n&&n.appId?n.appId:this.APPID,category:"Usage",type:"",action:e,label:t,value:i||1};s.sendStringRelationsToWebInWin("AddUsageProbe",JSON.stringify(o))}else{var o=this.getTracker("usage",e,n);o&&(o.setEventData({eventLabel:t,eventValue:i||1}),o.trackPageEvent())}},trackMultiUsage:function(e,t,i){var s,o={},r={};o.pd1=n.getWidgetId(),r.pv1=1;for(var l=2;l<i.length+2;l++)o["pd"+l]=i[l-2],r["pv"+l]=1;s={persVal:r,appID:this.APPID,tenant:n.getCurrentTenantName()},console.debug("track page event with input = "),console.debug(e,t,o,s),a.trackPageEvent("usage",e,t,1,o,s)},trackPerformance:function(e,t,i){if(s.isWebInWin()){let e={stepName:t};s.sendStringRelationsToWebInWin("EndPerfoProbe",JSON.stringify(e))}else{var o=this.getStartTime(t),a=null,r={};if(a=this.getTracker("performance",this.PERFORMANCELABEL+e)){o&&(r={Duration:Date.now()-o});let e=n.is3DSpaceIUExistingAndTenantAllowed()&&(n.getActivateOptimizedIndexNavigation()||n.getRedirectQueryToSGI());r.NavigationType=e?2:1,i&&(r={...r,...i}),a.addMultivaluedEventData(this.PERFORMANCELABEL+t,r),a.trackPageEvent(),this.stopTime(t)}}},setStartTime:function(e){if(this.setOption(this.TIMELABEL+e+"-Start",Date.now()),s.isWebInWin()){let t={appId:this.APPID,category:"Performance",type:"",action:this.PERFORMANCELABEL+e,label:e+"_Duration",stepName:e};s.sendStringRelationsToWebInWin("StartPerfoProbe",JSON.stringify(t))}},setProbesAfterParsing:function(e,t){var i=e.filter((function(e){if("link"===e.modelType)return e})),n=e.filter((function(e){if("node"===e.modelType)return e})),s=t.where({modelType:"node"}),o=i.reduce(((e,t)=>((e[t.type]=e[t.type]||[]).push(t),e)),{}),a=n.length+s.length,r="";if(a<=10)r="i<=10";else if(a<=20)r="10<i<=20";else if(a<=100){for(var l=20;l<=80;l+=20)if(a>l&&a<=l+20){r=l+"<i<="+(l+20);break}}else if(a<=500){for(l=100;l<=400;l+=100)if(a>l&&a<=l+100){r=l+"<i<="+(l+100);break}}else for(l=500;l<=3e4;l+=500)a>l&&a<=l+500&&(r=l+"<i<="+(l+500));r!=this.lastStepObjectsInSession&&(this.lastStepObjectsInSession=r,this.trackUsage("ObjectsInSession","Step-"+r)),Object.keys(o).forEach(function(e){this.trackUsage("LinksUsage",e,o[e].length)}.bind(this))},getStartTime:function(e){return this.getOption(this.TIMELABEL+e+"-Start")},stopTime:function(e){this.setOption(this.TIMELABEL+e+"-Start")}})})),define("DS/SNNavigationMap/views/popups/SelectionAssistantView",["UWA/Core","UWA/Class","UWA/Class/View","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/Button","DS/UIKIT/Input/Toggle","DS/SNNavigationMap/utils/ProbesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n,s,o,a,r,l){"use strict";return n.extend({name:"SelectionAssistant-panel",_dialog:null,_immersiveFrame:null,init:function(e){this._immersiveFrame=e.immersiveFrame,this._currentDockArea=WUXDockAreaEnum.NoneDockArea;var t=this._getDialogContent();let i={title:l.get("SelectionAssistant-Title"),content:t,identifier:this.name,immersiveFrame:this._immersiveFrame,expandedFlag:!1,minWidth:200,minHeight:210,maxWidth:750,resizableFlag:!1,autoCloseFlag:!1,position:{at:"top center",my:"top center"},buttons:{Cancel:new o({label:l.get("SelectionAssistant-Cancel"),allowUnsafeHTMLContent:!1,onClick:this._close.bind(this)}),Save:new o({label:l.get("SelectionAssistant-OK"),allowUnsafeHTMLContent:!1,onClick:this._okClick.bind(this)})}};this._parent(i),this.addEventListener("close",function(){this._close()}.bind(this))},render:function(e){this._options=e,this._toggleCommonActivation(),this._onCheckBoxClick(),this.setPanelVisibilityFlag(!0)},setPanelVisibilityFlag:function(e){this.visibleFlag=e},_okClick:function(){var e=this,t=[];this.elements.container.getElements("input").forEach((function(i){e._options.selOptions[i.value]=i.checked,i.checked&&t.push(i.value)})),this._close(),r.trackUsage("SelectionAssistant","Options-"+t.join("_")),this.dispatchEvent("ENORIPE_UpdateSelection",[this._options])},_onCheckBoxClick:function(){var e=this._isCheckBoxChecked();this.buttons.Save.disabled=!e},_toggleCommonActivation:function(){this._options.disableCommon?(this.commonresults.disable(),this.commonresults.uncheck()):(this.commonresults.enable(),this._options.selOptions.CommonResults?this.commonresults.check():this.commonresults.uncheck())},_isCheckBoxChecked:function(){var e=this.elements.container.getElements("input"),t=!1;return e.forEach((function(e){"checkbox"!==e.type||void 0===e.checked||!0!==e.checked||(t=!0)})),t},_getDialogContent:function(){var t=e.createElement("div",{class:"ENORipeSelAsst-Main"}),i=e.createElement("div",{class:"ENORipeSelAsst-SelOptions"}).inject(t),n=e.createElement("div",{class:"ENORipeSelAsst-CommonOptions"}).inject(t),s=new a({type:"checkbox",value:"SDP",className:"primary ENORIPE-SDP",events:{onClick:this._onCheckBoxClick.bind(this)},label:l.get("SelectionAssistant-SDP-Title")}).inject(i),o=new a({type:"checkbox",value:"SAP",className:"primary ENORIPE-SAP",events:{onClick:this._onCheckBoxClick.bind(this)},label:l.get("SelectionAssistant-SAP-Title")}).inject(i),r=new a({type:"checkbox",value:"SDS",className:"primary ENORIPE-SDS",events:{onClick:this._onCheckBoxClick.bind(this)},label:l.get("SelectionAssistant-SDS-Title")}).inject(i),c=new a({type:"checkbox",value:"SAS",className:"primary ENORIPE-SAS",events:{onClick:this._onCheckBoxClick.bind(this)},label:l.get("SelectionAssistant-SAS-Title")}).inject(i);return this.commonresults=new a({type:"switch",value:"CommonResults",className:"primary ENORIPE-SA-CommonResults",label:l.get("SelectionAssistant-CommonResults-Title")}).inject(n),this._options&&this._options.selOptions&&(this._options.selOptions.SDP&&s.check(),this._options.selOptions.SAP&&o.check(),this._options.selOptions.SDS&&r.check(),this._options.selOptions.SAS&&c.check(),this._toggleCommonActivation()),t},_close:function(){this.setPanelVisibilityFlag(!1)}})})),define("DS/SNNavigationMap/utils/CommonUtils",["UWA/Class","UWA/Class/Options","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/SNNavigationServices","DS/ENORIPE_Common/utils/CommonUtilsServices","DS/Utilities/DateUtils","DS/ENORIPE_Common/utils/CommonAlert","DS/FedDictionaryAccess/FedDictionaryAccessAPI","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n,s,o,a,r,l){"use strict";var c=e.singleton(t,{_currentRequest:null,init:function(e){},getAttributes:function(e){var t=i.getDefaultAttributes(),n={};return e=e||"AllTypes",t&&(void 0!==t[e]?n.attributes=t[e].attributes:n.attributes=t.AllTypes.attributes),n.attributes&&(n.attrs=n.attributes.map((function(e){return e.uri}))),n},_processData:function(t,i){var n=this;return i=JSON.parse(i),new e.Promise((function(e,s){i&&i.results&&i.results.length>0?n._processFetchData(t,i).then((function(t){let i=n._prepareDataToNls(Object.values(t.nlsObj));n._getNls(i).then((function(i){t=n._processNlsDataForFetch(t,i),e(t)}))})):(console.log("no results in fetch service for tooltip"),e(t))}))},_prepareDataToNls:function(e){let t={};return e.forEach((e=>{let i=e.serviceId?e.serviceId:"3DSpace";Object.keys(e).forEach((n=>{if(n.contains("ds6w")||n.contains("ds6wg"))if(t[n]){t[n].find((t=>t.value===e[n]))||t[n].push({value:e[n],source:[i]})}else t[n]=[{value:e[n],source:[i]}]}))})),t},_getNls:function(t,n){return new e.Promise((function(e,o){if(i.isWebInWin()){var a={myAppsBaseUrl:i.getMyAppsUrl(),userId:i.getUserID(),lang:i.getLang()};s.setConfigForMyApps(a)}r.getNlsOfPropertiesValuesBySource(t,{tenantId:i.getCurrentTenantName(),lang:i.getLang(),apiVersion:"R2019x",onComplete:function(t){t.ids=n,e(t)},onFailure:function(t){console.log("Error in fetching NLS data from FedDictionaryAccessAPI.getNlsOfPropertiesValuesBySource, the response received is ::"+t),e()}})}))},_getNlsAndProcessData:function(t,i,n,s){var o=this;return new e.Promise((function(e,a){o._getNls(t,i).then((function(t){var i=o._getNlsObj(t,n,s);i.isInstances=s,e(i)}))}),(function(){reject()}))},_getNlsObj:function(e,t,i){for(var n={},s={ids:[],nlsObj:{}},o={},a=[],r=0;r<e.ids.length;r++){var l=null;Object.keys(t).indexOf(e.ids[r])>-1&&(l=t[e.ids[r]]._attributes),a.push(l)}for(var c=0;c<a.length;c++){var d=a[c];for(var h in n={},d)if(d.hasOwnProperty(h)&&h.contains("ds6w")&&e[h]&&e[h].hasOwnProperty(d[h])){var u=e[h][d[h]];n[h]=u}Object.keys(n).length>0&&(o[d.id]={...n},s.ids.push(d.id))}return s.nlsObj=o,s},_processFetchData:function(t,i){return new e.Promise(((n,s)=>{if(i){let o=i.results,a=null,r=t.attrs,l=[],c=[],d=[];require(["DS/SNNavigationMap/utils/PreferencesUtils","DS/SNNavigationMap/collections/MappingSourcesServices"],((i,h)=>{for(let e=0;e<o.length;e++)if(o[e].attributes&&o[e].attributes.length>0)for(let i=0;i<o[e].attributes.length;i++){var u=o[e].attributes[i];"resourceid"===u.name&&(a=this._getAttrForIds(u.value,o[e].attributes,r),a&&(a.relTypesTaxonomies&&a.relTypesTaxonomies.startsWith("reltypes/PLMInstance")?d.push(a):(t.nlsObj||(t.nlsObj={}),t.nlsObj[a.id]=a,c.push(a))))}if(1===c.length&&d.length>0){let e=c[0];t.nlsObj[e.id].instances||(t.nlsObj[e.id].instances=[]);for(let i=0;i<d.length;i++){let n=d[i];n.nlsObj={...n},t.nlsObj[e.id].instances.push(n)}}for(let e=0;e<c.length;e++){let n=c[e].id;if(t.nlsObj[n].type||(t.nlsObj[n].type=t.nlsObj[n]["ds6w:type"]),!t.nlsObj[n].serviceId){let e=i.getPref("ENORIPE_navigatedNodes");if(e&&e[n]&&e[n].serviceId)t.nlsObj[n].serviceId=e[n].serviceId;else if(t.nlsObj[n].sourceid){let e=h.getMapping(n,t.nlsObj[n].sourceid).then((e=>{t.nlsObj[e.referenceId].serviceId=e.service})).catch((()=>{}));l.push(e)}else t.nlsObj[n].serviceId="3DSpace"}}e.Promise.all(l).then((function(){n(t)})).catch(s)}))}else n(t)}))},getResourcesInfo:function(t){return new e.Promise((function(e,n){r.getResourcesInfo(t.join(","),{tenantId:i.getCurrentTenantName(),lang:i.getLang(),apiVersion:"R2019x",onComplete:function(t){e(t)},onFailure:function(t){console.log("Error in fetching NLS data from FedDictionaryAccessAPI.getResourcesInfo, the response received is ::"+t),e()}})}))},_getAttrForIds:function(e,t,i){if(e&&t){for(var n={},s=0;s<t.length;s++)n[t[s].name]?("string"==typeof n[t[s].name]&&(n[t[s].name]=n[t[s].name].split()),n[t[s].name].push(t[s].value)):(n[t[s].name]=t[s].value,"resourceid"===t[s].name&&(n.id=t[s].value),"ds6w:label"===t[s].name&&(n.name=t[s].value));if(n.taxonomies&&("string"==typeof n.taxonomies&&(n.taxonomies.startsWith("types")||n.taxonomies.startsWith("reltypes"))?n.relTypesTaxonomies=n.taxonomies:n.taxonomies.every((function(e){if(e.startsWith("types")||e.startsWith("reltypes"))return n.relTypesTaxonomies=e,!1}))),Object.keys(n).length>0)return n}return null},_processNlsDataForFetch:function(e,t){if(!t)return e;const i=e.nlsObj;return Object.entries(i).forEach((([i,n])=>{const s={};Object.entries(n).forEach((([e,i])=>{s[e]=t[e]&&void 0!==t[e][i]?t[e][i]:i})),e.nlsObj[i].nlsObj=s})),e},get3DXContent:function(e,t){let s=[];e.forEach((e=>{let n=e.id;if(void 0===n&&(n=e.resourceid),void 0===n&&null!=e.items&&e.items.length>0&&(n=e.items[0].id),n){let a=e.serviceId;void 0===a&&(a=t&&t.serviceId?t.serviceId:"3DSpace");let r={serviceId:a,envId:i.getCurrentTenantName(),objectId:n,contextId:""};const l=e.type;l&&(r.objectType=l);let c=e.name;void 0===c&&(c=e.displayName),c&&(r.displayName=c);let d=null;if(e.nlsObj&&(d=e.nlsObj["ds6w:type"]),d&&(r.displayType=d),void 0!==e.path&&(r.path=e.path),"3DSpace"===a)if(e.relTypesTaxonomies&&e.relTypesTaxonomies.length>0){var o=this.getTaxonomies(e.relTypesTaxonomies);o&&o.length>0&&(r.objectTaxonomies=o)}else"3DShape"===l&&(itemsobjectTaxonomies=["PLMEntity","PLMReference","PLMCoreRepReference","LPAbstractRepReference","LPAbstract3DRepReference","PHYSICALAbstract3DRepReference","VPMRepReference","3DShape"]);else e["ds6w:i3dx"]&&(r.i3dx=e["ds6w:i3dx"]);s.push(r)}}));let o="";t&&t.widgetId&&(o=t.widgetId),""===o&&(o=n.isWebInWin()?"web_in_win":i.getWidgetId());let a={protocol:"3DXContent",version:"1.1",source:"ENORIPE_AP",widgetId:o};return t&&(t.profile&&(a.profile=t.profile),t.source&&(a.source=t.source),t.preSelectedObjectIds&&(a.preSelectedObjectIds=t.preSelectedObjectIds),t.action&&(a.action=t.action)),a.data={items:s},a},getTaxonomies:function(e){if(e&&e.length>0){for(var t=e.split(","),i=0;i<t.length;i++)if(t[i].contains("types")){t=t[i];break}var n=t.split("/");return n.length>1?(n.splice(0,1),n):[]}},getReverseRelations:function(e){return e.indexOf("_from")>-1?e.replace("_from","_to"):e.replace("_to","_from")},getMainRelName:function(e){return"_to"===e.substring(e.length-3)?e.substring(0,e.length-3):e.substring(0,e.length-5)},setAvailableRelations:function(e){for(var t=e,i={},n=0;n<t.length;n++)i[t[n].name]=!0;this._baseRelations=i,this._availableRelations=t},getProfileDirections:function(e){var t=e.indexOf("_from")>-1?e.replace("_from",""):e.replace("_to",""),i={};return i._from=this._baseRelations[t+"_from"],i._to=this._baseRelations[t+"_to"],void 0===this._baseRelations[t+"_from"]&&void 0===this._baseRelations[t+"_to"]&&(i={_from:!0,_to:!0}),i},switchRelationsDirection:function(e){var t=e.source,i=e.target;return"link"===e.modelType&&"in"===e.direction&&(this.getProfileDirections(e.type),e.type=e.type.replace("_from","_to"),e.source=i,e.target=t),e},getTitleLabel:function(e,t){if(t){for(var n="",s="",a=0;a<t.length&&(s="",e.hasOwnProperty(t[a])&&(s=e[t[a]],"ds6w:modified"!==t[a]&&"ds6w:created"!==t[a]||""===s||(s=o.formatDateToString(new Date(s),{timePrecision:"sec"}))),s&&s.length>0&&(n=n.length>0?n+i.getOption("displayNameSeparator")+s:s),2!==a);a++);return n}},getRelationLinkNls:function(e){var t=e.display_name_attributes;return t&&t.length?l[e[t[0]]]||e[t[0]]:l[e.type+"_short"]||l[e.type]||e.type},getUser3DSwymPictureURL:function(e,t){let n,s=i.get3DSwymUrl();return s&&(n=s+"/api/user/getpicture/login/"+e,t&&(n+="/format/"+t)),n},getRefInstIdsFromNavigatedNodes:function(e){var t=[];return Object.keys(e)&&Object.keys(e).length>0&&(t=[...Object.keys(e)],Object.keys(e).forEach((function(i){e[i].instances&&e[i].instances.length>0&&e[i].instances.forEach((function(e){t.push(e.id)}))}))),t},downloadfile:function(e,t,i){var n=document,s=n.createElement("a");if(UWA.is(e)&&UWA.is(t)&&UWA.is(i)&&(i=i||"application/octet-stream","download"in s)){var o=URL.createObjectURL(new Blob([e],{type:i}));return s.setAttribute("href",o),s.setAttribute("download",t),s.innerHTML="downloading...",n.body.appendChild(s),setTimeout((function(){s.click(),n.body.removeChild(s),URL.revokeObjectURL(o)}),66),!0}},splitItemsByServiceId:function(e){var t=!1;"object"!=typeof e||Array.isArray(e)||null===e||(e=Object.keys(e).map((t=>({key:t,...e[t]}))),t=!0);var[i,n]=e.reduce(((e,i)=>{let n="3DSpace"===i.serviceId?0:1;return t?(e[n][i.key]=i,delete i.key):e[n].push(i),e}),[[],[]]);return[i,n]},getItemsFromSelection:function(e){for(var t={},n=0;n<e.length;n++)e[n].path&&e[n].path[e[n].path.length-2]&&e[n].path[e[n].path.length-2].type&&"VPMInstance"===e[n].path[e[n].path.length-2].type&&(e[n].instances||(e[n].instances=[]),e[n].instances.push({id:e[n].path[e[n].path.length-2].resourceid})),t[e[n].objectId]?e[n].instances&&(t[e[n].objectId].instances=[...t[e[n].objectId].instances,...e[n].instances]):t[e[n].objectId]={instances:e[n].instances||[]},i.getOption("attributesForItems").forEach((function(i){e[n][i]&&(t[e[n].objectId][i]=e[n][i]),"id"===i&&(t[e[n].objectId][i]=e[n].objectId),"ds6w:i3dx"===i&&(t[e[n].objectId][i]=e[n].i3dx),"type"===i&&(t[e[n].objectId][i]=e[n].objectType)}));return t},checkAndGetItemsFromSelection:function(e){let t={},i={},n={},s={},o={};return i=this.getItemsFromSelection(e),[n,s]=c.splitItemsByServiceId(i),Object.values(n).forEach((e=>{t[e.id]=e})),Object.values(s).forEach((e=>{e["ds6w:i3dx"]&&""!==e["ds6w:i3dx"]?t[e.id]=e:o[e.id]=e})),this._showInvalidItemsNotifMsg(o),t},_showInvalidItemsNotifMsg:function(e){var t=Object.keys(e).length,n="",s="";if(t>0){var o=1===t?"object":"objects";n=l.get("DonotLoadObjNo3DSpace.title").replace("{0}",t).replace("{1}",o);var r=[...new Set(Object.values(e).map((e=>e.displayType||e.type)))];s=l.get("NoURIsNo3dspaceObjectNoDisplayType.subtitle"),1===r.length?s=l.get("NoURIsNo3dspaceOneObject.subtitle").replace("{0}",r[0]):r.length>1&&(s=l.get("NoURIsNo3dspaceObjects.subtitle").replace("{0}",r.join(", "))),a.showNotif({level:"warning",title:n,subtitle:s},i.isWebInWin())}},getItemsFromModels:function(e){for(var t={},n=0;n<e.length;n++)t[e[n].id]={},i.getOption("attributesForItems").forEach((function(i){e[n][i]&&(t[e[n].id][i]=e[n][i])}));return t},getItemFromId:function(e){if(e)return{id:e,serviceId:"3DSpace",instances:[]}},manageCSLLinks:function(e,t,i){var n=[];return e&&e.forEach((function(e){let s={},o=i.findWhere({"ds6w:i3dx":e.target});o?s=o:t.map((e=>e["ds6w:i3dx"])).indexOf(e.target)>=0&&(s=t[t.map((e=>e["ds6w:i3dx"])).indexOf(e.target)]),e.target&&s.id&&(e.id=e.id.replace(e.target,s.id),e.target=s.id,n.push(e))})),n},getItemsFromPreviousData:function(e){var t={};return Array.isArray(e)?e.forEach(function(e){t[e]=this.getItemFromId(e)}.bind(this)):(t=e,Object.values(e).forEach((function(e){e.serviceId||(e.serviceId="3DSpace")}))),t}});return c})),define("DS/SNNavigationMap/utils/PreferencesUtils",["UWA/Class","UWA/Class/Options","DS/WAFData/WAFData","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/CommonUtils"],(function(e,t,i,n,s){"use strict";return e.singleton(t,{_keyPrefix:"",init:function(e){n&&(this._keyPrefix=n.getUserID())},setPrefToWidget:function(e,t){e&&void 0!==t&&void 0!==e&&("string"!=typeof t&&(t=JSON.stringify(t)),widget&&widget.setValue(e,t))},setPrefToLocalStorage:function(e,t){e&&void 0!==t&&void 0!==e&&("string"!=typeof t&&(t=JSON.stringify(t)),localStorage.setItem(e,t))},setPrefEverywhere:function(e,t){e&&void 0!==t&&void 0!==e&&(widget?(this.setPrefToWidget(e,t),this.setPrefToLocalStorage(e,t)):this.setPrefToLocalStorage(e,t))},setPrefLocally:function(e,t){e&&void 0!==t&&void 0!==e&&(widget?this.setPrefToWidget(e,t):this.setPrefToLocalStorage(e,t))},getPref:function(e){var t;if(e&&(widget&&(t=widget.getValue(e)),t||(t=localStorage.getItem(e)),t||(t=this.restoreOldPref(e)),t)){try{t=JSON.parse(t)}catch(e){}return"ENORIPE_navigatedNodes"===e&&(t=s.getItemsFromPreviousData(t),this.setPrefToWidget("ENORIPE_navigatedNodes",t)),t}},restoreOldPref:function(e){var t,i;if(widget&&((t=widget.getValue(e+"-ENORIPE_AP")||widget.getValue(this.buildPrefKey(e)+"-ENORIPE_AP")||widget.getValue(e))||(t=this.getItemByPartialKey(widget.data,((e,t)=>Object.keys(e)[t]),((e,t)=>widget.getValue(t)),e)),t&&this.setPrefToWidget(e,t)),i=localStorage.getItem(e+"-ENORIPE_AP")||localStorage.getItem(this.buildPrefKey(e))||localStorage.getItem(e),t||(t=this.getItemByPartialKey(localStorage,((e,t)=>localStorage.key(t)),((e,t)=>localStorage.getItem(t)),e)),i&&(t=i,this.setPrefToLocalStorage(e,i)),t)return t},buildPrefKey:function(e){var t=this._keyPrefix;return e&&"_"!==e[0]&&(t+="-"),t+=e},getItemByPartialKey:function(e,t,i,n){for(let s=0;s<Object.keys(e).length;s++){let o=t(e,s);if(o.endsWith(n))return i(e,o)}return null}})})),define("DS/SNNavigationMap/utils/SearchUtils",["UWA/Class","UWA/Class/Options","UWA/Utils/InterCom","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","DS/SNNavigationMap/MapSettings","DS/ENORIPE_Common/utils/CommonAlert","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n,s,o,a,r){"use strict";return e.singleton(t,{_currentRequest:null,init:function(){},_searchCall:function(t){var i=this,s={};return this._currentRequest&&this._currentRequest.cancel(),this._debug&&(s.debug=!0),s.label=this._getSearchLabel(),s.query=this._getQueryFromItems(t.items,t.value),s.tenant=t.tenantName,s.with_synthesis_attribute=!1,s.with_synthesis=!1,s.select_predicate=["ds6w:label"],s=JSON.stringify(s),new e.Promise((function(e,o){i._currentRequest=n.authenticatedRequest(t.url,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:s,onComplete:function(t){i._currentRequest=null,e(t)},onFailure:function(e){i._currentRequest=null,console.log(e),a.showNotif({level:"error",msg:r.get("generic"),sticky:!0}),o(e)},onTimeout:function(e){i._currentRequest=null,console.log(e),a.showNotif({level:"error",msg:r.get("timeout"),subtitle:r.get("verifyConnection"),sticky:!0}),o(e)}})}))},_getQueryFromItems:function(e,t){var i="",n=0;return t&&(i=t+" AND ("),e.forEach((function(e){0!=n&&(i+=" OR "),i=e["ds6w:i3dx"]?i+'[ds6w:i3dx]:"'+e["ds6w:i3dx"]+'"':i+'physicalid:"'+e.id+'"',n++})),t&&(i+=")"),i},_getSearchLabel:function(){if(o.isWebInWin())return"ENORIPE_"+Date.now();var e=s.getUser();return"ENORIPE_"+(null!=e&&void 0!==e.login?e.login:"")+"_"+Date.now()},inAppSearch:function(e){var t=Object.assign(this._getDefaultRegistrationOpts(),e),n=new i.Socket(t.app_socket_id,{dispacthRetryInterval:0});!0===e.debug_mode&&n.setDebugMode(!0),UWA.is(e.parent_window)?n.subscribeServer("SearchComServer",window):n.subscribeServer("SearchComServer"),n.dispatchEvent("RegisterContext",t),t.default_search_criteria=e.fts_value,n.dispatchEvent("InContextSearch",t);var s=function(i){if("in_app_ok"===i.selected_command)e.callback.call(null,i.selected_data);else e.cancel&&e.cancel.call(null);n.removeListener("onCloseTransient",s),n.dispatchEvent("UnregisterContext",{widget_id:t.widget_id})};n.addListener("InContextSearch_Response",s),n.addListener("onCloseTransient",s)},_getDefaultRegistrationOpts(){var e=o.getWidgetId();return{mode:"furtive",default_with_precond:!0,widget_id:e,app_socket_id:"enosearchutils_"+e,idcard_activated:!1,multiSel:!0,advanced_search:{showByDefault:!1},tenant:o.getPlatformId()}}})})),define("DS/SNNavigationMap/views/SNMapSelector",["UWA/Core","UWA/Class/View","UWA/Utils/InterCom","DS/SNNavigationMap/utils/SNNavigationServices","DS/SNNavigationMap/utils/PreferencesUtils","DS/SNNavigationMap/utils/CommonUtils","DS/i3DXCompassServices/i3DXCompassPubSub","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n,s,o,a,r){"use strict";return{_ctx:{},_mapView:{},_listView:{},_collection:{},_platformId:"",_widgetId:"",_ObjectSelected:{},_mapViewSelected:{},_listViewSelected:{},_objectsInCompass:[],_feedBackMultiSelNumber:null,isSetTypesCallbackSubscribed:!1,viewContext:"",initialize:function(e){this._ctx=e.ctx,this._mapView=this._ctx.mapView,this._listView=this._ctx.listView,this._collection=e.collection,this._platformId=e.platformId||"onPremise",this._widgetId=e.widgetId;var t="com.ds."+this._widgetId;this._compassSocket=new i.Socket(t);this._compassSocket.subscribeServer("com.ds.compass",window.parent),this.isSetTypesCallbackSubscribed||(a.subscribe("setTypesCallback",this._setTypesCallback.bind(this)),this.isSetTypesCallbackSubscribed=!0)},_onSetObject:function(e){if(null==e)a.publish("resetObject"),a.publish("resetX3DContent"),a.publish("resetTypes");else{var t={serviceId:"3DSpace",objectId:e.get?e.get("id"):e.id,envId:this._platformId,contextId:""};a.publish("setObject",t);var i={widgetId:this._widgetId};a.publish("setTypes",i)}},_setTypesCallback:function(e){if(e.widgetId===this._widgetId){var t={appId:e.appId,widgetId:e.widgetId};if(this.getSelectedIDs().length>0){var i=this.buildSelectionForNativeApps(e.appId);t.fileName="-file",t.fileContent=JSON.stringify(i)}a.publish("launchApp",t)}},buildSelectionForNativeApps:function(e){const t={version:"2.4",completionOnCAD:"yes",results:[],structures:[]};let i=1;return this.getSelectedIDs().forEach((e=>{const n={id:i.toString(),phid:e};t.results.push(n);const s={structure:[{id:i.toString(),show:!0,select:!0,children:[]}]};t.structures.push(s),i++})),t},_AddFocusMS:function(e){var t=this._ctx.getElement("#container-"+CSS.escape(e));if(t){var i=t.getAttribute("class");-1===i.indexOf(" focus")&&(i+=" focus",t.setAttribute("class",i))}},_RemoveFocusMS:function(e){var t=this._ctx.getElement("#container-"+CSS.escape(e));if(t){var i=t.getAttribute("class");if(0<i.indexOf(" focus")){var n=i.replace(" focus","");t.setAttribute("class",n)}}},_changeSelectionToMapView:function(){var e=this._mapView.container,t=this._listView.container;if(this.viewContext="MapView",e){var i=this.getMapViewSelectedIds();e.removeClassName("unfocused"),this._mapView.switchFocus(i,!1)}t&&t.addClassName("unfocused")},_handleContextSwitch:function(e){"MapView"===this.viewContext&&(this._ObjectSelected=this._mapViewSelected,e&&this._changeSelectionToMapView()),this.setMultiSelCount(this.nbSelected().toString()),e&&n.sendToMapWebInWin("CleanCSO",[])},onObjectToMultiSel:function(e,t,i){var o=Array.isArray(e)?e:[e],a=o.length,r=[],l="";this.viewContext;if("add"===t){for(var c=0;c<a;c++){var d=(h=o[c]).id;this.initSelection(),this._mapViewSelected[d]=h,this._AddFocusMS(d),r.push(d),void 0!==h&&h.set("focus",!0)}l="InsertInCSO"}else if("remove"===t){for(c=0;c<a;c++){var h;d=(h=o[c]).id;r.push(d),delete this._mapViewSelected[d],this._RemoveFocusMS(d)}l="RemoveFromCSO"}if(this._handleContextSwitch(i),this._syncObjectToCompass(),l.length)if(i){var u=this.getSelectedIDs();u.length>0&&n.sendToMapWebInWin(l,u)}else n.sendToMapWebInWin(l,r);s.setPrefToWidget("ENORIPE_selectedNode",Object.keys(this._mapViewSelected))},setMultiSelCount:function(e){this._feedBackMultiSelNumber?"0"===e?this._feedBackMultiSelNumber.setContent(""):this._feedBackMultiSelNumber.setContent(e):this.initFeedbackMultiSel()},initMultiSel:function(e){e&&this.clearMultiSel(2),""===this.viewContext&&(this.viewContext="MapView"),"ListView"===this.viewContext?this._ObjectSelected=this._listViewSelected:this._ObjectSelected=this._mapViewSelected;var t=this.getSelected();t.length>0&&this.onObjectToMultiSel(t,"add")},initSelection:function(){""===this.viewContext&&(this.viewContext="MapView"),"ListView"===this.viewContext?this._ObjectSelected=this._listViewSelected:this._ObjectSelected=this._mapViewSelected},clearMultiSel:function(e){var t=this.getAllIDs(),i=t.length;if(2!==e){if(0===e);else if("ListView"===this.viewContext)return void this.clearMultiSelForListView();var s=this;this._collection.where({focus:!0}).forEach((function(e){s._RemoveFocusMS(e.get("id")),e.set("focus",!1)})),this._listView.clearPanel(),this._listView.hidePanel()}for(var o=i-1;o>=0;o--)delete this._mapViewSelected[t[o]],delete this._listViewSelected[t[o]],delete this._ObjectSelected[t[o]];this._listView&&this._listView.container&&this._listView.container.removeClassName("unfocused"),this.setMultiSelCount(this.nbSelected().toString()),n.sendToMapWebInWin("CleanCSO",[]),this._syncObjectToCompass()},clearMultiSelForListView:function(){for(var e=this.getAllIDs(),t=e.length-1;t>=0;t--)delete this._listViewSelected[e[t]];this._ObjectSelected=this._listViewSelected,this.setMultiSelCount(this.nbSelected().toString()),n.sendToMapWebInWin("CleanCSO",[]),this._syncObjectToCompass()},initFeedbackMultiSel:function(){var t,i=document.getElementsByClassName("multisel-icons");i&&i.length>0&&(t=i[0].getChildren())&&t.length>0&&(this._feedBackMultiSelNumber=e.createElement("span",{class:"feedBackMultiSel-count",html:""}).inject(t[0]))},updateFeedBack:function(e){for(var t=0;t<e.length;t++)delete this._ObjectSelected[e[t]],delete this._mapViewSelected[e[t]];this.setMultiSelCount(this.nbSelected().toString())},nbSelected:function(){return this.getSelectedIDs().length},isSelected:function(e){return this._ObjectSelected.hasOwnProperty(e)},getSelectedIDs:function(){return Object.keys(this._ObjectSelected)},getAllIDs:function(){var e=Object.keys(this._mapViewSelected);e=e.concat(Object.keys(this._listViewSelected));for(var t=Object.keys(this._ObjectSelected),i=0;i<t.length;i++)-1===e.indexOf(t[i])&&e.push(t[i]);return e},getSelectedItemsForDragAndDrop:function(){return this._collection.where({focus:!0})},getSelected:function(){var e=this;return Object.keys(this._ObjectSelected).map((function(t){return e._ObjectSelected[t]}))},getInverseSelection:function(){return this._collection.getNotSelectedNodes()},getMapViewSelectedIds:function(){return Object.keys(this._mapViewSelected)},getNetworkPaths:function(e,t){var i,n,s=[],o=[[]],a=[];if(i=this._collection.get(e),n=this._collection.get(t),i&&n){if(o[0]=[i._attributes],s=[i,n],(s=[...s,...this._getCommon(this.getAllSuccessors([i]),this.getAllPredecessors([n]))]).length>0){if((o=this.getPathObjects([i],t,s,0,o))&&o[0].length>1){for(var r=0;r<o.length;r++){a[r]=[];for(var l=o[r],c=0;c<l.length-1;c++){let e=this._collection.where({modelType:"link",sourceId:l[c].id,targetId:l[c+1].id});if(e.length>=1){0===c&&a[r].push(l[c]);for(var d=0;d<e.length;d++)a[r].push(e[d]._attributes);a[r].push(l[c+1])}}}return a}return null}return null}return null},getPathObjects:function(e,t,i,n,s){var o,a=e.map((function(e){return e.get("id")})),r=[...s[n]];if(o=r[0].id,a.indexOf(t)>-1)return s;if(""!=o&&r.length>1&&a.indexOf(o)>-1)return s.splice(n,1),null;{let o=this._getCommon(this.getSuccessors(e),i);for(var l=0;l<o.length;l++)0===l||(s[n]&&s[n].length>0&&n++,s[n]=[...r]),s[n].push(o[l]._attributes),this.hasPairInPath(r,e[0]._attributes.id,o[l]._attributes.id)||this.getPathObjects([o[l]],t,i,n,s);return s}},hasPairInPath:function(e,t,i){for(let n=0;n<e.length-1;n++)if(e[n].id===t&&e[n+1].id===i)return!0;return!1},getPredecessors:function(e){if(0!==e.length)return this._getDescendantsOrAscendants(e,"ascendant")},getAllPredecessors:function(e){if(0!==e.length)return this._getAllDescendantsOrAscendants(e,"ascendant")},getSuccessors:function(e){if(0!==e.length)return this._getDescendantsOrAscendants(e,"descendant")},getAllSuccessors:function(e){if(0!==e.length)return this._getAllDescendantsOrAscendants(e,"descendant")},getAllNeighbors:function(e){if(0!==e.length)return[...this.getAllSuccessors(e),...this.getAllPredecessors(e)]},getCommonDirectPredecessors:function(e){if(!(e.length<2)){for(var t=this.getPredecessors([e[0]]),i=1;i<e.length;i++)t=this._getCommon(t,this.getPredecessors([e[i]]));return t}},getCommonAllPredecessors:function(e){if(!(e.length<2)){for(var t=this.getAllPredecessors([e[0]]),i=1;i<e.length;i++)t=this._getCommon(t,this.getAllPredecessors([e[i]]));return t}},getCommonDirectSuccessors:function(e){if(!(e.length<2)){for(var t=this.getSuccessors([e[0]]),i=1;i<e.length;i++)t=this._getCommon(t,this.getSuccessors([e[i]]));return t}},getCommonAllSuccessors:function(e){if(!(e.length<2)){for(var t=this.getAllSuccessors([e[0]]),i=1;i<e.length;i++)t=this._getCommon(t,this.getAllSuccessors([e[i]]));return t}},_getCommon:function(e,t){if(0===e.length||0===t.length)return[];for(var i=[],n=0;n<e.length;n++)t.indexOf(e[n])>-1&&i.push(e[n]);return i},_getAllDescendantsOrAscendants:function(e,t){for(var i,n=[],s=[],o=[],a=this,r=0;r<e.length;r++)if(!(n.indexOf(e[r].get("id"))>-1)){i=this._getdescendantOrAscendantID(e[r].get("id"),t),s=i.slice();for(var l,c=0;i.length>0;)this._getdescendantOrAscendantID(s[c],t).forEach((function(e){-1===s.indexOf(e)&&s.push(e),-1===i.indexOf(e)&&i.push(e)})),l=i.indexOf(s[c]),i.splice(l,1),c++;s.forEach((function(e){-1===n.indexOf(e)&&n.push(e)}))}return n.forEach((function(e){o.push(a._collection.get(e))})),o},_getDescendantsOrAscendants:function(e,t){for(var i,n=[],s=[],o=this,a=0;a<e.length;a++){i=this._getdescendantOrAscendantID(e[a].get("id"),t);for(var r=0;r<i.length;r++)-1===n.indexOf(i[r])&&n.push(i[r])}return n.forEach((function(e){s.push(o._collection.get(e))})),s},_getdescendantOrAscendantID:function(e,t){var i,n,s=[];this._collection.get(e);return this._collection.forEach((function(o){"link"===o.get("modelType")&&("descendant"===t?o.get("source")&&o.get("source").id===e&&(i=o.get("target"))&&i.id&&-1===s.indexOf(i.id)&&s.push(i.id):"ascendant"===t&&o.get("target")&&o.get("target").id===e&&(n=o.get("source"))&&n.id&&-1===s.indexOf(n.id)&&s.push(n.id))})),s},_syncPathToCompass:function(e){e.data&&e.data.items&&(0===e.data.items.length?this._onSetObject(null):(this._onSetObject({id:e.data.items[0].objectId,isPath:!0}),a.publish("setX3DContent",e)))},_syncObjectToCompass:function(){var e=this.getSelected();if(0===e.length)this._onSetObject(null);else{1===e.length&&this._onSetObject(e[0]);var t=this._buildCompassData({widgetId:this._widgetId,envId:this._platformId,selectedModels:e});a.publish("setX3DContent",t)}},_buildCompassData:function(t){var i={};if(e.is(t)){var n=t.selectedModels;if(e.is(n,"array")){const e=n.map((e=>e._attributes));i=o.get3DXContent(e)}}return i},handleClearMap:function(){this._feedBackMultiSelNumber&&(this._feedBackMultiSelNumber.destroy(),this._feedBackMultiSelNumber=null)}}})),define("DS/SNNavigationMap/views/popups/PathPanelView",["UWA/Core","UWA/Class","UWA/Class/View","UWA/Class/Promise","DS/WAFData/WAFData","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","DS/SNNavigationMap/utils/CommonUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/TransientWidget/TransientWidget","DS/Windows/Panel","DS/TreeModel/TreeDocument","DS/Controls/Button","DS/Windows/ImmersiveFrame","DS/Controls/TooltipModel","DS/TreeModel/TreeNodeModel","DS/i3DXCompassPlatformServices/OpenWith","DS/UIKIT/Mask","DS/ENOFilterBIUX/FilterBIComponentProxy","DS/SNNavigationMap/utils/SNNavigationServices","DS/SNNavigationMap/views/SNMapSelector","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/DataGridView/DataGridViewLayout","DS/DataGridView/DataGridView","DS/i3DXCompassServices/i3DXCompassPubSub"],(function(e,t,i,n,s,o,a,r,l,c,d,h,u,g,p,f,m,v,_,S,b,N,w,C,I,E){"use strict";return d.extend({name:"findPath-panel",_dialog:null,_selectedPathsInfo:[],_immersiveFrame:null,models:[],init:function(e){this._debug=e.debugMode,this._addinMode=e.addinMode||void 0,this._widgetId=e.widgetId||null,this._immersiveFrame=e.immersiveFrame,this._filterProxy=new _({tenant:o.getCurrentTenantName(),widgetId:this._widgetId}),this.isSetTypesCallbackSubscribed||(E.subscribe("setTypesCallback",this.setTypesCallback.bind(this)),this.isSetTypesCallbackSubscribed=!0);var t=this._createDialogContent();let i={title:l.get("FindPaths"),minWidth:250,identifier:this.name,content:t,immersiveFrame:e.immersiveFrame,resizableFlag:!0,touchMode:!1,verticallyStretchableFlag:!0,autoCloseFlag:!1,currentDockArea:WUXDockAreaEnum.LeftDockArea,allowedDockAreas:WUXDockAreaEnum.TopDockArea|WUXDockAreaEnum.BottomDockArea|WUXDockAreaEnum.LeftDockArea};this._parent(i),this.addEventListener("close",function(){this._close()}.bind(this))},setPanelVisibilityFlag:function(e){this.visibleFlag=e},render:function(e){if(e){this.setPanelVisibilityFlag(!0);for(var t=0;t<e.length;t++)this.addStop(),this.addNodes(e[t]);this.findBtn.disabled=!0,this.currentFocusedItem.removeAttribute("focused"),this.inputLineForStart.setAttribute("focused",""),this.currentFocusedItem=this.inputLineForStart}},_createDialogContent:function(){var t=this,i=e.createElement("div",{class:"path-main-container"});this.pathInputContainer=e.createElement("div",{class:"path-input-container"}).inject(i),this.inputLineForStart=e.createElement("div",{class:"path-input-line",focused:""}).inject(this.pathInputContainer),this.currentFocusedItem=this.inputLineForStart;var n=e.createElement("div",{class:"path-input-line-span-div"}).inject(this.inputLineForStart);this.startSpan=e.createElement("span",{text:l.get("FindPathStart")}).inject(n);var s=e.createElement("div",{class:"path-line-editor"}).inject(this.inputLineForStart);s.addEventListener("click",(function(e){t._onClickInputLineEditor(this,e)}));e.createElement("div",{class:"path-line-editor-icon"}).inject(s),e.createElement("div",{class:"path-line-editor-content","data-placeholder":l.get("SelectStart")}).inject(s);new u({displayStyle:"lite",icon:{iconName:"clear",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.inputLineForStart).addEventListener("click",(function(e){t._clearInputLine(this.getParent())}));var o=e.createElement("div",{class:"addstops-container"}).inject(i);this.addStopsBtn=new u({label:l.get("FindPathAddStop"),icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},onClick:t.addStop.bind(this)}).inject(o),this.pathOptionsContainer=e.createElement("div",{class:"path-options-container"}).inject(i),this.optionsButtonGroup=new w({type:"radio"});var a=new N({type:"radio",label:l.get("StructurePathsOptionLabel"),value:0,checkFlag:!0}),r=e.createElement("div",{class:"wux-ui-3ds-help wux-ui-3ds"});r.tooltipInfos=new p({shortHelp:l.get("StructurePathsOptionTooltip")}),a.getContent().appendChild(r);var c=new N({type:"radio",label:l.get("NetworkPathsOptionLabel"),value:1}),d=e.createElement("div",{class:"wux-ui-3ds-help wux-ui-3ds"});d.tooltipInfos=new p({shortHelp:l.get("NetworkPathsOptionTooltip")}),c.getContent().appendChild(d),this.optionsButtonGroup.addChild(a),this.optionsButtonGroup.addChild(c),this.optionsButtonGroup.inject(this.pathOptionsContainer),this.pathOptionsContainer.setAttribute("disabled","");var g=e.createElement("div",{class:"findbtn-container"}).inject(i);return this.findBtn=new u({label:l.get("Find"),onClick:t.showPathsBetween.bind(this)}).inject(g),this.findBtn.disabled=!0,this.pathResultContainer=e.createElement("div",{class:"path-result-container"}).inject(i),this.resultLoadingContainer=e.createElement("div",{class:"path-result-loading-container"}).inject(this.pathResultContainer),this.pathsTreeDocument=new h,this.pathsTreeDocument.onPostExpand(function(e){if(void 0!==t.resultDatagridView&&1==t.resultDatagridView.visibleFlag){var i=t.resultDatagridView.layout.getColumnHeaderHeight()+t.pathsTreeDocument.getNumberOfVisibleDescendants()*t.resultDatagridView.layout.getRowHeight();this.pathResultContainer.style.setProperty("min-height",i+50+"px")}}.bind(this)),this.pathsTreeDocument.onPostCollapse(function(e){if(void 0!==t.resultDatagridView&&1==t.resultDatagridView.visibleFlag){var i=t.resultDatagridView.layout.getColumnHeaderHeight()+t.pathsTreeDocument.getNumberOfVisibleDescendants()*t.resultDatagridView.layout.getRowHeight();this.pathResultContainer.style.setProperty("min-height",i+50+"px")}}.bind(this)),i},addStop:function(){var t=this,i=e.createElement("div",{class:"path-input-line",focused:""}).inject(t.pathInputContainer),n=e.createElement("div",{class:"path-input-line-span-div"}).inject(i),s=e.createElement("span",{text:l.get("FindPathStop")}).inject(n),o=e.createElement("div",{class:"path-line-editor"});o.addEventListener("click",(function(e){t._onClickInputLineEditor(this,e)})),o.inject(i);e.createElement("div",{class:"path-line-editor-icon"}).inject(o),e.createElement("div",{class:"path-line-editor-content","data-placeholder":l.get("SelectStop")}).inject(o);new u({displayStyle:"lite",icon:{iconName:"clear",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(i).addEventListener("click",(function(e){t._clearInputLine(this.getParent())})),t.currentFocusedItem.removeAttribute("focused"),t.currentFocusedItem=i;var a=t.startSpan.offsetWidth/2;s.style.marginLeft=a+15+"px";var r=t.startSpan.offsetLeft+t.startSpan.offsetWidth/2,c=s.offsetLeft-r-10;e.createElement("div",{class:"path-dotted-line",styles:{left:r,width:c}}).inject(i);t.addStopsBtn.disabled=!0},_createAndDisplayDatagrid:function(){var e=this,t=e.pathsTreeDocument.getRoots().length,i=[{dataIndex:"tree",text:l.replace(l.get("FindPathPathsFound"),{N:t}),compareFunction:function(e,t,i,n,s){if(i.options.grid.pathInfo.displayNamePath&&n.options.grid.pathInfo.displayNamePath){let e=i.options.grid.pathInfo.displayNamePath,t=n.options.grid.pathInfo.displayNamePath;if(e.length!==t.length)return e.length-t.length;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return e[i].localeCompare(t[i])}return 0},getCellTooltip:function(e){var t=e.nodeModel;if(t&&t.options.grid&&t.isRoot()){for(var i=t.getAllDescendants(),n="",s=0;s<i.length;s++)0!==s&&(n+="\n"),n+=s+". "+i[s].getLabel();if(""!==n)return{shortHelp:n}}}}],n=new C({useLastColumnWidthAutoFlag:!0});e.resultDatagridView=new I({treeDocument:this.pathsTreeDocument,columns:i,showRowIndexFlag:!1,showContextualMenuColumnFlag:!0,cellDragEnabledFlag:!0,showRowBorderFlag:!0,showColumnBorderFlag:!0,showSelectionCheckBoxesFlag:!0,columnDragEnabledFlag:!1,rowSelection:"multiple",cellSelection:"none",useDragAndDrop:!0,sortModel:[{dataIndex:"tree",sort:"asc"}],selectionBehavior:{unselectAllOnEmptyArea:!0,toggle:!1,canMultiSelect:!0,enableShiftSelection:!0,canInteractiveMultiselectWithCheckboxClick:!0},defaultColumnDef:{resizableFlag:!1,editableFlag:!1,alignment:"near"},layout:n,onContextualEvent:function(e){return this._buildContextualMenu(e).then((function(e){return e}))}.bind(this)}).inject(this.pathResultContainer);var s=e.resultDatagridView.columns.find((e=>"ContextualMenuColumn"===e.dataIndex));void 0!==s&&(s.getCellClassName=function(e){var t="";return e.nodeModel&&!e.nodeModel.isRoot()&&(t="hidden-contextual-menu"),t});var o=e.resultDatagridView.layout.getColumnHeaderHeight()+e.pathsTreeDocument.getNumberOfVisibleDescendants()*e.resultDatagridView.layout.getRowHeight();e._setRowEvent(),e.resultDatagridView.show(),e.pathResultContainer.style.setProperty("min-height",o+50+"px")},_destroyDatagrid(){var e=this;e.resultDatagridView&&(e.resultDatagridView.hide(),e.resultDatagridView.destroy())},_setRowEvent:function(){var e=this,t=null;(t=e.pathsTreeDocument.getXSO()).onPostAdd((function(i){i.forEach((function(i){var n=i.getAttributeValue("pathInfo"),s=n.pathId;-1===e._selectedPathsInfo.findIndex((e=>e.pathId===s))&&(e._selectedPathsInfo.push(n),e._updatePathsOnCompass()),e._getAllNodesById(s).forEach((function(e){t.isIn(e)||t.add(e)}))}))})),t.onPostRemove((function(i){i.forEach((function(i){var n=i.getAttributeValue("pathInfo").pathId,s=e._selectedPathsInfo.findIndex((e=>e.pathId===n));-1!==s&&(e._selectedPathsInfo.splice(s,1),e._updatePathsOnCompass()),e._getAllNodesById(n).forEach((function(e){t.isIn(e)&&t.remove(e)}))}))})),e.resultDatagridView.onDragStartCell=function(t,i){var n=e._selectedPathsInfo,s=e._buildDragMessage(n);if(!s)return e.dispatchEvent("_showError",[{message:"noPathSelected"}]),!1;if(s=JSON.stringify(s),t.dataTransfer)if(S.isWebInWin())t.dataTransfer.setData("text",s);else try{t.dataTransfer.setData("text",s),t.dataTransfer.setData("text/searchitems",s)}catch(e){console.log(e),t.dataTransfer.setData("Text",s)}S.isWebInWin()||c.closeWidget()},e.resultDatagridView.onDragEndCell=function(t,i){e.dispatchEvent("ENORIPE_dragEnd")}},emptyGridViewSelection:function(){if(this.pathsTreeDocument){this.pathsTreeDocument.getRoots().forEach((e=>{this.pathsTreeDocument.getXSO().remove(e)}))}},emptyGridView:function(){this._destroyDatagrid(),this.pathsTreeDocument&&this.pathsTreeDocument.empty()},cleanView:function(){this.emptyGridView();for(var e=this.pathInputContainer.getElements(".path-input-line"),t=0;t<e.length;t++)this._clearInputLine(e[t])},_getAllNodesById:function(e){return this.pathsTreeDocument.search({match:function(t){if(e&&t.nodeModel.getAttributeValue("pathInfo").pathId===e)return!0}})},_buildContextualMenu:function(e){var i=this,n=[],s={},o=null,r={};if(e.cellInfos&&e.cellInfos.nodeModel&&e.cellInfos.rowID>-1&&(o=e.cellInfos.nodeModel),o){var c=(r=o.getAttributeValue("pathInfo")).pathId;if(-1===i._selectedPathsInfo.findIndex((e=>e.pathId===c))){var d=i.pathsTreeDocument.getXSO();d.empty();var h=i._getAllNodesById(c);d.add(h[0])}}return new t.Promise(function(t,c){if(S.isWebInWin()){var d=i._buildDragMessage(i._selectedPathsInfo,!0);if(!d)return i.dispatchEvent("_showError",[{message:"noPathSelected"}]),!1;d=JSON.stringify(d);var h="",u=[];"StructurePath"===r.pathType?(h=i._buildAddMessage(i._selectedPathsInfo),u=i._getSelectedIds()):u=i._getSelectedNodesIds(),S.sendToMapWebInWin("onComputeCtxMenu",[]);var g={targetId:u,targetElement:e.infos.target,typeOfPath:r.pathType,jsonMsgForOpen:d,jsonMsgForAddInGraph:h};this.dispatchEvent("ContextualMenuFindPath",g)}else{"StructurePath"===o.getAttributeValue("pathInfo").pathType?n.push({type:"PushItem",icon:{iconName:"plus",fontIconFamily:1},title:l.get("FindPathAddInGraph"),action:{callback:function(){var e=i._selectedPathsInfo,t=i._buildAddMessage(e),n=i._getSelectedIds();i.dispatchEvent("ENORIPE_AddInGraph",[n,t]),a.trackUsage("FindPath","AddInGraph")}}}):n.push({type:"PushItem",icon:{iconName:"select-on",fontIconFamily:1},title:l.get("FindPathSelectInGraph"),action:{callback:function(){var e=i._getSelectedIds();i.dispatchEvent("ENORIPE_SelectInGraph",[e]),a.trackUsage("FindPath","SelectInGraph")}}});var p=i._selectedPathsInfo,f=i._createOpenWithContent(p);(s=(new m).set3DXContent(f,!0)).retrieveCompatibleApps((function(e){if(e&&e.length>0){var t=[];if(e.forEach((function(e){t.push({type:"PushItem",title:e.text,fonticon:e.fonticon&&e.fonticon.length>0?{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon,family:WUXManagedFontIcons.Font3DS}:void 0,icon:e.icon?e.icon:"",action:{callback:function(){e.handler(),a.trackUsage("FindPath","OpenWith")}}})})),t.length>0){var i={name:"OpenWith",type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+s.DROPDOWN_CONF.fonticon},title:s.DROPDOWN_CONF.text,submenu:t};n.push(i)}}})),setTimeout((function(){t(n)}),50)}}.bind(this))},_getSelectedIds:function(){var e=[];for(let t of this._selectedPathsInfo)for(let i of t.path)e.includes(i.resourceid)||e.push(i.resourceid);return e},_getSelectedNodesIds:function(){var e,t=[];for(let i of this._selectedPathsInfo)for(let n of i.path)void 0===(e=n.modelType)||"node"!==e||t.includes(n.resourceid)||t.push(n.resourceid);return t},_onClickInputLineEditor:function(e){var t=this,i=t.currentFocusedItem.getElement(".path-line-editor");if(void 0!==i&&i!==e){t.currentFocusedItem.removeAttribute("focused");var n=e.getParent();null!=n&&(n.setAttribute("focused",""),t.currentFocusedItem=n)}},_clearInputLine:function(e){var t=this;if(void 0!==e){var i,n=e.getElement(".path-line-editor"),s=e.getData("id");if(void 0!==s){var o=t.models.findIndex((e=>e.get("id")===s));void 0!==o&&t.models.splice(o,1)}if(e===t.inputLineForStart)e.removeAttribute("data-id"),n.getElement(".path-line-editor-icon").setStyle("background-image",""),n.getElement(".path-line-editor-content").textContent="";else if(e.remove(),t.currentFocusedItem===e){var a=(i=t.pathInputContainer.getElements(".path-input-line")).find((e=>void 0===e.getData("id")));void 0!==a?(t.currentFocusedItem=a,t.currentFocusedItem.setAttribute("focused","")):(t.currentFocusedItem=t.inputLineForStart,t.inputLineForStart.setAttribute("focused",""))}var r=t.inputLineForStart.getData("id"),l=t.models.length;i=t.pathInputContainer.getElements(".path-input-line"),null!=r&&void 0!==i&&l>=2?(t.findBtn.disabled=!1,t.pathOptionsContainer.removeAttribute("disabled"),t._updateStructureToggleDisabledState(r,t.models)):(t.findBtn.disabled=!0,t.pathOptionsContainer.setAttribute("disabled","")),i.find((e=>e!==t.inputLineForStart&&void 0===e.getData("id")))||(t.addStopsBtn.disabled=!1)}},_createOpenWithContent:function(e){return this._get3DXContent({pathsInfo:e})},addNodes:function(e){var t=this;if(-1===t.models.findIndex((t=>t.get("id")===e.get("id")))){var i=t.currentFocusedItem.getData("id");if(void 0!==i&&""!==i){var n=t.models.findIndex((e=>e.get("id")===i));void 0!==n&&t.models.splice(n,1)}var s=t.currentFocusedItem.getElement(".path-line-editor");null!==s&&(s.getElement(".path-line-editor-icon").setStyle("background-image","url("+e.get("type_icon_url")+")"),s.getElement(".path-line-editor-content").textContent=e.get("name")),t.currentFocusedItem.setData("id",e.get("id")),t.models.push(e);var o=t.pathInputContainer.getElements(".path-input-line");o.find((e=>e!==t.inputLineForStart&&void 0===e.getData("id")))||(t.addStopsBtn.disabled=!1);var a=t.inputLineForStart.getData("id"),r=t.models.length;void 0!==a&&void 0!==o&&r>=2?(t.findBtn.disabled=!1,t.pathOptionsContainer.removeAttribute("disabled"),t._updateStructureToggleDisabledState(a,t.models)):(t.findBtn.disabled=!0,t.pathOptionsContainer.setAttribute("disabled",""))}},showPathsBetween:function(){var e=this,t=e.inputLineForStart.getData("id"),i=e.models.find((e=>e.get("id")===t));if(void 0!==i){var s=e.models.filter((e=>e.get("id")!==t));if(!(s.length<=0)){e._destroyDatagrid(),e.pathsTreeDocument.empty(),v.mask(e.resultLoadingContainer);var o=e.optionsButtonGroup.value,r=Array.isArray(o)&&1===o.length&&1===o[0]?"NetworkPath":"StructurePath";if(a.trackUsage("FindPaths","TypeOfPath-"+r),"StructurePath"===r){var l=[];let t;for(var c=0;c<s.length;c++)t=s[c],void 0!==t&&"3DSpace"===t.get("serviceId")&&("ENOStrRefinementSpecification"===i.get("type")?l.push(e.computeFilterPath(i,t)):l.push(e.computeStructurePaths(i,t)));n.all(l).then((function(){v.unmask(e.resultLoadingContainer),e._createAndDisplayDatagrid()}))}else{var d=[],h=[],u=0;for(c=0;c<s.length;c++)u=s[c].get("id"),null!=(h=b.getNetworkPaths(t,u))&&h.length>0?d=d.concat(h):this.dispatchEvent("noPathsFound",{type:"NetworkPath",anchor:UWA.String.escapeHTML(i.get("name")),selected:UWA.String.escapeHTML(s[c].get("name"))});this._parseResponse({paths:d}),v.unmask(e.resultLoadingContainer),e._createAndDisplayDatagrid()}}}},_renderStructurePaths:function(e){var t=[],i=[],n={};e.infos.error||void 0!==e.results&&0!==e.results.length&&(e.results.forEach((function(e){if(e.Path)t.push(e.Path);else if(e.resourceid){let t;if(e.from?e.name=e["ds6w:label"]:e.displayName=e["ds6w:label"],e.type=e["ds6w:type"],"Person"===e.type){let i=e["ds6w:identifier"];i&&(t=r.getUser3DSwymPictureURL(i))}e.type_icon_url=t||e.icon,n[e.resourceid]=e}})),t.forEach((function(e){var t=[];e.forEach((function(e){t.push(n[e])})),i.push(t)})),this._setStructurePaths(i))},_setStructurePaths:function(e){var t,i,n=this,s="StructurePath";n.pathsTreeDocument.prepareUpdate();for(let g of e){t=n._generateRandomPathId(),i=[];var o=Math.floor(g.length/2)+1,a=l.replace(l.get("FindPathObjects"),{N:o}),r=new f({label:a,grid:{pathInfo:{path:g,pathType:s,pathId:t}}});n.pathsTreeDocument.addRoot(r);var c=new f({label:g[0].displayName,icons:g[0].type_icon_url?[g[0].type_icon_url]:"",children:[],grid:{label:g[0].displayName,nodeInfo:g[0],pathInfo:{path:g,pathType:s,pathId:t}}});i.push(g[0].displayName),r.addChild(c);for(var d,h="",u=2;u<g.length;u++)2===u?(h=g[u].displayName+(g[1].name?" ("+g[1].name+")":""),d=c.addChild(new f({label:h,icons:g[u].type_icon_url?[g[u].type_icon_url]:"",grid:{label:h,nodeInfo:g[u],pathInfo:{path:g,pathType:s,pathId:t}}})),i.push(h)):g[u].displayName&&(h=g[u].displayName+(g[u-1].name?" ("+g[u-1].name+")":""),d=d.addChild(new f({label:h,icons:g[u].type_icon_url?[g[u].type_icon_url]:"",grid:{label:h,nodeInfo:g[u],pathInfo:{path:g,pathType:s,pathId:t}}})),i.push(h));c.expandAll()}r.options.grid.pathInfo.displayNamePath=i,n.pathsTreeDocument.pushUpdate()},_setNetworkPaths:function(e){var t,i,n=this,s="NetworkPath";n.pathsTreeDocument.prepareUpdate();for(let d of e){t=n._generateRandomPathId(),i=[];var o=0,a=new f({grid:{pathInfo:{path:d,pathType:s,pathId:t}}});n.pathsTreeDocument.addChild(a);for(var r=0;r<d.length;r++)d[r].displayName&&(a.addChild(new f({label:d[r].displayName,icons:d[r].type_icon_url?[d[r].type_icon_url]:"",grid:{label:d[r].displayName,nodeInfo:d[r],pathInfo:{path:d,pathType:s,pathId:t}}})),o+=1,i.push(d[r].displayName));var c=l.replace(l.get("FindPathObjects"),{N:o});a.setLabel(c),a.options.grid.pathInfo.displayNamePath=i}n.pathsTreeDocument.pushUpdate()},_generateRandomPathId:function(){return"path_"+Math.floor(1e4*Math.random())},_updateStructureToggleDisabledState:function(e,t){let i=t.find((t=>t.get("id")===e)),n=t.filter((e=>"3DSpace"===e.get("serviceId"))).length;"3DSpace"!==i.get("serviceId")||n<2?(this.optionsButtonGroup.getButtonFromValue(0).disabled=!0,this.optionsButtonGroup.selectValue(1)):this.optionsButtonGroup.getButtonFromValue(0).disabled=!1},_buildDragMessage:function(e,t){let i=null,n={},s=[];if(n=this._get3DXContent({pathsInfo:e}),S.isWebInWin()&&t){for(var o,a,r,l=[],c=0;c<e.length;c++){[],0,r=[],s=e[c].path,i=s[0],a=(o=s).length;for(var d=0;d<a;d++)r.push(o[d].resourceid);l.push(r)}l.length>0&&S.sendToMapWebInWin("RefreshOnDragPath",l,"path")}return n},_buildAddMessage:function(e){return this._get3DXContent({pathsInfo:e,command:"AddInGraph"})},_getExpandParams:function(e,t){var i=[],n={sequence:[{uql:"physicalid:"+t}]},s={label:"Relations "+Date.now(),root:{physical_id:e},graph:{descending_condition:{uql:"[ds6w:type]:* AND (NOT(flattenedtaxonomies:(types/PLMPort) OR flattenedtaxonomies:(types/PLMConnection)))"}},filter:{or:{filters:[{sequence_filter:n}]}},aggregation_processors:[{truncate:{max_distance_from_prefix:0,compute_matching_subpaths_lengths:1,sequence_filter:n}}]};return i.push(s),{batch:{expands:i},outputs:{select_object:["physicalid","ds6w:label","ds6w:type","ds6w:identifier"],select_relation:["physicalid","ds6w:label","ds6w:type","ds6w:identifier"],matching_lengths:1,hits:{predefined_computation:["thumbnail_2d","icons"]},format:"entity_relation_occurrence"}}},_updatePathsOnCompass:function(){var e=this._selectedPathsInfo,t=this._buildDragMessage(e);this.dispatchEvent("ENORIPE_SetPathOnCompass",[t])},computeStructurePaths:function(e,t){var i=this,s=t.get("id"),o=e.get("id"),a=this._getExpandParams(o,s);return new n((function(n,s){i._expandCall(a).then((function(s){(s=JSON.parse(s)).infos.error?n():void 0!==s.results?(0===s.results.length?i.dispatchEvent("noPathsFound",{type:"StructurePath",anchor:UWA.String.escapeHTML(e.get("name")),selected:UWA.String.escapeHTML(t.get("name"))}):i._renderStructurePaths(s),n()):n()}))}))},computeFilterPath:function(e,t){var i=this;return new n((function(n,s){var o=t.get("id"),a=e.get("linked").get("id"),r=e.get("id");if(a!==o){var l=i._getExpandParams(a,o);i._filterProxy.getFilterIdSpec(r,{V2:{find_in_context:"physicalid:"+o}}).then((function(s){if(void 0!==s)if(void 0!==s.filter){try{delete s.filter.or.filters[0].and.filters[1].sequence_filter.sequence[0].uql_prefix_handler}catch(e){return console.log(e),void n()}l.batch.expands[0].filter=s.filter,i._expandCall(l).then((function(s){(s=JSON.parse(s)).infos.error?n():void 0!==s.results?(0===s.results.length?i.dispatchEvent("noPathsFound",{type:"StructurePath",anchor:UWA.String.escapeHTML(e.get("name")),selected:UWA.String.escapeHTML(t.get("name"))}):i._renderStructurePaths(s),n()):n()}))}else n();else n()}),(function(e){console.log(e),n()}))}else n()}))},_expandCall:function(e){var t=o.get3DSpaceUrl()+"/cvservlet/progressiveexpand/v2?tenant="+o.getCurrentTenantName()+"&output_format=cvjson";return new n((function(i,n){s.authenticatedRequest(t,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:JSON.stringify(e),onComplete:function(e){i(e)},onFailure:function(e){console.log(e),n(e)},onTimeout:function(e){console.log(e),n(e)}})}))},_parseResponse:function(e){e&&void 0!==typeof e.paths&&(e.paths.forEach((function(e){e.forEach((function(e){e.resourceid=e.id,void 0===e.displayName&&(e.type.contains("_to")||e.type.contains("_from")||(e.displayName=e.name))}))})),this._setNetworkPaths(e.paths))},_get3DXContent(e){const t=e.pathsInfo;let i=null;void 0!==e.command&&(i=e.command);let n={},s=[],o=[];for(let e=0;e<t.length;e++)if(n=t[e],s=n.path,"StructurePath"===n.pathType&&null===i){const e=Object.assign({},s[0]);e.path=s,o.push(e)}else for(let e=0;e<s.length;e++){if(void 0===s[e].displayName)continue;const t=Object.assign({},s[e]);null!==i&&t.path&&delete t.path,o.push(t)}return r.get3DXContent(o,{serviceId:"3DSpace"})},setTypesCallback:function(e){if(e.widgetId===this._widgetId){if(this._selectedPathsInfo.length>0){var t={appId:e.appId,widgetId:e.widgetId},i=this.buildSelectionForNativeApps();t.fileName="-file",t.fileContent=i}E.publish("launchApp",t)}},buildSelectionForNativeApps:function(){const e={version:"2.4",completionOnCAD:"yes",results:[],structures:[]};let t=1;if("StructurePath"===this._selectedPathsInfo[0].pathType){let i=0,n=-1;this._selectedPathsInfo.map((e=>e.path)).forEach((s=>{const o={id:t.toString(),show:!0,select:!1,children:[]};s.reduce(((s,o)=>{const a={id:t.toString(),phid:o.resourceid};if(e.results.push(a),n<i){n++;const t={structure:[s]};e.structures.push(t)}else{const e={id:t.toString(),show:!0,select:!1,children:[]};s.children.push(e),s=e}return t++,s}),o),i++}))}else if("NetworkPath"===this._selectedPathsInfo[0].pathType){this._getSelectedNodesIds().forEach((i=>{const n={id:t.toString(),phid:i};e.results.push(n);const s={structure:{id:t.toString(),show:!0,select:!1,children:[]}};e.structures.push(s),t++}))}return JSON.stringify(e)},_close:function(e){this.models=[],this._selectedPathsInfo=[],this.cleanView(),this.setPanelVisibilityFlag(!1),this.dispatchEvent("PathPanelViewClose")}})})),define("DS/SNNavigationMap/utils/RelationsServices",["UWA/Controls/Abstract","UWA/Class/Events","UWA/Class","UWA/Class/Options","UWA/Core","UWA/Promise","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","DS/SNNavigationMap/utils/CommonUtils","DS/SNNavigationMap/utils/SearchUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/SNNavigationMap/utils/PromisesManager"],(function(e,t,i,n,s,o,a,r,l,c,d,h){"use strict";return i.singleton(n,{promiseManager:null,init:function(){this.promiseManager=new h({debugMode:"1"===a.getOption("debug_me")})},getRelationsCount:function(e){var t=this,i={};return i={widgetId:a.getWidgetId(),label:a.getLabelAPI(),items:e.items},e.excludedRelations&&(i.excludedRelations=i.excludedRelations.concat(e.excludedRelations)),a.is3DSpaceIUExistingAndTenantAllowed()&&(a.getActivateOptimizedIndexNavigation()||a.getRedirectQueryToSGI())&&(i.redirectQueryToSGI=!0),r.setStartTime("getRelationCount",Date.now()),a.setOption("getRelationCountNoOfObjects",i.items.length),this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/getRelationCount?tenant="+a.getCurrentTenantName(),params:i,timeout:a.getTimeout(),xPrefCredential:a.getXPrefCredential(),onComplete:function(e){return new o((function(i,n){t.trackServices(),i(e)}))}})},getEcosystem:function(e,t){var i=this,n=[],s={};return s={widgetId:a.getWidgetId(),label:a.getLabelAPI(),items:e,lang:a.getLang(),direction:"both",restrictedMode:!!t.restrictedMode,responseMode:t.responseMode?t.responseMode:"ObjectsAndLinks"},!t.direction||"in"!==t.direction&&"out"!==t.direction||(s.direction=t.direction),t.widgetId&&(s.widgetId=t.widgetId),t.relations&&t.relations.length>0&&(s.relations=t.relations),t.fullImportMode&&(s.fullImportMode=t.fullImportMode),t.computeWithInstances&&(s.computeWithInstances=t.computeWithInstances),t.excludedRelations&&(a.getOption("LastUsedProfile")&&"AutoModeProfile"===a.getOption("LastUsedProfile")&&(n=a.getExcludedAttributes()),s.excludedRelations=n.concat(t.excludedRelations)),a.is3DSpaceIUExistingAndTenantAllowed()&&(a.getActivateOptimizedIndexNavigation()||a.getRedirectQueryToSGI())&&(s.redirectQueryToSGI=!0),r.setStartTime("getecosystem",Date.now()),a.setOption("ecosystemNoOfObjects",s.items.length),this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/getEcosystem?tenant="+a.getCurrentTenantName(),params:s,timeout:a.getTimeout(),xPrefCredential:a.getXPrefCredential(),onComplete:function(e){return new o((function(t,n){i.trackServices(),e=JSON.parse(e),i._prepareURI(e).then((function(e){t(e)}))}))}})},_prepareURI:function(e){return new o(function(t,i){const n=e=>void 0===e.id&&e.serviceId&&"3DSpace"!=e.serviceId;let s=[];if(e.objectsByPatterns)for(let t in e.objectsByPatterns)s=s.concat(e.objectsByPatterns[t].filter(n));else s=e.objects.filter(n);s.length>0?this.fedSearch(s).then((function(i){Object.values(i.nlsObj).forEach((function(t){if(t["ds6w:i3dx"])if(e.objectsByPatterns)for(let i in e.objectsByPatterns)e.objectsByPatterns[i]=e.objectsByPatterns[i].map((function(e){return e["ds6w:i3dx"]&&e["ds6w:i3dx"]===t["ds6w:i3dx"]?(e.relations&&(t.relations=e.relations),t):e}));else e.objects=e.objects.map((function(e){return e["ds6w:i3dx"]&&e["ds6w:i3dx"]===t["ds6w:i3dx"]?t:e}))})),t(e)})):t(e)}.bind(this))},setPreferences:function(e){var t=["use-auto-by-type-relations"],i=[],n={};return e.relations?t=e.relations:a.getOption("LastUsedProfile")&&"AutoModeProfile"!=a.getOption("LastUsedProfile")?t=a.getOption("currentRelations"):n.excludedRelations=a.getExcludedAttributes(),e.excludedRelations&&e.excludedRelations.length>0&&(i=n.excludedRelations?[...new Set([...e.excludedRelations,...n.excludedRelations])]:e.excludedRelations),n={widgetId:a.getWidgetId(),label:a.getLabelAPI(),relations:t,lang:a.getLang(),computeWithInstances:!1,allRelationsMode:void 0!==e.allRelationsMode&&e.allRelationsMode,publicationsMode:a.getPublicationsMode(),attributesForView:e.attributes,ghostMode:a.getGhostMode()},i.length>0&&(n.excludedRelations=i),e.widgetId&&(n.widgetId=e.widgetId),this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/setPreferences?tenant="+a.getCurrentTenantName(),params:n,xPrefCredential:a.getXPrefCredential(),timeout:a.getTimeout()})},getDetails:function(e,t){var i={};return i={widgetId:a.getWidgetId(),direction:"both",id:e},!t.direction||"in"!==t.direction&&"out"!==t.direction||(i.direction=t.direction),r.setStartTime("detail",Date.now()),this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/navigate/detail?tenant="+a.getCurrentTenantName(),params:i,xPrefCredential:a.getXPrefCredential(),timeout:a.getTimeout(),onComplete:function(e){return new o((function(t,i){that.trackServices(),t(e)}))}})},clear:function(){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/clear?tenant="+a.getCurrentTenantName(),params:{widgetId:a.getWidgetId()},xPrefCredential:a.getXPrefCredential(),timeout:a.getTimeout()})},getFavorites:function(e){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnavfav/favorite/getFavorites?tenant="+a.getCurrentTenantName(),xPrefCredential:e,params:{widgetId:a.getWidgetId()}})},createFavorite:function(e,t){var i="",n={...t,name:a.getUniqueId(),favDescription:"my nav fav",layoutType:a.getLayoutType()};i="<p>"+d.get("Favorite_ErrorNotAccess")+"</br>";return i+=d.get("Favorite_ErrorCheckAccess")+"</br>",this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnavfav/favorite/createFavorite?tenant="+a.getCurrentTenantName(),xPrefCredential:e,params:n,failureParams:{message:i,subtitle:d.get("Favorite_ErrorTypeObject"),level:"error"}})},updateFavorite:function(e,t){var i={...t,favDescription:"my nav fav",layoutType:a.getLayoutType()};return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnavfav/favorite/updateFavorite?tenant="+a.getCurrentTenantName(),xPrefCredential:e,params:i})},getFavoriteInfo:function(e,t){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnavfav/favorite/getFavoriteInfo?tenant="+a.getCurrentTenantName(),xPrefCredential:e,params:{widgetId:a.getWidgetId(),id:t}})},isFavorite:function(e,t){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnavfav/favorite/isFavorite?tenant="+a.getCurrentTenantName(),xPrefCredential:e,params:{widgetId:a.getWidgetId(),id:t}})},getSettingsAndRelSets:function(e){var t=this.getRelSettings(e),i=this.getPatterns(),n=this.getProfiles();return o.all([t,i,n])},getRelSettings:function(e){var t=this;return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelcc/cc_services/getrelsettings?tenant="+a.getCurrentTenantName(),xPrefCredential:a.getXPrefCredential(),onComplete:function(i){return e?new o((function(e,t){e(JSON.parse(i))})):t._parseSettings(JSON.parse(i))}},"GET")},_parseSettings:function(e){var t=this;return new o((function(i,n){e.notexist||void 0===e.relation_apps?t.getResetRelApps().then((function(e){i(e)})):i(e)}))},getResetRelApps:function(){var e=this;return void 0===e._resetSettingsFromServer?this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelcc/cc_services/getrelappsinit?tenant="+a.getCurrentTenantName(),xPrefCredential:a.getXPrefCredential(),onComplete:function(t){return new o((function(i,n){e._resetSettingsFromServer=JSON.parse(t),i(e._resetSettingsFromServer)}))}},"GET"):new o((function(t,i){t(e._resetSettingsFromServer)}))},getPatterns:function(){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/getPatterns?tenant="+a.getCurrentTenantName(),params:{widgetId:a.getWidgetId(),roles:a.getRoles(),lang:a.getLang(),label:a.getLabelAPI()},xPrefCredential:a.getXPrefCredential(),timeout:a.getTimeout()})},getProfiles:function(){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/getProfiles?tenant="+a.getCurrentTenantName(),params:{widgetId:a.getWidgetId(),roles:a.getRoles(),lang:a.getLang(),label:a.getLabelAPI()},xPrefCredential:a.getXPrefCredential(),timeout:a.getTimeout()})},getMappingSourcesServices:function(){var e={tenant:a.getCurrentTenantName()};return this.promiseManager.createPromise({url:a.get3DSearchUrl()+"/login",params:e,xPrefCredential:a.getXPrefCredential(),timeout:a.getTimeout(),onComplete:function(e){return new o((function(t,i){t(e)}))}})},getSynchroStatus:function(e){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/getSynchroStatus?tenant="+a.getCurrentTenantName(),params:{widgetId:a.getWidgetId(),ids:e},xPrefCredential:a.getXPrefCredential(),timeout:a.getTimeout()})},getIsAlive_Is3DSpaceIUExistingAndTenantAllowed:function(){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/cvservlet/isalive/is3DSpaceIUExistingAndTenantAllowed?SecurityContext="+a.getXPrefCredential(),xPrefCredential:a.getXPrefCredential()},"GET")},fetchAttributes:function(e){var t=this,i={},n={attrs:[]};for(var s in i=a.getDefaultAttributes())n.attrs=[...n.attrs,...Array.from(new Set(i[s].attributes.map((function(e){return e.uri}))))];return n.attrs=[...n.attrs,...a.getFetchAttributes()],n.attrs=[...new Set(n.attrs)],e={...e,...n},new o((function(i,n){t._fetchCall(e).then((function(t){l._processData(e,t).then((function(e){i(e)}),(function(){n()}))}))}))},fetchRecents:function(e){var t=this,i={attrs:[...a.getOption("attributes"),...a.getFetchAttributes()],items:e};return new o((function(e,n){t.fedSearch(i.items).then((function(t){e(t)}))}))},_fetchCall:function(e){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/cvservlet/fetch/v2?tenant="+a.getCurrentTenantName(),params:{physicalid:e.ids,select_predicate:e.attrs,unescape_slashes_in_attribute_values:!0},timeout:a.getTimeout()})},fedSearch:function(e){var t,i,n=this,s={},r={attrs:[]};for(var d in s=a.getDefaultAttributes())r.attrs=[...r.attrs,...Array.from(new Set(s[d].attributes.map((function(e){return e.uri}))))];return r.attrs=[...r.attrs,...a.getFedSearchAttributes()],r.attrs=[...new Set(r.attrs)],i=Array.from(new Set(e.map((e=>e.serviceId)))),t={label:c._getSearchLabel(),query:c._getQueryFromItems(e),select_predicate:r.attrs,tenant:a.getCurrentTenantName(),with_synthesis_attribute:!1,with_synthesis:!1,list_source:i},new o((function(e,i){n._fedSearchCall(t).then((function(t){l._processData(r,t).then((function(t){e(t)}),(function(){i()}))}))}))},_fedSearchCall:function(e){return this.promiseManager.createPromise({url:a.get3DSearchUrl()+"/search",params:e,timeout:a.getTimeout()})},trackServices:function(){r.getStartTime("getRelationCount")&&r.trackPerformance("getRelationCount","getRelationCount",{NumberOfObjects:a.getOption("getRelationCountNoOfObjects")}),r.getStartTime("getecosystem")&&r.trackPerformance("getecosystem","getecosystem",{NumberOfObjects:a.getOption("ecosystemNoOfObjects")}),r.getStartTime("detail")&&r.trackPerformance("detail","detail")}})})),define("DS/SNNavigationMap/utils/TaggerServices",["UWA/Controls/Abstract","UWA/Class/Events","UWA/Core","DS/ENOFilterBIUX/FilterBIComponentProxy","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/SNNavigationServices","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n,s,o,a){"use strict";return e.extend(t,{widgetId:null,addVolatileTags:!1,_filterProxy:null,_colorMapsForVolatileTags:{},_summariesForVolatileTags:[],_activate:!0,init:function(e){this.widgetId=e.widgetId,this.addVolatileTags=e.addVolatileTags,this.addVolatileTags&&(this._colorMapsForVolatileTags=e.colorMapsForVolatileTags,this._summariesForVolatileTags=e.summariesForVolatileTags),this.createFilterProxy(e.taggerProxyOptions)},createFilterProxy:function(e){var t=this,i={};i={tenant:s.getCurrentTenantName(),appId:s.getAppId(),colorize:!0,widgetId:this.widgetId,isWebInWin:o.isWebInWin(),platformServices:s.getOption("platform_services")},e&&e.activateSelection&&(i.selection={}),this._filterProxy||(this._filterProxy=new n(i),this._filterProxy.addEvent("fetchFilterBIColorizeEvent",(function(e){t._activate&&t.dispatchEvent("Tagger_FilterBIColorize",[e])})),this._filterProxy.addEvent("FilterBIUnColorize",(function(e){t._activate&&t.dispatchEvent("Tagger_FilterBIUnColorize")})),this._filterProxy.addEvent("fetchFilterBIFilteringEvent",(function(e){t._activate&&t.dispatchEvent("Tagger_FilterBIFilteringEvent",e)})),this._filterProxy.addEvent("ColorizeVolatile",(function(e){t._activate&&t.dispatchEvent("Tagger_ColorizeVolatile",e)})),this._filterProxy.addEvent("FilterVolatile",(function(e){t._activate&&t.dispatchEvent("Tagger_FilteringVolatile",e)})),this._filterProxy.addEvent("FilterBISelectionEvent",(function(e){t._activate&&t.dispatchEvent("Tagger_FilterBISelection",e)})),this._filterProxy.addEvent("SelectVolatile",(function(e){t._activate&&t.dispatchEvent("Tagger_SelectVolatile",e)})))},updateFilterProxy:function(e,t){var i=this;t=t||!1,this._filterProxy&&(this.addVolatileTags?this._filterProxy.setTagsWithFetchSynthesis(e,(function(e){i._filterProxy.setVolatileTags({summary:i._summariesForVolatileTags,colorMap:i._colorMapsForVolatileTags,paramsFromFBI:e})}),t):this._filterProxy.setTagsWithFetchSynthesis(e))},updateVolatileTags:function(e){e&&(this._summariesForVolatileTags=e)},cleanProxy:function(){this._filterProxy&&this._filterProxy.cleanProxy()},removeRoots:function(e){this._filterProxy&&this._filterProxy.removeRoot(e)},deactivate:function(){this._activate=!1,this._filterProxy.deactivate()},activate:function(){this._activate=!0,this._filterProxy.activate()},isActivated(){return this._activate},setSelectStatus:function(){this._filterProxy&&this._filterProxy.setSelectStatus({status:!0})}})})),define("DS/SNNavigationMap/views/PreviewView",["UWA/Core","UWA/Class/View","UWA/Utils/InterCom","DS/TreeModel/TreeNodeModel","DS/Controls/TooltipModel","DS/WebappsUtils/WebappsUtils","DS/Utilities/DateUtils","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/DropdownMenu","DS/UIKIT/Spinner","DS/UIKIT/Accordion","DS/UIKIT/Scroller","DS/PlatformAPI/PlatformAPI","DS/SNNavigationMap/utils/TaggerServices","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","DS/SNNavigationMap/utils/PreferencesUtils","DS/SNNavigationMap/utils/SNNavigationServices","DS/SNNavigationMap/utils/CommonUtils","DS/ENORIPE_Common/utils/CommonAlert","DS/i3DXCompassPlatformServices/OpenWith","DS/i3DXCompassServices/i3DXCompassPubSub","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n,s,o,a,r,l,c,d,h,u,g,p,f,m,v,_,S,b,N,w,C){"use strict";return t.extend({_SERVICENAME:"3DSpace",name:"preview",_propertiesCommandRequire:"DS/ENOCollabSharingCmds/commands/EditPropCmd/EditPropCmdBase",_propertiesConstantsRequire:"DS/EditPropWidget/constants/EditPropConstants",_views:[{fonticon:"view-small-tile",text:C.get("TileView"),className:"tileview",loader:"DS/CollectionView/ResponsiveLargeTilesCollectionView",options:{height:"inherit",displayTitleTooltip:!0,displayedOptionalCellProperties:["description","contextualMenu"],useDragAndDrop:!0},layout:{columnMaxWidth:400}},{fonticon:"view-small-thb",text:C.get("ThumbnailView"),className:"thumbnailview",loader:"DS/CollectionView/ResponsiveThumbnailsCollectionView",options:{height:"inherit",allowUnsafeHTMLContent:!1,displayTitleTooltip:!0,displayedOptionalCellProperties:["description","contextualMenu"],useDragAndDrop:!0},layout:{columnMaxWidth:250}}],taggerServices:null,_currentListNodes:{},_currentFilteredNodes:[],_currentModels:{},_isWebInWin:_.isWebInWin(),_widgetId:"",separator:"",collectionsViews:{},direction:"",scrollerElement:null,previewAccordion:null,_accordionOpenedItem:[],_idsFilteredBySearch:null,navigationCollection:null,className:function(){return this.getClassNames("-container")},setup:function(t){this._compassSocket=new i.Socket("com.ds."+widget.id),this._compassSocket.subscribeServer("com.ds.compass",window.parent),this._widgetId=t.widgetId?t.widgetId:null,this.separator=t.separator?t.separator:null,this.navigationCollection=t.collection?t.collection:null,this.modalPreview=new r({className:"modal-preview",closable:!0,header:"<h4>"+C.get("previewUpAndDownstream")+"</h4>",events:{onHide:function(){this.cleanView(),this._cleanPreviewPanel()}.bind(this)}}).inject(this.container),t.direction&&this.setModalTitle(t.direction);var n=e.createElement("div",{class:"actionButton-container"});this.importInGraphButton=new l({value:C.get("addInGraph"),className:"primary extract",disabled:!0,events:{onClick:function(){this._extractNode()}.bind(this)}}).inject(n);new l({value:C.get("close"),className:"default cancel",events:{onClick:function(){this.modalPreview.hide()}.bind(this)}}).inject(n);this.modalPreview.setFooter(n),this.modalBody=e.createElement("div",{class:"modal-body-container"});var s=e.createElement("div",{class:"iconbar-container"}).inject(this.modalBody),o=this._views.filter(function(e){return e.className===v.getPref("typeLayoutView")}.bind(this))[0];this._isWebInWin&&e.createElement("span",{class:"fonticon fonticon-search enoripe-preview-searchcommand",title:C.get("MapSearchView_search")}).inject(s).addEventListener("click",this._handleSearch.bind(this));var a=e.createElement("span",{class:"fonticon fonticon-select-all enoripe-preview-selectcommands",title:C.get("Select-Deselect-Nodes")}).inject(s),h=e.createElement("span",{class:"fonticon fonticon-"+o.fonticon,title:o.text}).inject(s);new c({target:h,className:"count-list-layout-dropdown",items:this._views,events:{onClick:function(e,t){this._currentListNodes&&Object.values(this._currentListNodes).length>0&&(v.setPrefEverywhere("typeLayoutView",t.className),h.set("class",t.elements.icon.className),h.title=t.text,this._showLoading(),this.setPreview(this.sourceId,this._currentListNodes,this.direction,!0))}.bind(this)}}),new c({target:a,className:"count-list-layout-dropdown",items:[{text:C.get("SNNavigationMap.selectAll.Title"),fonticon:"select-all",selectable:!1},{text:C.get("SNNavigationMap.clearSelection.Title"),fonticon:"select-none",selectable:!1}],events:{onClick:function(e,t){"select-all"===t.fonticon?this.selectAllVisibleNodes():this.unselectAll()}.bind(this)}});this.detailsContainer=e.createElement("div",{class:"detailsContainer"}).inject(this.modalBody),this.spinner=(new d).inject(this.modalBody).show(),this.modalPreview.setBody(this.modalBody),this._initTagger()},setPreview:function(t,i,n,s){var o=[];if(this.cleanView(),i&&(this._currentListNodes=i),t&&(this.sourceId=t),n&&(this.setModalTitle(n),this.direction=n),i&&Object.keys(i).length>0){for(var a in this.previewAccordion=new h({className:"preview-accordion",items:[],exclusive:!1}).inject(this.detailsContainer),i=Object.keys(i).sort((function(e,t){return e.localeCompare(t)})).reduce((function(e,t){return e[t]=i[t],e}),{})){let t=null,n=0;n=i[a].reduce((function(e,t){if(t.relations&&t.relations.length>0){let i=0;return i="in"===t.relations[0].direction?1:t.relations.length,e+i}return e}),0),this.previewAccordion.addItem({title:a+" ("+n+")",name:a}),t=e.createElement("div",{class:"collectionContainer"}).inject(this.previewAccordion.getItem(a).elements.content),this._createCollection(a,i[a],t),o=o.concat(i[a])}this._accordionOpenedItem.forEach(function(e){this.previewAccordion.selectItem(e)}.bind(this))}else{e.createElement("div",{class:"noResult",html:C.get("noResult")}).inject(this.detailsContainer);this._hideLoading()}this.scrollerElement=new u({element:this.detailsContainer}).inject(this.modalBody),s||this._updateFilterProxy([],o)},render:function(e){this.modalPreview.show(),e?this.setModalTitle(e):e="both",this._showLoading(),m.trackUsage("Commands","Preview"),m.trackUsage("PreviewView","Options-"+e)},setModalTitle:function(e){var t="";switch(e){case"in":t=C.get("previewUpstream");break;case"out":t=C.get("previewDownstream");break;default:t=C.get("previewUpAndDownstream")}this.modalPreview.setHeader("<h4>"+t+"</h4>")},_createCollection:function(t,i,a){var r=this,l=null,c=[],d={},h=[],u=[],g=0;if(this.collectionsViews[t]&&this.collectionsViews[t].TreedocModel.getSelectedNodes()){h=this.collectionsViews[t].TreedocModel.getSelectedNodes();for(var p=0;p<h.length;p++)u.push(h[p].getAttributeValue("id"))}if(!i||0===i.length){e.createElement("div",{class:"noResult",html:C.get("noResult")}).inject(this.detailsContainer);return this._hideLoading(),void b.showNotif({isAlert:!0,msg:C.get("noDetails"),container:this.modalBody})}d=this._views.filter(function(e){return e.className===v.getPref("typeLayoutView")}.bind(this))[0],require([d.loader],function(e){for(var h=0;h<i.length;h++){var p,m=i[h],v=m.type,_=f.getDefaultAttributes(),b=(p=void 0!==_[v]?_[v].attributes:_.AllTypes.attributes).map((function(e){return e.uri})),N=S.getTitleLabel(m.nlsObj?m.nlsObj:m,b.slice(0,3)),w=S.getTitleLabel(m.nlsObj?m.nlsObj:m,b.slice(3,6));let e;if("Person"===v){var I=m["ds6w:identifier"];I&&(e=S.getUser3DSwymPictureURL(I))}e?m.type_icon_url=e:e=m.preview_url?m.preview_url:o.getWebappsAssetUrl("SNNavigationMap","icons/thumbnailLargeDefault.png");var E={label:N,icons:[m.type_icon_url],subLabel:w,thumbnail:e,contextualMenu:"A",customTooltip:new s({shortHelp:N,longHelp:this._getLongHelp(m.nlsObj?m.nlsObj:m,p)}),grid:{id:m.id,type:m.type,element:m}};m.instances&&m.instances.length>0&&m.relations&&m.relations.length>0&&(E.description=m.relations.length+" ",m.relations.length>1?E.description+=C.get("instances"):E.description+=C.get("instance")),c.push(new n(E))}c.sort((function(e,t){return e.getAttributeValue("label").localeCompare(t.getAttributeValue("label"))})),d.options.onDragStartCell=this._onDragStart.bind(this),(l=new e(d.options)).selectionBehavior={unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,canInteractiveMultiselectWithCheckboxClick:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1},l.layout&&l.layout.columnMaxWidth&&(l.layout.columnMaxWidth=d.layout.columnMaxWidth),l.onSelectionAdd((function(e){r._syncObjectToCompass(),1==r._getSelectedNodes().length&&r.importInGraphButton.enable()})),l.onSelectionRemove((function(e){r._syncObjectToCompass(),0==r._getSelectedNodes().length&&r.importInGraphButton.disable()})),l.updateView({updateCellContent:!0}),l.model=c,this._currentModels[t]=c,r._currentFilteredNodes&&r._currentFilteredNodes.length>0&&l.model.forEach((function(e){r._currentFilteredNodes.includes(e.getAttributeValue("id"))||e.hide()})),r._idsFilteredBySearch&&r._idsFilteredBySearch.length>0&&l.model.forEach((function(e){r._idsFilteredBySearch.includes(e.getAttributeValue("id"))||e.hide()})),this._updateAccordionItems(),u.length>0&&l.model.forEach(function(e){u.indexOf(e.getAttributeValue("id"))>-1&&l.selectNodeModel(e,!0,!1)}.bind(this)),l.onContextualEvent={this:r,callback:function(e){r._handleMenuClick(e),e.data.event.stopPropagation()}},l.getContent().inject(a),this.collectionsViews[t]=l,this._updateNls(i),this._hideLoading(),l.onReady(function(){l.getVisibleCellsInViewport();g=l.getContent().getElement(".wux-layouts-gridengine-poolcontainer-rel").getBoundingClientRect().height,a.setStyle("height",g+5)}.bind(this))}.bind(this))},_updateNls:function(e){var t,i=this,n={},s=[];e.forEach((function(e){if(!e.nlsObj&&!n[e.id]){var t={_attributes:e};n[e.id]=t}})),s=Object.values(n),t=Object.keys(n);var o=S._prepareDataToNls(s.map((e=>e._attributes)));S._getNlsAndProcessData(o,t,n).then((function(e){i._getCollectionsModels(!0).forEach((function(t){Object.keys(e.nlsObj).indexOf(t.getAttributeValue("id"))>-1&&i.updateAttributes(e.nlsObj[t.getAttributeValue("id")],t)}))}))},getFilteredElements:function(e){if(this._currentFilteredNodes&&this._currentFilteredNodes.length>0)return this._currentFilteredNodes;var t=[];return this._getCollectionsModels(!0).forEach((function(i){-1===t.indexOf(i.getAttributeValue(e))&&t.push(i.getAttributeValue(e))})),t},getIdsSorted:function(e){var t=[];return this._getCollectionsModels(!0).forEach((function(i){e.indexOf(i.getAttributeValue("id"))>-1&&t.push(i.getAttributeValue("id"))})),t},filterBySearch:function(e){for(var t in this.collectionsViews)this._currentModels[t]&&(this.collectionsViews[t].model=this._currentModels[t]);this._getCollectionsModels(!0).forEach((function(t){e.includes(t.getAttributeValue("id"))?t.show():t.hide()})),this._updateAccordionItems(),e.length?this._idsFilteredBySearch=e:this._idsFilteredBySearch=[]},clearSearch:function(){var e=this.getFilteredElements("id");this._getCollectionsModels(!0).forEach((function(t){e.includes(t.getAttributeValue("id"))?t.show():t.hide()})),this._updateAccordionItems(),this._idsFilteredBySearch=null},_handleSearch:function(){var t=this;if(this._searchModule)this._searchModule.container.toggle();else{var i=e.createElement("li",{class:"Enoripe-SearchContainer"}).inject(this.getElement(".iconbar-container"),"top");require(["DS/SNNavigationMap/views/SearchViewForNative"],(function(e){t._searchModule=new e({renderTo:i}),t._searchModule.render(),t.listenTo(t._searchModule,"ENORIPE_performSearch_native",(function(e){t.dispatchEvent("ENORIPE_performSearch_native",e)})),t.listenTo(t._searchModule,"ENORIPE_resetSearch_native",(function(){t.dispatchEvent("ENORIPE_resetSearch_native")}))}))}},selectNode:function(e){"All"===e?this.selectAllVisibleNodes():this._getCollectionsModels().forEach((function(t){t.options.grid.id===e?t.select():t.unselect()}))},selectAllVisibleNodes:function(){for(var e in this.collectionsViews)this.collectionsViews[e].selectAllVisibleNodes()},unselectAll:function(){for(var e in this.collectionsViews)this.collectionsViews[e].unselectAll()},_getSelectedNodes:function(){var e=[];for(var t in this.collectionsViews)e=e.concat(this.collectionsViews[t].TreedocModel.getSelectedNodes());return e},_handleMenuClick:function(e){var t,i=null;e&&e.infos&&e.infos.target?t=e.infos.target:e&&e.data&&e.data.target&&(t=e.data.target),e.cellInfos&&e.cellInfos.cellModel?i=e.cellInfos.cellModel.getAttributeValue("element"):e.context&&e.context.cellInfos&&e.context.cellInfos.cellModel&&(i=e.context.cellInfos.cellModel.getAttributeValue("element"));var n={target:t,items:[],events:{onClick:function(e){e.stopPropagation()},onClickOutside:function(){this.destroy()}}};if(this.dropDownMenu&&(this.dropDownMenu.destroy(),this.dropDownMenu=null),this.dropDownMenu=new c(n),i)if(this._isWebInWin)this.dispatchEvent("ContextualMenuPreviewGroup",{targetId:i.id,targetElement:t}),_.sendToMapWebInWin("onComputeCtxMenu",[i.id]);else{this.dropDownMenu.addItem({text:C.get("Information"),name:"properties",fonticon:"info-open-in-a-new-window",handler:function(){this._manageEditProp([i])}.bind(this)});const e=[i],t=S.get3DXContent(e);(new N).set3DXContent(t).render(this.dropDownMenu),0==this.dropDownMenu.items.length&&(this.dropDownMenu.items=[{}]),this.dropDownMenu.show(),i.type&&i.type.contains("Document")&&this.dropDownMenu.addItem({text:C.get("Download"),fonticon:"download",handler:function(){this.dispatchEvent("ENORIPE_DownloadDocument",[i.id,i.name])}.bind(this)})}},_extractNode:function(){var e=[],t=[],i={},n=this._getSelectedNodes();n&&n.length>0&&n.forEach(function(n){i=n.getAttributeValue("element"),e.push(i),i.relations&&("3DSpace"!=i.serviceId&&(i.relations=S.manageCSLLinks(i.relations,[i],this.navigationCollection)),t=[...t,...i.relations])}.bind(this)),e.length>0&&(this.dispatchEvent("ENORIPE_extractNode",{sourceIds:[this.sourceId],objects:e,links:t}),this.modalPreview.hide(),m.trackUsage("Expand","WithPreview"),m.trackUsage("PreviewView","AddInGraph-Commands"),m.trackUsage("PreviewView","AddInGraph-ExtractNumber",e.length))},_onDragStart:function(e,t){var i;if((i=this._getSelectedNodes())&&i.length>0){var n=this._buildCompassData({widgetId:this._widgetId,envId:f.getPlatformId(),selectedModels:i});try{e.dataTransfer.setData("text/searchitems",JSON.stringify(n)),e.dataTransfer.setData("text",JSON.stringify(n))}catch(t){console.log(t),e.dataTransfer.setData("text",JSON.stringify(n))}}return e.stopPropagation(),!1},updateAttributes:function(e,t){var i,n,o,a;a=(o=S.getAttributes(t.getAttributeValue("type")).attributes).map((function(e){return e.uri})),i=S.getTitleLabel(e,a.slice(0,3)),n=S.getTitleLabel(e,a.slice(3,6)),t.setLabel(i),t._options.subLabel=n,t._options.customTooltip=new s({shortHelp:i,longHelp:this._getLongHelp(e,o)}),!t._options.preview_url&&e.preview_url&&(t._options.preview_url=e.preview_url),t.updateOptions()},_updateAccordionItems:function(){for(var e in this.collectionsViews)if(this.previewAccordion){const t=this.previewAccordion.items.find((t=>t.name===e));if(t){let i=this._currentModels[e].filter((e=>!1===e._isHidden));if(i.length>0){let n=i.reduce(((t,i)=>{let n=this._currentListNodes[e].find((e=>e.id===i._options.grid.id)),s=0;return s="in"===n.relations[0].direction?1:n.relations.length,t+s}),0);this.previewAccordion.setTitle(e,'<i class="caret-left"></i>'+e+" ("+n+")"),t.elements.container.show()}else t.elements.container.hide()}}},_initTagger:function(){var e=this;this.taggerServices||(this.taggerServices=new p({widgetId:this._widgetId,addVolatileTags:!1}),this.taggerServices.addEvent("Tagger_FilterBIColorize",(function(t){e.onFilterBIColorize(t)})),this.taggerServices.addEvent("Tagger_FilterBIUnColorize",(function(t){e.onFilterBIUnColorize(t)})),this.taggerServices.addEvent("Tagger_FilterBIFilteringEvent",(function(t){e.onFilterBIFilteringEvent(t)})))},_updateFilterProxy:function(e,t){var i=[],n=[],s=0,o=!1;if(this.taggerServices.activate(),e&&e.length>0&&(Object.keys(e.allfilters).length>0||e.volatileFilters&&Object.keys(e.volatileFilters).length>0)&&(o=!0),o){if(e&&e.matchingIDs)for(s=0;s<e.matchingIDs.length;s++)"_"!==e.matchingIDs[s].slice(-2,-1)&&(i.push(e.matchingIDs[s]),n.push([s]))}else for(s=0;s<t.length;s++)i.push(t[s].id),n.push([s]);this.taggerServices.updateFilterProxy(i)},onFilterBIColorize:function(e){var t=[];this.onFilterBIUnColorize(),e.forEach((function(e){t[e.id]=e.color})),this._getCollectionsModels().forEach((function(e){Object.keys(t).includes(e.getAttributeValue("id"))&&e.updateOptions({color:t[e.getAttributeValue("id")]})}))},onFilterBIUnColorize:function(){this._getCollectionsModels().forEach((function(e){e.updateOptions({color:""})}))},onFilterBIFilteringEvent:function(e){var t=this;if(this._currentFilteredNodes=e.matchingIDs,t._idsFilteredBySearch)this.dispatchEvent("ENORIPE_LaunchSearch");else{for(var i in this.collectionsViews)this._currentModels[i]&&(this.collectionsViews[i].model=this._currentModels[i]);this._getCollectionsModels().forEach((function(e){t._currentFilteredNodes.includes(e.getAttributeValue("id"))?e.show():e.hide()})),this._updateAccordionItems()}},_manageEditProp:function(e){var t=this._getSelectedNodes();require([this._propertiesCommandRequire,this._propertiesConstantsRequire],function(e,i){let n=f.getXPrefCredential();var s={getSecurityContext:function(){return{SecurityContext:n,tenant:f.getPlatformId()||"OnPremise"}},getSelectedNodes:function(){var e=[];return t.forEach((function(t){var n={metatype:i.METATYPE_BUS,objectId:t.getAttributeValue("id"),tenant:f.getPlatformId()||"OnPremise",source:t.getAttributeValue("element").serviceId||"3DSpace",type:t.getAttributeValue("element").type,getID:function(){return t.getAttributeValue("id")}};"3DSpace"!=t.getAttributeValue("element").serviceId&&(n.indexModeParameter=!0),e.push(n)})),e}};(new e).launchProperties(s)}.bind(this))},_syncObjectToCompass:function(){var e=this._getSelectedNodes();if(0===e.length)this.updateSelection(null),w.publish("resetTypes");else{var t={widgetId:this._widgetId};w.publish("setTypes",t)}1===e.length&&this.updateSelection(e[0]);var i=this._buildCompassData({widgetId:this._widgetId,envId:f.getPlatformId(),selectedModels:e});this._compassSocket.dispatchEvent("onSetX3DContent",i),this._publishSelectionEvent(e)},_publishSelectionEvent:function(t){var i={metadata:{uid:e.Utils.getUUID(),originUid:this._selectUuid,timestamp:Date.now(),appid:"/no_private_channel",originWidgetId:this._widgetId,ignoreFromSameWidgetId:!1,origin:"SNNavigationMap"},data:{tenant:this._tenant,version:"1.1"}};"undefined"!=typeof widget&&null!==widget&&(void 0!==widget.getValue("x3dSharedId")?i.metadata.appid="/"+widget.getValue("x3dSharedId"):void 0!==widget.getValue("x3dAppId")?i.metadata.appid="/"+widget.getValue("x3dAppId"):void 0!==widget.getValue("appId")&&(i.metadata.appid="/"+widget.getValue("appId")+"_"+widget.id)),i.data.paths=[];for(var n=0;n<t.length;n++)i.data.paths[n]=[t[n].getAttributeValue("id")];try{require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],(function(e){i.data.changeControl=e.get()}))}catch(e){console.warn("No Change")}g.publish("DS/PADUtils/PADCommandProxy/select",i)},updateSelection:function(e){if(null===e){var t={objectId:"",envId:f.getPlatformId(),contextId:"",serviceId:this._serviceName||"3DSpace"};return this._compassSocket.dispatchEvent("onSetObject",t),void this._compassSocket.dispatchEvent("onResetX3DContent",{})}var i={objectId:e.getAttributeValue("id"),envId:f.getPlatformId(),contextId:"",serviceId:this._serviceName||"3DSpace"};if(this._compassSocket.dispatchEvent){this._compassSocket.dispatchEvent("onSetObject",i);var n={widgetId:this._widgetId};w.publish("setTypes",n)}},_buildCompassData:function(t){var i={};if(e.is(t)){var n=t.selectedModels;if(e.is(n,"array")){const e=n.map((e=>e._options.grid.element));i=S.get3DXContent(e)}}return i},buildSelectionForNativeApps:function(){for(var e,t={version:"2.1",results:[],structures:[{structure:[]}]},i=this._getSelectedNodes(),n=0;n<i.length;n++)e=JSON.stringify(n+1),t.results.push({id:e,phid:i[n].id}),t.structures[0].structure.push({id:e,show:!0,select:!0,children:[]});return JSON.stringify(t)},_showLoading:function(){this.spinner.show()},_hideLoading:function(){this.spinner.hide()},_getLongHelp:function(e,t){var i="",n="";if(e)for(var s=0;s<t.length;s++)if(void 0!==(n=e[t[s].uri])){var o=t[s].label;"ds6w:modified"!==t[s].uri&&"ds6w:created"!==t[s].uri||""===n||(n=a.formatDateToString(new Date(n),{timePrecision:"sec"})),i=i+o+" : "+n+"\n"}return i},_getCollectionsModels:function(e){var t=[];for(var i in this.collectionsViews)t=e?t.concat(this.collectionsViews[i].TreedocModel.getRoots()):t.concat(this.collectionsViews[i].model);return t},_cleanPreviewPanel:function(){if(this._currentFilteredNodes=[],this.previewAccordion=null,this._accordionOpenedItem=[],this.collectionsViews){for(var e in this.collectionsViews)this.collectionsViews[e].destroy(),this.collectionsViews[e]=null;this.collectionsViews={}}this.importInGraphButton.disable(),this.taggerServices.cleanProxy(),this.taggerServices.deactivate(),this.dispatchEvent("PreviewHide")},cleanView:function(){if(this.previewAccordion){var e=this.previewAccordion.getUnselectedItems().map(function(e){return this.previewAccordion.getItem(e.id).name}.bind(this));this._accordionOpenedItem=this._accordionOpenedItem.filter((function(t){return e.indexOf(t)<0})),this.previewAccordion.getSelectedItems().forEach(function(e){this._accordionOpenedItem.indexOf(this.previewAccordion.getItem(e.id).name)<0&&this._accordionOpenedItem.push(this.previewAccordion.getItem(e.id).name)}.bind(this))}this.scrollerElement&&(this.scrollerElement.destroy(),this.scrollerElement=null),this.detailsContainer.destroy()}})})),define("DS/SNNavigationMap/models/CountOnNode",["UWA/Class/Model","UWA/Class/Collection","DS/SNNavigationMap/models/Count","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/CommonUtils","DS/WAFData/WAFData"],(function(e,t,i,n,s,o){"use strict";return e.extend({defaults:{source:"",requestDone:!1,realCounts:null,allCounts:null},setup:function(e){this.set("realCounts",new UWA.Class.Collection([],{model:i})),this.set("allCounts",new UWA.Class.Collection([],{model:i})),this.set("source",e.source)},parse:function(e){e.forEach(function(e){this.get("allCounts").add(this.createCount(e))}.bind(this))},createCount:function(e){return new i(e)},resetRealCount:function(e){this.get("realCounts").reset(),this._buildRealCount(e,"in"),this._buildRealCount(e,"out")},_buildRealCount:function(e,t){var n=[],o=[],a={},r=null;this.getAllCounts(t).forEach(function(l){o=[],"out"===t?n=e.where({modelType:"link",sourceId:l.get("source")}):"in"===t&&(n=e.where({modelType:"link",targetId:l.get("source")})),n.forEach((function(e){s.getMainRelName(e.get("type"))===s.getMainRelName(l.get("name"))&&o.push(e)})),a=l.toJSON();let c=0;o.length>0?(c="in"===t?new Set(o.map((e=>e._attributes.sourceId))).size:o.length,a.count=a.count-c,a.count>0&&(r=new i(a),this.get("realCounts").add(r))):(a.count=parseInt(a.count),r=new i(a),this.get("realCounts").add(r))}.bind(this))},getCountsNumber:function(e){var t=0;return e.forEach((function(e){t+=parseInt(e.get("count"))})),t},isAllExpanded:function(e){return e?0===this.getCountsNumber(this.getRealCounts(e))||0===this.getRealCounts(e).length:this.isAllExpanded("in")&&this.isAllExpanded("out")},isAllCollapsed:function(e){return e?this.getCountsNumber(this.getRealCounts(e))===this.getCountsNumber(this.getAllCounts(e)):this.isAllCollapsed("in")&&this.isAllCollapsed("out")},isRequestDone:function(){return this.get("requestDone")},getExpandedRelations:function(){var e=[];return this.get("allCounts").filter(function(t){if(this.get("realCounts").get(t.id)){let i=this.get("realCounts").get(t.id);t.get("count")>i.get("count")&&e.push({count:t.get("count")-i.get("count"),relations:t.get("name")})}else e.push({count:t.get("count"),relations:t.get("name")})}.bind(this)),e},hasCount:function(e){return e?this.getCountsNumber(this.getAllCounts(e))>0:this.hasCount("in")||this.hasCount("out")},hasRealCount:function(e){return e?this.getCountsNumber(this.getRealCounts(e))>0:this.hasRealCount("in")||this.hasRealCount("out")},setRequestDone:function(e){!0!==e&&!1!==e||this.set("requestDone",e)},getAllCounts:function(e){return e?this.get("allCounts").where({direction:e}):[...this.getAllCounts("in"),...this.getAllCounts("out")]},getRealCounts:function(e){return e?this.get("realCounts").where({direction:e}):[...this.getRealCounts("in"),...this.getRealCounts("out")]},getRealCountAttribute:function(e,t){return this.getRealCounts(t).map((function(t){return t.get(e)}))},getAllCountAttribute:function(e,t){return this.getAllCounts(t).map((function(t){return t.get(e)}))}})})),define("DS/SNNavigationMap/views/popups/ExpandNLevel",["UWA/Core","UWA/Class/View","DS/UIKIT/SuperModal","DS/UIKIT/Input/Button","DS/UIKIT/Form","DS/SNNavigationMap/utils/PromisesManager","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/RelationsServices","DS/SNNavigationMap/utils/ProbesUtils","DS/SNNavigationMap/utils/PreferencesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n,s,o,a,r,l,c,d){"use strict";return i.extend({className:"expandNLevel-view",widgetId:"",selectedNode:{},progressContainer:null,nodesExpandedIdByLevel:[null],expandSessionId:"",continueGetEcosystem:!0,level:2,init:function(e){this._PM=new o({debugMode:"1"===a.getOption("debug_me")}),this.widgetId=e.widgetId;let t=c.getPref("expandNLevel");t&&t>0&&(this.level=t)},initModal:function(t){var i=this,n={},o=null;if(this.expandSessionId=t.expandSessionId?t.expandSessionId:this.getExpandSessionId(),this.continueGetEcosystem=!0,this.nodesExpandedIdByLevel=[null],t&&t.selectedNode){this.selectedNode=t.selectedNode,n={className:"vertical",grid:"1 2",fields:[{type:"select",label:d.get("NavigationDirectionLabel"),name:"navigationDirection",options:[{label:d.get("UpAndDownstream"),value:"",selected:!0},{label:d.get("Upstream"),value:"in"},{label:d.get("Downstream"),value:"out"}]},{type:"number",label:d.get("HowManyLevelExpand"),value:this.level,nativeNumber:!0,step:"1",min:"1",max:"5",name:"expandLevel",required:!0}],events:{onSubmit:function(e){e.expandLevel>0&&e.expandLevel<6?i.setCalculateView(e):(o.elements.container[1].style.borderColor="red",a.show())}}},o=new s(n);var a=e.createElement("span",{class:"error-text",text:d.get("NumberError")});a.hide(),o.elements.container[1].parentNode.insertBefore(a,o.elements.container[1].nextSibling),o.elements.container[1].addEventListener("blur",(function(e){this.value<1||this.value>5?(this.style.borderColor="red",a.show()):(this.style.borderColor="#b4b6ba",a.hide())})),this.options={closable:!0,renderTo:widget.body,className:"Enoripe-Modal-ExpandNLevel",animate:!0,events:{onHide:function(e){}.bind(this)}},this._parent(this.options),this.dialog({body:o,title:d.get("ExpandNLevelTitle")+" - 1/2",buttons:[{className:"primary",value:d.get("Calculate"),action:function(){o.submit()}},{value:d.get("cancel"),action:function(){this.closeModal()}.bind(this)}]}),this.modals.current.elements.close.addEventListener("click",function(){this.closeModal()}.bind(this))}},setCalculateView:function(t){var i,n,s=parseInt(t.expandLevel);this.progressContainer=e.createElement("div",{class:"progressContainer"}),n=e.createElement("div",{class:"progress w-0-percent",id:"self-animated"}).inject(this.progressContainer),i=e.createElement("div",{class:"separatorContainer"}).inject(n);for(var o=0;o<s;o++)e.createElement("div",{class:"separatorLevel","data-after":d.get("level")+" "+(o+1),styles:{width:"calc(100%/"+s+")",left:"calc((100%/"+s+")*"+o+")"}}).inject(i);e.createElement("div",{class:"progress-bar"}).inject(n),e.createElement("label",{id:"self-animated-label",text:d.get("Uploading")+"..."}).inject(n),this.dialog({body:this.progressContainer,title:d.get("ExpandNLevelTitle")+" - 2/2",buttons:[{className:"primary btn-create",value:d.get("OK"),disabled:!0},{value:d.get("cancel"),action:function(){this.closeModal()}.bind(this)}]}),this.next();var a={progressLevel:0,expandLevel:s,selectedNode:this.selectedNode};t.navigationDirection&&(a.direction=t.navigationDirection),this.level=s,c.setPrefToLocalStorage("expandNLevel",s),this._getEcosystemByLevel(a)},endUploading:function(t,i,n,s){var o,r=null,c=null,h=0;(r=this.progressContainer.getElement("#self-animated-label"))&&r.setText(d.get("UploadComplete")),this.progressContainer.getElement(".progress").addClassName("progress-success"),o=e.createElement("div",{class:"uploadCommentContainer"}).inject(this.progressContainer),n!=i&&e.createElement("span",{class:"endingLevel",text:d.get("TheLevel")+" "+i+" "+d.get("noMoreObjects")}).inject(o);for(var u=1;u<t.length;u++)h+=Object.keys(t[u]).length;var g=h>1?d.get("objectsExpanded").format(h,i):d.get("objectExpanded").format(h,i);e.createElement("span",{class:"numberObjectsExpanded",text:g}).inject(o),h>0&&(e.createElement("span",{class:"addObjectsText",text:d.get("AddinGraphText")}).inject(o),(c=this.modals.current.getFooter().getElement(".btn-create")).removeClassName("disabled"),c.disabled=!1,c.addEventListener("click",function(){s=s||"both",l.trackMultiUsage("expandNLevel","expandNLevel",[n,s]),a.setOption("fullImportNoOfObjects",h),this.dispatchEvent("ENORIPE_fullImport",{sessionId:this.expandSessionId}),this.closeModal()}.bind(this)))},closeModal:function(){this.modals.current.hide()},getExpandSessionId:function(){var e=new Date,t=e.getDay()+e.getMonth()+e.getFullYear()+"-"+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds();return"ENORIPE_Relations_Expand_"+Math.floor(1e4*Math.random())+"_"+t},_getEcosystemByLevel:function(e){var t,i=this,n=e.progressLevel?e.progressLevel:0,s=e.expandLevel?e.expandLevel:0;t={widgetId:this.expandSessionId,direction:e.direction,fullImportMode:!0},r.getEcosystem(Object.values(e.selectedNode),t).then((function(t){n++,i.progressContainer.getElement(".progress-bar").style.width=Math.round(100/s*n)+"%",i.nodesExpandedIdByLevel[n]={};for(var o=0;o<t.objects.length;o++){var r=t.objects[o],l={},c=[];if(Object.keys(i.nodesExpandedIdByLevel[n]).indexOf(r)<0&&Object.keys(e.selectedNode).indexOf(r)<0){for(var d=0;t.objects[o].instances&&d<t.objects[o].instances.length;d++){let e={};a.getOption("attributesForItems").forEach((function(i){t.objects[o].instances[d][i]&&(e[i]=t.objects[o].instances[d][i])})),c.push(e)}l={instances:c},a.getOption("attributesForItems").forEach((function(e){t.objects[o][e]&&(l[e]=t.objects[o][e])})),i.nodesExpandedIdByLevel[n][t.objects[o].id]=l}}if(i.continueGetEcosystem)if(i.nodesExpandedIdByLevel[n]&&Object.keys(i.nodesExpandedIdByLevel[n]).length>0&&n<s){var h={progressLevel:n,expandLevel:s,selectedNode:i.nodesExpandedIdByLevel[n],direction:e.direction};i._getEcosystemByLevel(h)}else i.endUploading(i.nodesExpandedIdByLevel,n,s,e.direction)}),(function(){i.endUploading(i.nodesExpandedIdByLevel,n,s,e.direction)}))}})})),define("DS/SNNavigationMap/views/CustomizeRelationsView",["UWA/Core","UWA/Class/View","DS/SNNavigationMap/utils/ProbesUtils","DS/SNNavigationMap/utils/PreferencesUtils","DS/WebappsUtils/WebappsUtils","DS/ENORIPE_Common/utils/CommonAlert","DS/UIKIT/Iconbar","DS/UIKIT/Autocomplete","DS/UIKIT/DropdownMenu","DS/UIKIT/SuperModal","DS/UIKIT/Form","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Accordion","DS/UIKIT/Mask","DS/WUXAutoComplete/AutoComplete","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Controls/Toggle","DS/Controls/TooltipModel","DS/DataGridView/DataGridViewLayout","DS/DataGridView/DataGridView","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n,s,o,a,r,l,c,d,h,u,g,p,f,m,v,_,S,b,N,w){"use strict";return t.extend({name:"Customize",_dialog:null,_notifContainer:null,currentRelations:{},displayedRelations:[],datagridViewDisplayedR:null,datagridViewOthersR:null,displayedTree:null,othersRelationsTree:null,togglesHeader:[],accordionsElements:[],RECENTLIMIT:3,MARGINACCORDION:5,className:function(){return this.getClassNames("-container")},setup:function(t){e.clone(t,!1).settings&&(this.currentProfile=t.currentProfile,this.dimensions={},this.dimensions.position={},this.dimensions.position.offsetX=0,this.dimensions.position.offsetY=50,this.dimensions.dialogWidth=400,this.dimensions.dialogHeight=520,this.firstLaunch=!0,this._thumbnails2d=t.thumbnails2d,this._recompute=t.recomputeLayout,this._autoNav=t.autoNav,this._initProfileAutoComplete(t))},render:function(e){null===this._dialog&&this.createDialogContent(),this.getElement("#relations-list")&&(this._relationsList=this.getElement("#relations-list")),this._previousProfile=this._getSelectedProfile(),this.handleProfileChange();this._dialog.getElement(".Customize_SearchCommand");this.loadingRelations()},showRelations:function(e){var t=[];this.currentRelations={...e},Object.keys(this.displayedRelations).forEach(function(i){Object.keys(e).indexOf(i)>-1&&(t[i]=e[i],delete e[i])}.bind(this)),this._refreshRelations(t,this.datagridViewDisplayedR,this.displayedTree),this._refreshRelations(e,this.datagridViewOthersR,this.othersRelationsTree),this._updateDatagridHeader(2),this._updateDatagridHeader(4)},createDialogContent:function(){var t,i,n;n=new e.createElement("div",{class:"customize-content",draggable:"false"}),i=new e.createElement("div",{class:"customize-headercontent",draggable:"false"}).inject(n),t=new e.createElement("div",{class:"customize-bodycontent",draggable:"false"}).inject(n),this._renderHeaderToolbar(i),this._renderBody(t),this._dialog=e.createElement("div",{html:n}).inject(this.container),this._createDropDownMenuToolbar(),this._notifContainer=this.container},_renderHeaderToolbar:function(e){var t=this;this._autocompleteInput=new r({noResultsMessage:!1,placeholder:w.get("Customize-SearchTextInvite"),events:{onKeyUp:t._onKeyUp.bind(t)}}).inject(e),this._renderProfileAutoComplete().inject(e),this._autocompleteInput.elements.container.addClassName("customize-autocomplete customize-hidden"),this._autocompleteInput.elements.clear.addEventListener("click",this._clearSearch.bind(t));var i=[{className:"divider selectionIcon",name:"divider"},{fonticon:"search",text:w.get("Customize_SearchCommmand"),className:"Customize_SearchCommand",handler:function(e,i){i.elements.container.toggleClassName("pressed"),t._autocompleteInput.elements.container.toggleClassName("customize-hidden"),t.customizeProfileContainer.toggleClassName("customize-hidden"),i.elements.container.hasClassName("pressed")||t._clearSearch()}},{fonticon:"plus",text:w.get("Customize_ModalCreate"),className:"Customize_AddRelationsSetCommand",handler:function(){t._onCreateClick()}},{fonticon:"menu-dot",text:w.get("Customize_RelationSet"),className:"Customize_RelationSet",id:"Customize_RelationSet"}];new a({renderTo:e,className:"customize-toolbar",items:i}).show()},_renderBody:function(t){var i,n=null,s=null;i=new e.createElement("div",{class:"customize-contentHeader",draggable:"false"}).inject(t),(n=new g({className:"customizeRelations-accordion accordionDisplayed",items:[],exclusive:!1})).inject(t),this.accordionsElements.push(n),(s=new g({className:"customizeRelations-accordion accordionOthers",items:[],exclusive:!1})).inject(t),this.accordionsElements.push(s),this._renderDatagridHeader(i),this._renderRelationsDisplayed(n),this._renderOthersRelations(s)},_renderDatagridHeader:function(t){var i=null;i=new e.createElement("div",{class:"customize-DatagridHeader",draggable:"false"}),this.togglesHeader.push(new _({name:"groupTitle",type:"checkbox",label:w.get("SNNavigationMap.CustomizeRelations.TypeTitle"),value:0,checkFlag:!0}));let n=new e.createElement("div",{class:"checkBoxContainer",draggable:"false"}).inject(i);this.togglesHeader[0].inject(n),this.togglesHeader[0].addEventListener("buttonclick",function(e){this.toggleSelectionColumn(this.togglesHeader[0].checkFlag,"titleValue",0),this.togglesHeader[1].checkFlag=this.togglesHeader[0].checkFlag,this.togglesHeader[2].checkFlag=this.togglesHeader[0].checkFlag}.bind(this)),this.togglesHeader.push(new _({type:"checkbox",label:w.get("Upstream"),value:1,checkFlag:!0}));let s=new e.createElement("div",{class:"checkBoxContainer",draggable:"false"}).inject(i);this.togglesHeader[1].inject(s),this.togglesHeader[1].addEventListener("buttonclick",function(e){this.toggleSelectionColumn(this.togglesHeader[1].checkFlag,"upstreamValue",2),this.togglesHeader[2].checkFlag===this.togglesHeader[1].checkFlag?this.togglesHeader[0].checkFlag=this.togglesHeader[1].checkFlag:this.togglesHeader[0].checkFlag=!0}.bind(this)),e.createElement("div",{class:"wux-ui-3ds-help wux-ui-3ds upstreamHelpIcon"}).inject(s).tooltipInfos=new S({shortHelp:w.get("SNNavigationMap.CustomizeRelations.UpstreamDescription")}),this.togglesHeader.push(new _({type:"checkbox",label:w.get("Downstream"),value:2,checkFlag:!0}));let o=new e.createElement("div",{class:"checkBoxContainer",draggable:"false"}).inject(i);this.togglesHeader[2].inject(o),this.togglesHeader[2].addEventListener("buttonclick",function(e){this.toggleSelectionColumn(this.togglesHeader[2].checkFlag,"downstreamValue",3),this.togglesHeader[2].checkFlag===this.togglesHeader[1].checkFlag?this.togglesHeader[0].checkFlag=this.togglesHeader[1].checkFlag:this.togglesHeader[0].checkFlag=!0}.bind(this)),e.createElement("div",{class:"wux-ui-3ds-help wux-ui-3ds downstreamHelpIcon"}).inject(o).tooltipInfos=new S({shortHelp:w.get("SNNavigationMap.CustomizeRelations.DownstreamDescription")}),i.inject(t)},_renderRelationsDisplayed:function(t){var i,n=[];i=new e.createElement("div",{class:"relationsDisplayed-content customizeRelations-content",draggable:"false"}),this.displayedTree=new m,this.datagridViewDisplayedR=this.createDatagrid(this.displayedTree,i),n.push({title:w.get("SNNavigationMap.CustomizeRelations.AlreadyDisplayTitle"),content:i,name:"accordionRelationsDisplayed",selected:!0}),this.datagridViewDisplayedR.container=i,t.addItem(n)},_renderOthersRelations:function(t){var i,n=[];i=new e.createElement("div",{class:"OthersRelations-content customizeRelations-content",draggable:"false"}),this.othersRelationsTree=new m,this.datagridViewOthersR=this.createDatagrid(this.othersRelationsTree,i),n.push({title:w.get("SNNavigationMap.CustomizeRelations.OthersRelationsTitle"),content:i,name:"accordionOthersRelations",selected:!0}),t.addItem(n)},createDatagrid:function(e,t){var i,n,s=null;return i=[{dataIndex:"titleValue",typeRepresentation:"boolean",editableFlag:!0,editionPolicy:"EditionInPlace",getCellSemantics:function(e){return{label:e.nodeModel.getAttributeValue("titleLabel")}},getCellTooltip:function(e){return e.nodeModel?{longHelp:e.nodeModel.getAttributeValue("tooltip")}:s.getCellDefaultTooltip(e)}},{dataIndex:"upstreamType",typeRepresentation:"string",visibleFlag:!1},{dataIndex:"upstreamValue",typeRepresentation:"boolean",editableFlag:!0,editionPolicy:"EditionInPlace",getCellSemantics:function(e){return{label:e.nodeModel.getAttributeValue("upstreamLabel")}}},{dataIndex:"downstreamType",typeRepresentation:"string",visibleFlag:!1},{dataIndex:"downstreamValue",typeRepresentation:"boolean",editableFlag:!0,editionPolicy:"EditionInPlace",getCellSemantics:function(e){return{label:e.nodeModel.getAttributeValue("downstreamLabel")}}}],n=new b({useLastColumnWidthAutoFlag:!0,columnsHeader:!1}),(s=new N({treeDocument:e,columns:i,showRowIndexFlag:!1,showRowHeaderBackgroundFlag:!1,showSelectionCheckBoxesFlag:!1,columnDragEnabledFlag:!1,cellSelection:"none",placeholder:w.get("Customize-NoRelation"),defaultColumnDef:{editableFlag:!1,alignment:"near"},layout:n}).inject(t)).onReady(function(){this.dimensialAdjustment(s)}.bind(this)),s.addEventListener("change",function(e,t){this._onCheckboxClick(s,t.nodeModel,t.columnID,!0)}.bind(this)),s},_refreshRelations:function(e,t,i){var n={},s=null,o={};if(i.empty(),i.prepareUpdate(),e&&Object.keys(e).length>0)for(var a=0;a<Object.keys(e).length;a++)o={titleLabel:e[Object.keys(e)[a]].nlsLabel,tooltip:e[Object.keys(e)[a]].title},Object.values(e)[a].length>0&&Object.values(e)[a].forEach(function(e){let t=this._getDirection(e.id);""!=t&&(o[t+"Value"]=e.value,o[t+"Label"]=e.relationName,o[t+"Type"]=e.id)}.bind(this)),o.titleValue=this._needToCheckTitleValue(o.upstreamValue,o.downstreamValue),n={label:e[Object.keys(e)[a]].nlsLabel,children:[],grid:o},s=new v(n),i.addRoot(s);i.pushUpdate({},!0),this.dimensialAdjustment(t),this.unloadRelations()},_createDropDownMenuToolbar:function(){var e=this,t={target:this.getElement(".Customize_RelationSet").getChildren()[0],closeOnClick:!0,className:"customize-dropdownmenu"};t.items=[{id:"customize-createrelationset",text:w.get("Customize_CreateRelationSet"),title:w.get("Customize_ModalCreate"),className:"customize-item",fonticon:"plus",handler:function(){e._onCreateClick()}},{id:"customize-saverelationset",text:w.get("Customize_SaveRelationSet"),title:w.get("Customize_SaveTooltip"),className:"customize-item",fonticon:"floppy",handler:function(){e._onSaveClick()}},{id:"customize-deleterelationset",text:w.get("Customize_DeleteRelationSet"),title:w.get("Customize_DeleteTooltip"),className:"customize-item",fonticon:"trash",handler:function(){e.showDeleteConfirmationDialog()}}],this.relationSetMenu=new l(t)},_renderProfileAutoComplete:function(){var t=this,i=e.createElement("div",{class:"relationSet_container",minWidth:150});e.createElement("span",{class:"autocomplete-label",html:w.get("RelationSet")}).inject(i),this.customizeProfileContainer=e.createElement("div",{class:"CustomizeProfile_Container item"}),this._profileAutoComplete&&this._profileAutoComplete.removeEventListener("change",this.handleProfileChange);var n=this.profileTreeDocument.search({match:function(e){return e.nodeModel.options.data.name===t.currentProfile}});return this._profileAutoComplete=new f({elementsTree:this.profileTreeDocument,allowFreeInputFlag:!1,placeholder:w.get("Customize-SelectRelationSet"),multiSearchMode:!1,fireOnlyFromUIInteractionFlag:!0,selectedItems:n,touchMode:!0}),this._profileAutoComplete.addEventListener("change",this.handleProfileChange.bind(this)),this._profileAutoComplete.inject(i),i.inject(this.customizeProfileContainer),this.customizeProfileContainer},_initProfileAutoComplete:function(e){for(var t=this._getProfilesForComboBox(e.profileArray,e.recentProfiles),i=e.currentProfile||e.lastUsedProfile,n=-1,s=2,o=0;o<t.length;o++)"AutoModeProfile"===t[o].name&&(s=o),null!==i&&""!==i&&void 0!==i&&(t[o].name===i&&"text"!==t[o].type&&(n=o),this._autoNav="AutoModeProfile"===i);-1===n&&(n=s),this.profileTreeDocument=new m({name:"test"}),this.profileTreeDocument.prepareUpdate();for(var a=0;a<t.length;a++){var r={label:t[a].nls?t[a].nls:t[a].name,data:{name:t[a].name,selectable:!1!==t[a].selectable}};t[a].isRecent?r.icons=[{iconName:"clock"}]:"UserDefined"!==t[a].type&&"custom"!==t[a].type||(r.icons=[{iconName:"user"}]),t[a].type&&(r.data.type=t[a].type),t[a].isRecent&&(r.data.isRecent=!0);var l=new v(r);this.profileTreeDocument.addRoot(l)}this.profileTreeDocument.pushUpdate(),t.length>0&&(this.currentProfile=t[n].name)},_getProfilesForComboBox:function(e,t){var i=[],n=[],s=[];e.map((e=>e.name));t&&(t.sort(((e,t)=>e.name>t.name?1:-1)),t.forEach((function(e){e.isRecent=!0,n.push(e)}))),e.sort(((e,t)=>e.nls>t.nls?1:-1));for(var o=0;o<e.length;o++)"UserDefined"===e[o].type?s.push(e[o]):i.push(e[o]);return n.concat(s.concat(i))},_updateToolbar:function(e=!0){if(this._dialog){var t=this._dialog.getElement(".Customize_AddRelationsSetCommand"),i=this._dialog.getElement(".Customize_RelationSet"),n=this.relationSetMenu.getItem("customize-saverelationset").elements.container,s=this._dialog.getElement(".Customize_SearchCommand");e?(s.removeClassName("disabled"),t.removeClassName("disabled"),i.removeClassName("disabled"),this.isCustomProfileSet()?(t.hide(),i.show(),this._isSaveRequired()?n.show():n.hide()):(t.show(),i.hide())):(s.addClassName("disabled"),t.addClassName("disabled"),i.addClassName("disabled"))}},updateRelationsDisplayed:function(e,t){var i=!1;Object.keys(t).length!=Object.keys(this.displayedRelations).length?i=!0:Object.keys(t).forEach(function(e){Object.keys(this.displayedRelations).indexOf(e)<0&&(i=!0)}.bind(this)),i?(this.displayedRelations=t,this.showRelations(e)):this.unloadRelations()},_updateDatagridHeader:function(e){var t,i,n=this,s=0;t=e/2,i=this.togglesHeader[t].checkFlag;let o=this.displayedTree.search({match:function(t){let o=t.nodeModel.getAttributeValue(n.datagridViewDisplayedR.layout.getDataIndexFromColumnIndex(e));if(null!=o&&s++,o===!i)return!0}}),a=this.othersRelationsTree.search({match:function(t){let o=t.nodeModel.getAttributeValue(n.datagridViewDisplayedR.layout.getDataIndexFromColumnIndex(e));if(null!=o&&s++,o===!i)return!0}});this.togglesHeader[t].checkFlag&&o.length+a.length===s?this.togglesHeader[t].checkFlag=!1:o.length+a.length>0&&(this.togglesHeader[t].checkFlag=!0)},loadingRelations:function(){this.accordionsElements.forEach((function(e){e.unselectAll()})),p.mask(this.container.getElementsByClassName("customize-bodycontent")[0])},unloadRelations:function(){this.accordionsElements.forEach((function(e){e.selectAll()})),p.unmask(this.container.getElementsByClassName("customize-bodycontent")[0])},toggleSelectionColumn:function(e,t,i){var n=this;this.othersRelationsTree.prepareUpdate(),this.othersRelationsTree.processDescendants({processNode:function(s){null!=s.nodeModel.getAttributeValue(t)&&s.nodeModel.setAttribute(t,e),n._onCheckboxClick(n.datagridViewOthersR,s.nodeModel,i,!1)}}),this.othersRelationsTree.pushUpdate(),this.displayedTree.prepareUpdate(),this.displayedTree.processDescendants({processNode:function(s){null!=s.nodeModel.getAttributeValue(t)&&s.nodeModel.setAttribute(t,e),n._onCheckboxClick(n.datagridViewDisplayedR,s.nodeModel,i,!1)}}),this.displayedTree.pushUpdate()},showDeleteConfirmationDialog:function(){if(this.modalDelete)this.modalDelete.show();else{this.modalDelete=new h({className:"modal-delete modalWarning",closable:!0,header:"<h4>"+w.get("Customize_DeleteRelationSet")+" - "+w.get("RelationSet")+"</h4>"}).inject(this.container);var t=e.createElement("div",{class:"actionButton-container"});new u({value:w.get("Customize_DeleteRelationSet"),className:"primary delete",events:{onClick:function(){this._onDeleteClick(),this.modalDelete.hide()}.bind(this)}}).inject(t),new u({value:w.get("cancel"),className:"default cancel",events:{onClick:function(){this.modalDelete.hide()}.bind(this)}}).inject(t),this.modalDelete.setFooter(t);var i=e.createElement("div",{class:"modalBody-container"});e.createElement("img",{class:"modalBody-icon",src:s.getWebappsAssetUrl("SNNavigationMap","icons/warning_icon.png")}).inject(i);var n=e.createElement("div",{class:"modalBody-text-container"}).inject(i);e.createElement("span",{class:"modalBody-question",html:w.get("Customize-DeleteQuestion")}).inject(n),e.createElement("span",{class:"modalBody-text",html:w.get("Customize-DeleteText")}).inject(n),this.modalDelete.setBody(i),this.modalDelete.show()}},alertRelationSetSaved:function(e){if(e){var t={classNameOnAlert:"CustomizeAlert",msg:'"'+e.name+'" '+w.get("Customize-SuccessfullySaved"),lvl:"success",isAlert:!0,container:this._notifContainer};o.showNotif(t),this._updateToolbar()}},alertRelationSetDeleted:function(e){if(e){var t={classNameOnAlert:"CustomizeAlert",msg:'"'+e+'" '+w.get("Customize-SuccessfullyDeleted"),lvl:"success",isAlert:!0,container:this._notifContainer};o.showNotif(t)}},_onKeyUp:function(e){this._delayTimer&&clearTimeout(this._delayTimer);var t=this;this._delayTimer=setTimeout((function(){var i;i=(e.srcElement||e.target).value,t._performSearch(i)}),500)},_onCreateClick:function(){var t=this,i=null,n=new c({className:"Customize-Relationsetmodal",animate:!0,events:{onHide:function(e){n.destroy()}}}),s={fields:[{type:"text",required:!0,pattern:"^(?!\\s*$)[^!@#$%^&*()+=\\[\\]\\\\';,./{}|\":<>?-]+(?:\\s+[^!@#$%^&*()+=\\[\\]\\\\';,./{}|\":<>?-]+)*\\s*$",value:"",placeholder:w.get("Customize_RelationSetCreation"),name:"inputval"}],events:{onSubmit:function(e){var s=!1;if((i=t.profileTreeDocument.getRoots())&&i.length)for(var o=0;o<i.length;o++)if(i[o]&&i[o].options&&i[o].options.data&&i[o].options.data.name===e.inputval&&"text"!==i[o].options.data.type){s=!0;break}s?!0===confirm(w.get("Customize-ExistingRelationSet"))&&(n.modals.current.hide(),t._createRelationSet(e.inputval)):(n.modals.current.hide(),t._createRelationSet(e.inputval))},onInvalid:function(){var e="";e=0===a.value.trim().length?w.get("InvalidName"):(e=w.get("Customize_SpecialCharErr")).concat(" !@#$%^&*()+=[]\\';,./{}|\":<>?-"),r.setContent(e)}}},o=new d(s),a=o.elements.container.getElement("input"),r=(e.createElement("p",{class:"CustomizeCreate",html:w.get("Customize_RelationSetTitle")}).inject(a,"before"),e.createElement("div",{class:"Customize-ProfileNameError",html:""}));n.dialog({body:o,title:w.get("Customize_ModalCreate"),buttons:[{className:"primary customize-newrelset-ok",value:w.get("SNNCustomize_Save"),action:function(){o.submit()}},{value:w.get("SNNCustomize_Cancel"),action:function(){n.modals.current.hide()}}]}),n.modals.current.elements.body&&n.modals.current.getBody().addContent(r),a.addEventListener("click",(function(e){this.focus()}))},_onSaveClick:function(){var e=this._getCheckedRelations(),t={};t.name=this._getSelectedProfile().options.data.name,t.relations=[];for(var n=0;n<e.length;n++)t.relations.push({name:e[n]});i.trackUsage("CustomizeRelations","ModifyCustom"),this.dispatchEvent("CustomizeAllView_SaveNewProfile",[t])},_onDeleteClick:function(){var e=[...this.profileTreeDocument.getRoots()],t=this._getSelectedProfile(),n=null,s=null,o="AutoModeProfile";if(t){(s=t!=this._previousProfile?this._previousProfile:this.profileTreeDocument.search({match:function(e){return"AutoModeProfile"===e.nodeModel.options.data.name&&!e.nodeModel.options.data.isRecent}})[0])&&(o=s.options.data.name);for(var a=0;a<e.length;a++)e[a]._options.data.name===t.options.data.name&&"text"!==e[a]._options.data.type&&(e[a]._options.data.isRecent?this.removeRecent(e[a]):this.profileTreeDocument.removeRoot(e[a]));n=t.options.data.name,this._updateProfile(o,s)}if(i.trackUsage("CustomizeRelations","DeleteCustom"),this.dispatchEvent("CustomizeAllView_DeleteProfile",[n,o]),"AutoModeProfile"===o){let e=this._getCheckedRelations();this.dispatchEvent("CustomizeAllView_UpdatePref",[e,o])}this._previousProfile.options.data.name===n&&(this._previousProfile=s)},_onCheckboxClick:function(e,t,i,n){var s="",o="",a="",r=!1,l=[];if(t&&(s=t.getAttributeValue("titleValue"),o=t.getAttributeValue("upstreamValue"),a=t.getAttributeValue("downstreamValue"),n&&l.push(i),"titleValue"===e.layout.getDataIndexFromColumnIndex(i)?(null!=o&&s!=o&&(t.setAttribute("upstreamValue",s),n&&l.indexOf(2)<0&&l.push(2)),null!=a&&s!=a&&(t.setAttribute("downstreamValue",s),n&&l.indexOf(4)<0&&l.push(4))):(r=this._needToCheckTitleValue(o,a))!=s&&(t.setAttribute("titleValue",r),n&&l.indexOf(0)<0&&l.push(0))),n)for(var c=0;c<l.length;c++)this._updateDatagridHeader(l[c]);this._updateToolbar(),this._isGlobalSaveRequired()},_performSearch:function(e){this._clearSearch(),0!==e.length&&(e=e.toLocaleLowerCase(),this._filterDatagrid(e,this.displayedTree),this.dimensialAdjustment(this.datagridViewDisplayedR),this._filterDatagrid(e,this.othersRelationsTree),this.dimensialAdjustment(this.datagridViewOthersR))},_filterDatagrid:function(e,t){t.prepareUpdate(),t.processDescendants({processNode:function(t){let i=t.nodeModel.getAttributeValue("downstreamLabel")?t.nodeModel.getAttributeValue("downstreamLabel").toLocaleLowerCase():"",n=t.nodeModel.getAttributeValue("upstreamLabel")?t.nodeModel.getAttributeValue("upstreamLabel").toLocaleLowerCase():"";e&&t.nodeModel.getLabel().toLocaleLowerCase().indexOf(e)<0&&i.indexOf(e)<0&&n.indexOf(e)<0&&t.nodeModel.hide()}}),t.pushUpdate()},_clearSearch:function(){this._removeFilterDatagrid(this.displayedTree),this.dimensialAdjustment(this.datagridViewDisplayedR),this._removeFilterDatagrid(this.othersRelationsTree),this.dimensialAdjustment(this.datagridViewOthersR)},_removeFilterDatagrid:function(e){e.prepareUpdate(),e.processDescendants({processNode:function(e){e.nodeModel.isHidden()&&e.nodeModel.show()}}),e.pushUpdate()},_getFilteredInputs:function(){},isCustomProfileSet:function(){var e=this._getSelectedProfile(),t=!1;return e&&e.options.data&&e.options.data.type&&"UserDefined"===e.options.data.type&&(t=!0),t},handleProfileChange:function(e,t){var i=this.getElement(".customize-bodycontent");if(t||void 0!==this._getSelectedProfile()){if(t){this.currentProfile=t;this.profileTreeDocument.getRoots()}else this.currentProfile=this._getSelectedProfile().options.data.name;"AutoModeProfile"===this.currentProfile?this._autoNav=!0:this._autoNav=!1,this.dispatchEvent("CustomizeAllView_UpdateRelations",[this.currentProfile]),i&&i.show(),this._updateToolbar();for(var n=0;n<this.togglesHeader.length;n++)this._updateDatagridHeader(2*n);this._isGlobalSaveRequired()}else i&&i.hide(),this._updateToolbar(!1),this.dispatchEvent("CustomizeAllView_UpdateSaveButton",{tabName:"CustomizeRelations",areThereChanges:!1})},setAutoNavMode:function(e){this._autoNav=e},_getProfileModel:function(e){if(this.profileTreeDocument)for(var t=this.profileTreeDocument.getAllDescendants(),i=0;t.length;i++)if(t[i].options.data.name===e)return t[i]},_createNewProfile:function(e){for(var t=!0,n=this.profileTreeDocument.getRoots(),s=null,o=0;o<n.length;o++)n[o].options.data.name===e.name&&"text"!==n[o].options.data.type&&(t=!1);var a=this._getRecentSize();t&&(s=new v({label:e.name,icons:[{iconName:"user"}],data:{type:"UserDefined",name:e.name,selectable:!0}}),this.profileTreeDocument.addRoot(s,a)),i.trackUsage("CustomizeRelations","NewCustom"),this.dispatchEvent("CustomizeAllView_CreateNewProfile",[e]),this._updateProfile(e.name,s)},_getSelectedProfile:function(){var e=this.profileTreeDocument.getSelectedNodes()[0];if(e)return e},addRecent:function(){var e=this._getSelectedProfile(),t=this.getRecents(),i=!1;if(t.length>0)for(var n=t.length-1;n>-1;){if(e.options.data.name===t[n].options.data.name){i=!0;break}n--}i||(t.unshift(new v({label:e.getLabel(),icons:[{iconName:"clock"}],data:{type:e.options.data.type,name:e.options.data.name,selectable:!0,isRecent:!0}})),this.profileTreeDocument.prepareUpdate(),t.length>this.RECENTLIMIT&&(t.splice(this.RECENTLIMIT,1),this.profileTreeDocument.removeRoot(this.RECENTLIMIT-1)),this.profileTreeDocument.addRoot(t[0],0),this.profileTreeDocument.pushUpdate(),this.dispatchEvent("CustomizeAllView_SetRecentRelationSet",[t]))},removeRecent:function(e){var t=[];e._options.data.isRecent&&(this.profileTreeDocument.removeRoot(e),t=this.getRecents(),this.dispatchEvent("CustomizeAllView_SetRecentRelationSet",[t]))},getRecents:function(){for(var e=this.profileTreeDocument.getRoots(),t=[],i=0;i<e.length;i++)e[i]._options.data&&e[i]._options.data.isRecent&&t.push(e[i]);return t},_getRecentSize:function(){for(var e=this.profileTreeDocument.getRoots(),t=0,i=0;i<e.length;i++)e[i]._options.data&&e[i]._options.data.isRecent&&t++;return t},_createRelationSet:function(e){var t=this._getCheckedRelations(),i={};i.name=e,i.relations=[];for(var n=0;n<t.length;n++)i.relations.push({name:t[n]});i.type="UserDefined",this._createNewProfile(i)},_getCheckedRelations:function(){var e=this._getAllRelations(),t=[];return e.forEach((function(e){e.getAttributeValue("upstreamValue")&&t.push(e.getAttributeValue("upstreamType")),e.getAttributeValue("downstreamValue")&&t.push(e.getAttributeValue("downstreamType"))})),t},_getAllRelations:function(){var e=[];e=this.displayedTree.getAllDescendants();let t=this.othersRelationsTree.getAllDescendants();return e=[...e,...t]},_getSavedRelationsForCustomProfile:function(e){for(var t=n.getPref("_ENORIPE_CustomRelationsSet"),i=[],s=[],o=0;o<t.length;o++)if(t[o].name===e){i=t[o].relations;break}for(var a=0;a<i.length;a++)i[a].name&&s.push(i[a].name);return s},_getSavedRelationsForProfile:function(){var e=[];return Object.values(this.currentRelations).forEach((function(t){let i=0;if(t[i])for(;t[i];)!0===t[i].value&&e.push(t[i].id),i++})),e},_getSavedRelationsForCurrentProfile:function(e,t){return e?this._getSavedRelationsForCustomProfile(t):this._getSavedRelationsForProfile()},_getCurrentRelations:function(){var e=[];return Object.values(this.currentRelations).forEach((function(t){let i=0;if(t[i])for(;t[i];)e.push(t[i].id),i++})),e},_needToCheckTitleValue:function(e,t){return void 0===e?t:void 0===t?e:!(!e&&!t)||!(!e&&!t)&&void 0},save:function(){var e=this._getCheckedRelations(),t=!0,s={},o=null,a={upstream:!0,downstream:!0};a=n.getPref("expandedDirection")?n.getPref("expandedDirection"):a,s=this._getCurrentRelations(),e.length===s.length&&e.every(((e,t)=>s.includes(e)))&&(t=!1),t&&i.trackUsage("CustomizeRelations","RelationsChange"),this.togglesHeader[1].checkFlag?(a.upstream||(a.upstream=!0,n.setPrefLocally("expandedDirection",a)),i.trackUsage("CustomizeRelations","Upstream-Displayed")):(a.upstream&&(a.upstream=!1,n.setPrefLocally("expandedDirection",a)),i.trackUsage("CustomizeRelations","Upstream-Hidden")),this.togglesHeader[2].checkFlag?(a.downstream||(a.downstream=!0,n.setPrefLocally("expandedDirection",a)),i.trackUsage("CustomizeRelations","Downstream-Displayed")):(a.downstream&&(a.downstream=!1,n.setPrefLocally("expandedDirection",a)),i.trackUsage("CustomizeRelations","Downstream-Hidden")),this.addRecent(),this._previousProfile=this._getSelectedProfile(),this.dispatchEvent("CustomizeAllView_UpdatePref",[e,this._previousProfile.options.data.name]),(o=this._dialog.getElement(".Customize_SearchCommand")).hasClassName("pressed")&&(this._autocompleteInput.elements.clear.click(),o.click())},cancel:function(){this._updateProfile(this._previousProfile.options.data.name,this._previousProfile)},_updateProfile:function(e,t){if(t||(t=this.profileTreeDocument.search({match:function(t){return t.nodeModel.options.data.name===e&&!t.nodeModel.options.data.isRecent}})[0]),t&&t!=this._profileAutoComplete.selectedItems)return this._profileAutoComplete.selectedItems=t,this.handleProfileChange(null,e),t},updateProfile:function(e,t){(t=this._updateProfile(e,t))&&(this._previousProfile=t)},isProfileAutoCompleteEmpty:function(){return void 0===this._getSelectedProfile()},_isGlobalSaveRequired:function(){var e=!1,t=!1,i=!0,n=this._getCheckedRelations(),s=this._getSavedRelationsForCurrentProfile();this._previousProfile&&this.currentProfile!=this._previousProfile.options.data.name&&(t=!0),n.length===s.length&&n.every(((e,t)=>s.includes(e)))&&(i=!1),(t||i)&&(e=!0),this.dispatchEvent("CustomizeAllView_UpdateSaveButton",{tabName:"CustomizeRelations",areThereChanges:e})},_translateRelations:function(e){return this._groupRelations?this._translateAndGroupRelations(e):this._translateAndFlatten(e)},_translateAndGroupRelations:function(e){return e.v6&&(e=e.v6),e},_translateAndFlatten:function(e){for(var t in e)if(e.hasOwnProperty(t))for(var i=0;i<e[t].length;i++);return e},_isSaveRequired:function(){var e=this.isCustomProfileSet(),t=this._getCheckedRelations(),i=this._getSelectedProfile().options.data.name,n=!0;if(e){var s=this._getSavedRelationsForCurrentProfile(e,i);t.length===s.length&&t.every(((e,t)=>s.includes(e)))&&(n=!1)}return n},_getDirection:function(e){var t=e.split("_"),i="";return"to"===t[t.length-1]?i="downstream":"from"===t[t.length-1]&&(i="upstream"),i},destroyCurrentDialog:function(){this.relationSetMenu.hide(),this._dialog=null,this.hide()},dimensialAdjustment:function(e){var t=e.elements.container.getParent(),i=e.getContent().getElement(".wux-layouts-gridengine-poolcontainer-rel").getBoundingClientRect().height;0!=i&&t.setStyle("height",i+this.MARGINACCORDION)},resizeDatagrid:function(){this.dimensialAdjustment(this.datagridViewDisplayedR),this.dimensialAdjustment(this.datagridViewOthersR)}})})),define("DS/SNNavigationMap/views/elements/RoundedRect",["UWA/Class","UWA/Core","DS/WebappsUtils/WebappsUtils","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/CommonUtils","DS/UIKIT/DropdownMenu","DS/Utilities/DateUtils","DS/i3DXCompassPlatformServices/OpenWith","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/SNNavigationMap/utils/SNNavigationServices","UWA/Class/Events","DS/Controls/TooltipModel"],(function(e,t,i,n,s,o,a,r,l,c,d,h){"use strict";return e.extend(d,{name:"Rounded-Rect",STRLIMIT:20,NODEWIDTH:170,THUMBNAILHEIGHT:n.getNodesHeight(),PADDINGTOPINSTANCELIST:5,svgNS:null,mainContainer:null,_UncheckedIcon:i.getWebappsAssetUrl("SNNavigationMap","icons/16/MultiSel_Unchecked.png"),_CheckedIcon:i.getWebappsAssetUrl("SNNavigationMap","icons/16/MultiSel_Checked.png"),init:function(e){this._selector=e,this.svgNS={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"}},createNode:function(e){var i=this;if(e.isGhost)return this.createGhost(e);this.mainContainer=t.extendElement(document.createElementNS(this.svgNS.svg,"g"));var o,a,r,l=t.extendElement(document.createElementNS(this.svgNS.svg,"g")),d=(t.extendElement(document.createElementNS(this.svgNS.svg,"title")),t.extendElement(document.createElementNS(this.svgNS.svg,"rect"))),h=t.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject")),u=null,g=null,p=null,f=null,m=null,v=t.extendElement(document.createElementNS(this.svgNS.svg,"text")),_=null;if(a=(r=!1!==n.getThumbnailsMode()&&!!e.preview_url)?90:25,e.preview_url&&((f=t.extendElement(document.createElementNS(this.svgNS.svg,"image"))).setAttributeNS(this.svgNS.xlink,"href",e.preview_url),f.setAttributes({class:"thumbnail-image",x:10,y:10,height:110,width:150})),e.type_icon_url&&((m=t.extendElement(document.createElementNS(this.svgNS.svg,"image"))).setAttributeNS(this.svgNS.xlink,"href",e.type_icon_url),m.setAttributes({x:r?5:20,y:a,height:16,width:16,class:"map-type-icon"})),d.setAttributes({class:"background",width:i.NODEWIDTH,height:r?this.THUMBNAILHEIGHT:n.getNodesHeight()}),(g=t.extendElement(document.createElementNS(this.svgNS.svg,"rect"))).setAttributes({class:"small-rect",x:5,y:85,height:42,width:160}),(u=t.extendElement(document.createElementNS(this.svgNS.svg,"rect"))).setAttributes({class:"thumbnail-background",x:5,y:5,width:160,height:r?120:55}),this.mainContainer.setAttribute("data-height",n.getNodesHeight()),h.setAttributes({x:0,y:0,class:"drag-shape-container",width:i.NODEWIDTH,height:r?this.THUMBNAILHEIGHT:n.getNodesHeight()}),p=t.createElement("div",{class:"drag-shape",draggable:"true","data-id":e.id}),h.setContent(p),this.setDragEvents(p,e),this.layoutingOn&&p.setStyle("display","none"),o=this._createMultiSelIcon(e),e.preview_url&&t.extendElement(document.createElementNS(this.svgNS.xhtml,"img")).setAttributes({src:e.preview_url}),v.setAttributes({class:"node-text","data-name":e.name,x:r?25:40,y:a}),this.mainContainer.setAttributes({class:"node"+(e.focus?" focus":"")+(e.preview_url?"":" no-thumbnail"),id:"container-"+e.id,"data-id":e.id}),l.setAttributes({class:"nodeReference",id:"referenceContainer-"+e.id,"data-id":e.id}),e.nlsObj){let t=s.getAttributes(e.type||"AllTypes");v.setContent(this.wrapText(s.getTitleLabel(e.nlsObj,t.attrs.slice(0,3)),r)),this.updateToolTip(this.mainContainer,e,e.id)}else v.setContent(this.wrapText(e.name,r));return l.setContent([d,u,f,g,m,v,h,o]),this.mainContainer.setContent([l]),_=c.isWebInWin()?"":this._createForeignObject(e,this.mainContainer),this.mainContainer.addContent([_]),this._addInstancesList(this.mainContainer,e),e.nlsObj||i.dispatchEvent("ENORIPE_GetNlsAttrInfo",e.id),this.mainContainer},createGhost:function(e){var i=t.extendElement(document.createElementNS(this.svgNS.svg,"g")),n=t.extendElement(document.createElementNS(this.svgNS.svg,"g")),s=t.extendElement(document.createElementNS(this.svgNS.svg,"text")),o=t.extendElement(document.createElementNS(this.svgNS.svg,"rect")),a=null;return(a=t.extendElement(document.createElementNS(this.svgNS.svg,"image"))).setAttributeNS(this.svgNS.xlink,"href",e.type_icon_url),a.setAttributes({x:25,y:25,height:16,width:16,class:"ghost-icon"}),o.setAttributes({class:"ghostBackground",width:this.NODEWIDTH,height:65}),s.setAttributes({class:"node-text","data-name":e.name,x:50,y:38}),s.setContent(e.name),i.setAttributes({class:"node ghost"+(e.focus?" focus":""),id:"container-"+e.id,"data-id":e.id,"data-height":65}),n.setAttributes({class:"nodeReference",id:"referenceContainer-"+e.id,"data-id":e.id}),n.setContent([o,a,s]),i.setContent([n]),i},createThumbnail:function(e,i){if(e&&i&&!e.getElement(".thumbnail-image")){var n=e.getElement(".thumbnail-background"),s=t.extendElement(document.createElementNS(this.svgNS.svg,"image"));s.setAttributeNS(this.svgNS.xlink,"href",i),s.setAttributes({class:"thumbnail-image",x:10,y:10,height:110,width:150}).inject(n,"after")}},_createInstanceText:function(e,i,n,s){var o,a=this,r=this._trim(i.name),c="instance-text";this._trim(i.name)||(r=l.get("noTitle"),c+=" noTitle"),o=t.createElement("span",{class:c,id:"instance-"+i.id,text:r,events:{click:function(e){e.stopPropagation(),"chrome"===t.Utils.Client.Engine.name&&e&&e.detail&&"true"===e.detail.isCustom||a._toggleInstance(s,this,n.id)}}}),e.appendChild(o),i.nlsObj&&this.updateToolTip(o,i,i.id)},_createForeignObject:function(e,i){var s,o=this,a=t.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject"));return s=!1!==n.getThumbnailsMode()&&!!i.getElement(".thumbnail-image"),a.setAttributes({class:"foreign-object-count-mobile",x:130,y:s?95:35,height:40,width:40}),a.setContent(t.createElement("span",{class:"fonticon-2x fonticon fonticon-chevron-down",events:{click:function(n){"chrome"===t.Utils.Client.Engine.name?"true"===n.detail.isCustom&&(o.dropDownMenu&&o.dropDownMenu.options.target===this?(o.dropDownMenu.destroy(),o.dropDownMenu=null):o._showDropDownContextualMenu(e,i)):o.dropDownMenu&&o.dropDownMenu.options.target===this?(o.dropDownMenu.destroy(),o.dropDownMenu=null):o._showDropDownContextualMenu(e,i)},touchstart:function(t){o.dropDownMenu&&o.dropDownMenu.options.target===this?(o.dropDownMenu.destroy(),o.dropDownMenu=null):o._showDropDownContextualMenu(e,i)}}})),a.addEvent("click",(function(e){e.stopPropagation()})),i.addEventListener("contextmenu",(function(t){o._showDropDownContextualMenu(e,i)})),a},_createMultiSelIcon:function(e){var i=t.extendElement(document.createElementNS(this.svgNS.svg,"image")),n=!0===e.focus?this._CheckedIcon:this._UncheckedIcon;return i.setAttributeNS(this.svgNS.xlink,"href",n),i.setAttributes({class:"multiSel-mapView-icon","data-id":e.id,"data-checked":e.focus||!1,x:149,y:5,width:16,height:16}),i},_getLongHelp:function(e,t){var i="",n="";if(e)for(var s=0;s<t.length;s++)if(void 0!==(n=e[t[s].uri])){var o=t[s].label;"ds6w:modified"!==t[s].uri&&"ds6w:created"!==t[s].uri||""===n||(n=a.formatDateToString(new Date(n),{timePrecision:"sec"})),i=i+o+" : "+n+"\n"}return i},_showDropDownContextualMenu:function(e,t){var i=this,n=200,a=t.getElement(".foreign-object-count-mobile"),c={target:a.firstChild,renderTo:a,position:"bottom left",events:{onHide:function(){i.dropDownMenu.destroy(),i.dropDownMenu=null,a.setAttributes({height:40,width:40})},onShow:function(){this.items&&this.items.length>0&&(n=45*this.items.length+50),a.setAttributes({height:n||200,width:1e3})}},items:[{text:l.get("previewUpAndDownstream"),fonticon:"eye",handler:function(){i.dispatchEvent("ENORIPE_ShowPreview",{model:e.identifierData})}}]};e.type&&e.type.contains("Document")&&c.items.push({id:e.id,name:e.name,text:l.get("Download"),fonticon:"download",handler:function(t){t.stopPropagation(),i.dispatchEvent("ENORIPE_downloadDocument",[e.id,e.name])}}),this.dropDownMenu&&(this.dropDownMenu.destroy(),this.dropDownMenu=null),this.dropDownMenu=new o(c),this.dropDownMenu.inject(a),this.dropDownMenu.items&&this.dropDownMenu.items.length>0&&(n=45*this.dropDownMenu.items.length+50),a.setAttributes({height:n||200,width:200});const d=[e],h=s.get3DXContent(d);(new r).set3DXContent(h,!0).render(this.dropDownMenu);this.dispatchEvent("ENORIPE_movetofront",t),this.dispatchEvent("ENORIPE_movetofront",a),setTimeout(function(){this.dropDownMenu.show()}.bind(this),50)},updateLabel:function(e,t){var i,o=t.ids[0],a=t.attrs.slice(0,3),r=s.getTitleLabel(t.nlsObj[o],a);i=!1!==n.getThumbnailsMode()&&!!e.getElement(".thumbnail-image"),e.getElement(".node-text").setContent(this.wrapText(r,i))},updateToolTip:function(e,t){if(e&&t){let i=s.getAttributes(t.type||"AllTypes");e.tooltipInfos=new h({shortHelp:s.getTitleLabel(t.nlsObj,i.attrs.slice(0,3)),longHelp:this._getLongHelp(t.nlsObj,i.attributes)})}},updateListInstancesSize:function(e,t){var i=e.getElement("#toggleMoreInstance"),n=e.getElement(".instance-list-g");0!=(t=parseInt(t))&&(t=23*(i?n.getElements(".instance-text").length+1:n.getElements(".instance-text").length)+10),e.getElement(".instance-expander-g").style.transform="translateY("+t+"px)",e.getElement(".foreign-object-instances").setAttribute("height",t),e.getElement(".rect-list-instance").setAttribute("height",t)},toggleListInstances:function(e,t){var i=e.getElement(".instance-list-g");(t=void 0!==t?t:!i.classList.contains("expand"))&&!i.classList.contains("expand")?(i.classList.add("expand"),e.getElement(".foreign-object-expand .fonticon").className="fonticon fonticon-expand-up",this.updateListInstancesSize(e)):!t&&i.classList.contains("expand")&&(i.classList.remove("expand"),e.getElement(".foreign-object-expand .fonticon").className="fonticon fonticon-expand-down",this.updateListInstancesSize(e,0))},removeSelectedInstance:function(e,t){var i=e.getElement(".instance-text.select");if(i){var n=i.id.replace("instance-","");i.classList.remove("select"),this.dispatchEvent("ENORIPE_toggleInstance",{nodeId:t,selected:null,instanceId:n})}},_addInstancesList:function(e,i){if(i.instances){var s,o=this,a=Math.min(i.instances.length,n.getOption("showInstancesLimit")),r=t.extendElement(document.createElementNS(this.svgNS.svg,"g"));r.setAttribute("class","instance-expander-g"),r.addEvent("click",function(t){t.stopPropagation(),t.detail&&!t.detail.isCustom&&(this.dispatchEvent("ENORIPE_clickListInstance",[t.currentTarget.parentNode.getAttribute("data-id")]),this.toggleListInstances(e))}.bind(this)),r.tooltipInfos=new h({shortHelp:l.get("expander-help")});var c=t.extendElement(document.createElementNS(this.svgNS.svg,"rect"));s=!1!==n.getThumbnailsMode()&&!!i.preview_url,c.setAttributes({width:45,height:15,class:"rect-bkg-instance",y:n.getNodesHeight(),x:65}),c.inject(r);var d=t.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject"));d.inject(r),d.setAttributes({class:"foreign-object-expand",x:80,y:s?129:64,height:40,width:40}),d.setContent(t.createElement("span",{class:"fonticon-1x fonticon fonticon-expand-down "}));var u,g=t.extendElement(document.createElementNS(this.svgNS.svg,"g"));g.setAttributes({class:"instance-list-g"}),(u=t.extendElement(document.createElementNS(this.svgNS.svg,"rect"))).setAttributes({class:"rect-list-instance",y:s?this.THUMBNAILHEIGHT:68,width:o.NODEWIDTH,height:0}),u.inject(g);var p=t.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject"));p.inject(g),p.setAttributes({class:"foreign-object-instances",y:s?this.THUMBNAILHEIGHT+this.PADDINGTOPINSTANCELIST:68+this.PADDINGTOPINSTANCELIST,x:-2,height:0,width:o.NODEWIDTH});for(var f=0;f<a;f++)this._createInstanceText(p,i.instances[f],i,g);i.instances.length-a>0&&p.appendChild(t.createElement("span",{class:"toggle-more-instance",id:"toggleMoreInstance",text:"+"+(i.instances.length-a),events:{click:function(n){if(n.stopPropagation(),"chrome"!==t.Utils.Client.Engine.name||!n||!n.detail||"true"!==n.detail.isCustom){for(var s=p.getElements(".instance-text").length;s<i.instances.length;s++)o._createInstanceText(p,i.instances[s],i,g);this.hide(),o.updateListInstancesSize(e),o.dispatchEvent("ENORIPE_clickMoreInstance",[i.id,i.instances])}}}})),r.inject(e),g.inject(e),this.toggleListInstances(e,n.getInstancesMode())}},updateInstancesList:function(e,i){var s=Math.min(i.instances.length,n.getOption("showInstancesLimit")),o=e.getElements(".instance-list-g")[0],a=[],r=!1,l=this;if(o){var c=o.getElements(".foreign-object-instances")[0];if((a=o.getElements(".instance-text")).length<=i.instances.length&&i.instancesExpanded>=0&&i.instancesExpanded<i.instances.length){for(var d=0;d<s;d++)0===o.getElements("#instance-"+i.instances[d].id).length&&(this._createInstanceText(c,i.instances[d],i,o),r=!0);if(i.instances.length-s>0){var h=c.getElement("#toggleMoreInstance");if(h){h.show(),h.innerHTML="+"+(i.instances.length-s);let t=c.getChildren();for(let e=s+1;e<t.length;e++)t[e].remove();l.updateListInstancesSize(e)}else c.appendChild(t.createElement("span",{class:"toggle-more-instance",id:"toggleMoreInstance",text:"+"+(i.instances.length-s),events:{click:function(n){if(n.stopPropagation(),"chrome"!==t.Utils.Client.Engine.name||!n||!n.detail||"true"!==n.detail.isCustom){for(var s=c.getElements(".instance-text").length;s<i.instances.length;s++)l._createInstanceText(c,i.instances[s],i,o);this.remove(),l.updateListInstancesSize(e),l.dispatchEvent("ENORIPE_clickMoreInstance",[i.id,i.instances])}}}}))}}else{if(i.instances&&i.instances.length>0)for(d=0;d<a.length;d++){let e=a[d].id.replace("instance-","");i.instances.map((e=>e.id)).includes(e)||(a[d].remove(),r=!0)}0!==(a=o.getElements(".instance-text")).length&&i.instances&&0!==i.instances.length||(o.remove(),e.getElement(".instance-expander-g").remove(),o=null)}o&&o.classList.contains("expand")&&r&&this.updateListInstancesSize(e)}else this._addInstancesList(e,i)},_toggleInstance:function(e,t,i){var n=!0,s=t.id.replace("instance-",""),o=e.getElement(".instance-text.select");o&&o!=t&&o.classList.remove("select"),t.classList.contains("select")?(n=!1,t.classList.remove("select")):t.classList.add("select"),this.dispatchEvent("ENORIPE_toggleInstance",{nodeId:i,selected:n,instanceId:s})},_trim:function(e){if(e)return e.length>this.STRLIMIT?e.slice(0,this.STRLIMIT)+"...":e},wrapText:function(e,i){var n,s=[],o=0,a=document.createElement("canvas").getContext("2d");a.font="14px Arial";const r=(e,i,n)=>{var s=t.extendElement(document.createElementNS(this.svgNS.svg,"tspan"));return s.setAttributes({x:i,dy:n}),s.setContent(e),s};n=160-(i?26:50);for(var l=0,c=o;c<e.length&&l<=n&&!((l=a.measureText(e.substring(o,c+1)).width)>n);)c++;if(s.push(r(e.substring(o,c),i?26:40,10)),(o=c)<e.length){n=120;var d=e.substring(o);if(a.measureText(d).width>n){d="";for(var h=o;h<e.length&&a.measureText(d+e[h]+"...").width<=n;)d+=e[h],h++;h<e.length&&(d+="...")}s.push(r(d,i?10:13,20))}return s},setDragEvents:function(e,t){var i=this;e.addEventListener("mousedown",(function(e){e.stopPropagation()})),e.addEventListener("dragstart",(function(e){e.stopPropagation();const n=i.getSelectedItems(t);let o=s.get3DXContent(n);i.dispatchEvent("ENORIPE_dragElement",[e,o])}))},getFeedbackReorder:function(e){var i;return this._reorderFeedback||(this._reorderFeedback=t.extendElement(document.createElementNS(this.svgNS.svg,"rect"))),i="top"===e?-10:"thumbnailsMode"===n.getThumbnailsMode()?this.THUMBNAILHEIGHT:65,this._reorderFeedback.setAttributes({y:i,id:"reorder-feedback",width:"170px",height:"10px"}),this._reorderFeedback},getSelectedItems:function(e){var t=[],i=!1;return this._selector.getSelectedItemsForDragAndDrop().forEach((function(n){n.get("id")===e.id&&(i=!0),t.push(n._attributes)})),!1===i&&t.push(e),t},showColor:function(e,i){var s;if(s="thumbnailsMode"===n.getThumbnailsMode(),e){var o=e.getElements(".small-rect")[1]||e.getElement(".drag-shape-container");o?t.extendElement(document.createElementNS(this.svgNS.svg,"rect")).setAttributes({class:"colored-rect-bi",fill:i,x:5,y:5,width:5,height:s?80:55}).inject(o,"after"):(o=e.closest(".instance-list-g"))&&t.extendElement(document.createElementNS(this.svgNS.svg,"rect")).setAttributes({class:"colored-rect-instance",fill:i,x:5,y:s?135:72,width:5,height:25}).inject(o)}}})})),define("DS/SNNavigationMap/views/SplittedDropView",["UWA/Core","UWA/Class/View","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/SNNavigationMap/utils/SNNavigationServices"],(function(e,t,i,n){"use strict";return t.extend({name:"SDV-drop",_zonesCounter:{add:0,replace:0},className:function(){return this.getClassNames("-container")},setup:function(){this._openIconAndLabelHTML=e.createElement("div",{class:"drop-zone",html:[{tag:"span",class:"fonticon fonticon-open fonticon-3x"},{tag:"p",html:i.get("dropZoneOpenContent")}]}),this._addIconAndLabelHTML=e.createElement("div",{class:"drop-zone",html:[{tag:"span",class:"fonticon fonticon-plus fonticon-3x"},{tag:"p",html:i.get("dropAddContent")}]}),this._addContentDiv=e.createElement("div",{class:"global-drop-zone add-content"}),this._addIconAndLabelHTML.inject(this._addContentDiv),this._replaceContentDiv=e.createElement("div",{class:"global-drop-zone replace-content",html:{tag:"div",class:"drop-zone",html:[{tag:"span",class:"fonticon fonticon-replace fonticon-3x"},{tag:"p",html:i.get("dropReplaceContent")}]}}),this._addContentDiv.addEventListener("dragenter",this._onDragEnter.bind(this)),this._addContentDiv.addEventListener("dragleave",this._dragleave.bind(this)),this._addContentDiv.addEventListener("drop",this._onDrop.bind(this)),this._replaceContentDiv.addEventListener("dragenter",this._onDragEnter.bind(this)),this._replaceContentDiv.addEventListener("dragleave",this._dragleave.bind(this)),this._replaceContentDiv.addEventListener("drop",this._onDrop.bind(this)),this.container.addEventListener("dragover",this._onDragOver),this.container.setContent(this._replaceContentDiv,this._addContentDiv),this.container.hide()},show:function(e,t){"none"===this.container.getStyle("display")&&(this.container.setStyle("width",e+"px"),"extract"===sessionStorage.getItem("ENORIPE_currentDrag")||!0===t?(this._addContentDiv.addClassName("full"),this._addContentDiv.innerHTML=this._openIconAndLabelHTML.outerHTML,this._replaceContentDiv.hide()):(this._addContentDiv.innerHTML=this._addIconAndLabelHTML.outerHTML,this._addContentDiv.removeClassName("full"),this._replaceContentDiv.show())),this.container.show()},hide:function(){this.container.getElements(".current-dragover").forEach((function(e){e.removeClassName("current-dragover")})),this.container.hide(),this._zonesCounter.add=0,this._zonesCounter.replace=0,this.dispatchEvent("ENORIPE_SDV_hide",[])},_onDragOver:function(e){e.stopPropagation(),e.preventDefault()},_onDragEnter:function(e){var t=e.currentTarget;e.stopPropagation(),e.preventDefault(),t.hasClassName("add-content")?this._zonesCounter.add++:this._zonesCounter.replace++,t.addClassName("current-dragover")},_dragleave:function(e){var t,i=e.currentTarget;e.stopPropagation(),e.preventDefault(),i.hasClassName("add-content")?(this._zonesCounter.add--,t=this._zonesCounter.add):(this._zonesCounter.replace--,t=this._zonesCounter.replace),0===t&&(i.removeClassName("current-dragover"),this.container.getElement(".current-dragover")||this.hide())},_onDrop:function(t){t.stopPropagation(),t.preventDefault(),this.hide();for(var i,s,o,a=e.is(t.dataTransfer.types.indexOf,"function")?"indexOf":"contains",r="",l=["text/searchitems","text/plain","Text"],c=t.currentTarget.hasClassName("add-content")?"add":"replace",d=0;d<l.length&&""===r;d++)o=t.dataTransfer.types[a](l[d]),(e.is(o,"number")&&o>=0||e.is(o,"boolean")&&!0===o)&&(r=l[d]);""===r?n.sendToMapWebInWin("RefreshOnDrop",[],c)||this.dispatchEvent("ENORIPE_dropNotSupported"):((s=t.dataTransfer.getData(r)).length&&(i=JSON.parse(s),c&&"add"===c&&i.action&&(c=i.action)),this.dispatchEvent("ENORIPE_drop",[c,i]),sessionStorage.removeItem("ENORIPE_currentDrag"))},updateHeight:function(e,t){t&&this.container.setStyle("width",t),this._addContentDiv.setStyle("height",e+"px"),this._replaceContentDiv.setStyle("height",e+"px")},_getFreeZoneWidth:function(){var e=document.querySelector(".list-view-container"),t=null,i=null;if(e&&!e.isHidden()&&(t=e.querySelector("div.wux-windows-docking-element-free-zone.wux-docking-element-right")),t){if(i=t.getStyle("width"))return parseFloat(i.substring(0,i.length-2))}else{var n=document.getElementById("svg-root").getStyle("width");if(n)return parseFloat(n.substring(0,n.length-2))-50}return window.innerWidth}})})),define("DS/SNNavigationMap/views/elements/ExpandMenu",["UWA/Class/View","UWA/Core","UWA/Class/Events","DS/WebappsUtils/WebappsUtils","DS/Controls/TooltipModel","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","DS/UIKIT/Spinner","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n,s,o,a,r,l){"use strict";return e.extend(i,{name:"ExpandMenu",direction:"",nodeData:{},roundedRectContainer:null,isCollapse:!1,toggleEcosystemContainer:null,counts:[],nodeWidth:0,nodeHeight:0,setup:function(e,t,i,n){switch(this.svgNS={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},this.setMenuData({direction:e,nodeData:t,roundedRectContainer:i,isCollapse:!1}),this.nodeWidth=o.getNodesWidth(),this.nodeHeight=o.getNodesHeight(),n){default:case 0:this.setBubble(0);break;case 1:this.showExpandMenu();break;case 2:this.setCollapseMenu()}},setMenuData:function(e){e.direction&&(this.direction=e.direction),e.nodeData&&(this.nodeData=e.nodeData),e.roundedRectContainer&&(this.roundedRectContainer=e.roundedRectContainer),e.isCollapse&&(this.isCollapse=e.isCollapse),this.nodeData&&this.direction&&(this.counts=this.nodeData.counts.getRealCounts(this.direction))},setBubble:function(e){var i,n=this,s=0,r=0,l=0;"out"===this.direction&&(r=this.nodeWidth),i=o.getNodesHeight()/2,this.toggleEcosystemContainer=t.extendElement(document.createElementNS(this.svgNS.svg,"g")),this.toggleEcosystemContainer.setAttributes({class:"expandMenuDirection-"+this.direction,id:"toggleEcosystem",style:"transform:translate("+r+"px,"+(i-30)+"px)"}),this.toggleEcosystemContainer.inject(this.roundedRectContainer),this.expandMenu=t.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject")),this.expandMenu.setAttributes({class:"foreignObjectExpandMenu",x:"in"===this.direction?-190:0,y:0}),this.expandMenu.inject(this.toggleEcosystemContainer);var c=t.extendElement(document.createElementNS(this.svgNS.svg,"g"));c.setAttributes({class:"expandBubble"}),c.inject(this.toggleEcosystemContainer);var d=t.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject"));d.setAttributes({class:"foreignObjectCircleExpand",x:8,y:8,width:30,height:30}),d.inject(c),t.createElement("div",{class:"circleExpand"}).inject(d);var h=t.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject"));h.inject(c),h.setAttributes({class:"foreignObjectFonticon",x:-20,y:20,height:40,width:40});var u=t.extendElement(document.createElementNS(this.svgNS.svg,"circle"));switch(u.setAttributes({class:"loadingExpander",cx:"0",cy:"32.5",r:"13"}),u.inject(c),this.createLoaderGif().inject(this.toggleEcosystemContainer),e){default:case 0:this.showWaiting();break;case 1:this.toggleEcosystemContainer.addEventListener("mouseenter",function(e){e.touchFlag||this.showExpandedMenu()}.bind(this)),this.toggleEcosystemContainer.addEventListener("mouseleave",this.hideExpandedMenu.bind(this)),h.setContent(t.createElement("span",{class:"fonticon fonticon-plus"})),c.addEventListener("click",function(e){e.stopPropagation(),e&&e.detail&&!e.detail.isCustom&&(this.splitCount(),a.trackUsage("Expand","OneDirectionCtx"))}.bind(this)),c.addEventListener("touchstart",(function(e){e.stopPropagation(),e.preventDefault(),s=(new Date).getTime(),l=setTimeout((function(){n.showExpandedMenu(e)}),1e3)})),c.addEventListener("touchend",(function(e){e.stopPropagation(),e.preventDefault();var t=(new Date).getTime()-s;t?(t<1e3&&n.splitCount(),clearTimeout(l)):n.splitCount(),a.trackUsage("Expand","OneDirectionCtx")}));break;case 2:h.setContent(t.createElement("span",{class:"fonticon fonticon-minus"})),c.addEventListener("click",function(e){e.stopPropagation(),e&&e.detail&&!e.detail.isCustom&&(this.dispatchEvent("ENORIPE_Collapse",[this.nodeData.id,this.direction]),a.trackUsage("Collapse","OneDirectionCtx"))}.bind(this))}},setExpandMenu:function(e){this.toggleEcosystemContainer&&(this.toggleEcosystemContainer.remove(),this.toggleEcosystemContainer=null),this.setMenuData({nodeData:e,isCollapse:!1}),this.showExpandMenu()},setCollapseMenu:function(){this.destroy(),this.setBubble(2),this.setMenuData({isCollapse:!0})},showExpandMenu:function(){var e,i=this;this.setBubble(1),e=this.calculateExpandNumber();var n=t.extendElement(document.createElementNS(this.svgNS.svg,"g"));n.inject(this.toggleEcosystemContainer),n.setAttributes({class:"expandNumberContainer"});var o=t.extendElement(document.createElementNS(this.svgNS.svg,"rect"));o.inject(n);var r=t.extendElement(document.createElementNS(this.svgNS.svg,"text"));r.inject(n);var c=t.extendElement(document.createElementNS(this.svgNS.svg,"tspan"));c.inject(r),c.setAttributes({class:"expandNumberText",dy:13,x:-3}),c.setContent(e);var d=c.getBBox();o.setAttributes({class:"expandNumberBackground",x:-4,y:0,width:d.width+2,height:17}),n.setContent([o,r]),this.expandMenuContainer=t.createElement("div",{class:"expandMenuContainer"}).inject(this.expandMenu);var h=t.createElement("div",{class:"expandMenuContents"}).inject(this.expandMenuContainer),u=e;u+=e>1?" "+l.get("objects"):" "+l.get("object");t.createElement("span",{class:"objectsNumber",text:u}).inject(h);for(var g=t.createElement("ul",{class:"expandMenuList"}).inject(h),p=0;p<this.counts.length;p++)this.nodeData.counts.getCountsNumber([this.counts[p]])>0&&(t.createElement("li",{id:this.counts[p].get("id"),"data-relation":this.counts[p].get("name"),html:"<a>"+this.counts[p].get("count")+" "+this.getNlsRelationValue(this.counts[p].get("name"))+"</a>",events:{click:function(e){e.stopPropagation(),e.detail&&!e.detail.isCustom&&(console.log(this),i.splitCount([this.dataset.relation]),a.trackUsage("Expand","OneRelationCtx"))}}}).inject(g).tooltipInfos=new s({longHelp:this.getNlsRelationValue(this.counts[p].get("name"))}));t.createElement("a",{class:"previewLink",text:l.get("PreviewAll"),events:{click:function(e){e.detail&&!e.detail.isCustom&&this.dispatchEvent("ENORIPE_ShowPreview",{model:this.nodeData.identifierData,direction:this.direction})}.bind(this)}}).inject(h)},showExpandedMenu:function(){var e=0;this.toggleEcosystemContainer&&!this.toggleEcosystemContainer.classList.contains("expanded")&&(this.toggleEcosystemContainer.classList.add("expanded"),this.dispatchEvent("ENORIPE_movetofront",this.roundedRectContainer),e=-15*this.counts.length,this.expandMenu.setAttributes({y:e,width:190,height:300}))},hideExpandedMenu:function(){this.toggleEcosystemContainer&&this.toggleEcosystemContainer.classList.contains("expanded")&&(this.toggleEcosystemContainer.classList.remove("expanded"),this.expandMenu.setAttributes({y:0,width:0,height:0}))},calculateExpandNumber:function(){var e=0;return this.counts&&this.counts.forEach((t=>{e+=this.nodeData.counts.getCountsNumber([t])})),e},getNlsRelationValue:function(e){return l[e+"_short"]||l[e]||e},splitCount:function(e){if(!this.isLoading()){if(this.showLoading(),!e){e=[];for(var t=0;t<this.counts.length;t++)e.push(this.counts[t].get("name"))}e.length>0?this.dispatchEvent("ENORIPE_splitCount",[[this.nodeData.id],e,this.direction]):this.hideLoading()}},showLoading:function(){this.isLoading()||this.toggleEcosystemContainer.classList.add("is-loading")},hideLoading:function(){this.isLoading()&&this.toggleEcosystemContainer.classList.remove("is-loading")},showWaiting:function(){this.isWaiting()||this.toggleEcosystemContainer.classList.add("is-waiting")},hideWaiting:function(){this.isWaiting()&&this.toggleEcosystemContainer.classList.remove("is-waiting")},isLoading:function(){return this.toggleEcosystemContainer.classList.contains("is-loading")},isWaiting:function(){return this.toggleEcosystemContainer.classList.contains("is-wainting")},createLoaderGif:function(){var e=t.extendElement(document.createElementNS(this.svgNS.svg,"image"));return e.setAttributeNS(this.svgNS.xlink,"href",n.getWebappsAssetUrl("SNNavigationMap","icons/ui/uikit-loader.gif")),e.setAttributes({x:-15,y:17,height:30,width:30,class:"loader-icon"}),e},destroy:function(){this.toggleEcosystemContainer&&(this.toggleEcosystemContainer.remove(),this.toggleEcosystemContainer=null),this.container=null}})})),define("DS/SNNavigationMap/collections/NavigationCollection",["UWA/Core","UWA/Class/Collection","DS/SNNavigationMap/utils/SearchUtils","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/models/CountOnNode","DS/WAFData/WAFData","DS/WebappsUtils/WebappsUtils","UWA/Promise","DS/PlatformAPI/PlatformAPI","DS/SNNavigationMap/utils/CommonUtils","DS/SNNavigationMap/utils/ProbesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n,s,o,a,r,l,c,d,h){"use strict";return t.extend({updateColumnId:!1,instancesMatch:{},currentModelId:0,_noLinkedNodesIds:[],_requests:[],setup:function(e,t){this.add(e),this._layoutUtils=t.layoutUtils,this._widgetId=t.widgetId||null,this._savedColumns=t.savedColumns||{},this._debug=t.debugMode||!1},parse:function(e){var t,i=[],o=this,r=[],l={},u={objects:[],links:[]},g=0;try{e=JSON.parse(e)}catch(e){}return e.objectsAndLinksBySteps||(e.objectsAndLinksBySteps=[e]),e.unindexedObjects&&e.unindexedObjects.length>0&&this.dispatchEvent("ENORIPE_someObjectsNotIndex",[e.objects.length,e.unindexedObjects]),e.objectsAndLinksBySteps.forEach((function(e){e.objects.forEach((function(e){if(e.id&&(e.name||e.isGhost)){if(!o.get(e.id)&&i.map((e=>e.id)).indexOf(e.id)<0){var d=o._savedColumns||{};if(e.modelType="node",e.level=g,i.push(e),t=void 0,"Person"===e.type){var p=e["ds6w:identifier"];p&&(t=c.getUser3DSwymPictureURL(p))}e.serviceId||(e.serviceId="3DSpace"),t&&(e.preview_url=t,e.type_icon_url=t),e.isGhost&&(e.name=h.get("GhostName"),e["ds6w:label"]=h.get("GhostName"),e.type_icon_url=a.getWebappsAssetUrl("SNNavigationMap","icons/ghost_icon.png")),0===o.length&&(e.columnID=d[e.id]||0,o._savedColumns[e.id]=e.columnID),e.counts=new s({source:e.id}),r=e.instances?e.instances:[],e.identifierData={},n.getOption("attributesForItems").forEach((function(t){e[t]&&(e.identifierData[t]=e[t])})),l=e}else e.instances&&((l=o.get(e.id)?o.get(e.id)._attributes:i[i.map((e=>e.id)).indexOf(e.id)]).instances&&l.instances.length>0?(r=e.instances.filter((({id:e})=>!l.instances.some((({id:t})=>t===e)))),l.instances=[...l.instances,...r]):(r=e.instances,l.instances=e.instances),r.length>0&&(l.instancesNeedUpdate=!0,i.push(l)));if(r&&r.length>0){l=o.setIdentifierDataInstance(r,l);for(var f=0;f<r.length;f++)o.instancesMatch[r[f].id]=l.id;l.counts&&l.counts.setRequestDone(!1)}}else e.id||!e.serviceId||o.get(e["ds6w:i3dx"])||"3DSpace"==e.serviceId||u.objects.push(e)})),u.objects.length>0?o.fedSearch(u.objects,{csl_links:e.csl_links}):e.csl_links&&(e.links=[...c.manageCSLLinks(e.csl_links,i,o),...e.links]),e.links.forEach((function(e){var t=[];if(null!=e.uniqueId&&(t=o.where({uniqueId:e.uniqueId})),0===t.length&&!e.isReflexive){let t=!1;t=i.some((function(t){return null!=t.uniqueId&&t.uniqueId===e.uniqueId})),t||(e.modelType="link","in"===e.direction&&(e=c.switchRelationsDirection(e)),i.push(e))}}))})),d.setProbesAfterParsing(i,this),g++,i},parseExtResp:function(e,t){var i,n,s={};return n={ids:(i=JSON.parse(t.data)).physicalid,attrs:i.select_predicate},c._processData(n,e).then((function(e){return e.nlsObj&&Object.keys(e.nlsObj).length>0?(s={objects:Object.values(e.nlsObj),links:[]},t.dataForParsing&&t.dataForParsing.csl_links&&(s.csl_links=t.dataForParsing.csl_links),s):{}}))},setColumnIds:function(e){this._savedColumns=e},fullImport:function(e){var t=this,i={widgetIdTo:n.getWidgetId(),timeout:n.getTimeout(),label:n.getLabelAPI()};e&&(i.widgetIdFrom=e);let s=this._models.filter((e=>"link"===e._attributes.modelType)).map((e=>e._attributes.uniqueId));d.setStartTime("fullImport"),this.fetch({url:n.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/fullImport?tenant="+n.getCurrentTenantName(),data:JSON.stringify(i),remove:!1,timeout:n.getTimeout(),onComplete:function(e,i){e._models.filter((e=>"link"===e._attributes.modelType)).map((e=>e._attributes.uniqueId)).some((e=>!s.includes(e)))||t.dispatchEvent("ENORIPE_noObjectToAdded"),t._prepareNodesAndLinks(e)}})},getFocusedNode:function(){return 1===this.length?this._models[0]:this.findWhere({focus:!0})},getEcoSystem:function(e){if(e.items){this.currentModelId=e.id,this._isBusy();var t={widgetId:e.widgetId?e.widgetId:n.getWidgetId(),label:n.getLabelAPI(),lang:n.getLang(),direction:"both",restrictedMode:!!e.restrictedMode&&e.restrictedMode,responseMode:e.responseMode?e.responseMode:"ObjectsAndLinks",items:e.items};return!e.direction||"in"!==e.direction&&"out"!==e.direction||(t.direction=e.direction),e.relations&&e.relations.length>0&&(t.relations=e.relations),n.is3DSpaceIUExistingAndTenantAllowed()&&(n.getActivateOptimizedIndexNavigation()||n.getRedirectQueryToSGI())&&(t.redirectQueryToSGI=!0),d.setStartTime("getecosystem",Date.now()),n.setOption("ecosystemNoOfObjects",e.items.length),new r(function(i){this.fetch({url:n.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/getEcosystem?tenant="+n.getCurrentTenantName(),data:JSON.stringify(t),remove:!1,timeout:n.getTimeout(),onComplete:function(){this._prepareNodesAndLinks(this),i()}.bind(this),onFailure:function(t){console.log(t),that.dispatchEvent("ENORIPE_handleErrorMsgs",[e]),reject(t)},onTimeout:function(e){console.log(e),reject(e)}})}.bind(this))}that.dispatchEvent("ENORIPE_handleErrorMsgs",[e])},fetchV2:function(e){var t,i=this,s={},o={attrs:[]};for(var a in s=n.getDefaultAttributes())o.attrs=[...o.attrs,...Array.from(new Set(s[a].attributes.map((function(e){return e.uri}))))];return o.attrs=[...o.attrs,...n.getFetchAttributes()],o.attrs=[...new Set(o.attrs)],(e={...e,...o}).attrs&&e.attrs.includes("ds6w:reserved")&&!e.attrs.includes("ds6w:reservedBy")&&e.attrs.push("ds6w:reservedBy"),t={widgetId:n.getWidgetId(),label:n.getLabelAPI(),physicalid:e.ids,select_predicate:e.attrs,unescape_slashes_in_attribute_values:!0},new r(function(s){this.fetch({url:n.get3DSpaceUrl()+"/cvservlet/fetch/v2?tenant="+n.getCurrentTenantName(),data:JSON.stringify(t),itemsId:e.ids,remove:!1,timeout:n.getTimeout(),onComplete:function(e){i._prepareNodesAndLinks(e)}.bind(this),onFailure:function(e){console.log(e),i.dispatchEvent("ENORIPE_handleErrorMsgs",[options]),reject(e)},onTimeout:function(e){console.log(e),reject(e)}})}.bind(this))},fedSearch:function(e,t){var s,o,a=this,l={},c={attrs:[]};for(var d in l=n.getDefaultAttributes())c.attrs=[...c.attrs,...Array.from(new Set(l[d].attributes.map((function(e){return e.uri}))))];return c.attrs=[...c.attrs,...n.getFedSearchAttributes()],c.attrs=[...new Set(c.attrs)],o=Array.from(new Set(e.map((e=>e.serviceId)))),s={label:i._getSearchLabel(),query:i._getQueryFromItems(e),select_predicate:c.attrs,tenant:n.getCurrentTenantName(),with_synthesis_attribute:!1,with_synthesis:!1,list_source:o},new r(function(i){this.fetch({url:n.get3DSearchUrl()+"/search",data:JSON.stringify(s),dataForParsing:t,itemsId:e.map((e=>e.id)),remove:!1,timeout:n.getTimeout(),onComplete:function(e){a._prepareNodesAndLinks(e)}.bind(this),onFailure:function(e){console.log(e),a.dispatchEvent("ENORIPE_handleErrorMsgs",[options]),reject(e)},onTimeout:function(e){console.log(e),reject(e)}})}.bind(this))},getNotSelectedNodes:function(){return this.filter((function(e){return"node"===e.get("modelType")&&!0!==e.get("focus")}))},removeNodes:function(e){var t=this,i=[];return new r(function(n){(i=this.getRemovedObject(e))&&(i.removedObjectsId.forEach(function(e){this.remove(e)}.bind(this)),Object.keys(i.removedInstances).forEach(function(e){if(this.get(e)){let t=this.get(e).get("instances").filter((t=>!i.removedInstances[e].includes(t.id))),n=this.get(e).get("identifierData");n.instances=t,this.get(e).set("identifierData",n),this.get(e).set("instances",t),this.get(e).set("instancesNeedUpdate",!0),0===t.length&&this.get(e).unset("instancesExpanded")}}.bind(this)),t._setColumnBasedOnLayout(),n())}.bind(this))},getRemovedObject:function(e){for(var t=this,i={},n=[],s=[],o=[],a=[],r=[],l=0;l<e.length;l++){for(var c=this.filter((function(n){if("link"===n.get("modelType")){if(n.get("source")===e[l]._attributes&&n.get("instanceTargetId")&&n.get("target").instances&&n.get("target").instances.map((e=>e.id)).includes(n.get("instanceTargetId"))){let e=t.getAllModelLinks(n.get("target"),n.get("instanceTargetId")),s=t.where({modelType:"link",sourceId:n.get("source").id,instanceTargetId:n.get("instanceTargetId")});e.length===s.length&&(i[n.get("target").id]?i[n.get("target").id].push(n.get("instanceTargetId")):i[n.get("target").id]=[n.get("instanceTargetId")])}return n.get("target")===e[l]._attributes||n.get("source")===e[l]._attributes}return!1})),d=0;d<c.length;d++)-1===s.indexOf(c[d].id)&&s.push(c[d].id);o=o.concat(c),n.push(e[l].id),e[l]&&e[l]._attributes&&e[l]._attributes.instances&&e[l]._attributes.instances.forEach((function(e){-1===n.indexOf(e.id)&&n.push(e.id)}))}return a=(a=a.concat(e)).concat(o),{removedObjectsId:r=(r=r.concat(n)).concat(s),removedNodesId:n,removedLinksId:s,removedObjects:a,removedInstances:i}},_isBusy:function(){var e=!1,t=[];return this._requests.forEach((function(i){4!==i.xhr.readyState&&(e=!0,t.push(i))})),this._requests=t,e},_prepareNodesAndLinks:function(t){this.trackServices();var i=t.filter((function(t){var i=t._attributes;return"link"===i.modelType&&(e.is(i.source,"string")||e.is(i.target,"string"))}));t.where({modelType:"node"});i.forEach((function(e){(t.get(e.get("source"))?e.set("source",t.get(e.get("source"))._attributes):t.instancesMatch[e.get("source")]&&e.set("source",t.get(t.instancesMatch[e.get("source")])._attributes),e.set("sourceId",e.get("source").id),t.get(e.get("target"))?e.set("target",t.get(e.get("target"))._attributes):t.instancesMatch[e.get("target")]&&(e._attributes.target.id?e.set("instanceTargetId",e._attributes.target.id):e.set("instanceTargetId",e._attributes.target),e.set("target",t.get(t.instancesMatch[e.get("target")])._attributes)),e.set("targetId",e.get("target").id),!0!==e.get("instancelink"))&&t.where({source:e.get("source"),target:e.get("target"),"ro.xcadbasedependency.v_cadlinktype":e.get("ro.xcadbasedependency.v_cadlinktype")}).forEach((function(t){t.id!==e.id&&t.get("type")===e.get("type")&&t.set("instancelink",!0)}))})),t._setColumnOnNodes(),t.dispatchEvent("ENORIPE_updateProxy")},_setRowBasedOnLayout:function(){var e,t={},i=null;t=this.groupBy("columnID"),e=Object.keys(t).sort((function(e,t){return e-t}));for(var n=0;n<e.length;n++){i=t[e[n]].sort(this._sortRow.bind(this));for(var s=0;s<i.length;s++)void 0===i[s].get("rowID")&&i[s].set("rowID",s)}},_setColumnBasedOnLayout:function(e){this._layoutUtils._dagre.layout(this._layoutUtils._graphObject);for(var t,i={},n=null,s=null,o=this._layoutUtils._graphObject.nodes(),a=0;a<o.length;a++)(n=this.get(o[a]))&&(n.set("xColumn",this._layoutUtils._graphObject.node(o[a]).x),n.set("yColumn",this._layoutUtils._graphObject.node(o[a]).y));for(delete(i=this.groupBy("xColumn"))[void 0],t=Object.keys(i).sort((function(e,t){return e-t})),a=0;a<t.length;a++){s=i[t[a]].sort((function(e,t){return e.get("yColumn")-t.get("yColumn")}));for(var r=0;r<s.length;r++)s[r].set("columnID",a),this._savedColumns[s[r].id]=a,e&&s[r].set("rowID",r)}},_setColumnOnNodes:function(){this._layoutUtils.setData(this.getLinksAndNodes()),"recompute"!==n.getLayoutMode()&&!0!==this.updateColumnId||(this._setColumnBasedOnLayout("recompute"===n.getLayoutMode()),this.updateColumnId=!1);for(var t=this.groupBy("level"),i=0;i<Object.keys(t).length;i++)if(!isNaN(parseInt(Object.keys(t)[i]))){var s=this,o=t[Object.keys(t)[i]].filter((function(e){return"node"===e.get("modelType")&&void 0===e.get("columnID")})),a=0,r=[],l=[],c=0,d=[],h=[],u=(e.is(this._savedColumns,"string")?JSON.parse(this._savedColumns):this._savedColumns)||{};for(var g in u)s.get(g)&&this.isLinked(s.get(g)._attributes)>0&&this._noLinkedNodesIds.indexOf(g)>-1&&(this._noLinkedNodesIds.splice(this._noLinkedNodesIds.indexOf(g),1),o.unshift(s.get(g)));for(var p=0;p<o.length;p++){if(r=s.where({target:o[p]._attributes}),l=s.where({source:o[p]._attributes}),c=r.length+l.length,r.length){for(var f=0;f<r.length;f++)Number.isInteger(r[f].get("source").columnID)&&(((a=this._noLinkedNodesIds.indexOf(r[f].get("source").id))<0||1===c)&&(void 0!==s.get(r[f].get("source").id)?d.push(s.get(r[f].get("source").id)):void 0!==s.get(r[f].get("source"))&&d.push(s.get(r[f].get("source")))),a>-1&&this._noLinkedNodesIds.splice(a,1));d.length>0&&o[p].set("columnID",Math.max.apply(Math,d.map((function(e){return e.get("columnID")})))+1)}if(l.length){for(i=0;i<l.length;i++)Number.isInteger(l[i].get("target").columnID)&&(((a=this._noLinkedNodesIds.indexOf(l[i].get("target").id))<0||1===c)&&(void 0!==s.get(l[i].get("target").id)?h.push(s.get(l[i].get("target").id)):void 0!==s.get(l[i].get("target"))&&d.push(s.get(l[i].get("target")))),a>-1&&this._noLinkedNodesIds.splice(a,1));h.length>0&&o[p].set("columnID",Math.min.apply(Math,h.map((function(e){return e.get("columnID")})))-1)}o[p].get("columnID")||o[p].set("columnID",0),u[o[p].get("id")]=o[p].get("columnID"),r=[],l=[],d=[],h=[],delete o[p]._attributes.level}var m=Object.keys(u).length>0?Math.min.apply(Math,Object.values(u)):0;for(var v in u){for(;Object.values(u).indexOf(u[v]-1)<0&&u[v]!=m;)Object.keys(u).filter((function(e){s.get(e)&&s.get(e).get("columnID")>=u[v]&&(u[e]--,s.get(e).set("columnID",u[e]))}));if(s.get(v)){let e=this._noLinkedNodesIds.indexOf(v);0===this.isLinked(s.get(v)._attributes)&&e<0&&this._noLinkedNodesIds.push(v)}}this._savedColumns=u,"recompute"!=n.getLayoutMode()&&this._setRowBasedOnLayout(),this.dispatchEvent("ENORIPE_setSavedColumnIds",["ENORIPE_savedColumnIds",u])}},filterOrphanNodes:function(e){var t=this,i=t.filter((function(e){return"node"===e.get("modelType")})),s=[],o=[],a=[],r=[];a=n.getRootIds();for(var l=0;l<i.length;l++)s=t.where({target:i[l]._attributes}),o=t.where({source:i[l]._attributes}),0===s.length&&0===o.length&&(a&&a.indexOf(i[l].id)<0||e)&&(t.remove(i[l],{silent:!0}),r.push(i[l].id));return r},reset:function(e){if(this._savedColumns={},e)for(var t=0;t<e.length;t++)e[t].id&&e[t].columnID>-1&&(this._savedColumns[e[t].id]=e[t].columnID);return this._noLinkedNodesIds=[],this._parent(e)},remove:function(e){return e.id||(e=this.get(e)),e&&(Object.keys(this._savedColumns).indexOf(e.id)>-1&&delete this._savedColumns[e.id],this._noLinkedNodesIds.indexOf(e.id)>0&&this._noLinkedNodesIds.splice(this._noLinkedNodesIds.indexOf(e.id),1)),this._parent(e)},sync:function(t,i,s){var a=this;try{s=JSON.parse(s)}catch(e){}this._debug&&(e.is(s.data,"string")&&(s.data=JSON.parse(s.data)),s.data.debug=!0,s.data=JSON.stringify(s.data));try{switch(t){case"read":var r=o.authenticatedRequest(s.url,{headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:n.getXPrefCredential()},method:"POST",data:s.data,timeout:s.timeout,onComplete:function(e){var t={};try{t=JSON.parse(e)}catch(e){}if(t.objectsAndLinksBySteps||t.objects)s.onComplete(e);else if(t.infos.nresults>0)a.parseExtResp(e,s).then((function(e){s.onComplete(JSON.stringify(e))}));else{let e=s.itemsId?s.itemsId:[];a.dispatchEvent("ENORIPE_someObjectsNotIndex",[0,e]),a.resetServiceTracker()}},onFailure:function(e){console.log(e);a.dispatchEvent("ENORIPE_handleErrorMsgs",[{type:"generic"}]),a.resetServiceTracker()},onTimeout:function(e){console.log(e);a.dispatchEvent("ENORIPE_handleErrorMsgs",[{type:"generic"}]),a.resetServiceTracker()}});break;case"create":case"update":case"patch":case"delete":break;default:throw new Error('Unsupported method "{0}"'.format(t))}this._requests.push(r)}catch(e){e.message}return{cancel:function(){}}},isLinked:function(e,t){var i=0,n=this.getAllModelLinks(e)||[];return 0!=n.length&&t?n.forEach((function(e){e.get("instanceTargetId")===t&&i++})):i=n.length,i},getModelsAttrs:function(e){if(e)return this.where({modelType:e}).invoke("toJSON");this.toJSON()},getLinksAndNodes:function(){var e=[],t=[];return this.filter((function(i){"node"===i.get("modelType")?e.push(i._attributes):"link"===i.get("modelType")&&t.push(i._attributes)})),{nodes:e,links:t}},getIdentifierDataById:function(e){var t=[],i={};if((t=e?this.filter((function(t){return"node"===t.get("modelType")&&e.indexOf(t.get("id"))>-1})):this.where({modelType:"node"})).length>0)for(var n=0;n<t.length;n++)i[t[n].id]=t[n].get("identifierData");return i},getNodesIds:function(){return this.getLinksAndNodes().nodes.map((function(e){return e.id}))},getLinksIds:function(){return this.getLinksAndNodes().links.map((function(e){return e.id}))},getNodeFromInstance:function(e){return this.find((function(t){if("node"===t.get("modelType")&&t.get("instances")&&t.get("instances").length>0){if(t.get("instances").find((t=>t.id===e)))return t}}))},getInstanceAttributes:function(e){var t={};return this.every((function(i){if("node"===i.get("modelType")&&i.get("instances")&&i.get("instances").length>0){let n=i.get("instances").find((t=>t.id===e));if(n)return t=n,!1}return!0})),t},setIdentifierDataInstance:function(e,t){for(var i=0;e&&i<e.length;i++){let s={};n.getOption("attributesForItems").forEach((function(t){e[i][t]&&(s[t]=e[i][t])})),t.identifierData.instances||(t.identifierData.instances=[]),t.identifierData.instances.push(s)}return t},setNlsObj:function(e,t,i){let n;var s=this.get(e);return s&&t&&(s.set("nlsObj",t),n=t),i&&this.every((function(i){if("node"===i.get("modelType")&&i.get("instances")&&i.get("instances").length>0){let s=i.get("instances").find((t=>t.id===e));if(s)return s.nlsObj=t,n=t,!1}return!0})),n},trackServices:function(){d.getStartTime("getecosystem")&&d.trackPerformance("getecosystem","getecosystem",{NumberOfObjects:n.getOption("ecosystemNoOfObjects")}),d.getStartTime("fullImport")&&d.trackPerformance("fullImport","fullImport",{NumberOfObjects:n.getOption("fullImportNoOfObjects")})},resetServiceTracker:function(){d.stopTime("getecosystem")},_sortRow:function(e,t){var i=0;if("node"===e.get("modelType")&&"node"===t.get("modelType")){if(null!=e.get("rowID"))return-1;if(null!=t.get("rowID"))return 1;if(0===(i=this._groupByLinkType(e,t))){let i=c.getAttributes(e.get("type")).attrs.slice(0,3),n=c.getTitleLabel(e._attributes,i),s=c.getTitleLabel(t._attributes,i);return n.localeCompare(s)}}return i},_groupByLinkType:function(e,t){var i=this.getAllModelLinks(e),n=this.getAllModelLinks(t);if(i.length>0&&n.length>0){let e=c.getRelationLinkNls(i[0]._attributes),t=c.getRelationLinkNls(n[0]._attributes);return e.localeCompare(t)}return-1},addModel:function(e,t){this.add(e),t&&t.external&&!t.silent&&(this._prepareNodesAndLinks(this),t.callback&&"function"==typeof t.callback&&t.callback(this))},getAllModelLinks:function(e,t){var i,n,s=[],o={},a={};return o={modelType:"link",sourceId:e.id},a={modelType:"link",targetId:e.id},t&&(o.instanceTargetId=t,a.instanceTargetId=t),i=this.where(o),n=this.where(a),(s=[...i,...n]).sort((function(e,t){let i=c.getRelationLinkNls(e._attributes),n=c.getRelationLinkNls(t._attributes);return i.localeCompare(n)})),s}})})),define("DS/SNNavigationMap/views/NavigationHomePage",["UWA/Core","UWA/Class/View","DS/SNNavigationMap/utils/CommonUtils","DS/SNNavigationMap/utils/ProbesUtils","DS/Utilities/DateUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/TransientWidget/TransientWidget","DS/WebappsUtils/WebappsUtils","DS/Handlebars/Handlebars4","DS/ENOXTriptych/js/ENOXTriptych","DS/TreeModel/TreeNodeModel","DS/UIKIT/DropdownMenu","DS/UIKIT/Mask","DS/CollectionView/ResponsiveTilesCollectionView","DS/SNNavigationMap/utils/SNNavigationServices","text!DS/SNNavigationMap/assets/templates/homepageleft.html","text!DS/SNNavigationMap/assets/templates/homepageright.html"],(function(e,t,i,n,s,o,a,r,l,c,d,h,u,g,p,f,m){"use strict";return t.extend({name:"navigationapp-homepage-view",models:[],_nameLabel:null,_detailLabel1:null,_detailLabel2:null,currentTab:null,_thumbnailIcon:r.getWebappsAssetUrl("SNNavigationMap","icons/I_RelatedObjectsFavoriteThumbnail.png"),_smallIcon:r.getWebappsAssetUrl("SNNavigationMap","icons/I_RelatedObjectsFavorite22.png"),className:function(){return this.getClassNames("-container")},setup:function(t){this._debug=t.debugMode,this._widgetId=t.widgetId||null,this._isWebInWin=t.isWebInWin,this._nameLabel=t.nameLabel,this._detailLabel1=t.detailLabel1,this._detailLabel2=t.detailLabel2,this._separator=t.separator,this._tenantId=t.platformId,this._leftWidth=270,this.tempDropZone=!1;var i=l.compile(f),n={header1:o.get("NavHomePage-Header1"),header2:o.get("NavHomePage-Header2"),quickAccess:o.get("NavHomePage-QuickAccess"),favorite:o.get("NavHomePage-Favorite"),recents:o.get("NavHomePage-Recents")},s=l.compile(m),a={header:o.get("NavHomePage-Recents")},r=i.call(null,n),d=s.call(null,a),h=e.createElement("div",{class:"ENORIPE-leftside-container",html:r}),u=e.createElement("div",{class:"ENORipe-rightside-container",html:d}),g=e.createElement("div",{class:"ENORipe-rightside-container-ignore",html:""}),p={left:{originalState:"open",overMobile:!0,minWidth:this._leftWidth,originalSize:this._leftWidth},borderLeft:!0,container:this.container,withtransition:!0,withoverflowhidden:!0};this._triptych=new c,this._triptych.init(p,h,u,g),this._setUpEvents()},render:function(){this.container.show();var e=this.getElement("#ENORipe-Favorite"),t=this.getElement("#ENORipe-Recents");this.changeTab(e,t),n.trackUsage("HomePage","OnHomepage")},showObjects:function(t){var n,s,o,a=null,l="",c="",h="",u=[];this.clearContent();try{if(Object.keys(t).length>0){this.responsiveTiles=this._getResponsiveTile({isDraggable:!0});for(var g=0;g<Object.keys(t).length;g++){if((a=Object.values(t)[g]).id=Object.keys(t)[g],l=this._getLabels(a,this._nameLabel),c=this._getLabels(a,this._detailLabel1),h=this._getLabels(a,this._detailLabel2),o=void 0,"Person"===a["ds6w:type"]){var p=a["ds6w:identifier"];p&&(o=i.getUser3DSwymPictureURL(p))}o?a.type_icon_url=o:o=a.preview_url?a.preview_url:r.getWebappsAssetUrl("SNNavigationMap","icons/thumbnailLargeDefault.png"),a.preview_url=o,s=new d({label:l,icons:[a.type_icon_url],subLabel:c,description:h,thumbnail:o,contextualMenu:"A",data:{id:a.id,type:a.type,element:a,name:a.name}}),u.push(s)}this.responsiveTiles.model=u,n=e.createElement("div",{class:"list-tiles-container"}).inject(this.getElement("#ENORipe-Recents-Container"));var f=window.innerHeight-47+"px";n.setStyle("height",f),this.responsiveTiles.getContent().inject(n)}else this.showDropInvite(this.getElement("#ENORipe-Recents-Container"))}catch(e){console.log(e),this.unmask()}this.unmask()},showFavorites:function(t){var i,n,a=null,r=null,l="",c="",h="",u=[],g={};try{if(this.clearContent(),t.favorite&&t.favorite.length>0){this.responsiveTiles=this._getResponsiveTile({isDraggable:!0}),t.favorite=t.favorite.sort((function(e,t){return new Date(t.modified)-new Date(e.modified)}));for(var p=0;p<t.favorite.length;p++)(r=t.favorite[p]).type="ENORelationalExplorerFavorite",l=r.title,a=s.formatDateToString(new Date(r.modified),{timePrecision:"sec"}),c=r.owner+" | "+a,h=o.get(r.profilename),g={label:l,icons:[this._smallIcon],subLabel:c,description:h,thumbnail:this._thumbnailIcon,contextualMenu:"A",data:{id:r.id,name:r.favoriteName,element:r,type:"ENORelationalExplorerFavorite",title:r.title,layoutType:r.layoutType||"linearGraph"}},r.rootIds&&(g.data.rootIds=r.rootIds),n=new d(g),u.push(n);this.responsiveTiles.model=u,i=e.createElement("div",{class:"list-tiles-container"}).inject(this.getElement("#ENORipe-Recents-Container"));var f=window.innerHeight-47+"px";i.setStyle("height",f),this.responsiveTiles.getContent().inject(i)}else this.showEmptyView("Favorite")}catch(e){console.log(e),this.unmask()}this.unmask()},changeTab:function(e,t){if(e&&e.id){this.getElements(".ENORipe-ActionContainer .selected").forEach((function(e){e&&e.removeClassName&&e.removeClassName("selected")})),e.addClassName("selected");var i=o.get("NavHomePage-Recents");e.id.contains("Favorite")?(i=o.get("NavHomePage-Favorite"),this.currentTab="Favorite",t?this.dispatchEvent("ENORIPE_HandleFavorite",t):this.dispatchEvent("ENORIPE_HandleFavorite")):e.id.contains("Recents")&&(i=o.get("NavHomePage-Recents"),this.currentTab="Recents",this.dispatchEvent("ENORIPE_HandleRecents")),this.getElement(".ENORipe-rightside-headertext").innerHTML=i}},mask:function(){u.mask(this.container)},unmask:function(){u.unmask(this.container)},showEmptyView:function(t){var i,n="",s="";switch(this.clearContent(),i=e.createElement("div",{class:"empty-container"}).inject(this.getElement("#ENORipe-Recents-Container")),t){default:case"Recents":s="fonticon-clock",n=o.get("NoRecentFound");break;case"Favorite":s="fonticon-favorite-on",n=o.get("NoFavoriteFound")}e.createElement("span",{class:"empty-view-icon center-block fonticon "+s+" fonticon-5x"}).inject(i),e.createElement("span",{class:"empty-view-title center-block",html:n}).inject(i),this.unmask()},getSelectedItems:function(e){let t=[];t.push(e);const i=this.responsiveTiles.TreedocModel.getSelectedNodes();return i&&i.length>0&&i.forEach((function(i){i._options.data.id!==e.id&&t.push(i._options.data.element)})),t},showDropInvite:function(t){this._dropInviteContainer=e.createElement("div",{class:"SDV-drop-container"}).inject(t),e.createElement("div",{class:"drop-invite",html:[{tag:"span",class:"wux-ui-3ds wux-ui-3ds-3x wux-ui-3ds-drag-drop"},{tag:"p",class:"drop-content-here",html:o.get("dropHere")}]}).inject(this._dropInviteContainer),this._addContentDiv=e.createElement("div",{class:"drop-zone add-content",html:{tag:"div",class:"dropzonemsg-container",html:[{tag:"span",class:"fonticon fonticon-open fonticon-3x"},{tag:"p",html:o.get("dropZoneOpenContent")}]}}).inject(this._dropInviteContainer).hide(),this._dropInviteContainer.addEventListener("dragenter",this._onDragEnter.bind(this)),this._addContentDiv.addEventListener("dragleave",this._onDragLeave.bind(this)),this._addContentDiv.addEventListener("drop",this._onDrop.bind(this)),this.getElement(".dropzonemsg-container").addEventListener("dragleave",(function(e){e.stopPropagation(),e.preventDefault()}))},hideDropInvite:function(){this._dropInviteContainer&&this._dropInviteContainer.hide()},removeDropInvite:function(){this._dropInviteContainer&&this._dropInviteContainer.parentNode.removeChild(this._dropInviteContainer)},_onDragEnter:function(e){e.stopPropagation(),e.preventDefault(),this._addContentDiv.show(),this._dropInviteContainer.addClassName("current-dragover")},_onDragLeave:function(e){e.stopPropagation(),e.preventDefault(),this._addContentDiv.hide(),this._dropInviteContainer.removeClassName("current-dragover"),!0===this.tempDropZone&&this.removeDropInvite(),this.tempDropZone=!1},_onDragOver:function(e){e.stopPropagation(),e.preventDefault()},_onDrop:function(t){t.stopPropagation(),t.preventDefault(),this._dropInviteContainer.removeClassName("current-dragover");for(var i,n,s,o=e.is(t.dataTransfer.types.indexOf,"function")?"indexOf":"contains",a="",r=["text/searchitems","text/plain","Text"],l="replace",c=0;c<r.length&&""===a;c++)s=t.dataTransfer.types[o](r[c]),(e.is(s,"number")&&s>=0||e.is(s,"boolean")&&!0===s)&&(a=r[c]);if(""===a){if(!p.sendToMapWebInWin("RefreshOnDrop",[],l))return this.dispatchEvent("ENORIPE_dropNotSupported"),void this._addContentDiv.hide();this.hideDropInvite(),this.hide(),this.clearContent()}else(n=t.dataTransfer.getData(a)).length&&(i=JSON.parse(n)),this.hideDropInvite(),this.hide(),this.clearContent(),this.dispatchEvent("ENORIPE_drop",[l,i]);this._addContentDiv.hide()},_onDragStart:function(e,t){const n=this.getSelectedItems(t.cellModel._options.data.element);let s=i.get3DXContent(n);try{e.dataTransfer.setData("text/searchitems",JSON.stringify(s)),e.dataTransfer.setData("text",JSON.stringify(s))}catch(t){console.log(t),e.dataTransfer.setData("text",JSON.stringify(s))}a.closeWidget()},_getSelectedNodes:function(){var e=[];return this.responsiveTiles&&this.responsiveTiles.TreedocModel&&(e=this.responsiveTiles.TreedocModel.getSelectedNodes()),e=e.map((function(e){return e._options.data.element}))},_getResponsiveTile:function(e){var t=this,i={height:"inherit",displayTitleTooltip:!0,displayPropertiesTooltip:!0,displayedOptionalCellProperties:["description","contextualMenu"],useDragAndDrop:e.isDraggable};e.isDraggable&&(i.onDragStartCell=this._onDragStart.bind(this));var n=new g(i);return(n=new g(i)).selectionBehavior={toggle:!0,unselectAllOnEmptyArea:!0,canMultiSelect:"Favorite"!==this.currentTab,canInteractiveMultiselectWithCheckboxClick:"Favorite"!==this.currentTab,enableShiftSelection:"Favorite"!==this.currentTab,enableFeedbackForActiveCell:!1},n.onContextualEvent={callback:function(e){var i=[];return e&&e.cellInfos&&i.push({type:"PushItem",title:o.get("open"),icon:"open",action:{callback:function(i){if("Recents"===t.currentTab){var n=t._getSelectedNodes()||[];n&&t._openRelExp(n)}else if("Favorite"===t.currentTab){var s=e.cellInfos.cellModel._options.data;s&&t._openRelExp([s])}}}}),i}},n.onCellDoubleClick((function(e){var i=e.cellModel._options.data;t._openRelExp([i])})),n},_openRelExp:function(e){e&&(this.hide(),this.clearContent(),e&&e.length>0&&(e=e.map((function(e){return(e={...e.element,...e}).objectId=e.id,delete e.element,e}))),this.dispatchEvent("ENORIPE_OpenRelExp",[e]))},_getLabels:function(e,t){if(t){for(var i="",n=0,o="",a=0;a<t.length&&(o="",e.hasOwnProperty(t[a])&&(o=e[t[a]],"ds6w:modified"!==t[a]&&"ds6w:created"!==t[a]||""===o||(o=s.formatDateToString(new Date(o),{timePrecision:"sec"}))),o&&o.length>0&&(i=i.length>0?i+this._separator+o:o,n++),3!==n);a++);return i}},_hideLeftPanel:function(){this.getElement(".triptych-left").addClassName("display-none"),this.getElement(".fonticon-menu").removeClassName("display-none"),this.getElement(".openicon").addClassName("display-none"),this.getElement(".triptych-main").setStyle("left","0px"),this.getElement(".overlay-left").addClassName("display-none")},_showLeftPanel:function(){this._triptych._showPanel("left"),this.getElement(".triptych-left").removeClassName("display-none"),this.getElement(".openicon").removeClassName("display-none"),this.getElement(".triptych-left").removeClassName("close"),this.getElement(".triptych-left").addClassName("open"),this.getElement(".fonticon-menu").addClassName("display-none"),this.getElement(".triptych-main").setStyle("left",this._leftWidth+"px"),this.getElement(".triptych-left").setStyle("width",this._leftWidth+"px")},_updateContainerDimensions:function(){var t=this.container.parentElement;if(t){var i=(t=t.getDimensions?t:e.extendElement(t)).getDimensions();this.ctnWidth=i.width,this.ctnHeight=this._isWebInWin?window.innerHeight:i.height,this.container.setStyle("height",this.ctnHeight),this.container.getElement(".ENORipe-View-Container").setStyle("height",this.ctnHeight-55);var n=this.getElement(".list-tiles-container");if(n){var s=window.innerHeight-47+"px";n.setStyle("height",s)}this.getElement(".triptych-main")&&(window.innerWidth<580?this._hideLeftPanel():(this._isCollapsed,this._showLeftPanel()))}},_setUpEvents:function(){var e=this;this.getElements(".ENORipe-ActionContainer .action-btn").forEach((function(t){t.addEventListener("click",(function(t){e.changeTab(t.currentTarget)}))})),this.getElements(".ENORipe-rightside-header").forEach((function(t){t.addEventListener("click",e._handleArrowClick.bind(e))})),this.container.addEventListener("dragover",this._onDragOver),this.container.addEventListener("dragenter",function(){this.tempDropZone=!0,this.showDropInvite(this.container),this.getElement(".drop-invite")&&this.getElement(".drop-invite").hide()}.bind(this))},_handleArrowClick:function(e){var t=e.currentTarget.getElement(".fonticon-menu"),i=e.currentTarget.getElement(".openicon");t.hasClassName("display-none")?i.hasClassName("fonticon-open-left")?(this._leftWidth=45,this._isCollapsed=!0,i.removeClassName("fonticon-open-left"),i.addClassName("fonticon-open-right"),this.getElement(".triptych-left").addClassName("ENORIPE-collapsed"),this.getElement(".triptych-main").setStyle("left",this._leftWidth+"px")):(this._leftWidth=270,this._isCollapsed=!1,i.removeClassName("fonticon-open-right"),i.addClassName("fonticon-open-left"),this.getElement(".triptych-left").removeClassName("ENORIPE-collapsed"),this.getElement(".triptych-left").setStyle("width",this._leftWidth+"px"),this.getElement(".triptych-main").setStyle("left",this._leftWidth+"px")):this._handleMenuClick(t)},_handleMenuClick:function(e){var t=this;if(!this.dropDownMenu){var i={target:e,items:[{id:"favorite",text:o.get("NavHomePage-Favorite"),fonticon:"favorite-on"},{id:"recents",text:o.get("NavHomePage-Recents"),fonticon:"clock"}]};i.events={onClick:function(e,i){e.stopPropagation();var n=o.get("NavHomePage-Recents");i.id.contains("favorite")?(n=o.get("NavHomePage-Favorite"),t.currentTab="Favorite",t.dispatchEvent("ENORIPE_HandleFavorite")):i.id.contains("recents")&&(n=o.get("NavHomePage-Recents"),t.currentTab="Recents",t.dispatchEvent("ENORIPE_HandleRecents")),t.getElement(".ENORipe-rightside-headertext").innerHTML=n}},this.dropDownMenu=new h(i),this.dropDownMenu.show()}},onResize:function(){this._updateContainerDimensions()},clearContent:function(){var e=this.getElement("#ENORipe-Recents-Container"),t=this.getElement("#ENORipe-Recents-Container"),i=this.getElement(".list-tiles-container");e&&e.empty(),t&&t.empty(),i&&i.destroy()},destroy:function(){this.clearContent(),this._parent(),this.container.destroy(),this.container=null}})})),define("DS/SNNavigationMap/views/popups/WhatsNew",["UWA/Core","DS/Windows/Dialog","DS/Controls/Button","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/PreferencesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n,s,o){"use strict";return t.extend({name:"WhatsNew-panel",_immersiveFrame:null,init:function(e){this._immersiveFrame=e.immersiveFrame,this._currentDockArea=WUXDockAreaEnum.NoneDockArea;var t=this._getDialogContent();let s={title:o.get("SNNavigationMap.WhatsNew.Title"),content:t,identifier:this.name,immersiveFrame:this._immersiveFrame,movableFlag:!1,resizableFlag:!1,position:{at:"top center",offsetY:200},buttons:{Close:new i({label:o.get("close"),allowUnsafeHTMLContent:!1,onClick:this._close.bind(this)})},checkboxInfos:{label:o.get("SNNavigationMap.WhatsNew.Checkbox.Label"),checkFlag:n.getWhatsNewDoNotShowAgain()}};this._parent(s),this.addEventListener("close",function(){this._close()}.bind(this))},render:function(){this.setPanelVisibilityFlag(!0)},setPanelVisibilityFlag:function(e){this.visibleFlag=e},_getDialogContent:function(){let t=e.createElement("div",{class:"ENORIPE-WhatsNew-Main"});e.createElement("p",{html:o.get("SNNavigationMap.WhatsNew.Content.Intro")}).inject(t),e.createElement("p",{html:o.get("SNNavigationMap.WhatsNew.Content.YouCanFindItUnder")}).inject(t);let i=e.createElement("p").inject(t),n=[o.get("SNNavigationMap.CustomizeAll.Title"),o.get("SNNavigationMap.CustomizeDisplayOptions.Title"),o.get("activateOptimizedIndexNavigation")].join(" > ");return e.createElement("a",{html:n,events:{click:()=>{this.dispatchEvent("ENORIPE_OpenDisplayOptions"),this.dispatchEvent("ENORIPE_HighlightDisplayOption","activateOptimizedIndexNavigation")}}}).inject(i),t},_close:function(){this.setPanelVisibilityFlag(!1),s.setPrefToLocalStorage("whatsNewDoNotShowAgain",this.checkboxInfos.checkFlag)}})})),define("DS/SNNavigationMap/views/DisplayOptionsView",["UWA/Core","UWA/Class/View","DS/Controls/ButtonGroup","DS/Controls/Toggle","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n,s,o,a){"use strict";return t.extend({name:"DisplayOptions",className:function(){return this.getClassNames("-container")},setup:function(t){this.displayOptions=new e.createElement("div",{class:"display-options-view"}),this.currentChanges=[],this.isCancel=!1},render:function(){var e=this;e.displayOptionsBtnGroup=e._getDisplayOptionsBtnGroup(),e._displayOptionsBtnGroupValue=e.displayOptionsBtnGroup.value,e.displayOptionsBtnGroup.addEventListener("change",(t=>{if(!e.isCancel){let t=this._displayOptionsBtnGroupValue,i=this.displayOptionsBtnGroup.value,n=new Set(t.concat(i)),s=Array.from(n).filter((e=>!t.includes(e)||!i.includes(e)));e.dispatchEvent("CustomizeAllView_updateSaveButton",{tabName:"DisplayOptions",areThereChanges:s.length>0}),e.currentChanges=s}})),e.displayOptionsBtnGroup.inject(e.container)},save:function(){let e={};for(let i=0;i<this.currentChanges.length;i++){var t=this.displayOptionsBtnGroup.getButtonFromValue(this.currentChanges[i]).checkFlag;e[this.currentChanges[i]]=t,t&&o.trackUsage("DisplayOptions",this.currentChanges[i])}this.dispatchEvent("CustomizeAllView_updateDisplayOptions",e),this._displayOptionsBtnGroupValue=this.displayOptionsBtnGroup.value},cancel:function(){var e,t=this;t.isCancel=!0;for(let i=0;i<t.displayOptionsBtnGroup.getButtonCount();i++)(e=t.displayOptionsBtnGroup.getButton(i)).checkFlag=e.refreshCheckFlag();t.isCancel=!1},_getDisplayOptionsBtnGroup:function(){var e=new i({type:"checkbox",touchMode:!0});return e.addChild(this._createToggle("showThumbnails2D",(()=>"thumbnailsMode"===s.getThumbnailsMode()))),e.addChild(this._createToggle("showInstances",(()=>s.getInstancesMode()))),e.addChild(this._createToggle("showPublications",(()=>s.getPublicationsMode()))),e.addChild(this._createToggle("showGhost",(()=>s.getGhostMode()))),e.addChild(this._createToggle("recumputeLayout",(()=>"recompute"===s.getLayoutMode()))),s.is3DSpaceIUExistingAndTenantAllowed()&&e.addChild(this._createToggle("activateOptimizedIndexNavigation",(()=>s.getActivateOptimizedIndexNavigation()))),e},_createToggle:function(e,t){let i=new n({type:"checkbox",label:a.get(e),value:e,checkFlag:t()});return i.refreshCheckFlag=t,i},highlightDisplayOption:function(e){let t=this.displayOptionsBtnGroup.getButtonFromValue(e);t.getContent().classList.add("highlight-display-option"),t.addEventListener("animationend",(()=>{t.getContent().classList.remove("highlight-display-option")}))}})})),define("DS/SNNavigationMap/utils/LayoutUtils",["UWA/Class","DS/DagreShim/DagreShim","DS/SNNavigationMap/MapSettings"],(function(e,t,i){return e.extend({init:function(e){this._dagre=t,this.layoutOptions=e},getNodesWidth:function(){return i.getNodesWidth()},getNodesHeight:function(){return i.getNodesHeight()},_setupGraph:function(){this._graphObject&&(this._graphObject=null,delete this._graphObject),this._graphObject=new this._dagre.graphlib.Graph({}).setGraph({rankdir:"LR",align:"DL",ranksep:350,directed:!0,multigraph:!0}).setDefaultEdgeLabel((function(){return{}}))},setData:function(e){this._setupGraph();var t=this,i=0;return e.nodes.forEach((function(e){e.instances&&(!0===e.instancesCollapsed||(i=t.getNodesHeightWithInstance(e))),t._graphObject.setNode(e.id,{label:e.name,width:t.getNodesWidth(),height:i})})),e.links.forEach((function(e){t._graphObject.setEdge(e.source.id,e.target.id)})),this},getNodesHeightWithInstance:function(e){var t;return t=e.instances?30*e.instances.length:0,this.getNodesHeight()+t},findLoops:function(){return this._dagre.graphlib.alg.findCycles(this._graphObject)},getPathCoordinates:function(e,t,i,n,s){var o="";return"x"===this.layoutOptions.layoutAxis&&(o=this._getPathCoordinatesXAxis(e,t,i,n,s)),o},_getPathCoordinatesXAxis:function(e,t,n,s,o){var a,r,l=e.source.columnID===e.target.columnID-1||e.source.columnID===e.target.columnID+1,c=e.source.columnID===e.target.columnID,d=e.source.columnID<e.target.columnID,h="",u="",g=0,p=0,f=this.getNodesHeight()/2,m=this.getNodesWidth(),v=e.target.y,_=e.target.x;if(i.getThumbnailsMode()?(g=e.source.preview_url?i.getOption("nodeHeightWtThumb")/2:i.getOption("nodeHeightWtoutThumb")/2,p=e.target.preview_url?i.getOption("nodeHeightWtThumb")/2:i.getOption("nodeHeightWtoutThumb")/2):(g=i.getOption("nodeHeightWtoutThumb")/2,p=i.getOption("nodeHeightWtoutThumb")/2),o.classed("duplicate")&&o.classed("displaynone",!0),e.target.instancesExpanded>0&&e.instanceTargetId){var S=e.target.instances.map((function(e){return e.id})).indexOf(e.instanceTargetId);S>-1&&S<e.target.instancesExpanded&&(o.classed("duplicate")&&o.classed("displaynone",!1),v=e.target.y+17+23*S+p)}return(!c&&!e.target.instancesExpanded||e.target.instancesExpanded<=0)&&n&&d&&(f-=32.5,g-=32.5,p-=32.5),!e.target.counts||!e.target.counts.hasCount("in")||n&&d||(_-=15),!e.source.counts||!e.source.counts.hasCount("out")||n&&d||(m+=15),h=d?e.source.x+m+" "+(e.source.y+g):e.source.x+" "+(e.source.y+g),u=d?_+" "+(v+p):e.target.x+m+" "+(v+p),l?"M"+h+" L "+u:c?(a=e.source.y+(v-e.source.y)/2,h=e.source.x+m+" "+(e.source.y+g),u=e.target.x+m+" "+(v+p),"M"+h+" Q "+(e.target.x+220)+" "+a+" "+u):(d||(t.attr("marker-end")&&(r=t.attr("marker-end").slice(0,-1),r+="-reverse)",t.attr("marker-start",r),t.attr("marker-end",null)),o.attr("transform","rotate(180) translate("+parseFloat(-(e.source.x+(e.target.x+m)))+", "+parseFloat(-(e.source.y+f+(v+f)))+")")),"M"+h+" Q "+(a=e.source.x+(e.target.x-e.source.x)/2)+" 0 "+u)},rotateTextLabel:function(e,t){if("x"===this.layoutOptions.layoutAxis)return this._rotateTextLabelXlayout(e,t)},_rotateTextLabelXlayout:function(e,t){var i=e.source.columnID===e.target.columnID-1||e.source.columnID===e.target.columnID+1,n=(e.source.columnID,e.target.columnID,e.source.columnID<e.target.columnID),s=this.getNodesWidth(),o=this.getNodesHeight()/2,a=e.target.y;if(e.target.instancesExpanded>0&&e.instanceTargetId){var r=e.target.instances.map((function(e){return e.id})).indexOf(e.instanceTargetId);r>-1&&(a=e.target.y+17+23*r+this.getNodesHeight()/2)}if(!n&&i)return"rotate(180) translate("+parseFloat(-(e.source.x+(e.target.x+s)))+", "+parseFloat(-(e.source.y+o+(a+o)))+")"}})})),define("DS/SNNavigationMap/views/CustomizeAttributeView",["UWA/Core","UWA/Class","UWA/Class/View","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","DS/SNNavigationMap/utils/AdditionalColumnsUtils","DS/ENORIPE_Common/utils/CommonUtilsServices","DS/Handlebars/Handlebars4","DS/Controls/ComboBox","DS/Controls/TooltipModel","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/UIKIT/Iconbar","DS/UIKIT/Mask","DS/UIKIT/Autocomplete","DS/FedDictionaryAccess/FedDictionaryAccessAPI","text!DS/SNNavigationMap/assets/templates/customizeAttribute.html","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n,s,o,a,r,l,c,d,h,u,g,p,f,m,v,_){"use strict";return i.extend({name:"CustomizeAttribute",_dialog:null,_attributesModel:[],_typesModified:[],_attributesAtLaunch:{},_renderOptions:{},className:function(){return this.getClassNames("-container")},setup:function(e){var t=r.compile(v);this.mainTemplateHtml=t.call(null,{typeNls:_.get("CustomizeAttr-Type"),selExtNls:_.get("CustomizeAttr-selExtNls")}),this.dimensions={},this.dimensions.position={},this.dimensions.position.offsetX=0,this.dimensions.position.offsetY=50,this.dimensions.dialogWidth=540,this.dimensions.dialogHeight=520,this.firstLaunch=!0,e.iswebinwin&&a.setConfigForMyApps({myAppsBaseUrl:n.getMyAppsUrl(),userId:n.getUserID(),lang:n.getLang()})},render:function(e){this._renderOptions=e,this.defaults=e.defaults||{},this.content=this._getDialogContent(e),this.content.inject(this.container),this._setEvents(),this._attributesAtLaunch={graphView:this._getSelectedAttributes("graphView").map((e=>e.getAttributeValue("name"))),dgvColumns:this._getSelectedAttributes("dgvColumns").map((e=>e.getAttributeValue("name")))}},refreshRender:function(e){this._renderOptions=e,this.defaults=e.defaults||{},this._refreshLayoutTypeComboBox(),this._refreshTreeView(e),this._refreshSelectedTreeView(e),this._refreshSelectedTreeViewColumns(e),this._attributesAtLaunch={graphView:this._getSelectedAttributes("graphView").map((e=>e.getAttributeValue("name"))),dgvColumns:this._getSelectedAttributes("dgvColumns").map((e=>e.getAttributeValue("name")))};let t=this.content.getElement(".Customize_SearchAttributesCommand");t.hasClassName("pressed")&&(t.toggleClassName("pressed"),this._srchAutocomplete.elements.container.toggleClassName("customize-hidden"),this.container.getElement(".ENORipeCustomizeAttr-TypeContainer").toggleClassName("customize-hidden"))},cancel:function(){},_refreshLayoutTypeComboBox:function(){if(this._viewSelectorCombobox){var e=n.getLayoutType(),t=0;"dataGridView"===e&&(t=1),this._viewSelectorCombobox.selectedIndex=t,this.comboboxInfoDiv&&this.comboboxInfoDiv.tooltipInfos&&(this.comboboxInfoDiv.tooltipInfos.longHelp=this._getComboboxTooltipBody(e))}},_refreshTreeView:function(e){this._attrTreeDocument.empty(),this._addToAttrTreeDoc(e)},_refreshSelectedTreeView:function(e){this._selectedAttrTreeDocument.empty(),this._addToSelectedAttrTreeDoc(e.defaults)},_refreshSelectedTreeViewColumns:function(e){this._selectedAttrTreeDocumentCols.empty(),this._addToSelectedAttrTreeDocCols(e.defaults)},_setUpToolBar:function(e){var t=this,i=[{fonticon:"reset",text:_.get("SNNavigationMap.CustomizeAttributes.Reset.Tooltip"),handler:function(){t._resetClick()}},{className:"divider selectionIcon",name:"divider"},{fonticon:"search",className:"Customize_SearchAttributesCommand",text:_.get("SearchAvailableAttrs"),handler:function(e,i){i.elements.container.toggleClassName("pressed"),t._handleSearch()}},{className:"divider selectionIcon",name:"divider"},{fonticon:"up",text:_.get("MoveUp"),handler:function(){t._handleMove("oneUp")}},{fonticon:"down",text:_.get("MoveDown"),handler:function(){t._handleMove("oneDown")}},{fonticon:"move-to-top",text:_.get("MoveTop"),handler:function(){t._handleMove("toTop")}},{fonticon:"move-to-bottom",text:_.get("MoveBottom"),handler:function(){t._handleMove("toBottom")}}];new g({renderTo:e,className:"customizeattr-arwcmd",items:i})},_setUpComboBox:function(t){var i=t.container;this.viewSelectorDoc=new d,this.viewSelectorDoc.addRoot(new h({label:_.get("TilesAndThumbnails"),grid:{value:"graphView"}})),this.viewSelectorDoc.addRoot(new h({label:_.get("DatagridColumns"),grid:{value:"dgvColumns"}}));var s=n.getLayoutType(),o=0;"dataGridView"===s&&(o=1);var a={elementsTree:this.viewSelectorDoc,nbDisplayedElements:this.viewSelectorDoc.getRoots().length,actionOnClickFlag:!1,selectedIndex:o,touchMode:!0,multiSelFlag:!1};this._viewSelectorCombobox=new l(a),this._viewSelectorCombobox.addEventListener("change",this._handleViewChange.bind(this));var r=i.getElement("#ENORipeCustomizeAttr-comboboxContainer");this._viewSelectorCombobox.inject(r),this.comboboxInfoDiv=e.createElement("div",{class:"wux-ui-3ds-help wux-ui-3ds"});var u=this._getComboboxTooltipBody(s);this.comboboxInfoDiv.tooltipInfos=new c({allowUnsafeHTMLLongHelp:!0,longHelp:u}),this.comboboxInfoDiv.inject(r)},_getComboboxTooltipBody:function(t){var i="linearGraph"===t?_.get("SNNavigationMap.CustomizeAttributes.ComboboxInfo.TilesAndThumbnails.Tooltip"):_.get("SNNavigationMap.CustomizeAttributes.ComboboxInfo.DataGrid.Tooltip"),n=e.createElement("div",{html:i,styles:{"text-align":"start"}});return"linearGraph"===t&&e.createElement("ul",{html:_.get("SNNavigationMap.CustomizeAttributes.ComboboxInfo.TilesAndThumbnails.Tooltip.ul"),styles:{"text-align":"start","list-style":"inside"}}).inject(n),n},_setTreeView:function(e){this._setAttributeTree(e);var t=[{dataIndex:"tree",typeRepresentation:"string",text:_.get("CustomizeAttr-AttributesAvailable"),height:"auto",width:"auto",alwaysVisibleFlag:!0,editableFlag:!1,sortableFlag:!1}];this._attrDGV=new u({showRowIndexFlag:!1,showRowBorderFlag:!0,showColumnBorderFlag:!0,showSelectionCheckBoxesFlag:!0,rowSelection:"multiple",cellSelection:"none",useDragAndDrop:!1,selectionBehavior:{unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1,canInteractiveMultiselectWithCheckboxClick:!0},useAsyncPreExpand:!0,columns:t,treeDocument:this._attrTreeDocument}).inject(e.container.getElement("#ENORipeCustomizeAttr-MainTable"))},_setEvents:function(){let e=this.container.getElement("#ENORipeCustomizeAttr-Movementctrlsright");e.addEventListener("click",this._addToSelectedAttributes.bind(this)),e.tooltipInfos=new c({shortHelp:_.get("SNNavigationMap.CustomizeAttributes.MovementCtrlsRight.Tooltip")});let t=this.container.getElement("#ENORipeCustomizeAttr-Movementctrlsleft");t.addEventListener("click",this._removeFromSelectedAttributes.bind(this)),t.tooltipInfos=new c({shortHelp:_.get("SNNavigationMap.CustomizeAttributes.MovementCtrlsLeft.Tooltip")})},_onKeyUp:function(e){this._delayTimer&&clearTimeout(this._delayTimer);var t=this;this._delayTimer=setTimeout((function(){var i;i=(e.srcElement||e.target).value,t._performSearch(i)}),500)},_resetClick:function(){var e=this._getSelectedView(),t=this._selectedAttrTreeDocumentCols;_.get("CustAttrResetDGV");this.defaults=JSON.parse(JSON.stringify(n.getJSONAttributes())),"graphView"===e&&(t=this._selectedAttrTreeDocument,_.get("CustAttrResetGraph")),t.prepareUpdate(),t.removeRoots(),t.pushUpdate(),"graphView"===e?this._addToSelectedAttrTreeDoc(this.defaults):this._addToSelectedAttrTreeDocCols(this.defaults),this._disableEnableOkBtn()},save:function(){var e=this._getChangesStatus();this._saveChangesInDefaults(),e.changesOnGraphView&&(s.trackUsage("CustomizeAttributes","UpdatesOnView-GraphView"),Object.keys(this.defaults).forEach((function(e){"EnoripeColumns"!=e&&s.trackUsage("CustomizeAttributes","GraphViewAttributes-"+e)}))),e.changesOnDatagridView&&this.defaults.EnoripeColumns&&s.trackUsage("CustomizeAttributes","UpdatesOnView-DatagridView"),this.dispatchEvent("CustomizeAllView_UpdateAttributes",[this.defaults])},_handleSearch:function(){this._srchAutocomplete.elements.container.toggleClassName("customize-hidden"),this.container.getElement(".ENORipeCustomizeAttr-TypeContainer").toggleClassName("customize-hidden")},_getMatchedNodesByTypeName:function(e,t,i){return e.search({match:function(e){if(e.nodeModel.options.grid.type===t&&e.nodeModel.options.grid.name===i)return!0}})},_setSearchAutoComplete:function(e){var t=this;this._srchAutocomplete=new f({noResultsMessage:!1,placeholder:_.get("CustomizeAttr-SearchTextInvite"),events:{onKeyUp:t._onKeyUp.bind(t)}}).inject(e,"after"),this._srchAutocomplete.elements.container.addClassName("customizeattr-search-autocomplete customize-hidden"),this._srchAutocomplete.elements.clear.addEventListener("click",this._clearSearch.bind(t))},_clearSearch:function(){this._attrTreeDocument.prepareUpdate(),this._attrTreeDocument.getAllDescendants().forEach((function(e){"attribute"===e.getAttributeValue("type")&&e.show()})),this._attrTreeDocument.pushUpdate()},_performSearch:function(e){this.addLoader(),this._clearSearch(),0!==e.length?(e=e.toLocaleLowerCase(),this._attrTreeDocument.prepareUpdate(),this._attrTreeDocument.getAllDescendants().forEach((function(t){t.getLabel().toLocaleLowerCase().search(e)>-1?(t.show(),t.getParent()&&t.getParent().expand()):"attribute"===t.getAttributeValue("type")&&t.hide()})),this.removeLoader(),this._attrTreeDocument.pushUpdate()):this.removeLoader()},_setSelectedTreeView:function(e){this._setSelectedAttributeTree(e);var t=[{dataIndex:"tree",text:_.get("CustomizeAttr-AttributesSelected"),height:"auto",width:"auto",editableFlag:!1,sortableFlag:!1}];this._selectedAttrDGV=new u({showRowIndexFlag:!1,showRowBorderFlag:!0,showColumnBorderFlag:!0,showSelectionCheckBoxesFlag:!0,rowSelection:"multiple",cellSelection:"none",useDragAndDrop:!1,selectionBehavior:{unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1,canInteractiveMultiselectWithCheckboxClick:!0},columns:t,treeDocument:this._selectedAttrTreeDocument}).inject(e.container.getElement("#ENORipeCustomizeAttr-SelectedTable"))},_setSelectedTreeViewColumns:function(e){this._setSelectedAttributeTreeCols(e);var t=[{dataIndex:"tree",text:_.get("CustomizeAttr-AttributesSelected"),height:"auto",width:"auto",editableFlag:!1,sortableFlag:!1}];this._selectedAttrDGVCols=new u({showRowIndexFlag:!1,showRowBorderFlag:!0,showColumnBorderFlag:!0,showSelectionCheckBoxesFlag:!0,rowSelection:"multiple",cellSelection:"none",useDragAndDrop:!0,selectionBehavior:{unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1,canInteractiveMultiselectWithCheckboxClick:!0},columns:t,treeDocument:this._selectedAttrTreeDocumentCols}).inject(e.container.getElement("#ENORipeCustomizeAttr-SelectedTable")),"graphView"===this._getSelectedView()?this._selectedAttrDGVCols.hide():this._selectedAttrDGV.hide()},_addToSelectedAttributes:function(){var e=this._attrTreeDocument.getSelectedNodes(),t=this._getSelectedView();"graphView"===t?this._selectedAttrTreeDocument.prepareUpdate():this._selectedAttrTreeDocumentCols.prepareUpdate();for(var i=0;i<e.length;i++)if("attribute"===e[i].options.grid.type){if(this._isAlreadyAdded(e[i]))continue;var n,s=e[i].getParents(),o=new h({label:e[i].options.label,grid:e[i].options.grid});if("dgvColumns"===t){this._selectedAttrTreeDocumentCols.addRoot(o);continue}for(var a=0;a<s.length;a++)if("ParentType"===s[a].options.grid.type){n=s[a];break}var r=this._getMatchedNodesByTypeName(this._selectedAttrTreeDocument,n.options.grid.type,n.options.grid.name);if(r.length>0){0===this._getMatchedNodesByTypeName(this._selectedAttrTreeDocument,e[i].options.grid.type,e[i].options.grid.name).length&&(r[0].addChild(o),r[0].expand())}else{var l=new h({label:n.options.label,grid:n.options.grid});l.addChild(o),this._selectedAttrTreeDocument.addRoot(l),l.expand()}}"graphView"===t?this._selectedAttrTreeDocument.pushUpdate():this._selectedAttrTreeDocumentCols.pushUpdate(),this._disableEnableOkBtn()},_removeFromSelectedAttributes:function(){var e;if("graphView"===this._getSelectedView()){this._selectedAttrTreeDocument.prepareUpdate(),e=this._selectedAttrTreeDocument.getSelectedNodes();for(var t=0;t<e.length;t++){var i=e[t].getParent();1===i.getAllDescendants().length?this._selectedAttrTreeDocument.removeRoot(i):i.removeChild(e[t])}this._selectedAttrTreeDocument.pushUpdate()}else{this._selectedAttrTreeDocumentCols.prepareUpdate(),e=this._selectedAttrTreeDocumentCols.getSelectedNodes();for(t=0;t<e.length;t++)this._selectedAttrTreeDocumentCols.removeRoot(e[t]);this._selectedAttrTreeDocumentCols.pushUpdate()}this._disableEnableOkBtn()},_setAttributeTree:function(e){this._attrTreeDocument=new d({shouldBeSelected:function(e){var t=e.options.grid.type;return"MoreBtn"!==t&&"ParentType"!==t&&"extension"!==t}}),this._addToAttrTreeDoc(e)},_addToAttrTreeDoc:function(e){var i,n,s=this,o=[];this._attrTreeDocument.prepareUpdate();for(var a=e.types,r=0;r<a.length;r++)i={label:a[r].nlsLabel,children:[],grid:{name:a[r].name,type:"ParentType",label:a[r].nlsLabel}},n=new h(i),this._attrTreeDocument.addRoot(n),o.push(a[r].name);function l(e,t){var i=e.options.grid.type,n=t.options.grid.type,s=0;if(i===n){var o=e.getLabel().toUpperCase(),a=t.getLabel().toUpperCase();o>a?s=1:o<a&&(s=-1)}else"attribute"===i&&"extension"===n?s=-1:"extension"===i&&"attribute"===n&&(s=1);return s}i={label:_.get("Customize-More"),grid:{name:"MoreBtn",type:"MoreBtn",label:_.get("Customize-More")},children:[]},n=new h(i),this._attrTreeDocument.addRoot(n),this._attrTreeDocument.onPreExpand((function(e){var i=e.target;if(i.hasChildren())i.sortChildren({isRecursive:!1,sortFunction:l}),i.preExpandDone();else if("MoreBtn"===i.options.grid.type)s._attrTreeDocument.removeRoot(i),s._getAndAddMoreTypes(o).then((function(){i.preExpandDone()}));else{var n=s._getAndAddAttributes(i),a=s._getAndAddExtension(i),r=s._getAndAddAdditionalColumns(i);t.Promise.all([n,a,r]).then((function(){i.sortChildren({isRecursive:!1,sortFunction:l}),i.preExpandDone()}))}})),this._attrTreeDocument.pushUpdate()},_setSelectedAttributeTree:function(e){this._selectedAttrTreeDocument=new d({shouldAcceptDrop:function(e){return"middle"!==e.dropPosition},shouldBeSelected:function(e){return"ParentType"!==e.options.grid.type}}),this._addToSelectedAttrTreeDoc(e.defaults)},_addToSelectedAttrTreeDoc:function(e){for(var t in this._selectedAttrTreeDocument.prepareUpdate(),e)if(e.hasOwnProperty(t)){if("EnoripeColumns"===t)continue;var i=e[t],n={label:i.nlsLabel,grid:{name:i.name,type:"ParentType",label:i.nlsLabel},children:[]},s=new h(n);if(i.attributes)for(var o=0;o<i.attributes.length;o++){var a=i.attributes[o],r={label:a.label,grid:{name:a.uri,type:"attributes",label:a.label}};s.addChild(new h(r))}this._selectedAttrTreeDocument.addRoot(s)}this._selectedAttrTreeDocument.pushUpdate()},_setSelectedAttributeTreeCols:function(e){this._selectedAttrTreeDocumentCols=new d({shouldBeSelected:function(e){return"ds6w:label"!==e.options.grid.name}}),this._addToSelectedAttrTreeDocCols(e.defaults)},_addToSelectedAttrTreeDocCols:function(e){this._selectedAttrTreeDocumentCols.prepareUpdate();for(var t=e.EnoripeColumns.attributes,i=0;i<t.length;i++){var n=t[i],s={label:n.label,grid:{name:n.uri,type:"attributes",label:n.label,dataType:n.dataType,additionalColumn:n.additionalColumn}};this._selectedAttrTreeDocumentCols.addRoot(new h(s))}this._selectedAttrTreeDocumentCols.pushUpdate()},_handleMove:function(e){var t,i;if("graphView"===this._getSelectedView()){if(0===this._selectedAttrTreeDocument.getSelectedNodes().length)return;for(var n=this._selectedAttrTreeDocument.getRoots(),s=0;s<n.length;s++){i=(t=n[s]).getChildren();for(var o=0;o<i.length;o++)if(i[o].isSelected()){switch(e){case"oneUp":this._moveOneUp(t,i,this._selectedAttrTreeDocument);break;case"oneDown":this._moveOneDown(t,i,this._selectedAttrTreeDocument);break;case"toTop":this._moveToTop(t,i,this._selectedAttrTreeDocument);break;case"toBottom":this._moveToBottom(t,i,this._selectedAttrTreeDocument)}break}}}else{if(0===this._selectedAttrTreeDocumentCols.getSelectedNodes().length)return;switch(i=(t=this._selectedAttrTreeDocumentCols).getChildren(),e){case"oneUp":this._moveOneUp(t,i,this._selectedAttrTreeDocumentCols,!0);break;case"oneDown":this._moveOneDown(t,i,this._selectedAttrTreeDocumentCols,!0);break;case"toTop":this._moveToTop(t,i,this._selectedAttrTreeDocumentCols,!0);break;case"toBottom":this._moveToBottom(t,i,this._selectedAttrTreeDocumentCols,!0)}}this._disableEnableOkBtn()},_moveOneUp:function(e,t,i,n){for(var s=0,o=[];s<t.length&&t[s].isSelected();)t[s].options.grid.isSequence=!0,s++;for(var a=0;a<t.length;a++)t[a].isSelected()&&(o.push(t[a]),!0!==t[a].options.grid.isSequence&&(t[a].options.grid.moveToIndex=a-1));i.prepareUpdate();for(var r=0;r<t.length;r++)if(t[r].isSelected()&&void 0!==t[r].options.grid.moveToIndex){var l;if(n){if("ds6w:label"===(l=e.getNthRoot(t[r].options.grid.moveToIndex)).getAttributeValue("name"))continue}else l=e.getNthChild(t[r].options.grid.moveToIndex);e.insertBefore(t[r],l)}i.pushUpdate(),this._persistSelection(o),this._resetSequencing(i)},_moveOneDown:function(e,t,i,n){for(var s=[],o=t.length-1;o>-1&&t[o].isSelected();)t[o].options.grid.isSequence=!0,o--;for(var a=0;a<t.length;a++)t[a].isSelected()&&(s.push(t[a]),a!==t.length-1&&!0!==t[a].options.grid.isSequence&&(t[a].options.grid.moveToIndex=a+2));i.prepareUpdate();for(var r=t.length-1;r>-1;r--)if(void 0!==t[r].options.grid.moveToIndex){var l;if(t[r].options.grid.moveToIndex===t.length)e.insertBefore(t[r]);else l=n?e.getNthRoot(t[r].options.grid.moveToIndex):e.getNthChild(t[r].options.grid.moveToIndex),e.insertBefore(t[r],l);t[r].options.grid.moveToIndex=void 0}i.pushUpdate(),this._persistSelection(s),this._resetSequencing(i)},_moveToTop:function(e,t,i,n){for(var s=[],o=0;o<t.length&&t[o].isSelected();)t[o].options.grid.isSequence=!0,o++;var a=0;n&&(a=1);for(var r=0;r<t.length;r++)t[r].isSelected()&&(s.push(t[r]),!0!==t[r].options.grid.isSequence&&(t[r].options.grid.moveToIndex=a),a++);i.prepareUpdate();for(var l=0;l<t.length;l++)if(t[l].isSelected()&&void 0!==t[l].options.grid.moveToIndex){var c;if(n){if("ds6w:label"===(c=e.getNthRoot(t[l].options.grid.moveToIndex)).getAttributeValue("name"))continue}else c=e.getNthChild(t[l].options.grid.moveToIndex);t[l]!==c&&e.insertBefore(t[l],c)}i.pushUpdate(),this._persistSelection(s),this._resetSequencing(i)},_moveToBottom:function(e,t,i,n){for(var s=[],o=t.length-1;o>-1&&t[o].isSelected();)t[o].options.grid.isSequence=!0,o--;for(var a=t.length,r=t.length-1;r>=0;r--)t[r].isSelected()&&(s.push(t[r]),r!==t.length-1&&!0!==t[r].options.grid.isSequence&&(t[r].options.grid.moveToIndex=a),a--);i.prepareUpdate();for(var l=t.length-1;l>-1;l--)if(void 0!==t[l].options.grid.moveToIndex){var c;if(t[l].options.grid.moveToIndex===t.length)e.insertBefore(t[l]);else c=n?e.getNthRoot(t[l].options.grid.moveToIndex):e.getNthChild(t[l].options.grid.moveToIndex),e.insertBefore(t[l],c);t[l].options.grid.moveToIndex=void 0}i.pushUpdate(),this._persistSelection(s),this._resetSequencing(i)},_getAndAddExtension:function(e){var i=this,n=e.options.grid.name;return new t.Promise((function(t,s){"AllTypes"!==n&&"extension"!==e.options.grid.type?i._getDataSet(n).then((function(n){i._parseAndAddDataSet(n,e),t()}),(function(e){console.log(e),t("extensionFetch-err")})):t()}))},_getAndAddAdditionalColumns:function(e){var i=e.options.grid.name,n=this._viewSelectorCombobox.selectedIndex;return new t.Promise((function(t,s){0!==n&&"AllTypes"===i?o.getConfigurationColumns().then((function(i){let n=[];if(i.forEach((function(e){n.push({name:e.dataIndex,value:e.text})})),n.length>0){let t,i;e.prepareUpdate();for(var s=0;s<n.length;s++)t={label:n[s].value,grid:{name:n[s].name,type:"attribute",label:n[s].value,additionalColumn:!0}},i=new h(t),e.addChild(i);e.pushUpdate()}t()}),(function(e){console.log(e),t("AdditionalColumns-err")})):t()}))},_getDataSet:function(e){return new t.Promise((function(t,i){var s=n.getCurrentTenantName(),o=n.getLang();m.getExtensionsForClass(e,{tenantId:s,lang:o,apiVersion:"R2019x",onComplete:t,onFailure:function(e){i(e)}})}))},_parseAndAddDataSet:function(e,t){var i=[];if(e&&e.extensions&&e.extensions.length>0&&(e.extensions.sort((function(e,t){return e.label.toUpperCase()<t.label.toUpperCase()?-1:e.label.toUpperCase()>t.label.toUpperCase()?1:0})),e.extensions.forEach((function(e){i.push({name:e.curi,value:e.label})}))),i.length>0){var n,s;t.options.grid.name;t.prepareUpdate();for(var o=0;o<i.length;o++)n={label:i[o].value,grid:{name:i[o].name,type:"extension",label:i[o].value},children:[]},s=new h(n),t.addChild(s);t.pushUpdate()}},_getAndAddAttributes:function(e){var i=this,n=e.options.grid.name,s="ds6wg:";return"AllTypes"===n?s+="PLMEntity":n.contains("ds6wg:")?s=n:s+=n,new t.Promise((function(t,n){i._getAttrPredicates(s).then((function(n){i._processAndUpdateAttributes(n,s,e),t()}),(function(e){console.log(e),n()}))}))},_getAttrPredicates:function(e){return new t.Promise((function(t,i){m.getPropertiesForClass(e,{tenantId:n.getCurrentTenantName(),lang:n.getLang(),apiVersion:"R2019x",onComplete:function(e){t(e)},onFailure:function(e){i(e)}})}))},_processAndUpdateAttributes:function(e,t,i){var n,s;if(e&&e.length>0){i.prepareUpdate();for(var o=e[0].properties,a=0;a<o.length;a++){var r=o[a].dataType;n={label:o[a].label,grid:{name:o[a].curi,typeUri:t,label:o[a].label,type:"attribute",dataType:r.slice(r.lastIndexOf("#")+1)}},s=new h(n),i.addChild(s)}i.pushUpdate()}},_getMoreTypes:function(){return new t.Promise((function(e,t){m.getVocabularyClasses("ds6wg",{tenantId:n.getCurrentTenantName(),lang:n.getLang(),apiVersion:"R2019x",onComplete:function(t){e(t)},onFailure:function(e){t(e)}})}))},_getAndAddMoreTypes:function(e){var i=this;function n(e,t){var i=e.label.toUpperCase(),n=t.label.toUpperCase(),s=0;return i>n?s=1:i<n&&(s=-1),s}return new t.Promise((function(t,s){i._getMoreTypes().then((function(s){if(i._attrTreeDocument.prepareUpdate(),s.classes&&s.classes.length){s.classes.sort(n);for(var o=0;o<s.classes.length;o++)if(-1===e.indexOf(s.classes[o].curi.replace("ds6wg:",""))){var a=s.classes[o],r={label:a.label,grid:{name:a.curi,type:"ParentType",label:a.label},children:[]},l=new h(r);i._attrTreeDocument.addRoot(l)}i._attrTreeDocument.pushUpdate(),t()}}))}))},_getSelectedAttributes:function(e){var t=[];return e||(e=this._getSelectedView()),"graphView"===e?this._selectedAttrTreeDocument.getRoots().forEach((function(e){t=t.concat(e.getAllDescendants())})):t=t.concat(this._selectedAttrTreeDocumentCols.getAllDescendants()),t},_getChangesStatus:function(){var e={changesOnGraphView:!1,changesOnDatagridView:!1,areThereChanges:!1},t=this._getSelectedAttributes("graphView").map((e=>e.getAttributeValue("name"))),i=this._getSelectedAttributes("dgvColumns").map((e=>e.getAttributeValue("name")));return e.changesOnGraphView=!UWA.Array.equals(t,this._attributesAtLaunch.graphView),e.changesOnDatagridView=!UWA.Array.equals(i,this._attributesAtLaunch.dgvColumns),e.areThereChanges=this.areThereEnoughAttributes()&&(e.changesOnGraphView||e.changesOnDatagridView),e},areThereEnoughAttributes:function(){return this._selectedAttrTreeDocument.getRoots().every((e=>!(e.getAllDescendants().length<3)))&&this._getSelectedAttributes("dgvColumns").length>2},_disableEnableOkBtn:function(){var e=this._getChangesStatus();this.dispatchEvent("CustomizeAllView_updateSaveButton",{tabName:"CustomizeAttributes",areThereChanges:e.areThereChanges})},_getDialogContent:function(t){var i=e.createElement("div",{class:"ENORipeCustomizeAttr-Main",html:this.mainTemplateHtml}),n={types:t.types||[],container:i,selectedIndex:t.selectedIndex};return t.container=i,this._setUpComboBox(n),this._setSearchAutoComplete(i.getElement(".ENORipeCustomizeAttr-TypeContainer")),this._setUpToolBar(i.getElement(".ENORipeCustomizeAttr-ToolBar")),this._setTreeView(t),this._setSelectedTreeView(t),this._setSelectedTreeViewColumns(t),i},_isAlreadyAdded:function(e){var t;if("dgvColumns"===this._getSelectedView()){t=this._selectedAttrTreeDocumentCols.getAllDescendants();for(var i=0;i<t.length;i++)if(t[i].getAttributeValue("name")===e.getAttributeValue("name"))return!0}else for(var n=e.getParent().getAttributeValue("name"),s=this._selectedAttrTreeDocument.getRoots(),o=0;o<s.length;o++)if(s[o].getAttributeValue("name")===n){t=s[o].getAllDescendants();for(i=0;i<t.length;i++)if(t[i].getAttributeValue("name")===e.getAttributeValue("name"))return!0;break}return!1},_handleViewChange:function(){var e=this._getSelectedView();"graphView"===e?(this._selectedAttrDGV.show(),this._selectedAttrDGVCols.hide()):(this._selectedAttrDGVCols.show(),this._selectedAttrDGV.hide()),this.comboboxInfoDiv&&this.comboboxInfoDiv.tooltipInfos&&(this.comboboxInfoDiv.tooltipInfos.longHelp=this._getComboboxTooltipBody("graphView"===e?"linearGraph":"dataGridView")),this._refreshTreeView(this._renderOptions)},_getSelectedView:function(){return this.viewSelectorDoc.getRoots()[this._viewSelectorCombobox.selectedIndex].options.grid.value},_persistSelection:function(e){e.forEach((function(e){e.select()}))},_resetSequencing:function(e){e.getAllDescendants().forEach((function(e){e.options.grid.isSequence=!1,e.options.grid.moveToIndex=void 0}))},_saveChangesInDefaults:function(){var e=this._selectedAttrTreeDocument.getRoots(),t=this._selectedAttrTreeDocumentCols.getRoots(),i=this.defaults;this.defaults={EnoripeColumns:i.EnoripeColumns};for(var n=0;n<e.length;n++){var s=e[n].getAllDescendants(),o=[];s.forEach((function(e){o.push({uri:e.options.grid.name,label:e.getLabel()})})),this.defaults[e[n].options.grid.name]={name:e[n].options.grid.name,nlsLabel:e[n].getLabel(),attributes:o}}var a=[];for(n=0;n<t.length;n++)a.push({uri:t[n].options.grid.name,label:t[n].getLabel(),dataType:t[n].options.grid.dataType,additionalColumn:t[n].options.grid.additionalColumn});this.defaults.EnoripeColumns.attributes=a},addLoader:function(e){var t=this;e?p.mask(e):t.container?p.mask(t.container):p.mask(t.content)},removeLoader:function(e){var t=this;e?p.unmask(e):t.container?p.unmask(t.container):p.unmask(t.content)}})})),define("DS/SNNavigationMap/utils/DataGridCustoColumnsUtils",["UWA/Class","DS/WebappsUtils/WebappsUtils","DS/PADServices/utils/MaturityUtils","DS/PlatformAPI/PlatformAPI","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/CommonUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n,s,o,a){"use strict";return e.extend({init:function(e){this._dataGridCollection=e,this._availableCADMasters=new Map;let i=["CATIAV5","SOLIDWORKS","NX","CREO","SOLIDEDGE","ALTIUM","INVENTOR","AUTOCAD","CAAUPSAPP","CADENCEALLEGRO","3DEXPERIENCE","EPLAN","SURPAC"];for(var o=0;o<i.length;o++)this._availableCADMasters.set(i[o],t.getWebappsAssetUrl("PADServices","icons/cadmasters/I_CADMaster"+i[o]+".png"));this._isWebInWin=s.isWebInWin(),this._isWebInWin||(this._currentUser=n.getUser())},getCustoColumns:function(){var e=this;return{"ds6w:cadMaster":{dataIndex:"ds6w:cadMaster",kind:"image",width:40,minWidth:40,editableFlag:!1,typeRepresentation:"image",alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellValue:function(t){let i;if(t.nodeModel){let n=t.nodeModel.id,s=e._dataGridCollection.get(n);if(n&&s){let t=s._attributes["ds6w:cadMaster"];void 0!==t&&(i=e._availableCADMasters.get(t))}}return i?{iconPath:i,iconSize:{height:"22px"}}:""},getCellValueForExport:function(t){if(t.nodeModel){return e._dataGridCollection.get(t.nodeModel.id)._attributes["ds6w:cadMaster"]}return t.cellModel}},"ds6w:status":{dataIndex:"ds6w:status",kind:"tag",minWidth:50,editableFlag:!1,typeRepresentation:"tag",className:"lc-maturity-state",customisation:{exportable:{lock:!1,value:!0}},getCellClassName:function(t){if(t.nodeModel){let s=t.nodeModel.id,o=e._dataGridCollection.get(s);if(s&&o){let e=o._attributes["ds6w:status"];var n;return e&&(n=i.getAndCreateMaturityClass(e,"wux-controls-label")),n}}}},"ds6w:isLastRevision":{dataIndex:"ds6w:isLastRevision",kind:"boolean",typeRepresentation:"boolean",minWidth:50,editableFlag:!1,alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellTooltip:function(t){let i="";if(t.nodeModel){let n=t.nodeModel.id,s=e._dataGridCollection.get(n);if(n&&s){let e=s._attributes["ds6w:isLastRevision"];void 0!==e&&(i=("boolean"==typeof e?e:"TRUE"===e.toUpperCase())?{shortHelp:a.get("LastRevision")}:{shortHelp:a.get("NotlastRevision")})}}return i},getCellClassName:function(t){if(t.nodeModel){let i=t.nodeModel.id,n=e._dataGridCollection.get(i);if(i&&n){let e=n._attributes["ds6w:isLastRevision"];if(void 0!==e)return("boolean"==typeof e?e:"TRUE"===e.toUpperCase())?"lc_dgv-lastversion-check":"lc_dgv-lastversion-wrong"}}}},"ds6w:isLastRevisionPerState":{dataIndex:"ds6w:isLastRevisionPerState",kind:"boolean",typeRepresentation:"boolean",minWidth:50,editableFlag:!1,alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellClassName:function(t){if(t.nodeModel){let i=t.nodeModel.id,n=e._dataGridCollection.get(i);if(i&&n){let e=n._attributes["ds6w:isLastRevisionPerState"];if(void 0!==e)return("boolean"==typeof e?e:"TRUE"===e.toUpperCase())?"lc_dgv-lastversion-check":"lc_dgv-lastversion-wrong"}}},getCellTooltip:function(t){let i="";if(t.nodeModel){let n=t.nodeModel.id,s=e._dataGridCollection.get(n);if(n&&s){let e=s._attributes["ds6w:isLastRevision"];void 0!==e&&(i=("boolean"==typeof e?e:"TRUE"===e.toUpperCase())?{shortHelp:a.get("LastRevision")}:{shortHelp:a.get("NotlastRevision")})}}return i}},"ds6w:reserved":{dataIndex:"ds6w:reserved",kind:"icon",minWidth:50,editableFlag:!1,typeRepresentation:"icon",alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellTooltip:function(t){var i=void 0;return t&&!t.isHeader&&t.nodeModel&&(i=e._getLockedByNls(t.nodeModel)),i},getCellValue:function(t){var i=void 0;if(!t.isHeader&&t.nodeModel){let n=t.nodeModel.id,s=e._dataGridCollection.get(n);if(n&&s){let n=e._getLockStatus(t.nodeModel),s=e._isLockedByMe(t.nodeModel);i=n?s?"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-key lc_dgv_lock":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock lc_dgv_lock_other":""}}return i},getCellValueForExport:function(t){if(t.nodeModel){return e._dataGridCollection.get(t.nodeModel.id)._attributes["ds6w:reserved"]}return t.cellModel}},"ds6w:responsible":{dataIndex:"ds6w:responsible",kind:"user",className:"dgv-responsible",minWidth:150,editableFlag:!1,customisation:{exportable:{lock:!1,value:!0}},getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.isGroupingNode?"string":"user"},getCellValue:function(t){let i,n;if(t.nodeModel){let a=t.nodeModel.id,r=e._dataGridCollection.get(a);if(a&&r){let e=r._attributes.owner;var s=e?o.getUser3DSwymPictureURL(e):void 0;i=s?{iconPath:"url("+s+")",className:"dgv-user-thumbnail"}:{iconName:"topbar-user",fontIconFamily:1},n=r._attributes["ds6w:responsible"]}}return n?{icon:i,label:n}:void 0},getCellValueForExport:function(t){if(t.nodeModel){return e._dataGridCollection.get(t.nodeModel.id)._attributes.owner}return t.cellModel}}}},_getUserLogin:function(){var e=this._currentUser,t="";return void 0!==e&&(t=e.login),t},_getUserName:function(){var e=this._currentUser,t="";return void 0!==e&&(t=e.firstName+" "+e.lastName),t},_getLockStatus:function(e){let t,i=e.id,n=this._dataGridCollection.get(i);if(i&&n){let e=n._attributes["ds6w:reserved"];t="boolean"==typeof e?e:"TRUE"===e.toUpperCase()}return t},_getLockedByNls:function(e){let t,i=this._getLockStatus(e),n=e.id,s=this._dataGridCollection.get(n);i?t=!this._isLockedByMe(e)&&s._attributes.nlsObj?{shortHelp:a.get("LockedBy")+" "+s._attributes.nlsObj["ds6w:reservedBy"]}:{shortHelp:a.get("LockedByMe")}:s._attributes.nlsObj&&(t={shortHelp:s._attributes.nlsObj["ds6w:reserved"]});return t},_isLockedByMe:function(e){let t,i=this._getLockStatus(e);if(e){let o=e.id,a=this._dataGridCollection.get(o);if(i){let e=a._attributes["ds6w:reservedBy"]?this._dataGridCollection.get(o)._attributes["ds6w:reservedBy"]:"";var n=this._getUserLogin(),s=this._getUserName();void 0!==e&&e.trim().length>0&&(t=n&&e.toUpperCase().trim()===n.toUpperCase().trim(),t||(t=s&&e.toUpperCase().trim()===s.toUpperCase().trim()))}}return t}})})),define("DS/SNNavigationMap/views/popups/Favorite",["UWA/Core","UWA/Class/View","DS/UIKIT/SuperModal","DS/UIKIT/Form","DS/SNNavigationMap/MapSettings","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n,s,o){"use strict";return i.extend({className:"favorite-modal",_favoriteTitle:"",_favOpen:!1,init:function(e,t){this.options={...e,className:this.className,animate:!0,closable:!0},this._parent(this.options),e.favoriteTile&&(this._favoriteTitle=e.favoriteTile),t&&(this._favOpen=t.favOpen,t.saveIn?this.favoriteSaveIn():t.favOpen?this.favoriteSave(!1):this.favoriteSaveAs(!1))},favoriteSave:function(t){var i=this,n=e.createElement("div",{class:"Favorite-OverwriteContainer"}),s=o.replace(o.get("Favorite-Overwrite"),{favName:this._favoriteTitle});e.createElement("div",{html:s}).inject(n),e.createElement("div",{html:o.get("Favorite-Confirm")}).inject(n),this.dialog({body:n,title:o.get("SNNavigationMap.Favorite.Title"),maxlength:80,buttons:[{className:"primary",value:o.get("SNNCustomize_Save"),action:function(e){i.dispatchEvent("ENORIPE_UpdateFav",t),e.hide(),setTimeout((()=>{i.destroyInstance()}),1e3)}},{value:o.get("Favorite_SaveAs"),action:function(){i.favoriteSaveAs(t,!0)}},{value:o.get("SNNCustomize_Cancel"),action:function(e){e.hide(),setTimeout((()=>{i.destroyInstance()}),1e3)}}]})},favoriteSaveAs:function(t,i){var a=this,r=null,l=null;s._getListOfSecurityContext().then((function(c){r=c,l=s.getOption("selectedSCForFav");for(var d=0;d<r.length;d++)if(l===r[d].value){r[d].selected=!0;break}var h={fields:[{type:"text",required:!0,pattern:"^(?!\\s*$)[^!@#$%^&*()+=\\[\\]\\\\';,./{}|\":<>?-]+(?:\\s+[^!@#$%^&*()+=\\[\\]\\\\';,./{}|\":<>?-]+)*\\s*$",value:"",placeholder:o.get("Favorite_SaveAsPlaceholder"),label:o.get("Favorite_SaveAsPlaceholder"),name:"inputval",maxlength:80},{type:"select",label:o.get("Favorite_SelectPlaceholder"),name:"securitycontext",options:r}],events:{onSubmit:function(e){0===e.inputval.trim().length?!p.getParent()&&a.modals.current.elements.body&&a.modals.current.getBody().addContent(p):(a.dispatchEvent("ENORIPE_CreateFavorite",[e,t]),a.modals.current.hide(),setTimeout((()=>{a.destroyInstance()}),1e3))},onInvalid:function(){var e="";e=0===g.value.trim().length?o.get("Favorite_EmptyErr"):(e=o.get("Customize_SpecialCharErr")).concat(" !@#$%^&*()+=[]\\';,./{}|\":<>?-"),p.setContent(e),p.getParent()||a.modals.current.elements.body&&a.modals.current.getBody().addContent(p)}}},u=new n(h),g=u.elements.container.getElement("input"),p=e.createElement("div",{class:"Customize-ProfileNameError",html:""});a.dialog({body:u,title:o.get("SNNavigationMap.Favorite.Title"),buttons:[{className:"primary",value:o.get("SNNCustomize_Save"),action:function(){u.submit()}},{value:o.get("SNNCustomize_Cancel"),action:function(e){e.hide(),setTimeout((()=>{a.destroyInstance()}),1e3)}}]}),i&&a.next(),g.addEventListener("click",(function(e){this.focus()}))}))},favoriteSaveIn:function(){var t=this,i=e.createElement("div",{class:"favorite-SaveInContainer"});e.createElement("p",{html:o.get("SNNavigationMap.SaveFavoriteModal.BodyIntroduction")}).inject(i),e.createElement("p",{html:o.get("SNNavigationMap.SaveFavoriteModal.BodyQuestion")}).inject(i),this.dialog({body:i,title:o.get("SNNavigationMap.Favorite.Title"),maxlength:80,buttons:[{value:o.get("save"),className:"primary save",action:function(e){this._favOpen?this.favoriteSave(!0):this.favoriteSaveAs(!0),this.next()}.bind(this)},{value:o.get("dontSave"),className:"default dont-save",action:function(e){this.dispatchEvent("ENORIPE_ShowHomePage"),e.hide(),setTimeout((()=>{t.destroyInstance()}),1e3)}.bind(this)},{value:o.get("cancel"),className:"default cancel",action:function(e){e.hide(),setTimeout((()=>{t.destroyInstance()}),1e3)}.bind(this)}]})},destroyInstance:function(){for(var e in this._events={},this)this.hasOwnProperty(e)&&(this[e]=null);"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf(this,null):this.__proto__=null}})})),define("DS/SNNavigationMap/views/CustomizeAllView",["UWA/Core","UWA/Class/View","DS/WebappsUtils/WebappsUtils","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Tab","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/SNNavigationMap/views/CustomizeRelationsView","DS/SNNavigationMap/views/CustomizeAttributeView","DS/SNNavigationMap/views/DisplayOptionsView","DS/SNNavigationMap/utils/SNNavigationServices","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n,s,o,a,r,l,c,d,h,u,g,p,f){"use strict";return t.extend({name:"CustomizeAll",_dialog:null,className:function(){return this.getClassNames("-container")},setup:function(e){this._immersiveFrame=new n,this._immersiveFrame.inject(this.container),this.dimensions={},this.dimensions.position={},this.dimensions.dialogWidth=800,this.dimensions.dialogHeight=500,this.dimensions.position.offsetX=0,this.dimensions.position.offsetY=300,this._changesInTabs={CustomizeRelations:!1,CustomizeAttributes:!1,DisplayOptions:!1},this._customizeRelationsOptions=e},render:function(e,t){if(null===this._dialog){var i=this._getDialogBody(e,t);this._createDialog(i)}else{if(this._customizeRelationsView)this._customizeRelationsView.resizeDatagrid();else if(this.customizeTab)this.customizeTab.getPageContentFromValue("CustomizeRelations").innerHTML=this._getErrorDiv(f.get("SNNavigationMap.CustomizeRelations.Title")).outerHTML;if(this._customizeAttributesView)this._customizeAttributesView.refreshRender(t);else if(this.customizeTab)if(null!=t)this.customizeTab.setPageContentFromValue("CustomizeAttributes",this._getCustomizeAttributesContent(t));else this.customizeTab.getPageContentFromValue("CustomizeAttributes").innerHTML=this._getErrorDiv(f.get("SNNavigationMap.CustomizeAttributes.Title")).outerHTML}this._immersiveFrame.elements.container.setStyle("z-index",300)},showRelations:function(e){this._customizeRelationsView&&this._customizeRelationsView.showRelations(e)},updateProfile:function(e){this._customizeRelationsView&&this._customizeRelationsView.updateProfile(e)},relationSetSaved:function(e){this._customizeRelationsView.alertRelationSetSaved(e)},relationSetDeleted:function(e){this._customizeRelationsView.alertRelationSetDeleted(e)},updateRelationsDisplayed:function(e,t){this._customizeRelationsView.updateRelationsDisplayed(e,t)},loadingCustomizeRelations:function(){this._customizeRelationsView&&this._customizeRelationsView.loadingRelations()},unloadCustomizeRelations:function(){this._customizeRelationsView.unloadRelations()},_updateSaveButton:function(e){if(this._dialog){e&&(this._changesInTabs[e.tabName]=e.areThereChanges);var t=Object.values(this._changesInTabs);this._dialog.buttons.Save.disabled=t.every((e=>!1===e))}},_createDialog:function(e){this._dialog=new s({title:f.get("SNNavigationMap.CustomizeAll.Title"),content:e,immersiveFrame:this._immersiveFrame,expandedFlag:!1,width:this.dimensions.dialogWidth,height:this.dimensions.dialogHeight,minWidth:400,minHeight:250,resizableFlag:!0,position:{at:"top center",offsetX:this.dimensions.position.offsetX,offsetY:this.dimensions.position.offsetY},buttons:{Cancel:new o({label:f.get("SNNCustomize_Cancel"),onClick:function(){this.areThereChangesInTabs()?this.showCancelConfirmationDialog():this._cancelClick()}.bind(this)}),Save:new o({label:f.get("SNNCustomize_Save"),onClick:function(){let e=!this._customizeRelationsView.isProfileAutoCompleteEmpty(),t=this._customizeAttributesView.areThereEnoughAttributes();e&&t?this._okClick():this.showCancelConfirmationDialog(e,t)}.bind(this)})},modalFlag:!0}),this._dialog.buttons.Save.disabled=!0,this._dialog.close=function(){this.areThereChangesInTabs()?this.showCancelConfirmationDialog():this._cancelClick()}.bind(this)},_getDialogBody:function(t,i){var n=new e.createElement("div",{class:"customize-all-dialog-body"});return this._getDialogTabBarComponentContent(t,i).inject(n),n},_getDialogTabBarComponentContent:function(e,t){var i=this;i.customizeTab=new a({displayStyle:"strip",touchMode:!0});var n=null;n=null!=e?i._getCustomizeRelationsContent(e):i._getErrorDiv(f.get("SNNavigationMap.CustomizeRelations.Title")),i.customizeTab.add({label:f.get("SNNavigationMap.Customize.Title"),isSelected:!0,value:"CustomizeRelations",content:n,icon:{iconName:"object-related-cog",fontIconFamily:WUXManagedFontIcons.Font3DS}});var s=null;return s=null!=t?i._getCustomizeAttributesContent(t):i._getErrorDiv(f.get("SNNavigationMap.CustomizeAttributes.Title")),i.customizeTab.add({label:f.get("CustomizeAttr-Attributes"),content:s,value:"CustomizeAttributes",icon:{iconName:"attributes-cog",fontIconFamily:WUXManagedFontIcons.Font3DS}}),i.customizeTab.add({label:f.get("SNNavigationMap.CustomizeDisplayOptions.Title"),content:i._getDisplayOptionsContent(),value:"DisplayOptions",icon:{iconName:"eye-cog",fontIconFamily:WUXManagedFontIcons.Font3DS}}),i.customizeTab},_getCustomizeRelationsContent:function(t){var i=new e.createElement("div",{class:"customize-all-tab-content customize-relations-content"});return this._customizeRelationsView=new c(this._customizeRelationsOptions),this._customizeRelationsView.inject(i),this._setUpListenEventsForCustomizeRelationsView(),this._customizeRelationsView.render(t),i},_getCustomizeAttributesContent:function(t){var i=this,n=new e.createElement("div",{class:"customize-all-tab-content customize-attributes-content"});return this._customizeAttributesView=new d({iswebinwin:u.isWebInWin()}),this._customizeAttributesView.inject(n),i.listenTo(i._customizeAttributesView,"CustomizeAllView_updateSaveButton",i._updateSaveButton),this.listenTo(this._customizeAttributesView,"CustomizeAllView_UpdateAttributes",(e=>{i.dispatchEvent("ENORIPE_UpdateAttributes",e)})),this._customizeAttributesView.render(t),n},_getDisplayOptionsContent:function(){var t=new e.createElement("div",{class:"customize-all-tab-content customize-displayoptions-content"});return this._displayOptionsView=new h,this._displayOptionsView.inject(t),this._setUpListenEventsForDisplayOptionsView(),this._displayOptionsView.render(),t},getDisplayOptionView:function(){return this._displayOptionsView},_getErrorDiv:function(t){let i=f.replace(f.get("SNNavigationMap.CustomizeErrorDiv.Msg"),{tabName:t});return e.createElement("div",{class:"customize-error-div",html:i})},switchToTab:function(e){this.customizeTab&&"undefined"!==this._changesInTabs[e]&&(this.customizeTab.value=[e])},showCancelConfirmationDialog:function(t=!0,n=!0){var s=f.get("Customize-SaveText");if(n||(s=f.get("SNNavigationMap.CustomizeAll.SaveModal.AtLeast3AttributesSelectedMsg")),t||(s=f.get("SNNavigationMap.CustomizeAll.SaveModal.NoRelationSetSelectedMsg")),this.modalSave)this.modalSave.getBody().getElement(".modalBody-text").innerHTML=s,this.modalSave.show();else{this.modalSave=new r({className:"modal-save modalWarning",closable:!0,header:"<h4>"+f.get("SNNavigationMap.CustomizeAll.SaveModal.Title")+"</h4>"}).inject(this.container);var o=e.createElement("div",{class:"actionButton-container"});new l({value:f.get("SNNCustomize_Save"),className:"primary save",events:{onClick:function(){this._okClick(),this.modalSave.hide()}.bind(this)}}).inject(o),new l({value:f.get("dontSave"),className:"default dontSave",events:{onClick:function(){this._cancelClick(),this.modalSave.hide()}.bind(this)}}).inject(o),new l({value:f.get("cancel"),className:"default cancel",events:{onClick:function(){this.modalSave.hide()}.bind(this)}}).inject(o),this.modalSave.setFooter(o);var a=e.createElement("div",{class:"modalBody-container"});e.createElement("img",{class:"modalBody-icon",src:i.getWebappsAssetUrl("SNNavigationMap","icons/warning_icon.png")}).inject(a);var c=e.createElement("div",{class:"modalBody-text-container"}).inject(a);e.createElement("span",{class:"modalBody-question",html:f.get("Customize-SaveQuestion")}).inject(c),e.createElement("span",{class:"modalBody-text",html:s}).inject(c),this.modalSave.setBody(a),this.modalSave.show()}},areThereChangesInTabs:function(){return Object.values(this._changesInTabs).some((function(e){if(!0===e)return!0}))},_setUpListenEventsForCustomizeRelationsView:function(){var e=this;e.listenTo(e._customizeRelationsView,"CustomizeAllView_UpdateSaveButton",e._updateSaveButton),e.listenTo(e._customizeRelationsView,"CustomizeAllView_UpdatePref",((t,i)=>{e.dispatchEvent("ENORIPE_updatePref",[t,i])})),e.listenTo(e._customizeRelationsView,"CustomizeAllView_UpdateRelations",(t=>{e.dispatchEvent("ENORIPE_updateRelations",t)})),e.listenTo(e._customizeRelationsView,"CustomizeAllView_CreateNewProfile",(t=>{e.dispatchEvent("ENORIPE_CreateNewProfile",t)})),e.listenTo(e._customizeRelationsView,"CustomizeAllView_SaveNewProfile",(t=>{e.dispatchEvent("ENORIPE_SaveNewProfile",t)})),e.listenTo(e._customizeRelationsView,"CustomizeAllView_DeleteProfile",((t,i)=>{e.dispatchEvent("ENORIPE_DeleteProfile",[t,i])})),e.listenTo(e._customizeRelationsView,"CustomizeAllView_SetRecentRelationSet",(t=>{e.dispatchEvent("ENORIPE_SetRecentRelationSet",[t])}))},_setUpListenEventsForDisplayOptionsView:function(){var e=this;e.listenTo(e._displayOptionsView,"CustomizeAllView_updateSaveButton",e._updateSaveButton),e.listenTo(e._displayOptionsView,"CustomizeAllView_updateDisplayOptions",(t=>{e.dispatchEvent("ENORIPE_updateDisplayOptions",t)}))},_okClick:function(){this._changesInTabs.CustomizeRelations&&(this._customizeRelationsView.save(),p.trackUsage("CustomizePanel","ChangesOnCustomizeRelations")),this._changesInTabs.CustomizeAttributes&&(this._customizeAttributesView.save(),p.trackUsage("CustomizePanel","ChangesOnCustomizeAttributes")),this._changesInTabs.DisplayOptions&&(this._displayOptionsView.save(),p.trackUsage("CustomizePanel","ChangesOnDisplayOptions")),this.destroyCurrentDialog(),this._updateSaveButton()},_cancelClick:function(){(this._changesInTabs.CustomizeRelations||this._customizeRelationsView.isProfileAutoCompleteEmpty())&&this._customizeRelationsView.cancel(),this._changesInTabs.CustomizeAttributes&&this._customizeAttributesView.cancel(),this._changesInTabs.DisplayOptions&&this._displayOptionsView.cancel(),this.destroyCurrentDialog(),this._updateSaveButton()},destroyCurrentDialog:function(){this._immersiveFrame.elements.container.setStyle("z-index",0),this.dimensions.dialogWidth=this._dialog.width,this.dimensions.dialogHeight=this._dialog.height,this.dimensions.position.offsetX=this._dialog.position.offsetX,this.dimensions.position.offsetY=this._dialog.position.offsetY,this._dialog._applyPosition(),this._changesInRelationsTab=!1,this._changesInAttributesTab=!1,this._changesInDisplayOptionsTab=!1,this._changesInTabs={CustomizeRelations:!1,CustomizeAttributes:!1,DisplayOptions:!1},this.hide()}})})),define("DS/SNNavigationMap/views/DataGridView",["UWA/Core","UWA/Class","UWA/Class/View","UWA/Controls/Abstract","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/SNNavigationMap/utils/PreferencesUtils","DS/i3DXCompassPlatformServices/OpenWith","DS/Windows/ImmersiveFrame","DS/Utilities/Utils","DS/Utilities/DateUtils","DS/SNNavigationMap/utils/CommonUtils","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/DataGridCustoColumnsUtils","DS/SNNavigationMap/utils/ProbesUtils","DS/WebappsUtils/WebappsUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/SNNavigationMap/utils/AdditionalColumnsUtils"],(function(e,t,i,n,s,o,a,r,l,c,d,h,u,g,p,f,m,v,_,S){"use strict";return i.extend({name:"datagrid-view",tree:{},collectionView:{},models:[],cols:[],attributes:[],promiseManager:{},isWebInWin:!1,modelsToAdd:{},linksInTree:[],expandingModelIds:[],expandDirection:{upstream:!0,downstream:!0},rightClickModel:null,tenantName:"",instancesNumberByLinks:{},_countInfos:{},_custoColumns:[],_taggerInUse:!1,_nbFixedColumn:3,_fromSwitch:!1,_filterOn:!1,TIMEOUT:6e4,LOOPINTERVAL:1e3,className:function(){return this.getClassNames("-container")},setup:function(e){this.tree=new s,this.promiseManager=e.promiseManager||null,this.isWebInWin=e.isWebInWin||!1,this.collection=e.collection,this.tenantName=e.tenantName||"OnPremise",this._custoColumns=new f(this.collection).getCustoColumns()},buildSkeleton:async function(e,t,i,n){var s=this;if(this.additionalColumns={},!!i.find((e=>!0===e.additionalColumn))){(await S.getConfigurationColumns()).forEach((e=>{this.additionalColumns[e.dataIndex]=e}))}this._fromSwitch=n,this.clear(),i&&(this.attributes=i),this.cols=[{text:_.get("DatagridColumn-Title"),dataIndex:"tree",typeRepresentation:"string",width:250,getCellKPIColor:function(e){if(!e.isHeader&&e.nodeModel&&e.nodeModel.options.color)return e.nodeModel.options.color}},{text:_.get("DatagridColumn-Title"),dataIndex:"instanceTitle",typeRepresentation:"string",icon:"flow-cascade",visibleFlag:p.getInstancesMode()},{text:_.get("DatagridColumn-Relation"),dataIndex:"relation",typeRepresentation:"string",icon:this.expandDirection.upstream&&this.expandDirection.downstream?"":"filter",width:100},{text:"Direction",dataIndex:"linkDirection",typeRepresentation:"string",visibleFlag:!1}],this._nbFixedColumn=p.getInstancesMode()?3:2;for(var o={},c=0;c<i.length;c++)if("ds6w:label"!==i[c].uri){if(i[c].uri in this._custoColumns)o={text:i[c].label,...this._custoColumns[i[c].uri]};else if(i[c].uri in this.additionalColumns)o={text:i[c].label,...this.additionalColumns[i[c].uri],typeRepresentation:"string",visibleFlag:!0};else{var g="ds6w:modified"===i[c].uri?"datetime":"string";void 0!==i[c].dataType&&(g=i[c].dataType.toLowerCase()),"real"===g?g="string":"timestamp"===g&&(g="datetime"),o={text:i[c].label,dataIndex:i[c].uri,typeRepresentation:g,alignment:"boolean"===g?"center":"near"}}this.cols.push(o)}this.cols=this.cols.map((e=>void 0===e.getCellTooltip?{...e,getCellTooltip:(e=>{var t=void 0;if(e.nodeModel&&e.nodeModel.options.grid&&e.nodeModel.options.grid.nlsObj){var i=s.collectionView.getColumnOrGroup(e.columnID),n=i.dataIndex;"tree"===i.dataIndex&&(n="ds6w:label"),"relation"===n?t=e.nodeModel.options.grid.relation:(t=e.nodeModel.options.grid.nlsObj[n],"datetime"===i.typeRepresentation&&t&&(t=u.formatDateToString(new Date(t),{timePrecision:"min"})))}return void 0!==t?{shortHelp:t}:s.collectionView.getCellDefaultTooltip(e)}).bind(s)}:e)),this.cols=this.setColumnsWidth(this.cols);var f=new r({cellHeight:38,useLastColumnWidthAutoFlag:!0});this.collectionView=new a({treeDocument:this.tree,columns:this.cols,showRowIndexFlag:!1,cellDragEnabledFlag:!0,showRowBorderFlag:!0,showColumnBorderFlag:!0,showSelectionCheckBoxesFlag:!0,columnDragEnabledFlag:!1,rowSelection:"multiple",cellSelection:"none",useDragAndDrop:!0,useAsyncPreExpand:!0,selectionBehavior:{unselectAllOnEmptyArea:!0,toggle:!1,canMultiSelect:!0,enableShiftSelection:!0,canInteractiveMultiselectWithCheckboxClick:!0},defaultColumnDef:{editableFlag:!1,alignment:"near"},layout:f,identifier:"ENORIPE_AP-mainViewDatagrid",useWidgetPreferencesFlag:!0,sortModel:[{dataIndex:"linkDirection",sort:"desc"},{dataIndex:"relation",sort:"asc"},{dataIndex:"tree",sort:"asc"}],onDelayedModelDataRequest:function(e){h.debounce(function(){this.updateAttributes(e),this.updateFiltering(e)}.bind(this),500)()}.bind(this),onContextualEvent:function(e){return this._buildContextualMenu(e).then((function(e){return e}))}.bind(this)});var m=new d;m.setContentInBackgroundLayer(this.collectionView.getContent()),m.reactToPointerEventsFlag=!1,m.inject(this.container);let v=l.getPref("expandedDirection")||null;v&&this.setExpandDirection(v),this.setRootNodes(e,n,!0),this.setData(!1,!1),this._setFilterModel(),this._setRowEvent(),this._setDatagridEvent(),this.collectionView.requestDelayedModelData("OnScrollEnd")},setData:function(e,t,i=1,n=0){var s={},o=[],a=[],r={},c=!1;o=this.collection.where({modelType:"link"}),this._fromSwitch=e,0===this.expandingModelIds.length&&(c=!0);const d=this.expandingModelIds.slice();if((a=this.tree.getAllDescendants()).forEach(function(e){(0===this.expandingModelIds.length||this.expandingModelIds.indexOf(e._id)>-1)&&(s[e.id]||(s[e.id]=[]),s[e.id].push(e))}.bind(this)),this.instancesNumberByLinks={},p.getInstancesMode()||(o=this.filterLinksWOInstances(o,Object.keys(s))),o.forEach(function(e){r={...r,...this.getModelToAdd(e,s)}}.bind(this)),this.tree.prepareUpdate(),Object.keys(r).length>0){this._addRelationsNode(Object.keys(r),c),n++;let s=l.getPref("expandNLevel");s>0&&t&&(i=s),i>0&&i>=n&&this.setData(e,t,i,n)}this.collectionView.reapplySortModel(),this.tree.pushUpdate(),d.forEach((e=>{a.find((t=>t._id===e)).preExpandDone()}))},_setFilterModel:function(){let e={};for(let t of this.cols){let i=t.dataIndex;"tree"===i&&(i="label");let n=this._getFilterIdForColumn(t);"ds6w:type"!==i&&"relation"!==i||(n="set"),e[i]={filterId:n}}this.tree.setFilterModel(e)},createNode:function(e,t){var i,n,s={},a={},r="";if(e.nlsObj&&(e={...e,...e.nlsObj}),t&&(e={...e,...t},r=this.getDirectionIcon(t.linkDirection),Object.keys(this.instancesNumberByLinks).indexOf(t.linkId)>-1&&(e.relation=e.relation+" ("+this.instancesNumberByLinks[t.linkId]+")")),"Person"===e.type){let t=e["ds6w:identifier"];t&&(i=g.getUser3DSwymPictureURL(t))&&""!==i&&(e.type_icon_url=i,n={iconPath:e.type_icon_url,className:"dgv-user-thumbnail"})}if(n||(n={iconPath:e.type_icon_url}),a={label:e.name,icons:[{iconName:r},n],children:[],grid:e},this._fromSwitch||(a.icons[1].badges={topLeft:{iconName:"reload wux-ui-3ds-spin",fontIconSize:"1x",className:"dgv-badge-top"}}),(s=new o(a)).id=e.id,!0===e.focus){var l=this.tree.getXSO();let e={isMultisel:this.getSelectedModels().length>1,nodeId:s.id,action:"add",selected:!0};s.getAttributeValue("instanceId")&&(e.instanceId=s.getAttributeValue("instanceId")),this.dispatchEvent("ENORIPE_onRowClicked",e),l.add(s)}return s.onPostCollapse(function(e){var t=[...s.getAllDescendants({treeTraversalOrder:"postOrder"})];this._collapseNode(t,s),m.trackUsage("Collapse","AllDirectionsCtx")}.bind(this)),s.onPreExpand(function(t){var i=[];this._taggerInUse||(this._manageExpandingState(s),e.counts&&(i=e.counts.getRealCountAttribute("name")),this.dispatchEvent("ENORIPE_ExpandNode",[[s.id],i]),m.trackUsage("Expand","AllDirectionsCtx"))}.bind(this)),s},_isChild:function(e,t){var i=e.getChildren();if(i)for(var n=0;n<i.length;n++)if(i[n].id===t)return!0;return!1},_addRelationsNode:function(e,t){var i=!1;e.forEach(function(e){i=this.setNewChildNode(e,t),delete this.modelsToAdd[e]}.bind(this)),i&&this.dispatchEvent("ENORIPE_UpdateCollectionWithView")},_addRootNodes:function(e){var t={};this.tree.prepareUpdate(),e.forEach(function(e){p.getInstancesMode()&&e.instances&&e.instances.length>0?e.instances.forEach(function(i){let n={...e};n.instanceTitle=i["ds6w:label"],n.instanceId=i.id,t=this.createNode(n),this.tree.addRoot(t)}.bind(this)):(t=this.createNode(e),this.tree.addRoot(t))}.bind(this)),this.collectionView.reapplySortModel(),this.tree.pushUpdate()},setRootNodes:function(e,t,i){var n=[],s=[];this._fromSwitch=t,e.forEach(function(e){this.models.indexOf(e)<0&&this.models.push(e)}.bind(this)),e.forEach(function(e){var t=e._attributes;s.push(t),t.nlsObj||n.push({targetId:t.id})}.bind(this));this.collection.getNodesIds().length===e.length&&e.every(function(e){return this.collection.getNodesIds().includes(e.id)}.bind(this));this.tree.prepareUpdate(),this._addRootNodes(s),t&&this.setData(t,!1),this.tree.pushUpdate()},setNewChildNode:function(e,t){var i=null,n=this.modelsToAdd[e],s=!1,o="collapsed",a=!1;return this.collection.get(e)&&this.collection.get(e)._attributes&&(i={...this.collection.get(e)._attributes}),i&&n.forEach(function(e){this.mustBeHidden(e)?a=!0:e.sources.forEach(function(n){this.collection.get(n.id)&&this.collection.get(n.id).get("counts");if(t&&(i.fromInit=!0),p.getInstancesMode()&&i.instances&&i.instances.length>0&&i.instances.forEach(function(t){if(e.linkId.contains(t.id)){i.instanceTitle=t["ds6w:label"],i.instanceId=t.id;let a=this.createNode(i,e);return n.addChild(a),o=this.getExpandStatus(a.getAttributeValue("counts"),a),this.expandingModelIds.indexOf(a._id)>-1&&this.expandingModelIds.splice(this.expandingModelIds.indexOf(a._id),1),void(s=!0)}}.bind(this)),!s){let t=this.createNode(i,e);n.addChild(t),o=this.getExpandStatus(t.getAttributeValue("counts"),t),this.expandingModelIds.indexOf(t._id)>-1&&this.expandingModelIds.splice(this.expandingModelIds.indexOf(t._id),1)}t&&this.setNodeInExpandingState(n),o=this.getExpandStatus(n.getAttributeValue("counts"),n),this.setNodeExpandState(n,o),this.expandingModelIds.indexOf(n._id)>-1&&this.expandingModelIds.splice(this.expandingModelIds.indexOf(n._id),1),s=!1}.bind(this))}.bind(this)),a},toggleAllInstances:function(){var e=!this.collectionView.layout.getColumnVisibleFlag("instanceTitle");this.collectionView.layout.setColumnVisibleFlag("instanceTitle",e),this._nbFixedColumn=e?3:2;var t=this.getRootModels();this.tree.empty(),this.clearTree(),this.setRootNodes(t,!0,!1)},setNodeInExpandingState:function(e,t){if(this.expandingModelIds.push(e._id),e.setState({state:"expanding"}),e.setAttribute("isExpanding",!0),e.options&&e.options.icons&&(t||!this._fromSwitch)){let t=UWA.clone(e.options.icons);t[1].badges={topLeft:{iconName:"reload wux-ui-3ds-spin",fontIconSize:"1x",className:"dgv-badge-top"}},e.updateOptions({icons:t})}},setNodeExpandState:function(e,t){var i=UWA.clone(e.options.icons);e.setState({state:t}),e.preExpandDone({state:t}),i[1].badges&&(i[1].badges.topLeft=null,e.updateOptions({icons:i}))},updateColumns:function(e){for(var t=-1,i=[],n=-1,s=-1,o=0;o<e.length;o++)"ds6w:label"!==e[o].uri&&(t=this.collectionView.layout.getColumnIndex(e[o].uri))>=0&&(n=(i=this.collectionView.layout.getVisibleOrderedColumnsIndexes()).indexOf(t)+1,s=i[o+(this._nbFixedColumn-1)],n!=o+this._nbFixedColumn&&this.collectionView.layout.moveColumn(t,s))},updateColumnIcon:function(e,t){var i;i=this.collectionView.layout.getColumnIndex(e),this.collectionView.layout.setColumnOrGroupProperties(i,{icon:t})},collapseNode:function(e,t){var i=[];this.tree.getSelectedNodes().forEach(function(n){t.indexOf(n.id)>-1&&(i=[],n.getChildren().forEach((function(t){e.indexOf(t.id)>-1&&i.push(t)})),i.length>0&&this._collapseNode(i,n))}.bind(this))},_collapseNode:function(e,t){var i=[];e.forEach(function(e){1===this.getAllNodesById(e.id).length&&i.push(e.id),e.remove(),e.getAttributeValue("linkId")&&this.linksInTree.indexOf(e.getAttributeValue("linkId"))>-1&&(this.linksInTree.splice(this.linksInTree.indexOf(e.getAttributeValue("linkId")),1),i.push(e.getAttributeValue("linkId")))}.bind(this)),t.getNumberOfVisibleChildren()>0?t.setState({state:"partiallyExpanded"}):t.setState({state:"collapsed"}),this.expandingModelIds.indexOf(t._id)>-1&&this.expandingModelIds.splice(this.expandingModelIds.indexOf(t._id),1),this.dispatchEvent("ENORIPE_CollapseNode",[[t.id],i,this.getVisibleNodes(!1)])},setExpandDirection:function(e){null!=e.upstream&&(this.expandDirection.upstream=e.upstream),null!=e.downstream&&(this.expandDirection.downstream=e.downstream)},setColumnsWidth:function(e){var t=[];return(t=l.getPref("dgvOptions"))&&(t.forEach((function(t){e.find((function(i,n){if(i.dataIndex===t.dataIndex&&t.width)return e[n].width=t.width,!0}))})),l.setPrefLocally("dgvOptions",t)),e},_manageExpandingState:function(e){if(!this._taggerInUse){e.getChildren().forEach((function(e){e.isHidden()&&e.show()})),this.setNodeInExpandingState(e,!0)}},manageSelectedNodesExpandingState:function(){this.tree.getSelectedNodes().forEach((e=>{this._manageExpandingState(e)}))},addToSelection:function(e,t){var i=this.tree.getXSO();this.getAllNodesById(e).forEach((function(e){e.isSelected()||(t?e.getAttributeValue("instanceId")===t&&i.add(e):i.add(e))}))},removeToSelection:function(e,t){var i=this.tree.getXSO();this.getAllNodesById(e).forEach((function(e){e.isSelected()&&(t?e.getAttributeValue("instanceId")===t&&i.remove(e):i.remove(e))}))},updateAttributes:function(e){var t=this,i=this.getVisibleNodes(),n=[],s=[],o=[],a={},r={},l={};let c={ids:[],modelType:"AllTypes",isInstances:!0,models:{}};this.tree.prepareUpdate();for(var d=e.startNodeIndex;d<=e.endNodeIndex;d++)if(i[d]&&this.collection.get(i[d].id)){!(r=this.collection.get(i[d].id)._attributes).nlsObj&&n.indexOf(i[d].id)<0&&n.push(i[d].id),s.push(i[d].id);let e=r.instances||[];o.push(...e.map((e=>e.id)));let t=i[d].options.grid.instanceId;if(t){let i=e.find((e=>e.id===t));i&&(i.nlsObj?a[i.id]=i:(c.modelType=i.type,c.ids.push(i.id),c.models[i.id]={_attributes:i}))}}Object.keys(a).forEach((e=>{const t=a[e].nlsObj;let n=i.filter((t=>{if(t.options.grid.instanceId)return t.options.grid.instanceId===e}));n.length&&n.forEach((e=>{l=e.options.grid,l={...l,...t,...l.nlsObj},e.updateOptions({grid:l})}))})),c.ids.length>0&&this._updateAttributesForInstances(i,c),n.length>0&&this._getNls(n).then((function(e){e.forEach((function(e){t.getAllNodesById(e).forEach((function(e){l=t.collection.get(e.id)._attributes,l={...l,...l.nlsObj},e.updateOptions({grid:l})}))}))})),this._updateConfigurationAttributes(i,s,o),this.tree.pushUpdate()},_updateAttributesForInstances:function(e,t){var i=this,n={},s={},o={};t.models&&(n=g.getAttributes(t.modelType),s=g._prepareDataToNls(Object.values(t.models).map((e=>e._attributes))),g._getNlsAndProcessData(s,t.ids,t.models,t.isInstances).then((function(s){let a;s={...s,...n},Object.keys(s.nlsObj).forEach((n=>{a=i.collection.setNlsObj(n,s.nlsObj[n],t.isInstances);let r=e.filter((e=>{if(e._options.grid.instanceId)return e.options.grid.instanceId===n}));r.length&&r.forEach((e=>{o=e.options.grid,o={...o,...a,...o.nlsObj},e.updateOptions({grid:o})}))}))})))},_updateConfigurationAttributes:function(e,t,i){if(p.getInstancesMode()){if(this.collectionView.layout._originalLeafColumns.filter((e=>"cfgEffectivty"===e.columnModule)).length){require(["DS/CfgWebAppEffectivityUX/scripts/CfgEffectivityColumns"],(function(n){let s={pids:t,relids:i,pairs:{}};n.updateAttributes(s,(function(t){if(t.relids){let i={};s.relids.forEach((n=>{const s=t.relids[n];let o=e.filter((e=>{if(e._options.grid.instanceId)return e.options.grid.instanceId===n}));o.length&&o.forEach((e=>{i=e.options.grid,i={...i,...s,...i.nlsObj},e.updateOptions({grid:i})}))}))}}))}))}}},_buildModelToAdd:function(e,t){for(var i=e.targetId,n=e.link,s={},o=null,a={sources:[]},r="",l="",c=[],d="",h=(this.tree.getAllDescendants(),0);h<t[e.sourceId].length;h++)if(o=t[e.sourceId][h],s=g.getProfileDirections(n.get("type")),e.inverseDirection&&s._from?(r=n.get("type").replace("_to","_from"),l=_[r+"_short"]||_[r]||r):(r=n.get("type"),l=_[r+"_short"]||_[r]||r),"to"===(c=r.split("_"))[c.length-1]?d="downstream":"from"===c[c.length-1]&&(d="upstream"),n.set("linkDirection",d),this._getIndexModelToAdd(i,o,n.id)<0&&!this._isInBranch(o,i,r,n)&&this.expandDirection[d])if(0===a.sources.length){a.sources.push(o);var u={relation:l,linkId:n.get("id"),linkDirection:d,linkType:r,sourceId:n.get("sourceId")};a={...a,...u}}else a.sources.push(o);return 0!=a.sources.length?a:null},_setModelToAdd:function(e,t){if(e){if(this.modelsToAdd[e]){let i=Object.values(this.modelsToAdd[e]).map((e=>e.sourceId)),n=i.indexOf(t.sourceId)>-1?Object.values(this.modelsToAdd[e])[i.indexOf(t.sourceId)]:null;if("upstream"===t.linkDirection&&n&&n.relation===t.relation)return}else this.modelsToAdd[e]=[];this.modelsToAdd[e].push(t)}},_updateDirection:function(e){this.expandDirection[e]?(this.dispatchEvent("ENORIPE_HideOneDirection",e),m.trackUsage("Direction","HideDirection-"+e)):this.dispatchEvent("ENORIPE_ShowOneDirection",e),this.expandDirection[e]=!this.expandDirection[e]},updateCount:function(e,t){var i=this,n=[],s={};n=this.tree.search({match:function(e){s=UWA.clone(e.nodeModel.options.icons);let i=null;if(e.nodeModel.getParent()&&e.nodeModel.getParent().id&&e.nodeModel.getParent().getAttributeValue("isExpanding")&&(i=e.nodeModel.getParent()),t&&t.length>0){if(s[1].badges&&s[1].badges.topLeft&&(t.indexOf(e.nodeModel.id)>-1||null!=i&&t.indexOf(i.id)>-1))return!0}else if(s[1].badges&&s[1].badges.topLeft)return!0}}),this.tree.prepareUpdate(),n&&n.length>0?n.forEach(function(t){this.refreshCountNode(e,t),t.getAttributeValue("isExpanding")&&t.setAttribute("isExpanding",!1)}.bind(this)):this.tree.processDescendants({processNode:function(t){i.refreshCountNode(e,t)}}),this.tree.pushUpdate()},refreshCountNode:function(e,t){if(e.get(t.id)&&e.get(t.id).get("counts")){let i=UWA.clone(t.options.icons);if(i[1].badges&&i[1].badges.topLeft){let i=e.get(t.id).get("counts"),n=this.getExpandStatus(i,t);this.setNodeExpandState(t,n),this.expandingModelIds.indexOf(t._id)>-1&&this.expandingModelIds.splice(this.expandingModelIds.indexOf(t._id),1)}}},removeSelectedNodes:function(){var e=[],t=[];return(e=this.tree.getSelectedNodes()).forEach(function(e){var i=[...e.getChildren()];t.concat(i),i.length>0&&this.collapseNode(i,[e])}.bind(this)),t.forEach((function(t){e.includes(t)?e.includes(t)&&this.linksInTree.indexOf(t.getAttributeValue("linkId"))>-1&&this.linksInTree.splice(this.linksInTree.indexOf(t.getAttributeValue("linkId")),1):t.getParent().removeChild(t)})),this},filterLinksWOInstances:function(e,t){if(e&&e.length>0){var i=[],n="",s=-1;return e=e.filter(function(t){if(s++,t.get("instanceTargetId")){n=n.replace(t.get("instanceTargetId"),t.get("targetId"));let o=i.findIndex((function(e){return e.sourceId===t.get("sourceId")&&e.targetId===t.get("targetId")&&e.type===t.get("type")&&"in"!=t.get("direction")}));if(o<0)return i.push({sourceId:t.get("sourceId"),targetId:t.get("targetId"),type:t.get("type"),linkId:t.id}),!0;{let n=e.findIndex((function(e){return e.get("sourceId")===t.get("sourceId")&&e.get("targetId")===t.get("targetId")&&e.get("type")===t.get("type")&&"in"!=t.get("direction")}));return n>-1&&n<s&&(Object.keys(this.instancesNumberByLinks).indexOf(i[o].linkId)<0?this.instancesNumberByLinks[i[o].linkId]=2:this.instancesNumberByLinks[i[o].linkId]=this.instancesNumberByLinks[i[o].linkId]+1),!1}}return!0}.bind(this))}return[]},filter:function(e){var t=[],i=[];this.endFilter(),this._taggerInUse=!0,this._filterOn=!0,this.tree.prepareUpdate(),e.matchingIDs.forEach((n=>{this.getAllNodesById(n).forEach((n=>{e.filteredLinks&&e.filteredLinks.length>0?e.filteredLinks.indexOf(n.getAttributeValue("linkId"))>-1&&(i.push(n),t.push(n)):(i.push(n),t.push(n))}))})),t.forEach((e=>{e.getParents().forEach((e=>{let t=i.filter((t=>t._rowID===e._rowID));0===t.length&&i.push(e)}))})),this.tree.search({match:e=>{let t=e.nodeModel;if(i.indexOf(t)<0){if("collapsed"!=t.getParent().getState()){var n="partiallyExpanded"===t.getParent().getState();return t.setAttribute("filter",!0),t.hide(),0===t.getParent().getNumberOfVisibleChildren()&&n&&t.getParent().setState({state:"collapsed"}),!0}this.getRootModelsIds().indexOf(t.id)>=0&&(t.setAttribute("filter",!0),t.hide())}}}),this.tree.pushUpdate(),t.forEach((e=>{e.getParents().forEach((e=>{let i=t.filter((t=>t._rowID===e._rowID));if(0===i.length){e.setAttribute("filterAndGrayed",!0);let t=this.collectionView.layout.getCellIDFromCoordinates({rowID:e._rowID,columnID:0});if(t){let e=this.collectionView.getCellInfosAt(t);e.cellView=this.collectionView._getViewAt(t),e.cellView&&e.cellView.getContent().parentNode.addClassName("filterGrayed")}}}))}));const n=t.map((e=>e.id));return this._taggerInUse=!1,n},endFilter:function(){this._taggerInUse=!0,this._filterOn=!1,this.tree.prepareUpdate(),this.tree.getAllDescendants().forEach(function(e){if(e.getAttributeValue("filterAndGrayed")){e.setAttribute("filterAndGrayed",!1);let t=this.collectionView.layout.getCellIDFromCoordinates({rowID:e._rowID,columnID:0});if(t){let e=this.collectionView.getCellInfosAt(t);e.cellView=this.collectionView._getViewAt(t),e.cellView&&e.cellView.getContent().parentNode.classList.remove("filterGrayed")}}}.bind(this)),this.tree.getAllDescendants().forEach(function(e){e.getAttributeValue("filter")&&(e.setAttribute("filter",!1),e.show(),e.getParent().isExpanded()||e.reverseExpand())}.bind(this)),this.tree.pushUpdate(),this._taggerInUse=!1},updateFiltering:function(e){var t=this.getVisibleNodes();this.tree.prepareUpdate();for(var i=e.startNodeIndex;i<=e.endNodeIndex;i++)if(t[i]){let e=t[i],n=this.collectionView.layout.getCellIDFromCoordinates({rowID:e._rowID,columnID:0});if(n){let t=this.collectionView.getCellInfosAt(n);t.cellView=this.collectionView._getViewAt(n),t.cellView&&(t.cellView.getContent().parentNode.classList.contains("filterGrayed")&&!e.getAttributeValue("filterAndGrayed")?t.cellView.getContent().parentNode.classList.remove("filterGrayed"):!t.cellView.getContent().parentNode.classList.contains("filterGrayed")&&e.getAttributeValue("filterAndGrayed")&&t.cellView&&t.cellView.getContent().parentNode.addClassName("filterGrayed"))}}this.tree.pushUpdate()},colorize:function(e){var t={};this.tree.prepareUpdate(),e.matchingIDs&&e.matchingIDs.forEach(function(e){this.getAllNodesById(e.id).forEach(function(t){t.updateOptions({color:e.color})}.bind(this))}.bind(this)),e.filteredLinks&&e.filteredLinks.colorMap&&(t=e.filteredLinks.colorMap,this.tree.search({match:function(e){Object.keys(t).indexOf(e.nodeModel.getAttributeValue("linkId"))>-1&&e.nodeModel.updateOptions({color:t[e.nodeModel.getAttributeValue("linkId")]})}})),this.tree.pushUpdate()},unColorize:function(){this.tree.prepareUpdate(),this.tree.getAllDescendants().forEach(function(e){e.updateOptions({color:null})}.bind(this)),this.tree.pushUpdate()},_setRowEvent:function(){var e=this,t={},i=null,n=!1;(i=this.tree.getXSO()).onPostAdd((function(s){s.forEach((function(s){p.getInstancesMode()||e.getAllNodesById(s.getAttributeValue("id")).forEach((function(e){i.add(e)})),n=e.getSelectedModels().length>1,t={isMultisel:n,nodeId:s.id,action:"add",selected:!0},s.getAttributeValue("instanceId")&&(t.instanceId=s.getAttributeValue("instanceId")),e.dispatchEvent("ENORIPE_onRowClicked",t)}))})),i.onPostRemove((function(n){n.forEach((function(n){e.collection.get(n.id)&&(p.getInstancesMode()||e.getAllNodesById(n.getAttributeValue("id")).forEach((function(e){i.remove(e)})),t={isMultisel:!0,nodeId:n.id,action:"remove",selected:!1},n.getAttributeValue("instanceId")&&(t.instanceId=n.getAttributeValue("instanceId")),e.dispatchEvent("ENORIPE_onRowClicked",t))}))}))},_setDatagridEvent:function(){var e=this;this.collectionView.onDragStartCell=function(t,i){const n=i.draggedNodes.map((e=>e._options.grid));let s=g.get3DXContent(n);e.dispatchEvent("ENORIPE_dragElement",[t,s])},this.collectionView.addEventListener("userPreferencesChange",function(e){for(var t=this.collectionView.layout.getOrderedColumnsIndexes(),i=[],n=0;n<t.length;n++){let e=this.collectionView.getColumnOrGroup(t[n]);e.width&&i.push({width:e.width,dataIndex:e.dataIndex})}l.setPrefEverywhere("dgvOptions",i)}.bind(this))},_buildContextualMenu:function(e){var i=this,n=[],s={},o={},a=null;if(e.cellInfos&&e.cellInfos.nodeModel&&e.cellInfos.rowID>-1&&(a=e.cellInfos.nodeModel,this.rightClickModel=a),a){var r=this.tree.getXSO();this.getAllNodesById(a.id).forEach((function(e){e.isSelected()||(r.empty(),r.add(e))}))}return new t.Promise(function(t,r){if(this.isWebInWin?a&&(this.dispatchEvent("onRowRightClicked",[{id:a.id,context:"DataGridView"}]),t([])):a&&e.cellInfos&&e.cellInfos.rowID>-1&&(a.getAttributeValue("type")&&a.getAttributeValue("type").contains("Document")&&n.push({type:"PushItem",title:_.get("Download"),icon:{iconName:"download",fontIconFamily:1},action:{callback:function(){i.dispatchEvent("ENORIPE_DownloadDocument",[a.id,a.getAttributeValue("name")])}},state:"enabled"}),this.getExpandCollapseCtxMenu(a,!1).then(function(e){n=[...n,...e]}.bind(this)).finally((function(){const e=[a._options.grid];s=g.get3DXContent(e),(o=(new c).set3DXContent(s,!0)).retrieveCompatibleApps((function(e){if(e&&e.length>0){var i=[];if(e.forEach((function(e){i.push({type:"PushItem",title:e.text,fonticon:e.fonticon&&e.fonticon.length>0?{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon,family:WUXManagedFontIcons.Font3DS}:void 0,icon:e.icon?e.icon:"",action:{callback:e.handler}})})),i.length>0){var s={name:"OpenWith",type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+o.DROPDOWN_CONF.fonticon},title:o.DROPDOWN_CONF.text,submenu:i};n.push(s)}}t(n)}))}))),e.cellInfos&&-1===e.cellInfos.rowID){(n=e.collectionView.buildDefaultContextualMenu(e,{pin:!0,sizeColumnToFit:!0,firstColumnsVisibility:!1,columnsManagement:!1,view:"data-gridview"})).push({type:"PushItem",title:this.expandDirection.upstream?_.get("HideUpstream"):_.get("ShowUpstream"),icon:{iconName:this.expandDirection.upstream?"left-minus":"left-add",fontIconFamily:1},action:{callback:function(){this._updateDirection("upstream")}.bind(this)}}),n.push({type:"PushItem",title:this.expandDirection.downstream?_.get("HideDownstream"):_.get("ShowDownstream"),icon:{iconName:this.expandDirection.downstream?"right-minus":"right-add",fontIconFamily:1},action:{callback:function(){this._updateDirection("downstream")}.bind(this)}}),t(n)}}.bind(this))},getExpandCollapseCtxMenu:function(e,i){var n=[],s=[],o=[],a={};return new t.Promise(function(t,r){if("expanded"!==e.getState()&&"partiallyExpanded"!==e.getState()||((a={model:e,upstreamChildren:this.getChildrenInOneDirection(e,"upstream"),downstreamChildren:this.getChildrenInOneDirection(e,"downstream")}).upstreamChildren.length>0&&(a.direction="upstream",o=this._getCollapseSubMenu(a,i),n.push(o)),a.downstreamChildren.length>0&&(a.direction="downstream",o=this._getCollapseSubMenu(a,i),n.push(o)),"expanded"===e.getState()&&t(n)),"collapsed"===e.getState()||"partiallyExpanded"===e.getState()){var l={};a={model:e},e.getAttributeValue("counts")?((l=this._getCurrentCounts(e.getAttributeValue("counts"),e)).upstreamCounts.length>0&&(a.direction="upstream",s=this._getExpandSubMenu(a,l,i),n.push(s)),l.downstreamCounts.length>0&&(a.direction="downstream",s=this._getExpandSubMenu(a,l,i),n.push(s)),t(n)):r()}r()}.bind(this))},getChildrenInOneDirection:function(e,t){var i=[];return e.getChildren().forEach((function(e){e.isHidden()||e.getAttributeValue("linkDirection")===t&&i.push(e)})),i},_getExpandSubMenu:function(e,t,i){var n={},s=[],o="",a=0,r={},l={},c=[],d=[];if("upstream"===e.direction?(o="in",c=t.upstreamCounts,d=t.downstreamCounts||[]):(o="out",c=t.downstreamCounts,d=t.upstreamCounts||[]),c.forEach(function(t){(l={}).title=t.get("count")+" "+t.get("relationName"),l.callback=function(){this.setNodeInExpandingState(e.model),c.length>1?this.contextualExpandStatus="partiallyExpanded":this.contextualExpandStatus="expanded",this.dispatchEvent("ENORIPE_ExpandNode",[[e.model.id],[t.get("name")],o]),m.trackUsage("Expand","OneRelationCtx")}.bind(this),t.get("count")>0&&(s.push(this._getContextualObject(i,l)),a+=parseInt(t.get("count")))}.bind(this)),a>0){switch(e.direction){case"upstream":r.icon=i?v.getWebappsAssetUrl("SNNavigationMap","icons/upstream_arrow.png"):"left-add",r.title=_.get("SNNavigationMap.ExpandUpstream.Title")+" ("+a+")";break;case"downstream":r.icon=i?v.getWebappsAssetUrl("SNNavigationMap","icons/downstream_arrow.png"):"right-add",r.title=_.get("SNNavigationMap.ExpandDownstream.Title")+" ("+a+")";break;default:return n}r.callback=function(){this.setNodeInExpandingState(e.model),d.length>0?this.contextualExpandStatus="partiallyExpanded":this.contextualExpandStatus="expanded",this.dispatchEvent("ENORIPE_ExpandNode",[[e.model.id],[],o]),m.trackUsage("Expand","OneDirectionCtx")}.bind(this),i&&s.push(this._getContextualObject(i,{title:_.get("SNNavigationMap.ExpandAll.Title")+" ("+a+")",callback:r.callback})),n=this._getContextualObject(i,r,s)}return n},_getCollapseSubMenu:function(e,t){var i,n={},s=[],o={},a=[],r={},l=[];switch(i=e.model,e.direction){case"upstream":r.icon=t?v.getWebappsAssetUrl("SNNavigationMap","icons/upstream_arrow.png"):"left-minus",a=e.upstreamChildren,e.downstreamChildren,r.title=_.get("SNNavigationMap.CollapseUpstream.Title")+" ("+a.length+")";break;case"downstream":r.icon=t?v.getWebappsAssetUrl("SNNavigationMap","icons/downstream_arrow.png"):"right-minus",a=e.downstreamChildren,e.upstreamChildren,r.title=_.get("SNNavigationMap.CollapseDownstream.Title")+" ("+a.length+")";break;default:return n}return l=this.getCountsFromNodes(a),Object.keys(l).forEach(function(e){(o={}).title=l[e].length+" "+e,o.callback=function(){var t=[];a.forEach(function(i){l[e].indexOf(i.id)>-1&&t.push(i)}.bind(this)),this._collapseNode(t,i),m.trackUsage("Collapse","OneRelationCtx")}.bind(this),s.push(this._getContextualObject(t,o))}.bind(this)),r.callback=function(){this._collapseNode(a,i),m.trackUsage("Collapse","OneDirectionCtx")}.bind(this),t&&s.push(this._getContextualObject(t,{title:_.get("SNNavigationMap.CollapseAll.Title")+" ("+a.length+")",callback:r.callback})),n=this._getContextualObject(t,r,s)},_getContextualObject:function(e,t,i){var n={};return t.title&&(e?(n={text:t.title,handler:t.callback},t.icon&&(n.icon=t.icon),i&&i.length>0&&(n.items=i)):(n={type:"PushItem",title:t.title,action:{callback:t.callback}},t.icon&&(n.icon={iconName:t.icon,fontIconFamily:1}),i&&i.length>0&&(n.submenu=i))),n},getDirectionIcon:function(e){var t="";switch(e){case"upstream":t="left";break;case"downstream":t="right";break;default:t=""}return t},getOneDirectionLink:function(e){var t=[],i=!1;return this.tree.getAllDescendants().forEach(function(n){i=!1,t.indexOf(n.id)<0&&n.getAttributeValue("linkDirection")===e&&(this.getAllNodesById(n.id).forEach((function(t){t.getAttributeValue("linkDirection")!=e&&(i=!0)})),i||t.push(n.id))}.bind(this)),t},getRightClickModel:function(){return this.rightClickModel},getCountsFromNodes:function(e){var t={},i="";return e.forEach((function(e){e.isHidden()||(i=e.getAttributeValue("relation"),Object.keys(t).indexOf(i)<0?(t[i]=[],t[i].push(e.id)):t[i].push(e.id))})),t},getAllNodesByLabel:function(e){return this.tree.search({match:function(t){if(e&&-1!==t.nodeModel.getLabel().indexOf(e))return!0}})},getAllNodesById:function(e){return this.tree.search({match:function(t){if(e&&t.nodeModel.id===e)return!0}})},getSelectedModels:function(){var e=[];return this.tree.getSelectedNodes().forEach(function(t){this.collection.get(t.id)&&e.push(this.collection.get(t.id))}.bind(this)),e},getRootModels:function(){return[...this.models]},getRootModelsIds:function(){return this.models.map((function(e){return e.id}))},getVisibleNodes:function(e){var t=[];return this.tree.processDescendants({onlyVisibleNodes:!0,processNode:function(i){e&&t.indexOf(i.nodeModel.id)<0?t.push(i.nodeModel.id):!e&&t.indexOf(i.nodeModel)<0&&t.push(i.nodeModel)}}),t},getAllNodes:function(e){var t=[];return this.tree.processDescendants({onlyVisibleNodes:!1,processNode:function(i){t.indexOf(i.nodeModel.id)<0&&(e?t.push(i.nodeModel.id):t.push(i.nodeModel))}}),t},_getCurrentCounts:function(e,t){var i=[],n=0,s="",o={};return o={downstreamCounts:[],upstreamCounts:[],counts:[],childrenNumber:0},"collapsed"!=t.getState()&&(i=this.getCountsFromNodes(t.getChildren())),e.getAllCounts().forEach((function(a){n=e.getCountsNumber([a]),s=a.get("relationName");let r=a.clone();t.getAttributeValue("linkType")&&g.getReverseRelations(t.getAttributeValue("linkType"))===a.get("name")&&n--,Object.keys(i).indexOf(s)>-1&&(n-=i[s].length),n>0&&(r.set(a,n),"out"===a.get("direction")?o.downstreamCounts.push(r):o.upstreamCounts.push(r)),o.childrenNumber+=parseInt(n)})),o.counts=[...o.downstreamCounts,...o.upstreamCounts],o.childrenNumber+=t.getNumberOfVisibleChildren(),o},_getIndexModelToAdd:function(e,t,i){if(this.modelsToAdd[e])for(var n=0;n<this.modelsToAdd[e].length;n++){var s=this.modelsToAdd[e][n];if(s.sources.indexOf(t)>-1&&s.linkId===i)return n}return-1},_isInBranch:function(e,t,i,n){var s=[],o=[];if(e){if(e.getRoot().id===t||e.id===t)return!0;if(s=e.getChildren())for(var a=0;a<s.length;a++)if(s[a].id===t&&s[a].getAttributeValue("linkType")===i)return!0;o=e.getParents(!0);for(a=0;a<o.length;a++)if(o[a].id===t){if(!o[a].getAttributeValue("instanceId")||!n.get("instanceTargetId"))return!0;{if(n.get("instanceTargetId")===o[a].getAttributeValue("instanceId"))return!0;let t=n.get("type").replace(/(_from|_to)$/,""),i="",s=o[a].getChildren().map((e=>e.id));if(o[a].getParent().id===e.id?i=o[a].getAttributeValue("linkType").replace(/(_from|_to)$/,""):s.indexOf(e.id)>-1&&(i=o[a].getChildren()[s.indexOf(e.id)].getAttributeValue("linkType").replace(/(_from|_to)$/,"")),t===i)return!0}}}return!1},getExpandStatus:function(e,t){var i=e.getCountsNumber(e.getAllCounts());if(t.getAttributeValue("isExpanding")){if(this.contextualExpandStatus){let e=this.contextualExpandStatus;return this.contextualExpandStatus=null,e}return 0===t.getChildren().length?"noChildren":"expanded"}return 0===i?"noChildren":"collapsed"},isInitWithNodes:function(){var e=this.getRootModels();return!!(e&&e.length>0)},mustBeHidden:function(e){return!(!e||!e.linkDirection||!1!==this.expandDirection[e.linkDirection])},getModelToAdd:function(e,t){var i=Object.keys(t),n={};return i.indexOf(e.get("source").id)>-1&&(n={...n,...this.getModelByDirection(e,t,!1)}),i.indexOf(e.get("target").id)>-1&&(n={...n,...this.getModelByDirection(e,t,!0)}),n},getModelByDirection:function(e,t,i){var n={},s={};if(e){n={inverseDirection:i,link:e},n=i?{...n,targetId:e.get("source").id,sourceId:e.get("target").id}:{...n,targetId:e.get("target").id,sourceId:e.get("source").id};var o=this._buildModelToAdd(n,t);o&&(this.linksInTree.push(e.id),s[n.targetId]=o,this._setModelToAdd(n.targetId,o))}return s},exportAsCSV:function(){var e,t=p.getExportLimit()&&p.getExportLimit()>0?p.getExportLimit():5e3;if((e=this.getVisibleNodes().length)<=t){var i=this.collectionView.getAsCSV({addLevelInformation:!0});g.downloadfile(i,"Relations_"+(new Date).toString().split(" ").splice(1,4).join(" ")+".csv","text/csv"),m.trackMultiUsage("export","export",[e]),this.dispatchEvent("ENORIPE_ExportMsg",{success:!0,nbLines:e})}else m.trackMultiUsage("export","export",[-1]),this.dispatchEvent("ENORIPE_ExportMsg",{success:!1,nbLines:e})},_getNls:function(e){var i,n=this,s={};return e.forEach((function(e){n.collection.get(e)&&(s[e]=n.collection.get(e))})),i=g._prepareDataToNls(Object.values(s).map((e=>e._attributes))),new t.Promise((function(t,o){g._getNlsAndProcessData(i,e,s,!1).then((function(i){for(var s=0;s<Object.keys(i.nlsObj).length;s++)n.collection.setNlsObj(Object.keys(i.nlsObj)[s],Object.values(i.nlsObj)[s]);t(e)}),(function(){console.log("err while fetching attributes"),t()}))}))},updateColumnsHeaderNls:function(e){let t={};e.EnoripeColumns.attributes.forEach((e=>{t[e.uri]=e.label})),this.cols.forEach((e=>{void 0!==t[e.dataIndex]&&(e.text=t[e.dataIndex])}))},_getFilterIdForColumn:function(e){let t="set";switch(e.typeRepresentation?e.typeRepresentation:"string"){case"datetime":t="date";break;case"integer":case"real":case"number":t="number";break;case"boolean":case"tag":case"icon":case"image":t="set";break;default:t="string"}return t},clear:function(){this.cols=[],this.models=[],this.attributes=[],this.modelsToAdd={},this.tree=new s,this.linksInTree=[],this.expandingModelIds=[],this.container.innerHTML="",this.rightClickModel=null},clearTree:function(){this.models=[],this.modelsToAdd={},this.linksInTree=[],this.expandingModelIds=[]}})})),define("DS/SNNavigationMap/views/elements/Links",["UWA/Class","UWA/Core","DS/Controls/TooltipModel","DS/SNNavigationMap/utils/CommonUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n,s){"use strict";return e.extend({svgNS:null,init:function(){this.svgNS={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"}},createNode:function(e){var n=t.extendElement(document.createElementNS(this.svgNS.svg,"g")),o=t.extendElement(document.createElementNS(this.svgNS.svg,"title")),a=t.extendElement(document.createElementNS(this.svgNS.svg,"path")),r=t.extendElement(document.createElementNS(this.svgNS.svg,"text")),l=t.extendElement(document.createElementNS(this.svgNS.svg,"textPath")),c=!0===e.source.focus||!0===e.target.focus,d="link col"+e.source.columnID+"-col"+e.target.columnID,h=e.display_name_attributes,u="",g=e.instancelink?e.instanceTargetId:e.target.id;if(a.setAttributes({id:"from_"+e.source.id+"_to_"+g,class:"path-element",fill:"none","marker-end":c?"url(#node-arrow-focus)":"url(#node-arrow)"}),r.setAttributes({class:"labelText","text-anchor":"middle",dy:-5,"font-size":"13px"}),l.setAttributeNS(this.svgNS.xlink,"href","#from_"+e.source.id+"_to_"+g),l.setAttribute("startOffset","50%"),l.setAttribute("class","pathText"),(u=h&&h.length?s[e[h[0]]]||e[h[0]]:s[e.type+"_short"]||s[e.type]||e.type).length>12)var p=u.slice(0,12)+"...";p?l.setContent(p):l.setContent(u),r.setContent(l),o.setContent(u),n.setAttribute("class",c?d+" focus":d),e.instancelink&&(n.addClassName("displaynone"),n.addClassName("duplicate")),n.setAttribute("id",e.id),n.setContent([a,r]);var f=new i({shortHelp:this.getShortHelp(e),longHelp:this.getLongHelp(e),allowUnsafeHTMLLongHelp:!0,longHelpImageDimension:{x:2e3,y:1e3}});return n.tooltipInfos=f,n},updateLabel:function(e,t){var i=n.getRelationLinkNls(t);e.setContent(i)},getShortHelp:function(e){var t="",i="";return e&&(i=n.getRelationLinkNls(e)),i&&(t=i),t},getLongHelp:function(e){var t="";if(e){var i=n.getMainRelName(e.type),o=s[i+"_short"]||s[i]||s[e.type];o&&(t=o),"IsPositionedBy"===i&&e.source.instances&&e.target.instances&&e.source.instances[0]&&e.source.instances[0].name&&e.target.instances[0]&&e.target.instances[0].name&&(t='<div style="display:flex;flex-direction:column;align-items:start;text-align:center;"><div><b>'+s[i]+"</b></div><div>"+e.source.instances[0].name+'&nbsp;<span style="font-size:0.75em;">&#8212;&nbsp;'+n.getRelationLinkNls(e)+"&nbsp;&#8594;&nbsp;</span>"+e.target.instances[0].name+"</div>")}return t}})})),define("DS/SNNavigationMap/views/ListView",["UWA/Core","UWA/Class/View","DS/Windows/Panel","DS/Windows/ImmersiveFrame","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/CommonUtils","DS/Utilities/DateUtils","DS/UIKIT/Spinner","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/models/EditPropAttributeModel"],(function(e,t,i,n,s,o,a,r,l,c,d,h,u){"use strict";var g=t.extend({name:"list-view",isVisible:!1,isWebInWin:!1,panel:null,model:{},_immersiveFrame:null,_informationPanel:null,_widgetId:"",_listSpinner:null,collection:null,className:function(){return this.getClassNames("-container multisel-off")},setup:function(t){this._widgetId=t.widgetId||null,this._parent(t),this.isWebInWin=t.isWebInWin,this._immersiveFrame=new n,this._immersiveFrame.inject(this.container),this.collection=t.collection?t.collection:null,this.panel=new i({closeButtonFlag:!1,width:s.getListViewPanelWidth(),resizableFlag:!0,immersiveFrame:this._immersiveFrame,position:{my:"bottom right",at:"bottom right",offsetY:48},touchMode:!0,verticallyStretchableFlag:!0,floatableFlag:!1}),this.hideTitle(),this._immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).collapsibleFlag=!1,this._immersiveFrame.dockWindow(this.panel,WUXDockAreaEnum.RightDockArea),this.panel.addEventListener("stopResize",function(e){this.dispatchEvent("ENORIPE_ResizeListViewPanel",this.panel.elements.container.offsetWidth)}.bind(this)),this._listSpinner=(new r).inject(e.createElement("div",{styles:{"text-align":"center",position:"absolute",top:"-4px",width:"95%"}}).inject(this.panel.elements.container)).show(),this.container.addEventListener("dragenter",(function(e){e.stopPropagation()})),this.hidePanel();try{this.isWebInWin&&s.getSecurityContext()}catch(e){console.log(e)}},setModel:function(e){Array.isArray(e)||(e=[e]),(!this.model||this.container.isHidden()||this.model.length!=e.length||this.model[0]!=e[0]||e[0].get("instances")&&e[0].get("instances").length>1)&&(this.model=e,null!=this._informationPanel?this._setInformationPanelObject(this.model):this._initInformationsPanel(this.model))},_initInformationsPanel:function(e){var t=this;e&&e.length>0||this.model;if(null===t._informationPanel){var i=t.getpropOptions(c);t._informationPanel=new h(i),t._setInformationPanelObject(e),t.isLoading(!1),require(["DS/ENORIPE_Relations/RelationsTabSettings"],(function(e){t.facetRelationsModule=e;var i={isDraggable:!0,isProfilesVisible:!1,appID:"ENORIPE_AP",publicationsMode:s.getPublicationsMode()};e.isAvailable(t._informationPanel.model,i).then((function(e){"object"==typeof e&&e.facetInfo?(e.facetInfo.options={defaultProfile:s.getOption("LastUsedProfile")},e.facetInfo.position=3,e.facetInfo.supportMerge=!0,t.relationsFacetInfos=e.facetInfo,t._informationPanel.addFacets([e.facetInfo]),require(["DS/PlatformAPI/PlatformAPI"],(function(e){t.platformAPI=e;var i=t.facetRelationsModule.getLocalKey()+"/addInGraph";e.subscribe(i,(function(e){e.models&&t._extractNode(e)}));i=t.facetRelationsModule.getLocalKey()+"/downloadDocument",e.subscribe(i,(function(e){e.modelId&&e.modelName&&t.dispatchEvent("ENORIPE_DownloadDocument",[e.modelId,e.modelName])}))}))):t.log("facets info is NOT in good format")}),(function(){t.log("this facet is not available for this context = "+e)}))}),(function(e){console.warn("Cannot load "+e.requireModules)}))}},_setInformationPanelObject:function(e){var t=this,i=[],n=1===(e=Array.isArray(e)?e:[e]).length;null!==t._informationPanel&&(e.forEach((function(e){if(e)if(e.get("selectedInstance")){e.get("selectedInstance").forEach((function(n){i.push(t.getPropModel(n,e,!0))}))}else{let s=t.getPropModel(e.id,e,!1);if(n&&"Person"===e.get("type")){let t=e.get("ds6w:identifier");if(t){let e=o.getUser3DSwymPictureURL(t);e&&s.set("previewUrl",e)}}i.push(s)}})),i&&t._informationPanel.initDatas(i),t.panel.content=t._informationPanel,this.showPanel(),this.relationsFacetInfos&&this._informationPanel.addFacets([this.relationsFacetInfos]))},updateAttributes:function(){if(this.isVisible){var e=this.facetRelationsModule.getLocalKey()+"/updateAttributes",t={attrs:s.getDefaultAttributes()};this.platformAPI.publish(e,t)}},updateProfileRelations:function(e){this.facetRelationsModule&&this.facetRelationsModule.setProfile(e)},updatePublicationsMode:function(e){this.facetRelationsModule&&this.facetRelationsModule.updatePublicationsMode(e)},getWidth:function(){var e=0;return this.isVisible&&(e=this.panel.elements.container.offsetWidth),e},getpropOptions:function(e,t){var i=[e.FACET_PROPERTIES,e.FACET_INSTANCE,e.FACET_VIEWS,e.FACET_EFFECTIVITY,e.FACET_CHANGE,e.FACET_SWYMCOMMENTS,e.FACET_SHARING,e.FACET_PC_CONTENT,e.FACET_GENERALHISTORY,e.FACET_EXPORTED_DOCUMENTS];this.isWebInWin||i.push(e.FACET_REVISIONS);var n={typeOfDisplay:e.ALL,selectionType:e.NO_SELECTION,facets:i,readOnly:!0,extraNotif:!0,multiselection:!0,setCloseButton:!0,appId:"ENORIPE_AP",actions:[{name:"action_close_panel",text:l.get("close"),icon:"close",handler:function(){this.dispatchEvent("ENORIPE_CloseListView")}.bind(this)}]};try{var o=s.getXPrefCredential();o&&(o=o.replace("ctx::",""),n.context={getSecurityContext:function(){return{SecurityContext:o}}})}catch(e){console.log("error in getting security context"+e)}return n},getPropModel:function(t,i,n){if(!e.is(t))return null;var r=n?"relationship":"businessobject",l=null;if(widget&&widget.setValue("x3dPlatformId",s.getPlatformId()),l=new d({metatype:r,objectId:t,source:i.get("serviceId"),tenant:s.getPlatformId()||"OnPremise"}),"3DSpace"!=i.get("serviceId")){let e={};o.getAttributes(i.get("type")).attributes.forEach((function(t){if(null!=i.get(t.uri)){let n=new u;n.set("name",t.uri),n.set("path",t.uri),n.set("label",t.label);let s=i.get(t.uri);switch(i.get("nlsObj")&&i.get("nlsObj")[t.uri]&&(s=i.get("nlsObj")[t.uri]),n.set("value",s),t.uri){case"ds6w:created":n.set("sectionIdentityCard","date");case"ds6w:modified":let e=a.formatDateToString(new Date(i.get(t.uri)),{timePrecision:"sec"});n.set("value",e);break;case"ds6w:responsible":n.set("type","person"),n.set("sectionIdentityCard","ownerName");break;case"ds6w:label":n.set("sectionIdentityCard","title")}e[t.uri]=n}})),l.set(e),i.get("preview_url")&&(l.set("previewUrl",i.get("preview_url")),l.set("preview_url",i.get("preview_url"))),i.get("type_icon_url")&&l.set("type_icon_url",i.get("type_icon_url")),l.set("isTransient",!0)}return l},hidePanel:function(){this.container.hide(),this.isVisible=!1,this._informationPanel&&this._informationPanel.initDatas([])},showPanel:function(){this.container.show(),this.isVisible=!0},hideTitle:function(){this.panel.elements._titleBarDiv.hide()},showTitle:function(){this.panel.elements._titleBarDiv.show()},isLoading:function(e){e?this._listSpinner.show():this._listSpinner.hide()},_extractNode:function(e){var t,i=[],n=[];t=this.model.map((function(e){return e.id})),(i=e.models).forEach(function(e){e.relations&&("3DSpace"!=e.serviceId&&(e.relations=o.manageCSLLinks(e.relations,[e],this.collection)),n=[...n,...e.relations])}.bind(this)),i.length>0&&this.dispatchEvent("ENORIPE_extractNode",{sourceIds:t,objects:i,links:n})},clearPanel:function(){this.panel.title="",this.model=null},destroy:function(){this.clearPanel(),this._parent(),this.container=null}});return g})),define("DS/SNNavigationMap/views/D3MapView",["UWA/Core","UWA/Class/View","DS/D3js_external/D3js","DS/SNNavigationMap/views/elements/RoundedRect","DS/SNNavigationMap/views/elements/ExpandMenu","DS/SNNavigationMap/views/elements/Links","DS/D3Cola/D3Cola","UWA/Utils/Client","DS/UIKIT/Tooltip","DS/WebappsUtils/WebappsUtils","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n,s,o,a,r,l,c,d,h,u){"use strict";return t.extend({name:"d3-map-view",className:function(){return this.getClassNames("-container multisel-off")},nodeMouseDown:!1,dragNodeStarted:!1,currentlyDraggingNode:!1,markersData:[{id:"node-arrow",position:10,color:"#77797c",dValue:"M 0 0 L 10 5 L 0 10 z"},{id:"node-arrow-focus",position:10,color:"#368ec4",dValue:"M 0 0 L 10 5 L 0 10 z"},{id:"node-arrow-focus-reverse",position:0,color:"#368ec4",dValue:"M 10 10 L 0 5 L 10 0 z"},{id:"node-arrow-reverse",position:0,color:"#77797c",dValue:"M 10 10 L 0 5 L 10 0 z"},{id:"node-arrow-red",position:10,color:"#EA4F37",dValue:"M 0 0 L 10 5 L 0 10 z"},{id:"node-arrow-green",position:10,color:"#57B847",dValue:"M 0 0 L 10 5 L 0 10 z"},{id:"node-arrow-orange",position:10,color:"#FFA500",dValue:"M 0 0 L 10 5 L 0 10 z"}],_highlightTimeout:null,_isMultiSelON:0,_currentDraggedNode:null,_selectedNode:null,_inFilteringMode:!1,_expandMenuViews:{out:{},in:{}},_scaleExtent:[.2,3],_UncheckedIcon:c.getWebappsAssetUrl("SNNavigationMap","icons/16/MultiSel_Unchecked.png"),_CheckedIcon:c.getWebappsAssetUrl("SNNavigationMap","icons/16/MultiSel_Checked.png"),_unfocusedIcon:c.getWebappsAssetUrl("SNNavigationMap","icons/16/MultiSel-unfocused.png"),setup:function(e){var t=this;i.selection.prototype.moveToFront=function(){return this.each((function(){this.parentNode.appendChild(this)}))},this._selector=e.selector,this._spinnerMap=e.spinner,this.NodeCreator=new n(this._selector),this.NodeCreator.isChrome=this.isChrome(),this.NodeCreator._dropZone=e.dropZone,this.NodeCreator.layoutingOn=!1,this.NodeCreator.addEvent("ENORIPE_downloadDocument",(function(e,i){t.dispatchEvent("ENORIPE_downloadDocument",[e,i])})),this.NodeCreator.addEvent("ENORIPE_Drop",(function(e,i){t.dispatchEvent("ENORIPE_Drop",[e,i])})),this.NodeCreator.addEvent("ENORIPE_ShowPreview",(function(e){t.dispatchEvent("ENORIPE_ShowPreview",e)})),this.NodeCreator.addEvent("ENORIPE_movetofront",(function(e){i.select(e).moveToFront()})),this.NodeCreator.addEvent("ENORIPE_GetNlsAttrInfo",(function(e){t.dispatchEvent("ENORIPE_GetNlsAttrInfo",e)})),this.NodeCreator.addEvent("ENORIPE_toggleInstance",(function(e){t.dispatchEvent("ENORIPE_toggleInstance",e)})),this.NodeCreator.addEvent("ENORIPE_dragElement",(function(e,i){t.dispatchEvent("ENORIPE_dragElement",[e,i])})),this.NodeCreator.addEvent("ENORIPE_clickListInstance",(function(e){t.dispatchEvent("ENORIPE_clickListInstance",e)})),this.NodeCreator.addEvent("ENORIPE_clickMoreInstance",(function(e,i){t.dispatchEvent("ENORIPE_clickMoreInstance",[e,i])})),this.LinksCreator=new o,this.initDragListener(),this.layoutAxis=d.getLayoutAxis(),this.layoutDirection=d.getLayoutDirection(),!1===d.getThumbnailsMode()&&this.container.addClassName("no-thumbnails"),this._countLimit=e.countLimit,this.NodeCreator.nameLabel=e.nameLabel,this.NodeCreator.separator=e.separator,this._layoutUtils=e.layoutUtils,this.nodeRadius=80,this.width=window.innerWidth,this.height=window.innerHeight-150,this.zoomListener=i.behavior.zoom().scaleExtent(this._scaleExtent),this.svgContainer=i.select(this.container).append("svg").attr("id","svg-root").attr("width",this.width).attr("height",this.height).attr("pointer-events","all").call(this.zoomListener.on("zoom",this._redraw.bind(this))).on("dblclick.zoom",null).on("mousedown",(function(){t.mouseDownTimeInContainer=new Date})).on("mouseup",(function(){t.mouseUpTimeInContainer=new Date})).on("click",this._clearSelection.bind(this)).on("touchmove",(function(){i.event.preventDefault()})),this.svgRootG=this.svgContainer.append("g"),this.linksContainer=this.svgRootG.append("g").attr("id","all-links"),this.nodesContainer=this.svgRootG.append("g").attr("id","all-nodes"),this.focusContainer=this.svgRootG.append("g").attr("id","focused-objects"),this.defs=this.svgContainer.append("svg:defs"),this.defs.selectAll("marker").data(this.markersData).enter().append("svg:marker").attr("id",(function(e){return e.id})).attr("viewBox","0 0 10 10").attr("refX",(function(e){return e.position})).attr("refY",5).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d",(function(e){return e.dValue})).attr("fill",(function(e){return e.color})),this.force=a.d3adaptor().linkDistance(150).size([this.width,this.height]).on("tick",this.tick.bind(this)).on("end",this.onViewReady.bind(this)),this.svgElement=this.getElement("svg")},render:function(e,t){var i=e.nodes;return this._resetFocusedLinksPosition(),this._d3Update(e),this.updateConstraints(e,t),i.forEach(function(e){if(!e.counts.isRequestDone()){var t=this.getElement("#container-"+CSS.escape(e.id));this.createExpandMenu("in",e,t,!1),this.createExpandMenu("out",e,t,!1)}}.bind(this)),this},_sortTargetInstancesAsPerLinks:function(e){let t=[];return e.forEach(function(e){t.push(e.instanceTargetId)}.bind(this)),e.forEach(function(e){if(void 0!==e.target.instances&&null!==e.target.instances){let i=new Map;e.target.instances.forEach(function(e,n){t.find(((t,n)=>{t===e.id&&i.set(n,e)}))}.bind(this));let n=[...i].sort(((e,t)=>e[0]-t[0])),s=[...new Map(n).values()];const o=new Set,a=s.filter((e=>!o.has(e.id)&&(o.add(e.id),!0)));e.target.instances=a}}.bind(this)),e},_sortLinksByColRow:function(e){let t=new Map;for(let i=0;i<e.length;i++){let n=e[i].source.columnID,s=t.get(n);void 0===s?t.set(n,[e[i]]):s.push(e[i])}let i=[...t].sort(((e,t)=>e[0]-t[0])),n=new Map(i),s=[];for(let[e,t]of n)t.sort(((e,t)=>e.source.rowID-t.source.rowID)),s.push(...t);return s},_d3Update:function(e){var t=this,n=e.nodes,s=this._sortLinksByColRow(e.links),o=0;this._sortTargetInstancesAsPerLinks(s),e.links=s,this.force.size([this.width,this.height]).nodes(n).links(s);var a=this.linksContainer.selectAll(".link").remove();a=this.linksContainer.selectAll(".link").data(s,(function(e){return e.id}));var l=this.nodesContainer.selectAll(".node").data(n,(function(e){return e.id}));l.classed("focus",(function(e){return e.focus})),a.classed("focus",(function(e){var i=!0===e.source.focus||!0===e.target.focus,n=this.getElementsByTagName("textPath")[0];return i?(this.getElement("path").hasAttribute("marker-end")&&this.getElement("path").setAttribute("marker-end","url(#node-arrow-focus)"),this.getElement("path").hasAttribute("marker-start")&&this.getElement("path").setAttribute("marker-start","url(#node-arrow-focus)")):(this.getElement("path").hasAttribute("marker-end")&&this.getElement("path").setAttribute("marker-end","url(#node-arrow)"),this.getElement("path").hasAttribute("marker-start")&&this.getElement("path").setAttribute("marker-start","url(#node-arrow)")),t.LinksCreator.updateLabel(n,e),i}));var c=l.enter().append(this.NodeCreator.createNode.bind(this.NodeCreator));c.on("mousedown",(function(){t.nodeMouseDown=!0,i.event.stopPropagation()})).on("mouseup",(function(){t.nodeMouseDown=!1})).on("touchmove",(function(){i.event.preventDefault(),i.event.stopPropagation()})).on("touchstart",(function(e){o=setTimeout((function(){t.nodeLongtouch(e)}),1e3)})).on("touchend",(function(){o&&clearTimeout(o)})).call(this.dragListener).on("click",this.nodeClicked.bind(this)).on("contextmenu",this.nodeRightClicked.bind(this)).each(this._setupEvents.bind(this)),!0!==r.Platform.ios&&!0!==r.Platform.ipad&&c.on("mouseenter",this._onMouseEnter.bind(this)).on("mouseleave",this._onMouseLeave.bind(this)),a.enter().append(this.LinksCreator.createNode.bind(this.LinksCreator)),this.dispatchEvent("ENORIPE_UpdateD3Map")},_redraw:function(e){this.nodeMouseDown||(e?this.svgRootG.transition():this.svgRootG).attr("transform","translate("+this.zoomListener.translate()+") scale("+this.zoomListener.scale()+")")},_generateConstraints:function(e,t){var i,n=[],s={},o={},a=[],r=0,l=[],c=function(e,t){return e._attributes.rowID>t._attributes.rowID?1:t._attributes.rowID>e._attributes.rowID?-1:0};for(var h in e.undefined&&delete e.undefined,e)if(e.hasOwnProperty(h)){a=e[h],h=parseInt(h),a=this._generateRowIDs(a);for(var u=0;u<a.length;u++)a[u].get("rowID")>-1&&(l[a[u].get("rowID")]?l[a[u].get("rowID")].push(a[u]):l[a[u].get("rowID")]=[a[u]]);if(e[h+1]&&n.push({axis:this.layoutAxis,left:t.indexOf(a[0]._attributes),right:t.indexOf(e[h+1][0]._attributes),gap:300}),a.length>1){a.sort(c),s={type:"alignment",axis:this.layoutAxis,offsets:[]},o={type:"alignment",axis:"x"===this.layoutAxis?"y":"x",offsets:[]};for(u=0;u<a.length;u++)r=o.offsets[u-1]?o.offsets[u-1].offset+d.getYOffset():0,(i=a[u-1])&&i.get("instances")&&(r+=d.getExpendHeight(),i.get("instancesExpanded")>0&&(r+=i.get("instancesExpanded")*d.getExpendHeight(),i.get("instancesExpanded")<i.get("instances").length&&(r+=d.getExpendHeight()))),s.offsets.push({node:t.indexOf(a[u]._attributes),offset:"0"}),o.offsets.push({node:t.indexOf(a[u]._attributes),offset:r});n.push(s,o)}}if(1===Object.keys(l).length){o={type:"alignment",axis:"x"===this.layoutAxis?"y":"x",offsets:[]};for(u=0;u<l[0].length;u++)o.offsets.push({node:t.indexOf(l[0][u]._attributes),offset:0});n.push(o)}return n},_generateRowIDs:function(e){for(var t,i=e.filter((function(e){return void 0!==e.get("rowID")})),n=e.filter((function(e){return void 0===e.get("rowID")})),s=[],o=e.length,a=0;a<i.length;a++)(t=i[a].get("rowID"))>e.length-1?i[a].set("rowID",e.length-1):t<0&&i[a].set("rowID",0),s[i[a].get("rowID")]?(i[a].unset("rowID"),n.push(i[a])):s[i[a].get("rowID")]=i[a];for(a=0;a<n.length;a++)for(var r=0;r<o;r++)if(void 0===s[r]){n[a].set("rowID",r),s[r]=n[a];break}return s},setAttrData:function(e){var t;if(e.isInstances)for(var i=0;i<e.ids.length;i++)(t=this.getElement("#instance-"+CSS.escape(e.ids[i])))&&this.NodeCreator.updateToolTip(t,e.models[e.ids[i]],e.ids[i]);else if((t=this.getElement("#container-"+CSS.escape(e.ids[0])))&&(this.NodeCreator.updateLabel(t,e),this.NodeCreator.updateToolTip(t.getElement(".drag-shape"),e.models[e.ids[0]],e.ids[0]),e.toFetchThumbnail)){var n=e.nlsObj[e.ids[0]].preview_url;this.NodeCreator.createThumbnail(t,n)}},initDragListener:function(){var e=this;this.nodeMousePressTime=0,this.dragListener=i.behavior.drag().on("dragstart",(function(t){e.nodeMouseDownTime=new Date,e.mouseOriginalY=i.mouse(this)[1],e.dragNodeStarted=!0,e.currentlyDraggingNode=!0,i.event.sourceEvent.stopPropagation()})).on("drag",(function(t){if(!1!==e.NodeCreator.layoutingOn){var n=i.mouse(this),s=i.mouse(e.svgContainer[0][0]);if(e.dragNodeStarted&&e.initiateDrag(t,this),s[1]<20)e._panTimer=!0,e._pan(this,"up");else if(s[1]>e.svgContainer[0][0].height.baseVal.value-20)e._panTimer=!0,e._pan(this,"down");else try{clearTimeout(e._panTimer)}catch(e){}t.y0+=n[1]-e.mouseOriginalY;var o,a=e.getElement("#"+CSS.escape(this.id)).getBoundingClientRect(),r=(a.top+a.bottom)/2;this._selectedNode=null,i.selectAll(".node").each((function(i){t.columnID===i.columnID&&t.id!==i.id&&(o=e.getElement("#"+CSS.escape(this.id)).getBoundingClientRect()).top<r&&r<o.bottom&&(e._selectedNode=i)})),i.select(this).attr("transform","translate("+t.x+","+t.y0+")"),e._updateReorderFeedback()}})).on("dragend",(function(t){var n,s,o,a=i.select(this);if(e.nodeMouseUpTime&&new Date-e.nodeMouseUpTime<100)return;if(e.nodeMouseUpTime=new Date,e.nodeMousePressTime=e.nodeMouseUpTime-e.nodeMouseDownTime,a.classed("node-dragging",!1),e.currentlyDraggingNode=!1,e.mouseOriginalY=0,e.nodeMouseDown=!1,e._selectedNode?(n=e._currentDraggedNode.rowID<e._selectedNode.rowID?"down":"up",s=e._currentDraggedNode.y0<e._selectedNode.y-("thumbnailsMode"===d.getThumbnailsMode()?-20:-5)?"top":"bottom","up"===n&&"top"===s||"down"===n&&"bottom"===s?o=e._selectedNode.rowID:"up"===n&&"bottom"===s?o=e._selectedNode.rowID+1:"down"===n&&"top"===s&&(o=e._selectedNode.rowID-1),e._currentDraggedNode.rowID!==o?e.dispatchEvent("ENORIPE_ReorderColumn",[e._currentDraggedNode,e._selectedNode,o]):a.attr("transform","translate("+t.x+","+t.y+")")):a.attr("transform","translate("+t.x+","+t.y+")"),e._currentDraggedNode=null,e._selectedNode=null,e.svgContainer.classed("dragging",!1),e._updateReorderFeedback(),e.isChrome()&&1===i.event.sourceEvent.which&&0!==e.nodeMousePressTime&&e.nodeMousePressTime<250){var r=new CustomEvent("click",{detail:{isCustom:"true",ctrlKey:i.event.sourceEvent.ctrlKey},bubbles:!0,cancelable:!0});i.event.sourceEvent.toElement?i.event.sourceEvent.toElement.dispatchEvent(r):i.event.sourceEvent.target&&i.event.sourceEvent.target.dispatchEvent(r)}}))},initiateDrag:function(e,t){this._currentDraggedNode=e,this.dragNodeStarted=!1,this.svgContainer.classed("dragging",!0),i.select(t).classed("node-dragging",!0).moveToFront()},nodeLongtouch:function(e){["in","out"].forEach(function(t){this._expandMenuViews[t][e.id]&&this._expandMenuViews[t][e.id].showExpandedMenu()}.bind(this))},nodeClicked:function(e){if(i.event.srcElement){if("multiSel-mapView-icon"===i.event.srcElement.className.baseVal)return}else if(i.event.target&&"multiSel-mapView-icon"===i.event.target.className.baseVal)return;if((!this.isChrome()||i.event.srcElement.hasClassName("drag-shape")||i.event.detail&&"true"===i.event.detail.isCustom)&&!(i.event.defaultPrevented&&this.nodeMousePressTime>100)){i.event.stopPropagation&&i.event.stopPropagation();var t=!1;t=i.event.detail&&i.event.detail.ctrlKey?i.event.detail.ctrlKey:i.event.ctrlKey;var n=this._updateMultiSelState(e);if(t||this._isTouchDevice())return this.initMultiSelection(),void this.dispatchEvent("ENORIPE_MultiSel_Object",[{models:e.id,sAction:n,origin:"MapView"}]);0===this._isMultiSelON&&(this._selector.clearMultiSel(),this.clearMultiSelection());this.getElement("#container-"+CSS.escape(e.id));this._resetOpacity(),this.dispatchEvent("onNodeClicked",[e.id,n]),void 0===this._nodeClickCounter&&(this._nodeClickCounter=0),this._nodeClickCounter++}},nodeRightClicked:function(e){i.event.stopPropagation(),i.event.preventDefault(),this._resetOpacity(),this.dispatchEvent("onNodeRightClicked",[{id:e.id,context:"D3MapView"}])},_setupDragEndEvent:function(e){var t=this.getElement("#container-"+CSS.escape(e.id)+" .drag-shap"),i=this;t&&t.addEventListener("dragend",(function(){i.dispatchEvent("ENORIPE_dragEnd")}))},_onMouseEnter:function(e){var t=this.getElement("#container-"+CSS.escape(e.id)+" .multiSel-mapView-icon");t&&t.show();var i=this;this._highlightTimeout&&clearTimeout(this._highlightTimeout),this._highlightTimeout=setTimeout((function(){i._fadeLinks(e)}),1e3)},_onMouseLeave:function(e){this._highlightTimeout&&clearTimeout(this._highlightTimeout),this._resetOpacity();var t=this.getElement("#container-"+CSS.escape(e.id)+" .multiSel-mapView-icon");t&&!this._isMultiSelON&&t.removeAttribute("style")},_setupEvents:function(e){var t=this.getElement("#container-"+CSS.escape(e.id)+" #toggleMoreInstance");this._setupDragEndEvent(e),this._setupMultiSelEvent(e),t&&t.addEvent("click",function(t){this._onClickMoreInstances(t,e.instances)}.bind(this))},filter:function(e){var t=e.matchingIDs,i=[],n=[],s=[],o=[];this.endFilter(),this._inFilteringMode=!0,this.svgRootG.classed("links-nodes-faded",!0),(o=t.map((function(e){return"#referenceContainer-"+CSS.escape(e)}))).length>0&&(i=document.querySelectorAll(o.join(", ")));for(var a=0;a<i.length;a++)i[a].addClassName("highlighted");if(e.filteredLinks)for(n=e.filteredLinks.map((function(e){return document.getElementById(e)})),a=0;a<n.length;a++)n[a]&&n[a].addClassName("highlighted");var r=t.map((function(e){return"#instance-"+CSS.escape(e)}));r.length>0&&(s=document.querySelectorAll(r.join(", ")));for(a=0;a<s.length;a++){if(s[a].closest(".node")){var l=s[a].closest(".node").getElement(".nodeReference");l&&l.addClassName("highlighted")}s[a].addClassName("highlighted")}return t},endFilter:function(e){this._inFilteringMode=!1,this._resetOpacity(e)},highlightPath:function(e){this.svgRootG.classed("links-nodes-faded",!0),e.forEach((function(e){var t=document.getElementById("referenceContainer-"+e)||document.getElementById(e);i.select(t).classed("highlighted mouseover",!0)}))},unhighlightPath:function(){this.svgRootG.classed("links-nodes-faded",!1),this.svgRootG.selectAll(".highlighted").classed("highlighted",!1).classed("mouseover",!1)},_fadeLinks:function(e){if(null!=this.container&&0!==this.getElements(".link").length){this.getElement("#container-"+CSS.escape(e.id));this.currentlyDraggingNode||(this.svgRootG.classed("links-nodes-faded",!0),this.svgRootG.selectAll(".link:not(.highlighted)").filter((function(t){if(t.source.id===e.id||t.target.id===e.id)return i.select("#referenceContainer-"+CSS.escape(t.source.id)+":not(.highlighted)").classed("highlighted mouseover",!0),i.select("#referenceContainer-"+CSS.escape(t.target.id)+":not(.highlighted)").classed("highlighted mouseover",!0),t.target.instancesExpanded>0&&i.select("#instance-"+CSS.escape(t.instanceTargetId)+":not(.highlighted)").classed("highlighted mouseover",!0),!0})).classed("highlighted mouseover",!0),this.svgRootG.selectAll(".link").filter((function(t){if(t.source.id===e.id||t.target.id===e.id)return!0})))}},_resetOpacity:function(e){!e&&this._inFilteringMode?(this.svgRootG.selectAll(".mouseover").classed("highlighted",!1).classed("mouseover",!1),this._inFilteringMode||0!=this.svgRootG.selectAll(".highlighted").data().length||(this.svgRootG.classed("links-nodes-faded",!1),clearTimeout(this._highlightTimeout),this._highlightTimeout=null)):(this._inFilteringMode=!1,this.svgRootG.selectAll(".highlighted").classed("highlighted",!1),this.svgRootG.classed("links-nodes-faded",!1),this.svgRootG.classed("links-faded",!1))},colorize:function(e){var t=null;e.matchingIDs.forEach(function(e){t=null,this.getElement("#container-"+CSS.escape(e.id))?t=this.getElement("#container-"+CSS.escape(e.id)):this.getElement("#instance-"+CSS.escape(e.id))&&(t=this.getElement("#instance-"+CSS.escape(e.id))),t&&this.NodeCreator.showColor(t,e.color)}.bind(this)),e.filteredLinks&&e.filteredLinks.colorMap&&this.colorizeLinks(e.filteredLinks)},unColorize:function(){this.getElements(".colored-rect-bi").forEach((function(e){e.remove()})),this.getElements(".colored-rect-instance").forEach((function(e){e.remove()})),this.uncolorizeLinks()},setColorOnLink:function(e,t,n){i.select(e).select("path").attr("marker-end","url(#"+t+"_"+n),e.setStyle("fill",n),e.setStyle("stroke",n),e.addClassName("filtered_rel")},setMarkerColorize:function(e,t){for(var i=!1,n=!1,s=0;s<t.length;s++){for(var o={id:e+"_"+t[s].color,position:10,color:t[s].color,dValue:"M 0 0 L 10 5 L 0 10 z"},a=(i=!1,0);a<this.markersData.length;a++)this.markersData[a].id===o.id&&(i=!0);!1===i&&(this.markersData.push(o),n=!0)}n&&this.defs.selectAll("marker").data(this.markersData).enter().append("svg:marker").attr("id",(function(e){return e.id})).attr("viewBox","0 0 10 10").attr("refX",(function(e){return e.position})).attr("refY",5).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d",(function(e){return e.dValue})).attr("fill",(function(e){return e.color}))},colorizeLinks:function(e){var t="node-arrow-relations";for(var n in this.setMarkerColorize(t,e.tagColors),e.colorMap)if(e.colorMap.hasOwnProperty(n)){this.setColorOnLink(document.getElementById(n),t,e.colorMap[n]);var s=i.select(document.getElementById(n)).select("path").attr("marker-end");i.select(document.getElementById(n)).select("path").attr("previous-marker",s)}},uncolorizeLinks:function(){i.selectAll(".filtered_rel").select("path").attr("marker-end",(function(e){return i.select(document.getElementById(e.id)).select("path").attr("previous-marker")})),i.selectAll(".link").select("path").attr("marker-end","url(#node-arrow)"),i.selectAll(".focus.link").select("path").attr("marker-end","url(#node-arrow-focus)"),this.svgRootG.selectAll(".filtered_rel").classed("filtered_rel",!1),i.selectAll(".link").style("fill",""),i.selectAll(".link").style("stroke","")},initMultiSelection:function(){this._isMultiSelON=1,this.container.removeClassName("multisel-off"),this.container.addClassName("multisel-on")},clearMultiSelection:function(){if(this._isMultiSelON=0,this.container){this.container.removeClassName("multisel-on"),this.container.addClassName("multisel-off"),this.container.removeClassName("unfocused");var e=this;this.getElements(".multiSel-mapView-icon").forEach((function(t){t.setAttribute("data-checked","false"),t.setAttributeNS("http://www.w3.org/1999/xlink","href",e._UncheckedIcon)}))}},addToSelection:function(e){var t=this.getElement("#container-"+CSS.escape(e)+" .multiSel-mapView-icon");t?(t.setAttribute("data-checked","true"),t.setAttributeNS("http://www.w3.org/1999/xlink","href",this._CheckedIcon)):this.updateFocusClasses(e)},removeToSelection:function(e){var t=this.getElement("#container-"+CSS.escape(e)+" .multiSel-mapView-icon"),i=this.getElement("#container-"+CSS.escape(e));i&&(i.removeClassName("focus"),this.NodeCreator.removeSelectedInstance(i,e)),t&&(t.setAttribute("data-checked","false"),t.setAttributeNS("http://www.w3.org/1999/xlink","href",this._UncheckedIcon))},switchFocus:function(e,t){for(var i,n,s=0;s<e.length;s++)i=e[s],(n=this.getElement("#container-"+CSS.escape(i)+" .multiSel-mapView-icon"))&&(t?(n.setAttribute("data-checked","false"),n.setAttributeNS("http://www.w3.org/1999/xlink","href",this._unfocusedIcon)):(n.setAttribute("data-checked","true"),n.setAttributeNS("http://www.w3.org/1999/xlink","href",this._CheckedIcon)))},_clearSelection:function(){if(i.event.srcElement){if(""!==i.event.srcElement.className.baseVal)return}else if(i.event.target&&""!==i.event.target.className.baseVal)return;var e=this.mouseUpTimeInContainer-this.mouseDownTimeInContainer;i.event.defaultPrevented&&e>100||(this.hideAllExpandedMenu(),this.dispatchEvent("ENORIPE_clearSelection",["MapView"]))},_setupMultiSelEvent:function(e){var t=this.getElement("#container-"+CSS.escape(e.id)+" .multiSel-mapView-icon"),i=this;t&&t.addEventListener("click",(function(t){if(!i.isChrome()||t.detail&&"true"===t.detail.isCustom){t.stopPropagation(),i.initMultiSelection();var n=i._updateMultiSelState(e);i.dispatchEvent("ENORIPE_MultiSel_Object",[{models:e.id,sAction:n,origin:"MapView"}])}}))},_updateMultiSelState:function(e){var t=this.getElement("#container-"+CSS.escape(e.id)+" .multiSel-mapView-icon"),i="";if(t){this._xUncheckedIcon&&0,this._xCheckedIcon&&0;var n,s=t.getAttribute("data-checked");"false"===s?(s="true",n=this._CheckedIcon,i="add"):(s="false",n=this._UncheckedIcon,i="remove"),t.setAttributeNS("http://www.w3.org/1999/xlink","href",n),t.setAttribute("data-checked",s)}return i},toggleAllInstances:function(e,t){var i=this.getElements(".node");this.updateConstraints(e.getLinksAndNodes(),e.groupBy("columnID")),i.forEach(function(e){e.getElement(".instance-list-g")&&this.NodeCreator.toggleListInstances(e,t)}.bind(this))},updateInstancesList:function(e){e.forEach(function(e){let t=this.getElement("#container-"+e.id);t&&this.NodeCreator.updateInstancesList(t,e._attributes)}.bind(this))},_onClickMoreInstances:function(e,t){var i=e.currentTarget.closest(".node");e.stopPropagation(),i&&e.detail&&!e.detail.isCustom&&this.dispatchEvent("ENORIPE_clickMoreInstance",[i.getAttribute("data-id"),t])},updateNodesYposition:function(e){var t=[],i=null,n=null,s=null,o=null,a=null,r=null,l=null,c=null,h=!0,u=0,g=d.getNodesHeight();t=this.getElements(".node");for(var p=0;p<t.length;p++){h="thumbnailsMode"==e&&!!t[p].getElement(".thumbnail-image"),u=h?g:65,t[p].getElement(".drag-shape-container").setAttribute("height",u),(i=t[p].getElement(".node-text")).setAttribute("y",u-40),i.setAttribute("x",h?25:40),i.setContent(this.NodeCreator.wrapText(i.textContent,h)),(n=t[p].getElement(".map-type-icon"))&&(n.setAttribute("y",u-40),n.setAttribute("x",h?5:20)),(s=t[p].getElement(".background"))&&s.setAttribute("height",u),(o=t[p].getElement(".thumbnail-background"))&&o.setAttribute("height",u-10),(a=t[p].getElement(".foreign-object-count-mobile"))&&a.setAttribute("y",u-35),r=t[p].getElements("#toggleEcosystem");for(var f=0;f<r.length;f++)r[f].hasClassName("expandMenuDirection-in")?r[f].setAttribute("style","transform:translate(0px,"+(u/2-30)+"px"):r[f].setAttribute("style","transform:translate("+d.getNodesWidth()+"px,"+(u/2-30)+"px");var m;if(l=t[p].getElement(".instance-expander-g .rect-bkg-instance"),c=t[p].getElements(".rect-list-instance"),l&&c)l.setAttribute("y",u+3),t[p].getElement(".foreign-object-expand").setAttribute("y",u+2),t[p].getElement(".foreign-object-instances").setAttribute("y",u+5),c.forEach((function(e){e.setAttribute("y",u),m=e.getElements(".rect-bkg-instance"),i=e.getElements(".node-text");for(var t=0;t<m.length;t++)m[t].setAttribute("y",h?155+23*t:90+23*t);for(t=0;t<i.length;t++)i[t].setAttribute("y",h?170+23*t:105+23*t)}))}var v=document.getElementsByClassName("loader-icon");for(p=0;p<v.length;p++){var _=v[p];h&&"20"===_.getAttribute("y")?_.setAttribute("y","40"):h||"40"!==_.getAttribute("y")||_.setAttribute("y","20")}},updateConstraints:function(e,t){var i=this._generateConstraints(t,e.nodes);this.force.constraints(i).start(),e.nodes.forEach((function(e){e.y0=e.y}))},updateFocusClasses:function(e){e&&(this.svgRootG.selectAll(".node.focus").classed("focus",!1),this.nodesContainer.select("#container-"+CSS.escape(e)).classed({focus:!0}),this.svgRootG.selectAll(".link").classed("focus",(function(e){var t=e.source.focus||e.target.focus;return i.select(this).select("path").attr("marker-end",t?"url(#node-arrow-focus)":"url(#node-arrow)"),t})))},centerTheGraph:function(e){var t=this.getBounds();if(t){var n=t.windowHeight,s=t.windowWidth,o=(n+e.actionBarHt)/2,a=(s-e.sidePanelWidth)/2,r=t.left+t.width/2,l=t.top+t.height/2,c=i.transform(i.select("g").attr("transform")),d=c.scale[0],h=c.translate[0]+(a-r),u=c.translate[1]+(o-l);this.zoomListener.translate([h,u]).scale(d),this._redraw(!0)}},fitAllIn:function(e){null==e&&(e={sidePanelWidth:0,actionBarHt:48});var t=this.getBounds(),n=t.windowWidth,s=t.windowHeight,o=s*n,a=t.nodeWidth*t.nodeHeight/o*100,r=Math.sqrt(10/a),l=t.width,c=t.height,d=n-e.sidePanelWidth,h=s-e.actionBarHt,u=Math.min(d/l,h/c);u=u>r?r:u;var g=i.transform(i.select("g").attr("transform")),p=g.scale[0],f=g.translate[0],m=g.translate[1];u=(u=(u*=p)>this._scaleExtent[1]?this._scaleExtent[1]:u)<this._scaleExtent[0]?this._scaleExtent[0]:u,this.zoomListener.translate([f,m]).scale(u),this._redraw(!1),this.centerTheGraph(e)},setSVGDimensions:function(e,t){this.width=t,this.height=e,this.container.setStyle(e),this.svgContainer.attr("width",t).attr("height",e)},addMissingThumbnail:function(e){var t=e.where({thumbnailTBU:!0}),i=this;t.length>0&&t.forEach((function(e){e.get("thumbnail")&&i.NodeCreator.createThumbnail(i.getElement("#container-"+CSS.escape(e.id)),e.get("thumbnail"))}))},layoutingOff:function(){i.selectAll(".node .drag-shape").style("display",""),this.NodeCreator.layoutingOn=!1},layoutingOn:function(){i.selectAll(".node .drag-shape").style("display","none"),this.NodeCreator.layoutingOn=!0},tick:function(){var e=this.svgRootG.selectAll(".link"),t=this.nodesContainer.selectAll(".node"),n=this,s={};t.attr("transform",(function(e){return"translate("+e.x+","+e.y+")"})),e.each((function(){var e=i.select(this),t=e.select("path"),o=e.select(".labelText"),a=i.select(this).datum(),l=n.getElements("#from_"+CSS.escape(a.source.id)+"_to_"+CSS.escape(a.target.id)),c=!1;if(l.length>1&&(s["#from_"+a.source.id+"_to_"+a.target.id]>=0&&(c=!0,s["#from_"+a.source.id+"_to_"+a.target.id]++),s["#from_"+a.source.id+"_to_"+a.target.id]||(c=!1,s["#from_"+a.source.id+"_to_"+a.target.id]=0)),"ie"===r.Engine.name&&this.parentNode.insertBefore(this,this),t.attr("d",(function(e){var t=n.getElement("#from_"+CSS.escape(e.target.id)+"_to_"+CSS.escape(e.source.id));return n._layoutUtils.getPathCoordinates(e,i.select(this),t,c,i.select(this.parentNode))})),!0===c){var d=15*s["#from_"+a.source.id+"_to_"+a.target.id]+5;o.attr("dy",-d)}o.attr("transform",(function(e){return n._layoutUtils.rotateTextLabel(e,c)}))})),s={}},removeSelectedNodes:function(e,t){e.nodes;return this._removeSelectedNodes(e),this._d3Update(e),this.updateConstraints(e,t),this},_removeSelectedNodes:function(e){var t=e.nodes,i=e.links,n=this.linksContainer.selectAll(".link").data(i,(function(e){return e.id}));this.nodesContainer.selectAll(".node").data(t,(function(e){return e.id})).exit().remove(),n.exit().remove()},_resetFocusedLinksPosition:function(){var e=this.focusContainer.selectAll("g").remove(),t=this;e.empty()||e.each((function(){var e=this;t.linksContainer.append((function(){return e}))}))},_updateReorderFeedback:function(){var e;i.select("#reorder-feedback").remove(),null!==this._currentDraggedNode&&null!==this._selectedNode&&(e=this._selectedNode.y-("thumbnailsMode"===d.getThumbnailsMode()?-20:-5),this._currentDraggedNode.y0<e?this.getElement("#container-"+CSS.escape(this._selectedNode.id)).appendChild(this.NodeCreator.getFeedbackReorder("top")):this.getElement("#container-"+CSS.escape(this._selectedNode.id)).appendChild(this.NodeCreator.getFeedbackReorder("bottom")))},_pan:function(e,t){var n,s,o,a=this;if(this._panTimer){clearTimeout(this._panTimer);var r=i.transform(this.svgRootG.attr("transform"));"up"!==t&&"down"!==t||(n=r.translate[0],s="up"===t?r.translate[1]+50:r.translate[1]-50),o=this.zoomListener.scale(),void 0!==n&&void 0!==s&&(this.zoomListener.translate([n,s]).scale(o),this.svgRootG.transition().attr("transform","translate("+this.zoomListener.translate()+") scale("+this.zoomListener.scale()+")"),this._panTimer=setTimeout((function(){a._pan(e,50,t)}),50))}},removeLoadingClass:function(e){var t=this.getElement("#container-"+CSS.escape(e));t&&i.select(t).classed("is-loading",!1)},addLoader:function(e){if(e){var t=this.getElement("#container-"+CSS.escape(e));i.select(t).classed("is-loading",!0)}},removeLoader:function(e){if(e){var t=this.getElement("#container-"+CSS.escape(e));i.select(t).classed("is-loading",!1)}},getBounds:function(){var e=/(msie|trident)/i.test(navigator.userAgent),t=0;if(i.select("g").node()&&i.select(".node").node()){t=i.select("g").node().getBoundingClientRect();var n=i.select(".node").node().getBoundingClientRect(),s={};if(e){for(var o=this.getElements(".node"),a=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY,d=0;d<o.length;d++){var h=o[d].getOffsets();r=Math.min(r,h.x),l=Math.max(l,h.x),a=Math.min(a,h.y),c=Math.max(c,h.y)}var u=n.width,g=n.height,p=(c+=g)-a,f=(l+=u)-r;s.left=r,s.top=a,s.right=l,s.bottom=c,s.windowWidth=window.innerWidth,s.windowHeight=window.innerHeight,s.width=f,s.height=p,s.nodeWidth=u,s.nodeHeight=g}else s.left=t.left,s.top=t.top,s.right=t.right,s.bottom=t.bottom,s.windowWidth=window.innerWidth,s.windowHeight=window.innerHeight,s.width=t.width,s.height=t.height,s.nodeWidth=n.width,s.nodeHeight=n.height}return s},isPathPanel:function(){var e=document.getElementsByClassName("path-panel-view-container");return e.length>0&&"none"!=e[0].style.display},_isTouchDevice:function(){var e=!1;return(r.Platform.ios||r.Platform.android||r.Platform.tablet||r.Platform.blackberry||navigator&&navigator.maxTouchPoints>1)&&(e=!0),e},isChrome:function(){var t=!1;return"chrome"===e.Utils.Client.Engine.name&&(t=!0),t},isInitWithNodes:function(){if(this.nodesContainer){let e=this.nodesContainer.selectAll(".node");return!!(e[0]&&e[0].length>1)}return!1},_graphBounds:function(){var e=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return this.nodesContainer.selectAll(".node").each((function(s){e=Math.min(e,s.x-10),t=Math.max(t,s.x+180),i=Math.min(i,s.y),n=Math.max(n,s.y+70)})),{x:e,X:t,y:i,Y:n}},updateCount:function(e){var t=e.getLinksAndNodes().nodes,i=null;t.forEach(function(e){i=this.getElement("#container-"+CSS.escape(e.id)),this.expandMenuUpdate("in",e,i),this.expandMenuUpdate("out",e,i)}.bind(this)),this.tick()},expandMenuUpdate:function(e,t,i){var n,s=null,o=null;n=(o=t.counts).isAllExpanded(e),i.getElement(".expandMenuDirection-"+e)?this._expandMenuViews[e][t.id]&&(s=this._expandMenuViews[e][t.id],n?o.hasCount(e)?s.setCollapseMenu():s.destroy():s.setExpandMenu(t)):this.createExpandMenu(e,t,i,!0)},createExpandMenu:function(e,t,n,o){var a=null,r=0;n.getElement(".expandMenuDirection-"+e)||(o&&t.counts.hasCount(e)||!o)&&(r=o?t.counts.hasRealCount(e)?1:2:0,this._expandMenuViews[e][t.id]=new s(e,t,n,r),a=this._expandMenuViews[e][t.id],this.listenTo(a,"ENORIPE_ShowPreview",function(e){this.dispatchEvent("ENORIPE_ShowPreview",e)}.bind(this)),this.listenTo(a,"ENORIPE_splitCount",function(e,t,i){this.dispatchEvent("ENORIPE_splitCount",[e,t,i])}.bind(this)),this.listenTo(a,"ENORIPE_movetofront",function(e){i.select(e).moveToFront()}.bind(this)),this.listenTo(a,"ENORIPE_Collapse",function(e,t){this.dispatchEvent("ENORIPE_Collapse",[[e],t])}.bind(this)))},hideAllExpandedMenu:function(){for(var e=0;e<Object.keys(this._expandMenuViews).length;e++)for(var t=this._expandMenuViews[Object.keys(this._expandMenuViews)[e]],i=0;i<Object.keys(t).length;i++)t[Object.keys(t)[i]].hideExpandedMenu()},destroy:function(){this._parent(),this.container=null},hideSpinner:function(){this._spinnerMap&&this._spinnerMap.hide()},onViewReady:function(){this.hideSpinner()}})})),define("DS/SNNavigationMap/views/ToolBarView",["UWA/Core","UWA/Class/View","UWA/Utils/Client","DS/Controls/ComboBox","DS/UIKIT/Iconbar","DS/UIKIT/DropdownMenu","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/SNNavigationMap/views/SNMapSelector","DS/UIKIT/Tooltip","DS/Controls/Label","DS/Controls/TooltipModel"],(function(e,t,i,n,s,o,a,r,l,c,d,h,u){"use strict";return t.extend({name:"ToolBar",toolbar:null,optionsDropdownMenu:null,leftIconBar:null,rightIconBar:null,renderTo:null,_addinMode:!1,_isWebInWin:!1,_excludedCommands:[],_helpRsc:"SNNavigationMap/help",className:function(){return this.getClassNames("-container")},setup:function(t){this.toolBar=new e.createElement("ul",{class:"map-toolbar",draggable:"false"}),this.renderTo=t.renderTo,this._addinMode=t.addinMode,this._isWebInWin=t.isWebInWin,this._excludedCommands=t.excludedCommands||[]},render:function(){var t=this,n=[{fonticon:"flow-tree-expand-down-cog",className:"ExpandCollapse_Command selectionIcon",id:"ExpandCollapse_Command",content:{type:"dropdownmenu",closeOnClick:!0,options:{multiSelect:!0,items:[{text:l.get("SNNavigationMap.Expand.Title"),className:"header"},{fonticon:"exchange-add",text:l.get("SNNavigationMap.ExpandUpAndDownstream.Title"),className:"ExpandUpAndDownstream_Command",name:"ExpandUpAndDownstream",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_Expand_Command"),r.trackUsage("Expand","AllDirectionsToolbar")}},{fonticon:"left-add",text:l.get("SNNavigationMap.ExpandUpstream.Title"),className:"ExpandUpstream_Command",name:"ExpandUpstream",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_Expand_Command","in"),r.trackUsage("Expand","OneDirectionToolbar")}},{fonticon:"right-add",text:l.get("SNNavigationMap.ExpandDownstream.Title"),className:"ExpandDownstream_Command",name:"ExpandDownstream",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_Expand_Command","out"),r.trackUsage("Expand","OneDirectionToolbar")}},{fonticon:"exchange-cog",text:l.get("SNNavigationMap.ExpandNLevel.Title"),className:"ExpandNLevel_Command",name:"ExpandNLevel",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_ExpandNLevel"),r.trackUsage("Expand","ExpandNLevelToolbar")}},{className:"divider"},{text:l.get("SNNavigationMap.Collapse.Title"),className:"header"},{fonticon:"exchange-minus",text:l.get("SNNavigationMap.CollapseUpAndDownstream.Title"),className:"CollapseUpAndDownstream_Command",name:"CollapseUpAndDownstream",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_Collapse_Command"),r.trackUsage("Collapse","AllDirectionsToolbar")}},{fonticon:"left-minus",text:l.get("SNNavigationMap.CollapseUpstream.Title"),className:"CollapseUpstream_Command",name:"CollapseUpstream",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_Collapse_Command","in"),r.trackUsage("Collapse","OneDirectionToolbar")}},{fonticon:"right-minus",text:l.get("SNNavigationMap.CollapseDownstream.Title"),className:"CollapseDownstream_Command",name:"CollapseDownstream",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_Collapse_Command","out"),r.trackUsage("Collapse","OneDirectionToolbar")}}],events:{onClick:function(e,t){r.trackUsage("Commands",t.name)}}}}},{fonticon:"eye-off",className:"Hide_Command selectionIcon",id:"ShowHide_Command",name:"Hide",handler:function(e,i){r.trackUsage("Commands","Hide"),t.dispatchEvent("ENORIPE_HideCommand")}},{className:"divider selectionIcon",name:"divider"},{fonticon:"linearGraph"==a.getLayoutType()?"object-related":"view-list",className:"LayoutType_Command",id:"LayoutType_Command",content:{type:"dropdownmenu",closeOnClick:!0,options:{multiSelect:!1,items:[{fonticon:"object-related",text:l.get("SNNavigationMap.LinearGraph.Title"),className:"linearGraph_Command",name:"linearGraph",selectable:!0,selected:"linearGraph"==a.getLayoutType()},{fonticon:"view-list",text:l.get("SNNavigationMap.DataGrid.Title"),className:"dataGrid_Command",name:"dataGridView",selectable:!0,selected:"dataGridView"==a.getLayoutType()}],events:{onClick:function(e,i){r.trackUsage("LayoutType","ChangeLT-"+i.name),t.dispatchEvent("ENORIPE_SwitchLayout",i.name)}}}}},{fonticon:"cog",className:"Customize_Command",id:"Customize_Command",handler:function(){r.trackUsage("Commands","CustomizeAll"),t.dispatchEvent("ENORIPE_CustomizeAllCommandClick")}},{fonticon:"select-on",className:"multisel-icons",id:"Selection_Command",content:{type:"dropdownmenu",closeOnClick:!0,options:{multiSelect:!0,items:[{fonticon:"select-all",text:l.get("SNNavigationMap.selectAll.Title"),className:"SelectAll_Command",name:"SelectAll",selectable:!1,handler:function(e){t.dispatchEvent("ENORIPE_selectAllFromCommand")}},{fonticon:"filter-select-on",text:l.get("SNNavigationMap.selectFiltered.Title"),className:"SelectFiltered_Command disabledOnDatagrid",name:"SelectFiltered",id:"SelectFiltered",selectable:!1,handler:function(e){t.dispatchEvent("ENORIPE_selectOutFilteredFromCommand")}},{fonticon:"select-inverted",text:l.get("SNNavigationMap.selectInverse.Title"),className:"SelectInverse_Command",name:"SelectInverse",selectable:!1,handler:function(e){t.dispatchEvent("ENORIPE_selectInverseFromCommand")}},{fonticon:"select-on-cog",text:l.get("SelectionAssistant-Title"),className:"SelectionAssistant_Command",name:"SelectionAssistant",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_SelectionAssistantFromCommand")}},{fonticon:"select-none",text:l.get("SNNavigationMap.clearSelection.Title"),className:"ClearSelection_Command",name:"ClearSelection",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_clearSelectionFromCommand")}}],events:{onClick:function(e,t){r.trackUsage("Commands",t.name)},onShow:function(e,t){this.updateLayout()}.bind(this)}}}},{fonticon:"pencil",className:"EditLayout_Command disabledOnDatagrid",id:"EditLayout_Command",selectable:!0,name:"EditLayout",handler:function(e,i){t.dispatchEvent("ENORIPE_EditLayoutCommandClick")}},{fonticon:"favorite-on",className:"Favorite_Command",id:"Favorite_Command",name:"Favorite",handler:function(e,i){r.trackUsage("Commands","Favorite"),t.dispatchEvent("ENORIPE_FavoriteCommandClick")}},{fonticon:"info",className:"Info_Command",id:"Info_Command",name:"Information",handler:function(e,i){t.dispatchEvent("ENORIPE_InfoCommandClick")}},{fonticon:"menu-dot",className:"DropdownMenu_Command",text:l.get("SNNavigationMap.Options.Title"),id:"toolBar-dropdownMenu",handler:function(){t.toolBar.getElement(".iconbar-overflow-menu-trigger")&&t.optionsDropdownMenu.show()}}].filter((function(e){return void 0!==e})),c=[{fonticon:"path-related",text:l.get("SNNavigationMap.computePaths.Title"),id:"ComputePath_Command",className:"ComputePath_Command",name:"ComputePath",handler:function(e,i){t.dispatchEvent("ENORIPE_ComputePathCommandClick")}},{className:"divider"},{fonticon:"arrow-double-combo",text:l.get("SNNavigationMap.fitAll.Title"),id:"FitAllIn_Command",className:"FitAllIn_Command disabledOnDatagrid",name:"FitAllIn",handler:function(e,i){t.dispatchEvent("ENORIPE_FitAllCommandClick")}},{fonticon:"clear",text:l.get("SNNavigationMap.clearMap.Title"),id:"ClearView_Command",className:"ClearView_Command",name:"ClearMap",handler:function(e,i){t.dispatchEvent("ENORIPE_ClearMapCommandClick")}},{fonticon:"refresh",text:l.get("SNNavigationMap.refreshMap.Title"),tooltipPosition:"bottom right",id:"Refresh_Command",className:"Refresh_Command",name:"RefreshMap",handler:function(e,i){t.dispatchEvent("ENORIPE_RefreshMapCommandClick")}},{fonticon:"print",text:l.get("SNNavigationMap.printMap.Title"),id:"Print_Command",className:"Print_Command",name:"PrintMap",handler:function(e,i){t.dispatchEvent("ENORIPE_PrintCommandClick")}},{fonticon:"export-to-csv",text:l.get("SNNavigationMap.export.Title"),id:"Export_Command",className:"Export_Command disabledOnGraph",name:"Export",handler:function(e,i){t.dispatchEvent("ENORIPE_ExportCommandClick")}}].filter((function(e){return void 0!==e}));i.Platform.android&&(c=c.filter((function(e){return"Print_Command"!==e.className}))),"solidworks"!==this._addinMode&&"catiav5"!==this._addinMode||n.unshift({fonticon:"open",text:l.get("SNNavigationMap.openMap.Title"),className:"Open_Command",name:"Open",handler:function(e,i){r.trackUsage("Commands","Open"),t.dispatchEvent("ENORIPE_OpenCommandClick")}}),this._isWebInWin&&n.unshift({fonticon:"search",text:l.get("MapSearchView_search"),className:"Search_Command",name:"Search",handler:function(e,i){r.trackUsage("Commands","Search"),t._handleSearch()}});var g=[{fonticon:"home",id:"Home_Command",className:"Home_Command",name:"HomePage",handler:function(e,i){r.trackUsage("Commands","HomePage"),t.dispatchEvent("ENORIPE_HomeCommandClick")}},{className:"divider favorite-divider",name:"FavoriteDivider"}];this._excludedCommands.length>0&&(n=1===this._excludedCommands.length&&"All"===this._excludedCommands[0]?[]:this.excludeCommands(n),g=1===this._excludedCommands.length&&"All"===this._excludedCommands[0]?[]:this.excludeCommands(g),c=1===this._excludedCommands.length&&"All"===this._excludedCommands[0]?[]:this.excludeCommands(c)),this.leftIconBar=new s({renderTo:t.toolBar,className:"left-toolbar-relations",tooltipsPosition:"bottom",items:g}),this.rightIconBar=new s({renderTo:t.toolBar,className:"right-toolbar-relations",tooltipsPosition:"bottom",items:n,events:{onShow:function(){this.updateLayout()}.bind(this)}}),this.onIconMouseOver=function(e,t){let i=e.target;if(!i.tooltipInfos||null===!i.tooltipInfos.elements){let e=p.some((e=>e.helpId===t)),n=new u({initialDelay:200,shortToLongDelay:1200,allowUnsafeHTMLLongHelp:!0,mouseRelativePosition:!1,position:e?"left":"bottom"});n.loadFromHelpRscFile(this._helpRsc,t),i.tooltipInfos=n}};[{iconId:"Home_Command",helpId:"RelationsHome"}].forEach((({iconId:e,helpId:t})=>{this.leftIconBar.getItem(e).elements.container.addEventListener("mouseover",(e=>{this.onIconMouseOver(e,t)}))}));[{iconId:"EditLayout_Command",helpId:"RelationsEditLayout"},{iconId:"Favorite_Command",helpId:"RelationsFavourite"},{iconId:"Info_Command",helpId:"RelationsInformation"},{iconId:"ExpandCollapse_Command",helpId:"RelationsExpandCollapse"},{iconId:"ShowHide_Command",helpId:"RelationsShowHide"},{iconId:"LayoutType_Command",helpId:"RelationsViews"},{iconId:"Customize_Command",helpId:"RelationsCustomize"},{iconId:"Selection_Command",helpId:"RelationsMultiSelection"}].forEach((({iconId:e,helpId:t})=>{this.rightIconBar.getItem(e).elements.container.addEventListener("mouseover",(e=>{this.onIconMouseOver(e,t)}))})),this.favoriteText=e.createElement("span",{class:"Enoripe-FavoriteText"}),this.favoriteText.addEventListener("mouseenter",(e=>{let t=e.target;t.offsetWidth<t.scrollWidth?(t.tooltipInfos&&null!==t.tooltipInfos.elements||(t.tooltipInfos=new d({position:"bottom right",target:t,body:t.textContent})),e.touchFlag&&t.tooltipInfos.show()):t.tooltipInfos&&t.tooltipInfos.elements&&t.tooltipInfos.destroy()})),this.favoriteText.inject(this.leftIconBar.elements.container),this._hideFavoriteDivider(),this.favoriteText.inject(this.leftIconBar.elements.container),a.is3DSpaceIUExistingAndTenantAllowed()&&a.getRedirectQueryToSGI()&&new h({value:"SGI Mode",emphasize:"highlight"}).inject(this.leftIconBar.elements.container),this._isWebInWin&&(this.searchContainer=e.createElement("li",{class:"Enoripe-SearchContainer"})),this.toolBar.addEventListener("dragenter",(function(e){e.stopPropagation()})),this.toolBar.inject(this.renderTo),-1===this._excludedCommands.indexOf("All")&&-1===this._excludedCommands.indexOf("DropdownMenu_Command")&&(this.optionsDropdownMenu=new o({target:this.rightIconBar.getItem("toolBar-dropdownMenu").elements.container,className:"optionsDropdownMenu",multiSelect:!0,items:c,responsiveMode:!0,events:{onClick:function(e,t){0!=t.selected&&r.trackUsage("Commands",t.name),this.dispatchEvent("ENORIPE_"+t.name,t.selected)}.bind(this),onShow:function(){this.updateLayout()}.bind(this)}}));const p=[{iconId:"ComputePath_Command",helpId:"RelationsFindPaths"},{iconId:"FitAllIn_Command",helpId:"RelationsFitAll"},{iconId:"ClearView_Command",helpId:"RelationsClearView"},{iconId:"Refresh_Command",helpId:"RelationsRefresh"},{iconId:"Print_Command",helpId:"RelationsPrint"},{iconId:"Export_Command",helpId:"RelationsExport"}];return p.forEach((({iconId:e,helpId:t})=>{this.optionsDropdownMenu.getItem(e).elements.container.addEventListener("mouseover",(e=>{this.onIconMouseOver(e,t)}))})),this.showAllToolbar(),this},getCommand:function(e){var t=this.toolBar.getElement("."+e);return t||((t=this.optionsDropdownMenu.elements.container.getElement("."+e))?t:void 0)},excludeCommands:function(e){for(var t=0;t<e.length;t++)this._excludedCommands.indexOf(e[t].className)>-1?(e.splice(t,1),t--):e[t].content&&"dropdownmenu"===e[t].content.type?e[t].content.options.items=this.excludeCommands(e[t].content.options.items):e[t].items&&(e[t].items=this.excludeCommands(e[t].items));return e},hideRightToolbar:function(){this.rightIconBar.hide()},hideItems:function(e){for(var t=document.getElementsByClassName("item "+e),i=0;i<t.length;i++)document.getElementById(t[i].id)&&document.getElementById(t[i].id).hide()},showItems:function(e){for(var t=document.getElementsByClassName("item "+e),i=0;i<t.length;i++)document.getElementById(t[i].id)&&document.getElementById(t[i].id).show()},hideSelectionIcon:function(){this.rightIconBar.elements.container.getElements(".selectionIcon").forEach((function(e){e.hide()})),this.toolBar.classList.remove("selectionIconOn"),this.rightIconBar.resize()},showSelectionIcon:function(){var e=a.getLayoutType();this.rightIconBar.elements.container.getElements(".selectionIcon").forEach(function(t){"dataGridView"===e&&t.className.contains("disabledOnDatagrid")||t.show()}.bind(this)),this.toolBar.addClassName("selectionIconOn"),this.rightIconBar.resize()},showAllToolbar:function(){this.toolBar.show(),this.rightIconBar.show(),this.leftIconBar.show()},toggleInfoCommand:function(){var e=this.getCommand("Info_Command");e.hasClassName("pressed")?e.removeClassName("pressed"):(e.addClassName("pressed"),r.trackUsage("Commands",e.getAttribute("name")))},updateLayout:function(){this.rightIconBar.getItem("LayoutType_Command");switch(a.getLayoutType()){default:case"linearGraph":this.showItems("disabledOnDatagrid"),this.hideItems("disabledOnGraph"),c.getSelected().length<=0&&this.hideSelectionIcon();break;case"dataGridView":this.hideItems("disabledOnDatagrid"),this.showItems("disabledOnGraph"),this.disableEditLayoutCommand();let e=this.getCommand("EditLayout_Command");e&&e.hasClassName("pressed")&&e.removeClassName("pressed")}this.updateLayoutMenu()},updateLayoutMenu:function(){var e=this.rightIconBar.getItem("LayoutType_Command"),t=e.elements.container,i=e.content.component,n=this.rightIconBar.getItem("LayoutType_Command").tooltip;switch(i&&i.getSelectedItems()[0].name!=a.getLayoutType()&&i.toggleSelection(i.getItem(a.getLayoutType())),a.getLayoutType()){default:case"linearGraph":t.firstChild.className="fonticon fonticon-object-related",n&&n.setBody(l.get("SNNavigationMap.LinearGraph.Title"));break;case"dataGridView":t.firstChild.className="fonticon fonticon-view-list",n&&n.setBody(l.get("SNNavigationMap.DataGrid.Title"))}},disableSelectionAssistantCommand:function(){try{var e=this.rightIconBar.getItem("Selection_Command").content.component;void 0!==e&&e.disableItem("SelectionAssistant")}catch(e){console.log(e)}},enableSelectionAssistantCommand:function(){try{var e=this.rightIconBar.getItem("Selection_Command").content.component;void 0!==e&&e.enableItem("SelectionAssistant")}catch(e){console.log(e)}},disableEditLayoutCommand:function(){let e=this.getCommand("EditLayout_Command");e&&e.hasClassName("pressed")&&e.removeClassName("pressed")},updateFavoriteTitle:function(e){this.favoriteText&&void 0!==e&&null!=e&&(this.favoriteText.setContent(e),""!==e?this._showFavoriteDivider():this._hideFavoriteDivider())},_showFavoriteDivider:function(){let e=this.leftIconBar.getItem("FavoriteDivider");e&&e.elements.container.show()},_hideFavoriteDivider:function(){let e=this.leftIconBar.getItem("FavoriteDivider");e&&e.elements.container.hide()},_handleSearch:function(){var t=this;if(this._searchModule)this._searchModule.container.isHidden()||this._searchModule.clearSearch(),this._searchModule.container.toggle();else{var i=e.createElement("li",{class:"Enoripe-SearchContainer"}).inject(this.rightIconBar.getContent().getChildren()[0],"top");require(["DS/SNNavigationMap/views/SearchViewForNative"],(function(e){t._searchModule=new e({renderTo:i}),t._searchModule.render(),t.listenTo(t._searchModule,"ENORIPE_performSearch_native",(function(e){t.dispatchEvent("ENORIPE_performSearch_native",e)})),t.listenTo(t._searchModule,"ENORIPE_resetSearch_native",(function(){t.dispatchEvent("ENORIPE_resetSearch_native")}))}))}},destroy:function(){this._parent(),this.toolBar.destroy(),this.toolBar=null,this.container=null},resizeHandler:function(){if(window&&window.innerWidth)window.innerWidth}})})),define("DS/SNNavigationMap/views/NavigationApp",["UWA/Core","UWA/Class","UWA/Class/View","DS/UIKIT/Spinner","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/SNNavigationMap/views/SplittedDropView","DS/UIKIT/Native/Dropdown","DS/SNNavigationMap/utils/SNNavigationServices","DS/SNNavigationMap/views/SNMapSelector","DS/SNNavigationMap/models/CountOnNode","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Mask","DS/UIKIT/SuperModal","DS/UIKIT/Input/Button","DS/Controls/Button","DS/Windows/ImmersiveFrame","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/PreferencesUtils","DS/SNNavigationMap/utils/ProbesUtils","DS/SNNavigationMap/views/D3MapView","DS/SNNavigationMap/views/DataGridView","DS/SNNavigationMap/views/ListView","DS/SNNavigationMap/views/ToolBarView","DS/SNNavigationMap/views/NavigationPager","DS/SNNavigationMap/utils/TaggerServices","DS/SNNavigationMap/utils/CommonUtils","DS/SNNavigationMap/utils/RelationsServices","DS/SNNavigationMap/views/popups/ExpandNLevel","DS/SNNavigationMap/views/popups/WhatsNew","DS/ENORIPE_Common/utils/CommonUtilsServices","DS/ENORIPE_Common/utils/CommonAlert","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/TransientWidget/TransientWidget","DS/WebUAUtils/WebUAUtils","DS/SNNavigationMap/utils/SearchUtils","DS/WebappsUtils/WebappsUtils","css!DS/SNNavigationMap/SNNavigationMap"],(function(e,t,i,n,s,o,a,r,l,c,d,h,u,g,p,f,m,v,_,S,b,N,w,C,I,E,y,D,P,O,M,x,A,T,R,k){"use strict";var V=i.extend({name:"navigation-app-view",rootModel:null,_isFiltered:!1,_isSearched:!1,_currentlyFilteredNodes:[],_currentlySearchedNodes:[],_lastFilterData:{},_isEmpty:!0,_isWebInWin:r.isWebInWin(),_theContextualMenu:null,_theContextualMenuTarget:{},_infoPanelCommandClick:!1,_isPreviewPanelOpen:!1,_appliedTags:0,_currentLayout:"linearGraph",_currentView:null,immersiveFrame:null,className:function(){return this.getClassNames("-container")},setup:function(t){this._autoNavMode=t.autoNavMode,this._layoutUtils=t.layoutUtils,this._countLimit=t.countLimit,this._lang=t.lang,this._isEmpty=t.isEmpty,this._widgetId=t.widgetId,this._widget=t.widget,this._platformId=t.platformId,this._lastRootID=t.lastRootID,this._debug=t.debugMode||!1,this._errorOnInit=t.errorOnInit,this._addinMode=t.addinMode,this._separator=t.separator,this._nameLabel=t.nameLabel,this._detailLabel1=t.detailLabel1,this._detailLabel2=t.detailLabel2,this.collection=t.collection?t.collection:null,this._PM=t.promiseManager,this._preSelectedObjectIds=t.preSelectedObjectIds,this._inAppOptions=t.inAppOptions,m.getLayoutType()&&(this._currentLayout=m.getLayoutType(),_.trackUsage("LayoutType","InitLT-"+this._currentLayout)),"catiav5"!==this._addinMode&&"solidworks"!==this._addinMode||this.container.addClassName("addin-mode-ripe"),this._spinner=(new n).inject(e.createElement("div",{styles:{position:"absolute","z-index":"201",top:"5px"}}).inject(this.container,"top")),this.showSpinner(),this._errorOnInit&&(this._errorOnInit.forEach(function(e){let t="";t=e.options?s.replace(s.get(e.errorMsg),{type:s.get(e.options.type),label:e.options.displayName}):s.get(e.errorMsg),this._showNotif({level:"error",msg:t})}.bind(this)),this._errorOnInit=!1),this._updateNLSForSavedAttrs(),this._initCollection(this.collection),this._initialize()},_initialize:function(){var t=this;this.setContainerEvents(),this._dropInvite=e.createElement("div",{class:"drop-invite",html:[{tag:"span",class:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-drag-drop"},{tag:"p",class:"drop-content-here",html:s.get("dropHere")}]}).inject(this.container),this._isWebInWin||(e.createElement("p",{class:"drop-invite-or",html:s.get("dropInviteOr")}).inject(this._dropInvite),this._openContentButton=new p({label:s.get("dropInviteOpenContent"),displayStyle:"normal",emphasize:"primary"}).inject(this._dropInvite),this._openContentButton.addEventListener("click",function(e){R.inAppSearch({showApplyButton:!1,title:s.get("inAppSearchOpenContentInRelations"),fts_value:"",search_criteria_to_display:"",callback:function(e){var i=e;t._handleDrop("add",i)}})}.bind(this))),this._dropInvite.hide(),this._dropZone=(new o).inject(this.container),this.listenTo(this._dropZone,"ENORIPE_drop",this._handleDrop),this.listenTo(this._dropZone,"ENORIPE_dropNotSupported",(function(){t._showNotif({level:"error",msg:s.get("dropNotSupported")})})),this.listenTo(this._dropZone,"ENORIPE_SDV_hide",this.setContainerEvents),window.addEventListener("keyup",this._onKeyUp.bind(this)),this._isEmpty?this._initEmptyMap():this._initSubViews(),this._initTagger()},_initCollection:function(e){e&&e!=this.collection&&(this.collection=e,this.listenTo(this.collection,"onSync",this.render.bind(this)))},_initSubViews:function(){this.showSpinner();var e=this.collection.getFocusedNode(),t=this;if(this.mapView||(this.mapView=new S({layoutUtils:this._layoutUtils,layoutAxis:this._layoutAxis,layoutDirection:this._layoutDirection,countLimit:this._countLimit,nameLabel:this._nameLabel,separator:this._separator,selector:l,dropZone:this._dropZone,spinner:this._spinner}),this.mapView.setSVGDimensions(this.ctnHeight,this.ctnWidth),this.listenTo(this.mapView,"onNodeClicked",this.nodeClicked),this.listenTo(this.mapView,"onNodeRightClicked",(function(e){var t=this,i=e.id;i&&(l.isSelected(i)||(t.clearSelection("MapView"),t._manageSelection({models:i,sAction:"add",origin:"MapView"}))),t._OnRightClick(e)})),this.listenTo(this.mapView,"ENORIPE_splitCount",this.splitCount),this.listenTo(this.mapView,"ENORIPE_Collapse",this.collapseNode),this.listenTo(this.mapView,"ENORIPE_dragEnd",this._hideDropZones),this.listenTo(this.mapView,"ENORIPE_showNotif",this._showNotif),this.listenTo(this.mapView,"ENORIPE_MultiSel_Object",function(e){this._manageSelection(e)}.bind(this)),this.listenTo(this.mapView,"ENORIPE_ReorderColumn",this._reorderColumn),this.listenTo(this.mapView,"ENORIPE_downloadDocument",this._handleDownload),this.listenTo(this.mapView,"ENORIPE_clearSelection",this.clearSelection),this.listenTo(this.mapView,"ENORIPE_Drop",this._handleDrop),this.listenTo(this.mapView,"ENORIPE_clickListInstance",this._clickListInstance),this.listenTo(this.mapView,"ENORIPE_clickMoreInstance",this._clickMoreInstance),this.listenTo(this.mapView,"ENORIPE_toggleInstance",this.toggleInstance),this.listenTo(this.mapView,"ENORIPE_dragElement",this.dragElement),this.listenTo(this.mapView,"ENORIPE_ShowPreview",this._showPreview),this.listenTo(this.mapView,"ENORIPE_HandlePathPanel",(function(e){if(e){var i=t.collection.get(e);i&&("ENOStrRefinementSpecification"===i.get("type")&&this.collection.filter((function(e){"link"===e.get("modelType")&&(e.get("source").id===i.get("id")?i._attributes.linked=t.collection.get(e.get("target").id):e.get("target").id===i.get("id")&&(i._attributes.linked=t.collection.get(e.get("source").id)))})),t.pathPanel.addNodes(i))}})),this.listenTo(this.mapView,"removefocus",(function(e){if(e){var i=t.collection.get(e);i&&i.set("focus",!1)}})),this.listenTo(this.mapView,"ENORIPE_GetNlsAttrInfo",this.updateMapViewAttributesNls.bind(this)),this.listenTo(this.mapView,"ENORIPE_UpdateD3Map",this._updateCollection),this.mapView.inject(this.container),this._currentView=this.mapView),this.dataGridView?this.dataGridView.clear():(this.dataGridView=new b({promiseManager:this._PM,isWebInWin:this._isWebInWin,collection:this.collection,tenantName:m.getCurrentTenantName()||"OnPremise"},this.collection),this.dataGridView.inject(this.container),this.dataGridView.hide(),this.listenTo(this.dataGridView,"handleServerErrorMsgs",this.handleServerErrorMsgs),this.listenTo(this.dataGridView,"ENORIPE_CollapseNode",this.collapseNodeOnDatagrid),this.listenTo(this.dataGridView,"ENORIPE_ExpandNode",this.splitCount),this.listenTo(this.dataGridView,"ENORIPE_DownloadDocument",this._handleDownload),this.listenTo(this.dataGridView,"onRowRightClicked",this._OnRightClick),this.listenTo(this.dataGridView,"ENORIPE_onRowClicked",function(e){e.nodeId&&e.action&&(m.getInstancesMode()&&e.instanceId?this.toggleInstance(e):this._manageSelection({models:e.nodeId,sAction:e.action,origin:"DataGridView"}))}.bind(this)),this.listenTo(this.dataGridView,"ENORIPE_dragElement",this.dragElement),this.listenTo(this.dataGridView,"ENORIPE_HideOneDirection",function(e){this.hideOneDirection(e)}.bind(this)),this.listenTo(this.dataGridView,"ENORIPE_ShowOneDirection",function(e){this.dispatchEvent("ENORIPE_ShowOneDirection",[e,!0])}.bind(this)),this.listenTo(this.dataGridView,"ENORIPE_UpdateCollectionWithView",this._updateCollectionWithView),this.listenTo(this.dataGridView,"ENORIPE_ExportMsg",function(e){this.exportMsg(e)}.bind(this))),!this.listView){this.listView=new N({model:e,widgetId:this._widgetId,isWebInWin:this._isWebInWin,collection:this.collection}),this.listenTo(this.listView,"ENORIPE_handleErrorMsgs",this.handleServerErrorMsgs),this.listenTo(this.listView,"ENORIPE_CloseListView",this.toggleInformationsPanel),this.listenTo(this.listView,"ENORIPE_ResizeListViewPanel",function(e){this.dispatchEvent("ENORIPE_ResizeListViewPanel",e)}.bind(this)),t.listenTo(t.listView,"ENORIPE_extractNode",(function(e){t._extractNode(e)})),t.listenTo(t.listView,"ENORIPE_DownloadDocument",this._handleDownload);let i=this.container;this.listView.inject(i)}this._toolBarView?this._toolBarView.showAllToolbar():this.setUpToolBar(w);try{m.getOption("inAppMode")&&this._setupInAppView()}catch(e){console.log("inAppsError--"+e)}m.getInformationPanelVisibility()!=this.listView.isVisible&&this.toggleInformationsPanel(),this.expandNLevelView||(this.expandNLevelView=new D({widgetId:this._widgetId}),this.listenTo(this.expandNLevelView,"ENORIPE_fullImport",function(e){e&&e.sessionId&&this.collection.fullImport(e.sessionId)}.bind(this)));var i={ctx:this,collection:this.collection,platformId:this._platformId,widgetId:this._widgetId};l.initialize(i),!0===this._setFirstFocusOnCompass&&(this._setFirstFocusOnCompass=!1),!this._isEmpty&&this._dropInvite&&this._dropInvite.hide(),this._isEmpty||this.dispatchEvent("ENORIPE_HideHomePage"),void 0===this.immersiveFrame||null===this.immersiveFrame?(this.immersiveFrame=new f({}),this.immersiveFrame.inject(this.container),T.setPanelHelpMode({immersiveFrame:this.immersiveFrame})):this.immersiveFrame&&this.container&&(this.container.removeChild(this.immersiveFrame.elements.container),this.immersiveFrame.inject(this.container)),m.is3DSpaceIUExistingAndTenantAllowed()&&!m.getWhatsNewDoNotShowAgain()&&(this._whatsNew||(this._whatsNew=new P({immersiveFrame:this.immersiveFrame}),this._whatsNew.addEvent("ENORIPE_OpenDisplayOptions",(()=>{this.dispatchEvent("ENORIPE_CustomizeAll","DisplayOptions")})),this._whatsNew.addEvent("ENORIPE_HighlightDisplayOption",(e=>{this.dispatchEvent("ENORIPE_HighlightDisplayOption",e)}))))},_setupInAppView:function(){var t=this;if(!this._inAppView){var i,n,o,a=e.createElement("div",{class:"enoripe-inAppContainer"}).inject(this.container),r=new g({value:s.get("inAppOK"),className:"primary enoripe-inAppOK"}).inject(a),l=new g({value:s.get("inAppCancel"),className:"default enoripe-inAppCancel"}).inject(a);this._inAppOptions&&this._inAppOptions.localUID&&(i="ENORIPE-InApp-"+this._inAppOptions.localUID,n=i+"/onOK",o=i+"/onCancel"),r.addEvent("onClick",(function(){var e=[];t.collection.where({modelType:"node",focus:!0}).forEach((function(t){e.push({id:t.id})})),t._inAppOptions&&t._inAppOptions.localUID&&d.publish(n,e),A.closeWidget()})),l.addEvent("onClick",(function(){t._inAppOptions&&t._inAppOptions.localUID&&d.publish(o),A.closeWidget()})),this._inAppView={container:a,okBtn:r,cancelBtn:l}}},render:function(e,t,i){var n=e.getLinksAndNodes(!1),s=i?JSON.parse(i.data):"";t=t?JSON.parse(t):null;if(this._isSearched)if(this._continueSearch){var o=this._searchValue;o&&this.dispatchEvent("ENORIPE_Search",o),this._continueSearch=!1}else this.clearFilterBySearch();if(0!==n.nodes.length){if(this._lastRootID&&0!==this._lastRootID.length||this._initLastRootWithColumnId(),"dataGridView"==this._currentLayout){let i=!(!t||!t.objectsAndLinksBySteps);this._updateDatagridView(e,i),this._currentView=this.dataGridView}else if(this.mapView){let t=e.where({instancesNeedUpdate:!0});t&&t.length>0&&(this._currentView.updateInstancesList(t),t.forEach((function(e){e.set("instancesNeedUpdate",!1)})));let i=!1;this.mapView.isInitWithNodes()||(i=!0),this.mapView.render(n,e.groupBy("columnID")),this._currentView=this.mapView,i&&this._manageFocus()}if(_.getStartTime("init")){let e="linearGraph"===m.getLayoutType()?1:2;_.trackPerformance("init","init",{LayoutType:e})}this.dispatchEvent("ENORIPE_SetNavigatedNode",[this.collection.getIdentifierDataById()]);let i=[];return s&&s.items&&s.items.length>0&&(i=s.items.map((e=>e.id))),this._updateCountModel().then(function(){this._updateCountView(i)}.bind(this)).catch(function(){this._updateCountView(i)}.bind(this)),this.listView&&this._infoPanelCommandClick&&this.manageProperties(),this._isWebInWin&&(this.collection._isBusy()||r.sendStringRelationsToWebInWin("ENORIPE_ViewReady","done")),this._afterRender(),this.updateFilterProxy(),void 0!==this._preSelectedObjectIds&&Array.isArray(this._preSelectedObjectIds)&&this._preSelectedObjectIds.length>0&&(this.clearSelection(),this._selectInGraph(this._preSelectedObjectIds),this._preSelectedObjectIds=[]),m.getOption("inAppMode")&&(this._inAppOptions&&void 0!==this._inAppOptions.preSelectedObjectIds&&(this.clearSelection(),this._selectInGraph(this._inAppOptions.preSelectedObjectIds)),this._checkInAppOkBtn()),this}this.dispatchEvent("ENORIPE_ClearMap")},renderAfterRemove:function(){var e=this.collection.getLinksAndNodes(!1);if(this._lastRootID&&0!==this._lastRootID.length||this._initLastRootWithColumnId(),this._currentView.removeSelectedNodes(e,this.collection.groupBy("columnID")),this.mapView){let e=!1;this.mapView.isInitWithNodes()||(e=!0),e&&this._manageFocus()}return this.dispatchEvent("ENORIPE_SetNavigatedNode",[this.collection.getIdentifierDataById()]),this._updateCountModel().then(function(){this._updateCountView()}.bind(this)),this.updateFilterProxy(),this.hideSpinner(),this},setUpToolBar:function(e){var t=this;this.profileArray=[],this.dispatchEvent("ENORIPE_ProfileInfo");var i=[];this._inAppOptions&&void 0!==this._inAppOptions.excludedToolBarCommands&&(i=this._inAppOptions.excludedToolBarCommands);let n=this.container.parentElement||this.container;this._toolBarView=new e({renderTo:n,lang:this._lang,addinMode:this._addinMode,isWebInWin:this._isWebInWin,excludedCommands:i}),this._toolBarView.render(),this._favTitle&&this._toolBarView&&this._toolBarView.updateFavoriteTitle(this._favTitle),this.listenTo(this._toolBarView,"ENORIPE_selectAllFromCommand",this.selectAllFromCmd),this.listenTo(this._toolBarView,"ENORIPE_selectOutFilteredFromCommand",this.selectOutFilteredFromComd),this.listenTo(this._toolBarView,"ENORIPE_selectInverseFromCommand",this.inverseSelectionFromCmd),this.listenTo(this._toolBarView,"ENORIPE_clearSelectionFromCommand",this.clearSelection),this.listenTo(this._toolBarView,"ENORIPE_CustomizeAllCommandClick",this.customizeAll),this.listenTo(this._toolBarView,"ENORIPE_InfoCommandClick",this.toggleInformationsPanel),this.listenTo(this._toolBarView,"ENORIPE_PrintCommandClick",this.printMap),this.listenTo(this._toolBarView,"ENORIPE_ExportCommandClick",this.exportDatagrid),this.listenTo(this._toolBarView,"ENORIPE_ComputePathCommandClick",(function(){t.pathPanel&&this.pathPanel.visibleFlag||t.computePaths()})),this.listenTo(this._toolBarView,"ENORIPE_FitAllCommandClick",this.fitAllInMap),this.listenTo(this._toolBarView,"ENORIPE_ClearMapCommandClick",this.clearMapClick),this.listenTo(this._toolBarView,"ENORIPE_RefreshMapCommandClick",this.refreshMapCmd),this.listenTo(this._toolBarView,"ENORIPE_OpenCommandClick",this.openCAD),this.listenTo(this._toolBarView,"ENORIPE_HideCommand",this.hideNodes),this.listenTo(this._toolBarView,"ENORIPE_ExcludeCommand",this.excludeNodes),this.listenTo(this._toolBarView,"ENORIPE_Expand_Command",this.expandSelectedNodes),this.listenTo(this._toolBarView,"ENORIPE_Collapse_Command",this.collapseSelectedNodes),this.listenTo(this._toolBarView,"ENORIPE_EditLayoutCommandClick",this.editLayout),this.listenTo(this._toolBarView,"ENORIPE_ExpandNLevel",this.expandNLevel.bind(this)),this.listenTo(this._toolBarView,"ENORIPE_HomeCommandClick",function(){if(this.collection&&this.collection.getNodesIds().length>0?this.dispatchEvent("ENORIPE_FavoriteModal",{saveIn:!0}):this.dispatchEvent("ENORIPE_ShowHomePage"),this.pathPanel&&(this.pathPanel.destroy(),this.pathPanel=null),this._selectionAssistant&&(this._selectionAssistant.destroy(),this._selectionAssistant=null),T){let e=T.getCurrentUAPanel();e&&e.isUAPanelReady()&&T.closePanelHelp()}}.bind(this)),this.listenTo(this._toolBarView,"ENORIPE_FavoriteCommandClick",function(){this.dispatchEvent("ENORIPE_FavoriteModal")}.bind(this)),this.listenTo(this._toolBarView,"ENORIPE_SelectionAssistantFromCommand",this.selectionAssistant.bind(this)),this.listenTo(this._toolBarView,"ENORIPE_SwitchLayout",(function(e){this.switchLayout(e)})),this._isWebInWin&&(this.listenTo(this._toolBarView,"ENORIPE_performSearch_native",(function(e){this.dispatchEvent("ENORIPE_performSearch_native",e)})),this.listenTo(this._toolBarView,"ENORIPE_resetSearch_native",(function(){this.clearFilterBySearch()})))},_initEmptyMap:function(e){"maximized"!==this._widgetStateAtInit||e||this._errorOnInit||this._showNotif({level:"error",msg:s.get("emptyMap")}),this._errorOnInit=!1,this.hideSpinner(),this._isEmpty&&this._dropInvite&&this._dropInvite.show()},_updateContainerDimensions:function(){var t=this.container.parentElement;if(t){var i=(t=t.getDimensions?t:e.extendElement(t)).getDimensions();this.ctnWidth=i.width,this.ctnHeight=this._isWebInWin?window.innerHeight:i.height,this.container.setStyle("height",this.ctnHeight)}},_updateDropZonesHeight:function(){var e=this.listView?this.container.getDimensions().width-this.listView.getWidth():this.container.getDimensions().width;this._dropZone&&this._dropZone.updateHeight(this.ctnHeight,e)},_updateSVGContainer:function(){this.mapView&&this.mapView.setSVGDimensions(this.ctnHeight,this.ctnWidth)},_reorderColumn:function(e,t,i){var n=this.collection.groupBy("columnID")[e.columnID];n.sort((function(e,t){return e._attributes.rowID>t._attributes.rowID?1:t._attributes.rowID>e._attributes.rowID?-1:0})),n.splice(i,0,n.splice(e.rowID,1)[0]);for(var s=0;s<n.length;s++)n[s].set("rowID",s);this.mapView.render(this.collection.getLinksAndNodes(),this.collection.groupBy("columnID"))},_afterRender:function(){this._pathSelReq&&(this._pathSelReq=!1,this._selectInGraph(this._pathSelReqNodes))},_checkInAppOkBtn:function(){if(this.collection){var e=this.collection.where({modelType:"node",focus:!0}).length;this._inAppView&&(e>0?this._inAppView.okBtn.enable():this._inAppView.okBtn.disable())}},_updateCollection:function(){var e=this,t=null,i=null;this.collection.filter((function(n){(t=e.mapView.getElement("#container-"+CSS.escape(n.id)+" .instance-list-g"))&&"node"===n.get("modelType")&&n.get("instances")&&n.get("instances").length>0&&(i=t.getElements(".instance-text"),t.classList.contains("expand")?n.set("instancesExpanded",i.length):n.get("instancesExpanded")>m.getOption("showInstancesLimit")?n.set("instancesExpanded",-1):n.set("instancesExpanded",0))}))},_hideDropZones:function(){this._dropZone&&this._dropZone.hide()},_updateCountModel:function(){var e=[],i=[],n={},s=[],o=[],a=[];return new t.Promise(function(t,r){(e=this.collection.where({modelType:"node"})).forEach(function(e){e.get("counts")?e.get("counts").get("requestDone")||(i.push(e.get("identifierData")),e.get("counts").set("requestDone",!0)):e.set("counts",new c({source:e.id}))}.bind(this)),i.length>0?(this.dispatchEvent("Customize_LoadingRelations"),y.getRelationsCount({items:i}).then(function(r){s=JSON.parse(r).counts,i.forEach(function(e){(n=this.collection.get(e.id).get("counts")).set("requestDone",!0),(o=s.filter((function(t){return t.source===e.id}))).length>0&&n.parse(o),a.push(n)}.bind(this)),e.forEach(function(e){e.get("counts").resetRealCount(this.collection)}.bind(this)),this.updateRelationsDisplayed(),t()}.bind(this)).catch(function(e){console.log(e),r()}.bind(this))):(e.forEach(function(e){e.get("counts").resetRealCount(this.collection)}.bind(this)),this.dispatchEvent("Customize_UnloadCustomizeRelations"),t())}.bind(this))},updateRelationsDisplayed:function(){var e=[];this.collection.where({modelType:"node"}).forEach((function(t){t.get("counts")&&t.get("counts").hasCount()&&t.get("counts").getAllCountAttribute("name").forEach((function(t){e.indexOf(t)<0&&e.push(t)}))})),this.dispatchEvent("Customize_UpdateRelationsDisplayed",[e])},_updateCountView:function(e){this._currentView.updateCount(this.collection,e)},_clickListInstance:function(e){var t=this.collection.get(e),i=this.mapView.getElement("#container-"+CSS.escape(e)+" .instance-list-g"),n=[];if(i){if(t.get("instancesExpanded")>0){t.get("instancesExpanded")>m.getOption("showInstancesLimit")?t.set("instancesExpanded",-1):t.set("instancesExpanded",0);for(var s=i.getElements(".instance-text"),o=0;o<s.length;o++){var a=s[o].id.replace("instance-","");n.push(a),this._currentlyFilteredNodes&&this._currentlyFilteredNodes.indexOf(a)>-1&&this._currentlyFilteredNodes.splice(this._currentlyFilteredNodes.indexOf(a),1)}this.taggerServices.removeRoots(n)}else{s=i.getElements(".instance-text");if(t.set("instancesExpanded",s.length),this._currentlyFilteredNodes&&this._currentlyFilteredNodes.length>0)for(o=0;o<s.length;o++)this._currentlyFilteredNodes.indexOf(s[o].id.replace("instance-",""))<0&&this._currentlyFilteredNodes.push(s[o].id.replace("instance-",""))}this.mapView.updateConstraints(this.collection.getLinksAndNodes(),this.collection.groupBy("columnID")),this.updateFilterProxy()}},_clickMoreInstance:function(e,t){var i=this.collection.get(e);if(this.mapView.getElement("#container-"+CSS.escape(e)+" .instance-list-g")&&(i.set("instancesExpanded",t.length),this._currentlyFilteredNodes&&this._currentlyFilteredNodes.length>0))for(var n=0;n<t.length;n++)this._currentlyFilteredNodes.indexOf(t[n].id)<0&&this._currentlyFilteredNodes.push(t[n].id);this.mapView.updateConstraints(this.collection.getLinksAndNodes(),this.collection.groupBy("columnID")),this.updateFilterProxy()},toggleInstance:function(e){var t=this.collection.get(e.nodeId),i=[];if(null!=t.get("selectedInstance")&&(i=t.get("selectedInstance")),e.selected?(null!=i?i.push(e.instanceId):i=[e.instanceId],t.set("selectedInstance",i)):i.length>1&&e.instanceId&&i.indexOf(e.instanceId)?(i.splice(i.indexOf(e.instanceId),1),t.set("selectedInstance",i)):t.set("selectedInstance",null),null!=e.selected){var n=e.selected?"add":"remove";this._manageSelection({models:e.nodeId,sAction:n,instanceId:e.instanceId})}},toggleListInstances:function(e){this.collection.filter((function(t){if("node"===t.get("modelType")&&t.get("instances")&&t.get("instances").length>0)if(e){var i=Math.min(t.get("instances").length,m.getOption("showInstancesLimit"));-1==t.get("instancesExpanded")&&(i=t.get("instances").length),t.set("instancesExpanded",i)}else t.set("selectedInstance",null),t.get("instancesExpanded")>0&&(t.get("instancesExpanded")>m.getOption("showInstancesLimit")?t.set("instancesExpanded",-1):t.set("instancesExpanded",0))})),this._currentView.toggleAllInstances(this.collection,e),this.updateFilterProxy(),this.listView&&this._infoPanelCommandClick&&this.manageProperties()},selectionAssistant:function(){var e=this,t=this.collection.where({modelType:"node",focus:!0}),i=!0;t&&t.length>1&&(i=!1),this._SARenderOption={selOptions:{SDP:!1,SAP:!1,SDS:!1,SAS:!1,CommonResults:!1},disableCommon:i},this._selectionAssistant?this._selectionAssistant.render(this._SARenderOption):require(["DS/SNNavigationMap/views/popups/SelectionAssistantView"],(function(t){e._selectionAssistant||(e._selectionAssistant=new t({immersiveFrame:e.immersiveFrame})),e._selectionAssistant.render(e._SARenderOption),e.listenTo(e._selectionAssistant,"ENORIPE_UpdateSelection",(function(t){e._SARenderOption=t,e.handleSelections(t)}))}))},handleSelections:function(e){var t=e.selOptions,i=l.getSelected();if(t.CommonResults){var n,o=0;Object.values(t).forEach((function(e){e&&o++})),void 0!==(n=o>2?this._handleCommonSelForMultiCriteria(t,i):this._handleCommonSelections(t,i))&&n&&n.showNotif&&this._showNotif({level:"info",lvl:"primary",msg:s.get("SA-NoNewSelection")})}else for(var a in t)if(t[a])switch(a){case"SDP":this._handleSDP(i);break;case"SAP":this._handleSAP(i);break;case"SDS":this._handleSDS(i);break;case"SAS":this._handleSAS(i)}},_handleCommonSelForMultiCriteria:function(e,t){var i=!1,n=[],o=[];e.SAP?t.forEach((function(e){n[e.id]||(n[e.id]=[]);var t=l.getAllPredecessors([e]);t&&(n[e.id]=[...n[e.id],...t])})):e.SDP&&t.forEach((function(e){n[e.id]||(n[e.id]=[]);var t=l.getPredecessors([e]);t&&(n[e.id]=[...n[e.id],...t])})),e.SAS?t.forEach((function(e){n[e.id]||(n[e.id]=[]);var t=l.getAllSuccessors([e]);t&&(n[e.id]=[...n[e.id],...t])})):e.SDS&&t.forEach((function(e){n[e.id]||(n[e.id]=[]);var t=l.getSuccessors([e]);t&&(n[e.id]=[...n[e.id],...t])}));o=n[Object.keys(n)[0]];for(var a=1;a<Object.keys(n).length;a++)o=l._getCommon(o,n[Object.keys(n)[a]]);o.length>0?this._manageSelection({models:o,sAction:"add"}):i=!0,i&&this._showNotif({level:"info",lvl:"primary",msg:s.get("SA-NoNewSelection")})},_handleCommonSelections:function(e,t){if(t.length<2)return{showNotif:!0};var i,n=!1;e.SDP?i=l.getCommonDirectPredecessors(t):e.SAP?i=l.getCommonAllPredecessors(t):e.SDS?i=l.getCommonDirectSuccessors(t):e.SAS&&(i=l.getCommonAllSuccessors(t)),i&&i.length>0&&(i=this._processSelection(i)).length?this._manageSelection({models:i,sAction:"add"}):n=!0,n&&this._showNotif({level:"info",lvl:"primary",msg:s.get("SA-NoNewSelection")})},_handleSDP:function(e){var t=l.getPredecessors(e),i=!1;if(t){var n=t.filter((function(t){if(!e.includes(t))return!0}));(t=this._processSelection(n)).length?this._manageSelection({models:t,sAction:"add"}):i=!0}else i=!0;i&&this._showNotif({level:"info",lvl:"primary",msg:s.get("SA-NoNewSelection")})},_handleSAP:function(e){var t=l.getAllPredecessors(e),i=!1;if(t){var n=t.filter((function(t){if(!e.includes(t))return!0}));(t=this._processSelection(n)).length?this._manageSelection({models:t,sAction:"add"}):i=!0}else i=!0;i&&this._showNotif({level:"info",lvl:"primary",msg:s.get("SA-NoNewSelection")})},_handleSDS:function(e){var t=l.getSuccessors(e),i=!1;if(t){var n=t.filter((function(t){if(!e.includes(t))return!0}));(t=this._processSelection(n)).length?this._manageSelection({models:t,sAction:"add"}):i=!0}else i=!0;i&&this._showNotif({level:"info",lvl:"primary",msg:s.get("SA-NoNewSelection")})},_handleSAS:function(e){var t=l.getAllSuccessors(e),i=!1;if(t){var n=t.filter((function(t){if(!e.includes(t))return!0}));(t=this._processSelection(n)).length?this._manageSelection({models:t,sAction:"add"}):i=!0}else i=!0;i&&this._showNotif({level:"info",lvl:"primary",msg:s.get("SA-NoNewSelection")})},openCAD:function(){d.publish("webinwin:web:notification",JSON.stringify({operation:"open/setTypes",operationVersion:"1.0",content:l.buildSelectionForNativeApps()}))},_handleDownload:function(e,t){var i=this;this.fileUtils?this.fileUtils.handleDownload(e,t):require(["DS/SNNavigationMap/utils/MapFileUtils"],(function(n){i.fileUtils=new n({spinner:i._spinner}),i.fileUtils.handleDownload(e,t)}))},getCustomizeAttributeOptions:function(){var e=this,i=[],n=[{name:"AllTypes",nlsLabel:s.get("AllTypes")}];return new t.Promise((function(t,s){e.collection.filter((function(e){if("node"===e.get("modelType")&&"3DSpace"===e.get("serviceId")){var t=e.get("type");null!=t&&""!==t&&-1===i.indexOf(t)&&i.push(t);var n=e.get("instances");if(void 0!==n)for(var s=0;s<n.length;s++){var o=n[s].type;null!=o&&""!==o&&-1===i.indexOf(o)&&i.push(o)}}})),e._getTypesNls(i).then((function(e){for(var i in e)e.hasOwnProperty(i)&&n.push({name:i,nlsLabel:e[i]});var s={defaults:m.getDefaultAttributes(),selectedIndex:0,types:n};t(s)}))}))},toggleInformationsPanel:function(){this._toolBarView.getCommand("Info_Command").hasClassName("pressed")===this._infoPanelCommandClick&&this._toolBarView.toggleInfoCommand(),this._infoPanelCommandClick?(this.listView.hidePanel(),this._infoPanelCommandClick=!1):(this._infoPanelCommandClick=!0,this.manageProperties()),this.dispatchEvent("ENORIPE_ToggleInformationPanel",this._infoPanelCommandClick)},manageProperties:function(){var e=this.collection.where({focus:!0});e&&0!==e.length&&this._infoPanelCommandClick?this.listView.setModel(e):this.listView.hidePanel()},_initPreviewView:function(e,t){var i=this;require(["DS/SNNavigationMap/views/PreviewView"],(function(n){i.previewView=new n({widgetId:i._widgetId,separator:i._separator,direction:t,collection:i.collection}),i.previewView.inject(i.container),i.previewView.render(),i.dispatchEvent("ENORIPE_ShowPreview",{model:e,direction:t}),i.listenTo(i.previewView,"ENORIPE_extractNode",(function(e){i._extractNode(e)})),i.listenTo(i.previewView,"PreviewHide",(function(){i.taggerServices.activate(),i.updateFilterProxy(),i._isPreviewPanelOpen=!1,i.clearFilterBySearch()})),i.listenTo(i.previewView,"ContextualMenuPreviewGroup",(function(e){e.targetId&&(i._theContextualMenuTarget.targetId=e.targetId,i._theContextualMenuTarget.targetElement=e.targetElement,i._theContextualMenuTarget.context="PreviewGroup")})),i.listenTo(i.previewView,"ENORIPE_DownloadDocument",i._handleDownload),i._isWebInWin&&(i.listenTo(i.previewView,"ENORIPE_performSearch_native",(function(e){i.dispatchEvent("ENORIPE_performSearch_native",e)})),i.listenTo(i.previewView,"ENORIPE_resetSearch_native",(function(){i.clearFilterBySearch()}))),i.listenTo(i.previewView,"ENORIPE_LaunchSearch",(function(){i.dispatchEvent("ENORIPE_LaunchSearch")}))}))},_showPreview:function(e){this.clearFilterBySearch();var t=e.direction?e.direction:"both";this._isPreviewPanelOpen=!0,this._currentView.endFilter(),this.previewView?(this.previewView.render(t),this.dispatchEvent("ENORIPE_ShowPreview",e)):this._initPreviewView(e.model,t),this.taggerServices.deactivate()},expandNLevel:function(){this.getSelectedIds().length<1?this._showNotif({level:"error",msg:s.get("ActionWithoutSelection")}):this.dispatchEvent("ENORIPE_initExpandNLevel",{selectedNodes:this.collection.getIdentifierDataById(this.getSelectedIds()),expandNLevelView:this.expandNLevelView})},_initDatagridView:function(e){var t=[],i=[],n=!e;this._manageFocus(),this.mapView&&this.mapView.hide(),e&&(t=this.collection.where({modelType:"node",focus:!0,isCount:void 0})).length>0&&(i=t.map((function(e){return e.id})),this.dispatchEvent("setLastRootNodeID",[i])),this.buildDatagrid(n,t),this._isFiltered&&this.updateFilterProxy()},buildDatagrid:function(e,t){var i,n=!e,s=[];t=[],i=m.getDefaultAttributes().EnoripeColumns.attributes,t&&0!==t.length||(s=v.getPref("lastRootNodeID")||[],t=this.collection.filter((function(e){if(s.indexOf(e.id)>-1)return!0}))),this.dataGridView.buildSkeleton(t,this.collection,i,n).then((()=>{this.dataGridView.show(),this.hideSpinner(),n&&this._updateCollectionWithView()}))},_updateDatagridView:function(e,t){var i=[];this.dataGridView&&(this.dataGridView.getRootModels()&&0!==this.dataGridView.getRootModels().length?(this._lastRootID.forEach(function(t){this.dataGridView.getRootModelsIds().indexOf(t)<0&&e.get(t)&&i.push(e.get(t))}.bind(this)),i.length>0?this.dataGridView.setRootNodes(i):this.dataGridView.setData(!1,t,1),this.hideSpinner()):this._initDatagridView())},collapseNodeOnDatagrid:function(e,t,i){var n=[];t&&e&&(i.map((function(e){return e.id})),n=this.collection.filter((function(e){if(t.indexOf(e.id)>-1)return!0})),t.length>0&&(this.collection.getRemovedObject(n).removedObjectsId.forEach(function(e){this.collection.remove(e)}.bind(this)),this.dispatchEvent("ENORIPE_SetNavigatedNode",[this.collection.getIdentifierDataById()]),this._updateCountModel().then(function(){this._updateCountView()}.bind(this)),this.updateFilterProxy()))},customizeAll:function(){this.dispatchEvent("ENORIPE_CustomizeAll")},customizeDisplay:function(){this.dispatchEvent("ENORIPE_CustomizeDisplay")},updateProfile:function(e){this.listView&&this.listView.updateProfileRelations(e),this.dataGridView&&"dataGridView"===this._currentLayout&&this.dataGridView.setExpandDirection({upstream:!0,downstream:!0}),this.dispatchEvent("ENORIPE_TrackProfileUsage",e)},computePaths:function(){var e=this.collection.where({focus:!0});this.pathPanel?this.pathPanel.render(e):this._initPathPanel()},managePathPanel:function(e){let t=this;if(e&&this.pathPanel&&this.pathPanel.visibleFlag){var i=this.collection.get(e);i&&("ENOStrRefinementSpecification"===i.get("type")&&this.collection.filter((function(e){"link"===e.get("modelType")&&(e.get("source").id===i.get("id")?i._attributes.linked=t.collection.get(e.get("target").id):e.get("target").id===i.get("id")&&(i._attributes.linked=t.collection.get(e.get("source").id)))})),this.pathPanel.addNodes(i))}},_initPathPanel:function(){var e=this;require(["DS/SNNavigationMap/views/popups/PathPanelView"],(function(t){e.pathPanel||(e.pathPanel=new t({spinner:e._spinner,widgetId:e._widgetId,debugMode:e._debug,position:{offsetX:0,offsetY:24,dialogWidth:520,dialogHeight:600},addinMode:e._addinMode,immersiveFrame:e.immersiveFrame})),e.listenTo(e.pathPanel,"ENORIPE_dragEnd",e._hideDropZones),e.listenTo(e.pathPanel,"ENORIPE_handleErrorMsgs",e.handleServerErrorMsgs),e.listenTo(e.pathPanel,"ENORIPE_ComputePath",e.computePaths),e.listenTo(e.pathPanel,"ENORIPE_AddInGraph",e._addInGraph),e.listenTo(e.pathPanel,"ENORIPE_SelectInGraph",e._selectInGraph),e.listenTo(e.pathPanel,"ENORIPE_SetPathOnCompass",(function(t){e.clearSelection("MapView","PathPanel"),l&&l._syncPathToCompass(t)})),e.listenTo(e.pathPanel,"ContextualMenuFindPath",(function(t){t.targetId&&(e._theContextualMenuTarget.context="FindPath",e._theContextualMenuTarget.targetId=t.targetId,e._theContextualMenuTarget.targetElement=t.targetElement,e._theContextualMenuTarget.typeOfPath=t.typeOfPath,e._theContextualMenuTarget.jsonMsgForOpen=t.jsonMsgForOpen,e._theContextualMenuTarget.jsonMsgForAddInGraph=t.jsonMsgForAddInGraph)})),e.pathPanel.addEvent("PathPanelViewRender",function(){e.hideSpinner()}.bind(e)),e.pathPanel.addEvent("PathPanelViewClose",function(){e._toolBarView.getCommand("ComputePath_Command").removeClassName("pressed")}.bind(e)),e.pathPanel.addEvent("ENORIPE_HighlightPath",e._highlightPath.bind(e)),e.pathPanel.addEvent("ENORIPE_UnHighlightPath",function(t){e._currentView.endFilter()}.bind(e)),e.pathPanel.addEvent("noPathsFound",function(t){var i="noPathsFoundNP";"StructurePath"===t.type&&(i="noPathsFoundSP"),e._showNotif({level:"info",lvl:"primary",msg:s.replace(s.get(i),{anchor:t.anchor,selected:t.selected}),sticky:!1})}.bind(e)),e.pathPanel.render(e.collection.where({focus:!0}))}))},_highlightPath:function(e){for(var t=this,i=e.paths,n=[],s=0;s<i.length;s++)if("StructurePath"===e.typeOfPath&&(i[s].from||i[s].to)||"NetworkPath"===e.typeOfPath&&i[s].type&&(i[s].type.contains("_from")||i[s].type.contains("_to"))){t.collection.where({modelType:"link"});var o=i[s-1],a=i[s+1];o&&a&&o.resourceid&&a.resourceid&&t.collection.filter((function(e){if("link"===e.get("modelType")){var t=e.get("id"),i=e.get("source"),s=e.get("target");i&&s&&(o.resourceid===i.id?a.resourceid===s.id&&n.push(t):o.resourceid===s.id&&a.resourceid===i.id&&n.push(t))}}))}else"0"!==i[s].resourceid&&n.push(i[s].resourceid);"linearGraph"===this._currentLayout&&this.mapView?t.mapView.highlightPath(n):t.dataGridView.filter({matchingIDs:n})},dragElement:function(e,t){if(r.isWebInWin()&&t.data.items[0].objectId&&r.sendToMapWebInWin("RefreshOnDrag",t.data.items[0].objectId),e.dataTransfer)if(r.isWebInWin())try{e.dataTransfer.setData("text",JSON.stringify(t))}catch(e){console.log("Error in set Data for web in win : "+e)}else try{e.dataTransfer.setData("text/searchitems",JSON.stringify(t)),e.dataTransfer.setData("text",JSON.stringify(t))}catch(i){console.log(i),e.dataTransfer.setData("Text",JSON.stringify(t))}this._inAppView&&A.closeWidget()},setContainerEvents:function(){var e=this;this.container.addEventListener("dragenter",this.onDragEnter.bind(this)),this.container.addEventListener("mousedown",(function(){e.containerMouseDownTime=new Date}))},_onHide:function(){this.hide(),this._toolBarView&&this._toolBarView.toolBar.hide(),this.listView&&this.listView.hidePanel(),this.dispatchEvent("ENORIPE_HideLeftToolBar")},_onShow:function(){this.show(),this._toolBarView&&this._toolBarView.toolBar.show(),this._infoPanelCommandClick&&this.listView.showPanel(),this.dispatchEvent("ENORIPE_ShowLeftToolBar")},_onKeyUp:function(e){if(!0===e.ctrlKey){e.stopPropagation(),e.preventDefault();var t=e.keyCode||e.which,i=String.fromCharCode(t);"a"!==i&&"A"!==i||this.selectAllFromCmd()}},_handleDrop:function(t,i){this.showSpinner(),this._doContinueSearch();"extract"===t&&i.id;var n=i.data&&e.is(i.data.items[0].objectId)?i.data.items:null,s="extract"===t&&i.data.sourceIds?i.data.sourceIds:[];this._pathSelReq||_.trackUsage("ObjectsDrop","Objectsdrop-"+t,n.length);var o=[t,s,n];this.dispatchEvent("ENORIPE_DropByMode",o)},onDropFromWebInWin:function(t){var i=t.action,n=t.objects&&e.is(t.objects)?JSON.parse(t.objects):null;n?(this.showSpinner(),this.dispatchEvent("ENORIPE_DropByMode",[i,n])):this._showNotif({level:"warning",lvl:"warning",msg:s.get("InvalidSelection")})},refreshMapCmd:function(){this.dispatchEvent("ENORIPE_refreshMap",[{initWithNodes:this.collection.getIdentifierDataById(),needClear:!0}]),this.refreshMsgPending=!0},refresh:function(e){this._isEmpty=e.isEmpty,e.isEmpty?this.hideSpinner():(this._initCollection(e.collection),this._initSubViews())},onResize:function(){if(this._updateContainerDimensions(),this._updateSVGContainer(),this._updateDropZonesHeight(),this._toolBarView&&this._toolBarView.resizeHandler(),this.mapView){var e={sidePanelWidth:this.listView.getWidth(),actionBarHt:48};this.mapView.centerTheGraph(e)}},onDragEnter:function(e){e.stopPropagation(),e.preventDefault();var t=this.listView&&this.listView.container&&this.listView.isVisible?this.listView.getWidth():0;this._isPreviewPanelOpen||this._dropZone.show(parseFloat(this.container.getStyle("width").slice(0,-2))-t,this._isEmpty)},_getTypesNls:function(e){var i=this,n={},o={};return e.forEach((function(e){n[e]=s.get(e)})),new t.Promise((function(t,s){i._isWebInWin&&O.setConfigForMyApps({myAppsBaseUrl:m.getMyAppsUrl(),userId:m.getUserID(),lang:m.getLang()}),e.length>0?o={"ds6w:type":e}:t(n),x.getNlsOfPropertiesValues(JSON.stringify(o),{tenantId:m.getCurrentTenantName(),lang:m.getLang(),apiVersion:"R2019x",onComplete:function(e){e&&void 0!==e["ds6w:type"]?t(e["ds6w:type"]):t(n)},onFailure:function(e){console.log("Error in fetching NLS data from FedDictionaryAccessAPI.getNlsOfPropertiesValues, the response received is ::"+e),t(n)}})}))},_updateNLSForSavedAttrs:function(){var e=this,i=m.getJSONAttributes(),n=m.getDefaultAttributes();return new t.Promise((function(t,s){for(var o,a=[],r=0;r<2;r++)for(var l in o=0===r?i:n)o.hasOwnProperty(l)&&o[l].attributes&&o[l].attributes.forEach((function(e){-1===a.indexOf(e.uri)&&a.push(e.uri)}));E.getResourcesInfo(a).then((function(s){if(s){var a={};s.forEach((function(e){a[e.curi]=e.label}));for(var r=0;r<2;r++)for(var l in o=0===r?i:n)o.hasOwnProperty(l)&&o[l].attributes&&o[l].attributes.forEach((function(e){a[e.uri]&&(e.label=a[e.uri])}));m.setJSONAttributes(i),m.setDefaultAttributes(n),v.setPrefEverywhere("_ENORIPE_Type_Attrs",n),e.dataGridView&&e.dataGridView.updateColumnsHeaderNls(o)}t()}))}))},_checkDefaults:function(e){for(var t in e)if(e.hasOwnProperty(t))for(var i=e[t].attributes,n=i.length;n--;)void 0!==i[n].uri&&null!==i[n].uri||i.splice(n,1);return e},updateMapViewAttributesNls:function(e){if(null!=e&&0!==e.length){var t={},i=null;(i=this.collection.get(e))&&((t={modelType:i.get("type")||"AllTypes",ids:[e],models:{}}).models[e]=i,this._getNlsAndSetAttributes(t),i.get("instances")&&i.get("instances").length>0&&(t={ids:[],modelType:"AllTypes",isInstances:!0,models:{}},i.get("instances").forEach((function(e){t.modelType=e.type,t.ids.push(e.id),t.models[e.id]={_attributes:e}})),this._getNlsAndSetAttributes(t)))}},_getNlsAndSetAttributes:function(e){var t=this,i={},n={};e.models&&(i=E.getAttributes(e.modelType),n=E._prepareDataToNls(Object.values(e.models).map((e=>e._attributes))),E._getNlsAndProcessData(n,e.ids,e.models,e.isInstances).then((function(n){(n={...n,...i}).models={};for(var s=0;s<Object.keys(n.nlsObj).length;s++){let i=Object.keys(n.nlsObj)[s];t.collection.setNlsObj(i,Object.values(n.nlsObj)[s],e.isInstances),!e.isInstances&&t.collection.get(i)?n.models[i]=t.collection.get(i)._attributes:e.isInstances&&t.collection.getInstanceAttributes(i)&&(n.models[i]=t.collection.getInstanceAttributes(i))}t.mapView&&"linearGraph"===t._currentLayout&&t.mapView.setAttrData(n)})))},_fetchAndSetAttributes:function(e){return new t.Promise((function(t,i){try{y.fetchAttributes(e).then((function(e){e&&e.nlsObj&&Object.keys(e.nlsObj).length>0&&t(e)}),(function(){i()}))}catch(e){console.log("err while fetching attributes"),i()}}))},_isDiffFromDefault:function(e){var t=v.getPref("_ENORIPE_Type_Attrs")||null;if(!t)return!0;if(Object.keys(e).length!==Object.keys(t).length)return!0;for(var i in e)if(e.hasOwnProperty(i)){if(void 0===t[i])return!0;var n=e[i].attributes,s=t[i].attributes;if(n.length!==s.length)return!0;for(var o=n.map((function(e){return e.uri})),a=0;a<s.length;a++)if(-1===o.indexOf(s[a].uri))return!0}return!1},_attributesOrderChange:function(e){var t=v.getPref("_ENORIPE_Type_Attrs")||null;if(!t||this._isDiffFromDefault(e))return!0;for(var i in e)if(e.hasOwnProperty(i))for(var n=e[i].attributes,s=t[i].attributes,o=0;o<n.length;o++)if(n[o].uri!==s[o].uri)return!0;return!1},hideOneDirection:function(e){this.showSpinner();var t=this.dataGridView.getOneDirectionLink(e);this.collection.filter((function(e){if(t.indexOf(e.id)>-1)return e})).length>0?(this.dispatchEvent("ENORIPE_SetNavigatedNode",[this.collection.getIdentifierDataById()]),this.dispatchEvent("ENORIPE_HideOneDirection",[e,!0]),this.updateFilterProxy()):this.dispatchEvent("ENORIPE_HideOneDirection",[e,!0])},collapseSelectedNodes:function(e){var t=this.getSelectedIds();t.length>0?this.collapseNode(t,e):this._showNotif({level:"error",msg:s.get("ActionWithoutSelection")})},collapseNode:function(e,t){var i,n,o=[];i=this.collection.filter((function(t){if(e.indexOf(t.id)>-1)return t})),("out"===t?l.getAllSuccessors(i):"in"===t?l.getAllPredecessors(i):l.getAllPredecessors(i).concat(l.getAllSuccessors(i))).forEach((function(t){e.indexOf(t.id)<0&&o.push(t)})),n=o.map((function(e){return e.id})),o.length>0?("linearGraph"===m.getLayoutType()?this.removeNodes(o):"dataGridView"===m.getLayoutType()&&this.dataGridView.collapseNode(n,e),this._updateLastRootID(n)):e.length>1?this._showNotif({level:"info",msg:s.get("NodesCantBeCollapsed")}):this._showNotif({level:"info",msg:s.get("NodeCantBeCollapsed")})},removeNodes:function(e){"dataGridView"===m.getLayoutType()&&m.getInstancesMode()&&e.forEach(function(t){let i=this.dataGridView.getAllNodesById(t.id);if(i.length>1){let n=0;i.forEach((function(e){e.isSelected()&&n++})),i.length>n&&e.splice(e.indexOf(t),1)}}.bind(this)),this.collection.removeNodes(e).then(function(){let t=this.collection.where({instancesNeedUpdate:!0});t&&t.length>0&&("linearGraph"==this._currentLayout&&this._currentView.updateInstancesList(t),t.forEach((function(e){e.set("instancesNeedUpdate",!1)}))),this.renderAfterRemove(),this._manageSelection({models:e,sAction:"remove"})}.bind(this)),this.updateRelationsDisplayed()},hideNodes:function(){var e=[];this._doContinueSearch(),(e=this.collection.where({focus:!0})).length>0?this.collection.where({modelType:"node"}).length===e.length?this._showNotif({level:"error",msg:s.get("AllNodesHidden")}):(this.showSpinner(),this.removeNodes(e),this._updateLastRootID(e.map((function(e){return e.id}))),this.listView&&this.listView.isVisible&&this.listView.hidePanel()):this._showNotif({level:"error",msg:s.get("ActionWithoutSelection")})},removeActions:function(e){var t=[];e&&e.length>0&&(l.updateFeedBack(e),this.collection.filter((function(i){"node"===i.get("modelType")&&e.indexOf(i.id)>-1&&t.push(i.id)})),this.taggerServices.removeRoots(t))},expandSelectedNodes:function(e){var t=[],i=[],n=[],o=m.getLayoutType();if((i=this.collection.where({focus:!0})).length>0){"dataGridView"==o&&this._currentView.manageSelectedNodesExpandingState();for(var a=0;a<i.length;a++)e?i[a].get("counts").hasRealCount(e)&&(t.push(i[a].id),n=[...n,...i[a].get("counts").getRealCountAttribute("name",e)]):i[a].get("counts").hasRealCount()&&(t.push(i[a].id),n=[...n,...i[a].get("counts").getRealCountAttribute("name")]);t.length>0?(this.showSpinner(),this.splitCount(t,n,e)):this.displayMsgAlreadyInGraph(e)}else this._showNotif({level:"error",msg:s.get("ActionWithoutSelection")})},splitCount:function(e,t,i){var n=[];e&&(e.forEach(function(e){let t=this.collection.get(e);t&&n.push(t.get("identifierData"))}.bind(this)),this.collection.getEcoSystem({items:n,relations:t||[],direction:i||"both"}),this._doContinueSearch())},_addInGraph:function(e,t){this._pathSelReq=!0,this._pathSelReqNodes=e,this._handleDrop("addInGraph",t)},_extractNode:function(e){this.showSpinner();var t=!1,i={};1===e.sourceIds.length&&(i=this.collection.get(e.sourceIds).clone()._attributes),e.links.forEach((function(n){if(n.instance){if(0===i.length&&(e.sourceIds.indexOf(n.source)>0?i=e.sourceIds[e.sourceIds.indexOf(n.source)]:e.sourceIds.indexOf(n.target)>0&&(i=e.sourceIds[e.sourceIds.indexOf(n.target)])),i.instances){if(0===i.instances.filter((function(e){return e.id===n.instance})).length){let e=[...i.instances];e.push(n.instance),i.instances=e,t=!0}}else i.instances=[n.instance],t=!0;delete n.instance}})),t&&e.objects.unshift(i);var n=this.collection.parse(e);n.length>0?n.forEach(function(e){e===n[n.length-1]?this.collection.addModel(e,{external:!0,callback:this.render.bind(this)}):this.collection.addModel(e,{external:!0,silent:!0})}.bind(this)):(this.dispatchEvent("ENORIPE_noObjectToAdded"),this.hideSpinner())},printMap:function(e){var t;if("dataGridView"==this._currentLayout){if(!this._isWebInWin)return void this.dataGridView.collectionView.openPrintableViewWindow(!0);t=this.dataGridView.collectionView.generatePrintableViewHTML()}else t=this.getElements(".d3-map-view-container")[0].outerHTML;this.printHTML(t,e)},printHTML:function(e,t){setTimeout((function(){var i="";let n=window.document.styleSheets;for(let e=0;e<n.length;e++){i+='<link rel="stylesheet" type="text/css" href="'+n[e].href+'" />'}const s="<!DOCTYPE html>\n              <html>\n                  <head>\n                      <title>Relations - Print</title>\n                      "+(i+='\n            <style type="text/css" media = "all">\n            @page {margin-top: 1cm; \tmargin-left: 1cm;}\n            #svg-root {overflow: visible; display: inline; zoom : 50%}\n            </style>\n          ')+"\n                  </head>\n                  <body>\n                    "+e+"\n                  </body>\n              </html>",o=URL.createObjectURL(new Blob([s],{type:"text/html"})),a=window.open(o,"_blank","width=1024,height=768,top=0,left=0,scrollbars=yes,status=no,resizable=yes");setTimeout((function(){!0===t?a.close():a.print(),a.close()}),500)}),0)},fitAllInMap:function(){if(this.mapView){var e={sidePanelWidth:0,actionBarHt:48};e.sidePanelWidth=this.listView.getWidth(),this.mapView.fitAllIn(e)}},switchLayout:function(e){if(this._currentLayout!=e){var t,i=this.collection.getNodesIds();if(t=this.getSelectedIds(!1),"linearGraph"===this._currentLayout&&0===t.length)return this._showNotif({level:"error",msg:s.get("commandWithoutSelection")}),void this._toolBarView.updateLayoutMenu();switch(i.length>m.getOption("navigatedNodeLimite")&&this.resetCollectionWithRoots(),this._currentLayout=e,m.setLayoutType(e),this.dispatchEvent("ENORIPE_SwitchLayout",e),this._toolBarView.updateLayout(),e){case"linearGraph":this.collection.getLinksAndNodes(!1);"recompute"===m.getLayoutMode()&&this.collection._setColumnOnNodes(),this.mapView&&(this.mapView.inject(this.container),this.mapView.show(),this._currentView=this.mapView),this.dataGridView&&this.dataGridView.hide(),this.dispatchEvent("ENORIPE_refreshMap",[{initWithNodes:this.collection.getIdentifierDataById(),needClear:!1,selectedNodes:t}]);break;case"dataGridView":this._currentView=this.dataGridView,this.clearMapSuccess(!0),this._initDatagridView(!0)}}},switchThumbnailsMode:function(e){"thumbnailsMode"===e?(this.getElement(".d3-map-view-container").removeClassName("no-thumbnails"),this.mapView.addMissingThumbnail(this.collection)):this.getElement(".d3-map-view-container").addClassName("no-thumbnails"),this.mapView.updateConstraints(this.collection.getLinksAndNodes(),this.collection.groupBy("columnID")),this.mapView.updateNodesYposition(e),this.getElements(".foreign-object-count-mobile").forEach((function(t){t.setAttribute("y","thumbnailsMode"===e?95:35)})),this.getElements(".colored-rect-bi").forEach((function(t){t.setAttribute("height","thumbnailsMode"===e?120:55)})),this.getElements(".colored-rect-instance").forEach((function(t){t.setAttribute("y","thumbnailsMode"===e?135:72)})),this.getElements("#toggleEcosystem").forEach((function(e){e.hasClassName("expandMenuDirection-in")?e.setAttribute("style","transform:translate(0px,"+(m.getNodesHeight()/2-30)+"px"):e.setAttribute("style","transform:translate("+m.getNodesWidth()+"px,"+(m.getNodesHeight()/2-30)+"px")}))},editLayout:function(){var e=this._toolBarView.getCommand("EditLayout_Command");e&&this.mapView&&(e.hasClassName("pressed")?(e.removeClassName("pressed"),this.mapView.layoutingOff()):(_.trackUsage("Commands","EditLayout"),e.addClassName("pressed"),this.mapView.layoutingOn()))},excludeNodes:function(e,t){var i=[];(i=t?i.concat(t):i.concat(this.getSelectedIds())).length>0?this.collection.where({modelType:"node"}).length===i.length?this._showNotif({level:"error",msg:s.get("AllNodesExcluded")}):(this.collection.excludeElements(e,i),e&&this.dispatchEvent("ENORIPE_setExcludeNode",[i])):this._showNotif({level:"error",msg:s.get("ActionWithoutSelection")})},exportDatagrid:function(){this.dataGridView.exportAsCSV()},displayMsgAlreadyInGraph:function(e){var t="";switch(e){case"in":t=s.get("UpstreamAlreadyInGraph");break;case"out":t=s.get("DownstreamAlreadyInGraph");break;default:t=s.get("UpAndDownstreamAlreadyInGraph")}this._showNotif({level:"info",lvl:"primary",msg:t})},handleServerErrorMsgs:function(e){e&&("timeout"===e.type?(e.level="error",e.msg=s.get("timeout"),e.subtitle=s.get("verifyConnection")):"internalServerError"===e.type?(e.level="error",e.msg=s.get("internalServerError")):(e.level="error",e.msg=s.get("generic"))),this._spinner&&this.hideSpinner(),this._showNotif(e)},exportMsg:function(e){e.success?this._showNotif({level:"success",lvl:"success",msg:s.replace(s.get("InfoMsg.ExportSuccess"),{nbLines:e.nbLines})}):this._showNotif({level:"error",msg:s.replace(s.get("ErrorMsg.ExportLimit"),{nbLines:e.nbLines,exportLimit:m.getExportLimit()})})},maskMapView:function(){h.mask(this.container)},unmaskMapView:function(){h.unmask(this.container)},_saveForRefresh:function(e,t){this.dispatchEvent("ENORIPE_SaveForRefresh",[e,t])},_updateLastRootID:function(e){var t=this._lastRootID.filter((t=>!e.includes(t)));t.length!=this._lastRootID&&this.dispatchEvent("ENORIPE_updateLastRootId",[t])},_updateCollectionWithView:function(){let e=[];this.collection.getNodesIds().forEach(function(t){this.dataGridView.getAllNodes(!0).indexOf(t)<0&&e.push(this.collection.get(t))}.bind(this)),e.length>0&&this.removeNodes(e)},resetCollectionWithRoots:function(){var e;(e=this.collection.where({modelType:"node",focus:!0,isCount:void 0})).length<m.getOption("navigatedNodeLimite")&&this._showNotif({level:"info",msg:s.replace(s.get("LoadingRootsOnly"),{limit:m.getOption("navigatedNodeLimite")})}),this.collection.reset(),e.forEach(function(t){t===e[e.length-1]?this.collection.addModel(e,{external:!0,callback:this.render.bind(this)}):this.collection.addModel(e,{external:!0,silent:!0})}.bind(this))},getSelectedIds:function(){return this.collection.where({focus:!0}).map((function(e){return e.id}))},_getIdsSortedByColumn:function(e){for(var t=this.collection.sortBy("columnID"),i=[],n="",s=0;s<t.length;s++)if("link"!==t[s]._attributes.modelType){n=t[s]._attributes.id;for(var o=0;o<e.length;o++)if(n===e[o]){i.push(e[o]);break}}return i},_processSelection:function(e){var t=[],i=[...this._currentlyFilteredNodes,...this._currentlySearchedNodes],n=this._isFiltered||this._isSearched;return e.forEach((function(e){n?i.indexOf(e.get("id"))>-1&&t.push(e):t.push(e)})),t},_manageFirstFocusAndAnchor:function(e){var t=e&&e.length>0?e:this._lastRootID,i=v.getPref("ENORIPE_selectedNode")||[],n=[];if(i&&i.length>0){let e=this.collection.getNodesIds();i.forEach(function(t){e.indexOf(t)>-1&&n.push(this.collection.get(t))}.bind(this))}0===n.length&&t&&t.length>0&&(n=t.map(function(e){return this.collection.get(e)}.bind(this))),n.length>0&&n[0]&&(this._manageSelection({models:n,sAction:"add",origin:"MapView"}),this._setFirstFocusOnCompass=!0)},_manageFocus:function(){if(this._lastRootID&&0!==this._lastRootID.length){0===this.collection.where({modelType:"node",focus:!0,isCount:void 0}).length&&this._manageFirstFocusAndAnchor()}else this._initLastRootWithColumnId()},_initLastRootWithColumnId:function(){var e=[],t=[];t=Object.keys(this.collection.groupBy("columnID")).sort(((e,t)=>e-t)),this._lastRootID&&0!==this._lastRootID.length||(t.every(function(t){let i=parseInt(t);if(Number.isInteger(i)){let t=this.collection.where({modelType:"node",columnID:i});return!((e=t.map((function(e){return e.id}))).length>0)}return!0}.bind(this)),this.dispatchEvent("setLastRootNodeID",[e]),this._currentView&&!this._currentView.isInitWithNodes()&&this._manageFirstFocusAndAnchor(e))},clearSelection:function(e,t){var i=[];e&&(l.viewContext=e),l.getSelectedIDs().forEach(function(e){this.collection.get(e)&&i.push(this.collection.get(e))}.bind(this)),this._manageSelection({models:i,sAction:"remove",origin:"MapView",caller:t}),l.clearMultiSel(0),this.mapView&&this.mapView.clearMultiSelection(),this._toolBarView&&(this._toolBarView.hideSelectionIcon(),this._toolBarView.disableSelectionAssistantCommand())},selectAllFromCmd:function(){var e,t;t=this.collection.where({modelType:"node"}),(e=this._processSelection(t)).length&&this._manageSelection({models:e,sAction:"add"})},selectOutFilteredFromComd:function(){var e=this._isFiltered||this._isSearched,t=[],i=[];e?(this.clearSelection(),t=[...this._currentlyFilteredNodes,...this._currentlySearchedNodes],this.collection.where({modelType:"node"}).forEach((function(e){t.indexOf(e.get("id"))<0&&i.push(e)})),this._manageSelection({models:i,sAction:"add"})):this._showNotif({level:"info",lvl:"primary",msg:s.get("ActionWithoutFiltering")})},inverseSelectionFromCmd:function(){let e=[],t=[];e=l.getInverseSelection(),t=this._processSelection(e),this._manageSelection({models:l.getSelected(),sAction:"remove"}),t.length>0&&this._manageSelection({models:t,sAction:"add"})},_manageSelection:function(e,t){this.pathPanel&&"PathPanel"!==e.caller&&this.pathPanel.emptyGridViewSelection();var i="string"==typeof e.models?[this.collection.get(e.models)]:e.models,n=!1;e.models&&(e.origin&&""!==l.viewContext&&(n=e.origin!==l.viewContext),"MapView"===e.origin?l.viewContext="MapView":"ListView"===e.origin&&(l.viewContext="ListView"),l.onObjectToMultiSel(i,e.sAction,n),this._toolBarView&&("remove"===e.sAction?this._toolBarView.disableSelectionAssistantCommand():this._toolBarView.enableSelectionAssistantCommand())),i.forEach(function(t){"add"===e.sAction?this._currentView.addToSelection(t.id,e.instanceId):"remove"===e.sAction&&this.removeFocus(t,e.instanceId)}.bind(this)),"add"===e.sAction&&i[0].id&&this.pathPanel&&this.pathPanel.visibleFlag&&!t&&this.managePathPanel(i[0].id),this.manageProperties(),this.updateToolbarSelectionIcon()},removeFocus:function(e,t){if("dataGridView"===m.getLayoutType()&&m.getInstancesMode()){let t=this.dataGridView.getAllNodesById(e.id);if(t.length>1){let i=0;t.forEach((function(e){e.isSelected()&&i++})),t.length<=i&&e.set("focus",!1)}else e.set("focus",!1)}else e.set("focus",!1);this._currentView.removeToSelection(e.id,t)},updateToolbarSelectionIcon:function(){0===this.getSelectedIds().length?(this._toolBarView&&(this._toolBarView.hideSelectionIcon(),this._toolBarView.disableSelectionAssistantCommand()),l.clearMultiSel(0)):this._toolBarView&&(this._toolBarView.showSelectionIcon(),this._toolBarView.enableSelectionAssistantCommand())},showSpinner:function(){this._spinner&&this._spinner.show(),this.dispatchEvent("Customize_LoadingRelations")},hideSpinner:function(){this._spinner&&this._spinner.hide()},_selectInGraph:function(e){if(e){if(0===e.length)return;var t,i=[],n=this;e.forEach((function(e){(t=n.collection.get(e))&&"node"===t.get("modelType")&&i.push(t)})),l.viewContext="MapView",this._manageSelection({models:i,sAction:"add"},!0)}},nodeClicked:function(e,t){var i=this.collection.get(e);if(i){this.currentModelClicked=i,this._manageSelection({models:e,sAction:t,origin:"MapView"});this.collection.where({modelType:"node",focus:!0});this._doContinueSearch()}},clearFilterBySearch:function(){if(this._isPreviewPanelOpen&&this.previewView)return this.previewView.clearSearch(),void(this._pager&&this._pager.closePager());this._isSearched=!1,this._continueSearch=!1,this._currentlySearchedNodes=[],this._isFiltered&&this._lastFilterData?this.filter(this._lastFilterData):(this._currentView.endFilter(),this.updateFilterProxy()),this._pager&&this._pager.closePager()},_doContinueSearch:function(){this._isWebInWin||(this._isSearched?this._continueSearch=!0:this._continueSearch=!1)},_onPager:function(e){this._pager||(this._pager=new C({debugMode:this._debug,isWebInWin:this._isWebInWin}),this.listenTo(this._pager,"ENORIPE_NavPagerClose",this.clearFilterBySearch),this.listenTo(this._pager,"ENORIPE_HighlightNode",this._highlightNodeByPager),this._pager.inject(this.container)),this._continueSearch&&(e.noChangeFocus=!0),this._pager.render(e)},_highlightNodeByPager:function(e){if(this._isPreviewPanelOpen)this.previewView.selectNode(e);else if(this.clearSelection(),"All"===e)this.selectAllFromCmd();else{var t=this.collection.get(e);this._manageSelection({models:[t],sAction:"add"})}},_initTagger:function(){var e=this;if(!this.taggerServices){this.summariesForVolatileTags=[{count:-1,dispValue:s.get("Synchronized"),object:"Synchronized",sixw:"ds6w:what/"+s.get("SynchronizationStatusPredicate"),type:"string",value:"Synchronized"},{count:-1,dispValue:s.get("NotSynchronized"),object:"NotSynchronized",sixw:"ds6w:what/"+s.get("SynchronizationStatusPredicate"),type:"string",value:"NotSynchronized"},{count:-1,dispValue:s.get("Unknown"),object:"Unknown",sixw:"ds6w:what/"+s.get("SynchronizationStatusPredicate"),type:"string",value:"Unknown"},{count:-1,dispValue:s.get("In"),object:"In",sixw:"ds6w:what/"+s.get("LoopsPredicate"),type:"string",value:"In"},{count:-1,dispValue:s.get("Out"),object:"Out",sixw:"ds6w:what/"+s.get("LoopsPredicate"),type:"string",value:"Out"}];var t={};t["ds6w:what/"+s.get("SynchronizationStatusPredicate")]=[{color:"#57B847",object:"Synchronized",type:"string"},{color:"#EA4F37",object:"NotSynchronized",type:"string"},{color:"#FFA500",object:"Unknown",type:"string"}],t["ds6w:what/"+s.get("LoopsPredicate")]=[{color:"#EA4F37",object:"In",type:"string"},{color:"#57B847",object:"Out",type:"string"}],this.taggerServices=new I({widgetId:this._widgetId,addVolatileTags:!0,summariesForVolatileTags:this.summariesForVolatileTags,colorMapsForVolatileTags:t,taggerProxyOptions:{activateSelection:!0}}),this.taggerServices.addEvent("Tagger_FilterBIColorize",(function(t){e.onFilterBIColorize(t)})),this.taggerServices.addEvent("Tagger_FilterBIUnColorize",(function(){e.onFilterBIUnColorize()})),this.taggerServices.addEvent("Tagger_FilterBIFilteringEvent",(function(t){e.onFilterBIFilteringEvent(t)})),this.taggerServices.addEvent("Tagger_ColorizeVolatile",(function(t){t.isVolatileData=!0,e.onFilterColorizeVolatile(t)})),this.taggerServices.addEvent("Tagger_FilteringVolatile",(function(t){t.isVolatileData=!0,e.onFilterVolatile(t)})),this.taggerServices.addEvent("Tagger_FilterBISelection",(function(t){e.clearSelection(),e.onFilterSelection(t)})),this.taggerServices.addEvent("Tagger_SelectVolatile",(function(t){e.onFilterSelectionVolatile(t)}))}},updateFilterProxy:function(e,t){var i=[];e||this.collection.filter((function(e){if("node"===e.get("modelType")&&(i.push(e.get("id")),e.get("instancesExpanded")>0&&e.get("instances")))for(var t=0;t<e.get("instancesExpanded");t++)i.push(e.get("instances")[t].id)}));var n=[],o=[];this.collection.filter((function(e){if("link"===e.get("modelType")){var t=e.get("type");if(-1===o.indexOf(t)){o.push(t);var i={count:-1,dispValue:s.get(t),object:t,sixw:"ds6w:what/"+s.get("RelationsPredicate"),type:"string",value:t};n.push(i)}}}));var a=this.summariesForVolatileTags.concat(n);this.taggerServices.updateVolatileTags(a),this.taggerServices.updateFilterProxy(i,e)},onFilterBIFilteringEvent:function(e){this._appliedTags=0,this.filter(e)},onFilterBIColorize:function(e,t){var i={matchingIDs:[],filteredLinks:[]};e&&(i.matchingIDs=e),t&&(i.filteredLinks=t),(e||t)&&(this.onFilterBIUnColorize(),this._currentView.colorize(i))},onFilterBIUnColorize:function(){this._currentView.unColorize()},onFilterSelectionVolatile:function(e){if(e){var t={},i={},n=[];t.matchingIDs=e.matchingIDs,delete e.matchingIDs,t.allfilters=e,t.matchingIDs&&t.matchingIDs.length>0&&this.onFilterSelection(t),n=Object.keys(t.allfilters),this.addLoader(),this.clearSelection(),n.forEach(function(e){switch(t.matchingIDs=this.collection.getNodesIds(),e){case"ds6w:what/"+s.get("SynchronizationStatusPredicate"):this.dispatchEvent("SelectSynchro",t);break;case"ds6w:what/"+s.get("LoopsPredicate"):i=this.loopFiltering(t),this.onFilterSelection(i);break;case"ds6w:what/"+s.get("RelationsPredicate"):i=this.relationsFiltering(t),this.onFilterSelection(i);break;default:this.removeLoader()}}.bind(this))}},onFilterColorizeVolatile:function(e){if(e&&e.tagColors&&e.tagColors.length>0)switch(this.addLoader(),this.onFilterBIUnColorize(),e.tagColors[0].predicate){case"ds6w:what/"+s.get("SynchronizationStatusPredicate"):this.dispatchEvent("ColorizeSynchro",e);break;case"ds6w:what/"+s.get("LoopsPredicate"):this.loopColorize(e);break;case"ds6w:what/"+s.get("RelationsPredicate"):this.colorizeRelations(e);break;default:this.removeLoader()}},onFilterVolatile:function(e){this._appliedTags=0;e.matchingIDs;var t={};this.collection.filter((function(e){return"node"===e.get("modelType")}));if(e&&e.allfilters){var i="";this.addLoader(),"linearGraph"===this._currentLayout&&(this.mapView._filteredOpacity=!1),this._currentView.endFilter();for(var n="",o=0;o<Object.keys(e.allfilters).length;o++){switch(i=Object.keys(e.allfilters)[o]){case"ds6w:what/"+s.get("SynchronizationStatusPredicate"):this.dispatchEvent("FilteringSynchro",e);break;case"ds6w:what/"+s.get("LoopsPredicate"):t=this.loopFiltering(e),this.filter(t);break;case"ds6w:what/"+s.get("RelationsPredicate"):t=this.relationsFiltering(e),this.filter(t);break;default:this.removeLoader()}var a=e.allfilters[i];a&&a.length&&a.forEach((function(e){n=n+e.object+","}))}n.length>0&&(n=n.substr(0,n.length-1),_.trackMultiUsage("volatileTagUsage","volatileTagUsage",[i,n]))}},onFilterSelection:function(e){var t=[];e.matchingIDs&&e.matchingIDs.length>0&&(e.matchingIDs.forEach(function(e){this.collection.get(e)&&t.push(this.collection.get(e))}.bind(this)),t.length>0&&this._manageSelection({models:t,sAction:"add"})),this.removeLoader(),this.taggerServices.setSelectStatus()},colorizeSynchro:function(e){e.colorMap={};for(var t=0;t<e.tagColors.length;t++)e[e.tagColors[t].object]&&e[e.tagColors[t].object].forEach((function(i){e.colorMap[i]=e.tagColors[t].color}));this.onFilterBIColorize([],e),this.removeLoader()},colorizeRelations:function(e){var t={};e.colorMap={};for(var i=0;i<e.tagColors.length;i++)t[e.tagColors[i].object]=e.tagColors[i].color;this.collection.filter((function(i){"link"===i.get("modelType")&&(e.colorMap[i.id]=t[i.get("type")])})),this.onFilterBIColorize([],e),this.removeLoader()},loopColorize:function(e){e.forColorize=!0;var t,i,n=[];e=this.loopFiltering(e);for(var s=0;s<e.tagColors.length;s++)"In"===e.tagColors[s].object?t=e.tagColors[s].color:"Out"===e.tagColors[s].object&&(i=e.tagColors[s].color);for(var o=0;o<e.inLoopNodes.length;o++)n.push({id:e.inLoopNodes[o],color:t});for(var a=0;a<e.outLoopNodes.length;a++)n.push({id:e.outLoopNodes[a],color:i});this.onFilterBIColorize(n),this.removeLoader()},loopFiltering:function(e,t){var i={excluded:!0,tags:[]},n=[],o=[];if(!e.forColorize)for(var a in e.allfilters)if(e.allfilters.hasOwnProperty(a)){a!=="ds6w:what/"+s.get("LoopsPredicate")&&!0;for(var r=0;r<e.allfilters[a].length;r++)if(!e.allfilters[a][r].excluded){i.excluded=!1;break}for(r=0;r<e.allfilters[a].length;r++)"In"!==e.allfilters[a][r].object&&"Out"!==e.allfilters[a][r].object||!e.allfilters[a][r].excluded!=!i.excluded||i.tags.push(e.allfilters[a][r].object)}for(var l=this._layoutUtils.findLoops(),c=0;c<l.length;c++)for(var d=l[c],h=0;h<d.length;h++){n.push(d[h]);var u=this.collection.get(d[h]);if(u&&u.get("instancesExpanded")>0&&u.get("instances"))for(r=0;r<u.get("instances").length;r++)n.push(u.get("instances")[r].id)}if(this.collection.filter((function(e){if("node"===e.get("modelType")&&n.indexOf(e.id)<0&&(o.push(e.id),e.get("instancesExpanded")>0&&e.get("instances")))for(r=0;r<e.get("instances").length;r++)o.push(e.get("instances")[r].id)})),e.forColorize)return e.inLoopNodes=n,e.outLoopNodes=o,e;for(r=0;r<i.tags.length;r++)"In"===i.tags[r]?i.excluded?e.matchingIDs=e.matchingIDs.filter((function(e){return n.indexOf(e)<0})):e.matchingIDs=n.filter((function(t){return e.matchingIDs.indexOf(t)>-1})):"Out"===i.tags[r]&&(i.excluded?e.matchingIDs=e.matchingIDs.filter((function(e){return o.indexOf(e)<0})):e.matchingIDs=o.filter((function(t){return e.matchingIDs.indexOf(t)>-1})));return e.isLoopData=!0,e},relationsFiltering:function(e){var t={excluded:!0,tags:[]},i={},n={},o=[];for(var a in e.filteredLinks=[],e.matchingIDs||(e.matchingIDs=[]),e.allfilters)if(e.allfilters.hasOwnProperty(a)&a==="ds6w:what/"+s.get("RelationsPredicate")){for(var r=0;r<e.allfilters[a].length;r++)if(!e.allfilters[a][r].excluded){t.excluded=!1;break}for(r=0;r<e.allfilters[a].length;r++)!e.allfilters[a][r].excluded==!t.excluded&&t.tags.push(e.allfilters[a][r].object)}return this.collection.filter((function(i){"link"===i.get("modelType")&&(t.excluded?t.tags.indexOf(i.get("type"))<0&&e.filteredLinks.push(i.id):-1!==t.tags.indexOf(i.get("type"))&&e.filteredLinks.push(i.id))})),this.collection.filter((function(t){if("link"===t.get("modelType")&&e.filteredLinks.indexOf(t.id)>-1){if(i=t.get("source"),n=t.get("target"),i.id&&o.indexOf(i.id)<0&&(o.push(i.id),i.instancesExpanded>0&&i.instances))for(var s=0;s<i.instances.length;s++)o.push(i.instances[s].id);if(n.id&&o.indexOf(n.id)<0&&(o.push(n.id),n.instancesExpanded>0&&n.instances))for(s=0;s<n.instances.length;s++)o.push(n.instances[s].id);t.get("instanceTargetId")&&o.indexOf(t.get("instanceTargetId"))<0&&o.push(t.get("instanceTargetId"))}})),e.matchingIDs=o.filter((function(t){return e.matchingIDs.indexOf(t)>-1})),e},filter:function(e){this._lastFilterData=e,Object.keys(e.allfilters).length>0?(this._isFiltered=!0,this._currentlyFilteredNodes=this._currentView.filter(e),e.isVolatileData&&this.updateFilterProxy(e.isVolatileData)):(this._isFiltered=!1,this._currentlyFilteredNodes=[],this._isSearched?(this._currentView.filter({matchingIDs:this._currentlySearchedNodes}),this.updateFilterProxy(e.isVolatileData,this._currentlySearchedNodes)):("linearGraph"===this._currentLayout&&this.mapView&&(this.mapView._filteredOpacity=!1),this._currentView.endFilter(!0))),this._appliedTags++,this._appliedTags===Object.keys(e.allfilters).length&&this.removeLoader()},filterBySearch:function(t){var i=e.clone(t);i=this._isPreviewPanelOpen?this.previewView.getIdsSorted(i):this._getIdsSortedByColumn(i),this._onPager({result:i}),this._isPreviewPanelOpen?this.previewView.filterBySearch(t):(this._isSearched=!0,this._currentlySearchedNodes=t,this._currentView.filter({matchingIDs:t})),0===i.length?this._showNotif({level:"error",msg:s.get("No-SearchMatch")}):this.updateFilterProxy(this._currentlySearchedNodes)},_OnRightClick:function(t){if(this._isWebInWin){var i=this.collection.get(t.id);if(this._theContextualMenuTarget.targetId=t.id,this._theContextualMenuTarget.context=t.context,e.is(i)){e.is(this._theContextualMenu)&&this._theContextualMenu.destroy();var n=[];(n=l.getSelectedIDs()).includes(t.id)||(n=[t.id]),r.sendToMapWebInWin("onComputeCtxMenu",n)}}},_onCtxMenuItem:function(e){if(this._isWebInWin){var t=l.getSelectedIDs();r.sendToMapWebInWin("onCtxMenuClick",t,e.action)}},SetContextualMenu:function(t){if(this._isWebInWin){var i,n=this,o=l.getSelectedIDs();if(o=o.length?o:[this._theContextualMenuTarget.targetId],i=r.ComputeContextualMenu(this,t),e.is(i))switch(i=i.filter((function(e){return"CATRelNavWebInWinCmdHdr"!==e.actionId})),this._theContextualMenuTarget.context){case"D3MapView":var c=this._theContextualMenuTarget.targetId,d=this.getElement("#container-"+CSS.escape(c)),h={id:"previewEcosys",text:s.get("previewUpAndDownstream"),icon:"preview",handler:function(){const e={model:E.getItemFromId(c)};n._showPreview(e)}};i.push(h),this._theContextualMenu=new a({isContextual:!0,target:d,items:i}),this._theContextualMenu.show(),this._theContextualMenuTarget={};break;case"DataGridView":c=this._theContextualMenuTarget.targetId,d=this.getElement("#container-"+CSS.escape(c));var u=this.dataGridView.getRightClickModel();u&&this.dataGridView.getExpandCollapseCtxMenu(u,!0).then(function(e){i=[...i,...e],this._theContextualMenu=new a({isContextual:!0,target:d,items:i}),this._theContextualMenu.show(),this._theContextualMenuTarget={}}.bind(this));break;case"PreviewGroup":c=this._theContextualMenuTarget.targetId,d=this._theContextualMenuTarget.targetElement;c&&d&&(this._theContextualMenu=new a({isContextual:!0,target:d,items:i}),this._theContextualMenu.show(),this._theContextualMenuTarget={});break;case"FindPath":var g=this._theContextualMenuTarget.targetId,p=(d=this._theContextualMenuTarget.targetElement,this._theContextualMenuTarget.typeOfPath);if(g&&d){if("StructurePath"==p){var f=this._theContextualMenuTarget.jsonMsgForOpen,m=this._theContextualMenuTarget.jsonMsgForAddInGraph,v={accelerator:"Ctrl+O",availabilityMode:"Normal=YES CommandSet=YES Editability=YES SmallScale=YES LargeScale=YES ",id:"OpenSearch",multisel:!0,text:s.get("open"),icon:"I_OpenDB",handler:function(){r.sendStringRelationsToWebInWin("onOpenPathClick",f)}};i.push(v);var _={id:"findPathAddInGraph",text:s.get("FindPathAddInGraph"),icon:"I_AddResource",handler:function(){n._addInGraph(g,m)}};i.push(_)}else{v={accelerator:"Ctrl+O",availabilityMode:"Normal=YES CommandSet=YES Editability=YES SmallScale=YES LargeScale=YES ",id:"OpenSearch",multisel:!0,text:s.get("open"),icon:"I_OpenDB",handler:function(){r.sendToMapWebInWin("onCtxMenuClick",g,"ENOVIA_Open_Simple")}};i.push(v);var S={id:"selectInGraphItem",text:s.get("FindPathSelectInGraph"),icon:"I_Select",handler:function(){n._selectInGraph(g)}};i.push(S)}this._theContextualMenu=new a({isContextual:!0,target:d,items:i}),this._theContextualMenu.show(),this._theContextualMenuTarget={}}}}},addLoader:function(){h.mask(this.container)},removeLoader:function(e){this.hideSpinner(),h.unmask(this.container)},_showNotif:function(e){e.container=e.container||this.container,M.showNotif(e,this._isWebInWin)},clearMapClick:function(){var e=this,t=new u({renderTo:e.container}),i=s.get("ClearConfirmHeader"),n=s.get("ClearConfirmBody");t.dialog({body:n,title:i,buttons:[{className:"primary",value:s.get("ClearView_ClearButton"),action:function(t){e.dispatchEvent("ENORIPE_ClearMap"),t.hide()}},{value:s.get("ClearView_Cancel"),action:function(e){e.hide()}}]})},clearMapFailure:function(){this._notifManager.addNotif({level:"info",message:s.get("clearView_failure"),sticky:!1})},clearMapSuccess:function(t){t||(this._isEmpty=!0),this._toolBarView&&(this._toolBarView.hideSelectionIcon(),this._toolBarView.disableSelectionAssistantCommand()),this.collection&&!t&&(this.collection.reset(),l&&(l.handleClearMap(),l.clearMultiSel(0))),e.is(this.mapView)&&(this.mapView.destroy(),this.mapView=null),e.is(this.dataGridView)&&!t&&(this.dataGridView.destroy(),this.dataGridView=null),e.is(this.listView)&&(this.listView.hidePanel(),this.listView.clearPanel(),this._infoPanelCommandClick=!1),e.is(this._pager)&&(this._pager.destroy(),this._pager=null),this._initEmptyMap(!0)},destroy:function(){this.stopListening(this.collection),this.stopListening(this.mapView),this.stopListening(this.listView),this.stopListening(this._dropZone),this.stopListening(this.pathPanel),this.collection.reset(),this.container=null,this._parent()}});return V})),define("DS/SNNavigationMap/ENORIPE",["UWA/Class","UWA/Core","UWA/Promise","DS/SNNavigationMap/utils/PromisesManager","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","DS/ENORIPE_Common/utils/CommonAlert","DS/SNNavigationMap/views/NavigationApp","DS/SNNavigationMap/views/NavigationHomePage","DS/SNNavigationMap/views/popups/Favorite","DS/SNNavigationMap/views/CustomizeAllView","DS/SNNavigationMap/collections/NavigationCollection","DS/SNNavigationMap/utils/SNNavigationServices","DS/SNNavigationMap/utils/RelationsServices","DS/SNNavigationMap/utils/LayoutUtils","DS/SNNavigationMap/utils/SearchUtils","DS/SNNavigationMap/utils/CommonUtils","DS/SNNavigationMap/utils/PreferencesUtils","DS/Utilities/DateUtils","DS/UIKIT/Modal","DS/WAFData/WAFData","DS/SNNavigationMap/utils/NlsManager","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],(function(e,t,i,n,s,o,a,r,l,c,d,h,u,g,p,f,m,v,_,S,b,N,w){"use strict";return e.extend({excludedNodes:[],currentProfile:"",_navigatedNodes:{},_currentRelations:[],_groupedRelations:{},_activeProfiles:[],_availableRelations:[],_lastSavedValues:{},_isHomePageVisible:!1,_preSelectedObjectIds:[],_tempPreferences:[],_isWebInWin:u.isWebInWin(),init:function(e){var i=this;t.merge(w,N.getNls()),o.setStartTime("init"),this._widget=e.widget||null,this.container=e.renderTo||null,this._navigatedNodes=v.getPref("ENORIPE_navigatedNodes")||{},this._addinMode=widget?widget.getValue("addinmode"):null,e.initWithNodes?(e.initWithNodes="string"==typeof e.initWithNodes?JSON.parse(e.initWithNodes):e.initWithNodes,e.initWithNodes=m.getItemsFromPreviousData(e.initWithNodes)):e.initWithNodes={};var r=e.initWithNodes||{};this._errorOnInit=e.errorOnInit,this._inAppOptions=e.inAppOptions,this._isWebInWin&&(this.container=t.extendElement(this.container)),s.setOption("iswebinwin",this._isWebInWin),this._PM=new n({debugMode:"1"===s.getOption("debug_me")}),this._widget&&(this._widgetId=this._widget&&this._widget.id?this._widget.id:void 0,this._widgetStateAtInit=this._widget.getView?this._widget.getView().type:""),this._widgetId=this._widgetId?this._widgetId:e.widgetId,s.setWidgetId(this._widgetId),e.profile&&void 0!==e.profile&&""!==e.profile&&this._savePreferencesLocally("LastUsedProfile",s.setLastUsedProfile.bind(s),e.profile),e.preSelectedObjectIds&&void 0!==e.preSelectedObjectIds&&(this._preSelectedObjectIds=e.preSelectedObjectIds),e.inAppMode&&s.setOption("inAppMode",!0),this._inAppOptions&&(void 0!==this._inAppOptions.relationSet&&""!==this._inAppOptions.relationSet&&this._savePreferencesLocally("LastUsedProfile",s.setLastUsedProfile.bind(s),e.profile),void 0!==this._inAppOptions.selectedObjectIds&&(r=JSON.stringify(this._inAppOptions.selectedObjectIds)));let l=v.getPref("favoriteID")||null,c={};l&&null!==l&&(c[l]=l,e.initWithFavorite=c),this._savePreferencesLocally("layoutType",s.setLayoutType.bind(s));let d=v.getPref("lastRootNodeID")||[];d&&!Array.isArray(d)&&this._updateLastRootID(d);let h=v.getPref("_ENORIPE_Type_Attrs")||{};e.initWithTenant&&s.setCurrentTenant(e.initWithTenant),e.defaultTenant&&s.setDefaultTenant(e.defaultTenant),s.appInitializationPromised(e.mapSettings,null,h).then((function(){s.addCredentialPreferenceToWidget().then((function(){g.getSettingsAndRelSets().then(i._mergeSettings.bind(i)).then(i._parseRelations.bind(i)).then((function(e){i.trackProfileUsage(i.currentProfile)})).then((function(){if(s.getSGINavigation())return g.getIsAlive_Is3DSpaceIUExistingAndTenantAllowed().then((function(e){let t="alive"===JSON.parse(e).status;console.info("is3DSpaceIUExistingAndTenantAllowed = ",t),s.setIs3DSpaceIUExistingAndTenantAllowed(t)})).catch((function(e){console.error("is3DSpaceIUExistingAndTenantAllowed web service error:",e),console.info("is3DSpaceIUExistingAndTenantAllowed = ",!1),s.setIs3DSpaceIUExistingAndTenantAllowed(!1)}))})).then((function(){r&&0!==Object.keys(r).length||!i._navigatedNodes||(e.initWithNodes=Object.keys(i._navigatedNodes).length>0?i._navigatedNodes:e.initWithNodes);let t=Object.values(e.initWithNodes),n=null;if(e.initWithFavorite)e.initWithNodes=e.initWithFavorite,n=Object.keys(e.initWithFavorite)[0];else{let t=Object.values(e.initWithNodes).find((e=>"ENORelationalExplorerFavorite"===e.type));t&&(n=t.id)}Object.keys(e.initWithNodes).length>0?n?(i._openFavorite(n),o.trackUsage("Favorite","InitWithFavorite")):(i._addRecents(t),i._initCollection(e)):i._initCollection(e),i._updateWidgetHeader()}))}))}),(function(e){e.showMsg&&a.showNotif({level:"error",msg:w.get(e.msg),sticky:!0},i._isWebInWin)})),s.setLang(e.lang),this._savePreferencesLocally("thumbnails2d",s.setThumbnailsMode.bind(s)),this._savePreferencesLocally("showInstances",s.setInstancesMode.bind(s)),this._savePreferencesLocally("showPublications",s.setPublicationsMode.bind(s)),this._savePreferencesLocally("showGhost",s.setGhostMode.bind(s)),this._savePreferencesLocally("layoutMode",s.setLayoutMode.bind(s)),this._savePreferencesLocally("activateOptimizedIndexNavigation",s.setActivateOptimizedIndexNavigation.bind(s)),this._savePreferencesToLocalStorage("whatsNewDoNotShowAgain",s.setWhatsNewDoNotShowAgain.bind(s)),this._savePreferencesLocally("listViewPanelWidth",s.setListViewPanelWidth.bind(s)),this._savePreferencesLocally("typeLayoutView",s.setTypeLayoutView.bind(s)),s.setInformationPanelStatus({isInformationPanelVisible:v.getPref("isInformationPanelVisible")||!1}),this._layoutUtils=new p({layoutAxis:s.getLayoutAxis(),layoutDirection:s.getLayoutDirection()})},getTaggerWebInWin:function(){return this._taggerWIWManager},synchroSelection:function(e){this.hideSpinner(),this.getSynchroStatus(e).then(function(e){this._navigationMap.onFilterSelection(e)}.bind(this))},synchroColorize:function(e){this.hideSpinner(),e.forColorize=!0,this.getSynchroStatus(e).then(function(e){this._navigationMap.colorizeSynchro(e)}.bind(this))},synchroFiltering:function(e){this.hideSpinner(),this.getSynchroStatus(e).then(function(t){this._navigationMap.filter(e)}.bind(this))},_cleanProxy:function(){this._navigationMap&&this._navigationMap.taggerServices&&this._navigationMap.taggerServices.cleanProxy()},_processSynchroData:function(e,t){e.isVolatileData=!0;var i,n=[],s=[],o=[],a=[],r={},l={},c=[],d={excluded:!0,tags:[]};if(!e.forColorize)for(var h in e.allfilters)if(e.allfilters.hasOwnProperty(h)){for(var u=0;u<e.allfilters[h].length;u++)if(!e.allfilters[h][u].excluded){d.excluded=!1;break}for(u=0;u<e.allfilters[h].length;u++)("NotSynchronized"===e.allfilters[h][u].object||"Synchronized"===e.allfilters[h][u].object||"Unknown"===e.allfilters[h][u].object&&!e.allfilters[h][u].excluded==!d.excluded)&&d.tags.push(e.allfilters[h][u].object)}t.outputlist&&t.outputlist.primitives&&(s=t.outputlist.primitives);for(var g=0;g<s.length;g++)"notuptodate"===s[g].stampvalue?n.push(s[g].parentRelationId):"unknown"===s[g].stampvalue?a.push(s[g].parentRelationId):"uptodate"===s[g].stampvalue&&o.push(s[g].parentRelationId);for(g=0;g<s.length;g++)o.indexOf(s[g].parentRelationId)>-1&&(-1!==n.indexOf(s[g].parentRelationId)||-1!==a.indexOf(s[g].parentRelationId))&&(i=o.indexOf(s[g].parentRelationId),o.splice(i,1)),n.indexOf(s[g].parentRelationId)>-1&&-1!==a.indexOf(s[g].parentRelationId)&&(i=n.indexOf(s[g].parentRelationId),n.splice(i,1));if(e.forColorize)return e.Synchronized=o,e.NotSynchronized=n,e.Unknown=a,e;e.filteredLinks=[];for(u=0;u<d.tags.length;u++)d.excluded?this.collection.filter((function(t){"link"===t.get("modelType")&&("Synchronized"===d.tags[u]&&o.indexOf(t.id)<0&&e.filteredLinks.push(t.id),"NotSynchronized"===d.tags[u]&&n.indexOf(t.id)<0&&e.filteredLinks.push(t.id),"Unknown"===d.tags[u]&&a.indexOf(t.id)<0&&e.filteredLinks.push(t.id))})):"Synchronized"===d.tags[u]?e.filteredLinks=e.filteredLinks.concat(o):"NotSynchronized"===d.tags[u]?e.filteredLinks=e.filteredLinks.concat(n):"Unknown"===d.tags[u]&&(e.filteredLinks=e.filteredLinks.concat(a));return this.collection.filter((function(t){if("link"===t.get("modelType")&&e.filteredLinks.indexOf(t.id)>-1){if(r=t.get("source"),l=t.get("target"),r.id&&c.indexOf(r.id)<0&&(c.push(r.id),r.instancesExpanded>0&&r.instances))for(var i=0;i<r.instances.length;i++)c.push(r.instances[i].id);if(l.id&&c.indexOf(l.id)<0&&(c.push(l.id),l.instancesExpanded>0&&l.instances))for(i=0;i<l.instances.length;i++)c.push(l.instances[i].id)}})),e.matchingIDs&&(e.matchingIDs=c.filter((function(t){return e.matchingIDs.indexOf(t)>-1}))),e},getSynchroStatus:function(e){var t=this,n=[],s={};return new i(function(i,o){(n=this.collection.getLinksIds()).length>0?g.getSynchroStatus(n).then((function(n){n&&(s=JSON.parse(n)),e=t._processSynchroData(e,s),i(e)}),(function(){t.hideSpinner(),o()})):(t._navigationMap.removeLoader(),o())}.bind(this))},_setPreferences:function(e){var t,i=this,n={},s=i._autoModeChanged;return n.attributes=this._getAttrForTypes(),n.excludedRelations=[],n.allRelationsMode="AutoModeProfile"===i.currentProfile,e&&(n.widgetId=e),(t=this._initExpandedDirection()).length>0&&(this._currentRelations=t),i._autoNavMode&&(n.excludedRelations=this._getExcludedRelations(),n.excludedRelations.push("v6_structure_roots_from")),s&&!n.allRelationsMode&&(n.relations=this._currentRelations),i._autoModeChanged=!1,g.setPreferences(n)},_initCollection:function(e){var t=e.initWithNodes,i=Object.keys(e.initWithNodes),n=this._navigatedNodes,o=this,a=v.getPref("ENORIPE_savedColumnIds"),r=e.needClear,l=e.selectedNodes||[];i&&0!==i.length||!n||(t=n.length?n:t,i=Object.keys(t)),this._isEmpty=0===i.length,o._navigationMap&&(this._navigationMap._isEmpty=this._isEmpty),i&&i.length>0?(this.collection||(this.collection=new h([],{widgetId:this._widgetId,layoutUtils:this._layoutUtils,savedColumns:a||null,debugMode:"1"===s.getOption("debug_me")}),this.collection.addEvent("ENORIPE_setSavedColumnIds",(function(e,t){v.setPrefToWidget(e,t)})),this.collection.addEvent("ENORIPE_noObjectToAdded",(function(){o._navigationMap&&o._navigationMap._showNotif({level:"info",lvl:"primary",msg:w.get("ObjectsAlreadyInGraph")})})),this.collection.addEvent("ENORIPE_handleErrorMsgs",(function(e){o._navigationMap&&o._navigationMap.handleServerErrorMsgs(e)})),this.collection.addEvent("ENORIPE_someObjectsNotIndex",(function(e,t){o.showMessageNotIndexed();let i=s.getRootIds();i=i.filter((e=>!t.includes(e))),o._updateLastRootID(i),0===o.collection.length&&0===e?(o._isEmpty=!0,o.clearMap()):o._navigationMap&&o._navigationMap.removeLoader()}))),e.needClear||0===this.collection.length?this._getInfosForObjects(t,r,l):(o._initMapView(!1),o._navigationMap.render(o.collection)),a&&Object.keys(a).length>0&&this.collection.setColumnIds(a)):(this._initMapView(!0),this.showHomePage())},_refreshCollection:function(e){if(this._navigationMap&&(this._navigationMap._spinner.show(),e.firedFromWidgetMenu&&(this._navigationMap.refreshMsgPending=!0)),this.collection&&this._navigatedNodes&&Object.keys(this._navigatedNodes).length){this._initCollection({initWithNodes:e.initWithNodes,objectType:e.objecType||null,needClear:e.needClear})}else{if(e.firedFromWidgetMenu)return void(this._navigationMap&&this._navigationMap._spinner.hide());this._initCollection({initWithNodes:e.initWithNodes,objectType:e.objecType||null})}},_setAvailableRelation:function(e){var t=[],i="",n="",s="false";this._availableRelations.forEach((function(e){t.push(e.name)}));for(var o=0;o<e.length;o++)-1===t.indexOf(e[o])&&(i=e[o],n="",n=this.currentProfile+":"+i,m.getMainRelName(i),s=e.indexOf(i)>-1?"true":"false",this._saveTempPreferences(n,s),this._lastSavedValues[i]=s,this._availableRelations.push({name:i}));m.setAvailableRelations(this._availableRelations)},_initMapView:function(e){var t=this;if(this._navigationMap){if(this._navigationMap.refresh({isEmpty:e,collection:this.collection}),this._isFavOpen){var i=this._navigationMap._favTitle;this._updateFavoriteTitle(i)}}else this._navigationMap=new r({addinMode:this._addinMode,collection:this.collection,layoutUtils:this._layoutUtils,autoNavMode:this._autoNavMode,promiseManager:this._PM,countLimit:s.getOption("countLimit"),platformId:s.getPlatformId(),lang:s.getLang(),isEmpty:e,widgetId:this._widgetId,widget:this._widget,lastRootID:this._lastRootID,debugMode:"1"===s.getOption("debug_me"),separator:s.getOption("displayNameSeparator"),nameLabel:s.getOption("displayNameAttributes"),detailLabel1:s.getOption("detailAttributesLevel1"),detailLabel2:s.getOption("detailAttributesLevel2"),preSelectedObjectIds:this._preSelectedObjectIds,inAppOptions:this._inAppOptions,errorOnInit:this._errorOnInit}),this.collection&&this.collection.addEvent("onSync",(function(e,i,n){t._navigationMap&&t._navigationMap.render(e,i,n)})),this._navigationMap.addEvent("ENORIPE_DropByMode",this._dropByMode.bind(this)),this._navigationMap.addEvent("ENORIPE_refreshMap",this._onRefresh.bind(this)),this._navigationMap.addEvent("ENORIPE_ClearMap",this.clearMap.bind(this)),this._navigationMap.addEvent("ENORIPE_SetNavigatedNode",this._setNavigatedNodes.bind(this)),this._navigationMap.addEvent("setLastRootNodeID",(function(e){t._addRootNode(e,!0)})),this._navigationMap.addEvent("ENORIPE_CustomizeAll",this.showCustomizeAll.bind(this)),this._navigationMap.addEvent("ENORIPE_HighlightDisplayOption",this.highlightDisplayOptionInCustomize.bind(this)),this._navigationMap.addEvent("ENORIPE_ProfileInfo",(function(){var e=t._getValuesForProfile();null!==e&&""!==e&&void 0!==e&&(t._navigationMap.lastUsedProfile=e);for(var i=0;i<t._activeProfiles.length;i++)t._navigationMap.profileArray[i]=t._activeProfiles[i].name})),t._navigationMap.addEvent("ENORIPE_updateRelations",t._updateRelations.bind(t)),t._navigationMap.addEvent("ENORIPE_Search",t.onSearch.bind(t)),t._navigationMap.addEvent("ENORIPE_ShowHomePage",t.showHomePage.bind(t)),t._navigationMap.addEvent("ENORIPE_FavoriteModal",t.handleFavorite.bind(t)),t._navigationMap.addEvent("ENORIPE_HideHomePage",t.hideHomePage.bind(t)),this._navigationMap.addEvent("ENORIPE_HideLeftToolBar",(function(){t.leftIconBar&&t.leftIconBar.hide()})),this._navigationMap.addEvent("ENORIPE_ShowLeftToolBar",(function(){t.leftIconBar&&t.leftIconBar.show()})),t._navigationMap.addEvent("ENORIPE_ShowPreview",(function(e){var i={};e.direction&&"WhereUsed"===t.currentProfile&&(e.direction="in"),e.model&&g.getEcosystem([e.model],{direction:e.direction,responseMode:"objectsByPatterns"}).then((function(n){i=t._parseEcosystem(n),t._navigationMap.previewView.setPreview(e.model.id,i)}))})),t._navigationMap.addEvent("ColorizeSynchro",(function(e){t.synchroColorize(e)})),t._navigationMap.addEvent("FilteringSynchro",(function(e){t.synchroFiltering(e)})),t._navigationMap.addEvent("SelectSynchro",(function(e){t.synchroSelection(e)})),t._navigationMap.addEvent("ENORIPE_ToggleInformationPanel",(function(e){v.setPrefLocally("isInformationPanelVisible",e),s.setInformationPanelStatus({isInformationPanelVisible:e})})),t._navigationMap.addEvent("ENORIPE_UpdateAttributes",(function(e){t._updatePreferences(e)})),t._navigationMap.addEvent("ENORIPE_ResizeListViewPanel",function(e){e&&v.setPrefEverywhere("listViewPanelWidth",e)}.bind(this)),t._navigationMap.addEvent("ENORIPE_initExpandNLevel",(function(e){t.initExpandNLevel(e)})),t._navigationMap.addEvent("ENORIPE_SwitchLayout",(function(e){e&&t._updateLayoutType(e)})),t._navigationMap.addEvent("ENORIPE_performSearch_native",t.onSearch.bind(t)),t._navigationMap.addEvent("ENORIPE_LaunchSearch",(function(){var e=t._navigationMap._searchValue;e&&t.onSearch(e)})),t._favData&&(t._isFavOpen=!0,t._navigationMap._favTitle=t._favData.title),this._navigationMap.addEvent("ENORIPE_HideOneDirection",this._hideOneDirection.bind(this)),this._navigationMap.addEvent("ENORIPE_ShowOneDirection",this._showOneDirection.bind(this)),this._navigationMap.addEvent("ENORIPE_noObjectToAdded",(function(){t._navigationMap&&t._navigationMap._showNotif({level:"info",lvl:"primary",msg:w.get("ObjectsAlreadyInGraph")})})),this._navigationMap.addEvent("ENORIPE_updateLastRootId",this._updateLastRootID.bind(this)),this._navigationMap.addEvent("ENORIPE_TrackProfileUsage",this.trackProfileUsage.bind(this)),this._navigationMap.addEvent("Customize_UpdateRelationsDisplayed",this.updateRelationsDisplayedCustomize.bind(this)),this._navigationMap.addEvent("Customize_UnloadCustomizeRelations",function(){this._customizeAllView.unloadCustomizeRelations()}.bind(this)),this._navigationMap.addEvent("Customize_LoadingRelations",function(){this._customizeAllView.loadingCustomizeRelations()}.bind(this)),this.container.setContent(this._navigationMap),this._navigationMap.onResize();this.initCustomizeAll()},initExpandNLevel:function(e){var t=this,i="";e&&e.selectedNodes&&e.expandNLevelView&&(this.expandNLevelView=e.expandNLevelView,(i=this.expandNLevelView.getExpandSessionId())&&this._setPreferences(i).then((function(){t.expandNLevelView.initModal({selectedNode:e.selectedNodes,expandSessionId:i})})))},_initHomePage:function(){var e=this;this._homePage=new l({addinMode:this._addinMode,collection:this.collection,platformId:s.getPlatformId(),lang:s.getLang(),widgetId:this._widgetId,separator:s.getOption("displayNameSeparator"),nameLabel:s.getOption("displayNameAttributes"),detailLabel1:s.getOption("detailAttributesLevel1"),detailLabel2:s.getOption("detailAttributesLevel2"),debugMode:"1"===s.getOption("debug_me")}).inject(this.container),e._homePage.addEvent("ENORIPE_HandleRecents",e._handleRecents.bind(e)),e._homePage.addEvent("ENORIPE_HandleFavorite",e._handleFavorites.bind(e)),e._homePage.addEvent("ENORIPE_OpenRelExp",e._openRelExp.bind(e)),e._homePage.addEvent("ENORIPE_drop",e._handleDropFromHomePage.bind(e)),e._homePage.addEvent("ENORIPE_showNotif",(function(t){e._navigationMap._showNotif(t)})),e._homePage.addEvent("ENORIPE_dropNotSupported",(function(){e._navigationMap._showNotif({level:"error",msg:w.get("dropNotSupported")})}))},showHomePage:function(){this._homePage||this._initHomePage(),this.leftIconBar&&this.leftIconBar.elements.container.addClassName("displaynone"),this._navigationMap&&this._navigationMap._onHide(),this._homePage.render(),this._isHomePageVisible=!0},hideHomePage:function(){this._homePage&&(this._homePage.hide(),this._homePage.clearContent(),this._isHomePageVisible=!1),this.leftIconBar&&this.leftIconBar.elements.container.removeClassName("displaynone"),this._navigationMap&&this._navigationMap._onShow()},_handleDropFromHomePage:function(e,t){this._navigationMap&&(this._navigationMap._onShow(),this._navigationMap._handleDrop(e,t),this._isHomePageVisible=!1)},_handleRecents:function(){var e=v.getPref("_Recents")||[];0===e.length?this._homePage.showEmptyView("Recents"):(this._homePage.mask(),this._manageRecentObjects(e))},_manageRecentObjects:function(e){var t,i=this,n={},s={},o={};e.forEach((function(e){"string"!=typeof e&&(o[e.id]=e)})),0===Object.keys(o).length&&(o=e),o=m.getItemsFromPreviousData(o),[n,s]=m.splitItemsByServiceId(Object.values(o)),t=[...n,...s],g.fetchRecents(t).then((function(e){e&&i._homePage.showObjects(e.nlsObj)}),(function(e){console.log(e),i._homePage.unmask()}))},_isFavorite:function(e){var t=this;return new i((function(i,n){t.getSelectedSCForFavorites().then((function(t){g.isFavorite(t,e).then((function(e){e?(e=JSON.parse(e),i(e.isFavorite)):n()}),(function(){n()}))}),(function(e){n()}))}))},_openFavorite:function(e){var t=this;this.getSelectedSCForFavorites().then((function(i){g.getFavoriteInfo(i,e).then((function(e){e=JSON.parse(e),t._openRelExpFav(e.favorite[0])}))}))},_addFavoriteData:function(e){var t=this;this.getSelectedSCForFavorites().then((function(i){g.getFavoriteInfo(i,e).then((function(e){if(e){e=JSON.parse(e);var i={};e.favorite[0].rootPhysicalIds.forEach((function(e){i[e.id]=e,i[e.id].instances=[]})),t._dropAdd(i)}}))}))},_handleFavoritesDrop:function(e,t){var i=this;"add"===e?this._isEmpty?i._openFavorite(t.objectId):i._addFavoriteData(t.objectId):"replace"===e&&(this.clearMap(),i._openFavorite(t.objectId),o.trackUsage("Favorite","OpenFavFrom-DropReplace"))},handleFavorite:function(e){var t={saveIn:!1,favOpen:this._isFavOpen};e&&e.saveIn&&(t.saveIn=!0);var i=new c({favoriteTitle:this._favTitle},t);i.addEvent("ENORIPE_CreateFavorite",this._createFavorite.bind(this)),i.addEvent("ENORIPE_UpdateFav",this._updateFavorite.bind(this)),i.addEvent("ENORIPE_ShowHomePage",this.showHomePage.bind(this))},_handleFavorites:function(e){var t=this;this._homePage.mask(),this.getSelectedSCForFavorites().then((function(e){return g.getFavorites(e)})).then((function(i){(i=JSON.parse(i))&&i.favorite.length>0?t._homePage.showFavorites(i):e?t._homePage.changeTab(e):(t._homePage.showFavorites(i),t._homePage.unmask())}),(function(e){console.log(e),t._homePage.clearContent(),t._homePage.unmask()}))},_openRelExp:function(e){if(this.showSpinner(),this._cleanProxy(),e[0].name&&"ENORelationalExplorerFavorite"===e[0].type)this._openRelExpFav(e[0]);else{let i=m.getItemsFromModels(e),n={};for(var t=0;t<e.length;t++)n={...i};this._resetMap(n,!0);let s=Object.keys(i);this._addRootNode(s,!0),v.setPrefToWidget("favoriteID",null),this._navigationMap&&this._updateFavoriteTitle(""),this._isFavOpen=!1}},updateFavTitle:function(e){e.title&&(v.setPrefToWidget("favoriteID",e.id),this._navigationMap&&(this._navigationMap._onShow(),this._isHomePageVisible=!1,this._favData=e,this._isFavOpen=!0,this._navigationMap._favTitle=e.title,this._updateFavoriteTitle(e.title)))},_openRelExpFav:function(e){e&&e.layoutType&&e.layoutType!==s.getLayoutType()&&s.setLayoutType(e.layoutType);var t=e.preferences,i=!0,n=e.profilename,a=!1;if(n!==this.currentProfile&&(a=!0),a?("AutoModeProfile"===n?(this._autoNavMode=!0,this._autoModeChanged=!0):this._autoNavMode=!1,i=!0):i=!t.equals(this._currentRelations),e.rootIds&&e.rootIds.length>0&&this._addRootNode(e.rootIds,!0),i)this.checkDirections(t),this._updatePreferences(t,n,e);else{let t={};e.rootPhysicalIds.forEach((function(e){"string"!=typeof e&&(t[e.id]=e)})),0===Object.keys(t).length&&(t=e.rootPhysicalIds),t=m.getItemsFromPreviousData(t),this._onRefresh({initWithNodes:t,needClear:!0,isFav:!0,favData:e})}o.trackUsage("Favorite","OpenFavFrom-Homepage")},_createFavorite:function(e,t){var i,n=this,s=Object.values(this.collection.getIdentifierDataById(Object.keys(this._navigatedNodes)));i={title:e.inputval,ids:s,preferences:this._currentRelations,profilename:this.currentProfile,rootIds:this._lastRootID},this.setSelectedSCForFavorites(e.securitycontext),o.trackUsage("Favorite","CreateFav"),g.createFavorite(e.securitycontext,i).then((function(e){var i=JSON.parse(e).favorite[0];if(i){n._navigationMap._showNotif({level:"info",lvl:"primary",msg:i.title+" "+w.get("FavoriteSuccess")});e={name:i.favoriteName,type:"ENORelationalExplorerFavorite",title:i.title};e={...e,...i},t?n.showHomePage():n.updateFavTitle(e)}}))},_updateFavorite:function(e){var t,i=this,n=Object.values(this.collection.getIdentifierDataById(Object.keys(this._navigatedNodes)));t={favoriteName:this._favData.favoriteName,title:this._favData.title,ids:n,preferences:this._currentRelations,profilename:this.currentProfile,rootIds:this._lastRootID},this.showSpinner(),this._favData&&(o.trackUsage("Favorite","UpdateFav"),this.getSelectedSCForFavorites().then((function(n){g.updateFavorite(n,t).then((function(t){i.hideSpinner();var n=JSON.parse(t);n&&i._navigationMap._showNotif({level:"info",lvl:"primary",msg:n.favorite[0].title+" "+w.get("FavoriteUpdate")}),e&&i.showHomePage()}),(function(){i.hideSpinner()}))})))},getSelectedSCForFavorites:function(){var e=this;return new i((function(t,i){e._selectedSCForFav?t(e._selectedSCForFav):s._getListOfSecurityContext().then((function(n){let s=e.getKeyForSCFav(),o=!1,a=e._getValuesInSession(s);if(a)for(let e=0;e<n.length;e++)if(a===n[e].value){o=!0;break}o||(a=n[0].value),a?(e.setSelectedSCForFavorites(a),t(e._selectedSCForFav)):i()}))}))},getKeyForSCFav:function(){return(s.getUserID()||"defaultUserID")+"-selectedSCForFav"},setSelectedSCForFavorites:function(e){let t=this.getKeyForSCFav();this._selectedSCForFav=e,this._saveValuesInSession(t,e),s.setOption("selectedSCForFav",e)},initCustomizeAll:function(){var e=this;if(this._navigationMap&&(this._customizeAllView||(this._customizeAllView=new d(this._getCustomizeRelationsViewOptions()),this._initCustomizeAllListenEvents(),this._customizeAllView.inject(this.container),this._customizeAllView.hide()),this._customizeAllView)){var t=this._getCustomizeRelationsViewRenderOptions();this.collection?this._navigationMap.getCustomizeAttributeOptions().then((i=>{e._customizeAllView.render(t,i)})):e._customizeAllView.render(t)}},showCustomizeAll:function(e){var t=this;if(this._navigationMap&&this._customizeAllView){this._customizeAllView.show();var i=this._getCustomizeRelationsViewRenderOptions();this._navigationMap.getCustomizeAttributeOptions().then((e=>{t._customizeAllView.render(i,e)})),e&&t._customizeAllView.switchToTab(e)}},highlightDisplayOptionInCustomize:function(e){this._customizeAllView.getDisplayOptionView().highlightDisplayOption(e)},_setCustomizeRelationsOptions:function(){var e;(e=this._getCustomizeRelationsViewOptions())&&null!=e&&this._customizeAllView&&this._customizeAllView.setCustomizeRelationsContent(e)},_getCustomizeRelationsViewOptions:function(){var e,t,i=this,n=s.getOption("noautomode"),o=this._getValuesForProfile(),a=[];null!==o&&""!==o&&void 0!==o&&(t=o),n&&"AutoModeProfile"===t&&(t=i._activeProfiles[1].name,this._savePreferencesLocally("LastUsedProfile",s.setLastUsedProfile.bind(s),t));for(var r=0,l=0;l<i._activeProfiles.length;l++)if(n&&"AutoModeProfile"===i._activeProfiles[l].name)i._autoNavMode=!1;else{var c=i._activeProfiles[l].type,d=i._activeProfiles[l].nls;d||(d=w.get(i._activeProfiles[l].name)),i._activeProfiles[l].custom&&(c="custom",d=i._activeProfiles[l].nlsLabel),a[r]={name:i._activeProfiles[l].name,type:c,nls:d},r++}var h=this._groupedRelations;this._autoNavMode&&(h=(e=this._getRelForAutoMode({...this._groupedRelations})).present);let u=v.getPref("_ENORIPE_RecentRelationsSet")||[];return{settings:h,notPresentRelations:i._autoNavMode?e.notPresent:[],title:w.get("SNNavigationMap.Customize.Title"),currentProfile:i.currentProfile,thumbnails2d:"thumbnailsMode"===s.getThumbnailsMode(),recomputeLayout:"recompute"===s.getLayoutMode(),autoNav:i._autoNavMode,lastUsedProfile:t,profileArray:a,recentProfiles:u,lang:s.getLang()}},_getCustomizeRelationsViewRenderOptions:function(){var e={},t={};return this._autoNavMode&&(t=this._getRelForAutoMode({...this._groupedRelations}),e.settings=t.present,e.notPresentRelations=t.notPresent),e},_initCustomizeAllListenEvents:function(){var e=this;e._navigationMap&&(e._customizeAllView.addEvent("ENORIPE_updatePref",e._updatePreferences.bind(e)),e._customizeAllView.addEvent("ENORIPE_updateRelations",e._updateRelations.bind(e)),e._customizeAllView.addEvent("ENORIPE_CreateNewProfile",e._createNewProfile.bind(e)),e._customizeAllView.addEvent("ENORIPE_SaveNewProfile",e._createNewProfile.bind(e)),e._customizeAllView.addEvent("ENORIPE_DeleteProfile",e._deleteProfile.bind(e)),e._customizeAllView.addEvent("ENORIPE_SetRecentRelationSet",e.setRecentRelationSet.bind(e)),e._customizeAllView.addEvent("ENORIPE_SetCustomizeRelationsOptions",e._setCustomizeRelationsOptions.bind(e)),e._customizeAllView.addEvent("ENORIPE_UpdateAttributes",(function(t){var i,n;if(t=e._navigationMap._checkDefaults(t),i=e._navigationMap._isDiffFromDefault(t),n=e._navigationMap._attributesOrderChange(t),i||n){var o=[];if(s.setDefaultAttributes(t),e._navigationMap.listView.updateAttributes(),e._navigationMap.dataGridView&&"dataGridView"===s.getLayoutType())e._navigationMap.dataGridView.updateColumns(t.EnoripeColumns.attributes);else{e._navigationMap.collection.filter((function(e){if("node"===e.get("modelType")){var t=e.get("id");-1===o.indexOf(t)&&o.push(t)}}));for(var a=0;a<o.length;a++)e._navigationMap.updateMapViewAttributesNls(o[a])}v.setPrefEverywhere("_ENORIPE_Type_Attrs",t),i&&e._navigationMap.dispatchEvent("ENORIPE_UpdateAttributes")}})),e._customizeAllView.addEvent("ENORIPE_updateDisplayOptions",(function(t){e._savePreferencesEverywhere("thumbnails2d",s.setThumbnailsMode.bind(s),t.showThumbnails2D),e._savePreferencesEverywhere("showInstances",s.setInstancesMode.bind(s),t.showInstances),e._savePreferencesEverywhere("showPublications",s.setPublicationsMode.bind(s),t.showPublications),e._savePreferencesEverywhere("showGhost",s.setGhostMode.bind(s),t.showGhost),e._savePreferencesEverywhere("layoutMode",s.setLayoutMode.bind(s),t.recumputeLayout),e._savePreferencesEverywhere("activateOptimizedIndexNavigation",s.setActivateOptimizedIndexNavigation.bind(s),t.activateOptimizedIndexNavigation),void 0!==t.showPublications||void 0!==t.showGhost||void 0!==t.activateOptimizedIndexNavigation?(e._onRefresh({initWithNodes:e._navigatedNodes,needClear:!0}),void 0!==t.showPublications&&"undefined"!==e._navigationMap.listView&&e._navigationMap.listView.updatePublicationsMode(t.showPublications)):(void 0!==t.showThumbnails2D&&"linearGraph"===s.getLayoutType()&&e._navigationMap.switchThumbnailsMode(s.getThumbnailsMode()),void 0!==t.showInstances&&e._navigationMap.toggleListInstances(t.showInstances),void 0!==t.recumputeLayout&&!0===t.recumputeLayout&&"linearGraph"===s.getLayoutType()&&(e.collection._setColumnOnNodes(),e._navigationMap.mapView.render(e.collection.getLinksAndNodes(),e.collection.groupBy("columnID"))))})))},_updateRelations:function(e){this._autoNavMode=!(!e||"AutoModeProfile"!==e);for(var t=0;t<this._activeProfiles.length;t++)if(this._activeProfiles[t].name===e){this.currentProfile=e,this._availableRelations=this._activeProfiles[t].relations,this._splitRelations(this._activeProfiles[t].relations);var i=this._groupedRelations;i=this._sortGroupedRel(i),this._customizeAllView&&this._customizeAllView.showRelations(i);break}},updateRelationsDisplayedCustomize:function(e){var t={};for(var i in this._groupedRelations)for(var n=0;n<this._groupedRelations[i].length;n++)for(var s=0;s<e.length;s++)this._groupedRelations[i][n].id.contains(e[s])&&(t[i]=this._groupedRelations[i]);this._customizeAllView.updateRelationsDisplayed({...this._groupedRelations},t)},_getInfosForObjects:function(e,t,i){this._initMapView(!1),t?(this.collection.reset(),this.collection.updateColumnId=!0,this._fetchData(e,i)):this._setPreferences().then((()=>{this.collection.updateColumnId=!0,this._fetchData(e,i)})).catch((e=>{console.error("Error setting preferences or processing data:",e)}))},_fetchData:function(e,t){var i=Object.keys(e),n=m.getRefInstIdsFromNavigatedNodes(e);if(1===i.length){var s={ids:n,type:"AllTypes"};Object.values(e)[0].serviceId&&"3DSpace"!=Object.values(e)[0].serviceId?this.collection.fedSearch(Object.values(e)):this.collection.fetchV2(s)}else{let i={},n={};[i,n]=m.splitItemsByServiceId(Object.values(e)),0===i.length?this.collection.fedSearch(Object.values(e)):this.collection.getEcoSystem({items:Object.values(e),restrictedMode:!0}).then(function(){let i=this.collection.getNodesIds();if(i.length>0){let n=Object.keys(e).filter((e=>i.indexOf(e)>-1)).reduce(((t,i)=>Object.assign(t,{[i]:e[i]})),{});this._navigationMap._manageFirstFocusAndAnchor(t),this._navigatedNodes=n,v.setPrefToWidget("ENORIPE_navigatedNodes",this._navigatedNodes)}else this.hideSpinner()}.bind(this))}},_getGrantedUsrGrp:function(){var e=this;return new i((function(t,i){if(s.getOption("user_granted_groups"))t(s.getOption("user_granted_groups"));else{var n={},o=s.get3DSearchUrl()+"/search",a=s.getUserID();n.label="ENORIPE_"+a+"_"+Date.now(),n.select_predicate=["ds6w:label"],n.query="[ds6w:type]:GROUP AND "+a,n.tenant=s.getCurrentTenantName(),n.nresults=100,n.with_synthesis_attribute=!1,n.with_synthesis=!1,n=JSON.stringify(n),b.authenticatedRequest(o,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:n,onComplete:function(i){var n=e._parseUserGroups(JSON.parse(i));s.setOption("user_granted_groups",n),t(n)},onFailure:function(e){console.log("failed in fetching granted usrgrps"+e),t([])},onTimeout:function(e){console.log("failed in fetching granted usrgrps"+e),t([])}})}}))},_processSynchroData:function(e,t){var i,n=[],s=[],o=[],a=[],r={},l={},c=[],d={excluded:!0,tags:[]};if(!e.forColorize)for(var h in e.allfilters)if(e.allfilters.hasOwnProperty(h)){for(var u=0;u<e.allfilters[h].length;u++)if(!e.allfilters[h][u].excluded){d.excluded=!1;break}for(u=0;u<e.allfilters[h].length;u++)("NotSynchronized"===e.allfilters[h][u].object||"Synchronized"===e.allfilters[h][u].object||"Unknown"===e.allfilters[h][u].object&&!e.allfilters[h][u].excluded==!d.excluded)&&d.tags.push(e.allfilters[h][u].object)}t.outputlist&&t.outputlist.primitives&&(s=t.outputlist.primitives);for(var g=0;g<s.length;g++)"notuptodate"===s[g].stampvalue?n.push(s[g].parentRelationId):"unknown"===s[g].stampvalue?a.push(s[g].parentRelationId):"uptodate"===s[g].stampvalue&&o.push(s[g].parentRelationId);for(g=0;g<s.length;g++)o.indexOf(s[g].parentRelationId)>-1&&(-1!==n.indexOf(s[g].parentRelationId)||-1!==a.indexOf(s[g].parentRelationId))&&(i=o.indexOf(s[g].parentRelationId),o.splice(i,1)),n.indexOf(s[g].parentRelationId)>-1&&-1!==a.indexOf(s[g].parentRelationId)&&(i=n.indexOf(s[g].parentRelationId),n.splice(i,1));if(e.forColorize)return e.Synchronized=o,e.NotSynchronized=n,e.Unknown=a,e;e.filteredLinks=[];for(u=0;u<d.tags.length;u++)d.excluded?this.collection.filter((function(t){"link"===t.get("modelType")&&("Synchronized"===d.tags[u]&&o.indexOf(t.id)<0&&e.filteredLinks.push(t.id),"NotSynchronized"===d.tags[u]&&n.indexOf(t.id)<0&&e.filteredLinks.push(t.id),"Unknown"===d.tags[u]&&a.indexOf(t.id)<0&&e.filteredLinks.push(t.id))})):"Synchronized"===d.tags[u]?e.filteredLinks=e.filteredLinks.concat(o):"NotSynchronized"===d.tags[u]?e.filteredLinks=e.filteredLinks.concat(n):"Unknown"===d.tags[u]&&(e.filteredLinks=e.filteredLinks.concat(a));return this.collection.filter((function(t){if("link"===t.get("modelType")&&e.filteredLinks.indexOf(t.id)>-1){if(r=t.get("source"),l=t.get("target"),r.id&&c.indexOf(r.id)<0&&(c.push(r.id),r.instancesExpanded>0&&r.instances))for(var i=0;i<r.instances.length;i++)c.push(r.instances[i].id);if(l.id&&c.indexOf(l.id)<0&&(c.push(l.id),l.instancesExpanded>0&&l.instances))for(i=0;i<l.instances.length;i++)c.push(l.instances[i].id)}})),e.matchingIDs&&(e.matchingIDs=c.filter((function(t){return e.matchingIDs.indexOf(t)>-1}))),e},_parseRelations:function(e){if(e){var t=this,n="AutoModeProfile",o=e.profiles[0],a=this._getValuesForProfile();this.autoModeProfile&&e.profiles.unshift(this.autoModeProfile);var r=v.getPref("_ENORIPE_CustomRelationsSet");if(r)for(var l=0;l<r.length;l++)e.profiles.splice(l+1,0,r[l]);n=null!==a&&""!==a&&void 0!==a?a:this._settings.relation_apps.ENORIPE_AP,this.currentProfile=e.profiles[0].name,this._activeProfiles=e.profiles,s.getOption("noautomode")&&(n=e.profiles[1].name,this.currentProfile=e.profiles[1].name,this._autoNavMode=!1);for(var c=0;c<e.profiles.length;c++)if(n===e.profiles[c].name){o=e.profiles[c],this.currentProfile=e.profiles[c].name;break}return"AutoModeProfile"===this.currentProfile?this._autoNavMode=!0:this._autoNavMode=!1,this._savePreferencesLocally("LastUsedProfile",s.setLastUsedProfile.bind(s),this.currentProfile),new i((function(e,i){o?(t._availableRelations=o.relations,t._splitRelations(o.relations),t._setAvailableRelation(t._currentRelations),e()):i()}))}},_parsePatterns:function(e){if(e){var t=JSON.parse(e);this.autoModeProfile={name:"AutoModeProfile"},this.autoModeProfile.relations=t.patterns?t.patterns:[];for(var n=this.autoModeProfile.relations.length;n--;)this.autoModeProfile.relations[n].name.contains("v6_structure_roots")&&this.autoModeProfile.relations.splice(n,1);return new i((function(e,t){e()}))}},_mergeSettings:function(e){if(e&&e[1]&&e[2]){this._parsePatterns(e[1]);var t=JSON.parse(e[2]),n=s.getRoles(),o=this,a=!1;return o._settings=e[0],new i((function(e,i){o._settings.relation_sets||e(t),0===Object.keys(o._settings.relation_sets).length&&e(t);t.profiles.map((function(e){return e.name}));for(var s=0;s<o._settings.relation_sets.length;s++){for(var r=o._settings.relation_sets[s].roles,l=o._settings.relation_sets[s].userGroups,c=!1,d=0;d<r.length;d++)if(n.indexOf(r[d])>-1){c=!0;break}if(l.length>0&&!c){a=!0;break}}a?o._getGrantedUsrGrp().then((function(i){t=o._filterRelSets(t,i),e(t)})):(t=o._filterRelSets(t,[]),e(t))}))}},_filterRelSets:function(e,t){var i=s.getRoles(),n=this._getValuesForProfile(),o=e.profiles.map((function(e){return e.name}));if(t=t.map((function(e){return e.resourceid})),-1!==o.indexOf(n)){let t=o.indexOf(n);if(t>-1&&e.profiles[t].applications&&e.profiles[t].applications.length>0){e.profiles[t].applications.map((function(e){return e.name})).indexOf(s.getAppId())<0&&(e.profiles.splice(t,1),this._savePreferencesLocally("LastUsedProfile",s.setLastUsedProfile.bind(s),"AutoModeProfile"))}}return this._filterRelationSets(e,t,i)},_filterRelationSets:function(e,t,i){for(var n=0;n<this._settings.relation_sets.length;n++){var s=this._settings.relation_sets[n],o=this._isAuthorized(s,i,t),a=e.profiles.findIndex((function(e){return e.name===s.name}));if(o){-1===a?e.profiles.push(s):e.profiles.splice(a,1,s);var r=[...e.profiles];this._manageApplications(r,s),e.profiles=r}else-1!==a&&e.profiles.splice(a,1)}return e},_isAuthorized:function(e,t,i){var n=e.roles,s=e.userGroups;n&&n.length>0&&(n=n.map((function(e){return e.name}))),s&&s.length>0&&(s=s.map((function(e){return e.name})));for(var o=0;o<n.length;o++)if(t.indexOf(n[o])>-1)return!0;for(o=0;o<s.length;o++)if(i.indexOf(s[o])>-1)return!0;return!1},_manageApplications:function(e,t){if(t.applications&&t.applications.length>0&&t.applications.map((function(e){return e.name})).indexOf(s.getAppId())<0){var i=e.findIndex((function(e){return e.name===t.name}));-1!==i&&e.splice(i,1)}},_parseEcosystem:function(e){var t={};if(e)for(var i in t=e.objectsByPatterns)t[w.get(i)]=t[i],delete t[i];return t},_parseUserGroups:function(e){var t=[];if(e.results)for(var i=0;i<e.results.length;i++){var n=e.results[i];if(n.attributes){for(var s={},o=0;o<n.attributes.length;o++)"resourceid"===n.attributes[o].name&&(s.resourceid=n.attributes[o].value),"ds6w:label"===n.attributes[o].name&&(s.label=n.attributes[o].value);void 0!==s.resourceid&&t.push(s)}}return t},_saveValuesInSession:function(e,t){this._isWebInWin?localStorage.setItem(e,t):this._widget&&(this._widget.setValue(e,t),localStorage.setItem(e,t)),s.setOption(e,t)},_getValuesInSession:function(e){var t;!this._isWebInWin&&(!!this._widgetId&&this._widgetId.contains("preview"));if(this._widget&&(t=this._widget.getValue(e)),t&&this._widget||(t=localStorage.getItem(e)),t)return t},_saveTempPreferences:function(e,t){e&&t&&(this._tempPreferences[e]=t)},_getTempPreferences:function(e){if(this._tempPreferences){var t=this._tempPreferences[e];if(t)return t}},_savePreferencesLocally:function(e,t,i){void 0===i&&(i=v.getPref(e)),""===i||void 0===i?i=s.getOption(e):t(i),v.setPrefLocally(e,i)},_savePreferencesEverywhere:function(e,t,i){void 0===i&&(i=v.getPref(e)),""===i||void 0===i?i=s.getOption(e):t(i),v.setPrefEverywhere(e,i)},_savePreferencesToLocalStorage:function(e,t,i){void 0===i&&(i=v.getPref(e)),""===i||void 0===i?i=s.getOption(e):t(i),v.setPrefToLocalStorage(e,i)},_setRelationSet:function(e){JSON.stringify(e);var t=null,i=v.getPref("_ENORIPE_CustomRelationsSet"),n=!1;if(i){t=i;for(var s=0;s<t.length;s++)e.name===t[s].name&&(t[s].relations=e.relations,n=!0);n||t.push(e)}else(t=[]).push(e);v.setPrefToLocalStorage("_ENORIPE_CustomRelationsSet",t)},setRecentRelationSet:function(e){var t=[],i=null;e.forEach((function(e){i={name:e._options.data.name,type:e._options.data.type,selectable:e._options.data.selectable,isRecent:e._options.data.isRecent,nls:e.getLabel()},e._options.comboBoxSemantics&&(i.comboBoxSemantics=e._options.comboBoxSemantics),e._options.data.nls&&(i.nls=e._options.data.nls),t.push(i)})),v.setPrefToLocalStorage("_ENORIPE_RecentRelationsSet",t)},onSearch:function(e){var t=this;if(this._isHomePageVisible)this._navigationMap&&this._navigationMap._showNotif({level:"error",lvl:"error",msg:w.get("SearchCurrentTabHomepageErr"),container:this._homePage.container});else if(void 0!==this.collection&&null!==this.collection){var i=[];if(this._navigationMap._isPreviewPanelOpen?(i=this._navigationMap.previewView.getFilteredElements("element"),this._navigationMap.previewView._showLoading()):(this.showSpinner(),this.collection.filter((function(e){"node"===e.get("modelType")&&(t._navigationMap._isFiltered?-1!==t._navigationMap._currentlyFilteredNodes.indexOf(e.get("id"))&&i.push(e.get("identifierData")):i.push(e.get("identifierData")))}))),e&&i.length>0){var n={};n.items=i,n.value=e,n.url=s.get3DSearchUrl()+"/search",n.tenantName=s.getCurrentTenantName(),n.locale=s.getLang(),f._searchCall(n).then((function(i){var n=JSON.parse(i);if(n&&void 0!==n.results&&n.infos&&n.infos.nresults>0){var s=t._processSearchResult(n.results);t._navigationMap.filterBySearch(s)}else t._navigationMap.filterBySearch([]);t._navigationMap._searchValue=e,t.hideSpinner(),t._navigationMap.previewView&&t._navigationMap.previewView._hideLoading()}),(function(){t.hideSpinner(),t._navigationMap.previewView&&t._navigationMap.previewView._hideLoading()}))}}},_processSearchResult:function(e){var t=[],i=[];return e.forEach((function(e){if(e.attributes){i=e.attributes;for(var n=0;n<i.length;n++)if("resourceid"===i[n].name){t.push(i[n].value);break}}})),t},onResetSearch:function(){this._navigationMap&&this._navigationMap.clearFilterBySearch()},_updateLastRootID:function(e){this._lastRootID=e,this._navigationMap&&(this._navigationMap._lastRootID=e),s.setRootIds(e),v.setPrefLocally("lastRootNodeID",e)},_updateLayoutType:function(e){e&&(this._savePreferencesEverywhere("layoutType",s.setLayoutType.bind(s),e),this._navigationMap&&(this._navigationMap._currentLayout=e,this._navigationMap._toolBarView&&this._navigationMap._toolBarView.updateLayout()),this.container.className.includes("mode-")?this.container.className=this.container.className.replace(/mode-\w*/,"mode-"+e):this.container.addClassName("mode-"+e))},_updateWidgetHeader:function(){if(!this._isWebInWin&&widget){var e;if(w[this.currentProfile])e=w[this.currentProfile];else for(var t=0;t<this._activeProfiles.length;t++)if(this._activeProfiles[t].name===this.currentProfile){e=this._activeProfiles[t].nlsLabel||w.get(this.currentProfile);break}widget.setTitle(e+" ("+s.getCurrentTenantLabel()+")")}},_changePlatformSL:function(e){s.setCurrentTenant(e),v.getPref("selected_tenant")!==e&&v.setPrefToWidget("selected_tenant",e),this._updateWidgetHeader(),this._navigationMap&&this._navigationMap._showNotif({level:"warning",lvl:"warning",msg:w.get("PlatformChangesTo")+" "+e})},_addRootNode:function(e,t){var i=v.getPref("lastRootNodeID")||[],n=[];if(t)i=e;else for(var s=0;s<e.length;s++)i.indexOf(e[s])<0&&i.push(e[s]),this.collection&&Object.keys(this._navigatedNodes).indexOf(e[s])<0&&this.collection.get(e[s])&&n.push(this.collection.get(e[s]).get("identifierData"));this._updateLastRootID(i),n.length>0&&this._setNavigatedNodes(n,!0)},addToRecents:function(e){var t=[];"string"==typeof e?t.push(e):t=e,this._addRecents(t)},_addRecents:function(e){for(var t=v.getPref("_Recents")||[],i=0;i<e.length;i++){var n=e[i],s=n.id,o=t.findIndex((e=>e.id===s));-1===o||t.splice(o,1),t.push(n),t.length>10&&t.shift()}v.setPrefEverywhere("_Recents",t)},_setNavigatedNodes:function(e,t){t||(this._navigatedNodes={});for(var i=0;i<Object.keys(e).length;i++)Object.keys(this._navigatedNodes).indexOf(Object.keys(e)[i])<0&&(this._navigatedNodes[Object.keys(e)[i]]=Object.values(e)[i]);v.setPrefToWidget("ENORIPE_navigatedNodes",this._navigatedNodes)},_createNewProfile:function(e){if(e){e.name;var t=!1;this._setRelationSet(e),this.currentProfile=e.name;for(var i=this._activeProfiles,n=0;n<i.length;n++)i[n].name===e.name&&(this._activeProfiles[n].relations=e.relations,t=!0);t||this._activeProfiles.splice(1,0,e),this._customizeAllView.relationSetSaved(e)}},_deleteProfile:function(e,t){var i=v.getPref("_ENORIPE_CustomRelationsSet");if(i){for(var n=i,o=0;o<n.length;o++)n[o].name===e&&i.splice(o,1);v.setPrefToLocalStorage("_ENORIPE_CustomRelationsSet",i);for(var a=this._activeProfiles,r=0;r<a.length;r++)a[r].name===e&&this._activeProfiles.splice(r,1);this.currentProfile=t,this._savePreferencesEverywhere("LastUsedProfile",s.setLastUsedProfile.bind(s),t),this._customizeAllView.relationSetDeleted(e)}},_getRelForAutoMode:function(e){var t=[],i={};this.collection&&this.collection.filter((function(e){if("link"===e.get("modelType")){var i=e.get("type");-1===t.indexOf(i)&&t.push(i)}}));var n=this._sortGroupedRel(e),s={};for(var o in e)if(e.hasOwnProperty(o))for(var a=0;a<e[o].length;a++)for(var r=0;r<t.length;r++)if(e[o][a].id.contains(t[r])){e[o][a].present=!0,s[o]=e[o],delete n[o];break}return i.present=s,i.notPresent=n,i},_sortGroupedRel:function(e){if(e){var t={},i=[];for(var n in e)i.push([e[n].nlsLabel,n]);i.sort((function(e,t){var i=e[0].toLowerCase(),n=t[0].toLowerCase();return i<n?-1:i>n?1:0}));for(var s=0;s<i.length;s++){var o=i[s][1];t[o]=e[o]}return t}},_splitRelations:function(e){var i,n,o,a={},r=!1,l={},c="",d="",h={},u=[],g={};e.forEach((function(e){u.push(e.name)})),this._currentRelations=[],void 0!==v.getPref("expandedDirection")&&(g=v.getPref("expandedDirection"));for(var p=0;p<e.length;p++){if(d="",n=e[p].name,d=this.currentProfile+":"+n,c=m.getMainRelName(n),void 0===this._getTempPreferences(d))i=!0;else{var f=this._getTempPreferences(d);"true"===f?f=!0:"false"===f&&(f=!1),i=f}e[p].showdetail&&"done"!==h[c]&&(h[c]="done",r=void 0!==this._getTempPreferences(this.currentProfile+":details_"+c)&&this._getTempPreferences(this.currentProfile+":details_"+c)),(0===Object.keys(g).length||n.endsWith("_from")&&!0===g.upstream||n.endsWith("_to")&&!0===g.downstream)&&(i&&!r?this._currentRelations.push(n):i&&r&&(this._currentRelations=this._currentRelations.concat(e[p].showdetail),this._publications[n]=e[p].showdetail)),r=!1,a={id:n,relationName:w[n],value:i};var _=c+"_to",S=c+"_from";u.indexOf(_)>-1?o=w[_+"_short"]||w[_]:u.indexOf(S)>-1&&(o=w[S+"_short"]||w[S]),t.is(l[c],"array")||(l[c]=[]),a.id.contains("_from")?(!1===g.upstream&&(a.value=!1),l[c].unshift(a)):(!1===g.downstream&&(a.value=!1),l[c].push(a)),l[c].title=w[c+"_short"]||w[c]||w[c+"_to"]||c,l[c].nlsLabel=o||w[c+"_short"]||w[c]||c}s.setOption("currentRelations",this._currentRelations),this._groupedRelations=this._sortGroupedRel(l)},_hideOneDirection:function(e,t){var i="",n=[],s={upstream:!0,downstream:!0};return(s=v.getPref("expandedDirection")?v.getPref("expandedDirection"):s)[e]=!1,v.setPrefLocally("expandedDirection",s),t&&("upstream"===e?i="to":"downstream"===e&&(i="from"),this._currentRelations.forEach((function(e){var t=e.split("_");t[t.length-1]===i&&n.push(e)})),this._updatePreferences(n)),n},_showOneDirection:function(e,t){var i="",n=[...this._currentRelations],s={upstream:!1,downstream:!1};return(s=v.getPref("expandedDirection")?v.getPref("expandedDirection"):s)[e]=!0,v.setPrefLocally("expandedDirection",s),t&&("upstream"===e?i="from":"downstream"===e&&(i="to"),this._availableRelations.forEach((function(e){var t=e.name.split("_");t[t.length-1]===i&&n.indexOf(e.name)<0&&n.push(e.name)})),this._updatePreferences(n)),n},_initExpandedDirection:function(){var e=[];if(void 0!==v.getPref("expandedDirection")){let t=v.getPref("expandedDirection");!1===t.upstream&&(e=this._hideOneDirection("upstream")),!1===t.downstream&&(e=this._hideOneDirection("downstream"))}return e},_getAttrForTypes:function(){var e=s.getDefaultAttributes(),t=[];for(var i in e){if(e.hasOwnProperty(i))e[i].attributes.map((function(e){return e.uri})).forEach((function(e){e&&-1===t.indexOf(e)&&t.push(e)}))}return t},_getExcludedRelations:function(){for(var e=[],t=this.autoModeProfile.relations,i=0;i<t.length;i++)-1===this._currentRelations.indexOf(t[i].name)&&e.push(t[i].name);return e},_getValuesForProfile:function(){var e;!this._isWebInWin&&(!!this._widgetId&&this._widgetId.contains("preview"));if(!(e=v.getPref("LastUsedProfile"))){let t="AutoModeProfile";this._settings&&this._settings.relation_apps&&(t=this._settings.relation_apps.ENORIPE_AP),e=t,this._savePreferencesLocally("LastUsedProfile",s.setLastUsedProfile.bind(s),t)}return e},onEndEditPref:function(){if("catiav5"!==this._addinMode&&"solidworks"!==this._addinMode){var e=v.getPref("selected_tenant"),t=!1,i=widget.getValue("xPref_CREDENTIAL");i!==s.getXPrefCredential()&&(s.setXPrefCredential(i),t=!0),e!==s.getCurrentTenantName()&&(t=!1,this._isEmpty?this._changePlatformSL(e):(this._needToConfirmPlatformChange=!0,this._currentNewTenantValue=e,this._navigationMap?(this._modal||this._setupModal(),this._modal.show()):(this._changePlatformSL(e),this._currentNewTenantValue="",this._initMapView(!0),this._navigationMap&&this._navigationMap._showNotif({level:"warning",lvl:"warning",msg:w.get("PlatformChangesTo")+" "+e}))),this._updateWidgetHeader()),t&&(this._dontRefresh=!0,this._onRefresh({initWithNodes:this._navigatedNodes,needClear:!0}))}else try{let e=JSON.parse(widget.getValue("X3DContentId")).data.items,t=m.getItemsFromSelection(e)||{};this._resetMap(t,!0)}catch(e){console.error(e)}},_dropByMode:function(e,t,i){var n=this.collection||null,s=[],o={},a={},r=[];if(i&&i.length>0){for(var l=0;l<i.length;l++)if(i[l].objectType&&"ENORelationalExplorerFavorite"===i[l].objectType)return void this._handleFavoritesDrop(e,i[l]);if(o=m.checkAndGetItemsFromSelection(i)||{},r=Object.values(o),"extract"===e&&n)s=i.map((function(e){return e.objectId})),t&&s.push(...t),a={items:r,restrictedMode:!0},n.getEcoSystem(a);else if(i&&"replace"===e)this._resetMap(o,!0),this._addRecents(r),this._updateFavoriteTitle(""),this._navigationMap&&(v.setPrefToWidget("favoriteID",null),this._addRootNode(i.map((function(e){return e.objectId}))),this._isFavOpen=!1);else{if(this._isEmpty)return this._resetMap(o,!0),void this._addRootNode(i.map((function(e){return e.objectId})));"addInGraph"===e?this._addInGraph(i.map((function(e){return e.objectId})),o):this._dropAdd(o),this._addRecents(r)}}},_dropAdd:function(e){for(var t=[],i=v.getPref("lastRootNodeID")||[],n=(this.collection,0);n<Object.keys(e).length;n++){if(Object.values(e)[n].envId&&s.getCurrentTenantName()!==Object.values(e)[n].envId)return this._addNewObjectsFromDifferentPlatform=e,this._currentNewTenantValue=Object.values(e)[n],this._modal||this._setupModal(),void this._modal.show();if(i.indexOf(Object.keys(e)[n])<0)t.push(Object.keys(e)[n]);else{let i=this.collection.get(Object.keys(e)[n]);i&&JSON.stringify(i.get("instances"))!=JSON.stringify(Object.values(e)[n].instances)&&t.push(Object.keys(e)[n])}}if(this._addInGraph(t,e),this._isWebInWin){var o=this._navigationMap.getSelectedIds();if(o.length>0){let e="InsertInCSO";u.sendToMapWebInWin(e,o)}}},_addInGraph:function(e,t){var i;i=this.collection.where({modelType:"node",focus:!0}),e.length>0?(this.collection.updateColumnId=!0,this._addRootNode(e),this._fetchData(t,i)):this.hideSpinner()},_updatePreferences:function(e,t,i){var n,o,a,r="",l=[];if(e||(e=this._currentRelations,this._onRefresh({initWithNodes:this._navigatedNodes,newRelations:e})),this._cleanProxy(),this._navigationMap&&this._navigationMap.filter({allfilters:{}}),this._availableRelations.forEach((function(e){l.push(e.name)})),r=v.getPref("LastUsedProfile"),t&&""!=t){this.currentProfile=t;for(var c=0;c<this._activeProfiles.length;c++)if(this._activeProfiles[c].name===this.currentProfile&&r!=this.currentProfile){this._savePreferencesEverywhere("LastUsedProfile",s.setLastUsedProfile.bind(s),this._activeProfiles[c].name),this._navigationMap&&(this._navigationMap.updateProfile(this._activeProfiles[c].name),this._customizeAllView.updateProfile(this.currentProfile)),r=this._activeProfiles[c].name;break}}for(c=0;c<this._availableRelations.length;c++)o=this._availableRelations[c].name,a=this.currentProfile+":"+o,m.getMainRelName(o),n=e.indexOf(o)>-1?"true":"false",this._saveTempPreferences(a,n),this._lastSavedValues[o]=n;for(var d=0;d<this._activeProfiles.length;d++)this._activeProfiles[d].name===this.currentProfile&&(this._availableRelations=this._activeProfiles[d].relations,this._splitRelations(this._activeProfiles[d].relations));this.collection&&this._setAvailableRelation(e),this._currentRelations=e,s.setOption("currentRelations",this._currentRelations),this._autoNavMode&&(this._autoModeChanged=!0);let h={};if(i){let t={};i.rootPhysicalIds.forEach((function(e){"string"!=typeof e&&(t[e.id]=e)})),0===Object.keys(t).length&&(t=i.rootPhysicalIds),t=m.getItemsFromPreviousData(t),h={initWithNodes:t,newRelations:e,isFav:!0,favData:i}}else h={initWithNodes:this._navigatedNodes,newRelations:e};this.checkDirections([...this._currentRelations]),this._onRefresh(h),this._customizeAllView&&this._customizeAllView.showRelations({...this._groupedRelations}),this._updateWidgetHeader()},checkDirections:function(e){var t={upstream:!0,downstream:!0};t=v.getPref("expandedDirection")?v.getPref("expandedDirection"):t,this._checkOneDirection(e,"upstream",t),this._checkOneDirection(e,"downstream",t)},_checkOneDirection:function(e,t,i){var n="";"upstream"===t?n="from":"downstream"===t&&(n="to"),(e=e.filter((function(e){let t=e.split("_");if(t[t.length-1]===n)return!0}))).length>0&&!i[t]?this._showOneDirection(t,!1):0===e.length&&i[t]&&this._hideOneDirection(t,!1)},_setupModal:function(){var e=this,t=this.container;this._navigationMap&&this._navigationMap.container&&(t=this._navigationMap.container),this._modal=new S({className:"site-reset",closable:!1,header:"<h4>"+w.get("PlatformChange")+"</h4>",body:"<p>"+w.get("PlatformChangeMsg")+"</p>",footer:'<button type="button" id="confirm-change" class="btn btn-primary">'+w.get("SNNCustomize_Save")+'</button> <button type="button" id="cancel-change" class="btn btn-default">'+w.get("SNNCustomize_Cancel")+"</button>"}).inject(t),this._modal.getContent().getElements(".btn").forEach((function(t){t.addEvent("click",(function(){e._needToConfirmPlatformChange=!1,e._modal.hide(),"confirm-change"===this.getAttribute("id")?(e.clearMap(),e._changePlatformSL(e._currentNewTenantValue),e._currentNewTenantValue="",e._addNewObjectsFromDifferentPlatform&&(e._resetMap(e._addNewObjectsFromDifferentPlatform),e._addNewObjectsFromDifferentPlatform=void 0)):(v.setPrefToWidget("selected_tenant",s.getCurrentTenantName()),e._currentNewTenantValue="",this.hideSpinner())}))}))},trackProfileUsage:function(e){var t=[],i=e,n=[],s=[];this._settings.relation_sets&&(t=this._settings.relation_sets.map((function(e){return e.name}))),t.indexOf(e)>-1?i="AdminCustomProfile":((n=v.getPref("_ENORIPE_CustomRelationsSet"))&&(s=n.map((function(e){return e.name}))),s.indexOf(e)>-1&&(i="UserCustomProfile")),o.trackUsage("ProfileUsage",i)},showMessageNotIndexed:function(){var e=this,t=w.get("ObjectNotLoaded"),i={};i={level:"error",title:t,subtitle:w.get("ObjectNotIndexed")};let n=s.getXPrefCredential();b.authenticatedRequest(s.get3DSpaceUrl()+"/cvservlet/indexingdate?SecurityContext="+n,{headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:n},method:"POST",data:JSON.stringify({select_service:["FTS"]}),onComplete:function(t){if((t=JSON.parse(t)).FTS&&t.FTS.allvaultsacl){var n=new Date(1e3*t.FTS.allvaultsacl),s=_.formatDateToString(n,{datePrecision:"none",timePrecision:"sec"});i.msg=" "+w.get("LastIndexed")+" "+s}e._navigationMap._showNotif(i)},onFailure:function(t){e._navigationMap._showNotif(i)},onTimeout:function(t){e._navigationMap._showNotif(i)}})},onResize:function(){this._navigationMap&&this._navigationMap.onResize(),this._homePage&&this._homePage.onResize()},_updateFavoriteTitle:function(e){this._navigationMap&&this._navigationMap._toolBarView&&this._navigationMap._toolBarView.updateFavoriteTitle(e)},_resetMap:function(e,t){for(var i="",n=0;n<e.length;n++)""===i?i=e[n].envId:e[n].envId;i&&s.getCurrentTenantName()!==i&&this._changePlatformSL(i),0!==Object.keys(e).length?(this._cleanProxy(),this._addRootNode([],!0),this._onRefresh({initWithNodes:e,needClear:t})):this.hideSpinner()},_onRefreshWebInWin:function(e){var t=e.initWithNodes,i=this;if(t&&"[]"!==t){0===t.indexOf("[")?t=JSON.parse(t):"string"==typeof t&&(t=[t]);const n={};t.forEach((e=>{n[e]=m.getItemFromId(e)})),e.initWithNodes=n,this._updateLastRootID(t),i._isFavorite(t[0]).then((function(n){n?i._openFavorite(t[0]):i._onRefresh(e)}),(function(){i._onRefresh(e)}))}else i._onRefresh(e)},_onRefresh:function(e){if(e.newRelations&&(this._currentRelations=e.newRelations,s.setOption("currentRelations",this._currentRelations),e.needClear=!0),0===Object.keys(e.initWithNodes).length&&Object.keys(this._navigatedNodes).length>0&&(e.initWithNodes=this._navigatedNodes),e.initWithNodes&&Object.keys(e.initWithNodes).length>0)if(this.showSpinner(),!0===e.needClear){var t=this;v.setPrefToWidget("ENORIPE_savedColumnIds",{}),t.clearMap(!0).then((function(){t._setNavigatedNodes(e.initWithNodes),t._initCollection({initWithNodes:e.initWithNodes,objectType:e.objecType||null,needClear:!0,selectedNodes:e.selectedNodes||[]}),e.isFav&&(e.favData.layoutType&&t._updateLayoutType(e.favData.layoutType),t.updateFavTitle(e.favData))}))}else this._refreshCollection({initWithNodes:e.initWithNodes,objectType:e.objecType||null})},clearMap:function(e){return new i(function(t,i){this._cleanProxy(),this._isEmpty=!0,this._navigationMap&&(this._navigationMap._isEmpty=this._isEmpty),this._navigatedNodes=[],v.setPrefToWidget("ENORIPE_navigatedNodes",this._navigatedNodes),widget&&widget.setValue("X3DContentId","{}"),this.collection&&this.collection.reset(),this._updateFavoriteTitle(""),this._navigationMap&&this._navigationMap._toolBarView&&this._navigationMap._toolBarView.disableEditLayoutCommand(),e?g.clear().then(function(){this._setPreferences().then(function(){this._navigationMap&&this._navigationMap.clearMapSuccess(!1),t()}.bind(this),function(){this._navigationMap&&this._navigationMap.clearMapFailure(),i()}.bind(this))}.bind(this),function(){this._navigationMap&&this._navigationMap.clearMapFailure(),i()}.bind(this)):(this._navigationMap&&this._navigationMap.clearMapSuccess(!1),t())}.bind(this))},hideSpinner:function(){this._navigationMap&&this._navigationMap.hideSpinner()},showSpinner:function(){this._navigationMap&&this._navigationMap.showSpinner()}})}));