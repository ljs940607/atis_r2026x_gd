define("DS/ENOCharacteristicsApp/commands/ShowPerfSpecFacet",["UWA/Core","UWA/Class","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/ENOCharacteristicsApp/ENOCharacteristicsApp","DS/XSRCommonComponents/service/CommandsService","DS/ENOCharacteristicsApp/utils/CharacteristicsEvents","DS/XSRCommonComponents/service/XSpecsActionsFactory","DS/XSRCommonComponents/utils/RequestUtil","DS/XSRCommonComponents/utils/Notification","DS/XSRCommonComponents/components/XSpecRouter/XSpecRouteManager","DS/EditPropWidget/facets/Common/FacetsBase","UWA/Controls/Abstract","DS/SpecGridView/model/GridItemModel","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/PlatformAPI/PlatformAPI","i18n!DS/ENOCharacteristicsApp/assets/nls/ENOCharacteristicsApp"],(function(e,t,n,i,o,a,s,r,c,l,d,u,p,m,f,C,g){"use strict";return t.extend(p,u,{_PerformanceSpecView:null,items:[],modal:null,transactionParameters:null,sTenentID:"OnPremise",securityContext:null,myBaseAppURL:null,options:null,_notif_manager:null,init:function(t){var n=this;this.options=t,t=e.extend(t,{isAsynchronous:!1}),this._parent(t),widget.data=widget.data||{},widget.data.isPerfSpecDeployedAsFacet=!0,widget.data.appId||widget.data.appId,n.firstLoad=!0,n.elements.container||(n.elements.container=new e.Element("div",{class:"perfspec-container",styles:{height:"100%"}})),c.set3DSpaceURL().then(n._setCSRFToken.bind(n)).then(n._handlePreferences.bind(n)).then((()=>{n._buildView(t)}))},_buildView:function(e){var t=this,c={};t.modelEvents=new s;var l={modelEvents:t.modelEvents};r.setOptions(l),null===t._notif_manager&&(t._notif_manager=n,i.setNotificationManager(t._notif_manager),i.setStackingPolicy(5),i.setRemoveStackOnFirstTimeoutFlag(!0),i.setFadeOutPolicy(2));var u=t.options.appContext.getSelectedRefId(),p=new m,f=t.buildParentModel(p),C=new d({modelEvents:t.modelEvents});(c={perfSpecAsPlugin:!0,basicModelEvents:t.modelEvents,specRouteManager:C}).specRouteManager.setActiveSpecItem(f),t.initializeWorkUnder(c);l={itemId:u,container:t.elements.container,appCore:c,currentTabKey:t.options.currentTabKey,specModel:f};t.charAppInstance=new o(l),t.charAppInstance.render();var g={modelEvents:t.modelEvents};a.initialize(g)},initializeWorkUnder:function(e){C.subscribe(f.myAuthkey,(function(t){var n=t.change,i={};if(i.id=n.id,i.name=n.name,i.id){e.wucCtxCapSet=!0;let t="pid:"+i.id;e.wucCtxCapValue=t}}))},updateFacet(){var e=this;e.firstLoad?e.firstLoad=!1:(e.charAppInstance.destroy(),this._buildView())},onResize(){},onRefresh(){this.updateFacet()},buildParentModel:function(e){let t=this.options.modelInfo.title,n=this.options.modelInfo.maturity;return e._options={},e._options.title=t,e._options.currentAccess="",e._options.maturity=n,e.isBeyondInWork=()=>"IN_WORK"!=n,e.getMaturityActualName=()=>n,e},_setCSRFToken:function(){return new Promise(((e,t)=>{c.setCSRFToken(),c.setSecurityContext();const n=setInterval((function(){void 0!==c.getSecurityContext()&&(clearInterval(n),e())}),200)}))},_handlePreferences:function(){var e=this;return new Promise(((t,n)=>{var i=widget.hasPreference("Current_security_credentials");c.isCloud()&&e.addPlatformPreference(!0),i&&null!=widget.getValue("Current_security_credentials")?t():c.retrieveSCList({callback:function(e){var n=c.getSecurityContext();if(n){var i=n.substring(5);widget.setValue("Current_security_credentials",i),widget.setValue("SC",i),widget.setValue("pad_security_ctx",i),widget.setValue("xPref_CREDENTIAL",i)}t()}}),c.setSecurityContext(),setTimeout((()=>{widget.getValue("Current_security_credentials")||l.displayNotification({eventID:"error",msg:"Credentials are not selected. Choose credentials from widget preferences."})}),2e3)}))},addPlatformPreference:function(e){let t=c.getTenantList(),n=c.getPlatformId();t.forEach((e=>{console.log(e)})),console.log(n);let i=t.find((e=>e.platformId==n));null==i&&(i=t[0],console.log("Preferred Platform not available, using the first one")),widget.addPreference({name:"x3dPlatformId",defaultValue:n,type:e?"list":"hidden",label:g.label_3DEXPERIENCEPlatform,options:t.map((function(e){return{label:e.displayName,value:e.platformId||e.name}})),onchange:"onPlatformIdChange",disabled:t.length<2})},destroyComponent:function(){this.charAppInstance.destroy()}})}));