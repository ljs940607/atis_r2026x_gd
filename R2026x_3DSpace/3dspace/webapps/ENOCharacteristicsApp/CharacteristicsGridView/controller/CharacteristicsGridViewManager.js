function updateRequirementCell(e,t,i,a){e.keys().forEach((a=>{var n=e.get(a),s=n.getAttributeValue("physicalId"),r=n.getParent().getID();let o=null;t&&t[r]&&(o=t[r][s]);var d=n.getRequirements(),l=n.getRequirementsList();if(d){if(!d.includes(i))if(d.includes("+")){const e=d.split(" + ");let t=e[1];d=e[0]+" + "+(parseInt(t)+1)}else d+=" + 1"}else d||(d=i);n.updateOptions({grid:{requirements:d,requirementsList:l}}),o&&n.updateOptions({grid:{physicalId:o}})}))}function updateTestMethodCell(e,t,i,a,n){e.keys().forEach((s=>{var r=e.get(s),o=r.getAttributeValue("physicalId"),d=r.getParent().getID();let l=null;t&&t[d]&&(l=t[d][o]);var c=r.getTestMethods(),p=r.getTestMethodsLabel(),u=r.getTestMethodsList();if(u&&p&&!p.contains(i)){let e=u.find((e=>e.name==i));e?e.physicalid=a:e={physicalid:a,name:i,title:n},u.push(e)}else(!u||u&&0==u.length)&&(u=[{physicalid:a,name:i,title:n}]);if(u&&u.length>1){let e=u.length;c=u[0].title+" + "+(e-1)}else u&&1==u.length&&(c=n,p=n);r.updateOptions({grid:{testMethods:c,testMethodsList:u,testMethodsLabel:c}}),l&&r.updateOptions({grid:{physicalId:l}})}))}define("DS/ENOCharacteristicsApp/CharacteristicsGridView/controller/CharacteristicsGridViewManager",["UWA/Core","UWA/Class","DS/DataGridView/DataGridView","DS/ENOCharacteristicsApp/model/SpecificationModel","DS/ENOCharacteristicsApp/model/CharacteristicsModel","DS/ENOCharacteristicsApp/CharacteristicsGridView/controller/GridColumn","DS/ENOCharacteristicsApp/utils/CharacteristicsUtils","DS/ENOCharacteristicsApp/utils/CharacteristicsValidation","DS/ENOCharacteristicsApp/utils/Constants","DS/ENOCharacteristicsApp/utils/Notification","DS/XSRCommonComponents/utils/XSRMask","DS/ENOCharacteristicsApp/service/CharacteristicsServiceWrapper","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/TypeUtils","i18n!DS/ENOCharacteristicsApp/assets/nls/ENOCharacteristicsApp"],(function(e,t,i,a,n,s,r,o,d,l,c,p,u,g,m){"use strict";return t.extend({limitValues:{},init:function(e){var t=e;this._parent(t),this.appCore=t.appCore,this.specViewerModelEvents=this.appCore.specViewerModelEvents,this.itemId=t.itemId,this.container=t.container;var i=t.columns;this.modelEvents=t.modelEvents,this.currentTabKey=t.currentTabKey,this.initializeColumns(i),this.model=t.model,this._subscribe()},_subscribe:function(){},initializeColumns:function(e){var t=e;t&&widget.data.appId&&"ENOSPEC_AP"!==widget.data.appId&&(t=e.filter((e=>"menu"!==e.dataIndex)));var i=this.appCore.isSpecificationLimitsDisabled,a=this.appCore.isRoutineReleaseLimitsDisabled,n=[];t&&t.forEach((function(e){"newRoutineLimits"===e.dataIndex&&a||"newSpecificationLimits"===e.dataIndex&&i||n.push(e)})),this.columns=(new s).process.call(this,n)},addColumn:function(e,t){this.grid.addColumnOrGroup(e,t)},setColumns:function(e){this.initializeColumns(e)},setToolBar:function(e){},addChildColumns:function(e,t){},drawGrid:function(e){var t=this;function o(e){let t=e.nodeModel,i=e.isTestMethod?e.testmethodInfo.results:e.requirementInfo.results,a=[];i.forEach((e=>{let t={};e.attributes.forEach((e=>{"ds6w:label"==e.name&&(t.label=e.value,t.title=e.value),"resourceid"==e.name?t.physicalid=e.value:"ds6w:identifier"===e.name&&(t.name=e.value)})),a.push(t)}));let n=[];e.isTestMethod?n=t.getTestMethodsList()?t.getTestMethodsList():[]:e.isRequirement&&(n=t.getRequirementsList()?t.getRequirementsList():[]),n=n.concat(a);let s={};n.forEach((e=>{s.hasOwnProperty(e.physicalid)||(s[e.physicalid]=e)})),n=Object.values(s);let r="";r=n.length>1?`${n[0].title} + ${n.length-1}`:n[0].title;let o="";o=n.length>1?n[0].title?`${n[0].title} + ${n.length-1}`:`${n[0].label} + ${n.length-1}`:n[0].title?n[0].title:n[0].label,e.isTestMethod?(t.setTestMethodsList(n),t.setTestMethods(r),t.setTestMethodsLabel(o),t.updateOptions({grid:{testMethods:r}})):e.isRequirement&&(t.setRequirementsList(n),t.setRequirements(r),t.updateOptions({grid:{requirements:r}}))}function c(e){let t=e.nodeModel,i=[];e.isTestMethod?i=t.getTestMethodsList()?t.getTestMethodsList():[]:e.isRequirement&&(i=t.getRequirementsList()?t.getRequirementsList():[]);let a=[];e.isTestMethod?(a=i.filter((t=>!e.testmethodIds.includes(t.physicalid))),t.setTestMethodsList(a)):e.isRequirement&&(a=i.filter((t=>!e.requirementsIds.includes(t.physicalid))),t.setRequirementsList(a));let n="";n=a.length>1?`${a[0].title} + ${a.length-1}`:1===a.length?a[0].title:"";let s="";s=a.length>1?a[0].title?`${a[0].title} + ${a.length-1}`:`${a[0].label} + ${a.length-1}`:1===a.length?a[0].title?a[0].title:a[0].label:"",e.isTestMethod?(t.setTestMethods(n),t.setTestMethodsLabel(s),t.updateOptions({grid:{testMethods:n}})):e.isRequirement&&(t.setRequirements(n),t.setRequirements(s),t.updateOptions({grid:{requirements:n}}))}!function(){var e={modelEvents:t.modelEvents,appCore:t.appCore};t.grid=new i({columns:t.columns,showModelChangesFlag:!0,showTreeIconsFlag:!1,showRowBorderFlag:!0,treeDocument:t.model,cellSelection:"multiple",rowSelection:"multiple",rowDragEnabledFlag:!0,showNodeKPIColorFlag:!0,rowGroupingEnabledFlag:!1}).inject(t.container),t.grid.onReady((function(){t.grid.getTreeDocument().expandAll()})),t.grid.layout.cellHeight=50,t.addEvents(),t.model.onPostExpand((e=>{e.target;t.model.gridLayout.resetRowHeight()})),t.model.onPostCollapse((e=>{e.target;t.model.gridLayout.resetRowHeight()})),t.service=new p(e);t.grid.getTypeRepresentationFactory().registerTypeTemplates(JSON.stringify({UWAObjectTemplate:{path:"DS/SpecGridView/utils/UWAObjectTemplate",options:{}}}));t.grid.layout.columnHeaderHeight=40,t.model.setLayoutInstance(t.grid.layout);widget.getValue("Current_security_credentials").startsWith("VPLMAdmin.");t.grid.onCustomViewsSave=function(e,i){i=-1==i?0:i,widget.getValue("Current_security_credentials").startsWith("VPLMAdmin.")?(e.forEach((e=>{"DefaultConfiguration"===e.identifier&&(e.label=d.DEFAULT_CONFIGURATION)})),e.forEach((e=>{"DefaultConfiguration"===e.identifier&&(e.label=d.DEFAULT_CONFIGURATION)})),t.service.saveGlobalViewsConfiguredByAdmin(e).then((function(e){var a=e.GlobalViews?JSON.parse(e.GlobalViews):JSON.parse('[{"identifier":"DefaultConfiguration","label":"Default Configuration"}]');a.forEach((e=>{"DefaultConfiguration"===e.identifier&&(e.label=m.label_DefaultConfiguration)})),t.grid.loadCustomViews(a,i)})).catch((function(e){})),widget.setValue("CurrentCustomViewIndex"+t.currentTabKey,i)):(t.grid.loadCustomViews(e,i),widget.setValue("CustomGridViews"+t.currentTabKey,e),widget.setValue("CurrentCustomViewIndex"+t.currentTabKey,i))};var a=widget.getValue("CustomGridViews"+t.currentTabKey),n=widget.getValue("CurrentCustomViewIndex"+t.currentTabKey);let r=[];a&&a.forEach((function(e){e.columnsVisibleFlag&&Object.keys(e.columnsVisibleFlag).forEach((e=>{r.includes(e)||r.push(e)}))})),t.service.getGlobalViewsConfiguredByAdmin(r).then((function(e){var i=e.GlobalViews?JSON.parse(e.GlobalViews):JSON.parse('[{"identifier":"DefaultConfiguration","label":"Default Configuration"}]');if(i.forEach((e=>{"DefaultConfiguration"===e.identifier&&(e.label=m.label_DefaultConfiguration)})),(new s).process.call(t,e.definitions),widget.getValue("Current_security_credentials").startsWith("VPLMAdmin.")){var r=n||0;t.grid.loadCustomViews(i,r),t.addCustomColumnsToGrid(e,i,r)}else{var o=i,d=0;if(a){var l,c=a[n].identifier,p=!1;a.forEach((e=>{e.identifier.startsWith("DefaultConfiguration")||e.identifier.startsWith("XSR_PS_GV_")||o.push(e)}));for(var u=0;u<o.length;u++)o[u].identifier===c&&(p=!0,l=u);d=p?l:0}widget.setValue("CustomGridViews"+t.currentTabKey,o),widget.setValue("CurrentCustomViewIndex"+t.currentTabKey,d),t.addCustomColumnsToGrid(e,o,d),t.grid.loadCustomViews(o,d)}})).catch((function(e){})),t.addUpdateEvents(),t.grid.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify({contextMenu:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"chevron-down",fontIconFamily:1}}},UWAObject:{stdTemplate:"UWAObjectTemplate"}}))}(),t.modelEvents.subscribe({event:"specification-created"},(function(e){let i=t.grid.treeDocument;e.specRowData.enableDefaultExtensions=!0;let n=new a({appCore:t.appCore}).set(e.specRowData);i.prepareUpdate(),i.addChild(n),i.pushUpdate(),i.acceptChanges()})),t.modelEvents.subscribe({event:"characteristic-created"},(function(e){let i=t.grid.treeDocument,a=i.getSelectedNodes()[0];e.specRowData.dimension=e.specRowData.dimension!==d.ARBITRARY_UNIT?r.dimensionIdToObjMap[e.specRowData.dimension]:e.specRowData.dimension,e.specRowData.storageUnit=e.specRowData.dimension!==d.ARBITRARY_UNIT?r.displayUnitIdToObjMap[e.specRowData.displayUnit]:r.getStorageUnitObjForArbitraryUnit(e.specRowData.displayUnit),e.specRowData.enableDefaultExtensions=!0;let s=new n({appCore:t.appCore}).set(e.specRowData);i.prepareUpdate(),a.addChild(s),i.pushUpdate(),i.acceptChanges(),a.expand()})),t.modelEvents.subscribe({event:"sync-specifications"},(function(e){let i=t.grid.treeDocument,n=[],s=[];if(i.getChildren().forEach((e=>{e.isDerivedSpec()&&n.push(e.getPhysicalId())})),!e.engItemId&&0==n.length)return l.clearNotifications(),void l.displayNotification({eventID:"error",msg:m.Err_NoScopeLinkExists});if(i.prepareUpdate(),e.specsList.length>0){let r=t.grid.columns.map((e=>e.dataIndex));e.extensionAttribs.forEach((e=>{r.includes(e.dataIndex)||(e.editableFlag=!1,t.addColumn(e))})),e.specsList.forEach((e=>{if(s.push(e.physicalid),!n.includes(e.physicalid)){e.enableDefaultExtensions=!0;let n=new a({appCore:t.appCore}).set(e);i.addChild(n)}})),i.getChildren().forEach((e=>{!e.isDerivedSpec()||s.includes(e.getPhysicalId())&&"OBSOLETE"!=e.getMaturityActualName()||e.getParent().removeChild(e)}))}else n.length>0&&i.getChildren().forEach((e=>{e.isDerivedSpec()&&e.getParent().removeChild(e)}));i.pushUpdate(),i.acceptChanges(),l.clearNotifications(),l.displayNotification({eventID:"success",msg:m.MfgItemSyncSuccess})})),t.modelEvents.subscribe({event:"dup-characteristic-created"},(function(e){let i=t.grid.treeDocument,a=i.getSelectedNodes()[0].getParent();e.specRowData.forEach((function(e){e.dimension=e.dimension!==d.ARBITRARY_UNIT?r.dimensionIdToObjMap[e.dimension]:e.dimension,e.dimension===d.ARBITRARY_UNIT?e.storageUnit={displayName:e.uom,name:e.uom,id:e.displayUnit}:e.storageUnit=r.displayUnitIdToObjMap[e.displayUnit],e.enableDefaultExtensions=!0;let s=new n({appCore:t.appCore}).set(e);i.prepareUpdate(),a.addChild(s),i.pushUpdate(),i.acceptChanges(),i.getSelectedNodes()[0].unselect(),s.highlight(),a.expand()}))})),t.modelEvents.subscribe({event:"assign-testmethod"},(function(e){let i=t.grid.treeDocument,a=i.getSelectedNodes(),n=e.resp,s=e.tmId,r=e.tmName,o=e.tmTitle,d=n.revisedChars;if(n.assigned){i.prepareUpdate();let e=new Map;a.forEach((t=>{g.isPerformanceCharacteristics(t.getTypeActualName())?e.set(t.getID(),t):t.getChildren().forEach((t=>{e.set(t.getID(),t)}))})),updateTestMethodCell(e,d,r,s,o),i.pushUpdate(),i.acceptChanges()}})),t.modelEvents.subscribe({event:"link-requirement"},(function(e){let i=t.grid.treeDocument,a=i.getSelectedNodes(),n=e.resp,s=e.reqId,r=e.reqName,o=n.revisedChars;if(n.assigned){i.prepareUpdate();let e=new Map;a.forEach((t=>{g.isPerformanceCharacteristics(t.getTypeActualName())?e.set(t.getID(),t):t.getChildren().forEach((t=>{e.set(t.getID(),t)}))})),updateRequirementCell(e,o,r,s),i.pushUpdate(),i.acceptChanges()}})),t.specViewerModelEvents.subscribe({event:"TestMethodFacet-to-PerfSpec-commute-add-node-success"},(function(e){e.isTestMethod=!0,o(e)})),t.specViewerModelEvents.subscribe({event:"requirement-facet-add-node-success"},(function(e){e.isRequirement=!0,o(e)})),t.specViewerModelEvents.subscribe({event:"TestMethodFacet-to-PerfSpec-commute-remove-node-success"},(function(e){e.isTestMethod=!0,c(e)})),t.specViewerModelEvents.subscribe({event:"requirement-facet-remove-node-success"},(function(e){e.isRequirement=!0,c(e)})),t.modelEvents.subscribe({event:"handle-modified-extensions"},(function(e){let i=t.grid.columns.map((e=>e.dataIndex)),a=t.grid.getTreeDocument().getSelectedNodes()[0];if(e.extToAdd&&Object.keys(e.extToAdd).length>0){let n={interfaces:e.extToAdd,physicalid:e.itemId,type:e.type,specid:e.parentId};t.service.addExtensions(n).then((n=>{Object.keys(e.extAttribsInfo).forEach((n=>{let s=e.extAttribsInfo[n];Object.keys(s).forEach((e=>{let n=s[e],r="";r=n.ranges?Array.isArray(n.value)?n.value.map((e=>n.ranges[e])):n.ranges[n.value]:n.value;let o=e.split(".")[1],d=n.mandatory;o.includes("__")&&(o=o.slice(0,o.indexOf("__"))),n.unitNLSName&&(o=`${o} (${n.unitNLSName})`);let l=e.replace(".","||"),c="Date"!=n.type||n.hasRange?"string":"datetime";"Boolean"!=n.type||n.multiValue||(n.hasRange=!0,n.ranges=[m.boolean_true,m.boolean_false],r=""==r?m.boolean_false:r),i.includes(l)||t.addColumn({dataIndex:l,text:o,typeRepresentation:c,editableFlag:!n.readOnly,getCellSemantics:function(e){if(n.hasRange){var t=e.nodeModel;if(t&&t._canBeGrouped()){var i=Object.values(n.ranges);return{possibleValues:()=>i,placeholder:""}}}}}),a.setAttribute(l,r),a.mandatory=d}))})),n.data.revisedCharId&&a.setID(n.data.revisedCharId),l.clearNotifications(),l.displayNotification({eventID:"success",msg:m.extensions_modify_success})})).catch((function(e){l.clearNotifications(),l.displayNotification({eventID:"error",msg:m.extensions_modify_failure})}))}if(e.extToRemove&&Object.keys(e.extToRemove).length>0){let n={interfaces:e.extToRemove,physicalid:e.itemId,type:e.type,specid:e.parentId};t.service.removeExtensions(n).then((t=>{e.extToRemove.forEach((e=>{i.filter((t=>t.startsWith(e))).forEach((e=>{a.removeAttribute(e)}))})),t.data.revisedCharId&&a.setID(t.data.revisedCharId),l.clearNotifications(),l.displayNotification({eventID:"success",msg:m.extensions_modify_success})})).catch((function(e){l.clearNotifications(),l.displayNotification({eventID:"error",msg:m.extensions_modify_failure})}))}}))},addCustomColumnsToGrid:function(e,t,i){var a=this;if(e.definitions&&e.definitions.length){let n=Object.keys(t[i].columnsVisibleFlag??{}).filter((e=>-1!=e.indexOf("||"))),s=e.definitions.reduce(((e,t)=>(e[t.dataIndex]=t,e)),{});n.forEach((e=>{s[e]&&a.addColumn(s[e])}))}},groupRoots:function(e){this.model.groupRoots(e)},highlightCell:function(e,t){if(e&&t){var i=this.grid.layout.getColumnIndex(t),a=this.grid.layout.getCellIDFromCoordinates({rowID:e,columnID:i});a&&this.grid.selectCell(a)}},exportCSV:function(e){var t=this.grid.layout.getVisibleOrderedColumnsIndexes(),i=[];if(t&&t.length>0){this.model.selectAll();for(var a=0;a<t.length;a++){var n=t[a],s=this.grid.layout.getDataIndexFromColumnIndex(n);this.exportableColums.indexOf(s)>=0&&i.push(s)}var r=this.grid.getAsCSV({forceQuotes:!1,allColumns:!1,onlySelectedRows:!(!e||!e.onlySelectedRows)&&e.onlySelectedRows,columnKeys:i,columnSeparator:e&&e.columnSeparator?e.columnSeparator:void 0,addLevelInformation:!0});u.downloadCSV(r,e.fileName),this.model.unselectAll()}},addUpdateEvents:function(){var e=this;e.modelEvents.subscribe({event:d.EVENT_SAVE_CHAR},(function(t){var i=f(t.newValue),a=t.oldValue,n=t.nodeModel,s=!1;let o=t.nodeModel.mandatory;null==o?s=t.nodeModel.getAttributeValue("mandatory"):"YES"===o.toUpperCase()&&(s=!0);t.rowID;if(e.cellId=t.cellId,n){if(r.allTypeList.includes(n.getTypeActualName())){if((p={}).title=f(n.getTitle()),p.description=f(n.getDescription()),p.notes=f(n.getNotes()),p.category=n.getCategory(),p.physicalid=n.getPhysicalId(),p.parentPhysicalid=e.itemId,t.dataIndex.contains("||")){p.customerAttributes={};let e=t.dataIndex.split("||"),n=e[0],r=e[1],o=t.nodeModel.getAttributeValue(t.dataIndex+"_type");if(1==s&&(""==i||null==i))return t.nodeModel.setAttribute(t.dataIndex,a),void l.displayNotification({eventID:"error",msg:m.mandatory_extensions_failure});"integer"!==o||isNaN(i)||t.nodeModel.setAttribute(t.dataIndex,parseInt(i)),p.customerAttributes[n]={[r]:i}}[].push(p),e.grid.unselectAll(),t.nodeModel.select(),e.service.updateSpecificationData(p,e.itemId,n.getPhysicalId()).then((function(t){JSON.parse(t)&&(n.syncModel(p),n.acceptChanges(),l.displayNotification({eventID:"success",msg:m.Perf_Spec_Updated}),c.unmaskLoader(e.container)),Object.keys(e.limitValues).length>0&&e.isLimitColumn&&e.deleteLimitValues()})).catch((function(t){if(c.unmaskLoader(e.container),console.log(t),n.cancelChanges(),(i=JSON.parse(t)).errorMessage)var i=m.replace(m.get(m.Failure_Update),{errorMsg:i.errorMessage});Object.keys(e.limitValues).length>0&&e.isLimitColumn&&e.deleteLimitValues(),l.displayNotification({eventID:"error",msg:i}),c.unmaskLoader(e.container)}))}else{var p={},u="",g=r.CharLimitsValidation(n);switch(t.dataIndex){case"lowerTarget":if(!i&&n.isLowerTargetIncluded())return n.cancelChanges(),void l.displayNotification({eventID:"error",msg:m.Err_Deactivate_LowerInc});if(!g.isValidated)return n.setLowerTarget(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:g.msg});if(!i.length>0)return n.setLowerTarget(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:m.Err_Cannot_Clear_Value});u="min";break;case"upperTarget":if(!i&&n.isUpperTargetIncluded())return n.cancelChanges(),void l.displayNotification({eventID:"error",msg:m.Err_Deactivate_UpperInc});if(!g.isValidated)return n.setUpperTarget(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:g.msg});if(!i.length>0)return n.setUpperTarget(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:m.Err_Cannot_Clear_Value});u="max";break;case"displayTarget":if(!g.isValidated)return n.setDisplayTarget(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:g.msg});if(!i.length>0)return n.setDisplayTarget(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:m.Err_Cannot_Clear_Value});u="target";break;case"lowerRoutineReleaseLimit":if(!g.isValidated)return n.setLowerRoutineReleaseLimit(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:g.msg});if(!i.length>0)return n.setLowerRoutineReleaseLimit(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:m.Err_Cannot_Clear_Value});u="lowerRoutineReleaseLimit";break;case"upperRoutineReleaseLimit":if(!g.isValidated)return n.setUpperRoutineReleaseLimit(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:g.msg});if(!i.length>0)return n.setUpperRoutineReleaseLimit(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:m.Err_Cannot_Clear_Value});u="upperRoutineReleaseLimit";break;case"lowerSpecificationLimit":if(!g.isValidated)return n.setLowerSpecificationLimit(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:g.msg});if(!i.length>0)return n.setLowerSpecificationLimit(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:m.Err_Cannot_Clear_Value});u="lowerSpecificationLimit";break;case"upperSpecificationLimit":if(!g.isValidated)return n.setUpperSpecificationLimit(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:g.msg});if(!i.length>0)return n.setUpperSpecificationLimit(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:m.Err_Cannot_Clear_Value});u="upperSpecificationLimit";break;case"title":u="title";break;case"description":u="description";break;case"notes":u="notes";break;case"displayUnit":u="storageUnit";break;case"dimension":u="dimension";break;case"charPrecision":if(u="precision",!i)return n.setCharPrecision(a),void n.acceptChanges();break;case"priority":if(!i)return n.setPriority(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:m.info_clearPriority});if(isNaN(i)||i.contains(".")&&i.lastIndexOf(".")+1===i.length||parseInt(i)<0||i.contains("-0"))return n.setPriority(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:m.Err_Priority});if(5<i.length)return n.setPriority(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:m.err_priorityLength});u="priority";break;case"missedTargetAction":if(!i)return n.cancelChanges(),void l.displayNotification({eventID:"error",msg:m.Err_MissedTargetAction});u="missedTargetAction";break;case"displayLowerTargetIncluded":if(u="isMinIncluded",i&&!n.getLowerTarget())return n.setUpperTargetIncluded(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:m.updateMin});if(!(i||parseFloat(n.getLowerTarget())!==parseFloat(n.getDisplayTarget())&&parseFloat(n.getLowerTarget())!==parseFloat(n.getUpperTarget())))return n.setLowerTargetIncluded(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:m.LowerIncCannotDeactivate});if(!g.isValidated)return n.setLowerTargetIncluded(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:g.msg});u="isMinIncluded";break;case"displayUpperTargetIncluded":if(u="isMaxIncluded",i&&!n.getUpperTarget())return n.setUpperTargetIncluded(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:m.updateMax});if(!(i||parseFloat(n.getUpperTarget())!==parseFloat(n.getDisplayTarget())&&parseFloat(n.getUpperTarget())!==parseFloat(n.getLowerTarget())))return n.setUpperTargetIncluded(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:m.UpperIncCannotDeactivate});if(!g.isValidated)return n.setUpperTargetIncluded(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:g.msg});u="isMaxIncluded";break;case"displayLowerRoutineIncluded":if(u="isLowerRoutineReleaseLimitIncluded",i&&!n.getLowerRoutineReleaseLimit())return n.setLowerRoutineIncluded(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:m.updateLowerRoutine});if(!(i||parseFloat(n.getLowerRoutineReleaseLimit())!==parseFloat(n.getDisplayTarget())&&parseFloat(n.getLowerRoutineReleaseLimit())!==parseFloat(n.getUpperRoutineReleaseLimit())))return n.setLowerRoutineIncluded(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:m.LowerRoutineIncCannotDeactivate});if(!g.isValidated)return n.setLowerRoutineIncluded(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:g.msg});u="isLowerRoutineReleaseLimitIncluded";break;case"displayUpperRoutineIncluded":if(u="isUpperRoutineReleaseLimitIncluded",i&&!n.getUpperRoutineReleaseLimit())return n.setUpperRoutineIncluded(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:m.updateUpperRoutine});if(!(i||parseFloat(n.getUpperRoutineReleaseLimit())!==parseFloat(n.getDisplayTarget())&&parseFloat(n.getUpperRoutineReleaseLimit())!==parseFloat(n.getLowerRoutineReleaseLimit())))return n.setUpperRoutineIncluded(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:m.UpperRoutineIncCannotDeactivate});if(!g.isValidated)return n.setUpperRoutineIncluded(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:g.msg});u="isUpperRoutineReleaseLimitIncluded";break;case"displayLowerSpecificationIncluded":if(u="isLowerSpecificationLimitIncluded",i&&!n.getLowerSpecificationLimit())return n.setLowerSpecificationIncluded(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:m.updateLowerSpecification});if(!(i||parseFloat(n.getLowerSpecificationLimit())!==parseFloat(n.getDisplayTarget())&&parseFloat(n.getLowerSpecificationLimit())!==parseFloat(n.getUpperSpecificationLimit())))return n.setLowerSpecificationIncluded(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:m.LowerSpecificationIncCannotDeactivate});if(!g.isValidated)return n.setLowerSpecificationIncluded(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:g.msg});u="isLowerSpecificationLimitIncluded";break;case"displayUpperSpecificationIncluded":if(u="isUpperSpecificationLimitIncluded",i&&!n.getUpperSpecificationLimit())return n.setUpperSpecificationIncluded(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:m.updateUpperSpecification});if(!(i||parseFloat(n.getUpperSpecificationLimit())!==parseFloat(n.getDisplayTarget())&&parseFloat(n.getUpperSpecificationLimit())!==parseFloat(n.getLowerSpecificationLimit())))return n.setUpperSpecificationIncluded(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:m.UpperSpecificationIncCannotDeactivate});if(!g.isValidated)return n.setUpperSpecificationIncluded(a),n.acceptChanges(),void l.displayNotification({eventID:"error",msg:g.msg});u="isUpperSpecificationLimitIncluded";break;case"newAcceptanceLimits":u="target"}if("storageUnit"==u){let e=n.getDimensionId();e===d.ARBITRARY_UNIT?p[u]=r.getArbitraryUnitURIByName(i):p[u]=r.dimensionId_uomValue_To_uomId[e+":"+i]?r.dimensionId_uomValue_To_uomId[e+":"+i]:i}else if("priority"==u)p[u]=parseInt(i);else if("missedTargetAction"==u)p[u]=r.missedTargetActionMap[i];else if(u)p[u]=i;else if(t.dataIndex.contains("||")){p.customerAttributes={};let e=t.dataIndex.split("||"),n=e[0],r=e[1],o=t.nodeModel.getAttributeValue(t.dataIndex+"_type");if(1==s&&(""==i||null==i))return t.nodeModel.setAttribute(t.dataIndex,a),void l.displayNotification({eventID:"error",msg:m.mandatory_extensions_failure});"integer"!==o||isNaN(i)||t.nodeModel.setAttribute(t.dataIndex,parseInt(i)),p.customerAttributes[n]={[r]:i}}p.type=n.getTypeActualName(),e.grid.unselectAll(),t.nodeModel.select(),e.service.updateCharacteristicsData(p,n.getParent().getPhysicalId(),n.getPhysicalId()).then((function(t){var i=JSON.parse(t);i&&(i.data.additionalAttributes&&(p.customerAttributes=i.data.additionalAttributes),n.syncModel(p),i.data.revisionid&&""!==i.data.revisionid&&n.setPhysicalId(i.data.revisionid),n.acceptChanges(),l.displayNotification({eventID:"success",msg:m.Perf_Char_Updated}),i.data.message&&""!==i.data.message&&l.displayNotification({eventID:"info",msg:i.data.message}),c.unmaskLoader(e.container)),Object.keys(e.limitValues).length>0&&e.isLimitColumn&&e.deleteLimitValues()})).catch((function(t){if(c.unmaskLoader(e.container),console.log(t),n.cancelChanges(),(i=JSON.parse(t)).errorMessage)var i=m.replace(m.get(m.Failure_Update),{errorMsg:i.errorMessage});Object.keys(e.limitValues).length>0&&e.isLimitColumn&&e.deleteLimitValues(),l.displayNotification({eventID:"error",msg:i}),c.unmaskLoader(e.container)}))}}function f(e){return null==e?"":"boolean"==typeof e||"number"==typeof e?e:e.length&&e.length>5e3?(l.clearNotifications(),l.displayNotification({eventID:"warning",msg:m.Warning_Max_Char_Length}),e.substring(0,5e3)):e}}))},addEvents:function(){var t=this;t.grid.getCellsXSO().onPostAdd((function(i){if(i&&e.is(i,"array")&&1==i.length){t.grid.unselectAll(),!i[0].nodeModel._canBeGrouped()?setTimeout((function(){i[0].nodeModel.select()}),50):i[0].nodeModel.select()}})),t.grid.addEventListener("dragstart",(function(e,t){t.nodeModel&&(u.dragStartedInXSR=!0)})),t.grid.addEventListener("dragend",(function(e,i){i.nodeModel&&(u.dragStartedInXSR=!1);var a={modelEvents:t.modelEvents,appCore:t.appCore};t.service=new p(a);var n=i.nodeModel._parentNode.getChildren(),s=i.nodeModel._parentNode.getTreeDocument().getSelectedNodes()[0].getPhysicalId();i.nodeModel._parentNode.getTreeDocument().getSelectedNodes()[0].getTitle();for(let e=0;e<n.length;e++){var r={};r.sequenceNumber=e+1,r.characteristicsid=s,r.title=n[e].options.grid.title,s==n[e].getPhysicalId()&&t.service.reorderchar(r,i.nodeModel.getParent().getID(),s).catch((function(e){l.displayNotification({eventID:"error",msg:m.Error_NoAccess_Resequence})}))}}));var i=function(e){var i=t.grid.layout.getDataIndexFromColumnIndex(e.columnID),a=(t.grid.getColumnOrGroup(e.columnID).text,t.grid.getColumnOrGroup(e.columnID)._parent,t.grid.getColumnOrGroup(e.columnID).rangeNLSActualMap),n=e.cellModel,s=e.nodeModel?e.nodeModel.getReferenceValue(i):void 0;s=s&&Array.isArray(s)?s[0]:s;var r="string"==typeof n?n.trim():n;r instanceof Date?r=u.convertDateToStandard(r):Array.isArray(r)&&r[0]instanceof Date?r=r.map((e=>u.convertDateToStandard(e))):a&&(r=Array.isArray(r)?r.map((e=>Object.keys(a).find((t=>a[t]===e)))):Object.keys(a).find((e=>a[e]===r))),r!==s&&t.modelEvents.publish({event:d.EVENT_SAVE_CHAR,data:{nodeModel:e.nodeModel,cellId:e.cellID,newValue:r,oldValue:s,dataIndex:i}})};this.grid.addEventListener("preEdit",(function(e,i){var a=t.grid.layout.getDataIndexFromColumnIndex(i.columnID),n=(o.hasValidationValueFields(a,d.LIMIT_VALUE_FIELDS),t.grid.getTreeDocument()._charRefModels);if(n.length>0)if(i.rowID!==n[0]._rowID)t.removeErrors();else if(i.rowID==n[0]._rowID){var s=n[0]._referenceValues;for(var r in s){var l=o.hasValidationValueFields(r,d.LIMIT_VALUE_FIELDS),c=n[0].isInvalidNo();if(r==a)break;l?l&&!c&&t.removeErrors():t.removeErrors()}}})),this.grid.addEventListener("change",(function(e,a){void 0===a||"boolean"!==t.grid.layout.getColumnTypeRepresentation(a.columnID)&&"UWAObject"!=t.grid.layout.getColumnTypeRepresentation(a.columnID)&&"independantBoolean"!==t.grid.layout.getColumnTypeRepresentation(a.columnID)&&"string"!==t.grid.layout.getColumnTypeRepresentation(a.columnID)&&"textBlock"!==t.grid.layout.getColumnTypeRepresentation(a.columnID)&&"datetime"!==t.grid.layout.getColumnTypeRepresentation(a.columnID)||i(a)})),t.modelEvents.subscribe({event:"update-acceptance-limits"},(function(e){console.log(e),i(e.cellInfos)}))},removeErrors:function(){l.clearNotifications(),this.modelEvents.publish({event:d.EVENT_HIDE_RESET_COMMAND}),this.grid.getTreeDocument().cancelChanges()},hide:function(){this.container.setStyle("display","none")},show:function(){this.container.setStyle("display","block")},personalizeColumns:async function(){var e=this;c.maskLoader(e.container,m.Loading),await e.service.getAllExtensions(e.itemId).then((t=>{c.unmaskLoader(e.container);let i=e.grid.columns.reduce(((e,t)=>(e[t.dataIndex]=t,e))),a=t.filter((e=>null==i[e.dataIndex]));(new s).process.call(e,a),a.forEach((t=>{e.addColumn(t)})),e.loadAppliedExtensionsData(),e.grid.showCustomViewsDialog()}))},loadAppliedExtensionsData:async function(){var e=this;if(e.appCore.defaultExtensionAttributes){e.grid.treeDocument.prepareUpdate();for(const t of e.grid.treeDocument.getAllDescendants().filter((e=>e.options.grid&&(e.options.grid.additionalAttributes||e.options.grid.extensions))))for(const i of e.appCore.defaultExtensionAttributes)if(t.options.grid.additionalAttributes.hasOwnProperty(i.name)){let e=i.extension+"||"+i.name,a=e+"_type",n=t.options.grid.additionalAttributes[i.name],s=i.mandatory;i.rangevalue&&"timestamp"!==i.type?n=Array.isArray(n)?n.map((e=>i.rangevalue[e]||e)):i.rangevalue[n]||n:i.rangevalue&&"timestamp"===i.type&&(n=Array.isArray(n)?n.map((e=>u.formatDate(e)||e)):u.formatDate(n)||n),t.options.grid[e]=n,t.options.grid[a]=i.type,t.options.grid.mandatory=s}else if(t.options.grid.extensions&&t.options.grid.extensions.includes(i.extension)&&i.multiValue){let e=i.extension+"||"+i.name,a=e+"_type",n=[],s=i.mandatory;t.options.grid[e]=n,t.options.grid[a]=i.type,t.options.grid.mandatory=s}else if(t.options.grid.extensions&&t.options.grid.extensions.includes(i.extension)&&!i.multiValue){let e=i.extension+"||"+i.name,a=e+"_type",n=i.defaultValue,s=i.mandatory;t.options.grid[e]=n,t.options.grid[a]=i.type,t.options.grid.mandatory=s}e.grid.treeDocument.pushUpdate(),e.grid.treeDocument.acceptChanges()}},deleteLimitValues:function(){for(var e in this.limitValues)delete this.limitValues[e]},destroy:function(){for(var e in l.clearNotifications(),this.limitValues)delete this.limitValues[e];this.eventList&&this.eventList.length>0&&this.modelEvents.unsubscribeList(this.eventList)}})}));