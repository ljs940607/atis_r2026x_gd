define("DS/ENOCharacteristicsApp/CharacteristicsGridView/controller/CharGridToolBar",["UWA/Class","DS/Menu/Menu","DS/ENOXCollectionToolBar/js/ENOXCollectionToolBar","DS/ENOCharacteristicsApp/utils/CharacteristicsEvents","DS/ENOCharacteristicsApp/utils/Constants","DS/ENOCharacteristicsApp/utils/CharacteristicsMask","DS/ENOCharacteristicsApp/utils/CharacteristicsUtils","DS/XSRCommonComponents/utils/TypeUtils","DS/Controls/TooltipModel","i18n!DS/ENOCharacteristicsApp/assets/nls/ENOCharacteristicsApp"],(function(e,t,i,n,a,l,s,o,r,c){"use strict";return e.extend({init:function(e){this.modelEvents=e.modelEvents,this.target=e.target,this.container=e.container,this.toolBarEvents=new n,this.hiddenCmds=[],this.appCore=e.appCore,this._subscribeEvents(),this.appCore.wrap_enabled=!1},draw:function(e){e&&(this.target=e);var t={modelEvents:this.toolBarEvents,withmultisel:!0,showItemCount:!0,actions:this.actionCommands,multiselActions:null,multiselActionCallback:!1,filter:{multiselect:!1,enableCache:!1},sort:[],views:[],currentView:""};this.collectionToolbar=new i(t),this.collectionToolbar.inject(e);let n=[],a=[],l=document.querySelectorAll("li#enox-collection-toolbar-search-id"),s=document.querySelectorAll("li#add"),o=document.querySelectorAll("li#DeleteCharacteristics"),c=document.querySelectorAll("li#Export"),u=document.querySelectorAll("li#VersionExplorer"),d=document.querySelectorAll("li#MaturityGraph"),h=document.querySelectorAll("li#AddExtensions"),p=document.querySelectorAll("li#DuplicateCharacteristics"),m=document.querySelectorAll("li#AssignTestMethod"),C=document.querySelectorAll("li#LinkRequirement"),f=document.querySelectorAll("li#expandAll"),g=document.querySelectorAll("li#collapseAll"),E=document.querySelectorAll("li#Personalize"),A=document.querySelectorAll("li#Wraptext"),b=document.querySelectorAll("li#Unwraptext");n.push(l),n.push(s),n.push(o),n.push(c),n.push(u),n.push(d),n.push(h),n.push(p),n.push(m),n.push(C),n.push(f),n.push(g),n.push(E),n.push(A),n.push(b),a.push("help-rc-searchtab"),a.push("help-rc-addperf"),a.push("help-rc-deletehdr"),a.push("help-rc-exportcmdtab"),a.push("help-rc-revisionhdr"),a.push("help-rc-maturitystatehdr"),a.push("help-rc-addextensioncmdtab"),a.push("help-rc-duplicatecharacmdtab"),a.push("help-rc-testmethodcmdtab"),a.push("help-rc-linkrequirmentcmdtab"),a.push("help-rc-expandallcmdtab"),a.push("help-rc-collapseallcmdtab"),a.push("help-rc-customviewcmdtab"),a.push("help-rc-wrapmdtab"),a.push("help-rc-unwrapmdtab");for(let e=0;e<n.length;e++){let t=n[e][0]?.querySelector("span")??void 0;t&&(t.tooltipInfos=new r({allowUnsafeHTMLShortHelp:!1,allowUnsafeHTMLLongHelp:!0,mouseRelativePosition:!1}),t.tooltipInfos.loadFromHelpRscFile("ENOSpecManagementApp/help",a[e]))}this.hideResetCommand(),this.hideCommand("Unwraptext"),this.hideCommand("expandAll")},_subscribeEvents:function(){var e=this;this.subscriptionList=[],this.subscriptionList.push(this.modelEvents.subscribe({event:a.UPDATE_CHARVIEW_TOOLBOOR_COUNT},(function(t){var i=e.currentModel?e.currentModel.getSelectedNodes().length:0;i>0?e.toolBarEvents.publish({event:a.COLLECTION_TOOLBAR_CHECKBOX_CHECK_FLAG,data:{}}):e.toolBarEvents.publish({event:a.COLLECTION_TOOLBAR_CHECKBOX_UNCHECK_FLAG,data:{}}),e.toolBarEvents.publish({event:a.COLLECTION_TOOLBAR_EVENT_UPDATE_COUNT,data:i})}))),this.subscriptionList.push(e.modelEvents.subscribe({event:a.EVENT_SHOW_RESET_COMMAND},(function(){e.showResetCommand()}))),this.subscriptionList.push(e.modelEvents.subscribe({event:a.EVENT_HIDE_RESET_COMMAND},(function(){e.hideResetCommand()}))),e.toolBarEvents.subscribe({event:a.COLLECTION_TOOLBAR_SEARCH},(function(t){var i=e.currentModel;i.prepareUpdate();var n=i.getChildren();e.showAllNodes(n);let l=widget.getValue(a.VIEW_PERSISTANCE_KEY);if(!t.searchValue[0]||0===t.searchValue.length)return i.collapseAll(),i.expandAll(),void i.pushUpdate();var s=[];i.search({match:function(e){var i=e.nodeModel;if(!i._canBeGrouped())return!1;if(i&&o.isPerformanceSpecification(i.getTypeActualName())){if(l===a.TOOLBAR_VIEW_RELEASED&&!i.isReleased()||l===a.TOOLBAR_VIEW_REVISED&&!i.isLastRevision())return i.setSearchFilterState(!1),!0}else if(o.isPerformanceCharacteristics(i.getTypeActualName())&&(l===a.TOOLBAR_VIEW_RELEASED&&!i.getParent().isReleased()||l===a.TOOLBAR_VIEW_REVISED&&!i.getParent().isLastRevision()))return i.setSearchFilterState(!1),!0;if(!i.getTitle)return!0;var n=i.getTitle()+" "+i.getDescription()+" "+i.getCategory()+" "+i.getRevision()+" "+i.getMaturity()+" "+i.getNotes();if(o.isPerformanceCharacteristics(i.getTypeActualName())&&(n+=i.getDimension()+" "+i.getLowerRoutineReleaseLimit()+" "+i.getLowerSpecificationLimit()+" "+i.getLowerTarget()+" "+i.getUpperRoutineReleaseLimit()+" "+i.getUpperSpecificationLimit()+" "+i.getUpperTarget()+" "+i.getDisplayUnit()+" "+i.getCharPrecision()+" "+i.getPriority()+" "+i.getMissedTargetAction()+" "+i.getTestMethodsLabel()+" "+i.getDisplayTarget()),t.searchValue[0]&&-1!==n.toUpperCase().indexOf(t.searchValue[0].toUpperCase())){if(i.setSearchFilterState(!0),o.isPerformanceCharacteristics(i.getTypeActualName())){let e=i.getParent();s.push(e.getID())}return!1}return i.setSearchFilterState(!1),!0}}).forEach((function(e,t){e._canBeGrouped()&&e.getTitle&&!s.includes(e.getID())&&(e.unmatchSearch(),e.setSearchFilterState(!1),e.applyFilters())})),i.pushUpdate()})),e.toolBarEvents.subscribe({event:a.COLLECTION_TOOLBAR_EVENT_ALL_SELECTED},(function(t){e.currentModel.selectAll()})),e.toolBarEvents.subscribe({event:a.COLLECTION_TOOLBAR_EVENT_ALL_UNSELECTED},(function(t){e.currentModel.unselectAll()}))},hideResetCommand:function(){var e=this.target?this.target.getElementsByTagName("li").ResetChanges:void 0;e&&e.setStyle("display","none")},showResetCommand:function(){var e=this.target?this.target.getElementsByTagName("li").ResetChanges:void 0;e&&e.setStyle("display","inline-block")},showAllNodes:function(e){var t=this;let i=widget.getValue(a.VIEW_PERSISTANCE_KEY);e&&Array.isArray(e)&&e.forEach((function(e,n){if(!e||!o.isPerformanceSpecification(e.getTypeActualName())||(i!==a.TOOLBAR_VIEW_RELEASED||e.isReleased())&&(i!==a.TOOLBAR_VIEW_REVISED||e.isLastRevision()))if(e._canBeGrouped()){if(e.setSearchFilterState(!0),e.getChildren()&&e.getChildren().length>0){e.getChildren().forEach((e=>{e.setSearchFilterState(!0),e._isHidden=!1}))}e.applyFilters()}else t.showAllNodes(e.getChildren())}))},setActions:function(e){this.actionCommands=this.commandHandler(e)},setCurrentView:function(e){this.currentView=e},setCurrentModel:function(e){this.currentModel=e},commandHandler:function(e){var t=[],i=this;e.forEach((function(e){var n={};n.id=e.key,n.text=e.nlsLabel?c[e.nlsLabel]:e.nlsLabel,n.title=e.nlsLabel,n.disabled=e.disabled,n.fonticon=e.fonticon;var a=e.persistencyKey,l=e.isSelectable,s=e.subMenu;if(s){if(n.handler=function(e){var t=e.target.getBoundingClientRect();i.drawSubMenu(t,s,this,a,l)},a&&l){let e=widget.getValue(a);s.forEach((t=>{e&&e===t.key&&(n.fonticon=t.fonticon,n.text=c[t.nlsLabel])}))}}else n.handler=i.launchCommand.bind(i,e.key);t.push(n)}));var n={id:"expandAll"};n.text=c.label_expandAll||"Expand All",n.title="expand View",n.fonticon="flow-tree-expand-down",n.handler=i.launchExpandAll.bind(i,"expandAll"),t.push(n);var a={id:"collapseAll"};a.text=c.label_collapseAll||"Collapse All",a.title="Collapse View",a.fonticon="flow-tree-expand-up",a.handler=i.launchCollapseAll.bind(i,"collapseAll"),t.push(a);var l={id:"Export"};l.text=c.label_ExportCharacteristics,l.title=c.label_ExportCharacteristics,l.fonticon="export",l.handler=i.launchCommand.bind(i,"Export"),t.push(l);var s={id:"Personalize"};s.text=c.PersonalizeView,s.title="Personalize View",s.fonticon="cog",s.handler=i.launchCommand.bind(i,"Personalize"),t.push(s);var o={id:"Wraptext"};o.text=c.label_Wrap,o.title=c.label_Wrap,o.fonticon="text-wrapping-ok",o.handler=i.launchWrapText.bind(i),t.push(o);var r={id:"Unwraptext"};r.text=c.label_UnWrap,r.title=c.label_UnWrap,r.fonticon="text-wrapping-off",r.handler=i.launchUnWrapText.bind(i),t.push(r);var u={id:"ResetChanges"};return u.text=c.ResetChanges,u.title=c.ResetChanges,u.fonticon="reset",u.handler=i.launchResetModelChanges.bind(i),t.push(u),t},drawSubMenu:function(e,i,n,a,l){var o=this;if(i){var u=function(e){var t=[];return e.forEach((function(e){var i={};if(i.title=c[e.nlsLabel]||e.text,"CheckItem"==e.type?i.type=e.type:i.type=e.type&&"separator"===e.type?"TitleItem":"PushItem",e.tooltip){let t={};e.tooltip.title&&(t.title=c[e.tooltip.title]),e.tooltip.shortHelp&&(t.shortHelp=c[e.tooltip.shortHelp]),e.tooltip.longHelp&&(t.longHelp=c[e.tooltip.longHelp]),i.tooltip=new r(t)}if("CreateCharacteristics"===e.key){let e=o.currentView.getTreeDocument().getSelectedNodes();1===e.length&&s.allTypeList.includes(e[0].getTypeActualName())&&e[0].isInWork()||(i.state="disabled")}if(o.currentView.getTreeDocument().getSelectedNodes().length>0&&"CreateSpecification"===e.key&&(i.state="disabled"),a||"CheckItem"===i.type){let t=widget.getValue(a);null!=t?t==e.key?i.state="selected":i.state="unselected":(e.isDefault,i.state=e.isDefault?"selected":"unselected")}if(e.subMenu){e.fonticon&&(i.fonticon={family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+e.fonticon}),i.action={this:this,callback:function(t){o.launchCommand(e.key)}};var d=u(e.subMenu);i.submenu=d}else if("PushItem"===i.type||"CheckItem"===i.type){if(e.fonticon&&(i.fonticon={family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+e.fonticon}),"CreateSpecification"===e.key){delete i.fonticon;var h=s.getIconForChar("PerformanceSpecification_2");i.icon=h}else if("CreateCharacteristics"===e.key){delete i.fonticon;var p=s.getIconForChar("MeasurementCharacteristics_2");i.icon=p}i.action={this:this,callback:function(t){(!e.isDefault&&l||e.isDefault&&l)&&(widget.setValue(a,e.key),o.changeTooltipFontIcon(n,e)),o.launchCommand(e.key)}}}t.push(i)})),t};o.subMenus=u(i),t.show(o.subMenus,{position:{x:e.left,y:e.bottom}})}},launchExport:function(){this.currentView.gridOptions.api.exportDataAsExcel()},launchExpandAll:function(){this.currentView.treeDocument.expandAll(),this.hideCommand("expandAll"),this.showCommand("collapseAll")},launchCollapseAll:function(){this.currentView.treeDocument.collapseAll(),this.hideCommand("collapseAll"),this.showCommand("expandAll")},launchWrapText:function(){var e=this.currentModel;l.maskLoader(this.container,c.WrapLoader),this.currentModel.gridLayout.collectionView.prepareUpdateView();var t=this.currentModel.gridLayout.columns;document.querySelectorAll(".xsr-custom-container > .read-only").forEach((e=>{e.addClassName("wrap-text")})),this.appCore.wrap_enabled=!0;for(var i=function(e,t,i){("tree"===t.typeRepresentation||"string"===t.typeRepresentation&&"charPrecision"!=i&&"missedTargetAction"!=i&&!t.range)&&(t._defaulttypeRepresentation=t.typeRepresentation,e.gridLayout.setColumnTypeRepresentation(i,"textBlock")),e.gridLayout.setColumnAutoRowHeightFlag(i,!0)},n=0;n<t.length;n++){var a=t[n],o=t[n].children,r=a.dataIndex;if(a.typeRepresentation)i(e,a,r);else if(o)for(var u=0;u<o.length;u++){var d=o[u];i(e,d,d.dataIndex)}}this.currentModel.gridLayout.collectionView.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0),s.disableEditableContainers(),this.hideCommand("Wraptext"),this.showCommand("Unwraptext"),l.unmaskLoader(this.container)},launchUnWrapText:function(){this.currentModel.gridLayout.collectionView.prepareUpdateView();var e=this.currentModel.gridLayout.columns;document.querySelectorAll(".xsr-custom-container > .read-only").forEach((e=>{e.removeClassName("wrap-text")})),this.appCore.wrap_enabled=!1;for(var t=function(e,t,i){t.typeRepresentation&&"textBlock"===t.typeRepresentation&&(t.typeRepresentation=t._defaulttypeRepresentation?t._defaulttypeRepresentation:t.typeRepresentation),e.gridLayout.setColumnAutoRowHeightFlag(i,!1)},i=0;i<e.length;i++){var n=this.currentModel,a=e[i],l=e[i].children,o=a.dataIndex;if(a.typeRepresentation)t(n,a,o);else if(l)for(var r=0;r<l.length;r++){var c=l[r];t(n,c,c.dataIndex)}}this.currentModel.gridLayout.collectionView.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0),s.disableEditableContainers(),this.hideCommand("Unwraptext"),this.showCommand("Wraptext")},hideCommand:function(e){var t=this.target?this.target.getElementsByTagName("li")[e]:void 0;t&&(t.setStyle("display","none"),-1===this.hiddenCmds.indexOf(e)&&this.hiddenCmds.push(e))},showCommand:function(e){var t=this.target?this.target.getElementsByTagName("li")[e]:void 0;t&&(t.setStyle("display","inline-block"),this.hiddenCmds.splice(this.hiddenCmds.indexOf(e),1))},launchResetModelChanges:function(){this.currentModel&&(this.currentModel.cancelChanges(),this.hideResetCommand())},launchCommand:function(e){this.modelEvents.publish({event:"grid-toolbar-action-click-characterstics",data:e})},disableCommands:function(e){for(var t=0;t<e.length;t++){var i=e[t];this.toolBarEvents.publish({event:a.COLLECTION_TOOLBAR_COMMAND_DISABLE,data:i}),this.hiddenCmds.indexOf(i)>=0&&this.hideCommand(i)}},enableCommands:function(e){for(var t=0;t<e.length;t++){var i=e[t];this.toolBarEvents.publish({event:a.COLLECTION_TOOLBAR_COMMAND_ENABLE,data:i}),this.hiddenCmds.indexOf(i)>=0&&this.hideCommand(i)}},changeTooltipFontIcon:function(e,t){let i=c[t.nlsLabel]||t.text;e.tooltip.getBody().setText(i),e.fonticon="fonticon fonticon-"+t.fonticon,e.elements.icon.className="fonticon fonticon-"+t.fonticon},destroy:function(){this.subscriptionList&&this.modelEvents.unsubscribeList(this.subscriptionList),this.toolBarEvents.unsubscribeAll()}})}));