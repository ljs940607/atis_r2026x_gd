define("DS/ENOCharacteristicsApp/controls/CharacteristicsControl",["UWA/Class","DS/ENOCharacteristicsApp/controls/CreateCharacteristics","DS/ENOCharacteristicsApp/controls/CreateSpecification","DS/ENOCharacteristicsApp/controls/DeleteCharacteristics","DS/ENOCharacteristicsApp/utils/CharacteristicsUtils","DS/ENOCharacteristicsApp/service/CharacteristicsServiceWrapper","DS/ENOCharacteristicsApp/utils/Constants","DS/XSRCommonComponents/service/XSpecsActionsFactory","DS/XSRCommonComponents/components/EditProp/XSpecProperties","DS/XSRCommonComponents/utils/TypeUtils","DS/ENOCharacteristicsApp/utils/Notification","DS/Controls/Button","DS/Windows/Dialog","DS/XSRCommonComponents/components/AddExtensions/AddExtensions","DS/XSRCommonComponents/utils/RequestUtil","DS/XSRCommonComponents/utils/XSRSearch","i18n!DS/ENOCharacteristicsApp/assets/nls/ENOCharacteristicsApp"],(function(e,t,i,a,s,r,n,o,c,l,d,p,h,u,m,g,f){"use strict";return e.extend({init:function(e){this.charGrid=e.charGrid,this.dataGrid=e.dataGrid,this.itemTitle=e.itemTitle,this.itemMaturity=e.itemMaturity,this.actualItemMaturity=e.actualItemMaturity,this.physicalPrdModel=e.physicalPrdModel,this.modelEvents=e.modelEvents,this.specViewerModelEvents=e.specViewerModelEvents,this.appCore=e.appCore},launchCreateForm:function(e,a){var s=this,r={};if(r.charContainer=e.charContainer,r.modelEvents=s.modelEvents,r.appCore=s.appCore,"CreateSpecification"===a){r.parentId=e.parentId,r.title=s.itemTitle,r.createCloseAction=r.createAction=function(e,t){e&&null!=e&&t.modelEvents.publish({event:"specification-created",data:{specRowData:e}})},new i(r).loadFields()}else{if(r.isSpecificationLimitsDisabled=e.isSpecificationLimitsDisabled,r.isRoutineReleaseLimitsDisabled=e.isRoutineReleaseLimitsDisabled,!s.dataGrid.getTreeDocument().getSelectedNodes()||1!==s.dataGrid.getTreeDocument().getSelectedNodes().length)return void d.displayNotification({eventID:"info",msg:f.MultipleItemSelected});r.parentId=s.dataGrid.getTreeDocument().getSelectedNodes()[0].getPhysicalId(),r.title=s.dataGrid.getTreeDocument().getSelectedNodes()[0].getTitle(),r.createCloseAction=r.createAction=function(e,t){e&&null!=e&&t.modelEvents.publish({event:"characteristic-created",data:{specRowData:e}})},new t(r).loadFields()}},deleteCharNodes:function(e){var t={};t.parentId=e.parentId,t.modelEvents=e.modelEvents,t.container=e.container,t.selectedNodes=this.dataGrid.getTreeDocument().getSelectedNodes(),new a(t).deleteCharacteristics()},testMethodsDialog:function(e){var t=this;console.log("Test Methods Dialog"),console.log(e);var i=e.selectedNodes[0];t.facetsArr=[];var a=UWA.createElement("div",{class:"testMethods-char-container",styles:{height:"inherit"}});t.specProp=new c,t.editPropView=t.specProp.init({id:i.getID(),container:a,readOnly:!1,facets:t.facetsArr,enableChangeRequired:!1,specModel:i});var s=new h({title:"Test Methods",content:a,height:600,width:500,activeFlag:!1,modalFlag:!0,buttons:{Cancel:new p({onClick:function(e){s.close()}})}});s.addEventListener("close",(function(e){t.specViewerModelEvents.publish({event:"xsr-slide-in-facet-destroy-updated"})})),t.specProp._addCustomFacet(e.appCore)},informationDialog:function(e){var t=this;if(null==e||0==e.length)return void d.displayNotification({eventID:"info",msg:f.Info_Select_Spec_Or_Char});if(e.length>1)return void d.displayNotification({eventID:"info",msg:f.Info_Select_Single_item});var i=e[0];let a="PerformanceSpec"!==e[0].getTypeActualName();t.facetsArr=["Properties","Change","Comments"];var s=UWA.createElement("div",{class:"properties-char-container",styles:{height:"inherit"}});t.specProp=new c,t.editPropView=t.specProp.init({id:i.getID(),container:s,readOnly:a,facets:t.facetsArr,enableChangeRequired:!0,specModel:i});var r=new h({title:"Properties",content:s,height:600,width:500,activeFlag:!1,modalFlag:!0,buttons:{Cancel:new p({onClick:function(e){r.close()}})}})},addExtensions:function(){var e=this;let t=new r,i=this.dataGrid.getTreeDocument().getSelectedNodes(),a=i[0].getTypeActualName(),s=l.isPerformanceSpecification(a)?n.TYPE_PERFORMANCE_SPEC:l.isPerformanceCharacteristics(a)?n.TYPE_PERFORMANCE_CHAR:null,o=s===n.TYPE_PERFORMANCE_SPEC?i[0].getMaturityActualName():i[0].getParent().getMaturityActualName(),c=e.physicalPrdModel.isBeyondInWork();if(o!==n.MATURITY_IN_WORK||c)return d.clearNotifications(),void d.displayNotification({eventID:"error",msg:f.Error_Beyond_InWork_State});let p,h={classes:a,isCloud:m.isCloud()},g=i[0].getID();s==n.TYPE_PERFORMANCE_CHAR&&(p=i[0].getParent().getID());let v=t.getExtensions(h),C={},E={physicalid:g,isCloud:m.isCloud()},D=t.getAttachedExtensions(E),S={};function y(e){return e.filter((e=>{let t=e.name;return!(t.startsWith("XP_")&&t.endsWith("_Ext"))}))}Promise.all([v,D]).then((([t,i])=>{C=y(t.data[0].interfaces),S=y(i.data.interfaces),new u({itemId:g,type:s,parentId:p,modelEvents:e.modelEvents,applicableExtensions:C,attachedExtensions:S}).render()})).catch((e=>{d.clearNotifications(),d.displayNotification({eventID:"error",msg:f.Error_Fetch_Extensions})}))},syncPerformanceSpecs:function(e){let t=this,i=new r({appCore:t.appCore});i.getScopedEngItem(e).then((a=>{if(a.totalItems>0){let s=a.member[0].ScopeEngItem?a.member[0].ScopeEngItem.identifier:"";i.syncPerformanceSpecs(e,{scopeEngItem:s}).then((e=>{let i=e.data,a=e.extensionAttribs;i&&t.modelEvents.publish({event:"sync-specifications",data:{specsList:i,engItemId:s,extensionAttribs:a}})}))}})).catch((e=>{d.clearNotifications(),d.displayNotification({eventID:"error",msg:e?e.errorMessage:"An Error Occured."})}))},assignTestMethod:function(e){var t=this;let i=new r,a=e.itemId;var s={allowedTypes:["Test Method Specification"],role:"",multiSel:!1,criteria:"Test Method Specification",precondition:"(current==Release OR current==RELEASED) AND latestrevision==TRUE",in_apps_callback:async function(e){console.log(e);let s=[],r={};t.charGrid.model&&(s=t.charGrid.model.getSelectedNodes(),s.forEach((function(e){if(l.isPerformanceCharacteristics(e.getTypeActualName())){var t=e.getParent().getID(),i=e.getAttributeValue("physicalId");r[i]||(r[i]=t)}else{e.getChildren().forEach((t=>{var i=t.getAttributeValue("physicalId");r[i]||(r[i]=e.getAttributeValue("physicalId"))}))}})));var n=e[0].id,o=e[0]["ds6w:identifier"],c=e[0]["ds6w:label"],p={testMethod:n,selectedList:r,physicalPrdId:a};try{let e=await i.assignTestMethod(p);if(!e||200!==e.statusCode)throw e;t.modelEvents.publish({event:"assign-testmethod",data:{tmName:o,tmId:n,tmTitle:c,resp:e.data}}),d.displayNotification({eventID:"success",msg:f.Message_TestMethodAssigned})}catch(e){d.displayNotification({eventID:"error",msg:e.errorMessage?e.errorMessage.contains("access")?f.Message_Error_AddTestMethod:e.errorMessage:""})}}};new g(s).launchSearch(s)},linkRequirement:function(e){var t=this;let i=new r,a=e.itemId;var s={allowedTypes:["Requirement"],role:"",multiSel:!1,criteria:"Requirement",precondition:"(current==Release OR current==RELEASED) AND latestrevision==TRUE",in_apps_callback:async function(e){console.log(e);let s=[],r={};t.charGrid.model&&(s=t.charGrid.model.getSelectedNodes(),s.forEach((function(e){if(l.isPerformanceCharacteristics(e.getTypeActualName())){var t=e.getParent().getID(),i=e.getAttributeValue("physicalId");r[i]||(r[i]=t)}else{e.getChildren().forEach((t=>{var i=t.getAttributeValue("physicalId");r[i]||(r[i]=e.getAttributeValue("physicalId"))}))}})));var n=e[0].id,o=e[0]["ds6w:label"],c=e[0]["ds6w:status_value"],p={requirement:n,selectedList:r,physicalPrdId:a};try{if("Requirement.Release"!==c&&"Released"!==c)d.displayNotification({eventID:"error",msg:f.Err_Req_NotReleased});else{let e=await i.linkRequirement(p);if(!e||200!==e.statusCode)throw e;t.modelEvents.publish({event:"link-requirement",data:{reqName:o,reqId:n,resp:e.data}}),d.displayNotification({eventID:"success",msg:f.Message_ReqMethodAssigned})}}catch(e){d.displayNotification({eventID:"error",msg:e.errorMessage?e.errorMessage.contains("access")?f.Message_Error_LinkReq:e.errorMessage:""})}}};new g(s).launchSearch(s)},duplicateCharNodes:function(e){var t=this,i=[],a=1,o=!1,c="";if(e.forEach((function(e){if(!(n.MEASUREMENT_CHAR!==e.getTypeActualName()||n.ARBITRARY_UNIT===e.getDimension()||s.dimensionDisplayUnitMap[e.getDimensionId()]&&s.displayUnitIdToObjMap[e.getDisplayUnitId()]))return o=!0,void(c+=`${e.getTitle()}, `)})),o)return d.clearNotifications(),void d.displayNotification({eventID:"error",msg:`${f.Err_Duplicate_Unsupported} : ${c.replace(/,\s*$/,"")}`});e.forEach((function(e){var t=e.getParent().getID(),s=e.getParent().getChildren().length+a;a+=1;var n={};n.type=e.getTypeActualName(),n.charId=e.getID(),n.sequence=s;var o=(new r).duplicateInstances(t,n);i.push(o)})),Promise.allSettled(i).then((function(e){if(e&&e.length>0){for(var i=[],a=0,r=0;r<e.length;r++)if("fulfilled"===e[r].status){var n=JSON.parse(e[r].value),o=s.createDupCharData(n.data.data);i.push(o)}else a++;a>0?d.displayNotification({eventID:"error",msg:f.Err_DuplicateChar}):(t.modelEvents.publish({event:"dup-characteristic-created",data:{specRowData:i}}),d.displayNotification({eventID:"success",msg:f.Success_DuplicateChar}))}})).catch((function(e){d.displayNotification({eventID:"error",msg:e?e.message:"An Error Occured."}),t._closeDialog()}))},personalize:function(){this.charGrid.personalize()},exportGrid:function(){var e;e=this.itemTitle&&this.itemMaturity?this.itemTitle+"_"+this.itemMaturity+"_"+f.label_PerformanceSpec+"_"+(new Date).toString().split(" ").splice(1,4).join(" "):f.label_Characteristics+"_"+(new Date).toString().split(" ").splice(1,4).join(" "),this.charGrid.exportGrid(e)},maturityStateControl:function(e){o.showMaturityGraph(e)},revisionControl:function(e){o.launchPerfSpecVersionExplorer(e)}})}));