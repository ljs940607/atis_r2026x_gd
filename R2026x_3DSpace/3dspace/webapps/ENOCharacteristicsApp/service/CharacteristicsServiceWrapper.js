define("DS/ENOCharacteristicsApp/service/CharacteristicsServiceWrapper",["UWA/Core","UWA/Promise","DS/Controls/Abstract","DS/ENOCharacteristicsApp/model/SpecificationModel","DS/ENOCharacteristicsApp/utils/CharacteristicsServiceProvider","DS/XSRCommonComponents/utils/TypeUtils","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/store/AppStorage","DS/ENOCharacteristicsApp/utils/Constants","i18n!DS/ENOCharacteristicsApp/assets/nls/ENOCharacteristicsApp"],(function(e,t,n,r,i,a,c,o,s,u){"use strict";return n.extend({init:function(e){e&&(this.modelEvents=e.modelEvents,this.options=e,this.appCore=e.appCore)},saveGlobalViewsConfiguredByAdmin:function(e){return new t((function(t,n){(new i).saveGlobalViewsConfiguredByAdmin(e).then((function(e){return o.remove(s.XSR_PS_GLOBAL_VIEW),JSON.parse(e).data?t(JSON.parse(e).data):""})).catch((function(e){}))}))},getAllExtensions:function(e){let n=this;return new t((function(t,r){let a=o.get(s.XSR_PS_EXTENSIONS);if(a){let e=n.buildExtensionAttributesInfo(a);t(e)}else(new i).getAllExtensions(e).then((function(e){o.set(s.XSR_PS_EXTENSIONS,e);let r=n.buildExtensionAttributesInfo(e);t(r)})).catch((function(e){return r(e)}))}))},getGlobalViewsConfiguredByAdmin:function(e){let n=this;return new t((function(t,r){let a=o.get(s.XSR_PS_GLOBAL_VIEW);if(a&&function(){let t=new Set;try{let n=JSON.parse(a);return n.data.definitions&&n.data.definitions.forEach((e=>{t.add(`${e.extension}||${e.name}`)})),e.every((e=>t.has(e)))}catch(e){return!1}}()){let e=JSON.parse(a).data?JSON.parse(a).data:"",r=n.buildExtensionAttributesInfo(e);e.definitions=r,t(e)}else(new i).getGlobalViewsConfiguredByAdmin(e).then((function(e){o.set(s.XSR_PS_GLOBAL_VIEW,e);let r=JSON.parse(e).data?JSON.parse(e).data:"",i=n.buildExtensionAttributesInfo(r);r.definitions=i,t(r)})).catch((function(e){r(e)}))}))},getMeasurementCharacteristicLimitsConfiguration:function(){return new t((function(e,t){let n=o.get(s.XSR_PS_MEASUREMENT_LIMITS);if(n){let t=JSON.parse(n).data?JSON.parse(n).data:null;e(t)}else(new i).getMeasurementCharacteristicLimitsConfiguration().then((function(t){o.set(s.XSR_PS_MEASUREMENT_LIMITS,t);let n=JSON.parse(t).data?JSON.parse(t).data:null;e(n)})).catch((function(e){t(e)}))}))},getParameterTemplatesAndArbitraryUnits:function(){return new t((function(e,t){let n=o.get(s.XSR_PS_TEMPLATES_UNITS);if(n){let t=JSON.parse(n)?JSON.parse(n):"";e(t)}else(new i).getParameterTemplatesAndArbitraryUnits().then((function(t){o.set(s.XSR_PS_TEMPLATES_UNITS,t);let n=JSON.parse(t)?JSON.parse(t):"";e(n)})).catch((function(e){return t(e)}))}))},getSpecData:function(e){var n=this;return new t((function(t,r){(new i).fetchSpecificationsData(e).then((function(e){let r=e.data.specsData;var i=n.createSpecNodes(r);return t({listNodes:i})})).catch((function(e){return r(e)}))}))},buildExtensionAttributesInfo:function(e){let t=this,n={};if(e&&(e.data||e.definitions)){let i=e.data?e.data.additionalAttributes:e.definitions;return t.appCore.defaultExtensionAttributes=i,function(e){for(let t in e){(Array.isArray(e[t])?e[t]:[e[t]]).forEach((e=>{let t="";if(t=e.nlsName?e.nlsName:r(e.name),"Change Id"===t)return;let i=e.extension+"||"+e.name;e.mandatory;if(e.dimension&&""!==e.dimension){let n="";e.units.forEach((t=>{t.dbName==e.preferredUnit&&(n=t.nlsLabel)})),t=`${t} (${n})`}if(!n.hasOwnProperty(i)){let r="timestamp"!==e.type||e.rangevalue?e.multiline?"textBlock":"string":"datetime";n[i]={dataIndex:i,text:t,typeRepresentation:r,editableFlag:"ReadWrite"==e.userAccess,extension:e.extension,mandatory:e.mandatory,visibleFlag:!1,multiValue:e.multiValue},e.dimension&&""!==e.dimension&&(n[i].baseUnit=e.baseUnit,n[i].preferredUnit=e.preferredUnit),e.hasOwnProperty("rangevalue")&&"timestamp"!==e.type&&(n[i].range=Object.values(e.rangevalue),n[i].rangeNLSActualMap=Object.fromEntries(Object.entries(e.rangevalue))),"boolean"!==e.type||e.multiValue||(n[i].range=[u.boolean_true,u.boolean_false]),"timestamp"===e.type&&e.rangevalue&&(n[i].range=Object.values(e.rangevalue).sort().map((e=>c.formatDate(e))),c.formatAttributeRanges(e),n[i].rangeNLSActualMap=Object.fromEntries(Object.entries(e.rangevalue)))}}))}}(i),Object.values(n)}return[];function r(e){let t="";return t=e.includes("XP_PerformanceSpec_Ext")?e.replace("XP_PerformanceSpec_Ext.",""):e.includes("XP_PerformanceChar_Ext")?e.replace("XP_PerformanceChar_Ext.",""):e,t}},createSpecNodes:function(t){var n=[];if(void 0!==t){for(var r=0;r<t.length;r++){var i=this.createSpecNode(t[r]);e.is(i)&&n.push(i)}return n}},createSpecNode:function(e){var t=new r({appCore:this.appCore}).set(e);return t.charModelEvents=this.modelEvents,t},updateCharacteristicsData:function(e,n,r){return new t((function(t,a){(new i).updateCharacteristics(e,n,r).then((function(e){return t(e)})).catch((function(e){return a(e)}))}))},assignTestMethod:function(e){return new t((function(t,n){(new i).assignTestMethod(e).then((function(e){return t(e)})).catch((function(e){return n(e)}))}))},linkRequirement:function(e){return new t((function(t,n){(new i).linkRequirement(e).then((function(e){return t(e)})).catch((function(e){return n(e)}))}))},updateSpecificationData:function(e,n,r){return new t((function(t,a){(new i).updateSpecificaton(e,n,r).then((function(e){return t(e)})).catch((function(e){return a(e)}))}))},reorderchar:function(e,n,r){return new t((function(t,a){(new i).reorder(e,n,r).then((function(e){return t(e)})).catch((function(e){return a(e)}))}))},createCharacteristics:function(e){return new t((function(t,n){(new i).createCharacteristics(e).then((function(e){var r=JSON.parse(e),i=r.data.physicalid;return null!=e&&null!=i?t(r):n(r)})).catch((function(e){var t=JSON.parse(e).errorMessage;return console.log(t),n(t)}))}))},deleteInstances:function(e){var t=e[0].getTypeActualName(),n=new i(this.options);return a.isPerformanceSpecification(t)?n.deleteSpecifications(e):n.deleteCharacteristics(e)},getDimensionDisplayUnitSet:function(){return new t((function(e,t){let n=o.get(s.XSR_PC_DIMENSION_UNITS);n?e(n):(new i).fetchDimensionDisplayUnitSet().then((function(t){return o.set(s.XSR_PC_DIMENSION_UNITS,t),e(t)})).catch((function(e){return t(e)}))}))},createSpecification:function(e,n){return new t((function(t,r){(new i).createSpecification(e,n).then((function(e){var n=JSON.parse(e),i=n.data.physicalid;return null!=e&&null!=i?t(n):r(n)})).catch((function(e){var t=JSON.parse(e).errorMessage;return console.log(t),r(t)}))}))},getExtensions:function(e){return new t(((t,n)=>{(new i).getExtensions(e).then((e=>t(e))).catch((e=>n(e)))}))},getAttachedExtensions:function(e){return new t(((t,n)=>{(new i).getAttachedExtensions(e).then((e=>t(e))).catch((e=>n(e)))}))},addExtensions:function(e){return new t(((t,n)=>{(new i).addExtensions(e).then((e=>t(e))).catch((e=>n(e)))}))},removeExtensions:function(e){return new t(((t,n)=>{(new i).removeExtensions(e).then((e=>t(e))).catch((e=>n(e)))}))},getSpecDataById:function(e,n,r){return new t((function(t,a){(new i).fetchSpecificationsDataByID(e,n,r).then((function(e){return e.data?t(e.data):null})).catch((function(e){return a(e)}))}))},duplicateInstances:function(e,n){return new t((function(t,r){(new i).duplicateCharacteristics(e,n).then((function(e){return t(e)})).catch((function(e){return r(e)}))}))},syncPerformanceSpecs:function(e,n){let r=this;return new t((function(t,a){(new i).syncPerformanceSpecs(e,n).then((function(e){e.data;let n=r.buildExtensionAttributesInfo(o.get(s.XSR_PS_EXTENSIONS));return t({data:e.data,extensionAttribs:n})})).catch((function(e){return a(e)}))}))},getScopedEngItem:function(e){return new t((function(t,n){(new i).getScopedEngItem(e).then((function(e){return t(e)})).catch((function(e){return n(e)}))}))},getType:function(){return new t((function(e,t){let n=o.get(s.XSR_PS_PC_SUBTYPES);n?e(n.data):(new i).getType().then((function(t){o.set(s.XSR_PS_PC_SUBTYPES,t);let n=t.data?t.data:null;e(n)})).catch((function(e){return t(e)}))}))},getRequirements:function(e,n){return new t((function(t,r){(new i).getRequirements(e,n).then((function(e){return e.data?t(e.data):null})).catch((function(e){return r(e)}))}))}})}));