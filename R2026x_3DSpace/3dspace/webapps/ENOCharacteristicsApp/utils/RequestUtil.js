define("DS/ENOCharacteristicsApp/utils/RequestUtil",["UWA/Class","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","DS/Utilities/TouchUtils","DS/ENOCharacteristicsApp/utils/PlatformDataProvider","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],(function(e,t,n,r,i,a){"use strict";return e.singleton({enableTestMethodSpecificationFlag:null,testMethodsTypesActualValue:null,BrowserEnum:{OPERA:0,CHROME:1,FIREFOX:2,IE:3,SAFARI:4,EDGE:6,SAFARI_IPAD:7,SAFARI_IPHONE:8,UNKNOWN:99},m3DSpaceURL:"../..",mUserLogin:"",charAppPath:"characteristicmodeller",charAppVersion:"v1",m3DSpaceCSRFToken:null,mLanguage:null,widgetTitle:null,_theListSC:[],_theListSC_NLS:[],_SCPreferredDB:null,_callback:null,init:function(){this._parent()},getCharWebServiceURL:function(){return"resources/"+this.charAppVersion+"/"+this.charAppPath+"/"},detectBrowser:function(){return!document.documentMode&&window.StyleMedia?this.BrowserEnum.EDGE:window.opera||navigator.userAgent.indexOf(" OPR/")>=0?this.BrowserEnum.OPERA:window.chrome?this.BrowserEnum.CHROME:"undefined"!=typeof InstallTrigger?this.BrowserEnum.FIREFOX:document.documentMode?this.BrowserEnum.IE:/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?this.BrowserEnum.SAFARI:this.BrowserEnum.UNKNOWN},getLanguage:function(){if(this.mLanguage)return this.mLanguage;try{if(window.parent&&window.parent.dsLang)return window.parent.dsLang;if(widget)return widget.lang}catch(e){}var e="en";return(e=navigator.browserLanguage?navigator.browserLanguage:navigator.language).indexOf("fr")>-1?"fr":e.indexOf("en")>-1?"en":e.indexOf("es")>-1?"es":e.indexOf("it")>-1?"it":e.indexOf("de")>-1?"de":e.indexOf("ja")>-1?"ja":e.indexOf("zh")>-1?"zh":"en"},isSafarionIPadorPod:function(){if(this.BrowserEnum.SAFARI!==this.detectBrowser())return!1;var e=null!==navigator.userAgent.match(/iPad/i),t=null!==navigator.userAgent.match(/iPhone/i)||null!==navigator.userAgent.match(/iPod/i);return e&&(t=!1),!(!e&&!t)||void 0},getTouchMode:function(){return r.getTouchMode()},get3DSpaceURL:function(){return this.m3DSpaceURL||""},getAppTitle:function(){return this.widgetTitle},getTimeZone:function(){var e=(new Date).getTimezoneOffset()/60;return widget.setValue("timeZone",e),e},get3DSpaceCSRFToken:function(){return this.m3DSpaceCSRFToken},setCSRFToken:function(){var e=this;return new Promise((function(t,n){e.send3DSpaceRequest("resources/v1/application/E6WFoundation/CSRF","GET",{type:"json",headers:{"Content-type":"application/json;"}},(function(n){!function(n){(n.csrf||null!==n.csrf)&&e.set3DSpaceCSRFToken(n.csrf.value),t()}(n)}),(function(e){var t;t=e,console.log("getCSRFToken:Failure..."+t),n()}))}))},get3DSearchURL:function(){var e=this.getPlatformId();return i.getServiceURL("3DSearch",e)},getPlatformId:function(){try{return this._platformId=widget&&widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",this._platformId}catch(e){return"OnPremise"}},getChange:function(){return this.authorizedChange=CfgAuthoringContext.get(),this.authorizedChange},setWorkUnderHeaders:function(e){this.workUnderHeader=e},workUnderIsSet:!1,addAdditionalHeader:function(e){return Object.assign(e,this.workUnderHeader)},setSecurityContext:function(){var e,t=this;return new Promise((function(n,r){var i=widget.getValue("Current_security_credentials");null!=i&&""!==i&&(e="ctx::"+i,t._securityContext=e),n()}))},getSecurityContext:function(){return this._securityContext||""},getloginUser:function(){return this.mUserLogin||(this.mUserLogin=n.getUser()),this.mUserLogin},set3DSpaceURL:function(){var e=this;return new Promise((function(t,n){i.getAllPlatforms().then((function(n){var r=e.getPlatformId(),a=i.getServiceURL("3DSpace",r);e.m3DSpaceURL=a,t()}),n)}))},set3DSpaceCSRFToken:function(e){this.m3DSpaceCSRFToken=e},send3DSpaceRequest:function(e,t,n,r,i){this.sendRequest(this.m3DSpaceURL+"/"+e,t,n,r,(function(e,t){i(t)}))},send3DSpaceRequestSimple:function(e,t){this.sendRequestSimple(this.m3DSpaceURL+"/"+e,t)},sendRequest:function(e,t,n,r,i){n.method=t,n.onComplete=r,n.onFailure=i,this.sendRequestSimple(e,n)},sendRequestSimple:function(e,n){return n.headers||(n.headers={},n.headers["Content-type"]="text/html"),n.type||(n.type="text"),n.data||(n.data=""),!n.headers.SecurityContext&&this.getSecurityContext()&&(n.headers.SecurityContext=this.getSecurityContext()),n.headers["Accept-Language"]||(n.headers["Accept-Language"]=this.getLanguage()),this.m3DSpaceCSRFToken&&(n.headers["X-Requested-With"]="csrf protection",n.headers["X-Request"]=this.m3DSpaceCSRFToken,n.headers.ENO_CSRF_TOKEN=this.m3DSpaceCSRFToken),this.workUnderIsSet&&(n.headers=this.addAdditionalHeader(n.headers)),t.authenticatedRequest(e,n)}})}));