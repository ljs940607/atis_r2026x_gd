define("DS/ENOCharacteristicsApp/view/TestMethodFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/SpecGridView/SpecGridView","DS/ENOCharacteristicsApp/utils/CharTestMethodUtils","DS/ENOCharacteristicsApp/service/CharTestMethodServiceProvider","DS/ENOCharacteristicsApp/service/CharacteristicsServiceWrapper","DS/ENOCharacteristicsApp/model/CharTestMethodModel","DS/XSRCommonComponents/utils/XSRSearch","DS/ENOCharacteristicsApp/utils/Notification","DS/XSRCommonComponents/utils/GridCommonActionsManager","DS/XSRCommonComponents/utils/XSRMask","DS/XSRCommonComponents/utils/Constants","DS/ENOCharacteristicsApp/view/DeleteCharacteristicsDialog","text!DS/ENOCharacteristicsApp/assets/config/CharTestMethodToolBarCommands.json","text!DS/ENOCharacteristicsApp/assets/config/CharRequirementToolBarCommands.json","text!DS/ENOCharacteristicsApp/assets/config/CharTestMethodColumnConfig.json","text!DS/ENOCharacteristicsApp/assets/config/CharRequirementColumnConfig.json","i18n!DS/ENOCharacteristicsApp/assets/nls/ENOCharacteristicsApp","css!DS/ENOCharacteristicsApp/view/TestMethodFacet.css"],(function(e,t,i,s,r,n,o,a,c,d,l,u,h,m,p,g,v,M,C,f){"use strict";return t.extend(i,s,{init:function(t){this._parent(t),this.isTMFacet="testMethods"==t.tabId,this.isRequirementsFacet="requirements"==t.tabId;let i=this.isTMFacet?"xsr-testmethod-view":"xsr-requirement-view";this.elements.container||(this.elements.container=e.createElement("div",{class:i})),this.appCore=this.options.appContext,this.appId=t.appId,this.appCore.contextAppId=this.appId,this.pcId=t.itemId,this.itemModel=t.itemModel,this.itemTitle=this.itemModel?this.itemModel.getLabel():"",this.rootModel=this.itemModel.getRoot().getAttributeValue("physicalId")?this.itemModel.getRoot():this.itemModel.getNthParent(1),this.psId=this.rootModel.getAttributeValue("physicalId"),this.modelEvents=this.appCore.specViewerModelEvents,this.basicModelEvents=this.appCore.basicModelEvents,this.currentTabKey=this.isTMFacet?"test-method-facet":"requirements-facet",this._SubscriptionList=[],this._subscribeEvents(),this.preferredView=void 0===widget.getValue("grid-preferred-view-"+this.currentTabKey)?m.BIG_TILE:widget.getValue("grid-preferred-view-"+this.currentTabKey),this.TMService=new o({psid:this.psId,pcid:this.pcId}),this.charService=new a},updateFacet:function(){var e=this;!e.facetContainer||e.facetContainer&&e.facetContainer.getChildren()&&0===e.facetContainer.getChildren().length?e._buildView():e.drawTMNodes()},_buildView:function(){var t=this;t.elements.container.empty(),t.facetContainer=e.createElement("div",{class:"tm_container"}).inject(t.elements.container),t.loadGrid(),t.drawNodes()},loadGrid:function(){var e=this,t=e.isTMFacet?JSON.parse(g):JSON.parse(v),i=n.getNLSLabels(t.actions),s=e.isTMFacet?JSON.parse(M):JSON.parse(C),o=n.getNLSLabels(s.columns),a={itemId:e.pcId,container:e.facetContainer,appCore:e.appCore,currentTabKey:e.currentTabKey,enableCrossWidgetFeature:!1,isColorized:!0,parentModel:e.itemModel,preferredView:e.preferredView};e.grid=new r(a),e.grid.setColumns(o),e.grid.render(),e.grid.setToolBarActions({actions:i});var c=e.isTMFacet?["RemoveTestMethod"]:["RemoveRequirement"];if(!this.rootModel.isInWork()){let t=e.isTMFacet?"AddTestMethod":"AddRequirement";c.push(t)}if(e.grid.toolbar.disableCommands(c),this.rootModel.isInWork()){let t=e.isTMFacet?["RemoveTestMethod"]:["RemoveRequirement"];e.grid.getTreeDocument().getXSO().onPostAdd((function(i){e.grid.getTreeDocument().getSelectedNodes().length>0&&e.grid.toolbar.enableCommands(t)})),e.grid.getTreeDocument().getXSO().onPostRemove((function(i){0==e.grid.getTreeDocument().getSelectedNodes().length&&e.grid.toolbar.disableCommands(t)}))}},drawNodes:function(){this.getNodes(this.pcId)},getNodes:function(e){var t=this;(t.isTMFacet?n.getTestMethods:t.getRequirements).call(t,t.psId,e,t.appCore,this.extApp_SC).then((function(e){if(e&&e.length>0){var i=[];t.grid.getTreeDocument().empty(),t.grid.getTreeDocument().acceptChanges();for(var s={appCore:t.appCore,currentTabKey:t.currentTabKey},r=0;r<e.length;r++){let n=new c(s).set(e[r]);t._addNewNode(n),i.push(n)}t.grid.getTreeDocument().acceptChanges()}else t.grid.displayEmptyObjectView()})).catch((function(e){console.log(e);let i=t.isTMFacet?f.Error_Get_TM:f.Error_Get_Requirement;l.displayNotification({eventID:"error",msg:e?e.result.message:i}),h.unmaskLoader(t.facetContainer)}))},getRequirements:function(e,t){var i=this;return new Promise((function(s,r){i.charService.getRequirements(e,t).then((function(e){if(e&&e.length>0){let t=e.map((e=>e.physicalid));i.TMService.fetch(t).then((function(e){let t=[];e.results.forEach(((e,i)=>{t[i]=e.attributes})),s(t)}))}else s(null)})).catch((function(e){var t;t=e&&e.result?e.result.message:f.Error_Get_Requirement,l.displayNotification({eventID:"error",msg:t})}))}))},_addNewNode:function(e,t){this.grid.addRootNodes(e,!1),this.grid.getTreeDocument().acceptChanges()},evt_GridToolbarSwitchView:function(e){var t="grid-preferred-view-"+this.currentTabKey;widget.setValue(t,e),this.grid.switchView(e)},evt_RemoveItems:function(){var e=this,t=e.grid.getTreeDocument().getSelectedNodes();if(t&&t.length>0){var i=e.itemModel.getTypeActualName();this.confirmationBox((function(){var s,r;t.length,r=(s=t).reduce((function(e,t){return e.push(t.getPhysicalId()),e}),[]),e.remove(e.psId,e.pcId,r,i).then((function(t){let i=e.isTMFacet?f.Message_TestMethodsRemoved:f.Message_RequirementRemoved;l.displayNotification({eventID:"success",msg:i}),t&&t.revisionid&&""!==t.revisionid&&(e.itemModel.setPhysicalId(t.revisionid),e.pcId=t.revisionid,e.basicModelEvents.publish({event:m.EVENT_LAUNCH_COMMAND,data:{commandId:m.INFORMATION_CMD,context:{item:e.itemModel}}}));let n=e.isTMFacet?"TestMethodFacet-to-PerfSpec-commute-remove-node-success":"requirement-facet-remove-node-success",o=e.isTMFacet?"testmethodIds":"requirementsIds";e.modelEvents.publish({event:n,data:{[o]:r,nodeModel:e.itemModel}}),e.grid.gridTreeDocument.removeRoot(s)}))}),t)}},remove:function(e,t,i,s){var r=this;return new Promise((function(n,o){var a;a={[r.isTMFacet?"testMethods":"requirements"]:i,type:s,addOperation:!1},r.charService.updateCharacteristicsData(a,e,t).then((function(e){var t=JSON.parse(e);return t&&200===t.statusCode?n(t.data):n(null)})).catch((function(e){var t;t=e&&e.result?e.result.message:r.isTMFacet?f.Message_Error_RemoveTestMethod:f.Message_Error_AddRequirement,l.displayNotification({eventID:"error",msg:t})}))}))},confirmationBox:function(e,t){var i=new p(t).renderDialog(!1);i.listenTo(i,"EVENT_CLICK_CHAR_OK",(function(){e(),i.closeDialog()}))},evt_AddItems:function(e){var t=this;!async function(e){var i=t.appCore.immersiveFrame?t.appCore.immersiveFrame.elements.container:document.body;let s=t.isTMFacet?"xsr-testmethod-view":"xsr-requirement-view";i=(i=i.getElementsByClassName(s)[0]?i.getElementsByClassName(s)[0]:i).getElementsByClassName("fonticon fonticon-plus")[0];const r=await d._getSearchCriteria(t.appCore.immersiveFrame,i);if("AddTestMethod"===e||"AddRequirement"===e){var n=0;let e=t.isTMFacet?"Document Release.RELEASED":"Requirement.Release";var o=t.grid.getTreeDocument().getChildren().reduce((function(e,t){return e.push(t.getPhysicalId()),e}),[]);var a={allowedTypes:t.isTMFacet?["Test Method Specification"]:["Requirement"],role:"",subType:"",criteria:r,precondition:"(current==Release OR current==RELEASED)",in_apps_callback:function(i){if(i){for(var s=0;s<i.length;s++)if(e!==i[s]["ds6w:status_value"]){n++;break}if(0<n){let e=t.isTMFacet?f.Err_TMS_NotReleased:Err_Requirement_NotReleased;l.displayNotification({eventID:"error",msg:e})}else{var r=i.reduce((function(e,t){return e.push(t.id),e}),[]);let e=t.isTMFacet?"testMethods":"requirements",s=t.isTMFacet?"testmethodInfo":"requirementInfo",n=t.isTMFacet?"TestMethodFacet-to-PerfSpec-commute-add-node-success":"requirement-facet-add-node-success";var o={[e]:r,type:t.itemModel.getTypeActualName(),addOperation:!0};t.charService.updateCharacteristicsData(o,t.psId,t.pcId).then((function(e){var i=JSON.parse(e);i.data&&i.data.revisionid&&""!==i.data.revisionid&&(t.itemModel.setPhysicalId(i.data.revisionid),t.pcId=i.data.revisionid,t.basicModelEvents.publish({event:m.EVENT_LAUNCH_COMMAND,data:{commandId:m.INFORMATION_CMD,context:{item:t.itemModel}}})),i&&200===i.statusCode&&t.TMService.fetch(r).then((function(e){t.modelEvents.publish({event:n,data:{[s]:e,nodeModel:t.itemModel}});for(var i={appCore:t.appCore,currentTabKey:t.currentTabKey},r=0;r<e.results.length;r++){var o=new c(i).set(e.results[r].attributes);t._addNewNode(o)}t.grid.getTreeDocument().acceptChanges();let a=t.isTMFacet?f.Message_TestMethodsAdded:f.Message_RequirementsAdded;l.displayNotification({eventID:"success",msg:a})}))})).catch((function(e){let i=t.isTMFacet?f.Message_Error_AddTestMethod:f.Message_Error_AddRequirement;l.displayNotification({eventID:"error",msg:i}),h.unmaskLoader(t.facetContainer)}))}}},multiSel:!0,excludeList:o};new d(a).launchSearch(a)}}(e)},_subscribeEvents:function(){var e=this;this._SubscriptionList.push(this.modelEvents.subscribe({event:`grid-toolbar-switch-view-${e.currentTabKey}`},(t=>e.evt_GridToolbarSwitchView(t)))),this._SubscriptionList.push(e.appCore.basicModelEvents.subscribe({event:m.OPEN_SPECIFICATION_VIEW},(t=>{e.appCore.triptychManager.hideRightPanel()}))),this._SubscriptionList.push(this.modelEvents.subscribe({event:"xsr-slide-in-facet-destroy-updated"},(function(t){e.destroyComponent()}))),this._SubscriptionList.push(this.modelEvents.subscribe({event:"grid-toolbar-action-click-"+this.currentTabKey},(function(t){"AddTestMethod"===t||"AddRequirement"===t?e.evt_AddItems(t):e.evt_RemoveItems()}))),this._SubscriptionList.push(this.modelEvents.subscribe({event:m.GRID_CONTEXT_MENU+"-"+this.currentTabKey},(function(t){var i=e.grid.getTreeDocument().getSelectedNodes();t.gridInstance=e.grid;var s=["Information","OpenWith","ManageFiles","SetPartNumber","UPSAuthUnparent","RemoveChild","VersionExplorer","DuplicateItem","CompareWith","RelatedObjects","MaturityGraph","ActionBar_ChangeOwner","MultiOwnership","DownloadReport","Subscriptions","DeleteItem","addExisting","RegenerateReport","Close","Information_Widget","Alternates"];if(i&&i.length>1)(0,u.getMultiActionMenu)(t,s);else if(i&&(0===i.length||1===i.length)){(0,u.getActionMenu)(t,s)}})))},destroyComponent:function(){this.elements.container.destroy(),this.grid.destroy(),this._SubscriptionList&&this.modelEvents.unsubscribeList(this._SubscriptionList)}})}));