define("DS/DELPPWModelBehaviors/ResultingProductBatchCmdBehavior",["UWA/Core","UWA/Utils","DS/PlatformAPI/PlatformAPI","DS/ExperienceKernel/ExperienceKernel"],(function(e,t,n,i){"use strict";return{plugins:["BatchCmdPlugin","DatabasePlugin","ResourcePlugin","UXComponentsPlugin"],creator:function(o,r,a,s,c,l){const u="Compute Resulting Product of Item",f=["CREATED","SUBMITTED","IN_PROGRESS"],g=l.getComponent("WUXFrameWindowsManager").getFrameWindow(r.getAppContext()),d=l.getComponent("Element"),m=l.getComponent("Dialog"),p=l.getComponent("Button"),h=l.getComponent("ButtonGroup"),P=l.getComponent("Toggle"),I=l.getComponent("ProgressBar");var S,y,L,D,v,R,C,b,N,k,A,F;return S=function(t,n,i){var o,r,a,l,u,f,I,S,y,L,D,v,R=s.getReferenceModel(t);o=new d("div",{class:"RPBatchUI-Dialog-Container"}),(l=new e.Element("div",{class:"TNRInfo section-Conatiner"})).inject(o),u=new e.Element("div",{class:"iconType-container"}),c.getIconElem(R.get("type")).inject(u),u.inject(l),new e.Element("div",{class:"SubLabelDiv",text:s.getDisplayName(R)}).inject(l),(f=new d("div",{class:"options-Container section-Conatiner"})).inject(o),(I=new d("div",{class:"computeMode-Container field-Conatiner"})).inject(f),new e.Element("div",{class:"fieldLabel",text:c.getNLSValue("RPBatchUI.Field.ComputeMode.Label")}).inject(I),y=new h({type:"radio"}),L=new P({type:"radio",label:c.getNLSValue("RPBatchUI.FieldValue.ComputeReplace.Label"),value:1,checkFlag:!0}),D=new P({type:"radio",label:c.getNLSValue("RPBatchUI.FieldValue.ComputeUpdate.Label"),value:2}),v=new P({type:"radio",label:c.getNLSValue("RPBatchUI.FieldValue.ComputeMultiLevel.Label"),value:3}),y.addChild(L),y.addChild(D),y.addChild(v),S=new e.Element("div",{class:"fieldValue"}),y.inject(S),S.inject(I),r={immersiveFrame:g.getImmersiveFrame(),title:c.getNLSValue("RPBatchUI.Dialog.Title"),domId:"RPBatchUI-Dialog",content:o,resizableFlag:!0,modalFlag:!0,width:350,visibleFlag:!0,buttons:{No:new p({label:c.getNLSValue("RPBatchUI.Button.Close.Title"),onClick:()=>{a.close(),i()}}),Yes:new p({label:c.getNLSValue("RPBatchUI.Button.Launch.Title"),onClick:()=>{var e={};e.ComputeMode=y.value[0],a.close(),n(e)}})}},(a=new m(r)).close=function(){e.is(o)&&o.destroy(),this.destroy(),a=null}},y=function(e){return new Promise((function(t,n){S(e,(function(e){t(e)}),(function(){n()}))}))},L=function(e){return new Promise((function(t,n){a.queryJobsInfo({operation:u,mfgId:e}).then((e=>{let n=[];Array.isArray(e)&&(n=e.filter((e=>f.indexOf(e.status)>-1))),t(n)}),(e=>{n(e)}))}))},D=function(){return new Promise((function(e,t){a.getRemoteBatchMachineInfos().then((t=>{e(t)}),(e=>{t(e)}))}))},v=function(t){return new Promise((function(n,o){let r=!1;var a=new i.Node({onText:i=>{e.is(i)&&(i=JSON.parse(i),e.is(i.content)&&e.is(i.content.machine===t.name)&&(r=!0,a.stop(),n({name:t.name,value:t.value,sizeJobRemained:i.content.sizeJobRemained})))},onHypervisorConnect:function(){var e={type:"informationMachine",content:{machine:t.name}};try{a.sendText(s,JSON.stringify(e))}catch(e){a.stop()}},onHypervisorDisconnect:function(){r||o("Machine info couldn't be fetched")},hypervisorUrl:"wss://"+t.name+":"+t.value,pool:"MFNBatchValidationNode"}),s=a.connect("DELPPRRemoteNode").select()}))},R=function(e){return new Promise((function(t,n){D().then((i=>{var o=i.map((e=>v(e)));e.updateMessage(c.getNLSValue("ResultingProductBatchCmdBehavior.JobStatus.ValidateConfiguredMachine")),Promise.allSettled(o).then((e=>{let i=[];e.forEach((e=>{"fulfilled"===e.status&&i.push(e.value)})),i.length>0?t(i):n()}),n)}),n)}))},C=function(e){var t=null;return e.length>0&&(e.sort(((e,t)=>e.sizeJobRemained-t.sizeJobRemained)),t=e[0]),t},b=function(i,o,r){var c=s.getReferenceModel(i),l=s.getDisplayName(c),f=e.is(o)&&e.is(o.ComputeMode)?o.ComputeMode:1,g={correlationId:t.getUUID(),operation:u,owner:n.getUser().login,mfgId:i,contextObject:l,details:"Created Job",status:"CREATED",payload:'{"pid":["'+i+'"],"param":[{"name":"ComputeMode","value":["'+f+'"]}]}',remoteMachine:r.name};return new Promise((function(e,t){a.saveJob(g).then((()=>{e(g.correlationId)}),(e=>{t(e)}))}))},N=function(t,n){return new Promise((function(o,r){a.getTicket().then((a=>{var s={type:"newJob",content:{id:t,ticket:a.ticket}};let c=!1;var l=new i.Node({onText:n=>{e.is(n)&&(n=JSON.parse(n),e.is(n.content)&&n.content.id===t&&("submitted"===n.content.status?(c=!0,l.stop(),o()):l.stop()))},onHypervisorConnect:function(){try{l.sendText(u,JSON.stringify(s))}catch(e){l.stop()}},onHypervisorDisconnect:function(){c||r()},hypervisorUrl:"wss://"+n.name+":"+n.value,pool:"MFNBatchJobNode_"+t}),u=l.connect("PoolDELPPRBatchNode").select()}),r)}))},k=function(t,n,i){var o=t+" : "+c.getNLSValue(n);e.is(i)&&(o=o+" : "+i),r.info(o)},A=function(t,n,i){var o=t+" : "+c.getNLSValue(n);e.is(i)&&(o=o+" : "+i),r.warn(o)},F=function(t){var n,i,o;return i=new d("div",{class:"RPBatchUI-StatusDialog-Container"}),new I({shape:"spinner"}).inject(i),(o=new e.Element("div",{class:"statusLabel",text:""})).inject(i),(n=new m({immersiveFrame:g.getImmersiveFrame(),title:t,domId:"RPBatchUI-StatusDialog",content:i,resizableFlag:!0,modalFlag:!0,width:500,visibleFlag:!0,closeButtonFlag:!1})).close=function(){e.is(i)&&i.destroy(),this.destroy(),n=null},n.updateMessage=function(e){o.setText(e)},n},{listenTo:function(){return{ComputeResultingProduct:this.launchResultingProductBatchCmd}},launchResultingProductBatchCmd:function(t){var n,i,o,r,a;n=s.getPPRType(t),e.is(n)&&"PROCESS"===n&&(i=s.getReferenceModel(t),o=s.getDisplayName(i),r=c.getNLSValue("ResultingProductBatchCmdBehavior.JobIdentifier",{mfgItem:o}),L(t).then((n=>{Array.isArray(n)&&n.length>0?A(r,"ResultingProductBatchCmdBehavior.ErrorMessage.JobAlreadyExists"):y(t).then((n=>{(a=F(r)).updateMessage(c.getNLSValue("ResultingProductBatchCmdBehavior.JobStatus.FetchConfiguredMachineInfos")),R(a).then((i=>{a.updateMessage(c.getNLSValue("ResultingProductBatchCmdBehavior.JobStatus.SelectingMachine"));let o=C(i);e.is(o)?(a.updateMessage(c.getNLSValue("ResultingProductBatchCmdBehavior.JobStatus.SavingJobInfos")),b(t,n,o).then((e=>{a.updateMessage(c.getNLSValue("ResultingProductBatchCmdBehavior.JobStatus.SubmittingJobInfos")),N(e,o).then((()=>{a.close(),k(r,"ResultingProductBatchCmdBehavior.SuccessMessage.JobSubmitted")}),(e=>{a.close(),A(r,"ResultingProductBatchCmdBehavior.ErrorMessage.IssueSubmittingJob",e)}))}),(e=>{a.close(),A(r,"ResultingProductBatchCmdBehavior.ErrorMessage.IssueSavingJob",e)}))):(a.close(),A(r,"ResultingProductBatchCmdBehavior.ErrorMessage.NoActiveMachineExists"))}),(e=>{a.close(),A(r,"ResultingProductBatchCmdBehavior.ErrorMessage.NoMachinesConfigured",e)}))}))}),(e=>{A(r,"ResultingProductBatchCmdBehavior.ErrorMessage.NoMachinesConfigured",e)})))}}}}})),define("DS/DELPPWModelBehaviors/InterWidgetComBehavior",["UWA/Core"],(function(e){"use strict";return{plugins:["InterWidgetComPlugin"],creator:function(e,t,n){e.getLogger();return{listenTo:function(){return{}},onStart:function(){},onStop:function(){},addEventListener:function(e,t){n.addEventListener(e,t)},subscribeEvent:function(e,t){n.subscribeEvent(e,t)},publishEvent:function(e,t){n.publishEvent(e,t)},isWidgetLinked:function(e){return n.isWidgetLinked(e)},isOpsViewerWidgetLinked:function(){return n.isOpsViewerWidgetLinked()},getOpViewerWidgetAppId:function(){return n.getOpViewerWidgetAppId()},isCloud:function(){return n.isCloud()}}}}})),define("DS/DELPPWModelBehaviors/DocumentBehavior",[],(function(){"use strict";return{plugins:["DocumentPlugin","ResourcePlugin","DicoPlugin","PlatformPlugin"],creator:function(e,t,n,i,o,r){var a,s;return a=function(e,n,i){i=i||{},t.info(n),t.notify("stopProgress",e),UWA.is(i.onComplete,"function")&&i.onComplete.call(null,n)},s=function(e,n,i,o){o=o||{},UWA.is(i)&&UWA.is(i.message,"string")&&(n+="\n"+i.message),t.warn(n),t.notify("stopProgress",e),UWA.is(o.onFailure,"function")&&o.onFailure.call(null,n)},{listenTo:function(){return{}},onStart:function(){},onStop:function(){},getDocumentTypes:function(){return n.getDocumentTypes()},getDocumentsPolicies:function(e){n.getDocumentsPolicies({onComplete:function(t){e(t)},onFailure:function(){t.warn(i.getNLSValue("Document.FetchDocPolicyFailed"))}})},getDocument:function(e){return n.getDocument(e)},isDocConnection:function(e){return n.isDocConnection(e)},addDocumentConnection:function(e,t,i,o){return n.addDocumentConnection(e,t,i,o)},addDocument:function(e,t){return n.addDocument(e,t)},uploadDocument:function(e,o,r,c){var l,u=this,f=r.shift(),g={},d={};t.notify("startProgress",g),l=function(l){var f=l[0],m={id:f},p=UWA.is(o.relInfo)?o.relInfo.parentRelName:null;n.addDocumentConnection(e,f,p),u.attachFile(m,r,{silent:!0,onComplete:function(){a(g,i.getNLSValue("Document.UploadDocSucceeded",{document:o.title})),UWA.is(c)&&c()},onFailure:function(){s(g,i.getNLSValue("Document.UploadDocPartialSuccess",{document:o.title}))}}),t.notify("documentAttached",d)},u.attachFile(o,f,{silent:!0,onComplete:l,onFailure:function(e){s(g,i.getNLSValue("Document.UploadDocFailed",{message:UWA.Json.encode(UWA.result(e,"message"))}))}})},attachDocuments:function(e,r){var c={},l={};t.notify("startProgress",c),n.getDocumentInfo(r,{onComplete:function(r){var u,f,g;for(u=0;u<r.data.length;u++)f=r.data[u],g={onComplete:function(){n.addDocument(this),n.addDocumentConnection(e,this.id),a(c,i.getNLSValue("Document.UploadDocSucceeded",{document:this.dataelements.title})),t.notify("documentAttached",l)}.bind(f),onFailure:function(e){s(c,i.getNLSValue("Document.UploadDocFailed",{message:UWA.Json.encode(UWA.result(e,"message"))}))}},"DOCUMENT"!==o.getPPRType(f.type)?t.warn(i.getNLSValue("Document.SelectionNotSupported",{type:f.type})):n.linkWithDocumentID(e,f.id,g)},onFailure:function(e){s(c,i.getNLSValue("Document.UploadDocFailed",{message:UWA.Json.encode(UWA.result(e,"message"))}))}})},fetchDocuments:function(e,i){n.getDocumentID(e,{onComplete:function(o){if(Array.isArray(o)&&o.length>0){const r=new Set;o.forEach((e=>{r.add(e.PID)})),n.getDocumentInfo([...r],{onComplete:function(r){var a,s=[];for(n.getConnectedDocumentPIDs(e).forEach((function(t){const[i,,o]=t.split("|");n.removeDocumentConnection(e,o,i,{silent:!0})})),a=0;a<r.data.length;a++){const e=r.data[a];s.push(n.addDocument(e))}o.forEach((t=>{n.addDocumentConnection(e,t.PID,t.type,{silent:!0})})),t.notify("documentAdded",[[e]]),i(s)},onFailure:function(){i()}})}else 0===o.length&&i(o)},onFailure:function(){i()}})},downloadDocument:function(e){var o=n.getDocument(e),r={};t.notify("startProgress",r),n.downloadDocuments(e,{onComplete:function(){a(r,i.getNLSValue("Document.DownloadDocSucceeded",{document:o.get("dataelements").title}))},onFailure:function(e){s(r,i.getNLSValue("Document.DownloadDocFailed",{document:o.get("dataelements").title,message:UWA.Json.encode(UWA.result(e,"message"))}))}})},deleteDocument:function(e,o){var r=n.getDocument(o),c={};t.notify("startProgress",c),n.deleteLink(e,o,{onComplete:function(){n.removeDocumentConnection(e,o),0===n.getDocumentConnectionsByDocID(o).length&&n.removeDocument(o),a(c,i.getNLSValue("Document.DeleteDocLinkSucceeded",{document:r.get("dataelements").title}))},onFailure:function(e){s(c,i.getNLSValue("Document.DeleteDocLinkFailed",{document:r.get("dataelements").title,message:UWA.Json.encode(UWA.result(e,"message"))}))}})},attachFile:function(o,r,c){var l,u,f,g=[],d={};if(c=c||{},r=UWA.is(r,"array")?r:[r],UWA.is(c.silent,"boolean")&&c.silent||t.notify("startProgress",d),!UWA.is(o.id)&&r.length>1)return e.getLogger().debug("if documentID is not provided only one file can be added"),void(UWA.is(c.onFailure)&&c.onFailure());for(l=0;l<r.length;l++)f=r[l],u=new Promise(function(e,t){n.attachFile(this.docInfo,this.fileInfo,{onComplete:function(t){var i;UWA.is(o.id)?(i=n.getDocument(o.id)).addFile(t.data[0].relateddata.files[0]):i=n.addDocument(t.data[0]),e(i.id)},onFailure:function(e){t(e)}})}.bind({docInfo:o,fileInfo:f})),g.push(u);Promise.all(g).then((function(e){UWA.is(c.silent,"boolean")&&c.silent?UWA.is(c.onComplete)&&c.onComplete(e):a(d,i.getNLSValue("Document.AttachFileSuccess"))}),(function(e){UWA.is(c.silent,"boolean")&&c.silent?UWA.is(c.onFailure)&&c.onFailure(e):s(d,i.getNLSValue("Document.AttachFileFailed")+UWA.Json.encode(UWA.result(e,"error")))}))},downloadFile:function(e,o,r){var c={};t.notify("startProgress",c),n.downloadFile(e,o,{onComplete:function(){a(c,i.getNLSValue("Document.DownloadFileSucceeded",{file:r}))},onFailure:function(e){s(c,i.getNLSValue("Document.DownloadFileFailed",{file:r,message:UWA.Json.encode(e)}))}})},modifyFile:function(e,o,r){var c={};t.notify("startProgress",c),n.modifyFile(e,o,{onComplete:function(o){n.getDocument(e.id).modifyFile(o.data[0].relateddata.files[0]),a(c,i.getNLSValue("Document.ModifyFileSucceeded",{file:r})),t.notify("editDocument",{})},onFailure:function(e){s(c,i.getNLSValue("Document.ModifyFileFailed",{file:r,message:UWA.Json.encode(e)}))}})},removeFile:function(e,o){var r={};t.notify("startProgress",r),n.removeFile(e,o,{onComplete:function(){n.getDocument(e).removeFile(o),a(r,i.getNLSValue("Document.RemoveFileSuccess"))},onFailure:function(e){s(r,i.getNLSValue("Document.RemoveFileFailure")+UWA.Json.encode(e))}})},viewFile:function(e,t,o){n.fetchFileURL(e,t,{onComplete:function(e){window.open(e,i.getNLSValue("Document.ViewFile",{title:o}),"fullscreen=no")}})},getFileCommands:function(){return r.isCloud()?{document:{authoring:["Download","Update","Delete"],nonAuthoring:["Download"]},file:{authoring:["DownloadFile","ModifyFile","RemoveFile","ViewFile"],nonAuthoring:["DownloadFile","ViewFile"]}}:{document:{authoring:["Download","Update","Delete","Explore"],nonAuthoring:["Download","Explore"]},file:{authoring:["DownloadFile","ModifyFile","RemoveFile","ViewFile"],nonAuthoring:["DownloadFile","ViewFile"]}}},removeDocumentConnection:function(e,t,i,o){return n.removeDocumentConnection(e,t,i,o)},getConnectedDocumentPIDs:function(e){return n.getConnectedDocumentPIDs(e)}}}}})),define("DS/DELPPWModelBehaviors/AppPreferencesBehavior",["UWA/Core"],(function(e){"use strict";return{plugins:["PlatformPlugin"],creator:function(t,n,i){var o;return o=function(i){var o=t.getService(i);return e.is(o)||n.debug("Requested service ia not avilable : "+i),o},{getConfigurationPID:function(){var n="",r=e.is(t.getConfig())&&e.is(t.getConfig().widgetTrigram,"string")?t.getConfig().widgetTrigram:"",a=o("ConfigService");return e.is(a)&&(n=a.getConfigurationPID()),""===n&&(n=i.getVariable("app."+r+".customParametersSetPhysicalID","string","")),n},isUsingInputValueKF:function(){return i.isUsingInputValueKF()},getWKILTHOptions:function(){return i.getWKILTHOptions()},isWKILTHLAEnabled:function(){return i.isWKILTHLAEnabled()}}}}})),define("DS/DELPPWModelBehaviors/ResourceBehavior",[],(function(){"use strict";return{plugins:["ResourcePlugin"],creator:function(e,t,n){return{onStart:function(){},onStop:function(){},getNLSValue:function(e,t,i,o){return n.getNLSValue(e,t,i,o)},getLabelForUnit:function(e,t){return n.getLabelForUnit(e,t)},getNLSForUnit:function(e,t){return n.getNLSForUnit(e,t)},getIconURLFromKey:function(e,t,i){return n.getIconURLFromKey(e,t,i)},getIconElem:function(e,t){return n.getIconElem(e,t)}}}}})),define("DS/DELPPWModelBehaviors/Mutex",["UWA/Core"],(function(e){"use strict";return function(){var t=!1,n=[];return{acquire:function(){var i=e.Promise.deferred();return t?n.push(i):(t=!0,i.resolve()),i.promise},release:function(){var i=null;t&&(n.length>0?i=n.shift():t=!1),e.is(i)&&i.resolve()},destroy:function(){for(;n.length>0;)n.shift().resolve()}}}})),define("DS/DELPPWModelBehaviors/UserDefProceduresBehaviour",["UWA/Core"],(function(e){"use strict";const t="system",n="workplan",i="process",o="resource",r="product";return{plugins:["WebServicePlugin","DatabasePlugin","RootsPlugin","PlatformPlugin","ResourcePlugin","DicoPlugin"],creator:function(a,s,c,l,u,f,g,d){var m,p={ProcDisplayName:g.getNLSValue("UserDefExploreBehavior.DefaultBehavior.ProcDisplayName"),ProcID:"default",ProcShortDescription:g.getNLSValue("UserDefExploreBehavior.DefaultBehavior.ProcShortDescription")},h=[],P=new Set,I={default:"DSForAllUsers",sample:"",inWork:""},S=function(e){return d.isAKindOf(e,"DELLmiWorkPlanSystemReference")||d.isAKindOf(e,"DELLmiServiceWorkPlanSystemReference")||d.isAKindOf(e,"DELLmiHeaderWorkPlanReference")||d.isAKindOf(e,"DELLmiServiceHeaderWorkPlanReference")},y=function(t,n){var i,o=[];return i=s.getPreferenceValue("UDE_Default_Procedures"),e.is(i)&&(I.default=i?"DSForAllUsers":""),i=s.getPreferenceValue("UDE_Sample_Procedures"),e.is(i)&&(I.sample=i?"Sample":""),i=s.getPreferenceValue("UDE_InWork_Procedures"),e.is(i)&&(I.inWork=i?"DEV":""),1===t.size&&e.is(n)&&n.length>0?o=n.filter((function(e){var n=!1;if("OBSOLETE"!==e.ProcVisibility&&"WIN"!==e.ProcWinWeb){let i;switch(e.ProcNodeType){case"EBOM":i=["PRODUCT"];break;case"MBOM":i=["PROCESS","SERVICE","CONSTRUCTION"];break;case"Workplan":i=["WORKPLAN","OPERATION"];break;case"System":i=["SYSTEM"];break;case"Resource":i=["RESOURCE"];break;case"Any":i=["ALL"];break;default:i=[]}if(Array.isArray(i)){const o=i.includes(Array.from(t)[0])||i.includes("ALL"),r=[I.default,I.sample,"Custo"].includes(e.ProcCategory),a=e.ProcVisibility===I.inWork||"DEV"!==e.ProcVisibility;n=r&&a&&o}}return n})):console.error("Objects of different PPR types are selected or Procedures are not available."),function(e){e.sort(((e,t)=>{const n=e.ProcDisplayName?e.ProcDisplayName.toLowerCase():"",i=t.ProcDisplayName?t.ProcDisplayName.toLowerCase():"",o=/^[a-zA-Z]/.test(e.ProcDisplayName),r=/^[a-zA-Z]/.test(t.ProcDisplayName);return o&&!r?-1:!o&&r?1:n.localeCompare(i)}))}(o),o.unshift(p),o};return{getProcedures:function(t){var n=function(e){var t,n,i=!1;return m=[],P.clear(),e.forEach((function(e){e.forEach((function(e){switch(t=l.getPPRType(e.id)){case"OPERATION":case"SYSTEM":if(e.path.length>0){let t=l.getParentReferenceIdFromInstance(e.path[0]);i=S(l.getReferenceModel(t))}else i=S(l.getReferenceModel(e.id));t=i?"WORKPLAN":"SYSTEM";break;case"WORKINSTRUCTION":if(t="SYSTEM",e.path.length>0){let n=l.getParentReferenceIdFromInstance(e.path[0]);i=S(l.getReferenceModel(n)),t=i?"WORKPLAN":"SYSTEM"}}n=l.transformToRIROccurrencePath(e.path).length>0?l.transformToRIROccurrencePath(e.path):[e.id],h.push(e.id),m.push({type:t,path:n}),P.add(t)}))})),P}(t);return new e.Promise((function(t){var i,o;c.webServiceRequest({url:"delmcb/api/UDOWebServices/GetProcedureList",method:"GET",onFailure:function(e){s.debug("GetProcedureList Failed "+e),t([p])},onComplete:function(r){i=e.is(r)&&e.is(r.Scenarios)?r.Scenarios:[],o=y(n,i),t(o)}})}))},executeProcedure:function(a,f,d){var p,P,I,S,y={},L=d||{},D=function(a,c){var f,g,d,p={workplan:[],process:[],resource:[],product:[]};return g={workplan:{path:[],rootPID:"",configId:""},process:{path:[],rootPID:"",configId:""},product:{path:[],rootPID:"",configId:""},resource:{path:[],rootPID:"",configId:""}},f=function(t,n){g[t].path.push({pids:n}),g[t].rootPID=n[0],e.is(u.getCompatibleConfigurationFilters([n[0]]))&&(g[t].configId=u.getCompatibleConfigurationFilters([n[0]])[n[0]])},d=function(a){var s="";switch(l.getPPRType(a)){case"PROCESS":case"SERVICE":s=i;break;case"PRODUCT":s=r;break;case"RESOURCE":s=o;break;case"OPERATION":s=n;break;case"SYSTEM":s=t}e.is(p[s])&&p[s].push({compiledForm:"",configuration:g[s].configId,rootId:a,volume:""})},m.forEach((function(e){switch(e.type){case"PROCESS":case"SERVICE":f(i,e.path);break;case"PRODUCT":f(r,e.path);break;case"RESOURCE":f(o,e.path);break;case"SYSTEM":f(t,e.path);break;case"WORKPLAN":case"OPERATION":f(n,e.path);break;default:s.debug("Invalid Type")}})),u.getRoots(s.getId()).forEach((function(e){Array.isArray(e)&&e.forEach((function(e){d(e)}))})),'<execute xmlns="http://www.3ds.com/xmql/query"><function>'+a+"</function><version>"+c+'</version><params><param name="SEL_WK_PL">{"modelerName":"workplan","occurrences":'+JSON.stringify(g.workplan.path)+'}</param><param name="SEL_PRCS">{"modelerName":"process","occurrences":'+JSON.stringify(g.process.path)+'}</param><param name="SEL_PRD">{"modelerName":"product","occurrences":'+JSON.stringify(g.product.path)+'}</param><param name="SEL_RSC">{"modelerName":"resource","occurrences":'+JSON.stringify(g.resource.path)+'}</param><param name="SEL_PROD_SYS">{"modelerName":"productionSystem","occurrences":'+JSON.stringify(g.workplan.path)+'}</param><param name="SEL_CPBL_RSC">{"modelerName":"resource","occurrences":'+JSON.stringify(g.resource.path)+'}</param><param name="PRD">{"modelerName":"product","occurrences":'+JSON.stringify(g.product.path)+'}</param><param name="PROD_SYS">{"modelerName":"productionSystem","occurrences":'+JSON.stringify(g.workplan.path)+'}</param><param name="WK_PL">{"modelerName":"workplan","occurrences":'+JSON.stringify(g.workplan.path)+'}</param><param name="RSC">{"modelerName":"resource","occurrences":'+JSON.stringify(g.resource.path)+'}</param><param name="PRCS">{"modelerName":"process","occurrences":'+JSON.stringify(g.process.path)+'}</param><param name="CPBL_RSC">{"modelerName":"capableResource","occurrences":'+JSON.stringify(g.resource.path)+'}</param><param name="ConfigurationsVal">[{"filters":'+JSON.stringify(p.product)+',"modelerName":"product"},{"filters":'+JSON.stringify(p.process)+',"modelerName":"process"},{"filters":'+JSON.stringify(p.workplan)+',"modelerName":"workplan"},{"filters":[{"compiledForm":"","configuration":'+JSON.stringify(g.workplan.configId)+',"rootId":'+JSON.stringify(g.workplan.rootPID)+',"volume":""}],"modelerName":"productionSystem"},{"filters":'+JSON.stringify(p.resource)+',"modelerName":"resource"},{"filters":[{"compiledForm":"","configuration":'+JSON.stringify(g.resource.configId)+',"rootId":'+JSON.stringify(g.resource.rootPID)+',"volume":""}],"modelerName":"capableResource"}]</param></params></execute>'}(a,f);s.notify("startProgress",y),I=function(t){var n=[],i=[],o=e.is(t.xmql_response.footer["global error"])?t.xmql_response.footer["global error"]:null,r=t.xmql_response.body.result;e.is(r)&&null===o?(r.forEach((function(e){Object.keys(e).length>0&&e.output.occurrences.forEach((function(e){i.push(e.pids),e.pids.forEach((function(e){-1===n.indexOf(e)&&n.push(e)}))}))})),p=function(e){var t,o,r,a,c=[],u=[],f=[],g=[];a=function(){s.notify("addOccurrece",[i]),r.length>0&&s.notify("selectNodes",[r])},h.forEach((e=>{t=l.getPPRType(e),-1===u.indexOf(t)&&u.push(t),l.getImpacted(e,!0,{excludeRelationTypes:["LinearProductFlowCnx"]}).forEach((function(e){e=Array.isArray(e)?e:[e],-1!==n.indexOf(e[e.length-1])&&c.push(e[e.length-1])}))})),h=[],L.selectConnectedObjects&&(r=[],c.forEach((e=>{u.includes(l.getPPRType(e))||r.push(e)}))),e.instancesAndReferences.forEach((e=>{f.push(e.id)})),(o=n.filter((e=>!f.includes(e)))).length>0?(o.forEach((e=>{l.isInstance(e)||g.push(e)})),g.length>0?l.fetchInstancesAndTheirReferences(g,{onComplete:function(e){a()},silentMode:"true"}):a()):a(),s.notify("stopProgress",y)},P=function(){s.debug("Fetching getDescendantsFromServer for user defined procedure failed.")},l.getDescendantsFromServer(n,p,{onFailure:P,silentMode:!0,expandLevel:0,forceDBMode:!0})):(s.notify("stopProgress",y),o=(o=JSON.parse(o).MESSAGE).substr(o.lastIndexOf(":")+1),s.warn(o))},S=function(){s.notify("stopProgress",y),s.warn(g.getNLSValue("UserDefExploreBehavior.ExecuteProc.Failure"))},c.webServiceRequest({url:c.get3DSpaceUrl()+"i3dx/services/xmql",method:"POST",data:D,headers:{Accept:"application/json","Content-Type":"application/xml"},onComplete:I,onFailure:S,onTimeout:S,onCancel:S})}}}}})),define("DS/DELPPWModelBehaviors/LinkBehavior",["UWA/Core","UWA/Promise"],(function(e,t){"use strict";return{plugins:["DatabasePlugin","DicoPlugin","WebServicePlugin","AttributePlugin","ResourcePlugin","ProductImplementPlugin","ProcessImplementPlugin","SelectionPlugin","PlatformPlugin"],creator:function(n,i,o,r,a,s,c,l,u,f,g){const d="ProductImplementLink",m="ProductImplementLinkOcc",p="DELMBOMContextualImplementCnx",h=l.getPartialScopeLinkType(),P="ProcessImplementLink",I="PartialProcessImplementLink",S="ProcessImplementLinkOcc",y="ResultingProductLink",L="DELLmiProductionSystemOutputCnxToMBOM",D="CapableResourcesStructureLink",v="DELAsmProcessCanUseCnx",R="SecondaryCandidateResourceLink",C="MfgProcessAlternate",b="HistorizationLinkRefRef",N="DELLmiTimeConstraintCnx",k="DELLmiMaterialPathCnxCust",A="DELMfgResponsibilityCnx",F="DELFmiMfgSubstituteCnx",M="PLMReqSpecifyHowToCnx",E="DELAssetsStructureLink",O="AllocatedResourceLink",T=["DELLmiServiceWorkPlanOperationalReference","DELLmiServiceWorkPlanRectifyingReference","DELLmiServiceWorkPlanSupportingTaskReference"];var V,w,U,B,x,W,j,J,_,K,H,q,Y,z,Q,G;return U=function(t,n,o,r){o=o||{},e.is(n,"string")&&i.info(n,r),i.notify("stopProgress",t),e.is(o.onComplete,"function")&&o.onComplete.call(null,n)},B=function(t,n,o,r,a){r=r||{},e.is(o,"string")&&(n+="\n"+o),e.is(n,"string")&&(i.warn(n,a),i.debug(n)),i.notify("stopProgress",t),e.is(r.onFailure,"function")&&r.onFailure.call(null,n)},x=function(t){return new e.Promise((function(n){var r=[],a=function(t){var n,i;-1===r.indexOf(t)&&(n=o.getInstance(t),i=t,e.is(n)&&(i=n.get("isInstanceOf"),o.needToQueryForConnections(t)&&r.push(t)),-1===r.indexOf(i)&&o.needToQueryForConnections(i)&&r.push(i))};o.isNavigateOnDemand()||n({impactedList:[],relationsLoaded:!0}),(e.is(t)?t:f.getModuleSelections(i.getId())).forEach((function(e){a(e.id),Array.isArray(e.path)&&e.path.forEach((function(e){a(e)}))})),r.length>0?o.getConnectionsFromServer(r,(function(t){e.is(t)&&Array.isArray(t.connections)&&t.connections.length>0&&i.notify("connectionAdded",[t.connections]),n({impactedList:r,result:t,relationsLoaded:!0})})):n({impactedList:r,relationsLoaded:!0})}))},W=function(e){return x(e).then((function(e){var t=e.impactedList;t.length>0&&(i.notify("refreshImpacted",{impactedChildren:[],impactedObjects:t}),i.getBehavior("RefreshBehavior").onRefreshSelected({impactedChildren:[],impactedObjects:t}))}))},j=function(){return e.is(V)||(V=i.getBehavior("ProductImplementBehavior")),V},J=function(){return e.is(w)||(w=i.getBehavior("ProcessImplementBehavior")),w},_=function(t){var n,i,a,s,l,u=!0,f={};return e.is(t.fromSideRefPID)&&e.is(t.toSideRefPID)?(n=t.fromSideRefPID,i=t.toSideRefPID,a=o.getReference(n),s=o.getReference(i)):(u=!1,l=c.getNLSValue("LinkBehavior.canCreateOutputLinkError.InsufficentInfo")),u&&(r.isAKindOf(s,"Provide")||r.isAKindOf(a,"DELLmiHeaderWorkPlanReference")||r.isAKindOf(a,"DELLmiQtyControlProcessReference")||r.isAKindOf(a,"DELLmiServiceHeaderWorkPlanReference")?(u=!1,l=c.getNLSValue("LinkBehavior.canCreateOutputLinkError.ObjectTypeDoesntSupport")):o.hasConnection({from:n,to:i,type:L})&&(u=!1,l=c.getNLSValue("LinkBehavior.canCreateOutputLinkError.LinkAlreadyExists"))),f={canCreateLink:u},u?f.data=e.merge({type:L,IDFrom:t.fromSideRefPID,IDTo:t.toSideRefPID,displayText:c.getNLSValue(L,null,"CreateLink"),buttonIdentifier:c.getNLSValue(L,null,"CreateLink")},e.clone(t)):f.errorMessage=l,f},K=function(t){var n,i,a,s,l,u=!0,f={};return e.is(t.fromSideRefPID)&&e.is(t.toSideRefPID)?(i=t.fromSideRefPID,a=t.toSideRefPID,s=o.getReference(i),l=o.getReference(a)):(u=!1,n=c.getNLSValue("LinkBehavior.canCreateOriginateLinkError.InsufficentInfo")),u&&(o.hasConnection({from:i,to:a,type:b})||o.hasConnection({from:a,to:i,type:b})?(u=!1,n=c.getNLSValue("LinkBehavior.canCreateOriginateLinkError.LinkAlreadyExists")):(r.isAKindOf(s,"DELLmiHeaderWorkPlanReference")||r.isAKindOf(l,"DELLmiHeaderWorkPlanReference")||r.isAKindOf(s,"DELLmiServiceHeaderWorkPlanReference")||r.isAKindOf(l,"DELLmiServiceHeaderWorkPlanReference"))&&(u=!1,n=c.getNLSValue("LinkBehavior.canCreateOriginateLinkError.ObjectTypeDoesntSupport"))),f={canCreateLink:u},u?f.data=e.merge({type:b,IDFrom:i,IDTo:a,displayText:c.getNLSValue(b,null,"CreateLink"),buttonIdentifier:c.getNLSValue(b,null,"CreateLink")},e.clone(t)):f.errorMessage=n,f},H=function(t){let n,i,o=M,r=!0,a="",s={};return e.is(t.fromSideRefPID)&&e.is(t.toSideRefPID)?(n=t.fromSideRefPID,i=t.toSideRefPID):(r=!1,a=c.getNLSValue("LinkBehavior.canCreateRequirementLinkError.InsufficentInfo")),r||(s.errorMessage=a),s={canCreateLink:r},s.data=e.merge({type:o,IDFrom:n,IDTo:i,displayText:c.getNLSValue(o,null,"CreateLink"),buttonIdentifier:c.getNLSValue(o,null,"CreateLink")},e.clone(t)),s},q=function(t){var n,i,r,a=!0,s={};if(e.is(t.fromSideRefPID)&&e.is(t.toSideRefPID)){n=t.fromSideRefPID,i=t.toSideRefPID;o.hasConnection({from:n,to:i,type:C})&&(a=!1,r=c.getNLSValue("LinkBehavior.canCreateAlternateLinkError.LinkAlreadyExists"))}else a=!1,r=c.getNLSValue("LinkBehavior.canCreateAlternateLinkError.InsufficentInfo");return s={canCreateLink:a},a?s.data=e.merge({type:C,IDFrom:n,IDTo:i,displayText:c.getNLSValue(C,null,"CreateLink"),buttonIdentifier:c.getNLSValue(C,null,"CreateLink")},e.clone(t)):s.errorMessage=r,s},Y=function(t){var n,i,r,a=!0,s={};return e.is(t.fromSideRefPID)&&e.is(t.toSideRefPID)?(n=t.fromSideRefPID,i=t.toSideRefPID,o.hasConnection({from:n,to:i,type:A})&&(a=!1,r=c.getNLSValue("LinkBehavior.canCreateMfgResponsibilityLinkError.LinkAlreadyExists"))):(a=!1,r=c.getNLSValue("LinkBehavior.canCreateMfgResponsibilityLinkError.InsufficentInfo")),s={canCreateLink:a},a?s.data=e.merge({type:A,IDFrom:n,IDTo:i,displayText:c.getNLSValue(A,null,"CreateLink"),buttonIdentifier:c.getNLSValue(A,null,"CreateLink")},e.clone(t)):s.errorMessage=r,s},z=function(t){var n,i,r,a=!0,s={};return e.is(t.fromSideAbsPath)&&e.is(t.toSideRefPID)?(n=t.toSideRefPID,e.is(t.fromSideAbsPath,"array")&&t.fromSideAbsPath.length>0?(i=t.fromSideAbsPath[t.fromSideAbsPath.length-1],o.hasConnection({from:i,to:n,type:F})&&(a=!1),r=o.getInstance(i),o.getReferenceModelFromInstance(r).get("PID")===n&&(a=!1),e.is(t.IDFrom)&&(t.IDFrom=i)):a=!1):a=!1,s={canCreateLink:a},a&&(s.data=e.merge({type:F,IDFrom:i,IDTo:n,displayText:c.getNLSValue(F,null,"CreateLink"),buttonIdentifier:c.getNLSValue(F,null,"CreateLink")},e.clone(t))),s},Q=function(t,n){var o,r=i.getBehavior("ProductFlowLinkBehavior"),a=i.getBehavior("CapableResourceLinkBehaviour");switch(e.is(t.type)?t.type:n){case d:o=l.canCreateScopeLink(t);break;case m:o=l.canCreateImplementLink(t);break;case h:o=l.canCreatePartialScopeLink(t);break;case P:o=u.canCreateScopeLink(t);break;case S:o=u.canCreateImplementLink(t);break;case y:o=l.canCreateResultingProductLink(t);break;case L:o=_(t);break;case C:o=q(t);break;case b:o=K(t);break;case v:o=a.canCreatePrimaryCapableRscLink(t);break;case R:o=a.canCreateSecondaryCapableRscLink(t);break;case E:o=a.canCreateAssetsStructureLink(t);break;case O:o=a.canCreatePreassignedWorkcenterLink(t);break;case N:case k:o=r.canCreateProductFlowLink(t,n);break;case A:o=Y(t);break;case F:o=z(t);break;case M:o=H(t);break;default:o={canCreateLink:!1}}return o},G=function(n,r){var a,s,c,l,u=j(),f=J(),g=i.getBehavior("ProductFlowLinkBehavior"),d=i.getBehavior("CapableResourceLinkBehaviour");return new t((function(t,i){var p=function(e){t(e)},h=function(e){i(e)};switch(n.type){case m:u.createImplementLink(n,r,p,h);break;case S:f.createImplementLink(n,r,p,h);break;case v:case R:case E:case O:d.createConnection(n,r,p,h);break;case N:case k:g.createProductFlowLink(n,r,p,h);break;default:s={linkType:n.type,target:n.IDFrom,source:n.IDTo},c=function(){e.is(p,"function")&&p(s)},l=function(t,n){e.is(n)&&e.is(n.message)&&(s.errorMessage=n.message),e.is(h,"function")&&h(s)},(a=Q(n)).canCreateLink?(r=r||{},o.createConnection({IDFrom:n.IDFrom,IDTo:n.IDTo,type:n.type},e.merge({onFailure:l,onTimeout:l,onCancel:l,onComplete:c},r))):(s.errorMessage=a.errorMessage,l())}}))},{listenTo:function(){return{LoadRelations:function(e){var t;return Array.isArray(e)&&(t=e),W(t)}}},onStart:function(){},onStop:function(){},getPossibleRelationTypes:function(t){var n=e.is(t.fromSideRefPID)?o.getReference(t.fromSideRefPID):null,a=e.is(t.toSideRefPID)?o.getReference(t.toSideRefPID):null,s=e.is(n)?n.get("type"):null,c=e.is(a)?a.get("type"):null,l={};return e.is(s)&&e.is(c)?(r.getPossibleRelations(s,c,"write").forEach((function(n){var i={};(i=Q(t,n)).canCreateLink&&(delete i.canCreateLink,i.data=e.is(i.data,"array")?i.data:[i.data],l[n]=i)})),l):(i.debug("No Types on models"),[])},canCreatePartialScopeLink:function(e){return u.canCreatePartialScopeLink(e)},isLinkPossible:function(e,t,n,i){return r.isLinkPossible(e,t,n,i)},isRelationTypeConfiguredForPPRTypes:function(e,t,n,i){const o=r.getConfiguredRelations(t,n,i);return Array.isArray(o)&&o.indexOf(e)>-1},webServiceRequest:function(e){a.webServiceRequest(e)},getConnection:function(e){return o.getConnection(e)},isExploreWebAppEnabled:function(){return g.isCloud()?!g.isCloud():"true"===localStorage.getItem("isExploreWebAppEnabled")},createConnectionsByType:function(e,t){var n,i=j(),o=J(),r=e.linkType,a=e.linksData;switch(r){case d:i.createScopeLink(a,t);break;case h:(n=a[0]).cmdAction=i.PartialScopeAction.CREATE_PARTIALSCOPE,i.managePartialScopeLink(n,t);break;case P:o.createScopeLink(a,t);break;default:this.createConnection(a,t)}},createConnection:function(n,r){var a,s={},l=[];e.is(n)&&e.is(n,"array")&&(i.notify("startProgress",s),a=i.log(c.getNLSValue("CreateLink.LogMessage")),l=n.map((function(e){return G(e,r)})),t.allSettled(l).then((function(t){var n=0,l={},u={},f={success:l,failed:u};t.forEach((function(t){var o,r;"rejected"===t.state?(n++,r=u,o=t.reason,e.is(o.errorMessage,"string")&&i.debug(o.linkType+" creation failed :  "+o.errorMessage)):(r=l,o=t.value),e.is(r[o.linkType])||(r[o.linkType]={}),e.is(r[o.linkType][o.target])||(r[o.linkType][o.target]=[]),r[o.linkType][o.target].push({errorMessage:o.errorMessage,source:o.source})})),Object.keys(f).forEach((function(e){var t="success"===e,n=t?"CreateLink.Success":"CreateLink.Failure",r=f[e];Object.keys(r).forEach((function(e){var s=r[e];Object.keys(s).forEach((function(r){var l,u,f=s[r],g=[],d=o.getReferenceModel(r),m=o.getDisplayName(d);u=[],f.forEach((function(e){var t=e.source,n=o.getReferenceModel(t);e.errorMessage&&u.push(e.errorMessage),g.push(o.getDisplayName(n))})),u=u.join(", "),l=c.getNLSValue(n,{linkType:c.getNLSValue(e),target:m,source:g.join(", ")}),l=u.length>0?l+" "+u:l,t?i.info(l,a):(i.warn(l,a),i.debug(l))}))}))})),0===n?U(s,null,r,a):B(s,null,null,r,a)})))},createHOPMfgItemPartialScopeLink:function(e){var t,n={},o=c.getNLSValue("ImplementBehavior.CreateMGAPartialScopeLink.LogMessage");i.notify("startProgress",n),t=i.log(o),u.createHOPMfgItemPartialScopeLink(e,{onSuccess:function(e){U(n,e,null,t)},onFailure:function(e){B(n,e,null,null,t)}})},setUsagePoints:function(t,n,o){var r,a=i.log(c.getNLSValue("LinkBehavior.SetUsagePoints.LogMessage")),s={},l=this.getConnection(t),f=e.is(o)?o.get("type"):l.get("type"),g={IDFrom:l.get("from"),IDTo:l.get("to")};i.notify("startProgress",s),r={connPID:t,connectionParams:g,pathOfInstanceIds:n,implementLinkId:e.is(o)?o.get("PID"):null},e.is(r)&&e.is(f)&&u.setUsagePoints(r,f,{onSuccess:function(){f===P?U(s,c.getNLSValue("LinkBehavior.SetUsagePoints.CreateUsagePoints.SaveSucceeded"),null,a):f===S&&U(s,c.getNLSValue("LinkBehavior.SetUsagePoints.AssignImplementLink.SaveSucceeded"),null,a)},onFailure:function(e){f===P?B(s,c.getNLSValue("LinkBehavior.SetUsagePoints.CreateUsagePoints.SaveFailed"),e,null,a):f===S&&B(s,c.getNLSValue("LinkBehavior.SetUsagePoints.AssignImplementLink.SaveFailed"),e,null,a)}})},deleteUsagePoint:function(t,n){var o,r=i.log(c.getNLSValue("LinkBehavior.DeleteUsagePoint.LogMessage",{pathInstIds:n})),a={};i.notify("startProgress",a),o={pid:t,pathOfInstanceIds:n},e.is(o)&&u.deleteUsagePoint(o,{onSuccess:function(){U(a,c.getNLSValue("LinkBehavior.DeleteUsagePoint.SaveSucceeded"),null,r),i.notify("refreshImpacted"),i.notify("updateCrossHighlight")},onFailure:function(e){B(a,c.getNLSValue("LinkBehavior.DeleteUsagePoint.SaveFailed"),e,null,r)}})},unassignImplementLinkFromUsagePoints:function(t,n){var o,r=i.log(c.getNLSValue("LinkBehavior.UnassignImplementLinkFromUsagePoints.LogMessage")),a={};i.notify("startProgress",a),o={pid:t,implementLinkId:n},e.is(o)&&u.unassignImplementLinkFromUsagePoints(o,{onSuccess:function(){U(a,c.getNLSValue("LinkBehavior.UnassignImplementLinkFromUsagePoints.SaveSucceeded"),null,r),i.notify("refreshImpacted"),i.notify("updateCrossHighlight")},onFailure:function(e){B(a,c.getNLSValue("LinkBehavior.UnassignImplementLinkFromUsagePoints.SaveFailed"),e,null,r)}})},setImplementLinkToUsagePoints:function(t,n){var i,o,r=this.getConnection(t);e.is(r)&&(1===(i=u.findInstanceWhoseParentIsScoped(r.get("from")).scopeLinks).length?o=i[0]:i.length>1&&i.forEach((function(t){t.get("type")===P&&e.is(t.get("usagePoint"))&&t.get("usagePoint").includes(n[0])&&(o=t)})),e.is(o)&&(n.length>0?this.setUsagePoints(o.get("PID"),n,r):this.unassignImplementLinkFromUsagePoints(o.get("PID"),t)))},canDeleteRelation:function(t){var n,i,a,s,c,l,u=!1;return n=this.getConnection(t),e.is(n)&&((i=n.getAttribute("type"))===D?u=!1:i===R||i===k?u=!0:(a=n.getAttribute("from"),s=o.getReferenceModel(a).get("type"),c=n.getAttribute("to"),l=o.getReferenceModel(c).get("type"),u=r.isRelationTypeConfigured(i,s,l,"write"))),u},switchScope:function(t,n,o,r,a,s){var l,f,g={};f=i.log(c.getNLSValue("LinkBehavior.SwitchScope.LogMessage")),i.notify("startProgress",g),l={fromID:t,mbomRefID:n,mbomInstID:o,connectionType:r,isRefInstRefScope:a},e.is(s)&&l&&u.switchScope(l,s,{onSuccess:function(){U(g,c.getNLSValue("LinkBehavior.SwitchScope.SaveSucceeded"),null,f)},onFailure:function(e){B(g,c.getNLSValue("LinkBehavior.SwitchScope.SaveFailed"),e,null,f)}})},deleteConnection:function(t,n){var r,a,s,f,g,p={},I=o.getConnection(t),y=I.getAttribute("type"),L=c.getNLSValue(y),D=j();switch(n=n||{},i.notify("startProgress",p),s=i.log(c.getNLSValue("DeleteLink.LogMessage",{linkType:L})),r={onComplete:function(t,o){U(p,c.getNLSValue("DeleteLink.Success",{linkType:L}),n,s),e.is(t)&&e.is(t.impactedInfo)&&i.notify("updateImpactedInfoOnModel",t.impactedInfo),e.is(o)?i.notify("linkDeleted",[o.deletedConnections]):i.notify("linkDeleted",I.toJSON())},onFailure:f=function(e,t){B(p,c.getNLSValue("DeleteLink.Failure",{linkType:L}),t,n,s)},onTimeout:f,onCancel:f},a=e.extend({},n),r=e.extend(a,r),y){case d:l.deleteScopeLink(t,r);break;case P:u.deleteScopeLink(t,r);break;case m:l.isDeleteOfProductImplementLinkAllowed()?l.deleteImplementLink(t,r):B(p,c.getNLSValue("DeleteLink.ProductImplementLinkDeleteNotAllowed"),null,n,s);break;case S:u.deleteImplementLink(t,r);break;case h:if(3===(g=t.split("|")).length){r.cmdAction=D.PartialScopeAction.DELETE_PARTIALSCOPE;const[,e,t]=g;l.manageScopeAndImplementLink(e,null,t,null,r,[])}break;default:o.deleteConnection(t,r)}},addConnection:function(e,t){return o.addConnection(e,t)},updateLinkAttributes:function(t,n,r){var a,l,f,g,d,m,p,h=[],P={},I={},S={},y=i.getBehavior("ProductFlowLinkBehavior");for(n=n||{},r=r||{},a=0;a<n.length;a++)d=s.hasRangeDefined(n[a].attributeInfo,n[a].attributeDef)&&s.isInteger(n[a].attributeInfo),g=(m=n[a].objectToBeModified).get(n[a].dataIndex),f=n[a].newValue,d&&(g=s.getAuthorizedValueIndex(n[a].attributeInfo,n[a].attributeDef,g)),s.isDate(n[a].attributeInfo)&&(g=new Date(g).getTime()/1e3),g!==f&&(n[a].previousValue=g,h.push(n[a]));if(0!==h.length){for(a=0;a<h.length;a++)P[h[a].attributeName]=h[a].newValue;P=u.addCustoRoleToLinkData(P),P=u.validateQuantityToEdit(t,P),m.get("type")===N&&([P,p]=y.validateProductFlowCategory(t,P)),l={data:P,onFailure:function(t,n){var i;for(a=0;a<h.length;a++)t.set(h[a].dataIndex,h[a].previousValue);e.is(n)&&e.is(n.message,"string")&&(i=n.message),B(S,c.getNLSValue("AttributeUtil.SaveFailed"),i,r)},onComplete:function(t,n){U(S,c.getNLSValue("AttributeUtil.SaveSucceeded"),r),e.is(p)&&!p&&i.warn(c.getNLSValue("AttributeUtil.ProductFlowCategory.NotValidType")),e.is(n)&&e.is(n.impactedInfo)&&i.notify("updateImpactedInfoOnModel",n.impactedInfo),i.notify("linkAttributesModified",I),i.notify("refreshImpacted",{impactedChildren:[],impactedObjects:[]})},logMessage:c.getNLSValue("AttributeUtil.EditAttributesLogMessage")},i.notify("startProgress",S),o.updateConnection(t,l)}},getConnectionsByModel:function(e,t,n){o.getConnectionsByModel(e,t,n)},getImpactedConnections:function(e,t,n){return o.getImpacted(e,t,n)},getImpactedObjects:function(t,n,r){var a,s,c,l,u=[];return a=o.getInstance(t),e.is(a)?(s=t,c=o.getReferenceModelFromInstance(a),l=c.get("PID")):(c=o.getReference(t),l=t),o.getImpacted(t,!1,r).forEach((function(e){var t,o=J(),a=i.getBehavior("CapableResourceLinkBehaviour"),c=i.getBehavior("ProductImplementBehavior"),f=e.get("type"),g=e.get("from"),A=e.get("to");switch(f){case d:case h:case m:case p:u=u.concat(c.getImpactedObjects(l,s,n,e));break;case P:case I:case S:u=u.concat(o.getImpactedObjects(l,s,n,e));break;case D:case v:case R:case E:u=u.concat(a.getImpactedObjects(l,s,n,e,r));break;case L:case C:case b:case y:t=g===l?A:g,u.push(t);break;case F:t=g===s?A:g,u.push(t);break;case N:case k:break;default:console.log("Invalid Type")}})),u},getConnectedObjects:function(t,n,r){var a,s,c,l,u,f,g=J(),A=i.getBehavior("CapableResourceLinkBehaviour"),M=i.getBehavior("ProductImplementBehavior"),T={},V=[];return a=o.getInstance(t),e.is(a)?(s=t,c=o.getReferenceModelFromInstance(a),l=c.get("PID")):(c=o.getReference(t),l=t),f=r.relationTypes||[],(u=o.getImpacted(t,!1,r)).forEach((t=>{var n=t.get("type");e.is(T[n])||(T[n]=[]),T[n].push(t)})),e.is(M)&&(f.indexOf(d)>-1||f.indexOf(h)>-1||f.indexOf(m)>-1||f.indexOf(p)>-1)&&(V=V.concat(M.getConnectedObjects(l,s,n,T))),u.forEach((function(e){var t,i=e.get("type"),o=e.get("from"),a=e.get("to");switch(i){case P:case I:case S:V=V.concat(g.getConnectedObjects(l,s,n,e));break;case D:case v:case R:case E:case O:V=V.concat(A.getConnectedObjects(l,s,n,e,r));break;case L:case C:case b:case y:t=o===l?a:o,V.push({ctxPath:[],objectPID:t});break;case F:t=o===s?a:o,V.push({ctxPath:[],objectPID:t});break;case N:case k:break;default:console.log("Invalid Type")}})),V},getConnectedUsagePoints:function(t,n){var i,a,s=[];return i=o.getInstance(t),a=e.is(i)?o.getReferenceModelFromInstance(i):o.getReference(t),e.is(a)&&(r.isAKindOf(a.get("type"),"DELLmiServiceWorkPlanSystemReference")||r.isAKindOf(a.get("type"),"DELServicePartReference")||r.isAKindOf(a.get("type"),"DELServiceAssemblyReference")||r.isAKindOf(a.get("type"),"DELServiceKitReference")||T.find((e=>r.isAKindOf(a.get("type"),e))))&&o.getImpacted(t,!1,n).forEach((function(t){var n=t.get("usagePoint");e.is(n)&&n.length>0&&s.push(...n.map((e=>({ctxPath:[],objectPID:e[e.length-1]}))))})),s},getXMLValues:function(e,t,n){return a.getXMLValues(e,t,n)},getRelations:function(t){return x(t).then((function(t){var n=t.result;return{isRelationsLoaded:t.relationsLoaded,connections:e.is(n)?n.connections:[]}}))},areRelationsLoaded:function(t){var n=!0;return t=Array.isArray(t)?t:[t],o.isNavigateOnDemand()&&(n=t.some((function(t){var n,i,r,a=o.getReferenceModel(t),s=a.get("PID")===t;return e.is(a)&&(s||(r=t),i=o.getInstance(r),n=e.is(i)?a.getAdditionalInfo("queriedForConnections")&&i.getAdditionalInfo("queriedForConnections"):a.getAdditionalInfo("queriedForConnections")),n}))),n},hasConnection:function(e){return o.hasConnection(e)},getLinkInfo:function(t){var n,o=i.getBehavior("ProductFlowLinkBehavior"),r={NLS:null,type:null,subType:null,iconName:null,interface:null};return e.is(t)&&((n=t.get("type"))===N&&e.is(o)?r=o.getLinkInfo(t):(r.NLS=c.getNLSValue(n),r.type=n,r.iconName=n)),r},getSecondaryRscLinksFromPrimaryLink:function(e){var t;return t=e.get("PID"),o.getImpacted(t,!1,{relationTypes:[R]})},cloneSecondaryCapableRscLinkWithFromAttr:function(t){var n=this.getConnection(t.get("from"));return e.is(n)&&(t=t.clone()).set("from",n.get("from")),t},getSecondaryResourceLinksInfo:function(t){var n,i=this,r=[],a=o.getConnection(t),s=this.getSecondaryRscLinksFromPrimaryLink(a);return n=function(t){var n=t.get("PID"),i=t.get("type"),r=t.get("DELAsmProcessCanUseCnx.V_IsPreferred"),a=t.get("from"),s=t.get("to"),c=o.getReference(a),l=o.getReference(s),u=e.is(c)?c.get("type"):null,f=e.is(l)?l.get("type"):null,g=e.is(c)?c.get("PLMEntity.V_Name"):null,d=e.is(l)?l.get("PLMEntity.V_Name"):null,m=e.is(t.get("ResourceUsage"))?t.get("ResourceUsage"):null,p=e.is(m)?o.getInstance(m):null,h=e.is(p)?p.get("PLMInstance.PLM_ExternalID"):"";return{connPID:n,isPreferred:i===v?r:"",fromPID:a,toPID:s,fromType:u,toType:f,fromName:g,toName:d,resourceUsage:h,resourceUsagePID:m}},s.forEach((function(e){var t=i.cloneSecondaryCapableRscLinkWithFromAttr(e);r.push(n(t))})),r},isAuthoringMode:function(){return o.isAuthoringMode()},getAttributeNLSForUnit:function(e){var t=r.getAttributeInfo(e);return s.getNLSForUnit(t)},isModuleActivated:function(e){return n.isStarted(e)}}}}})),define("DS/DELPPWModelBehaviors/ModelBehavior",["UWA/Core","DS/DELPPWModelBehaviors/Mutex"],(function(e,t){"use strict";return{plugins:["DatabasePlugin","ResourcePlugin","AttributePlugin","WebServicePlugin","DicoPlugin"],creator:function(n,i,o,r,a,s,c){var l,u,f,g,d,m,p,h,P,I,S,y,L,D,v,R;return p=function(t,n,o,r,a){var s=o||{};!0===(!e.is(s.popupMessage)||s.popupMessage)?i.info(n,r):i.log(n,r),e.is(t)&&i.notify("stopProgress",t),e.is(s.onComplete,"function")&&s.onComplete.call(null,n,o,a)},h=function(t,n,o,r,a,s){var c=r||{},l=!e.is(c.popupMessage)||c.popupMessage;e.is(o)&&e.is(o.message,"string")&&(n+="\n"+o.message),!0===l?i.warn(n,a):i.log(n,a),i.notify("stopProgress",t),e.is(c.onFailure,"function")&&c.onFailure.call(null,n,s)},l=function(t,n,a,s,c,l){var u,f,g,d,m,P,S=r.getNLSValue("DeleteObject.Success"),y=r.getNLSValue("DeleteObject.Failure"),L=r.getNLSValue("DeleteObject.PatialFailure"),D=[],v=t?"Instance":"Reference",R={};if(a&&!0===a.isDetachInstance)I(t,n,a,s,c,l);else if(l=!!e.is(l)&&l,u=function(e,t){m=r.getNLSValue(v,{objectLabel:e.get(s)},"Delete","Success"),i.log(m,d),e.isInstance()&&(g=o.getReferenceModelFromInstance(e)),t(g)},f=function(t,n,o){m=r.getNLSValue(v,{objectLabel:t.get(s)},"Delete","Failure"),e.is(o)&&e.is(o.message,"string")&&(m+="\n"+o.message),i.log(m,d),n()},e.is(n,"array")&&n.length>0){if(i.notify("startProgress",R),d=i.log(r.getNLSValue("DeleteObject.LogMessage")),P=o[t?"deleteInstance":"deleteReference"],!e.is(P,"function"))return void i.debug("delete function not found on database plugin.");n.forEach((function(n){D.push(new Promise((function(o,r){P(n.id,{deep:!!e.is(c)&&c,onComplete:function(){u(n,o),t&&i.notify("instanceDeleted",n.toJSON())},onFailure:function(e,t){f(n,r,t)}})})))})),Promise.allSettled(D).then((function(n){var o=!1,r=0,s=0,c=[];for(r=0;r<n.length;r++)"rejected"!==n[r].state&&"rejected"!==n[r].status?e.is(n[r].value)&&c.push(n[r].value):s++;0===s?(p(R,S,a,d),o=!0):s===n.length?h(R,y,null,a,d):(h(R,L,null,a,d),o=!0),o&&t&&l&&i.notify("addToAuxiliaryView",[c,{askAddToAuxConfirmation:!l}])}))}},S=function(e,t){let n,i,o=Math.ceil(e.length/t),r=[];for(i=0,n=0;i<o;i++,n+=t)r[i]=e.slice(n,n+t);return r},y=function(t,r,a){let s,c;s=function(t){let n={};return n.deletedObjects=t.deleted,new e.Promise((function(t,r){n.onComplete=function(){e.is(a)&&i.notify("stopProgress",a),t()},n.onFailure=function(){e.is(a)&&i.notify("stopProgress",a),r()},o.addToCollections(n)}))},c=function(t){return new e.Promise((function(e){let i=[];t.forEach((function(e){i=i.concat(o.getImpacted(e.id,!1,{onlyInstanceRelations:!0}))})),i.length>0&&(o.removeConnection(i,{silent:!0}),n.getMediator().notify("connectionRemoved",[i])),n.getMediator().notify("instanceRemoved",[t]),e()}))},s(r).then((function(){t.length>0&&c(t)}))},L=function(e,t){let n=new Map;n.set(!0,[]),n.set(!1,[]);for(let i=0;i<e.length;i++){const o=t(e[i]),r=e[i];n.set(o,n.get(o).concat(r))}return n},D=function(e){let t=new Set;for(let n=0;n<e.length;n++)if("fullfilled"===e[n].state){let i=e[n].value.deleted;for(let e=0;e<i.length;e++)t.add(i[e])}return t},I=function(t,n,a,c,l,u){var f,g,d,m,P,I=r.getNLSValue("DeleteObject.Success"),v=r.getNLSValue("DeleteObject.Failure"),R=r.getNLSValue("DeleteObject.PatialFailure"),C=t?"Instance":"Reference",b={},N=new Set;u=!!e.is(u)&&u,m=function(t){return new e.Promise((function(n,i){let o={url:"dsmfg/private/V0/MfgElement/instance/deleteMultipleInstances",method:"POST",headers:s.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),data:e.Json.encode(t),onComplete:function(e){n(e)},onFailure:function(){i()}};s.webServiceRequest(o)}))},P=function(e,t){let n="";return n=e.length===t.length?"Success":0===e.length?"Failure":"Partial Success",n},n.length>0&&(i.notify("startProgress",b),g=i.log(r.getNLSValue("DeleteObject.LogMessage"))),n.forEach((function(e){N.add(e.id)}));const k=S(Array.from(N),500).map((e=>m(e)));e.Promise.allSettled(k).then((function(s){let c=new Set,l=[],m=!1,S=new Map;c=D(s),S=L(n,(function(e){return c.has(e.id)}));const N=S.get(!0),k=S.get(!1);let A=[];for(let t=0;t<N.length;t++)if(N[t].isInstance()){let n=o.getReferenceModelFromInstance(N[t]);e.is(n)&&e.is(n.get("PPRTYPE"))&&("OPERATION"===n.get("PPRTYPE")||"SYSTEM"===n.get("PPRTYPE"))&&o.manageLinearProductFlowsOnDeleteInstance(N[t]),e.is(n)&&e.is(n.get("PPRTYPE"))&&"PROCESS"===n.get("PPRTYPE")&&A.push(N[t].id)}y(N,{deleted:Array.from(c)},b);let F=[];for(let e=0;e<N.length;e++)d=r.getNLSValue(C,{objectLabel:o.getDisplayName(N[e])},"Delete","Success"),i.log(d,g),N[e].isInstance()&&(f=o.getReferenceModelFromInstance(N[e]),l.push(f)),F.push(N[e].toJSON());i.notify("instanceDeleted",F),i.notify("updateBIModelFromServerResponse",{deletedObjects:A});for(let e=0;e<k.length;e++)d=r.getNLSValue(C,{objectLabel:o.getDisplayName(k[e])},"Delete","Failure"),i.log(d,g);switch(P(N,n)){case"Success":p(null,I,a,g),m=!0;break;case"Failure":default:h(b,v,null,a,g);break;case"Partial Success":h(null,R,null,a,g),m=!0}m&&t&&u&&i.notify("addToAuxiliaryView",[l,{askAddToAuxConfirmation:!u}])})).catch((function(e){i.log(e),h(b,v,null,a,g)}))},P=function(t){var n=t.parent,r=t.child,a=i.getBehavior("MfgProcessBehavior");let{isInstancePossible:s,errorMessage:l}=o.computeIsInstancePossible(n,r);return s&&c.isAKindOf(r,"DELLmiHeaderOperationReference")&&e.is(a)&&(s=a.isInstPossible(t)),{isInstancePossible:s,errorMessage:l}},u=function(t,n){var a,s,c,l={},u={},f=!1,g=!1;return n=n||{},e.is(n.securityContextOverride,"string")&&(c=n.securityContextOverride,delete n.securityContextOverride),e.is(n.silent,"boolean")&&(f=n.silent,delete n.silent),e.is(n.isBLToBecalled,"boolean")&&(g=n.isBLToBecalled),e.is(t)?e.is(t.V_Type)&&e.is(t.type)?(a=i.log(r.getNLSValue("ModelBehavior.CreateReference.LogMessage",{title:o.getDisplayName(t),type:t.type})),i.notify("startProgress",l),s=o.createReference(t,{onComplete:function(t){var s={transactionUUID:e.is(n.transactionUUID,"string")&&n.transactionUUID.length>0?n.transactionUUID:null,referenceAttrs:t.toJSON(),instanceAttrs:null};n.newRef=t,p(l,r.getNLSValue("ModelBehavior.CreateReference.Success",{name:o.getDisplayName(t)}),n,a,s),i.notify("referenceCreated",u)},onFailure:function(t,i){var o={transactionUUID:e.is(n.transactionUUID,"string")&&n.transactionUUID.length>0?n.transactionUUID:null,referenceAttrs:null,instanceAttrs:null};h(l,r.getNLSValue("ModelBehavior.CreateReference.Failure"),i,n,a,o)},securityContextOverride:c,silent:f,isBLToBecalled:g})):i.debug("Type is required to create reference",s):i.debug("data is empty to addReference"),s},g=function(t){var n,r=!1;if(e.is(t)){let a;if(e.is(t.targetReferencePID)&&(a=t.targetReferencePID),e.is(t.isAggregatedBy)&&(a=t.isAggregatedBy),e.is(a)){let s=!0,c=null;const l=e.is(t.referencePID)?t.referencePID:e.is(t.isInstanceOf)?t.isInstanceOf:null;e.is(l)&&(n={parent:o.getReference(a),child:o.getReference(l)},({isInstancePossible:s,errorMessage:c}=P(n))),s?r=!0:(i.debug("Instance object cannot be created between two selected Types"),i.warn(c))}else i.debug("isAggregatedBy required to create instance")}else i.debug("data is empty to createInstance");return r},f=function(t,n){var a,s,c={};if(n=n||{},e.is(n.securityContextOverride,"string")&&(s=n.securityContextOverride,delete n.securityContextOverride),g(t)){i.notify("startProgress",c),a=i.log(r.getNLSValue("ModelBehavior.CreateInstance.LogMessage"));const l=i.getPreferenceValue("copyModelParentToChild");t.copyModelParentToChild=l,o.createInstance(t,{onComplete:function(t){var s=o.getReferenceModelFromInstance(t),l={transactionUUID:e.is(n.transactionUUID,"string")&&n.transactionUUID.length>0?n.transactionUUID:null,referenceAttrs:e.is(s)?s.toJSON():null,instanceAttrs:e.is(t)?t.toJSON():null};if(n.newInst=t,p(c,r.getNLSValue("ModelBehavior.CreateInstance.Success",{name:o.getDisplayName(t)}),n,a,l),i.notify("instanceCreated",t.toJSON()),e.is(s)&&e.is(t)){let e=[];e.push(s),e.push(t),i.notify("addInstanceAndReferenceToBIModel",[e])}},onFailure:function(t,i){var o={transactionUUID:e.is(n.transactionUUID,"string")&&n.transactionUUID.length>0?n.transactionUUID:null,referenceAttrs:null,instanceAttrs:null};h(c,r.getNLSValue("ModelBehavior.CreateInstance.Failure"),i,n,a,o)},securityContextOverride:s})}},d=function(t,n){var a,s,c,l,u={};if(n=n||{},e.is(n.securityContextOverride,"string")&&(l=n.securityContextOverride,delete n.securityContextOverride),(c=t.filter(g).map((function(e){return{isAggregatedBy:e.targetReferencePID,isInstanceOf:e.referencePID}}))).length>0){i.notify("startProgress",u),a=i.log(r.getNLSValue("ModelBehavior.InsertExistingRefs.LogMessage")),s={childInfos:c},e.is(i.getPreferenceValue("skipVaidationIfScopedCheck"))&&(s.skipScopeCheck=i.getPreferenceValue("skipVaidationIfScopedCheck"));const t=i.getPreferenceValue("copyModelParentToChild");s.copyModelParentToChild=t,o.insertExistingRefs(s,{onComplete:function(t){var s,c=[],l=[],f={};if(e.is(t)&&e.is(t.instancesAndReferences)){let g=[];for(s in t.instancesAndReferences.forEach((function(t){var n,i,r;if(o.isInstance(t.get("PID"))){c.push(t),l.push(t.toJSON()),n=t.get("isAggregatedBy"),i=o.getReference(n),r=o.getDisplayName(t),e.is(i)&&(f[n]?f[n].instLabel.push(r):f[n]={aggLabel:o.getDisplayName(i),instLabel:[r]});const a=t.get("isInstanceOf");e.is(a)&&g.push(a)}})),f)if(Object.hasOwnProperty.call(f,s)){const e={instanciatedReference:f[s].instLabel.join(","),referenceName:f[s].aggLabel};let t=r.getNLSValue("ModelBehavior.InsertExistingRefs.Created",e);i.info(t,a)}i.notify("instanceAdded",[c]),i.notify("instanceCreated",[l]);const d={reusedReferences:g,instancesAndReferences:c};i.notify("updateBIModelFromServerResponse",d),p(u,r.getNLSValue("ModelBehavior.InsertExistingRefs.Success"),n,a,c)}},onFailure:function(t,i){var o={transactionUUID:e.is(n.transactionUUID,"string")&&n.transactionUUID.length>0?n.transactionUUID:null,referenceAttrs:null,instanceAttrs:null};(n=n||{}).popupMessage=!0,h(u,r.getNLSValue("ModelBehavior.InsertExistingRefs.Failure"),i,n,a,o)},securityContextOverride:l})}else e.is(n.onFailure,"function")&&n.onFailure.call()},m=function(t,n){var a,s,c,l={};if(n=n||{},(c=t.filter(g).map((function(e){return{isAggregatedBy:e.targetReferencePID,isInstanceOf:e.referencePID}}))).length>0){i.notify("startProgress",l),a=i.log(r.getNLSValue("ModelBehavior.InsertExistingRefs.LogMessage")),(s={childInfos:c}).isDeepDuplicate=n.isDeepDuplicate||!1,e.is(i.getPreferenceValue("skipVaidationIfScopedCheck"))&&(s.skipScopeCheck=i.getPreferenceValue("skipVaidationIfScopedCheck"));const t=i.getPreferenceValue("copyModelParentToChild");s.copyModelParentToChild=t,o.insertDuplicated(s,{onComplete:function(t){var s,c=[],u=[],f={};if(e.is(t)&&e.is(t.instancesAndReferences)){let g=[];for(s in t.instancesAndReferences.forEach((function(t){var n,i,r;if(o.isInstance(t.get("PID"))){c.push(t),u.push(t.toJSON()),n=t.get("isAggregatedBy"),i=o.getReference(n),r=o.getDisplayName(t),e.is(i)&&(f[n]?f[n].instLabel.push(r):f[n]={aggLabel:o.getDisplayName(i),instLabel:[r]});const a=t.get("isInstanceOf");e.is(a)&&g.push(a)}})),f)if(Object.hasOwnProperty.call(f,s)){const e={instanciatedReference:f[s].instLabel.join(","),referenceName:f[s].aggLabel};let t=r.getNLSValue("ModelBehavior.InsertExistingRefs.Created",e);i.info(t,a)}i.notify("instanceAdded",[c]),i.notify("instanceCreated",[u]);const d={reusedReferences:g,instancesAndReferences:c};i.notify("updateBIModelFromServerResponse",d),p(l,r.getNLSValue("ModelBehavior.InsertExistingRefs.Success"),n,a,c)}},onFailure:function(t,i){var o={transactionUUID:e.is(n.transactionUUID,"string")&&n.transactionUUID.length>0?n.transactionUUID:null,referenceAttrs:null,instanceAttrs:null};(n=n||{}).popupMessage=!0,h(l,r.getNLSValue("ModelBehavior.InsertExistingRefs.Failure"),i,n,a,o)}})}else e.is(n.onFailure,"function")&&n.onFailure.call()},v=function(e,t,n){s.webServiceRequest({url:"dsmfg/private/V0/MfgElement/reference/type",method:"POST",data:JSON.stringify(e),onFailure:n,onTimeout:n,onCancel:n,onComplete:e=>{t(e)}})},{onStart:function(){R=new t},onStop:function(){R.destroy(),R=null},getDisplayName:function(e){return o.getDisplayName(e)},getNavigateOnIndex:function(){return o.getNavigateOnIndex()},getNavigateOnDatabasePreference:function(){return o.getNavigateOnDatabasePreference()},moveInstance:function(t){var a,c,l,u,f=t||{},g=null,d=null,m={},P=widget.getBool("oneDelmiaAggregationMode"),I=r.getNLSValue("ModelBehavior.ReparentInstances"),S=r.getNLSValue("ModelBehavior.ReparentInstances.Success"),y=r.getNLSValue("ModelBehavior.ReparentInstances.Failure"),L=s.getServerConfigurationRawXML("DELWebMfgAssetsLinkAuthoring.xml"),D=[];if(a=function(t){var r,a={formerParentsPIDArray:g.formerInstancesParentPIDs,movedInstPIDArray:g.instancesPIDsToReparent,newParentPID:g.newParentPID,newInstPIDArray:[]},s={stackedObjects:{stackedReferences:[],stackedInstances:[],stackedConnections:[],deletedObjects:[]},silentOpt:!0,onComplete:function(n){var r;for(r of(a.newInstPIDArray=n.instancePIDs.slice(),a.newInstPIDArray))o.manageLinearProductFlowsOnCreateInstancePID(r);i.notify("reorder",a),i.notify("updateBIModelFromServerResponse",{deletedObjects:t.deletedObjects}),i.notify("reparent",a);let s=[],c=[];t.instancesAndReferences.forEach((function(t){const n=t.attributesValue;if(e.is(n)&&e.is(n.PID)){const i=o.getReferenceModel(n.PID);if(e.is(i)){const n=i.get("PID");e.is(n)&&D.includes(n)&&(s.push(t),c.push(n))}}}));const l={reusedReferences:c,connections:t.connections,instancesAndReferences:s};i.notify("updateBIModelFromServerResponse",l),p(m,S,f,d),i.notify("reparentEnd",g.newParentPID)}};for(r of g.instancesPIDsToReparent)o.manageLinearProductFlowsOnDeleteInstancePID(r);let c=[];e.is(t.deletedObjects)&&t.deletedObjects.forEach((function(e){c=c.concat(o.getImpacted(e,!1,{onlyInstanceRelations:!0}))})),c.length>0&&(o.removeConnection(c,{silent:!0}),n.getMediator().notify("connectionRemoved",[c])),o.parseServerObjects(t,s)},c=function(e,t){f.popupMessage=!0,i.notify("reparentEnd",g.newParentPID),h(m,y,t,f,d)},d=i.log(I),i.notify("startProgress",m),u=e.is(f.instancesPIDsToReparent)?f.instancesPIDsToReparent:[],Array.isArray(u)&&u.forEach((function(e){const t=o.getReferenceModel(e).get("PID");D.push(t)})),"PROCESS"===o.getPPRType(f.newParentPID)){let t=i.getBehavior("ProductImplementBehavior"),n=e.is(f.newParentPath)?f.newParentPath[0]:[],o=[],r=e.is(f.instancesPathsToReparent)?f.instancesPathsToReparent:[];Array.isArray(r)&&(r.forEach((function(e){if(Array.isArray(e)){let n=t.getPathToScope(e);o.push(n)}})),f.instancesPathsToReparent=o);const a=t.getPathToScope(n);Array.isArray(a)&&a.length>0&&(f.newParentPath=[a])}g={oneDelmiaAggregationMode:P,instancesPIDsToReparent:u,formerInstancesParentPIDs:e.is(f.formerInstancesParentPIDs)?f.formerInstancesParentPIDs:[],newParentPID:e.is(f.newParentPID)?f.newParentPID:"",newParentInstancesOrder:e.is(f.newParentInstancesOrder)?f.newParentInstancesOrder:[],instancesPathsToReparent:e.is(f.instancesPathsToReparent)?f.instancesPathsToReparent:[],newParentPath:e.is(f.newParentPath)?f.newParentPath:[]},e.is(L,"string")&&(g.xmlLinkAuthoringConfig=L);const v=i.getPreferenceValue("copyModelParentToChild");g.copyModelParentToChild=v,l={url:"dsmfg/private/V0/invoke/reparent",method:"POST",headers:s.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),onComplete:a,onFailure:c,data:e.Json.encode(g)},i.notify("reparentBegin",g.newParentPID),i.debug("Reparent instance ("+g.instancesPIDsToReparent.reduce((function(e,t,n){return e+(0===n?"":", ")+t+"#"+o.getDisplayName(o.getInstance(t))}),"")+"), formerly under reference ("+g.formerInstancesParentPIDs.reduce((function(e,t,n){return e+(0===n?"":", ")+t+"#"+o.getDisplayName(o.getReference(t))}),"")+"), under new reference ("+g.newParentPID+"#"+o.getDisplayName(o.getReference(g.newParentPID))+")"),s.webServiceRequest(l)},moveMultipleInstances:function(t,n,o){var a=this;return new Promise((function(n,i){var o=e.merge({onComplete:n,onFailure:i,popupMessage:!1},t);a.moveInstance(o)})).then((function(){var e=r.getNLSValue("ModelBehavior.MoveInstances.Success",{instanceLabel:o,newParentLabel:n});return i.info(e),Promise.resolve(e)}))},createRefOrInst:function(t,n,o){var r,a={};if(o=o||{},e.is(t)){for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(a[r]=t[r]);c.isAKindOf(a.type,"MBOMContinuousPhaseReference")&&delete a["DELFmiMagnitudeExt.V_DimensionType"],e.is(n,"string")?(a.isAggregatedBy=n,c.isAKindOf(a.type,"DELLmiHeaderOperationReference")&&(a.isAutoCreateScopeOnHOP=c.isAutoCreateScopeOnHOP()),f(a,o)):u(a,o)}else i.debug("createRefOrInst: No data to insert")},insertExistingRefs:function(e,t){return new Promise((function(n,i){d(e,{onComplete:n,onFailure:i,popupMessage:!1,isDeepDuplicate:t})}))},insertDuplicated:function(e,t){return new Promise((function(n,i){m(e,{onComplete:n,onFailure:i,popupMessage:!1,isDeepDuplicate:t})}))},getConnectionsByModel:function(e,t,n){o.getConnectionsByModel(e,t,n)},insertInstance:function(t,n){var a,s,l=i.getBehavior("MfgProcessBehavior"),u={onComplete:function(){var e=t.isAggregatedBy,a={parent:o.getReference(e),child:s,targetAbsPath:n};l.isInstPossible(a)?f(t):i.warn(r.getNLSValue("ModelBehavior.InsertInstance.HOP.Error",{refName:o.getDisplayName(a.child)}))}};if(c.isAKindOf(t.type,"DELLmiHeaderOperationReference")){let n=i.getBehavior("ProcessImplementBehavior").getPartialScopeLinkType();a=t.isInstanceOf,s=o.getReference(a),o.getConnectionsByModel(s,null,e.merge(u,{relationTypes:[n]}))}else f(t)},deleteInstance:function(t,n){var a,s,c,u=[],f=i.getBehavior("UXFactoryBehavior"),g=r.getNLSValue("Confirmation.addRefToAuxViewPostDelete");if(t.length>0)for(let e=0;e<t.length;e++)u.push(o.getDisplayName(t[e]));e.is(f)?(n=n||{},a=!e.is(n.askDeleteConfirmation)||n.askDeleteConfirmation,e.is(t,"array")&&t.length>0&&(a?(!!e.is(n.isDetachInstance)&&n.isDetachInstance?(c=r.getNLSValue("Detach.Confirmation.Title"),s=r.getNLSValue("DetachInstance.Confirmation.Message")):(c=r.getNLSValue("Delete.Confirmation.Title"),s=r.getNLSValue("DeleteInstance.Confirmation.Message")),f.showConfirmation(c,s,{displayNames:u,models:t},(function(i,o,r){e.is(i)&&i&&l(!0,t,n,u,!1,r)}),{check:g})):l(!0,t,n,u))):i.debug("uxFactoryBehavior is not available.")},fetchRoot:function(e,t){return o.fetchRoot(e,t)},fetchInstancesAndTheirReferences:function(e,t){return o.fetchInstancesAndTheirReferences(e,t)},isNavigateOnDemand:function(){return o.isNavigateOnDemand()},fetchInstance:function(e,t){return o.fetchInstance(e,t)},getReference:function(e){return o.getReference(e)},getReferencesFromArray:function(e){return o.getReferencesFromArray(e)},removeReference:function(e,t){o.removeReference(e,t)},getInstance:function(e){return o.getInstance(e)},getReferenceModelFromInstance:function(e){return o.getReferenceModelFromInstance(e)},getAggregatingReferenceModelFromInstance:function(e){return o.getAggregatingReferenceModelFromInstance(e)},getReferenceIdFromInstance:function(e){return o.getReferenceIdFromInstance(e)},getParentReferenceIdFromInstance:function(e){return o.getParentReferenceIdFromInstance(e)},getReferenceId:function(e){var t=e;return this.isInstance(e)&&(t=o.getReferenceIdFromInstance(e)),t},getInstancesFromCollection:function(e,t){return o.getInstancesFromCollection(e,t)},getParentInstancesFromCollection:function(e){return o.getParentInstancesFromCollection(e)},needToQueryForConnections:function(e){return o.needToQueryForConnections(e)},needToQueryForChildren:function(e){return o.needToQueryForChildren(e)},getDescendantsFromServer:function(e,t,n){o.getDescendantsFromServer(e,t,n)},getConnectionsFromServer:function(e,t,n){o.getConnectionsFromServer(e,t,n)},getAllChildrenFromCollection:function(e){return o.getAllChildrenFromCollection(e)},getAllFilteredChildrenFromCollection:function(e,t){return o.getAllFilteredChildrenFromCollection(e,t)},getImpactedConnections:function(t,n,i){var r,a=[];return e.is(t,"array")&&t.forEach((function(t){r=o.getImpacted(t,n,i),e.is(r)&&e.is(r,"array")&&r.length>0&&(a=a.concat(r))})),a},checkForContextualImplementLink:function(t,n){var i,r,a=".V_ContextualImplementLink";if(e.is(t)&&e.is(t._attributes))if(i=t._attributes.type+a,e.is(t._attributes[i])){if("TRUE"===t._attributes[i])return!0}else if(e.is(n)&&(r=n.get("isAggregatedBy"),e.is(r))){let t=o.getReferenceModel(r);if(e.is(t)&&e.is(t._attributes)&&(i=t._attributes.type+a,e.is(t._attributes[i])&&"TRUE"===t._attributes[i]))return!0}return!1},getReferenceModel:function(e){return o.getReferenceModel(e)},isReference:function(t){return e.is(this.getReference(t))},isInstance:function(t){return e.is(this.getInstance(t))},updateModelAttribute:function(t,n,s,c){var l,u,f,g,d,m,P,I,S,y,L,D,v,R,C,b,N,k,A=this,F=[],M=function(t){var n=t,i=function(t){return e.is(t,"string")?a.getFormattedDate(t):a.getFormattedDate(1e3*t)};return a.isDate(D)?n=Array.isArray(t)?t.map((function(e){return i(e)})):i(t):y&&!P?n=a.getValueAsString(t,a.getType(D)):a.isBoolean(D)&&(n=r.getNLSValue(t.toString().toUpperCase())),n};e.is(n,"array")&&(n=n[0]),n=n||{},c=c||{},e.is(n.instOrRef)&&e.is(n.dataIndex)&&e.is(n.attributeInfo)&&e.is(n.objectToBeModified)&&e.is(n.attributeName)?(R=n.attributeName,D=n.attributeInfo,v=e.is(n.attributeDef)?n.attributeDef:{},d=a.getNLS(D),C=n.objectToBeModified,m="instance"===n.instOrRef,P=a.hasRangeDefined(D,v),I=a.isString(D),S=a.isInteger(D),y=a.isDouble(D),L=a.isMultiValuated(D),g=C.get(R),e.is(g)&&"NULL"!==g||(g=""),P&&!L&&(I||S||y)&&(g=a.getAuthorizedValue(D,v,g)),N=function(e,t,n,o){var a,s=M(n),c=M(t),l=i.getBehavior("UXFactoryBehavior"),u=l.getComponent("Button"),f=l.createElement("div",{class:"confirmation-dialog-content-container"}),g=l.createElement("div",{text:r.getNLSValue("UpdateAttributeUI.NotUptoDate")}),m=l.createElement("div"),p=l.createElement("div",{text:r.getNLSValue("UpdateAttributeUI.NewValue")}),h=l.createElement("div"),P=l.createElement("div",{text:r.getNLSValue("UpdateAttributeUI.DoYouWantToUpdate")});g.inject(f),m.textContent=s,m.inject(f),p.inject(f),h.textContent=c,h.inject(f),P.inject(f),(a=l.create("Dialog",{title:r.getNLSValue("UpdateAttributeUI.Header",{attributeName:d}),domId:"EditAttributeUI-Dialog",content:f,resizableFlag:!0,modalFlag:!0,buttons:{No:new u({onClick:function(){n===t&&b(e,o,n),a.close()}}),Yes:new u({disabled:!1,onClick:function(){b(e,t,n),a.close()}})}})).close=function(){this.destroy(),a=null}},k=function(t){var n=!1,o=s;if(e.is(t))if(f=t.get(R),e.is(f)&&"NULL"!==f||(f=""),P&&!L&&(I||S)&&(f=a.getAuthorizedValue(D,v,f)),a.isDate(D)&&!a.isMultiValuated(D)?(f=(f=new Date(f).getTime()/1e3).toString(),o=s=o.toString()):y&&a.hasMagnitude(D)&&!L&&(f=parseFloat(f),s="AsRequired"===o?o:o.toString()),(f=isNaN(f)&&"AsRequired"===o?o:f)!==o)if(a.doesAttributeExist(t,R)||a.isAttrApplicableForType(t,R)||a.isAttributeInProtectedList(R))if(R.contains(".V_ContQuantity")&&"AsRequired"!==o){const t=o.split(" ")[0],a=!!Number.isNaN(t);let s=!1,c=!1;if(R.contains("DELFmiRatioOfDiscreteQuantity.V_ContQuantity")||(c=!e.is(Math.sign(t))||-1===Math.sign(t),s=0===Number(t)),s||a||c)i.warn(r.getNLSValue("Error.InvalidQuantity.Title")),n=!1;else{const e=new RegExp("^([0-9]+.|)[0-9]+$");!Number.isInteger(t)||e.test(t.toFixed(1))?n=!0:(i.warn(r.getNLSValue("Error.InvalidQuantity.Title")),n=!1)}}else n=!0;else i.warn(r.getNLSValue("TableView.AvailabilityFailure",{key:d}));else i.info(r.getNLSValue("TableView.NoChange"));return n},e.is(t,"array")?t.forEach((function(e){l=m?A.getInstance(e):A.getReference(e),k(l)&&F.push(l.get("PID"))})):k(C)&&F.push(C.id),0!==F.length&&(1===F.length?(b=function(t,n,s){var l,f={previous:{}},g={},P={};f[R]=n,l=m?A.getInstance(t):A.getReference(t),a.doesAttributeExist(l,R)&&(f.previous[R]=s),u={data:f,onFailure:function(e,t){const i=r.getNLSValue("TableView.SingleUpdateFailure",{key:d,value:M(n)});h(P,c.failureMsg?c.failureMsg:i,t,c)},onComplete:function(o,a){var l,u;l="AsRequired"===n?n:o.get(R),e.is(a)&&e.is(a.isInSync)&&!a.isInSync?(h(P,r.getNLSValue("TableView.UpdateWarning",{key:d})),N(t,n,l,s)):e.is(o._changed.modified)?(l="AsRequired"===l?l:M(l),u=r.getNLSValue("TableView.SingleUpdateSuccess",{key:d,value:l}),p(P,c.successMsg?c.successMsg:u,c),i.notify("objectAttributesModified",g)):(n="AsRequired"===n?n:M(n),h(P,r.getNLSValue("TableView.SingleUpdateFailure",{key:d,value:n}),a,c))},logMessage:r.getNLSValue("TableView.SingleUpdateLogMessage")},i.notify("startProgress",P),!0===m?o.updateInstance(t,u):o.updateReference(t,u)},b(F[0],s,g)):F.length>1&&function(e,t){var n={},a={};e.forEach((function(e){n[e]={[R]:t}})),u={data:n,onFailure:function(e){h(a,r.getNLSValue("TableView.MassUpdateFailure",{key:d,value:M(t)}),e,c)},onComplete:function(n){n.length!==e.length?h(a,r.getNLSValue("TableView.UpdateWarning",{key:d})):(p(a,r.getNLSValue("TableView.MassUpdateSuccess",{key:d,value:M(t)}),c),i.notify("objectAttributesModified",{}))},logMessage:r.getNLSValue("TableView.MassUpdateLogMessage")},i.notify("startProgress",a),!0===m?o.updateInstances(R,u):o.updateReferences(R,u)}(F,s))):i.debug("Required attribute information is missing to update the model attribute")},getValidChildTypes:function(e){return o.getValidChildTypes(e)},computeIsInstancePossible:function(e){return P(e)},isMovePossible:function(t,n){var i,r=!1;return o.isWorkInstruction(n)?r=!1:n&&n.get("isAggregatedBy")!==t.id&&(i=this.getReferenceModelFromInstance(n).get("PPRTYPE"),e.is(i)&&(r=c.isReparentPossible(i))),r},isAKindOf:function(e,t){return c.isAKindOf(e,t)},getTypeHierarchy:function(e){return c.getTypeHierarchy(e)},getAttributeInfo:function(e){return c.getAttributeInfo(e)},fetchDicoAttributeInfo:function(e,t,n){c.fetchDicoAttributeInfo(e,t,n)},getPPRType:function(e){return o.getPPRType(e)},getPPRTypeFromType:function(e){return c.getPPRType(e)},getParentTypes:function(e){return c.getParentTypes(e)},getReadOnlyTypes:function(){return c.getReadOnlyTypes()},isReferencesHasReadOnlyType:function(e){return c.isReferencesHasReadOnlyType(e)},getMajorRevisions:function(t,n,a){var c,l,u,f=o.getDisplayName(o.getReferenceModel(t));l=function(e,t,n){i.debug("jsonData: "+e+" error:"+t+" options: "+n),c=r.getNLSValue("Error.GetMajorRevisionFailure.Title",{objectName:f}),a(c)},u=function(e){n(e)},s.webServiceRequest({url:"dsmfg/private/V0/invoke/getMajorRevisions",method:"POST",data:e.Json.encode({pid:t}),onFailure:l,onTimeout:l,onCancel:l,onComplete:u})},isReadOnly:function(t,n,o,a){var c,l,u;l=function(e,t,n){i.debug("jsonData: "+e+" error:"+t+" options: "+n),a()},u=function(t){e.is(t.isReadOnly)&&t.isReadOnly&&(c=r.getNLSValue("Error.ObjNotInReadWrite.Title",{objectName:n})),o(c)},s.webServiceRequest({url:"dsmfg/private/V0/invoke/isReadOnly",method:"GET",data:{pid:t},onFailure:l,onTimeout:l,onCancel:l,onComplete:u})},isLatestRevision:function(t,n,o,a){var c,l,u;l=function(e,t,n){i.debug("jsonData: "+e+" error:"+t+" options: "+n),a()},u=function(t){e.is(t.isLatestRevision)&&!t.isLatestRevision&&(c=r.getNLSValue("Error.ObjNotLatestRevision.Title",{objectName:n})),o(c)},s.webServiceRequest({url:"dsmfg/private/V0/invoke/isLatestRevision",method:"GET",data:{pid:t},onFailure:l,onTimeout:l,onCancel:l,onComplete:u})},getWhereUsedReferences:function(e,t){o.getWhereUsedReferences(e,t)},getTenant:function(){return s.getTenant()},getHeaders:function(e){return s.getHeaders(e)},getSecurityContext:function(){return s.getSecurityContext()},getTypeProxy:function(e,t,n){return v(e,t,n)},get3DSpaceUrl:function(){return s.get3DSpaceUrl()},isEntityInstance:function(e){return c.isEntityInstance(e)},getAcceptedBaseTypesForCreation:function(){var t=[],n=c.getAcceptedBaseTypesForActions();return e.is(n)&&e.is(n.CREATION,"array")&&(t=n.CREATION),t},getFilteredInstancesFromCollection:function(e,t){return o.getFilteredInstancesFromCollection(e,t)},transformToRIROccurrencePath:function(e){return o.transformToRIROccurrencePath(e)},transformRIRToAbsolutePath:function(e){return o.transformRIRToAbsolutePath(e)},isOperation:function(e){return o.isOperation(e)},isSystem:function(e){return o.isSystem(e)},webServiceGETRequest:function(e,t,n,i){s.webServiceRequest({url:this.get3DSpaceUrl()+e,method:t,onFailure:i,onTimeout:i,onCancel:i,onComplete:n})},getModelMaturity:function(t){const n=this.getAttributeInfo("BusinessType.current");let i=t.get("current");if(e.is(i)&&e.is(n))return a.getAuthorizedValue(n,null,i)},findAllRIRPaths:function(e){return o.findAllRIRPaths(e)},findAllInstsPaths:function(e){var t=this.findAllRIRPaths(e),n=[];return t.forEach((e=>{n.push(e.filter((e=>this.isInstance(e))))})),n},findAllRefsPaths:function(e){var t=this.findAllRIRPaths(e),n=[];return t.forEach((e=>{n.push(e.filter((e=>this.isReference(e))))})),n},getSequenceNumber:function(t,n,i){var r,a,s,l,u,f,g="",d={sort:!0},m=e.is(t,"array")?t:[t],p=function(e){return!(!c.isAKindOf(e,"DELLmiHeaderWorkPlanReference")&&!c.isAKindOf(e,"DELLmiServiceHeaderWorkPlanReference"))};if(0===m.length)g=p(n.get("type"))?"":1;else for(r=0;r<m.length;r++)s=o.getInstance(m[r]),e.is(s)&&(l=o.getReferenceModel(s.get("isAggregatedBy")),(u=i.filterQuery?o.getFilteredInstancesFromCollection(l.get("PID"),i.filterQuery,d):o.getInstancesFromCollection(l.get("PID"),d)).length>0&&(f=-1===(a=u.findIndex((e=>e.id===m[r])))?-1:a+1),g=0===r?p(l.get("type"))?f:"1."+f:g+"."+f);return g},getTreeOrderPosition:function(t,n,i){var r,a,s={sort:!0};if((r=e.is(i.filterQuery)?o.getFilteredInstancesFromCollection(t,i.filterQuery,s):o.getInstancesFromCollection(t,s)).length>0)return-1===(a=r.findIndex((e=>e.id===n)))?-1:a+1},sanitizeHTML:function(e){return a.sanitizeHTML(e)},getMagnitude:function(e){return a.getMagnitude(e)},withMutexLock:function(t){return new Promise((function(n,i){e.is(t,"function")?setTimeout((function(){e.is(R)?R.acquire().then((function(){const o=t();e.is(o.then,"function")?o.then((function(){R.release(),n()})).catch((function(e){R.release(),i(e)})):(R.release(),i("promiseSupplier is not returning a Promise"))})):i("_mutex is not initialized")}),5):i("Given promiseSupplier is not a function")}))},getMutex:function(){return R}}}}}));