/*!  COPYRIGHT DASSAULT SYSTEMES 2015   */
function ENXSceneV2(e){"use strict";var t,i="xscene_root_pids",n="xscene_root_pids_detached",s="xscene_struture",o="xsceneStoredObjects";function a(e){return"string"==typeof e?JSON.parse(e):null}var r=function(e){return UWA.is(e,"string")&&(e=e.replace(/'label':'((\\'|[^'])*)',/gi,"")),e},l=function(e){var t=!1;return UWA.is(e,"boolean")?t=e:UWA.is(e,"string")&&(t="true"===e.toLowerCase()),t};function c(e,t,i,n){let s=new Promise((function(s,o){Promise.all(e).then((function(){!1===n()?s():require([i],(function(e){e.isAdditionalColumnsAvailable((function(i){!0===i&&t.push(e),s()})),"function"==typeof e.setReadOnlyMode&&e.setReadOnlyMode(!0)}),s)}))}));s.name="Add-"+i,e.push(s)}var d=function(e){if(self.widget.isDeEnabled){var t=require("DS/PADServices/views/private/AppStructure"),i=t.retrieveData(o);t.addDesignEnv(i,e.designEnvIds),t.addOpenDesignEnv(i,e.designEnvIds),t.persistData(o,i),require("DS/PADServices/utils/GlobalModelEvents").getModelEvents().publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"designEnv",designEnv:e.designEnvIds,designExpDetails:e.designExpDetails}})}},u={widget:null,activeBody:"welcome",active_table_view:"ENO2D_DEFAULT",xnav_component_opts:{x3dAppId:null,widget:null,active_view:null,action_bar_opts:null,configuration:{ctxMenuOpts:{definition:"ENXScene/assets/configuration/xsceneCtxMenu.json"},commands:{definition:"ENXScene/assets/configuration/xsceneCmds.json"}},layout:{statusInfo:!0,view_customization:null,padshell:!0,withWelcomePanel:!0},amd_custo:{}},sharedSettings:["x3dPlatformId","showWelcomePanel","autoreload","pad_security_ctx","synthesisModeOnInstance","pgpFromServer","activateSGI"],mepreferences:["TABLE_DEFAULT","TABLE_CUSTO","TABLE_DENSITY","TABLE_ROW_HDR"],xnav_component:null,init:function(e){this.pcsPrefix=widget.id+"_"+widget.title,window.top.performance.mark(this.pcsPrefix+"_init"),window.top.performance.measure(this.pcsPrefix+"_call_init","enxscene_load_html",this.pcsPrefix+"_init"),this.widget=e.widget,e.odt_settings&&(this._odt_settings=e.odt_settings),e.odt_xnavcomponents_opts&&(this.xnav_component_opts=e.odt_xnavcomponents_opts),this.widget.addEvent("onLoad",this.onLoad.bind(this)),this.widget.addEvent("onRefresh",this.onRefresh.bind(this)),this.widget.addEvent("onSearch",this.onSearch.bind(this))},onRefresh:function(){null!==this.xnav_component&&require(["DS/Utilities/Utils","i18n!DS/ENXNav/assets/nls/ENXNav.json"],((e,t)=>{this.xnav_component.beginBlockingTransaction(t.refresh_ongoing),this.__debounceRefresh=this.__debounceRefresh?this.__debounceRefresh:e.debounce((()=>{this.xnav_component.refresh()}),1e3),this.__debounceRefresh()}))},onLoad:function(){var e=this;window.top.performance.mark(this.pcsPrefix+"_onload"),window.top.performance.measure(this.pcsPrefix+"_call_onload",this.pcsPrefix+"_init",this.pcsPrefix+"_onload");var i=widget.preferences.length;const n=["storedObjectMgt"];for(var s=0;s<i;s++)-1!==n.indexOf(widget.preferences[s].name)&&(widget.preferences.splice(s,1),s++);this.widget.setValue("tenantAware",!0),null===this.xnav_component&&require(["DS/ENOXInterWdgCom/LinkManager","DS/PADUtils/PADSettingsMgt","text!DS/ENXScene/assets/xscene_settings.json","css!DS/ENXScene/ENXScene.css","DS/PADServices/settings/AppSettings","DS/PADServices/utils/Dimensions","DS/PADServices/utils/GlobalUtils"],((i,n,s,o,a,r,l)=>{e.widget.isDeEnabled="true"==l.getURLParameter("enableDesignExpPE"),e.widget.isCowEnabled="true"==l.getURLParameter("enableDesignExpCOW");var c=e.widget.isDeEnabled?function(e){let i=e.padsettings.enxscene.run_options;return i.type_kind.value.DesignEnv=["ENOExpDesignExperience"],i.authorized_root_types.value.push("ENOExpDesignExperience"),e.view_settings.defaultAttributes.unshift({name:"asset-type"}),t=e,e}(JSON.parse(s)):JSON.parse(s);e._odt_settings&&(c.padsettings=UWA.extend(c.padsettings,e._odt_settings,!0));let d=n.setApp(c.padsettings,"enxscene",!0),u=r.retrieveDimensions();Promise.all([d,u]).then((()=>{let t=Promise.resolve();if(!0===a.getSetting("activateStatusBar")&&(this.xnav_component_opts.layout.statusInfo=!1),!0===a.getSetting("activateMePref")||!0===a.getSetting("tablePref")){if(a.setSetting("activateMePref",!0),!0===a.getSetting("activateMePrefV2")){this.mepreferences=["TABLE_DEFAULT","TABLE_CUSTO","TABLE_DENSITY","TABLE_ROW_HDR","RELOAD_SESSION","SHOW_WP_STARTUP","HIDESHOW_INHERIT","RETRIEVE_INSTANCES","AUTH_CTX_DEF","AUTH_CTX_POS_DEF"],this.sharedSettings=["x3dPlatformId","pad_security_ctx","pgpFromServer","activateSGI"];var s=widget.preferences.length;const e=["autoreload","synthesisModeOnInstance","showWelcomePanel"];for(var o=0;o<s;o++)-1!==e.indexOf(widget.preferences[o].name)&&widget.preferences.splice(o,1)}let e=this.widget.getValue("Explorer_Active_TableView");"string"==typeof e&&e.length>0&&(this.active_table_view=e),t=this.__readPreferences()}t.then((()=>{!0!==n.getSetting("activateWidgetLink")?this._init():i.initializeWidgetLink(widget,n.getSetting("widgetLink_options")).then((()=>{e._init()}))})).catch((()=>{console.warn("=== MePreference cannot be read")}))}))}));try{require(["DS/MSFDocumentManagement/WidgetIntegration"],(function(e){widget.MSFDocumentClient=e,widget.MSFDocumentClient.ConnectWidgetWithMSF()}))}catch(e){}},_init:function(){var e=this;require(["DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSession","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/GlobalUtils","DS/PADUtils/PADSharedSettings","DS/PADUtils/PADWebInWinServices","UWA/Utils/Client","text!DS/ENXScene/assets/xscene_settings.json","i18n!DS/ENXScene/assets/nls/ENXScene.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADUtils/Configuration","text!DS/ENXScene/assets/ProductExplorerConf.json","DS/PADServices/utils/PADTrackerManager","DS/PADServices/utils/ZipUtils","DS/PADUtils/PADUtilsServices","DS/WebUAUtils/WebUAUtils","DS/PADServices/settings/AppSettings"],(function(i,n,s,o,a,c,d,u,g,p,v,h,f,m,_,S,w){n.softInit(!0),window.top.performance.mark(e.pcsPrefix+"_require_infra_padutils"),window.top.performance.measure(e.pcsPrefix+"_require_infra",e.pcsPrefix+"_onload",e.pcsPrefix+"_require_infra_padutils"),S.setAppid("ENOSC2D_AP");var D=window.top.performance.getEntriesByName(e.pcsPrefix+"_call_init"),P=D.length>0?D[D.length-1].duration:void 0,A=D.length>0?D[D.length-1].startTime:void 0,b=(D=window.top.performance.getEntriesByName(e.pcsPrefix+"_call_onload")).length>0?D[D.length-1].duration:void 0,E=D.length>0?D[D.length-1].startTime:void 0,C=f.getPADTracker({eventCategory:"performance",eventAction:"2d_app_init"});C&&C.addMultivaluedEventData("2d_app_init",{call_init_start:A,call_init_duration:P,call_onload_start:E,call_onload_duration:b});var x=!0===w.getSetting("activateMePref");let y;if(x){let t=e.widget.getValue("xsceneCustoV2");"null"===t&&(t=null);try{t=m.jsonUnzip(t),t=r(t),t&&(t=JSON.parse(t),e.active_table_view&&t.currentTableView!==e.active_table_view&&(console.log("== Reset the stored view. Stored one ["+t.currentTableView+"] is different from active one ["+e.active_table_view+"]"),t=null,e.widget.setValue("xsceneCustoV2",null))),y=s.initializeFromMePref(e.mePrefTableCusto,t,e.active_table_view);var V=require("DS/PADServices/utils/GlobalModelEvents");V.subscribe({event:"ENXViews/DGV/store"},e.__storeDGVPref.bind(e)),V.subscribe({event:"DS/ENXViews/SwitchTableView"},e.__switchTableView.bind(e))}catch(e){y=Promise.reject()}}else y=s.initialize({defaultAttributesJSON:"DS/PADServices/assets/init/AttributesMgt.json",appAttributesJSON:"DS/ENXScene/assets/json/AppDefaultAttributes.json"});y.then((async function(){var n,g=e.widget.isDeEnabled?((n=JSON.parse(h)).settings.columnViews.value.unshift({dataIndex:"asset-type",AMD:"DS/ENXNav/views/private/externalColumnsViews/designExpColumn"}),n.columnsCusto.order.unshift("asset-type"),n.columnsCusto.attributes.unshift({dataIndex:"asset-type"}),n):JSON.parse(h);if(!0===w.getSetting("activateLockUX")){for(let e=0;e<g.settings.columnViews.value.length;e++)"ds6w:reserved"===g.settings.columnViews.value[e].dataIndex&&(g.settings.columnViews.value[e].AMD="DS/ENXNav/views/private/externalColumnsViews/lockRO");g.settings.columnViews.value.push({dataIndex:"ds6w:reserved-Instance",AMD:"DS/ENXNav/views/private/externalColumnsViews/lockRO"}),g.columnsCusto.order=["tree","ds6w:label-Instance","ds6wg:revision","ds6w:type","ds6w:responsible","ds6w:status","ds6w:cadMaster","ds6w:reserved","positionMatrix-Instance","ds6w:description","hide_show","findinctx"],e.widget.isDeEnabled&&g.columnsCusto.order.unshift("asset-type")}v.mergeConfig(g);var p=e.widget.isDeEnabled?t:JSON.parse(u);e._odt_settings&&(p.padsettings=UWA.extend(p.padsettings,e._odt_settings,!0)),e.widget.isDeEnabled&&(e.widget.authorized_DE_types=p.padsettings.enxscene.run_options.type_kind.value.DesignEnv),e._migrate_settings(),c.initialize({widget:e.widget}),await a.addAsyncSharedSettings(e.widget,e.sharedSettings);let f=await o.loadAMD("DS/PADServices/utils/GrantedRolesCache");await f.initialize(),e.widget.mergePreferences(i.getWidgetPreferences()),e.widget.addEvent("endEdit",(function(){void 0!==e.widget&&-1!==i.getSetting("webInWin_context_availability").indexOf(e.widget.getValue("addinmode"))&&e.widget.getValue("X3DContentId")?e._processContentID({callback:function(){require("DS/PADServices/utils/GlobalModelEvents").publish({event:"ENXViews/WelcomePanel/closeLandingPage"}),e.widget.dispatchEvent("onContentAdded")}}):i.updateWidgetPreferences.call(i)})),i.updateWidgetPreferences(),i.setSetting("readOnlyDashboard",!!e.widget.readOnly&&e.widget.readOnly),e.widget.addEvent("onChangeControlUpdate",e._onChangeControlUpdateHandler.bind(e)),i.updateWidgetPreferences();var _,S=e.xnav_component_opts,D=!!widget.getValue("forceTouchMode")&&widget.getValue("forceTouchMode")||d.Features.touchEvents&&!d.Features.pointerEvents?p.action_bar.touch:p.action_bar.standard;if(c.isWebInWinContext()&&(D=p.action_bar.webinwin),!0===w.getSetting("activateMePref")&&(D={file:"ENXSceneV2TablePref.xml",module:"ENXScene"}),S.layout.propertiesFacet=i.getSetting("propertiesFacet"),D.language=e.widget.lang,S.x3dAppId=e.widget.getValue("x3dAppId"),S.widget=e.widget,S.insert_replace=!0,S.active_view=e.widget.getValue("default_view"),S.authorize_setStructure=!0,S.insert_replace=!0,S.renderTo=document.body,!0===i.getSetting("activateDropInviteWithFilter")&&(S.layout.drop_invite="inviteWithFilter"),!0===i.getSetting("authorizeChangeControl")&&(S.authorizeChangeControl=!0,void 0!==e.widget.getValue("changeControlActivation")&&i.setSetting("changeControlActivation",e.widget.getBool("changeControlActivation"))),"treelistview"===S.active_view&&(S.active_view="datagridview"),S.layout.amdTreeView="datagridview",!0!==e.xnav_component_opts.layout.noactionbar&&(S.action_bar_opts=D),S.configuration.toolbarActivated=!0===l(o.getURLParameter("activateToolbar")),S.configuration.dynamicCtxActivated=!0!==l(o.getURLParameter("NoCtxEvo"))&&!0!==i.getSetting("FUN103640-NoCtxEvo"),e._odt_settings&&e._odt_settings.onModifyViewSettings&&e._odt_settings.onModifyViewSettings(p.view_settings),!0===x)S.activeTableView=e.active_table_view,localStorage.removeItem("PADTreeListDefinition."+S.x3dAppId),e._initialize_component(S);else{s.updateAttributesList(g.columnsCusto);var P,A,b="null"===(_=e.widget.getValue("xscene_custoParams"))?null:_;b&&s.updateSelectedParams(JSON.parse(b));var E=i.getSetting("resetCustomization")||!0===w.getSetting("activateMePref");if(!E){"null"===(P=e.widget.getValue("xscene_custo"))&&(P=null);try{P=m.jsonUnzip(P),(P=r(P))&&(A=JSON.parse(P))}catch(e){E=!0}}E||P&&"{"!==P.charAt(0)&&!1===P.startsWith("ZIP:")?(localStorage.removeItem("PADTreeListDefinition."+S.x3dAppId),e._initialize_component(S)):A?(S.layout.view_customization=A,e._initialize_component(S)):require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADWSAccess"],(function(t,i){t.app_initialization((function(n){n&&n.success?i.getMyAppsTemplate({preference_name:S.x3dAppId+"-"+t.getPlatformId(),onComplete:function(t){var i=null;try{t.length>0&&(t.startsWith("ZIP:")&&(t=m.jsonUnzip(t)),"{"===(t=r(t)).charAt(0)&&(i=JSON.parse(t)).selectedExtensions&&i.selectedTypes&&(s.updateSelectedParams({selectedExtensions:i.selectedExtensions,selectedTypes:i.selectedTypes}),delete i.selectedExtensions,delete i.selectedTypes))}catch(e){}S.layout.view_customization=i,e._initialize_component(S)},onFailure:function(t){e._initialize_component(S)}}):e._initialize_failure()}))}))}})).catch((t=>{e._initialize_failure()}))}))},_onChangeControlUpdateHandler:function(e,t){var i=this,n=require("DS/PADUtils/PADSettingsMgt"),s="bottom-right";s=sessionStorage.getItem("changeControlPosition")?sessionStorage.getItem("changeControlPosition"):n.getSetting("changeControlPosition");var o=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");!1===t?(o.hide(),i.widget.addPreference({name:"changeControlPosition",type:"hidden",defaultValue:s})):(o.show(),i.widget.addPreference({name:"changeControlPosition",defaultValue:s,type:"list",label:"changeControlPosition_label",options:[{label:"bottom-right_label",value:"bottom-right"},{label:"bottom-left_label",value:"bottom-left"},{label:"top-right_label",value:"top-right"}]})),i.widget.dispatchEvent("onEdit")},onDestroy:function(){for(this.xnav_component.destroy(),this.xnav_component=null,this.welcome.destroy(),this.welcome=null;this.elements.mainBody.firstChild;)this.elements.mainBody.removeChild(this.elements.mainBody.firstChild);this.elements.mainBody.parentNode&&this.elements.mainBody.parentNode.removeChild(this.elements.mainBody),delete this.elements.mainBody,require("DS/PADUtils/PADSharedSettings").destroy(),require("DS/PADServices/utils/AttributesMgtV2").deleteMapping()},_migrate_settings:function(){var e=this.widget.getValue(i),t=this.widget.getValue(n),r=this.widget.getValue(s),l=a(e),c=(a(t),a(r)),d=!1,u={products:{},filters:{}};if(c)for(var g=Object.keys(c),p=0;p<g.length;p++){var v=g[p];if(!u.products[v]){u.products[v]={};c[v];d=!0}}if(l)for(var h=0;h<l.length;h++){var f=l[h];u.products[f]={},d=!0}if(d){this.widget.setValue(o,JSON.stringify(u)),require("DS/PADServices/utils/PADTrackerManager").addCommandHit("migrateSettings","init")}this.widget.deleteValue(i),this.widget.deleteValue(n),this.widget.deleteValue(s),this.widget.deleteValue("saved_filter_ids")},_initialize_component:function(e){var t=this,i=e||{};window.top.performance.mark(t.pcsPrefix+"_require_xnavcomponent_before"),require(["DS/PADServices/views/ENXWelcomePanel","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/GlobalUtils","DS/PADUtils/Configuration","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADProbes","DS/PADUtils/PADSettingsMgt","DS/PADServices/views/private/AppStructure","i18n!DS/ENXScene/assets/nls/ENXScene","DS/UIKIT/Mask","i18n!DS/PADServices/assets/nls/PADServices","DS/PADServices/settings/AppSettings","DS/PADServices/utils/SGIUtils"],(function(e,n,s,a,r,u,g,p,v,h,f,m,_){p.setWidget(t.widget),r.app_initialization((function(r){if(r&&!0!==r.success)t._initialize_failure();else{t._buildDOM(),h.mask(t.elements.mainBody,f.welcomePanel.appLoading);var u=n.getModelEvents(),p=t.widget.getValue("xsceneStoredObjects");"null"===p&&(p=null),"xsceneStoredObjects"===s.getURLParameter("cleanSetting")?(t.widget.deleteValue("xsceneStoredObjects"),p={products:{},filters:{}},t.widget.isDeEnabled&&(p.designEnv={})):UWA.is(p,"string")?p=JSON.parse(p):(p={products:{},filters:{}},t.widget.isDeEnabled&&(p.designEnv={}));var S=g.getSetting("pad_security_ctx");S?s.setSecurityContext(S):g.addEvent("onPad_security_ctx",(function(e){s.setSecurityContext(e)}));var w=m.getSetting("autoreload"),D=m.getSetting("showWelcomePanel"),P=t.widget.getValue("X3DContentId"),A=null!=P,b=void 0;p.supplementalNodes&&_.setSupplementalNodes(p);var E={appTitle:"Product Structure Explorer",description:v.appDescription,modelEvents:u,storedObjects:p,autoreload:w,structKey:o,readOnlyApp:a.getConfig("readOnlyApp"),mePrefActivated:m.getSetting("activateMePref")};t.widget.isDeEnabled&&(E.isDeEnabled=t.widget.isDeEnabled,E.authorized_DE_types=t.widget.authorized_DE_types),n.subscribe({event:"ENXModel/DesignEnv/addToRecents"},(function(e){d(e)}));Promise.all([]).then((function(){t.welcome=new e(E),t.welcome.initialize().then((function(){!0===D&&(!1!==w||A||(h.unmask(t.elements.mainBody),t._setActiveView(t.activeBody,t.welcome)))})),w&&(b=p),require(["DS/ENXNav/XNavComponent","DS/PADServices/utils/PADTrackerManager","DS/PADServices/settings/AppSettings"],(function(e,n,o){var a=[],r=[],d=new Promise((function(e){Promise.all(r).then((function(){if(!0!==g.getSetting("Activate_relationsColumns"))e();else{require(["DS/ENORIPE_RelationsColumns/RelationsColumns"],(function(t){t.isAdditionalColumnsAvailable((function(i){!0===i&&(a.push(t),t.setPreferenceProxy()),e()})),d.name="Add "+t.getName()}),e)}}))}));r.push(d),c(r,a,"DS/CfgWebAppEffectivityUX/scripts/CfgEffectivityColumns",(function(){return!0!==g.getSetting("removeCfgColumns")&&!0!==l(s.getURLParameter("no-pe-add-cfg-col"))})),c(r,a,"DS/CfgWebAppEffectivityUX/scripts/CfgConfigurationRevisionColumn",(function(){return!0!==g.getSetting("removeCfgColumns")&&!0!==l(s.getURLParameter("no-pe-add-cfg-col"))})),c(r,a,"DS/CfgWebAppEffectivityUX/scripts/CfgConfigurationContextColumn",(function(){return!0!==g.getSetting("removeCfgColumns")&&!0!==l(s.getURLParameter("no-pe-add-cfg-col"))})),c(r,a,"DS/CfgWebAppEffectivityUX/scripts/CfgProductConfigurationColumn",(function(){return!0!==g.getSetting("removeCfgColumns")&&!0!==l(s.getURLParameter("no-pe-add-cfg-col"))}));var u=new Promise((function(s){Promise.all(r).then((function(){!function(s){window.top.performance.mark(t.pcsPrefix+"_require_xnavcomponent_done"),window.top.performance.measure(t.pcsPrefix+"_require_xnavcomponent",t.pcsPrefix+"_require_xnavcomponent_before",t.pcsPrefix+"_require_xnavcomponent_done");var o=window.top.performance.getEntriesByName(t.pcsPrefix+"_require_infra"),a=o.length>0?o[o.length-1].startTime:void 0,r=o.length>0?o[o.length-1].duration:void 0,l=(o=window.top.performance.getEntriesByName(t.pcsPrefix+"_require_xnavcomponent")).length>0?o[o.length-1].startTime:void 0,c=o.length>0?o[o.length-1].duration:void 0,d=n.getPADTracker({eventCategory:"performance",eventAction:"2d_app_init"});d&&d.addMultivaluedEventData("2d_app_init",{require_infra_start:a,require_infra_duration:r,require_xnavcomponent_start:l,require_xnavcomponent_duration:c});var u=UWA.extend(i,t._addEventsCB());b&&(u.objects2Load=b),u.additionalColumnsModules=s,u.amd_custo.TreeDocument="DS/ENXNav/models/xNavTreeDocOcc",t.widget.isDeEnabled&&(u.isDeEnabled=t.widget.isDeEnabled,u.authorized_DE_types=t.widget.authorized_DE_types),t.xnav_component=new e(u)}(a),s()}))}));u.name="Launch real initialization",r.push(u)}))}))}}))}))},_initialize_failure:function(){var e=this;require(["css!DS/ENXScene/ENXScene","i18n!DS/ENXScene/assets/nls/ENXScene.json"],(function(t,i){e.elements||e._buildDOM();var n=UWA.createElement("div",{class:"explorer-load-failure"});let s=UWA.createElement("div",{class:"explorer-title"});s.innerText=i.errors.appTitle;let o=UWA.createElement("div",{class:"explorer-subtitle"});o.innerText=i.errors.errorLoad,s.inject(n),o.inject(n),e._setActiveView("failure-v2",n),e.widget.dispatchEvent("onXSceneReady",e)}))},_processContentID:function(e){var t=this,i=t.widget.getValue("X3DContentId"),n=UWA.is(i,"string")?JSON.parse(i):i;require(["DS/PADUtils/PADTypesMgt","DS/PADUtils/PADUtilsServices","DS/ENXNav/utils/xNavKindProcessor"],(function(i,s,o){i.retrieveAuthorizedObjects({version:"2.0",X3DContentId:n,behavior:"WITH_CONTEXT",displayNotif:!1,callback:function(i){var n=i.authorized_objects[0].envId;s.updatePlatformId(n),o.loadKinds(t.xnav_component,i,"fromx3dContentId",!1,e&&e.callback?e.callback:void 0),t.widget.deleteValue("X3DContentId")}})}))},_addEventsCB:function(){var e=this,t={events:{onReady:function(t){require("DS/UIKIT/Mask").unmask(e.elements.mainBody),window.top.performance.mark(e.pcsPrefix+"_xnavcomponent_onready"),window.top.performance.measure(e.pcsPrefix+"_xnavcomponent_ready",e.pcsPrefix+"_require_xnavcomponent_done",e.pcsPrefix+"_xnavcomponent_onready");var i=require("DS/PADServices/utils/PADTrackerManager"),n=(c=window.top.performance.getEntriesByName(e.pcsPrefix+"_xnavcomponent_ready")).length>0?c[c.length-1].startTime:void 0,s=c.length>0?c[c.length-1].duration:void 0,o=i.getPADTracker({eventCategory:"performance",eventAction:"2d_app_init"});o&&o.addMultivaluedEventData("2d_app_init",{app_loading_start:n,app_loading_duration:s});var a=e.widget.getValue("X3DContentId"),r=require("DS/PADServices/utils/GlobalModelEvents");UWA.is(a)&&e._processContentID({callback:function(){e.xnav_component.getRoots().length>0&&r.publish({event:"ENXViews/WelcomePanel/closeLandingPage"})}}),e.widget.addEvent("onViewChange",e.xnav_component.onResize.bind(e.xnav_component)),e.widget.addEvent("onResize",e.xnav_component.onResize.bind(e.xnav_component));var l=(r=require("DS/PADServices/utils/GlobalModelEvents")).getModelEvents();l.subscribe({event:"ENXViews/Views/showInWidgetBody"},(function(t){t.html?(t.title&&widget.setTitle(t.title),e._setActiveView(t.idView,t.html)):!0===t.restore&&(widget.setTitle(e.xnav_component.getWidgetTitle()),"welcome"===e.previousBody?e._setActiveView("welcome",e.welcome):"app"!==e.previousBody&&"app"!==t.idView||e._setActiveView("app",e.xnav_component))})),require("DS/PADUtils/PADSharedSettings").resetDebounceFlags(),e.xnav_component.addEvent("onToggleView",(function(t){e.widget.setValue("default_view",t)})),t&&t.addInView&&e._setActiveView("app",e.xnav_component),t&&!0===t.error&&e._initialize_failure(),l.subscribe({event:"ENXViews/WelcomePanel/openContent"},(function(t){switch(e._setActiveView("app",e.xnav_component),t.mode){case"welcome":e.xnav_component.openStoredObjects(t);break;case"drop":e.xnav_component.openDroppedObjects(t).then((function(t){if(t&&t.error&&"noAuthObj"!==t.error){require("DS/PADUtils/PADSettingsMgt").getSetting("welcomeonempty")&&0===e.xnav_component.getRoots().length&&e._setActiveView("welcome",e.welcome)}}))}})),l.subscribe({event:"ENXViews/WelcomePanel/removeFromStored"},(function(t){if(t.item2remove){var i=t.item2remove,n=[],s=require("DS/PADServices/utils/SGIUtils");s.removeIdsFromMap(i);var o=e.widget.getValue("xsceneStoredObjects");if("null"===o&&(o=null),UWA.is(o,"string")){o=JSON.parse(o);var a,r,l=i.length,c=!1;for(a=0;a<l;a++){if(o.products&&o.products.hasOwnProperty(i[a]))(g=e.xnav_component.options.model.searchRootById(i[a]))&&n.push(i[a]),delete o.products[i[a]],c=!0;if(o.filters){var d=Object.getOwnPropertyNames(o.filters);for(r=d.length-1;r>=0;r--){var u,g;if(o.filters[d[r]].associatedProduct===i[a]?u=i[a]:d[r]===i[a]&&(u=o.filters[d[r]].associatedProduct),u)(g=e.xnav_component.options.model.searchRootById(u))&&(e.xnav_component.options.model.removeRoot(g,t.noDispatch),n.push(d[r])),delete o.filters[d[r]],c=!0}}}if(c){let e=s.getSupplementalMap();e&&(o.supplementalNodes=e),widget.setValue("xsceneStoredObjects",JSON.stringify(o))}if(n.length){var p=require("DS/PADServices/utils/GlobalModelEvents").getModelEvents();p.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"deleteRoots",removeIds:n}}),p.publish({event:"ENXViews/WelcomePanel/removeFromView",data:{item2remove:n}})}}}})),l.subscribe({event:"ENXViews/WelcomePanel/activate"},(function(t){l.publish({event:"ENXViews/WelcomePanel/refreshView"}),"fromHome"===t&&(e.welcome.fromHome=!0),e._setActiveView("welcome",e.welcome)})),l.subscribe({event:"ENXViews/WelcomePanel/closeLandingPage"},(function(){e._setActiveView("app",e.xnav_component)})),l.subscribe({event:"ENXViews/WelcomePanel/unselectAllInModel"},(function(){e.xnav_component.getPADTreeDocument().unselectAll()})),l.subscribe({event:"ENXViews/WelcomePanel/removeFromView"},(function(t){if(!t.fromWLSync){var i=t.item2remove,n=i?i.length:0,s=e.xnav_component.getPADTreeDocument();s.withTransactionUpdate((function(){for(var e=0;e<n;e++){var t=s.searchRootById(i[e]);t&&s.removeRoot(t)}}))}})),e.appReady=!0,l.publish({event:"ENXViews/WelcomePanel/appReady"}),window.top.performance.mark(e.pcsPrefix+"_app_load_complete"),window.top.performance.measure(e.pcsPrefix+"_app_load_completed","enxscene_load_html",e.pcsPrefix+"_app_load_complete");var c,d=(c=window.top.performance.getEntriesByName(e.pcsPrefix+"_app_load_completed")).length>0?c[c.length-1].duration:void 0;o&&(o.setEventData({eventLabel:"Initialization",eventValue:d}),o.trackPageEvent()),e.widget.dispatchEvent("onXSceneReady",e),!1===require("DS/PADServices/settings/AppSettings").getSetting("showWelcomePanel")&&e._setActiveView("app",e.xnav_component),r.publish({event:"ENXViews/WelcomePanel/loadData"})},onAddDesignEnv:function(e){d(e)},onAddPaths:function(t){var i=require("DS/PADServices/views/private/AppStructure"),n=i.retrieveData(o);t.addedPaths&&e.widget.isDeEnabled&&this.hasActiveDesignExp()&&this.getPseService().isDesignExpLoading&&this.getPseService().checkBeforeAddingToRecent(t),i.addProductPath(n,t.addedPaths),i.addOpenProduct(n,t.addedPaths),i.persistData(o,n);var s=require("DS/PADServices/utils/GlobalModelEvents").getModelEvents();s.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"products",addedPaths:t.addedPaths}}),s.publish({event:"ENXViews/WelcomePanel/closeLandingPage"})},onAddFilters:function(t){for(var i=require("DS/PADServices/views/private/AppStructure"),n=i.retrieveData(o),s={filters:{},filters2Ignore:[]},a=0;a<t.filterIds.length;a++){var r=t.filterIds[a];e.widget.isDeEnabled&&this.hasActiveDesignExp()&&this.getPseService().isDesignExpLoading?this.getPseService().shouldAddFilterToRecent(r)?(i.addFilter(n,r,t.rootIds[a]),i.addOpenFilter(n,[r]),s.filters[r]={associatedProduct:t.rootIds[a],filterName:t.filterNames[a]}):s.filters2Ignore.push(r):(i.addFilter(n,r,t.rootIds[a]),i.addOpenFilter(n,[r]),s.filters[t.filterIds[a]]={associatedProduct:t.rootIds[a],filterName:t.filterNames[a]})}i.persistData(o,n);var l=require("DS/PADServices/utils/GlobalModelEvents").getModelEvents();l.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"filters",addedFilters:s}}),l.publish({event:"ENXViews/WelcomePanel/closeLandingPage"})},onDeleteRoots:function(e){var t=JSON.parse(e.str_removeIds);require("DS/PADServices/utils/SGIUtils").removeIdsFromMap(t);var i=require("DS/PADServices/views/private/AppStructure"),n=i.retrieveData(o),s=i.removeOpen(n,t);i.persistData(o,n);var a=require("DS/PADServices/utils/GlobalModelEvents");a.getModelEvents().publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"removeFromView",removedFromViewIds:s,fromWLSync:e.fromWLSync}}),e.fromWLSync||a.publish({event:"ENXViews/Model/remove"}),this?.options?.isDeEnabled&&this?.hasActiveDesignExp()&&!this.getRoots().length&&this.getPseService().applyDefaultSort()},onEmptyView:function(){},onCustoViewChange:function(t,i){var n=require("DS/PADServices/utils/ZipUtils").jsonZip(JSON.stringify(t));if(e.widget.setValue("xscene_custo",n),i&&e.widget.setValue("xscene_custoParams",JSON.stringify(i)),e.xnav_component&&e.xnav_component.options){var s=e.xnav_component.options.views.datagridview;s&&(s.columnOrdering=!0)}},onTenantChange:function(t){e.welcome.tenantChange(),require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADWSAccess","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/ZipUtils"],(function(i,n,s,o){n.getMyAppsTemplate({preference_name:e.widget.getValue("x3dAppId")+"-"+i.getPlatformId(),onComplete:function(e){var i=null;e.length>0&&(e=o.jsonUnzip(e),(i=JSON.parse(e)).selectedExtensions&&i.selectedTypes&&(s.updateSelectedParams({selectedExtensions:i.selectedExtensions,selectedTypes:i.selectedTypes}),delete i.selectedExtensions,delete i.selectedTypes)),t.updateTreeView(i)},onFailure:function(e){t.updateTreeView()}})}))},onSaveAsTemplate:function(t){t&&t.selectedExtensions&&t.selectedTypes&&e.widget.setValue("xscene_custoParams",JSON.stringify({selectedExtensions:t.selectedExtensions,selectedTypes:t.selectedTypes}));var i=require("DS/PADServices/utils/ZipUtils").jsonZip(JSON.stringify(t));e.widget.setValue("xscene_custo",i),require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADWSAccess"],(function(e,t){t.saveMyAppsTemplate({preference_name:widget.getValue("x3dAppId")+"-"+e.getPlatformId(),value:i,onComplete:function(e){},onFailure:function(e){}})}))}}};return!0===require("DS/PADServices/settings/AppSettings").getSetting("activateMePref")?t.events.onAuthoringCtxAvailable=function(e){let t=require("DS/PADServices/settings/AppSettings");var i=t.getSetting("changeControlActivation"),n=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");!0===i?n.show():n.hide();var s=t.getSetting("changeControlPosition");n.setPosition(s),n.addEvent&&n.addEvent("onAuthoringCtxVisible",(function(e){t.setSetting("changeControlActivation",e.showAuthoringContext);var i=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");!0===e.showAuthoringContext?i.show():i.hide(),require("DS/PADUtils/PADSettingsMgt").setSetting("changeControlDlgOpen",!0)}))}:t.events.onAuthoringCtxAvailable=function(t){var i=require("DS/PADUtils/PADSettingsMgt"),n=require("DS/PADUtils/PADCommandProxy");e.debouncePrefSynchro=!1,e._proxy=n.create({events:{onPreferenceModification:function(t){"changeControlActivation"===t.name&&(e.debouncePrefSynchro=!0,e.widget.setValue(t.name,t.value),i.setSetting(t.name,t.value))}}}),e.widget.addEvent("endEdit",(function(t){if(t&&!1===t.submitted){var n="bottom-right";n=sessionStorage.getItem("changeControlPosition")?sessionStorage.getItem("changeControlPosition"):i.getSetting("changeControlPosition");var s=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");!1===e.widget.getBool("changeControlActivation")?(s.hide(),e.widget.addPreference({name:"changeControlPosition",type:"hidden",defaultValue:n})):(s.show(),e.widget.addPreference({name:"changeControlPosition",defaultValue:n,type:"list",label:"changeControlPosition_label",options:[{label:"bottom-right_label",value:"bottom-right"},{label:"bottom-left_label",value:"bottom-left"},{label:"top-right_label",value:"top-right"}]}))}}));var s=i.getSetting("changeControlActivation");s=void 0!==e.widget.getValue("changeControlActivation")?e.widget.getBool("changeControlActivation"):t.isAuthoringContextVisible;var o="bottom-right";o=sessionStorage.getItem("changeControlPosition")?sessionStorage.getItem("changeControlPosition"):i.getSetting("changeControlPosition");var a=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");a.setPosition(o),e.widget.addPreference({name:"changeControlActivation",defaultValue:s,type:"boolean",label:"changeControlActivation_label",onchange:"onChangeControlUpdate"}),!0===s?(a.show(),e.widget.addPreference({name:"changeControlPosition",defaultValue:o,type:"list",label:"changeControlPosition_label",options:[{label:"bottom-right_label",value:"bottom-right"},{label:"bottom-left_label",value:"bottom-left"},{label:"top-right_label",value:"top-right"}]})):(a.hide(),e.widget.addPreference({name:"changeControlPosition",type:"hidden",defaultValue:o})),i.setSetting("changeControlActivation",s,!0),i.addEvent("onChangeControlActivation",e._onChangeControlActivation.bind(e)),a.addEvent&&a.addEvent("onAuthoringCtxVisible",(function(t){i.setSetting("changeControlActivation",t.showAuthoringContext,!0),e._onChangeControlActivation(t.showAuthoringContext),i.setSetting("changeControlDlgOpen",!0)})),i.addEvent("onChangeControlPosition",(function(e){require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext").setPosition(e),sessionStorage.setItem("changeControlPosition",e)}))},t},onSearch:function(e){this.xnav_component&&this.xnav_component.onSearch({query:e})},_onChangeControlActivation:function(e){var t=this,i=require("DS/PADUtils/PADSettingsMgt"),n=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");t.debouncePrefSynchro?t.debouncePrefSynchro=!1:t._proxy.preferenceModification({name:"changeControlActivation",value:e});var s="bottom-right";s=sessionStorage.getItem("changeControlPosition")?sessionStorage.getItem("changeControlPosition"):i.getSetting("changeControlPosition"),n.setPosition(s),!0===e?(n.show(),t.widget.addPreference({name:"changeControlPosition",defaultValue:s,type:"list",label:"changeControlPosition_label",options:[{label:"top-right_label",value:"top-right"},{label:"top-left_label",value:"top-left"},{label:"bottom-right_label",value:"bottom-right"},{label:"bottom-left_label",value:"bottom-left"}]})):(n.hide(),t.widget.addPreference({name:"changeControlPosition",type:"hidden",defaultValue:s}))},_buildDOM:function(){if(!this.elements){this.elements={};var e=this.elements.mainBody=UWA.createElement("div");this.elements.mainBody.classList.add("explorer-root"),this.elements.mainBody.classList.add("enx-appMainBody"),this.elements.mainBody.id="product-explorer-app",this.elements.mainBody.style.position="absolute",this.elements.mainBody.style.height="100%",this.elements.mainBody.style.width="100%",self.widget.setBody(e)}},_setActiveView:function(e,t){var i;(this.initDiv||(this.initDiv={}),void 0===e&&(e="default-"+Date.now()),this.previousBody=this.activeBody,this.activeBody=e,!0!==this.initDiv[e])&&(this.elements[e]||(this.elements[e]=document.createElement("div"),this.elements[e].classList.add("explorer-"+e),this.elements[e].classList.add("explorer-div"),this.elements.mainBody.appendChild(this.elements[e])),"function"==typeof t.render?(i=t.render(),this.initDiv[e]=!0):i=t,this.elements[e].appendChild(i));this._showActiveView(e)},_showActiveView:function(e){for(var t=Object.keys(this.elements),i=0;i<t.length;i++)e===t[i]?this.elements[t[i]].classList.remove("explorer-hidden"):"mainBody"!==t[i]&&this.elements[t[i]].classList.add("explorer-hidden");window.dispatchEvent(new Event("resize"))},__storeDGVPref:function(e){let t=require("DS/PADServices/utils/ZipUtils");e.currentTableView=this.active_table_view;var i=t.jsonZip(JSON.stringify(e));this.widget.setValue("xsceneCustoV2",i),this.widget.getValue("xscene_custo")&&this.widget.deleteValue("xscene_custo")},__switchTableView:async function(e){console.log("== Switch table view "+e.view);let t=require("i18n!DS/ENXScene/assets/nls/ENXScene.json");this.xnav_component.beginBlockingTransaction(t.switchingTableView),this.widget.setValue("xsceneCustoV2",null),!0===e.updateActiveView&&(this.active_table_view=e.view);let i=require("DS/PADServices/utils/AttributesMgtV2");await i.initializeFromMePref(this.mePrefTableCusto,null,this.active_table_view),this.widget.setValue("Explorer_Active_TableView",e.view),await this.xnav_component.updateTableView(this.active_table_view),this.xnav_component.endBlockingTransaction(),this.xnav_component.refresh()},__readPreferences:async function(){return new Promise((async(e,t)=>{require(["DS/MePreferencesClientAPI/MePreferencesClientAPI","DS/PlatformAPI/PlatformAPI","DS/PADServices/settings/AppSettings"],((i,n,s)=>{let o=s.getSetting("activateMePrefV2");n.subscribe("com.ds.mep:onPrefUpdate",this.__preferencesUpdated.bind(this)),i.readPreferences([{Repository:"StructureExploreRepository",PreferenceNames:this.mepreferences}]).then((i=>{try{this.mePrefTableCusto={default:null,views:[]};for(let e=0;e<i.repositories.length;e++){let t=i.repositories[e];if("StructureExploreRepository"===t.name){let n=t.preferences;for(let t=0;t<n.length;t++)switch(n[t].name){case"TABLE_DEFAULT":this.mePrefTableCusto.default=JSON.parse(i.repositories[e].preferences[t].value).ENO2D_VIEWS[0];break;case"TABLE_CUSTO":this.mePrefTableCusto.views=[].concat(JSON.parse(i.repositories[e].preferences[t].value).ENO2D_VIEWS);break;case"TABLE_DENSITY":this.mePrefTableCusto.TABLE_DENSITY=i.repositories[e].preferences[t].value;break;case"TABLE_ROW_HDR":this.mePrefTableCusto.TABLE_ROW_HDR="true"===i.repositories[e].preferences[t].value;break;case"RELOAD_SESSION":!0===o&&(s.setSetting("autoreload","true"===i.repositories[e].preferences[t].value),this.widget.deleteValue("autoreload"));break;case"SHOW_WP_STARTUP":!0===o&&(s.setSetting("showWelcomePanel","true"===i.repositories[e].preferences[t].value),this.widget.deleteValue("showWelcomePanel"));break;case"RETRIEVE_INSTANCES":!0===o&&(s.setSetting("synthesisModeOnInstance","true"===i.repositories[e].preferences[t].value),this.widget.deleteValue("synthesisModeOnInstance"));break;case"AUTH_CTX_DEF":!0===o&&(s.setSetting("changeControlActivation","true"===i.repositories[e].preferences[t].value),this.widget.deleteValue("changeControlActivation"));break;case"AUTH_CTX_POS_DEF":!0===o&&(s.setSetting("changeControlPosition",i.repositories[e].preferences[t].value),this.widget.deleteValue("changeControlPosition"));break;case"HIDESHOW_INHERIT":if(!0===o){const n="true"===i.repositories[e].preferences[t].value;!0===s.getSetting("hideShowInheritanceDisabled")?(s.setSetting("hideShowInheritance",!1),this.widget.deleteValue("hideShowInheritance"),this.onRefresh()):(s.setSetting("hideShowInheritance",n),this.widget.deleteValue("hideShowInheritance"))}break;default:console.log("== Unknown preference "+n[t].name)}}}e()}catch(e){this._initialize_failure(),t()}})).catch((()=>{this._initialize_failure(),t()}))}))}))},__preferencesUpdated:function(e){try{let t=JSON.parse(e[1].preferences),i=require("DS/PADServices/utils/PADTrackerManager"),n=require("DS/PADServices/utils/GlobalModelEvents"),s=require("DS/PADServices/settings/AppSettings"),o=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");for(let e=0;e<t.repositories.length;e++){let a=t.repositories[e];if("StructureExploreRepository"===a.name){let r=a.preferences;for(let a=0;a<r.length;a++)switch(i.addCommandHit(r[a].name,"updateMePref"),r[a].name){case"TABLE_DEFAULT":console.log("== Update TABLE_DEFAULT preference =="),this.mePrefTableCusto.default=JSON.parse(r[a].value).ENO2D_VIEWS[0],this.__switchTableView({view:this.active_table_view});break;case"TABLE_CUSTO":console.log("== Update TABLE_CUSTO preference =="),this.mePrefTableCusto.views=[].concat(JSON.parse(r[a].value).ENO2D_VIEWS);let l=null;if(this.active_table_view===this.mePrefTableCusto.default.ENO2D_VIEW_NAME)l=this.mePrefTableCusto.default.ENO2D_VIEW_NAME;else{0===this.mePrefTableCusto.views.filter((e=>{if(e.ENO2D_VIEW_NAME===this.active_table_view)return!0})).length&&(l=this.mePrefTableCusto.views[0].ENO2D_VIEW_NAME,this.active_table_view=l)}this.__switchTableView({view:l});break;case"TABLE_DENSITY":n.publish({event:"ENXViews/DatagridView/changeDensity",data:{layoutDensity:r[a].value}});break;case"TABLE_ROW_HDR":n.publish({event:"ENXViews/DatagridView/changeRowsHeader",data:{rowsHeader:"true"===r[a].value}});break;case"RETRIEVE_INSTANCES":let c="true"===t.repositories[e].preferences[a].value;s.setSetting("synthesisModeOnInstance",c),n.publish({event:"ENXModel/synthesisModeOnInstance",data:c});break;case"AUTH_CTX_DEF":let d="true"===t.repositories[e].preferences[a].value;s.setSetting("changeControlActivation",d),!0===d?o.show():o.hide();break;case"AUTH_CTX_POS_DEF":s.setSetting("changeControlPosition",t.repositories[e].preferences[a].value),o.setPosition(t.repositories[e].preferences[a].value);break;case"HIDESHOW_INHERIT":const u="true"===t.repositories[e].preferences[a].value;s.setSetting("hideShowInheritance",u);const g=this.xnav_component;g&&(g.isLinkedTo3D()&&g.isAllLinkImplENXContentExt()?s.setSetting("hideShowInheritanceDisabled",!u):s.setSetting("hideShowInheritanceDisabled",!0)),i.getPADTracker({eventCategory:"usage",eventAction:"hide_show_inheritance",eventLabel:u}),this.onRefresh();break;default:console.log("== Unknown preference "+r[a].name)}}}}catch(e){console.warn("Cannot parse preferences")}}};return u.init(e),u}