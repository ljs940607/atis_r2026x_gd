define("DS/DocumentCommands/DOCMClipboard",["UWA/Core","UWA/Promise","DS/WAFData/WAFData","DS/CoreEvents/ModelEvents","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],(function(e,t,o,n,i,a){"use strict";return{events:new n,contentCopied:!1,copy:function(e){window.docmClipboard=e,this.contentCopied=!0,this.events.publish({event:"x3dcontent-copied",data:{cancelled:!1,data:this.contentCopied}})},paste:function(e){window.docmClipboard&&e&&e({action:"Paste",data:window.docmClipboard})}}})),define("DS/DocumentCommands/V2/FileActions/CopyLink",["UWA/Core","UWA/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Dropdown","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o,n,i,a,s){"use strict";var l=function(e){return{id:"CopyLink",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"link",fontIconFamily:1},tooltip:s.get("CopyLink"),label:s.get("CopyLink"),position:"far",category:"colllaboration",value:function(t){t.options=e,l.execute(t)},visibleFlag:!1},execute:function(){l.execute({options:e})},updateForSelection:function(o,n){return new t((function(t){o({visibleFlag:"MultiFilePreviewtoolbar"==e.getOrigin().component||1==e.getSelectedNodes().length}),t(!0)}))}}};return l.execute=function(t){var a=t.options.getSelectedNodes(),l=void 0;a.length>0&&(l=a[0]);var c=void 0;l&&(c=t.options.getDocumentFromNodeModel(l));var r=t.options.getParentDocument(),d=t.options.container,u=void 0;c&&null==(u=c.title||c.name)&&c.dataelements&&(u=c.dataelements.title||c.dataelements.name);var m=function(e){var t={protocol:"3DXContent",data:{items:[]}};t.data.items.push({envId:e.envId,objectId:e.objectId,openLink:!0,objectType:"Document"}),e.fileid&&(t.data.items[0].fileid=e.fileid,t.data.items[0].openFile=!0);return t}({objectId:r,envId:t.options.platformUrls.platformId,fileid:c?c.id:void 0,titleOrName:u}),p=e.createElement("div",{styles:{display:"flex"}}),f=new n("input",{attributes:{readonly:"readonly"}});f.getContent().setStyles({display:"inline-block","border-top-right-radius":0,"border-bottom-right-radius":0}),f.inject(p);var g=new o({value:s.get("CopyLink"),className:"block",events:{onClick:function(o){f.setFocus(),f.elements.input.select(),f.elements.input.setSelectionRange(0,99999),document.execCommand("cut"),D.hide(),u&&""!==u?t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:s.get("LinkCopiedTitle"),subtitle:e.String.format(s.get("LinkCopiedMsg"),u),message:"",sticky:!1,allowUnsafeHTML:!1}}):t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:s.get("LinkCopiedTitle"),subtitle:s.get("LinkCopied"),message:"",sticky:!1,allowUnsafeHTML:!1}})}}});g.getContent().setStyles({display:"inline-block","border-top-left-radius":0,"border-bottom-left-radius":0,padding:"0 10px"}),g.inject(p);var v,D=new i({body:p,closeOnClick:!1,events:{onClickOutside:function(e){console.log("DDClickOutside")}}});if(D.options.target=d,t.options&&t.options.platformUrls&&t.options.platformUrls["3DDashboard"]&&(v=t.options.platformUrls["3DDashboard"]),null==v&&(v=t.options.widget.widgetDomain),console.log(v),null==v)throw"url is undefined.";D.hide(),D.show(),f.setFocus(),f.setValue(v+"#app:ENXWDOC_AP/content:X3DContentId="+encodeURIComponent(JSON.stringify(m))),f.elements.input.select(),f.elements.input.setSelectionRange(0,99999,"backward"),g.getContent().click()},l})),define("DS/DocumentCommands/V2/Actions/NewBranch",["UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t){"use strict";var o=function(n){return{id:"NewBranch",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"flow-branch-add",fontIconFamily:1},label:t.get("NewBranch"),tooltip:t.get("NewBranch"),position:"far",category:"lifecycle",value:function(e){e.options=n,o.execute(e)},visibleFlag:!1},execute:function(){o.execute({options:n})},updateForSelection:function(t){return new e((function(e){t({visibleFlag:n.getSelectedNodes().length>=1}),e(!0)}))}}};return o.execute=function(e){require(["DS/LifecycleCmd/NewBranchCmd"],(function(t){var o=e.options.getSelectedNodes().map((function(e){return{physicalid:e.options.data.id,getID:function(){return e.options.data.id}}}));(t=new t({ID:"newBranch_cmd_ID",context:{getSelectedNodes:()=>o,securitycontext:e.options.fetchSecurityContext(),getSecurityContext:function(){return{SecurityContext:this.securitycontext}},getUUID:function(){return e.options.getOrigin?JSON.stringify(UWA.extend(e.options.getOrigin(),{action:"new-branch"})):"docv2.new-branch."+Date.now()}}})).begin()}))},o})),define("DS/DocumentCommands/V2/Actions/Subscription/UnSubscribe",["i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e){"use strict";var t=function(o){return{id:"UnSubscribe",type:"PushItem",title:e.get("UnSubscribe"),dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"bell-delete",fontIconFamily:1},label:e.get("UnSubscribe"),tooltip:e.get("UnSubscribe"),position:"far",category:"information",value:function(e){e.options=o,t.execute(e)},visibleFlag:!1},execute:function(){t.execute({options:o})},updateForSelection:function(e,t){e({visibleFlag:o.getSelectedNodes().length>=1})}}};return t.execute=function(e){require(["DS/ENOSubscriptionMgmt/Commands/UnSubscribe"],(function(t){var o=e.options.getSelectedNodes().map((function(t){var o=e.options.getDocumentFromNodeModel(t);return{physicalid:o.id,type:o.type,getID:function(){return o.id},getType:function(){return o.type}}}));new t({ID:"UnSubscribeCmdHdr",context:{getSelectedNodes:()=>o},objIDType:"modelID"}).execute(e)}))},t})),define("DS/DocumentCommands/V2/FileActions/Delete",["UWA/Core","UWA/Promise","DS/UIKIT/Modal","DS/WAFData/WAFData","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o,n,i,a){"use strict";var s=function(e){return{id:"Delete",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"trash",fontIconFamily:1},label:a.get("Delete"),tooltip:a.get("Delete"),position:"far",category:"destructive",value:function(t){t.options=e,s.execute(t)},visibleFlag:!1},execute:function(){s.execute({options:e})},updateForSelection:function(o,n){return new t((function(t){o({visibleFlag:e.getSelectedNodes().length>0}),t(!0)}))}}};return s.execute=function(t){if(t.options.getSelectedNodes().length>0){var s='<div style="display: flex;"><span class="fonticon fonticon-attention text-warning fonticon-2x"></span><p style="margin-left: 10px; white-space: pre-line">'+a.get("DeleteConfirmationMsg")+"</p></div>",l=new o({className:"site-reset",header:a.get("DeleteConfirmation",""),body:s,footer:'<button type="button" class="btn btn-primary">'+a.get("Confirm")+'</button> <button type="button" class="btn btn-default">'+a.get("Cancel")+"</button>",animate:!0,resizable:!0,autocenter:!0,visible:!0,limitParent:!0,overlay:!0,closable:!1});function c(){let t=i.get(),o=e.is(t)&&e.is(t.change.id)?t.change.id:null;return""!=o?{"DS-Change-Authoring-Context":"pid:"+o}:{}}function r(t){var o={},i=t.options.getParentDocument(),s=t.options.getSelectedNodes();o.tenant=t.options.platformUrls.platformId,o.securityContext=t.options.fetchSecurityContext()?encodeURIComponent(t.options.fetchSecurityContext()):void 0,o.tenantUrl=t.options.platformUrls["3DSpace"],o.onFailure=function(e,o){var n="Document";if(o.error)t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("YouCannotDeleteX",{typeNLS:n}),subtitle:a.get("VerifyCredentials"),message:a.get("NotHaveRequiredAccessRole"),sticky:!1,allowUnsafeHTML:!1}});else if(e&&e.error)if((e.error.match(/\n/g)||[]).length>=2){for(var i=e.error.split("\n"),s=[],l=2;l<i.length;l++)s.push(i[l]);s=s.join("<br/>"),t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:i[0],subtitle:i[1],message:s,sticky:!1,allowUnsafeHTML:!0}})}else t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("YouCannotDeleteX",{typeNLS:n}),subtitle:e.error,message:"",sticky:!1,allowUnsafeHTML:!1}});else t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("YouCannotDeleteX",{typeNLS:n}),subtitle:e,message:"",sticky:!1,allowUnsafeHTML:!1}});console.error("Document Delete Failed Due to:"),console.error(e)},o.onComplete=function(o){t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:a.get("Filedeletesuccessful"),subtitle:e.String.format(a.get("FiledeletesuccessfulMsg")),message:"",sticky:!1,allowUnsafeHTML:!1}}),t.options.events.publish({event:"enox-docfiles-delete-complete",data:{nodeModels:s,data:o.data}}),require(["DS/PlatformAPI/PlatformAPI"],(function(e){e.publish("docm-files-deleted-from-document",{platformId:t.options.platformUrls.platformId,documentId:i,deletedFileIds:s.map((function(e){return e.options.data.id}))})}))};var l=[];s.map((function(e){var o={id:t.options.getDocumentFromNodeModel(e).id,updateAction:"DELETE"};l.push(o)})),n.authenticatedRequest(o.tenantUrl+"/resources/v1/application/E6WFoundation/CSRF",e.extend({},{method:"GET",url_temp:o.tenantUrl,onComplete:function(t){o.onComplete,o.onFailure;var a=o.tenantUrl+"/resources/v1/modeler/documents/"+i+"/files";o.type="json",o.url=encodeURI(a);var s=JSON.parse(t).csrf;o.data=JSON.stringify({csrf:s,data:l}),o.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:o.securityContext},o.headers=e.merge(o.headers,c()),o.method="PUT",n.authenticatedRequest(o.url,o)}}))}l.show(),l.elements.container.setStyle("z-index","50000"),l.inject(t.options.widget.body),l.getContent().getElements(".btn.btn-primary").forEach((function(e){e.addEvent("click",(function(){r(t),l.hide(),l.destroy()}))})),l.getContent().getElements(".btn.btn-default").forEach((function(e){e.addEvent("click",(function(){l.hide(),l.destroy()}))}))}},s})),define("DS/DocumentCommands/V2/Actions/Move",["UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t){"use strict";var o=function(n){return{id:"Move",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"move-to",fontIconFamily:1},label:t.get("Move"),tooltip:t.get("Move"),position:"far",category:"colllaboration",value:function(e){e.options=n,o.execute(e)},visibleFlag:!1},execute:function(){o.execute({options:n})},updateForSelection:function(t,o){return new e((function(e){t({visibleFlag:n.getSelectedNodes().length>=1}),e(!0)}))}}};return o.execute=function(e){require(["DS/ENOCollabSharingCmds/commands/TransferOwnershipCmd/ActionBar_ChangeOwnerCmd"],(function(t){var o=e.options.getSelectedNodes().map((function(e){var t=e;return t.options.physicalid&&0!=t.options.physicalid.length||(t.options.physicalid=t.options.data.id),t.getID||(t.getID=function(){return t.options.physicalid}),t}));(t=new t({ID:"changeOwner_cmd_id",context:{getSelectedNodes:()=>o,securityContext:{SecurityContext:e.options.fetchSecurityContext()},getSecurityContext:function(){return this.securityContext}}})).begin()}))},o})),define("DS/DocumentCommands/V2/FileActions/Preview",["UWA/Core","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o){"use strict";var n=void 0,i=void 0,a=function(e){return{id:"Preview",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"eye",fontIconFamily:1},label:o.get("Preview"),tooltip:o.get("Preview"),position:"far",category:"view",value:function(t){t.options=e,a.execute(t)},visibleFlag:!1},execute:function(t){a.execute({options:e},t)},updateForSelection:function(o,n){return new t((function(t){o({visibleFlag:1==e.getSelectedNodes().length}),t(!0)}))}}};return a.execute=function(e,t){var o=t||e.options.getSelectedNodes()[0],a=e.options.getParentDocument(),s=e.options.getDocumentFromNodeModel(o);e.options.getDocumentFromNodeModel(o)&&e.options.ctrl.controller.data.getFiles(a).then((function(t){var o=t.e6wDocument;require(["DS/DocumentMultiFilePreview/MultiFilePreviewComponent"],(function(t){n&&(e.options.events.unsubscribe(n),n=void 0),n=e.options.events.subscribe({event:"docv2-preview-reload-viewer"},(function(t){if(e.options.widget.multiFilePreviewComponent&&1==e.options.getSelectedNodes().length&&null!=t.nodeModel){var o=e.options.getSelectedNodes()[0],n=e.options.getDocumentFromNodeModel(o);e.options.getDocumentFromNodeModel(t.nodeModel).id==n.id&&e.options.widget.multiFilePreviewComponent.updateDocument(n,!0)}})),i&&(e.options.events.unsubscribe(i),i=void 0),i=e.options.events.subscribe({event:"docv2-preview-reload-toolbar"},(function(t){if(e.options.widget.multiFilePreviewComponent&&1==e.options.getSelectedNodes().length&&null!=t.nodeModel){var o=e.options.getSelectedNodes()[0],n=e.options.getDocumentFromNodeModel(o);e.options.getDocumentFromNodeModel(t.nodeModel).id==n.id&&e.options.widget.multiFilePreviewComponent.updateDocument(n,!1)}})),e.options.widget.multiFilePreviewComponent?(e.options.widget.multiFilePreviewComponent.setOptions({platformUrls:e.options.platformUrls,modelEvents:e.options.events,tenant:e.options.platformUrls.platformId,securityContext:e.options.fetchSecurityContext(),hideNextPrev:!0,enableFavoriteToggle:!1,documentManagedByPreview:!0,selectedFileId:s.id}),
//! argumentList.options.widget.multiFilePreviewComponent.updateDocument(e6wDocument, true);
e.options.widget.multiFilePreviewComponent.updateDocument(o,s.id)):(window.previewLoadStart=new Date,e.options.widget.multiFilePreviewComponent=new t({document:o,platformUrls:e.options.platformUrls,modelEvents:e.options.events,tenant:e.options.platformUrls.platformId,securityContext:e.options.fetchSecurityContext(),selectedFileId:s.id,hideNextPrev:!0,enableFavoriteToggle:!1,documentManagedByPreview:!0,uaSource:e.options.getSourceForUsageAnalytics()}),e.options.widget.multiFilePreviewComponent.loaded=function(e){},e.options.widget.multiFilePreviewComponent.elements.container.setStyles({background:"white",width:"100%",height:"100%"}),e.options.widget.multiFilePreviewComponent.close=function(){e.options.widget.multiFilePreviewComponent.destroy(),e.options.widget.multiFilePreviewComponent=void 0},e.options.widget.multiFilePreviewComponent.inject(e.options.widget.body))}))}))},a})),define("DS/DocumentCommands/V2/Actions/Share",["UWA/Core","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o){"use strict";var n=function(e){return{id:"Share",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"forward",fontIconFamily:1},label:o.get("Share"),tooltip:o.get("Share"),position:"far",category:"colllaboration",value:function(t){t.options=e,n.execute(t)},visibleFlag:!1},execute:function(){n.execute({options:e})},updateForSelection:function(o,n){return new t((function(t){o({visibleFlag:e.getSelectedNodes().length>=1}),t(!0)}))}}};return n.execute=function(t){var o=t.options.getSelectedNodes();require(["DS/ENOCollabSharingCmds/BaseModels/ResultElement","DS/SharePopup/SharePopup"],(function(n,i){var a=o.map((function(o){var i=t.options.getDocumentFromNodeModel(o),a=void 0;i&&null==(a=i.title||i.name)&&i.dataelements&&(a=i.dataelements.title||i.dataelements.name);var s=void 0;i.revision?s=i.revision:i.dataelements&&(s=i.dataelements.revision);var l=void 0;i.typeNLS?l=i.typeNLS:i.dataelements&&(l=i.dataelements.typeNLS);var c=void 0;i.collabSpaceTitle?c=i.collabSpaceTitle:i.dataelements&&(c=i.dataelements.collabSpaceTitle);var r=void 0;i.organizationTitle?r=i.organizationTitle:i.dataelements&&(r=i.dataelements.organizationTitle);var d=void 0;return e.is(i.firstname,"string")?d=i.firstname+" "+i.lastname:i.relateddata&&i.relateddata.ownerInfo&&i.relateddata.ownerInfo[0]&&i.relateddata.ownerInfo[0].dataelements&&e.is(i.relateddata.ownerInfo[0].dataelements.firstname,"string")&&(d=i.relateddata.ownerInfo[0].dataelements.firstname+" "+i.relateddata.ownerInfo[0].dataelements.lastname),new n({physicalId:i.id,Revision:s,typeDisplayName:l,name:a,organizationTitle:r,collabSpaceTitle:c,responsibleName:d})}));t.options.sharePanel?(t.options.sharePanel.show(a),t.options.sharePanel.container.centerIt()):(t.options.sharePanel=new i(t.options.widget,t.options.widget.body,{removeAtClose:!0,events:{onClose:function(){t.options.sharePanel=null}}}),t.options.sharePanel.show(a))}))},n})),define("DS/DocumentCommands/V2/Actions/Subscription/MySubscriptions",["i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e){"use strict";var t=function(o){return{id:"MySubscriptions",type:"PushItem",title:e.get("MySubscriptions"),dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"bell",fontIconFamily:1},label:e.get("MySubscriptions"),tooltip:e.get("MySubscriptions"),position:"far",category:"information",value:function(e){e.options=o,t.execute(e)},visibleFlag:!0},execute:function(){t.execute({options:o})},updateForSelection:function(e,t){e({visibleFlag:0==o.getSelectedNodes().length})}}};return t.execute=function(e){require(["DS/ENOSubscriptionMgmt/Commands/MySubscriptions"],(function(t){var o=e.options.getSelectedNodes().map((function(t){var o=e.options.getDocumentFromNodeModel(t);return{physicalid:o.id,type:o.type,getID:function(){return o.id},getType:function(){return o.type}}}));new t({ID:"MySubscriptionsCmdHdr",context:{getSelectedNodes:()=>o},objIDType:"modelID"}).execute(e)}))},t})),define("DS/DocumentCommands/V2/Actions/Relations",["UWA/Promise","UWA/Utils/InterCom","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o){"use strict";var n=function(t){return{id:"Relations",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"object-related",fontIconFamily:1},label:o.get("Relations"),tooltip:o.get("Relations"),position:"far",category:"information",value:function(e){e.options=t,n.execute(e)},visibleFlag:!1},execute:function(){n.execute({options:t})},updateForSelection:function(o,n){return new e((function(e){o({visibleFlag:t.getSelectedNodes().length>0}),e(!0)}))}}};return n.execute=function(e){var o=function(e,t){var o={protocol:"3DXContent",version:"2.0",source:"ENOXATTACHMENTS",widgetId:t.widget.id,data:{items:[]}};return e.forEach((function(e){var n={envId:t.platformUrls.platformId,serviceId:"3DSpace",contextId:t.fetchSecurityContext(),objectId:t.getDocumentFromNodeModel(e).id,objectType:t.getDocumentFromNodeModel(e).type};t&&t.includeObjectTaxonomies&&(n.objectTaxonomies=e.options.taxonomies),o.data.items.push(n)})),o}(e.options.getSelectedNodes(),e.options);o.appId="ENORIPE_AP";var n=new t.Socket("compassPageSocket");n.subscribeServer("com.ds.compass",window.parent),n.dispatchEvent("onSetX3DContent",o,"compassPageSocket"),n.addListener("launchApp",(function(e,t,o){n.unsubscribeServer("com.ds.compass"),n.disconnect()})),n.dispatchEvent("onLaunchApp",o,"compassPageSocket")},n})),define("DS/DocumentCommands/V2/Actions/Download",["UWA/Core","UWA/Element","UWA/Promise","DS/DocumentManagement/DocumentManagement","DS/DocumentCommonInfra/TrackerAPI","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o,n,i,a){"use strict";var s=e.createElement("iframe",{name:"multidocdownloaderFrame",styles:{display:"none"}}),l=e.createElement("form",{method:"POST",enctype:"application/x-www-form-urlencoded",target:"multidocdownloaderFrame",html:[{tag:"input",value:"true",name:"attachment"}],styles:{display:"none"}}),c=function(e){return{id:"Download",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"download",fontIconFamily:1},label:a.get("Download"),tooltip:a.get("Download"),position:"far",category:"information",value:function(t){t.options=e,c.execute(t)},visibleFlag:!1},execute:function(){c.execute({options:e})},updateForSelection:function(t,n){return new o((function(o){var n=!0;e.getOrigin&&"MultiFilePreviewtoolbar"==e.getOrigin().component&&(1==e.previewedDocumentStatusModel.getPreviewedDocumentFiles().length||(n=!1));t({visibleFlag:e.getSelectedNodes().length>0&&n}),o(!0)}))}}};return c.execute=function(t){if(t.options.getSourceForUsageAnalytics=t.options.getSourceForUsageAnalytics||function(e){t.options.uaSource||(t.options.uaSource="unknown");var o=t.options.uaSource;return e&&(o=o+"."+e),t.options.isFromContextMenu?o+=" Contextual Menu":o+=" Tool bar",o},1==t.options.getSelectedNodes().length){var o=new Date,c=t.options.getSelectedNodes()[0],r=t.options.getDocumentFromNodeModel(c),d=[];r.files?d=r.files:r.relateddata&&r.relateddata.files&&(d=r.relateddata.files);var u=void 0;if(r&&null==(u=r.title||r.name)&&r.dataelements&&(u=r.dataelements.title||r.dataelements.name),0==d.length)return void t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("DownloadFailed"),subtitle:"",message:a.get("DocumentHasNoFile",{documents:u}),sticky:!1,allowUnsafeHTML:!1}});var m=void 0;e.is(t.options.getSelectedFile,"function")&&null!=t.options.getSelectedFile()&&(m=t.options.getSelectedFile().id,u=t.options.getSelectedFile().dataelements.title),(h={asZip:!0,autoDownload:!0,additionalURLParams:"useDOCMParamSettings=true"}).tenant=t.options.platformUrls.platformId,h.securityContext=t.options.fetchSecurityContext(),h.tenantUrl=t.options.platformUrls["3DSpace"],h.onComplete=function(n){var s=new Date-o;if(i.sendTrackerPageEvent({category:"docm.command.download",action:"click",label:"Document Download",pd:{docType:r.type,docId:r.id,source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:s,success:1,numberOfDocuments:1}}),u&&""!==u){var l={subtitle:e.String.format(a.DOWNLOAD_FILES_INITIATED,u)};t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:l.title||"",subtitle:l.subtitle||"",message:"",sticky:!1,allowUnsafeHTML:!1}})}else t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:a.Download_Initiated,subtitle:"",message:"",sticky:!1,allowUnsafeHTML:!1}})},h.onFailure=function(e){var n=new Date-o;i.sendTrackerPageEvent({category:"docm.command.download",action:"click",label:"Document Download",pd:{docType:r.type,docId:r.id,source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:n,failure:0,numberOfDocuments:1}}),t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("DownloadFailed"),subtitle:a.get("VerifyCredentials"),message:a.get("NotHaveRequiredAccessRole"),sticky:!1,allowUnsafeHTML:!1}})},t.options.widget&&t.options.widget.MSFDocumentClient&&null===n.MSFDocumentClient?n.MSFDocumentClient=t.options.widget.MSFDocumentClient:t.options.MSFDocumentClient&&null===n.MSFDocumentClient&&(n.MSFDocumentClient=t.options.MSFDocumentClient),n.downloadDocument(r.id,m,!1,h)}else if(t.options.getSelectedNodes().length>1){var p=new Date,f=t.options.getSelectedNodes().map((function(e){return t.options.getDocumentFromNodeModel(e)})),g=f.map((function(e){var t=[];e.files?t=e.files:e.relateddata&&e.relateddata.files&&(t=e.relateddata.files);var o=e.title||e.name;return null==o&&e.dataelements&&(o=e.dataelements.title||e.dataelements.name),{title:o,count:t.length}})),v=[],D=[];for(var y of g)y.count>1&&v.push(y.title),0==y.count&&D.push(y.title);if(D.length>0)return void t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("DownloadFailed"),subtitle:"",message:a.get("DocumentHasNoFile",{documents:D.join(", ")}),sticky:!1,allowUnsafeHTML:!1}});if(v.length>0)t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("DownloadFailed"),subtitle:"",message:a.get("MoreThanOneFileInMultipleDocuments",{documents:v.join(", ")}),sticky:!1,allowUnsafeHTML:!1}});else{var h,S=t.options.getSelectedNodes().map((function(e){return t.options.getDocumentFromNodeModel(e).id}));(h={asZip:!0,autoDownload:!0,additionalURLParams:"useDOCMParamSettings=true"}).tenant=t.options.platformUrls.platformId,h.securityContext=t.options.fetchSecurityContext(),h.tenantUrl=t.options.platformUrls["3DSpace"],h.onComplete=function(o){var n=new Date-p;i.sendTrackerPageEvent({category:"docm.command.mulitpledownload",action:"click",label:"Multiple Document Download",pd:{source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:n,success:1,numOfDocuemnts:S.length,numOfFiles:o[0].fileNames.length}});var c=o;e.is(c,"array")&&c.forEach((function(o){if(o.downloadUrl){var n=new URL(o.downloadUrl),i=(s.isInjected()||s.inject(document.body),l.isInjected()||l.inject(document.body),l.empty(),e.createElement("input",{name:"attachment",value:"true"}).inject(l),l);for(var c of n.searchParams)e.createElement("input",{name:c[0],value:c[1]}).inject(i);n.search="",i.action=n.href,console.log(n),i.submit(),t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:a.get("DownloadHasStarted"),subtitle:"",message:a.get("DownloadHasStarted"),sticky:!1,allowUnsafeHTML:!1}})}else t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("DownloadNotInitiated"),subtitle:"",message:"",sticky:!1,allowUnsafeHTML:!1}})}))},h.onFailure=function(e){var o=new Date-p;i.sendTrackerPageEvent({category:"docm.command.mulitpledownload",action:"click",label:"Multiple Document Download",pd:{source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:o,failure:1,numOfDocuemnts:S.length}}),t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("DownloadFailed"),subtitle:e[0].errorMessage,message:"",sticky:!1,allowUnsafeHTML:!1}})},t.options.widget&&t.options.widget.MSFDocumentClient&&null===n.MSFDocumentClient?n.MSFDocumentClient=t.options.widget.MSFDocumentClient:t.options.MSFDocumentClient&&null===n.MSFDocumentClient&&(n.MSFDocumentClient=t.options.MSFDocumentClient),n.downloadDocuments(S,h)}}},c})),define("DS/DocumentCommands/V2/Actions/Subscription/SubscriptionForOthers",["i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e){"use strict";var t=function(o){return{id:"SubscriptionForOthers",type:"PushItem",title:e.get("SubscriptionForOthers"),dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"subscription-others-add",fontIconFamily:1},label:e.get("SubscriptionForOthers"),tooltip:e.get("SubscriptionForOthers"),position:"far",category:"information",value:function(e){e.options=o,t.execute(e)},visibleFlag:!1},execute:function(){t.execute({options:o})},updateForSelection:function(e,t){e({visibleFlag:o.getSelectedNodes().length>=1})}}};return t.execute=function(e){require(["DS/ENOSubscriptionMgmt/Commands/PushSubscribe"],(function(t){var o=e.options.getSelectedNodes().map((function(t){var o=e.options.getDocumentFromNodeModel(t);return{physicalid:o.id,type:o.type,getID:function(){return o.id},getType:function(){return o.type}}}));new t({ID:"PushSubscribeHdr",context:{getSelectedNodes:()=>o},objIDType:"modelID"}).execute(e)}))},t})),define("DS/DocumentCommands/V2/Actions/ChangeOwner",["UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t){"use strict";var o=function(n){return{id:"ChangeOwner",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"user-change",fontIconFamily:1},label:t.get("ChangeOwner"),tooltip:t.get("ChangeOwner"),position:"far",category:"colllaboration",value:function(e){e.options=n,o.execute(e)},visibleFlag:!1},execute:function(){o.execute({options:n})},updateForSelection:function(t,o){return new e((function(e){t({visibleFlag:n.getSelectedNodes().length>=1}),e(!0)}))}}};return o.execute=function(e){require(["DS/ENOCollabSharingCmds/commands/TransferOwnershipCmd/ActionBar_TransferOwnershipCmd"],(function(t){var o=e.options.getSelectedNodes().map((function(e){var t=e;return t.options.physicalid&&0!=t.options.physicalid.length||(t.options.physicalid=t.options.data.id),t.getID||(t.getID=function(){return t.options.physicalid}),t}));(t=new t({ID:"transferOwnership_cmd_id",context:{getSelectedNodes:()=>o,securitycontext:e.options.fetchSecurityContext(),getSecurityContext:function(){return{SecurityContext:this.securitycontext}}}})).begin()}))},o})),define("DS/DocumentCommands/Jobs",["UWA/Core"],(function(e){"use strict";return function(e){var t={name:"doco-jobs",MAX_PARALLEL_JOBS:1,jobs:[],states:{WAIT:1,PROCESSING:2,FINISHED:3},init:function(e){this.app=e},latestJobId:0,process:function(){var e=this.jobs.filter((function(e){return e.processing==t.states.PROCESSING}));if(e.length<this.MAX_PARALLEL_JOBS)for(var o=this.MAX_PARALLEL_JOBS-e.length,n=this.jobs.filter((function(e){return e.processing==t.states.WAIT})),i=0;i<n.length&&i<o;i++){var a=n[i];a.processing=t.states.PROCESSING,a.process()}},addJob:function(e){e.id=this.latestJobId++,e.processing=t.states.WAIT,e.ui&&(this.app.progressPane.addProgress(e),e.update=function(t){e.progress.update(e.title,.99*t.loaded,t.total)}),this.jobs.push(e),this.process()},finishJob:function(e,o){e.processing=t.states.FINISHED;var n=this.jobs.indexOf(e);-1!=n?this.jobs.splice(n,1):console.error("This wasn't supposed to happen, Unable to splice Q"),this.process(),e.ui&&(e.progress.update(e.title,100,100,o),setTimeout((function(){e.progress.destroy(),0==t.jobs.length&&t.app.progressPane.hide()}),2e3))},cancelAll:function(){for(var e=this.jobs.length-1;e>=0;e--)this.jobs[e].cancel&&this.jobs[e].cancel()}};return t.init(e),t}})),define("DS/DocumentCommands/Resources",[],(function(){"use strict";return{REPLACE_BY_REVISION:"/resources/v1/modeler/commondocuments/documentaction/replacebyrevision",LATEST_REVISION:"/resources/v1/dslc/getlastversions",NEW_REVISION:"/resources/lifecycle/revise/major"}})),define("DS/DocumentCommands/V2/Actions/Maturity",["UWA/Core","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o){"use strict";var n=function(e){return{id:"Maturity",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"collaborative-lifecycle-management",fontIconFamily:1},tooltip:o.get("Maturity"),label:o.get("Maturity"),position:"far",category:"lifecycle",value:function(t){t.options=e,n.execute(t)},visibleFlag:!1},execute:function(t){n.execute({options:e},t)},updateForSelection:function(o,n){return new t((function(t){o({visibleFlag:e.getSelectedNodes().length>0}),t(!0)}))}}};return n.execute=function(t,o){o=o||t.options.getSelectedNodes();var n={securitycontext:t.options.fetchSecurityContext(),context:{securitycontext:t.options.fetchSecurityContext(),getSecurityContext:function(){return{SecurityContext:this.securitycontext}},getUUID:function(){return t.options.getOrigin?JSON.stringify(e.extend(t.options.getOrigin(),{action:"maturity"})):"docv2.maturity."+Date.now()}}};require(["DS/LifecycleCmd/MaturityCmd"],(function(e){new e(n).executeAsync(o.map((function(e){var o=t.options.getDocumentFromNodeModel(e),n=void 0;o.collabSpaceTitle?n=o.collabSpaceTitle:o.dataelements&&(n=o.dataelements.collabSpaceTitle);var i=void 0;return o.organizationTitle?i=o.organizationTitle:o.dataelements&&(i=o.dataelements.organizationTitle),{physicalid:o.id,organizationTitle:i,collabSpaceTitle:n,serviceurl:t.options.platformUrls["3DSpace"]+"/resources/lifecycle/maturity/"}}))).then((function(e,n,i){o.forEach((function(e){t.options.events.publish({event:"docv2-maturity-complete",data:{nodeModel:e}})}))}))}))},n})),define("DS/DocumentCommands/V2/Actions/Revisions",["UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t){"use strict";var o=function(n){return{id:"Revisions",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"flow-branch-list",fontIconFamily:1},label:t.get("Revisions"),tooltip:t.get("Revisions"),position:"far",category:"lifecycle",value:function(e){e.options=n,o.execute(e)},visibleFlag:!1},execute:function(){o.execute({options:n})},updateForSelection:function(t,o){return new e((function(e){t({visibleFlag:1==n.getSelectedNodes().length}),e(!0)}))}}};return o.execute=function(e){require(["DS/LifecycleCmd/HistoryCmd"],(function(t){var o=e.options.getSelectedNodes().map((function(e){var t=e;return t.options.physicalid&&0!=t.options.physicalid.length||(t.options.physicalid=t.options.data.id),t.getID||(t.getID=function(){return t.options.physicalid}),t}));(t=new t({ID:"revisions_cmd_ID",context:{getSelectedNodes:()=>o}})).begin()}))},o})),define("DS/DocumentCommands/TypeDerivativesCache",["UWA/Core","UWA/Promise","DS/WAFData/WAFData"],(function(e,t,o){"use strict";return{csrfs:{},ready:{},types:{},platformUrls:void 0,setup:function(t){this.ready[t]=e.Promise.deferred(),this.ready[t].resolve(!0)},getTypeDerivatives:function(e,t,o){var n=this,i={};e.every((e=>null!=n.types[e]))?(e.forEach((e=>{i[e]=n.types[e]})),t&&t(i)):n.fetchTypeDerivatives(e,t,o)},fetchTypeDerivatives:function(e,t,n){var i=this,a=n+"/resources/v1/modeler/documents/typeDerivatives";o.authenticatedRequest(a,{method:"post",type:"json",onComplete:function(e){if(e.success){var o={};e.data.forEach((e=>{i.types[e.type]=e.children.map((e=>e.type)),i.types[e.type]=i.types[e.type].filter((function(e){return e})),0==i.types[e.type].length&&i.types[e.type].push(e.type),o[e.type]=i.types[e.type]})),t&&t(o)}},data:JSON.stringify({data:e.map((function(e){return{type:e}}))}),headers:{"content-type":"application/json"}})}}})),define("DS/DocumentCommands/V2/Actions/Subscription/EditSubscriptionForOthers",["i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e){"use strict";var t=function(o){return{id:"EditSubscriptionForOthers",type:"PushItem",title:e.get("EditSubscriptionForOthers"),dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"subscription-others-pencil",fontIconFamily:1},label:e.get("EditSubscriptionForOthers"),tooltip:e.get("EditSubscriptionForOthers"),position:"far",category:"information",value:function(e){e.options=o,t.execute(e)},visibleFlag:!1},execute:function(){t.execute({options:o})},updateForSelection:function(e,t){e({visibleFlag:o.getSelectedNodes().length>=1})}}};return t.execute=function(e){require(["DS/ENOSubscriptionMgmt/Commands/ViewSubscriptions"],(function(t){var o=e.options.getSelectedNodes().map((function(t){var o=e.options.getDocumentFromNodeModel(t);return{physicalid:o.id,type:o.type,getID:function(){return o.id},getType:function(){return o.type}}}));new t({ID:"ViewSubscriptionsCmdHdr",context:{getSelectedNodes:()=>o},objIDType:"modelID"}).execute(e)}))},t})),define("DS/DocumentCommands/V2/Actions/Subscription/EditSubscriptions",["i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e){"use strict";var t=function(o){return{id:"EditSubscriptions",type:"PushItem",title:e.get("EditSubscriptions"),dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"bell-pencil",fontIconFamily:1},label:e.get("EditSubscriptions"),tooltip:e.get("EditSubscriptions"),position:"far",category:"information",value:function(e){e.options=o,t.execute(e)},visibleFlag:!1},execute:function(){t.execute({options:o})},updateForSelection:function(e,t){e({visibleFlag:o.getSelectedNodes().length>=1})}}};return t.execute=function(e){require(["DS/ENOSubscriptionMgmt/Commands/EditSubscribe"],(function(t){var o=e.options.getSelectedNodes().map((function(t){var o=e.options.getDocumentFromNodeModel(t);return{physicalid:o.id,type:o.type,getID:function(){return o.id},getType:function(){return o.type}}}));new t({ID:"EditSubscriptionCmdHdr",context:{getSelectedNodes:()=>o},objIDType:"modelID"}).execute(e)}))},t})),define("DS/DocumentCommands/V2/Actions/Subscription/Subscribe",["i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e){"use strict";var t=function(o){return{id:"Subscribe",type:"PushItem",title:e.get("Subscribe"),dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"bell-add",fontIconFamily:1},label:e.get("Subscribe"),tooltip:e.get("Subscribe"),position:"far",category:"information",value:function(e){e.options=o,t.execute(e)},visibleFlag:!1},execute:function(){t.execute({options:o})},updateForSelection:function(e,t){e({visibleFlag:o.getSelectedNodes().length>=1})}}};return t.execute=function(e){require(["DS/ENOSubscriptionMgmt/Commands/Subscribe"],(function(t){var o=e.options.getSelectedNodes().map((function(t){var o=e.options.getDocumentFromNodeModel(t);return{physicalid:o.id,type:o.type,getID:function(){return o.id},getType:function(){return o.type}}}));new t({ID:"SubscribeCmdHdr",context:{getSelectedNodes:()=>o},objIDType:"modelID"}).execute(e)}))},t})),define("DS/DocumentCommands/V2/Actions/Preview",["UWA/Core","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o){"use strict";var n=void 0,i=void 0,a=function(e){return{id:"Preview",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"eye",fontIconFamily:1},label:o.get("Preview"),tooltip:o.get("Preview"),position:"far",category:"view",value:function(t){t.options=e,a.execute(t)},visibleFlag:!1},execute:function(){a.execute({options:e})},updateForSelection:function(o,n){return new t((function(t){o({visibleFlag:1==e.getSelectedNodes().length}),t(!0)}))}}};return a.execute=function(e){var t=e.options.getSelectedNodes()[0];if(!e.options.getDocumentFromNodeModel(t))throw"e6wDocument cannot be loaded from nodeModel";!function(t){require(["DS/DocumentMultiFilePreview/MultiFilePreviewComponent"],(function(o){n&&(e.options.events.unsubscribe(n),n=void 0),n=e.options.events.subscribe({event:"docv2-preview-reload-viewer"},(function(t){if(e.options.widget.multiFilePreviewComponent&&1==e.options.getSelectedNodes().length&&null!=t.nodeModel){var o=e.options.getSelectedNodes()[0],n=e.options.getDocumentFromNodeModel(o);e.options.getDocumentFromNodeModel(t.nodeModel).id==n.id&&
//! argumentList.options.widget.multiFilePreviewComponent.updateDocument(latestDocument, true);
e.options.widget.multiFilePreviewComponent.updateDocument(n,void 0)}})),i&&(e.options.events.unsubscribe(i),i=void 0),i=e.options.events.subscribe({event:"docv2-preview-reload-toolbar"},(function(t){if(e.options.widget.multiFilePreviewComponent&&1==e.options.getSelectedNodes().length&&null!=t.nodeModel){var o=e.options.getSelectedNodes()[0],n=e.options.getDocumentFromNodeModel(o);e.options.getDocumentFromNodeModel(t.nodeModel).id==n.id&&e.options.widget.multiFilePreviewComponent.updateDocument(n,void 0)}})),e.options.widget.multiFilePreviewComponent?(e.options.widget.multiFilePreviewComponent.setOptions({platformUrls:e.options.platformUrls,modelEvents:e.options.events,tenant:e.options.platformUrls.platformId,securityContext:e.options.fetchSecurityContext(),documentManagedByPreview:!0,nodeModel:t,hideNextPrev:!0,enableFavoriteToggle:!1}),
//! argumentList.options.widget.multiFilePreviewComponent.updateDocument(argumentList.options.getDocumentFromNodeModel(nodeModel), true);
e.options.widget.multiFilePreviewComponent.updateDocument(e.options.getDocumentFromNodeModel(t),void 0)):(window.previewLoadStart=new Date,e.options.widget.multiFilePreviewComponent=new o({document:e.options.getDocumentFromNodeModel(t),platformUrls:e.options.platformUrls,modelEvents:e.options.events,tenant:e.options.platformUrls.platformId,securityContext:e.options.fetchSecurityContext(),nodeModel:t,documentManagedByPreview:!0,hideNextPrev:!0,enableFavoriteToggle:!1,uaSource:e.options.getSourceForUsageAnalytics()}),e.options.widget.multiFilePreviewComponent.loaded=function(e){},e.options.widget.multiFilePreviewComponent.elements.container.setStyles({background:"white",width:"100%",height:"100%"}),e.options.widget.multiFilePreviewComponent.close=function(){e.options.widget.multiFilePreviewComponent.destroy(),e.options.widget.multiFilePreviewComponent=void 0},e.options.widget.multiFilePreviewComponent.inject(e.options.widget.body))}))}(t)},a})),define("DS/DocumentCommands/V2/ConvertCmdToWebUX",[],(function(){"use strict";return function(e){return e.map((e=>{var t=void 0;UWA.is(e.dataElements.value,"function")&&(t={callback:e.dataElements.value||function(e,t,o){console.error("This command doesnt have value")}});var o=void 0;UWA.is(e.dataElements.value.menu,"array")&&(o=e.dataElements.value.menu);var n={rawItem:e,type:"PushItem",title:e.dataElements.label,fonticon:{content:"wux-ui-3ds wux-ui-3ds-"+e.dataElements.icon.iconName},action:t,submenu:o,recId:e.id,category:e.dataElements.category};return"FileIterations"==e.id&&(delete n.fonticon,n.icon=e.dataElements.icon),n}))}})),define("DS/DocumentCommands/V2/Actions/Compare",["UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t){"use strict";var o=function(n){return{id:"Compare",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"part-compare",fontIconFamily:1},label:t.get("Compare"),tooltip:t.get("Compare"),position:"far",category:"lifecycle",value:function(e){e.options=n,o.execute(e)},visibleFlag:!1},execute:function(){o.execute({options:n})},updateForSelection:function(t,o){return new e((function(e){t({visibleFlag:n.getSelectedNodes().length>=1}),e(!0)}))}}};return o.execute=function(e){require(["DS/CompareCmd/CompareCmd"],(function(t){var o=e.options.platformUrls.platformId,n=e.options.getSelectedNodes().map((function(t){return{contextId:e.options.fetchSecurityContext(),id:t.options.data.id,objIDType:"modelID",objTenant:o}}));(t=new t({ID:"CompareHdr"})).launchCompare(o,n,void 0,void 0)}))},o})),define("DS/DocumentCommands/V2/Actions/CopyLink",["UWA/Core","UWA/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Dropdown","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o,n,i,a,s){"use strict";var l=function(e){return{id:"CopyLink",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"link",fontIconFamily:1},tooltip:s.get("CopyLink"),label:s.get("CopyLink"),position:"far",category:"colllaboration",value:function(t){t.options=e,l.execute(t)},visibleFlag:!1},execute:function(){l.execute({options:e})},updateForSelection:function(o,n){return new t((function(t){o({visibleFlag:1==e.getSelectedNodes().length}),t(!0)}))}}};return l.execute=function(t){var a=t.options.getSelectedNodes()[0],l=t.options.getDocumentFromNodeModel(a),c=t.options.container,r=void 0;l&&null==(r=l.title||l.name)&&l.dataelements&&(r=l.dataelements.title||l.dataelements.name);var d={objectId:l.id,envId:t.options.platformUrls.platformId};e.is(t.options.getSelectedFile,"function")&&null!=t.options.getSelectedFile()&&(d.fileid=t.options.getSelectedFile().id,r=t.options.getSelectedFile().dataelements.title);var u=function(e){var t={protocol:"3DXContent",data:{items:[]}};t.data.items.push({envId:e.envId,objectId:e.objectId,openLink:!0,objectType:"Document"}),e.fileid&&(t.data.items[0].fileid=e.fileid,t.data.items[0].openFile=!0);return t}(d),m=e.createElement("div",{styles:{display:"flex"}}),p=new n("input",{attributes:{readonly:"readonly"}});p.getContent().setStyles({display:"inline-block","border-top-right-radius":0,"border-bottom-right-radius":0}),p.inject(m);var f=new o({value:s.get("CopyLink"),className:"block",events:{onClick:function(o){p.setFocus(),p.elements.input.select(),p.elements.input.setSelectionRange(0,99999),document.execCommand("cut"),v.hide(),r&&""!==r?t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:s.get("LinkCopiedTitle"),subtitle:e.String.format(s.get("LinkCopiedMsg"),r),message:"",sticky:!1,allowUnsafeHTML:!1}}):t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:s.get("LinkCopiedTitle"),subtitle:s.get("LinkCopied"),message:"",sticky:!1,allowUnsafeHTML:!1}})}}});f.getContent().setStyles({display:"inline-block","border-top-left-radius":0,"border-bottom-left-radius":0,padding:"0 10px"}),f.inject(m);var g,v=new i({body:m,closeOnClick:!1,events:{onClickOutside:function(e){console.log("DDClickOutside")}}});if(v.options.target=c,t.options&&t.options.platformUrls&&t.options.platformUrls["3DDashboard"]&&(g=t.options.platformUrls["3DDashboard"]),null==g&&(g=t.options.widget.widgetDomain),console.log(g),null==g)throw"url is undefined.";v.hide(),v.show(),p.setFocus(),p.setValue(g+"#app:ENXWDOC_AP/content:X3DContentId="+encodeURIComponent(JSON.stringify(u))),p.elements.input.select(),p.elements.input.setSelectionRange(0,99999,"backward"),f.getContent().click()},l})),define("DS/DocumentCommands/V2/FileActions/Download",["UWA/Core","UWA/Element","UWA/Promise","DS/DocumentManagement/DocumentManagement","DS/DocumentCommonInfra/TrackerAPI","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o,n,i,a){"use strict";var s=e.createElement("iframe",{name:"multidocdownloaderFrame",styles:{display:"none"}}),l=e.createElement("form",{method:"POST",enctype:"application/x-www-form-urlencoded",target:"multidocdownloaderFrame",html:[{tag:"input",value:"true",name:"attachment"}],styles:{display:"none"}}),c=function(e){return{id:"Download",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"download",fontIconFamily:1},label:a.get("Download"),tooltip:a.get("Download"),position:"far",category:"information",value:function(t){t.options=e,c.execute(t)},visibleFlag:!1},execute:function(){c.execute({options:e})},updateForSelection:function(t,n){return new o((function(o){t({visibleFlag:e.getSelectedNodes().length>0}),o(!0)}))}}};return c.execute=function(t){var o=t.options.getParentDocument();if(1==t.options.getSelectedNodes().length){var c=new Date,r=t.options.getSelectedNodes()[0],d=t.options.getDocumentFromNodeModel(r),u=void 0;d&&null==(u=d.title||d.name)&&d.dataelements&&(u=d.dataelements.title||d.dataelements.name);e.is(t.options.getSelectedFile,"function")&&null!=t.options.getSelectedFile()&&(t.options.getSelectedFile().id,u=t.options.getSelectedFile().dataelements.title),(m={asZip:!0,autoDownload:!0}).tenant=t.options.platformUrls.platformId,m.securityContext=t.options.fetchSecurityContext(),m.tenantUrl=t.options.platformUrls["3DSpace"],m.onComplete=function(n){var s=new Date-c;if(i.sendTrackerPageEvent({category:"docm.command.file.download",action:"click",label:"File Download",pd:{docId:o,source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:s,success:1,numberOfFiles:1,fileid:d.id}}),u&&""!==u){var l={subtitle:e.String.format(a.DOWNLOAD_FILES_INITIATED,u)};t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:l.title||"",subtitle:l.subtitle||"",message:"",sticky:!1,allowUnsafeHTML:!1}})}else t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:a.Download_Initiated,subtitle:"",message:"",sticky:!1,allowUnsafeHTML:!1}})},m.onFailure=function(e){var n=new Date-c;i.sendTrackerPageEvent({category:"docm.command.file.download",action:"click",label:"File Download",pd:{docId:o,source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:n,failure:0,numberOfFiles:1,fileId:d.id}}),t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:e.data[0].updateMessage,subtitle:"",message:"",sticky:!1,allowUnsafeHTML:!1}})},t.options.widget&&t.options.widget.MSFDocumentClient&&null===n.MSFDocumentClient?n.MSFDocumentClient=t.options.widget.MSFDocumentClient:t.options.MSFDocumentClient&&null===n.MSFDocumentClient&&(n.MSFDocumentClient=t.options.MSFDocumentClient),n.downloadDocument(o,d.id,!1,m)}else if(t.options.getSelectedNodes().length>1){var m,p=new Date,f=(t.options.getSelectedNodes().map((function(e){return t.options.getDocumentFromNodeModel(e)})),t.options.getSelectedNodes().map((function(e){return t.options.getDocumentFromNodeModel(e).id})));(m={asZip:!0,autoDownload:!0}).tenant=t.options.platformUrls.platformId,m.securityContext=t.options.fetchSecurityContext(),m.additionalURLParams="isFilesFacet=true",m.tenantUrl=t.options.platformUrls["3DSpace"],m.onComplete=function(n){var c=new Date-p;i.sendTrackerPageEvent({category:"docm.command.mulitpleFile.download",action:"click",label:"Multiple File Download",pd:{docId:o,source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:c,success:1,fileIds:f,numOfFiles:n[0].fileNames.length}});var r=n;e.is(r,"array")&&r.forEach((function(o){if(o.downloadUrl){var n=new URL(o.downloadUrl),i=(s.isInjected()||s.inject(document.body),l.isInjected()||l.inject(document.body),l.empty(),e.createElement("input",{name:"attachment",value:"true"}).inject(l),l);for(var c of n.searchParams)e.createElement("input",{name:c[0],value:c[1]}).inject(i);n.search="",i.action=n.href,console.log(n),i.submit(),t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:a.get("DownloadHasStarted"),subtitle:"",message:a.get("DownloadHasStarted"),sticky:!1,allowUnsafeHTML:!1}})}else t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("DownloadNotInitiated"),subtitle:"",message:"",sticky:!1,allowUnsafeHTML:!1}})}))},m.onFailure=function(e){var n=new Date-p;i.sendTrackerPageEvent({category:"docm.command.mulitpleFile.download",action:"click",label:"Multiple File Download",pd:{docId:o,source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:n,failure:0}}),t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("DownloadFailed"),subtitle:e[0].errorMessage,message:"",sticky:!1,allowUnsafeHTML:!1}})},t.options.widget&&t.options.widget.MSFDocumentClient&&null===n.MSFDocumentClient?n.MSFDocumentClient=t.options.widget.MSFDocumentClient:t.options.MSFDocumentClient&&null===n.MSFDocumentClient&&(n.MSFDocumentClient=t.options.MSFDocumentClient),m.documentIdForMSF=o,n.downloadDocuments(f,m)}},c})),define("DS/DocumentCommands/Constants",[],(function(){"use strict";return{PREVIEW:"Preview",PREVIEW2:"Preview2",REPLACE_BY_REVISION:"ReplaceBy",DOWNLOAD:"Download",NEW_REVISION:"NEW REVISION",DELETE:"Delete",COPY_LINK:"CopyLink",RELATION:"Relation",REMOVE:"Remove",MATURITY:"Maturity",UPDATE:"Update",UPLOAD_FILE:"UploadFile",UPDATE_AND_UNLOCK:"UpdateAndUnlock",UNLOCK:"Unlock",LOCK:"Lock",LOCK_AND_DOWNLOAD:"LockAndDownload",EDIT:"Edit",UNDO_EDIT:"UndoEdit",COPY:"Copy",PASTE:"Paste",SHARE:"Share",PROPERTIES:"Properties",OFFICE_WEB_EDITION:"OfficeWebEdition"}})),define("DS/DocumentCommands/V2/Actions/Duplicate",["UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t){"use strict";var o=function(n){return{id:"Duplicate",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"duplicate",fontIconFamily:1},label:t.get("Duplicate"),tooltip:t.get("Duplicate"),position:"far",category:"lifecycle",value:function(e){e.options=n,o.execute(e)},visibleFlag:!1},execute:function(){o.execute({options:n})},updateForSelection:function(t,o){return new e((function(e){t({visibleFlag:n.getSelectedNodes().length>=1}),e(!0)}))}}};return o.execute=function(e){require(["DS/LifecycleCmd/DuplicateCmd"],(function(t){var o=e.options.getSelectedNodes().map((function(t){var o=e.options.getDocumentFromNodeModel(t),n=void 0;o&&null==(n=o.title||o.name)&&o.dataelements&&(n=o.dataelements.title||o.dataelements.name);var i=void 0;return o.revision?i=o.revision:o.dataelements&&(i=o.dataelements.revision),{physicalid:o.id,displayName:n,revision:i,icon:o.dataelements.indexedTypeicon||o.dataelements.typeicon,type:o.type,typeDisplayName:o.dataelements.typeNLS,current:o.dataelements.state,currentDisplayName:o.dataelements.stateNLS,getID:function(){return o.id},getLabel:function(){return n},getType:function(){return o.type},getAttribute:function(e){return e.contains("revision")?i:e.contains("type")?o.type:e.contains("status")?o.dataelements.stateNLS:void 0}}}));(t=new t({ID:"duplicate_cmd_id",context:{getSelectedNodes:()=>o,securitycontext:e.options.fetchSecurityContext(),getSecurityContext:function(){return{SecurityContext:this.securitycontext}},getUUID:function(){return e.options.getOrigin?JSON.stringify(UWA.extend(e.options.getOrigin(),{action:"duplicate"})):"docv2.duplicate."+Date.now()}}})).begin()}))},o})),define("DS/DocumentCommands/V2/Actions/AddTo/Libraries",["i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e){"use strict";var t=function(o){return{id:"Libraries",type:"PushItem",title:e.get("Libraries"),dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"library-add",fontIconFamily:1},label:e.get("Libraries"),tooltip:e.get("Libraries"),position:"far",category:"edit",value:function(e){e.options=o,t.execute(e)},visibleFlag:!1},execute:function(){t.execute({options:o})},updateForSelection:function(e,t){e({visibleFlag:o.getSelectedNodes().length>=1})}}};return t.execute=function(e){require(["DS/LibraryActive/commands/ActionBar_MultipleClassificationCmd"],(function(t){var o=e.options.getSelectedNodes().map((function(t){return e.options.getDocumentFromNodeModel(t).id}));(new t).execute({id:"Classfy_cmd_id",securityContext:e.options.fetchSecurityContext(),tenantId:e.options.platformUrls.platformId,objects:o},{launchMode:"Classify",selectionMode:"DefaultSingle",ComponentTitle:"Libraries",OKButtonLabel:"Add"})}))},t})),define("DS/DocumentCommands/V2/Actions/Delete",["UWA/Core","UWA/Promise","DS/UIKIT/Modal","DS/DocumentManagement/DocumentManagement","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o,n,i){"use strict";var a=function(e){return{id:"Delete",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"trash",fontIconFamily:1},label:i.get("Delete"),tooltip:i.get("Delete"),position:"far",category:"destructive",value:function(t){t.options=e,a.execute(t)},visibleFlag:!1},execute:function(){a.execute({options:e})},updateForSelection:function(o,n){return new t((function(t){o({visibleFlag:e.getSelectedNodes().length>0}),t(!0)}))}}};return a.execute=function(t){if(t.options.getSelectedNodes().length>0){var o=t.options.getSelectedNodes();require(["DS/LifecycleCmd/DeleteCmd"],(function(n){new n({securitycontext:t.options.fetchSecurityContext(),context:{securitycontext:t.options.fetchSecurityContext(),getSecurityContext:function(){return{SecurityContext:this.securitycontext}},displayNotification:function(n){if("primary"==n.eventID)if(1==o.length){var a=t.options.getSelectedNodes()[0],s=t.options.getDocumentFromNodeModel(a),l=void 0;s&&null==(l=s.title||s.name)&&s.dataelements&&(l=s.dataelements.title||s.dataelements.name),t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:i.get("DeletionSuccessful"),subtitle:e.String.format(i.get("DeletionSuccessfulMsg"),l),message:"",sticky:!1,allowUnsafeHTML:!1}})}else o.length>1&&(n&&"string"==e.typeOf(n.msg)&&n.msg.includes("No objects have been deleted. All the selected objects have been excluded from the command.")?t.options.events.publish({event:"docv2-show-notification",data:{level:"info",message:n.msg,sticky:!1,allowUnsafeHTML:!1}}):t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:i.get("DeletionSuccessful"),subtitle:i.get("MultipleDeletionSuccessfulMsg",{count:o.length}),message:"",sticky:!1,allowUnsafeHTML:!1}}))},getUUID:function(){return t.options.getOrigin?JSON.stringify(e.extend(t.options.getOrigin(),{action:"delete"})):"docv2.delete."+Date.now()}}}).execute(o.map((function(e){var o=t.options.getDocumentFromNodeModel(e),n=void 0;o&&null==(n=o.title||o.name)&&o.dataelements&&(n=o.dataelements.title||o.dataelements.name);var i=void 0;return o.revision?i=o.revision:o.dataelements&&(i=o.dataelements.revision),{physicalid:o.id,displayName:n,revision:i,icon:o.dataelements.indexedTypeicon||o.dataelements.typeicon,type:o.type,typeDisplayName:o.dataelements.typeNLS,current:o.dataelements.state,currentDisplayName:o.dataelements.stateNLS}})))}))}},a})),define("DS/DocumentCommands/ENOXDocumentCommands",["UWA/Core","UWA/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Modal","DS/UIKIT/Form","DS/UIKIT/Input/File","UWA/Utils/InterCom","DS/CoreEvents/ModelEvents","DS/UIKIT/DropdownMenu","DS/UIKIT/Dropdown","DS/WAFData/WAFData","DS/LifecycleCmd/MaturityCmd","DS/ENOXVersionExplorerController/VersionExplorerController","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerViews/VersionExplorerModal","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/DocumentManagement/DocumentManagement","DS/DocumentCommands/Resources","DS/DocumentCommands/Constants","DS/DocumentCommands/TypeDerivativesCache","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/DocumentCommands/DOCMClipboard","DS/Controls/Loader","DS/Controls/ModalContainer","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o,n,i,a,s,l,c,r,d,u,m,p,f,g,v,D,y,h,S,b,C,w,F,I,U,E){"use strict";var x={},A={},P=function(e){this._name="ENOXDocCommands",A=e||window.widget};function k(){var t=this.that,o=this;this._myVersionExplorer.unsubscribeAll();var n=this._myVersionExplorer.getSelectedNodes().shift(),i=n.getAttribute("id");if(i===o.oldDocumentId){console.log("selected revison and current revison is same.");var a={result:{message:E.SameRevision},action:"ReplacebyRevision",targetDocumentId:i};t.options.onComplete(a)}else if(""!==i&&null!=i){null==o.relName&&(o.relName="Reference Document");var s={onComplete:function(e){(e=e||{}).message=E.ReplacedRevision+" "+n.options.data.revision;var o={result:e,action:"ReplacebyRevision",targetDocumentId:i};t.options.onComplete(o)},onFailure:function(e,t){T("error",E.get("YouCannotReplaceX"),E.get("VerifyCredentials"),E.get("NotHaveRequiredAccessRole"));
//!showNotification("error", '', errorJson.error, '', false);
}};u.authenticatedRequest(o.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",e.extend({},{method:"GET",url_temp:o.platformUrls["3DSpace"],onComplete:function(n){s.onComplete,s.onFailure;var a=o.platformUrls["3DSpace"]+"/resources/v1/modeler/documents/?parentRelName="+o.relName+"&parentDirection="+o.parentDirection+"&tenant="+o.platformUrls.platformId;s.type="json",s.url=encodeURI(a);var l=JSON.parse(n).csrf;s.data=JSON.stringify({csrf:l,data:[{id:o.oldDocumentId,updateAction:"NONE",relateddata:{parents:[{id:o.parentId,updateAction:"DELETE"}]}},{id:i,updateAction:"NONE",relateddata:{parents:[{id:o.parentId,updateAction:"CREATE"}]}}]}),s.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:encodeURIComponent(o.securityContext)},s.method="PUT",s.SecurityContext=o.securityContext,s.headers=e.merge(s.headers,e.is(t.options.getWorkUnderHeaders,"function")?t.options.getWorkUnderHeaders():{}),u.authenticatedRequest(s.url,s)}}))}}function N(){this._myVersionExplorer.unsubscribeAll()}function T(e,t,o,n,i,a,s){var l={level:e,title:t,subtitle:o,message:n,sticky:i,allowUnsafeHTML:s||!1};window.notifs||(window.notifs=D,y.setNotificationManager(window.notifs)),a?y.inject(a):y.elements.container.isInjected()||y.inject(),window.notifs.addNotif(l)}function M(t){var o={protocol:"3DXContent",version:"2.0",source:e.is(A.data.appId)?A.data.appId:A.environment.data._data._x_appId,widgetId:A.id,data:{items:[]}};return o.data.items.push({envId:t.document.envId,serviceId:t.document.serviceId||"3DSpace",contextId:t.document.contextId,objectId:t.document.id}),o}function L(a,s,c){var r=a.options.document.index||1,D={};D.index=r;var y={title:E.get("Preview"),name:"Preview",text:E.get("Preview"),fonticon:"eye",handler:function(){var e=M(a.options);require(["DS/ENOFloatingPanel/ENOFloatingPanel","DS/DocumentPreview/PreviewComponent"],(function(t,o){var n=new o({x3dcontent:e,options:a.options});n.loaded=function(e){},n.elements.container.setStyles({background:"white",width:"100%",height:"100%"}),n.close=function(){i.destroy()};var i=new t({header:n.topBar.container,body:n.elements.container,overlay:!0,closable:!1,resizable:!0,animate:!0,visible:!0,limitParent:!0,autocenter:!0});i.inject(A.body),n.topBar.container.getParent().setStyle("padding","5px"),n.elements.container.getParent().setStyle("padding","5px"),i._maximize()}))}},C={title:E.get("Preview"),name:"Preview2",text:E.get("Preview"),fonticon:"eye",handler:function(){function o(e,t){require(["DS/DocumentMultiFilePreview/MultiFilePreviewComponent"],(function(o){A.multiFilePreviewComponent?(A.multiFilePreviewComponent.setOptions({platformUrls:s,modelEvents:x.modelEvents,tenant:a.options.document.envId,securityContext:a.options.document.contextId,nodeModel:void 0,hideNextPrev:!0,enableFavoriteToggle:!1,documentManagedByPreview:t}),A.multiFilePreviewComponent.updateDocument(e,void 0)):(A.multiFilePreviewComponent=new o({document:e,platformUrls:s,modelEvents:x.modelEvents,tenant:a.options.document.envId,securityContext:a.options.document.contextId,nodeModel:void 0,hideNextPrev:!0,enableFavoriteToggle:!1,documentManagedByPreview:t}),A.multiFilePreviewComponent.loaded=function(e){},A.multiFilePreviewComponent.elements.container.setStyles({background:"white",width:"100%",height:"100%"}),A.multiFilePreviewComponent.close=function(){A.multiFilePreviewComponent.destroy(),A.multiFilePreviewComponent=void 0},A.multiFilePreviewComponent.inject(A.body))}))}if(a.options.document.data)o(a.options.document.data,!1);else{var n=new I({text:E.get("LOADINGPREVIEW"),showButtonFlag:!0});n.canceller=t.deferred(),n.elements.stopButton.addEventListener("buttonclick",(function(e){n.canceller.reject("usercancelled")})),U.createModal(A.body,n.elements.container),n.on(E.get("LOADINGPREVIEW"));var i=new e.Promise((function(e,t){h.getDocuments([a.options.document.id],{tenant:a.options.document.envId,securityContext:a.options.document.contextId,tenantUrl:a.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedTypeicon",onComplete:function(o){o.success&&Array.isArray(o.data)?e(o.data[0]):t({error:"BAD_RESPONSE"})},onFailure:function(e){t({error:"GETDOCUMENT_FAILED",reason:e})}})})),l=n.canceller.promise;e.Promise.race([i,l]).then((function(e){n.on(E.get("LOADINGPREVIEW")),U.removeModal(A.body),o(e,!0)}),(function(e){"usercancelled"!=e&&(e.reason?T("error",E.get("CannotPreviewDocument"),E.get("CannotAccessDocument"),e.reason.error,!1):T("error",E.get("CannotPreviewDocument"),E.get("CannotAccessDocument"),"",!1)),U.removeModal(A.body)}))}}},P={title:E.get("Download"),name:"Download",text:E.get("Download"),fonticon:"download",handler:function(){var t=void 0;a.options.document.data&&null==(t=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(t=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name);var o={asZip:!0,autoDownload:!0};o.tenant=a.options.document.envId,o.securityContext=a.options.document.contextId,o.tenantUrl=a.options.platformUrls["3DSpace"],o.onComplete=function(o){if(t&&""!==t){var n={subtitle:e.String.format(E.DOWNLOAD_FILES_INITIATED,t)};T("info",n.title||"",n.subtitle||"","",!1)}else T("info",E.Download_Initiated,"",!1)},o.onFailure=function(e){T("error",e.data[0].updateMessage,"","",!1)},A.MSFDocumentClient&&null===h.MSFDocumentClient&&(h.MSFDocumentClient=A.MSFDocumentClient),h.downloadDocument(a.options.document.id,a.options.document.fileid,!1,o)}},L={title:E.get("Edit"),name:"Edit",text:E.get("Edit"),fonticon:"pencil",handler:function(){var t=void 0;if(a.options.document.data&&null==(t=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(t=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name),1==a.options.document.data.files.length){var o={asZip:!0,autoDownload:!0};o.tenant=a.options.document.envId,o.securityContext=a.options.document.contextId,o.tenantUrl=a.options.platformUrls["3DSpace"],o.onComplete=function(o){if(t&&""!==t){var n={title:E.get("Download_Initiated"),subtitle:e.String.format(E.get("Filedownloadstartedforedit"),t)};T("info",n.title||"",n.subtitle||"","",!1)}else T("info",E.get("checkout_initiated"),"",!1);a.options.onComplete&&h.getDocuments([a.options.document.id],{tenant:a.options.document.envId,securityContext:a.options.document.contextId,tenantUrl:a.options.platformUrls["3DSpace"],onComplete:function(e){if(e.success){if(!Array.isArray(e.data))return;a.options.onComplete({action:"Edit",data:e.data})}}})},o.onFailure=function(e){var t="Document";a.options.document&&a.options.document.data&&a.options.document.data.dataelements?t=a.options.document.data.dataelements.typeNLS||a.options.document.data.dataelements.type:a.options.document.type&&(t=a.options.document.type),e&&e.data&&e.data.length>0&&e.data[0].updateMessage?T("error",E.get("YouCannotEditX",{typeNLS:t}),E.get("VerifyCredentials"),E.get("NotHaveRequiredAccessRole")):T("error",E.get("YouCannotEditX",{typeNLS:t}),e),console.error("Document Edit Failed Due to:",e)},A.MSFDocumentClient&&null===h.MSFDocumentClient&&(h.MSFDocumentClient=A.MSFDocumentClient),h.downloadDocument(a.options.document.id,a.options.document.fileid,!0,o)}else 0==a.options.document.data.files.length?T("error","",E.get("objectcontainsnofile"),"",!1):T("error","",E.get("Nomultifilesupport"),"",!1)}},O={title:E.get("Copy"),name:"Copy",text:E.get("Copy"),fonticon:"copy",handler:function(){var e=M(a.options);F.copy(e),a.options.onComplete({action:"Copy"})}},R={title:E.get("Paste"),name:"Paste",text:E.get("Paste"),fonticon:"paste",handler:function(){F.paste(a.options.onComplete)}},V={title:E.get("Relations"),name:"Relations",text:E.get("Relations"),fonticon:"object-related",handler:function(){var e=M(a.options);e.appId="ENORIPE_AP";var t=new l.Socket("compassPageSocket");t.subscribeServer("com.ds.compass",window.parent),t.dispatchEvent("onSetX3DContent",e,"compassPageSocket"),t.addListener("launchApp",(function(e,o,n){t.unsubscribeServer("com.ds.compass"),t.disconnect()})),t.dispatchEvent("onLaunchApp",e,"compassPageSocket")}},W={title:E.get("CopyLink"),name:"CopyLink",text:E.get("CopyLink"),fonticon:"link",handler:function(){var t=void 0;a.options.document.data&&null==(t=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(t=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name);var i,l,c=(i=a.options,(l={protocol:"3DXContent",data:{items:[]}}).data.items.push({envId:i.document.envId,objectId:i.document.id,openLink:!0}),i.document.fileid&&(l.data.items[0].fileid=i.document.fileid,l.data.items[0].openFile=!0),l),r=e.createElement("div",{styles:{display:"flex"}}),u=new n("input",{attributes:{readonly:"readonly"}});u.getContent().setStyles({display:"inline-block","border-top-right-radius":0,"border-bottom-right-radius":0}),u.inject(r);var m=new o({value:E.get("CopyLink"),className:"block",events:{onClick:function(o){u.setFocus(),u.elements.input.select(),u.elements.input.setSelectionRange(0,99999),document.execCommand("cut"),f.hide(),T("success",E.get("LinkCopiedTitle"),t&&""!==t?e.String.format(E.get("LinkCopiedMsg"),t):E.get("LinkCopied"),"",!1,a.options.notificationTarget)}}});m.getContent().setStyles({display:"inline-block","border-top-left-radius":0,"border-bottom-left-radius":0,padding:"0 10px"}),m.inject(r);var p,f=new d({body:r,closeOnClick:!1,events:{onClickOutside:function(e){console.log("DDClickOutside")}}});f.options.target=this.options.target,s["3DDashboard"]&&(p=s["3DDashboard"]),null==p&&(p=A.widgetDomain),console.log(p),null==p?w.getPlatformServices({platformId:a.options.document.envId,onComplete:function(e){f.hide(),f.show(),u.setFocus(),u.setValue(e["3DDashboard"]+"#app:ENXWDOC_AP/content:X3DContentId="+encodeURIComponent(JSON.stringify(c))),u.elements.input.select(),u.elements.input.setSelectionRange(0,99999,"backward"),m.getContent().click()}}):(f.hide(),f.show(),u.setFocus(),u.setValue(p+"#app:ENXWDOC_AP/content:X3DContentId="+encodeURIComponent(JSON.stringify(c))),u.elements.input.select(),u.elements.input.setSelectionRange(0,99999,"backward"),m.getContent().click())}},_={title:E.get("ReplaceBy"),name:"ReplaceBy",text:E.get("ReplaceBy"),fonticon:"replace-by-revision",items:[{text:E.get("ReplacebyRevision"),title:E.get("ReplacebyRevision"),name:"ReplacebyRevision",fonticon:"replace-by-revision",handler:function(){this.platformUrls=a.options.platformUrls,this.securityContext=a.options.document.contextId,this.parentId=a.options.document.data.parentId,this.relName=a.options.document.data.relName,this.oldDocumentId=a.options.document.id,this.parentDirection=a.options.document.data.parentDirection,this.tenant=a.options.document.envId,this.tenantUrl=a.options.platformUrls["3DSpace"];var t=this;this.that=a;var o=e.createElement("div",{class:"revisionUpdate-dialog"}).inject(document.body);this._myVersionExplorer=new p({versionGraphContainer:null,selectionMode:g.SELECTION_MODES.SINGLE_SELECT_ONLY,widget:A}),this._myVersionExplorer.disableDrag(),this._myVersionExplorer.showDialog({x:100,y:100},o,!0),f.loadUserSettingsPromise({displayMode:g.DISPLAY_MODES.SUBWAY_VIEW,displayLegend:!0},!0),this._myVersionExplorer.publishEvent("ENOXVersionExplorerLoadVersionModel",{id:this.oldDocumentId,tenantId:a.options.document.envId,securityContext:this.securityContext,onComplete:function(){},dataModelType:g.DATA_MODEL_TYPES.MODEL_HISTORY}),this._myVersionExplorer.subscribeEvent("ENOXVersionExplorerModalOK",k.bind(this)),this._myVersionExplorer.subscribeEvent("ENOXVersionExplorerModalCancel",N.bind(this)),this._dlgVersionExplorer=v._dlg,v._dlg&&v._dlg.rightButtons&&v._dlg.rightButtons.addEventListener("click",N.bind(this)),this._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!0,this._myVersionExplorer.subscribeEvent("select",(function(e){t._dlgVersionExplorer.isVisible&&(t._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!1)})),this._myVersionExplorer.subscribeEvent("unselect",(function(e){t._dlgVersionExplorer.isVisible&&(t._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!0)}))}},{text:E.get("ReplacebyLatestRevision"),title:E.get("ReplacebyLatestRevision"),name:"ReplacebyLatestRevision",fonticon:"replace-by-latest-version",handler:function(){var t=a.options.platformUrls,o=a.options.document.contextId,n=a.options.document.data.parentId,i=a.options.document.data.relName,s=a.options.document.id,l=a.options.document.data.parentDirection,c={};c.data=JSON.stringify({lastVersionRequests:[{id:s}]}),c.onComplete=function(c){if((c=JSON.parse(c)).lastVersionRequests[0].islast){console.log("Existing document is in latest revision.");var r={result:c={message:E.WarningLatestRevision},action:"ReplacebyLatestRevision",targetDocumentId:s};a.options.onComplete(r)}else{var d=c.lastVersionRequests[0].candidates[0],m={onComplete:function(e){(e={}).message=E.get("ReplacedByLatest");var t={result:e,action:"ReplacebyLatestRevision",targetDocumentId:d};a.options.onComplete(t)},onFailure:function(e,t){T("error",E.get("YouCannotReplaceX"),E.get("VerifyCredentials"),E.get("NotHaveRequiredAccessRole"));
//! showNotification("error", '', errorJson.error, '', false);
}};u.authenticatedRequest(t["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",e.extend({},{method:"GET",url_temp:t["3DSpace"],onComplete:function(c){m.onComplete,m.onFailure;var r=t["3DSpace"]+"/resources/v1/modeler/documents/?parentRelName="+i+"&parentDirection="+l+"&tenant=OnPremise";m.type="json",m.url=encodeURI(r);var p=JSON.parse(c).csrf;m.data=JSON.stringify({csrf:p,data:[{id:s,updateAction:"NONE",relateddata:{parents:[{id:n,updateAction:"DELETE"}]}},{id:d,updateAction:"NONE",relateddata:{parents:[{id:n,updateAction:"CREATE"}]}}]}),m.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:encodeURIComponent(o)},m.headers=e.merge(m.headers,e.is(a.options.getWorkUnderHeaders,"function")?a.options.getWorkUnderHeaders():{}),m.method="PUT",m.SecurityContext=o,u.authenticatedRequest(m.url,m)}}))}},c.onFailure=function(e){console.log("Get Latest version failed."+e),T("error",e.data[0].updateMessage,"","",!1)},c.method="POST",c.headers={Accept:"application/json","Content-Type":"application/json",securitycontext:encodeURIComponent(o)},c.proxy="passport",c.url=t["3DSpace"]+S.LATEST_REVISION,u.authenticatedRequest(c.url,c)}}]},j={title:E.get("Remove"),name:"Remove",text:E.get("Remove"),fonticon:"remove",handler:function(){var e={relInfo:{parentId:a.options.document.data.parentId,parentRelName:a.options.document.data.relName,parentDirection:a.options.document.data.parentDirection},tenant:a.options.document.envId,securityContext:a.options.document.contextId,tenantUrl:a.options.platformUrls["3DSpace"],additionalHeaders:{SecurityContext:a.options.document.contextId?encodeURIComponent(a.options.document.contextId):void 0},onFailure:function(e){(e=JSON.parse(e)).message=E.DocumentDisconnectFailed;b.REMOVE,a.options.document.id},onComplete:function(e){console.log("Disconnect document completed.");var t={result:{message:E.DocumentDisconnect},action:b.REMOVE,targetDocumentId:a.options.document.id};a.options.onComplete(t)}};h.disconnectDocumentFromParent(a.options.document.id,e)}},H={title:E.get("NewRevision"),name:"New Revision",text:E.get("NewRevision"),fonticon:"flow-line-add",handler:function(){var t=void 0;a.options.document.data&&null==(t=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(t=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name);var o=a.options.platformUrls,n=a.options.document.contextId,i=(a.options.document.data.parentId,a.options.document.data.relName,a.options.document.id),s=a.options.document.envId,l=(a.options.document.data.parentDirection,{});l.data=JSON.stringify({data:[{physicalid:i,folderid:null}]}),l.onComplete=function(i){"success"==(i=JSON.parse(i)).status?(T("success","",e.String.format(E.get("NewRevisionSuccessfulMsg"),t),"",!1),a.options.onComplete&&h.getDocuments([i.results[0].physicalid],{tenant:s,securityContext:n,tenantUrl:o["3DSpace"],onComplete:function(e){if(e.success){if(!Array.isArray(e.data))return;a.options.onComplete({action:"New Revision",data:e.data})}}})):"failure"==i.status&&(console.log(i.status+" : "+i.report[0].error),T("error","",i.report[0].error,"",!1))},l.onFailure=function(e){console.log("Get Latest version failed."+e),T("error",e.data[0].updateMessage,"","",!1)},l.method="POST",l.headers={Accept:"application/json","Content-Type":"application/json",securitycontext:encodeURIComponent(n)},l.headers=e.merge(l.headers,e.is(a.options.getWorkUnderHeaders,"function")?a.options.getWorkUnderHeaders():{}),l.proxy="passport",l.url=o["3DSpace"]+S.NEW_REVISION+"?tenant="+s,u.authenticatedRequest(l.url,l)}},J={title:E.get("UndoEdit"),name:b.UNDO_EDIT,text:E.get("UndoEdit"),fonticon:"undo",handler:function(){var t=void 0;a.options.document.data&&null==(t=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(t=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name),1==a.options.document.data.files.length?u.authenticatedRequest(s["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:s["3DSpace"],onComplete:function(o){var n={};n.tenant=a.options.document.envId,n.securityContext=a.options.document.contextId,n.tenantUrl=a.options.platformUrls["3DSpace"],n.onComplete=function(o){T("success","",e.String.format(E.get("Editoperationcancelled"),t),!1),a.options.onComplete&&h.getDocuments([a.options.document.id],{tenant:a.options.document.envId,securityContext:a.options.document.contextId,tenantUrl:a.options.platformUrls["3DSpace"],onComplete:function(e){if(e.success){if(!Array.isArray(e.data))return;a.options.onComplete({action:"UndoEdit",data:e.data})}}})},n.onFailure=function(e,t){T("error","",t.error,"",!1)};var i=n.tenantUrl+"/resources/v1/modeler/documents/"+a.options.document.id+"/unlock";n.type="json",n.url=i,n.data=JSON.stringify({csrf:JSON.parse(o).csrf}),n.headers=n.headers||{Accept:"*/*","Content-Type":"application/ds-json"},n.headers.SecurityContext=n.headers.SecurityContext?encodeURIComponent(n.headers.SecurityContext):void 0,n.method="POST",u.authenticatedRequest(i,n)}}):0==a.options.document.data.files.length?T("error","",E.get("objectcontainsnofile"),"",!1):T("error","",E.get("Nomultifilesupport"),"",!1)}},X={title:E.get("Update"),name:"Update",text:E.get("Update"),fonticon:"update",handler:function(){var t=void 0;a.options.document.data&&null==(t=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(t=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name);var o=void 0;if(a.options.document.data.revision?o=a.options.document.data.revision:a.options.document.data.dataelements&&(o=a.options.document.data.dataelements.revision),o&&(t=t+" "+o),1==a.options.document.data.files.length){var n=e.createElement("input",{attributes:{id:"btnUpload_chooser",type:"file",multiple:!1},styles:{display:"none"},events:{change:function(e){if(e.target&&e.target.files&&e.target.files.length>0||e.dataTransfer&&e.dataTransfer.files){var o=e.target&&e.target.files&&e.target.files.length>0?e.target.files:e.dataTransfer.files;if(0==o.length&&(o=e.detail.files),o.length>1)throw E.get("Cannotselectmorethanonefile");1==o.length?a.file=o[0]:a.file=null}else a.file=null;if(a.options.document.data.files&&a.file)if(a.options.document.data.files[0].dataelements.title!=a.file.name){var s='<div style="display: flex;"><span class="fonticon fonticon-attention text-warning fonticon-2x"></span><p style="margin-left: 10px; white-space: pre-line">'+E.get("UpdateConfirmationMsg",{newFileName:a.file.name,oldFileName:a.options.document.data.files[0].dataelements.title})+"</p></div>",l=new i({className:"site-reset",header:E.get("UpdateConfirmation",{documentTitle:t}),body:s,footer:'<button type="button" class="btn btn-primary">'+E.get("Update")+'</button> <button type="button" class="btn btn-default">'+E.get("Cancel")+"</button>",animate:!0,resizable:!0,autocenter:!0,visible:!0,limitParent:!0,overlay:!0,closable:!1});l.show(),l.elements.container.setStyle("z-index","50000"),l.inject(A.body),l.getContent().getElements(".btn.btn-primary").forEach((function(e){e.addEvent("click",(function(){X.sendFile(a.file,t),l.hide(),l.destroy()}))})),l.getContent().getElements(".btn.btn-default").forEach((function(e){e.addEvent("click",(function(){l.hide(),l.destroy()}))}))}else X.sendFile(a.file,t);n.destroy()}}}).inject(A.body);n.click()}else 0==a.options.document.data.files.length?T("error","",E.get("objectcontainsnofile"),"",!1):T("error","",E.get("Nomultifilesupport"),"",!1)},sendFile:function(t,o){var n={tenant:a.options.document.envId,securityContext:a.options.document.contextId,tenantUrl:a.options.platformUrls["3DSpace"],additionalHeaders:{SecurityContext:a.options.document.contextId?encodeURIComponent(a.options.document.contextId):void 0},onFailure:function(e){x.jobs.finishJob(l,"failed");var t="Document";if(a.options.document&&a.options.document.data&&a.options.document.data.dataelements?t=a.options.document.data.dataelements.typeNLS||a.options.document.data.dataelements.type:a.options.document.type&&(t=a.options.document.type),e&&e.length>0&&e[0].updateMessage)T("error",E.get("YouCannotUpdateX",{typeNLS:t}),E.get("VerifyCredentials"),E.get("NotHaveRequiredAccessRole"));else if(e&&e.error)if((e.error.match(/\n/g)||[]).length>=2){for(var o=e.error.split("\n"),n=[],i=2;i<o.length;i++)n.push(o[i]);n=n.join("<br/>"),T("error",o[0],o[1],n,void 0,void 0,!0)}else T("error",E.get("YouCannotUpdateX",{typeNLS:t}),e.error);else T("error",E.get("YouCannotUpdateX",{typeNLS:t}),e);console.error("Document Update Failed Due to:"),console.error(e)},onProgress:function(e){l.update(e)},onComplete:function(t){x.jobs.finishJob(l),T("success",E.get("Fileuploadsuccessful"),e.String.format(E.get("FileuploadsuccessfulMsg"),o),"",!1),a.options.onComplete&&a.options.onComplete({action:"Update",data:t.data})}},i={file:t};t.name&&(i.fileName=t.name);var s={id:a.options.document.id,fileInfo:i},l={title:E.get("UPLOADING_X",{title:a.file.name}),ui:!!s.fileInfo,process:function(){l.xhr=h.modifyDocument(s,n)}};x.jobs.addJob(l)}},q={title:E.get("Delete"),name:"Delete",text:E.get("Delete"),fonticon:"trash",handler:function(){var t=void 0;a.options.document.data&&null==(t=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(t=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name);var o=void 0;a.options.document.data.revision?o=a.options.document.data.revision:a.options.document.data.dataelements&&(o=a.options.document.data.dataelements.revision),o&&(t=t+" "+o);var n=e.createElement("div",{styles:{display:"flex"}});e.createElement("span",{styles:{color:"red"},class:"fonticon fonticon-attention fonticon-2x"}).inject(n);var s=e.createElement("p");s.innerText=e.String.format(E.get("DeleteConfirmation"),t),s.inject(n);var l=n,c=new i({className:"site-reset",closable:!0,header:E.get("Delete"),body:l,footer:'<button type="button" class="btn btn-primary">'+E.get("Ok")+'</button> <button type="button" class="btn btn-default">'+E.get("Cancel")+"</button>",animate:!0,resizable:!0,autocenter:!0,visible:!0,limitParent:!0,overlay:!0});c.show(),c.inject(A.body);var r={onComplete:function(o){T("success",E.get("DeletionSuccessful"),e.String.format(E.get("DeletionSuccessfulMsg"),t),"",!1),a.options.onComplete&&a.options.onComplete({action:"Delete"})},onFailure:function(e){T("error","",e.error,"",!1)}};r.tenant=a.options.document.envId,r.securityContext=a.options.document.contextId,r.tenantUrl=a.options.platformUrls["3DSpace"],r.additionalHeaders={SecurityContext:a.options.document.contextId?encodeURIComponent(a.options.document.contextId):void 0},c.getContent().getElements(".btn.btn-primary").forEach((function(e){e.addEvent("click",(function(){h.deleteDocument(a.options.document.id,r),c.hide(),c.destroy()}))})),c.getContent().getElements(".btn.btn-default").forEach((function(e){e.addEvent("click",(function(){c.hide(),c.destroy()}))}))}},B={title:E.get("Maturity"),name:"Maturity",text:E.get("Maturity"),fonticon:"collaborative-lifecycle-management",handler:function(){a.options.document.contextId,a.options.document.envId;(new m).executeAsync([{physicalId:a.options.document.id}]).then((function(e,t,o){console.log("Maturity view.");var n={result:{message:"Maturity View."},action:"maturity",targetDocumentId:a.options.document.id};a.options.onComplete(n)}))}},K={title:E.get("Share"),name:"Share",text:E.get("Share"),fonticon:"share",handler:function(){var e=void 0;a.options.document.data&&null==(e=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(e=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name),require(["DS/ENOCollabSharingCmds/BaseModels/ResultElement","DS/SharePopup/SharePopup"],(function(t,o){var n=[new t({physicalId:a.options.document.id,name:e})];a.sharePanel?(a.sharePanel.show(n),a.sharePanel.container.centerIt()):(a.sharePanel=new o(A,A.body,{removeAtClose:!0,events:{onClose:function(){a.sharePanel=null}}}),a.sharePanel.show(n))}))}},G=!1,z=!1;if(a.options.document.data&&a.options.document.data.files&&a.options.document.data.files.length>1&&(z=!0),a.options.document.data&&a.options.document.data.files&&0!=a.options.document.data.files.length&&(G=""!=a.options.document.data.files[0].dataelements.locker),void 0===c){var Y={};return a.options.document.type?a.supportedTypes.includes(a.options.document.type)?(Y[b.PREVIEW]=y,Y[b.PREVIEW2]=C,Y[b.REPLACE_BY_REVISION]=_,Y[b.MATURITY]=B,Y[b.DOWNLOAD]=P,Y[b.SHARE]=K,Y[b.COPY_LINK]=W,Y[b.RELATION]=V,Y[b.REMOVE]=j,Y[b.NEW_REVISION]=H,Y[b.DELETE]=q,Y[b.COPY]=O,F.contentCopied&&(Y[b.PASTE]=R),(a.options.document.filesCallback||a.options.document.data&&a.options.document.data.files)&&(Y[b.UPDATE]=X,!G||z?Y[b.EDIT]=L:Y[b.UNDO_EDIT]=J)):(Y[b.MATURITY]=B,Y[b.RELATION]=V,Y[b.REMOVE]=j):(Y[b.PREVIEW]=y,Y[b.PREVIEW2]=C,Y[b.REPLACE_BY_REVISION]=_,Y[b.MATURITY]=B,Y[b.DOWNLOAD]=P,Y[b.SHARE]=K,Y[b.COPY_LINK]=W,Y[b.RELATION]=V,Y[b.REMOVE]=j,Y[b.NEW_REVISION]=H,Y[b.DELETE]=q,Y[b.COPY]=O,F.contentCopied&&(Y[b.PASTE]=R),(a.options.document.filesCallback||a.options.document.data&&a.options.document.data.files)&&(Y[b.UPDATE]=X,!G||z?Y[b.EDIT]=L:Y[b.UNDO_EDIT]=J)),a.options.renderToArray?Object.values(Y):Y}D={index:r},c.addItem(e.merge(D,y)),D={index:r+=1},c.addItem(e.merge(D,_)),D={index:r+=1},c.addItem(e.merge(D,B)),D={index:r+=1},c.addItem(e.merge(D,P)),D={index:r+=1},c.addItem(e.merge(D,K)),D={index:r+=1},c.addItem(e.merge(D,W)),D={index:r+=1},c.addItem(e.merge(D,V)),D={index:r+=1},c.addItem(e.merge(D,j)),D={index:r+=1},c.addItem(e.merge(D,H)),D={index:r+=1},c.addItem(e.merge(D,q)),D={index:r+=1},c.addItem(e.merge(D,X)),D={index:r+=1},!G||z?c.addItem(e.merge(D,L)):c.addItem(e.merge(D,J))}return P.prototype.init=function(e){var o=this;this.options=e,this.supportedTypes=["Document","Quality System Document","Technical Document"],C.setup(o.options.platformUrls);var n=new t((function(e,t){C.getTypeDerivatives(o.supportedTypes,(function(t){var n=[];o.supportedTypes.length>0&&(o.supportedTypes.forEach((e=>{n.push(...t[e])})),o.supportedTypes=n),e(!0)}),o.options.platformUrls["3DSpace"])}));return A&&A.app&&A.app.jobs&&"doco-jobs"==A.app.jobs.name&&A.app.progressPane&&"doco-progress"==A.app.progressPane.name?x=A.app:(null==x.jobs&&require(["DS/DocumentCommands/Jobs"],(function(e){null==x.jobs&&(x.jobs=new e(x))})),null==x.progressPane&&require(["DS/DocumentCommands/ProgressPane"],(function(e){null==x.progressPane&&(x.progressPane=new e(x),x.progressPane.inject(A.body))})),null==x.modelEvents&&(x.modelEvents=new c,x.modelEvents.ownedBy="ENOXDocumentCommands")),n},P.prototype.render=function(){var e=this,o=e.options.contextmenu,n=e.options.platformUrls,i={};if(e.options.document.data&&e.options.document.data.relateddata&&e.options.document.data.relateddata.files&&(e.options.document.data.files=e.options.document.data.relateddata.files),null!=e.options.document.data&&null!=e.options.document.data.files||!o&&!e.options.document.filesCallback){if(void 0===o)return i=L(e,n);L(e,n,o)}else{var a={tenant:n.platformId,securityContext:e.options.document.contextId,tenantUrl:e.options.platformUrls["3DSpace"],additionalURLParams:"$include=none,files"};new t((function(t,o){a.onComplete=t,a.onFailure=o,h.getDocuments([e.options.document.id],a)})).then((function(t){e.options.document.data=t.data[0],e.options.document.data.files=t.data[0].relateddata.files,void 0!==o?L(e,n,o):(i=L(e,n),e.options.document.filesCallback(i))}),(function(e){console.error("Failed to get file Info",e)}))}},P})),define("DS/DocumentCommands/Helper",["UWA/Core","UWA/Promise","DS/WAFData/WAFData","DS/DocumentCommands/Constants","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/UIKIT/Modal","DS/Controls/Loader","DS/Controls/ModalContainer","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o,n,i,a,s,l,c,r){"use strict";var d=new e.Promise((function(e,t){i.getUser({onComplete:function(t){e(t)},onFailure:function(e){t(e)}})})),u={formatBytes:function(e,t){if(0===e)return"0 "+r.get("fileSizeBytes");if(1===e)return"1 "+r.get("fileSizeByte");var o=t+1||3,n=[r.get("fileSizeBytes"),r.get("fileSizeKiB"),r.get("fileSizeMiB"),r.get("fileSizeGiB"),r.get("fileSizeTiB"),r.get("fileSizePiB"),r.get("fileSizeEiB"),r.get("fileSizeZiB"),r.get("fileSizeYiB")],i=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,i)).toPrecision(o)+" "+n[i]},isIpadPro:function(){return"MacIntel"===navigator.platform&&navigator.maxTouchPoints&&navigator.maxTouchPoints>1},IsWebEditionAvailable:function(){let e=widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",o="OnPremise"!=e;return null==this.isODEGrantedPromise&&(this.isODEGrantedPromise=new t((function(t){require(["DS/OfficeDocumentEditorClient/Editor"],(function(n){o?n.isGranted({platformId:e}).then((()=>{t(!0)})).catch((e=>{t(!1)})):t(!1)}),(function(e){t(!1)}))}))),this.isODEGrantedPromise},IsWebEditionDocumentSessionActive:function(e,o){return new t((function(t,n){require(["DS/OfficeDocumentEditorClient/Editor"],(function(i){i.state({platformId:e,key:o}).then((e=>{t(e)})).catch((e=>{n(e)}))}),(function(e){n(e)}))}))},IsFileFormatSupported:function(e){return new t((function(t,o){require(["DS/OfficeDocumentEditorClient/Editor"],(function(n){n.isFileFormatSupported({format:e}).then((e=>{t(e)})).catch((e=>{o(e)}))}),(function(e){o(e)}))}))},AuthoringCommandVisibiltyPromise:function(e,o,n){return new t((function(t){u.CalculateDocumentModificationCommandsVisibility(e,o).then((function(e){n({visibleFlag:e[o]}),t(!0)}))}))},AuthoringFilesCommandVisibiltyPromise:function(e,o,n){return new t((function(t){u.CalculateFileModificationCommandsVisibility(e,o).then((function(e){n({visibleFlag:e[o]}),t(!0)}))}))},ConfirmWebEditorSessionActiveFromService:function(e,n,i,a){return new t((function(t,s){var l=e.fetchSecurityContext()?encodeURIComponent(e.fetchSecurityContext()):void 0,c=e.platformUrls["3DSpace"]+"/resources/v1/modeler/documents/IsOnlineWebEditorSessionActive?documentId="+n+"&fileId="+i+"&fileName="+a;o.authenticatedRequest(c,{method:"GET",type:"json",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:l},onComplete:function(e){if(e.success){if(!Array.isArray(e.data))return;t(e.data[0])}else console.error("ConfirmWebEditorSessionActiveFromService onComplete Failed",e),s(e)},onFailure:function(e){s(e)}})}))},ConfirmIsDocumentType:function(e,n){return new t((function(t,i){var a=e.fetchSecurityContext()?encodeURIComponent(e.fetchSecurityContext()):void 0,s=e.platformUrls["3DSpace"]+"/resources/v1/modeler/documents/IsDocumentType/"+n;o.authenticatedRequest(s,{method:"GET",type:"json",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:a},onComplete:function(e){e.success?t(e.data[0].dataelements.IsDocumentType):i(e)},onFailure:function(e){i(e)}})}))},showModalDialogIfWebSessionAvailable:function(t,n,i,s,l,c,r,d){var u=new a({className:"site-reset",header:r,body:t,footer:n,animate:!0,resizable:!0,autocenter:!0,visible:!0,limitParent:!0,overlay:!0,closable:!1});u.show(),u.elements.container.setStyle("z-index","50000"),u.inject(widget.body),u.getContent().getElements(".btn").forEach((function(t){"edit_online"===t.value?t.addEvent("click",(function(){u.hide(),u.destroy();var e="";e="file"==d?"DS/DocumentCommands/V2/FileActions/OfficeWebEdition":"DS/DocumentCommands/V2/Actions/OfficeWebEdition",require([e],(function(e){new e(i.options).execute()}))})):"request_to_unlock"==t.value?t.addEvent("click",(function(){u.hide(),u.destroy();o.authenticatedRequest(i.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",e.extend({},{method:"GET",type:"json",onComplete:function(e){var t=i.options.platformUrls["3DSpace"]+"/resources/v1/modeler/documents/SendNotificationOnRequestToUnlock?lockerName="+s+"&documentId="+l+"&fileId="+c,n={tenant:i.options.platformUrls.platformId,securityContext:i.options.securityContext,onComplete:function(e){console.log("request to unlock message sent to locker ")},onFailure:function(e,t){console.error("Issue in request to unlock message sent to locker",t.message)},url:t,type:"json",data:JSON.stringify({csrf:e.csrf}),headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:encodeURIComponent(i.options.securityContext)},method:"PUT"};o.authenticatedRequest(n.url,n)}}))})):"cancel"===t.value&&t.addEvent("click",(function(){u.hide(),u.destroy()}))}))},CalculateDocumentModificationCommandsVisibility:function(e,o){var i=this.IsWebEditionAvailable(),a=this;return new t((function(t){var s=/(android|iPhone|iPod|iPad)/i.test(navigator.userAgent)||a.isIpadPro(),l={};l[n.EDIT]=!1,l[n.OFFICE_WEB_EDITION]=!1,l[n.LOCK_AND_DOWNLOAD]=!1,l[n.UNDO_EDIT]=!1,l[n.UNLOCK]=!1,l[n.UPDATE_AND_UNLOCK]=!1,l[n.UPDATE]=!1,l[n.UPLOAD_FILE]=!1;var c=e.getSelectedNodes();if(1==c.length){l[n.UPLOAD_FILE]=!0;var r=e.getDocumentFromNodeModel(c[0]),d=null==r.dataelements.isDocumentType?void 0:"TRUE"==r.dataelements.isDocumentType,m=[];if(r.relateddata&&r.relateddata.files?m=r.relateddata.files:r.files&&(m=r.files),1==m.length)if(""!=m[0].dataelements.locker){"OnPremise"==e.platformUrls.platformId?(l[n.UNDO_EDIT]=!0,l[n.UPDATE]=!0,t(l)):i.then((function(i){if(i){l[n.UNLOCK]=!0,l[n.UPDATE_AND_UNLOCK]=!0;let i=m[0].dataelements.title,c=i.lastIndexOf("."),r=i.substring(c+1,i.length);if(o!=n.OFFICE_WEB_EDITION)t(l);else if(null==d)a.ConfirmIsDocumentType(e,m[0].id).then((function(e){d="TRUE"==e,!s&&d?u.IsFileFormatSupported(r).then((e=>{e&&(l[n.OFFICE_WEB_EDITION]=!0),t(l)})).catch((function(e){t(l)})):t(l)})).catch((e=>{console.error("Error in calling isDocumentType")}));else!s&&d?u.IsFileFormatSupported(r).then((e=>{e&&(l[n.OFFICE_WEB_EDITION]=!0),t(l)})).catch((function(e){t(l)})):t(l)}else l[n.UNDO_EDIT]=!0,l[n.UPDATE]=!0,t(l)}))}else{"OnPremise"==e.platformUrls.platformId?(l[n.EDIT]=!0,l[n.UPDATE]=!0,t(l)):i.then((function(i){if(i){l[n.LOCK_AND_DOWNLOAD]=!0,l[n.UPDATE]=!0;let i=m[0].dataelements.title,c=i.lastIndexOf("."),r=i.substring(c+1,i.length);if(o!=n.OFFICE_WEB_EDITION)t(l);else if(null==d)a.ConfirmIsDocumentType(e,m[0].id).then((function(e){d="TRUE"==e,!s&&d?u.IsFileFormatSupported(r).then((e=>{e&&(l[n.OFFICE_WEB_EDITION]=!0),t(l)})).catch((function(e){t(l)})):t(l)})).catch((e=>{console.error("Error in calling isDocumentType")}));else!s&&d?u.IsFileFormatSupported(r).then((e=>{e&&(l[n.OFFICE_WEB_EDITION]=!0),t(l)})).catch((function(e){t(l)})):t(l)}else l[n.EDIT]=!0,l[n.UPDATE]=!0,t(l)}))}else t(l)}else t(l)}))},CalculateFileModificationCommandsVisibility:function(e,o){var i=this.IsWebEditionAvailable(),a=this;return new t((function(t){var s=/(android|iPhone|iPod|iPad)/i.test(navigator.userAgent)||a.isIpadPro(),l={};l[n.EDIT]=!1,l[n.OFFICE_WEB_EDITION]=!1,l[n.LOCK_AND_DOWNLOAD]=!1,l[n.LOCK]=!1,l[n.UNDO_EDIT]=!1,l[n.UNLOCK]=!1,l[n.UPDATE_AND_UNLOCK]=!1,l[n.UPDATE]=!1;var c=e.getSelectedNodes();if(1==c.length){var r=null==e.ctrl.e6wDocument?e.ctrl.options.document:e.ctrl.e6wDocument,d=e.getDocumentFromNodeModel(c[0]),m=null==r.dataelements.isDocumentType?void 0:"TRUE"==r.dataelements.isDocumentType;if(""!=d.dataelements.locker){"OnPremise"==e.platformUrls.platformId?(l[n.UNDO_EDIT]=!0,l[n.UNLOCK]=!0,l[n.UPDATE_AND_UNLOCK]=!0,t(l)):i.then((function(i){if(i){l[n.UNLOCK]=!0,l[n.UPDATE_AND_UNLOCK]=!0;let i=d.dataelements.title,c=i.lastIndexOf("."),r=i.substring(c+1,i.length);if(o!=n.OFFICE_WEB_EDITION)t(l);else if(null==m)a.ConfirmIsDocumentType(e,d.id).then((function(e){m="TRUE"==e,!s&&m?u.IsFileFormatSupported(r).then((e=>{e&&(l[n.OFFICE_WEB_EDITION]=!0),t(l)})).catch((function(e){t(l)})):t(l)})).catch((e=>{console.error("Error in calling isDocumentType")}));else!s&&m?u.IsFileFormatSupported(r).then((e=>{e&&(l[n.OFFICE_WEB_EDITION]=!0),t(l)})).catch((function(e){t(l)})):t(l)}else l[n.UNDO_EDIT]=!0,l[n.UNLOCK]=!0,l[n.UPDATE_AND_UNLOCK]=!0,t(l)}))}else{"OnPremise"==e.platformUrls.platformId?(l[n.EDIT]=!0,l[n.LOCK]=!0,l[n.UPDATE]=!0,t(l)):i.then((function(i){if(i){l[n.LOCK_AND_DOWNLOAD]=!0,l[n.LOCK]=!0,l[n.UPDATE]=!0;let i=d.dataelements.title,c=i.lastIndexOf("."),r=i.substring(c+1,i.length);if(o!=n.OFFICE_WEB_EDITION)t(l);else if(null==m)a.ConfirmIsDocumentType(e,d.id).then((function(e){m="TRUE"==e,!s&&m?u.IsFileFormatSupported(r).then((e=>{e&&(l[n.OFFICE_WEB_EDITION]=!0),t(l)})).catch((function(e){t(l)})):t(l)})).catch((e=>{console.error("Error in calling isDocumentType")}));else!s&&m?u.IsFileFormatSupported(r).then((e=>{e&&(l[n.OFFICE_WEB_EDITION]=!0),t(l)})).catch((function(e){t(l)})):t(l)}else l[n.EDIT]=!0,l[n.LOCK]=!0,l[n.UPDATE]=!0,t(l)}))}}else{var p=[],f=[];c.forEach((t=>{""!=e.getDocumentFromNodeModel(t).dataelements.locker?f.push(!0):p.push(!0)})),l[n.LOCK]=p.includes(!0)&&!p.includes(!1),l[n.UNLOCK]=f.includes(!0)&&!f.includes(!1),t(l)}}))},getFile:function(e,n,i){return new t((function(t,a){var s=e.fetchSecurityContext()?encodeURIComponent(e.fetchSecurityContext()):void 0,l=e.platformUrls["3DSpace"]+"/resources/v1/modeler/documents/"+n+"/files/"+i+"/";o.authenticatedRequest(l,{method:"GET",type:"json",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:s},onComplete:function(e){if(e.success){if(!Array.isArray(e.data))return;t(e.data[0])}else console.error("Data.GetFiles onComplete Failed",e),a(e)},onFailure:function(e){a(e)}})}))},fetchCurrentUser:function(){return d},checkModifyAccess:async function(n,i){var a=await new t((function(t,a){var s=i.options.fetchSecurityContext()?encodeURIComponent(i.options.fetchSecurityContext()):void 0,l=i.options.platformUrls["3DSpace"],c=e.is(i.options.getWorkUnderHeaders,"function")?i.options.getWorkUnderHeaders():u.getWorkUnderHeaders(),d=l+"/resources/v1/modeler/documents/"+n+"?$fields=none,hasModifyAccess,title&$include=none";o.authenticatedRequest(d,{method:"GET",type:"json",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:s,...c},onComplete:function(e){e&&e?.data&&e.data[0]?.dataelements?t({modifyAccess:e.data[0].dataelements.hasModifyAccess,title:e.data[0].dataelements.title}):(console.log("On complete failed for check modify access"),a(e))},onFailure:function(e){i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:r.get("AnErrorOccurred"),subtitle:r.get("FailedToCheckModifyAccess"),message:"",sticky:!1,allowUnsafeHTML:!0}}),a(e)}})}));try{return"FALSE"!=a.modifyAccess||(i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:r.get("YouCannotModifyX",{documentTitle:a.title}),subtitle:r.get("CheckAccessAndMaturity"),message:r.get("VerifyChangeActionSelected",{documentTitle:a.title}),sticky:!1,allowUnsafeHTML:!0}}),!1)}catch(e){i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:r.get("AnErrorOccurred"),subtitle:r.get("FailedToCheckModifyAccess"),message:"",sticky:!1,allowUnsafeHTML:!0}})}},startLoading:function(){this.webUXloader=new s({text:r.get("LOADING")}),this.webUXloader.on(),l.createModal(widget.body,this.webUXloader.elements.container)},finishLoading:function(){this.webUXloader.off(),l.removeModal(widget.body,this.webUXloader.elements.container)},getWorkUnderHeaders:function(){let t=c.get(),o=e.is(t)&&e.is(t.change.id)?t.change.id:null;return""!=o?{"DS-Change-Authoring-Context":"pid:"+o}:{}}};return u})),define("DS/DocumentCommands/ProgressPane",["UWA/Core","UWA/Controls/Abstract","DS/DocumentCommands/Helper","i18n!DS/DocumentCommands/assets/nls/DocumentCommands","css!DS/DocumentCommands/DocumentCommands.css"],(function(e,t,o,n){"use strict";return e.Controls.Abstract.extend({name:"doco-progress",options:{className:""},init:function(e){this.app=e,this._parent(e.options),this.buildSkeleton()},buildSkeleton:function(){var t=this;this.container=e.createElement("div",{class:t.getClassNames("-progresspane popover")});var o=e.createElement("div",{class:"progresspane-titlebar popover-title"});o.inject(this.container),(t.titleElement=e.createElement("div",{class:"progresspane-title",text:n.get("PROGRESS")})).inject(o),t.titlebarCancelAll=e.createElement("div",{class:"progresspane-title-cancelall fonticon-clickable",text:n.get("CancelAll")}),t.titlebarCancelAll.addEvent("click",(function(){t.app.jobs.cancelAll()})),t.titlebarCancelAll.inject(o),t.titlebarCancelAll.hide();var i=e.createElement("button",{class:"close fonticon fonticon-chevron-down",type:"button"});i.inject(o),i.addEvent("click",(function(){i.classList.contains("fonticon-chevron-down")?(i.classList.remove("fonticon-chevron-down"),i.classList.add("fonticon-chevron-up"),t.content.hide()):(i.classList.remove("fonticon-chevron-up"),i.classList.add("fonticon-chevron-down"),t.content.show())})),this.content=e.createElement("div",{class:"progresspane-content popover-content"}),this.content.inject(this.container),this.hide()},show:function(){this.container.show()},hide:function(){this.container.hide(),this.totalSize=0,this.completedSize=0,this.ongoingSizes={},this.titlebarCancelAll.hide(),this.titleElement.setText(n.get("PROGRESS"))},addPendingSize:function(e){this.totalSize+=e},totalSize:0,completedSize:0,ongoingSizes:{},addProgress:function(t){var i=this;i.show();var a=e.createElement("div",{class:"progresspane-job"}),s=e.createElement("div",{class:"progresspane-jobtitle",text:t.title,title:t.tooltip||t.title});s.inject(a);var l=e.createElement("progress",{class:"progress progresspane-jobprogress",value:0,max:100}).hide();l.inject(a);var c=e.createElement("div",{class:"progresspane-jobstatus",text:n.get("Pending")}).inject(a);if(t.cancel){var r=e.createElement("span",{class:"progresspane-jobcancel fonticon fonticon-close fonticon-clickable",title:n.get("Cancel")}).inject(a);r.addEvent("click",(function(){t.cancel()})),this.titlebarCancelAll.show()}a.inject(i.content),t.progress=a,t.progress.update=function(e,a,d,u){s.setText(e),l.setAttributes({value:100*a/d,max:100,title:e}),0!=a&&(c.hide(),l.show()),a==d&&(r&&r.hide(),u&&"failed"==u?c.setText(n.get("Failed")):u&&"cancelled"==u?c.setText(n.get("Cancelled")):(c.setText(n.get("Completed")),t.size&&i.titleElement.setText(n.get("PROGRESSOF",{current:o.formatBytes(i.completedSize,2),max:o.formatBytes(i.totalSize,2)}))),l.addClassName("progress-success"),c.show(),l.hide())}}})})),define("DS/DocumentCommands/V2/FileActions/UpdateAndUnlock",["UWA/Core","DS/UIKIT/Modal","DS/DocumentManagement/DocumentManagement","DS/DocumentCommands/Helper","DS/DocumentFiles/data/Model","DS/DocumentCommonInfra/TrackerAPI","DS/DocumentCommonInfra/components/UploadFileDialog","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/DocumentCommonInfra/Utils/GetWidgetConfiguration","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o,n,i,a,s,l,c,r){"use strict";var d=function(e){return{id:"UpdateAndUnlock",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"update-lock-open",fontIconFamily:1},label:r.get("UpdateAndUnlock"),tooltip:r.get("UpdateAndUnlock"),position:"far",category:"edit",value:function(t){t.options=e,d.execute(t)},visibleFlag:!1},execute:function(){d.execute({options:e})},updateForSelection:function(t,o){return n.AuthoringFilesCommandVisibiltyPromise(e,this.id,t)}}};function u(t,n,s,c){var d=new Date,u={},m=s.options.getDocumentFromNodeModel(t),p=s.options.getParentDocument();u.additionalHeaders=e.is(s.options.getWorkUnderHeaders,"function")?s.options.getWorkUnderHeaders():function(){let t=l.get(),o=e.is(t)&&e.is(t.change.id)?t.change.id:null;return""!=o?{"DS-Change-Authoring-Context":"pid:"+o}:{}}(),u.additionalHeaders.SecurityContext=s.options.fetchSecurityContext()?encodeURIComponent(s.options.fetchSecurityContext()):void 0,u.tenant=s.options.platformUrls.platformId,u.securityContext=s.options.fetchSecurityContext(),u.tenantUrl=s.options.platformUrls["3DSpace"],u.onFailure=function(e){var o=new Date-d;a.sendTrackerPageEvent({category:"docm.command.update",action:"click",label:"Document Update",pd:{docType:m.type,docId:m.id,newFileExtension:i.getFileExtension(n.name),oldFileExtension:i.getFileExtension(m.dataelements.title),source:s.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:o,failure:0}}),s.options.getJobsProcessorPromise.then((function(e){e.finishJob(v,"failed")}));var l="Document";if(m&&m.dataelements?l=m.dataelements.typeNLS||m.dataelements.type:t.options.type&&(l=t.options.type),e&&e.length>0&&e[0].updateMessage)s.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:r.get("YouCannotUpdateX",{typeNLS:l}),subtitle:r.get("VerifyCredentials"),message:r.get("NotHaveRequiredAccessRole"),sticky:!1,allowUnsafeHTML:!1}});else if(e&&e.error)if((e.error.match(/\n/g)||[]).length>=2){for(var c=e.error.split("\n"),u=[],p=2;p<c.length;p++)u.push(c[p]);u=u.join("<br/>"),s.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:c[0],subtitle:c[1],message:u,sticky:!1,allowUnsafeHTML:!0}})}else s.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:r.get("YouCannotUpdateX",{typeNLS:l}),subtitle:e.error,message:"",sticky:!1,allowUnsafeHTML:!1}});else s.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:r.get("YouCannotUpdateX",{typeNLS:l}),subtitle:e,message:"",sticky:!1,allowUnsafeHTML:!1}});console.error("Document Update Failed Due to:"),console.error(e)},u.onProgress=function(e){v.update(e)},u.onComplete=function(o){var l=new Date-d;a.sendTrackerPageEvent({category:"docm.command.update",action:"click",label:"Document Update",pd:{docType:m.type,docId:m.id,newFileExtension:i.getFileExtension(n.name),oldFileExtension:i.getFileExtension(m.dataelements.title),source:s.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:l,success:1}}),s.options.getJobsProcessorPromise.then((function(e){e.finishJob(v)})),s.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:r.get("Fileuploadsuccessful"),subtitle:e.String.format(r.get("FileuploadsuccessfulMsg"),c),message:"",sticky:!1,allowUnsafeHTML:!1}}),s.options.events.publish({event:"enox-docfiles-update-complete",data:{nodeModel:t,updatedFile:o.data[0].relateddata.files[0]}}),require(["DS/PlatformAPI/PlatformAPI"],(function(e){e.publish("docm-file-updated-to-document",{platformId:s.options.platformUrls.platformId,documentId:p,oldFileId:m.id,updatedFile:o.data[0].relateddata.files[0]})}))};var f={comments:n.comment?n.comment:" ",file:n};n.name&&(f.fileName=n.name,f.id=m.id);var g={id:p,fileInfo:f},v={title:r.get("UPLOADING_X",{title:n.name}),ui:!!g.fileInfo,process:function(){v.xhr=o.modifyDocument(g,u)}};s.options.getJobsProcessorPromise.then((function(e){e.addJob(v)}))}return d.execute=function(e){d.executeUpdate(e)},d.uploadFilesDialog=async function(t,o,n){var i=this;i.uploadFileDialog&&i.uploadFileDialog.myDialog&&(i.uploadFileDialog.immersiveFrame&&i.uploadFileDialog.immersiveFrame.destroy(),i.uploadFileDialog.myDialog.destroy(),i.uploadFileDialog.myDialog=void 0);var a={securityContext:t.options.fetchSecurityContext(),platformUrls:t.options.platformUrls},l=await c.getcommentAsMandtoryConfigValue(a).promise;t.options.mandatoryCommentConfigSetting=l;var u={events:t.options.events,dialogCustomizations:{defaultPrimaryDialogLabel:r.get("Update")},mandatoryCommentValueConfiguartionSetting:t.options.mandatoryCommentConfigSetting,platformUrls:e.clone(t.options.platformUrls,!0),files:[o],getSelectedNodes:t.options.getSelectedNodes(),onUploadFile:function(e){e.context.myForm.getModelItem("file").value.comment=e.context.myForm.getModelItem("comments").value,t.files=[e.context.myForm.getModelItem("file").value],d.executeFileUpload(t,t.files[0],n)}};i.uploadFileDialog=new s(u)},d.executeUpdate=async function(t){var o=t.options.getParentDocument(),i=t.options.getSelectedNodes()[0];let a=t.options.platformUrls.platformId;var s=t.options.getDocumentFromNodeModel(i);if(await n.checkModifyAccess(o,t)){var l=void 0;s&&null==(l=s.title||s.name)&&s.dataelements&&(l=s.dataelements.title||s.dataelements.name);var c=void 0;s.revision?c=s.revision:s.dataelements&&(c=s.dataelements.revision),c&&(l=l+" "+c);var u=window.FileActionsFilePicker=e.createElement("input",{attributes:{id:"btnUpload_chooser",type:"file",multiple:!1},styles:{display:"none"},events:{change:function(e){var o,s=t.options.getDocumentFromNodeModel(i);if(e.target&&e.target.files&&e.target.files.length>0||e.dataTransfer&&e.dataTransfer.files){var l=e.target&&e.target.files&&e.target.files.length>0?e.target.files:e.dataTransfer.files;if(0==l.length&&(l=e.detail.files),l.length>1)throw r.get("Cannotselectmorethanonefile");o=1==l.length?l[0]:null}else o=null;"OnPremise"!=a?n.ConfirmWebEditorSessionActiveFromService(t.options,t.options.getParentDocument(),s.id,s.dataelements.title).then((e=>{"true"==e.dataelements.WEB_EDITOR_SESSION_ACTIVE?t.options.events.publish({event:"docv2-show-notification",data:{level:"warning",title:"",subtitle:r.get("UpdateErrorMessageAsWebEditionSessionActive"),message:"",sticky:!1,allowUnsafeHTML:!0}}):d.uploadFilesDialog(t,o,u)})).catch((e=>{d.uploadFilesDialog(t,o,u)})):d.uploadFilesDialog(t,o,u)}}}).inject(t.options.widget.body);window.preventFilePickerClicks||u.click()}},d.executeFileUpload=function(e,o,n){var i=e.options.getSelectedNodes()[0],a=e.options.getDocumentFromNodeModel(i),s=void 0;if(a&&null==(s=a.title||a.name)&&a.dataelements&&(s=a.dataelements.title||a.dataelements.name),a.dataelements.title!=o.name){var l='<div style="display: flex;"><span class="fonticon fonticon-attention text-warning fonticon-2x"></span><p style="margin-left: 10px; white-space: pre-line">'+r.get("UpdateConfirmationMsg",{newFileName:o.name,oldFileName:a.dataelements.title})+"</p></div>",c=new t({className:"site-reset",header:r.get("UpdateConfirmation",{documentTitle:s}),body:l,footer:'<button type="button" class="btn btn-primary">'+r.get("Update")+'</button> <button type="button" class="btn btn-default">'+r.get("Cancel")+"</button>",animate:!0,resizable:!0,autocenter:!0,visible:!0,limitParent:!0,overlay:!0,closable:!1});c.show(),c.elements.container.setStyle("z-index","50000"),c.inject(e.options.widget.body),c.getContent().getElements(".btn.btn-primary").forEach((function(t){t.addEvent("click",(function(){u(i,o,e,s),c.hide(),c.destroy()}))})),c.getContent().getElements(".btn.btn-default").forEach((function(e){e.addEvent("click",(function(){c.hide(),c.destroy()}))}))}else u(i,o,e,s);n.destroy()},d})),define("DS/DocumentCommands/V2/Actions/LockAndDownload",["UWA/Core","DS/DocumentManagement/DocumentManagement","DS/DocumentCommands/Helper","DS/DocumentCommonInfra/TrackerAPI","i18n!DS/DocumentCommands/assets/nls/DocumentCommands","i18n!DS/DocumentWebEdition/assets/nls/DocumentWebEdition"],(function(e,t,o,n,i,a){"use strict";var s=function(e){return{id:"LockAndDownload",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"lock-download",fontIconFamily:1},label:i.get("LockAndDownload"),tooltip:i.get("LockAndDownload"),position:"far",category:"edit",value:function(t){t.options=e,s.execute(t)},visibleFlag:!1},execute:function(){s.execute({options:e})},updateForSelection:function(t,n){return o.AuthoringCommandVisibiltyPromise(e,this.id,t)}}};return s.execute=function(e){s.executeLockAndDownload(e)},s.executeEdit=function(a){var l=new Date,c=a.options.getSelectedNodes()[0],r=a.options.getDocumentFromNodeModel(c),d=[];r.files?d=r.files:r.relateddata&&r.relateddata.files&&(d=r.relateddata.files);var u=void 0;if(r&&null==(u=r.title||r.name)&&r.dataelements&&(u=r.dataelements.title||r.dataelements.name),1==d.length){var m={asZip:!0,autoDownload:!0};m.tenant=a.options.platformUrls.platformId,m.securityContext=a.options.fetchSecurityContext(),m.tenantUrl=a.options.platformUrls["3DSpace"],m.onComplete=function(t){var m=new Date-l;if(n.sendTrackerPageEvent({category:"docm.command.lockanddownload",action:"click",label:"Document LockAndDownload",pd:{docType:r.type,docId:r.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:m,success:1,numOfFiles:1}}),u&&""!==u){var p={title:i.get("Download_Initiated"),subtitle:e.String.format(i.get("Filedownloadstartedforedit"),u)};s.showNotification(a,"info",p.title||"",p.subtitle||"","",!1,!1)}else s.showNotification(a,"info",i.get("checkout_initiated"),"","",!1,!1);a.options.events&&(a.options.events.publish({event:"docv2-edit-complete",data:{nodeModel:c}}),o.getFile(a.options,r.id,d[0].id).then((function(e){require(["DS/PlatformAPI/PlatformAPI"],(function(t){t.publish("docm-file-edited-in-document",{platformId:a.options.platformUrls.platformId,documentId:r.id,file:e})}))})))},m.onFailure=function(e){var t=new Date-l;n.sendTrackerPageEvent({category:"docm.command.lockanddownload",action:"click",label:"Document LockAndDownload",pd:{docType:r.type,docId:r.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:t,failure:0,numOfFiles:1}});var o="Document";r&&r.dataelements?o=r.dataelements.typeNLS||r.dataelements.type:r.type&&(o=r.type),e&&e.data&&e.data.length>0&&e.data[0].updateMessage?s.showNotification(a,"error",i.get("YouCannotEditX",{typeNLS:o}),i.get("VerifyCredentials"),i.get("NotHaveRequiredAccessRole"),!1,!1):s.showNotification(a,"error",i.get("YouCannotEditX",{typeNLS:o}),e,"",!1,!1),console.error("Document Edit Failed Due to:",e)},a.options.widget&&a.options.widget.MSFDocumentClient&&null===t.MSFDocumentClient?t.MSFDocumentClient=a.options.widget.MSFDocumentClient:a.options.MSFDocumentClient&&null===t.MSFDocumentClient&&(t.MSFDocumentClient=a.options.MSFDocumentClient),t.downloadDocument(r.id,r.fileid,!0,m)}else 0==d.length?s.showNotification(a,"error","",i.get("objectcontainsnofile"),"",!1,!1):s.showNotification(a,"error","",i.get("Nomultifilesupport"),"",!1,!1)},s.executeLockAndDownload=async function(e){let t=e.options.platformUrls.platformId;var n=e.options.getSelectedNodes()[0],l=e.options.getDocumentFromNodeModel(n);if(await o.checkModifyAccess(l.id,e)){var c=[];l.files?c=l.files:l.relateddata&&l.relateddata.files&&(c=l.relateddata.files);var r=c[0].dataelements.title||c[0].dataelements.name;if("OnPremise"!=t&&1==c.length)o.ConfirmWebEditorSessionActiveFromService(e.options,l.id,c[0].id,r).then((t=>{if("true"==t.dataelements.WEB_EDITOR_SESSION_ACTIVE){let t='<button type="button" value="edit_online" class="btn btn-primary">'+i.get("EditOnline")+'</button> <button type="button" value="cancel" class="btn btn-default">'+i.get("Cancel")+"</button>";o.showModalDialogIfWebSessionAvailable(a.get("WebEditorConfirmMessageWithNoLock"),t,e,"","","",r,"document")}else s.executeEdit(e)})).catch((t=>{s.executeEdit(e)}));else s.executeEdit(e)}},s.showNotification=function(e,t,o,n,i,a,s){e.options.events.publish({event:"docv2-show-notification",data:{level:t,title:o,subtitle:n,message:i,sticky:a,allowUnsafeHTML:s}})},s})),define("DS/DocumentCommands/V2/FileActions/UndoEdit",["UWA/Core","DS/WAFData/WAFData","DS/DocumentCommands/Helper","i18n!DS/DocumentCommands/assets/nls/DocumentCommands","css!DS/DocumentCommands/DocumentCommands.css"],(function(e,t,o,n){"use strict";var i=function(e){return{id:"UndoEdit",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"pencil-block",fontIconFamily:1},label:n.get("UndoEdit"),tooltip:n.get("UndoEdit"),position:"far",category:"edit",value:function(t){t.options=e,i.execute(t)},visibleFlag:!1},execute:function(){i.execute({options:e})},updateForSelection:function(t,n){return o.AuthoringFilesCommandVisibiltyPromise(e,this.id,t)}}};return i.execute=async function(i){var a=i.options.getSelectedNodes()[0],s=i.options.getDocumentFromNodeModel(a),l=i.options.getParentDocument();if(await o.checkModifyAccess(l,i)){var c=void 0;s&&null==(c=s.title||s.name)&&s.dataelements&&(c=s.dataelements.title||s.dataelements.name),t.authenticatedRequest(i.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:i.options.platformUrls["3DSpace"],onComplete:function(r){var d={};d.tenant=i.options.platformUrls.platformId,d.securityContext=i.options.fetchSecurityContext()?encodeURIComponent(i.options.fetchSecurityContext()):void 0,d.tenantUrl=i.options.platformUrls["3DSpace"],d.onComplete=function(t){i.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:"",subtitle:e.String.format(n.get("Editoperationcancelled"),c),message:"",sticky:!1,allowUnsafeHTML:!1}}),i.options.events&&(i.options.events.publish({event:"enox-docfiles-undoedit-complete",data:{nodeModel:a,fileId:s.id}}),o.getFile(i.options,l,s.id).then((function(e){require(["DS/PlatformAPI/PlatformAPI"],(function(t){t.publish("docm-file-undoedited-in-document",{platformId:i.options.platformUrls.platformId,documentId:l,file:e})}))})))},d.onFailure=function(e,t){i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:t.error,message:"",sticky:!1,allowUnsafeHTML:!1}})};var u=d.tenantUrl+"/resources/v1/modeler/documents/"+l+"/files/"+s.id+"/unlock";d.type="json",d.url=u,d.data=JSON.stringify({csrf:JSON.parse(r).csrf}),d.headers=d.headers||{Accept:"*/*","Content-Type":"application/ds-json"},d.method="POST",t.authenticatedRequest(u,d)}})}},i})),define("DS/DocumentCommands/V2/Actions/UpdateAndUnlock",["UWA/Core","DS/UIKIT/Modal","DS/DocumentManagement/DocumentManagement","DS/DocumentCommands/Helper","DS/DocumentFiles/data/Model","DS/DocumentCommonInfra/TrackerAPI","DS/DocumentCommonInfra/components/UploadFileDialog","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/DocumentCommonInfra/Utils/GetWidgetConfiguration","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o,n,i,a,s,l,c,r){"use strict";var d=function(e){return{id:"UpdateAndUnlock",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"update-lock-open",fontIconFamily:1},label:r.get("UpdateAndUnlock"),tooltip:r.get("UpdateAndUnlock"),position:"far",category:"edit",value:function(t){t.options=e,d.execute(t)},visibleFlag:!1},execute:function(){d.execute({options:e})},updateForSelection:function(t,o){return n.AuthoringCommandVisibiltyPromise(e,this.id,t)}}};function u(t,n,s,c){var d=new Date,u={},m=s.options.getDocumentFromNodeModel(t),p=[];m.files?p=m.files:m.relateddata&&m.relateddata.files&&(p=m.relateddata.files),u.additionalHeaders=e.is(s.options.getWorkUnderHeaders,"function")?s.options.getWorkUnderHeaders():function(){let t=l.get();var o=e.is(t)&&e.is(t.change.id)?t.change.id:null;return""!=o?{"DS-Change-Authoring-Context":"pid:"+o}:{}}(),u.additionalHeaders.SecurityContext=s.options.fetchSecurityContext()?encodeURIComponent(s.options.fetchSecurityContext()):void 0,u.tenant=s.options.platformUrls.platformId,u.securityContext=s.options.fetchSecurityContext(),u.tenantUrl=s.options.platformUrls["3DSpace"],u.onFailure=function(e){var o=new Date-d;a.sendTrackerPageEvent({category:"docm.command.update",action:"click",label:"Document Update",pd:{docType:m.type,docId:m.id,newFileExtension:i.getFileExtension(n.name),oldFileExtension:i.getFileExtension(p[0].dataelements.title),source:s.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:o,failure:0}}),s.options.getJobsProcessorPromise.then((function(e){e.finishJob(v,"failed")}));var l="Document";if(m&&m.dataelements?l=m.dataelements.typeNLS||m.dataelements.type:t.options.type&&(l=t.options.type),e&&e.length>0&&e[0].updateMessage)s.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:r.get("YouCannotUpdateX",{typeNLS:l}),subtitle:r.get("VerifyCredentials"),message:r.get("NotHaveRequiredAccessRole"),sticky:!1,allowUnsafeHTML:!1}});else if(e&&e.error)if((e.error.match(/\n/g)||[]).length>=2){for(var c=e.error.split("\n"),u=[],f=2;f<c.length;f++)u.push(c[f]);u=u.join("<br/>"),s.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:c[0],subtitle:c[1],message:u,sticky:!1,allowUnsafeHTML:!0}})}else s.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:r.get("YouCannotUpdateX",{typeNLS:l}),subtitle:e.error,message:"",sticky:!1,allowUnsafeHTML:!1}});else s.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:r.get("YouCannotUpdateX",{typeNLS:l}),subtitle:e,message:"",sticky:!1,allowUnsafeHTML:!1}});console.error("Document Update Failed Due to:"),console.error(e)},u.onProgress=function(e){v.update(e)},u.onComplete=function(o){var l=new Date-d;a.sendTrackerPageEvent({category:"docm.command.update",action:"click",label:"Document Update",pd:{docType:m.type,docId:m.id,newFileExtension:i.getFileExtension(n.name),oldFileExtension:i.getFileExtension(p[0].dataelements.title),source:s.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:l,success:1}}),s.options.getJobsProcessorPromise.then((function(e){e.finishJob(v)})),s.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:r.get("Fileuploadsuccessful"),subtitle:e.String.format(r.get("FileuploadsuccessfulMsg"),c),message:"",sticky:!1,allowUnsafeHTML:!1}}),s.options.events.publish({event:"docv2-update-complete",data:{nodeModel:t,data:o.data}}),require(["DS/PlatformAPI/PlatformAPI"],(function(e){e.publish("docm-file-updated-to-document",{platformId:s.options.platformUrls.platformId,documentId:m.id,oldFileId:p[0].id,updatedFile:o.data[0].relateddata.files[0]})}))};var f={comments:n.comment?n.comment:" ",file:n};n.name&&(f.fileName=n.name);var g={id:m.id,fileInfo:f},v={title:r.get("UPLOADING_X",{title:n.name}),ui:!!g.fileInfo,process:function(){v.xhr=o.modifyDocument(g,u)}};s.options.getJobsProcessorPromise.then((function(e){e.addJob(v)}))}return d.execute=function(e){d.executeUpdate(e)},d.uploadFilesDialog=async function(t,o,n){var i=this;i.uploadFileDialog&&i.uploadFileDialog.myDialog&&(i.uploadFileDialog.immersiveFrame&&i.uploadFileDialog.immersiveFrame.destroy(),i.uploadFileDialog.myDialog.destroy(),i.uploadFileDialog.myDialog=void 0);var a={securityContext:t.options.fetchSecurityContext(),platformUrls:t.options.platformUrls},l=await c.getcommentAsMandtoryConfigValue(a).promise;t.options.mandatoryCommentConfigSetting=l;var u={events:t.options.events,dialogCustomizations:{defaultPrimaryDialogLabel:r.get("Update")},mandatoryCommentValueConfiguartionSetting:t.options.mandatoryCommentConfigSetting,platformUrls:e.clone(t.options.platformUrls,!0),files:[o],getSelectedNodes:t.options.getSelectedNodes(),onUploadFile:function(e){e.context.myForm.getModelItem("file").value.comment=e.context.myForm.getModelItem("comments").value,t.files=[e.context.myForm.getModelItem("file").value],d.executeFileUpload(t,t.files[0],n)}};i.uploadFileDialog=new s(u)},d.executeUpdate=async function(t){let o=t.options.platformUrls.platformId;var i=t.options.getSelectedNodes()[0],a=t.options.getDocumentFromNodeModel(i);if(await n.checkModifyAccess(a.id,t)){var s=[];a.files?s=a.files:a.relateddata&&a.relateddata.files&&(s=a.relateddata.files);var l=void 0;a&&null==(l=a.title||a.name)&&a.dataelements&&(l=a.dataelements.title||a.dataelements.name);var c=void 0;if(a.revision?c=a.revision:a.dataelements&&(c=a.dataelements.revision),c&&(l=l+" "+c),1==s.length){var u=window.FilePicker=e.createElement("input",{attributes:{id:"btnUpload_chooser",type:"file",multiple:!1},styles:{display:"none"},events:{change:function(e){var i;if(e.target&&e.target.files&&e.target.files.length>0||e.dataTransfer&&e.dataTransfer.files){var l=e.target&&e.target.files&&e.target.files.length>0?e.target.files:e.dataTransfer.files;if(0==l.length&&(l=e.detail.files),l.length>1)throw r.get("Cannotselectmorethanonefile");i=1==l.length?l[0]:null}else i=null;"OnPremise"!=o&&1==l.length?n.ConfirmWebEditorSessionActiveFromService(t.options,a.id,s[0].id,s[0].dataelements.title).then((e=>{"true"==e.dataelements.WEB_EDITOR_SESSION_ACTIVE?t.options.events.publish({event:"docv2-show-notification",data:{level:"warning",title:"",subtitle:r.get("UpdateErrorMessageAsWebEditionSessionActive"),message:"",sticky:!1,allowUnsafeHTML:!0}}):d.uploadFilesDialog(t,i,u)})).catch((e=>{d.uploadFilesDialog(t,i,u)})):d.uploadFilesDialog(t,i,u)}}}).inject(t.options.widget.body);window.preventFilePickerClicks||u.click()}else 0==s.length?t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:r.get("objectcontainsnofile"),message:"",sticky:!1,allowUnsafeHTML:!1}}):t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:r.get("Nomultifilesupport"),message:"",sticky:!1,allowUnsafeHTML:!1}})}},d.executeFileUpload=function(o,n,i){var a=o.options.getSelectedNodes()[0],s=o.options.getDocumentFromNodeModel(a),l=[];s.files?l=s.files:s.relateddata&&s.relateddata.files&&(l=s.relateddata.files);var c=void 0;if(s&&null==(c=s.title||s.name)&&s.dataelements&&(c=s.dataelements.title||s.dataelements.name),l[0].dataelements.title!=n.name){var d='<div style="display: flex;"><span class="fonticon fonticon-attention text-warning fonticon-2x"></span><p style="margin-left: 10px; white-space: pre-line">'+r.get("UpdateConfirmationMsg",{newFileName:n.name,oldFileName:l[0].dataelements.title})+"</p></div>",m=new t({className:"site-reset",header:r.get("UpdateConfirmation",{documentTitle:e.String.escapeHTML(c)}),body:d,footer:'<button type="button" class="btn btn-primary">'+r.get("Update")+'</button> <button type="button" class="btn btn-default">'+r.get("Cancel")+"</button>",animate:!0,resizable:!0,autocenter:!0,visible:!0,limitParent:!0,overlay:!0,closable:!1});m.show(),m.elements.container.setStyle("z-index","50000"),m.inject(o.options.widget.body),m.getContent().getElements(".btn.btn-primary").forEach((function(e){e.addEvent("click",(function(){u(a,n,o,c),m.hide(),m.destroy()}))})),m.getContent().getElements(".btn.btn-default").forEach((function(e){e.addEvent("click",(function(){m.hide(),m.destroy()}))}))}else u(a,n,o,c);i.destroy()},d})),define("DS/DocumentCommands/V2/FileActions/LockAndDownload",["UWA/Core","DS/DocumentManagement/DocumentManagement","DS/DocumentCommands/Helper","DS/DocumentCommonInfra/TrackerAPI","i18n!DS/DocumentCommands/assets/nls/DocumentCommands","i18n!DS/DocumentWebEdition/assets/nls/DocumentWebEdition"],(function(e,t,o,n,i,a){"use strict";var s=function(e){return{id:"LockAndDownload",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"lock-download",fontIconFamily:1},label:i.get("LockAndDownload"),tooltip:i.get("LockAndDownload"),position:"far",category:"edit",value:function(t){t.options=e,s.execute(t)},visibleFlag:!1},execute:function(){s.execute({options:e})},updateForSelection:function(t,n){return o.AuthoringFilesCommandVisibiltyPromise(e,this.id,t)}}};return s.execute=function(e){s.executeLockAndDownload(e)},s.executeEdit=function(a){var l=new Date,c=a.options.getSelectedNodes()[0],r=a.options.getDocumentFromNodeModel(c),d=a.options.getParentDocument(),u=void 0;r&&null==(u=r.title||r.name)&&r.dataelements&&(u=r.dataelements.title||r.dataelements.name);var m={asZip:!0,autoDownload:!0};m.tenant=a.options.platformUrls.platformId,m.securityContext=a.options.fetchSecurityContext(),m.tenantUrl=a.options.platformUrls["3DSpace"],m.onComplete=function(t){var m=new Date-l;if(n.sendTrackerPageEvent({category:"docm.command.lockanddownload",action:"click",label:"Document LockAndDownload",pd:{docType:r.type,docId:r.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:m,success:1,numOfFiles:1}}),u&&""!==u){var p={title:i.get("Download_Initiated"),subtitle:e.String.format(i.get("Filedownloadstartedforedit"),u)};s.showNotification(a,"info",p.title||"",p.subtitle||"","",!1,!1)}else s.showNotification(a,"info",i.get("checkout_initiated"),"","",!1,!1);a.options.events&&(a.options.events.publish({event:"enox-docfiles-edit-complete",data:{nodeModel:c,fileId:r.id}}),o.getFile(a.options,d,r.id).then((function(e){require(["DS/PlatformAPI/PlatformAPI"],(function(t){t.publish("docm-file-edited-in-document",{platformId:a.options.platformUrls.platformId,documentId:d,file:e})}))})))},m.onFailure=function(e){var t=new Date-l;n.sendTrackerPageEvent({category:"docm.command.lockanddownload",action:"click",label:"Document LockAndDownload",pd:{docType:r.type,docId:r.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:t,failure:0,numOfFiles:1}});var o="Document";r&&r.dataelements?o=r.dataelements.typeNLS||r.dataelements.type:r.type&&(o=r.type),e&&e.data&&e.data.length>0&&e.data[0].updateMessage?s.showNotification(a,"error",i.get("YouCannotEditX",{typeNLS:o}),i.get("VerifyCredentials"),i.get("NotHaveRequiredAccessRole"),!1,!1):s.showNotification(a,"error",i.get("YouCannotEditX",{typeNLS:o}),e,"",!1,!1),console.error("Document Edit Failed Due to:")},a.options.widget&&a.options.widget.MSFDocumentClient&&null===t.MSFDocumentClient?t.MSFDocumentClient=a.options.widget.MSFDocumentClient:a.options.MSFDocumentClient&&null===t.MSFDocumentClient&&(t.MSFDocumentClient=a.options.MSFDocumentClient),t.downloadDocument(d,r.id,!0,m)},s.executeLockAndDownload=async function(e){let t=e.options.getParentDocument(),n=e.options.platformUrls.platformId;var l=e.options.getSelectedNodes()[0],c=e.options.getDocumentFromNodeModel(l),r=c.dataelements.title||c.dataelements.name;await o.checkModifyAccess(t,e)&&("OnPremise"!=n?o.ConfirmWebEditorSessionActiveFromService(e.options,t,c.id,r).then((t=>{if("true"==t.dataelements.WEB_EDITOR_SESSION_ACTIVE){let t='<button type="button" value="edit_online" class="btn btn-primary">'+i.get("EditOnline")+'</button> <button type="button" value="cancel" class="btn btn-default">'+i.get("Cancel")+"</button>";o.showModalDialogIfWebSessionAvailable(a.get("WebEditorConfirmMessageWithNoLock"),t,e,"","","",r,"file")}else s.executeEdit(e)})).catch((t=>{s.executeEdit(e)})):s.executeEdit(e))},s.showNotification=function(e,t,o,n,i,a,s){e.options.events.publish({event:"docv2-show-notification",data:{level:t,title:o,subtitle:n,message:i,sticky:a,allowUnsafeHTML:s}})},s})),define("DS/DocumentCommands/V2/Actions/NewRevision",["UWA/Core","UWA/Promise","DS/DocumentManagement/DocumentManagement","DS/WAFData/WAFData","DS/DocumentCommands/Resources","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o,n,i,a){"use strict";var s=function(e){return{id:"NewRevision",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"flow-line-add",fontIconFamily:1},label:a.get("NewRevision"),tooltip:a.get("NewRevision"),position:"far",category:"lifecycle",value:function(t){t.options=e,s.execute(t)},visibleFlag:!1},execute:function(){s.execute({options:e})},updateForSelection:function(o,n){return new t((function(t){o({visibleFlag:e.getSelectedNodes().length>=1}),t(!0)}))}}};return s.execute=function(t){if(t.options.getSelectedNodes().length>0){var o=t.options.getSelectedNodes();require(["DS/LifecycleCmd/ReviseCmd"],(function(n){new n({securitycontext:t.options.fetchSecurityContext(),context:{securitycontext:t.options.fetchSecurityContext(),getSecurityContext:function(){return{SecurityContext:this.securitycontext}},displayNotification:function(n){if("primary"==n.eventID)if(1==o.length){var i=t.options.getSelectedNodes()[0],s=t.options.getDocumentFromNodeModel(i),l=void 0;s&&null==(l=s.title||s.name)&&s.dataelements&&(l=s.dataelements.title||s.dataelements.name),t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:a.get("RevisionSuccessful"),subtitle:e.String.format(a.get("RevisionSuccessfulMsg"),l),message:"",sticky:!1,allowUnsafeHTML:!1}})}else o.length>1&&t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:a.get("RevisionSuccessful"),subtitle:a.get("MultipleRevisionSuccessfulMsg",{count:o.length}),message:"",sticky:!1,allowUnsafeHTML:!1}})},getUUID:function(){return t.options.getOrigin?JSON.stringify(e.extend(t.options.getOrigin(),{action:"new-revision"})):"docv2.new-revision."+Date.now()}}}).execute(o.map((function(e){var o=t.options.getDocumentFromNodeModel(e),n=void 0;o&&null==(n=o.title||o.name)&&o.dataelements&&(n=o.dataelements.title||o.dataelements.name);var i=void 0;return o.revision?i=o.revision:o.dataelements&&(i=o.dataelements.revision),{physicalid:o.id,displayName:n,revision:i,icon:o.dataelements.indexedTypeicon||o.dataelements.typeicon,type:o.type,typeDisplayName:o.dataelements.typeNLS,current:o.dataelements.state,currentDisplayName:o.dataelements.stateNLS}})))}))}},s})),define("DS/DocumentCommands/V2/Actions/UndoEdit",["UWA/Core","DS/WAFData/WAFData","DS/DocumentCommands/Helper","i18n!DS/DocumentCommands/assets/nls/DocumentCommands","css!DS/DocumentCommands/DocumentCommands.css"],(function(e,t,o,n){"use strict";var i=function(e){return{id:"UndoEdit",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"pencil-block",fontIconFamily:1},label:n.get("UndoEdit"),tooltip:n.get("UndoEdit"),position:"far",category:"edit",value:function(t){t.options=e,i.execute(t)},visibleFlag:!1},execute:function(){i.execute({options:e})},updateForSelection:function(t,n){return o.AuthoringCommandVisibiltyPromise(e,this.id,t)}}};return i.execute=async function(i){var a=i.options.getSelectedNodes()[0],s=i.options.getDocumentFromNodeModel(a);if(await o.checkModifyAccess(s.id,i)){var l=[];s.files?l=s.files:s.relateddata&&s.relateddata.files&&(l=s.relateddata.files);var c=void 0;s&&null==(c=s.title||s.name)&&s.dataelements&&(c=s.dataelements.title||s.dataelements.name),1==l.length?t.authenticatedRequest(i.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:i.options.platformUrls["3DSpace"],onComplete:function(r){var d={};d.tenant=i.options.platformUrls.platformId,d.securityContext=i.options.fetchSecurityContext()?encodeURIComponent(i.options.fetchSecurityContext()):void 0,d.tenantUrl=i.options.platformUrls["3DSpace"],d.onComplete=function(t){i.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:"",subtitle:e.String.format(n.get("Editoperationcancelled"),c),message:"",sticky:!1,allowUnsafeHTML:!1}}),i.options.events&&(i.options.events.publish({event:"docv2-undoedit-complete",data:{nodeModel:a}}),o.getFile(i.options,s.id,l[0].id).then((function(e){require(["DS/PlatformAPI/PlatformAPI"],(function(t){t.publish("docm-file-undoedited-in-document",{platformId:i.options.platformUrls.platformId,documentId:s.id,file:e})}))})))},d.onFailure=function(e,t){i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:t.error,message:"",sticky:!1,allowUnsafeHTML:!1}})};var u=d.tenantUrl+"/resources/v1/modeler/documents/"+s.id+"/unlock";d.type="json",d.url=u,d.data=JSON.stringify({csrf:JSON.parse(r).csrf}),d.headers=d.headers||{Accept:"*/*","Content-Type":"application/ds-json",SecurityContext:d.securityContext},d.method="POST",t.authenticatedRequest(u,d)}}):0==l.length?i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:n.get("objectcontainsnofile"),message:"",sticky:!1,allowUnsafeHTML:!1}}):i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:n.get("Nomultifilesupport"),message:"",sticky:!1,allowUnsafeHTML:!1}})}},i})),define("DS/DocumentCommands/V2/FileActions/Unlock",["UWA/Core","DS/DocumentCommands/V2/FileActions/UndoEdit","DS/WAFData/WAFData","DS/DocumentCommands/Helper","DS/DocumentCommonInfra/TrackerAPI","i18n!DS/DocumentCommands/assets/nls/DocumentCommands","css!DS/DocumentCommands/DocumentCommands.css"],(function(e,t,o,n,i,a){"use strict";var s=function(e){return{id:"Unlock",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"lock-open",fontIconFamily:1},label:a.get("Unlock"),tooltip:a.get("Unlock"),position:"far",category:"edit",value:function(t){t.options=e,s.execute(t)},visibleFlag:!1},execute:function(){s.execute({options:e})},updateForSelection:function(t,o){return n.AuthoringFilesCommandVisibiltyPromise(e,this.id,t)}}};return s.execute=async function(t){var s=t.options.getParentDocument(),l=t.options.getSelectedNodes();if(await n.checkModifyAccess(s,t))if(1==l.length){var c=new Date,r=l[0],d=t.options.getDocumentFromNodeModel(r),u=void 0;if(d)null==(u=d.title||d.name)&&d.dataelements&&(u=d.dataelements.title||d.dataelements.name),""!=d.dataelements.locker?o.authenticatedRequest(t.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:t.options.platformUrls["3DSpace"],onComplete:function(l){var m=new Date-c;i.sendTrackerPageEvent({category:"docm.command.unlock",action:"click",label:"Document Unlock",pd:{docType:d.type,docId:d.id,source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:m,success:1}});var p={};p.tenant=t.options.platformUrls.platformId,p.securityContext=t.options.fetchSecurityContext()?encodeURIComponent(t.options.fetchSecurityContext()):void 0,p.tenantUrl=t.options.platformUrls["3DSpace"],p.onComplete=function(o){t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:a.get("FileUnlocked"),subtitle:e.String.format(a.get("FileXUnlocked"),u),message:"",sticky:!1,allowUnsafeHTML:!1}}),t.options.events&&(t.options.events.publish({event:"enox-docfiles-unlock-complete",data:{nodeModel:r,fileId:d.id}}),n.getFile(t.options,s,d.id).then((function(e){require(["DS/PlatformAPI/PlatformAPI"],(function(o){o.publish("docm-file-unlocked-in-document",{platformId:t.options.platformUrls.platformId,documentId:s,file:e})}))})))},p.onFailure=function(e,o){t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:o.error,message:"",sticky:!1,allowUnsafeHTML:!1}})};var f=p.tenantUrl+"/resources/v1/modeler/documents/"+s+"/files/"+d.id+"/unlock";p.type="json",p.url=f,p.data=JSON.stringify({csrf:JSON.parse(l).csrf}),p.headers=p.headers||{Accept:"*/*","Content-Type":"application/ds-json",SecurityContext:p.securityContext},p.method="POST",o.authenticatedRequest(f,p)},onFailure:function(e,o){var n=new Date-c;i.sendTrackerPageEvent({category:"docm.command.unlock",action:"click",label:"Document Unlock",pd:{docType:d.type,docId:d.id,source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:n,failure:0}}),t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:o.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}}):t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:a.get("FileUnlocked"),subtitle:e.String.format(a.get("FileXAlreadyUnlocked"),u),message:"",sticky:!1,allowUnsafeHTML:!1}})}else l.forEach((l=>{var c=t.options.getDocumentFromNodeModel(l),r=void 0;if(c&&null==(r=c.title||c.name)&&c.dataelements&&(r=c.dataelements.title||c.dataelements.name),""!=c.dataelements.locker){var d={title:e.String.format(a.get("LOCKING_X"),r),ui:!1,process:function(){var u=new Date;o.authenticatedRequest(t.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:t.options.platformUrls["3DSpace"],onComplete:function(m){var p={};p.tenant=t.options.platformUrls.platformId,p.securityContext=t.options.fetchSecurityContext()?encodeURIComponent(t.options.fetchSecurityContext()):void 0,p.tenantUrl=t.options.platformUrls["3DSpace"],p.onComplete=function(o){var m=new Date-u;i.sendTrackerPageEvent({category:"docm.command.unlock",action:"click",label:"Document Unlock",pd:{docType:c.type,docId:c.id,source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:m,success:1}}),t.options.getJobsProcessorPromise.then((function(e){e.finishJob(d)})),t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:a.get("FileUnlocked"),subtitle:e.String.format(a.get("FileXUnlocked"),r),message:"",sticky:!1,allowUnsafeHTML:!1}}),t.options.events&&(t.options.events.publish({event:"enox-docfiles-unlock-complete",data:{nodeModel:l,fileId:c.id}}),n.getFile(t.options,s,c.id).then((function(e){require(["DS/PlatformAPI/PlatformAPI"],(function(o){o.publish("docm-file-unlocked-in-document",{platformId:t.options.platformUrls.platformId,documentId:s,file:e})}))})))},p.onFailure=function(e,o){var n=new Date-u;i.sendTrackerPageEvent({category:"docm.command.unlock",action:"click",label:"Document Unlock",pd:{docType:c.type,docId:c.id,source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:n,failure:0}}),t.options.getJobsProcessorPromise.then((function(e){e.finishJob(d,"failed")})),t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:o.error,message:"",sticky:!1,allowUnsafeHTML:!1}})};var f=p.tenantUrl+"/resources/v1/modeler/documents/"+s+"/files/"+c.id+"/unlock";p.type="json",p.url=f,p.data=JSON.stringify({csrf:JSON.parse(m).csrf}),p.headers=p.headers||{Accept:"*/*","Content-Type":"application/ds-json",SecurityContext:p.securityContext},p.method="POST",o.authenticatedRequest(f,p)},onFailure:function(e,o){var n=new Date-u;i.sendTrackerPageEvent({category:"docm.command.unlock",action:"click",label:"Document Unlock",pd:{docType:c.type,docId:c.id,source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:n,failure:0}}),t.options.getJobsProcessorPromise.then((function(e){e.finishJob(d,"failed")})),t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:o.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}})}};t.options.getJobsProcessorPromise.then((function(e){e.addJob(d)}))}else t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:a.get("FileUnlocked"),subtitle:e.String.format(a.get("FileXAlreadyUnlocked"),r),message:"",sticky:!1,allowUnsafeHTML:!1}})}))},s})),define("DS/DocumentCommands/V2/FileActions/Edit",["DS/DocumentCommands/V2/FileActions/LockAndDownload","DS/DocumentCommands/Helper","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o){"use strict";var n=function(e){return{id:"Edit",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"pencil",fontIconFamily:1},label:o.get("Edit"),tooltip:o.get("Edit"),position:"far",category:"edit",value:function(t){t.options=e,n.execute(t)},visibleFlag:!1},execute:function(){n.execute({options:e})},updateForSelection:function(o,n){return t.AuthoringFilesCommandVisibiltyPromise(e,this.id,o)}}};return n.execute=function(t){e.executeLockAndDownload(t)},n})),define("DS/DocumentCommands/V2/Actions/OfficeWebEdition",["DS/PlatformAPI/PlatformAPI","DS/DocumentManagement/DocumentManagement","DS/DocumentCommands/Helper","i18n!DS/DocumentCommands/assets/nls/DocumentCommands","i18n!DS/DocumentWebEdition/assets/nls/DocumentWebEdition"],(function(e,t,o,n,i){"use strict";var a=function(e){return{id:"OfficeWebEdition",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"pencil",fontIconFamily:1},label:n.get("OfficeWebEdition"),tooltip:n.get("OfficeWebEdition"),position:"far",category:"edit",value:function(t){t.options=e,a.execute(t)},visibleFlag:!1,priority:10},execute:function(){a.execute({options:e})},updateForSelection:function(t,n){if(!window.dscef){return o.AuthoringCommandVisibiltyPromise(e,this.id,t)}t({visibleFlag:!1})}}};return a.execute=async function(a){var s=a.options.getSelectedNodes()[0],l=a.options.getDocumentFromNodeModel(s);await o.checkModifyAccess(l.id,a)&&t.getDocuments([l.id],{files:[],tenant:a.options.platformUrls.platformId,securityContext:a.options.securityContext,tenantUrl:a.options.platformUrls["3DSpace"],onComplete:function(t){var c=this;if(t.success){if(!Array.isArray(t.data))return void console.error("no data received in DocumentManagement.getDocuments");if((l=t.data[0]).relateddata&&l.relateddata.files?c.files=l.relateddata.files:l.files&&(c.files=l.files),1==c.files.length){var r=c.files[0].dataelements.title||c.files[0].dataelements.name;let u=e.getUser().login;var d;if(""!=c.files[0].dataelements.locker&&c.files[0].dataelements.locker!=u){c.files[0].relateddata.lockerInfo&&c.files[0].relateddata.lockerInfo.length>0&&(d=c.files[0].relateddata.lockerInfo[0].dataelements.firstname+" "+c.files[0].relateddata.lockerInfo[0].dataelements.lastname);let m='<button type="button" value="request_to_unlock" class="btn btn-primary">'+n.get("RequestToUnlock")+'</button> <button type="button" value="cancel" class="btn btn-default">'+n.get("Cancel")+"</button>";o.showModalDialogIfWebSessionAvailable(d+" "+i.get("WebEditorConfirmMessageWithLock"),m,a,c.files[0].dataelements.locker,l.id,c.files[0].id,r,"document")}else{function p(e){require(["DS/DocumentWebEdition/OfficeWebEditorComponent"],(function(t){a.options.widget.officeWebEditorComponent=new t({title:a.options.getDocumentFromNodeModel(e).dataelements.title,icon:a.options.getDocumentFromNodeModel(e).typeicon||a.options.getDocumentFromNodeModel(e).dataelements.indexedTypeicon||a.options.getDocumentFromNodeModel(e).dataelements.typeicon,file:c.files[0],documentId:a.options.getDocumentFromNodeModel(e).id,platformUrls:a.options.platformUrls,modelEvents:a.options.events,tenant:a.options.platformUrls.platformId,securityContext:a.options.fetchSecurityContext(),nodeModel:e,actionInitiatedAt:"document"}),a.options.widget.officeWebEditorComponent.loaded=function(e){},a.options.widget.officeWebEditorComponent.elements.container.setStyles({background:"white",width:"100%",height:"100%"}),a.options.widget.officeWebEditorComponent.close=function(){a.options.widget.officeWebEditorComponent&&(a.options.widget.officeWebEditorComponent.destroy(),a.options.widget.officeWebEditorComponent=void 0)},a.options.widget.officeWebEditorComponent.inject(a.options.widget.body)}))}if(!a.options.getDocumentFromNodeModel(s))throw"e6wDocument cannot be loaded from nodeModel";p(s)}}}}})},a})),define("DS/DocumentCommands/V2/Actions/AddTo",["DS/DocumentCommands/V2/Actions/AddTo/Libraries","DS/DocumentCommands/V2/ConvertCmdToWebUX","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o,n){"use strict";return function(i){var a=new e(i);return{id:"AddTo",dataElements:{docV2Public:!0,typeRepresentation:"functionMenuIcon",icon:{iconName:"plus",fontIconFamily:1},label:n.get("AddTo"),tooltip:n.get("AddTo"),position:"far",category:"edit",value:{menu:t([a])},visibleFlag:!1},updateForSelection:function(e,t){return new o((function(t){e({visibleFlag:i.getSelectedNodes().length>=1}),t(!0)}))}}}})),define("DS/DocumentCommands/V2/Actions/Revise",["DS/DocumentCommands/V2/Actions/NewRevision","DS/DocumentCommands/V2/Actions/Revisions","DS/DocumentCommands/V2/Actions/NewBranch","DS/DocumentCommands/V2/ConvertCmdToWebUX","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o,n,i,a){"use strict";var s=function(l){var c=new e(l),r=new t(l),d=new o(l);return{id:"Revise",dataElements:{docV2Public:!0,typeRepresentation:"functionMenuIcon",icon:{iconName:"flow-branch-list",fontIconFamily:1},label:a.get("Revisions"),tooltip:a.get("Revisions"),position:"far",category:"lifecycle",value:{menu:n([r,c,d])},visibleFlag:!1},execute:function(){s.execute({options:l})},updateForSelection:function(e){var t=[];return t=l.getSelectedNodes().length>1?[c,d]:[r,c,d],new i((function(o){e({visibleFlag:l.getSelectedNodes().length>=1,grid:{data:{menu:n(t)}}}),o(!0)}))}}};return s})),define("DS/DocumentCommands/V2/FileActions/UploadFile",["UWA/Core","DS/UIKIT/Modal","DS/DocumentManagement/DocumentManagement","DS/DocumentCommands/Helper","DS/DocumentFiles/data/Model","DS/DocumentCommonInfra/TrackerAPI","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/DocumentCommonInfra/components/UploadFileDialog","DS/DocumentCommonInfra/Utils/GetWidgetConfiguration","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o,n,i,a,s,l,c,r){"use strict";var d=function(e){return{id:"UploadFile",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"upload",fontIconFamily:1},label:r.get("UploadFile"),tooltip:r.get("UploadFile"),position:"far",category:"edit",value:function(t){t.options=e,d.execute(t)},visibleFlag:!0},execute:function(t){d.execute({options:e,files:t})},updateForSelection:function(e,t){},filesProvider:function(e,t){d.filesProvider(e,t)}}};function u(){let t=s.get(),o=e.is(t)&&e.is(t.change.id)?t.change.id:null;return""!=o?{"DS-Change-Authoring-Context":"pid:"+o}:{}}function m(t){for(var n=0;n<t.files.length;n++){!function(n){var s={},l=t.options.getParentDocument();s.tenant=t.options.platformUrls.platformId,s.securityContext=t.options.fetchSecurityContext(),s.tenantUrl=t.options.platformUrls["3DSpace"],s.additionalHeaders=u(),s.additionalHeaders.SecurityContext=t.options.fetchSecurityContext()?encodeURIComponent(t.options.fetchSecurityContext()):void 0,s.onFailure=function(e){var o=new Date-m.fileUploadStart;a.sendTrackerPageEvent({category:"docm.file.upload.complete",action:"click",label:"File Upload Done",pd:{parentId:void 0,parentRelName:void 0,securityContext:s.securityContext,docType:n.type,fileType:i.getFileExtension(n.name),filesize:n.size},pv:{totalTimeTaken:o,failure:0}}),t.options.getJobsProcessorPromise.then((function(e){e.finishJob(m,"failed")}));var l="Document";if(e&&e.length>0&&e[0].updateMessage)t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:r.get("YouCannotUpdateX",{typeNLS:l}),subtitle:r.get("VerifyCredentials"),message:r.get("NotHaveRequiredAccessRole"),sticky:!1,allowUnsafeHTML:!1}});else if(e&&e.error)if((e.error.match(/\n/g)||[]).length>=2){for(var c=e.error.split("\n"),d=[],u=2;u<c.length;u++)d.push(c[u]);d=d.join("<br/>"),t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:c[0],subtitle:c[1],message:d,sticky:!1,allowUnsafeHTML:!0}})}else t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:r.get("YouCannotUpdateX",{typeNLS:l}),subtitle:e.error,message:"",sticky:!1,allowUnsafeHTML:!1}});else t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:r.get("YouCannotUpdateX",{typeNLS:l}),subtitle:e,message:"",sticky:!1,allowUnsafeHTML:!1}});console.error("Document Update Failed Due to:"),console.error(e)},s.onProgress=function(e){m.update(e)},s.onComplete=function(o){var c=new Date-m.fileUploadStart;a.sendTrackerPageEvent({category:"docm.file.upload.complete",action:"click",label:"File Upload Done",pd:{parentId:void 0,parentRelName:void 0,securityContext:s.securityContext,docType:n.type,fileType:i.getFileExtension(n.name),filesize:n.size},pv:{totalTimeTaken:c,success:1}}),t.options.getJobsProcessorPromise.then((function(e){e.finishJob(m)})),t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:r.get("Fileuploadsuccessful"),subtitle:e.String.format(r.get("FileuploadsuccessfulMsg"),""),message:"",sticky:!1,allowUnsafeHTML:!1}}),t.options.events.publish({event:"enox-docfiles-upload-complete",data:{parentId:l,files:o.data[0].relateddata.files,token:t.options.token?t.options.token:void 0,source:t.options.source?t.options.source:void 0}}),require(["DS/PlatformAPI/PlatformAPI"],(function(e){e.publish("docm-file-added-to-document",{platformId:t.options.platformUrls.platformId,documentId:l,newFiles:o.data[0].relateddata.files,token:t.options.token?t.options.token:void 0,source:t.options.source?t.options.source:void 0})}))};var c={comments:n.comment?n.comment:"",file:n};n.name&&(c.fileName=n.name,c.newFile=!0);var d={id:l,fileInfo:c},m={title:r.get("UPLOADING_X",{title:n.name}),ui:!!d.fileInfo,process:function(){m.fileUploadStart=new Date,m.xhr=o.modifyDocument(d,s)}};t.options.getJobsProcessorPromise.then((function(e){e.addJob(m)}))}(t.files[n])}}return d.execute=async function(e){var t=e.options.getParentDocument();await n.checkModifyAccess(t,e)&&d.selectFiles(e)},d.filesProvider=function(t,o){var n=e.createElement("input",{attributes:{id:"btnUpload_chooser",type:"file",multiple:!1},styles:{display:"none"},events:{change:function(e){o(e),n.destroy()}}}).inject(t);window.preventFilePickerClicks?console.error("window.preventFilePickerClicks = true"):n.click()},d.selectFiles=function(e){null==e.files?d.filesProvider(e.options.widget.body,(t=>{(t.target&&t.target.files&&t.target.files.length>0||t.dataTransfer&&t.dataTransfer.files)&&(e.files=t.target&&t.target.files&&t.target.files.length>0?t.target.files:t.dataTransfer.files,0==e.files&&(e.files=t.detail.files),d.uploadFilesDialog(e))})):e.options&&"PLMNewFilesTab"==e.options.source?m(e):d.uploadFilesDialog(e)},d.uploadFilesDialog=async function(t){var o=this;o.uploadFileDialog&&o.uploadFileDialog.myDialog&&(o.uploadFileDialog.immersiveFrame&&o.uploadFileDialog.immersiveFrame.destroy(),o.uploadFileDialog.myDialog.destroy(),o.uploadFileDialog.myDialog=void 0);var n={securityContext:t.options.fetchSecurityContext(),platformUrls:t.options.platformUrls},i=await c.getcommentAsMandtoryConfigValue(n).promise;t.options.mandatoryCommentConfigSetting=i;var a={events:t.options.events,dialogCustomizations:{},mandatoryCommentValueConfiguartionSetting:t.options.mandatoryCommentConfigSetting,platformUrls:e.clone(t.options.platformUrls,!0),files:t.files,getSelectedNodes:t.options.getSelectedNodes(),onUploadFile:function(e){t.files.length<=1?(e.context.myForm.getModelItem("file").value.comment=e.context.myForm.getModelItem("comments").value,t.files=[e.context.myForm.getModelItem("file").value]):t.files=e.context.dataGridView.treeDocument.getAllDescendants().map((e=>{var t=e.options.data.file;return t.comment=e.options.grid.comments,t})),m(t)}};o.uploadFileDialog=new l(a)},d})),define("DS/DocumentCommands/V2/FileActions/FileIterations",["UWA/Core","UWA/Promise","DS/DocumentManagement/DocumentManagement","DS/WAFData/WAFData","DS/DocumentCommands/Resources","DS/DocumentCommonInfra/Utils/GetWidgetConfiguration","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o,n,i,a,s){"use strict";var l=function(e){return{id:"FileIterations",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"database-history wux-ui-3ds",fontIconFamily:1},label:s.get("FileIterations"),tooltip:s.get("FileIterations"),position:"far",category:"lifecycle",value:function(t){t.options=e,l.execute(t)},visibleFlag:!1},execute:function(){l.execute({options:e})},updateForSelection:function(o,n){return new t((function(t){o({visibleFlag:1==e.getSelectedNodes().length}),t(!0)}))}}};return l.execute=async function(t){var o={securityContext:t.options.fetchSecurityContext(),platformUrls:t.options.platformUrls},n=!1;"Enabled"==await a.getcommentAsMandtoryConfigValue(o).promise&&(n=!0),require(["DS/LifecycleCmd/IterationsCmd"],(function(o){if(1==t.options.getSelectedNodes().length)var i={securitycontext:t.options.fetchSecurityContext(),context:{getUUID:function(){return t.options.getOrigin?JSON.stringify(e.extend(t.options.getOrigin(),{action:"new-fileiteration"})):"docv2.new-fileiteration."+Date.now()}},mandatoryComment:n};o=new o(i);var a=[{physicalid:t.options.getSelectedNodes()[0].options.data.id,tenant:t.options.platformUrls.platformId,type:t.options.getSelectedNodes()[0].options.data.type,displayName:t.options.getSelectedNodes()[0].options.title}];o.execute(a)}))},l})),define("DS/DocumentCommands/V2/FileActions/Lock",["UWA/Core","DS/WAFData/WAFData","DS/DocumentCommands/Helper","DS/DocumentCommonInfra/TrackerAPI","i18n!DS/DocumentCommands/assets/nls/DocumentCommands","i18n!DS/DocumentWebEdition/assets/nls/DocumentWebEdition","css!DS/DocumentCommands/DocumentCommands.css"],(function(e,t,o,n,i,a){"use strict";var s=function(e){return{id:"Lock",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"lock",fontIconFamily:1},label:i.get("Lock"),tooltip:i.get("Lock"),position:"far",category:"edit",value:function(t){t.options=e,s.execute(t)},visibleFlag:!1},execute:function(){s.execute({options:e})},updateForSelection:function(t,n){return o.AuthoringFilesCommandVisibiltyPromise(e,this.id,t)}}};return s.execute=async function(t){var n=t.options.getParentDocument(),l=t.options.platformUrls.platformId,c=t.options.getSelectedNodes();if(await o.checkModifyAccess(n,t))if(1==c.length){var r=c[0],d=t.options.getDocumentFromNodeModel(r),u=void 0;if(d)if(null==(u=d.title||d.name)&&d.dataelements&&(u=d.dataelements.title||d.dataelements.name),""!=d.dataelements.locker)t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:i.get("FileLocked"),subtitle:e.String.format(i.get("FileXAlreadyLocked"),u),message:"",sticky:!1,allowUnsafeHTML:!1}});else if("OnPremise"!=l)o.ConfirmWebEditorSessionActiveFromService(t.options,n,d.id,u).then((e=>{if("true"==e.dataelements.WEB_EDITOR_SESSION_ACTIVE){let e='<button type="button" value="edit_online" class="btn btn-primary">'+i.get("EditOnline")+'</button> <button type="button" value="cancel" class="btn btn-default">'+i.get("Cancel")+"</button>";o.showModalDialogIfWebSessionAvailable(a.get("WebEditorConfirmMessageWithNoLock"),e,t,"","","",u,"file")}else s.executeSingleLock(t,d,n,u,r)})).catch((e=>{console.error("Error in webEditionPromise in File->Lock action"),s.executeSingleLock(t,d,n,u,r)}));else s.executeSingleLock(t,d,n,u,r)}else c.forEach((c=>{var r=t.options.getDocumentFromNodeModel(c),d=void 0;if(r&&null==(d=r.title||r.name)&&r.dataelements&&(d=r.dataelements.title||r.dataelements.name),""!=r.dataelements.locker)t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:i.get("FileLocked"),subtitle:e.String.format(i.get("FileXAlreadyLocked"),d),message:"",sticky:!1,allowUnsafeHTML:!1}});else{var u={title:e.String.format(i.get("LOCKING_X"),d),ui:!1,process:function(){"OnPremise"!=l?o.ConfirmWebEditorSessionActiveFromService(t.options,n,r.id,d).then((e=>{if("true"==e.dataelements.WEB_EDITOR_SESSION_ACTIVE){c.toOpenInWebEdit=!0,t.options.getJobsProcessorPromise.then((function(e){e.finishJob(u)}));let e='<button type="button" value="edit_online" class="btn btn-primary">'+i.get("EditOnline")+'</button> <button type="button" value="cancel" class="btn btn-default">'+i.get("Cancel")+"</button>";o.showModalDialogIfWebSessionAvailable(a.get("WebEditorConfirmMessageWithNoLock"),e,t,"","","",d,"file")}else s.executeMultipleLock(t,r,n,d,c,u)})).catch((e=>{console.error("Error in state promise in File->Lock action in multiselection flow"),s.executeMultipleLock(t,r,n,d,c,u)})):s.executeMultipleLock(t,r,n,d,c,u)}};t.options.getJobsProcessorPromise.then((function(e){e.addJob(u)}))}}))},s.executeSingleLock=function(a,s,l,c,r){var d=new Date;t.authenticatedRequest(a.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:a.options.platformUrls["3DSpace"],onComplete:function(u){var m=new Date-d;n.sendTrackerPageEvent({category:"docm.command.lock",action:"click",label:"Document lock",pd:{docType:s.type,docId:s.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:m,success:1}});var p={};p.tenant=a.options.platformUrls.platformId,p.securityContext=a.options.fetchSecurityContext()?encodeURIComponent(a.options.fetchSecurityContext()):void 0,p.tenantUrl=a.options.platformUrls["3DSpace"],p.onComplete=function(t){a.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:i.get("FileLocked"),subtitle:e.String.format(i.get("FileXLocked"),c),message:"",sticky:!1,allowUnsafeHTML:!1}}),a.options.events&&(a.options.events.publish({event:"enox-docfiles-lock-complete",data:{nodeModel:r,fileId:s.id}}),o.getFile(a.options,l,s.id).then((function(e){require(["DS/PlatformAPI/PlatformAPI"],(function(t){t.publish("docm-file-locked-in-document",{platformId:a.options.platformUrls.platformId,documentId:l,file:e})}))})))},p.onFailure=function(t,n){o.fetchCurrentUser().then((t=>{n&&e.is(n.internalError,"string")&&n.internalError.includes("Business object locked by '"+t.id+"'")?a.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:i.get("FileLocked"),subtitle:e.String.format(i.get("FileXAlreadyLocked"),c),message:"",sticky:!1,allowUnsafeHTML:!1}}):a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:n.error,message:"",sticky:!1,allowUnsafeHTML:!1}})})).catch((e=>{a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:n.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}))};var f=p.tenantUrl+"/resources/v1/modeler/documents/"+l+"/files/"+s.id+"/lock";p.type="json",p.url=f,p.data=JSON.stringify({csrf:JSON.parse(u).csrf}),p.headers=p.headers||{Accept:"*/*","Content-Type":"application/ds-json",SecurityContext:p.securityContext},p.method="POST",t.authenticatedRequest(f,p)},onFailure:function(e,t){var o=new Date-d;n.sendTrackerPageEvent({category:"docm.command.lock",action:"click",label:"Document lock",pd:{docType:s.type,docId:s.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:o,failure:0}}),a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:t.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}})},s.executeMultipleLock=function(a,s,l,c,r,d){var u=new Date;t.authenticatedRequest(a.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:a.options.platformUrls["3DSpace"],onComplete:function(m){var p={};p.tenant=a.options.platformUrls.platformId,p.securityContext=a.options.fetchSecurityContext()?encodeURIComponent(a.options.fetchSecurityContext()):void 0,p.tenantUrl=a.options.platformUrls["3DSpace"],p.onComplete=function(t){var m=new Date-u;n.sendTrackerPageEvent({category:"docm.command.lock",action:"click",label:"Document lock",pd:{docType:s.type,docId:s.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:m,success:1}}),a.options.getJobsProcessorPromise.then((function(e){e.finishJob(d)})),a.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:i.get("FileLocked"),subtitle:e.String.format(i.get("FileXLocked"),c),message:"",sticky:!1,allowUnsafeHTML:!1}}),a.options.events&&(a.options.events.publish({event:"enox-docfiles-lock-complete",data:{nodeModel:r,fileId:s.id}}),o.getFile(a.options,l,s.id).then((function(e){require(["DS/PlatformAPI/PlatformAPI"],(function(t){t.publish("docm-file-locked-in-document",{platformId:a.options.platformUrls.platformId,documentId:l,file:e})}))})))},p.onFailure=function(t,l){var r=new Date-u;n.sendTrackerPageEvent({category:"docm.command.lock",action:"click",label:"Document lock",pd:{docType:s.type,docId:s.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:r,failure:0}}),a.options.getJobsProcessorPromise.then((function(e){e.finishJob(d,"failed")})),o.fetchCurrentUser().then((t=>{l&&e.is(l.internalError,"string")&&l.internalError.includes("Business object locked by '"+t.id+"'")?a.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:i.get("FileLocked"),subtitle:e.String.format(i.get("FileXAlreadyLocked"),c),message:"",sticky:!1,allowUnsafeHTML:!1}}):a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:l.error,message:"",sticky:!1,allowUnsafeHTML:!1}})})).catch((e=>{a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:l.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}))};var f=p.tenantUrl+"/resources/v1/modeler/documents/"+l+"/files/"+s.id+"/lock";p.type="json",p.url=f,p.data=JSON.stringify({csrf:JSON.parse(m).csrf}),p.headers=p.headers||{Accept:"*/*","Content-Type":"application/ds-json",SecurityContext:p.securityContext},p.method="POST",t.authenticatedRequest(f,p)},onFailure:function(e,t){a.options.getJobsProcessorPromise.then((function(e){e.finishJob(d,"failed")})),a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:t.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}})},s})),define("DS/DocumentCommands/V2/FileActions/Update",["DS/DocumentCommands/Helper","DS/DocumentCommands/V2/FileActions/UpdateAndUnlock","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o){"use strict";var n=function(t){return{id:"Update",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"update",fontIconFamily:1},label:o.get("Update"),tooltip:o.get("Update"),position:"far",category:"edit",value:function(e){e.options=t,n.execute(e)},visibleFlag:!1},execute:function(){n.execute({options:t})},updateForSelection:function(o,n){return e.AuthoringFilesCommandVisibiltyPromise(t,this.id,o)}}};return n.execute=function(e){t.executeUpdate(e)},n})),define("DS/DocumentCommands/V2/Actions/UploadFile",["UWA/Core","DS/DocumentManagement/DocumentManagement","DS/DocumentCommands/Helper","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/DocumentCommonInfra/components/UploadFileDialog","DS/DocumentCommonInfra/Utils/GetWidgetConfiguration","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o,n,i,a,s){"use strict";var l=function(e){return{id:"UploadFile",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"upload",fontIconFamily:1},label:s.get("UploadFile"),tooltip:s.get("UploadFile"),position:"far",category:"edit",value:function(t){t.options=e,l.execute(t)},visibleFlag:!0},execute:function(){l.execute({options:e})},updateForSelection:function(t,n){return o.AuthoringCommandVisibiltyPromise(e,this.id,t)}}};function c(o,i){var a={},l=i.options.getSelectedNodes()[0],c=i.options.getDocumentFromNodeModel(l).id;a.tenant=i.options.platformUrls.platformId,a.securityContext=i.options.fetchSecurityContext(),a.additionalHeaders=function(){let t=n.get(),o=e.is(t)&&e.is(t.change.id)?t.change.id:null;return""!=o?{"DS-Change-Authoring-Context":"pid:"+o}:{}}(),a.additionalHeaders.SecurityContext=i.options.fetchSecurityContext()?encodeURIComponent(i.options.fetchSecurityContext()):void 0,a.tenantUrl=i.options.platformUrls["3DSpace"],a.onFailure=function(e){i.options.getJobsProcessorPromise.then((function(e){e.finishJob(u,"failed")}));var t="Document";if(e&&e.length>0&&e[0].updateMessage)i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:s.get("YouCannotUpdateX",{typeNLS:t}),subtitle:s.get("VerifyCredentials"),message:s.get("NotHaveRequiredAccessRole"),sticky:!1,allowUnsafeHTML:!1}});else if(e&&e.error)if((e.error.match(/\n/g)||[]).length>=2){for(var o=e.error.split("\n"),n=[],a=2;a<o.length;a++)n.push(o[a]);n=n.join("<br/>"),i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:o[0],subtitle:o[1],message:n,sticky:!1,allowUnsafeHTML:!0}})}else i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:s.get("YouCannotUpdateX",{typeNLS:t}),subtitle:e.error,message:"",sticky:!1,allowUnsafeHTML:!1}});else i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:s.get("YouCannotUpdateX",{typeNLS:t}),subtitle:e,message:"",sticky:!1,allowUnsafeHTML:!1}});console.error("Document Update Failed Due to:"),console.error(e)},a.onProgress=function(e){u.update(e)},a.onComplete=function(t){i.options.getJobsProcessorPromise.then((function(e){e.finishJob(u)})),i.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:s.get("Fileuploadsuccessful"),subtitle:e.String.format(s.get("FileuploadsuccessfulMsg"),""),message:"",sticky:!1,allowUnsafeHTML:!1}}),i.options.events.publish({event:"docv2-uploadfile-complete",data:{nodeModel:l,files:t.data[0].relateddata.files}}),require(["DS/PlatformAPI/PlatformAPI"],(function(e){e.publish("docm-file-added-to-document",{platformId:i.options.platformUrls.platformId,documentId:c,newFiles:t.data[0].relateddata.files})}))};var r={comments:o.comment?o.comment:"",file:o};o.name&&(r.fileName=o.name,r.newFile=!0);var d={id:c,fileInfo:r},u={title:s.get("UPLOADING_X",{title:o.name}),ui:!!d.fileInfo,process:function(){u.xhr=t.modifyDocument(d,a)}};i.options.getJobsProcessorPromise.then((function(e){e.addJob(u)}))}return l.execute=function(e){l.updateandUnlockFile(e)},l.executeUpdate=function(t){var o=e.createElement("input",{attributes:{id:"btnUpload_chooser",type:"file",multiple:!1},styles:{display:"none"},events:{change:function(e){if(e.target&&e.target.files&&e.target.files.length>0||e.dataTransfer&&e.dataTransfer.files){var n=e.target&&e.target.files&&e.target.files.length>0?e.target.files:e.dataTransfer.files;0==n.length&&(n=e.detail.files),l.uploadFilesDialog(t,n)}o.destroy()}}}).inject(t.options.widget.body);o.click()},l.updateandUnlockFile=function(e){l.executeUpdate(e)},l.uploadFilesDialog=async function(t,o){var n=this;n.uploadFileDialog&&n.uploadFileDialog.myDialog&&(n.uploadFileDialog.immersiveFrame&&n.uploadFileDialog.immersiveFrame.destroy(),n.uploadFileDialog.myDialog.destroy(),n.uploadFileDialog.myDialog=void 0);var s={securityContext:t.options.fetchSecurityContext(),platformUrls:t.options.platformUrls},l=await a.getcommentAsMandtoryConfigValue(s).promise;t.options.mandatoryCommentConfigSetting=l;var r={events:t.options.events,dialogCustomizations:{},mandatoryCommentValueConfiguartionSetting:t.options.mandatoryCommentConfigSetting,platformUrls:e.clone(t.options.platformUrls,!0),files:o,getSelectedNodes:t.options.getSelectedNodes(),onUploadFile:function(e){o.length<=1?(e.context.myForm.getModelItem("file").value.comment=e.context.myForm.getModelItem("comments").value,t.files=[e.context.myForm.getModelItem("file").value]):t.files=e.context.dataGridView.treeDocument.getAllDescendants().map((e=>{var t=e.options.data.file;return t.comment=e.options.grid.comments,t}));for(var n=0;n<t.files.length;n++)c(t.files[n],t)}};n.uploadFileDialog=new i(r)},l})),define("DS/DocumentCommands/V2/Actions/Update",["DS/DocumentCommands/Helper","DS/DocumentCommands/V2/Actions/UpdateAndUnlock","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o){"use strict";var n=function(t){return{id:"Update",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"update",fontIconFamily:1},label:o.get("Update"),tooltip:o.get("Update"),position:"far",category:"edit",value:function(e){e.options=t,n.execute(e)},visibleFlag:!1},execute:function(){n.execute({options:t})},updateForSelection:function(o,n){return e.AuthoringCommandVisibiltyPromise(t,this.id,o)}}};return n.execute=function(e){t.executeUpdate(e)},n})),define("DS/DocumentCommands/V2/Actions/Edit",["DS/DocumentCommands/V2/Actions/LockAndDownload","DS/DocumentCommands/Helper","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o){"use strict";var n=function(e){return{id:"Edit",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"pencil",fontIconFamily:1},label:o.get("Edit"),tooltip:o.get("Edit"),position:"far",category:"edit",value:function(t){t.options=e,n.execute(t)},visibleFlag:!1},execute:function(){n.execute({options:e})},updateForSelection:function(o,n){return t.AuthoringCommandVisibiltyPromise(e,this.id,o)}}};return n.execute=function(t){e.executeLockAndDownload(t)},n})),define("DS/DocumentCommands/V2/FileActions/OfficeWebEdition",["DS/PlatformAPI/PlatformAPI","DS/DocumentCommands/Helper","i18n!DS/DocumentCommands/assets/nls/DocumentCommands","i18n!DS/DocumentWebEdition/assets/nls/DocumentWebEdition"],(function(e,t,o,n){"use strict";var i=function(e){return{id:"OfficeWebEdition",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"pencil",fontIconFamily:1},label:o.get("OfficeWebEdition"),tooltip:o.get("OfficeWebEdition"),position:"far",category:"edit",value:function(t){t.options=e,i.execute(t)},visibleFlag:!1,priority:10},execute:function(){i.execute({options:e})},updateForSelection:function(o,n){if(!window.dscef){return t.AuthoringFilesCommandVisibiltyPromise(e,this.id,o)}o({visibleFlag:!1})}}};return i.execute=async function(i){var a=void 0;i.options.getSelectedNodes().length>1?(i.options.getSelectedNodes().map((function(e){null!=e.toOpenInWebEdit&&1==e.toOpenInWebEdit&&((a=e).toOpenInWebEdit=void 0)})),null==a&&(a=i.options.getSelectedNodes()[0])):a=i.options.getSelectedNodes()[0];var s=i.options.getDocumentFromNodeModel(a);let l=e.getUser().login;var c,r=i.options.getParentDocument();if(await t.checkModifyAccess(e6wDocument.id,i)){var d=s.dataelements.title||s.dataelements.name;if(""!=s.dataelements.locker&&s.dataelements.locker!=l){s.relateddata.lockerInfo&&s.relateddata.lockerInfo.length>0&&(c=s.relateddata.lockerInfo[0].dataelements.firstname+" "+s.relateddata.lockerInfo[0].dataelements.lastname);let u='<button type="button" value="request_to_unlock" class="btn btn-primary">'+o.get("RequestToUnlock")+'</button> <button type="button" value="cancel" class="btn btn-default">'+o.get("Cancel")+"</button>";t.showModalDialogIfWebSessionAvailable(c+" "+n.get("WebEditorConfirmMessageWithLock"),u,i,s.dataelements.locker,r,s.id,d,"file")}else{function m(e){require(["DS/DocumentWebEdition/OfficeWebEditorComponent"],(function(t){i.options.widget.officeWebEditorComponent=new t({file:i.options.getDocumentFromNodeModel(e),title:i.options.getDocumentFromNodeModel(e).dataelements.title,icon:e.options.icons[0],documentId:r,platformUrls:i.options.platformUrls,modelEvents:i.options.events,tenant:i.options.platformUrls.platformId,securityContext:i.options.fetchSecurityContext(),nodeModel:e,actionInitiatedAt:"file"}),i.options.widget.officeWebEditorComponent.loaded=function(e){},i.options.widget.officeWebEditorComponent.elements.container.setStyles({background:"white",width:"100%",height:"100%"}),i.options.widget.officeWebEditorComponent.close=function(){i.options.widget.officeWebEditorComponent&&(i.options.widget.officeWebEditorComponent.destroy(),i.options.widget.officeWebEditorComponent=void 0)},i.options.widget.officeWebEditorComponent.inject(i.options.widget.body)}))}if(!i.options.getDocumentFromNodeModel(a))throw"e6wDocument cannot be loaded from nodeModel";m(a)}}},i})),define("DS/DocumentCommands/DocumentFileCommandsV2",["UWA/Core","UWA/Promise","DS/DocumentCommands/V2/FileActions/Preview","DS/DocumentCommands/V2/FileActions/Edit","DS/DocumentCommands/V2/FileActions/LockAndDownload","DS/DocumentCommands/V2/FileActions/Lock","DS/DocumentCommands/V2/FileActions/UndoEdit","DS/DocumentCommands/V2/FileActions/Unlock","DS/DocumentCommands/V2/FileActions/FileIterations","DS/DocumentCommands/V2/FileActions/CopyLink","DS/DocumentCommands/V2/FileActions/Download","DS/DocumentCommands/V2/FileActions/Update","DS/DocumentCommands/V2/FileActions/UpdateAndUnlock","DS/DocumentCommands/V2/FileActions/UploadFile","DS/DocumentCommands/V2/FileActions/Delete","DS/DocumentCommands/V2/FileActions/OfficeWebEdition","DS/DocumentCommands/V2/ConvertCmdToWebUX"],(function(e,t,o,n,i,a,s,l,c,r,d,u,m,p,f,g,v){"use strict";return e.Class.extend({init:function(t){t.widget=null==t.widget?window.widget:t.widget,t.getSourceForUsageAnalytics=t.getSourceForUsageAnalytics||function(e){t.uaSource||(t.uaSource="unknown");var o=t.uaSource;return e&&(o=o+"."+e),t.isFromContextMenu?o+=" Contextual Menu":o+=" Tool bar",o},t.getJobsProcessorPromise=t.getJobsProcessorPromise||new e.Promise((function(e,o){var n={};t.widget&&t.widget.app&&t.widget.app.jobs&&"doco-jobs"==t.widget.app.jobs.name&&t.widget.app.progressPane&&"doco-progress"==t.widget.app.progressPane.name?(n=t.widget.app,e(n.jobs)):(console.warn("DocumentFileCommandsV2 had to initialize jobs and progressPane"),require(["DS/DocumentCommands/Jobs","DS/DocumentCommands/ProgressPane"],(function(o,i){null==n.jobs&&(n.jobs=new o(n)),null==n.progressPane&&(n.progressPane=new i(n),t.widget&&t.widget.body?n.progressPane.inject(t.widget.body):n.progressPane.inject(document.body)),e(n.jobs)})))})),this._parent(t),this.commands={Preview:new o(t),Edit:new n(t),LockAndDownload:new i(t),Lock:new a(t),UndoEdit:new s(t),Unlock:new l(t),Download:new d(t),FileIterations:new c(t),CopyLink:new r(t),Update:new u(t),UpdateAndUnlock:new m(t),UploadFile:new p(t),Delete:new f(t),OfficeWebEdition:new g(t)}},commands:[],connectToWebUXToolbar:function(e){e.items.getRoots().forEach((e=>{e.options.docV2Public&&e.options.extend&&e.options.extend(e)}))},selectionChangedForWebUXToolbar:function(e){e.items.getRoots().forEach((e=>{e.options.docV2Public&&(e.options.grid.action=e,e.options.updateForSelection&&e.options.updateForSelection((function(t){e.updateOptions(t)})))}))},getWebUXContextMenuItemsForCurrentSelection:function(o,n){return new e.Promise((function(i,a){var s=[],l=o[0].dataElements.category,c=[!0];o.forEach((t=>{if(t.updateForSelection){var o=t.updateForSelection((function(o){t.dataElements=e.extend(t.dataElements,o,!0)}));c.push(o)}else c.push(!0)})),t.all(c).then((function(e){o.forEach((e=>{e.dataElements.visibleFlag&&(n&&l!=e.dataElements.category&&s.push({type:"SeparatorItem"}),s.push(v([e])[0]),l=e.dataElements.category)})),i(s)}))}))},getUIKitItemsForCurrentSelection:function(o,n){var i=[!0],a=o[0].dataElements.category,s=[];return new e.Promise((function(l,c){o.forEach((t=>{if(t.updateForSelection){var o=t.updateForSelection((function(o){t.dataElements=e.extend(t.dataElements,o,!0)}));i.push(o)}else i.push(!0)})),t.all(i).then((function(){o.forEach((e=>{e.dataElements.visibleFlag&&(n&&a!=e.dataElements.category&&s.push({className:"divider"}),s.push({rawItem:e,title:e.dataElements.label,name:e.id,text:e.dataElements.label,fonticon:e.dataElements.icon.iconName,handler:e.execute||function(e,t,o){console.error("This command doesnt have value")},category:e.dataElements.category}),a=e.dataElements.category)})),l(s)}))}))}})})),define("DS/DocumentCommands/V2/Actions/Subscription",["DS/DocumentCommands/V2/Actions/Subscription/Subscribe","DS/DocumentCommands/V2/Actions/Subscription/UnSubscribe","DS/DocumentCommands/V2/Actions/Subscription/EditSubscriptions","DS/DocumentCommands/V2/Actions/Subscription/MySubscriptions","DS/DocumentCommands/V2/Actions/Subscription/EditSubscriptionForOthers","DS/DocumentCommands/V2/Actions/Subscription/SubscriptionForOthers","DS/DocumentCommands/V2/ConvertCmdToWebUX","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,o,n,i,a,s,l,c){"use strict";return function(r){var d=new e(r),u=new t(r),m=new o(r),p=new n(r),f=new a(r),g=new i(r);return{id:"Subscription",dataElements:{docV2Public:!0,typeRepresentation:"functionMenuIcon",icon:{iconName:"bell-list",fontIconFamily:1},label:c.get("Subscriptions"),tooltip:c.get("Subscriptions"),position:"far",category:"information",value:{menu:s([d,u,m,p,f,g])},visibleFlag:!1},updateForSelection:function(e,t){return new l((function(t){e({visibleFlag:r.getSelectedNodes().length>=1}),t(!0)}))}}}})),define("DS/DocumentCommands/V2/Actions/Lock",["UWA/Core","DS/WAFData/WAFData","DS/DocumentCommands/Helper","DS/DocumentCommonInfra/TrackerAPI","i18n!DS/DocumentCommands/assets/nls/DocumentCommands","css!DS/DocumentCommands/DocumentCommands.css"],(function(e,t,o,n,i){"use strict";var a=function(e){return{id:"Lock",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"lock",fontIconFamily:1},label:i.get("Lock"),tooltip:i.get("Lock"),position:"far",category:"edit",value:function(t){t.options=e,a.execute(t)},visibleFlag:!1},execute:function(){a.execute({options:e})},updateForSelection:function(t,n){return o.AuthoringCommandVisibiltyPromise(e,this.id,t)}}};return a.execute=function(a){var s=a.options.getSelectedNodes();if(1==s.length){var l=new Date,c=s[0],r=a.options.getDocumentFromNodeModel(c),d=[];r.files?d=r.files:r.relateddata&&r.relateddata.files&&(d=r.relateddata.files);var u=void 0;if(r&&null==(u=r.title||r.name)&&r.dataelements&&(u=r.dataelements.title||r.dataelements.name),1==d.length)""!=d[0].dataelements.locker?a.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:i.get("DocumentLocked"),subtitle:e.String.format(i.get("FileInXAlreadyLocked"),u),message:"",sticky:!1,allowUnsafeHTML:!1}}):t.authenticatedRequest(a.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:a.options.platformUrls["3DSpace"],onComplete:function(s){var m=new Date-l;n.sendTrackerPageEvent({category:"docm.command.lock",action:"click",label:"Document lock",pd:{docType:r.type,docId:r.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:m,success:1}});var p={};p.tenant=a.options.platformUrls.platformId,p.securityContext=a.options.fetchSecurityContext()?encodeURIComponent(a.options.fetchSecurityContext()):void 0,p.tenantUrl=a.options.platformUrls["3DSpace"],p.onComplete=function(t){a.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:i.get("DocumentLocked"),subtitle:e.String.format(i.get("FileInXLocked"),u),message:"",sticky:!1,allowUnsafeHTML:!1}}),a.options.events&&(a.options.events.publish({event:"docv2-lock-complete",data:{nodeModel:c}}),o.getFile(a.options,r.id,d[0].id).then((function(e){require(["DS/PlatformAPI/PlatformAPI"],(function(t){t.publish("docm-file-locked-in-document",{platformId:a.options.platformUrls.platformId,documentId:r.id,file:e})}))})))},p.onFailure=function(t,n){o.fetchCurrentUser().then((t=>{n&&e.is(n.internalError,"string")&&n.internalError.includes("Business object locked by '"+t.id+"'")?a.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:i.get("DocumentLocked"),subtitle:e.String.format(i.get("FileInXAlreadyLocked"),u),message:"",sticky:!1,allowUnsafeHTML:!1}}):a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:n.error,message:"",sticky:!1,allowUnsafeHTML:!1}})})).catch((e=>{a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:n.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}))};var f=p.tenantUrl+"/resources/v1/modeler/documents/"+r.id+"/lock";p.type="json",p.url=f,p.data=JSON.stringify({csrf:JSON.parse(s).csrf}),p.headers=p.headers||{Accept:"*/*","Content-Type":"application/ds-json",SecurityContext:p.securityContext},p.method="POST",t.authenticatedRequest(f,p)},onFailure:function(e,t){var o=new Date-l;n.sendTrackerPageEvent({category:"docm.command.lock",action:"click",label:"Document lock",pd:{docType:r.type,docId:r.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:o,failure:0}}),a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:t.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}})}else s.forEach((s=>{var l=a.options.getDocumentFromNodeModel(s),c=[];l.files?c=l.files:l.relateddata&&l.relateddata.files&&(c=l.relateddata.files);var r=void 0;if(l&&null==(r=l.title||l.name)&&l.dataelements&&(r=l.dataelements.title||l.dataelements.name),1==c.length)if(""!=c[0].dataelements.locker)a.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:i.get("DocumentLocked"),subtitle:e.String.format(i.get("FileInXAlreadyLocked"),r),message:"",sticky:!1,allowUnsafeHTML:!1}});else{var d={title:e.String.format(i.get("LOCKING_X"),r),ui:!0,process:function(){var u=new Date;t.authenticatedRequest(a.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:a.options.platformUrls["3DSpace"],onComplete:function(m){d.update({loaded:.5,total:1});var p={};p.tenant=a.options.platformUrls.platformId,p.securityContext=a.options.fetchSecurityContext()?encodeURIComponent(a.options.fetchSecurityContext()):void 0,p.tenantUrl=a.options.platformUrls["3DSpace"],p.onComplete=function(t){var m=new Date-u;n.sendTrackerPageEvent({category:"docm.command.lock",action:"click",label:"Document lock",pd:{docType:l.type,docId:l.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:m,success:1}}),a.options.getJobsProcessorPromise.then((function(e){e.finishJob(d)})),a.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:i.get("DocumentLocked"),subtitle:e.String.format(i.get("FileInXLocked"),r),message:"",sticky:!1,allowUnsafeHTML:!1}}),a.options.events&&(a.options.events.publish({event:"docv2-lock-complete",data:{nodeModel:s}}),o.getFile(a.options,l.id,c[0].id).then((function(e){require(["DS/PlatformAPI/PlatformAPI"],(function(t){t.publish("docm-file-locked-in-document",{platformId:a.options.platformUrls.platformId,documentId:l.id,file:e})}))})))},p.onFailure=function(t,s){var c=new Date-u;n.sendTrackerPageEvent({category:"docm.command.lock",action:"click",label:"Document lock",pd:{docType:l.type,docId:l.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:c,failure:0}}),a.options.getJobsProcessorPromise.then((function(e){e.finishJob(d,"failed")})),o.fetchCurrentUser().then((t=>{s&&e.is(s.internalError,"string")&&s.internalError.includes("Business object locked by '"+t.id+"'")?a.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:i.get("DocumentLocked"),subtitle:e.String.format(i.get("FileInXAlreadyLocked"),r),message:"",sticky:!1,allowUnsafeHTML:!1}}):a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:s.error,message:"",sticky:!1,allowUnsafeHTML:!1}})})).catch((e=>{a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:s.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}))};var f=p.tenantUrl+"/resources/v1/modeler/documents/"+l.id+"/lock";p.type="json",p.url=f,p.data=JSON.stringify({csrf:JSON.parse(m).csrf}),p.headers=p.headers||{Accept:"*/*","Content-Type":"application/ds-json",SecurityContext:p.securityContext},p.method="POST",t.authenticatedRequest(f,p)},onFailure:function(e,t){a.options.getJobsProcessorPromise.then((function(e){e.finishJob(d,"failed")})),a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:t.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}})}};a.options.getJobsProcessorPromise.then((function(e){e.addJob(d)}))}else 0==c.length?a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:i.get("objectcontainsnofile"),message:"",sticky:!1,allowUnsafeHTML:!1}}):a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:i.get("Nomultifilesupport"),message:"",sticky:!1,allowUnsafeHTML:!1}})}))},a})),define("DS/DocumentCommands/V2/Actions/Unlock",["UWA/Core","DS/WAFData/WAFData","DS/DocumentCommands/Helper","DS/DocumentCommonInfra/TrackerAPI","i18n!DS/DocumentCommands/assets/nls/DocumentCommands","css!DS/DocumentCommands/DocumentCommands.css"],(function(e,t,o,n,i){"use strict";var a=function(e){return{id:"Unlock",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"lock-open",fontIconFamily:1},label:i.get("Unlock"),tooltip:i.get("Unlock"),position:"far",category:"edit",value:function(t){t.options=e,a.execute(t)},visibleFlag:!1},execute:function(){a.execute({options:e})},updateForSelection:function(t,n){return o.AuthoringCommandVisibiltyPromise(e,this.id,t)}}};return a.execute=function(a){var s=a.options.getSelectedNodes();if(1==s.length){var l=new Date,c=s[0],r=a.options.getDocumentFromNodeModel(c),d=[];r.files?d=r.files:r.relateddata&&r.relateddata.files&&(d=r.relateddata.files);var u=void 0;if(r&&null==(u=r.title||r.name)&&r.dataelements&&(u=r.dataelements.title||r.dataelements.name),1==d.length)""!=d[0].dataelements.locker?t.authenticatedRequest(a.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:a.options.platformUrls["3DSpace"],onComplete:function(s){var m=new Date-l;n.sendTrackerPageEvent({category:"docm.command.unlock",action:"click",label:"Document Unlock",pd:{docType:r.type,docId:r.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:m,success:1}});var p={};p.tenant=a.options.platformUrls.platformId,p.securityContext=a.options.fetchSecurityContext()?encodeURIComponent(a.options.fetchSecurityContext()):void 0,p.tenantUrl=a.options.platformUrls["3DSpace"],p.onComplete=function(t){a.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:i.get("DocumentUnlocked"),subtitle:e.String.format(i.get("FileInXUnlocked"),u),message:"",sticky:!1,allowUnsafeHTML:!1}}),a.options.events&&(a.options.events.publish({event:"docv2-undoedit-complete",data:{nodeModel:c}}),o.getFile(a.options,r.id,d[0].id).then((function(e){require(["DS/PlatformAPI/PlatformAPI"],(function(t){t.publish("docm-file-undoedited-in-document",{platformId:a.options.platformUrls.platformId,documentId:r.id,file:e})}))})))},p.onFailure=function(e,t){a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:t.error,message:"",sticky:!1,allowUnsafeHTML:!1}})};var f=p.tenantUrl+"/resources/v1/modeler/documents/"+r.id+"/unlock";p.type="json",p.url=f,p.data=JSON.stringify({csrf:JSON.parse(s).csrf}),p.headers=p.headers||{Accept:"*/*","Content-Type":"application/ds-json",SecurityContext:p.securityContext},p.method="POST",t.authenticatedRequest(f,p)},onFailure:function(e,t){var o=new Date-l;n.sendTrackerPageEvent({category:"docm.command.unlock",action:"click",label:"Document Unlock",pd:{docType:r.type,docId:r.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:o,failure:0}}),a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:t.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}}):a.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:i.get("DocumentUnlocked"),subtitle:e.String.format(i.get("FileInXAlreadyUnocked"),u),message:"",sticky:!1,allowUnsafeHTML:!1}});else 0==d.length?a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:i.get("objectcontainsnofile"),message:"",sticky:!1,allowUnsafeHTML:!1}}):a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:i.get("Nomultifilesupport"),message:"",sticky:!1,allowUnsafeHTML:!1}})}else s.forEach((s=>{var l=a.options.getDocumentFromNodeModel(s),c=[];l.files?c=l.files:l.relateddata&&l.relateddata.files&&(c=l.relateddata.files);var r=void 0;if(l&&null==(r=l.title||l.name)&&l.dataelements&&(r=l.dataelements.title||l.dataelements.name),1==c.length)if(""!=c[0].dataelements.locker){var d={title:e.String.format(i.get("UNLOCKING_X"),r),ui:!0,process:function(){var u=new Date;t.authenticatedRequest(a.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:a.options.platformUrls["3DSpace"],onComplete:function(m){d.update({loaded:.5,total:1});var p={};p.tenant=a.options.platformUrls.platformId,p.securityContext=a.options.fetchSecurityContext()?encodeURIComponent(a.options.fetchSecurityContext()):void 0,p.tenantUrl=a.options.platformUrls["3DSpace"],p.onComplete=function(t){var m=new Date-u;n.sendTrackerPageEvent({category:"docm.command.unlock",action:"click",label:"Document Unlock",pd:{docType:l.type,docId:l.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:m,success:1}}),a.options.getJobsProcessorPromise.then((function(e){e.finishJob(d)})),a.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:i.get("DocumentUnlocked"),subtitle:e.String.format(i.get("FileInXUnlocked"),r),message:"",sticky:!1,allowUnsafeHTML:!1}}),a.options.events&&(a.options.events.publish({event:"docv2-undoedit-complete",data:{nodeModel:s}}),o.getFile(a.options,l.id,c[0].id).then((function(e){require(["DS/PlatformAPI/PlatformAPI"],(function(t){t.publish("docm-file-undoedited-in-document",{platformId:a.options.platformUrls.platformId,documentId:l.id,file:e})}))})))},p.onFailure=function(e,t){var o=new Date-u;n.sendTrackerPageEvent({category:"docm.command.unlock",action:"click",label:"Document Unlock",pd:{docType:l.type,docId:l.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:o,failure:0}}),a.options.getJobsProcessorPromise.then((function(e){e.finishJob(d,"failed")})),a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:t.error,message:"",sticky:!1,allowUnsafeHTML:!1}})};var f=p.tenantUrl+"/resources/v1/modeler/documents/"+l.id+"/unlock";p.type="json",p.url=f,p.data=JSON.stringify({csrf:JSON.parse(m).csrf}),p.headers=p.headers||{Accept:"*/*","Content-Type":"application/ds-json",SecurityContext:p.securityContext},p.method="POST",t.authenticatedRequest(f,p)},onFailure:function(e,t){var o=new Date-u;n.sendTrackerPageEvent({category:"docm.command.unlock",action:"click",label:"Document Unlock",pd:{docType:l.type,docId:l.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:o,failure:0}}),a.options.getJobsProcessorPromise.then((function(e){e.finishJob(d,"failed")})),a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:t.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}})}};a.options.getJobsProcessorPromise.then((function(e){e.addJob(d)}))}else a.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:i.get("DocumentUnlocked"),subtitle:e.String.format(i.get("FileInXAlreadyUnlocked"),r),message:"",sticky:!1,allowUnsafeHTML:!1}});else 0==c.length?a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:i.get("objectcontainsnofile"),message:"",sticky:!1,allowUnsafeHTML:!1}}):a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:i.get("Nomultifilesupport"),message:"",sticky:!1,allowUnsafeHTML:!1}})}))},a})),define("DS/DocumentCommands/DocumentCommandsV2",["UWA/Core","UWA/Promise","DS/DocumentCommands/V2/Actions/Preview","DS/DocumentCommands/V2/Actions/Edit","DS/DocumentCommands/V2/Actions/LockAndDownload","DS/DocumentCommands/V2/Actions/UndoEdit","DS/DocumentCommands/V2/Actions/Unlock","DS/DocumentCommands/V2/Actions/Lock","DS/DocumentCommands/V2/Actions/Share","DS/DocumentCommands/V2/Actions/CopyLink","DS/DocumentCommands/V2/Actions/Download","DS/DocumentCommands/V2/Actions/Relations","DS/DocumentCommands/V2/Actions/Maturity","DS/DocumentCommands/V2/Actions/NewRevision","DS/DocumentCommands/V2/Actions/Update","DS/DocumentCommands/V2/Actions/UpdateAndUnlock","DS/DocumentCommands/V2/Actions/Delete","DS/DocumentCommands/V2/Actions/Revisions","DS/DocumentCommands/V2/Actions/Duplicate","DS/DocumentCommands/V2/Actions/Compare","DS/DocumentCommands/V2/Actions/Move","DS/DocumentCommands/V2/Actions/ChangeOwner","DS/DocumentCommands/V2/Actions/AddTo/Libraries","DS/DocumentCommands/V2/Actions/AddTo","DS/DocumentCommands/V2/ConvertCmdToWebUX","DS/DocumentCommands/V2/Actions/Subscription/Subscribe","DS/DocumentCommands/V2/Actions/Subscription/UnSubscribe","DS/DocumentCommands/V2/Actions/Subscription/EditSubscriptions","DS/DocumentCommands/V2/Actions/Subscription/MySubscriptions","DS/DocumentCommands/V2/Actions/Subscription/EditSubscriptionForOthers","DS/DocumentCommands/V2/Actions/Subscription","DS/DocumentCommands/V2/Actions/OfficeWebEdition","DS/DocumentCommands/V2/Actions/UploadFile","DS/DocumentCommands/V2/Actions/Revise","DS/DocumentCommands/V2/Actions/NewBranch"],(function(e,t,o,n,i,a,s,l,c,r,d,u,m,p,f,g,v,D,y,h,S,b,C,w,F,I,U,E,x,A,P,k,N,T,M){"use strict";return e.Class.extend({init:function(t){t.widget=window.widget=null==t.widget?window.widget:t.widget,t.getSourceForUsageAnalytics=t.getSourceForUsageAnalytics||function(e){t.uaSource||(t.uaSource="unknown");var o=t.uaSource;return e&&(o=o+"."+e),t.isFromContextMenu?o+=" Contextual Menu":o+=" Tool bar",o},t.getJobsProcessorPromise=t.getJobsProcessorPromise||new e.Promise((function(e,o){var n={};t.widget&&t.widget.app&&t.widget.app.jobs&&"doco-jobs"==t.widget.app.jobs.name&&t.widget.app.progressPane&&"doco-progress"==t.widget.app.progressPane.name?(n=t.widget.app,e(n.jobs)):(console.warn("DocumentCommandsV2 had to initialize jobs and progressPane"),require(["DS/DocumentCommands/Jobs","DS/DocumentCommands/ProgressPane"],(function(o,i){null==n.jobs&&(n.jobs=new o(n)),null==n.progressPane&&(n.progressPane=new i(n),t.widget&&t.widget.body?n.progressPane.inject(t.widget.body):n.progressPane.inject(document.body)),e(n.jobs)})))})),this._parent(t),this.commands={Preview:new o(t),Edit:new n(t),LockAndDownload:new i(t),UndoEdit:new a(t),Unlock:new s(t),Lock:new l(t),Download:new d(t),Share:new c(t),CopyLink:new r(t),Relations:new u(t),Maturity:new m(t),NewRevision:new p(t),Update:new f(t),UpdateAndUnlock:new g(t),UploadFile:new N(t),Delete:new v(t),Revisions:new D(t),Duplicate:new y(t),Compare:new h(t),Move:new S(t),ChangeOwner:new b(t),Libraries:new C(t),AddTo:new w(t),Subscribe:new I(t),UnSubscribe:new U(t),EditSubscriptions:new E(t),MySubscriptions:new x(t),EditSubscriptionForOthers:new A(t),Subscription:new P(t),OfficeWebEdition:new k(t),Revise:new T(t),NewBranch:new M(t)}},commands:[],connectToWebUXToolbar:function(e){e.items.getRoots().forEach((e=>{e.options.docV2Public&&e.options.extend&&e.options.extend(e)}))},selectionChangedForWebUXToolbar:function(e){e.items.getRoots().forEach((e=>{e.options.docV2Public&&(e.options.grid.action=e,e.options.updateForSelection&&e.options.updateForSelection((function(t){e.updateOptions(t)})))}))},getWebUXContextMenuItemsForCurrentSelection:function(o,n){return new e.Promise((function(i,a){var s=[],l=o[0].dataElements.category,c=[!0];o.forEach((t=>{if(t.updateForSelection){var o=t.updateForSelection((function(o){t.dataElements=e.extend(t.dataElements,o,!0)}));c.push(o)}else c.push(!0)})),t.all(c).then((function(e){o.forEach((e=>{e.dataElements.visibleFlag&&(n&&l!=e.dataElements.category&&s.push({type:"SeparatorItem"}),s.push(F([e])[0]),l=e.dataElements.category)})),i(s)}))}))},getUIKitItemsForCurrentSelection:function(o,n){var i=[!0],a=o[0].dataElements.category,s=[];return new e.Promise((function(l,c){o.forEach((t=>{if(t.updateForSelection){var o=t.updateForSelection((function(o){t.dataElements=e.extend(t.dataElements,o,!0)}));i.push(o)}else i.push(!0)})),t.all(i).then((function(){o.forEach((e=>{e.dataElements.visibleFlag&&(n&&a!=e.dataElements.category&&s.push({className:"divider"}),s.push({rawItem:e,title:e.dataElements.label,name:e.id,text:e.dataElements.label,fonticon:e.dataElements.icon.iconName,handler:e.execute||function(e,t,o){console.error("This command doesnt have value")},category:e.dataElements.category}),a=e.dataElements.category)})),l(s)}))}))}})}));