/*!  COPYRIGHT DASSAULT SYSTEMES 2019   */
define("DS/PADServices/views/ENXDropTarget",["text!DS/PADServices/assets/templates/dropArea.html","css!DS/PADServices/PADServices.css","i18n!DS/PADServices/assets/nls/PADServices.json","DS/Handlebars/Handlebars","DS/Core/Core","DS/Utilities/Dom"],(function(e,t,i,n,o,s){"use strict";var r=n.compile(e),a=function(e){this.options=Object.assign({show:!1,isOver:!1,backgroundOnDefault:!1},e),this.elements={};let t={openTitle:i.dropTarget.openTitle,openInCtxTitle:i.dropTarget.openInCtxTitle,openAndFilterTitle:i.dropTarget.openAndFilterTitle};var n=document.createElement("div");n.innerHTML=r(t).trim(),this.elements.container=n.firstChild,!0!==this.options.show?this.elements.container.style.visibility="hidden":this.elements.container.style.visibility="visible";var o=this.elements.container.getElementsByClassName("enx-drop-zone");for(let e=0;e<o.length;e++)this.__addDnDCB(o[e]);this.elements.defaultDrop=this.elements.container.querySelector(".enx-drop-default"),!0===this.options.backgroundOnDefault&&this.elements.container.classList.add("withbackground")};function l(e){return e.preventDefault(),e.stopPropagation(),!1}return a.prototype.render=function(){return this.elements.container},a.prototype.show=function(){this.elements.container.style.visibility="visible"},a.prototype.hide=function(){if(this.elements.container.style.visibility="hidden",!0===this.options.isOver){this.options.isOver=!1;let e=this.elements.container.getElementsByClassName("enx-drop-zone");for(let t=0;t<e.length;t++)e[t].classList.remove("hover")}},a.prototype.getMainClassName=function(){return"enx-droptarget"},a.prototype.isOver=function(){return this.options.isOver},a.prototype.onOpenInCtx=function(e){},a.prototype.onOpenAndFilter=function(e){},a.prototype.__addDnDCB=function(e){e.addEventListener("drop",this.__dropped.bind(this)),e.addEventListener("dragenter",l),e.addEventListener("dragover",this.__dragOver.bind(this)),e.addEventListener("dragleave",this.__dragLeave.bind(this))},a.prototype.__dropped=function(e){e.preventDefault(),e.stopPropagation();let t=s.firstParentWithClass(e.target,"enx-open-ctx")?"openCtx":s.firstParentWithClass(e.target,"enx-open-filter")?"openFilter":null;return"openCtx"===t?this.onOpenInCtx(e):"openFilter"===t&&this.onOpenAndFilter(e),this.hide(),!1},a.prototype.__dragOver=function(e){e.preventDefault(),e.stopPropagation();let t=s.firstParentWithClass(e.target,"enx-open-ctx")||s.firstParentWithClass(e.target,"enx-open-filter");return t&&(this.options.isOver=!0,t.classList.add("hover"),this.elements.container.classList.remove("hover")),!1},a.prototype.__dragLeave=function(e){e.preventDefault(),e.stopPropagation();let t=s.firstParentWithClass(e.target,"enx-open-ctx")||s.firstParentWithClass(e.target,"enx-open-filter");return t&&(this.options.isOver=!1,t.classList.remove("hover"),this.elements.container.classList.add("hover")),!1},a})),define("DS/PADServices/utils/Generics",["UWA/Core"],(function(e){const t={ARRAY:"array",STRING:"string",NUMBER:"number",FUNCTION:"function",OBJECT:"object"};function i(t,i){return e.is(t,i)}function n(e){return function(t){return i(t,e)}}const o={string:n(t.STRING),array:n(t.ARRAY),number:n(t.NUMBER),function:n(t.FUNCTION),object:n(t.OBJECT)};return{clone:e.clone,merge:e.merge,typeOf:e.typeOf,checks:o,is:e.is,isType:i,TYPES:t}})),define("DS/PADServices/utils/Iterator",[],(function(){function e(e,t){if(Array.isArray(e)){var i=e.length;if(i)for(var n=0;n<i;n++){t(e[n],n,e)}}}return{iterate:e,iterateControl:function(e,t){if(Array.isArray(e)){var i=e.length;if(i)for(var n=0;n<i;n++){let i=t(e[n],n,e);if(i&&i.break)break;!i||i.continue}}},iterateObj:function(t,i){e(Object.keys(t),(function(e){var n=t[e];i(n,e,t)}))},iterateMap:function(e,t){var i=e.keys();for(let n of i){t(e.get(n),n)}}}})),define("DS/PADServices/utils/WaitingPromise",[],(function(){function e(){let e=this;this._promise=new Promise((function(t,i){e.resolve=t,e.reject=i}))}return e.prototype={then:function(e,t){e&&t?this._promise.then(e,t):this._promise.then(e)},catch:function(e){this._promise.catch(e)}},e})),define("DS/PADServices/views/ENXMultiSourcePanel",["i18n!DS/PADServices/assets/nls/PADServices.json","DS/Utilities/Dom","DS/Controls/Button","DS/Windows/Dialog"],(function(e,t,i,n){"use strict";const o="eno-multi-source";function s(e){this.options=e,this._dialog=null,this.createDialog()}return s.prototype.createDialog=function(){const s=t.createElement("div",{class:o}),r=t.createElement("div",{class:o+"-message"});r.innerText=e.multiSourcePanel.message,s.appendChild(r),this._dialog=new n({title:e.multiSourcePanel.title,content:s,autoCloseFlag:!0,closeButtonFlag:!0,modalFlag:!0,width:450,buttons:{Close:new i({onClick:e=>{this.close()}})}}),this._dialog.addEventListener("close",this.close.bind(this))},s.prototype.close=function(){this.destroy()},s.prototype.destroy=function(){this._dialog.destroy()},s})),define("DS/PADServices/utils/SubscriptionHolder",[],(function(){function e(e){this.modelEvents=e,this.subscriptions=[]}return e.prototype={subscribe:function(e,t){this.subscriptions.push(this.modelEvents.subscribe(e,t))},destroy:function(){for(var e=0;e<this.subscriptions.length;e++){var t=this.subscriptions[e];this.modelEvents.unsubscribe(t)}}},e})),define("DS/PADServices/views/private/Iconbar",["css!DS/PADServices/PADServices.css","css!DS/UIKIT/UIKIT","UWA/Core","UWA/Event","UWA/Utils","UWA/Controls/Abstract","DS/UIKIT/Menu","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu"],(function(e,t,i,n,o,s,r,a,l){"use strict";var d=i.Utils.Client.Features.touchEvents;var c,p=(c=/^(divider)$/,function(e){var t,i,n=!1;if(!e)return!1;for(t=e.split(" "),i=0;i<t.length&&!1===n;i++)c.test(t[i])&&(n=!0);return n}),u=r.extend({name:"iconbar-items",templateClassname:"iconbar-template"}),h=l.extend({show:function(){document.body.style.overflow="hidden",this._parent(),document.body.style.overflow="auto"}}),m=s.extend({name:"iconbar",menu:null,overflowMenu:null,overflowMenuTrigger:null,init:function(e){if(void 0===e.renderTo)throw new Error("renderTo options is Mandatory");this._parent(e),this.buildSkeleton(),this.handleEvents(),this.show()},buildSkeleton:function(){var e=this.elements,t=this.options;e.container||(this.menu=new u({multiSelect:t.multiSelect}),this.addItem(t.items),e.container=this.menu.elements.container,e.container.className=this.getClassNames(),e.container.addClassName("enx-iconbar"),t.renderTo&&1===t.renderTo.nodeType&&(e.container.inject(t.renderTo),delete t.renderTo))},buildOverflowMenu:function(){var e,t,n=[];this.overflowMenuTrigger||(this.overflowMenuTrigger=i.createElement("li",{class:this.name+"-overflow-menu-trigger item",html:{tag:"span",class:"fonticon fonticon-menu-dot"}})),this.overflowMenu&&this.overflowMenu.destroy(),this.overflowMenu=null,this.menu.items.forEach((function(i){i.content&&"dropdown"===i.content.type||(t=!0,e={className:(i.id+" "+(i.className?i.className:"")).trim(),fonticon:i.fonticon,text:i.text,name:i.name,handler:i.handler,selectable:i.selectable,selected:i.selected,disabled:i.disabled},i.content&&i.content.options.items&&"icondropdown"!==i.content.type?e.items=i.content.options.items.map((function(e){return e.className=(i.id+" "+(e.className?e.className:"")).trim(),e.selectable=!0,e})):i.content&&"icondropdown"===i.content.type&&(t=!1,i.content.options.items&&i.content.options.items.forEach((function(e){n.push({className:(i.id+" "+(e.className?e.className:"")).trim(),fonticon:e.fonticon,icon:e.icon,handler:e.handler,text:e.description})}))),t&&n.push(e))})),this.overflowMenu=new h({multiSelect:this.options.multiSelect,items:n,target:this.overflowMenuTrigger,events:this.options.events})},getItem:function(e){var t,i,n,o=!1;for(t=0,i=this.menu.items.length;t<i;t++){if(o=this.menu.items[t],e&&e.nodeType){if(n=e.hasClassName("item")?e:e.getParent(),o.id===n.id)break}else if(t===e||o.id===e||o.name===e)break;o=!1}return o},handleEvents:function(){var e,t,i,o;this.events={container:{click:function(e){var t=n.getElement(e),i=this.getItem(t);i.selectable&&this.select(i.name,!i.selected),i&&(i.content&&(window.requestAnimationFrame?window.requestAnimationFrame(this.displayContent.bind(this,i)):this.displayContent(i)),i.tooltip&&i.tooltip.isVisible&&!d&&i.tooltip.hide(),this.dispatchEvent("onClick",[e,i],this),"function"==typeof i.handler&&i.handler.call(this,e,i))}.bind(this)}},this.elements.container.addEvents(this.events.container),this.events.window={resize:(e=this.resize,t=100,function(){var n,s=this,r=arguments;n=i&&!o,clearTimeout(o),o=setTimeout((function(){o=null,i||e.apply(s,r)}),t),n&&e.apply(s,r)}).bind(this)},window.addEventListener("resize",this.events.window.resize)},addItem:function(e){return o.splat(e).forEach((function(e){this._addItem(e)}),this),this.buildOverflowMenu(),this},_addItem:function(e){var t=this.menu._addItem(e);t.content=t.innerComponent||t.content,!p(e.className)&&t.text&&(t.tooltip=new a({target:t.elements.container,body:t.text,trigger:t.tooltipTrigger||this.options.tooltipsTrigger||"hover focus"}),t.tooltip.getContent().addClassName("enx-tooltip-iconbar"),t.elements.container.getElement(".item-text").remove())},isOverflowing:function(){return this.menu.items.some(function(e){return!e.elements.container.isInViewport(this.elements.container,!0,!0)}.bind(this))},isInjected:function(){if(this.elements&&this.elements.container)return this.elements.container.isInjected()},resize:function(){function e(){var e=this.elements.container.getBoundingClientRect();return this.menu.items.filter((function(t){var i=t.elements.container.getBoundingClientRect();return i.top+i.height>e.bottom||i.left+i.width>e.right}),this)}function t(e){this.overflowMenu.items.forEach((function(t){e.some((function(e){return!!t.className&&(t.className&&-1!==t.className.indexOf(e))}))?t.elements.container.removeClassName("hidden"):t.elements.container.addClassName("hidden")}))}return function(){if(this.elements.container){var i,n;if(this.overflowMenuTrigger&&this.overflowMenuTrigger.isInjected()&&this.overflowMenuTrigger.remove(),this.overflowMenu.isVisible&&this.overflowMenu.hide(),this.elements.container&&!this.isOverflowing())return;if(n=(i=e.call(this)).map((function(e){return e.id})),t.call(this,n),i.length)for(this.menu.elements.wrapper.insertBefore(this.overflowMenuTrigger,i[0].elements.container);!this.overflowMenuTrigger.isInViewport(this.elements.container,!0,!0)&&this.overflowMenuTrigger.previousSibling;)this.menu.elements.wrapper.insertBefore(this.overflowMenuTrigger,this.overflowMenuTrigger.previousSibling),i.push(this.overflowMenuTrigger.nextSibling),this.overflowMenuTrigger.nextSibling.id&&n.push(this.overflowMenuTrigger.nextSibling.id),t.call(this,n)}}}(),displayContent:function(e){var t=i.clone(e.content.options);if(t.target=e.elements.container,e.content.created)e.content.component&&e.content.component.show();else{if("dropdown"===e.content.type)require(["DS/UIKIT/Dropdown"],(function(i){e.content.component=new i(t).show()}));else if("icondropdown"===e.content.type)require(["DS/UIKIT/IconDropdown"],(function(i){e.content.component=new i(t).show()}));else{if("dropdownmenu"!==e.content.type)return;e.content.component=new l(t).show(),e.content.component.getContent().addClassName("enx-dropdown-iconbar")}e.content.created=!0}},select:function(){var e,t,i,n,o=arguments;null!=o[0]&&(t=void 0===o[1]||o[1],!0!==this.options.multiSelect&&(t&&function(e,t){for(var i=e.length,n=0;n<i;n++)t(e[n],n)}(this.elements.container.querySelectorAll(".selected"),(function(e){e.removeClassName&&e.removeClassName("selected")})),t&&this.overflowMenu.getSelectedItems().forEach((function(e){this.overflowMenu.menus[0].toggleSelection(e),e.elements.container.removeClassName("selectable")}),this)),(e=this.getItem(o[0])).selected=t,e&&!e.elements.container.hasClassName("divider")&&(e.elements.container[t?"addClassName":"removeClassName"]("selected"),i=e.elements.container.id,1===(n=this.overflowMenu.items.filter((function(e){return e.elements.container.hasClassName(i)}))).length&&(this.overflowMenu.menus[0].toggleSelection(n[0]),n[0].elements.container.addClassName("selectable"),n[0].selected=t)))},enableItem:function(e){this.menu.enableItem(e);var t=this.getItem(e);t&&(t.disabled=!1)},disableItem:function(e){this.menu.disableItem(e);var t=this.getItem(e);t&&(t.disabled=!0)},show:function(){this.isInjected()&&(this._injectionObserver&&this._injectionObserver.disconnect(),this._injectionObserver=null,this._parent(),window.requestAnimationFrame?window.requestAnimationFrame(this.resize.bind(this)):this.resize())},destroy:function(){window.removeEventListener("resize",this.events.window.resize),this.overflowMenu&&this.overflowMenu.destroy(),this.overflowMenuTrigger&&this.overflowMenuTrigger.destroy(),this.elements.container.removeEvents(this.events.container),this.menu.items.forEach((function(e){e.tooltip&&e.tooltip.destroy()})),this._parent()}});return m})),define("DS/PADServices/utils/PromiseCompletion",[],(function(){function e(e){if(this.options=e,!this.options.promise||!this.options.before||!this.options.after)throw Error("Key parameter missing");this._start()}return e.prototype={_start:function(){this.options.before();var e=this._complete.bind(this);this.options.promise.then(e).catch(e)},_complete:function(){this.options.after()}},e})),define("DS/PADServices/utils/PersistBlob",[],(function(){function e(e){this.options=e,this._readData(),this._data||(this._data={_internals:{version:this.options.version,timestamp:Date.now()}})}return e.prototype={_readData:function(){this._data=this.options.storageWrapper.get(this.options.key),this._data&&this.options.versionConverter&&(this._data=this.options.versionConverter(this._data))},save:function(){this._data._internals?(this._data._internals.version=this.options.version,this._data._internals.timestamp=Date.now()):this._data={_internals:{version:this.options.version,timestamp:Date.now()}},this.options.storageWrapper.set(this.options.key,this._data)}},Object.defineProperties(e.prototype,{data:{get:function(){return this._data}}}),e})),define("DS/PADServices/utils/PConfigUtils",["DS/PADUtils/PADSettingsMgt"],(function(e){"use strict";return{isMultiRootSupported:function(){return!0===e.getSetting("keepFilterAuthoring")&&!0===e.getSetting("multiRootFilterAuthoring")},keepFilterForRoot:function(t){return!0===e.getSetting("keepFilterAuthoring")&&(!0===e.getSetting("multiRootFilterAuthoring")||1===t.length)},validateFIlters:function(e,t){let i,n,o="",s="",r=0,a=!1;if(e&&e.filter&&e.filter.or&&e.filter.or.filters&&1===e.filter.or.filters.length){var l=[],d=[];if(t?e.filter.or.filters[0].and&&(l=e.filter.or.filters[0].and.filters,n=0):e.filter.or.filters[0].and_not&&e.filter.or.filters[0].and_not.left?(l=e.filter.or.filters[0].and_not.left.and.filters,d=e.filter.or.filters[0].and_not.right?e.filter.or.filters[0].and_not.right.or.filters:[],n=1):e.filter.or.filters[0].and?(l=e.filter.or.filters[0].and.filters,n=1):e.filter.or.filters[0].truncatable_if&&e.filter.or.filters[0].truncatable_if.truncate_length_filter&&(l=e.filter.or.filters[0].truncatable_if.truncate_length_filter.and.filters,n=1),l)for(var c=0;c<l.length;c++)if(l[c].prefix_filter)r++;else{if(!l[c].config_filter&&!l[c].config_filter_id){o="",s="";break}l[c].config_filter?(o=l[c].config_filter,s="Compiled"):l[c].config_filter_id&&(o=l[c].config_filter_id.physical_id,s="PhysicalId")}e.root&&e.root.physical_id&&(i=e.root.physical_id)}return r<=n&&o&&s&&d.length<=1&&(a=!0),{root:i,isValid:a,config_filter:o,configCompiledForm:s}}}})),define("DS/PADServices/views/private/ComboSelector",["css!DS/PADServices/PADServices.css","UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","DS/Menu/ContextualMenu","DS/Menu/Menu","DS/Core/Core"],(function(e,t,i,n,o,s,r){"use strict";return i.extend(n,{defaultOptions:{treedocument:null,disabled:!1},init:function(e){this._parent(e);var i=this;if(this.elements.container=t.createElement("div",{class:"comboSelector "+(e.className?e.className:"")}),this.elements.inner=t.createElement("div",{class:"comboSelector-inner"}).inject(this.elements.container),this.elements.text=t.createElement("div",{class:"comboSelector-text"}).inject(this.elements.inner),this.elements.expander=t.createElement("span",{class:"comboSelector-expander wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-down"}).inject(this.elements.inner),this.elements.container.addEventListener("click",i._launchCtxMenu.bind(i)),this.elements.container.addEventListener("contextmenu",i._launchCtxMenu.bind(i)),null===this.options.treedocument)throw new Error("Invalid attribute in constructor. Missing treedocument");this.options.treedocument.getXSO().onPostAdd(this._redrawInnerText.bind(this)),this.options.treedocument.getXSO().onPostRemove(this._redrawInnerText.bind(this)),this.disabled(this.options.disabled),this._redrawInnerText()},disabled:function(e){e?(this.elements.container.setAttribute("disabled",""),this.options.disabled=e):(this.elements.container.removeAttribute("disabled",""),this.options.disabled=e)},_launchCtxMenu:function(e){var t=[];if(!1===this.options.disabled){for(var i=this.options.treedocument.getRoots(),n=0;n<i.length;n++){var o=i[n].options.icons&&i[n].options.icons.length&&i[n].options.icons[0].iconName?{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+i[n].options.icons[0].iconName}:void 0;t.push({title:i[n].getLabel(),type:"CheckItem",state:i[n].isSelected()?"selected":void 0,fonticon:o,action:{this:this,context:i[n],callback:this._typeSelectedInMenu.bind(this)}})}if(t.length){var r=this.elements.container.getBoundingClientRect();s.show(t,{position:{x:r.left,y:r.bottom}})}}},_typeSelectedInMenu:function(e){var t=e.context;t.select(!0),this.dispatchEvent("onSelect",t),this.dispatchEvent("onSelectionChange"),this._redrawInnerText()},_redrawInnerText:function(){this.elements.text.empty();for(var e="",i=[],n=this.options.treedocument.getSelectedNodes(),o=0;o<n.length;o++)i.push(n[o].getLabel());if(e=i.length?i.join(", "):this.options.nlsEmptySelection,1===n.length&&n[0].options.icons){t.createElement("div",{class:"iconMenu wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+n[0].options.icons[0].iconName}).inject(this.elements.text);n[0].options.subLabel&&(this.elements.text.title=n[0].options.subLabel)}t.createElement("p",{text:e}).inject(this.elements.text)}})})),define("DS/PADServices/utils/NlsCache",[],(function(){function e(){this.entries={}}let t;return e.prototype={store:function(e,t,i){this.entries[e]||(this.entries[e]={originals:{}}),this.entries[e].originals[t]=i},hasChange:function(e,t,i){let n={found:!1,hasChange:!1},o=this.entries[e];if(o){return n.found=!0,o.originals[i]!==t&&(n.hasChange=!0),n}return n}},t||(t=new e),t})),define("DS/PADServices/views/private/SearchInput",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","UWA/Event","DS/Controls/ButtonGroup","DS/Controls/Button"],(function(e,t,i,n,o,s,r,a){"use strict";return n.extend(o,{name:"enx-search-input",init:function(e){this._parent(e);this.elements.container=UWA.createElement("div",{class:this.getClassNames(e.className?e.className:"")}),this.elements.inner=UWA.createElement("div",{class:this.getClassNames("-inner")}).inject(this.elements.container);var i=UWA.createElement("div",{class:this.getClassNames("-input-container")}).inject(this.elements.inner);this.elements.input=UWA.createElement("input",{class:this.getClassNames("-input"),type:"text",placeholder:this.options.placeholder?this.options.placeholder:t.searchInput.placeholder}).inject(i);var n=UWA.createElement("div",{class:this.getClassNames("-right")}).inject(this.elements.inner),o=UWA.createElement("div",{class:this.getClassNames("-clear")+this.getClassNames("-btn")}).inject(n);this.elements.clearBtn=UWA.createElement("div",{class:this.getClassNames("-btnIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-clear"),title:t.searchInput.clear}).inject(o),this.elements.clearBtn.hide();var s=UWA.createElement("div",{class:this.getClassNames("-search")+this.getClassNames("-btn")}).inject(n);this.elements.searchBtn=UWA.createElement("div",{class:this.getClassNames("-btnIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-search"),title:t.searchInput.search}).inject(s),this.elements.searchBtn.setStyle("opacity","0.1"),this.elements.searchBtn.addEventListener("click",this._onSearch.bind(this)),this.elements.clearBtn.addEventListener("click",this._onClearSearch.bind(this)),this.elements.input.addEventListener("keyup",this._onSearchInputKeyUp.bind(this)),this.elements.input.addEventListener("paste",this._onSearchInputPaste.bind(this)),this.elements.input.addEventListener("keydown",this._onSearchInputKeyDown.bind(this))},clear:function(e){this._onClearSearch(null,e)},_onSearch:function(e){this.elements.input.blur(),this.dispatchEvent("onSearch",{searchStr:this.elements.input.value})},_onClearSearch:function(e,t){this.elements.input.value="",this.elements.clearBtn.hide(),this.elements.searchBtn.setStyle("opacity","0.1"),!0!==t&&this.dispatchEvent("onSearch",{searchStr:this.elements.input.value})},_onSearchInputKeyUp:function(e){this.elements.input.value?(this.elements.searchBtn.setStyle("opacity","1"),this.elements.clearBtn.setStyle("display","inline-block"),this.dispatchEvent("onSearch",{searchStr:this.elements.input.value})):(this.elements.clearBtn.hide(),this.elements.searchBtn.setStyle("opacity","0.1"),this.dispatchEvent("onSearch",{searchStr:this.elements.input.value}))},_onSearchInputPaste:function(e){var t=this;setTimeout(function(){t._onSearchInputKeyUp()}.bind(this),200)},_onSearchInputKeyDown:function(e){"return"!==s.whichKey(e)&&"Enter"!==e.keyIdentifier&&"return"!==e.keyIdentifier||this._onSearch(),s.stopPropagation(e)}})})),define("DS/PADServices/views/private/CustomColorView",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices.json","UWA/Class/View"],(function(e,t,i){"use strict";return i.extend({className:"padcustomcolorview",name:"padcustomcolorview",template:function(){return'              <div data-label="'+this.model.get("label")+'" class="'+this.getClassNames("_cell")+'" style="background-color:'+this.model.get("background_color")+';">              <div class="'+this.getClassNames("_check")+' ">'+this.displayContent+"</div>              </div>"},domEvents:{"click .padcustomcolorview_cell":"_onSelect","click .padcustomcolorview_check":"_onSelect"},setup:function(e){var i=e||{};this._parent(i),"P_Preview"===this.model.get("label")?this.displayContent=t.colorView.content:this.displayContent=t.colorView.checkmark,this.model.addEvent("onChange:selected",this.render.bind(this)),this.model.addEvent("onChange:background_color",this.render.bind(this)),this.model.addEvent("onChange:color",this.render.bind(this)),"BG_Greyscale_8"!==this.model.get("label")&&"FG_Greyscale_1"!==this.model.get("label")||this.model.set("selected",!0)},render:function(){this.container.setHTML(this.template()),this.container.setStyle("background-color",this.model.get("background_color"));var e=this.model.get("background_color");return"P_Preview"===this.model.get("label")&&this.container.setStyle("cursor","default"),!0!==this.model.get("selected")&&"P_Preview"!==this.model.get("label")||(e=this.model.get("color")),this.container.setStyle("color",e),this.elements.padcustomcolorview=this.container,this},toggleSelected:function(){!0===this.model.get("selected")?(this.model.set("selected",!1),this.elements.padcustomcolorview.setStyle("color",this.model.get("background_color"))):(this.model.set("selected",!0),this.elements.padcustomcolorview.setStyle("color",this.model.get("color")))},isSelected:function(){return this.model.get("selected")},_onSelect:function(){this.toggleSelected(),this.dispatchEvent("select",this.model.get("label"))}})})),define("DS/PADServices/views/private/WizardSteps",["text!DS/PADServices/assets/templates/WizardSteps.html","css!DS/PADServices/PADServices.css","i18n!DS/PADServices/assets/nls/PADServices.json","UWA/Core","UWA/Controls/Abstract","DS/Handlebars/Handlebars","DS/Core/Core","css!DS/UIKIT/UIKIT.css"],(function(e,t,i,n,o,s,r,a){"use strict";var l=s.compile(e);return s.registerHelper("getlabel",(function(e){for(var t=require("i18n!"+this.label.file),i=this.label.key.split("."),n=t,o=0;o<i.length;o++)n=n[i[o]];return n})),o.extend({name:"enx-wizard-container",defaultOptions:{subscribeTokens:[],modelEvents:null,renderTo:null,steps:null,activeStep:null},init:function(e){this._parent(e),this.elements.container=n.createElement("div",{class:this.getClassNames()}),this.options.steps&&this.elements.container.setContent(l(this.options.steps)),this.options.renderTo&&this.elements.container.inject(this.options.renderTo),this.options.rope=this.elements.container.getElement("div.enx-wizard-rope"),this.options.navigator=this.elements.container.getElement("nav.enx-view-navigator");var t=this.elements.container.getElement("a.nav-item.active");if(t){var i=t.id;this._render2ActiveStep(i)}for(var o=this,s=this.options.navigator.getElements("a"),r=0;r<s.length;r++)s[r].addEventListener("click",(function(e){var t=e.currentTarget.id;o.changeStep(t)}));this.options.subscribeTokens.push(this.options.modelEvents.subscribe({event:"ENXViews/WizardSteps/changeStep"},(function(e){var t=e.stepId;o.changeStep(t)})))},changeStep:function(e){this._render2ActiveStep(e),this.options.modelEvents.publish({event:"ENXViews/WizardSteps/stepChanged",data:{stepId:e}})},destroy:function(){for(var e=0;e<this.options.subscribeTokens.length;e++)this.options.modelEvents.unsubscribe(this.options.subscribeTokens[e]);this._parent()},_render2ActiveStep:function(e){for(var t,i=this.options.navigator.getElements("a"),n=!1,o=0;o<i.length;o++){var s=i[o];if(!1===n?s.removeClassName("filled").addClassName("filled"):s.removeClassName("filled"),s.id===this.options.activeView&&s.removeClassName("active"),s.id===e){s.addClassName("active");s.getElement(".view-icon.enx-icon");var r="100%";o<i.length-1&&(r=Math.floor(100/(i.length+1))*(o+1)+"%"),this.options.rope.setStyles({width:r,height:"2px"}),t=s.id,n=!0}}this.options.activeView=t}})})),define("DS/PADServices/utils/WidgetProxy",[],(function(){function e(){this._hasWidget=void 0!==window.widget,this._hasWidget||(this._data={})}var t;return e.prototype={setValue:function(e,t){if(this._hasWidget)return window.widget.setValue(e,t);this._data[e]=t},getValue:function(e){return this._hasWidget?window.widget.getValue(e):this._data[e]},addPreference:function(e){if(this._hasWidget)return window.widget.addPreference(e);this._data[e.name]=e.defaultValue},dispatchEvent:function(e,t){this._hasWidget&&window.widget.dispatchEvent(e,t)}},Object.defineProperties(e.prototype,{hasWidget:{get:function(){return this._hasWidget}}}),t||(t=new e),t})),define("DS/PADServices/commands/HomeCmd",["DS/ApplicationFrame/Command"],(function(e){"use strict";return e.extend({execute:function(e){require(["DS/PADServices/utils/GlobalModelEvents"],(function(e){e.getModelEvents().publish({event:"ENXViews/PADPager/close",data:"fromHome"}),e.getModelEvents().publish({event:"ENXViews/WelcomePanel/activate",data:"fromHome"})}))}})})),define("DS/PADServices/utils/ZipUtils",["UWA/Utils","DS/ZipJS/inflate","DS/ZipJS/deflate"],(function(e,t,i){"use strict";function n(){return"object"==typeof n.instance?n.instance:(n.instance=this,this)}return n.prototype.jsonZip=function(t){if(!t)return t;if(t.length>0&&"{"!==t[0]&&"["!==t[0])return t;var i=t;try{i=encodeURIComponent(t)}catch(e){}for(var n=new ArrayBuffer(i.length),o=new Uint8Array(n),s=0;s<i.length;s++)o[s]=i.charCodeAt(s);var r=new Deflater;r.append(o);var a=r.flush(),l=String.fromCharCode.apply(null,a);return"ZIP:"+e.base64Encode(l)},n.prototype.jsonUnzip=function(t){if(!t||!1===t.startsWith("ZIP:"))return t;var i=t=t.replace("ZIP:","");try{i=e.base64Decode(t)}catch(e){}for(var n=new ArrayBuffer(i.length),o=new Uint8Array(n),s=0;s<i.length;s++)o[s]=i.charCodeAt(s);var r=new Inflater,a=r.append(o);r.flush();var l=String.fromCharCode.apply(null,a);return l=decodeURIComponent(l)},new n})),define("DS/PADServices/utils/GlobalModelEvents",["DS/CoreEvents/ModelEvents"],(function(e){"use strict";var t=new e;return{getModelEvents:function(){return t},publish:function(e){return t.publish(e)},subscribe:function(e,i){return t.subscribe(e,i)},subscribeOnce:t.subscribeOnce,unsubscribe:function(e){return t.unsubscribe(e)},unsubscribeAll:function(e){return t.unsubscribeAll(e)}}})),define("DS/PADServices/utils/GrantedRolesCache",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],(function(e){"use strict";function t(){this._enabledMap=new Map}let i;return t.prototype={setup:function(e){this.options=e},initialize:async function(){let t=this;return new Promise(((i,n)=>{e.getGrantedRoles((function(e){let n=e.map((function(e){return e.id}));for(let e=0;e<n.length;e++)t._enabledMap.set(n[e],!0);i()}))}))},isEnabled:function(e,t){let i=this._enabledMap.get(e);return void 0===i&&!0!==t?!!this._enabledMap.get("InternalDS"):i}},i||(i=new t)})),define("DS/PADServices/utils/Meas",[],(function(){var e=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,t="undefined"!=typeof InstallTrigger,i=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),n=!!document.documentMode,o=window.navigator.userAgentData&&window.navigator.userAgentData.brands.filter((function(e){return-1!==e.brand.indexOf("Microsoft Edge")})).length>0,s=!!window.chrome&&!o,r={isOpera:e,isFirefox:t,isSafari:i,isIE:n,isEdge:o,isChrome:s,isBlink:(s||e)&&!!window.CSS};Object.freeze(r);var a=-1!=navigator.appVersion.indexOf("Win"),l=-1!=navigator.appVersion.indexOf("Mac"),d=-1!=navigator.appVersion.indexOf("Linux"),c={isWin:a,isMac:l,isUnix:-1!=navigator.appVersion.indexOf("X11"),isLinux:d};Object.freeze(c);var p,u="measure",h="mark";function m(e,t,i){this.name=t,this.section=e,this.section.start(t,i)}function f(e,t,i){this._perfPtr=e,this.name=t,this.startName=t+"_start",this.endName=t+"_end",this.measName=t+"_meas",i&&(this.options=i),this.hasMeasured=!1,this._perfPtr.mark(this.startName)}function g(e,t,i){this.perfPtr=e,this.name=t,this.trackerPrefix=i,this.enabled=!0,this.trackers={},this.sections={}}function v(e){this.perfPtr=e}function b(e){this.perfPtr=e}function S(e){this.perfPtr=e}function w(e){this.perfPtr=e,this.clearHelper=new v(this.perfPtr),this.lsHelper=new b(this.perfPtr),this.findHelper=new S(this.perfPtr)}function y(){this.trackers={},this.sections={},this.perfHelper=new w(this.perfPtr),window?this.setPerfPtr(window.performance):this.setPerfPtr(self.performance),this.enabled=!0}return m.prototype={end:function(){this.section.end(this.name)}},f.prototype={end:function(){this.hasEnded||(this._perfPtr.mark(this.endName),this.hasEnded=!0)},endnmeas:function(e){return this.end(),this.meas()},meas:function(){return this.hasMeasured||(this._perfPtr.measure(this.measName,this.startName,this.endName),this.hasMeasured=!0),this._findmeas()},_findmeas:function(){const e=this._perfPtr.getEntriesByType(u);for(let t=0;t<e.length;t++){const i=e[t];if(i.name===this.measName)return i}},dump:function(e){let t=this._perfPtr.getEntriesByType(u),i=this,n=t.filter((function(e){return e.name===i.measName}));if(this.options&&this.options.stats){let e=0,t=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,o=n.length;for(let s=0;s<o;s++){let o=n[s].duration;e+=o,o<t&&(t=o),o>i&&(i=o)}let s=e/o,r=0;for(let e=0;e<o;e++){r+=n[e].duration-s^2}r/=o;let a=Math.sqrt(r);this.calculated={cnt:o,min:t,max:i,avg:s,let:r,stddev:a};const l=`name=${this.name}, cnt=${o} avg=${s}, min=${t}, max=${i}, σ2=${r}, σ=${a}`;console.log(l)}else{let e=n.length;e>1&&console.warn("there are more than one entry...maybe you should do stats");let t=n[e-1];if(e){this.calculated={duration:t.duration};const e=`name=${this.name}, value=${t.duration}`;console.log(e)}}}},g.prototype={create:function(e,t){return new m(this,e,t)},start:function(e,t){if(this.enabled){var i=this.trackerPrefix+"."+e;this.trackers[e]&&(this.trackers[e].end(),this.trackers[e].meas()),this.trackers[e]=new f(this.perfPtr,i,t)}},end:function(e){this.enabled&&this.trackers[e]&&this.trackers[e].end()},enable:function(e){this.enabled=e;for(var t=Object.keys(this.sections),i=0;i<t.length;i++){var n=t[i];this.sections[n].enable(e)}},addOrGetSection:function(e){if(!this.enabled)return;let t=this.sections[e];if(t)return t;{const i=this.trackerPrefix+"."+e;t=this.sections[e]=new g(this.perfPtr,e,i)}return t},addOrGetTracker:function(e){if(!this.enabled)return;let t=this.trackers[e];if(t)return t;{const i=this.trackerPrefix+"."+e;t=this.trackers[e]=new f(this.perfPtr,e,i)}return t},meas:function(e){let t,i=Object.keys(this.trackers);for(let o=0;o<i.length;o++){var n=i[o];if(e===n){t=this.trackers[n].meas();break}}return t},dump:function(e){let t=e||"";t.length?t+="."+this.name:t=this.name;const i=Object.keys(this.trackers);for(let e=0;e<i.length;e++){const n=i[e];this.trackers[n].meas(),this.trackers[n].dump(t)}const n=Object.keys(this.sections);for(let e=0;e<n.length;e++){const i=n[e];this.sections[i].dump(t)}}},v.prototype={_set:function(e){this.perfPtr=e},mark:function(){this.perfPtr.clearMarks()},meas:function(){this.perfPtr.clearMeasures()}},b.prototype={_set:function(e){this.perfPtr=e},mark:function(){for(var e=this.perfPtr.getEntriesByType(h),t=[],i=0;i<e.length;i++)t.push(e[i].name);return t},meas:function(){for(var e=this.perfPtr.getEntriesByType(u),t=[],i=0;i<e.length;i++)t.push(e[i].name);return t}},S.prototype={_set:function(e){this.perfPtr=e},mark:function(e){for(var t=this.perfPtr.getEntriesByType(h),i=[],n=0;n<t.length;n++){var o=t[n];-1!==o.name.indexOf(e)&&i.push(o)}return i},meas:function(e){for(var t=this.perfPtr.getEntriesByType(u),i=[],n=0;n<t.length;n++){var o=t[n];-1!==o.name.indexOf(e)&&i.push(o)}return i}},w.prototype={_set:function(e){this._perfPtr=e,this.clearHelper._set(e),this.lsHelper._set(e),this.findHelper._set(e)}},Object.defineProperties(w.prototype,{clr:{get:function(){return this.clearHelper}},ls:{get:function(){return this.lsHelper}},find:{get:function(){return this.findHelper}}}),y.prototype={setPerfPtr:function(e){e.mark&&e.measure&&e.getEntriesByType&&(this._perfPtr=e,this.perfHelper._set(e),e.onresourcetimingbufferfull&&(e.onresourcetimingbufferfull=function(){console.error("You cannot make more marks and measures try upping your buffersize")}))},start:function(e){this.enabled&&(this.trackers[e]=new f(this.perfPtr,e))},end:function(e){this.enabled&&this.trackers[e]&&this.trackers[e].end()},endnmeas:function(e){if(this.enabled)return this.trackers[e]?this.trackers[e].endnmeas():void 0},meas:function(e){if(this.enabled)return this.trackers[e]?this.trackers[e].meas():void 0},specificMeas:function(e,t,i){return this.perfPtr.measure(e,t,i),this.perfPtr.getEntriesByType("measure").filter((function(t){return t.name===e}))},withMeas:function(e,t){try{this.start(e),t()}finally{this.end(e)}},addOrGetSection:function(e){if(!this.enabled)return;let t=this.sections[e];return t||(t=this.sections[e]=new g(this.perfPtr,e,e),t)},buildOrGetSection:function(e){const t=e.split(".");let i;for(let e=0;e<t.length;e++){const n=t[e];i=0===e?this.addOrGetSection(n):i.addOrGetSection(n)}return i},enable:function(e){this.enabled=e;const t=Object.keys(this.sections);for(let i=0;i<t.length;i++){const n=t[i];this.sections[n].enable(e)}},dump:function(){const e=Object.keys(this.sections);for(let t=0;t<e.length;t++){const i=e[t];this.sections[i].dump()}}},Object.defineProperties(y.prototype,{BrowserFlags:{value:r,writable:!1},OsFlags:{value:c,writable:!1},perf:{get:function(){return this.perfHelper}},perfPtr:{get:function(){return this._perfPtr}},buffersize:{set:function(e){this._perfPtr.setResourceTimingBufferSize&&this._perfPtr.setResourceTimingBufferSize(e)}}}),p||(p=new y,window?(window.meas=p,window.top.meas=p):self&&(self.meas=p)),p})),define("DS/PADServices/utils/PromiseHook",[],(function(){return function(e,t){e.then(t),e.catch(t)}})),define("DS/PADServices/views/ENXMePreferenceMigrationPanel",["i18n!DS/PADServices/assets/nls/PADServices.json","DS/Controls/Button","DS/Windows/Dialog"],(function(e,t,i){"use strict";function n(e){this.options=e,this._dialog=null,this.createDialog()}return n.prototype.createDialog=function(){const n=document.createElement("DIV"),o=document.createElement("P");o.innerHTML=`${e.mePreferenceMigrationPanel.docLabel} `;const s=document.createElement("A");s.id="helpLnk_PrefMigPanel",s.innerHTML=e.mePreferenceMigrationPanel.docLink,s.addEventListener("click",(()=>{this.options.callback.openDocumentation()})),o.appendChild(s);const r=document.createElement("P");r.innerHTML=`${e.mePreferenceMigrationPanel.prefPanelLabel} `;const a=document.createElement("A");a.id="mepLaunch_PrefMigPanel",a.innerHTML=e.mePreferenceMigrationPanel.prefPanelLink,a.addEventListener("click",(()=>{this.options.callback.openMePreferences(),this.close()})),r.appendChild(a);const l=new t({domId:"cancel_PrefMigPanel",label:e.mePreferenceMigrationPanel.close,onClick:this.close.bind(this)});n.appendChild(o),n.appendChild(r),this._dialog=new i({title:e.mePreferenceMigrationPanel.title+" - "+this.options.appName,content:n,identifier:"ENXMePreferenceMigrationPanel_"+this.options.appName,autoCloseFlag:!1,closeButtonFlag:!1,modalFlag:!0,buttons:{Cancel:l},checkboxInfos:{label:e.mePreferenceMigrationPanel.doNotShowAgain,checkFlag:!1},width:450}),this._dialog.addEventListener("close",this.close.bind(this))},n.prototype.close=function(){this.options.callback.onClose(this._dialog.checkboxInfos.checkFlag),this.destroy()},n.prototype.destroy=function(){this._dialog.destroy()},n})),define("DS/PADServices/utils/MePrefsAssist",["DS/PlatformAPI/PlatformAPI"],(function(e){"use strict";function t(){this._preferenceUpdateMap=new Map}let i;return t.prototype={getSettings:function(e){return new Promise(((t,i)=>{new Promise(((e,t)=>{require(["DS/MePreferencesClientAPI/MePreferencesClientAPI"],(function(t){e(t)}),t)})).then((n=>{n.readPreferences(e).then((e=>{t(e)})).catch(i)}))}))},hookForUpdates:function(t){let i=Object.keys(t.repos);for(let e=0;e<i.length;e++){let n=i[e];this._preferenceUpdateMap.set(n,t.repos[n])}e.subscribe("com.ds.mep:onPrefUpdate",this._preferenceUpdate.bind(this))},_preferenceUpdate:function(e){let t=JSON.parse(e[1].preferences);for(let e=0;e<t.repositories.length;e++){let i=t.repositories[e],n=this._preferenceUpdateMap.get(i.name);n&&n(t)}}},i||(i=new t)})),define("DS/PADServices/views/private/ColorView",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices.json","UWA/Class/View","UWA/Class/Options"],(function(e,t,i,n){"use strict";return i.extend(n,{className:"padcolorview",name:"padcolorview",template:function(){var e="";return this.selected_color.color===this.model.get("color")&&this.selected_color.background_color===this.model.get("background_color")&&(e=this.getClassNames("_cell_selected")),this.model.get("custom")?'                <div data-label="'+this.model.get("label")+'" class="'+this.getClassNames("_cell","_custom_cell")+e+'" style="background-color:'+this.model.get("background_color")+';">                <div class="'+this.getClassNames("_content","_custom_content")+' font-3dsregular" style="color:'+this.model.get("color")+';">'+t.colorView.content+"</div>                </div>":'                <div data-label="'+this.model.get("label")+'" class="'+this.getClassNames("_cell")+e+'" style="background-color:'+this.model.get("background_color")+';">                <div class="'+this.getClassNames("_content")+' font-3dsregular" style="color:'+this.model.get("color")+';">'+t.colorView.content+"</div>                </div>"},domEvents:{"click .padcolorview_cell":"_onSelect","click .padcolorview_content":"_onSelect"},setup:function(e){var i=e||{};this._parent(i),this.displayContent=t.colorView.content,i.selected_color?this.selected_color=i.selected_color:this.selected_color={background_color:"#ffffff",color:"#000000"},this.model.addEvent("onChange:selected",this.render.bind(this))},render:function(){return this.container.setHTML(this.template()),this.model.get("empty")?(this.container.getElement("div.padcolorview_cell").setStyle("border-color","#ffffff"),this.container.getElement("div.padcolorview_cell").addClassName("padcolorview_empty_cell")):this.container.getElement("div.padcolorview_cell").addClassName("padcolorview_active_cell"),this.elements.padcolorview_cell=this.container.getElement("div.padcolorview_cell"),this},toggleSelected:function(){!0===this.model.get("selected")?this.model.set("selected",!1):this.model.set("selected",!0)},isSelected:function(){return this.model.get("selected")},_onSelect:function(){this.model.set("empty",!1),this.selected_color.color=this.model._attributes.color,this.selected_color.background_color=this.model._attributes.background_color,this.toggleSelected(),this.dispatchEvent("select",this.model.get("label"))}})})),define("DS/PADServices/utils/GlobalUtils",["DS/PlatformAPI/PlatformAPI","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","UWA/Utils/Client","i18n!DS/PADUtils/assets/nls/PADUtils.json"],(function(e,t,i,n,o){"use strict";var s,r=null,a=null,l=null,d=null,c=null,p=void 0,u=!1;var h={setExecutionContext:function(e){a=(r=e).getComponent("AFR_NotificationManager")},getExecutionContext:function(){return r},displayError:function(e,t){a&&a.addNotif({title:e,message:t.message,level:"error"}),console.error(e),console.groupCollapsed("Error outputs"),console.error("Message:"+t.message),console.error("Stack:"+t.stack),console.groupEnd()},displayNotif:function(e){null===a&&(a=t,i.setNotificationManager(a),i.setStackingPolicy(5));if(e=UWA.extend({level:"info",sticky:!1},e),a.addNotif(e),"error"===e.level||"warning"===e.level){void 0===p&&(p=require("DS/PADServices/utils/PADTrackerManager"));var n=p.getPADTracker({eventCategory:"usage",eventAction:"notification"});n&&(n.setEventData({eventLabel:e.key?e.key:"no-key",eventValue:"error"===e.level?1:2}),n.trackPageEvent())}},uid:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},getLang:function(){return"undefined"!=typeof widget?widget.lang:"en"},deserializeDroppedData:function(e){for(var t,i={data:{items:[]}},n=UWA.is(e.dataTransfer.types.indexOf,"function")?"indexOf":"contains",o="",s=["text/searchitems","text/plain","Text"],r=0;r<s.length&&""===o;r++){var a=e.dataTransfer.types[n](s[r]);(UWA.is(a,"number")&&a>=0||UWA.is(a,"boolean")&&!0===a)&&(o=s[r])}if(""!==o){t=e.dataTransfer.getData(o);try{i=JSON.parse(t)}catch(e){}}return i},getUser:function(){return null==l&&(l=e.getUser()),l},getAdminUser:function(){return u},setAdminUser:function(e){!0===e&&(u=!0)},getUserLogin:function(){var e=h.getUser(),t="";return void 0!==e&&(t=e.login),t},getUserName:function(){var e=h.getUser(),t="";return void 0!==e&&(t=e.firstName+" "+e.lastName),t},getWidgetId:function(){return"undefined"!=typeof widget&&null!==widget?widget.id:"default-widget-id"},getAppId:function(){if("undefined"!=typeof widget&&null!==widget)return widget.getValue("x3dAppId")?widget.getValue("x3dAppId"):widget.getValue("appId")},getSharedId:function(){if("undefined"!=typeof widget)return widget.getValue("x3dSharedId")?widget.getValue("x3dSharedId"):this.getAppId()},getRequestLabel:function(){return h.getUserLogin()+"-"+h.getAppId()+"-"+Date.now()},setSecurityContext:function(e){s=e,require("DS/PADServices/utils/GlobalModelEvents").publish({event:"DS/CS/Updated"})},getSecurityContext:function(){return s},getSecurityContextLabel:function(){let e=s;if("undefined"!=typeof widget){let t=widget.getPreference("pad_security_ctx");for(let i=0;i<t.options.length;i++)if(t.options[i].value===s){e=t.options[i].label;break}}return e},retrieveAndSetSC:function(e){var t=require("DS/PADServices/ws/WSAccess"),i=this;return new Promise((function(e,n){t.getscandcollab().then((function(t){var n,o,s,r,a=UWA.is(t,"string")?JSON.parse(t):t;a.pid;for(var l in a.preferredcredentials){var d=a.preferredcredentials[l];switch(l){case"collabspace":o=d.name,d.title?d.title:o;break;case"organization":s=d.name;break;case"role":r=d.name}}if(void 0===o&&Array.isArray(a.collabspaces)&&a.collabspaces.length){let e=a.collabspaces[0];o=e.name,e.title;let t=e.couples[0];s=t.organization.name,r=t.role.name}n="ctx::"+r+"."+s+"."+o,i.setSecurityContext(n),e(n)})).catch(e)}))},createCSSClass:function(e,t){var i=document.getElementById(e);if(!UWA.is(i)){var n=document.createElement("style");n.type="text/css",n.id=e,n.innerHTML="."+e+t,document.getElementsByTagName("head")[0].appendChild(n)}},getURLParameter:function(e){return null===d&&((d=decodeURIComponent((new RegExp("[?|&]widgetDomain=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null)||(d=location.search.length?location.search:null)),d&&decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(d)||[null,""])[1].replace(/\+/g,"%20"))||null},isWebInWinContext:function(){return null===c&&(c="undefined"!=typeof widget?widget.getValue("addinmode"):""),"solidworks"===c||"catiav5"===c},isCEFCtx:function(){return"undefined"!=typeof dscef||"undefined"!=typeof CATCefSendString},hookTransitionEnd:function(e,t){var i=function(){var e,t=document.createElement("fakeelement"),i={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in i)if(void 0!==t.style[e])return i[e]}();if(i){var n=function(e){t(e)};return e.addEventListener(i,n),function(){e.removeEventListener(i,n)}}},getPCSPrefix:function(){return"undefined"==typeof widget?"ODTFallbackPrefix":widget.id+"_"+widget.title},isDataIndexed:function(){return new Promise(((e,t)=>{const i=require("DS/PADUtils/PADWSAccess"),n=require("DS/PADUtils/PADSession");i.getIndexingDate({service:["FTS","EXPAND"],onComplete:function(t){var i=JSON.parse(t),o=Number(i.EXPAND.allvaultsacl);n.determineAuthoredFlag()&&1e3*o>n.getLastAuthoredTimeStamp()?e(!0):e(!1)},onFailure:function(e){t(e)}})}))},isFakeTreeNodeModel:function(e){return void 0!==e.getNodeSource&&1===e.getNodeSource()?(e.options.isGroupingNode=!0,!0):!0===e.options.isGroupingNode},getLastDataIndexTime:function(){return new Promise(((e,t)=>{let i=o.genericWSFailure.noIndexTimeMsg;require("DS/PADUtils/PADWSAccess").getIndexingDate({service:["FTS","EXPAND"],onComplete:function(t){const n=JSON.parse(t);let o;if(n.FTS&&n.FTS.allvaultsacl){const e=new Date(1e3*n.FTS.allvaultsacl);let t=e.getHours(),i=e.getMinutes(),s=e.getSeconds();t<10&&(t="0"+t),i<10&&(i="0"+i),s<10&&(s="0"+s),o=t+":"+i+":"+s}else o=i;e(o)},onFailure:function(e){t(i)}})}))},downloadfile:function(e,t,i){var n=document,o=n.createElement("a");if(UWA.is(e)&&UWA.is(t)&&UWA.is(i)&&(i=i||"application/octet-stream","download"in o)){var s=URL.createObjectURL(new Blob([e],{type:i}));return o.setAttribute("href",s),o.setAttribute("download",t),o.innerHTML="downloading...",n.body.appendChild(o),setTimeout((function(){o.click(),n.body.removeChild(o),URL.revokeObjectURL(s)}),66),!0}},isMobileDevice:function(){return navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i)||this.isIOSDesktopMode()},isIOSDesktopMode:function(){return"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1},loadAMD:async function(e){return new Promise((t=>{require([e],(e=>{t(e)}))}))},loadAMDs:function(e){return new Promise(((t,i)=>{require(e,(()=>{t({loadedAMDs:e})}),(i=>{console.error("Cannot load following AMDs:\n"+JSON.stringify(i.requireModules,null,2));var n=[];for(let t=0;t<i.requireModules.length;t++){var o=i.requireModules[t].replace("pluginDS!","");const s=e.indexOf(o);s>-1&&e.splice(s,1),n.push(o)}t({loadedAMDs:e,notLoadedAMDs:n})}))}))},copyTexttoCLipboard:async function(e){if(navigator&&navigator.clipboard&&"function"==typeof navigator.clipboard.writeText)return new Promise((t=>{var i=document.createElement("textarea");i.classList.add("bookmark-txt-link"),i.value=e,i.select(),i.setSelectionRange(0,i.length),document.body.appendChild(i),navigator.clipboard.writeText(i.value).then((()=>{t(!0)}),(()=>{t(!1)})).finally((()=>{document.body.removeChild(i)}))}));var t=document.createElement("textarea");if(t.classList.add("bookmark-txt-link"),t.value=e,document.body.appendChild(t),n.Platform.hasOwnProperty("ios")&&!0===n.Platform.ios){t.contentEditable=!0,t.readOnly=!0;var i=document.createRange();i.selectNodeContents(t);var o=window.getSelection();o.removeAllRanges(),o.addRange(i),t.setSelectionRange(0,t.value.length)}else t.select();try{var s=document.execCommand("copy")}catch(e){}return document.body.removeChild(t),Promise.resolve(s)},launchURL:function(e){"documentation"===e.kind?require(["DS/WebUAUtils/WebUAUtils"],(t=>{t.displayHelp(e.topics)})):"directLnk"===e.kind&&e.url&&window.open(e.url,"_blank")}};return h})),define("DS/PADServices/utils/ParserUtils",["DS/ENOXParser/modules/Numbers"],(function(e){"use strict";return{parseAttributes:function(t){var i={};return t.forEach((function(t){UWA.is(t.value)&&UWA.is(t.value.replace,"function")&&(t.value=t.value.replace(/\n/g," ")),"physicalid"===t.name||"resourceid"===t.name?i.resourceid=t.value:"did"===t.name?i.did=t.value:"ro.plminstance.V_treeorder"===t.name?(i.relationOrder=parseFloat(t.value),isNaN(i.relationOrder)&&(i.relationOrder=-1)):"matrixtxt"===t.name?e.checkNotIdentity(t.value)&&(i.instanceMatrix=t.value):"type_icon_url"===t.name?(i.icons||(i.icons=[]),i.icons.push(t.value)):"thumbnail_2d"===t.name||"preview_url"===t.name?(i.thumbnail=t.value,i.grid||(i.grid={}),i.grid.thumbnail="url("+t.value+")"):"ds6w:label"===t.name?(i.label=t.value,i.display=i.label):(i.grid||(i.grid={}),i.grid[t.name]=t.value)})),i.relationOrder||(i.relationOrder=-1),i}}})),define("DS/PADServices/views/ENXModal",["css!DS/PADServices/PADServices.css","DS/Utilities/Dom","DS/Windows/Dialog"],(function(e,t,i){"use strict";function n(e){this.elements={},this.options=e||{},this.options=Object.assign({target:null,events:{onClose:this.close.bind(this)},closeCB:void 0},this.options);var n=Object.assign({resizableFlag:!0,modalFlag:!0,position:{my:"top",at:"top"},height:"auto",width:"auto"},this.options);return this.elements.dialog=new i(n),this.elements.dialog.addEventListener("close",this.close.bind(this)),this.options.modalOpened=!0,document.querySelector(".wux-windows-modalDialog").addEventListener("click",function(e){t.firstParentWithClass(e.target,"wux-windows-window-content")||"function"!=typeof this.options.events.onClickOutsideContent||this.options.events.onClickOutsideContent()}.bind(this)),this}return n.prototype.close=function(){!0===this.options.modalOpened&&(this.options.modalOpened=!1,this.elements.dialog.close(),this.elements.dialog=null,this.options.closeCB&&this.options.closeCB())},n.prototype.destroy=function(){!0===this.options.modalOpened&&this.close(),delete this.options},n.prototype.getContent=function(){return this.elements.dialog.getContent()},n})),define("DS/PADServices/views/private/ENXMask",["DS/Controls/ModalContainer","DS/Controls/Loader"],(function(e,t){"use strict";function i(e){return"object"==typeof i.instance?i.instance:(i.instance=this,this.elements={},this.currentTarget=null,this)}return i.prototype.mask=function(i,n){null!==this.currentTarget&&this.currentTarget!==i&&this.unmask(this.currentTarget),this.currentTarget=i,void 0===this.elements.loader&&(this.elements.loader=new t({}),this.elements.loader.getContent().addClassName("ENXMask-loader")),this.elements.loader.on(n),e.createModal(i,this.elements.loader.getContent())},i.prototype.unmask=function(t){this.currentTarget===t&&(this.currentTarget=null,this.elements.loader.off(),e.removeModal(t))},new i})),define("DS/PADServices/views/ProgressDialog",["DS/Windows/Dialog","DS/Controls/ProgressBar","DS/Utilities/Dom","DS/PADServices/utils/GlobalModelEvents","DS/Controls/Button"],(function(e,t,i,n,o){"use strict";function s(s){this.options=s||{},this.options=Object.assign({width:230,height:45,progressBar:{displayStyle:"lite",infiniteFlag:!0},renderTo:document.body},this.options),this.elements={},this.elements.progressBar=new t(this.options.progressBar);var r=void 0;!0!==s.noCancel&&(r={Cancel:new o({onClick:function(e){console.log("Export is Cancelled "),n.publish({event:"ENXViews/ExportAs/CancelExportOrPrint"})}})}),this.elements.dialog=new e({modalFlag:!0,title:this.options.title,content:this.elements.progressBar.getContent(),closeButtonFlag:!1,width:this.options.width,showTitleFlag:!1,buttons:r}),this.elements.dialog.getContent().setStyle("z-index",void 0),i.addEndResizeListener(this.options.target,this.setPosition.bind(this),100),this.setPosition(),this.options.modalOpened=!0,document.querySelector(".wux-windows-modalDialog").addEventListener("click",function(e){i.firstParentWithClass(e.target,"wux-windows-window-content")||"function"!=typeof this.options.events.onClickOutsideContent||this.options.events.onClickOutsideContent()}.bind(this))}return s.prototype.setProgress=function(e){this.elements.progressBar.value=e},s.prototype.setPosition=function(){if(this.elements.container){var e=this.options.renderTo.getBoundingClientRect(),t={x:e.x+(e.width/2-this.options.width/2),y:e.x+(e.height/2-this.options.height/2)};this.elements.container.getContent().setStyles({left:t.x,top:t.y})}},s.prototype.close=function(){delete this.elements.progressBar,this.options.modalOpened=!1,this.elements.dialog.destroy(),this.elements.dialog=null},s})),define("DS/PADServices/utils/HideShowController",["DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADCommandProxy","DS/PADServices/utils/GlobalModelEvents"],(function(e,t,i){const n={isPADHidden:!0},o={isPADHidden:!1},s={icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-eye pad_eye "},label:"show"},r={icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-eye-off pad_eye_off"},label:"hide"},a={HIDDEN:0,SHOWN:1,MIXED:2},l={UI:10,PROXY:20,PGP:30},d={SHOW:{isHiddenState:a.SHOWN},HIDDEN:{isHiddenState:a.HIDDEN},MIXED:{isHiddenState:a.MIXED}},c={icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-eye pad_eye "},label:"show"},p={icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-eye-off pad_eye_off"},label:"hide"},u={icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-eye-partial pad_eye_partial"},label:"mixed"};function h(e){let t=[];if(!e.isRoot()){let i=e.getParent();for(;i&&(t.push(i),!i.isRoot());)i=i.getParent()}return t}function m(e){if(!e.isRoot()){var t=e.options.isHiddenState;t===d.MIXED.isHiddenState&&(e.options.prevIsHiddenState=t)}}function f(e){var t=e.options.prevIsHiddenState;return void 0!==t&&(delete e.options.prevIsHiddenState,e.updateOptions({isHiddenState:t}),!0)}function g(){e.getSetting("explorerOcc")||(this._isThreeStates=e.getSetting("activateFUN105429"),this._hiddenPaths=new Map,this._shownPaths=new Map,i.subscribe({event:"ENXModel/hideShowState"},this._hideShowUpdate.bind(this)),i.subscribe({event:"ENXModel/Root/remove"},function(e){if(e.all)this._hiddenPaths.clear(),this._shownPaths.clear();else{for(let[t,i]of this._hiddenPaths)e.pids.includes(i[0])&&this._hiddenPaths.delete(t);for(let[t,i]of this._shownPaths)e.pids.includes(i[0])&&this._shownPaths.delete(t)}}.bind(this)))}var v;return g.prototype={defaultHiddenState:function(t){e.getSetting("pgpFromServer")?this._isThreeStates&&(t.isPADHidden?t.isHiddenState=a.HIDDEN:t.isHiddenState=a.SHOWN):t.isHiddenState=a.SHOWN},cleanupOptions:function(e,t){let i=e.options;void 0===i.isHiddenState||i.isHiddenState===t.isHiddenState||i.isHiddenStateFrom!==l.UI&&i.isHiddenStateFrom!==l.PROXY||(delete t.isHiddenState,delete t.isPADHidden)},gatherParentsIfHidden:function(e,t){if(this._isThreeStates&&t.options.isHiddenState===a.HIDDEN){let i=h(t);for(let t=0;t<i.length;t++){let n=i[t];e.indexOf(n)&&e.push(n)}}},gatherParentsIfHiddenOrShown:function(e,t){if(this._isThreeStates&&(t.options.isHiddenState===a.HIDDEN||t.options.isHiddenState===a.SHOWN)){let i=h(t);for(let t=0;t<i.length;t++){let n=i[t];-1===e.indexOf(n)&&e.push(n)}}},calculateParents:function(e,t,i){if(this._isThreeStates){e.sort((function(e,t){return t.getDepth()-e.getDepth()}));for(let n=0;n<e.length;n++)this._calculateParentState(e[n],t,i)}},determineIcon:function(e){if(!this._isThreeStates)return e.options.isPADHidden&&!0===e.options.isPADHidden?r:s;switch(e.options.isHiddenState){case a.HIDDEN:return p;case a.MIXED:return u;default:return c}},determineTooltip:function(e,t){let i;if(e.options.isHiddenState===a.HIDDEN)i={shortHelp:t.columnsDef.hide,updateModel:!1};else i={shortHelp:t.columnsDef.show,updateModel:!1};return i},shouldeRecalculate:function(e){let t=e.options;return t.isHiddenState===a.HIDDEN||t.isHiddenState===a.MIXED},updateHideShowStatus:function(e,t){this._hide(e),this._show(t)},clearHiddenState:function(e){let t=performance.now();this.parentList=new Map,this._show(e,!0,l.UI),this._hiddenPaths.clear(),this._shownPaths.clear();let i=performance.now();console.log("PERFORMANCE : ",i-t)},_hideShowUpdate:function(e){var t=e.target,i="show"===e.data.toggle;let n=e.data.fromUI?l.UI:l.PROXY;var o=e.data.nobroadcast;i?this._show(t,o,n):this._hide(t,o,n)},_hide:function(e,t,i){var o=()=>{if(this._isThreeStates)for(let n=0;n<e.length;n++){this._hideMultiState(e[n],t,i);let o=e[n]._id;this._hiddenPaths.set(o,e[n].getOccurencePath()),this._shownPaths.delete(o)}else for(let t=0;t<e.length;t++){e[t].updateOptions(n);let i=e[t]._id;this._hiddenPaths.set(i,e[t].getOccurencePath()),this._shownPaths.delete(i)}};let s;e&&e.length&&(s=e[0].getTreeDocument()),s?s.withTransactionUpdate(o):o()},_show:function(e,t,i){var n=()=>{if(this._isThreeStates)for(let n=0;n<e.length;n++){this._showMultiState(e[n],t,i);let o=e[n]._id;this._shownPaths.set(o,e[n].getOccurencePath()),this._hiddenPaths.delete(o)}else for(let t=0;t<e.length;t++){e[t].updateOptions(o);let i=e[t]._id;this._shownPaths.set(i,e[t].getOccurencePath()),this._hiddenPaths.delete(i)}};let s;e&&e.length&&(s=e[0].getTreeDocument()),s?s.withTransactionUpdate(n):n()},_showMultiState:function(e,t,i){if(void 0!==i&&(e.options.isHiddenStateFrom=i),void 0!==e.options.finalHiddenState&&e.options.finalHiddenState===e.options.isHiddenState)return void delete e.options.finalHiddenState;let n=!1;f(e)||(m(e),this._determineMixedOnShow(e)?(e.updateOptions(d.MIXED),n=!0):(e.updateOptions(d.SHOW),e.updateOptions(o)),delete e.options.hiddenStateSet),n||e.options.isHiddenState===d.HIDDEN.isHiddenState&&(e.updateOptions(d.SHOW),delete e.options.hiddenStateSet);let s=h(e);this._nobroadcast=t,this.parentList&&this.parentList.clear(),this.parentList=new Map;for(let t=0;t<s.length;t++){let i=s[t].options;if(i.isPADHiddenInstance||i.isPADHiddenReference||i.isPADHiddenOccurrence)break;if(this.parentList&&!this.parentList.has(s[t]._id+"_"+s[t].getLabel()))s[t].options.isHiddenState===d.HIDDEN.isHiddenState&&e.options.isHiddenState===d.SHOW.isHiddenState?this._calculateParentState(s[t],!0):this._calculateParentState(s[t]),this.parentList.set(s[t]._id+"_"+s[t].getLabel(),!0);else{if(!this.parentList||!this.parentList.has(s[t]._id+"_"+s[t].getLabel())||e.options.isPADHidden===s[t].options.isPADHidden)continue;this._calculateParentState(s[t])}}},_hideMultiState:function(e,t,i){if(void 0!==i&&(e.options.isHiddenStateFrom=i),!t&&void 0!==e.options.finalHiddenState&&e.options.finalHiddenState===e.options.isHiddenState&&(delete e.options.finalHiddenState,e&&!e.isRoot()))return;f(e)||(m(e),e.updateOptions(d.HIDDEN),e.options.ignoreRebound?delete e.options.ignoreRebound:e.options.hiddenStateSet=!0);let n=h(e);this._nobroadcast=t;for(let e=0;e<n.length;e++)this._calculateParentState(n[e]);delete this._nobroadcast},_determineMixedOnShow:function(e){let t=!1;if(e.hasChildren()){let i=e.getChildren();for(let e=0;e<i.length;e++){let n=i[e];if(t=n.options.isHiddenState===a.HIDDEN||n.options.isHiddenState===a.MIXED,t)break;t=this._determineMixedOnShow(n)}}return t},_calculateParentState:function(e,t,i){i=void 0!==i&&i;let n=e.options;if((n.isHiddenState!==a.HIDDEN||n.isHiddenStateFrom!==l.PGP)&&e.hasChildren()){if(e.options.isHiddenState===a.HIDDEN&&e.options.hiddenStateSet)return;let n=e.getChildren().filter((function(e){return!0!==e.isRelationsObjectGroupingNode})),o=n.filter((function(e){return e.options.isHiddenState===a.SHOWN})),s=n.filter((function(e){return e.options.isHiddenState===a.HIDDEN}));n.filter((function(e){return e.options.isHiddenState===a.MIXED}));if(function(e){return!e.childComputed&&!e.options.childComputed||"partiallyExpanded"===e.getState()}(e)&&!i)return void(o.length===n.length?e.updateOptions(d.SHOW):e.updateOptions(d.MIXED));o.length===n.length||e.options.isHiddenState===a.HIDDEN&&e.options.hiddenStateSet?e.updateOptions(d.SHOW):s.length===n.length?e.updateOptions(d.HIDDEN):(e.options.isHiddenState===a.HIDDEN&&(m(e),e.options.finalHiddenState=d.MIXED.isHiddenState),t&&(e.options.finalHiddenState=d.MIXED.isHiddenState),e.updateOptions(d.MIXED))}},getHiddenPathsAsArray:function(){return Array.from(this._hiddenPaths.values())},getShownPathsAsArray:function(){return Array.from(this._shownPaths.values())}},Object.defineProperties(g.prototype,{isThreeStates:{get:function(){return this._isThreeStates}},STATES:{get:function(){return a}},FROMS:{get:function(){return l}}}),v||(v=new g),v})),define("DS/PADServices/views/ENXDropDiv",["i18n!DS/PADServices/assets/nls/PADServices.json","css!DS/PADServices/PADServices.css","DS/PADServices/views/ENXDropTarget","DS/ENOXEmptyContent/js/ENOXEmptyContent","DS/CoreEvents/ModelEvents","DS/Controls/Button"],(function(e,t,i,n,o,s){"use strict";const r="enx-dropdiv";var a=function(e){this.options=Object.assign({isOver:!1,withEmptyInvite:!1,openSearchFilter:'flattenedtaxonomies:"types/VPMReference" OR flattenedtaxonomies:"types/VPMRepReference" OR flattenedtaxonomies:"types/ENOStrRefinementSpecification"'},e),this.options.modelEvents||(this.options.modelEvents=new o),this.elements={},this.elements.container=document.createElement("div"),this.elements.container.classList.add(r),this.options.className&&this.elements.container.classList.add(this.options.className),this.elements.content=document.createElement("div"),this.elements.content.classList.add(r+"-content"),this.elements.container.append(this.elements.content),!0===this.options.withEmptyInvite&&(this.__createEmptyInvite(),this.options.modelEvents.subscribe({event:"DS/ENXDropInvite/displayEmptyInvite"},this.displayEmptyInvite.bind(this))),this.options.dropTarget=new i({backgroundOnDefault:!0!==this.options.withEmptyInvite}),this.options.dropTarget.onOpenInCtx=this.__onOpenInCtx.bind(this),this.options.dropTarget.onOpenAndFilter=this.__onOpenAndFilter.bind(this),this.elements.container.appendChild(this.options.dropTarget.render()),this.__addDnDCB(this.elements.container)};return a.prototype.render=function(){return this.elements.container},a.prototype.getContentDiv=function(){return this.elements.content},a.prototype.getMainClassName=function(){return r},a.prototype.displayEmptyInvite=function(e){!0===e?this.elements.emptyDiv.removeAttribute("hidden"):this.elements.emptyDiv.setAttribute("hidden","")},a.prototype.onOpen=function(e){},a.prototype.onOpenInCtx=function(e){},a.prototype.onOpenAndFilter=function(e){},a.prototype.onOpenFromEmpty=function(e){},a.prototype.__onOpenInCtx=function(e){this.options.isOver=!1,this.options.dropTarget.hide(),this.elements.container.classList.remove("hover"),this.options.emptyHiddenByOver=!1,this.onOpenInCtx(e)},a.prototype.__onOpenAndFilter=function(e){this.options.isOver=!1,this.options.dropTarget.hide(),this.elements.container.classList.remove("hover"),this.options.emptyHiddenByOver=!1,this.onOpenAndFilter(e)},a.prototype.__addDnDCB=function(e){e.addEventListener("drop",this.__dropped.bind(this)),document.addEventListener("dragover",this.__dragOver.bind(this)),document.addEventListener("dragend",this.__dragEnd.bind(this)),document.addEventListener("dragleave",this.__dragLeave.bind(this))},a.prototype.__dropped=function(e){return this.onOpen(e),this.options.isOver=!1,this.options.dropTarget.hide(),this.elements.container.classList.remove("hover"),this.options.emptyHiddenByOver=!1,!0},a.prototype.__dragOver=function(e){return this.__isInside(e)&&(this.options.isOver=!0,this.elements.container.classList.add("hover"),this.options.dropTarget.show(),this.options.withEmptyInvite&&!1===this.elements.emptyDiv.hasAttribute("hidden")&&(this.options.emptyHiddenByOver=!0,this.displayEmptyInvite(!1))),e.preventDefault(),!0},a.prototype.__dragLeave=function(e){this.__isInside(e)||setTimeout((()=>{!1===this.options.dropTarget.isOver()&&(this.options.isOver=!1,this.options.dropTarget.hide(),this.elements.container.classList.remove("hover"),this.options.emptyHiddenByOver&&(this.options.emptyHiddenByOver=!1,this.displayEmptyInvite(!0)))}),50)},a.prototype.__dragEnd=function(e){this.options.isOver=!1,this.options.dropTarget.hide(),this.elements.container.classList.remove("hover"),this.options.emptyHiddenByOver=!1},a.prototype.__isInside=function(e){let t=(o=0,s=0,(n=e).pageX||n.pageY?(o=n.pageX,s=n.pageY):(n.clientX||n.clientY)&&(o=n.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,s=n.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:o,y:s}),i=!1;var n,o,s,r,a;return this.options.containerRec=this.elements.container.getBoundingClientRect(),r=t,a=this.options.containerRec,r.y>=a.top&&r.y<=a.bottom&&r.x>=a.left&&r.x<=a.right&&(i=!0),i},a.prototype.__createEmptyInvite=function(){this.elements.emptyDiv=document.createElement("div"),this.elements.emptyDiv.classList.add(r+"-empty"),this.elements.container.append(this.elements.emptyDiv);var t=new s({label:e.dropdiv.openContent,emphasize:"primary"});t.getContent().addClassName(r+"-openContent"),t.addEventListener("click",(()=>{this.__launchOpen()})),this.elements.emptyContent=new n({modelEvents:this.options.modelEvents,sentences:[{type:"drop",text:e.dropdiv.dropcontenthere},{type:"dom",DOMelement:t.getContent()}],fontSize:"16px",orderedListType:"none"}),this.elements.emptyContent.inject(this.elements.emptyDiv)},a.prototype.__launchOpen=function(){return new Promise((t=>{require(["DS/PADServices/utils/SearchUtils"],(i=>{let n=()=>{t()};var o={title:e.dropdiv.openContent,search_criteria_to_display:"",fts_value:this.options.openSearchFilter,showApplyButton:!0,applyButton_Nls:e.dropTarget.openAndFilterTitle,callback:e=>{var t=i.createDropDataFromSearch(e);this.onOpenFromEmpty({mode:"drop",behavior:"WITH_CONTEXT",unserializedData:t}),n()},apply:e=>{var t=i.createDropDataFromSearch(e);this.onOpenFromEmpty({mode:"drop",behavior:"FILTER",unserializedData:t}),n()},cancel:n};i.inAppsSearch(o)}))}))},a})),define("DS/PADServices/utils/CommandProxy",["text!DS/PADServices/assets/init/CommandProxyRsc.json","text!DS/PADServices/assets/init/CommandProxyRsc_karma.json","DS/PlatformAPI/PlatformAPI","DS/ENOXInterWdgCom/Proxy","DS/PADServices/utils/GlobalUtils"],(function(e,t,i,n,o){"use strict";var s=window.__karma__?JSON.parse(t):JSON.parse(e),r={};function a(){var e="/no_private_channel";return"undefined"!=typeof widget&&null!==widget&&(void 0!==widget.getValue("x3dSharedId")?e="/"+widget.getValue("x3dSharedId"):void 0!==widget.getValue("x3dAppId")?e="/"+widget.getValue("x3dAppId"):void 0!==widget.getValue("appId")&&(e="/"+widget.getValue("appId")+"_"+widget.id)),e}return r.create=function(e){var t;return e&&(t=e.events),new n({prefix:"DS/PADUtils/PADCommandProxy/",privateChannel:a(),commands:s,events:t})},r.appId=function(){return a()},r})),define("DS/PADServices/views/private/ENXDnD",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices","DS/Utilities/Dom","DS/PADServices/utils/GlobalUtils"],(function(e,t,i,n){"use strict";const o="enx-dnd";function s(e){return this.options=e||{},this.options=Object.assign({containerSuffix:""},this.options),this.elements={},this.__buildUX(),this.__addListeners(),this}return s.prototype.getDOM=function(){return this.elements.container},s.prototype.__buildUX=function(){this.elements.container=i.createElement("div",{id:this.options.idCmp,class:o+" "+this.options.containerSuffix}),this.elements.dndZones=[];let e=i.createElement("div",{class:o+"-dropZone dropZone1"});this.elements.dndZones.push(e);let n=i.createElement("div",{class:o+"-openInCtx dropInvite dropInvite1"}),s=i.createElement("div",{class:o+"-icon"});s.appendChild(i.generateIcon({iconName:"drag-drop ",fontIconSize:"3x",fontIconFamily:1})),n.appendChild(s);let r=i.createElement("div",{class:o+"-label"});r.innerText=t.dropTarget.openInCtxTitle,n.appendChild(r),e.appendChild(n);let a=i.createElement("div",{class:o+"-dropZone dropZone2"});this.elements.dndZones.push(a);let l=i.createElement("div",{class:o+"-open dropInvite dropInvite2"}),d=i.createElement("div",{class:o+"-icon"});d.appendChild(i.generateIcon({iconName:"drag-drop ",fontIconSize:"3x",fontIconFamily:1})),l.appendChild(d);let c=i.createElement("div",{class:o+"-label"});c.innerText=t.dropTarget.openTitle,l.appendChild(c),a.appendChild(l);let p=i.createElement("div",{class:o+"-dropZone dropZone3"});this.elements.dndZones.push(p);let u=i.createElement("div",{class:o+"-openFilter dropInvite dropInvite3"}),h=i.createElement("div",{class:o+"-icon"});h.appendChild(i.generateIcon({iconName:"filter-open",fontIconSize:"3x",fontIconFamily:1})),u.appendChild(h);let m=i.createElement("div",{class:o+"-label"});m.innerText=t.dropTarget.openAndFilterTitle,u.appendChild(m),p.appendChild(u),this.elements.container.appendChild(e),this.elements.container.appendChild(a),this.elements.container.appendChild(p)},s.prototype.__addListeners=function(){function e(e){e.preventDefault(),e.stopPropagation()}this.options.main.addEventListener("dragenter",(e=>-1===e.dataTransfer.types.indexOf("Files")?(this.options.dropContainer.removeAttribute("hidden"),!0):(e.dataTransfer.dropEffect="none",e.dataTransfer.effectAllowed="none",!1)),!1),this.options.main.addEventListener("dragover",(e=>(e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="none",e.dataTransfer.effectAllowed="none",!1))),["dragleave","drop"].forEach((t=>{this.options.main.addEventListener(t,e,!1)})),this.options.dropContainer.addEventListener("dragleave",(e=>{this.options.dropContainer.setAttribute("hidden","")})),["dragenter","dragover","dragleave","drop"].forEach((t=>{this.elements.dndZones.forEach((i=>{i.addEventListener(t,e,!1)}))})),["dragenter","dragover"].forEach((e=>{this.elements.dndZones.forEach((t=>{t.addEventListener(e,i,!1)}))})),["dragleave","drop"].forEach((e=>{this.elements.dndZones.forEach((t=>{t.addEventListener(e,o,!1)}))}));var t=this;function i(e){e.target.classList.add("highlight")}function o(e){e.target.classList.remove("highlight")}function s(e){t.options.dropContainer.setAttribute("hidden","");let i,o=n.deserializeDroppedData(e);e.target.classList.contains("dropZone1")?i="WITH_CONTEXT":e.target.classList.contains("dropZone2")?i="WITHOUT_CONTEXT":e.target.classList.contains("dropZone3")&&(i="FILTER"),t.__openDropContent({behavior:i,dataTransfer:o})}this.elements.dndZones.forEach((e=>{e.addEventListener("drop",s,!1)}))},s.prototype.__openDropContent=function(e){"function"==typeof this.options.openDropContent&&this.options.openDropContent(e)},s})),define("DS/PADServices/utils/Batches",["DS/PADServices/utils/Iterator","DS/PADServices/utils/WaitingPromise"],(function(e,t){function i(e,t,i,n){var o=-1;return function(){if(++o<=e.length-1){var s=e[o];i(s,t)}else n()}}function n(e,t,i){var n=[],o=e.length;if(o>=t)for(var s=0;s<o;s+=i)n.push(e.slice(s,s+i));else n.push(e);return n}return{breakup:n,stepper:i,promStepper:function(e,t,o,s,r){let a,l=n(e,t,o);return a=i(l,null,(function(e){new Promise((function(t,i){s(e,t)})).then(a)}),(function(){r()})),a},chain:function(e,t,i,o){let s=n(e,t,i),r=[],a=1,l=s.length;return new Promise((function(e,t){s.reduce((function(t,i){return t.then((function(){let t=o(i,a);return a++,r.push(t),r.length===l&&e({promises:r}),t}))}),Promise.resolve())}))},waiting:function(i,o,s,r){let a=n(i,o,s),l=Promise.resolve(),d=[];return e.iterate(a,(function(e,i){d.push({batch:e,batchId:i+1,waiting:new t})})),results=d.map((function(e){return e.waiting})),e.iterate(d,(function(e){l.then((function(){e.work=r(e.batch,e.batchId),e.work.then((function(t){e.waiting.resolve(t)})),l=e.waiting}))})),results}}})),define("DS/PADServices/utils/private/TreeDocUpdate",["DS/PADServices/utils/PromiseCompletion"],(function(e){return function(t,i){this._completion=new e({before:function(){t.prepareUpdate()},after:function(){t.pushUpdate()},promise:i})}})),define("DS/PADServices/utils/PlatformURL",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/PADServices/utils/GlobalUtils"],(function(e,t){"use strict";var i=null,n={retrievePlatformUrl:async function(t){var n=this;return new Promise((function(o,s){var r=[];null===i&&r.push(new Promise((function(t,o){e.getPlatformServices({onComplete:function(e){n.__checkURLs(e).then((e=>{i=e,t()}))},onFailure:function(e){o(e)}})}))),t&&!0===t.initWSAcess&&r.push(new Promise((function(e,i){require(["DS/PADServices/ws/WSAccess"],(function(n){n.initialize({addDefaults:t.addDefaults,WSDefinitionAMDs:t.WSDefinitionAMDs}).then(e).catch(i)}),i)}))),Promise.all(r).then(o).catch(s)}))},getPlatformId:function(){return"undefined"!=typeof widget&&null!==widget&&widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"},isCloud:function(){return"onpremise"!==this.getPlatformId().toLowerCase()},getTenantInfo:function(e){for(var t={},n=0;n<i.length;n++)if(i[n].platformId===e){t=i[n];break}return t},get3DSpaceURL:function(){return n.getPlatformURL("3DSpace")},get3DSwymURL:function(){if(!UWA.is(i,"array"))throw new Error("Platform services not initialize yet");var e=n.getPlatformId(),t=n.getTenantInfo(e);return void 0===t["3DSwym"]?null:t["3DSwym"]},getPlatformURL:function(e){if(!UWA.is(i,"array"))throw new Error("Platform services not initialize yet");var t=n.getPlatformId(),o=n.getTenantInfo(t);if(void 0===o[e])throw console.error("No "+e+" URL available for this tenant."),new Error("Unknown service "+e);return o[e]},getAppInfo:function(t){return new Promise((i=>{e.getAppInfo({appId:t,onComplete:e=>{i(e)}})}))},__checkURLs:function(i){return new Promise((n=>{var o=!1;"undefined"!=typeof widget&&widget.getValue("noCompass")&&(o=!0);var s=!1;if(!o&&"undefined"!=typeof widget&&i&&i.length>1){var r=i[0].platformId;r&&-1===["OnTenant1","odt_tenant","OnPremise"].indexOf(r)&&(s=!0)}s?e.getAppInfo({appId:t.getAppId(),onComplete:function(e){var t=[],o=!!e.tenantAware&&e.tenantAware;if(o){for(var s=0;s<e.platforms.length;s++)for(var r=0;r<i.length;r++)if(!o||i[r].platformId===e.platforms[s].id){t.push(i[r]);break}}else t=i;n(t)},onFailure:function(e){console.error("Cannot retrieve the App Info"),n(i)}}):n(i)}))}};return n})),define("DS/PADServices/views/private/SoITimelineV1",["css!DS/PADServices/PADServices.css","i18n!DS/PADServices/assets/nls/PADServices.json","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils","DS/PADUtils/PADSettingsMgt","DS/Utilities/Dom","DS/Controls/TooltipModel","DS/Windows/Panel","DS/Controls/Expander","DS/Controls/Toggle","DS/Controls/Slider","DS/ENOXInterWdgCom/LinkManager"],(function(e,t,i,n,o,s,r,a,l,d,c,p){"use strict";const u="soi-timeline-v1";function h(e){return this.options=e||{},this.isUsable=!0,this._visibility=e.visibility,this.options=Object.assign({dateFormatOptions:{dateStyle:"long",timeStyle:"medium"},sliderStops:[],data:void 0,events:{}},this.options),this.elements={},this._BSCenter=e.BSCenter,this.__preprocessData(),this.__buildUX(e),this}return h.prototype.close=function(e){!0===this.__surveyLoadingInProgress?this.__removeIdWhenLoaded=e:e===this.getActiveStateId()&&(delete this.__removeIdWhenLoaded,delete this.elements.content,this.elements.panel.close(),"function"==typeof this.options.events.closeTimeline&&this.options.events.closeTimeline(this.options.data.soiData.resourceid))},h.prototype.__preprocessData=function(){const e=this.options.data.states[this.options.data.selectedState].resourceid;this.options.data.states.sort(((e,t)=>e.grid["r2v:fsEffectivityDate"]>t.grid["r2v:fsEffectivityDate"]?1:e.grid["r2v:fsEffectivityDate"]<t.grid["r2v:fsEffectivityDate"]?-1:0));for(let t=0;t<this.options.data.states.length;++t)if(this.options.data.states[t].resourceid===e){this.options.loadedStateIdx=t,this.options.data.selectedState=t;break}},h.prototype.__buildUX=function(e){this.elements.content=s.createElement("div",{class:u+"-container"}),this.__buildContentUX(e),p.subscribe("DS/ExternalWdgtCom/StateStopClicked",this._onReceiveStateStopClicked.bind(this)),this.elements.panel=new a({identifier:"PAD3DSoITimeline",immersiveFrame:this.options.immersiveFrame,title:this.options.data.soiData["ds6w:label"],icon:"url("+this.options.data.soiData.icon+")",content:this.elements.content,resizableFlag:!1,maxHeight:140,minHeight:40,allowedDockAreas:WUXDockAreaEnum.TopDockArea,horizontallyStretchableFlag:!0,verticallyStretchableFlag:!0,collapsibleFlag:!1,closeButtonFlag:!1}),this._visibility?this.show():this.hide()},h.prototype.show=function(){this._visibility=!0,this.elements.panel&&this.elements.panel.show()},h.prototype.hide=function(){this._visibility=!1,this.elements.panel&&this.elements.panel.hide()},h.prototype.__buildContentUX=function(e){this.elements.stateTimeline=s.createElement("div",{class:u+"-states-line"}),this.elements.stateOptionsTimeline=s.createElement("div",{class:u+"-states-options"}),this.elements.stateOptions=s.createElement("div",{class:u+"-options"}),"afr"===o.getSetting("eno3dviewer_infrastructure_version")&&(this.elements.mode360Toggle=new d({type:"switch",label:t.soiTimelineV1.show360,value:0,checkFlag:this.options.mode360Activated}),this.elements.mode360Toggle.inject(this.elements.stateOptions),this.elements.mode360Toggle.addEventListener("change",(e=>{window.localStorage.setItem("SoITimeline360ModeState",e.dsModel.checkFlag),this.options.events.on360ModeChangedCB({checkFlag:e.dsModel.checkFlag,BSCenter:this._BSCenter})})),this.elements.mode360Title=s.createElement("label",{class:u+"-mode360-title"}),this.elements.mode360Title.innerHTML=t.soiTimelineV1.view),this.elements.splattingSliderOptionsDiv=s.createElement("div",{class:u+"-splatting-slider-options"}),this.elements.splattingSliderDiv=s.createElement("div",{class:u+"-splatting-slider"}),this.elements.splattingSliderTitle=s.createElement("label",{class:u+"-splatting-title"}),this.elements.splattingSliderTitle.innerHTML=t.soiTimelineV1.splattingFactor,this.elements.splattingSliderOptionsDiv.appendChild(this.elements.splattingSliderTitle),this.elements.splattingSliderOptionsDiv.appendChild(this.elements.splattingSliderDiv),this.elements.splattingSlider=new c({value:1,minValue:0,maxValue:2,stepValue:.1}),this.elements.splattingSlider.getTextFromValue=function(){},this.elements.splattingSlider.getContent().addEventListener("change",function(){this.options.events.onSplattingChangedCB({value:this.elements.splattingSlider.value})}.bind(this)),this.elements.splattingSlider.getContent().addEventListener("endEdit",function(){this.options.events.onSplattingChangedCB({value:this.elements.splattingSlider.value}),require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"ENO3DSOITimelineView-usage"});t.setEventData({eventLabel:"ENO3DSOITimelineView-splatting"}),t.trackPageEvent()}))}.bind(this)),"afr"===o.getSetting("eno3dviewer_infrastructure_version")&&(this.elements.stateOptions.appendChild(this.elements.mode360Title),this.elements.mode360Toggle.inject(this.elements.stateOptions)),this.elements.splattingSlider.inject(this.elements.splattingSliderDiv),this.elements.stateOptions.appendChild(this.elements.splattingSliderOptionsDiv);var i=null!==window.localStorage.getItem("SoITimelineViewOptionExpanderState")&&JSON.parse(window.localStorage.getItem("SoITimelineViewOptionExpanderState")),r=new l({style:"simple",header:t.soiTimelineV1.options,expandedFlag:i,allowUnsafeHTMLHeader:!1,body:this.elements.stateOptions});r.addEventListener("expand",(function(){window.localStorage.setItem("SoITimelineViewOptionExpanderState",!0)})),r.addEventListener("collapse",(function(){window.localStorage.setItem("SoITimelineViewOptionExpanderState",!1)})),r.inject(this.elements.stateOptionsTimeline);const a=new Date(this.options.data.states[this.options.loadedStateIdx].grid["r2v:fsEffectivityDate"]),p=this.options.data.states[this.options.loadedStateIdx]["ds6w:label"]+" - "+`${new Intl.DateTimeFormat(n.getLang(),this.options.dateFormatOptions).format(a)}`;let h=s.createElement("div",{class:u+"-state-header"});h.appendChild(s.generateIcon({className:u+"-state-icon",iconPath:this.options.data.states[this.options.loadedStateIdx].icon,iconSize:{height:"22px",width:"22px"}}));let m=this.elements.stateLabel=s.createElement("div",{className:u+"-state-label"});m.innerText=p,h.appendChild(m),this.elements.content.appendChild(h),this.options.data.states.length>1&&this.elements.content.appendChild(this.elements.stateTimeline),this.elements.content.appendChild(this.elements.stateOptionsTimeline),this.__buildSlidderUX(e)},h.prototype.__buildSlidderUX=function(e){this.elements.disabled=s.createElement("div",{class:u+"-disabled"}),this.elements.timelineDisabled=s.createElement("div",{class:u+"-disabled"}),this.elements.sliderTrack=s.createElement("div",{class:u+"-slider"});let t=this.options.data,i=Math.floor(100/(t.states.length-1)),n="";for(let e=0;e<t.states.length;e++)n+=i+"% ";this.elements.sliderTrack.style.gridTemplateColumns=n,this.elements.content.appendChild(this.elements.disabled),this.elements.stateTimeline.appendChild(this.elements.sliderTrack),this.elements.stateTimeline.appendChild(this.elements.timelineDisabled);for(let i=0;i<t.states.length;++i){const n=this.__createStateStop(t.states[i],t.serviceId,i);i===this.options.loadedStateIdx&&this.__stateStopClicked({target:n,reframe:e.data.reframe,fromInit:!0}),this.elements.sliderTrack.appendChild(n),this.options.sliderStops.push(n)}},h.prototype.startStateLoadingTransaction=function(){this.__surveyLoadingInProgress=!0,this.disable()},h.prototype.endStateLoadingTransaction=function(e){this.__surveyLoadingInProgress=!1,this.options.selectedStateId=e,this.isUsable&&this.enable(),this.__removeIdWhenLoaded&&this.close(this.__removeIdWhenLoaded)},h.prototype.enable=function(){this.elements.disabled.style.display="none"},h.prototype.disable=function(){this.elements.disabled.style.display="block"},h.prototype.enableTimeline=function(){this.elements.timelineDisabled.style.display="none"},h.prototype.disableTimeline=function(){this.elements.timelineDisabled.style.display="block"},h.prototype.setActiveState=function(e){this.__stateStopClicked({target:this.options.sliderStops[e]})},h.prototype.getActiveStateId=function(){return this.options.selectedStateId},h.prototype.__createStateStop=function(e,t,o){const a=s.createElement("div",{class:u+"-stop"}),l=new Date(e.grid["r2v:fsEffectivityDate"]),d=`${e["ds6w:label"]} - ${new Intl.DateTimeFormat(n.getLang(),this.options.dateFormatOptions).format(l)}`,c=JSON.stringify({stateIdx:o,envId:i.getPlatformId(),contextId:n.getSecurityContext(),objectId:e.resourceid,objectType:e.type,displayName:d,description:e["ds6w:description"],serviceId:t,date:l,fromTimeline:!0,soiId:this.options.data.soiData.resourceid,soIdisplayName:this.options.data.soiData["ds6w:label"]});return a.tooltipInfos=new r({title:d,shortHelp:`${e.grid["ds6w:description"]}`}),a.dataset.locstate=e.resourceid,a.dataset.state=c,a.dataset.label=`${e["ds6w:label"]} - ${new Intl.DateTimeFormat(n.getLang(),this.options.dateFormatOptions).format(l)}`,a.addEventListener("click",this.__stateStopClicked.bind(this)),a},h.prototype.__stateStopClicked=function(e){if(!0!==this.__surveyLoadingInProgress){const t=JSON.parse(e.target.dataset.state);t.objectId!==this.options.selectedStateId&&(this.startStateLoadingTransaction(),this.elements.stateLabel.innerText=t.displayName,"function"==typeof this.options.events.stateStopClicked&&(e.previouslySelected=this.options.selectedStateId,this._selectedSurveyElement&&this._selectedSurveyElement.classList.remove("state-selected"),e.stateData=t,e.fromInit||p.publish("DS/ExternalWdgtCom/StateStopClicked",e),this.options.events.stateStopClicked(e).then((()=>{this._selectedSurveyElement=e.target,this._selectedSurveyElement.classList.add("state-selected")}))))}},h.prototype._onReceiveStateStopClicked=function(e){!0!==this.__surveyLoadingInProgress&&e.stateData.objectId!==this.options.selectedStateId&&(this.startStateLoadingTransaction(),this.elements.stateLabel.innerText=e.stateData.displayName,"function"==typeof this.options.events.stateStopClicked&&(e.previouslySelected=this.options.selectedStateId,this._selectedSurveyElement&&this._selectedSurveyElement.classList.remove("state-selected"),this.options.events.stateStopClicked(e).then((()=>{this._selectedSurveyElement=this.options.sliderStops[e.stateData.stateIdx],this._selectedSurveyElement&&this._selectedSurveyElement.classList.add("state-selected")}))))},h.prototype.toggle360Mode=function(e,t){if("afr"===o.getSetting("eno3dviewer_infrastructure_version")){this._BSCenter=t.BSCenter;var i=null===window.localStorage.getItem("SoITimeline360ModeState")||JSON.parse(window.localStorage.getItem("SoITimeline360ModeState"));if(i!==this.elements.mode360Toggle.checkFlag)return this.elements.mode360Toggle.toggle(),!0;if(i===this.elements.mode360Toggle.checkFlag&&!0===i)return!1}},h.prototype.setToggleValue=function(e){"afr"===o.getSetting("eno3dviewer_infrastructure_version")&&e!==this.elements.mode360Toggle.checkFlag&&this.elements.mode360Toggle.toggle()},h.prototype.toggle360ModeAvailability=function(e){this.elements.mode360Toggle.disabled=!e},h.prototype.setSplattingFactorAvailability=function(e){this.elements.splattingSlider.disabled=e},h.prototype.updateBS=function(e){this._BSCenter=e.BSCenter},h})),define("DS/PADServices/views/AttributesCustomization",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices.json","DS/PADServices/views/private/Iconbar","DS/PADServices/views/private/ComboSelector","DS/PADServices/utils/GlobalUtils","css!DS/UIKIT/UIKIT","DS/UIKIT/Mask","UWA/Core","UWA/Controls/Abstract","DS/Controls/Button","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/DataModelSet","DS/Controls/Toggle","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/PADServices/utils/PlatformURL","DS/Utilities/Dom","DS/Utilities/TouchUtils"],(function(e,t,i,n,o,s,r,a,l,d,c,p,u,h,m,f,g,v,b){"use strict";var S=["selection","hide_show","ds6w:label-Instance","positionMatrix-Instance","thumbnail"],w=["bi_color","selection","hide_show","thumbnail","grpBSD"],y=!1,_=!1;function D(e){var t=!0;return(-1!==w.indexOf(e)||!1===y&&-1!==["ds6w:label-Instance","positionMatrix-Instance"].indexOf(e))&&(t=!1),t}var C={properties:[function(){return{property:"label",value:this.options.grid.attrTitle}},function(){var e={property:"text",value:void 0};return(void 0===this.options.grid.hasTitle||this.options.grid.hasTitle)&&(e.value=this.options.grid.attrTitle),e},function(){return{property:"dataIndex",value:this.options.grid.attrName}},function(){return{property:"attrDBName",value:this.options.grid.attrDBName}},function(){let e;if("positionMatrix-Instance"===this.options.grid.attrName)e="matrixtxt";else e=this.options.grid.attrName;return{property:"ds6w",value:e}},function(){return{property:"hasNLS",value:void 0===this.options.grid.hasTitle||this.options.grid.hasTitle}},function(){return{property:"noTitleColumn",value:void 0!==this.options.grid.hasTitle&&!this.options.grid.hasTitle}},function(){return{property:"kind",value:this.options.kind}},function(){return{property:"ds6wFrom",value:"Instance"===this.options.grid.attrInstRef?"rel":void 0}},function(){return{property:"source",value:"Classification"===this.options.grid.attrInstRef?"Classification":void 0}},function(){return{property:"dimension",value:this.options.grid.dimension}},function(){return{property:"selectable",value:this.options.grid.selectable?this.options.grid.selectable:void 0}}]};function P(e,t){for(let i=0;i<e.length;i++){let n=e[i];if(n.dataIndex===t)return n;if(n.xnav_options&&n.xnav_options.name===t)return n}}return l.extend({name:"attr-customization",columnOrdering:!0,defaultOptions:{renderTo:null,modelEvents:null,subscribeTokens:[],modelSubscribeTokens:[],compactMode:!1,applyOnlyToThisApp:!1,baseTypes:[],selectedTypes:[],selectedExtensions:[],defaultTypes:[],defaultExtensions:[],defaultAttributes:[],rowHeaderActivated:!0,thumbnailsActivated:!1,pinModel:{},noAddRemoveColumn:!1,manageAttrFromInstance:!0,dgvOptions:{defaultColumnDef:{width:"auto",typeRepresentation:"string"},showRowIndexFlag:!1,showRowBorderFlag:!0,showAlternateBackgroundFlag:!1,rowSelection:"multiple",cellSelection:"none",selectionBehavior:{canInteractiveMultiselectWithCheckboxClick:!0,canMultiSelect:!0,enableFeedbackForActiveCell:!0,enableShiftSelection:!0,toggle:!1,unselectAllOnEmptyArea:!0},columns:[{icon:{iconName:"eye",fontIconFamily:1},tooltip:t.attributesCustomization.attrVisible,dataIndex:"attrVisible",typeRepresentation:"boolean",alignmentValue:"center",alwaysVisibleFlag:!0,width:30,editableFlag:!0,editionPolicy:"EditionInPlace",sortableFlag:!1,resizableFlag:!1,getCellEditableState:function(e){var t=!0;return e.nodeModel.options.grid.layout&&void 0!==e.nodeModel.options.grid.layout.removableFromView?t=e.nodeModel.options.grid.layout.removableFromView:!0===e.nodeModel.options.pinColumn&&(t=!1),t},getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.pinColumn?"string":"boolean"}},{dataIndex:"tree",text:t.attributesCustomization.attrTitle,typeRepresentation:"string",editableFlag:!1,editionPolicy:"EditionOnDoubleClick",sortableFlag:!1,getCellEditableState:function(e){var t=!0;return e.nodeModel?!0===y?-1===w.indexOf(e.nodeModel.options.columnIndex)&&!0!==e.nodeModel.options.pinColumn&&!0!==e.nodeModel.options.grid.isAdditionalColumn||(t=!1):-1===S.indexOf(e.nodeModel.options.columnIndex)&&!0!==e.nodeModel.options.pinColumn&&!0!==e.nodeModel.options.grid.isAdditionalColumn||(t=!1):t=!1,t}},{icon:{iconName:"pin",fontIconFamily:1},dataIndex:"pinContent",typeRepresentation:"pin",alignmentValue:"center",alwaysVisibleFlag:!0,width:100,editableFlag:!0,editionPolicy:"EditionInPlace",sortableFlag:!1,resizableFlag:!1},{icon:{iconName:"export",fontIconFamily:1},dataIndex:"exportContent",typeRepresentation:"boolean",alignmentValue:"center",alwaysVisibleFlag:!0,width:30,editableFlag:!0,editionPolicy:"EditionInPlace",sortableFlag:!1,resizableFlag:!1,getCellEditableState:function(e){var t=void 0!==e.nodeModel.options.grid.exportLock&&!e.nodeModel.options.grid.exportLock;return!0===e.nodeModel.options.pinColumn&&(t=!1),t},getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.pinColumn?"string":"boolean"},getCellSemantics:function(e){var t=void 0!==e.nodeModel.options.grid.exportLock&&e.nodeModel.options.grid.exportLock;return!0===e.nodeModel.options.pinColumn&&(t=!0),{disabled:t}}},{icon:{iconName:"palette",fontIconFamily:1},dataIndex:"columnColor",alignmentValue:"center",alwaysVisibleFlag:!0,width:30,editableFlag:!1,sortableFlag:!1,resizableFlag:!1,typeRepresentation:"colorChange",getCellClassName:function(e){var t=[];if(e.nodeModel){var i="#ffffff",n="#000000";if(e.nodeModel.options.grid&&e.nodeModel.options.grid.columnColor){if(i=(i=e.nodeModel.options.grid.columnColor["background-color"]?e.nodeModel.options.grid.columnColor["background-color"]:"#ffffff").replace(/;/g,""),n=(n=e.nodeModel.options.grid.columnColor.color?e.nodeModel.options.grid.columnColor.color:"#0000").replace(/;/g,""),"#ffffff"!==i){var s="enx-background-color-"+i.replace(/\#/g,""),r="{background-color:"+i+";}";o.createCSSClass(s,r),t.push(s)}if("#000000"!==n){var a="enx-color-"+n.replace(/\#/g,"");r="{color:"+n+";}";o.createCSSClass(a,r),t.push(a)}}}return t.join(" ")},getCellEditableState:function(e){var t=!0;return!0===e.nodeModel.options.pinColumn&&(t=!1),t}},{icon:{iconName:"remove",fontIconFamily:1},dataIndex:"attrRemove",alignmentValue:"center",alwaysVisibleFlag:!0,width:30,sortableFlag:!1,resizableFlag:!1,editableFlag:!1,getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.pinColumn?"string":e.nodeModel&&(!0===e.nodeModel.options.grid.isAdditionalColumn||e.nodeModel.options.grid.layout&&!1===e.nodeModel.options.grid.layout.removable)?"actionNotRemove":"actionRemove"},getCellSemantics:function(e){if(e.nodeModel&&(!0===e.nodeModel.options.grid.isAdditionalColumn||e.nodeModel.options.grid.layout&&!1===e.nodeModel.options.grid.layout.removable))return{disabled:!0}}}]},dgvLayoutOptions:{cellHeight:28,columnHeaderHeight:38,rowsHeader:!0}},init:function(e){this._parent(e);var i=this,n=o.isWebInWinContext()?"-immersivePanelWebInWin":"-immersivePanel";if(i.elements.container=a.createElement("div",{class:i.getClassNames(n)}),this.options.dgvInfo){let e=this.options.dgvInfo.options.context;e&&e.options.isDeEnabled&&(_=e.hasActiveDesignExp())}g.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0}).then((function(){y=!!(i.options.baseInstanceTypes&&i.options.baseInstanceTypes.length>0),i.options.allowedIndexAttributes=new Set(i.options.allowedIndexAttributes),i._buildBody(),i._buildFooter(),i.elements.panel2small=a.createElement("div",{class:i.getClassNames("-panel2small"),text:t.attributesCustomization.panel2small}).inject(i.elements.container),i.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{idView:"customize",title:t.attributesCustomization.apptitle,html:i.elements.container}})}))},destroy:function(){for(var e=0;e<this.options.subscribeTokens.length;e++)this.options.modelEvents.unsubscribe(this.options.subscribeTokens[e]);this.options.toolbar.destroy(),this.options.grid.destroy(),this.options.grid=null,this._parent()},_buildBody:function(){this._buildIconBar(),this.elements.dgv=a.createElement("div",{class:this.getClassNames("-dgv")}).inject(this.elements.container);var e=this.options.dgvOptions;!0!==this.options.withDgv?e.columns.splice(2,1):(e.columns.splice(4,1),!0===this.options.noAddRemoveColumn&&e.columns.splice(4,1));var i=a.extend({identifier:"DataGridView-attrCusto-"+o.uid()},this.options.dgvOptions);i.layout=new f(this.options.dgvLayoutOptions);var s=this.options.grid=new m(i);s.onContextualEvent=function(){return[]},s.getCellTooltip=function(e){if(-1===e.columnID)return this.options.grid.getCellDefaultTooltip(e);var i=this.options.grid.getColumnOrGroup(e.columnID).dataIndex;return e.dataIndex=i,-1===e.rowID?{shortHelp:t.attributesCustomization[i],updateModel:!1}:"tree"===i&&e.nodeModel&&!0!==e.nodeModel.getReferenceValue("isAdditionalColumn")?!0===u.instanceMgtActivated?{shortHelp:t.replace(t.attributesCustomization.tooltipColName,{label:e.nodeModel.getLabel(),instRef:t.attributesCustomization[e.nodeModel.getReferenceValue("attrInstRef")]}),updateModel:!1}:{shortHelp:e.nodeModel.getLabel(),updateModel:!1}:void 0}.bind(this);var r={actionRemove:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"remove",fontIconFamily:WUXManagedFontIcons.Font3DS}}},actionNotRemove:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"block",fontIconFamily:WUXManagedFontIcons.Font3DS}}}},l={};l[t.attributesCustomization.pinLeft]="left",l[t.attributesCustomization.pinRight]="right",l[t.attributesCustomization.unpinned]="unpinned";var d={pin:{stdTemplate:"enumCombo",semantics:{possibleValues:l,valueType:"enumCustom"}}};s.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(d)),!0!==this.options.withDgv&&(r.colorChange={stdTemplate:"functionIcon",semantics:{icon:{iconName:"text",fontIconFamily:WUXManagedFontIcons.Font3DS}}}),s.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(r));var u=this;this.options.attrModel=new c({shouldBeSelected:function(e){return!0!==e.options.pinColumn}}),s.treeDocument=this.options.attrModel,s.getContent().addClassName("enxdatagridview"),s.getContent().inject(this.elements.dgv);u=this;s.onReady((function(){s.addEventListener("change",u._cellModified.bind(u)),s.addEventListener("click",u._cellClicked.bind(u)),u.options.toolbar.show(),u.options.grid.sizeColumnToFit("pinContent",{computeAllRows:!0})})),this._addColumns(),this.options.attrModel.getXSO().onPostAdd(this._manageAttrSelection.bind(this)),this.options.attrModel.getXSO().onPostRemove(this._manageAttrSelection.bind(this)),this.options.attrModel.getXSO().onEmpty(this._manageAttrSelection.bind(this)),this.options.modelSubscribeTokens.push(this.options.attrModel.getModelEvents().subscribe({event:"addChild"},(function(e){!0!==u._isMoving&&!0!==u._globalUpdate&&u.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",addedColumns:[e.data.nodeModel.dump(C)]}})}))),this.options.modelSubscribeTokens.push(this.options.attrModel.getModelEvents().subscribe({event:"removeChild"},(function(e){if(!0!==u._isMoving&&!0!==u._globalUpdate){var t=e.data.nodeModel.getReferenceValue("attrName");if(-1!==S.indexOf(t)&&!0!==u.options.withDgv){var i=u.options.toolbar.getItem("specificColumns").content.component;i&&i.isSelected(t)&&i.toggleSelection(i.getItem(t))}u.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",removedColumns:[e.data.nodeModel.dump(C)]}})}}))),this.elements.behavior=a.createElement("div",{class:this.getClassNames("-behavior")}).inject(this.elements.container);var g=new c,v=new p({viewMode:"comfortable",label:t.attributesCustomization.comfortable,subLabel:t.attributesCustomization.comfortableExplanation,children:null,icons:[{iconName:"view-big-tile",fontIconFamily:WUXManagedFontIcons.Font3DS}]});g.addRoot(v);var w=new p({viewMode:"compact",label:t.attributesCustomization.compact,subLabel:t.attributesCustomization.compactExplanation,children:null,icons:[{iconName:"view-list",fontIconFamily:WUXManagedFontIcons.Font3DS}]});g.addRoot(w);this.options.attrModel.getRoots().filter((function(e){return"thumbnail"===e.getReferenceValue("attrName")})).length;"compact"===this.options.viewMode?w.select(!0):v.select(!0),this.elements.comboCompact=new n({className:this.getClassNames("-compactmode-selector"),treedocument:g,events:{onSelectionChange:function(){var e=g.getSelectedNodes()[0].options.viewMode;u.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"changeViewMode",viewMode:e}})}}});var y=a.createElement("div",{class:this.getClassNames("-compactmode-global")});a.createElement("div",{class:this.getClassNames("-compactmode-label"),text:t.attributesCustomization.density}).inject(y),this.elements.comboCompact.inject(y),y.inject(this.elements.behavior),b.getTouchMode()&&this.elements.comboCompact.disabled(!0),this.elements.applyToggle=new h({label:t.attributesCustomization.apply_to_this_app});var _=a.createElement("div",{class:this.getClassNames("-applytothisapp"),content:this.elements.applyToggle});this.elements.applyToggle.addEventListener("change",(function(e){var t=e.dsModel;u.options.applyOnlyToThisApp=t.checkFlag,u.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/applyOnlyToThisApp",data:{applyOnlyToThisApp:u.options.applyOnlyToThisApp}})})),_.inject(this.elements.behavior)},_buildFooter:function(){var e=this,i=a.createElement("div",{class:e.getClassNames("-footer")}).inject(e.elements.container),n=new d({label:t.attributesCustomization.close,emphasize:"primary",touchMode:!0});n.addEventListener("buttonclick",(function(){e._closePanel(),e.destroy()})),n.inject(i);var o=new d({label:t.attributesCustomization.reset,touchMode:!0});o.addEventListener("buttonclick",(function(){var i=e.elements.container.getParent("body");r.mask(i,t.attributesCustomization.resetView),e.options.modelEvents.publish({event:"container-to-unmask",data:{container:i}}),e.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"reset",applyOnlyToThisApp:e.options.applyOnlyToThisApp}}),e.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{restore:!0,idView:"app"}}),e.destroy()})),o.inject(i)},_closePanel:function(){var e=[];this.options.attrModel.getRoots().forEach((function(t){e.includes(t.dump(C))||e.push(t.dump(C))})),this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"close",selectedTypes:this.options.selectedTypes,selectedExtensions:this.options.selectedExtensions,selectedAttributes:e,applyOnlyToThisApp:this.options.applyOnlyToThisApp}}),this.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{restore:!0,idView:"app"}})},_addColumns:function(){const e=this;void 0===this.options.appColumns?console.error("AttributesCustomization## Invalid input. Missing property appColumns"):e.options.attrModel.withTransactionUpdate((function(){for(let t=0;t<e.options.appColumns.length;t++){const i=e.options.appColumns[t];if(!i.neverVisible&&((_||"asset-type"!==i.dataIndex)&&"bi_color"!==i.dataIndex&&"grpBSD"!==i.dataIndex)){const t=a.is(i.text,"string")&&i.text.length>0?i.text:e._retrieveColumnName(i.dataIndex),n=!i.customisation||!i.customisation.exportable||i.customisation.exportable.value,o=!(!i.customisation||!i.customisation.exportable)&&i.customisation.exportable.lock,s=i.customisation&&i.customisation.styles?i.customisation.styles:{"background-color":"#ffffff",color:"#000000"},r=i.customisation&&i.customisation.layout?i.customisation.layout:{},l=i.pinned?i.pinned:"unpinned";let d=void 0!==i.visibleFlag?i.visibleFlag:!i.isHidden;!0!==e.options.withDgv&&(d=!i.isHidden);let c,u=i.ds6wFrom&&"rel"===i.ds6wFrom?"Instance":"Reference";i.isAdditionalColumn?u="AdditionalColumn":i.source&&"Classification"===i.source&&(u="Classification"),!0===y?"Reference"===u?c=[{iconName:"object-reference"}]:"Instance"===u?c=[{iconName:"object-instance"}]:"AdditionalColumn"===u?c=[{iconName:"attributes-add"}]:"Classification"===u&&(c=[{iconName:"library-books"}]):c=void 0;const h=i.ds6w&&"rel"!==i.ds6wFrom?i.ds6w:i.dataIndex,m=new p({columnIndex:i.dataIndex,label:t,icons:c,grid:{attrTitle:t,attrVisible:d,exportContent:n,exportLock:o,columnColor:s,attrName:h,attrDBName:i.attrDBName,isAdditionalColumn:i.isAdditionalColumn,layout:r,pinContent:l,attrRemove:!0,attrInstRef:u,attrAlert:null},children:null});e.options.attrModel.addChild(m)}}e.options.attrModel.expandAll()}))},_cellModified:function(e,t){if(t&&t.nodeModel&&t.nodeModel.options.grid)switch(this.options.grid.layout.getDataIndexFromColumnIndex(t.columnID)){case"attrVisible":this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"visibilityColumn",modifiedColumn:t.nodeModel.options.columnIndex,visibilityFlag:t.nodeModel.getReferenceValue("attrVisible")}});break;case"tree":this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"changeTitle",modifiedColumn:t.nodeModel.options.columnIndex,newTitle:t.nodeModel.getLabel()}});break;case"exportContent":this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"exportColumn",modifiedColumn:t.nodeModel.options.columnIndex,exportFlag:t.nodeModel.getReferenceValue("exportContent")}});break;case"pinContent":var i=this,n=t.nodeModel.getReferenceValue("attrName");"tree"===t.nodeModel.options.columnIndex&&(n="tree");var o=t.nodeModel.getReferenceValue("pinContent"),s=i.options.attrModel.getRoots(),r=s.filter((function(e){return"left"===e.getReferenceValue("pinContent")})),a=s.filter((function(e){return"unpinned"===e.getReferenceValue("pinContent")}));s.filter((function(e){return"right"===e.getReferenceValue("pinContent")}));i.options.attrModel.withTransactionUpdate((function(){i._globalUpdate=!0;var e=r.length-1;"unpinned"==o&&(e=r.length,t.nodeModel._localID>r.length&&(e=e+a.length-1)),"right"==o&&(e=r.length+a.length),i.options.attrModel.addChild(t.nodeModel,e),t.nodeModel.select(),delete i._globalUpdate,i.options.grid.sizeColumnToFit("pinContent",{computeAllRows:!0})})),this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"pinChange",modifiedColumn:n,pin:o}})}},_cellClicked:function(e,i){if(i&&i.nodeModel&&i.nodeModel.options.grid){if(!0===i.nodeModel.options.pinColumn)return;switch(this.options.grid.layout.getDataIndexFromColumnIndex(i.columnID)){case"attrRemove":if(i.nodeModel){if(i.nodeModel.options.grid.layout&&!1===i.nodeModel.options.grid.layout.removable||i.nodeModel.options.grid.isAdditionalColumn&&!0===i.nodeModel.options.grid.isAdditionalColumn)break;if(this.options.attrModel.removeRoot(i.nodeModel),"thumbnail"===i.nodeModel.options.columnIndex){this.options.thumbnailsActivated=!1;var n={id:this.options.toolbar.getItem("thumbnail").id,tile:t.attributesCustomization.activateThumbnails};this.options.toolbar.menu.updateItem(n),this.options.toolbar.select("thumbnail",!1)}}}}},_retrieveColumnName:function(e){return t.attributesCustomization[e]?t.attributesCustomization[e]:e},_buildIconBar:function(){this.elements.toolbar=a.createElement("div",{class:this.getClassNames("-toolbar")}).inject(this.elements.container);var e=(this.options.appColumns?this.options.appColumns:[]).filter((function(e){return!e.isHidden})).map((function(e){return e.dataIndex})),n=this,o={renderTo:this.elements.toolbar,multiSelect:!0,items:[{fonticon:"cog",title:t.attributesCustomization.moreAttributes,name:"moreAttributes",handler:function(e,i){require(["DS/PADServices/views/private/MoreAttributesWizard"],(function(e){for(var i=n.options.attrModel.getRoots(),o=[],s=0;s<i.length;s++)!0===D(i[s].getReferenceValue("attrName"))&&o.push({name:i[s].getReferenceValue("attrName"),instRef:i[s].getReferenceValue("attrInstRef")});var r=n.options.modelEvents.subscribe({event:"ENXViews/MoreAttributesWizard/selectedAttributes"},(function(e){n.options.modelEvents.unsubscribe(r);for(var i=n.options.attrModel.getRoots(),o=[],s=0;s<i.length;s++)!0===D(i[s].getReferenceValue("attrName"))&&o.push(i[s].getReferenceValue("attrName"));n.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{idView:"customize",html:n.elements.container,title:t.attributesCustomization.apptitle}}),n.options.selectedExtensions=e.selectedExtensions,n.options.selectedTypes=e.selectedTypes,n._globalUpdate=!0;var a=e.selectedAttributes.filter((function(e){return-1!==o.indexOf(e.dataIndex)})).map((function(e){return e.dataIndex})),l=o.filter((function(e){return-1===a.indexOf(e)})),d=e.selectedAttributes.filter((function(e){return-1===o.indexOf(e.dataIndex)})),c=[],u=[],h=0;for(h=0;h<l.length;h++){var m=n.options.attrModel.search({match:function(e){var t=!1;return e.nodeModel.options.columnIndex===l[h]&&!0!==e.nodeModel.options.grid.isAdditionalColumn&&!1!==e.nodeModel.options.grid.layout.removable&&"ds6w:type"!==l[h]&&(t=!0,n.options.dbOnlyAttributes&&n.options.allowedIndexAttributes.has(l[h])&&(t=!1)),t}});n.options.attrModel.withTransactionUpdate((function(){for(var e=0;e<m.length;e++)n.options.attrModel.removeRoot(m[e]),c.push(m[e].dump(C))}))}var f=[];for(h=0;h<d.length;h++){var g,v=P(n.options.appColumns,d[h].dataIndex),b=!1;if(v){var S=v.xnav_options;S||(S=v.customisation),S&&(b=!!S.exportable&&S.exportable.lock)}!0===y&&("Reference"===d[h].attrParent?g=[{iconName:"object-reference"}]:"Instance"===d[h].attrParent?g=[{iconName:"object-instance"}]:"Classification"===d[h].attrParent&&(g=[{iconName:"library-books"}]));var w=new p({label:d[h].label,columnIndex:d[h].dataIndex,icons:g,grid:{attrTitle:d[h].label,attrVisible:!0,exportContent:!0,exportLock:b,columnColor:{background_color:"#ffffff",color:"#000000"},attrName:d[h].dataIndex,attrDBName:d[h].attrDBName,attrRemove:!0,pinContent:"unpinned",attrInstRef:d[h].attrParent,dimension:d[h].dimension,preferredUnit:d[h].preferredUnit,attrAlert:null,selectable:d[h].selectable},kind:d[h].kind,children:null});if(y){var _=n.__locateFirstAndLastPin("right");_.first?n.options.attrModel.insertBefore(w,_.first):n.options.attrModel.addChild(w)}else n.options.attrModel.addChild(w);w.select(),f.push(w)}for(h=0;h<f.length;h++)u.push(f[h].dump(C));(c.length||u.length)&&n.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",selectedTypes:n.options.selectedTypes,selectedExtensions:n.options.selectedExtensions,removedColumns:c,addedColumns:u}}),delete n._globalUpdate})),a=n.options.modelEvents.subscribe({event:"ENXViews/MoreAttributesWizard/closeWizard"},(function(){n.options.modelEvents.unsubscribe(a),n.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{idView:"customize",html:n.elements.container,title:t.attributesCustomization.apptitle}})}));new e({dgv:n.options.withDgv,modelEvents:n.options.modelEvents,baseTypes:n.options.baseTypes,baseInstanceTypes:n.options.baseInstanceTypes,selectedTypes:n.options.selectedTypes,selectedExtensions:n.options.selectedExtensions,selectedAttributes:o,defaultTypes:n.options.defaultTypes,defaultExtensions:n.options.defaultExtensions,defaultAttributes:n.options.defaultAttributes,dbOnlyAttributes:n.options.dbOnlyAttributes,attributesToIgnore:n.options.attributesToIgnore,onlyCustomer:!1})}))}},{className:"divider"},{fonticon:"up",title:t.attributesCustomization.moveUp,name:"moveUp",disabled:!0,handler:function(e,t){n._moveColumn(t.name,n.options.attrModel.getSelectedNodes())}},{fonticon:"down",title:t.attributesCustomization.moveDown,name:"moveDown",disabled:!0,handler:function(e,t){n._moveColumn(t.name,n.options.attrModel.getSelectedNodes())}},{fonticon:"move-to-top",title:t.attributesCustomization.moveFirst,name:"moveFirst",disabled:!0,handler:function(e,t){n._moveColumn(t.name,n.options.attrModel.getSelectedNodes())}},{fonticon:"move-to-bottom",title:t.attributesCustomization.moveLast,name:"moveLast",disabled:!0,handler:function(e,t){n._moveColumn(t.name,n.options.attrModel.getSelectedNodes())}},{className:"divider"},{fonticon:"remove",title:t.attributesCustomization.remove,name:"remove",disabled:!0,handler:function(e,t){n._removeSelectedColumn()}}]};if(!0===this.options.withDgv){this.options.thumbnailsActivated=-1!==e.indexOf("thumbnail");var s=[{fonticon:this.options.rowHeaderActivated?"checkbox-on":"checkbox-off",title:this.options.rowHeaderActivated?t.attributesCustomization.deactivateSelectionBoxes:t.attributesCustomization.activateSelectionBoxes,name:"checkBoxes",handler:function(e,i){n.options.rowHeaderActivated=!n.options.rowHeaderActivated;var o=n.options.rowHeaderActivated?"checkbox-on":"checkbox-off",s=n.options.rowHeaderActivated?t.attributesCustomization.deactivateSelectionBoxes:t.attributesCustomization.activateSelectionBoxes,r={id:n.options.toolbar.getItem("checkBoxes").id,title:s,fonticon:o};n.options.toolbar.menu.updateItem(r),n.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"rowsHeaderModification",rowsHeader:n.options.rowHeaderActivated}})}},{fonticon:"picture",title:this.options.thumbnailsActivated?t.attributesCustomization.deactivateThumbnails:t.attributesCustomization.activateThumbnails,name:"thumbnail",selectable:!0,selected:this.options.thumbnailsActivated,handler:function(e,i){n.options.thumbnailsActivated=!n.options.thumbnailsActivated;var o=n.options.thumbnailsActivated?t.attributesCustomization.deactivateThumbnails:t.attributesCustomization.activateThumbnails,s={id:n.options.toolbar.getItem("thumbnail").id,title:o,selected:n.options.thumbnailsActivated};n.options.toolbar.menu.updateItem(s),n._manageThumbnailAttribute(i.name,i.selected)}},{className:"divider"}];if(!0!==y&&!0!==n.options.noAddRemoveColumn&&n.options.manageAttrFromInstance){var r={fonticon:"list-add",title:t.attributesCustomization.instanceAtt,name:"instanceAttributes",content:{type:"dropdownmenu",options:{multiSelect:!0,items:[{text:t.attributesCustomization.instanceName,name:"ds6w:label-Instance",selectable:!0,selected:-1!==e.indexOf("ds6w:label-Instance")},{text:t.attributesCustomization.instanceMatrix,name:"positionMatrix-Instance",selectable:!0,selected:-1!==e.indexOf("positionMatrix-Instance")}],events:{onClick:function(e,t){n._manageInstanceAttributes(t.name,t.selected)}}}}};s.splice(1,0,r)}o.items.splice.apply(o.items,[2,0].concat(s))}else{var l=[{fonticon:"list-add",title:t.attributesCustomization.specificColumn,name:"specificColumns",id:"specificColumns",content:{type:"dropdownmenu",options:{multiSelect:!0,items:[{fonticon:"checkbox-on",text:t.attributesCustomization.selection,name:"selection",id:"selection",selectable:!0,selected:-1!==e.indexOf("selection")},{fonticon:"eye",text:t.attributesCustomization.hide_show,name:"hide_show",id:"hide_show",selectable:!0,selected:-1!==e.indexOf("hide_show")},{text:t.attributesCustomization.instanceName,name:"ds6w:label-Instance",id:"ds6w:label-Instance",selectable:!0,selected:-1!==e.indexOf("ds6w:label-Instance")},{text:t.attributesCustomization.instanceMatrix,name:"positionMatrix-Instance",id:"positionMatrix-Instance",selectable:!0,selected:-1!==e.indexOf("positionMatrix-Instance")},{fonticon:"picture",text:t.attributesCustomization.thumbnail,name:"thumbnail",id:"thumbnail",selectable:!0,selected:-1!==e.indexOf("thumbnail")}],events:{onClick:function(e,t){n._manageSpecificColumn(t.name,t.selected)}}}}},{className:"divider"}];o.items.splice.apply(o.items,[2,0].concat(l))}!0===this.options.noAddRemoveColumn&&(o.items.splice(0,2),o.items.splice(7,2)),this.options.toolbar=new i(o),this.options.toolbar.elements.container.setStyle("display",void 0)},_manageAttrSelection:function(){var e=this.options.attrModel.getSelectedNodes(),t=["moveUp","moveDown","moveFirst","moveLast"],i=["remove","changeColor"],n=e.length,o=!1,s=0;for(s=0;s<n;s++)!0===e[s].options.grid.isAdditionalColumn||e[s].options.grid.layout&&!1===e[s].options.grid.layout.removable||(o=!0);if(0===n){for(s=0;s<t.length;s++)this.options.toolbar.disableItem(t[s]);for(s=0;s<i.length;s++)this.options.toolbar.disableItem(i[s])}else if(1===n){for(s=0;s<t.length;s++)this.options.toolbar.enableItem(t[s]);for(s=0;s<i.length;s++)"remove"===i[s]&&!1===o?this.options.toolbar.disableItem(i[s]):this.options.toolbar.enableItem(i[s])}else if(n>=1){for(s=0;s<t.length;s++)this.options.toolbar.disableItem(t[s]);for(s=0;s<i.length;s++)"remove"===i[s]&&!1===o?this.options.toolbar.disableItem(i[s]):this.options.toolbar.enableItem(i[s])}},_moveColumn:function(e,t){!0===this.options.withDgv?this.__dgvMoveColumn(e,t):this.__treeMoveColumn(e,t)},__dgvMoveColumn:function(e,t){var i=this;1===t.length&&this.options.attrModel.withTransactionUpdate((function(){var n,o=t[0],s=o.getReferenceValue("pinContent"),r=o._getLocalID?o._getLocalID():o._localID,a=i.__locateFirstAndLastPin(s,!0),l=a.first._getLocalID?a.first._getLocalID():a.first._localID,d=a.last?a.last._getLocalID?a.last._getLocalID():a.last._localID:i.options.getRoots().length-1;switch(e){case"moveFirst":n=l;break;case"moveUp":n=l<=r-1?r-1:r;break;case"moveDown":n=d>=r+1?r+1:r;break;case"moveLast":n=d}if(r!==n&&i.options.dgvInfo&&!0===i.options.dgvInfo.columnOrdering){i.options.dgvInfo.columnOrdering=!1;var c={from:i.options.attrModel.getRoots()[r].options.columnIndex,to:i.options.attrModel.getRoots()[n].options.columnIndex};i._isMoving=!0,i.options.attrModel.addChild(o,n),o.select(),i._isMoving=!1,i.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"moveColumn",move2perform:c}})}}))},__treeMoveColumn:function(e,t){var i=this;1===t.length&&this.options.attrModel.withTransactionUpdate((function(){var n=t[0],o=n._getLocalID?n._getLocalID():n._localID,s={fromID:o,toID:-1};switch(e){case"moveFirst":s.toID=0;break;case"moveUp":s.toID=o-1;break;case"moveDown":s.toID=o+1;break;case"moveLast":s.toID=i.options.attrModel.getRoots().length-1}-1!==s.toID&&o!==s.toID&&s.toID<i.options.attrModel.getRoots().length&&(i._isMoving=!0,i.options.attrModel.addChild(n,s.toID),n.select(),i._isMoving=!1,i.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"moveColumn",move2perform:s}}))}))},_manageSpecificColumn:function(e,i){var n=this,o=!1,s=!0;"ds6w:label-Instance"===e&&(o=!0,s=!1);var r=["hide_show","ds6w:label-Instance","positionMatrix-Instance","thumbnail"],a="ds6w:label-Instance"===e?"instanceName":"positionMatrix-Instance"===e?"instanceMatrix":e,l=t.attributesCustomization[a]?t.attributesCustomization[a]:e;if(!0===i){if("thumbnail"===e)this.elements.comboCompact.options.treedocument.getRoots()[0].select(!0);this.options.attrModel.withTransactionUpdate((function(){var t=-1!==r.indexOf(e),i=new p({columnIndex:e,label:l,grid:{attrTitle:l,attrVisible:!0,exportContent:o,exportLock:s,attrRemove:!0,columnColor:{background_color:"#ffffff",color:"#000000"},attrName:e,hasTitle:t},modelEvents:n.options.modelEvents});n.options.attrModel.addChild(i)}))}else{var d=this.options.attrModel.search({match:function(t){return t.nodeModel.options.label===e||t.nodeModel.options.columnIndex===e}});this.options.attrModel.withTransactionUpdate((function(){for(var e=0;e<d.length;e++)n.options.attrModel.removeRoot(d[e])}))}},_manageInstanceAttributes:function(e,i){var n=this;if(!0===i)this.options.attrModel.withTransactionUpdate((function(){var i="ds6w:label-Instance"===e?"instanceName":"positionMatrix-Instance"===e?"instanceMatrix":e,o=t.attributesCustomization[i]?t.attributesCustomization[i]:e;switch(e){case"ds6w:label-Instance":var s=new p({columnIndex:e,label:o,grid:{attrTitle:o,attrVisible:!0,exportContent:!0,exportLock:!1,attrRemove:!0,columnColor:{background_color:"#ffffff",color:"#000000"},pinContent:"left",attrName:e,hasTitle:!0,attrInstRef:"Instance"},modelEvents:n.options.modelEvents});(r=n.__locateFirstAndLastPin("right")).first?n.options.attrModel.insertBefore(s,r.first):n.options.attrModel.addChild(s);break;case"positionMatrix-Instance":var r,a=new p({columnIndex:e,label:o,grid:{attrTitle:o,attrVisible:!0,exportContent:!0,exportLock:!1,attrRemove:!0,columnColor:{background_color:"#ffffff",color:"#000000"},pinContent:"unpinned",attrName:e,hasTitle:!0,attrInstRef:"Instance"},modelEvents:n.options.modelEvents});(r=n.__locateFirstAndLastPin("right")).first?n.options.attrModel.insertBefore(a,r.first):n.options.attrModel.addChild(a)}}));else{var o=this.options.attrModel.search({match:function(t){return t.nodeModel.options.label===e||t.nodeModel.options.columnIndex===e}});this.options.attrModel.withTransactionUpdate((function(){for(var e=0;e<o.length;e++)n.options.attrModel.removeRoot(o[e])}))}},_manageThumbnailAttribute:function(e,i){var n=this;if(!0===i)this.options.attrModel.withTransactionUpdate((function(){var i=t.attributesCustomization[e]?t.attributesCustomization[e]:e,o=new p({columnIndex:e,icons:[{iconName:"product"}],label:i,grid:{attrTitle:i,attrVisible:!0,exportContent:!1,exportLock:!0,attrRemove:!0,columnColor:{background_color:"#ffffff",color:"#000000"},pinContent:"unpinned",attrName:e,hasTitle:!1},modelEvents:n.options.modelEvents}),s=n.__locateFirstAndLastPin("right");s.first?n.options.attrModel.insertBefore(o,s.first):n.options.attrModel.addChild(o)}));else{var o=this.options.attrModel.search({match:function(t){return t.nodeModel.options.label===e||t.nodeModel.options.columnIndex===e}});this.options.attrModel.withTransactionUpdate((function(){for(var e=0;e<o.length;e++)n.options.attrModel.removeRoot(o[e])}))}},_removeSelectedColumn:function(){var e=this.options.attrModel.getSelectedNodes(),i=this;this.options.attrModel.withTransactionUpdate((function(){for(var n=0;n<e.length;n++)!0===e[n].options.grid.isAdditionalColumn||e[n].options.grid.layout&&!1===e[n].options.grid.layout.removable?(e[n].unselect(),o.displayNotif({level:"warning",message:t.replace(t.attributesCustomization.cannotRemove,{attr:e[n].getReferenceValue("attrTitle")}),key:"AttCusto-cannotRemove"})):i.options.attrModel.removeRoot(e[n])}))},__locateFirstAndLastPin:function(e,t){var i,n;let o=2;t&&(o=1);var s=this.options.attrModel.getRoots().filter((function(t){return t.getReferenceValue("pinContent")===e}));if(i=s[0],s.length>1&&"left"===e)n=s[r=s.length-o];else if("left"!==e&&1===s.length){var r=this.options.attrModel.getRoots().length-1;n=this.options.attrModel.getRoots()[r]}else{n=s[r=s.length-o]}return{first:i,last:n}}})})),define("DS/PADServices/ws/WSRelations",["DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL"],(function(e,t){"use strict";function i(){}return i.prototype.getDetail=function(i){return new Promise(function(n,o){var s=t.get3DSpaceURL(),r={onComplete:n,onFailure:o};s=s+"/resources/enorelnav/navigate/getecosystem?tenant="+t.getPlatformId(),r.method="POST",r.headers={Accept:"application/json","Content-Type":"application/json"},r.data={widgetId:"Reveal-"+e.getWidgetId()+"-"+Date.now(),displayTime:!0,trueREST:!0,debug:!1},r.data=Object.assign(r.data,i),r.data=JSON.stringify(r.data),this.executeRequest(s,r)}.bind(this))},i})),define("DS/PADServices/views/private/SoITimelineV2",["css!DS/PADServices/PADServices.css","i18n!DS/PADServices/assets/nls/PADServices.json","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils","DS/Utilities/Dom","DS/Windows/Panel","DS/ENOXInterWdgCom/LinkManager","DS/Controls/TooltipModel","DS/Utilities/DateUtils"],(function(e,t,i,n,o,s,r,a,l){"use strict";const d="soi-timeline-v2";function c(e){return this.options=e||{},this.isUsable=!0,this._visibility=e.visibility,this._singleState=!this._visibility,this.isTooltipHovered=!1,this._isListeningToResize=!1,this.options=Object.assign({dateFormatOptions:{dateStyle:"long",timeStyle:"medium"},sliderStops:[],data:void 0,events:{}},this.options),this.elements={},this._BSCenter=e.BSCenter,this.__preprocessData(),this.__buildUX(e),this}return c.prototype.close=function(e){!0===this.__surveyLoadingInProgress?this.__removeIdWhenLoaded=e:e===this.getActiveStateId()&&(delete this.__removeIdWhenLoaded,delete this.elements.content,this.elements.panel.destroy(),"function"==typeof this.options.events.closeTimeline&&this.options.events.closeTimeline(this.options.data.soiData.resourceid))},c.prototype.__preprocessData=function(){const e=this.options.data.states[this.options.data.selectedState].resourceid;this.options.data.states.sort(((e,t)=>{let i=new Date(e.grid["r2v:fsEffectivityDate"]),n=new Date(t.grid["r2v:fsEffectivityDate"]);return i>n?1:i<n?-1:0}));for(let t=0;t<this.options.data.states.length;++t)if(this.options.data.states[t].resourceid===e){this.options.loadedStateIdx=t,this.options.data.selectedState=t;break}},c.prototype.__buildUX=function(e){this.elements.content=o.createElement("div",{class:d+"-container"}),r.subscribe("DS/ExternalWdgtCom/StateStopClicked",this._onReceiveStateStopClicked.bind(this));if(this.defaultHorizontalModeHeight=154,this.defaultHorizontalModeWidth=51+36*this.options.data.states.length,this.minHorizontalModeWidth=150,this.defaultHorizontalModeWidth<this.minHorizontalModeWidth&&(this.defaultHorizontalModeWidth=this.minHorizontalModeWidth),this.defaultVerticalModeWidth=149,this.defaultVerticalModeHeight=90+36*this.options.data.states.length,this.minVerticalModeHeight=155,this.defaultVerticalModeHeight<this.minVerticalModeHeight&&(this.defaultVerticalModeHeight=this.minVerticalModeHeight),this.elements.panel=new s({identifier:"PAD3DSoITimeline-"+this.options.data.soiData.resourceid,immersiveFrame:this.options.immersiveFrame,title:this.options.data.soiData["ds6w:label"],icon:"url("+this.options.data.soiData.icon+")",content:this.elements.content,minHeight:this.defaultHorizontalModeHeight,height:this.defaultHorizontalModeHeight,width:this.defaultHorizontalModeWidth,resizableFlag:!0,allowedDockAreas:WUXDockAreaEnum.TopDockArea|WUXDockAreaEnum.LeftDockArea|WUXDockAreaEnum.RightDockArea,horizontallyStretchableFlag:!1,verticallyStretchableFlag:!1,collapsibleFlag:!1,closeButtonFlag:!0,autoCloseFlag:!1}),this.elements.panel.addEventListener("close",function(e){this.options.events.closePanel()}.bind(this)),this._onResize=this._onResize.bind(this),this.elements.panel.addEventListener("resize",this._onResize),this._isListeningToResize=!0,this.elements.panel.addEventListener("prePlaceChange",this._onPrePlaceChange.bind(this)),this.elements.panel.addEventListener("placeChange",this._onPlaceChange.bind(this)),this.elements.panel.addEventListener("contentVisibleStateChange",this._onContentVisibleStateChange.bind(this)),this.elements.panel.addEventListener("activate",this._onActivate.bind(this)),this.elements.panel.addEventListener("deactivate",this._onDeactivate.bind(this)),this.elements.panel.addEventListener("startWindowDrag",(e=>{this.stopListeningToResize()})),this.elements.panel.addEventListener("stopWindowDrag",(e=>{this.startListeningToResize()})),this.elements.panel.currentDockArea===WUXDockAreaEnum.LeftDockArea||this.elements.panel.currentDockArea===WUXDockAreaEnum.RightDockArea)this.isHorizontal=!1;else if(this.elements.panel.currentDockArea===WUXDockAreaEnum.TopDockArea)this.isHorizontal=!0;else{let e=window.localStorage.getItem("ENO3DR2VTimelineMode");e?this.isHorizontal="horizontal"===e:(this.isHorizontal=!0,window.localStorage.setItem("ENO3DR2VTimelineMode","horizontal"))}this._onHorizontalScroll=this._onHorizontalScroll.bind(this),this.isHorizontal&&this.elements.content.addEventListener("wheel",this._onHorizontalScroll),this.__buildContentUX(e),this._visibility?this.elements.panel.show():this.elements.panel.hide()},c.prototype.show=function(){this._singleState||(this._visibility=!0,this.elements.panel&&this.elements.panel.show())},c.prototype.hide=function(){this._singleState||(this._visibility=!1,this.elements.panel&&this.elements.panel.hide())},c.prototype.__buildContentUX=function(e){this.elements.stateHeader=o.createElement("div",{class:d+"-header"});let t=this.options.data.states[this.options.loadedStateIdx]["ds6w:label"];this.elements.stateHeader.tooltipInfos=new a({shortHelp:t}),this.elements.stateHeader.appendChild(o.generateIcon({className:d+"-header-icon",iconPath:this.options.data.states[this.options.loadedStateIdx].icon,iconSize:{height:"12px",width:"12px"}})),this.elements.stateLabel=o.createElement("div",{class:d+"-header-label"}),this.elements.stateLabel.innerText="",this.elements.stateHeader.appendChild(this.elements.stateLabel),this.elements.content.appendChild(this.elements.stateHeader),this.elements.stateTimeline=o.createElement("div",{class:d+"-slider"}),this.elements.stateTimeline.style["min-width"]=28*this.options.data.states.length+"px",this.elements.stateTimeline.style["max-width"]=document.getElementById("___view___2").offsetWidth+"px",this.elements.content.appendChild(this.elements.stateTimeline),this.__buildSlidderUX(e)},c.prototype.__buildSlidderUX=function(e){this.elements.disabled=o.createElement("div",{class:d+"-disabled"}),this.elements.content.parentElement.appendChild(this.elements.disabled),this.elements.sliderTrack=o.createElement("div",{class:d+"-track"}),this.elements.stateTimeline.appendChild(this.elements.sliderTrack),this.elements.yearSeparatorContainer=o.createElement("div",{class:d+"-yearSeparators"}),this.elements.stateTimeline.appendChild(this.elements.yearSeparatorContainer),this.elements.sliderLine=o.createElement("div",{class:d+"-line"}),this.elements.tooltipsContainer,this.elements.panel.currentDockArea!==WUXDockAreaEnum.NoneDockArea?void 0!==this.elements.panel.windowGroup&&null!==this.elements.panel.windowGroup?this.elements.tooltipsContainer=this.elements.panel.windowGroup.getContent().parentElement.parentElement:this.elements.tooltipsContainer=this.elements.panel.getContent().parentElement.parentElement.parentElement:this.elements.panel.currentDockArea!==WUXDockAreaEnum.NoneDockArea||this.elements.panel.windowGroup?this.elements.panel.currentDockArea===WUXDockAreaEnum.NoneDockArea&&this.elements.panel.windowGroup&&(this.elements.tooltipsContainer=this.elements.panel.windowGroup.getContent().parentElement):this.elements.tooltipsContainer=this.elements.panel.getContent(),this.elements.tooltipsContainer.style.overflow="visible",this.elements.sliderTrack.appendChild(this.elements.sliderLine);let t=this.options.data;for(let i=0;i<t.states.length;++i){const n=this.__createStateStop(t.states[i],t.serviceId,i);i===this.options.loadedStateIdx&&this.__stateStopClicked({target:n,reframe:e.data.reframe,fromInit:!0}),this.elements.sliderTrack.appendChild(n),this.options.sliderStops.push(n)}let i=t.states.map((e=>l.formatDateToString(new Date(e.grid["r2v:fsEffectivityDate"]),{datePrecision:"year"}))).sort(),s=[...new Set(i)],r=[],a=i[0];for(let e=1;e<t.states.length;e++){let t=i[e];a!==t&&r.push(e),a=t}r.push(i.length),this.elements.yearSeparators=[],this.options.gridTemplateYears="";for(let e=0;e<s.length;e++){let t=this.__createYearSeparator(s[e],r,e);this.elements.yearSeparatorContainer.appendChild(t),this.elements.yearSeparatorContainer.style.gridTemplateColumns=this.options.gridTemplateYears}for(let e=0;e<t.states.length;++e){let i=this.options.sliderStops[e];i.tooltipContainer=this.__createTooltip(e),this.elements.tooltipsContainer.appendChild(i.tooltipContainer),i.stopDate=o.createElement("div",{class:d+"-stopDate"});let s=new Date(t.states[e].grid["r2v:fsEffectivityDate"]);i.stopDate.innerText=s.toLocaleString(n.getLang(),{day:"numeric",month:"short"}),i.appendChild(i.stopDate)}this.isHorizontal?this._switchToHorizontalMode(!0):(this.stopListeningToResize(),this.elements.panel.currentDockArea!==WUXDockAreaEnum.NoneDockArea&&(this.elements.panel.minHeight=this.minVerticalModeHeight-1),this._switchToVerticalMode(!0),this.startListeningToResize())},c.prototype.startListeningToResize=function(){this._isListeningToResize||(this.elements.panel.addEventListener("resize",this._onResize),this._isListeningToResize=!0)},c.prototype.stopListeningToResize=function(){this.elements.panel.removeEventListener("resize",this._onResize),this._isListeningToResize=!1},c.prototype.startStateLoadingTransaction=function(){this.__surveyLoadingInProgress=!0,this.disable()},c.prototype.endStateLoadingTransaction=function(e){this.__surveyLoadingInProgress=!1,this.options.selectedStateId=e,this.isUsable&&this.enable(),this.__removeIdWhenLoaded&&this.close(this.__removeIdWhenLoaded)},c.prototype.enable=function(){this.elements.disabled.style.display="none"},c.prototype.disable=function(){this.elements.disabled.style.display="block"},c.prototype.setActiveState=function(e){this.__stateStopClicked({target:this.options.sliderStops[e]})},c.prototype.getActiveStateId=function(){return this.options.selectedStateId},c.prototype.__createStateStop=function(e,t,s){const r=o.createElement("div",{class:d+"-stop"}),a=new Date(e.grid["r2v:fsEffectivityDate"]),l=`${e["ds6w:label"]} - ${new Intl.DateTimeFormat(n.getLang(),this.options.dateFormatOptions).format(a)}`,c=JSON.stringify({stateIdx:s,envId:i.getPlatformId(),contextId:n.getSecurityContext(),objectId:e.resourceid,objectType:e.type,displayName:l,description:e["ds6w:description"],serviceId:t,date:a,fromTimeline:!0,soiId:this.options.data.soiData.resourceid,i3dx:e["ds6w:i3dx"],soIdisplayName:this.options.data.soiData["ds6w:label"]});return r.dataset.locstate=e.resourceid,r.dataset.idx=s,r.dataset.state=c,r.dataset.label=`${e["ds6w:label"]} - ${new Intl.DateTimeFormat(n.getLang(),this.options.dateFormatOptions).format(a)}`,r.addEventListener("click",this.__stateStopClicked.bind(this)),r.addEventListener("mouseenter",this.__stateStopMouseEnter.bind(this)),r.addEventListener("mouseleave",(e=>{this.__stateStopMouseLeave({withTimeout:!0,event:e})})),r},c.prototype.__createTooltip=function(e){let i=this.options.data.states[e],n=this.options.sliderStops[e],s=o.createElement("div",{class:d+"-tooltip"});n.tooltip={},n.tooltip.arrow=o.createElement("div",{class:d+"-tooltip-arrow"}),s.appendChild(n.tooltip.arrow),n.tooltip.box=o.createElement("div",{class:d+"-tooltip-box"}),s.appendChild(n.tooltip.box),n.tooltip.box.addEventListener("mouseenter",(()=>{this.isTooltipHovered=!0})),n.tooltip.box.addEventListener("mouseleave",(()=>{this.isTooltipHovered=!1,this.__stateStopMouseLeave({event:{target:{dataset:{idx:e}}},withTimeout:!1})})),n.tooltip.thumbnail=o.createElement("img",{class:d+"-tooltip-thumbnail",src:i.thumbnail}),n.tooltip.box.appendChild(n.tooltip.thumbnail);let r=o.createElement("div",{class:d+"-tooltip-infos"});n.tooltip.box.appendChild(r);let c=this.options.data.soiData["ds6w:label"],p=i["ds6w:label"].substr(c.length+3,i["ds6w:label"].length);for(let e=0;e<5;e++){let n,s;switch(e){case 0:n=t.soiTimelineV2.locationState,s=p;break;case 1:n=t.soiTimelineV2.effectivityDate;let e=new Date(i.grid["r2v:fsEffectivityDate"]);s=l.formatDateToString(e);break;case 2:n=t.soiTimelineV2.owner,s=i.grid["ds6w:responsible"];break;case 3:n=t.soiTimelineV2.locationSurvey,s=i["ds6w:label"];break;case 4:n=t.soiTimelineV2.creationDate;let o=new Date(i.grid["ds6w:created"]);s=l.formatDateToString(o)}let c=o.createElement("div",{class:d+"-tooltip-row"});r.appendChild(c);let u=o.createElement("div",{class:d+"-tooltip-rowTitle"});u.innerText=n,c.appendChild(u);let h=o.createElement("div",{class:d+"-tooltip-rowText"});h.innerText=s,h.tooltipInfos=new a({shortHelp:s}),c.appendChild(h)}return s},c.prototype.__createYearSeparator=function(e,t,i){let n=o.createElement("div",{class:d+"-yearSeparator"}),s=o.createElement("div",{class:d+"-yearBorder"});n.appendChild(s);let r,a=o.createElement("div",{class:d+"-yearText"});return a.innerText=e,n.appendChild(a),r=0===t.length?1:t[i]?0===i?t[i]-.5:i===t.length-1?t[i]-t[i-1]-.5:t[i]-t[i-1]:.5,this.options.gridTemplateYears+=r+"fr ",this.elements.yearSeparators.push({yearSeparator:n,yearBorder:s,yearText:a}),n},c.prototype.__stateStopClicked=function(e){if(!0!==this.__surveyLoadingInProgress){const t=JSON.parse(e.target.dataset.state);if(t.objectId!==this.options.selectedStateId){this.startStateLoadingTransaction();let i=t.displayName;this.elements.stateLabel.innerText=i,"function"==typeof this.options.events.stateStopClicked&&(e.previouslySelected=this.options.selectedStateId,this._selectedSurveyElement&&(this._selectedSurveyElement.classList.remove("state-selected"),this._selectedSurveyElement.tooltip.box.style["box-shadow"]="0px 0px 17px -9px"),e.stateData=t,e.fromInit||r.publish("DS/ExternalWdgtCom/StateStopClicked",e),this.options.events.stateStopClicked(e).then((()=>{this._selectedSurveyElement=e.target,this._selectedSurveyElement.classList.add("state-selected"),this._selectedSurveyElement.tooltip.box.style["box-shadow"]="0px 0px 17px -9px"})))}}},c.prototype.__stateStopMouseEnter=function(e){this.options.sliderStops.forEach((e=>{e.tooltipContainer.classList.remove(d+"-tooltip-mouseover")}));let t=e.target.dataset.idx,i=this.options.sliderStops[t];i.tooltipContainer.classList.add(d+"-tooltip-mouseover");let n=this._getStopCoordinates(i,!1),o=n.top,s=n.left,r=0,a=0;if(this.elements.panel.currentDockArea!==WUXDockAreaEnum.NoneDockArea){let e;e=void 0!==this.elements.panel.windowGroup&&null!==this.elements.panel.windowGroup?this.elements.panel.windowGroup.getContent().parentElement:this.elements.panel.getContent().parentElement}this.isHorizontal?(a=7,r=14):(a=14,r=7),i.tooltipContainer.style.top=o+r+"px",i.tooltipContainer.style.left=s+a+"px",this._computeTooltipPosition(t)},c.prototype.__stateStopMouseLeave=function(e){const t=function(){if(!this.isTooltipHovered){let t=e.event.target.dataset.idx;this.options.sliderStops[t].tooltipContainer.classList.remove(d+"-tooltip-mouseover")}}.bind(this);e.withTimeout?setTimeout((()=>{t()}),400):t()},c.prototype._onReceiveStateStopClicked=function(e){if(!0!==this.__surveyLoadingInProgress&&e.stateData.objectId!==this.options.selectedStateId){this.startStateLoadingTransaction();let t=e.stateData.displayName;this.elements.stateLabel.innerText=t,"function"==typeof this.options.events.stateStopClicked&&(e.previouslySelected=this.options.selectedStateId,this._selectedSurveyElement&&this._selectedSurveyElement.classList.remove("state-selected"),this.options.events.stateStopClicked(e).then((()=>{this._selectedSurveyElement=this.options.sliderStops[e.stateData.stateIdx],this._selectedSurveyElement&&this._selectedSurveyElement.classList.add("state-selected")})))}},c.prototype.updateBS=function(e){this._BSCenter=e.BSCenter},c.prototype._onHorizontalScroll=function(e){e.preventDefault(),this.elements.content.scrollBy({left:e.deltaY<0?-30:30})},c.prototype._onResize=function(e){this._resize(!0)},c.prototype._resize=function(e){if(this.elements.panel.currentDockArea===WUXDockAreaEnum.NoneDockArea){this.elements.panel.windowGroup;let t=this.elements.panel,i=this.elements.content.parentElement.offsetWidth;0!==this.elements.content.parentElement.offsetHeight&&0!==i&&(this.stopListeningToResize(),this.isHorizontal?t.width<this.minHorizontalModeWidth?(e&&(t.minHeight=this.minVerticalModeHeight-1,t.height=this.minVerticalModeHeight),t.minWidth=this.defaultVerticalModeWidth,t.width=this.defaultVerticalModeWidth,this._switchToVerticalMode(!0)):t.height>this.defaultHorizontalModeHeight&&(t.minWidth=this.defaultVerticalModeWidth,t.width=this.defaultVerticalModeWidth,this._switchToVerticalMode(!0)):t.height<this.minVerticalModeHeight?(e&&(t.minWidth=this.minHorizontalModeWidth-1,t.width=this.minHorizontalModeWidth),t.minHeight=this.defaultHorizontalModeHeight,t.height=this.defaultHorizontalModeHeight,this._switchToHorizontalMode(!0)):t.width>this.defaultVerticalModeWidth&&(t.minHeight=this.defaultHorizontalModeHeight,t.height=this.defaultHorizontalModeHeight,this._switchToHorizontalMode(!0)),this.startListeningToResize())}},c.prototype._onPrePlaceChange=function(){if(this.stopListeningToResize(),this.elements.panel.currentDockArea!==WUXDockAreaEnum.NoneDockArea)for(let e=0;e<this.options.sliderStops.length;e++){let t=this.options.sliderStops[e];try{this.elements.tooltipsContainer.removeChild(t.tooltipContainer)}catch(e){}}else if(this.elements.panel.currentDockArea!==WUXDockAreaEnum.NoneDockArea||this.elements.panel.windowGroup){if(this.elements.panel.currentDockArea===WUXDockAreaEnum.NoneDockArea&&this.elements.panel.windowGroup)for(let e=0;e<this.options.sliderStops.length;e++){let t=this.options.sliderStops[e];this.elements.tooltipsContainer.removeChild(t.tooltipContainer)}}else if(this.elements.tooltipsContainer)for(let e=0;e<this.options.sliderStops.length;e++){let t=this.options.sliderStops[e];this.elements.tooltipsContainer.removeChild(t.tooltipContainer)}},c.prototype._onPlaceChange=function(){this.elements.panel.currentDockArea!==WUXDockAreaEnum.NoneDockArea?(void 0!==this.elements.panel.windowGroup&&null!==this.elements.panel.windowGroup?this.elements.tooltipsContainer=this.elements.panel.windowGroup.getContent().parentElement.parentElement.parentElement.parentElement:this.elements.panel.getContent().parentElement&&(this.elements.tooltipsContainer=this.elements.panel.getContent().parentElement.parentElement.parentElement),this.elements.panel.currentDockArea!==WUXDockAreaEnum.LeftDockArea&&this.elements.panel.currentDockArea!==WUXDockAreaEnum.RightDockArea||(this.isHorizontal&&(this.elements.panel.height=this.defaultVerticalModeHeight,this.elements.panel.minWidth=this.defaultVerticalModeWidth,this.elements.panel.width=this.defaultVerticalModeWidth,this._switchToVerticalMode(!0),this.elements.panel.contentVisibleState&&(this.elements.panel.minWidth=this.minVerticalModeHeight)),this.elements.panel.contentVisibleState&&(this.elements.panel.minHeight=this.minVerticalModeHeight)),this.elements.panel.currentDockArea===WUXDockAreaEnum.TopDockArea&&(this.isHorizontal||(this.elements.panel.width=this.defaultHorizontalModeWidth,this.elements.panel.minHeight=this.defaultHorizontalModeHeight,this.elements.panel.height=this.defaultHorizontalModeHeight,this._switchToHorizontalMode(!0),this.elements.panel.contentVisibleState&&(this.elements.panel.minWidth=this.minHorizontalModeWidth)),this.elements.panel.contentVisibleState&&(this.elements.panel.minWidth=this.minHorizontalModeWidth))):(this.elements.panel.contentVisibleState&&(this.isHorizontal?(this.elements.panel.minWidth=this.defaultHorizontalModeWidth-1,this.elements.panel.minHeight=this.defaultHorizontalModeHeight):(this.elements.panel.minWidth=this.defaultVerticalModeWidth,this.elements.panel.minHeight=this.defaultVerticalModeHeight-1)),this.startListeningToResize(),this.elements.panel.windowGroup?this.elements.tooltipsContainer=this.elements.panel.windowGroup.getContent():this.elements.tooltipsContainer=this.elements.panel.getContent());for(let e=0;e<this.options.sliderStops.length;e++){let t=this.options.sliderStops[e];this.elements.tooltipsContainer.appendChild(t.tooltipContainer)}},c.prototype._onContentVisibleStateChange=function(e){!e.options.contentVisibleState&&this.elements.panel.windowGroup&&this.stopListeningToResize()},c.prototype._onActivate=function(){this._resize(!1),this.elements.panel.currentDockArea===WUXDockAreaEnum.NoneDockArea&&this.startListeningToResize()},c.prototype._onDeactivate=function(){this.stopListeningToResize()},c.prototype._computeTooltipPosition=function(e){let t,i;this.options.sliderStops[e].tooltip.arrow.classList.remove(d+"-tooltip-arrow-reversed"),this.options.sliderStops[e].tooltip.arrow.classList.remove(d+"-tooltip-arrow-vertical-reversed"),i=this.elements.panel.currentDockArea===WUXDockAreaEnum.LeftDockArea||this.elements.panel.currentDockArea===WUXDockAreaEnum.RightDockArea?this.elements.tooltipsContainer.offsetHeight:document.getElementById("___view___2").offsetHeight,t=document.getElementById("___view___2").offsetWidth;let n,o,s,r,a=this._getStopCoordinates(this.options.sliderStops[e].tooltipContainer,!0),l=30,c=this.options.sliderStops[e].tooltip.box.offsetWidth,p=this.options.sliderStops[e].tooltip.box.offsetHeight,u=c/2,h=p/2,m=0,f=0;this.isHorizontal?(n=a.left-u,o=a.left+u,s=a.top+l,r=a.top+l+p,m=n<0?5-n:o>t?-(o-t)-5:20,this.options.sliderStops[e].tooltip.box.style.left=m-u+"px",r>i?(f=-p-15-14,this.options.sliderStops[e].tooltip.box.style.top=f+"px",this.options.sliderStops[e].tooltip.arrow.classList.add(d+"-tooltip-arrow-reversed")):(f=15,this.options.sliderStops[e].tooltip.box.style.top=f+"px")):(n=a.left+l,o=a.left+l+c,s=a.top-h,r=a.top+h,f=s<0?-s-5:r>i?-(r-i)-5:0,this.options.sliderStops[e].tooltip.box.style.top=f-p/2+"px",o>t?(m=-c-15-14,this.options.sliderStops[e].tooltip.box.style.left=m+"px",this.options.sliderStops[e].tooltip.arrow.classList.add(d+"-tooltip-arrow-vertical-reversed")):(m=15,this.options.sliderStops[e].tooltip.box.style.left=m+"px"))},c.prototype._switchToHorizontalMode=function(e){this.isHorizontal=!0,window.localStorage.setItem("ENO3DR2VTimelineMode","horizontal");let t=this.elements.panel;e&&(this.stopListeningToResize(),t.minWidth=this.minHorizontalModeWidth-1,this.startListeningToResize()),this.elements.stateHeader.classList.remove(d+"-header-vertical"),this.elements.yearSeparatorContainer.style.gridTemplateRows="",this.elements.yearSeparatorContainer.style.gridTemplateColumns=this.options.gridTemplateYears,this.elements.content.addEventListener("wheel",this._onHorizontalScroll),this.elements.content.classList.add(d+"-container"),this.elements.content.classList.remove(d+"-container-vertical"),this.elements.stateTimeline.classList.add(d+"-slider"),this.elements.stateTimeline.classList.remove(d+"-slider-vertical"),this.elements.stateTimeline.style["min-height"]="0px",this.elements.stateTimeline.style["max-height"]="100%",this.elements.stateTimeline.style["min-width"]=28*this.options.data.states.length+"px",this.elements.stateTimeline.style["max-width"]=document.getElementById("___view___2").offsetWidth+"px",this.elements.sliderLine.classList.add(d+"-line"),this.elements.sliderLine.classList.remove(d+"-line-vertical"),this.elements.sliderTrack.classList.add(d+"-track"),this.elements.sliderTrack.classList.remove(d+"-track-vertical");for(let e=0;e<this.options.sliderStops.length;++e){let t=this.options.sliderStops[e];t.classList.add(d+"-stop"),t.classList.remove(d+"-stop-vertical"),t.stopDate.classList.add(d+"-stopDate"),t.stopDate.classList.remove(d+"-stopDate-vertical"),t.tooltip.arrow.classList.add(d+"-tooltip-arrow"),t.tooltip.arrow.classList.remove(d+"-tooltip-arrow-vertical"),t.tooltip.box.classList.add(d+"-tooltip-box"),t.tooltip.box.classList.remove(d+"-tooltip-box-vertical")}this.elements.yearSeparatorContainer.classList.add(d+"-yearSeparators"),this.elements.yearSeparatorContainer.classList.remove(d+"-yearSeparators-vertical");for(let e=0;e<this.elements.yearSeparators.length;e++){let t=this.elements.yearSeparators[e];t.yearSeparator.classList.add(d+"-yearSeparator"),t.yearSeparator.classList.remove(d+"-yearSeparator-vertical"),t.yearBorder.classList.add(d+"-yearBorder"),t.yearBorder.classList.remove(d+"-yearBorder-vertical"),t.yearBorder.style["border-left"]=t.yearBorder.style["border-bottom"],t.yearText.classList.add(d+"-yearText"),t.yearText.classList.remove(d+"-yearText-vertical")}},c.prototype._switchToVerticalMode=function(e){this.isHorizontal=!1,window.localStorage.setItem("ENO3DR2VTimelineMode","vertical");let t=this.elements.panel;e&&(this.stopListeningToResize(),t.currentDockArea!==WUXDockAreaEnum.LeftDockArea&&t.currentDockArea!==WUXDockAreaEnum.RightDockArea&&(t.minHeight=this.minVerticalModeHeight-1),this.startListeningToResize()),this.elements.stateHeader.classList.add(d+"-header-vertical"),this.elements.yearSeparatorContainer.style.gridTemplateColumns="",this.elements.yearSeparatorContainer.style.gridTemplateRows=this.options.gridTemplateYears,this.elements.content.removeEventListener("wheel",this._onHorizontalScroll),this.elements.content.classList.remove(d+"-container"),this.elements.content.classList.add(d+"-container-vertical"),this.elements.stateTimeline.style["min-width"]="0px",this.elements.stateTimeline.style["max-width"]="100%",this.elements.stateTimeline.classList.remove(d+"-slider"),this.elements.stateTimeline.classList.add(d+"-slider-vertical"),this.elements.stateTimeline.style["min-height"]=28*this.options.data.states.length+"px",this.elements.stateTimeline.style["max-height"]=""+document.getElementById("___view___2").offsetHeight-100+"px",this.elements.sliderLine.classList.remove(d+"-line"),this.elements.sliderLine.classList.add(d+"-line-vertical"),this.elements.sliderTrack.classList.remove(d+"-track"),this.elements.sliderTrack.classList.add(d+"-track-vertical");for(let e=0;e<this.options.sliderStops.length;++e){let t=this.options.sliderStops[e];t.classList.remove(d+"-stop"),t.classList.add(d+"-stop-vertical"),t.stopDate.classList.remove(d+"-stopDate"),t.stopDate.classList.add(d+"-stopDate-vertical"),t.tooltip.arrow.classList.remove(d+"-tooltip-arrow"),t.tooltip.arrow.classList.add(d+"-tooltip-arrow-vertical"),t.tooltip.box.classList.remove(d+"-tooltip-box"),t.tooltip.box.classList.add(d+"-tooltip-box-vertical")}this.elements.yearSeparatorContainer.classList.remove(d+"-yearSeparators"),this.elements.yearSeparatorContainer.classList.add(d+"-yearSeparators-vertical");for(let e=0;e<this.elements.yearSeparators.length;e++){let t=this.elements.yearSeparators[e];t.yearSeparator.classList.remove(d+"-yearSeparator"),t.yearSeparator.classList.add(d+"-yearSeparator-vertical"),t.yearBorder.classList.remove(d+"-yearBorder"),t.yearBorder.classList.add(d+"-yearBorder-vertical"),t.yearBorder.style["border-top"]=t.yearBorder.style["border-bottom"],t.yearText.classList.remove(d+"-yearText"),t.yearText.classList.add(d+"-yearText-vertical")}},c.prototype._getStopCoordinates=function(e,t){if(t){var i=e.getBoundingClientRect(),n=document.body,o=document.documentElement,s=window.scrollY||o.scrollTop||n.scrollTop,r=window.scrollX||o.scrollLeft||n.scrollLeft,a=o.clientTop||n.clientTop||0,l=o.clientLeft||n.clientLeft||0,d=i.top-s-a,c=i.left-r-l;return{top:Math.round(d),left:Math.round(c)}}var p=e.getBoundingClientRect(),u=this.elements.tooltipsContainer.getBoundingClientRect();s=this.elements.tooltipsContainer.scrollTop,r=this.elements.tooltipsContainer.scrollLeft,d=p.top-s-u.top,c=p.left-r-u.left;return{top:Math.round(d),left:Math.round(c)}},c.prototype.updateThumbnail=function(e,t){this.options.sliderStops[e].tooltip.thumbnail.src=t},c})),define("DS/PADServices/ws/WSAdmin",["DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils"],(function(e,t){"use strict";function i(){}return i.prototype.getTypesHierarchy=function(t){return new Promise(function(i,n){var o=e.get3DSpaceURL()+"/resources/enong/dico/gettypeshierarchy?tenant="+e.getPlatformId(),s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({types:t}),onComplete:i,onFailure:n};this.executeRequest(o,s)}.bind(this))},i.prototype.getTypeInfo=function(i){return new Promise(function(n,o){var s=e.get3DSpaceURL()+"/resources/dictionary/getTypeInfo?tenant="+e.getPlatformId();i.onlyCustomer&&(s+="&customerOnly=true&displayAttributes=true");var r={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},onComplete:n,onFailure:o};if(i.url_parameters){for(var a=Object.getOwnPropertyNames(i.url_parameters),l=0;l<a.length;l++)s=s+"&"+a[l]+"="+i.url_parameters[a[l]];delete i.url_parameters}r.data=JSON.stringify(i.body),delete r.body,this.executeRequest(s,r)}.bind(this))},i.prototype.getFullDictionary=function(i){return new Promise(function(n,o){var s=e.get3DSpaceURL()+"/resources/dictionary/Dictionary?tenant="+e.getPlatformId();i&&i.getNLS&&(s+="&lang="+t.getLang());var r={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},timeout:3e5,onComplete:n,onFailure:o,onTimeout:o};this.executeRequest(s,r)}.bind(this))},i.prototype.getPermissionRules=async function(){var i=`${e.getPlatformURL("3DSpace")}/resources/ParamWS/access/DomainElements?tenant=${e.getPlatformId()}&domainid=DataAccessRight&xrequestedwith=xmlhttprequest`,n={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()}};return this.executeRequestPromise(i,n,!0)},i.prototype.interfaces=function(i){return new Promise(function(n,o){var s=e.get3DSpaceURL()+"/resources/dictionary/class/interfaces?tenant="+e.getPlatformId();i.onlyCustomer&&(s+="&customerOnly=true&displayAttributes=true");var r={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},onComplete:n,onFailure:o};r.data=JSON.stringify(i.data),this.executeRequest(s,r)}.bind(this))},i.prototype.retrievePQ=function(){return new Promise(function(i,n){var o=e.get3DSpaceURL()+"/resources/SNAPI/pq_services/pqs?tenant="+e.getPlatformId(),s={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},cache:-1,onComplete:i,onFailure:n};this.executeRequest(o,s)}.bind(this))},i.prototype.getscandcollab=async function(i){return new Promise(((n,o)=>{try{var s={},r=e.get3DSpaceURL()+"/resources/modeler/pno/person?current=true&select=preferredcredentials&select=collabspaces&tenant="+e.getPlatformId();s.method="GET",s.headers={Accept:"application/json","Accept-Language":t.getLang(),"Content-Type":"application/json"},s.cache=-1,s.onComplete=n,s.onFailure=o,!0===i&&(r=e.get3DSpaceURL()+"/resources/modeler/pno/person?current=true&select=collabspaces&tenant="+e.getPlatformId()),this.executeRequest(r,s)}catch(e){console.warn("Cannot retrueve the SC"),o()}}))},i.prototype.getTemplates=function(){return new Promise(function(i,n){var o={},s=e.get3DSpaceURL()+"/resources/v1/collabServices/authoring/op/getTemplatesNames?tenant="+e.getPlatformId()+"&templateType=component";o.method="GET",o.headers={Accept:"application/json","Accept-Language":t.getLang(),"Content-Type":"application/json"},o.cache=-1,o.onComplete=i,o.onFailure=n,o.type="json",this.executeRequest(s,o)}.bind(this))},i.prototype.getTemplatesV2=function(){return new Promise(function(i,n){var o={},s=e.get3DSpaceURL()+"/resources/v1/collabServices/authoring/createContent/typeInfo?tenant="+e.getPlatformId()+"&objType=VPMReference&preferedType=VPMReference&typeName=component&subTypes=true";o.method="GET",o.headers={Accept:"application/json","Accept-Language":t.getLang(),"Content-Type":"application/json"},o.cache=-1,o.onComplete=i,o.onFailure=n,o.type="json",this.executeRequest(s,o)}.bind(this))},i.prototype.prodConfig=function(){return new Promise(function(i,n){var o=e.get3DSpaceURL()+"/resources/modeler/configuration/settingsServices/getConfigurationSettings?tenant="+e.getPlatformId(),s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},data:JSON.stringify({version:"1.0",settings:["StaticMappingActivation"]}),onComplete:i,onFailure:n};this.executeRequest(o,s)}.bind(this))},i.prototype.setMePreferences=async function(t){return new Promise(((i,n)=>{var o=e.getPlatformURL("mepreferences")+"/api/v1/preferences?tenant="+e.getPlatformId(),s={method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify(t),onComplete:i,onFailure:n};this.executeRequest(o,s,!0)}))},i.prototype.getProductConfiguration=function(i){let n=this;return new Promise(((o,s)=>{let r={version:"1.0",settings:i.settingsArray},a=new URL(e.get3DSpaceURL());a.pathname+="/resources/modeler/configuration/settingsServices/getConfigurationSettings",a.searchParams.set("tenant",e.getPlatformId());let l=a.toString(),d={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},data:JSON.stringify(r),onComplete:function(e){let t="string"==typeof typeof e?JSON.parse(e):e;o(t)},onFailure:function(e){s({isTimeout:!1,error:e})},onTimeout:function(e){s({isTimeout:!0,error:errObj})}};n.executeRequest(l,d)}))},i.prototype.retrieveDimensions=async function(){var i=e.getPlatformURL("3DSpace")+"/resources/dictionary/dimensions?tenant="+e.getPlatformId(),n={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()}};return this.executeRequestPromise(i,n,"dictionary/dimensions")},i})),define("DS/PADServices/ws/WSFilter",["DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils"],(function(e,t){"use strict";function i(){}return i.prototype.fetchFilter=function(i){return new Promise(function(n,o){var s=i.data.filterids,r=t.getSecurityContext(),a=e.get3DSpaceURL()+"/resources/FilterBIAPI/Filter/getBasicsInDBFromIds?tenant="+e.getPlatformId(),l={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},timeout:i.timeout?i.timeout:void 0,data:JSON.stringify(s),onComplete:n,onFailure:o};r&&(a+="&SecurityContext="+r),this.executeRequest(a,l)}.bind(this))},i})),define("DS/PADServices/settings/AppSettings",["DS/PADServices/utils/GlobalUtils"],(function(e){"use strict";function t(e,t,i){for(var n=Object.keys(e),o=0;o<n.length;o++)e[n[o]].debug=i,t.set(n[o],e[n[o]])}function i(){return"object"==typeof i.instance?i.instance:(i.instance=this,this._defaultUUID="DefaultSettingUUID-"+e.getWidgetId(),this._settingsMap=new Map,this)}return i.prototype.initializeSettings=async function(e,i){return new Promise(((n,o)=>{if(e.AMDSettings);else if(e.padsettingsInit){var s=this.getSettingsMap(i,!0);t(e.padsettingsInit.run_options,s),t(e.padsettingsInit.debug_options,s,!0),t(e.padsettingsInit.session_options,s)}else o();n()}))},i.prototype.getSettingsMap=function(e,t){void 0===e&&(e=this._defaultUUID);var i=this._settingsMap.get(e);return void 0===i&&!0===t&&(i=new Map,this._settingsMap.set(e,i)),i},i.prototype.getSetting=function(t,i){var n,o,s=e.getURLParameter(t),r=s?(n=s,o=!1,UWA.is(n,"boolean")?o=n:UWA.is(n,"string")&&(o="true"===n.toLowerCase()),o):void 0;if(void 0===r){var a,l=this.getSettingsMap(i);l&&(a=l.get(t)),r=l&&a?a.value:void 0}return r},i.prototype.setSetting=function(e,t,i){var n,o=this.getSettingsMap(i,!0);o&&((n=o.get(e))?n.value=t:n={value:t,debug:!0},o.set(e,n),void 0===i&&(i=this._defaultUUID),this._settingsMap.set(i,o))},i.prototype._dump=function(e){var t={};const i=this.getSettingsMap(e).entries();for(var n=i.next();!1===n.done;)t[n.value[0]]=n.value[1],n=i.next();return t},new i})),define("DS/PADServices/ws/R2VServices",["DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils","DS/PADServices/settings/AppSettings","DS/WAFData/WAFData"],(function(e,t,i,n){"use strict";function o(){}return o.prototype.getR2VAssets=function(t){return new Promise(function(t,o,s){let r=e.getPlatformURL(t.serviceId)+"/enovia/resources/r2v/v1/modeler/featurestate/"+t.objectId+"/assets";!0===i.getSetting("eno3dview_r2vservices_v2")&&(r=e.getPlatformURL(t.serviceId)+"/enovia/resources/r2v/modeler/v2/ingest/"+t.objectId+"/assets");const a={cors:!0,method:"GET",headers:{"Accept-Language":"*"},onComplete:o,onFailure:function(){s("FAILURE")},onTimeout:function(){s("TIMEOUT")}};n.authenticatedRequest(r,a)}.bind(this,t))},o.prototype.getFeatureState=function(n){let o="";!0===n.isFork&&(o="/nexts?");let s=e.getPlatformURL(n.serviceId)+"/enovia/resources/r2v/v1/modeler/featurestate/"+n.objectId+o;!0===i.getSetting("eno3dview_r2vservices_v2")&&(s=e.getPlatformURL(n.serviceId)+"/enovia/resources/r2v/modeler/v2/activity/"+n.objectId);const r={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()}};return this.executeRequestPromise(s,r,!0,!0)},o.prototype.fetchFeatureStates=function(n){let o=e.getPlatformURL(n.serviceId)+"/enovia/resources/r2v/v1/modeler/featurestate/fetch";!0===i.getSetting("eno3dview_r2vservices_v2")&&(o=e.getPlatformURL(n.serviceId)+"/enovia/resources/r2v/modeler/v2/activity/fetch");const s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},data:JSON.stringify({ids:n.ids})};return this.executeRequestPromise(o,s,!0,!0)},o.prototype.getSoIActivities=function(i){let n=e.getPlatformURL(i.serviceId)+"/enovia/resources/r2v/modeler/v2/featureofinterest/"+i.objectId+"/activities",o={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()}};return this.executeRequestPromise(n,o,!0,!0)},o.prototype.getBSFActivity=function(i){let n=e.getPlatformURL(i.serviceId)+"/enovia/resources/r2v/modeler/v2/i3dx/fetch",o={data:[{"ds6w:i3dx":i.id}]},s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},data:JSON.stringify(o)};return this.executeRequestPromise(n,s,!0,!0)},o.prototype.getSoI=function(n){let o=e.getPlatformURL(n.serviceId)+"/enovia/resources/r2v/v1/modeler/featureofinterest/"+n.objectId;!0===i.getSetting("eno3dview_r2vservices_v2")&&(o=e.getPlatformURL(n.serviceId)+"/enovia/resources/r2v/modeler/v2/featureofinterest/"+n.objectId);let s={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()}};return this.executeRequestPromise(o,s,!0,!0)},o.prototype.fetchSoIs=function(n){let o=e.getPlatformURL(n.serviceId)+"/enovia/resources/r2v/v1/modeler/featureofinterest/fetch";!0===i.getSetting("eno3dview_r2vservices_v2")&&(o=e.getPlatformURL(n.serviceId)+"/enovia/resources/r2v/modeler/v2/featureofinterest/fetch");let s={ids:n.ids},r={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},data:JSON.stringify(s)};return this.executeRequestPromise(o,r,!0,!0)},o.prototype.getFeatureStatesFromSOI=function(n){let o=e.getPlatformURL(n.serviceId)+"/enovia/resources/r2v/v1/modeler/featureofinterest/"+n.objectId+"/featurestates?mainChainOnly=true";!0===i.getSetting("eno3dview_r2vservices_v2")&&(o=e.getPlatformURL(n.serviceId)+"/enovia/resources/r2v/modeler/v2/featureofinterest/"+n.objectId+"/activities?type=INGEST&type=UPDATE&type=PREVISUALIZATION&mainChainOnly=true");const s={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()}};return this.executeRequestPromise(o,s,!0,!0)},o.prototype.fetchInfosFromI3DX=function(i){const n=e.getPlatformURL("r2vsurvey")+"/enovia/resources/r2v/modeler/v2/i3dx/fetch";let o={data:i.data},s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},data:JSON.stringify(o)};return this.executeRequestPromise(n,s,!0,!0)},o})),define("DS/PADServices/utils/Storage",["DS/PADServices/utils/GlobalUtils"],(function(e){function t(e){this.root=e}t.prototype={set:function(e,t){try{return this.root.setItem(e,JSON.stringify(t)),!0}catch(t){return console.error(t),console.error(`${e} not stored`),t&&"QuotaExceededError"===t.name&&console.error(`${e} data may be the quotexceed problem.`),!1}},setWithExpire:function(e,t,i){return t.expiresAt=Date.now()+i,this.set(e,t)},get:function(e){var t;try{t=JSON.parse(this.root.getItem(e))}catch(e){return console.error(e),null}return t&&t.expiresAt?Date.now()<t.expiresAt?t:(this.root.removeItem(e),null):t},del:function(e){this.root.removeItem(e)},clear:function(){this.root.clear()}};var i={local:new t(localStorage),session:new t(sessionStorage)},n={buildKey:function(t,i,n){return n?t+"."+e.getWidgetId()+"."+i:t+"."+i}};return Object.defineProperties(n,{local:{get:function(){return i.local}},sess:{get:function(){return i.session}}}),n})),define("DS/PADServices/utils/PADTrackerManager",["text!DS/PADServices/assets/init/TrackerMetrics.json","DS/Usage/TrackerAPI","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL"],(function(e,t,i,n){"use strict";var o={},s=Date.now();function r(){return"object"==typeof r.instance?r.instance:(r.instance=this,this)}function a(t,i){return this._id=t.id,this._trackerMetrics=i?JSON.parse(i):JSON.parse(e),this.widgetId=t.widgetId,this.eventCategory=t.eventCategory,this.eventAction=t.eventAction,this.appID=t.appID,this.tenant=t.tenant,this.eventLabel=null,this.eventValue=null,this.persDim={},this.persVal={},this.persDim.pd1=this.widgetId,this.persVal.pv1=Date.now()-s,this}return r.prototype.getPADTracker=function(e,t){var s=e.widgetId?e.widgetId:i.getWidgetId(),r=s+"_"+e.eventCategory+"_"+e.eventAction;if(o[r])return o[r];var l=new a({widgetId:s,eventCategory:e.eventCategory,eventAction:e.eventAction,appID:e.appID?e.appID:i.getAppId(),tenant:e.tenant?e.tenant:n.getPlatformId(),id:r},t);return o[r]=l,l},r.prototype.addCommandHit=function(e,t){var i=this.getPADTracker({eventCategory:"usage",eventAction:t||"command"});i.setEventData({eventLabel:e}),i.trackPageEvent()},a.prototype.setEventData=function(e){if(e.hasOwnProperty("eventLabel")){let t=Object.keys(e);for(let i=0;i<t.length;i++)"eventLabel"===t[i]?this.eventLabel=e.eventLabel:"eventValue"===t[i]?this.eventValue=e.eventValue:"txKey"===t[i]?this.txKey=e.txKey:0===t[i].indexOf("pd")&&(this.persDim[t[i]]=e[t[i]])}},a.prototype.addMultivaluedEventData=function(e,t,i){var n=this._trackerMetrics[e];if(void 0!==n){var o=Object.keys(t);for(var s in o){var r=o[s];void 0!==n[r]&&(this.persDim["pd"+n[r]]=r,t[r]&&(this.persVal["pv"+n[r]]=t[r]))}i&&(i.filtered&&(this.persDim.pd18=i.filtered),i.labelKey&&(this.persDim.pd19=i.labelKey),i.txKey&&(this.persDim.pd20=i.txKey))}},a.prototype.setProxyData=function(e){this.eventLabel=e.topic,this.persDim.pd2=e.direction,this.persVal.pv2=1,e.originAppId&&(this.persDim.pd3=e.originAppId,this.persVal.pv3=1),this.persDim.pd4=e.isPrivate?"private":"public",this.persVal.pv4=1,void 0!==e.sameApp&&(this.persDim.pd5=e.sameApp?"sameApp":"otherWidget",this.persVal.pv5=1)},a.prototype.setWidgetLinkEventsData=function(e){this.eventLabel=e.topic,this.persDim.pd2=e.fromAppId,this.persVal.pv2=1},a.prototype.setDims=function(e){if(e.dims){var t=Object.keys(e.dims);for(var i in t){var n=t[i];this.persDim[n]=e.dims[n]}}if(e.vals){t=Object.keys(e.vals);for(var i in t){n=t[i];this.persVal[n]=e.vals[n]}}},a.prototype.trackPageEvent=function(){if(this.eventCategory&&this.eventAction)if(o[this._id]){this.txKey&&(this.persDim.pd20=this.txKey);var e={eventCategory:this.eventCategory,eventAction:this.eventAction,eventLabel:this.eventLabel,eventValue:this.eventValue,appID:this.appID,tenant:this.tenant,persDim:this.persDim,persVal:this.persVal};console.debug("track page event with input = "),console.debug(e),t.trackPageEvent(e),o[this._id]&&delete o[this._id]}else console.error("tracker not found, might be deleted");else console.error("Not able to send trackpageEvent query: check eventCategory and eventAction input")},new r})),define("DS/PADServices/utils/TrackerInsert",["DS/PADServices/utils/PADTrackerManager","DS/PADServices/utils/Meas"],(function(e,t){"use strict";function i(e,t,i,n){this._measSection=e,this._nameForMeasure=t,this._nameForTracker=i,this._trackerOptions=n,this._measSection.start(this._nameForMeasure)}return i.prototype={end:function(){this._measSection.end(this._nameForMeasure);let t=this._measSection.meas(this._nameForMeasure);if(t){let i=e.getPADTracker(this._trackerOptions);if(i){const e=t.duration,n=t.startTime;i.addMultivaluedEventData(this._nameForTracker,{call_refresh_start:n,call_refresh_duration:e}),i.trackPageEvent()}}}},i})),define("DS/PADServices/utils/CompassUtils",["DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL","DS/i3DXCompassServices/i3DXCompassPubSub","UWA/Utils/InterCom"],(function(e,t,i,n){"use strict";let o=null;function s(t,i={},n="2.1"){let o={protocol:"3DXContent",source:e.getAppId(),widgetId:e.getWidgetId(),data:{items:[]}};if("2.1"===n){o.version="2.1";for(let e=0;e<t.length;e++)!0!==t[e].isGroupingNode&&o.data.items.push(a(t[e],i))}else{o.version="1.1";for(let e=0;e<t.length;e++)!0!==t[e].isGroupingNode&&o.data.items.push(r(t[e],i))}return o}function r(i,n){const o=[i.options.type];return n&&n[i.options.type]&&(o=n[i.options.type]),{envId:t.getPlatformId(),serviceId:i.options.serviceId?i.options.serviceId:"3DSpace",contextId:e.getSecurityContext(),objectId:i.options.resourceid,objectType:i.options.type,objectTaxonomies:o}}function a(i,n){let o=[];o=n&&n[i.options.type]?n[i.options.type]:[i.options.type];const s=i.options.i3dx||"",r={envId:t.getPlatformId(),serviceId:i.options.serviceId?i.options.serviceId:"3DSpace",contextId:e.getSecurityContext(),objectId:i.options.resourceid,objectType:i.options.type,objectTaxonomies:o,i3dx:s,cpid:i.options.cpid},a=function(t){return t.isRelationsObjectNode?void 0:e.isFakeTreeNodeModel(t)?t.getParent().getOccurencePathWithType():t.getOccurencePathWithType?t.getOccurencePathWithType():void 0}(i);return a&&(r.displayName=i.options.display?i.options.display:i.getLabel(),r.displayType=i.options.grid["ds6w:type"],r.path=a),r}function l(){return"object"==typeof l.instance?l.instance:(l.instance=this,this)}return l.prototype.launchApp=function(n){var o=n.context.model,r=n.context.appName,a=s([o]);n={x3dSharedId:e.getSharedId(),x3dPlatformId:t.getPlatformId(),CollabSpacePref:JSON.stringify(a)};if(e.isWebInWinContext()){var l={objectId:o.options.resourceid,envId:t.getPlatformId(),contextId:e.getSecurityContext(),serviceId:"3DSpace"};i.publish("setObject",l),i.subscribe("launchAppCallback",(function(n){n.appId===r&&n.widgetId===e.getWidgetId()&&i.publish("setObject",{objectId:"",envId:t.getPlatformId(),contextId:"",serviceId:"3DSpace"})}));var d={appId:r,widgetId:e.getWidgetId()};i.publish("launchApp",d,(function(e){console.log("CompassUtils:launchApp called back with["+JSON.stringify(e)+"]")}))}else require(["DS/TransientWidget/TransientWidget"],(function(e){e.showWidget(r,void 0,n,(function(e){console.log("CompassUtils:launchApp called back with["+JSON.stringify(e)+"]")}))}))},l.prototype.setObject=function(e){var t="undefined"!=typeof widget&&widget.id?"padcompassSocket_"+widget.id:"padcompassSocket";if(!UWA.is(e.nodes,"array"))throw new Error("setObject: Invalid init parameter nodes");if(null===o&&(o=new n.Socket(t),o.subscribeServer("com.ds.compass",window.parent)),0===e.nodes.length)o.dispatchEvent("onResetX3DContent",{},t);else{var i=s(e.nodes);o.dispatchEvent("onSetX3DContent",i,t)}},l.prototype.contentOpenWith=async function(e){return new Promise((t=>{let i=[];e.forEach((function(e){-1===i.indexOf(e.options.type)&&i.push(e.options.type)}));require(["DS/PADUtils/PADTypesMgt"],(n=>{n.retrieveHierarchy(i,(i=>{let n=this.buildX3DContent(e,i,"2.1");t(n)}))}))}))},l.prototype.buildDnDData=s,l.prototype.buildX3DContent=s,new l})),define("DS/PADServices/utils/SearchUtils",["DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/CompassUtils","UWA/Utils/InterCom","DS/Utilities/Utils"],(function(e,t,i,n,o){"use strict";function s(){return"object"==typeof s.instance?s.instance:(s.instance=this,this)}return s.prototype.inAppsSearch=function(i){var s=Object.assign(function(){var i={mode:"furtive",default_with_precond:!0,widget_id:t.getWidgetId(),app_socket_id:"enosearchutils_"+t.getWidgetId(),idcard_activated:!1,tenant:e.getPlatformId()};return i}(),i),r=new n.Socket(s.app_socket_id,{dispacthRetryInterval:0});!0===i.debug_mode&&r.setDebugMode(!0),UWA.is(i.parent_window)?r.subscribeServer("SearchComServer",window):r.subscribeServer("SearchComServer"),r.dispatchEvent("RegisterContext",s),UWA.is(i.context_name)&&(s.context_title=i.context_name),s.default_search_criteria=i.fts_value,r.dispatchEvent("InContextSearch",s);var a,l=[];r.addListener("InContextSearch_Response",(function(e){e,l=e.selected_objects,a=e.selected_command}));var d=o.debounce((function(e){switch(a){case"in_app_ok":i.callback.call(null,l);break;case"in_app_apply":i.apply?i.apply.call(null,l):i.callback.call(null,l);break;default:i.cancel&&i.cancel.call(null)}r.removeListener("onCloseTransient",d),r.dispatchEvent("UnregisterContext",{widget_id:s.widget_id})}),200);r.addListener("InContextSearch_Response",d),r.addListener("onCloseTransient",d),r.addListener("onCloseTransient",(function(e){i.cancel&&i.cancel.call(null),r.dispatchEvent("UnregisterContext",{widget_id:s.widget_id})}))},s.prototype.createDropDataFromSearch=function(e){var t=[];for(let i=0;i<e.length;i++){var n={options:{label:e[i]["ds6w:label"],resourceid:e[i].resourceid,type:e[i]["ds6w:type_value"]}};t.push(n)}return i.buildDnDData(t)},new s})),define("DS/PADServices/utils/ClassificationAttributes",["UWA/Core","UWA/Promise","DS/PADServices/utils/GlobalUtils","DS/PADServices/settings/AppSettings","DS/Utilities/Utils"],(function(e,t,i,n,o){"use strict";var s=!1;return{getClassificationAttributes:function(e){return new t((function(e,t){let o=n.getSetting("activateFUN118223");if(s||!0!==o)return e();require(["DS/ClassificationUtil/ClassificationUtil"],(function(t){t.fetchClassificationAttributes({apiVersion:"R2019x",lang:i.getLang(),onComplete:function(t){e(t)},onFailure:function(t){console.warn("Cannot retrieve Classification Attributes"),e()}})}),(function(){s=!0,e()}))}))}}})),define("DS/PADServices/utils/DictionaryAccess",["UWA/Core","UWA/Promise","DS/Utilities/Utils","DS/FedDictionaryAccess/FedDictionaryAccessAPI","i18n!DS/PADServices/assets/nls/PADServices.json","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/NlsCache","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/ClassificationAttributes"],(function(e,t,i,n,o,s,r,a,l){"use strict";var d={nodes2updateId:[],nodes2update:[],grpnodes2updateId:[],grpnodes2update:[],idx:0,idxGrp:0};const c=["globaltype","ds6wg:revision","ds6w:type","ds6w:cadMaster","ds6w:status"],p=["ds6w:label","ds6w:type","ds6w:description","ds6w:identifier","ds6w:modified","ds6w:responsible","ds6wg:revision","ds6w:status","owner","ds6w:created"];function u(e,t,i){e[t]||(e[t]=[]),-1===e[t].indexOf(i)&&e[t].push(i)}function h(t,i,n){for(var o=!1,s={grid:e.clone(t.options.grid)},r=0;r<i.length;r++)s.grid[i[r]]&&n[i[r]][s.grid[i[r]]]&&n[i[r]][s.grid[i[r]]]!==s.grid[i[r]]&&(o=!0,s.grid[i[r]]=n[i[r]][s.grid[i[r]]]);return{updated:o,options:s}}var m="R2019x",f=i.debounce((function(t){v.idx=0;var i,o,l,p={},u=require("DS/PADServices/utils/AttributesMgtV2"),h=u.getAvailableColumns(),f=u.getColumnsToNotNls(),g=h.filter((function(e){return-1===f.indexOf(e)}));for(i=0;i<t.length;i++){l=t[i].getTreeDocument();var b=t[i].options.grid?Object.getOwnPropertyNames(t[i].options.grid):[];for(o=0;o<b.length;o++)if(u.hasNLS(b[o])&&"ds6w:reserved"!==b[o]&&"ds6w:reserved-Instance"!==b[o]&&"positionMatrix-Instance"!==b[o]&&-1!==g.indexOf(b[o])){var S=-1!==b[o].indexOf("-Instance")?b[o].substring(0,b[o].indexOf("-Instance")):b[o];void 0===p[S]&&(p[S]=[]),-1===p[S].indexOf(t[i].options.grid[b[o]])&&p[S].push(t[i].options.grid[b[o]])}}n.getNlsOfPropertiesValues(JSON.stringify(p),{tenantId:a.getPlatformId(),lang:s.getLang(),apiVersion:m,onComplete:function(n){var s=e.is(n,"string")?JSON.parse(n):n;Object.getOwnPropertyNames(s);function a(t){var i=!1,n={grid:e.clone(t.options.grid)},a=Object.keys(n.grid);for(o=0;o<a.length;o++){var l=-1!==a[o].indexOf("-Instance")?a[o].substring(0,a[o].indexOf("-Instance")):a[o];if(s[l]&&s[l][n.grid[a[o]]]&&s[l][n.grid[a[o]]]!==n.grid[a[o]]){i=!0,n.grid[a[o]+"-original"]=n.grid[a[o]],n.grid[a[o]]=s[l][n.grid[a[o]]];let e=a[o],t=e+"-original";-1!==c.indexOf(e)&&r.store(e,n.grid[t],n.grid[e])}}return{updated:i,options:n}}if(l)l.setUseChangeTransactionMode(!0),l.withTransactionUpdate((function(){for(i=0;i<t.length;i++){var e=t[i],n=a(e);!0===n.updated&&e.updateOptions(n.options),delete e._manageNLS,e.options.ensureNLS=!1}d.nodes2updateId=[],d.nodes2update=[]})),l.setUseChangeTransactionMode(!1);else{for(i=0;i<t.length;i++){var p=t[i],u=a(p);!0===u.updated&&p.updateOptions(u.options),delete p._manageNLS,p.options.ensureNLS=!1}d.nodes2updateId=[],d.nodes2update=[]}},onFailure:function(e){console.warn("Cannot retrieve NLS"),d.nodes2updateId=[],d.nodes2update=[]}})}),200),g=i.debounce((function(t){v.idxGrp=0;var i,o,r={};if(t.length){for(o=t[0].getTreeDocument(),i=0;i<t.length;i++){var l=t[i].options.ds6w;r[l]||(r[l]=[]),-1===r[l].indexOf(t[i].getLabel())&&r[l].push(t[i].getLabel())}n.getNlsOfPropertiesValues(JSON.stringify(r),{tenantId:a.getPlatformId(),lang:s.getLang(),apiVersion:m,onComplete:function(n){var s=e.is(n,"string")?JSON.parse(n):n;function r(n){var o={label:e.clone(n.getLabel())},r=!1,a=t[i].options.ds6w;return s[a]&&s[a][n.getLabel()]&&n.getLabel()!==s[a][n.getLabel()]&&(r=!0,o.label=s[a][n.getLabel()]),{updated:r,options:o}}o&&(o.setUseChangeTransactionMode(!0),o.withTransactionUpdate((function(){for(i=0;i<t.length;i++){var e=t[i],n=r(e);!0===n.updated&&e.updateOptions(n.options),delete e._manageNLS}d.grpnodes2updateId=[],d.grpnodes2update=[]})),o.setUseChangeTransactionMode(!1))},onFailure:function(e){console.warn("Cannot retrieve NLS"),d.grpnodes2updateId=[],d.grpnodes2update=[]}})}}),100),v={__mapAttNameNLS:{},initNLS:function(){return this.retrieveDS6WNLS(p)},getAttNameNLS:function(e){return this.__mapAttNameNLS[e]?this.__mapAttNameNLS[e].label:o.columnsNLS[e]?o.columnsNLS[e]:e},retrieveDS6WNLS:async function(e){return new t(((t,i)=>{var o={tenantId:a.getPlatformId(),lang:s.getLang(),apiVersion:m,onComplete:e=>{for(let t=0;t<e.length;t++)this.__mapAttNameNLS[e[t].curi]=e[t];t(this.__mapAttNameNLS)},onFailure:()=>{t()}};n.getResourcesInfo(e.join(","),o)}))},retrieveNLS:async function(i){return new t((function(t,o){n.getNlsOfPropertiesValues(JSON.stringify(i.nlsData),{tenantId:a.getPlatformId(),lang:s.getLang(),apiVersion:m,onComplete:function(i){var n=e.is(i,"string")?JSON.parse(i):i;t(n)},onFailure:function(e){console.warn("Cannot retrieve NLS"),t({})}})}))},retrieveNLSWithSource:function(i){return new t((function(t,o){n.getNlsOfPropertiesValuesBySource(i.nlsData,{tenantId:a.getPlatformId(),lang:s.getLang(),apiVersion:m,onComplete:function(i){var n=e.is(i,"string")?JSON.parse(i):i;t(n)},onFailure:function(e){console.warn("Cannot retrieve NLS"),t({})}})}))},updateColumnsWithNLS:function(t,i){var n,r=this,a=[],l=require("DS/PADServices/utils/AttributesMgtV2"),d=l.getBaseInstanceTypes().length>0;for(r.completeResponse={},n=0;n<t.length;n++){var c=null;if(c=t[n].ds6w&&"rel"!==t[n].ds6wFrom?t[n].ds6w:t[n].ds6w&&"rel"===t[n].ds6wFrom?t[n].dataIndex:t[n].xnav_options&&t[n].xnav_options.name?t[n].xnav_options.name:t[n].dataIndex,t[n].customisation&&!0===t[n].customisation.titleModified&&(c=null),c){if("actualIndex"===c)continue;if(t[n].text)r.completeResponse[c]={nlsName:t[n].text,lang:s.getLang()};else if(t[n].label)console.info("custom_label==>",c),r.completeResponse[c]={nlsName:t[n].label,lang:s.getLang()};else if(-1!==c.indexOf(":")&&"rel"!==t[n].ds6wFrom)a.push(c);else if("rel"===t[n].ds6wFrom){if(-1!==c.indexOf(":"))if(!0===d){var p=c.substring(0,c.indexOf("-Instance"));-1===a.indexOf(p)&&a.push(p)}else"ds6w:label-Instance"===c&&(r.completeResponse[c]={nlsName:o.attributesCustomization.instanceName,lang:s.getLang()});"positionMatrix-Instance"===c&&(r.completeResponse[c]={nlsName:o.attributesCustomization.instanceMatrix,lang:s.getLang()})}else t[n].xnav_options&&!0===t[n].xnav_options.hardcoded?r.completeResponse[c]={nlsName:o[c],lang:s.getLang()}:o.attributesCustomization[c]?r.completeResponse[c]={nlsName:o.attributesCustomization[c],lang:s.getLang()}:!0!==t[n].isAdditionalColumn&&l.isAttributeColumn(t[n].dataIndex)&&console.warn("DictionaryAccess## Unknown attribute type:"+t[n].dataIndex)}}var u=function(){for(n=0;n<t.length;n++){var e=null,o=null;t[n].ds6w&&"rel"!==t[n].ds6wFrom?e=t[n].ds6w:t[n].ds6w&&"rel"===t[n].ds6wFrom?-1!==(e=t[n].dataIndex).indexOf("-Instance")&&(o=e.substring(0,e.indexOf("-Instance"))):e=t[n].xnav_options&&t[n].xnav_options.name?t[n].xnav_options.name:t[n].dataIndex,t[n].noTitleColumn?t[n].text=void 0:e&&r.completeResponse[e]&&r.completeResponse[e].nlsName&&!0!==t[n].noTitleColumn?t[n].text=r.completeResponse[e].nlsName:o&&r.completeResponse[o]&&r.completeResponse[o].nlsName&&!0!==t[n].noTitleColumn?t[n].text=r.completeResponse[o].nlsName+" ":e&&-1!==e.indexOf("ds6w")&&!0!==t[n].customisation.titleModified&&(console.warn("DictionaryAccess## ds6w attribute ["+e+"] not found by FedDictionaryAccessAPI.getResourcesInfo"),t[n].text=e)}i({status:"success",columns:t})};a.length>0?r.getResourcesInfo(a).then((function(t){if(e.is(t,"array"))for(var i=0;i<t.length;i++){var n=t[i].label;if(t[i].curi)if(n===t[i].curi.replace("ds6wg:","")){console.warn("No real label for attribute "+t[i].curi);var o=n.indexOf(".");o>0&&(n=n.substring(o+1))}r.completeResponse[t[i].curi]={nlsName:n,lang:s.getLang(),kind:t[i].dataType}}})).finally((function(){u()})):u()},updateNLS:function(e){var t=e.getOccurencePath();-1===d.nodes2updateId.indexOf(t)&&(d.nodes2updateId.push(t),d.nodes2update.push(e),f(d.nodes2update))},updateNLSforexport:function(i,o){var r=o||i.getAllDescendants();return new t((function(t,o){var l=function(e){for(var t={},i=require("DS/PADServices/utils/AttributesMgtV2"),n=i.getAvailableColumns(),o=i.getColumnsToNotNls(),s=n.filter((function(e){return-1===o.indexOf(e)})),r=0;r<e.length;r++)for(var a=e[r],l=Object.keys(a.options.grid),d=0;d<l.length;d++){var c=l[d];i.hasNLS(c)&&-1!==s.indexOf(c)&&"ds6w:reserved"!==c&&"positionMatrix-Instance"!==c&&u(t,c,a.options.grid[c])}return t}(r);n.getNlsOfPropertiesValues(JSON.stringify(l),{tenantId:a.getPlatformId(),lang:s.getLang(),apiVersion:"R2019x",onComplete:function(n){var o=function(e){for(var t={},i=Object.keys(e),n=0;n<i.length;n++)for(var o=e[i[n]],s=Object.keys(o),r=0;r<s.length;r++){var a=s[r],l=o[a];l&&a!==l&&0!==l.indexOf("emxFramework")&&(t[i[n]]||(t[i[n]]={}),t[i[n]][a]=l)}return t}(e.is(n,"string")?JSON.parse(n):n),s=Object.keys(o);i.setUseChangeTransactionMode(!0),i.withTransactionUpdate((function(){for(var e=0;e<r.length;e++){var t=r[e],i=h(t,s,o);!0===i.updated&&t.updateOptions(i.options)}})),i.setUseChangeTransactionMode(!1),t()},onFailure:function(e){console.warn("Cannot retrieve NLS"),t()}})}))},getPropertiesForClass:async function(e){const t=e.classURIs.split("\n");var i=[];for(let e=0;e<t.length;e+=100){const n=t.slice(e,e+100);let o=await this.__splittedPropertiesForClass(n.join("\n"));o&&(i=i.concat(o))}return i},getResourcesInfo:async function(e){return new t((function(t,i){var o={tenantId:a.getPlatformId(),lang:s.getLang(),apiVersion:m,onComplete:function(e){t(e)},onFailure:function(i){console.warn("DictionaryAccess## FedDictionaryAccessAPI.getResourcesInfo failed for"+e.join(",")),i&&i.length?t(i):t()}};n.getResourcesInfo(e.join(","),o)}))},updateNLSGroupingNode:function(e){var t=e.getGroupID();-1===d.grpnodes2updateId.indexOf(t)&&(d.grpnodes2updateId.push(t),d.grpnodes2update.push(e),g(d.grpnodes2update))},__splittedPropertiesForClass:async function(i){return new t((function(t,o){n.getPropertiesForClass(i,{tenantId:a.getPlatformId(),lang:s.getLang(),apiVersion:m,onComplete:function(i){var n=e.is(i,"string")?JSON.parse(i):i;t(n)},onFailure:function(e){console.warn("FedDictionaryAccessAPI.getPropertiesForClass failed"),o()}})}))}};return v})),define("DS/PADServices/utils/AttributesMgtV2",["DS/Utilities/UUID","DS/PADServices/utils/DictionaryAccess","DS/PADServices/utils/GlobalUtils"],(function(e,t,i){"use strict";var n=["matrixtxt"];const o=["ds6w:reservedBy","ds6w:i3dx"],s=[{primary:"ds6w:reserved",secondary:"ds6w:reservedBy"}],r={default:!0,baseTypes:[],baseInstanceTypes:[],selectedTypes:[],selectedExtensions:[],typeRepresentations:{},attributesToNotNls:["ds6w:label","ds6w:label-Instance","ds6wg:revision","ds6wg:minorrevision","ds6wg:majorrevision","ds6w:identifier","ds6w:description","ds6w:responsible","ds6wg:EnterpriseExtension.V_PartNumber","ds6wg:PLMReference.V_isLastVersion","ds6w:cadMaster","actualIndex"]};function a(e){var t,i,n={},o={};if(e.attributes)for(t=0;t<e.attributes.length;t++){!(s=e.attributes[t]).ds6w&&s.name&&0===s.name.indexOf("ds6w:")&&(s.ds6w=s.name,delete s.name),s.dataIndex?n[s.dataIndex.toLowerCase()]=s:s.ds6w&&(n[s.ds6w.toLowerCase()]=s),!0===s.tree&&(i=s.ds6w),"rel"===s.ds6wFrom&&(o[s.ds6w.toLowerCase()]=s.dataIndex)}if(e.commandColumns)for(t=0;t<e.commandColumns.length;t++){var s;(s=e.commandColumns[t]).isCommand=!0,s.dataIndex&&(n[s.dataIndex]=s)}return{accessMap:n,accessMapInst:o,treeColumn:i}}function l(){return"object"==typeof l.instance?l.instance:(this._mapAttribute=new Object,this._defaultUUID="Default-"+e.v4(),this._currentUUID="Current"+e.v4(),this.isInitialized=!1,l.instance=this,this)}function d(e){let t=e.ptr,n=e.meprefCustoView,o=e.order,s=e.attLst,l=e.storeMap;return new Promise(((e,d)=>{let c=window.structuredClone(r);c.baseTypes=n.ENO2D_BASED_TYPES,c.baseInstanceTypes=n.ENO2D_BASED_INST_TYPES,c.selectedTypes=n.ENO2D_SELECTED_COLS,c.selectedExtensions=n.ENO2D_SELECTED_EXTS,i.loadAMD("text!DS/PADServices/assets/conf/tablePreferenceConf.json").then((i=>{let n=JSON.parse(i).cmdColumns.map((e=>{let t=Object.assign({alignment:"center",hasNLS:!1,noTitleColumn:!0,kind:"functionIcon",groupableFlag:!1,customisation:{exportable:{lock:!0,value:!1},layout:{pinEditable:!0,removable:!1}}},e);return delete t.icon,o.includes(t.dataIndex)||o.push(t.dataIndex),t}));c.order=o,c.attributes=s,c.commandColumns=n;let r=a(c);c.treeColumn=r.treeColumn,c.attAccessMap=r.accessMap,c.attInstAccessMap=r.accessMapInst,c.default&&(c.defaultOrder=c.order.slice(),c.defaultAttributes=c.attributes.slice(),c.defaultSelectedTypes=c.selectedTypes.slice(),c.defaultSelectedExtensions=c.selectedExtensions.slice(),c.storeMap=l,t._mapAttribute[t._defaultUUID]=c,t._mapAttribute[t._currentUUID]=c),t.isInitialized=!0,t.mePrefAttr=!0,e()}))}))}function c(e){return null!=e}return l.prototype.getKind=function(){return"Static"},l.prototype.initialize=async function(e){return new Promise(((t,i)=>{var n=e.uuid;n||(n=this._defaultUUID),new Promise(((t,o)=>{this._mapAttribute[n]&&this.isInitialized?t():(e.defaultAttributesJSON||i("Default Attributes JSON not in initialization parameters"),require(["text!"+e.defaultAttributesJSON],(i=>{var s=JSON.parse(i),r=a(s);s.treeColumn=r.treeColumn,s.attAccessMap=r.accessMap,s.attInstAccessMap=r.accessMapInst,this._mapAttribute[n]=s,this._mapAttribute[this._currentUUID]=s,e.appAttributesJSON?require(["text!"+e.appAttributesJSON],(e=>{var i=JSON.parse(e);this.updateAttributesList(i,n),this.isInitialized=!0,t()}),o):(!0===s.default&&(s.defaultOrder=s.order.slice(),s.defaultAttributes=s.attributes.slice(),s.defaultSelectedTypes=s.selectedTypes.slice(),s.defaultSelectedExtensions=s.selectedExtensions.slice(),this._mapAttribute[n]=s,this._mapAttribute[this._currentUUID]=s),this.isInitialized=!0,t())}),o))})).then((()=>{t()}))}))},l.prototype.initializeFromMePref=async function(e,t,n){return new Promise((async o=>{let s;if(this.meprefCusto=JSON.parse(JSON.stringify(e)),"ENO2D_DEFAULT"===n)s=this.meprefCusto.default;else{let e=this.meprefCusto.views.map((function(e){return e.ENO2D_VIEW_NAME}));s=this.meprefCusto.views[-1===e.indexOf(n)?0:e.indexOf(n)]}let r=await i.loadAMD("text!DS/PADServices/assets/conf/tablePreferenceConf.json"),l=JSON.parse(r);s.ENO2D_CMDS=l.cmdColumns;let d=s.ENO2D_SELECTED_COLS&&s.ENO2D_SELECTED_COLS.length?s.ENO2D_SELECTED_COLS:s.ENO2D_DEFAULT_COLS,c=[],p={};if(t){for(let e=0;e<t.columns.length;e++)p[t.columns[e].dataIndex]=t.columns[e],c.push(t.columns[e].dataIndex);for(let e=0;e<d.length;e++)void 0===d[e].dataIndex&&(d[e].dataIndex=d[e].ds6w),-1===c.indexOf(d[e].dataIndex)&&c.push(d[e].dataIndex)}else c=d.map((e=>(void 0===e.dataIndex&&(e.dataIndex=e.ds6w),e.dataIndex)));let u={default:!0,baseTypes:s.ENO2D_BASED_TYPES,baseInstanceTypes:s.ENO2D_BASED_INST_TYPES?s.ENO2D_BASED_INST_TYPES:["VPMInstance","VPMRepInstance"],selectedTypes:s.ENO2D_SELECTED_TYPES&&s.ENO2D_SELECTED_TYPES.length?s.ENO2D_SELECTED_TYPES:s.ENO2D_DEFAULT_TYPES,selectedExtensions:s.ENO2D_SELECTED_EXTS&&s.ENO2D_SELECTED_EXTS.length?s.ENO2D_SELECTED_EXTS:s.ENO2D_DEFAULT_EXTS,typeRepresentations:{},attributesToNotNls:["ds6w:label","ds6w:label-Instance","ds6wg:revision","ds6wg:minorrevision","ds6wg:majorrevision","ds6w:identifier","ds6w:description","ds6w:responsible","ds6wg:EnterpriseExtension.V_PartNumber","ds6wg:PLMReference.V_isLastVersion","ds6w:cadMaster","actualIndex"]},h=[],m={};for(let e=0;e<d.length;e++){let t=d[e];if("tree"===t.dataIndex&&(t.tree=!0),"Inst"===t.attType)t.ds6wFrom="rel";else if("Cmd"===t.attType){m[t.dataIndex]=t;continue}!1===t.attVisible&&(t.visibleFlag=!1),t.customisation={},void 0===t.exportableFlag&&(t.exportableFlag=!0),!0===t.exportableFlag&&(t.customisation.exportable={value:t.exportableFlag,lock:t.blockExportedFlag}),!0===t.mandatory&&(t.customisation.layout={removableFromView:!1}),p[t.dataIndex]&&("boolean"==typeof p[t.dataIndex].visibleFlag&&(t.visibleFlag=p[t.dataIndex].visibleFlag),"number"==typeof p[t.dataIndex].width&&(t.width=p[t.dataIndex].width),"string"==typeof p[t.dataIndex].pinned&&(t.pinned=p[t.dataIndex].pinned)),"positionMatrix-Instance"===t.dataIndex&&(t.groupableFlag=!1),h.push(t)}let f=[];for(let e=0;e<s.ENO2D_CMDS.length;e++){let t=s.ENO2D_CMDS[e];t=Object.assign({alignment:"center",hasNLS:!1,noTitleColumn:!0,kind:"functionIcon",groupableFlag:!1,customisation:{exportable:{lock:!0,value:!1},layout:{pinEditable:!0,removable:!1}}},t),delete t.icon,p[t.dataIndex]&&("boolean"==typeof p[t.dataIndex].visibleFlag&&(t.visibleFlag=p[t.dataIndex].visibleFlag),"number"==typeof p[t.dataIndex].width&&(t.width=p[t.dataIndex].width),"string"==typeof p[t.dataIndex].pinned&&(t.pinned=p[t.dataIndex].pinned)),-1===c.indexOf(t.dataIndex)&&c.push(t.dataIndex),f.push(t)}u.order=c,u.attributes=h,u.commandColumns=f;var g=e.uuid;g||(g=this._defaultUUID);var v=u,b=a(v);v.treeColumn=b.treeColumn,v.attAccessMap=b.accessMap,v.attInstAccessMap=b.accessMapInst,this._mapAttribute[g]=v,this._mapAttribute[this._currentUUID]=v,!0===v.default&&(v.defaultOrder=v.order.slice(),v.defaultAttributes=v.attributes.slice(),v.defaultSelectedTypes=v.selectedTypes.slice(),v.defaultSelectedExtensions=v.selectedExtensions.slice(),v.storeMap=p,this._mapAttribute[g]=v,this._mapAttribute[this._currentUUID]=v),this.isInitialized=!0,this.mePrefAttr=!0,o()}))},l.prototype.initializeFromMePrefEditor=function(e){return new Promise(((t,i)=>{let n,o=e.mePrefsData,s=e.custoView,r=e.activeView;if(this.meprefCusto=window.structuredClone(o),"ENO2D_DEFAULT"===r)n=o.default;else n=o.views.find((e=>e.ENO2D_VIEW_NAME===r));let a=!!s&&c(s.tableViewTS),l=c(n.ENO2D_VIEW_TS);if(a&&l&&s.tableViewTS===n.ENO2D_VIEW_TS){let e={},i=s.columns.map((t=>(e[t.dataIndex]=t,t.dataIndex||(t.dataIndex=t.ds6w),t.dataIndex))),o={};d({ptr:this,meprefCustoView:n,order:i,attLst:s.columns.map((e=>{let t=window.structuredClone(e),i=!0;return"tree"===t.dataIndex&&(t.tree=!0),"Inst"===t.attType?t.ds6wFrom="rel":"Cmd"===t.attType&&(o[t.dataIndex]=t,i=!1),i&&(!1===t.attVisible&&(t.visibleFlag=!1),t.customisation={},void 0===t.exportableFlag&&(t.exportableFlag=!0),!0===t.exportableFlag&&(t.customisation.exportable={value:t.exportableFlag,lock:t.blockExportedFlag}),!0===t.mandatory&&(t.customisation.layout={removableFromView:!1}),"positionMatrix-Instance"===t.dataIndex&&(t.groupableFlag=!1)),t})),storeMap:e}).then((()=>{t()}))}else{let e={},i=n.ENO2D_SELECTED_COLS.map((t=>(t.dataIndex||(t.dataIndex=t.ds6w),e[t.dataIndex]=t,t.dataIndex))),o=n.ENO2D_SELECTED_COLS,s=[],r={};for(let e=0;e<o.length;e++){let t=o[e];if("tree"===t.dataIndex&&(t.tree=!0),"Inst"===t.attType)t.ds6wFrom="rel";else if("Cmd"===t.attType){r[t.dataIndex]=t;continue}!1===t.attVisible&&(t.visibleFlag=!1),t.customisation={},void 0===t.exportableFlag&&(t.exportableFlag=!0),!0===t.exportableFlag&&(t.customisation.exportable={value:t.exportableFlag,lock:t.blockExportedFlag}),!0===t.mandatory&&(t.customisation.layout={removableFromView:!1}),"positionMatrix-Instance"===t.dataIndex&&(t.groupableFlag=!1),s.push(t)}d({ptr:this,meprefCustoView:n,order:i,attLst:s,storeMap:e}).then((()=>{t()}))}}))},l.prototype.getCustomViews=function(){return this.meprefCusto.views.map((function(e){return e.ENO2D_VIEW_NAME}))},l.prototype.getDGVLayout=function(e){let t;return!0===this.isInitialized&&!0===this.mePrefAttr&&(t={layoutDensity:"compact"===this.meprefCusto.TABLE_DENSITY?"compact":"comfortable",rowsHeader:"boolean"==typeof this.meprefCusto.TABLE_ROW_HDR&&this.meprefCusto.TABLE_ROW_HDR}),t},l.prototype.deleteMapping=function(e){var t=e?e.uuid:void 0;t||(t=this._defaultUUID),this._mapAttribute[t]&&delete this._mapAttribute[t]},l.prototype.getCurrentUUID=function(e){return e||(Object.keys(this._mapAttribute).length>=1?this._currentUUID:this._defaultUUID)},l.prototype.getMap=function(e){var t,i=this.getCurrentUUID(e);if(!(t=this._mapAttribute[i]))throw new Error("Map is not initialized for UUID "+i);return t},l.prototype.updateAttributesList=function(e,t,i=!0){return new Promise(function(n){let o,s;if(!0===e.default?(o=this.getMap(this._defaultUUID),s=this.getCurrentUUID(this._defaultUUID)):(o=this.getMap(t),s=this.getCurrentUUID(t)),e.attributesToIgnore&&(o.attributesToIgnore=e.attributesToIgnore),delete o.computedOutputs,Array.isArray(e)){let s,r=[];for(s=0;s<e.length;s++)e[s].dataIndex&&"bi_color"!==e[s].dataIndex&&(i||"hide_show"!==e[s].dataIndex||(e[s].visibleFlag=!1),r.push(this.addAvailableColumn(e[s].dataIndex,e[s],t)),-1===o.order.indexOf(e[s].dataIndex)&&o.order.push(e[s].dataIndex));Promise.all(r).then(function(){var t=a(o);o.treeColumn=t.treeColumn,o.attAccessMap=t.accessMap,o.attInstAccessMap=t.accessMapInst,!0===e.default&&(o.defaultOrder=o.order.slice(),o.defaultAttributes=o.attributes.slice(),o.defaultSelectedTypes=o.selectedTypes.slice(),o.defaultSelectedExtensions=o.selectedExtensions.slice(),this._mapAttribute[this._defaultUUID]=JSON.parse(JSON.stringify(o))),this._mapAttribute[this._currentUUID]=JSON.parse(JSON.stringify(o)),n()}.bind(this))}else{o=function(e,t){var i,n=new Object(e),o=[];if(t.order&&(n.order=t.order),t.attributes)for(i=0;i<t.attributes.length;i++){var s=t.attributes[i];if(n.attAccessMap[s.ds6w])o.push(s);else{n.attributes.push(s);var r=s.dataIndex?s.dataIndex:s.ds6w;-1===n.order.indexOf(r)&&n.order.push(r)}}if(t.commandColumns)for(i=0;i<t.commandColumns.length;i++)s=t.commandColumns[i],n.attAccessMap[s.dataIndex]?o.push(s):(n.attributes.push(s),r=s.dataIndex?s.dataIndex:s.ds6w,-1===n.order.indexOf(r)&&n.order.push(r));return Array.isArray(t.baseTypes)&&(n.baseTypes=t.baseTypes),Array.isArray(t.baseInstanceTypes)&&(n.baseInstanceTypes=t.baseInstanceTypes),Array.isArray(t.selectedTypes)&&(n.selectedTypes=t.selectedTypes),Array.isArray(t.selectedExtensions)&&(n.selectedExtensions=t.selectedExtensions),n}(o,e);var r=a(o);o.treeColumn=r.treeColumn,o.attAccessMap=r.accessMap,o.attInstAccessMap=r.accessMapInst,!0===e.default&&(o.defaultOrder=o.order.slice(),o.defaultAttributes=o.attributes.slice(),o.defaultSelectedTypes=o.selectedTypes.slice(),o.defaultSelectedExtensions=o.selectedExtensions.slice(),this._mapAttribute[this._defaultUUID]=JSON.parse(JSON.stringify(o))),this._mapAttribute[this._currentUUID]=JSON.parse(JSON.stringify(o)),n()}}.bind(this))},l.prototype.getColumnsOrder=function(e){return this.getMap(e).order},l.prototype.getColumn=function(e,t){var i=this.getMap(t);if(!0===this.mePrefAttr){let t=i.attAccessMap[e.toLowerCase()];if(void 0===t)if(i.storeMap[e]&&!0===i.storeMap[e].isAdditionalColumn)t=i.storeMap[e];else{let n=0;for(;void 0===t&&n<i.commandColumns.length;)e===i.commandColumns[n].dataIndex&&(t=i.commandColumns[n]),n++}return t}return i.attAccessMap[e.toLowerCase()]},l.prototype.addAvailableColumn=function(e,t,i){return new Promise(function(n){var o=this.getColumn(e);if("bi_color"!==e&&void 0===this.getColumn(e)){var s=this.getMap(i),r=this.getCurrentUUID(i);"selection"===e&&(t.type="selection"),s.attributes.push(t),-1===s.order.indexOf(t.dataIndex)&&s.order.push(t.dataIndex);var l=a(s);s.treeColumn=l.treeColumn,s.attAccessMap=l.accessMap,s.attInstAccessMap=l.accessMapInst,delete s.computedOutputs,this._mapAttribute[r]=s,n(this.getColumn(e))}else{o=JSON.parse(JSON.stringify(o)),n(UWA.extend(o,t,!0))}}.bind(this))},l.prototype.removeAvailableColumn=function(e,t){return new Promise(function(i){if(void 0!==this.getColumn(e,t)){for(var n=this.getMap(t),o=this.getCurrentUUID(t),s=0,r=0;0===s&&r<n.attributes.length;r++)n.attributes[r].dataIndex===e&&(s=r);if(s){n.attributes.splice(s,1);var l=a(n);n.treeColumn=l.treeColumn,n.attAccessMap=l.accessMap,n.attInstAccessMap=l.accessMapInst,delete n.computedOutputs,this._mapAttribute[o]=n}i()}else i()}.bind(this))},l.prototype.updateAttributesWithKind=function(e,i){if(i)return new Promise((function(e){var o=i.filter((function(e){return void 0===e.kind&&e.ds6w&&-1===n.indexOf(e.ds6w)})).map((function(e){return e.ds6w})),s=o.filter((function(e,t){return o.indexOf(e)===t}));s.length?t.getResourcesInfo(s).then((function(t){for(var n=t.map((function(e){return e.curi})),o=0;o<i.length;o++)i[o].ds6w&&-1!==n.indexOf(i[o].ds6w)&&(i[o].kind=t[n.indexOf(i[o].ds6w)].dataType);e(i)})):e(i)}));var o=this.getMap(e),s=this.getCurrentUUID(e);return!0===o.columnsChecked?Promise.resolve():new Promise(function(e){var i=o.attributes.filter((function(e){return void 0===e.kind&&e.ds6w&&-1===n.indexOf(e.ds6w)})).map((function(e){return e.ds6w})),r=i.filter((function(e,t){return i.indexOf(e)===t}));r.length?t.getResourcesInfo(r).then(function(t){if(t)for(var i=0;i<t.length;i++){var n=t[i].curi;n===o.treeColumn&&(n="tree"),o.attAccessMap[n]&&(o.attAccessMap[n].kind=t[i].dataType)}o.columnsChecked=!0,this._mapAttribute[s]=o,e()}.bind(this)):(o.columnsChecked=!0,this._mapAttribute[s]=o,e())}.bind(this))},l.prototype.getTreeColumn=function(e){var t=this.getMap(e);return t.treeColumn?t.treeColumn:"ds6w:label"},l.prototype.getAttributesToIgnore=function(e){return this.getMap(e).attributesToIgnore},l.prototype.getAvailableColumns=l.prototype.getColumnsOrder,l.prototype.getAvailableColumnsOpts=function(e){for(var t=[],i=this.getColumnsOrder(e),n=0;n<i.length;n++){var o=this.getColumn(i[n],e);o&&t.push(o)}return t},l.prototype.getBaseTypes=function(e){return this.getMap(e).baseTypes},l.prototype.getBaseInstanceTypes=function(e){var t=this.getMap(e);return t.baseInstanceTypes?t.baseInstanceTypes:[]},l.prototype.getSelectedTypes=function(e){return this.getMap(e).selectedTypes},l.prototype.getSelectedExtensions=function(e){return this.getMap(e).selectedExtensions},l.prototype.updateSelectedParams=function(e,t){var i=this.getMap(t),n=this.getCurrentUUID(t);e.selectedTypes&&(i.selectedTypes=e.selectedTypes),e.selectedExtensions&&(i.selectedExtensions=e.selectedExtensions);var o=a(i);i.treeColumn=o.treeColumn,i.attAccessMap=o.accessMap,i.attInstAccessMap=o.accessMapInst,this._mapAttribute[n]=i},l.prototype.getDefaultTypesAndExtensions=function(e){var t=this.getMap(e);return{defaultTypes:t.defaultSelectedTypes,defaultExtensions:t.defaultSelectedExtensions}},l.prototype.resetSelectedParams=function(e){var t=this.getMap(this._defaultUUID),i=this.getCurrentUUID(e);t.order=t.defaultOrder,t.attributes=t.defaultAttributes,t.selectedTypes=t.defaultSelectedTypes,t.selectedExtensions=t.defaultSelectedExtensions;var n=a(t);t.treeColumn=n.treeColumn,t.attAccessMap=n.accessMap,t.attInstAccessMap=n.accessMapInst,this._mapAttribute[i]=t},l.prototype.addBIColumn=function(e,t,i){var n=this.getMap(i),o=this.getCurrentUUID(i);void 0===n.attAccessMap[e]&&(delete n.computedOutputs,void 0===n.biPredicates&&(n.biPredicates=[]),-1===n.biPredicates.indexOf(e)&&n.biPredicates.push(e),!0===t&&(void 0===n.biPredicatesInst&&(n.biPredicatesInst=[]),-1===n.biPredicatesInst.indexOf(e)&&n.biPredicatesInst.push(e)),-1===n.order.indexOf(e)&&n.order.push(e),this._mapAttribute[o]=n),!0===t&&void 0===n.attInstAccessMap[e+"-Instance"]&&(delete n.computedOutputs,void 0===n.biPredicatesInst&&(n.biPredicatesInst=[]),-1===n.biPredicatesInst.indexOf(e)&&n.biPredicatesInst.push(e),-1===n.order.indexOf(e+"-Instance")&&n.order.push(e+"-Instance"),this._mapAttribute[o]=n)},l.prototype.removeBIColumn=function(e,t){var i=this.getMap(t),n=this.getCurrentUUID(t);void 0===i.attAccessMap[e]&&(delete i.computedOutputs,void 0!==i.biPredicates&&-1!==i.biPredicates.indexOf(e)&&(i.biPredicates.splice(i.biPredicates.indexOf(e),1),0===i.biPredicates.length&&delete i.biPredicates),-1!==i.order.indexOf(e)&&i.order.splice(i.order.indexOf(e),1),void 0!==i.biPredicatesInst&&-1!==i.biPredicatesInst.indexOf(e)&&(i.biPredicatesInst.splice(i.biPredicatesInst.indexOf(e),1),0===i.biPredicatesInst.length&&delete i.biPredicatesInst),-1!==i.order.indexOf(e+"-Instance")&&i.order.splice(i.order.indexOf(e+"-Instance"),1),this._mapAttribute[n]=i)},l.prototype.createOutputsRequest=function(e,t){var i=this.getMap(t),n="expand3d"===e?["physicalid","ds6w:globalType","ds6w:type"]:["physicalid","ds6w:globalType","ds6w:type","ds6w:identifier"],r="expand3d"===e?["physicalid","ds6w:globalType","ds6w:type"]:["physicalid","ds6w:globalType","ds6w:type","ds6w:identifier"],a=i.predefinedComputation?i.predefinedComputation:["thumbnail_2d","icon"];require("DS/PADServices/settings/AppSettings");"expand3d"!==e&&n.push("ds6w:composed");var l=i.computedOutputs&&i.computedOutputs[e];if(!l){for(var d=Object.keys(i.attAccessMap),c=d.length,p=0;p<c;p++)if(!0!==i.attAccessMap[d[p]].isCommand&&"thumbnail"!==d[p]&&"actualindex"!==d[p]&&i.attAccessMap[d[p]].ds6w)if("rel"===i.attAccessMap[d[p]].ds6wFrom){var u=i.attAccessMap[d[p]].ds6w;u.length>9&&"-Instance"===u.substring(u.length-9,u.length)&&(u=u.substring(0,u.length-9)),-1===r.indexOf(u)&&r.push(u)}else-1===n.indexOf(i.attAccessMap[d[p]].ds6w)&&n.push(i.attAccessMap[d[p]].ds6w);if(i.biPredicates)for(p=0;p<i.biPredicates.length;p++)-1===n.indexOf(i.biPredicates[p])&&n.push(i.biPredicates[p]);if(i.biPredicatesInst)for(p=0;p<i.biPredicatesInst.length;p++)-1===r.indexOf(i.biPredicatesInst[p])&&r.push(i.biPredicatesInst[p]);o.length&&(n=n.concat(o)),s.length&&s.forEach((function(e,t){r.indexOf(e.primary)>=0&&r.push(e.secondary)})),n=n.filter((function(e,t,i){return i.indexOf(e)===t})),r=r.filter((function(e,t,i){return i.indexOf(e)===t})),l="expandV2"===e?{select_object:n,select_relation:r,hits:{predefined_computation:["urlstream|thumbnail|2dthb|allrefs","icons"]}}:"fetch"===e?{select_predicate:n,select_file:a}:{select_object:n,select_relation:r,select_file:a},i.computedOutputs||(i.computedOutputs={}),i.computedOutputs[e]=l,this._mapAttribute[this.getCurrentUUID(t)]=i}return JSON.parse(JSON.stringify(l))},l.prototype.hasNLS=function(e,t){var i=this.getMap(t),n=!0,o=e.toLowerCase();return i.additionalColumns&&-1!==i.additionalColumns.indexOf(e)?n=!1:i.attAccessMap[o]&&UWA.is(i.attAccessMap[o].hasNLS,"boolean")&&(n=i.attAccessMap[o].hasNLS),n},l.prototype.isAttributeColumn=function(e,t){var i=this.getMap(t),n=!1,o=i.attAccessMap[e.toLowerCase()];return o&&(!0!==o.isCommand&&!0!==o.isAdditionalColumn||e===i.treeColumn)&&(n=!0),n},l.prototype.addAsyncAttributes=function(e,t){for(var i=this.getMap(t),n=this.getCurrentUUID(t),o=0;o<e.length;o++)i.additionalColumns||(i.additionalColumns=[]),-1===i.additionalColumns.indexOf(e[o])?i.additionalColumns.push(e[o]):console.warn("Additional Column Attribute["+e[o]+"] already defined");this._mapAttribute[n]=i},l.prototype.getAdditionalColumns=function(e){return this.getMap(e).additionalColumns},l.prototype.getColumnsToNotNls=function(e){var t=this.getMap(e),i=t.attributesToNotNls;return i||(i=[]),i=i.concat(t.additionalColumns)},l.prototype.deprecatedLoadAttr=function(e,t){console.warn("Deprecated use of DS/PADServices/utils/AttributesMgt please use DS/PADServices/utils/AttributesMgtV2");var i=t;if(i||(i=this._defaultUUID),this._mapAttribute[i])throw new Error("AttributesMgt Map with UUID["+i+"] already created");if(void 0===e)throw new Error("Default Attributes JSON not in initialization parameters");var n=a(e);e.treeColumn=n.treeColumn,e.attAccessMap=n.accessMap,e.attInstAccessMap=n.accessMapInst,this._mapAttribute[i]=e;var o=e.attributesToNotNls?e.attributesToNotNls.slice():[];this._mapAttribute[this._currentUUID]={baseTypes:e.baseTypes.slice(),selectedTypes:e.selectedTypes.slice(),selectedExtensions:e.selectedExtensions.slice(),order:e.order.slice(),attributes:e.attributes.slice(),commandColumns:e.commandColumns.slice(),treeColumn:e.treeColumn,attAccessMap:e.attAccessMap,attInstAccessMap:e.attInstAccessMap,attributesToNotNls:o,typeRepresentations:e.typeRepresentations},this.isInitialized=!0},new l})),define("DS/PADServices/utils/AttributesMgt",["text!DS/PADServices/assets/init/AttributesMgt.json","DS/PADServices/utils/AttributesMgtV2"],(function(e,t){"use strict";var i=JSON.parse(e);return t.deprecatedLoadAttr(i),t})),define("DS/PADServices/utils/PCSTracker",["DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PADTrackerManager"],(function(e,t){"use strict";function i(){return"object"==typeof i.instance?i.instance:(i.instance=this,this)}function n(t){this.id=e.getPCSPrefix()+"_"+t,this.inprogress=!0,this.stamp=window.top.performance.now(),this.beginMark=this.id+"__begin_"+this.stamp,this.endMark=this.id+"__end_"+this.stamp,window.top.performance.mark(this.beginMark)}return i.prototype.createProbe=function(e){return new n(e)},i.prototype.networkprobe=function(e){var i,n,o=e.request_options,s=e.wsName?e.wsName:function(e){var t=e.split("/");if(t.length>5){var i=t[t.length-1],n=t[t.length-1].indexOf("?");return-1!==n&&(i=i.substring(0,n),t[t.length-1]=i),t.slice(4,t.length).join("/")}return 0===t[t.length-1].length?t[t.length-2]:t[t.length-1]}(e.url),r=this.createProbe("query_"+s);return r.eventName=s,r.txKey=e.txKey,o.onComplete=(i=o.onComplete,function(e){if(r.end(),r.eventName){var n=t.getPADTracker({eventCategory:"usage",eventAction:"query"}),o=r.duration;n.setEventData({eventLabel:r.eventName,eventValue:o,txKey:r.txKey}),n.trackPageEvent()}if(UWA.is(i,"function"))return i.apply(this,Array.prototype.slice.call(arguments))}),o.onFailure=(n=o.onFailure,function(e){if(r.end(),r.eventName){var i=t.getPADTracker({eventCategory:"usage",eventAction:"queryFailed"}),o=r.duration;i.setEventData({eventLabel:r.eventName,eventValue:o,txKey:r.txKey}),i.trackPageEvent()}if(UWA.is(n,"function"))return n.apply(this,Array.prototype.slice.call(arguments))}),o},n.prototype.end=function(){if(!0===this.inprogress){this.inprogress=!1,window.top.performance.mark(this.endMark);try{window.top.performance.measure(this.id,this.beginMark,this.endMark),this.duration=window.top.performance.getEntriesByName(this.id)[0].duration}catch(e){console.error(e),console.log("%c Measure failure...begin or end does not exist","font-size: 1.1rem; text-shadow: 4px 4px 5px red")}}},n.prototype.dump=function(){console.log(window.top.performance.getEntriesByName(this.id))},new i})),define("DS/PADServices/ws/WSAccess",["i18n!DS/PADServices/assets/nls/PADServices","DS/WAFData/WAFData","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PCSTracker"],(function(e,t,i,n){"use strict";const o=new Error("TIMEOUT");function s(){return"object"==typeof s.instance?s.instance:(s.instance=this,this)}return s.prototype.initialize=async function(e){return new Promise(function(t,i){var n=[],o=[];if(!0===e.addDefaults&&(o=o.concat(["DS/PADServices/ws/WSAdmin","DS/PADServices/ws/WSIndexCommon","DS/PADServices/ws/WSENOAuth","DS/PADServices/ws/WSFilter","DS/PADServices/ws/WSRelations","DS/PADServices/ws/R2VServices"])),Array.isArray(e.WSDefinitionAMDs)&&(o=o.concat(e.WSDefinitionAMDs)),Array.isArray(o))for(var r=0;r<o.length;r++){var a=r;n.push(new Promise(function(e,t){require([o[a]],(function(t){s.prototype=Object.assign(s.prototype,t.prototype),e()}),t)}.bind(this)))}Promise.all(n).then(t).catch(i)}.bind(this))},s.prototype.appendCfgIf=function(e){var t;try{t=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext").get()}catch(e){console.warn("CfgAuthoringContext throw an error")}t&&""!==t.change.id&&(e.headers["DS-Change-Authoring-Context"]="pid:"+t.change.id),t&&null!==t.AuthoringContextHeader&&UWA.extend(e.headers,t.AuthoringContextHeader)},s.prototype.executeRequest=function(s,r,a,l){var d=i.getSecurityContext();if(UWA.is(d,"string")&&!0!==a&&(r.headers.SecurityContext=d,!0!==l)){var c=i.getUser();c&&c.login&&(r.headers.SecurityToken=c.login+"|"+d+"|preferred")}if(void 0===r.onTimeout){var p=r.onFailure?r.onFailure:r.onComplete;r.onTimeout=function(){i.displayNotif({level:"error",message:e.errors.requesttimeout,sticky:!0,key:"WSAccess-requesttimeout"}),p(o)}}var u=n.networkprobe({url:s,request_options:r,wsName:r.wsName,txKey:r.txKey});return t.authenticatedRequest(s,u)},s.prototype.executeRequestPromise=function(e,t,i,n){var o=this;return new Promise((function(s,r){t.onComplete=function(e){var t=function(e){return"string"==typeof e&&"{"===e.charAt(0)?JSON.parse(e):e}(e);s(t)},t.onFailure=function(e){r(e)},t.onTimeout=function(e){r({timeoutOccurs:!0,e:e})},"POST"===t.method&&"string"!=typeof t.data&&(t.data=JSON.stringify(t.data)),o.executeRequest(e,t,i,n)}))},new s})),define("DS/PADServices/utils/Dimensions",["DS/PADServices/utils/PlatformURL","DS/PADServices/ws/WSAccess"],(function(e,t){"use strict";function i(){return"object"==typeof i.instance?i.instance:(i.instance=this,this.dimensionsMap=new Map,this.unitsMap=new Map,this)}return i.prototype.retrieveDimensions=async function(){try{t.retrieveDimensions||await e.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0});let i=await t.retrieveDimensions();for(let e=0;e<i.results.length;e++){let t=i.results[e],n={MKSUnit:t.MKSUnit,NLS:t.NLS,Units:[]};for(let e=0;e<t.Units.length;e++){let i=t.Units[e];if(this.unitsMap.get(i.Name)){let e=this.unitsMap.get(i.Name);e.NLSName===i.NLSName&&e.label===i.label||console.log("Dimensions:: different units ["+e.NLSName+" !== "+i.NLSName+"] OR ["+e.label+" !== "+i.label+"] ")}else n.Units.push(i.Name),this.unitsMap.set(i.Name,i)}this.dimensionsMap.set(t.name,n)}}catch(e){console.warn("Dimensions:: Cannot retrieve dimensions")}},i.prototype.getNLSForUnit=function(e){let t=this.unitsMap.get(e);return t?t.NLSName:e},new i})),define("DS/PADServices/utils/ConfigurationCache",["DS/PADServices/ws/WSAccess"],(function(e){"use strict";function t(){this._enableMap=new Map}let i;return t.prototype={setup:function(e){this.options=e},initialize:function(){let t=this,i=this.options.settingsArray;return new Promise(((n,o)=>{e.getProductConfiguration({settingsArray:i}).then((e=>{let i=e.settings.map((e=>({id:e.settingName,enabled:"enabled"===e.value})));for(let e=0;e<i.length;e++){let n=i[e];t._enableMap.set(n.id,n.enabled)}n()})).catch(o)}))},isEnabled:function(e){return this._enableMap.get(e)}},i||(i=new t)})),define("DS/PADServices/utils/PermissionRulesCache",["DS/PADServices/ws/WSAccess"],(function(e){"use strict";function t(){this._permissionRulesData=[]}let i;return t.prototype={setup:function(e){this.options=e},initialize:function(){return new Promise(((t,i)=>{e.getPermissionRules().then((e=>{let t,i,n=[];for(var o=0;o<e.family.length;o++)if("LifecycleRules"===e.family[o].id&&(t=e.family[o].parameter.filter((e=>{if("AutoPromoteFirstMinorRev"===e.id&&"true"===e.isDeployed)return!0}))),"ModifyAccess"===e.family[o].id&&(i=e.family[o].parameter.filter((e=>"AutoReserveOnDefinition"===e.id))),t&&i){n=[t,i];break}return n})).then((e=>{let i=e[0][0].argument[0].argValue,n=!1,o=e[1][0].argument[0].argValue;"None"!==o&&o||(n=!0),this._permissionRulesData=[i,n],t(e)})).catch((e=>{i(console.error("Error",e))}))}))},isEnabled:function(){return this._permissionRulesData}},i||(i=new t)})),define("DS/PADServices/utils/PredefinedQueryUtils",["UWA/Promise","DS/PADServices/ws/WSAccess"],(function(e,t){"use strict";var i=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(UWA.is(e[n],"object")&&UWA.is(t[n],"object")?i(e[n],t[n]):UWA.is(e[n],"array")&&(e[n]=e[n].concat(t[n])))},n={pqDictionary:null,abvLst:{},retrievePQDictionary:function(){return new e((function(e,o){null===n.pqDictionary?t.retrievePQ().then((function(t){if((t="string"==typeof t?JSON.parse(t):t).pqlist&&t.pqlist.PQ){if(t.custom){console.log("Custome PQ exists");for(var o=0,s=t.custom.PQ.length;o<s;o++){t.custom.PQ[o].custom=!0}i(t.pqlist,t.custom)}n.pqDictionary=t.pqlist.PQ;for(var r=0;r<t.pqlist.PQ.length;r++)for(var a=t.pqlist.PQ[r].abbreviations.split(","),l=0;l<a.length;l++)n.abvLst[a[l]]=r}else n.pqDictionary=[];e()})).catch((function(e){console.error(e),o()})):e()}))}};return{isPredefinedQry:function(t,i){return new e((function(e){var o=t,s=t.indexOf(":"),r=!1;i&&2===i.version&&(r=!0),-1!==s?n.retrievePQDictionary().then((function(){var i=!1,a=t.substring(0,s),l=t.substring(s+1,t.length);if(void 0!==n.abvLst[a]){var d=UWA.clone(n.pqDictionary[n.abvLst[a]]);!0===d.custom&&(d.value="3dexp"+a+":__QUERY__"),o=d.value.replace(/__QUERY__/g,l),i=!0}e(r?{realQry:o,isPredefinedQry:i}:o)})).catch((function(){console.warn("Predefined Qry retrival fails. Keep the original query String"),e(r?{realQry:o,isPredefinedQry:!1}:o)})):e(r?{realQry:o,isPredefinedQry:!1}:o)}))}}})),define("DS/PADServices/utils/SGIUtils",["DS/PADServices/utils/PlatformURL","DS/PADServices/ws/WSAccess","DS/PADServices/settings/AppSettings","DS/PADServices/utils/PADTrackerManager","DS/PADServices/utils/GlobalModelEvents"],(function(e,t,i,n,o){"use strict";function s(){return"object"==typeof s.instance?s.instance:(s.instance=this,this.supplementalMap=new Map,this.supplementalModeActivated=!1,this.homepageContent=0,this)}return s.prototype.isFeatureNavigationAvailable=function(){let e=!1;return this.isSGIEnv()&&!0===this.sgiActivated&&!1===this.supplemental&&(e=!0),e},s.prototype.isSupplementalAvailable=function(){let e=!1;return this.isSGIEnv()&&!0===this.sgiActivated&&!0===this.supplemental&&(e=!0,i.setSetting("activateSGI",!0)),e},s.prototype.isSGIAvailable=async function(){let o=!1;if(e.isCloud()){if(void 0===this.status){t.isSGIAvailable||await e.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0});try{let e=await t.isSGIAvailable();e&&e.status&&(this.status=e.status,this.supplemental="true"===e.supplemental.toLowerCase(),function(e){const t=n.getPADTracker({eventCategory:"usage",eventAction:"sgi_isalive"});t&&(t.setEventData({eventLabel:e.status}),t.trackPageEvent())}(e))}catch(e){console.warn("SGI availability cannot be checked")}}"alive"!==this.status&&!0!==i.getSetting("forceSGIActivation")||(o=!0,this.sgiActivated=o,i.setSetting("activateSGI",!0))}return o},s.prototype.getAdditionalParameters=function(e,t){let i="";return this.isFeatureNavigationAvailable()?(i="&redirectQueryToSGI=true&expandIndexUnit=3DSpaceTransformedForIFC",t&&this.addPredicates(t)):this.isSupplementalAvailable()&&this.isSupplemental(e)&&(i="&isSupplemental=true",t&&this.replaceOrRemoveAtt(t,"ds6w:i3dx","ds6w:cpid")),i},s.prototype.modifyFilterOnSGIActivation=function(e){let t=this.isSGIEnv();if(e&&(this.filterCtrl=e),!this.filterCtrl)return void console.error("No BIFilter Ctrl defined");const i=this._filterAlreadyTreatedRoot;let n=this.filterCtrl._biFilter;if(n||(n=this.filterCtrl._BIProxy),i&&i.length&&(this.removeNGFilter(this._filterAlreadyTreatedRoot),n.removeRoots(this._filterAlreadyTreatedRoot),this._filterAlreadyTreatedRoot=[]),"function"==typeof n._addURLParam){let e="",i=!1;!0===t&&(!0===this.supplementalModeActivated?(e="isSupplemental=true",i=!1):!0!==this.supplemental&&(e="redirectQueryToSGI=true&expandIndexUnit=3DSpaceTransformedForIFC",i=!0)),n._addURLParam({services:"progressive",param:e}),n._forceShatteredProperties({services:"progressive",force:i})}i&&i.length&&this.onSetTagsWithExpandSynthesis()},s.prototype.isSGIEnv=function(){return!0===i.getSetting("activateSGI")},s.prototype.isSpecialPID=function(e){return e.length>32},s.prototype.clearSpecialPIDS=function(e){let t=e.slice();for(let i=0;i<e.length;i++)this.isSpecialPID(e[i])&&t.splice(t.indexOf(e[i]),1);return t},s.prototype.addPredicates=function(e){const t=["isPivotObject","isInternalJSONObj"];e.select_predicate?(e.select_predicate=e.select_predicate.concat(t),e.shatteredFetch=!0):e.select_object?e.select_object=e.select_object.concat(t):e.select_bo=e.select_bo.concat(t)},s.prototype.replaceOrRemoveAtt=function(e,t,i){function n(e,t,i){var n=e.indexOf(t);~n&&(void 0===i?e.splice(n,1):e[n]=i)}e.select_predicate?n(e.select_predicate,t,i):e.select_object?n(e.select_object,t,i):e.select_bo&&n(e.select_bo,t,i)},s.prototype.setAppModel=function(e){this.appModel=e},s.prototype.multiSourceItems=function(e){let t=!0,i=!1,n=!1;for(let o=0;o<e.length&&!0===t;o++){let s=e[o];s.cpid&&s.cpid.contains("cpid:3DEXPERIENCEOP:")?i=!0:n=!0,i&&n&&(t=!1)}return!t},s.prototype.hasSupplementalItems=function(e){let t=!1;for(let i=0;i<e.length&&!1===t;i++){let n=e[i];n.cpid&&n.cpid.contains("cpid:3DEXPERIENCEOP:")&&(t=!0)}return t},s.prototype.addToi3DXMap=function(e){if(!0===i.getSetting("activateSup")&&!0===this.isSGIEnv()&&e.cpid&&e.cpid.contains("cpid:3DEXPERIENCEOP:")&&(console.log("SGIUtils::Found supplemental item: "+e.objectId),this.supplementalMap.set(e.objectId,e),!1===this.supplementalModeActivated)){this.supplementalModeActivated=!0,this.modifyFilterOnSGIActivation(),o.publish({event:"DS/ENXApp/supplementalActivated",data:!0});const e=n.getPADTracker({eventCategory:"usage",eventAction:"supplemental_activated"});e&&e.trackPageEvent()}},s.prototype.isSupplemental=function(e){let t=!1;for(let i=0;i<e.length;i++)if(void 0!==this.supplementalMap.get(e[i])){t=!0;break}return this.appModel&&(t=this.appModel.isSupplemental(e)),!0===this.supplementalModeActivated&&!1===t&&(console.debug("SGIUtils::isSupplemental ID not found in supplementalMap"),t=!0),t},s.prototype.getSupplementalMap=function(){let e;return this.supplementalMap.size>0&&(e=Object.fromEntries(this.supplementalMap)),e},s.prototype.setSupplementalNodes=function(e){if(!0===i.getSetting("activateSup")&&!0===this.isSGIEnv()){let t=e.supplementalNodes;if(t){if(Object.keys(t).forEach((i=>{void 0===e.products[i]&&void 0===e.filters[i]||this.supplementalMap.set(i,t[i])})),this.supplementalMap.size>0&&!1===this.supplementalModeActivated){this.supplementalModeActivated=!0,this.modifyFilterOnSGIActivation(),o.publish({event:"DS/ENXApp/supplementalActivated",data:!0});const e=n.getPADTracker({eventCategory:"usage",eventAction:"supplemental_activated"});e&&e.trackPageEvent()}}}},s.prototype.removeIdsFromMap=function(e){for(let t=0;t<e.length;t++)this.supplementalMap.delete(e[t]);0===this.supplementalMap.size&&(this.supplementalModeActivated=!1,this.modifyFilterOnSGIActivation(),o.publish({event:"DS/ENXApp/supplementalActivated",data:!1}))},s.prototype.displayNotSupportedMultiSource=function(){require(["DS/PADServices/views/ENXMultiSourcePanel"],(e=>{new e}))},s.prototype.getServiceIdFromCpid=function(e){let t,i=e.indexOf("cpid:3DEXPERIENCEOP:"),n=e.split(":");return 0===i&&5===n.length&&(t=n[2]),t},s.prototype.setHomepageContent=function(e){this.homepageContent=e},s.prototype.isOpenAuthorized=function(e){let t=!0;return this.isSGIEnv()&&e&&e.length&&(e.length>1&&!0===this.multiSourceItems(e)||0!==this.homepageContent&&this.supplementalModeActivated!==this.hasSupplementalItems(e))&&(t=!1),t},new s})),define("DS/PADServices/views/private/AppStructure",["DS/PADServices/utils/SGIUtils"],(function(e){var t;function i(e){return"null"===e?null:e}function n(){}return n.prototype={setWidget:function(e){this.widget=e},retrieveData:function(t){var i,n=this.widget.getValue(t);return"null"===n&&(n=null),n?((i=JSON.parse(n)).wasOpenFilters||(i.wasOpenFilters={}),i.wasOpenProducts||(i.wasOpenProducts={}),i.wasOpenPointCloud||(i.wasOpenPointCloud={}),self.widget.isDeEnabled?(i.wasOpenDesignEnv||(i.wasOpenDesignEnv={}),i.designEnv||(i.designEnv={})):(delete i.designEnv,delete i.wasOpenDesignEnv),i.ver||(i.ver={major:2,minor:0}),i.pointClouds||(i.pointClouds={}),i.supplementalNodes&&e.setSupplementalNodes(i)):(i={ver:{major:2,minor:0},products:{},filters:{},pointClouds:{},wasOpenProducts:{},wasOpenFilters:{},wasOpenPointCloud:{}},self.widget.isDeEnabled&&(i={...i,designEnv:{},wasOpenDesignEnv:{}})),i},cleanupWasOpens:function(e){let t=!1,i=this.retrieveData(e),n=Object.keys(i.products),o=Object.keys(i.wasOpenProducts);if(o.length){let e=o.filter((e=>!n.includes(e)));for(let n=0;n<e.length;n++){let o=e[n];delete i.wasOpenProducts[o],t=!0}}let s=Object.keys(i.filters),r=Object.keys(i.wasOpenFilters);if(r.length){let e=r.filter((e=>!s.includes(e)));for(let n=0;n<e.length;n++){let o=e[n];delete i.wasOpenFilters[o],t=!0}}t&&this.persistData(e,i)},getWidgetBool:function(e){return t=this.widget.getValue(e),i=!1,"boolean"==typeof t?i=t:"string"==typeof t&&(i="true"===t.toLowerCase()),i;var t,i},migratePrevData:function(e){let t=i(this.widget.getValue("PAD3DViewerPathsInSession")),n=i(this.widget.getValue("Cockpit_RootIds"));if(t){let i=JSON.parse(t);this._migrateArrayOfPaths(e,i),this.widget.deleteValue("PAD3DViewerPathsInSession"),this.widget.setValue("3dmigrated",!0)}else if(n){let t=JSON.parse(n);this._migrateArrayOfPaths(e,t),this.widget.deleteValue("Cockpit_RootIds")}},_migrateArrayOfPaths:function(e,t){let i=this.retrieveData(e);for(let e=0;e<t.length;e++)this.addProductPath(i,t[e],!0);this.addOpenProduct(i,t),this.persistData(e,i)},persistData:function(t,i){let n=e.getSupplementalMap();n?i.supplementalNodes=n:delete i.supplementalNodes,this.widget.setValue(t,JSON.stringify(i))},addOpenDesignEnv:function(e,t){for(var i=!1,n=0;n<t.length;n++){var o=t[n];e.wasOpenDesignEnv[o]||(e.wasOpenDesignEnv[o]={},i=!0)}return i},addOpenProduct:function(e,t){for(var i=!1,n=0;n<t.length;n++)for(var o,s=t[n],r=0;r<s.length;r++){var a=s[r];0===r?(o=e.wasOpenProducts[a])||(o=e.wasOpenProducts[a]={},i=!0):o[a]?o=o[a]:(o=o[a]={},i=!0)}return i},addOpenFilter:function(e,t){for(var i=!1,n=0;n<t.length;n++){var o=t[n];e.wasOpenFilters[o]||(e.wasOpenFilters[o]={},i=!0)}return i},addOpenPointCloud:function(e,t){var i=!1;return e.wasOpenPointCloud[t]||(e.wasOpenPointCloud[t]=e.pointClouds[t],i=!0),i},removeOpen:function(e,t){for(var i=[],n=0;n<t.length;n++){var o=t[n];e.wasOpenProducts[o]&&(i.push(o),delete e.wasOpenProducts[o]),self.widget.isDeEnabled&&e.wasOpenDesignEnv[o]&&(i.push(o),delete e.wasOpenDesignEnv[o]),e.wasOpenFilters[o]&&(i.push(o),delete e.wasOpenFilters[o]),e.wasOpenPointCloud[o]&&(i.push(o),delete e.wasOpenPointCloud[o]);let l=0,d=Object.keys(e.pointClouds);for(l=0;l<d.length;l++){e.pointClouds[d[l]].fsId===o&&(i.push(d[l]),delete e.wasOpenPointCloud[d[l]])}var s=Object.keys(e.filters);for(l=0;l<s.length;l++){var r=s[l],a=e.filters[r];a.associatedProduct===o&&(i.push(a.associatedProduct),delete e.wasOpenFilters[r])}}return i},addDesignEnv:function(e,t){return!(!t.length||e.designEnv[t])&&(e.designEnv[t]={},!0)},addProduct:function(e,t){return!e.products[t]&&(e.products[t]={},!0)},addProductPath:function(e,t,i){if(Array.isArray(t))if(i){var n=e.products,o=0,s=t.length;for(o=0;o<s;o++)n.hasOwnProperty(t[o])||(n[t[o]]={}),n=n[t[o]]}else{var r,a=t.length;for(r=0;r<a;r++){n=e.products,o=0,s=t[r].length;for(o=0;o<s;o++)n.hasOwnProperty(t[r][o])||(n[t[r][o]]={}),n=n[t[r][o]]}}},addFilter:function(e,t,i){return!e.filters[t]&&(e.filters[t]={associatedProduct:i},!0)},addPointCloud:function(e,t,i){return e.pointClouds[i]?e.pointClouds[i].fsId!==t&&(e.pointClouds[i].fsId=t,!0):(e.pointClouds[i]={fsId:t},!0)},buildReloadList:function(e){var t={products:{},filters:{},pointClouds:[],hasLoad:!1};if(self.widget.isDeEnabled&&(t.designEnv={}),e.wasOpenFilters&&e.wasOpenProducts&&e.wasOpenPointCloud){for(var i=Object.keys(e.wasOpenProducts),n=Object.keys(e.wasOpenFilters),o=Object.keys(e.wasOpenPointCloud),s=0;s<i.length;s++){var r=i[s],a=e.wasOpenProducts[r];a&&(t.products[r]=a,t.hasLoad=!0)}for(s=0;s<n.length;s++){var l=n[s];if(e.wasOpenFilters[l]){var d=e.filters[l];d&&(t.filters[l]={associatedProduct:d.associatedProduct},t.hasLoad=!0)}}for(s=0;s<o.length;s++){var c=o[s],p=e.wasOpenPointCloud[c];p&&(t.pointClouds.push({objectId:p.fsId,serviceId:e.pCloudServiceId}),t.hasLoad=!0)}}return self.widget.isDeEnabled&&e.wasOpenDesignEnv&&Object.keys(e.wasOpenDesignEnv).forEach((i=>{var n=e.wasOpenDesignEnv[i];n&&(t.designEnv[i]=n,t.hasLoad=!0)})),t},removeDesignEnv:function(e,t){var i=!1;return e.designEnv[t]&&(delete e.designEnv[t],i=!0),e.wasOpenDesignEnv[t]&&(delete e.wasOpenDesignEnv[t],i=!0),i},removeProduct:function(e,t){var i=!1;return e.products[t]&&(delete e.products[t],i=!0),e.wasOpenProducts[t]&&(delete e.wasOpenProducts[t],i=!0),i},removeFilter:function(e,t){return e.filters[t]&&(delete e.filters[t],!0),e.wasOpenFilters[t]&&(delete e.wasOpenFilters[t],!0),!1},removePointCloud:function(e,t){var i=!1;return e.pointClouds[t]&&(delete e.pointClouds[t],i=!0),e.wasOpenPointCloud[t]&&(delete e.wasOpenPointCloud[t],i=!0),i}},t||(t=new n),t})),define("DS/PADServices/views/private/docsMgt/AttachmentDocsUI",["UWA/Core","UWA/Controls/Abstract","UWA/Class","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL"],(function(e,t,i,n,o){"use strict";return i.extend(t,{init:function(e){this._parent(e),this.options=e},initPane:function(e){this.options.showLoader=e.showLoader,this.options.hideLoader=e.hideLoader;var t=this;t.options.showLoader(),require(["DS/ENOXAttachmentsUX/AttachmentsPane","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],(function(i,o){t.elements={},t.elements.doclstdiv=document.createElement("div"),t.elements.doclstdiv.classList.add("doclst_container");var s=new i({parentObject:{parentId:t._currentid},connectorOptions:{fetchSecurityContext:function(){return n.getSecurityContext().replace("ctx::","")},getWorkUnderHeaders:function(){if(o){var e=o.get();return e&&e.change&&""!==e.change.id?{"DS-Change-Authoring-Context":"pid:"+e.change.id}:{}}},platformUrls:t.getPlatformOptions()},hideAttachments:t.options.hideAttachments,hideSpecifications:t.options.hideSpecifications,supportedTypes:t.options.supportedTypes,readonly:t.options.readonly,webinwin:n.isWebInWinContext()});s.inject(t.elements.doclstdiv),t.options.hideLoader(),e.renderTo.appendChild(t.elements.doclstdiv),t.options.mainRenderDiv=e.renderTo,t.attachmentsPane=s,t.options.hideLoader()}))},getPlatformOptions:function(){return{"3DSpace":o.get3DSpaceURL(),"3DSwym":o.get3DSwymURL(),"3DDashboard":o.getPlatformURL("3DDashboard"),platformId:o.getPlatformId()}},updatePane:function(e){this.options.showLoader(),this.attachmentsPane&&(this.attachmentsPane.attachmentsPane&&(this.attachmentsPane.attachmentsPane.options.connectorOptions.platformUrls=this.getPlatformOptions()),this.attachmentsPane.specificationsPane&&(this.attachmentsPane.specificationsPane.options.connectorOptions.platformUrls=this.getPlatformOptions()),this.attachmentsPane.setParentObject(e))},selectionModified:function(e){this.options.showLoader(),e.parentId!==this._currentid?(this._currentid=e.parentId,this._parentType=e.parentType,this.updatePane(e)):this.updatePane(e),this.options.hideLoader()}})})),define("DS/PADServices/views/private/docsMgt/AttachmentDocsFacet",["css!DS/PADServices/PADServices","UWA/Core","DS/PADServices/views/private/docsMgt/AttachmentDocsUI","UWA/Controls/Abstract","UWA/Class"],(function(e,t,i,n,o){"use strict";var s=require("DS/EditPropWidget/facets/Common/FacetsBase");return o.extend(n,s,{_docList:null,init:function(e){this._parent(e),this._initUI()},_initUI:function(){null===this._docList&&(this.elements.container=t.createElement("div",{class:"relatedDocumentsv2"}),this._docList=new i(this.options),this._docList.initPane({renderTo:this.elements.container,showLoader:this.showLoader.bind(this),hideLoader:this.hideLoader.bind(this)}))},updateFacet:function(){var e=this,t=function(t){t&&"Document"!==model.get("type")&&e._docList.selectionModified({parentId:t,parentType:model.get("type")})},i=this.getModel();i&&("relationship"===i.get("metatype")?this.getOccurrence().addEventOnce("onChange:properties",(function(){var i=e.getModel();t(i.get("objectId"))})):t(i.get("objectId")))},destroyComponent:function(){},onRefresh:function(){this.updateFacet()}})})),define("DS/PADServices/utils/R2VUtils",["DS/PADServices/ws/WSAccess","DS/PADServices/settings/AppSettings"],(function(e,t){"use strict";function i(){return"object"==typeof i.instance?i.instance:(i.instance=this,this)}return i.prototype.retrieveRecentTiles=async function(i,n,o){let s=i,r=[];for(let e=0;e<i.length;e++)r.push(n.pointClouds[i[e]].fsId);return!0===t.getSetting("eno3dview_r2vservices_v2")?this.retrieveRecentTilesV2(i,n,o):new Promise(((t,i)=>{let a=[];a.push(e.fetchSoIs({ids:s,serviceId:o})),a.push(e.fetchFeatureStates({ids:r,serviceId:o})),Promise.all(a).then((e=>{let i=0,o=e[0].result,s=e[1].result,r=[],a={};for(i=0;i<s.length;i++)a[s[i].resourceid]=s[i];for(i=0;i<o.length;i++){let e=o[i];e.label=o[i]["ds6w:label"],e.fsId=n.pointClouds[e.resourceid].fsId,e.selectedFs=a[e.fsId],r.push(e)}t(r)})).catch(i)}))},i.prototype.retrieveRecentTilesV2=async function(t,i,n){return new Promise(((i,o)=>{e.fetchSoIs({ids:t,serviceId:n}).then((t=>{const s=t.result;let r=[];for(let t=0;t<s.length;++t)r.push(e.getBSFActivity({id:s[t]["ds6w:i3dx"],serviceId:n}));Promise.all(r).then((t=>{r=[];for(let i=0;i<t.length;++i)t[i].data[0].bsfIngestId?r.push(e.fetchFeatureStates({ids:[t[i].data[0].bsfIngestId],serviceId:n})):r.push(e.getSoIActivities({objectId:t[i].data[0].resourceid,serviceId:n}));Promise.all(r).then((e=>{let t=[];for(let i=0;i<s.length;i++){let n=s[i],o=e[i].result[0];n.label=n["ds6w:label"],n.fsId=o.resourceid,n.grid||(n.grid={owner:n.owner,"ds6w:responsible":n["ds6w:responsible"],"ds6w:description":n["ds6w:description"],"ds6w:modified":n["ds6w:modified"],"ds6w:type":n["ds6w:type"],"ds6w:created":n["ds6w:created"],"r2v:fsEffectivityDate":o.effectivityDate,"r2v:computeParameters":o.parameters}),n.type=n["ds6w:type"],n.icon||(n.icon=n["ds6w:icon"]),n.thumbnail||(n.thumbnail=n["ds6w:previewURL"]),n.type=n["ds6w:type"],o.grid||(o.grid={owner:o.owner,"ds6w:responsible":o["ds6w:responsible"],"ds6w:description":o["ds6w:description"],"ds6w:modified":o["ds6w:modified"],"ds6w:type":o["ds6w:type"],"ds6w:created":o["ds6w:created"],"r2v:fsEffectivityDate":o.effectivityDate,"r2v:computeParameters":o.parameters}),o.type=o["ds6w:type"],o.icon=o["ds6w:icon"],o.thumbnail=o["ds6w:previewURL"],o.type=o["ds6w:type"],n.selectedFs=o,t.push(n)}i(t)})).catch(o)})).catch(o)})).catch(o)}))},new i})),define("DS/PADServices/utils/DictionaryMgt",["UWA/Promise","DS/PADServices/ws/WSAccess","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/DictionaryAccess","DS/PADServices/utils/Storage","DS/PADServices/utils/ClassificationAttributes"],(function(e,t,i,n,o,s){"use strict";const r="-1";var a={},l=null,d={buildIconUrl:function(e){return null===l&&(l=i.get3DSpaceURL()+"/snresources/images/icons/small/"),e?l+e+".png":""},getNLSForTypes:function(e){var t=e.replace("ds6wg:","");return a.typesInfo[t]?a.typesInfo[t].displayName:a.extensions[t]?a.extensions[t].nlsName:a.automaticExtensions[t]?a.automaticExtensions[t].nlsName:t},getTypesInfo:function(i,s){return new e((function(e){var r=function(t,i){t="string"==typeof t?JSON.parse(t):t;for(var s=Object.getOwnPropertyNames(t),r=0;r<s.length;r++)t[s[r]]&&0===Object.keys(t[s[r]]).length&&delete t[s[r]];void 0===i&&o.sess.set("AttWizard/TypesInfo-1",t);var l=Object.getOwnPropertyNames(t),c={"ds6w:type":l};n.retrieveNLS({nlsData:c}).then((function(i){for(var n=0;n<l.length;n++)i["ds6w:type"][l[n]]?t[l[n]].displayName=i["ds6w:type"][l[n]]:t[l[n]].displayName=l[n],t[l[n]].iconUrl=d.buildIconUrl(t[l[n]].IconName);e(t),a.typesInfo=t}))};!0===s?(o.sess.del("AttWizard/TypesInfo"),t.getTypeInfo({url_parameters:{parentInfo:!0,$select:"IconName"},body:i.baseTypes}).then(r)):c("AttWizard/TypesInfo").then(r).catch((function(){t.getTypeInfo({url_parameters:{parentInfo:!0,$select:"IconName"},body:i.baseTypes}).then(r)}))}))},interfaces:function(i,n){return new e((function(e){var s=function(t,i){t="string"==typeof t?JSON.parse(t):t,void 0===i&&o.sess.set("AttWizard/InterfacesInfo-1",t);for(var n={},s={},r=t.results,l=0;l<r.length;l++)for(var d=r[l].name,c=0;c<r[l].interfaces.length;c++)r[l].interfaces[c].automatic&&"yes"===r[l].interfaces[c].automatic.toLowerCase()||r[l].interfaces[c].name.startsWith("XP_")&&r[l].interfaces[c].name.endsWith("_Ext")?(void 0===s[r[l].interfaces[c].name]&&(s[r[l].interfaces[c].name]=r[l].interfaces[c],s[r[l].interfaces[c].name].declareIn=[]),s[r[l].interfaces[c].name].declareIn.push(d)):(void 0===n[r[l].interfaces[c].name]&&(n[r[l].interfaces[c].name]=r[l].interfaces[c],n[r[l].interfaces[c].name].declareIn=[]),n[r[l].interfaces[c].name].declareIn.push(d));e({extensions:n,automaticExtensions:s}),a.extensions=n,a.automaticExtensions=s};!0===n?(o.sess.del("AttWizard/InterfacesInfo"),t.interfaces({url_parameters:{},onlyCustomer:i.onlyCustomer,data:{classes:i.classes}}).then(s)):c("AttWizard/InterfacesInfo").then(s).catch((function(){t.interfaces({url_parameters:{},onlyCustomer:i.onlyCustomer,data:{classes:i.classes}}).then(s)}))}))},getPropertiesForClass:function(t,i){return new e((function(i,o){var r=[n.getPropertiesForClass(t)];e.all(r).then((function(o){for(var r=o[0],l=o[1],d={},c=0;c<r.length;c++)for(var p=r[c],u=0;u<p.properties.length;u++){var h=p.properties[u];if(l){var m=h.originCuri;-1!==m.indexOf("ds6wg:")&&(m=m.replace("ds6wg:","")),h.dbAttrName=[],l.has(m)&&(h.dbAttrName=Array.from(l.get(m)))}if(void 0===d[h.curi])d[h.curi]=h,d[h.curi].inTypes=[p.classInfo.curi];else if(d[h.curi].inTypes.push(p.classInfo.curi),l){d[h.curi].dbAttrName;var f=h.dbAttrName;for(var g in f){var v=f[g];-1===d[h.curi].dbAttrName.indexOf(v)&&d[h.curi].dbAttrName.push(v)}}}var b=new e((function(e){s.getClassificationAttributes().then((function(t){if(t&&t.length>0)for(var i=0;i<t.length;i++)for(var n=t[i],o=0;o<n.properties.length;o++){var s=n.properties[o];void 0===d[s.curi]?(d[s.curi]=s,d[s.curi].inTypes=[n.classInfo.curi]):d[s.curi].inTypes.push(n.classInfo.curi)}e()})).catch((function(t){e()}))})),S=[];if(S.push(b),(void 0===t.queryTypeNLS||!0===t.queryTypeNLS)&&void 0===d["ds6w:type"]){d["ds6w:type"]={curi:"ds6w:type",label:"ds6w:type",dataType:"string"};var w=new e((function(e){n.getResourcesInfo(["ds6w:type"]).then((function(t){UWA.is(t,"array")&&1===t.length&&(d["ds6w:type"]=UWA.merge(t[0],d["ds6w:type"])),e()}))}));S.push(w)}e.all(S).then((function(){i({availaibleAttributes:d}),a.availaibleAttributes=d}))}))}))},getAllTypes:function(){return new e((function(e,i){function n(e,t){var i=e.name,n=t.name;return i.localeCompare(n)}var o={getNLS:!0};t.getFullDictionary(o).then((function(t){(t="string"==typeof t?JSON.parse(t):t)&&t.Dictionary&&t.Dictionary.Types&&t.DictionaryNLS||i();var o={},s={},r=[];Object.keys(t.Dictionary.Types).forEach((function(e){var i=t.DictionaryNLS["Type."+e];s[e]={displayName:i,parent:t.Dictionary.Types[e].Parent},r.push({type:e,name:i})})),a.typesInfo=s,o.res=s,r.sort(n),o.types=function(e){for(var t=[],i=0,n=e.length;i<n;++i)t.push(e[i].type);return t}(r),e(o)}),(function(){i()}))}))}},c=function(t){return new e((function(e,i){var n=o.sess.get(t+r);n?setTimeout((function(){e(n,!0)}),10):i()}))};return d})),define("DS/PADServices/views/private/MoreAttributesWizard",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Promise","DS/PADServices/utils/GlobalUtils","DS/PADServices/views/private/WizardSteps","text!DS/PADServices/assets/init/MoreAttrWizardSteps.json","DS/PADServices/views/private/SearchInput","DS/PADServices/views/private/Iconbar","DS/PADServices/utils/DictionaryMgt","DS/Controls/Button","DS/Controls/Loader","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/Utilities/Utils"],(function(e,t,i,n,o,s,r,a,l,d,c,p,u,h,m,f,g,v){"use strict";var b=JSON.parse(a),S={properties:[function(){return{property:"dataIndex",value:this.options.grid.attrName}},function(){return{property:"attrDBName",value:this.options.grid.attrDBName}},function(){return{property:"attrParent",value:this.options.grid.attrParent}},function(){return{property:"label",value:this.options.label}},function(){return{property:"kind",value:this.options.grid.attrKind}},function(){return{property:"description",value:this.options.grid.attrDesc}},function(){return{property:"dimension",value:this.options.grid.dimension}},function(){return{property:"preferredUnit",value:this.options.grid.preferredUnit}},function(){return{property:"selectable",value:this.options.grid.selectable}}]},w={"ds6wg:XCADExtension.V_CADOrigin":"ds6w:cadMaster"},y=["ds6w:globalType"];return n.extend({name:"more-attr",defaultOptions:{baseTypes:[],baseInstanceTypes:[],selectedTypes:[],automaticExtensions:[],selectedExtensions:[],selectedAttributes:[],defaultTypes:[],defaultExtensions:[],defaultAttributes:[],subscribeTokens:[],modelEvents:null,renderTo:null,steps:null,activeView:null,onlyCustomer:!0,maps:{referenceTypes:[],instanceTypes:[]},views:{typesView:null,extensionsView:null,attributesView:null},toolbar:null,grids:{},models:{},dgvOptions:{defaultColumnDef:{width:"auto",typeRepresentation:"string"},showRowBorderFlag:!0,alternateBackgroundFlag:!1,columns:[{icon:{iconName:"check",fontIconFamily:1},dataIndex:"attrSel",typeRepresentation:"boolean",alwaysVisibleFlag:!0,width:40,resizableFlag:!1,editableFlag:!0,editionPolicy:"EditionInPlace",getCellEditableState:function(e){var t=!0;return e.nodeModel&&(this.mandatorySelected&&-1!==this.mandatorySelected.indexOf(e.nodeModel.getReferenceValue("attrName"))||this.mandatorySelectedWithParent&&this.mandatorySelectedWithParent[e.nodeModel.options.grid.attrParent]&&-1!==this.mandatorySelectedWithParent[e.nodeModel.options.grid.attrParent].indexOf(e.nodeModel.getReferenceValue("attrName")))&&(t=!1),t}},{dataIndex:"attrParent",editableFlag:!1,width:30,sortableFlag:!0,resizableFlag:!1,getCellTypeRepresentation:function(e){return e.nodeModel&&e.nodeModel.options.grid.attrParent?e.nodeModel.options.grid.attrParent:"Unknown"},getCellSemantics:function(e){if(e.nodeModel)return{disabled:!0}}},{dataIndex:"tree",text:t.moreAttributesWizard.attrTitle}]},dgvLayoutOptions:{cellHeight:26,columnHeaderHeight:38,rowsHeader:!1}},init:function(e){this._parent(e),this._realInit(e)},_realInit:function(){var e=this,t=s.isWebInWinContext()?"-immersivePanelWebInWin":"-immersivePanel";e.elements.container=i.createElement("div",{class:e.getClassNames(t)}),e.instanceMgt=e.options.baseInstanceTypes&&e.options.baseInstanceTypes.length>0,e._buildBody().then(e._buildFooter.bind(e)).done((function(){e.switchView(b.activeStep),e.options.subscribeTokens.push(e.options.modelEvents.subscribe({event:"ENXViews/WizardSteps/stepChanged"},(function(t){var i=t.stepId;e.switchView(i)}))),e.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{html:e.elements.container}})}))},destroy:function(){for(var e=0;e<this.options.subscribeTokens.length;e++)this.options.modelEvents.unsubscribe(this.options.subscribeTokens[e]);this.options.toolbar.destroy();var t=this;Object.keys(t.options.grids).forEach((function(e){t.options.grids[e].destroy(),t.options.grids[e]=null})),this._parent()},_buildBody:function(){var e=this;return new o((function(t,n){e.elements.wizard=i.createElement("div",{class:e.getClassNames("-wizard")}).inject(e.elements.container),e.options.wizard=new r({modelEvents:e.options.modelEvents,renderTo:e.elements.wizard,steps:b});var o=i.createElement("div",{class:e.getClassNames("-toolbar-container")}).inject(e.elements.container);e.elements.content=i.createElement("div",{class:e.getClassNames("-content")}).inject(e.elements.container),e._generateToolbar({renderTo:o}),t()}))},_buildFooter:function(){var e=this;return new o((function(n,o){e.elements.footer=i.createElement("div",{class:e.getClassNames("-footer")}).inject(e.elements.container);var s=e.elements.nextButton=new p({label:t.moreAttributesWizard.next,value:"next",emphasize:"primary",touchMode:!0});s.addEventListener("click",(function(){if("typesView"===e.options.activeView)e.options.modelEvents.publish({event:"ENXViews/WizardSteps/changeStep",data:{stepId:"extensionsView"}});else if("extensionsView"===e.options.activeView)e.options.modelEvents.publish({event:"ENXViews/WizardSteps/changeStep",data:{stepId:"attributesView"}});else if("attributesView"===e.options.activeView){var t=e.options.models.attributesView.search({match:function(e){return!0===e.nodeModel.options.grid.attrSel}}).map((function(e){return e.dump(S)})),i=[].concat(e.options.selectedExtensions).concat(e.options.automaticExtensions);e.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/selectedAttributes",data:{selectedAttributes:t,selectedTypes:e.options.selectedTypes,selectedExtensions:i}}),e.destroy()}})),s.inject(e.elements.footer);var r=e.elements.closeButton=new p({label:t.moreAttributesWizard.cancel,emphasize:"secondary",touchMode:!0});r.addEventListener("click",(function(){e.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/closeWizard"}),e.destroy()})),r.inject(e.elements.footer),n()}))},switchView:function(e){if(this.options.activeView!==e)if(this.elements.toolbarSearch.clear(),this.__setToolbarCmds(e),this.options.previousView=this.options.activeView,this.options.activeView=e,null===this.options.views[e]){(c=this.elements.content.getElement("div.more-attr-chooser-view"))&&this.elements.content.removeChild(c),i.is(this.elements.loader)||(this.elements.loaderDiv=i.createElement("div",{class:this.getClassNames("-loader")}).inject(this.elements.content),this.elements.loader=(new u).inject(this.elements.loaderDiv),this.elements.loader.getContent().addClassName("enx-loader")),this.elements.loaderDiv.removeClassName("hidden"),this.elements.nextButton.disabled=!0,this.options.wizard.getContent().addClassName("disabled"),this.elements.loader.on();var t=this,n=[],s=null,r=0,a=b.steps.length;do{b.steps[r].id===e&&(s=b.steps[r]),r++}while(r<a||null===s);var l=!1;if(s.prerequisiteViews)for(var d=0;d<s.prerequisiteViews.length;d++)null===this.options.views[s.prerequisiteViews[d]]&&(n.push(this["_build"+s.prerequisiteViews[d]](!0)),l=!0);o.all(n).then(function(){if(!0===l){var i=this.elements.content.getElement("div.more-attr-chooser-view");i&&this.elements.content.removeChild(i)}this["_build"+e]().then((function(e){t.elements.loaderDiv.addClassName("hidden"),t.elements.loader.off(),t.elements.nextButton.disabled=!1,t.options.wizard.getContent().removeClassName("disabled"),t.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/viewReady",data:{activeView:t.options.activeView}})}))}.bind(this))}else{var c;(c=this.elements.content.getElement("div.more-attr-chooser-view"))&&this.elements.content.removeChild(c),this.options.views[e].inject(this.elements.content);t=this;!0===this.typesUpdated&&"extensionsView"===this.options.activeView?this.__updateExtensionsView().then((function(){delete t.typesUpdated,t.extensionsUpdated=!0,t.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/viewReady",data:{activeView:t.options.activeView}})})):!0!==this.typesUpdated&&!0!==this.extensionsUpdated||"attributesView"!==this.options.activeView?this.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/viewReady",data:{activeView:this.options.activeView}}):this.__updateAttributesView().then((function(){delete t.typesUpdated,delete t.extensionsUpdated,t.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/viewReady",data:{activeView:t.options.activeView}})}))}},_buildtypesView:function(){var e=this;return new o((function(n,o){e.elements.nextButton.label=t.moreAttributesWizard.next,e.elements.nextButton.disabled=!0;var r="typesView";e.options.wizard.getContent().addClassName("disabled"),e.options.views[r]=i.createElement("div",{class:e.getClassNames("-"+r+" more-attr-chooser-view")});var a=i.createElement("div",{class:e.getClassNames("-"+r+"Dgv more-attr-dgv-container")}).inject(e.options.views[r]),l=i.extend({identifier:"MoreAttrWizard-"+s.uid()},i.clone(e.options.dgvOptions));!0!==e.instanceMgt&&l.columns.splice(1,1),l.layout=new g(e.options.dgvLayoutOptions);var d=e.options.grids[r]=new f(l);!0===e.instanceMgt&&e._declareInstRefTypeReps(d),d.onContextualEvent=function(){return[]},d.getCellTooltip=function(i){var n=e.options.grids[r].getColumnOrGroup(i.columnID).dataIndex;if(i.dataIndex=n,-1===i.rowID)return{shortHelp:t.moreAttributesWizard[n],updateModel:!1}}.bind(this),d.mandatorySelected=e.options.defaultTypes,e.options.models[r]=new h({}),d.treeDocument=e.options.models[r],d.getContent().addClassName("enxdatagridview loading"),d.getContent().inject(a),e.options.views[r].inject(e.elements.content),d.onReady((function(){e.__updateTypesViewModel().finally((function(){d.getContent().removeClassName("loading"),n()})),d.addEventListener("change",e._changeType.bind(e))}))}))},_changeType:function(e,t){var i=this.options.grids[this.options.activeView];if(t&&t.nodeModel&&t.nodeModel.options.grid&&"attrSel"===i.layout.getDataIndexFromColumnIndex(t.columnID)){var n=t.nodeModel.getReferenceValue("attrName"),o=this.options.selectedTypes.indexOf(n);!0===t.nodeModel.options.grid.attrSel?-1===o&&this.options.selectedTypes.push(n):-1!==o&&this.options.selectedTypes.splice(o),this.typesUpdated=!0}},_buildextensionsView:function(){var e=this;return new o((function(n,o){e.elements.nextButton.label=t.moreAttributesWizard.next,e.elements.nextButton.disabled=!0;var r="extensionsView";e.options.wizard.getContent().addClassName("disabled"),e.options.views[r]=i.createElement("div",{class:e.getClassNames("-"+r+" more-attr-chooser-view")});var a=i.createElement("div",{class:e.getClassNames("-"+r+"-Dgv more-attr-dgv-container")}).inject(e.options.views[r]),l=i.extend({identifier:"MoreAttrWizard-"+s.uid()},i.clone(e.options.dgvOptions));!0!==e.instanceMgt&&(l.columns.splice(1,1),!0!==e.options.dgv&&l.columns.push({icon:{iconName:"where-used",fontIconFamily:1},dataIndex:"declaredIn",typeRepresentation:"declaredInRepresentation",editableFlag:!1,width:75,sortableFlag:!1,resizableFlag:!1})),l.layout=new g(e.options.dgvLayoutOptions);var d=e.options.grids[r]=new f(l);if(!0===e.instanceMgt)e._declareInstRefTypeReps(d);else if(!0!==e.options.dgv){var c={declaredInRepresentation:{stdTemplate:"functionMenuIcon",semantics:{icon:{iconName:"where-used",fontIconFamily:WUXManagedFontIcons.Font3DS}}}};d.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(c))}d.onContextualEvent=function(){return[]},d.getCellTooltip=function(i){var n=e.options.grids[r].getColumnOrGroup(i.columnID).dataIndex;return i.dataIndex=n,-1===i.rowID?{shortHelp:t.moreAttributesWizard[n],updateModel:!1}:!0===e.instanceMgt&&i.nodeModel?{shortHelp:t.replace(t.moreAttributesWizard.declaredInWithTypes,{types:i.nodeModel.getReferenceValue("attrInTypeNLS").join("\n")}),updateModel:!1}:void 0}.bind(this),d.mandatorySelected=e.options.defaultExtensions,e.options.models[r]=new h({}),d.treeDocument=e.options.models[r],d.getContent().addClassName("enxdatagridview loading"),d.getContent().inject(a),e.options.views[r].inject(e.elements.content),d.onReady((function(){e.__updateExtensionsViewModel(!0).finally((function(){d.getContent().removeClassName("loading"),n({})})),d.addEventListener("change",e._changeExtension.bind(e))}))}))},_changeExtension:function(e,t){var i=this.options.grids[this.options.activeView];if(t&&t.nodeModel&&t.nodeModel.options.grid&&"attrSel"===i.layout.getDataIndexFromColumnIndex(t.columnID)){var n=t.nodeModel.getReferenceValue("attrName"),o=this.options.selectedExtensions.indexOf(n);!0===t.nodeModel.options.grid.attrSel?-1===o&&this.options.selectedExtensions.push(n):-1!==o&&this.options.selectedExtensions.splice(o),this.extensionsUpdated=!0}},_buildattributesView:function(){var e=this;return new o((function(n){e.elements.nextButton.label=t.moreAttributesWizard.done,e.elements.nextButton.disabled=!0;var o="attributesView";e.options.wizard.getContent().addClassName("disabled"),e.options.views[o]=i.createElement("div",{class:e.getClassNames("-"+o+" more-attr-chooser-view")});var r=i.createElement("div",{class:e.getClassNames("-"+o+"-Dgv more-attr-dgv-container")}).inject(e.options.views[o]),a=i.extend({identifier:"MoreAttrWizard-"+s.uid()},i.clone(e.options.dgvOptions));e.instanceMgt||(a.columns.splice(1,1),!0!==e.options.dgv&&a.columns.push({text:t.moreAttributesWizard.declaredIn,dataIndex:"declaredIn",typeRepresentation:"declaredInRepresentation",editableFlag:!1,width:75,sortableFlag:!1,resizableFlag:!1})),a.layout=new g(e.options.dgvLayoutOptions);var l=e.options.grids[o]=new f(a);if(!e.instanceMgt&&!0!==e.options.dgv){var d={declaredInRepresentation:{stdTemplate:"functionMenuIcon",semantics:{icon:{iconName:"where-used",fontIconFamily:WUXManagedFontIcons.Font3DS}}}};l.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(d))}l.onContextualEvent=function(){return[]},l.getCellTooltip=function(i){var n=e.options.grids[o].getColumnOrGroup(i.columnID).dataIndex;if(i.dataIndex=n,-1===i.rowID)return{shortHelp:t.moreAttributesWizard[n],updateModel:!1};if(i.nodeModel){var s=i.nodeModel.getReferenceValue("attrInTypeNLS");if(s)return{shortHelp:t.replace(t.moreAttributesWizard.declaredInWithTypes,{types:s.join("\n")}),updateModel:!1}}}.bind(this),e.options.defaultAttributes.length<=0&&(e.options.defaultAttributes=["ds6w:label","ds6w:type"]),l.mandatorySelectedWithParent={Reference:e.options.defaultAttributes},e.options.models[o]=new h({}),l.treeDocument=e.options.models[o],l.getContent().addClassName("enxdatagridview loading"),l.getContent().inject(r),e.options.views[o].inject(e.elements.content),l.onReady((function(){e.__updateAttributesViewModel().then((function(){l.getContent().removeClassName("loading"),n()})),l.addEventListener("change",e._changeAttributes.bind(e))}))}))},_changeAttributes:function(e,t){var i=this.options.grids[this.options.activeView];if(t&&t.nodeModel&&t.nodeModel.options.grid&&"attrSel"===i.layout.getDataIndexFromColumnIndex(t.columnID)){for(var n=-1,o=0,s=this.options.selectedAttributes.length;-1===n&&o<s;)this.options.selectedAttributes[o].name===t.nodeModel.getReferenceValue("attrName")&&this.options.selectedAttributes[o].instRef===t.nodeModel.getReferenceValue("attrParent")&&(n=o),o++;!0===t.nodeModel.options.grid.attrSel?-1===n&&this.options.selectedAttributes.push({name:t.nodeModel.getReferenceValue("attrName"),instRef:t.nodeModel.getReferenceValue("attrParent")}):-1!==n&&this.options.selectedAttributes.splice(n)}},_generateToolbar:function(e){var t=this,n=v.debounce((function(e){t.options.models[t.options.activeView].withTransactionUpdate((function(){var i=e.searchStr,n=!0;t.options.filterInProgress=!0,t.options.models[t.options.activeView].search({match:function(e){!function(e,t){var i=!1,n=new RegExp(e,"i");return(n.test(t.nodeModel.options.grid.attrTitle)||n.test(t.nodeModel.getLabel()))&&(i=!0),i}(i,e)?(e.nodeModel.unmatchSearch(),e.nodeModel.unselect(),e.nodeModel.hide()):(e.nodeModel.show(),i.length>0&&n?(e.nodeModel.select(!0),e.nodeModel.matchSearch(),n=!1):(e.nodeModel.unmatchSearch(),e.nodeModel.unselect()))}}),t.options.filterInProgress=!1})),t.options.models[t.options.activeView].getXSO().onPostAdd((function(){})),t.options.models[t.options.activeView].getXSO().onPostRemove((function(){}))}),500);this.elements.toolbar=i.createElement("div",{class:this.getClassNames("-toolbar")}).inject(e.renderTo);var o=i.createElement("div",{class:this.getClassNames("-toolbar-input")}).inject(this.elements.toolbar);this.elements.toolbarIconbar=i.createElement("div",{class:this.getClassNames("-toolbar-iconbar")}).inject(this.elements.toolbar);this.elements.toolbarSearch=new l({events:{onSearch:n}}).inject(o)},__setToolbarCmds:function(e){var i,n=this,o="none",s="none",r=function(){n.options.models[n.options.activeView].withTransactionUpdate((function(){for(var e=n.options.models[n.options.activeView].getRoots(),t=o+"-"+s,i=0;i<e.length;i++)switch(t){case"none-none":e[i].show();break;case"selected-none":!0===e[i].getReferenceValue("attrSel")?e[i].show():e[i].hide();break;case"unselected-none":!1===e[i].getReferenceValue("attrSel")?e[i].show():e[i].hide();break;case"none-reference":"Instance"!==e[i].getReferenceValue("attrParent")?e[i].show():e[i].hide();break;case"none-instance":"Reference"!==e[i].getReferenceValue("attrParent")?e[i].show():e[i].hide();break;case"selected-reference":!0===e[i].getReferenceValue("attrSel")&&"Instance"!==e[i].getReferenceValue("attrParent")?e[i].show():e[i].hide();break;case"selected-instance":!0===e[i].getReferenceValue("attrSel")&&"Reference"!==e[i].getReferenceValue("attrParent")?e[i].show():e[i].hide();break;case"unselected-reference":!1===e[i].getReferenceValue("attrSel")&&"Instance"!==e[i].getReferenceValue("attrParent")?e[i].show():e[i].hide();break;case"unselected-instance":!1===e[i].getReferenceValue("attrSel")&&"Reference"!==e[i].getReferenceValue("attrParent")?e[i].show():e[i].hide()}})),n.options.models[n.options.activeView].getXSO().onPostAdd((function(){})),n.options.models[n.options.activeView].getXSO().onPostRemove((function(){}))},a={fonticon:"reload",text:t.replace(t.moreAttributesWizard.reload,{what:t.moreAttributesWizard.availableTypes}),name:"reload",handler:function(e,t){n.elements.loader.on(),n.elements.loaderDiv.removeClassName("hidden"),n.options.grids.typesView.getContent().addClassName("loading"),n.elements.nextButton.disabled=!0,n.options.wizard.getContent().addClassName("disabled"),n.options.models.typesView.removeRoots(),n.__updateTypesViewModel(!0).finally((function(){n.elements.loader.off(),n.options.grids.typesView.getContent().removeClassName("loading"),n.elements.nextButton.disabled=!1,n.options.wizard.getContent().removeClassName("disabled")}))}},l={fonticon:"reload",text:t.replace(t.moreAttributesWizard.reload,{what:t.moreAttributesWizard.availableExtensions}),name:"reload",handler:function(e,t){n.__updateExtensionsView()}},c={fonticon:"reload",text:t.replace(t.moreAttributesWizard.reload,{what:t.moreAttributesWizard.availableAttributes}),name:"reload",handler:function(e,t){n.__updateAttributesView()}},p={fonticon:"list-filter",text:t.moreAttributesWizard.filterRowsKind,name:"filter-kind",content:{type:"dropdownmenu",options:{items:[{fonticon:"block",text:t.moreAttributesWizard.none,name:"none",selectable:!0,selected:!0},{fonticon:"object-reference",text:t.moreAttributesWizard.filterreference,name:"reference",selectable:!0},{fonticon:"object-instance",text:t.moreAttributesWizard.filterinstance,name:"instance",selectable:!0}],events:{onClick:function(e,t){var i;i=t.name,s=i,r()}}}}},u={fonticon:"filter",text:t.moreAttributesWizard.filterRows,name:"filter",content:{type:"dropdownmenu",options:{items:[{fonticon:"block",text:t.moreAttributesWizard.none,name:"none",selectable:!0,selected:!0},{fonticon:"checkbox-on",text:t.moreAttributesWizard.selected,name:"selected",selectable:!0},{fonticon:"checkbox-off",text:t.moreAttributesWizard.unselected,name:"unselected",selectable:!0}],events:{onClick:function(e,t){var i;i=t.name,o=i,r()}}}}},h={className:"divider"};if(!this.options.toolbar||this.options.toolbar.currentView!==e){if(!0===this.instanceMgt)switch(e){case"typesView":i=[a,h,p,u];break;case"extensionsView":i=[l,h,p,u];break;case"attributesView":i=[c,h,p,u]}else i=[h,u];var m={renderTo:this.elements.toolbarIconbar,items:i};this.options.toolbar&&(this.options.toolbar.destroy(),this.options.toolbar=null),this.options.toolbar=new d(m),this.options.toolbar.elements.container.setStyle("display",void 0)}},_declareInstRefTypeReps:function(e){var t={Reference:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"object-reference",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Instance:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"object-instance",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Both:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"part-replace",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Extension:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"part-add",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Classification:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"library-books",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Unknown:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"i-question",fontIconFamily:WUXManagedFontIcons.Font3DS}}}};e.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(t))},_checkSelected:function(e,t){var i=this.options.selectedAttributes.filter((function(i){return i.name===e&&i.instRef===t}));return i.length>1&&console.warn("Several attributes found "+JSON.stringify(i)),1===i.length},__updateTypesViewModel:function(e){var t=this;return new o((function(i){var n="typesView",o=function(e,o){o||(o=Object.getOwnPropertyNames(e)),t.options.models[n].withTransactionUpdate((function(){let i=[];for(var s=0;s<o.length;s++){var r=o[s],a=e[r],l=-1!==t.options.selectedTypes.indexOf(r),d=a.parent?a.parent:r,c=-1!==t.options.baseTypes.indexOf(d)?"Reference":-1!==t.options.baseInstanceTypes.indexOf(d)?"Instance":"Unknown";!0===l&&i.push(r);var p=new m({label:a.displayName,grid:{attrName:r,attrTitle:a.displayName,attrSel:l,attrParent:c},icons:[a.iconUrl]});t.options.models[n].addRoot(p,l?0:void 0),"Reference"===c&&-1===t.options.maps.referenceTypes.indexOf(r)&&t.options.maps.referenceTypes.push(r),"Instance"===c&&-1===t.options.maps.instanceTypes.indexOf(r)&&t.options.maps.instanceTypes.push(r)}i.length!==t.options.selectedTypes.length&&(console.log("All selected types not found. \nSelected:"+JSON.stringify(t.options.selectedTypes)+"\nFound:"+JSON.stringify(i)),t.options.selectedTypes=i)})),i({})};if(0==t.options.baseTypes.length)c.getAllTypes().then((function(e){t.options.baseTypes=e.types,o(e.res,e.types)}));else{var s=t.options.baseInstanceTypes.length?t.options.baseTypes.concat(t.options.baseInstanceTypes):t.options.baseTypes;s=s.concat(t.options.defaultExtensions),c.getTypesInfo({baseTypes:s},e).then(o)}}))},__updateExtensionsView:function(){var e=this;return new o((function(t){e.elements.loader.on(),e.elements.loaderDiv.removeClassName("hidden"),e.options.grids.extensionsView.getContent().addClassName("loading"),e.elements.nextButton.disabled=!0,e.options.wizard.getContent().addClassName("disabled"),e.options.models.extensionsView.removeRoots(),e.__updateExtensionsViewModel(!0).finally((function(){e.elements.loader.off(),e.options.grids.extensionsView.getContent().removeClassName("loading"),e.elements.nextButton.disabled=!1,e.options.wizard.getContent().removeClassName("disabled"),t()}))}))},__updateExtensionsViewModel:function(e){var t=this;return new o((function(i){var n="extensionsView";c.interfaces({classes:t.options.selectedTypes,onlyCustomer:t.options.onlyCustomer},e).then((function(e){for(var o=Object.getOwnPropertyNames(e.extensions),s=[],r=[],a=0;a<o.length;a++){var l=o[a],d=e.extensions[l],p=-1!==t.options.selectedExtensions.indexOf(l);p&&(s.push(l),r.push(l));for(var u={menu:[]},h="",f=!1,g=!1,v=[],b=0;b<d.declareIn.length;b++)-1!==t.options.baseTypes.indexOf(d.declareIn[b])?f=!0:-1!==t.options.baseInstanceTypes.indexOf(d.declareIn[b])&&(g=!0),t.instanceMgt||u.menu.push({type:"PushItem",title:c.getNLSForTypes(d.declareIn[b])}),-1===v.indexOf(d.declareIn[b])&&v.push(c.getNLSForTypes(d.declareIn[b]));h=!0===f&&!0===g?"Both":!0===f?"Reference":!0===g?"Instance":"Unknown";var S=new m({label:d.nlsName,grid:{attrName:d.name,attrTitle:d.nlsName,attrSel:p,declaredIn:u,attrInType:d.declareIn,attrInTypeNLS:v,attrParent:h}});t.options.models[n].addRoot(S,p?0:void 0)}var w=Object.getOwnPropertyNames(e.automaticExtensions);for(a=0;a<w.length;a++)t.options.automaticExtensions.push(w[a]);for(a=0;a<t.options.defaultExtensions.length;a++)0===t.options.defaultExtensions[a].indexOf("XP_")&&t.options.defaultExtensions[a].indexOf("_Ext")===t.options.defaultExtensions[a].length-4&&(t.options.automaticExtensions.push(t.options.defaultExtensions[a]),s.push(t.options.defaultExtensions[a]));if(r.length!==t.options.selectedExtensions.length)for(let e=t.options.selectedExtensions.length-1;e>=0;e--)-1===r.indexOf(t.options.selectedExtensions[e])&&-1===t.options.defaultExtensions.indexOf(t.options.selectedExtensions[e])&&(console.warn("MoreAttributesWizard ## Remove Not Available extension ["+t.options.selectedExtensions[e]+"]"),t.options.selectedExtensions.splice(e,1));if(s.length!==t.options.defaultExtensions.length){h="Reference";for(let e=0;e<t.options.defaultExtensions.length;e++){var y=t.options.defaultExtensions[e];if(-1===r.indexOf(y)){var _=["VPMReference"],D=(v=[c.getNLSForTypes(_[0])],u={},c.getNLSForTypes(y));S=new m({label:D,grid:{attrName:y,attrTitle:D,attrSel:!0,declaredIn:u,attrInType:_,attrInTypeNLS:v,attrParent:h}});t.options.models[n].addRoot(S,0)}}}i({})}))}))},__updateAttributesView:function(){var e=this;return new o((function(t){e.elements.loader.on(),e.elements.loaderDiv.removeClassName("hidden"),e.options.grids.attributesView.getContent().addClassName("loading"),e.elements.nextButton.disabled=!0,e.options.wizard.getContent().addClassName("disabled"),e.options.models.attributesView.removeRoots(),e.__updateAttributesViewModel(!0).finally((function(){e.elements.loader.off(),e.options.grids.attributesView.getContent().removeClassName("loading"),e.elements.nextButton.disabled=!1,e.options.wizard.getContent().removeClassName("disabled"),t()}))}))},__updateAttributesViewModel:function(e){var n=this;return new o((function(e){for(var o="attributesView",s=i.clone(n.options.selectedTypes.concat(n.options.automaticExtensions).concat(n.options.selectedExtensions)),r=0;r<s.length;r++)s[r]="ds6wg:"+s[r];var a=s.join("\n");c.getPropertiesForClass({classURIs:a,types:i.clone(n.options.selectedTypes),interfaces:i.clone(n.options.automaticExtensions.concat(n.options.selectedExtensions))},n.options.dbOnlyAttributes).then((function(i){for(var r=Object.getOwnPropertyNames(i.availaibleAttributes),a=[],l=[],d=n.options.attributesToIgnore?n.options.attributesToIgnore:y,p=0;p<r.length;p++){var u=r[p],h=i.availaibleAttributes[u],f=w[u]?w[u]:u;if(-1===d.indexOf(f)){var g={menu:[]},v="",b=!1,S=!1,_=!1,D=!1,C=[],P=[],I=[],x=[],A=h.dbAttrName;if(h.inTypes)for(var E=0;E<h.inTypes.length;E++){var O=h.inTypes[E].substring(h.inTypes[E].indexOf(":")+1,h.inTypes[E].length);if(-1!==n.options.baseTypes.indexOf(O))b=!0;else if(-1!==n.options.baseInstanceTypes.indexOf(O))S=!0;else if(-1!==n.options.selectedExtensions.indexOf(O)||-1!==n.options.automaticExtensions.indexOf(O)){_=!0;var T=n.options.models.extensionsView.search({match:function(e){return e.nodeModel.getReferenceValue("attrName")===O}});if(T.length){var N=T[0].getReferenceValue("attrParent");"Reference"===N?b=!0:"Instance"===N?S=!0:"Both"===N&&(b=!0,S=!0)}}else"ClassificationAttributes"===O&&(D=!0);n.instanceMgt||-1===s.indexOf(h.inTypes[E])||g.menu.push({type:"PushItem",title:c.getNLSForTypes(h.inTypes[E])}),-1===n.options.maps.referenceTypes.indexOf(O)&&!b||-1!==C.indexOf(O)||(C.push(O),P.push(c.getNLSForTypes(h.inTypes[E])),b=!0),-1===n.options.maps.instanceTypes.indexOf(O)&&!S||-1!==I.indexOf(O)||(I.push(O),x.push(c.getNLSForTypes(h.inTypes[E])),S=!0)}if("Instance"===(v=!0===b&&!0===S?"Both":!0===b?"Reference":!0===S?"Instance":!0===_?"Extension":!0===D?"Classification":"Unknown")&&(f+="-Instance"),-1===l.indexOf(f))if("Both"===v){a.push(f);var M=f+"-Instance",L=n._checkSelected(M,"Instance"),R=new m({label:h.label,grid:{attrName:M,attrDBName:A,attrTitle:h.label,attrDesc:h.description,attrKind:h.dataType.substring(h.dataType.indexOf("#")+1),attrInType:I,attrInTypeNLS:x,declaredIn:g,attrSel:L,dimension:"string"==typeof h.dimension&&h.dimension.length?h.dimension:void 0,preferredUnit:"string"==typeof h.manipulationUnit&&h.manipulationUnit.length?h.manipulationUnit:void 0,attrParent:"Instance",selectable:h.selectable}});n.options.models[o].addRoot(R,L?0:void 0),l.push(M);var U=n._checkSelected(f,"Reference"),F=new m({label:h.label,grid:{attrName:f,attrDBName:A,attrTitle:h.label,attrDesc:h.description,attrKind:h.dataType.substring(h.dataType.indexOf("#")+1),attrInType:C,attrInTypeNLS:P,declaredIn:g,attrSel:U,dimension:"string"==typeof h.dimension&&h.dimension.length?h.dimension:void 0,preferredUnit:"string"==typeof h.manipulationUnit&&h.manipulationUnit.length?h.manipulationUnit:void 0,attrParent:"Reference",selectable:h.selectable}});n.options.models[o].addRoot(F,U?0:void 0),l.push(f)}else{var V,k;"Reference"===v?(V=C,k=P):"Instance"===v?(V=I,k=x):"Classification"===v&&(V=["ClassificationAttributes"],k=[t.attributesCustomization.classificationAttributes]);var j=n._checkSelected(f,v),W=new m({label:h.label,grid:{attrName:f,attrDBName:A,attrTitle:h.label,attrDesc:h.description,attrKind:h.dataType.substring(h.dataType.indexOf("#")+1),attrInType:V,attrInTypeNLS:k,declaredIn:g,attrSel:j,dimension:"string"==typeof h.dimension&&h.dimension.length?h.dimension:void 0,preferredUnit:"string"==typeof h.manipulationUnit&&h.manipulationUnit.length?h.manipulationUnit:void 0,attrParent:v,selectable:h.selectable}});n.options.models[o].addRoot(W,j?0:void 0),l.push(f)}}}if(!0===n.instanceMgt){f="positionMatrix-Instance",j=n._checkSelected(f,"Instance"),W=new m({label:t.attributesCustomization.instanceMatrix,grid:{attrName:f,attrTitle:t.attributesCustomization.instanceMatrix,attrDesc:"",attrKind:"string",attrInType:["VPMInstance"],attrInTypeNLS:[c.getNLSForTypes("VPMInstance")],attrSel:j,attrParent:"Instance",selectable:h.selectable}});n.options.models[o].addRoot(W,j?0:void 0),l.push(f)}e({})}))}))}})})),define("DS/PADServices/utils/HideShowInhUtils",["DS/PADServices/settings/AppSettings","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/Meas"],(function(e,t,i){"use strict";function n(){return"object"==typeof n.instance?n.instance:(n.instance=this,this)}return n.prototype.generateRespFromNodes=function(e,t,i=!1,n=!0){if(!Array.isArray(e)||0===e.length)return{inherit:[],alertHasPGP:i,from2D:!0};const o=e[0].getOccurencePath(),s={inherit:[],from2D:!0};if(n){let t=0;for(let n=1;n<e.length;n++){const o=e[n];!this.isOneParentNodeLockedDuePGP(o)&&o.getUserModifiedState()&&(s.inherit[t++]=o.getOccurencePath()),o.isLockNodeDuePGP()&&(i=!0)}}return t?s.show=[o]:s.hide=[o],s.alertHasPGP=i,s},n.prototype.isHideShowInheritActive=function(){return this.isHideShowInheritEnabledByUser()&&!this.isHideShowInheritDisabledDueContext()},n.prototype.isHideShowInheritEnabledByUser=function(){return!0===e.getSetting("hideShowInheritance")},n.prototype.isPGPFromServerDisabled=function(){return!1===e.getSetting("pgpFromServer")},n.prototype.isHideShowInheritDisabledDueContext=function(){return!0===e.getSetting("hideShowInheritanceDisabled")},n.prototype.isNodeValidForProcessing=function(e){let i=!0;return!!e&&((e.isRelationsObjectNode||e.isRelationsObjectGroupingNode)&&(i=!1),t.isFakeTreeNodeModel(e)&&(i=!1),30===e.options.isHiddenStateFrom&&(i=!1),i)},n.prototype.hideShowExtraNodes=function(e){const t=i.addOrGetSection("hideShowInheritance");t.start("collectExtraNodes",{stats:!0});let n=[],o=!1,s=(Array.isArray(e)&&e.length>0?e[0]:e).getChildren();if(!s||0===s.length)return{extraNodes:n,isPGPInsideExtraNodes:o};const{freeNode:r,hasPGP:a}=this.nodesWithoutLock(s);o=a;const l=new Set,d=new Array(r.length);let c=0;for(let e=0;e<r.length;e++)d[e]=r[e],l.add(r[e]);for(;c<d.length;){const e=d[c++].getChildren();for(let t=0;e&&t<e.length;t++){const i=e[t];this.isNodeValidForProcessing(i)&&(l.has(i)||(d.push(i),l.add(i)))}}return n=Array.from(l),t.end("collectExtraNodes"),{extraNodes:n,isPGPInsideExtraNodes:o}},n.prototype.setLockNodeDuePGP=function(e){return 30===e.options.isHiddenStateFrom},n.prototype.isOneParentNodeLockedDuePGP=function(e){let t=!1;const i=30;if(!e.isRoot()){let n=e.getRealParent();for(;n;){if(n.isLockNodeDuePGP()){t=!0;break}if(n.options.isHiddenStateFrom===i){t=!0;break}if(n.isRoot())break;n=n.getRealParent()}}return t},n.prototype.processChildNodesRecursively=function(e,i,n){let o=n;const s=e.getChildren();if(!s||0===s.length)return o;for(let e=0;e<s.length;e++){const n=s[e];if(!this.isNodeValidForProcessing(n)){if(t.isFakeTreeNodeModel(n)||n.isRelationsObjectNode||n.isRelationsObjectGroupingNode){const e=this.processChildNodesRecursively(n,i,o);o=o||e}continue}t.isFakeTreeNodeModel(n)||(n.isLockNodeDuePGP()&&n.options&&1===n.options.isHiddenState&&(o=!0),n.isLockNodeDuePGP()||i.push(n));const r=this.processChildNodesRecursively(n,i,o);o=o||r}return o},n.prototype.nodesWithoutLock=function(e){let i=[];let n=!1;for(let o=0;o<e.length;o++){const s=e[o];this.isNodeValidForProcessing(s)?(s.isLockNodeDuePGP()&&s.options&&1===s.options.isHiddenState&&(n=!0),s.isLockNodeDuePGP()||i.push(s)):(t.isFakeTreeNodeModel(s)||s.isRelationsObjectNode||s.isRelationsObjectGroupingNode)&&this.processChildNodesRecursively(s,i,n)}return{freeNode:i,hasPGP:n}},new n})),define("DS/PADServices/utils/HideShowCtrl",["DS/PADServices/settings/AppSettings","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/Storage","DS/PADUtils/PADSettingsMgt","DS/Utilities/UUID","DS/PADServices/utils/HideShowInhUtils"],(function(e,t,i,n,o,s,r){function a(e,t,i){let n=i.get(e);n?n.push(t):i.set(e,[t])}function l(){if("object"==typeof l.instance)return l.instance;l.instance=this;const e="undefined"!=typeof __karma__;function i(e,t){for(let[i,n]of t)e.pids.includes(n[0])&&g(i,t,!0)}return(o.getSetting("explorerOcc")||e)&&(this._hiddenPaths=new Map,this._shownPaths=new Map,t.subscribe({event:"ENXModel/hideShowState"},this.__hideShowUpdate.bind(this)),t.subscribe({event:"ENXModel/Root/remove"},function(e){e.all?(this._hiddenPaths.clear(),this._shownPaths.clear()):(i.call(this,e,this._hiddenPaths),i.call(this,e,this._shownPaths))}.bind(this)),t.subscribe({event:"ENXModel/refresh/begin"},function(){this._hiddenPaths.clear(),this._shownPaths.clear()}.bind(this))),this}function d(e,t,i=!1){t===b.HIDDEN&&(v(e),e.options.finalHiddenState=y.MIXED.isHiddenState),i&&(e.options.finalHiddenState=y.MIXED.isHiddenState),e.updateOptions(t)}function c(e,t){(i.isFakeTreeNodeModel(e)?e.getParent():e).updateOptions(t)}Object.defineProperties(l.prototype,{STATES:{get:function(){return b}},FROM:{get:function(){return w}}}),l.prototype.determineState=function(e){return e.options.isHiddenState?e.options.isHiddenState:e.options.isPADHidden?b.HIDDEN:b.SHOWN},l.prototype.determineIcon=function(e){let t=S.SHOWN;switch(e.options.isHiddenState){case b.HIDDEN:t=S.HIDDEN;break;case b.MIXED:t=S.MIXED;case b.SHOWN:}if(r.isHideShowInheritActive()){let i=e.isLockNodeDuePGP();t.disabled=!!i}return r.isHideShowInheritDisabledDueContext()&&!0===t.disabled&&(t.disabled=!1),t},l.prototype.determineTooltip=function(e,t){let o;const s=r.isHideShowInheritActive();switch(e.options.isHiddenState){case b.HIDDEN:o=s&&e.isLockNodeDuePGP()?{shortHelp:t.columnsDef.lock,updateModel:!1}:{shortHelp:t.columnsDef.hidden,updateModel:!1};break;case b.SHOWN:case b.MIXED:default:o=s&&!i.isFakeTreeNodeModel(e)&&e.isLockNodeDuePGP()?{shortHelp:t.columnsDef.lock,updateModel:!1}:{shortHelp:t.columnsDef.shown,updateModel:!1}}let a=i.getUserLogin()+".ENX2Dapp.debugPgpInfos";return n.local.get(a)&&e.options.isHiddenStateFrom===w.PGP&&(o.allowUnsafeHTMLShortHelp=!0,o.shortHelp+="<br>",o.shortHelp+="Status from server:["+e.options.isHiddenStateFrom+"]<br>",o.shortHelp+="Hide Server reference status:["+e.options.isPADHiddenReference+"]<br>",o.shortHelp+="Hide Server instance status:["+e.options.isPADHiddenInstance+"]<br>",o.shortHelp+="Hide Server occurrence status:["+e.options.isPADHiddenOccurrence+"]<br>"),o},l.prototype.setPGPs=function(e,t){e.prepareUpdate();let i=function(e,t){let i=[];for(let n=0;n<e.length;n++){let o=t.getNodeFromPath(e[n]);o&&i.push(o)}return i}(t,e),n=function(e){let t={bins:new Map};for(let i=0;i<e.length;i++){let n=e[i];a(n.getRealParent(),n,t.bins)}return t.parentArray=Array.from(t.bins.keys()),t}(i);for(let e=0;e<n.parentArray.length;e++){let t=n.parentArray[e],i=n.bins.get(t);const o=i.length-1;for(let e=0;e<i.length;e++){let t=e===o;this.__setPGPonOcc(i[e],t)}}e.pushUpdate()},l.prototype.__hideShowUpdate=function(e){let t=e.target;const i="show"===e.data.toggle,n=e.data.fromUI?w.UI:w.PROXY,o=e.data.noBroadcast;r.isHideShowInheritActive()&&(t=t.filter((e=>r.isNodeValidForProcessing(e))),t=e.data.hideShonInherit?t.concat(e.data.hideShonInherit.extraNodes):t.concat(r.hideShowExtraNodes(t).extraNodes)),i?this.__show(t,o,n,void 0,e.data.from2D):this.__hide(t,o,n,void 0,e.data.from2D)},l.prototype.__setPGPonOcc=function(e,t=!0){const i=e.options.isPADHiddenInstance,n=e.options.isPADHiddenReference;let o=!1;(e.options.isPADHiddenOccurrence||i||n)&&(o=!0),r.isHideShowInheritActive()?e.updateOptions({isPADHidden:o,isHiddenState:o?b.HIDDEN:b.SHOWN,isLockNode:r.setLockNodeDuePGP(e)}):e.updateOptions({isPADHidden:o,isHiddenState:o?b.HIDDEN:b.SHOWN});let s=(e,t)=>{if(!1===e.isRoot()){let i=e.getRealParent(),n=(i.options.isPADHidden,e.options.isHiddenState),o=i.options.isHiddenState,a=t;for(let e=0;e<i.options.children.length;e++){const t=i.options.children[e];if(t.options.isPADHidden!==a){a=t.options.isPADHidden;break}}a===t?o!==b.HIDDEN&&i.updateOptions({isPADHidden:t,isHiddenState:n!==o&&n===b.MIXED?b.MIXED:t?b.HIDDEN:b.SHOWN}):r.isHideShowInheritActive()?i.updateOptions({isPADHidden:!0,isHiddenState:b.MIXED}):i.updateOptions({isPADHidden:!1,isHiddenState:b.MIXED}),s(i,t)}};t&&s(e,o)},l.prototype.__hide=function(e,t,i,n){const o=()=>{for(let o=0;o<e.length;o++){const s=!r.isHideShowInheritActive()||o===e.length-1;this.__changeHSState(e[o],!0,t,i,s,n),m.call(this,e[o],"hide")}};let s;e&&e.length&&(s=e[0].getTreeDocument()),s&&s.withTransactionUpdate(o)},l.prototype.__show=function(e,t,i,n=!0,o){let s,a=()=>{for(let s=0;s<e.length;s++){const a=!r.isHideShowInheritActive()||s===e.length-1;this.__changeHSState(e[s],!1,t,i,a,o),n&&m.call(this,e[s],"show")}};e&&e.length&&(s=e[0].getTreeDocument()),s&&s.withTransactionUpdate(a)},l.prototype.__changeHSState=function(e,t,i,n,o=!0,s){if(void 0!==n&&(e.options.isHiddenStateFrom=n),e.updateOptions({isHiddenStateFrom:n,isPADHidden:t}),(i||void 0===e.options.finalHiddenState||e.options.finalHiddenState!==e.options.isHiddenState||(delete e.options.finalHiddenState,!e||e.isRoot()))&&(t&&e.updateOptions(y.HIDDEN),function(e){const t=e.options.prevIsHiddenState;if(void 0!==t)return delete e.options.prevIsHiddenState,e.updateOptions({isHiddenState:t}),!0;return!1}(e)||(v(e),e.updateOptions(t?y.HIDDEN:y.SHOW),e.options.ignoreRebound?delete e.options.ignoreRebound:t?e.options.hiddenStateSet=!0:e.updateOptions({hiddenStateSet:void 0})),o)){let n=this.__gatherParentList(e);this.__noBroadcastHS=i;for(let e=0;e<n.length;e++)this.__calculateParentState(n[e],null,null,s);!t&&this._determineMixedOnShow(e)&&(e.updateOptions(y.MIXED),e.updateOptions({isPADHidden:t}),delete e.options.hiddenStateSet),delete this.__noBroadcastHS}},l.prototype.defaultHiddenState=function(e){e&&e.isHiddenStateFrom&&e.isHiddenStateFrom===w.PGP?void 0===e.isPADHidden&&(e.isHiddenState=b.HIDDEN,e.isPADHidden=!0):(e.isHiddenState=b.SHOWN,e.isPADHidden=!1)};const p=e=>!i.isFakeTreeNodeModel(e)&&!0!==e.isGroupingNode;function u(e,t){let i=e.filter(p);if(i.length!==e.length){t.final=t.final.concat(i);let n=e.filter((e=>!i.includes(e)));for(let e=0;e<n.length;e++){let i=n[e];u(i.hasChildren()?i.getChildren():[],t)}}else t.final=t.final.concat(e)}function h(e){let t={final:[]};return u(e.getChildren(),t),t.final}function m(e,t){"hide"===t?(f(e,this._hiddenPaths),g(e,this._shownPaths)):(f(e,this._shownPaths),g(e,this._hiddenPaths))}function f(e,t){const i=e.getID();if(t.has(i)){if(!function(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}(t.get(i),e.getOccurencePath())){const n=e.getOccurencePath(),o=`${i}_${s.v4()}`;e.setUniqueIdentifier(o),t.set(o,n)}}else t.set(i,e.getOccurencePath())}function g(e,t,i=!1){let n;if(n=i?e:e.getID(),t.has(n))t.delete(n);else if(i)console.warn("Node not found in the map");else{const i=e.getUniqueIdentifier();t.delete(i)}}function v(e){if(!e.isRoot()){const t=e.options.isHiddenState;t===y.MIXED.isHiddenState&&(e.options.prevIsHiddenState=t)}}l.prototype.__calculateParentState=function(e,t,n,o){if(n=void 0!==n&&n,e.hasChildren()){if(!r.isHideShowInheritEnabledByUser()&&e.options.isHiddenState===b.HIDDEN){if(e.options.hiddenStateSet)return;if(e.options.isHiddenStateFrom===w.PGP)return}let s=h(e),a=0,l=[],p=[],u=[],m=!1;for(let t=0;t<s.length;t++){const n=s[t];i.isFakeTreeNodeModel(n)?(n.isRelationsObjectGroupingNode=!0,a++):!0!==n.isRelationsObjectGroupingNode&&(l.push(n),n.options.isHiddenState===b.SHOWN?p.push(n):n.options.isHiddenState===b.HIDDEN&&u.push(n),r.isHideShowInheritActive()&&e.options.isHiddenState===b.HIDDEN&&"function"==typeof n.isLockedDuePGP&&n.isLockedDuePGP()&&n.options.isHiddenState===b.SHOWN&&(m=!0))}if(a===s.length)return;if(function(e){return!e.childComputed&&!e.options.childComputed||"partiallyExpanded"===e.getState()}(e)&&!n)return void(p.length===l.length?c(e,y.SHOW):r.isHideShowInheritActive()&&u.length===l.length&&e.options.isHiddenState===b.HIDDEN&&e.options.hiddenStateSet?c(e,y.HIDDEN):c(e,y.MIXED));let f=p.length===l.length||e.options.isHiddenState===b.HIDDEN&&e.options.hiddenStateSet;const g=u.length===l.length;if(r.isHideShowInheritActive()&&(f=p.length===l.length),f){let t=y.SHOW;if(r.isHideShowInheritActive()&&e.getUserModifiedState()){if(t.isPADHidden=!1,d(e,t),!o){const t=require("DS/ENOXInterWdgCom/LinkManager"),i=r.generateRespFromNodes([e],!0,m,!1);t.publish("DS/ExternalWdgtCom/HideShowInherit",i)}}else d(e,t)}else g?d(e,y.HIDDEN):d(e,y.MIXED,t)}},l.prototype.getHiddenPathsAsArray=function(){return Array.from(this._hiddenPaths.values())},l.prototype.getShownPathsAsArray=function(){return Array.from(this._shownPaths.values())},l.prototype.__gatherParentList=function(e){let t=[];if(!e.isRoot()){let i=e.getRealParent();for(;i&&(t.push(i),!i.isRoot());)i=i.getRealParent()}return t},l.prototype.__clearHiddenState=function(){this._hiddenPaths.clear(),this._shownPaths.clear()},l.prototype._determineMixedOnShow=function(e){let t=!1;if(r.isHideShowInheritActive()&&e.options.isHiddenState===b.HIDDEN)return t;if(e.hasChildren()){const i=e.getChildren();for(let n=0;n<i.length;n++){const o=i[n];if(t=o.options.isHiddenState!==e.options.isHiddenState,t)break;t=this._determineMixedOnShow(o)}}return t};const b={HIDDEN:0,SHOWN:1,MIXED:2},S={SHOWN:{icon:{iconName:"eye dgv-show",fontIconFamily:1},label:"show"},HIDDEN:{icon:{iconName:"eye-off dgv-hide",fontIconFamily:1},label:"hide"},MIXED:{icon:{iconName:"eye-partial dgv-partial-hide"+(r.isHideShowInheritActive()&&!0===e.getSetting("hideShowRendering")?" hide_show_v2":""),fontIconFamily:1},label:"mixed"}},w={UI:10,PROXY:20,PGP:30},y={SHOW:{isHiddenState:b.SHOWN},HIDDEN:{isHiddenState:b.HIDDEN},MIXED:{isHiddenState:b.MIXED}};return new l})),define("DS/PADServices/views/private/docsMgt/SpecificationDocsUI",["UWA/Core","UWA/Controls/Abstract","UWA/Class","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL"],(function(e,t,i,n,o){"use strict";return i.extend(t,{init:function(e){this._parent(e),this.options=e},initPane:function(e){this.options.showLoader=e.showLoader,this.options.hideLoader=e.hideLoader;var t=this;t.options.showLoader(),require(["DS/ENOXSpecificationsUX/SpecificationsPane","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],(function(i,o){t.elements={},t.elements.doclstdiv=document.createElement("div"),t.elements.doclstdiv.classList.add("doclst_container");var s=new i({parentObject:{parentId:t._currentid},connectorOptions:{fetchSecurityContext:function(){return n.getSecurityContext().replace("ctx::","")},getWorkUnderHeaders:function(){if(o){var e=o.get();return e&&e.change&&""!==e.change.id?{"DS-Change-Authoring-Context":"pid:"+e.change.id}:{}}},platformUrls:t.getPlatformOptions()},hideAttachments:t.options.hideAttachments,hideSpecifications:t.options.hideSpecifications,supportedTypes:t.options.supportedTypes,readonly:t.options.readonly,webinwin:n.isWebInWinContext()});s.inject(t.elements.doclstdiv),t.options.hideLoader(),e.renderTo.appendChild(t.elements.doclstdiv),t.options.mainRenderDiv=e.renderTo,t.attachmentsPane=s,t.options.hideLoader()}))},getPlatformOptions:function(){return{"3DSpace":o.get3DSpaceURL(),"3DSwym":o.get3DSwymURL(),"3DDashboard":o.getPlatformURL("3DDashboard"),platformId:o.getPlatformId()}},updatePane:function(e){this.options.showLoader(),this.attachmentsPane&&(this.attachmentsPane.attachmentsPane&&(this.attachmentsPane.attachmentsPane.options.connectorOptions.platformUrls=this.getPlatformOptions()),this.attachmentsPane.specificationsPane&&(this.attachmentsPane.specificationsPane.options.connectorOptions.platformUrls=this.getPlatformOptions()),this.attachmentsPane.setParentObject(e))},selectionModified:function(e){this.options.showLoader(),e.parentId!==this._currentid?(this._currentid=e.parentId,this._parentType=e.parentType,this.updatePane(e)):this.updatePane(e),this.options.hideLoader()}})})),define("DS/PADServices/views/private/docsMgt/SpecificationDocsFacet",["css!DS/PADServices/PADServices","UWA/Core","DS/PADServices/views/private/docsMgt/SpecificationDocsUI","UWA/Controls/Abstract","UWA/Class"],(function(e,t,i,n,o){"use strict";var s=require("DS/EditPropWidget/facets/Common/FacetsBase");return o.extend(n,s,{_docList:null,init:function(e){this._parent(e),this._initUI()},_initUI:function(){null===this._docList&&(this.elements.container=t.createElement("div",{class:"relatedDocumentsv2"}),this._docList=new i(this.options),this._docList.initPane({renderTo:this.elements.container,showLoader:this.showLoader.bind(this),hideLoader:this.hideLoader.bind(this)}))},updateFacet:function(){var e=this,t=function(t){t&&"Document"!==model.get("type")&&e._docList.selectionModified({parentId:t,parentType:model.get("type")})},i=this.getModel();i&&("relationship"===i.get("metatype")?(console.count("firstModel-relatio"),this.getOccurrence().addEventOnce("onChange:properties",(function(){var i=e.getModel();t(i.get("objectId"))}))):t(i.get("objectId")))},destroyComponent:function(){},onRefresh:function(){this.updateFacet()}})})),define("DS/PADServices/utils/MaturityUtils",["DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL","DS/WAFData/WAFData","DS/i3DXCompassServices/i3DXCompassServices"],(function(e,t,i,n){"use strict";var o=!0,s=[],r={},a=(Promise.resolve(),[]);const l=["VPLM_SMB_Definition","VPLM_SMB_Evaluation","VPLM_SMB_Definition_MajorRev"];var d=null,c=function(i){return new Promise(((n,o)=>{i?e.getSecurityContext()?n():t.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0}).then((()=>{try{e.retrieveAndSetSC().then(n)}catch(e){console.warn("Cannot retrieve SC"),o()}})):o()}))};function p(s){return o?new Promise(((r,a)=>{new Promise((e=>{d?e(!0):void 0===d?e(!1):n.getServiceUrl({serviceName:"3DSpace",platformId:t.getPlatformId(),onComplete:t=>{e(void 0!==(d=t))},onFailure:()=>{d=void 0,e(!1)}})})).then(c).then((()=>{let n,a=s.policies?s.policies:void 0,l=JSON.stringify({policies:a}),c={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:encodeURIComponent(e.getSecurityContext())},data:l,onComplete:e=>{e=JSON.parse(e),r(e)},onFailure:e=>{n&&n.xhr&&404===n.xhr.status&&(console.warn("Unknown WS: ["+d+"/resources/lifecycle/maturity/getStatesAttributes]"),o=!1),r({policies:[]})}},p=d+"/resources/lifecycle/maturity/getStatesAttributes?tenant="+t.getPlatformId();n=i.authenticatedRequest(p,c)})).catch((()=>{a()}))})):Promise.resolve({})}function u(e,t,i){if(null===document.getElementById(e)){var n=document.createElement("style");n.type="text/css",n.id=e;let o=i||"."+e;n.innerHTML=o+t,document.getElementsByTagName("head")[0].appendChild(n)}}function h(e){return e.replace(/(\.| )/g,"-")}function m(){return"object"==typeof m.instance?m.instance:(m.instance=this,this)}return m.prototype.getAndCreateMaturityClass=function(e,t){if("string"!=typeof e)return console.warn("MaturityUtils## Maturity status mus be a string "),"";let i="lc-status-"+h(e)+(t?"-withClass":""),n=[],o=e.split(".")[0];return-1===s.indexOf(o+(t?"-withClass":""))&&n.push(o),n.length&&this.addCSSMaturityClasses(n,t),i},m.prototype.addCSSMaturityClasses=function(e,t){void 0===e&&(e=l.slice()),Promise.all(a).then((()=>{let i=[];for(let t=0;t<e.length;t++)-1===s.indexOf(e[t])&&void 0===r[e[t]]&&i.push(e[t]);let n=Promise.resolve();i.length&&(n=new Promise((e=>{s=s.concat(i),a.push(p({policies:i}).then((t=>{let i=t.policies;for(let e=0;i&&e<i.length;e++){let t=i[e].policyName;r[t]=i[e].states}e()})).catch((()=>{e()})))}))),n.then((()=>{for(let i=0;i<e.length;i++){let n=e[i];if(r[n]){let e=r[n];for(let i=0;i<e.length;i++){let o=e[i].activeColor,s="{color:"+("#FFFFFF"===o?"#000000":"#FFFFFF")+" ; background-color:"+o+";}",r=h(e[i].stateSysName),a=h(n),l="lc-status-"+a+"-"+r;if(u(l,s,"."+l+(t?" ."+t:"")),t){let e="lc-status-"+a+"-"+r+"-withClass";u(e,s,"."+e+" ."+t)}}t&&-1===s.indexOf(n+"-withClass")&&s.push(n+"-withClass")}}}))}))},m.prototype.__resetForUT=function(){o=!0,s=[],r={},Promise.resolve(),a=[],d=null},new m})),define("DS/PADServices/views/private/TilesViewUtils",["css!DS/PADServices/PADServices.css","i18n!DS/PADServices/assets/nls/PADServices.json","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/MaturityUtils","DS/PADServices/utils/DictionaryAccess","DS/PADServices/settings/AppSettings","DS/Utilities/Dom","DS/Controls/TooltipModel","DS/PlatformAPI/PlatformAPI","DS/Utilities/DateUtils"],(function(e,t,i,n,o,s,r,a,l,d,c){"use strict";const p=["ds6w:label","ds6w:type","ds6wg:revision","ds6w:status","owner","ds6w:responsible","ds6w:modified","ds6w:project","ds6w:identifier","ds6w:created","ds6w:reserved","ds6w:reservedBy"],u={dateStyle:"long",timeStyle:"medium"};o.addCSSMaturityClasses();var h=null,m=null;function f(e){return new Promise((t=>{let i={nlsData:{}},n=!1,o=e.serviceId?e.serviceId:"3DSpace";e.grid&&(e.grid["ds6w:type-original"]||(i.nlsData["ds6w:type"]=[{value:e.grid["ds6w:type"],source:[o]}],n=!0),e.grid["ds6w:status-original"]||(i.nlsData["ds6w:status"]=[{value:e.grid["ds6w:status"],source:[o]}],n=!0)),n?s.retrieveNLSWithSource(i).then((i=>{i["ds6w:type"]&&(e.grid["ds6w:type-original"]=e.grid["ds6w:type"],e.grid["ds6w:type"]=i["ds6w:type"][e.grid["ds6w:type"]]?i["ds6w:type"][e.grid["ds6w:type"]]:e.grid["ds6w:type"]),i["ds6w:status"]&&(e.grid["ds6w:status-original"]=e.grid["ds6w:status"],e.grid["ds6w:status"]=i["ds6w:status"][e.grid["ds6w:status"]]?i["ds6w:status"][e.grid["ds6w:status"]]:e.grid["ds6w:status"]),t(e)})):t(e)}))}function g(e,t){let i=a.createElement("span",{class:t.isWP&&!0!==e.isR2V?"enx-tile-subLabel enx-tile-subLabel-wp-custom":"enx-tile-subLabel"}),n=a.createElement("span",{class:"enx-tile-subLabel-type"});if(n.innerText=e.grid["ds6w:type"],i.appendChild(n),e.grid["ds6wg:revision"]){let t=a.createElement("span",{class:"enx-tile-divider"});t.innerText=" | ",i.appendChild(t);let n=a.createElement("span",{class:"enx-tile-subLabel-type"});n.innerText=e.grid["ds6wg:revision"],i.appendChild(n)}if(e.grid["ds6w:status"]){let t=a.createElement("span",{class:"enx-tile-divider"});t.innerText=" | ",i.appendChild(t),v(i,e.grid["ds6w:status-original"],e.grid["ds6w:status"])}if(b(i,e.grid.owner,e.grid["ds6w:responsible"]),e.grid["ds6w:modified"]){var o=c.formatDateToString(new Date(e.grid["ds6w:modified"]),{dateStyle:"medium",timePrecision:"sec"});let t=a.createElement("span",{class:"enx-tile-subLabel-modified"});t.innerText=o,i.appendChild(t)}return i.innerHTML}function v(e,t,i,n,s){if(t&&i){let r=a.createElement("span",{class:"enx-tile-status "+(s||"")}),l=o.getAndCreateMaturityClass(t);if(r.classList.add(l),r.innerText=i,e.appendChild(r),!0!==n){let t=a.createElement("span",{class:"enx-tile-divider"});t.innerText=" | ",e.appendChild(t)}}}function b(e,t,i,o,s){if(t&&i){let l=a.createElement("span",{class:"enx-tile-owner "+(s||"")});var r=n.get3DSwymURL();let d;if(r){d={iconPath:"url("+(r+"/api/user/getpicture/login/"+t)+")",className:"enx-tile-owner-icon owner-url"}}else d={iconName:"topbar-user",fontIconFamily:1,className:"enx-tile-owner-icon owner-font"};let c=a.generateIcon(d);l.appendChild(c);let p=a.createElement("span",{class:"enx-tile-subLabel-owner-label"});if(p.innerText=i,l.appendChild(p),e.appendChild(l),!0!==o){let t=a.createElement("span",{class:"enx-tile-divider"});t.innerText=" | ",e.appendChild(t)}}}function S(e){let t="";if(e.selectedFs){t=a.createElement("div",{class:"enx-fs-label"});let n=a.generateIcon({iconPath:e.selectedFs.icon,iconSize:{height:"14px",width:"14px"}});n.classList.add("enx-fs-label-icon"),t.appendChild(n);let o=a.createElement("div",{class:"enx-fs-label-txt"}),s=new Date(e.selectedFs.grid["r2v:fsEffectivityDate"]);o.innerText=e.selectedFs["ds6w:label"]+" - "+`${new Intl.DateTimeFormat(i.getLang(),u).format(s)}`,t.appendChild(o)}return t}function w(e,t){let i=UWA.String.escapeHTML(e.grid["ds6w:identifier"]);if(!0===r.getSetting("activateLockUX")&&_(e.grid["ds6w:reserved"])&&e.grid["ds6w:reservedBy"]){i=a.createElement("span",{class:"enx-tile-desc "+(t||"")}),i.appendChild(function(e){var t,i;t=void 0!==e.grid["ds6w:reserved"]?e.grid["ds6w:reserved"]:void 0,i=e.grid["ds6w:reservedBy"]?e.grid["ds6w:reservedBy"]:"";let n;if(void 0!==t){let e;if("boolean"==typeof t?t:"TRUE"===t.toUpperCase()){let t=function(){var e=D(),t="";void 0!==e&&(t=e.login);return t}(),n=!0;if(i.trim().length>0&&(n=i.toUpperCase().trim()===t.toUpperCase().trim()||!1,!n)){let e=function(){var e=D(),t="";void 0!==e&&(t=e.firstName+" "+e.lastName);return t}();n=i.toUpperCase().trim()===e.toUpperCase().trim()||!1}e=n?"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-key enx_wp_lock":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock enx_wp_lock_other"}e&&(n=a.generateIcon(e))}return n}(e));let n=a.createElement("span",{class:"enx-tile-divider"});n.innerText=" | ",i.appendChild(n);let o=a.createElement("span",{class:"enx-tile-subLabel-desc-label"});o.innerText=UWA.String.escapeHTML(e.grid["ds6w:identifier"]),i.appendChild(o)}return i}function y(){return"object"==typeof y.instance?y.instance:(y.instance=this,this)}function _(e){return"string"==typeof e?"TRUE"===e.toUpperCase():e}function D(){return null==m&&(m=d.getUser()),m}return y.prototype.addCSSMaturityClasses=function(){o.addCSSMaturityClasses()},y.prototype.getFetchAttribute=function(){return p},y.prototype.translateFetchAttribute=function(){return null===h?new Promise((e=>{s.getResourcesInfo(p).then((t=>{if(h={},!0===Array.isArray(t))for(let e=0;e<t.length;e++)h[t[e].curi]=t[e];else for(let e=0;e<p.length;e++)h[p[e]]={label:p[e]};e()}))})):Promise.resolve()},y.prototype.buildNodeOptions=function(e,t){return t=t||{},new Promise((i=>{this.translateFetchAttribute().then((()=>{f(e).then((e=>{if(e.grid){var n=e.grid["ds6w:status-original"]?e.grid["ds6w:status-original"]:e.grid["ds6w:status"];if(n&&!1===n.contains(".")){let t=e.grid["ds6w:policy-original"]?e.grid["ds6w:policy-original"]:e.grid["ds6w:policy"];t&&(e.grid["ds6w:status-original"]=t+"."+n)}e.subLabel=g(e,t);var o=e.grid["ds6w:type-original"]?e.grid["ds6w:type-original"]:e.grid["ds6w:type"];"ENOStrRefinementSpecification"===o?e.isFilter=!0:"R2V_FeatureOfInterest"===o?e.isR2V=!0:e.isFilter=!1,e.isR2V?e.description=S(e):e.description=w(e)}i(e)}))}))}))},y.prototype.toBeUpdated=function(e,t){let i=!1;if(e.options.filtered!==t.options.filtered)i=!0;else for(let n=0;n<p.length&&!1===i;n++)"ds6w:label"===p[n]?e.getLabel()!==t.getLabel()&&(i=!0):e.getReferenceValue(p[n])!==t.getReferenceValue(p[n])&&(i=!0);return i},y.prototype.getTooltip=function(e,i){if(null!==h){let n=function(e){let i=a.createElement("span",{class:"enx-tile-tooltip"}),n=a.createElement("span",{class:"enx-tile-tooltip-type enx-tile-tooltip-row"});i.appendChild(n);let o=a.createElement("span",{class:"enx-tile-tooltip-label"});o.innerText=h["ds6w:type"].label,n.appendChild(o);let s=a.createElement("span",{class:"enx-tile-tooltip-value"});if(s.innerText=e.grid["ds6w:type"],n.appendChild(s),e.grid["ds6wg:revision"]){let t=a.createElement("span",{class:"enx-tile-tooltip-revision enx-tile-tooltip-row"});i.appendChild(t);let n=a.createElement("span",{class:"enx-tile-tooltip-label"});n.innerText=h["ds6wg:revision"].label,t.appendChild(n);let o=a.createElement("span",{class:"enx-tile-tooltip-value"});o.innerText=e.grid["ds6wg:revision"],t.appendChild(o)}if(e.grid["ds6w:status-original"]||e.grid["ds6w:status"]){let t=a.createElement("span",{class:"enx-tile-tooltip-status enx-tile-tooltip-row"});i.appendChild(t);let n=a.createElement("span",{class:"enx-tile-tooltip-label"});n.innerText=h["ds6w:status"].label,t.appendChild(n);let o=a.createElement("span",{class:"enx-tile-tooltip-value"});v(o,e.grid["ds6w:status-original"],e.grid["ds6w:status"],!0),t.appendChild(o)}let l=a.createElement("span",{class:"enx-tile-tooltip-owner enx-tile-tooltip-row"});i.appendChild(l);let d=a.createElement("span",{class:"enx-tile-tooltip-label"});d.innerText=h["ds6w:responsible"].label,l.appendChild(d),b(l,e.grid.owner,e.grid["ds6w:responsible"],!0,"enx-tile-tooltip-value");let p=a.createElement("span",{class:"enx-tile-tooltip-modified enx-tile-tooltip-row"});i.appendChild(p);let u=a.createElement("span",{class:"enx-tile-tooltip-label"});if(u.innerText=h["ds6w:modified"].label,p.appendChild(u),e.grid["ds6w:modified"]){var m=c.formatDateToString(new Date(e.grid["ds6w:modified"]),{dateStyle:"medium",timePrecision:"sec"});let t=a.createElement("span",{class:"enx-tile-tooltip-value"});t.innerText=m,p.appendChild(t)}if(!0===r.getSetting("activateLockUX")&&_(e.grid["ds6w:reserved"])){let t=a.createElement("span",{class:"enx-tile-tooltip-reserverBy enx-tile-tooltip-row"});i.appendChild(t);let n=a.createElement("span",{class:"enx-tile-tooltip-label"});n.innerText=h["ds6w:reservedBy"].label,t.appendChild(n);let o=a.createElement("span",{class:"enx-tile-tooltip-value"});o.innerText=e.grid["ds6w:reservedBy"],t.appendChild(o)}if(e.selectedFs){let n=a.createElement("span",{class:"enx-tile-tooltip-location-state enx-tile-tooltip-row"});i.appendChild(n);let o=a.createElement("span",{class:"enx-tile-tooltip-label"});o.innerText=t.columnsNLS.locationstate,n.appendChild(o);let s=a.createElement("span",{class:"enx-tile-tooltip-value"});s.innerText=e.selectedFs["ds6w:label"],n.appendChild(s);let r=a.createElement("span",{class:"enx-tile-tooltip-eff-date enx-tile-tooltip-row"});i.appendChild(r);let l=a.createElement("span",{class:"enx-tile-tooltip-label"});l.innerText=t.columnsNLS["r2v:fsEffectivityDate"],r.appendChild(l),m=c.formatDateToString(new Date(e.selectedFs.grid["r2v:fsEffectivityDate"]),{dateStyle:"medium",timePrecision:"sec"});let d=a.createElement("span",{class:"enx-tile-tooltip-value"});d.innerText=m,r.appendChild(d)}return i}(e.options);return new l({title:e.getLabel(),shortHelp:n,allowUnsafeHTMLShortHelp:!0,updateModel:!1,wrapThreshold:375,initialDelay:i||void 0})}},y.prototype.updateNode=function(e,t){t=t||{},f(e.options).then((i=>{if(i.grid){var n=i.grid["ds6w:status-original"]?i.grid["ds6w:status-original"]:i.grid["ds6w:status"];if(n&&!1===n.contains(".")){let e=i.grid["ds6w:policy-original"]?i.grid["ds6w:policy-original"]:i.grid["ds6w:policy"];e&&(i.grid["ds6w:status-original"]=e+"."+n)}let o={};o.subLabel=g(i,t),i.isR2V?o.description=S(i):o.description=w(i),e.updateOptions(o)}}))},new y})),define("DS/PADServices/ws/WSENOAuth",["DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils","DS/PADServices/settings/AppSettings","DS/PADServices/views/private/TilesViewUtils","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/PConfigUtils","require","DS/PADUtils/PADSettingsMgt"],(function(e,t,i,n,o,s,r,a){"use strict";const l={url:"/resources/enoauthoring/fetch/v1",verb:"POST"},d={url:"/resources/enoedit/prodtopart/v1",verb:"POST"},c={url:"/resources/enoauthoring/expand/v2",verb:"POST"},p={url:"/resources/enoauthoring/expand/v2/progressive",verb:"POST"},u={url:"/resources/v1/collabServices/attributes/op/read",verb:"POST"};function h(e,t){var i=void 0;return t>-1&&(i=[{truncate:{max_distance_from_prefix:t,prefix_filter:{prefix_path:e}}}]),i}function m(){}return m.prototype={fetchDB:function(s){var r=t.getSecurityContext(),a=this,d=function(){var d=l,c=s.data;delete s.data,r||(r=t.getSecurityContext()),r=encodeURIComponent(r);var p=UWA.extend({method:l.verb,headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()}},s),u=e.get3DSpaceURL()+d.url+"?SecurityContext="+r+"&tenant="+e.getPlatformId(),h=Object.assign({label:"fetchDB-"+t.getRequestLabel(),physicalid:s.pids,select_predicate:c.select_predicate,locale:t.getLang(),tenant:e.getPlatformId(),types:o.getSelectedTypes(),extensions:o.getSelectedExtensions()},c);if(s.autoAttSelection){h=Object.assign(h,o.createOutputsRequest("fetch"));var m=n.getFetchAttribute();h.select_predicate=h.select_predicate.concat(m)}return!0===i.getSetting("pgpFromServer")&&(h.select_predicate&&-1===h.select_predicate.indexOf("bo.pgpshowextension.V_PGP_Show")&&h.select_predicate.push("bo.pgpshowextension.V_PGP_Show"),h.select_pgp=["Show","Hide"]),delete h.intent,delete h.authored,h.select_predicate&&(h.select_predicate=h.select_predicate.filter((function(e,t,i){return i.indexOf(e)===t}))),p.data=h,a.executeRequestPromise(u,p)};return r?d():new Promise(function(e,i){t.retrieveAndSetSC().then((function(){d().then(e)}))}.bind(this))},productToPart:function(n){var s=t.getSecurityContext(),r=this,a=function(){var s=d;n.data;delete n.data;var a=UWA.extend({method:d.verb,headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},timeout:i.getSetting("webapi_timeout")},n),l=e.get3DSpaceURL()+s.url+"?tenant="+e.getPlatformId(),c=o.createOutputsRequest(),p={label:"ProductToPart-"+t.getRequestLabel(),physicalid:n.pids,select_predicate:c.select_object,select_file:c.select_file,locale:t.getLang(),tenant:e.getPlatformId(),types:o.getSelectedTypes(),extensions:o.getSelectedExtensions(),template:n.template};return p.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},delete p.intent,delete p.authored,p.select_predicate=p.select_predicate.filter((function(e,t,i){return i.indexOf(e)===t})),a.data=JSON.stringify(p),a.onTimeout=a.onTimeout||a.onFailure,r.executeRequest(l,a)};return s?a():new Promise(function(e,i){t.retrieveAndSetSC().then((function(){a().then(e)}))}.bind(this))},expandv2DBprogressive:function(r){let a=p;var l=r.FBIProxy;r.version;for(var d={},c=[],u=0;u<r.pathIds.length;u++){var m=r.pathIds[u][0];void 0===d[m]&&(d[m]=[],c.push(m)),d[m].push(r.pathIds[u])}var f=-1;r.data.expandLevel&&(f=parseInt(r.data.expandLevel));var g=!1;r.data.prodConfigSupportInAuth&&(g=r.data.prodConfigSupportInAuth);let v="Expand-Level-"+(-1===f?"All":f)+"-"+t.getRequestLabel();var b=r.batch?r.batch:function(e){for(var t={expands:[]},i=e.pathsWithRoot,n=e.expandLevel,o=Object.keys(i),s=e.queryLabel,r=0;r<o.length;r++){for(var a=i[o[r]],l=[],d=0;d<a.length;d++)l.push({physical_id_path:a[d]});var c=e.FBIProxy.getFilterSpec(o[r],{V2:{prefixPathArray:l,appQueryObj:{keep:'((typecode:0 OR typecode:1) AND (ds6w_58_globaltype:"ds6w:Document" OR ds6w_58_globaltype:"ds6w:Part"))  OR (typecode:2 AND NOT (flattenedtaxonomies:"reltypes/XCADBaseDependency"))'}}}),p=h(l,n);Array.isArray(c.aggregation_processors)&&c.aggregation_processors.length>0&&(p=p?p.concat(c.aggregation_processors):c.aggregation_processors),t.expands.push({label:s,root:{physical_id:o[r]},filter:c.filter,aggregation_processors:p})}return t}({queryLabel:v,pathsWithRoot:d,expandLevel:f,FBIProxy:l});let S=o.createOutputsRequest("expandV2"),w={};w.select_object=S.select_object.slice(),w.select_relation=S.select_relation.slice();let y=["urlstream|thumbnail|2dthb|allrefs","icons"];var _;S.hits&&(y=S.hits.predefined_computation),w.hits={predefined_computation:y},!0===i.getSetting("pgpFromServer")&&(_=["show","hide"],w.select_pgp=_,w.select_object&&-1===w.select_object.indexOf("bo.pgpshowextension.V_PGP_Show")&&w.select_object.push("bo.pgpshowextension.V_PGP_Show"),w.select_object&&-1===w.select_object.indexOf("cestamp")&&w.select_object.push("cestamp"),w.select_relation&&-1===w.select_relation.indexOf("ro.pgpshowextension.V_PGP_Show")&&w.select_relation.push("ro.pgpshowextension.V_PGP_Show"),w.select_relation&&-1===w.select_relation.indexOf("cestamp")&&w.select_relation.push("cestamp"),w.select_relation&&!w.select_relation.includes("ro.plminstance.v_treeorder")&&w.select_relation.push("ro.plminstance.v_treeorder"));var D=n.getFetchAttribute();w.select_object=w.select_object.concat(D),w.select_object=w.select_object.filter((function(e,t,i){return i.indexOf(e)===t}));let C,P={batch:b,outputs:w},I="Expand-Level-"+(-1===f?"All":f)+"-"+t.getRequestLabel();i.getSetting("authoringFilterEnabled")&&1===b.expands.length&&g&&(C=s.validateFIlters(b.expands[0]));let x={source:"cstorage",root_path_physicalid:r.pathIds.slice(),expand_iter:r.data.expandLevel,label:I,select_bo:[],select_rel:[],compute_select_bo:["icon","thumbnail_2d"],select_pgp:["Show","Hide"],types:o.getSelectedTypes(),extensions:o.getSelectedExtensions()};r.withOccResponse&&(x.format="entity_relation_occurrence"),C&&C.isValid&&(C.config_filter&&(x.config_filter=C.config_filter),C.configCompiledForm&&(x.configCompiledForm=C.configCompiledForm)),x.static_mapping=i.getSetting("staticMappingEnabled"),x.select_bo=S.select_object.slice(),x.select_rel=S.select_relation.slice();D=n.getFetchAttribute();x.select_bo=x.select_bo.concat(D),x.select_bo&&(x.select_bo.includes("bo.pgpshowextension.V_PGP_Show")||x.select_bo.includes("bo.PGPShowExtension.V_PGP_Show")||x.select_bo.push("bo.PGPShowExtension.V_PGP_Show")),x.select_rel&&(x.select_rel.includes("ro.pgpshowextension.V_PGP_Show")||x.select_rel.includes("ro.PGPShowExtension.V_PGP_Show")||x.select_rel.push("ro.PGPShowExtension.V_PGP_Show"),x.select_rel.includes("ro.plminstance.V_treeorder")||x.select_rel.push("ro.plminstance.V_treeorder")),x.select_bo=x.select_bo.filter((function(e,t,i){return i.indexOf(e)===t})),x.select_rel=x.select_rel.filter((function(e,t,i){return i.indexOf(e)===t}));var A=t.getSecurityContext(),E=e.get3DSpaceURL()+a.url+"?tenant="+e.getPlatformId();A&&(E+="&SecurityContext="+encodeURIComponent(A));let O={cv:P,db:x};return this.executeRequestPromise(E,{method:a.verb,headers:{Accept:"application/json","Content-Type":"application/json"},data:O,timeout:r.timeout})},expandv2DB:function(i){i.FBIProxy;let s=c;var r=-1;i.data.expandLevel&&(r=parseInt(i.data.expandLevel));let a="Expand-Level-"+(-1===r?"All":r)+"-"+t.getRequestLabel(),l=(i.version,{source:"cstorage",root_path_physicalid:i.pathIds.slice(),unescape_slashes_in_attribute_values:!0,expand_iter:i.data.expandLevel,label:a,select_bo:[],select_rel:[],compute_select_bo:["icon","thumbnail_2d"],select_pgp:["Show","Hide"],types:o.getSelectedTypes(),extensions:o.getSelectedExtensions()});var d=o.createOutputsRequest("expandV2");l.select_bo=d.select_object.slice(),l.select_rel=d.select_relation.slice();var p=n.getFetchAttribute();l.select_bo=l.select_bo.concat(p),l.select_bo&&(l.select_bo.includes("bo.pgpshowextension.V_PGP_Show")||l.select_bo.includes("bo.PGPShowExtension.V_PGP_Show")||l.select_bo.push("bo.PGPShowExtension.V_PGP_Show")),l.select_rel&&(l.select_rel.includes("ro.pgpshowextension.V_PGP_Show")||l.select_rel.includes("ro.PGPShowExtension.V_PGP_Show")||l.select_rel.push("ro.PGPShowExtension.V_PGP_Show"),l.select_rel.includes("ro.plminstance.V_treeorder")||l.select_rel.push("ro.plminstance.V_treeorder")),l.select_bo=l.select_bo.filter((function(e,t,i){return i.indexOf(e)===t})),l.select_rel=l.select_rel.filter((function(e,t,i){return i.indexOf(e)===t}));var u=t.getSecurityContext(),h=e.get3DSpaceURL()+s.url+"?tenant="+e.getPlatformId();return u&&(h+="&SecurityContext="+u),this.executeRequestPromise(h,{method:s.verb,headers:{Accept:"application/json","Content-Type":"application/json"},data:l,timeout:i.timeout})},read:function(t){var i=t;let n=u;var o=e.get3DSpaceURL()+n.url+"?tenant="+e.getPlatformId();return i.method=u.verb,i.headers={Accept:"application/json","Content-Type":"application/json"},this.appendCfgIf(i),i.cache=-1,delete i.ids,i.onTimeout=i.onTimeout||i.onFailure,this.executeRequestPromise(o,i)}},m})),define("DS/PADServices/utils/R2VProperties",["DS/PADServices/utils/PlatformURL","DS/PADServices/utils/DictionaryAccess","DS/Utilities/DateUtils","DS/PADServices/ws/WSAccess","DS/PADServices/views/private/TilesViewUtils","text!DS/PADServices/assets/init/r2vpropertiesCfg.json"],(function(e,t,i,n,o,s){"use strict";const r=JSON.parse(s);function a(){return"object"==typeof a.instance?a.instance:(a.instance=this,this)}return a.prototype.getPropModel=async function(e){return new Promise(((i,s)=>{t.initNLS().then((()=>{let t;e.type;t=new Promise((t=>{n.fetchFeatureStates({serviceId:e.serviceId,ids:[e.objectId]}).then((e=>{"0"===e.infos.code&&e.result&&t(e.result)}))})),t.then((e=>{e[0].serviceId="r2vsurvey",o.buildNodeOptions(e[0]).then((e=>{var t=this.__setPropModels(e);i(t)}))}))}))}))},a.prototype.__setPropModels=function(n){if("{}"===JSON.stringify(n))throw new Error("Invalid arguments sent to R2VProperties.prototype.__setPropModels");let o=require("DS/EditPropWidget/models/EditPropModel"),s=require("DS/EditPropWidget/models/EditPropAttributeModel"),a=new o({metatype:require("DS/EditPropWidget/constants/EditPropConstants").METATYPE_BUS,objectId:n.resourceid,source:"r2vsurvey",tenant:e.getPlatformId()});n.surveyId&&a.set("surveyId",n.surveyId),n.soiid&&a.set("soiid",n.soiid);let l={},d=new s;d.set("name","ds6w:label"),d.set("path","ds6w:label"),d.set("label",t.getAttNameNLS("ds6w:label")),-1!==r.positionInUI.indexOf("ds6w:label")&&d.set("positionUI",r.positionInUI.indexOf("ds6w:label")+""),d.set("value",n["ds6w:label"]),d.set("sectionIdentityCard","title"),l["ds6w:label"]=d,l["ds6w:what/ds6w:type_value"]=n.type,n.grid||(n.grid={owner:n.owner,"ds6w:responsible":n["ds6w:responsible"],"ds6w:description":n["ds6w:description"],"ds6w:modified":n["ds6w:modified"],"ds6w:type":n["ds6w:type"],"ds6w:created":n["ds6w:created"],"r2v:fsEffectivityDate":n.effectivityDate,"r2v:computeParameters":n.parameters,"ds6w:status":n["ds6w:status"]},n.type=n["ds6w:type"],n.icon=n["ds6w:icon"],n.thumbnail=n["ds6w:previewURL"]);let c=Object.keys(n.grid);for(const e of c)if("owner"!==e&&-1===r.removedAttribues.indexOf(e)&&-1===e.indexOf("-original")){let o=new s;switch(o.set("name",e),o.set("path",e),o.set("label",t.getAttNameNLS(e)),-1!==r.positionInUI.indexOf(e)&&o.set("positionUI",r.positionInUI.indexOf(e)+""),e){case"ds6w:created":o.set("sectionIdentityCard","date");case"ds6w:modified":case"r2v:startedAtTime":case"r2v:endedAtTime":case"r2v:firstObsDate":case"r2v:lastObsDate":case"r2v:fsEffectivityDate":let t=new Date(n.grid[e]);var p=i.formatDateToString(t);o.set("value",p);break;case"ds6w:responsible":o.set("type","person"),o.set("sectionIdentityCard","ownerName"),o.set("valueDB",n.grid.owner),o.set("value",n.grid[e]);break;case"ds6w:type":o.set("urlIcon",n.icon),o.set("valueDB",n.type),o.set("value",n.grid[e]);break;default:o.set("value",n.grid[e])}l[e]=o}return a.set(l),a.set("previewUrl",n.thumbnail),a.set("preview_url",n.thumbnail),a.set("type_icon_url",n.icon),a.set("isTransient",!0),a},new a})),define("DS/PADServices/ws/WSIndexCommon",["DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/settings/AppSettings","DS/PADServices/views/private/TilesViewUtils","DS/PADServices/utils/SGIUtils"],(function(e,t,i,n,o,s){"use strict";function r(e,t){var i=void 0;return t>-1&&(i=[{truncate:{max_distance_from_prefix:t,prefix_filter:{prefix_path:e}}}]),i}const a='((typecode:0 OR typecode:1) AND ([ds6w:globaltype]:"ds6w:Document" OR [ds6w:globaltype]:"ds6w:Part"))  OR (typecode:2 AND NOT (flattenedtaxonomies:"reltypes/XCADBaseDependency"))';function l(){}return l.prototype.fetch=function(r){return new Promise(async function(a,l){let d=r.data||{},c="fetch-"+t.getRequestLabel();r.labelPrefix&&(c=r.labelPrefix+c);let p=Object.assign({label:c,locale:t.getLang(),tenant:e.getPlatformId(),unescape_slashes_in_attribute_values:!0},d);if(void 0!==r.pids&&(p.physicalid=r.pids),!0===r.autoAttSelection&&(p=Object.assign(p,i.createOutputsRequest("fetch"))),!0===n.getSetting("pgpFromServer")&&p.select_predicate&&-1===p.select_predicate.indexOf("bo.pgpshowextension.V_PGP_Show")&&p.select_predicate.push("bo.pgpshowextension.V_PGP_Show"),!0===r.autoAttSelection){const e=o.getFetchAttribute();p.select_predicate=p.select_predicate.concat(e),p.select_predicate=p.select_predicate.filter((function(e,t,i){return i.indexOf(e)===t}))}let u=s.getAdditionalParameters(p.physicalid,p);!0===n.getSetting("activateUnits")&&(p.select_uom=p.select_predicate);const h=t.getSecurityContext();let m=e.get3DSpaceURL()+"/cvservlet/fetch/v2?tenant="+e.getPlatformId()+u,f={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},timeout:r.timeout?r.timeout:void 0,data:JSON.stringify(p),onComplete:a,onFailure:l};h&&(m+="&SecurityContext="+h),this.executeRequest(m,f)}.bind(this))},l.prototype.findInCtx=function(e){return console.warn("/! WSAccess.findInCtx:: Internal and Obsolete Code"),Promise.reject()},l.prototype.findInCtxV2=function(i){return new Promise(async function(o,r){let a={},l=t.getSecurityContext(),d="",c=!1;s.isSGIEnv()&&(d=s.getAdditionalParameters(i.data.rootPhID),c=s.isFeatureNavigationAvailable());let p=e.get3DSpaceURL()+"/cvservlet/progressiveexpand/v2?output_format=cvjson&tenant="+e.getPlatformId()+d;const u=this._buildPrefixPath(i.data.rootPhID);i.data.max_count_path&&(i.data.max_count_path=parseInt(i.data.max_count_path),i.data.maxOutputPaths===parseInt(n.getSetting("maxPathsForSearch"))&&(i.data.max_count_path=i.data.max_count_path+1));const h=i.FBIProxy.GetFilterSpec(i.data.rootPhID[0],{V2:{prefixPathArray:u,find_in_context:i.data.ftsString}}).filter,m=[{truncate:{max_distance_from_prefix:0,compute_matching_subpaths_lengths:1,match_only_refs:1,sequence_filter:{sequence:[{uql:i.data.ftsString,uql_prefix_handler:"starPH"}]}}}];let f;!0===n.getSetting("pgpFromServer")&&(f=["show","hide"],i.data.select_bo&&-1===i.data.select_bo.indexOf("bo.pgpshowextension.V_PGP_Show")&&i.data.select_bo.push("bo.pgpshowextension.V_PGP_Show"),i.data.select_rel&&-1===i.data.select_rel.indexOf("ro.pgpshowextension.V_PGP_Show")&&i.data.select_rel.push("ro.pgpshowextension.V_PGP_Show"));const g={batch:{expands:[{label:"FindInCtxV2_"+t.getRequestLabel(),parameters:void 0!==i.data.max_count_path?{limit_max_path:i.data.max_count_path+1}:void 0,root:{physical_id:i.data.rootPhID[0]},filter:h,aggregation_processors:m,shatteredExpand:!!c||void 0}]},outputs:{select_object:i.data.select_bo,select_relation:i.data.select_rel,select_pgp:f,hits:{predefined_computation:["urlstream|thumbnail|2dthb|allrefs","icons"]},matching_lengths:1}};return s.isSupplemental([i.data.rootPhID])?(s.replaceOrRemoveAtt(g.outputs,"ds6w:i3dx"),g.outputs.hits.predefined_computation.push("ds6w:cpid")):s.isFeatureNavigationAvailable()&&s.addPredicates(g.outputs),!0===n.getSetting("activateGraph")&&(g.batch.expands[0].graph=n.getSetting("structureGraph")),i.format?g.outputs.format=i.format:g.outputs.format="entity_relation_occurrence",!0===n.getSetting("activateUnits")&&(g.outputs.hits.with_units=1),a.onComplete=o,a.onFailure=r,a.onTimeout=function(){o({timeoutOccurs:!0})},a.timeout=i.timeout?i.timeout:void 0,a.method="POST",a.headers={Accept:"application/json","Content-Type":"application/json"},a.data=JSON.stringify(g),a.wsName="findInCtx",a.txKey=i.data.rootPhID[0],l&&(p+="&SecurityContext="+l),this.executeRequest(p,a)}.bind(this))},l.prototype.selectFromTagger=function(i){return new Promise(async function(o,r){var a={},l=t.getSecurityContext();let d="",c=!1;s.isSGIEnv()&&(d=s.getAdditionalParameters([i.data.rootPhID]),c=s.isFeatureNavigationAvailable());let p=e.get3DSpaceURL()+"/cvservlet/progressiveexpand/v2?output_format=cvjson&tenant="+e.getPlatformId()+d,u=this._buildPrefixPath(i.data.rootPhID);i.data.max_count_path&&(i.data.max_count_path=parseInt(i.data.max_count_path),i.data.max_count_path===parseInt(n.getSetting("maxPathsForSearch"))&&(i.data.max_count_path=i.data.max_count_path+1));let h=i.FBIProxy.GetFilterSpec(i.data.rootPhID,{V2:{prefixPathArray:u,tagger_select:i.data.taggerSelect}}).filter;const m={truncate:i.FBIProxy.buildSpecFromAppIntent({V2:{tagger_select:i.data.taggerSelect}})};m.truncate.max_distance_from_prefix=0,m.truncate.compute_matching_subpaths_lengths=1,m.truncate.match_only_refs=1;var f,g=[m];!0===n.getSetting("pgpFromServer")&&(f=["show","hide"],i.data.select_bo&&-1===i.data.select_bo.indexOf("bo.pgpshowextension.V_PGP_Show")&&i.data.select_bo.push("bo.pgpshowextension.V_PGP_Show"),i.data.select_rel&&-1===i.data.select_rel.indexOf("ro.pgpshowextension.V_PGP_Show")&&i.data.select_rel.push("ro.pgpshowextension.V_PGP_Show"));var v={batch:{expands:[{label:"SelectFromTaggerV2_"+t.getRequestLabel(),parameters:void 0!==i.data.max_count_path?{limit_max_path:i.data.max_count_path}:void 0,root:{physical_id:i.data.rootPhID},filter:h,aggregation_processors:g,shatteredExpand:!!c||void 0}]},outputs:{select_object:i.data.select_bo,select_relation:i.data.select_rel,select_pgp:f,hits:{predefined_computation:["urlstream|thumbnail|2dthb|allrefs","icons"]},matching_lengths:1}};return i.format?v.outputs.format=i.format:v.outputs.format="entity_relation_occurrence",s.isSGIEnv()&&(s.isSupplemental([i.data.rootPhID])?(s.replaceOrRemoveAtt(v.outputs,"ds6w:i3dx"),v.outputs.hits.predefined_computation.push("ds6w:cpid")):s.isFeatureNavigationAvailable()&&s.addPredicates(v.outputs)),!0===n.getSetting("activateUnits")&&(v.outputs.hits.with_units=1),a.onComplete=o,a.onFailure=r,a.onTimeout=function(){o({timeoutOccurs:!0})},a.timeout=i.timeout?i.timeout:void 0,a.method="POST",a.headers={Accept:"application/json","Content-Type":"application/json"},a.data=JSON.stringify(v),a.wsName="selectFromTagger",a.txKey=i.data.rootPhID,l&&(p+="&SecurityContext="+l),this.executeRequest(p,a)}.bind(this))},l.prototype.getRootStats=function(i){return new Promise(async function(o,r){var l=i.data||{},d=i.filterBI;let c="",p=!1;s.isSGIEnv()&&(c=s.getAdditionalParameters([l.rootPhID]),p=s.isFeatureNavigationAvailable());var u=this._buildPrefixPath(l.rootPhID,l.root_path_physicalid);let h={V2:{prefixPathArray:u}},m=n.getSetting("activateGraph");!0!==m&&(h.V2.appQueryObj={keep:a});let f=d.getFilterSpec(l.rootPhID,h);var g=f?f.filter:void 0,v=[{truncate:{max_distance_from_prefix:0,prefix_filter:{prefix_path:u}}}],b={batch:{expands:[{label:"GetRootStats-"+t.getRequestLabel(),root:{physical_id:l.rootPhID},parameters:{limit_max_path:i.maxLeaves},filter:g,graph:!0===m?n.getSetting("structureGraph"):void 0,aggregation_processors:[{synthesis:{name:"ProgressiveExpand_FlatSynthesis",mode:"flat"}},{synthesis:{name:"ProgressiveExpand_OccSynthesis",mode:"occurence"}},{synthesis:{name:"ProgressiveExpand_LeafSynthesis",mode:"tree_leaf",synthesis_only:1}}],shatteredExpand:!!p||void 0},{label:"GetRootStats-0-"+t.getRequestLabel(),root:{physical_id:l.rootPhID},filter:{prefix_filter:{prefix_path:u}},graph:!0===m?n.getSetting("structureGraph"):void 0,aggregation_processors:v,shatteredExpand:!!p||void 0}]},outputs:{select_object:l.select_bo?l.select_bo:["physicalid"],synthesis:["ProgressiveExpand_FlatSynthesis","ProgressiveExpand_OccSynthesis","ProgressiveExpand_LeafSynthesis"]}},S=t.getSecurityContext(),w=e.get3DSpaceURL()+"/cvservlet/progressiveexpand/v2?output_format=cvjson&tenant="+e.getPlatformId()+c,y={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},timeout:i.timeout?i.timeout:"30000",data:JSON.stringify(b),onComplete:o,onFailure:r,onTimeout:function(){o({timeoutOccurs:!0})},wsName:"getRootStats",txKey:i.data.rootPhID};S&&(w+="&SecurityContext="+S),this.executeRequest(w,y)}.bind(this))},l.prototype.expandv2=function(l){return new Promise(async function(d,c){let p,u=l.FBIProxy,h=(l.version,""),m=!1,f={},g=[];for(let e=0;e<l.pathIds.length;e++){let t=l.pathIds[e][0];void 0===f[t]&&(f[t]=[],g.push(t)),f[t].push(l.pathIds[e])}if(s.isSGIEnv()){h=s.getAdditionalParameters(g);(!0===l.isPivotObject||l.isInternalJSONObj||l.addPathSGIEnv&&!l.isPivotObject||l.hasFilter||l.hasInternalJSONObject||l.forceSGIShattered)&&(m=s.isFeatureNavigationAvailable())}let v=-1;l.data.expandLevel&&(v=parseInt(l.data.expandLevel,10));let b=`Expand-Level-${-1===v?"All":v}-${t.getRequestLabel()}`,S=l.batch?l.batch:function(e){var t={expands:[]},i=e.pathsWithRoot,o=e.expandLevel,s=Object.keys(i),l=e.queryLabel;console.groupCollapsed("Batch for ["+l+"]"),console.log("Number of Roots "+s.length);for(var d=0;d<s.length;d++){console.log("Root["+d+"] with id ["+s[d]+"]");var c=i[s[d]];console.log("Number of Paths "+c.length);for(var p=[],u=0;u<c.length;u++)p.push({physical_id_path:c[u]});let f={V2:{prefixPathArray:p}},g=n.getSetting("activateGraph");var h;!0!==g&&(f.V2.appQueryObj={keep:a}),h=(e.readOnlyRootsFilterSpec?e.readOnlyRootsFilterSpec.get(s[d]):null)||e.FBIProxy.getFilterSpec(s[d],{V2:{prefixPathArray:p}});var m=r(p,o);Array.isArray(h.aggregation_processors)&&h.aggregation_processors.length>0&&(m=m?h.aggregation_processors.concat(m):h.aggregation_processors);let v={label:l,root:{physical_id:s[d]},filter:h.filter,aggregation_processors:m,shatteredExpand:!!e.shattered||void 0};!0===g&&(v.graph=n.getSetting("structureGraph")),t.expands.push(v)}return console.groupEnd(),t}({queryLabel:b,pathsWithRoot:f,expandLevel:v,FBIProxy:u,shattered:m,readOnlyRootsFilterSpec:l.data.readOnlyRootsFilterSpec});const w=i.createOutputsRequest("expandV2");let y;!0===n.getSetting("pgpFromServer")&&(y=["show","hide"],w.select_pgp=y,w.select_object&&-1===w.select_object.indexOf("bo.pgpshowextension.V_PGP_Show")&&w.select_object.push("bo.pgpshowextension.V_PGP_Show"),w.select_relation&&-1===w.select_relation.indexOf("ro.pgpshowextension.V_PGP_Show")&&w.select_relation.push("ro.pgpshowextension.V_PGP_Show")),l.select_relation&&-1===w.select_relation.indexOf("ro.plminstance.v_treeorder")&&(w.select_relation=w.select_relation.concat(l.select_relation)),!0===l.withOccResponse&&(w.format=n.getSetting("occDelta")?"entity_relation_occurrence_delta":"entity_relation_occurrence");const _=o.getFetchAttribute();w.select_object=w.select_object.concat(_),w.select_object=w.select_object.filter((function(e,t,i){return i.indexOf(e)===t})),s.isSGIEnv()&&(s.isSupplemental(g)?(s.replaceOrRemoveAtt(w,"ds6w:i3dx"),w.hits.predefined_computation.push("ds6w:cpid")):s.isFeatureNavigationAvailable()&&s.addPredicates(w)),!0===n.getSetting("activateUnits")&&(w.hits.with_units=1),p={batch:S,outputs:w};let D=t.getSecurityContext(),C=`${e.get3DSpaceURL()}/cvservlet/progressiveexpand/v2?output_format=cvjson&tenant=${e.getPlatformId()}${h}`,P={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},timeout:l.timeout?l.timeout:void 0,data:JSON.stringify(p),onComplete:d,onFailure:c,onTimeout:function(){d({timeoutOccurs:!0})}};D&&(C+="&SecurityContext="+D),this.executeRequest(C,P)}.bind(this))},l.prototype.getGroupingNodes=async function(o){return new Promise(((s,r)=>{for(var a=o.data||{},l=o.filterBI,d={},c=[],p=0;p<o.pathIds.length;p++){var u=o.pathIds[p][0];void 0===d[u]&&(d[u]=[],c.push(u)),d[u].push(o.pathIds[p])}a.rootPhID=c[0];var h={};let m=[],f=o.grouping.groups,g="GetGroupingNodes-"+t.getRequestLabel();m.push([a.rootPhID]),h=l.getGroupingSpec(m,[f[0]],g,!1);var v=i.createOutputsRequest("expandV2");h.outputs=Object.assign(h.outputs,v);var b=t.getSecurityContext(),S=e.get3DSpaceURL()+"/cvservlet/progressiveexpand/v2?output_format=cvjson&tenant="+e.getPlatformId(),w={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},timeout:o.timeout?o.timeout:"30000",data:JSON.stringify(h),onComplete:s,onFailure:r,onTimeout:function(){s({timeoutOccurs:!0})},wsName:"getGroupingNodes",txKey:1===c.length?c[0]:void 0};!0===n.getSetting("splitActivation")&&(S+="&enable_mono_sixw=false"),b&&(S+="&SecurityContext="+b),this.executeRequest(S,w)}))},l.prototype.getBSDGroupOnInstances=async function(o){return new Promise(((r,a)=>{o.data;var l=o.filterBI;let d="",c=!1;s.isSGIEnv()&&(d="&redirectQueryToSGI=true",d+="&expandIndexUnit=3DSpaceTransformedForIFC",c=!0);for(var p=[],u=0;u<o.pathIds.length;u++){var h=o.pathIds[u][0];-1===p.indexOf(h)&&p.push(h)}var m={};let f=o.pathIds,g=o.predicate,v=""+t.getRequestLabel();m=l.getGroupingBSDSpec(f,g,v);var b=i.createOutputsRequest("expandV2");m.outputs=Object.assign(m.outputs,b),m.outputs.format="entity_relation_occurrence",m.outputs.select_relation.includes("ro.plminstance.V_treeorder")||m.outputs.select_relation.push("ro.plminstance.V_treeorder");var S=t.getSecurityContext(),w=e.get3DSpaceURL()+"/cvservlet/progressiveexpand/v2?output_format=cvjson&tenant="+e.getPlatformId()+d,y={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},timeout:o.timeout?o.timeout:"30000",data:JSON.stringify(m),onComplete:r,onFailure:a,onTimeout:function(){r({timeoutOccurs:!0})},wsName:"getGroupingNodes",txKey:1===p.length?p[0]:void 0};!0===n.getSetting("splitActivation")&&(w+="&enable_mono_sixw=false"),S&&(w+="&SecurityContext="+S),this.executeRequest(w,y)}))},l.prototype.expandBSNode=async function(s){return new Promise(((r,a)=>{var l,d=s.FBIProxy?s.FBIProxy:s.filterBI;s.version;for(var c={},p=[],u=0;u<s.pathIds.length;u++){var h=s.pathIds[u][0];void 0===c[h]&&(c[h]=[],p.push(h)),c[h].push(s.pathIds[u])}s.data.expandLevel&&parseInt(s.data.expandLevel);var m=d.getExpandBSDSpec(s.pathIds,s.bsGrp,"BSD_Expand_"+t.getRequestLabel());let f,g=i.createOutputsRequest("expandV2");!0===n.getSetting("pgpFromServer")&&(f=["show","hide"],g.select_pgp=f,g.select_object&&-1===g.select_object.indexOf("bo.pgpshowextension.V_PGP_Show")&&g.select_object.push("bo.pgpshowextension.V_PGP_Show"),g.select_relation&&-1===g.select_relation.indexOf("ro.pgpshowextension.V_PGP_Show")&&g.select_relation.push("ro.pgpshowextension.V_PGP_Show"));var v=o.getFetchAttribute();g.select_object=g.select_object.concat(v),g.select_relation.includes("ro.plminstance.V_treeorder")||g.select_relation.push("ro.plminstance.V_treeorder"),g.select_object=g.select_object.filter((function(e,t,i){return i.indexOf(e)===t})),!0===s.withOccResponse&&(g.format=n.getSetting("occDelta")?"entity_relation_occurrence_delta":"entity_relation_occurrence"),!0===n.getSetting("activateUnits")&&(g.hits.with_units=1),l={batch:m.batch,outputs:g};var b=t.getSecurityContext(),S=e.get3DSpaceURL()+"/cvservlet/progressiveexpand/v2?output_format=cvjson&tenant="+e.getPlatformId(),w={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},timeout:s.timeout?s.timeout:void 0,data:JSON.stringify(l),onComplete:r,onFailure:a,onTimeout:function(){r({timeoutOccurs:!0})},wsName:"expandBSDNode",txKey:1===p.length?p[0]:void 0};b&&(S+="&SecurityContext="+b),this.executeRequest(S,w)}))},l.prototype.expandGroupingNodeV2=async function(s){return new Promise(((r,a)=>{var l=s.FBIProxy?s.FBIProxy:s.filterBI;s.version;let d,c={},p=[];for(let e=0;e<s.pathIds.length;e++){const t=s.pathIds[e][0];void 0===c[t]&&(c[t]=[],p.push(t)),c[t].push(s.pathIds[e])}var u={groupingIntent:s.groupingFilter};u.root_path_physicalid=c[p[0]];var h,m=l.getExpandSpec(p[0],u,!1),f=i.createOutputsRequest("expandV2");!0===n.getSetting("pgpFromServer")&&(h=["show","hide"],f.select_pgp=h,f.select_object&&-1===f.select_object.indexOf("bo.pgpshowextension.V_PGP_Show")&&f.select_object.push("bo.pgpshowextension.V_PGP_Show"),f.select_relation&&-1===f.select_relation.indexOf("ro.pgpshowextension.V_PGP_Show")&&f.select_relation.push("ro.pgpshowextension.V_PGP_Show"));var g=o.getFetchAttribute();f.select_object=f.select_object.concat(g),f.select_object=f.select_object.filter((function(e,t,i){return i.indexOf(e)===t})),!0===s.withOccResponse&&(f.format=n.getSetting("occDelta")?"entity_relation_occurrence_delta":"entity_relation_occurrence"),d={batch:m.batch,outputs:f};var v=t.getSecurityContext(),b=e.get3DSpaceURL()+"/cvservlet/progressiveexpand/v2?output_format=cvjson&tenant="+e.getPlatformId(),S={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},timeout:s.timeout?s.timeout:void 0,data:JSON.stringify(d),onComplete:r,onFailure:a,onTimeout:function(){r({timeoutOccurs:!0})},wsName:"expandGroupingNodeV2",txKey:1===p.length?p[0]:void 0};v&&(b+="&SecurityContext="+v),this.executeRequest(b,S)}))},l.prototype.retrieveIcons=function(e){var t=this;return new Promise((function(i,n){if(e.tmpParams){var o={pids:e.tmpParams.rscIds,data:{select_predicate:["resourceid"].concat(e.tmpParams.ATTICON),select_file:["icon","thumbnail_2d"]}};t.fetch(o).then((function(e){var t=[];if((e="string"==typeof e?JSON.parse(e):e).results&&e.results.length>0)for(var n=0;n<e.results.length;n++){for(var o={},s=0;s<e.results[n].attributes.length;s++)o[e.results[n].attributes[s].name]=e.results[n].attributes[s].value;t.push(o)}i({infos:{},results:t})}))}}))},l.prototype.search=async function(i){var n=i||{},o=Object.assign({label:"3DSearch-"+t.getRequestLabel()+n.qryLabel?"-"+n.qryLabel:"",locale:t.getLang(),tenant:e.getPlatformId(),with_synthesis:!1,select_exclude_synthesis:["ds6w:what/ds6w:topic"],order_by:"desc",order_field:"relevance"},n),s=e.getPlatformURL("3DSearch")+"/search?tenant="+e.getPlatformId(),r={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},timeout:i.timeout?i.timeout:void 0,data:JSON.stringify(o)};return this.executeRequestPromise(s,r,"fedsearch/search")},l.prototype.isSGIAvailable=async function(){let i=`${e.getPlatformURL("3DSpace")}/cvservlet/isalive/isTenantDeclaredAsEnabledInSGIDB?tenant=${e.getPlatformId()}`,n=t.getSecurityContext();return n?i+="&SecurityContext="+n:(await t.retrieveAndSetSC(),n=t.getSecurityContext(),n?i+="&SecurityContext="+n:console.error("Security Context is not available")),this.executeRequestPromise(i,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}},"cvservlet/isSGI")},l.prototype._buildPrefixPath=function(e,t){let i=null,n=0;if(t&&t.length)for(i=[],n=0;n<t.length;n++)i.push({physical_id_path:t[n]});else i=Array.isArray(e)?[{physical_id_path:e}]:[{physical_id_path:[e]}];return i},l})),define("DS/PADServices/views/private/ResponsiveRootList",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/GlobalUtils","DS/PADUtils/Utility","DS/PADServices/utils/CompassUtils","DS/PADServices/views/private/TilesViewUtils","DS/CollectionView/ResponsiveLargeTilesCollectionView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/WebappsUtils/WebappsUtils","DS/Utilities/Utils"],(function(e,t,i,n,o,s,r,a,l,d,c,p){"use strict";function u(e){var n=this;this._broadcastSelect=!0,this._roots2add=[],this._root2select=[],this.elements={},this.elements.container=UWA.createElement("div",{class:"rootLst-main"}),this.elements.noRoot=document.createElement("div"),this.elements.noRoot.innerHTML=t.rootLst.noRoot,this.elements.noRoot.classList.add("no-root"),this.elements.container.appendChild(this.elements.noRoot),this.options={grid:null,model:null,HasFilter:void 0,getCtxForSharing:void 0},this.options.dgvOptions={useDragAndDrop:!0,selectionBehavior:{unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1,canInteractiveMultiselectWithCheckboxClick:!0},allowUnsafeHTMLContent:!0};var o=this.options.grid=new a(this.options.dgvOptions);o.name="resposiverootlist",o.onStatusbarIconPointerDown=function(e){var t=e.cellInfos,i=e.clickedIconIndex,o=t?t.cellModel:void 0;if(0===i)n._removeTile({tile_id:o.options.resourceid});else console.warn("PADResponsiveRootList: Unknown Icon")},o.getContent().addEventListener("dragover",(function(e){return e.preventDefault(),e.stopPropagation(),!1})),o.getContent().addEventListener("drop",this._onDropBlank.bind(this)),o.onContextualEvent=this.__onContextualEvent(),o.onDragStartCell=this.__onDragStartCell.bind(this),o.getCustomTooltip=r.getTooltip;this.options.model=new l({shouldAcceptDrag:function(){return!1}}),this.options.model.id="rootListModel",this.options.model.getXSO().onPostAdd((function(e){if(n._broadcastSelect){var t=n.options.model.getSelectedNodes().map((function(e){return e.options.resourceid}));i.publish({event:"ENXModel/Root/select",data:{tile_ids:t}})}})),this.options.model.getXSO().onPostRemove((function(e){if(n._broadcastSelect){var t=n.options.model.getSelectedNodes().map((function(e){return e.options.resourceid}));i.publish({event:"ENXModel/Root/select",data:{tile_ids:t}})}})),this.options.model.getXSO().onEmpty((function(e){n._broadcastSelect&&i.publish({event:"ENXModel/Root/select",data:{tile_ids:[]}})})),o.model=this.options.model,o.getContent().inject(n.elements.container),i.subscribe({event:"ENXModel/Root/FBIProxy"},(function(e){n.options.HasFilter=e.HasFilter,n.options.getCtxForSharing=e.getCtxForSharing})),i.subscribe({event:"ENXModel/Root/manage"},this._manageRoot.bind(this)),i.subscribe({event:"ENXModel/Root/sync"},this._syncTile.bind(this)),i.subscribe({event:"ENXModel/Root/remove"},this._removeTiles.bind(this)),i.subscribe({event:"ENXModel/Root/selectTile"},this.selectTile.bind(this)),i.subscribe({event:"ENXModel/Root/unselectTile"},this.unselectTile.bind(this)),i.subscribe({event:"ENXModel/Root/updateThumbnail"},this._updateRootThumbnail.bind(this))}function h(e,t,i){if(!0===i)e.options.statusbarIcons.push(t),e.options.statusbarIconsTooltips.push(t);else{const i=e.options.statusbarIcons.indexOf(t),n=e.options.statusbarIconsTooltips.indexOf(t);-1!==i&&e.options.statusbarIcons.splice(i,1),-1!==n&&e.options.statusbarIconsTooltips.splice(n,1)}}function m(e,t,i,n){r.toBeUpdated(e,t)&&(i.prepareUpdate(),this.__cloneNodeOpts(t.options).then((t=>{e.updateOptions(t),e.options.filtered=n,!0===e.options.filtered?h(e,"filter",!0):h(e,"filter",!1),i.pushUpdate(),this.options.grid.layout.invalidate()})))}return u.prototype.getContent=function(){return this.elements.container},u.prototype.getTabLabel=function(){return t.rootLst.rootLstLabel},u.prototype.setVisible=function(e){e?this.elements.container.removeAttribute("hidden"):this.elements.container.setAttribute("hidden","")},u.prototype.selectTile=function(e){this._broadcastSelect=!1;var t=this._search(e.data.nodeModel.getID());1===t.length?t[0].select():-1===this._root2select.indexOf(e.data.nodeModel.getID())&&this._root2select.push(e.data.nodeModel.getID()),this._broadcastSelect=!0},u.prototype.unselectTile=function(e){this._broadcastSelect=!1;var t=this._search(e.data.nodeModel.getID());1===t.length&&t[0].unselect(),this._broadcastSelect=!0},u.prototype.__cloneNodeOpts=function(e){return new Promise((i=>{if(1==e.clonedRootNode)i(e);else{var n={clonedRootNode:!0,resourceid:e.resourceid,i3dx:e.i3dx,cpid:e.cpid,serviceId:e.serviceId,label:UWA.String.escapeHTML(e.label),icons:UWA.clone(e.icons,!0),thumbnail:e.thumbnail?e.thumbnail:c.getWebappsAssetUrl("PADServices","icons/32/I_DefaultThumbnail.png"),statusbarIcons:["close"],statusbarIconsTooltips:[t.rootLst.removeRoot],children:null,isFiltered:e.isFiltered,type:e.type,isR2V:e.isR2V};e.badges&&(n.badges=UWA.clone(e.badges)),n.icons[0]&&n.icons[0].badges&&delete n.icons[0].badges.topRight,delete n.contextualMenu,n.contextualMenu=[{type:"SeparatorItem"}];let o=Promise.resolve(n);n.grid=UWA.clone(e.grid,!0),o=r.buildNodeOptions(n),o.then(i)}}))},u.prototype._addRootTiles=function(e,t){for(var i=0;i<e.length;i++){var n=e[i];!0===n.waiting4validation&&!0!==n.parseV2||this.__cloneNodeOpts(n).then((e=>{this._roots2add.push(e),this._realAddInWebUX(this._roots2add,t)}))}},u.prototype._updateRootThumbnail=function(e){var t=this.options.model.getRoots();if(t&&t.length>0)for(var i=0;i<t.length;i++)t[i].options.i3dx===e.i3dx&&t[i].updateOptions({thumbnail:e.thumbnail})},u.prototype._manageRoot=function(e){var t=void 0!==e.added_node?[e.added_node]:void 0!==e.added_nodes?e.added_nodes:[];if("boolean"!=typeof e.isremove||!0!==e.isremove){for(var i=[],n=[],o=0;o<t.length;o++){var s=t[o];s instanceof d||(s=new d(s));var r=!1,a=this.options.model.getRoots();if(a&&a.length>0)for(var l=0;l<a.length;l++)if(a[l].options.resourceid===s.options.resourceid){r=!0;break}r||n.push(this.__cloneNodeOpts(s.options).then((e=>{i.push(e),s.onSelect(this.selectTile.bind(this)),s.onUnselect(this.unselectTile.bind(this))})))}Promise.all(n).then((()=>{if(i.length){this._addRootTiles(i,e.onComplete);const t=this.elements.container.firstElementChild,n=this.elements.container.lastElementChild;t&&n&&(t.classList.contains("no-root")||n.classList.contains("no-root"))&&this.elements.container.removeChild(this.elements.noRoot)}}))}},u.prototype._syncTile=function(e){let t,i,n;if(e instanceof d){const o=e;if(!o.isRoot())return;let s=o.getID?o.getID():"FakeTreeNode";if(t=this._search(s),1===t.length){i=t[0],n=this.options.model;const e=o.options.filtered;m.call(this,i,o,n,e)}}else if(e.tileId&&(t=this._search(e.tileId),1===t.length))if(i=t[0],n=this.options.model,e.nodeOpts){e.nodeOpts.thumbnail||(e.nodeOpts.thumbnail=i.options.thumbnail),e.nodeOpts.label||(e.nodeOpts.label=i.options.label);let t=new d(e.nodeOpts);m.call(this,i,t,n,e.isFiltered)}else n.prepareUpdate(),"boolean"==typeof e.isFiltered&&(i.options.filtered=e.isFiltered,!0===i.options.filtered?h(i,"filter",!0):h(i,"filter",!1)),n.pushUpdate(),this.options.grid.layout.invalidate()},u.prototype._search=function(e){return this.options.model.search({match:function(t){if(t.nodeModel.options.resourceid===e)return!0}})},u.prototype._removeTiles=function(e){var t=!0===e.all?this._getAllIDs():Array.isArray(e.pids)?e.pids:[];if(t.length>500)this._removeTilesBatch({pids:t,noDispatch:e.noDispatch});else for(var i=0;i<t.length;i++)this._removeTile({tile_id:t[i],noDispatch:e.noDispatch})},u.prototype._removeTilesBatch=function(e){let t=this.options.model.getRoots().filter((function(t){return-1!==e.pids.indexOf(t.options.resourceid)}));var n=this;this.options.model.withTransactionUpdate((function(){for(let s=0;s<t.length;s++){let r=t[s];if(n.options.model.removeRoot(r),!0!==e.noDispatch){var o={tile_id:r.options.resourceid};i.publish({event:"ENXModel/Root/removeTile",data:o})}}}))},u.prototype._removeTile=function(e){var t=e.tile_id,n=this._search(t);if(1===n.length){var o=this;this.options.model.withTransactionUpdate((function(){o.options.model.removeRoot(n[0]);var s={tile_id:t};!0!==e.noDispatch&&i.publish({event:"ENXModel/Root/removeTile",data:s}),0===o.options.model.getRoots().length&&o.elements.container.appendChild(o.elements.noRoot)}))}},u.prototype._realAddInWebUX=p.debounce((function(e,t){var i=[];this.options.model.prepareUpdate(),i=e;var n=function(){i.length&&i[0].resolve&&i[0].resolve()};let s=this.options.model.getRoots().map((function(e){return e.options.resourceid})),r=e.filter((function(e){return-1===s.indexOf(e.resourceid)})),a=r.map((function(e){return e.resourceid})),l=a.filter((function(e,t,i){return i.indexOf(e)===t})),d=r;if(l.length<a.length){let e={};d=r.filter((function(t){let i=t.resourceid;if(!e[i]&&-1!==l.indexOf(i))return e[i]=!0,!0}))}if(0===(e=d).length)return void n();let c=this,p=o.createBatchStepper(e,500,200,(function(e,t){c.options.model.addRoot(e),t()}),(function(){n(),c._roots2add.length=0,c._broadcastSelect=!1;let e=c.options.model.getRoots().filter((function(e){return-1!==l.indexOf(e.options.resourceid)}));for(let t=0;t<e.length;t++){let i=e[t];i.options.selectTile&&i.select(),i.options.isFiltered?h(i,"filter",!0):!1===i.options.isFiltered&&h(i,"filter",!1)}c.options.model.pushUpdate(),c._broadcastSelect=!0,"function"==typeof t&&t()}));p()}),100),u.prototype._onDropBlank=function(e,t){var o=n.deserializeDroppedData(e);return i.publish({event:"ENXModel/Root/addTile",data:{unserializedData:o,behavior:"WITHOUT_CONTEXT",broadcast:!0}}),!0},u.prototype._getAllIDs=function(){var e=[],t=this.options.model.getRoots();for(var i in t)e.push(t[i].options.resourceid);return e},u.prototype.__onDragStartCell=function(e,t){var i=t.nodeModel,n=this.options.model.getXSO().get().slice(0);if(n[0]!==i){var o=n.indexOf(i),r=n[0];n[0]=i,n[o]=r}var a=s.buildX3DContent(n);return this._updateWithBIProxyInfos(n,a),e.dataTransfer.setData("Text",JSON.stringify(a)),e.stopPropagation(),!1},u.prototype.__dropDataItem=function(e){return{envId:require("DS/PADServices/utils/PlatformURL").getPlatformId(),serviceId:e.options.serviceId?e.options.serviceId:"3DSpace",contextId:n.getSecurityContext()?n.getSecurityContext():void 0,objectId:e.options.resourceid,objectType:e.options.type,displayType:e.options.grid["ds6w:type"],displayName:e.options.display?e.options.display:e.getLabel()}},u.prototype._updateWithBIProxyInfos=function(e,t){var i=!1;if("function"==typeof this.options.HasFilter&&"function"==typeof this.options.getCtxForSharing){for(let t=0;t<e.length&&!1===i;t++){if(e[t].isRoot())!0===this.options.HasFilter(e[t].options.resourceid).hasFilter&&(i=!0)}if(i){var n=this.options.getCtxForSharing();n&&(t.biProxyCtx=n)}}},u.prototype.__onContextualEvent=function(){return{this:this,callback:function(e){var n=this;return new Promise((function(e){var o=[],s=n.options.model,r={type:"PushItem",icon:{iconName:"wrong",fontIconFamily:1},title:t.rootLst.removeRoot,action:{this:s,callback:function(){var e=this;this.withTransactionUpdate((function(){var t=e.getSelectedNodes();for(let o=0;o<t.length;o++){var n={tile_id:t[o].options.resourceid};e.removeRoot(t[o]),i.publish({event:"ENXModel/Root/removeTile",data:n})}}))}}};o.push(r),e(o)}))}}},u})),define("DS/PADServices/views/ENXLeftSidePanel",["DS/Controls/TabBar","DS/PADServices/views/private/ResponsiveRootList"],(function(e,t){"use strict";function i(i){var n=this;this._containerMap=new Map,this._arrayContainer=[],n.elements={},n.elements.container=UWA.createElement("div",{class:"enx-leftsidepanel"}),i&&i.noTitle||(n.elements.leftHeaderdiv=document.createElement("div"),n.elements.leftHeaderdiv.classList.add("enx-left-header"),n.elements.container.appendChild(n.elements.leftHeaderdiv),n.elements.leftsidetabbar=new e({displayStyle:"strip"}),n.elements.leftsidetabbar.onContextualMenuEvent((function(){return Promise.resolve([])})),n.elements.leftsidetabbar.getContent().setStyle("width","calc(100% - 38px)"),n.elements.leftHeaderdiv.appendChild(n.elements.leftsidetabbar.getContent()),n.elements.leftsidetabbar.addEventListener("change",(function(e){var t=e.dsModel.value[0];let i=n._containerMap.get(t),o=n._arrayContainer.filter((function(e){return i!==e}));i&&i.setVisible(!0);for(let e=0;e<o.length;e++){o[e].setVisible(!1)}}))),n.elements.leftContentdiv=document.createElement("div"),n.elements.leftContentdiv.classList.add("enx-left-content"),n.elements.container.appendChild(n.elements.leftContentdiv),n.elements.rootLst=new t,this.addTab({key:"rootlst",label:n.elements.rootLst.getTabLabel(),noTitle:i&&i.noTitle||!1,isSelected:!0,icon:{iconName:"list",fontIconFamily:WUXManagedFontIcons.Font3DS},container:n.elements.rootLst,content:n.elements.rootLst.getContent()})}return i.prototype.addTab=function(e){e&&!e.noTitle&&this.elements.leftsidetabbar.add({label:e.label,isSelected:e.isSelected,value:e.key,icon:e.icon}),this.elements.leftContentdiv.appendChild(e.content),this._arrayContainer.push(e.container),this._containerMap.set(e.key,e.container)},i.prototype.getContent=function(){return this.elements.container},i})),define("DS/PADServices/views/private/ContentChooser",["css!DS/PADServices/PADServices.css","i18n!DS/PADServices/assets/nls/PADServices.json","DS/PADServices/utils/GlobalUtils","DS/PADServices/views/private/TilesViewUtils","UWA/Core","UWA/Controls/Abstract","DS/Controls/Button","DS/CollectionView/ResponsiveLargeTilesCollectionView","DS/CollectionView/ResponsiveTilesCollectionView","DS/CollectionView/ResponsiveThumbnailsCollectionView","DS/TreeModel/TreeDocument","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Iconbar","DS/ENOXEmptyContent/js/ENOXEmptyContent","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/SGIUtils"],(function(e,t,i,n,o,s,r,a,l,d,c,p,u,h,m,f){function g(e,t,i){return e.getRoots().filter((function(e){return i(e,t)}))}function v(e,t){return g(e,t,(function(e,t){return e.options.resourceid===t}))}function b(e,t){return g(e,t,(function(e,t){return e.options.grid&&e.options.grid.leaves&&-1!==e.options.grid.leaves.indexOf(t)}))}function S(e,t){return g(e,t,(function(e,t){return e.options.grid&&e.options.grid.associatedProduct&&e.options.grid.associatedProduct===t}))}function w(e){var t=e.target;return!(!t||t.parentElement.classList.contains("disabled"))}function y(e,t,i){e[t]=i}function _(e){return!!self.widget.authorized_DE_types.includes(e.options.grid["ds6w:type-original"])}function D(e){return!!(self.widget.isDeEnabled&&e&&e.length>1)&&e.filter((e=>_(e))).length>1}function C(e,t,i){let n=!0;if(t.size>0&&t.has(i)&&(n=!1),e.getRoots()&&n)for(let o=0;o<e.getRoots().length;o++){let s=e.getRoots()[o],r=[];if(s.options.paths){for(let e=0;e<s.options.paths.length;e++)r=[...r,...s.options.paths[e]];(t=new Set(r)).has(i)&&(n=!1)}else n=!0}return n}var P,I={largeTiles:{title:t.contentChooser.bigTiles,fonticon:"view-big-tile"},tiles:{title:t.contentChooser.smallTiles,fonticon:"view-small-tile"},thumbnails:{title:t.contentChooser.smallThb,fonticon:"view-small-thb"}};return s.extend({name:"enx-contentChooser",defaultOptions:{modelEvents:null,model:null,defaultView:"tiles",view:{largeTiles:null,tiles:null,thumbnails:null},title:"",subscribeTokens:[],mapIds:{}},init:function(e){this._parent(e),P="ENXWelcomePanel-activeView-"+i.getAppId()+"-"+i.getWidgetId();this.options.model=new c({}),this.options.model.getModelEvents().subscribe({event:"addChild"},this.__manageWPContent.bind(this)),this.options.model.getModelEvents().subscribe({event:"removeChild"},this.__manageWPContent.bind(this)),this.options.model.getModelEvents().subscribe({event:"removeChildren"},this.__manageWPContent.bind(this)),this.options.model.getModelEvents().subscribe({event:"empty"},this.__manageWPContent.bind(this)),this.elements.container=o.createElement("div",{class:this.getClassNames()}),this.__addToolbar().inject(this.elements.container),this.elements.content=o.createElement("div",{class:this.getClassNames("-content")}).inject(this.elements.container),this["__build"+this.options.defaultView]().getContent().inject(this.elements.content),this._addSubscribe("ENXViews/ContentChooser/model/"+e.loadKey,this._modelEvent.bind(this));var t="-withoutContent";o.is(i.isWebInWinContext,"function")&&i.isWebInWinContext()&&(t="-withoutContentWebInWin"),this.elements.withoutContent=o.createElement("div",{class:this.getClassNames(t)}).inject(this.elements.container),this.elements.withoutContent.hide(),this.__buildEmptyContent()},render:function(){return this.elements.container},getModel:function(){return this.options.model},destroy:function(){for(var e=0;e<this.options.subscribeTokens.length;e++)this.options.modelEvents.unsubscribe(this.options.subscribeTokens[e])},iconBarResize:function(){this.elements.iconbar.show(),this.elements.iconbar.buildOverflowMenu(),this.elements.iconbar.resize()},_addSubscribe:function(e,t){this.options.subscribeTokens.push(this.options.modelEvents.subscribe({event:e},t))},_modelEvent:function(e){switch(e.op){case"populate":var t=this;(i=this.options.model.search({match:function(e){if(!0!==e.nodeModel.options.fromCustom)return!0}})).length>0&&this.options.model.withTransactionUpdate((function(){for(var e=0;e<i.length;e++)t.options.model.removeRoot(i[e])})),this._addObjectsToModel(e.objects,e.allselected),this.options.model.getRoots().length>0&&(this.elements.withoutContent.hide(),this.elements.content.show());break;case"populateAppend":this._addObjectsToModel(e.objects,e.allselected),this.options.model.getRoots().length>0&&(this.elements.withoutContent.hide(),this.elements.content.show());break;case"update":this._updatedObjectsInModel(e);break;case"remove":this._removeObjectsInModel(e);break;case"noResult":var i;t=this;(i=this.options.model.search({match:function(e){if(!0!==e.nodeModel.options.fromCustom)return!0}})).length>0&&this.options.model.withTransactionUpdate((function(){for(var e=0;e<i.length;e++)t.options.model.removeRoot(i[e])})),0===this.options.model.getRoots().length&&(this.elements.content.hide(),this.elements.withoutContent.show());break;case"addOrRefresh":this._addOrRefresh(e.objects,e.allselected),this.options.model.getRoots().length>0&&(this.elements.withoutContent.hide(),this.elements.content.show())}},_addObjectsToModel:function(e,t){for(var i=[],n=0;n<e.length;n++){var s=o.clone(e[n]);i.push(s)}var r=this.options.model;r.withTransactionUpdate((function(){r.addRoot(i),!0===t&&r.selectAll()}))},_addOrRefresh:function(e,i){var n=this.options.model;n.withTransactionUpdate((function(){for(var o=0;o<e.length;o++){var s=e[o];!0===s.loading?s=Object.assign(s,{thumbnail:p.getWebappsAssetUrl("PADServices","icons/32/loading.gif"),label:t.welcomePanel.loading,grid:{"ds6w:type":""},loading:!0}):s.contextualMenu=[{type:"SeparatorItem"}];var r=v(n,s.resourceid);0===r.length?n.addRoot(s):1===r.length?r[0].updateOptions(s):console.warn("More than one object found")}!0===i&&n.selectAll()}))},_updatedObjectsInModel:function(e){var i=this.options.model,s=e.objects,r=this,a=!0;let l=new Set;i.withTransactionUpdate((function(){for(var d=0;d<s.length;d++){let n=s[d];if(n.escaped||(n.label=o.String.escapeHTML(n.label),n.escaped=!0),!0===e.withAllPathInfos&&n.grid){let e=n.grid["ds6w:type-original"];e||(e=n.grid["ds6w:type"]),r.options.mapIds[n.resourceid]={type:e,label:n.label,display:n.display,i3dx:n.i3dx,cpid:n.cpid}}a=!0;var c=v(i,s[d].resourceid);1===c.length&&(a=!1,s[d].opened,s[d].contextualMenu=[{type:"SeparatorItem"}],e.fromCustom&&(s[d].fromCustom=!0),s[d].branchLabel&&(s[d].labelUpdated=!1),(c[0].options.rootLabel||c[0].options.branchLabel)&&(c[0].options.labelUpdated=!1),c[0].updateOptions(s[d]));var p=b(i,s[d].resourceid);if(p.length){a=!1;for(var u=0;u<p.length;u++){var h=p[u].getAttributeValue("leaves");if(1===h.length){var m="UNKNOWN";s[d].grid&&s[d].grid["ds6w:identifier"]&&(m=s[d].grid["ds6w:identifier"]),p[u].updateOptions({branchLabel:s[d].label,branchIdentifier:m,loading:!1})}else{let e=h.length+t.contentChooser.branches;p[u].updateOptions({branchLabel:e,branchIdentifier:e,loading:!1})}}}var f=S(i,s[d].resourceid);if(f.length){a=!1;for(u=0;u<f.length;u++){var g="UNKNOWN";s[d].grid&&s[d].grid["ds6w:identifier"]&&(g=s[d].grid["ds6w:identifier"]),f[u].updateOptions({rootLabel:s[d].label,rootIdentifier:g,loading:!1})}}if(!0!==e.withAllPathInfos&&a||e.fetchDB&&a){s[d].contextualMenu=[{type:"SeparatorItem"}],s[d].item2Load||(s[d].item2Load={},s[d].item2Load[s[d].resourceid]={}),e.fromCustom&&(s[d].fromCustom=!0),C(i,l,s[d].resourceid)&&i.addRoot(s[d])}}for(var w=[],y=i.getRoots(),_=[],D=0;D<y.length;D++)y[D].options.branchLabel&&!y[D].options.labelUpdated&&y[D].updateOptions({label:y[D].getLabel()+" ► "+y[D].options.branchLabel,description:y[D].options.description+" ► "+y[D].options.branchIdentifier,labelUpdated:!0}),y[D].options.rootLabel&&!y[D].options.labelUpdated&&y[D].updateOptions({label:y[D].getLabel()+t.contentChooser.onrootprod+y[D].options.rootLabel,description:y[D].options.description+t.contentChooser.onrootprod+y[D].options.rootIdentifier,labelUpdated:!0}),!0===y[D].options.loading&&(!0===e.fromDB||!0===e.readOnlyApp?_.push(y[D]):(y[D].updateOptions({label:t.contentChooser.checkOnRecent}),w.push(y[D].options.resourceid),y[D].options.grid.leaves&&(w=w.concat(y[D].options.grid.leaves)))),n.updateNode(y[D],{isWP:!0});for(;_.length;){let e=_.pop();i.removeRoot(e)}w.length&&r.options.modelEvents.publish({event:"ENXViews/ContentChooser/searchInRecent",data:{unknownIds:w}})}))},_removeObjectsInModel:function(e){var t=this.options.model,i=0;t.withTransactionUpdate(function(){for(var n=0;n<e.removedOjects.length;n++){var o=v(t,e.removedOjects[n]);1===o.length?(!0===e.removeFromView?o[0].updateOptions({opened:!1,contextualMenu:[{type:"SeparatorItem"}]}):t.removeRoot(o[0]),self.widget.isDeEnabled&&_(o[0])&&(i++,this.options.modelEvents.publish({event:"ENXModel/DesignEnv/close",data:{deId:o[0].options.resourceid}}))):console.log("ID to remove ["+e.removedOjects[n]+" not found")}i&&(this.options.modelEvents.publish({event:"ENXModel/DesignEnv/close",data:{deCnt:i}}),i=0),0===t.getRoots().length&&e.cbEmptyView&&e.cbEmptyView(),this.options.modelEvents.publish({event:"ENXViews/ContentChooser/refresh"})}.bind(this))},__doubleClickCellHandler:function(e){var t=e.nodeModel;t&&(t.options.opened?(this.options.modelEvents.publish({event:"ENXViews/WelcomePanel/closeLandingPage"}),_(t)&&this.options.modelEvents.publish({event:"DesignExp/ReopenDesignExpAssets",data:{deId:t.options.resourceid}})):this.options.modelEvents.publish({event:"ENXViews/ContentChooser/openContent",data:{nodes:[t]}}),this.options.model.unselectAll())},__openSingle:function(e){this.options.modelEvents.publish({event:"ENXViews/ContentChooser/openContent",data:{nodes:[e]}}),this.options.model.unselectAll()},__openSingleWithFilter:function(e){this.options.modelEvents.publish({event:"ENXViews/ContentChooser/openContent",data:{nodes:[e],withFilter:!0}}),this.options.model.unselectAll()},__openSelected:function(){this.options.modelEvents.publish({event:"ENXViews/ContentChooser/openContent",data:{nodes:this.options.model.getSelectedNodes()}}),this.options.model.unselectAll()},__openSelectedWithFilter:function(){this.options.modelEvents.publish({event:"ENXViews/ContentChooser/openContent",data:{nodes:this.options.model.getSelectedNodes(),withFilter:!0}}),this.options.model.unselectAll()},__addToolbar:function(){var e=this,n="-toolbar";o.is(i.isWebInWinContext,"function")&&i.isWebInWinContext()&&(n="-toolbarWebInWin");var s,r,a=o.createElement("div",{class:e.getClassNames(n)}),l=localStorage.getItem(P);switch(l&&(this.options.defaultView=l),o.createElement("div",{class:e.getClassNames("-togglePlaceHolder")}).inject(a),o.createElement("div",{class:e.getClassNames("-title"),text:e.options.title}).inject(a),e.options.defaultView){case"thumbnails":s="view-small-thb",r=t.contentChooser.smallThb;break;case"largeTiles":s="view-big-tile",r=t.contentChooser.bigTiles;break;default:s="view-small-tile",r=t.contentChooser.smallTiles}var d=o.createElement("div",{class:e.getClassNames("-commands")}).inject(a),c=function(t){e.__switchView(t);var i=e.elements.iconbar.getItem("viewDropDown");i.fonticon=I[t].fonticon,i.text=I[t].title,i.elements.icon.className="fonticon fonticon-"+i.fonticon,i.tooltip.setBody(i.text);var n=i.content.options.items;for(let e=0;e<n.length;e++)n[e].name===t?n[e].selected=!0:n[e].selected=!1;e.elements.iconbar.buildOverflowMenu()},p={renderTo:d,items:[{fonticon:"open",text:t.contentChooser.open,name:"openSelected",handler:function(t){w(t)&&e.__openSelected()}},{fonticon:"filter",text:t.contentChooser.openwithfilter,name:"filterSelected",handler:function(t){w(t)&&e.__openSelectedWithFilter()}},{fonticon:"select-on",text:t.contentChooser.manageSelection,name:"selectDropDown",content:{type:"dropdownmenu",options:{items:[{fonticon:"select-on",text:t.contentChooser.selectAll,name:"selectAll",handler:function(){e.options.model.selectAll()}},{fonticon:"select-off",text:t.contentChooser.selectNone,name:"selectNone",handler:function(){e.options.model.unselectAll()}}]}}},{fonticon:"remove",text:t.contentChooser.remove,name:"removeSelected",handler:function(t){w(t)&&e.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+e.options.loadKey+"/remove",data:{nodes2remove:e.options.model.getSelectedNodes(),dispatch:!0}})}},{fonticon:s,text:r,name:"viewDropDown",content:{type:"dropdownmenu",options:{items:[{fonticon:"view-big-tile",text:t.contentChooser.bigTiles,name:"largeTiles",selectable:!0,selected:"largeTiles"===e.options.defaultView,handler:function(e){c("largeTiles")}},{fonticon:"view-small-tile",text:t.contentChooser.smallTiles,name:"tiles",selectable:!0,selected:"tiles"===e.options.defaultView,handler:function(e){c("tiles")}},{fonticon:"view-small-thb",text:t.contentChooser.smallThb,name:"thumbnails",selectable:!0,selected:"thumbnails"===e.options.defaultView,handler:function(e){c("thumbnails")}}]}},handler:function(e){e.target.addClassName("active"),setTimeout((()=>{document.getElementsByClassName("dropdown-menu dropdown-menu-root dropdown dropdown-root")[0].addEventListener("focusout",(()=>{e.target.removeClassName("active")}),!0)}),100)}},{fonticon:"close",text:t.contentChooser.back2app,name:"back2app",handler:function(t){w(t)&&e.options.modelEvents.publish({event:"ENXViews/ContentChooser/closeLandingPage"})}}]};this.elements.iconbar=new u(p),this.elements.iconbar.menu.templateClassname="byPassABug";var h=function(t){for(var i=!1,n=e.options.model.getRoots(),o=0;o<n.length&&!1===i;o++)!0===n[o].options.opened&&(i=!0);var s={id:e.elements.iconbar.getItem("selectDropDown").id,disabled:0===n.length};e.elements.iconbar.menu.updateItem(s),y(t,"selectDropDown",0===n.length),function(e,t,i){for(var n=Object.keys(i),o=0;o<n.length;o++){var s=n[o];i[s]?(t.disableItem(s),0===e.length&&"viewDropDown"!==t.menu.items[o].name?t.menu.items[o].elements.container.addClassName("hideInactiveIcon"):t.menu.items[o].elements.container.removeClassName("hideInactiveIcon")):t.enableItem(s)}}(n,e.elements.iconbar,t)},f=function(){var t=!0,i=!0,n=e.options.model.getSelectedNodes(),o=!0,s=!0,r=!1,a={};t=0===n.length;for(var l=0;l<n.length&&(o||s);l++)"ENOStrRefinementSpecification"!==n[l].getAttributeValue("ds6w:type")&&"ENOStrRefinementSpecification"!==n[l].getAttributeValue("ds6w:type-original")&&!1!==n[l].options.openWithFilter||(o=!1),!0!==n[l].options.opened?s=!1:r=!0;t=!1!==s,self.widget.isDeEnabled&&D(n)&&(t=!0),o&&1===n.length&&!1===s&&(i=!1),y(a,"openSelected",t);var d={id:e.elements.iconbar.getItem("openSelected").id,disabled:t};e.elements.iconbar.menu.updateItem(d);var c={id:e.elements.iconbar.getItem("filterSelected").id,disabled:i};e.elements.iconbar.menu.updateItem(c),y(a,"filterSelected",i);const p=e.elements.iconbar.getItem("removeSelected");let u=0===n.length;m.getSetting("readOnlyDashboard")&&(u=!0);const f={id:p.id,disabled:u};e.elements.iconbar.menu.updateItem(f),y(a,"removeSelected",u);var g={id:e.elements.iconbar.getItem("removeFromView").id,disabled:0===n.length||!1===r};e.elements.iconbar.menu.updateItem(g),y(a,"removeFromView",0===n.length||!1===r),h(a)};return e.options.model.getXSO().onPostAdd(f),e.options.model.getXSO().onPostRemove(f),e.options.model.getXSO().onEmpty(f),e.options.model.getModelEvents().subscribe({event:"addChild"},(function(){f()})),e.options.model.getModelEvents().subscribe({event:"removeChild"},(function(){f()})),f(),this._addSubscribe("ENXViews/ContentChooser/refresh",(function(){f(),setTimeout((function(){e.iconBarResize()}),500)})),a},__buildlargeTiles:function(){var e=this.options.view.largeTiles=new a({useDragAndDrop:!0,allowUnsafeHTMLContent:!0,displayedOptionalCellProperties:["description","contextualMenu","activeFlag"]});return e.selectionBehavior={unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1,canInteractiveMultiselectWithCheckboxClick:!0},e.getCustomTooltip=n.getTooltip,e.onContextualEvent=this.__onContextualEvent(),e.onCellDoubleClick(this.__doubleClickCellHandler.bind(this)),e.onDragStartCell=this.__onDragStartCell.bind(this),e.loadGridViewModel(this.options.model),e.getContent().classList.add("enx-responsive-view"),e.getContent().classList.add("large-tiles"),e},__buildtiles:function(){var e=this.options.view.tiles=new l({useDragAndDrop:!0,allowUnsafeHTMLContent:!0,displayedOptionalCellProperties:["description","contextualMenu","activeFlag"]});return e.selectionBehavior={unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1,canInteractiveMultiselectWithCheckboxClick:!0},e.getCustomTooltip=n.getTooltip,e.onContextualEvent=this.__onContextualEvent(),e.onCellDoubleClick(this.__doubleClickCellHandler.bind(this)),e.onDragStartCell=this.__onDragStartCell.bind(this),e.loadGridViewModel(this.options.model),e.getContent().classList.add("enx-responsive-view"),e.getContent().classList.add("tiles"),e},__buildthumbnails:function(){var e=this.options.view.thumbnails=new d({useDragAndDrop:!0,allowUnsafeHTMLContent:!0,displayedOptionalCellProperties:["description","contextualMenu","activeFlag"]});return e.selectionBehavior={unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1,canInteractiveMultiselectWithCheckboxClick:!0},e.getCustomTooltip=n.getTooltip,e.onContextualEvent=this.__onContextualEvent(),e.onCellDoubleClick(this.__doubleClickCellHandler.bind(this)),e.onDragStartCell=this.__onDragStartCell.bind(this),e.loadGridViewModel(this.options.model),e.getContent().classList.add("enx-responsive-view"),e.getContent().classList.add("tiles"),e},__switchView:function(e){this.options.view[this.options.defaultView].unloadGridViewModel();var t=this.options.view[e];null===t?t=this["__build"+e]():t.loadGridViewModel(this.options.model),this.options.defaultView=e,localStorage.setItem(P,e),this.elements.content.empty(),t.inject(this.elements.content)},__onContextualEvent:function(){return{this:this,callback:function(e){var i=this;return new Promise((function(n){var o=[];if(void 0!==e.cellInfos){var s=self.widget.isDeEnabled&&D(i.options.model.getSelectedNodes()),r=e.cellInfos.nodeModel,a=i.options.model.getSelectedNodes().length,l=!1,d=!0;if(!0!==r.options.opened||self.widget.isDeEnabled&&_(r)||s){!0===r.options.isFilter||!0===r.options.isR2V||!1===r.options.openWithFilter||!0===r.options.opened||1!==a||self.widget.isDeEnabled&&_(r)||(l=!0),!s&&(!0!==r.options.opened||self.widget.isDeEnabled&&_(r)&&!0!==r.options.opened)&&(d=!1),"Person"!==r.getAttributeValue("ds6w:type")&&"Person"!==r.getAttributeValue("ds6w:type-original")||(d=!0,l=!1);var c={type:"PushItem",icon:{iconName:"open",fontIconFamily:1},title:t.contentChooser.open,action:{this:r,callback:function(){i.__openSelected(this)}},state:!0===d?"disabled":"enabled"};if(o.push(c),l){var p={type:"PushItem",icon:{iconName:"filter",fontIconFamily:1},title:t.contentChooser.openwithfilter,action:{this:r,callback:function(){i.__openSingleWithFilter(this)}}};o.push(p)}o.push({type:"SeparatorItem"})}var u={type:"PushItem",icon:{iconName:"remove",fontIconFamily:1},title:t.contentChooser.remove,state:m.getSetting("readOnlyDashboard")?"disabled":"enabled",action:{this:r,callback:function(){let e=[this],t=i.options.model.getSelectedNodes();t.length&&(e=t),i.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+i.options.loadKey+"/remove",data:{nodes2remove:i.options.model.getSelectedNodes(),dispatch:!0}})}}};if(o.push(u),!0===r.options.addRemoveFromViewCtx&&!0===r.options.opened){var h={type:"PushItem",icon:{iconName:"open wux-ui-3ds-flip-vertical",fontIconFamily:1},title:t.contentChooser.removeFromViewTile,action:{this:r,callback:function(){i.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+i.options.loadKey+"/removeFromView",data:{nodes2remove:[this],dispatch:!0}})}}};o.push(h)}n(o)}else n(o)}))}}},__buildEmptyContent:function(){var e=this,i=new r({label:t.welcomePanel.searchContent,emphasize:"primary"});i.getContent().addClassName(e.getClassNames("-searchForContent")),i.addEventListener("click",(function(){e.options.modelEvents.publish({event:"ENXViews/ContentChooser/searchContent"})})),this.elements.emptyContent=new h({modelEvents:this.options.modelEvents,sentences:[{type:"drop",text:t.contentChooser.dropcontenthere},{type:"dom",DOMelement:i.getContent()}],fontSize:"16px",orderedListType:"none"}),this.elements.emptyContent.inject(this.elements.withoutContent)},__onDragStartCell:function(e,t){var i=t.nodeModel,n=this.options.model.getXSO().get().slice(0);if(n[0]!==i){var o=n.indexOf(i),s=n[0];n[0]=i,n[o]=s}var r=this.__dropDataFromNodes(n);return e.dataTransfer.setData("Text",JSON.stringify(r)),e.stopPropagation(),!1},__dropDataFromNodes:function(e){var t={protocol:"3DXContent",version:"2.1",source:i.getAppId(),widgetId:i.getWidgetId(),data:{items:[]}};return e.forEach(function(e){t.data.items=t.data.items.concat(this.__dropDataItem(e))}.bind(this)),t},__dropDataItem:function(e){var t=require("DS/PADServices/utils/PlatformURL"),n=[],o=e.options.paths;let s=e.options.i3dx||"";if(!0===e.options.isR2V){let o=e.options.selectedFs,s={envId:t.getPlatformId(),serviceId:e.options.serviceId?e.options.serviceId:"3DSpace",contextId:i.getSecurityContext()?i.getSecurityContext():void 0,objectId:o.resourceid,objectType:o.grid["ds6w:type"],displayName:o["ds6w:label"],i3dx:o["ds6w:i3dx"]};n.push(s)}else if(o&&o.length)for(let c=0;c<o.length;c++){var r,a,l,d=[];for(let e=0;e<o[c].length;e++)d.push({resourceid:o[c][e],type:this.options.mapIds[o[c][e]]?this.options.mapIds[o[c][e]].type:void 0,i3dx:this.options.mapIds[o[c][e]]?this.options.mapIds[o[c][e]].i3dx:void 0,cpid:this.options.mapIds[o[c][e]]?this.options.mapIds[o[c][e]].cpid:void 0}),e===o[c].length-1&&(r=o[c][e],this.options.mapIds[o[c][e]]&&(a=this.options.mapIds[o[c][e]].type,l=this.options.mapIds[o[c][e]].display?this.options.mapIds[o[c][e]].display:this.options.mapIds[o[c][e]].label));let p={envId:t.getPlatformId(),serviceId:e.options.serviceId?e.options.serviceId:"3DSpace",contextId:i.getSecurityContext()?i.getSecurityContext():void 0,objectId:r,objectType:a,displayName:l,path:d,i3dx:s,cpid:e.options.cpid};n.push(p)}else{let o=e.getReferenceValue("ds6w:type-original");o||(o=e.getReferenceValue("ds6w:type"));let r={envId:t.getPlatformId(),serviceId:e.options.serviceId?e.options.serviceId:"3DSpace",contextId:i.getSecurityContext()?i.getSecurityContext():void 0,objectId:e.options.resourceid,objectType:o,displayName:e.options.display?e.options.display:e.getLabel(),i3dx:s,cpid:e.options.cpid};n.push(r)}return n},__manageWPContent:function(){let e=this.options.model.getRoots().length;f.setHomepageContent(e)}})})),define("DS/PADServices/views/ENXWelcomePanel",["css!DS/PADServices/PADServices.css","i18n!DS/PADServices/assets/nls/PADServices.json","UWA/Controls/Abstract","UWA/Class/Promise","DS/Core/Core","DS/PADServices/utils/PlatformURL","DS/PADServices/views/private/ContentChooser","DS/PADServices/views/private/AppStructure","DS/PADServices/ws/WSAccess","DS/PADServices/utils/GlobalModelEvents","DS/ENOXParser/ParserCV","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/SubscriptionHolder","DS/PADServices/utils/Storage","DS/PADServices/utils/R2VUtils","DS/PADServices/utils/SGIUtils","DS/PADServices/views/private/TilesViewUtils","DS/WebappsUtils/WebappsUtils","DS/Utilities/Dom","DS/TreeModel/TreeNodeModel","DS/UIKIT/Mask","DS/Menu/Menu","DS/Utilities/UUID","DS/UIKIT/Tooltip","DS/ENOXInterWdgCom/LinkManager","DS/PADUtils/PADSettingsMgt","DS/Utilities/DateUtils","DS/PADServices/settings/AppSettings"],(function(e,t,i,n,o,s,r,a,l,d,c,p,u,h,m,f,g,v,b,S,w,y,_,D,C,P,I,x){"use strict";var A={actual:null,count:0},E={properties:[function(){return{property:"resourceid",value:this.options.resourceid}}]},O={WELCOME:"ENXViews/WelcomePanel/",CONTENT:"ENXViews/ContentChooser/"};Object.freeze(O);var T='flattenedtaxonomies:"types/VPMReference" OR flattenedtaxonomies:"types/VPMRepReference" OR flattenedtaxonomies:"types/ENOStrRefinementSpecification"',N="ENOStrRefinementSpecification",M=["R2V_FeatureOfInterest","R2V_Activity"],L=["ds6w:label","ds6w:type","ds6wg:revision","ds6w:status","owner","ds6w:responsible","ds6w:modified","ds6w:project","ds6w:identifier","ds6w:reserved","ds6w:reservedBy","ds6w:i3dx","ds6w:globalType"];const R={isWP:!0};var U=!1,F=[];function V(e,t){let i=null,n=t.products||{},o=Object.getOwnPropertyNames(n),s=!1;for(let t=0;t<o.length&&!1===s;t++)o[t]===e&&(s=!0,i=o[t]);return i}function k(e){var t=[],i=Object.getOwnPropertyNames(e);if(!i.length)return null;for(var n=0;n<i.length;n++)if("opened"!==i[n]){var o=k(e[i[n]]);null===o?t.push(i[n]):UWA.is(o,"string")?t.push(o):t=t.concat(o)}return t}function j(e){var t=[],i=[],n=function(e,o){var s,r=Object.getOwnPropertyNames(e),a=r.length;for(s=0;s<a;s++){var l,d=Object.getOwnPropertyNames(e[r[s]]).length;if(0===d){var c;(c=void 0===o?[]:o.slice()).push(r[s]);var p=c.join(",");-1===i.indexOf(p)&&(i.push(p),t.push(c))}else for(l=0;l<d;l++){var u;(u=void 0===o?[]:o.slice()).push(r[s]),n(e[r[s]],u)}}};return n(e),t}function W(e,t){e.openProducts||(e.openProducts={}),e.openProducts[t]||(e.openProducts[t]={}),e.hasUpdated=!0}function H(e,t){e.openProducts||(e.openProducts={});var i=!1;return e.openProducts[t]&&(delete e.openProducts[t],i=!0),e.hasUpdated=!0,i}function z(e,t){e.openDesignEnv||(e.openDesignEnv={});var i=!1;return e.openDesignEnv[t]&&(delete e.openDesignEnv[t],i=!0),e.hasUpdated=!0,i}function B(e,t){e.openPointCloud||(e.openPointCloud={}),e.pointClouds||(e.pointClouds={});var i=!1;let n=Object.keys(e.pointClouds);for(let o=0;o<n.length;o++)n[o]===t&&e.openPointCloud[n[o]]&&(delete e.openPointCloud[n[o]],i=!0);return e.hasUpdated=!0,i}function X(e,t){return!(!e.openProducts||!e.openProducts[t])}function G(e,t){return e.filters&&e.filters[t]&&e.filters[t].opened}function q(e,t){return new n((function(i,n){l.fetchDB(e).then((function(e){var n=[];if((e="string"==typeof e?JSON.parse(e):e).results&&e.results.length>0)for(var o=0;o<e.results.length;o++){var s=e.results[o],r=c.parseAttributes(s.attributes);if(r.grid){var a=I.formatDateToString(new Date(r.grid["ds6w:modified"]));r.subLabel=r.grid["ds6w:responsible"]+" | "+a,r.description=r.grid["ds6w:identifier"]}r.loading=void 0,void 0!==t.mapIdStoredObjLst[r.resourceid]&&!0===t.storedObjLst[t.mapIdStoredObjLst[r.resourceid]].opened?r.opened=!0:r.opened=!1,n.push(r)}i(n)})).catch((function(t){console.error(t),n({errorCode:"notFoundAtAll",notFound:e.pids})}))}))}function J(e,t){var i=e.objectsLst;return new n((function(o,s){var r=function(e,t){var i={products:[],filters:[]},n=[],o=e.products||{},s=Object.getOwnPropertyNames(o);for(var r in n=n.concat(s),s){var a=k(o[s[r]]);if(a)for(var l=0;l<a.length;l++)-1===n.indexOf(a[l])&&n.push(a[l])}var d=e.filters||{},c=Object.getOwnPropertyNames(d);for(var p in c){var u=c[p];-1===n.indexOf(d[u].associatedProduct)&&n.push(d[u].associatedProduct)}if(U){var h=[],m=e.designEnv||{},f=Object.getOwnPropertyNames(m);h=h.concat(f),f.forEach((e=>{let t=k(m[e]);t&&t.forEach((e=>{-1===h.indexOf(e)&&h.push(e)}))})),i.designEnvs=[]}for(l=0;l<t.length;l++)-1!==n.indexOf(t[l])&&-1===i.products.indexOf(t[l])?i.products.push(t[l]):-1!==c.indexOf(t[l])&&-1===i.filters.indexOf(t[l])?i.filters.push(t[l]):U&&-1!==h.indexOf(t[l])&&-1===i.designEnvs.indexOf(t[l])&&i.designEnvs.push(t[l]);return i}(t,e.idsNotFound),a=[];if(U&&r.designEnvs.length){let e={pids:r.designEnvs,data:{select_predicate:["ds6w:label","ds6w:type","owner","ds6w:project","ds6w:modified","ds6wg:revision","ds6w:identifier","ds6w:status"],select_file:["icon","thumbnail_2d"]}};a.push(q(e,i))}if(r.products.length){var l={pids:r.products,data:{select_predicate:L,select_file:["icon","thumbnail_2d"]}};a.push(q(l,i))}r.filters.length&&a.push(K({idsNotFound:r.filters})),n.all(a).then((function(e){for(var t=[],i=0;i<e.length;i++)t=t.concat(e[i]);o(t)})).catch((function(e){s(e)}))}))}function K(e,i){var o=e.objectsLst;return new n((function(i,n){var s=[];l.fetchFilter({data:{filterids:e.idsNotFound}}).then((function(r){if((r="string"==typeof r?JSON.parse(r):r).success)for(var a=0;a<r.success.length;a++){for(var l=r.success[a],d=Object.getOwnPropertyNames(l),c=0;c<d.length;c++){var p={resourceid:d[c],icons:[v.getWebappsAssetUrl("ENOFilterBIUX","icons/I_AdvancedFilter32.png")],thumbnail:v.getWebappsAssetUrl("ENOFilterBIUX","icons/I_AdvancedFilter144.png"),grid:{"ds6w:type":"ENOStrRefinementSpecification","ds6w:identifier":l[d[c]].filterName},label:l[d[c]].filterTitle,subLabel:t.welcomePanel.filterNotIndexYet,display:l[d[c]].filterTitle,description:l[d[c]].filterName,loading:void 0};o&&o.mapIdStoredObjLst&&void 0!==o.mapIdStoredObjLst[p.resourceid]&&!0===o.storedObjLst[o.mapIdStoredObjLst[p.resourceid]].opened?p.opened=!0:p.opened=!1,s.push(p)}i(s)}else n({errorCode:"notFoundAtAll",notFound:e.idsNotFound})})).catch((function(e){n(e)}))}))}function $(e,t,i){var o=e.objectsLst,s=[];if(void 0!==i.pointClouds&&JSON.stringify(i.pointClouds)!==JSON.stringify({}))for(let e=o.id2retrieve.length-1;e>=0;--e)i.pointClouds[o.id2retrieve[e]]&&(s.push(o.id2retrieve[e]),delete o.mapIdStoredObjLst[o.id2retrieve[e]],o.id2retrieve.splice(e,1));var r={idsNotFound:o.id2retrieve,objectsLst:o};t.options.readOnlyApp;return new n((function(o,a){var d=e.objectsLst;(function(e,t,i){return new n((n=>{null!=i&&0!==e.length?m.retrieveRecentTiles(e,t,i).then(n).catch(n):n([])}))})(s,i,t.options.pCloudServiceId).then((p=>{var u=[],h=UWA.clone(d.id2retrieve),m=function(e){return e.reduce(((e,t)=>e.then((()=>function(e){return new n((function(t){var n=e.attributes?c.parseAttributes(e.attributes):e;n&&n.grid&&-1!==M.indexOf(n.grid["ds6w:type"])&&(n.serviceId="r2vsurvey");const o=e.attributes&&e.attributes.length>0,s=n&&n.grid&&n.grid["ds6w:type"];o||s?g.buildNodeOptions(n,R).then((e=>{var n,o;e.loading=void 0,e.isFilter?e.opened=G(i,e.resourceid):e.isR2V?(e.opened=(n=i,o=e.resourceid,!(!n.openPointCloud||!n.openPointCloud[o])),e.serviceId="r2vsurvey"):U&&F.includes(e.grid["ds6w:type-original"])?e.opened=function(e,t){return!(!e.openDesignEnv||!e.openDesignEnv[t])}(i,e.resourceid):e.opened=X(i,e.resourceid),u.push(e);var s=h.indexOf(e.resourceid);-1!==s&&h.splice(s,1),t()})):t()}))}(t)))),n.resolve())},f={labelPrefix:"WelcomePanel-",pids:d.id2retrieve,data:{select_predicate:L,select_file:["icon","thumbnail_2d"]}};if(0===d.id2retrieve.length){if(p&&p.length>0)m(p).then((()=>{if(u.length){let e={op:"update",objects:u,readOnlyApp:t.options.readOnlyApp,fromDB:!0,withAllPathInfos:!1};t.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/previousContent",data:e})}}));else{const e=[];for(let i=0;i<s.length;++i){const n=s[i];void 0!==t.options.storedObjects.pointClouds[n]&&(e.push(n),delete t.options.storedObjects.pointClouds[n]),void 0!==t.options.storedObjects.wasOpenPointCloud[n]&&delete t.options.storedObjects.wasOpenPointCloud[n]}t.options.storedObjects.hasUpdated=!1,t._updateStoredList({loadKey:"previousContent",removedFromViewIds:e,removeFromStore:!0}),t.__launchRemoveMdlEvts({item2remove:e})}o()}else l.fetch(f).then((function(s){(s="string"==typeof s?JSON.parse(s):s).results&&s.results.length>0?(p&&p.length>0&&(s.results=s.results.concat(p)),m(s.results).then((()=>{if(u.length){let e={op:"update",objects:u,readOnlyApp:t.options.readOnlyApp,fromDB:!0,withAllPathInfos:!0};t.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/previousContent",data:e})}var s=[];if(h.length)if(!0===t.options.readOnlyApp){for(var l=[],c=0;c<h.length;c++){if(d.mapIdStoredObjLst[h[c]]>=0)d.storedObjLst[d.mapIdStoredObjLst[h[c]]].grid.filterId===h[c]&&l.push(l)}l.length===h.length?(console.log("Only filter ids missing "+JSON.stringify(h)),r.idsNotFound=h,s.push(K(r).then((function(e){u=u.concat(e)})))):a({error:"No result on Index",errorCode:"resultNotFoundOnIndex",idsNotFound:h})}else r.idsNotFound=h,s.push(J(r,i).then((function(e){u=u.concat(e)})));n.all(s).then((function(){u.length&&t.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+e.loadKey,data:{op:"update",objects:u,readOnlyApp:t.options.readOnlyApp,fromDB:!0,fetchDB:!0,withAllPathInfos:!0}}),o()})).catch((function(e){a(e)}))}))):!0===t.options.readOnlyApp?a({error:"No result on Index",errorCode:"resultNotFoundOnIndex",idsNotFound:d.id2retrieve}):J(r,i).then((function(i){0===i.length?t.__noResult():t.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+e.loadKey,data:{op:"update",objects:i,readOnlyApp:t.options.readOnlyApp,fromDB:!0,withAllPathInfos:!0}})})).catch(a)})).catch((function(e){console.error(e),a(e)}))}))}))}function Y(e,t,i,n,o){var s={id:i,text:n,tooltip:n};o&&(s.fonticon=o),t.actions.push(s)}function Z(e,t,i){var n={id:t,title:i,actions:[]};return e.push(n),n}var Q=i.extend({name:"enx-welcome-panel",defaultOptions:{wpUUID:null,defaultActionId:null,defaultSearchTemplate:null,defaultAttributesJSON:"DS/PADServices/assets/init/AttributesMgt.json",welcomePanelState:"opened",openStack:{openContent:null,removeContent:null,openProxy:null,removeProxy:null,launchAction:null},appReady:!1,proxyReady:!1,readOnlyApp:!0,subscriptions:[]},init:function(e){this._parent(e),this.options.wpUUID="enwwp-"+_.v4(),U=e.isDeEnabled,F=e.authorized_DE_types,void 0===this.options.storedObjects&&(this.options.storedObjects={products:{},filters:{},pointClouds:{}}),U&&!this.options.storedObjects.designEnv&&(this.options.storedObjects={...this.options.storedObjects,designEnv:{},wasOpenDesignEnv:{}}),"string"==typeof this.options.globalSearchPrecond&&(T=this.options.globalSearchPrecond),this.options.isTransient=void 0!==window.widget&&(-1!==window.widget.id.indexOf("preview")||"true"===window.widget.metas.isPreview),this.options.isTransient&&window.widget.setValue("autoreloadPreview","true"),this.subcriptionHolder=new u(e.modelEvents),this.options.updateOnceStoreList=!0},initialize:function(){var e=this;return new n((function(t,i){!1===e.options.wpActivated?t():require(["DS/ENOXTriptych/js/ENOXTriptych","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/settings/AppSettings"],(function(i,o,r){o.initialize({defaultAttributesJSON:e.options.defaultAttributesJSON}).then((function(){s.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0}).then((function(){e.elements.container=UWA.createElement("div",{class:e.getClassNames()});var o=e.options.modelEvents,s={title:e.options.appTitle,description:e.options.description,container:e.elements.container,modelEvents:o,useNewUXGuidelines:r.getSetting("useNewUXGuidelinesWP2")};if(void 0===e.options.activities)s=UWA.extend(s,e._defaultWelcomePanel({}),!0);else{if(s.defaultActionId=e.options.defaultActionId,s.activities=[],e.options.description){var l=e.options.description,c={id:"appDescriptionRoot",title:e.options.appTitle,description:l,className:"appTitle"};s.appDescription=c}s.footer=e.options.footer,e._buildActivities(s.activities,e.options.activities)}e.options.customOpenControllerClass&&(e._openController=new e.options.customOpenControllerClass);let u=n.resolve(),h="true"===p.getURLParameter("dndDivEvo");h&&(u=e.__setDnDDivEvolution()),u.then((function(){let n=e.elements.container;h&&(n=e.options.dropDiv.getContentDiv());var l={modelEvents:e.options.modelEvents,container:n,withtransition:!0,left:{originalState:"open"}},c=function(e){for(var t=[],i=0;i<e.length;i++)if(e[i].section)for(var n=e[i].section,o=Z(t,n.id,n.title),s=0;s<n.actions.length;s++)Y(0,o,n.actions[s].id,n.actions[s].title,n.actions[s].icon);return t}(s.activities);s.activities=c;e.elements.leftPlaceHolder=UWA.createElement("div",{class:e.getClassNames("-welcomeLeft")});s.modelEvents=e.options.modelEvents;var u=e.options.triptych=new i;u.init(l,null,void 0,null,s);var m=e.options.welcomePanel=u.welcomePanel;e.triptychTooltip=e._setTooltipForTriptychToggleButton(u._mainPanel.children,"Collapse"),e.options.modelEvents.subscribe({event:"welcome-panel-expanded"},(function(t){u._mainPanel&&(e.triptychTooltip=e._setTooltipForTriptychToggleButton(u._mainPanel.children,"Collapse"))})),e.options.modelEvents.subscribe({event:"welcome-panel-collapsed"},(function(t){u._mainPanel&&(e.triptychTooltip=e._setTooltipForTriptychToggleButton(u._mainPanel.children,"Expand"))})),e.subcriptionHolder.subscribe({event:O.WELCOME+"maskWP"},(function(){e.mask()})),e.subcriptionHolder.subscribe({event:O.WELCOME+"appReady"},(function(){e.options.appReady=!0,e.unmask(),e.options.openStack.closeLandingPage&&(e.options.openStack.closeLandingPage(),delete e.options.openStack.closeLandingPage),null!==e.options.openStack.openContent&&(e.__launchOpenMdlEvts(e.options.openStack.openContent),e.options.openStack.openContent=null),null!==e.options.openStack.removeContent&&(e.__launchRemoveMdlEvts(e.options.openStack.removeContent),e.options.openStack.removeContent=null),null!==e.options.openStack.launchAction&&(e.__launchAction(e.options.openStack.launchAction),e.options.openStack.launchAction=null),e.unmask()})),e.subcriptionHolder.subscribe({event:O.WELCOME+"cleanup"},e._cleanup.bind(e)),e.subcriptionHolder.subscribe({event:O.WELCOME+"loadData"},(function(){var t=a.retrieveData(e.options.structKey),i=a.buildReloadList(t);let n=!0===e.options.mePrefActivated?r.getSetting("autoreload"):a.getWidgetBool("autoreload"),o=a.getWidgetBool("autoreloadPreview");if(e.options.isTransient||window.widget.deleteValue("autoreloadPreview"),(e.options.autoreload||o||n)&&i.hasLoad)e.options.modelEvents.publish({event:O.WELCOME+"activate"}),e.mask(),i.mode="welcome",i.fromAutoReload=!0,i.wasTransient=o,e.__launchOpenMdlEvts(i),e.unmask();else{var s=!0===e.options.mePrefActivated?r.getSetting("showWelcomePanel"):"undefined"==typeof widget||widget.getValue("showWelcomePanel"),l="boolean"==typeof s?s:!s||(c=!1,"boolean"==typeof(d=s)?c=d:"string"==typeof d&&(c="true"===d.toLowerCase()),c);let t="boolean"==typeof e.options.closeRequested&&e.options.closeRequested;delete e.options.closeRequested,l&&!t&&e.options.modelEvents.publish({event:O.WELCOME+"activate"})}var d,c})),e.subcriptionHolder.subscribe({event:"welcome-panel-action-selected"},(function(e){o.publish({event:O.WELCOME+"action/"+e.id,data:{id:e.id}})})),e.options.defaultActionId&&(m.selectAction(e.options.defaultActionId),e.options.modelEvents.publish({event:"welcome-panel-action-selected",data:{id:e.options.defaultActionId}})),e.subcriptionHolder.subscribe({event:"ENXApp/possibleTenantChange"},(function(t){e._possibleTenantChange=!0})),d.subscribe({event:"ENXApp/cancelTenantChange"},(function(t){delete e._possibleTenantChange})),e.subcriptionHolder.subscribe({event:"ENXApp/SettingsModification/onX3dPlatformId"},(function(t){"OnPremise"!==t&&e.options.appReady&&(delete e._possibleTenantChange,e.tenantChange())})),e.subcriptionHolder.subscribe({event:"ENXModel/Nodes/modified"},e.__updateWPNode.bind(e)),e.elements.triptych=e.elements.container.querySelector(".triptych-container"),e.elements.triptych.classList.add("enx-welcome-shell");var f=e.elements.container.querySelector(".triptych-left");e._hookCleanup=p.hookTransitionEnd(f,(function(t){e.elements.previousContent&&e.elements.previousContent.iconBarResize()})),e.subcriptionHolder.subscribe({event:O.CONTENT+"openContent"},(function(t){let i=[];t.nodes&&t.nodes.forEach((function(e){let t={};t.resourceid=e._options.resourceid,t.objectType=e._options.grid["ds6w:type-original"],t.label=e._options.label,t.displayType=e._options.grid["ds6w:type"],i.push(t)}));var n={mode:"welcome",products:{},filters:{},pointClouds:[],nodes:i},o=t.nodes,s=!1,r=[];U&&(n.designEnvs=[]);for(var a=0;a<o.length;a++){var l=o[a];let t=l.getReferenceValue("ds6w:type-original")?l.getReferenceValue("ds6w:type-original"):l.getReferenceValue("ds6w:type");t===N?(s=!0,n.filters=UWA.extend(n.filters,l.options.item2Load)):-1!==M.indexOf(t)?l.options.selectedFs?(s=!0,n.pointClouds.push({serviceId:l.options.serviceId,displayName:l.options.label,objectId:l.options.fsId,objectType:l.options.selectedFs.type,path:[{resourceid:l.options.fsId,type:l.options.selectedFs.type}]})):console.log("Loading feature of interest, but no selected FS"):l.options.fromCustom?(e._openController&&e._openController.processOpenType(n,l.dump(E)),r.push(l.options.resourceid)):(s=!0,U&&F.includes(t)?n.designEnvs.push({envId:widget.getValue("x3dPlatformId"),serviceId:"3DSpace",displayName:l.options.label,objectId:l.options.resourceid,objectType:t,path:[{resourceid:l.options.resourceid,type:t}]}):n.products=UWA.extend(n.products,o[a].options.item2Load))}if(s){if(n.products){let e=Object.keys(n.products);for(let t=0;t<e.length;t++){let i=n.products[e[t]];i.associatedProduct&&delete i.associatedProduct}}void 0!==t.withFilter&&(n.withFilter=t.withFilter),e.__launchOpenMdlEvts(n)}r&&e.options.modelEvents.publish({event:O.WELCOME+"customObjOpen",data:{customitem2open:r}})})),e.subcriptionHolder.subscribe({event:"ENXViews/WelcomePanel/setAction"},(function(t){e.options.welcomePanel.selectAction(t)})),e.subcriptionHolder.subscribe({event:O.WELCOME+"openedObject"},(function(t){switch(t.kind){case"products":var i=t.addedPaths.length,n=e.options.storedObjects,o=[];for(u=0;u<i;u++){var s=n.products,r=0,a=t.addedPaths[u].length;for(r=0;r<a;r++)if(s.hasOwnProperty(t.addedPaths[u][r])||(s[t.addedPaths[u][r]]={}),s=s[t.addedPaths[u][r]],0===r){var l=t.addedPaths[u][r];o.push({resourceid:l,opened:!0}),W(n,t.addedPaths[u][r])}}e._updateStoredList({loadKey:"previousContent"});break;case"filters":if(t.addedFilters.filters)for(var d=Object.getOwnPropertyNames(t.addedFilters.filters),c=0;c<d.length;c++){var p=d[c];U&&t.addedFilters.filters2Ignore.includes(p)||(e.options.storedObjects.filters[p]?e.options.storedObjects.filters[p].opened=!0:(e.options.storedObjects.filters[p]=t.addedFilters.filters[p],e.options.storedObjects.filters[p].opened=!0,e.options.storedObjects.hasUpdated=!0))}e._updateStoredList({loadKey:"previousContent"});break;case"designEnv":t.designEnv&&t.designEnv.forEach((t=>{e.options.storedObjects.designEnv&&(e.options.storedObjects.designEnv[t]||(e.options.storedObjects.designEnv[t]={})),function(e,t){e.openDesignEnv||(e.openDesignEnv={}),e.openDesignEnv[t]||(e.openDesignEnv[t]={}),e.hasUpdated=!0}(e.options.storedObjects,t)})),e._updateStoredList({loadKey:"previousContent"});break;case"pointclouds":n=e.options.storedObjects;e.options.pCloudServiceId&&e.options.pCloudServiceId===t.serviceId||(e.options.pCloudServiceId=t.serviceId),(s=n.pointClouds).hasOwnProperty(t.soiId)||(s[t.soiId]={opened:!0}),s[t.soiId].fsId=t.fsId,s[t.soiId].toUpdate=!0,function(e,t,i){e.openPointCloud||(e.openPointCloud={}),e.openPointCloud[t]=i,e.hasUpdated=!0}(n,t.soiId,s[t.soiId],t.serviceId),e._updateStoredList({loadKey:"previousContent"});break;case"roots":var u;i=t.openedIds.length,n=e.options.storedObjects,o=[];for(u=0;u<i;u++){s=n.products;var h=n.filters;r=0,a=t.openedIds[u].length;for(r=0;r<a;r++){l=t.openedIds[u][r];o.push({resourceid:l,opened:!0}),W(n,t.openedIds[u][r])}for(d=Object.getOwnPropertyNames(h),c=0;c<d.length;c++){h[p=d[c]].associatedProduct===t.openedIds[u][0]&&(e.options.storedObjects.filters[p].opened=!0,e.options.storedObjects.hasUpdated=!0)}}break;case"deleteRoots":for(var m=0;m<t.removeIds.length;m++)e.options.storedObjects.products[t.removeIds[m]]?delete e.options.storedObjects.products[t.removeIds[m]]:e.options.storedObjects.filters[t.removeIds[m]]?delete e.options.storedObjects.filters[t.removeIds[m]]:e.options.storedObjects.pointClouds&&e.options.storedObjects.pointClouds[t.removeIds[m]]&&delete e.options.storedObjects.pointClouds[t.removeIds[m]],H(e.options.storedObjects,t.removeIds[m]),e.options.storedObjects.hasUpdated=!0;e._updateStoredList({loadKey:"previousContent",removedFromViewIds:t.removeIds,removeFromStore:!0});break;case"removeFromView":e._removeObjectFromView({item2remove:t.removedFromViewIds,dispatch:t.dispatch,fromWLSync:t.fromWLSync})}})),h||e.__setDnDBehavior(),e.__setupCrossWidgetCommunication().then((function(){t()}))}))}))}))}))}))},addUpdateTooltip:function(e,t){return this.triptychTooltip&&this.triptychTooltip.destroy(),new D({position:"right",target:e,body:t})},_setTooltipForTriptychToggleButton:function(e,t){if(Symbol.iterator in Object(e)){let i=Array.from(e).filter((e=>e.className.includes("triptych-wp-toggle-btn")));if(i.length)return this.addUpdateTooltip(i[0],t)}},render:function(){return"opened"===this.options.welcomePanelState&&("triptych-wp-toggle-btn open"===this.triptychTooltip.options.target.className?setTimeout(function(){this.options.modelEvents.publish({event:"triptych-set-size",data:{size:40,side:"left"}})}.bind(this),10):setTimeout(function(){this.options.modelEvents.publish({event:"triptych-set-size",data:{size:300,side:"left"}}),this.options.modelEvents.publish({event:"triptych-show-panel",data:"left"})}.bind(this),10)),this.elements.container},destroy:function(){this.subcriptionHolder.destroy(),this.options.cmdProxy&&this.options.cmdProxy.destroy(),this._hookCleanup&&this._hookCleanup(),this.options.triptych.destroy(),this.elements.previousContent&&(this.elements.previousContent.destroy(),delete this.elements.previousContent,this.elements.previousContent=null),this.elements.container.getParent()&&this.elements.container.getParent().removeChild(this.elements.container),delete this.elements.container,this.elements.container=null},setCurrentLoadRequest:function(e){this._currentLoadRequest=e},tenantChange:function(e){var t=this.elements.previousContent.options.model.getRoots().map((function(e){return e.options.resourceid}));t.length&&d.publish({event:O.WELCOME+"cleanup",data:{item2remove:t}})},_defaultWelcomePanel:function(e){var t=this,i={defaultActionId:null,activities:[]};if(t.options.defaultActionId=t.options.defaultActionId?t.options.defaultActionId:"previousContent",i.defaultActionId=t.options.defaultActionId,t.options.description){var n=t.options.description,o={id:"appDescriptionRoot",title:t.options.appTitle,description:n,className:"appTitle"};i.appDescription=o}i.footer=t.options.footer;var s=Q.getDefaultActivities();return t._buildActivities(i.activities,s.activities),t.options.extraActivities&&i.activities.push(t.options.extraActivities),i},_buildActivities:function(e,i){for(var n=this,o=0;o<i.length;o++){var s=i[o],r={};if(s.section){r.section={id:s.section.id,title:s.section.title,actions:[]};for(var a=0;a<s.section.actions.length;a++){var l=s.section.actions[a],d={};if("string"==typeof l)switch(l){case"searchContent":d={id:"searchContent",title:t.welcomePanel.searchContent,icon:"open"},n.subcriptionHolder.subscribe({event:O.WELCOME+"action/searchContent"},(function(){var e=T;n.options.customize&&n.options.customize.searchFilter&&(e=n.options.customize.searchFilter),n._launchSearch({title:t.welcomePanel.searchContent,showApplyButton:!0,applyButton_Nls:t.welcomePanel.applyWithFilter,precondition:"",fts_value:e})}));break;case"previousContent":d={id:"previousContent",title:t.welcomePanel.previousContent,icon:"clock"};n.subcriptionHolder.subscribe({event:O.WELCOME+"action/previousContent"},n._previousContent.bind(n));break;case"availableproducts":d={id:"availableproducts",title:t.welcomePanel.availableproducts,icon:"3dproduct-open"};n.subcriptionHolder.subscribe({event:O.WELCOME+"action/availableproducts"},(function(){n._launchSearch({title:t.welcomePanel.availableproducts,showApplyButton:!0,applyButton_Nls:t.welcomePanel.applyWithFilter,precondition:' (flattenedtaxonomies:"types/VPMReference" OR (flattenedtaxonomies:"types/VPMRepReference"))'})}));break;case"availablefilters":d={id:"availablefilters",title:t.welcomePanel.availablefilters,icon:"filter-open"};n.subcriptionHolder.subscribe({event:O.WELCOME+"action/availablefilters"},(function(){n._launchSearch({precondition:' (flattenedtaxonomies:"types/ENOStrRefinementSpecification")'})}));break;default:console.error("Welcome Panel: Unknown activity ["+l+"]")}else d=l;d&&r.section.actions.push(d)}}e.push(r)}return e},_previousContent:function(){var e=this,i="previousContent";this.elements.loadauto&&this.elements.loadauto.show(),this.elements.countResults&&this.elements.countResults.hide(),this.elements.back2appDiv&&this.elements.back2appDiv.show(),e.elements.previousContent||(e.elements.previousContent=new r({title:t.welcomePanel.previousContent,modelEvents:e.options.modelEvents,loadKey:i,toggleIcon:"opened"===e.options.welcomePanelState?"expand-left":"expand-right",defaultView:void 0===e.options.defaultView?"tiles":e.options.defaultView,attrInNodes:L}),e.__addContentCB({loadKey:i})),e._updateStoredList({loadKey:i}),e.options.modelEvents.publish({event:"triptych-set-content",data:{side:"middle",content:e.elements.previousContent.render()}}),this._previousContentSubscriptions||(e.subcriptionHolder.subscribe({event:"ENXViews/ContentChooser/model/"+i+"/remove"},e._removeObjectFromStore.bind(e)),e.subcriptionHolder.subscribe({event:O.CONTENT+"model/"+i+"/removeFromView"},e._removeObjectFromView.bind(e)),this._previousContentSubscriptions=!0)},_removeObjectFromStore:function(e){var t=this;if(e.nodes2remove||e.item2remove||e.customitem2remove){var i=[],n=[];if(e.nodes2remove)for(var o=0;o<e.nodes2remove.length;o++){var s=e.nodes2remove[o];if(!0===s.options.fromCustom)n.push(s.options.resourceid),i.push(s.options.resourceid);else if(s.options.item2Load)for(var r=Object.getOwnPropertyNames(s.options.item2Load),a=0;a<r.length;a++){var l=r[a];s.options.item2Load[r[a]].associatedProduct&&(l=s.options.item2Load[r[a]].associatedProduct),-1===i.indexOf(l)&&i.push(l)}}else e.item2remove&&(i=e.item2remove);e.customitem2remove&&(n=e.customitem2remove);var d,c,p=[],u=t.options.storedObjects,h=i.length;for(d=0;d<h;d++){if(u.products&&u.products.hasOwnProperty(i[d])&&(delete u.products[i[d]],p.push(i[d])),U&&u.designEnv&&u.designEnv.hasOwnProperty(i[d])&&(delete u.designEnv[i[d]],p.push(i[d])),u.filters){var m=Object.getOwnPropertyNames(u.filters);for(c=0;c<m.length;c++)m[c]!==i[d]&&u.filters[m[c]].associatedProduct!==i[d]||(p.push(m[c]),delete u.filters[m[c]])}u.pointClouds&&u.pointClouds.hasOwnProperty(i[d])&&(delete u.pointClouds[i[d]],p.push(i[d]))}n.length&&(p=p.concat(n)),p.length&&(t._updateStoredList({loadKey:"previousContent",removedFromViewIds:p,removeFromStore:!0}),!1!==e.dispatch&&t.__launchRemoveMdlEvts({item2remove:i,customitem2remove:n,fromProxy:e.fromProxy,dispatch:e.dispatch}))}},_removeObjectFromView:function(e){var t=this;if(e.nodes2remove||e.item2remove||e.customitem2remove){var i=[],n=[];if(e.nodes2remove)for(var o=0;o<e.nodes2remove.length;o++){var s=e.nodes2remove[o];if(!0===s.options.fromCustom)n.push(s.options.resourceid),i.push(s.options.resourceid);else if(s.options.item2Load)for(var r=Object.getOwnPropertyNames(s.options.item2Load),a=0;a<r.length;a++){var l=r[a];s.options.item2Load[r[a]].associatedProduct&&(l=s.options.item2Load[r[a]].associatedProduct),-1===i.indexOf(l)&&i.push(l)}}else e.item2remove&&(i=e.item2remove);e.customitem2remove&&(n=e.customitem2remove);var d,c,p=[],u=t.options.storedObjects,h=i.length;for(d=0;d<h;d++){var m=H(u,i[d]);if(!0===m&&p.push(i[d]),!0===(m=B(u,i[d]))&&p.push(i[d]),u.filters){var f=Object.getOwnPropertyNames(u.filters);for(c=0;c<f.length;c++)f[c]!==i[d]&&u.filters[f[c]].associatedProduct!==i[d]||!0===u.filters[f[c]].opened&&(p.push(f[c]),delete u.filters[f[c]].opened)}U&&!0===(m=z(u,i[d]))&&p.push(i[d])}n.length&&(p=p.concat(n)),p.length&&(t._updateStoredList({loadKey:"previousContent",removedFromViewIds:p,removeFromView:!0}),!1!==e.dispatch&&t.__launchRemoveFromViewMdlEvts({item2remove:i,customitem2remove:n,fromProxy:e.fromProxy,dispatch:e.dispatch,fromWLSync:e.fromWLSync}))}},_smartUpdateList:function(){if(this.options.storedObjects.hasUpdated)this.options.storedObjects.hasUpdated=!1,this._updateStoredList({loadKey:"previousContent"});else{for(var e=[],t=this.elements.previousContent.options.model.getRoots(),i=0;i<t.length;i++){var n=t[i];if(!0!==n.options.fromCustom){var o=n.options.resourceid,s=n.options.opened;s||(s=!1);var r=n.options.grid&&n.options.grid["ds6w:type"]===N;n.options.opened=r?G(this.options.storedObjects,o):X(this.options.storedObjects,o),s!==n.options.opened&&e.push({resourceid:o,opened:n.options.opened})}}e.length>0&&this.elements.previousContent._updatedObjectsInModel({objects:e})}},_updateStoredList:function(e){var i=this;if(!P.getSetting("readOnlyDashboard")||i.options.updateOnceStoreList){if(this._possibleTenantChange)return void setTimeout((function(){i._updateStoredList(e)}),500);if(e.removedFromViewIds&&e.removedFromViewIds.length&&e.removeFromStore)i.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+e.loadKey,data:{op:"remove",removedOjects:e.removedFromViewIds,removeFromView:e.removeFromView,removeFromStore:e.removeFromStore,cbEmptyView:i.__noResult.bind(i)}});else{var n=this.options.storedObjects;delete n.hasUpdated;var o=function(e,i,n,o){for(var s=[],r=[],a={},l=e.products||{},d=e.openProducts||{},c=Object.getOwnPropertyNames(l),p=0;p<c.length;p++){if("undefined"===c[p])continue;i&&-1!==i.indexOf(c[p])&&delete l[c[p]].opened;let e=o.search({match:function(e){if(e.nodeModel.options.resourceid===c[p])return!0}});if(e=1===e.length?e[0]:null,e){if(d[(C=e.options).resourceid]?(e.updateOptions({opened:!0}),C.opened=!0):(e.updateOptions({opened:!1}),C.opened=!1),!0===n&&!0===C.loading){let e=C.paths?C.paths:[];for(let t=0;t<e.length;t++){var u=e[t];for(let e=0;e<u.length;e+=2)-1===r.indexOf(u[e])&&r.push(u[e])}C.paths=e}}else{(C={resourceid:c[p],grid:{rootId:c[p],leaves:k(l[c[p]])},opened:l[c[p]].opened||!1,thumbnail:v.getWebappsAssetUrl("PADServices","icons/32/loading.gif"),item2Load:{},label:t.welcomePanel.loading,loading:!0}).item2Load[c[p]]=l[c[p]];var h=j(C.item2Load);if(d[C.resourceid]&&(C.opened=!0),!0===n){for(let e=0;e<h.length;e++){u=h[e];for(let e=0;e<u.length;e+=2)-1===r.indexOf(u[e])&&r.push(u[e])}C.paths=h}else if(-1===r.indexOf(c[p])&&r.push(c[p]),C.grid.leaves)for(var m=0;m<C.grid.leaves.length;m++)-1===r.indexOf(C.grid.leaves[m])&&r.push(C.grid.leaves[m])}s.push(C),a[C.resourceid]=s.length-1}if(U)for(var f=e.designEnv||{},g=e.openDesignEnv||{},b=Object.getOwnPropertyNames(f),S=0;S<b.length;S++){if("undefined"===b[S])continue;i&&-1!==i.indexOf(b[S])&&delete f[b[S]].opened;let e=o.search({match:function(e){if(e.nodeModel.options.resourceid===b[S])return!0}});if(e=1===e.length?e[0]:null,e){if(g[(C=e.options).resourceid]?(e.updateOptions({opened:!0}),C.opened=!0):(e.updateOptions({opened:!1}),C.opened=!1),!0===n&&!0===C.loading){let e=C.paths?C.paths:[];for(let t=0;t<e.length;t++){u=e[t];for(let e=0;e<u.length;e+=2)-1===r.indexOf(u[e])&&r.push(u[e])}C.paths=e}}else if((C={resourceid:b[S],grid:{rootId:b[S],leaves:k(f[b[S]])},opened:f[b[S]].opened,thumbnail:v.getWebappsAssetUrl("PADServices","icons/32/loading.gif"),item2Load:{},label:t.welcomePanel.loading,loading:!0}).item2Load[b[S]]=f[b[S]],h=j(C.item2Load),g[C.resourceid]&&(C.opened=!0),!0===n){for(let e=0;e<h.length;e++){u=h[e];for(let e=0;e<u.length;e+=2)-1===r.indexOf(u[e])&&r.push(u[e])}C.paths=h}else if(-1===r.indexOf(b[S])&&r.push(b[S]),C.grid.leaves)for(m=0;m<C.grid.leaves.length;m++)-1===r.indexOf(C.grid.leaves[m])&&r.push(C.grid.leaves[m]);s.push(C),a[C.resourceid]=s.length-1}for(var w=e.filters||{},y=Object.getOwnPropertyNames(w),_=0;_<y.length;_++){if("undefined"===y[_])continue;var D=y[_];let e=o.search({match:function(e){if(e.nodeModel.options.resourceid===D)return!0}});e=1===e.length?e[0]:null,e&&!0!==e.options.loading?(C=e.options,e.updateOptions({opened:w[D].opened}),C.opened=w[D].opened,s.push(C)):((C={resourceid:D,grid:{filterId:D,associatedProduct:w[D].associatedProduct},opened:w[D].opened,thumbnail:v.getWebappsAssetUrl("PADServices","icons/32/loading.gif"),item2Load:{},label:t.welcomePanel.loading,loading:!0}).item2Load[D]=w[D],s.push(C),a[C.resourceid]=s.length-1,-1===r.indexOf(D)&&r.push(D))}if(l={},e.pointClouds)if(!0===Array.isArray(e.pointClouds))for(let t=0;t<e.pointClouds.length;t++)l[e.pointClouds]={};else l=e.pointClouds;var C,P=e.openPointCloud||{},I=e.pointClouds||{};for(c=Object.getOwnPropertyNames(l),p=0;p<c.length;p++){if("undefined"===c[p])continue;i&&-1!==i.indexOf(c[p])&&delete l[c[p]].opened;let e=o.search({match:function(e){if(e.nodeModel.options.resourceid===c[p])return!0}});e=1===e.length?e[0]:null,e?(P[(C=e.options).resourceid]?(e.updateOptions({opened:!0}),C.opened=!0):(e.updateOptions({opened:!1}),C.opened=!1),!0===n&&(!0===C.loading||I[c[p]]&&!0===I[c[p]].toUpdate)&&(void 0!==P[c[p]]&&delete P[c[p]].toUpdate,r.push(c[p]))):((C={resourceid:c[p],grid:{rootId:c[p]},opened:l[c[p]].opened,thumbnail:v.getWebappsAssetUrl("PADServices","icons/32/loading.gif"),item2Load:{},label:t.welcomePanel.loading,loading:!0}).item2Load[c[p]]=l[c[p]],P[C.resourceid]&&(C.opened=!0),-1===r.indexOf(c[p])&&r.push(c[p])),s.push(C),a[C.resourceid]=s.length-1}return{id2retrieve:r,storedObjLst:s,mapIdStoredObjLst:a}}(n,e.removedFromViewIds,!0,this.elements.previousContent.getModel());if(o.storedObjLst.length)if(i.options.modelEvents.publish({event:O.CONTENT+"model/"+e.loadKey,data:{op:"populate",objects:o.storedObjLst,allselected:!1}}),o.id2retrieve.length){var s={objectsLst:o,loadKey:e.loadKey},r={success:!1,retriedExceeded:!1,retryCounter:0},a=function(){$(s,i,n).then((function(e){r.success=!0,i.options.modelEvents.publish({event:"ENXViews/ContentChooser/refresh"})})).catch((function(l){var d;r.retryCounter++,r.retryCounter<3?a():l&&"resultNotFoundOnIndex"===l.errorCode?(p.displayNotif({level:"error",title:t.errors.objetRecentNotFoundTitle,subtitle:t.errors.objetNotFoundOnIndex,message:t.errors.objetRefreshWidget,sticky:!0,key:"WP-objetNotFoundOnIndex"}),i.options.isDeEnabled&&n.designEnv&&s.objectsLst.id2retrieve?.length&&Object.keys(n.designEnv).includes(s.objectsLst.id2retrieve[0])&&i.options.modelEvents.publish({event:"ENXModel/DesignEnv/close",data:{deId:s.objectsLst.id2retrieve[0],unindexed:!0}}),i.__launchRemoveMdlEvts({item2remove:l.idsNotFound}),o.storedObjLst.length===l.idsNotFound.length&&i.__noResult()):l&&"notFoundAtAll"===l.errorCode?(d=l.notFound,i.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+e.loadKey,data:{op:"remove",removedOjects:d,readOnlyApp:i.options.readOnlyApp,cbEmptyView:i.__noResult.bind(i)}})):(r.retriedExceeded=!0,function(){for(var n=[],s=UWA.clone(o.id2retrieve),r=0;r<s.length;r++)n.push({resourceid:s[r],label:t.welcomePanel.notLoaded,subLabel:t.welcomePanel.notLoaded,icons:["attention"],thumbnail:v.getWebappsAssetUrl("PADServices","icons/32/I_Warn.png"),loading:!1});i.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+e.loadKey,data:{op:"update",objects:n,readOnlyApp:i.options.readOnlyApp}}),p.displayNotif({level:"error",title:t.errors.cannotFetchAttributesTitle,message:t.errors.cannotFetchAttributes,sticky:!0,key:"WP-cannotFetchAttributes"})}())}))};a()}else i.options.modelEvents.publish({event:"ENXViews/ContentChooser/refresh"});else i.__noResult()}}i.options.updateOnceStoreList=!1},__noResult:function(){this.options.modelEvents.publish({event:O.CONTENT+"model/previousContent",data:{op:"noResult"}})},__addContentCB:function(e){var i=this;i.subcriptionHolder.subscribe({event:O.CONTENT+"toggleClicked"},(function(e){!0===i.options.mobileTriptych?("opened"===i.options.welcomePanelState?i.options.welcomePanelState="reduced":"reduced"===i.options.welcomePanelState&&(i.options.welcomePanelState="opened"),i.options.modelEvents.publish({event:"triptych-toggle-panel",data:"left"})):"opened"===i.options.welcomePanelState?(i.options.welcomePanelState="reduced",i.options.modelEvents.publish({event:"welcome-panel-collapse"})):"reduced"===i.options.welcomePanelState&&(i.options.welcomePanelState="opened",i.options.modelEvents.publish({event:"welcome-panel-expand"}))})),i.subcriptionHolder.subscribe({event:"welcome-panel-collapse"},(function(){var e=document.querySelector(".triptych-left");p.hookTransitionEnd(e,(function(){i.elements.previousContent.iconBarResize()})),i.options.modelEvents.publish({event:"triptych-set-size",data:{size:40,side:"left"}}),i.options.modelEvents.publish({event:"triptych-show-panel",data:"left"}),i.options.modelEvents.publish({event:O.CONTENT+"toggleIcon",data:{iconName:"expand-right",fontIconFamily:WUXManagedFontIcons.Font3DS}})})),i.subcriptionHolder.subscribe({event:"welcome-panel-expand"},(function(){var e=document.querySelector(".triptych-left");p.hookTransitionEnd(e,(function(){i.elements.previousContent.iconBarResize()})),i.options.modelEvents.publish({event:"triptych-set-size",data:{size:300,side:"left"}}),i.options.modelEvents.publish({event:"triptych-show-panel",data:"left"}),i.options.modelEvents.publish({event:O.CONTENT+"toggleIcon",data:{iconName:"expand-left",fontIconFamily:WUXManagedFontIcons.Font3DS}})})),p.isMobileDevice()&&(i.subcriptionHolder.subscribe({event:"triptych-entering-mobile"},(function(){i.options.mobileTriptych=!0,i.options.modelEvents.publish({event:"welcome-panel-expand"})})),i.subcriptionHolder.subscribe({event:"triptych-leaving-mobile"},(function(){i.options.mobileTriptych=!1,i.options.welcomePanelState="reduced",i.options.modelEvents.publish({event:"welcome-panel-collapse"})}))),i.subcriptionHolder.subscribe({event:"triptych-panel-hidden"},(function(e){"left"===e&&i.options.modelEvents.publish({event:O.CONTENT+"toggleIcon",data:{iconName:"expand-right",fontIconFamily:WUXManagedFontIcons.Font3DS}})})),i.subcriptionHolder.subscribe({event:O.CONTENT+"closeLandingPage"},(function(){let e=function(){i.options.modelEvents.publish({event:O.WELCOME+"closeLandingPage"}),i.options.closeRequested=!0};!1===i.options.appReady?(i.options.openStack.closeLandingPage=e,i.mask()):e()})),i.subcriptionHolder.subscribe({event:"ENXViews/ContentChooser/searchContent"},(function(){var e=T;i.options.customize&&i.options.customize.searchFilter&&(e=i.options.customize.searchFilter),i._launchSearch({title:t.welcomePanel.searchContent,showApplyButton:!0,applyButton_Nls:t.welcomePanel.applyWithFilter,precondition:"",fts_value:e})})),i.subcriptionHolder.subscribe({event:"ENXViews/ContentChooser/searchInRecent"},(function(n){var o={pids:n.unknownIds,data:{select_predicate:["ds6w:label","ds6w:description","ds6w:type","ds6w:responsible","ds6w:identifier","ds6w:modified"],select_file:["icon","thumbnail_2d"]}};!0!==i.options.readOnlyApp?l.fetchDB(o).then((function(n){var o=[];if(n.results)for(var s=0;s<n.results.length;s++){var r=n.results[s],a=c.parseAttributes(r.attributes);if(a.grid){var l=I.formatDateToString(new Date(a.grid["ds6w:modified"]));a.subLabel=a.grid["ds6w:responsible"]+" | "+l,a.description=a.grid["ds6w:identifier"]+" ► "+t.welcomePanel.notFoundOnIndex}a.loading=void 0,o.push(a)}i.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+e.loadKey,data:{op:"update",objects:o,readOnlyApp:i.options.readOnlyApp,fromDB:!0}})})).catch((function(){console.warn("Search in DB failed")})):console.warn("Search in DB not suuported in read-Only apps")}))},__setDnDBehavior:function(){this.elements.container.addEventListener("dragenter",this.__onDragEnter.bind(this)),this.elements.container.addEventListener("dragover",this.__onDragOver.bind(this)),this.elements.container.addEventListener("dragleave",this.__onDragLeave.bind(this)),this.elements.container.addEventListener("dragend",this.__onDragEnd.bind(this)),this.elements.container.addEventListener("drop",this.__onDrop.bind(this));var e=p.isWebInWinContext()?"-dropAreaWebInWin":"-dropArea",i=this.elements.droparea=UWA.createElement("div",{class:this.getClassNames(e)}).inject(this.elements.container);i.hide();for(var n=[{id:"addInCtx",icon:"drag-drop",title:t.welcomePanel.addObjectInCtx},{id:"addObject",icon:"drag-drop",title:t.welcomePanel.addObject},{id:"filter",icon:"filter",title:t.welcomePanel.filter}],o=0;o<n.length;o++){var s=UWA.createElement("div",{class:this.getClassNames("-dropZoneGlobal "+n[o].id),draggable:!1}),r=UWA.createElement("div",{class:this.getClassNames("-dropZone "+n[o].id),draggable:!1}).inject(s),a=UWA.createElement("div",{class:this.getClassNames("-dropIconAndText "+n[o].id)}).inject(r);UWA.createElement("i",{class:this.getClassNames("_img wux-ui-3ds wux-ui-3ds-4x wux-ui-3ds-"+n[o].icon)}).inject(a),UWA.createElement("h5",{class:this.getClassNames("_txt "+n[o].id),text:n[o].title}).inject(a),s.inject(i)}},__onDragEnter:function(e){var t=b.firstParentWithClass(e.target,"enx-welcome-panel-dropZoneGlobal");if(0===A.count)this.elements.triptych.style.opacity="0.2",this.elements.droparea.show();else if(t){var i=t.querySelector(".enx-welcome-panel-dropZone");A.actual!==i&&(A.actual&&A.actual.classList.remove("zoneHighlighted"),i.classList.add("zoneHighlighted"),A.actual=i)}return A.count++,e.stopPropagation(),!1},__onDragOver:function(e){return b.firstParentWithClass(e.target,"enx-welcome-panel-dropZoneGlobal")&&e.preventDefault(),e.stopPropagation(),!1},__onDragLeave:function(e){return A.count--,0===A.count&&(this.elements.droparea.hide(),this.elements.triptych.style.opacity="1"),e.target===A.actual&&(A.actual.classList.remove("zoneHighlighted"),A.actual=null),e.stopPropagation(),!1},__onDragEnd:function(e){return A.count=0,A.actual&&(A.actual.classList.remove("zoneHighlighted"),A.actual=null),this.elements.droparea.hide(),this.elements.triptych.style.opacity="1",e.stopPropagation(),!1},__onDrop:function(e){if(A.count=0,this.elements.droparea.hide(),this.elements.triptych.style.opacity="1",e.stopPropagation(),!e.defaultPrevented){e.preventDefault();var t="WITH_CONTEXT";if(A.actual)A.actual.classList.contains("addObject")?t="WITHOUT_CONTEXT":A.actual.classList.contains("filter")&&(t="FILTER"),A.actual.classList.remove("zoneHighlighted"),A.actual=null;else{var i=b.firstParentWithClass(e.target,"enx-welcome-panel-dropZoneGlobal");i.classList.contains("addObject")?t="WITHOUT_CONTEXT":i.classList.contains("filter")&&(t="FILTER")}var n={mode:"drop",behavior:t,unserializedData:p.deserializeDroppedData(e)};let s=!0;var o;if(n.unserializedData&&n.unserializedData.data&&n.unserializedData.data.items)if(s=f.isOpenAuthorized(n.unserializedData.data.items),U)n.unserializedData.data.items.forEach((e=>{"opened"===e.objectId&&e.path&&e.path.length&&(o=e.path.find((e=>F.includes(e.type))))&&(e.objectId=o.resourceid,e.objectType=o.type,e.shouldFetchLabel=!0)}));s?this.__launchOpenMdlEvts(n):f.displayNotSupportedMultiSource()}return!1},_launchSearch:function(e){var t=this,i=function(e,i){var n={mode:"welcome",products:{},filters:{},pointClouds:[],unserializedData:{}},o={items:[]};if(e.length>0){for(var s=[],r=0;r<e.length;r++){var a=e[r]["ds6w:type_value"]?e[r]["ds6w:type_value"]:e[r]["ds6w:type"],l={resourceid:e[r].resourceid,label:e[r]["ds6w:label"],grid:{"ds6w:type":a},item2Load:{}};l.item2Load[e[r].resourceid]={},-1!==M.indexOf(a)?l.serviceId=e[r]["ds6w:dataSource_value"].toLowerCase():l.serviceId="3DSpace",l.objectType=e[r]["ds6w:type_value"],s.push(new S(l));var d={};d.objectId=e[r].resourceid,d.objectType=a,d.displayName=e[r]["ds6w:label"],d.displayType=e[r]["ds6w:type"],-1!==M.indexOf(a)?d.serviceId=e[r]["ds6w:dataSource_value"].toLowerCase():d.serviceId="3DSpace",o.items.push(d)}for(r=0;r<s.length;r++)s[r].getAttributeValue("ds6w:type")===N?n.filters=UWA.extend(n.filters,s[r].options.item2Load):-1!==M.indexOf(s[r].getAttributeValue("ds6w:type"))?n.pointClouds.push({serviceId:s[r].options.serviceId,displayName:s[r].options.label,objectId:s[r].options.resourceid,objectType:s[r].options.objectType}):n.products=UWA.extend(n.products,s[r].options.item2Load);n.unserializedData.protocol="3DXContent",n.unserializedData.data=o,n.withFilter=i,t.__launchOpenMdlEvts(n)}return n},n=function(e){e&&(t.options.storedObjects=UWA.merge(t.options.storedObjects,e)),t.options.welcomePanel.selectAction("previousContent")};void 0!==e.precondition&&require(["DS/PADServices/utils/SearchUtils"],(function(o){var s={parent_window:t.options.odtSpecificParentWindow,title:e.title,precond:e.precondition,fts_value:e.fts_value,search_criteria_to_display:"",showApplyButton:e.showApplyButton,applyButton_Nls:e.applyButton_Nls,callback:function(e){var t=i(e);n(t)},apply:function(e){var t=i(e,!0);n(t)},cancel:n};o.inAppsSearch(s)}))},__setupCrossWidgetCommunication:function(){var e=this;return new n((function(i){C._biFiltersReadyPromise&&C._biFiltersReadyPromise.then((function(){e.options.proxyReady=!0})),C.getLinked()&&0===C.getLinked().length&&(e.options.proxyReady=!0),C.addEventListener("unlink",(function(t){e.options.proxyReady=!0})),require(["DS/PADServices/utils/CommandProxy"],(function(n){e.options.cmdProxy=n.create({events:{onLoadStoredObj:function(i,n){if(y.hide(),n.originWidgetId!==p.getWidgetId()&&(!0!==i.fromAutoReload||1!=e.options.autoreload)){if(e._currentLoadRequest&&UWA.equals(e._currentLoadRequest,i))return void e.setCurrentLoadRequest(null);if(i.fromProxy=!0,!1===e.options.appReady)e.options.openStack.openContent=i,e.mask();else{if(P.getSetting("design_exp_authorized_types")&&i.unserializedData&&i.unserializedData.data.items&&i.unserializedData.data.items.length&&(i.unserializedData.data.items=i.unserializedData.data.items.filter((e=>!P.getSetting("design_exp_authorized_types").includes(e.objectType))),!i.unserializedData.data.items.length))return!1;e.options.modelEvents.publish({event:"ENXViews/WelcomePanel/openContent",data:i})}P.getSetting("readOnlyDashboard")&&void 0===e.displayOnceReadOnlyNotif&&(e.displayOnceReadOnlyNotif=!0,p.displayNotif({level:"warning",message:t.welcomePanel.readOnlyDashboard,key:"WP-ReadOnly"}))}},onRemoveStoredObj:function(t,i){y.hide(),i.originWidgetId!==p.getWidgetId()&&(t.fromProxy=!0,!1===e.options.appReady?(e.options.openStack.removeContent=t,e.mask()):e._removeObjectFromStore(t))},onRemoveObjFromView:function(t,i){y.hide(),i.originWidgetId!==p.getWidgetId()&&(t.fromProxy=!0,e._removeObjectFromView(t))},onAppProxyReady:function(t,i){i.originWidgetId!==p.getWidgetId()&&(e.options.proxyReady=!0,!0!==e.options.handshakeDone&&t.wpUUID!==e.options.partnerUUID&&(e.options.partnerUUID=t.wpUUID,e.options.handshakeDone=!0,e.options.cmdProxy.appProxyReady({wpUUID:e.options.wpUUID})),null!==e.options.openStack.openProxy&&(e.options.cmdProxy.loadStoredObj(e.options.openStack.openProxy),e.options.openStack.openProxy=null),null!==e.options.openStack.removeProxy&&(e.options.cmdProxy.removeStoredObj(e.options.openStack.removeProxy),e.options.openStack.removeProxy=null))},onUpdatePreviousContent:function(t,i){!0!==t.fromProxy&&(t.fromProxy=!0,e.__updateWPNode(t))}}}),e.options.cmdProxy.appProxyReady({wpUUID:e.options.wpUUID}),i()}))}))},__launchOpenMdlEvts:function(e){y.hide(),!1===this.options.appReady?(this.options.openStack.openContent=e,this.mask()):(this.options.modelEvents.publish({event:"ENXViews/WelcomePanel/openContent",data:e}),!e.wasTransient&&this.options.cmdProxy&&!0!==e.fromProxy&&(!1===this.options.proxyReady?this.options.openStack.openProxy=e:this.options.cmdProxy.loadStoredObj(e)))},__launchRemoveMdlEvts:function(e){y.hide();!1===this.options.appReady?(this.options.openStack.removeContent=e,this.mask()):(this.options.modelEvents.publish({event:"ENXViews/WelcomePanel/removeFromStored",data:e}),this.options.cmdProxy&&!0!==e.fromProxy&&(!1===this.options.proxyReady?this.options.openStack.removeProxy=e:this.options.cmdProxy.removeStoredObj(e)))},__launchRemoveFromViewMdlEvts:function(e){y.hide();this.options.modelEvents.publish({event:"ENXViews/WelcomePanel/removeFromView",data:e}),this.options.cmdProxy&&!0!==e.fromProxy&&e.dispatch&&this.options.cmdProxy.removeObjFromView(e)},__launchAction:function(e){y.hide();var t=this;require(["DS/ApplicationFrame/CommandsManager"],(function(i){var n=i.getCommand(e.command);n&&(!0===e.unselectBeforeLaunch&&t.options.modelEvents.publish({event:"ENXViews/WelcomePanel/unselectAllInModel"}),n.begin(),t.options.modelEvents.publish({event:"ENXViews/WelcomePanel/closeLandingPage"}))}))},_cleanup:function(e){var t=require("DS/PADServices/utils/GlobalModelEvents");t.publish({event:"ENXViews/WelcomePanel/removeFromStored",data:{item2remove:e.item2remove}}),t.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"deleteRoots",removeIds:e.item2remove}}),this.options.cmdProxy.removeStoredObj({item2remove:e.item2remove})},_addOrRefresh:function(e){this.options.modelEvents.publish({event:O.CONTENT+"model/previousContent",data:{op:"addOrRefresh",objects:e.objects,allselected:!1}})},mask:function(e){w.mask(this.elements.container,e||t.welcomePanel.appLoading)},unmask:function(){w.unmask(this.elements.container)},__updateWPNode:function(e){let t=[],i=[];for(let n=0;n<e.modifiedIds.length;n++){let o=V(e.modifiedIds[n],this.options.storedObjects);o&&(t.push(o),-1===i.indexOf(o)&&i.push(o))}if(t.length){e.fromProxy||this.options.cmdProxy.updatePreviousContent(e);let l={};var o=[],s=this.options.storedObjects;for(let t=0;t<e.fetchAnswer.results.length;t++){let i=c.parseAttributes(e.fetchAnswer.results[t].attributes);l[i.resourceid]=i}var r=this;(a=t,a.reduce(((t,r)=>t.then((()=>function(t){return new n((function(n){var r=l[t];r?g.buildNodeOptions(r,R).then((t=>{t.loading=void 0,t.isFilter?t.opened=G(s,t.resourceid):t.opened=X(s,t.resourceid),o.push(t),!0===e.fromProxy&&-1!==i.indexOf(t.resourceid)&&d.publish({event:"ENXModel/Root/sync",data:{tileId:t.resourceid,nodeOpts:t}}),n()})):n()}))}(r)))),n.resolve())).then((()=>{if(o.length){let e={op:"update",objects:o,readOnlyApp:r.options.readOnlyApp,fromDB:!0,withAllPathInfos:!0};r.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/previousContent",data:e})}}))}var a}});return Q.getDefaultActivities=function(e){return e&&"1.0"===e.version?{defaultActionId:"previousContent",activities:[{section:{id:"newActivity",title:t.welcomePanel.newActivity,actions:["searchContent"]}},{section:{id:"contentSection",title:t.welcomePanel.content,actions:["previousContent","availableproducts","availablefilters"]}}]}:{defaultActionId:"previousContent",activities:[{section:{id:"contentSection",title:t.welcomePanel.content,actions:["previousContent","searchContent","availableproducts","availablefilters"]}}]}},Q.launchSearch=function(e){require(["DS/PADServices/utils/SearchUtils"],(function(t){var i={parent_window:e.odtSpecificParentWindow,title:e.title,precond:e.precondition,search_criteria_to_display:e.search_criteria_to_display?e.search_criteria_to_display:"",fts_value:e.fts_value,showApplyButton:e.showApplyButton,applyButton_Nls:e.applyButton_Nls,callback:e.ok,apply:e.apply,cancel:function(t){e.modelEvts&&e.modelEvts.publish({event:"ENXViews/WelcomePanel/setAction",data:"previousContent"})}};t.inAppsSearch(i)}))},Q})),define("DS/PADServices/views/LandingPage",["css!DS/PADServices/PADServices","DS/PADServices/views/ENXWelcomePanel","UWA/Class/Promise","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/SubscriptionHolder","DS/PADServices/utils/GlobalUtils","DS/WebappsUtils/WebappsUtils","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSession","DS/PADServices/views/private/AppStructure","i18n!DS/PADServices/assets/nls/PADServices.json","DS/UIKIT/Mask","DS/PADServices/utils/SGIUtils"],(function(e,t,i,n,o,s,r,a,l,d,c,p,u){"use strict";function h(e){var t=!1;return UWA.is(e,"boolean")?t=e:UWA.is(e,"string")&&(t="true"===e.toLowerCase()),t}function m(e){e=e||{},this.options=UWA.extend({widget:null,welcome:null,viewer:null,injectedView:null,onLandingPageReady:null,readOnlyApp:!0,renderDiv:null,structKey:"xsceneStoredObjects",subscriptions:[],ready:{viewerReady:!1,appReady:!1}},e,!0),d.setWidget(this.options.widget),d.migratePrevData(this.options.structKey)}return m.prototype={initialize:function(){var e=this;return new i((function(i){require(["DS/PADServices/utils/PlatformURL"],(function(a){a.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0}).then((function(){e._buildDOM(),e._globalSubscriptionHolder=new o(n.getModelEvents());var a=e.options.widget.getValue("xsceneStoredObjects");"xsceneStoredObjects"===s.getURLParameter("cleanSetting")?(e.options.widget.deleteValue("xsceneStoredObjects"),a=d.retrieveData(e.options.structKey)):a=d.retrieveData(e.options.structKey),a.supplementalNodes&&u.setSupplementalNodes(a);var l=e.options.widget.getValue("showWelcomePanel"),p="boolean"==typeof l?l:!l||h(l),m=h(e.options.widget.getValue("autoreload")),f=void 0,g={odtSpecificParentWindow:e.options.odtSpecificParentWindow,modelEvents:n.getModelEvents(),storedObjects:a,pCloudServiceId:a.pCloudServiceId||"r2vsurvey",appTitle:e.options.appTitle,description:e.options.description,readOnlyApp:e.options.readOnlyApp,defaultAttributesJSON:"DS/ENOPAD3DViewer/assets/json/AttributesMgt.json",globalSearchPrecond:e.options.globalSearchPrecond,defaultActionId:e.options.defaultActionId,structKey:e.options.structKey,autoreload:m};e.options.activities&&(g.activities=e.options.activities),e.options.extraActivities&&(g.extraActivities=e.options.extraActivities),e.options.customHandlerClass&&(e._customHandler=new e.options.customHandlerClass({loadingNls:c.welcomePanel.loading,loadingIcon:r.getWebappsAssetUrl("PADServices","icons/32/loading.gif")}),e.__customizeSetup()),e.options.customOpenControllerClass&&(g.customOpenControllerClass=e.options.customOpenControllerClass),e.options.customize&&(g.customize=UWA.clone(e.options.customize));let v=function(){e.__switchView("welcome")};e.options.welcome=new t(g),e.options.welcome.initialize().then((function(){e.options.onLandingPageReady&&e.options.onLandingPageReady.call(null,a),!0===p&&(!1===m?v():e.hasObjectToLoad(a).then(function(e){e||v()}.bind(e)));var t=n.subscribe({event:"ENXViews/WelcomePanel/appReady"},(function(){n.unsubscribe(t),e.options.onReady&&e.options.onReady()}));e._globalSubscriptionHolder.subscribe({event:"ENXViews/LandingPage/addOrRefresh"},(function(t){e.options.welcome._addOrRefresh(t)})),e._globalSubscriptionHolder.subscribe({event:"ENXViews/LandingPage/remove"},(function(t){e.options.welcome._removeObjectFromStore(t)})),e._globalSubscriptionHolder.subscribe({event:"ENXViews/WelcomePanel/customObjOpen"},(function(e){n.publish({event:"ENXViews/LandingPage/openCustom",data:e})})),m&&(f=a,n.publish({event:"ENXViews/LandingPage/autoreload"})),i(f)}))}))}))}))},hasObjectToLoad:function(e){return new i(function(e,t,i){e&&t(d.buildReloadList(e).hasLoad);t(!1)}.bind(this,e))},setViewer:function(e,t){if(null!=e){if(this.options.viewer=e,this._viewerReady=t,this.__3DCBSetUp(),!0===t){var i=this.options.viewer.getController();if(0!==i.getNbRoots()){i._getRootLog();n.publish({event:"ENXViews/ContentChooser/openedObject",data:{nodes:i.getRoots()}})}}}else console.eror("LandingPage.setViewer : The viewer given as a parameter is empty")},render:function(){return this.options.welcome.render()},redraw:function(){this.options.welcome.render()},appReady:function(){this._setupReady("appReady")},dispose:function(){if(this.options.viewer&&this.options.viewer.render().getContent){let e=this.options.viewer.render().getContent(),t=e.parentNode;t&&t!==this.options.renderDiv&&this.options.renderDiv.appendChild(e)}this._globalSubscriptionHolder.destroy(),this._viewerSubscriptionHolder&&this._viewerSubscriptionHolder.destroy(),this.options.welcome&&(this.options.welcome.destroy(),this.options.welcome=null),this.elements.mainBody&&this.elements.mainBody.parentElement.removeChild(this.elements.mainBody)},destroy:function(){this._viewerReady=!1,this._globalSubscriptionHolder.destroy(),this._viewerSubscriptionHolder&&this._viewerSubscriptionHolder.destroy(),this.options.viewer&&(this.options.viewer.destroy(),this.options.viewer=null),this.options.welcome&&(this.options.welcome.destroy(),this.options.welcome=null),this.elements.mainBody&&this.elements.mainBody.parentElement.removeChild(this.elements.mainBody)},_buildDOM:function(){this.elements||(this.elements={},this.elements.mainBody=UWA.createElement("div"),this.elements.mainBody.classList.add("landing-root"),this.elements.mainBody.style.height="100%",this.elements.mainBody.style.width="100%",this.options.renderDiv.appendChild(this.elements.mainBody))},__switchView:function(e,t){e!==this.options.injectedView&&(this.initDiv||(this.initDiv={}),!0===this.options.externalViewerMgt&&"viewer"===e||!0!==this.initDiv[e]&&(this.elements[e]||(this.elements[e]=document.createElement("div"),this.elements[e].classList.add("landing-"+e),this.elements[e].classList.add("landing-div"),this.elements[e].classList.add("landing-hidden"),this.elements.mainBody.appendChild(this.elements[e])),this.options[e]&&this.options[e].render().inject(this.elements[e]),this.initDiv[e]=!0)),!0!==t?this._showActiveView(e):!0===this.options.externalViewerMgt&&"viewer"===e&&this.options.externalViewerMgtCB(e,t)},_showActiveView:function(e){var t=Object.keys(this.elements);this.options.injectedView=e;for(var i=0;i<t.length;i++)e===t[i]?this.elements[t[i]].classList.remove("landing-hidden"):"mainBody"!==t[i]&&this.elements[t[i]].classList.add("landing-hidden");!0===this.options.externalViewerMgt&&"function"==typeof this.options.externalViewerMgtCB&&this.options.externalViewerMgtCB(e),window.dispatchEvent(new Event("resize"))},__3DCBSetUp:function(){var e=this;if(this._viewerSubscriptionHolder=new o(this.options.viewer.getModelEvents()),"wafr"===a.getSetting("eno3dviewer_infrastructure_version")&&null!==this._ec){var t=h(this.options.widget.getValue("showWelcomePanel"));this.options.viewer.unsubscribe(i),!0===t?!0===this.options.viewer.injectInView?this.__switchView("viewer"):(this.__switchView("viewer",!0),this.__switchView("welcome")):this.__switchView("viewer"),this._viewerReady=!0,this._setupReady("viewerReady"),this.options.viewer.fromTransition||n.publish({event:"ENXViews/WelcomePanel/loadData"})}else{var i=e.options.viewer.subscribe({event:"onReady"},(function(t){var o=h(e.options.widget.getValue("showWelcomePanel"));e.options.viewer.unsubscribe(i),!0===o?!0===t.injectInView?e.__switchView("viewer"):(e.__switchView("viewer",!0),e.__switchView("welcome")):e.__switchView("viewer"),e._viewerReady=!0,e._setupReady("viewerReady"),t.fromTransition||n.publish({event:"ENXViews/WelcomePanel/loadData"})}));this._viewerSubscriptionHolder.subscriptions.push(i)}e._globalSubscriptionHolder.subscribe({event:"ENXViews/WelcomePanel/openContent"},(function(t){e.__switchView("viewer"),e.options.welcome.setCurrentLoadRequest(t),setTimeout((function(){switch(!0===t.fromProxy?(e.fromProxy=!0,t.broadcast=!1):e.fromProxy=!1,t.mode){case"welcome":e.options.viewer.openStoredObjects(t).then((function(){e.options.welcome.setCurrentLoadRequest(null)}));break;case"drop":e.options.viewer.openDroppedObjects(t).then((function(t){delete e._previousFilterRootPids}));break;default:console.error("Unknown mode ["+t.mode+"]"),e.__switchView("welcome")}}),500)})),e._globalSubscriptionHolder.subscribe({event:"ENXViews/WelcomePanel/removeFromStored"},(function(t){if(t.item2remove){var i=t.item2remove;u.removeIdsFromMap(i);var o=e.options.widget.getValue("xsceneStoredObjects");if("null"===o&&(o=null),UWA.is(o,"string")){var s=e.options.viewer.getController();o=JSON.parse(o);var r,a,l=i.length,d=!1,c=[],p=[];for(r=0;r<l;r++){if(o.products&&o.products.hasOwnProperty(i[r]))s.getNode({id:i[r]})&&p.push(i[r]),c.push(i[r]),delete o.products[i[r]],e.options.welcome.options.storedObjects.hasUpdated=!0,d=!0;if(o.filters){var h=Object.getOwnPropertyNames(o.filters);for(a=0;a<h.length;a++)if(h[a]===i[r])c.push(h[a]),p.push(o.filters[h[a]].associatedProduct),delete o.filters[h[a]],d=!0;else if(o.filters[h[a]].associatedProduct===i[r]){s.getNode({id:i[r]})&&p.push(i[r]),c.push(h[a]),delete o.filters[h[a]],d=!0}}if(o.pointClouds)s.getNode({id:i[r]})&&p.push(i[r]),c.push(i[r]),delete o.pointClouds[i[r]],e.options.welcome.options.storedObjects.hasUpdated=!0,d=!0}if(p.length&&s.removeRoots({pids:p},!1),d){let t=u.getSupplementalMap();t&&(o.supplementalNodes=t),e.options.widget.setValue("xsceneStoredObjects",JSON.stringify(o)),n.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"deleteRoots",removeIds:c}})}if(e._customHandler)e._customHandler.removeFromStore(e.options.widget,t.item2remove)&&n.publish({event:"/ENXViews/ContentChooser/model/previousContent/refresh/"})}}t.customitem2remove&&t.customitem2remove.length&&n.publish({event:"ENXViews/LandingPage/removeFromStore",data:{customitem2remove:t.customitem2remove}})})),e._globalSubscriptionHolder.subscribe({event:"ENXViews/WelcomePanel/activate"},(function(t){n.publish({event:"ENXViews/WelcomePanel/refreshView"}),("fromHome"===t||e.options.widget.getValue("showWelcomePanel"))&&e.__switchView("welcome")})),e._globalSubscriptionHolder.subscribe({event:"ENXViews/WelcomePanel/closeLandingPage"},(function(){e.__switchView("viewer")})),e._viewerSubscriptionHolder.subscribe({event:"onFilterApplied"},(function(t){for(var i=d.retrieveData(e.options.structKey),o=0;o<t.filter.objects.length;o++){var s=t.filter.objects[o],r=s.filterId,a=s.path[0];if(r){var l={filters:{}};i.filters||(i.filters={}),d.addFilter(i,r,a),l.filters[r]={associatedProduct:a},n.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"filters",addedFilters:l}})}}d.persistData(e.options.structKey,i)})),e._viewerSubscriptionHolder.subscribe({event:"onRefreshBegin"},(function(t){e._isInRefresh=!0})),e._viewerSubscriptionHolder.subscribe({event:"onRefreshCompleted"},(function(t){e._isInRefresh=!1})),e.__hookRemoveFromView(),e._viewerSubscriptionHolder.subscribe({event:"onRootUpdateStart"},(function(){e.applyFilterProcessed=!0,e.currentView=e.options.injectedView})),e._viewerSubscriptionHolder.subscribe({event:"onRootUpdateEnd"},(function(){delete e.applyFilterProcessed,void 0!==e.options.injectedView&&e.currentView!==e.options.injectedView&&(null!==e.currentView&&"welcome"!==e.currentView||(e.currentView=e.options.injectedView),e.__switchView(e.currentView),delete e.currentView)})),e._viewerSubscriptionHolder.subscribe({event:"onAutoloadStartupView"},(function(){"viewer"!==e.options.injectedView&&e.__switchView("viewer")})),e._viewerSubscriptionHolder.subscribe({event:"onRootAdded"},(function(t){if(!e._during3Drefresh&&!0!==t.fromLoadJSON){if(t.rootLog){var i=d.retrieveData(e.options.structKey);if(t.filterId){t.serviceId||(t.serviceId="3DSpace");var o={filters:{}};o.filters[t.filterId]={associatedProduct:t.id},d.addFilter(i,t.filterId,t.id),d.addOpenFilter(i,[t.filterId]);var s=t.rootLog.map((function(e){return e[0]}));e._previousFilterRootPids?(e._previousFilterRootPids=e._previousFilterRootPids.concat(t.id),s=(s=s.concat(e._previousFilterRootPids)).filter((function(e,t,i){return t===i.indexOf(e)}))):e._previousFilterRootPids=[t.id];var r=s.indexOf(t.id);if(-1!==r&&s.splice(r,1),e._previousFilterRootPids)for(var l=0;l<e._previousFilterRootPids.length;l++){var c=e._previousFilterRootPids[l],p=s.indexOf(c);-1!==p&&s.splice(p,1)}if(s.length){for(var u=[],h=0;h<s.length;h++){var m=s[h];i[m]={},u.push([m])}n.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"products",addedPaths:u}})}d.persistData(e.options.structKey,i),e._previousStoredFilter=t.filterId,n.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"filters",addedFilters:o}})}else if("r2vsurvey"===t.serviceId)i.pCloudServiceId=t.serviceId,d.addPointCloud(i,t.idPath[0],t.soiId),d.addOpenPointCloud(i,t.soiId),n.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"pointclouds",soiId:t.soiId,fsId:t.idPath[0],serviceId:t.serviceId}});else{if(t.serviceId||(t.serviceId="3DSpace"),e.applyFilterProcessed)return void("wafr"!==a.getSetting("eno3dviewer_infrastructure_version")&&e.options.viewer.getContentName({callbacks:{onComplete:function(t){e.options.widget.setTitle(t.contentName)}}}));d.addProductPath(i,t.idPath,!0);var f=[t.idPath];if(d.addOpenProduct(i,f),e._previousStoredFilter&&i&&i.filters&&i.filters[e._previousStoredFilter]){var g=i.filters[e._previousStoredFilter].associatedProduct;g&&i.products[g]&&(delete i.products[g],d.removeOpen(i,g),g===t.idPath[0]&&(f=[])),e._previousStoredFilter=void 0}n.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"products",addedPaths:f}})}d.persistData(e.options.structKey,i),"viewer"!==e.options.injectedView&&!0!==e._isInRefresh&&e.__switchView("viewer")}"wafr"!==a.getSetting("eno3dviewer_infrastructure_version")&&e.options.viewer.getContentName({callbacks:{onComplete:function(t){e.options.widget.setTitle(t.contentName)}}})}})),e._viewerSubscriptionHolder.subscribe({event:"onLoadingFailure"},(function(){var t=e.options.viewer.getController();let i=e.options.welcome._currentLoadRequest;if(i&&l.isAuthoring()&&i.products&&i.filters){let t=Object.keys(i.products),o=Object.keys(i.filters);t=t.concat(o),n.publish({event:"ENXViews/WelcomePanel/cleanup",data:{item2remove:t}}),d.cleanupWasOpens(e.options.structKey)}0===t.getNbRoots()&&!0!==e.applyFilterProcessed&&(n.publish({event:"ENXViews/WelcomePanel/refreshView"}),e.__switchView("welcome"))})),e._viewerSubscriptionHolder.subscribe({event:"onRetrieveFilterFailure"},(function(){0===e.options.viewer.getController().getNbRoots()&&(n.publish({event:"ENXViews/WelcomePanel/refreshView"}),e.__switchView("welcome"))})),e._viewerSubscriptionHolder.subscribe({event:"onRefreshBegin"},(function(t){e._during3Drefresh=!0})),e._viewerSubscriptionHolder.subscribe({event:"onRefreshCompleted"},(function(t){e._during3Drefresh=!1})),e._viewerSubscriptionHolder.subscribe({event:"onEndRootRemoved"},(function(t){if(!e._during3Drefresh&&!e.applyFilterProcessed&&t.ids&&t.ids.length){var i=t.ids;u.removeIdsFromMap(i);var o=[],s=d.retrieveData(e.options.structKey);if((o=d.removeOpen(s,i)).length&&(d.persistData(e.options.structKey,s),n.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"removeFromView",removedFromViewIds:o,dispatch:t.dispatch}})),UWA.is(s,"string")){s=JSON.parse(s);var r,l,c=i.length;for(r=0;r<c;r++)if(s.products&&s.products.hasOwnProperty(i[r])&&(delete s.products[i[r]],o.push(i[r])),s.filters){var p=Object.getOwnPropertyNames(s.filters);for(l=0;l<p.length;l++){var h;s.filters[p[l]].associatedProduct===i[r]?h=i[r]:p[l]===i[r]&&(h=s.filters[p[l]].associatedProduct),h&&(delete s.filters[p[l]],o.push(p[l]))}}o.length>0&&n.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"removeFromView",removedFromViewIds:o,dispatch:t.dispatch}})}0===e.options.viewer.getController().getNbRoots()&&!0!==e.applyFilterProcessed&&n.publish({event:"ENXViews/WelcomePanel/refreshView"}),"wafr"!==a.getSetting("eno3dviewer_infrastructure_version")&&e.options.viewer.getContentName({callbacks:{onComplete:function(t){e.options.widget.setTitle(t.contentName)}}})}})),e._viewerSubscriptionHolder.subscribe({event:"onAutoloadStartupViewLoaded"},(function(){"viewer"!==e.options.injectedView&&e.__switchView("viewer")})),e._viewerSubscriptionHolder.subscribe({event:"onAutoloadStartupViewFailed"},(function(){"welcome"!==e.options.injectedView&&e.__switchView("welcome")})),!0===e._viewerReady&&e._setupReady("viewerReady")},__hookRemoveFromView:function(){var e=this;e._globalSubscriptionHolder.subscribe({event:"ENXViews/WelcomePanel/removeFromView"},(function(t){for(var i=e.options.viewer.getController(),o=[],s=0;s<t.item2remove.length;s++){var r=t.item2remove[s];i.getNode({id:r})&&o.push(r)}(o.length&&i.removeRoots({pids:o},!1),e._customHandler&&"function"==typeof e._customHandler.removeFromView)&&(e._customHandler.removeFromView(e.options.widget,t.item2remove)&&n.publish({event:"/ENXViews/ContentChooser/model/previousContent/refresh/"}));t.customitem2remove&&t.customitem2remove.length&&n.publish({event:"ENXViews/LandingPage/removeFromView",data:{customitem2remove:t.customitem2remove}})}))},__customizeSetup:function(){var e=this;if(e._customHandler){e._globalSubscriptionHolder.subscribe({event:"/ENXViews/WelcomePanel/action/previousContent/"},(function(){var t=n.getModelEvents(),i=e._getStoredStruct();e._customHandler.populate(i).then((function(n){n.length&&t.publish({event:"ENXViews/ContentChooser/model/previousContent",data:{op:"populateAppend",objects:n,allselected:!0}}),e._customHandler.update(i).then((function(e){t.publish({event:"ENXViews/ContentChooser/model/previousContent",data:{op:"update",objects:e,allselected:!0,fromCustom:!0}})}))}))})),e._globalSubscriptionHolder.subscribe({event:"/ENXViews/ContentChooser/model/previousContent/refresh/"},(function(){n.publish({event:"/ENXViews/WelcomePanel/action/previousContent/"})}))}},_getStoredStruct:function(){var e=this.options.widget.getValue("xsceneStoredObjects");return e=UWA.is(e,"string")?JSON.parse(e):{products:{},filters:{}}},_setupReady:function(e){this.options.ready[e]=!0;for(var t=Object.keys(this.options.ready),i=!0,o=0;o<t.length&&i;o++)!1===this.options.ready[t[o]]&&(i=!1);!0===i&&n.publish({event:"ENXViews/WelcomePanel/appReady"})}},m.getDefaultActivities=t.getDefaultActivities,m.launchSearch=function(e){return e.modelEvts=n.getModelEvents(),t.launchSearch(e)},m}));