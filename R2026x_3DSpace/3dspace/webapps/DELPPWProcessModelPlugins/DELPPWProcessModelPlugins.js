define("DS/DELPPWProcessModelPlugins/BI/MfgProcessBIUtils",["UWA/Core","UWA/Class","DS/DELPPWIRPCModel/Collections/BIModelCollection","DS/DELPPWWebServices/WebserviceUtils"],(function(e,t,n,i){"use strict";return t.singleton({name:"MfgProcessBIUtils",init:function(e){this._parent(e),this.biModelCollection=new n,this._systemArray=[],this._itemArray=[],this._itemConfigFilter={},this._sysConfigFilter={}},getMfgItemAssignmentStatus:function(){var t;return e.is(this.biModelCollection)&&(t=this.biModelCollection.where({type:"ItemAssignmentStatus"})),t},getSystemUpdateStatus:function(){var t;return e.is(this.biModelCollection)&&(t=this.biModelCollection.where({type:"SystemUpdateStatus"})),t},getBrokenMfgProcessStatus:function(t,n){var i;(t=t||{}).silent=!0,this._fetchStatus(t,(function(t){e.is(t)&&(i=t.where({type:"SystemUpdateStatus",status:"DirectlyImpacting"}),n(i))}))},_fetchStatus:function(e,t){var n=this;new Promise((function(t){n.isBIComputed()?t():n.fetchBIComputation(e,(function(){t()}))})).then((function(){t(n.biModelCollection)}),(function(){t([])}))},fetchBIComputation:function(t,n){var o,s,r=this,a=function(n){e.is(t.onFailure,"function")&&t.onFailure.call(n)};t=t||{},s=!e.is(t.silent,"boolean")||t.silent,r._systemArray=e.is(t.rootSystems)?t.rootSystems:r._systemArray,r._itemArray=e.is(t.rootItems)?t.rootItems:r._itemArray,r._itemConfigFilter=e.is(t.itemConfigFilter)?t.itemConfigFilter:r._itemConfigFilter,r._sysConfigFilter=e.is(t.sysConfigFilter)?t.sysConfigFilter:r._sysConfigFilter,r._systemArray.length<=0||r._itemArray.length<=0?a():(o={expandLevel:-1,ordered:!0,systemIds:r._systemArray,sysConfigFilter:r._sysConfigFilter,itemIds:r._itemArray,itemConfigFilter:r._itemConfigFilter},i.webServiceRequest({url:"dsmfg/private/V0/invoke/MfgProcess/BI",method:"POST",onComplete:function(e){r._addToBIModelCollection(e,{silent:s}),n instanceof Function&&n()},onFailure:a,onTimeout:a,data:e.Json.encode(o),headers:{Accept:"application/json",SecurityContext:i.getSecurityContext(),"Content-Type":"application/ds-json"}}))},_addToBIModelCollection:function(e,t){var n,i,o,s;for(n in e)if(e.hasOwnProperty(n))for(o in i=e[n])i.hasOwnProperty(o)&&((s=i[o]).id=o,s.type=n,this.biModelCollection.add(s,t))},isBIComputed:function(){return this.biModelCollection.size()>0},resetBIModelCollection:function(){!0===this.isBIComputed()&&this.biModelCollection.reset()},setBIModelEvents:function(e){this.biModelCollection.addEvents(e)},removeBIModelEvents:function(){this.biModelCollection.removeEvents()},computeTotalQtyConsumed:function(t,n){var o,s,r=this,a=function(n){e.is(t.onFailure,"function")&&t.onFailure.call(n)};t=t||{},o=e.is(t.linkPID)?t.linkPID:null,r._systemArray=e.is(t.rootSystems)?t.rootSystems:r._systemArray,r._itemArray=e.is(t.rootItems)?t.rootItems:r._itemArray,r._itemConfigFilter=e.is(t.itemConfigFilter)?t.itemConfigFilter:r._itemConfigFilter,r._sysConfigFilter=e.is(t.sysConfigFilter)?t.sysConfigFilter:r._sysConfigFilter,r._systemArray.length<=0?a():(s={expandLevel:-1,ordered:!0,linkPID:o,systemIds:r._systemArray,sysConfigFilter:r._sysConfigFilter,itemIds:r._itemArray,itemConfigFilter:r._itemConfigFilter},i.webServiceRequest({url:"dsmfg/private/V0/invoke/MfgProcess/ComputeTotalQtyConsumed",method:"POST",onComplete:function(e){n instanceof Function&&n(e)},onFailure:a,onTimeout:a,data:e.Json.encode(s),headers:{Accept:"application/json",SecurityContext:i.getSecurityContext(),"Content-Type":"application/ds-json"}}))}})})),define("DS/DELPPWProcessModelPlugins/Graph/GraphModel",["UWA/Core","UWA/Class/Model","UWA/Class/Debug"],(function(e,t,n){"use strict";return t.extend(n,{name:"GraphModel",_logger:null,idAttribute:"PID",destroy:function(t){return this._parent(e.merge({type:""},t))},setup:function(e,t){}})})),define("DS/DELPPWProcessModelPlugins/ImplementPlugin/ProcessImplementBase",["UWA/Core","DS/DELPPWModelServices/CollectionUtils"],(function(e,t){"use strict";return function(n,i,o,s,r,a,l){var c,u,g,f,d,m,p,h="ImplementBase",P=o,y=s,I=r,C="DELMBOMContextualImplementCnx",S=a;if(l=!e.is(l)||l,!e.is(P))throw new Error("Error: scope link name is not defined!");if(!e.is(I))throw new Error("Error: implment link name is not defined!");return m=function(t){var n=!1;return e.is(t)&&e.is(t.type,"string")&&("BL Error"===t.type||"Specific Error"===t.type)&&e.is(t.message,"string")&&t.message.length>0&&(n=!0),n},c=function(n,i,o){var s=[P];return e.is(i,"string")&&(s=[i]),t.getImpactedConnections(n,null,{isRefRefOnly:!0,relationTypes:s,fromXEN:o})},u=function(n,i,o){var s=[y];return e.is(i,"string")&&(s=[i]),t.getImpactedConnections(n,null,{isRefRefOnly:!0,relationTypes:s,fromXEN:o})},g=function(n,i,o){var s=[S];return e.is(i,"string")&&(s=[i]),t.getImpactedConnections(n,null,{isRefRefOnly:!0,relationTypes:s,fromXEN:o})},f=function(e){var n,o=e;return Array.isArray(e)&&((n=e).length>0?o=t.getInstanceFromCollection(n[n.length-1]).get("isInstanceOf"):(o=null,i.debug(h,"Error: expected reference id for root node"))),o},d=function(n){var o=[];return e.is(n,"function")?o=t.findSomeConnection((function(e){var t=I===e.get("type")||C===e.get("type"),i=!1;return t&&(i=n(e.get("from"),e.get("to"))),t&&i})):i.debug(h,'Error: _getImplementLinks: expected a predicate method "funcHasImplement"'),o},p=function(o,s){var r=s||{},a={onComplete:function(t){e.is(r.onComplete)&&r.onComplete("ImplementPlugin.DeleteImpl.Success",t),e.is(t)&&n.getMediator().notify("updateBIModelFromServerResponse",t)},onFailure:function(t,n){e.is(r.onFailure)&&(m(n)?s.onFailure("ImplementPlugin.DeleteImpl.Failed",n.message):s.onFailure("ImplementPlugin.DeleteImpl.Failed"))}};e.is(o)?t.deleteConn(o,a):(i.debug(h,"Input connection ID is invalid."),r.onFailure("ImplementPlugin.DeleteImpl.Failed"))},{getReferencePID:function(e){return f(e)},filterImplementLinks:function(e){return d(e)},findInstanceWhoseParentIsScoped:function(n){var i,o,s,r,a=null;for(i=n.length-1;i>=0;i--)if(o=t.getInstanceFromCollection(n[i]),e.is(o)&&(r=o.get("isAggregatedBy"),(s=c(r)).length>0)){a={absPathIndex:i,instanceModel:o,scopeLinks:s};break}return a},findInstanceWhoseParentIsPartialScoped:function(n){var i,o,s,r,a=null;for(i=n.length-1;i>=0;i--)if(o=t.getInstanceFromCollection(n[i]),e.is(o)&&(r=o.get("isAggregatedBy"),(s=u(r)).length>0)){a={absPathIndex:i,instanceModel:o,scopeLinks:s};break}return a},getScopedParent:function(t){var n,i=null;return e.is(t,"array")&&t.length>0&&(n=this.findInstanceWhoseParentIsScoped(t),e.is(n)&&(i=n.instanceModel.get("isAggregatedBy"))),i},getPartialScopedParent:function(t){var n,i=null;return e.is(t,"array")&&t.length>0&&(n=this.findInstanceWhoseParentIsPartialScoped(t),e.is(n)&&(i=n.instanceModel.get("isAggregatedBy"))),i},isUnderScope:function(t){var n,o=!1;return e.is(t,"array")?t.length>0&&(n=this.findInstanceWhoseParentIsScoped(t),e.is(n)&&(o=!0)):(i.debug(h,"Error: isUnderScope: expected absolute path"),o=null),o},isUnderPartialScope:function(t){var n,o=!1;return e.is(t,"array")?t.length>0&&(n=this.findInstanceWhoseParentIsPartialScoped(t),e.is(n)&&(o=!0)):(i.debug(h,"Error: isUnderScope: expected absolute path"),o=null),o},isPartialOrFullScoped:function(e){let t=!1;if(this.getScopeLinks(e).length>0)t=!0;else{this.getPartialScopeLinks(e).length>0&&(t=!0)}return t},isScoped:function(e){return this.getScopeLinks(e).length>0},getScopedEBOMFromMBOM:function(t){const n=this.getScopeLinks(t);let i=null;return e.is(n)&&n.length>0&&(i=n[0].getAttribute("to")),i},isPartialScoped:function(e){return this.getPartialScopeLinks(e).length>0},getPartialScopedEBOMFromMBOM:function(t){const n=this.getPartialScopeLinks(t);let i=null;return e.is(n)&&n.length>0&&(i=n[0].getAttribute("to")),i},isResultingLinked:function(e){return this.getResultingProductLinks(e).length>0},getScopeLinks:function(e,t,n){var i=f(e),o=[];return i&&(o=c(i,t,n)),o},getPartialScopeLinks:function(e,t,n){var i=f(e),o=[];return i&&(o=u(i,t,n)),o},getResultingProductLinks:function(e){var t=f(e),n=[];return t&&(n=g(t)),n},getResultingProductLinksOfImplementing:function(e,t){var n,o=f(e),s=[];return o&&(n=g(o,S,t),Array.isArray(n)&&(1===n.length&&n[0].getAttribute("to")!==o?s=n:n.length>1&&i.debug(h,"ERROR: getResultingProductsLinksOfImplementing found more than one scope link for MfgItem: "+e))),s},getResultingProductLinksOfImplemented:function(e){var t,n=f(e),o=[];return n&&(t=g(n,S),Array.isArray(t)&&(1===t.length?o=t:t.length>1&&i.debug(h,"ERROR: getResultingProductsLinksOfImplementing found more than one scope link for MfgItem: "+e))),o},getScopeLinksOfImplemented:function(e){var t,n=f(e),i=[];return n&&(t=c(n,P),Array.isArray(t)&&(i=t)),i},getPathToScope:function(t){var n,i=[];return n=this.findInstanceWhoseParentIsScoped(t),e.is(n)&&(i=t.slice(n.absPathIndex)),i},getPathToPartialScope:function(t){var n,i=[];return n=this.findInstanceWhoseParentIsPartialScoped(t),e.is(n)&&(i=t.slice(n.absPathIndex)),i},getPathToPartialOrFullScope:function(t,i){const o=this.getPathsTillUpperScope(t,i),s=((t,i)=>{let o=null;const s=n.getPlugins("DatabasePlugin").instance,r=this.isUnderPartialScope(t);let a=!1;if(Array.isArray(t)&&t.length>0){let e=t[t.length-1];const n=s.getReferenceIdFromInstance(e);u(n).length>0&&(a=!0)}return(e.is(r)&&r||e.is(a)&&a)&&(o=this.getPathsTillUpperPartialScope(t,i)),o})(t,i);let r=o;return Array.isArray(s)&&Array.isArray(o)?r=((...e)=>{let t=e[0];const n=e.length;for(let i=1;i<n;i++)e[i].length<t.length&&(t=e[i]);return t})(s,o):Array.isArray(s)&&(r=s),r},getPathsTillUpperScope:function(t,n){let i=[],o=!1,s=[];return e.is(t)&&(s=this.getListOfImplementingParentPID(t,!0)),e.is(n)&&(n.reverse().forEach((t=>{if(!o){const n=this.findInstanceWhoseParentIsScoped([t]);if(e.is(n)&&e.is(n.scopeLinks)){n.scopeLinks.forEach((e=>{const t=e.getAttribute("from");s.includes(t)&&(o=!0)}))}i.push(t)}})),n.reverse()),i.reverse()},getPathsTillUpperPartialScope:function(t,n){let i=[],o=!1,s=[];return e.is(t)&&(s=this.getListOfImplementingParentPID(t,!0)),e.is(n)&&(n.reverse().forEach((t=>{if(!o){const n=this.findInstanceWhoseParentIsPartialScoped([t]);if(e.is(n)&&e.is(n.scopeLinks)){n.scopeLinks.forEach((e=>{const t=e.getAttribute("from");s.includes(t)&&(o=!0)}))}i.push(t)}})),n.reverse()),i.reverse()},getListOfImplementingParentPID:function(t,i){let o=[];const s=n.getPlugins("DatabasePlugin").instance;if(Array.isArray(t)){if(t.forEach((e=>{const t=s.getParentReferenceIdFromInstance(e);o.push(t)})),e.is(i)&&!0===i){const e=t[t.length-1],n=s.getReferenceIdFromInstance(e);o.push(n)}}else e.is(t)&&o.push(t);return o},getPathsToScope:function(e,t){return{implementingPathToScope:this.getPathToScope(e),implementedPathToScope:this.getPathToPartialOrFullScope(e,t)}},getImplLinks:function(t){var n,i,o;return e.is(t,"array")?(n=t[t.length-1],i=this.getPathToScope(t),o=d((function(t,o){return n===t||e.Json.encode(i)===e.Json.encode(o)}))):o=null,o},getImplLinksOfImplemented:function(t){var n,i;return Array.isArray(t)?(n=this.getPathToScope(t),i=d((function(t,i){return e.equals(n,i)}))):i=null,i},hasCrossScope:function(n,i,o,s){var r,a,l,g,f,d=[],m=[],p=[],h=[],P=null,y=!1,I=null,C=null,S=!1,L=!1;return f=function(e,t){var n=null;return e.some((function(e){var i=c(e);return(i=i.concat(u(e))).some((function(e){var i=!1,o=e.get("to");return t.indexOf(o)>-1&&(i=!0,n=e),i}))})),n},e.is(s,"array")&&s.length>0&&s.forEach((function(n,o){var r=t.getInstanceFromCollection(n);0===o&&p.push(r.get("isAggregatedBy")),s.length-1!==o?p.push(r.get("isInstanceOf")):e.is(i)||(i=r.get("isInstanceOf"))})),e.is(o,"array")&&o.length>0&&o.forEach((function(i,s){var r=t.getInstanceFromCollection(i);0===s&&d.push(r.get("isAggregatedBy")),o.length-1!==s?d.push(r.get("isInstanceOf")):e.is(n)||(n=r.get("isInstanceOf"))})),e.is(i)&&d.length>0&&t.expandOnBackbone(i,{referencesPID:h,instancesPID:[]}),e.is(n)&&p.length>0&&t.expandOnBackbone(n,{referencesPID:m,instancesPID:[]}),!e.is(P)&&d.length>0&&h.length>0&&(P=f(d,h),e.is(P)&&(S=!0)),!e.is(P)&&m.length>0&&p.length>0&&(P=f(m,p),e.is(P)&&(L=!0)),e.is(P)&&(y=!0,r=P.getAttribute("from"),l=t.getReferenceFromCollection(r),e.is(l)&&(I=l.get("PLMEntity.V_Name")),a=P.getAttribute("to"),g=t.getReferenceFromCollection(a),e.is(g)&&(C=g.get("PLMEntity.V_Name"))),{hasCrossScope:y,implementingName:I,implementedName:C,isParentCrossScope:S,isChildCrossScope:L}},getScopeLinkType:function(){return P},getPartialScopeLinkType:function(){return y},getResultingProductLinkType:function(){return S},getImplementLinkType:function(){return I},getContextualImplementLinkType:function(){return C},deleteImplementLink:function(e,t){p(e,t)},deleteScopeLink:function(n,o){var s;s={onComplete:function(){e.is(o)&&e.is(o.onComplete)&&o.onComplete("ImplementPlugin.DeleteScope.Success")},onFailure:function(t,n){e.is(o)&&e.is(o.onFailure)&&(m(n)?o.onFailure("ImplementPlugin.DeleteScope.Failed",n.message):o.onFailure("ImplementPlugin.DeleteScope.Failed"))}},e.is(n)?t.deleteConn(n,s):(i.debug(h,"Input connection ID is invalid."),s.onFailure("ImplementPlugin.DeleteScope.Failed"))},createImplementLink:function(i,o,s){var r,a,c;s=s||{},c=function(t,n){e.is(s.onFailure,"function")&&(m(n)?s.onFailure("ImplementPlugin.CreateImpl.Failed",n.message):s.onFailure("ImplementPlugin.CreateImpl.Failed"))},l?(i=i.toString(),o=o.toString()):(i=e.Json.encode(i),o=e.Json.encode(o)),r={type:I,IDFrom:i,IDTo:o},e.is(s.connectionParams)&&(r.connectionParams=s.connectionParams),a={onFailure:c,onTimeout:c,onCancel:c,onComplete:function(t){if(e.is(s.onComplete,"function")&&s.onComplete("ImplementPlugin.CreateImpl.Success",t),e.is(t)&&e.is(t.id)){const e={connections:[{PID:t.id}]};n.getMediator().notify("updateBIModelFromServerResponse",e)}},securityContextOverride:s.securityContextOverride},t.createConn(r,a)},createScopeLink:function(i,o,s){var r,a,l=function(t,n){e.is(s.onFailure,"function")&&(m(n)?s.onFailure("ImplementPlugin.CreateScope.Failed",n.message):s.onFailure("ImplementPlugin.CreateScope.Failed"))};s=s||{};const c=e.is(s.copyModelProductToItemUponSL)?s.copyModelProductToItemUponSL:"DoNotCopyModel";r={type:P,IDFrom:i,IDTo:o,copyModelProductToItemUponSL:c},a={onFailure:l,onTimeout:l,onCancel:l,onComplete:function(t){if(e.is(s.onComplete,"function")&&s.onComplete("ImplementPlugin.CreateScope.Success"),e.is(t)&&e.is(t.id)){let e=[];const i={PID:t.id};e.push(i);const o=s.implementLinks;Array.isArray(o)&&o.length>0&&e.push(...o);let r={connections:e};n.getMediator().notify("updateBIModelFromServerResponse",r)}}},t.createConn(r,a)}}}})),define("DS/DELPPWProcessModelPlugins/MfgProcess/MfgProcessPlugin",["UWA/Core","DS/DELPPWModelServices/CollectionUtils","DS/DELPPWWebServices/WebserviceUtils","DS/DELPPWNavigationServices/NavigateUtil","DS/DELPPWModelServices/BehaviorUtil"],(function(e,t,n,i,o){"use strict";return function(o){return{name:"MfgProcessPlugin",webserviceAndProcessing:function(s,r,a){var l,c,u=[],g={instancesAndReferences:[],connections:[]},f=JSON.parse(r),d=function(t,n){e.is(a)&&e.is(a.onFailure)&&a.onFailure(n)};f.rootMfgItemID&&(l=f.rootMfgItemID),n.webServiceRequest({url:e.is(a.url)?a.url:e.is(a.appenedURL)?"dsmfg/private/V0/invoke/MfgProcess/BI/"+a.appenedURL:"dsmfg/private/V0/invoke/MfgProcess/BI",method:s,logMessage:e.is(a.logMessage)?a.logMessage:null,headers:n.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),data:r,context:this,onFailure:d,onTimeout:d,onCancel:d,onComplete:function(n){var s={stackedReferences:[],stackedInstances:[],stackedConnections:[],deletedObjects:[],deletedConnections:[]},r=[],f=[],d=null,m=!1,p=i.getConnectionParser();!function(n){e.is(n.revisedObjects)&&n.revisedObjects.forEach((function(e){e.revisedFrom===l&&(d=e.revisedTo),r.push(e.revisedTo)})),n.instancesAndReferences.forEach((function(e){var t=e.attributesValue;t.hasOwnProperty("isInstanceOf")?(e.queriedForConnections=!0,s.stackedInstances.push(e)):(-1===r.indexOf(t.PID)&&(e.queriedForConnections=!0,e.queriedForDocuments=!0),f.push(t.PID),s.stackedReferences.push(e))})),n.connections.forEach((function(t){p.parse(t,s),g.connections.push(t),e.is(t["from.attributesValue"])&&t["from.attributesValue"].PID===l&&(m=!0)})),e.is(n.reusedReferences)&&(u=n.reusedReferences.filter((function(n){var i=e.is(t.getReferenceFromCollection(n)),o=-1!==f.indexOf(n);return!(i||o)}))),e.is(n.deletedUsagePoints)&&Object.keys(n.deletedUsagePoints).forEach((function(i){var o,s,r,a=n.deletedUsagePoints[i],l=t.getConnectionFromCollection(i);e.is(l)&&e.is(l.get("usagePoint"))&&e.is(a)&&(a.forEach((function(t){for(o=0;o<t.length;o++)s=l.get("usagePoint").findIndex((e=>JSON.stringify(e)===JSON.stringify(t[o]))),e.is(s)&&-1!==s&&l.get("usagePoint").splice(s,1)})),r={data:l,onComplete:function(){console.log("Usage point deleted successfully")},onFailure:function(){console.log("Deletion of Usage point failed")}},t.updateConn(i,r))})),e.is(n.usagePoints)&&Object.keys(n.usagePoints).forEach((function(i){var s,r=n.usagePoints[i],a=t.getConnectionFromCollection(i);e.is(a)&&e.is(a.get("usagePoint"))&&e.is(r)&&(r.forEach((function(e){a.get("usagePoint").push(...e)})),s={data:a,onComplete:function(){o.getMediator().notify("refreshImpacted"),o.getMediator().notify("updateCrossHighlight"),console.log("Usage point rerouted successfully")},onFailure:function(){console.log("Rerouting of Usage point failed")}},t.updateConn(i,s))})),e.is(n.deletedObjects)&&(s.deletedObjects=s.deletedObjects.concat(n.deletedObjects)),e.is(n.deletedConnections)&&(s.deletedConnections=s.deletedConnections.concat(n.deletedConnections)),s.stackedInstances.forEach((function(e){"PROCESS"===e.attributesValue.PPRTYPE&&g.instancesAndReferences.push(e.attributesValue)})),o.getMediator().notify("createMfgItemStructure",g)}(n),0!==s.deletedObjects.length||0!==s.stackedReferences.length||0!==s.stackedInstances.length||0!==s.stackedConnections.length||0!==s.deletedConnections.length||null!==d?(c=function(){var i=[];s.onComplete=function(){if(i.length>0&&o.getMediator().notify("instanceRemoved",[i]),e.is(a)&&e.is(a.onComplete)){if(e.is(n.processRootPID)){let i=t.getReferenceFromCollection(n.processRootPID);e.is(i)&&o.getMediator().notify("referenceAdded",[i])}a.onComplete(l,d,n,m)}},e.is(s.deletedObjects)&&s.deletedObjects.forEach((function(n){var o=t.getInstanceFromCollection(n);e.is(o)&&i.push(o)})),t.addToCollections(s)},e.is(u,"array")&&u.length>0?i.getDescendantsFromServer(u,c,{expandLevel:0,silentMode:!0}):c()):e.is(a)&&e.is(a.onComplete)&&a.onComplete(null,null,n)}})}}}})),define("DS/DELPPWProcessModelPlugins/BI/MfgProcessBIPlugin",["UWA/Core","DS/DELPPWProcessModelPlugins/BI/MfgProcessBIUtils","DS/DELPPWResourceServices/ResourceUtils"],(function(e,t,n){"use strict";return function(i){var o,s="BIPlugin",r=!1,a=[],l=function(){return e.is(o)||(o=i.getPlugins("DicoPlugin").instance),o},c=function(t){var n,o={},r=i.getPlugins("RootsPlugin");return r?(r=r.instance,t.forEach((function(t){if(n=r.getRootFilter(t),e.is(n)&&e.is(n.originalFilterQuery)){let e=n.originalFilterQuery.or.filters[0].and.filters;1===e.length&&(e[0].config_filter||e[0].config_filter_id)?o[t]=e[0]:(o[t]={config_filter:null},i.getLogger().debug(s,"IncompatibleFilter for rootPID : "+t))}else o[t]={config_filter:null}}))):i.getLogger().debug(s,"Roots Plugin unavailble"),o},u=function(o){var a,l,u,g,f,d,m,p={noTimeout:!0},h=i.getPlugins("RootsPlugin");!1!==r&&(f=i.getLogger().log(s,n.getNLSValue("BI.LogMessage"))),t.resetBIModelCollection(),m=!1,h?(d=(h=h.instance).getRoots(s),e.is(d,"array")&&d.length>=2&&(a=d[0],l=d[1],e.is(l,"array")&&l.length>0&&e.is(a,"array")&&a.length>0?m=!0:i.getLogger().warn(s,n.getNLSValue("BI.Computation.NoItemsOrSystems"),f))):i.getLogger().debug(s,"Roots Plugin unavailble"),m?(i.getMediator().notify("startProgress",p),u=c(a),g=c(l),t.fetchBIComputation({rootItems:a,itemConfigFilter:u,rootSystems:l,sysConfigFilter:g,onFailure:function(){i.getMediator().notify("stopProgress",p),i.getMediator().notify("toggleCmdCheckHeaderState",{cmdName:"BIEssentialsCmd",cmdState:!1}),i.getLogger().warn(s,n.getNLSValue("BI.Computation.Failure"),f)}},(function(){var a=t.getMfgItemAssignmentStatus(),l=t.getSystemUpdateStatus();i.getMediator().notify("stopProgress",p),e.is(o,"function")&&o(),!1!==r&&(i.getLogger().info(s,n.getNLSValue("BI.Computation.Success"),f),i.getMediator().notify("updateBIStatus",{ItemAssignmentStatus:a,SystemUpdateStatus:l}))}))):i.getMediator().notify("toggleCmdCheckHeaderState",{cmdName:"BIEssentialsCmd",cmdState:!1})},g=function(e){!0===e.state?(r=!0,u()):(r=!1,t.isBIComputed()&&t.resetBIModelCollection())},f=function(n){var o,r,a,c=!1;if(r=function(t){var n=t.get("type");return e.is(n,"string")?"ProcessImplementLink"===n||"ProcessImplementLinkOcc"===n:(i.getLogger().debug(s,"Connection type is not defined"),!1)},a=function(t){var n,o=l();return n=t.get("type"),e.is(n,"string")?!("PROCESS"!==o.getPPRType(n)||!t.hasChanged("V_NeedDedicatedSystem")):(i.getLogger().debug(s,"Connection type is not defined"),!1)},t.isBIComputed())for(n=e.is(n,"array")?n:[n],o=0;o<n.length&&(n[o].isConnection()&&(c=r(n[o])),n[o].isReference()&&(c=a(n[o])),!c);o++);return c},d=function(e){f(e)&&u()},m=function(n){var o,r,a,l=!1,c=["DELFmiContQuantity_Area.V_ContQuantity","DELFmiContQuantity_Length.V_ContQuantity","DELFmiContQuantity_Mass.V_ContQuantity","DELFmiContQuantity_Volume.V_ContQuantity"];if(t.isBIComputed()){for(n=Array.isArray(n)?n:[n],o=0;o<n.length;o++)if(a=(r=n[o]).get("type"),e.is(a,"string")){if("ProcessInstanceContinuous"===a){l=c.some((function(e){return r.hasChanged(e)}));break}}else i.getLogger().debug(s,"Instance type is not defined");l&&u()}},p=function(n){var o,r,a,l=!1;if(t.isBIComputed()){for(n=Array.isArray(n)?n:[n],r=0;r<n.length;r++){if(a=(o=n[r]).get("PPRTYPE"),!e.is(a)){let e=i.getPlugins("DatabasePlugin");if(e){e=e.instance,a=e.getReferenceModel(o.get("isInstanceOf")).get("PPRTYPE")}}if(e.is(a,"string")){if("OPERATION"===a){l=!0;break}}else i.getLogger().debug(s,"PPRType is not defined")}l&&u()}},h=function(n){var o,r,a,l=!1,c=["ImplementLinkUsageFamily.V_ImplLinkUsage","DELFmiContQuantity_Area.V_ContQuantity","DELFmiContQuantity_Length.V_ContQuantity","DELFmiContQuantity_Mass.V_ContQuantity","DELFmiContQuantity_Volume.V_ContQuantity","DELLmiUsageQuantity_Ratio.V_UsageQuantityRatio"];if(t.isBIComputed()){for(n=Array.isArray(n)?n:[n],o=0;o<n.length;o++)if(a=(r=n[o]).get("type"),e.is(a,"string")){if("ProcessImplementLinkOcc"===a){l=c.some((function(e){return r.hasChanged(e)}));break}}else i.getLogger().debug(s,"Connection type is not defined");l&&u()}},P=function(e){f(e)&&u()},y=function(n){var o,r,a,c=l(),g=!1;if(e.is(n)&&t.isBIComputed()){for(n=e.is(n,"array")?n:[n],o=0;o<n.length;o++)if(r=n[o].get("type"),e.is(r,"string")){if(a=c.getPPRType(r),["PROCESS","SYSTEM","OPERATION"].includes(a)){g=!0;break}}else i.getLogger().debug(s,"Model type is not defined");g&&u()}};return t.init({core:i}),{name:"MfgProcessBIPlugin",onStart:function(){t.setBIModelEvents({onReset:function(e,t,n){i.getMediator().notify("resetBIModel",[e,t,n],{sourceModuleId:s})}}),a.push(i.addExternalListener("BIEssentialsCmd",g)),a.push(i.addExternalListener("referenceChanged",P)),a.push(i.addExternalListener("instanceChanged",m)),a.push(i.addExternalListener("instanceRemoved",p)),a.push(i.addExternalListener("connectionAdded",d)),a.push(i.addExternalListener("connectionChanged",h)),a.push(i.addExternalListener("connectionRemoved",d)),a.push(i.addExternalListener("hideRootNode",y))},onStop:function(){var e,n;for(t.removeBIModelEvents(),e=0,n=a.length;e<n;e++)i.removeExternalListener(a[e]);a=[]},computeBI:function(){u()},getBICmdState:function(){return r},isBIComputed:function(){return t.isBIComputed()},resetBIModelCollection:function(){return t.resetBIModelCollection()},getBrokenMfgProcessStatus:function(e,n){t.isBIComputed()?t.getBrokenMfgProcessStatus(e,n):u((function(){t.getBrokenMfgProcessStatus(e,n)}))},getMfgItemAssignmentStatus:function(){return t.getMfgItemAssignmentStatus()},computeTotalQtyConsumed:function(o,r){!function(o,r){var a,l,u,g,f={noTimeout:!0},d=r||{},m=i.getPlugins("RootsPlugin");g=!1,m?(u=(m=m.instance).getRoots(s),e.is(u,"array")&&u.length>=2&&(a=u[1],e.is(a,"array")&&a.length>0?g=!0:i.getLogger().warn(s,n.getNLSValue("BI.Computation.NoSystems"),void 0))):i.getLogger().debug(s,"Roots Plugin unavailble"),g?(i.getMediator().notify("startProgress",f),l=c(a),t.computeTotalQtyConsumed({linkPID:o,rootSystems:a,sysConfigFilter:l,onFailure:function(){i.getMediator().notify("stopProgress",f),e.is(d.onFailure,"function")&&d.onFailure()}},(function(t){i.getMediator().notify("stopProgress",f),e.is(d.onComplete,"function")&&d.onComplete(t)}))):e.is(d.onFailure,"function")&&d.onFailure()}(o,r)}}}})),define("DS/DELPPWProcessModelPlugins/ImplementPlugin/ProcessImplementPlugin",["UWA/Core","DS/DELPPWModelServices/CollectionUtils","DS/DELPPWProcessModelPlugins/ImplementPlugin/ProcessImplementBase","text!DS/DELPPWProcessModelPlugins/assets/RolesOnImplementLink.json"],(function(e,t,n,i){"use strict";return function(o){const s="ProcessImplementLink",r="ProcessImplementLinkOcc",a="PartialProcessImplementLink",l=["DELFmiContQuantity_Area.V_ContQuantity","DELFmiContQuantity_Length.V_ContQuantity","DELFmiContQuantity_Mass.V_ContQuantity","DELFmiContQuantity_Volume.V_ContQuantity","DELLmiUsageQuantity_Ratio.V_UsageQuantityRatio"];var c,u,g,f,d,m,p,h,P,y,I,C,S,L,v,A,k,D,E,F,R,M,O,T,b,_,N,B,V,Q,U=[],x=[];return C=function(){return e.is(c)||(c=o.getPlugins("DicoPlugin").instance),c},S=function(){return e.is(u)||(u=o.getPlugins("DatabasePlugin").instance),u},L=function(){return e.is(g)||(g=o.getPlugins("ResourcePlugin").instance),g},v=function(){return e.is(f)||(f=o.getPlugins("BIPlugin").instance),f},A=function(){return e.is(d)||(d=o.getPlugins("WebServicePlugin").instance),d},y=function(t){var n,i=[],o=C();return Object.keys(h).forEach((function(n){o.isAKindOf(t,n)&&(i=h[n],i=e.clone(i))})),n=M(i),i.concat(n)},I=function(e,t){var n,i=C(),o=null;return Object.keys(P).forEach((function(s){i.isAKindOf(e,s)&&(n=P[s],Object.keys(n).forEach((function(e){i.isAKindOf(t,e)&&(o=P[s][e])})))})),o},k=function(e){let t=e.from,n=e.to,i=t[t.length-1],o=n[n.length-1],s=S(),r=s.getImpacted(i,!1,{relationTypes:["ProcessImplementLinkOcc"]}).filter((function(e){var t=e.get("to");return t[t.length-1]===o}));r.length>0&&s.removeConnection(r[0].get("PID"))},D=function(e,t){e[e.length-1];var n,i=t[t.length-1],o=S(),s=C(),r=!1;return(this.validateIfScoped(e,t)||this.validateIfPartialScoped(e,t))&&(r=!this.getImplLinksOfImplementing(e).some((function(e){return e.getAttribute("to")===i}))),n=o.getReferenceModel(i),s.isAKindOf(n,"DELServiceSpareItemReference")&&(r=!1),r},E=function(){A().webServiceRequest({url:"delmia/param/configuration/getParameters?domainID=DigitalManufacturing&familyID=OOTBRolesLayoutView&paramID=OOTBRolesLayoutTreeListView&argID=OOTBRolesLayoutTreeListViewArg",method:"GET",onComplete:function(e){var t,n,i=L(),o=i.getCountryCodesForLanguage(widget.lang),s=[];!(U=e)||!U.length>0||U.forEach((e=>{for(t in e)if(o.includes(t)){n=String(e[t]);break}s["Role."+e.rolecusto]=n||String(e.rolecusto),i.addNlsJSON(s,!0),n=null}))},onFailure:function(){console.log("Failure to fetch custom roles")}})},T=function(){A().webServiceRequest({url:"delmia/param/configuration/getParameters?domainID=DigitalManufacturing&familyID=ActionsOnOpItemImplLinkLayoutView&paramID=ActionsOnOpItemImplLinkTreeListView&argID=ActionsOnOpItemImplLinkTreeListViewArg",method:"GET",onComplete:function(e){var t,n,i=L(),o=i.getCountryCodesForLanguage(widget.lang),s=[];!(x=e)||!x.length>0||x.forEach((e=>{for(t in e)if(o.includes(t)){n=String(e[t]);break}s["Action."+e.action]=n||String(e.action),i.addNlsJSON(s),n=null}))},onFailure:function(){console.log("Failure to fetch actions")}})},M=function(t){var n,i,o=[];if(e.is(t))for(n of Array.isArray(t)?t:[t])(i=R(n)).length>0&&o.push(...i);return o},R=function(t){var n=[];return e.is(t)&&(t=t.toString(),n=U.filter((e=>e.roleootb===t&&e.rolecusto!==t)).map((e=>e.rolecusto))),n},F=function(t){var n,i;if(e.is(t))for(i of(n=t.toString(),U))if(i.rolecusto===O(n))return i.roleootb;return t},O=function(t){var n,i=L();if(e.is(t))for(n of(t=t.toString(),U))if(i.getNLSValue("Role."+n.rolecusto)===t)return n.rolecusto;return t},b=function(){var e=L(),t=[];return x.forEach((n=>{t.push({value:n.action,NLS:e.getNLSValue("Action."+n.action)})})),t},_=function(t){var n,i,o=S().getReference(t),s=[{fullName:"DELFmiRefQuantity_Mass.V_RefQuantity"},{fullName:"DELFmiRefQuantity_Area.V_RefQuantity"},{fullName:"DELFmiRefQuantity_Length.V_RefQuantity"},{fullName:"DELFmiRefQuantity_Volume.V_RefQuantity"}];if(!e.is(o))return null;for(let t=0;t<s.length;t++)if(n=s[t].fullName,i=o.get(n),e.is(i)&&""!==i){let e=V(s[t].fullName);return{magnitude:e.Magnitude,value:i,fullName:e.FullName}}},N=function(t){var n,i,o=S(),s=e.is(t,"array")?t[t.length-1]:t,r=o.getInstance(s)||o.getReference(s)||o.getConnection(s),a=[{fullName:"DELFmiContQuantity_Area.V_ContQuantity"},{fullName:"DELFmiContQuantity_Length.V_ContQuantity"},{fullName:"DELFmiContQuantity_Mass.V_ContQuantity"},{fullName:"DELFmiContQuantity_Volume.V_ContQuantity"},{fullName:"DELLmiUsageQuantity_Ratio.V_UsageQuantityRatio"}];if(!e.is(r))return null;for(let t=0;t<a.length;t++)if(n=a[t].fullName,i=r.get(n),e.is(i)&&""!==i){let e=V(a[t].fullName);return{magnitude:e.Magnitude,value:i,fullName:e.FullName}}},B=function(t){var n,i,o=S(),s=e.is(t,"array")?t[t.length-1]:t,r=o.getInstance(s);if(e.is(r)&&(i=N(r),n=e.is(i)?i.magnitude:null),!e.is(n)){let t=o.getReferenceModel(s),i="DELFmiMagnitudeExt.V_DimensionType";n=e.is(t)?t.get(i):null}return n},V=function(e){return C().getAttributeInfo(e)},Q=function e(t,n){var i=S();return t.hasChildren()&&t.getChildren(!0).forEach((function(t){let o=i.getImpacted(t.getInstancePID(),!0,{relationTypes:["ProcessImplementLinkOcc"]});0===o.length?e(t,n):o.forEach((function(e){let t=i.transformToRIROccurrencePath(e);n.push(t)}))})),n},m=new n(o,o.getLogger(),s,a,r),e.extend(m,{name:"ProcessImplementPlugin",onStart:function(){p=e.Json.decode(i),P=p.DefaultRoles,h=p.Roles,E(),T()},isImplementLinkValidForOccPath:function(n,i,o){var s,r,a,l,c=!1,u=!1,g=!1;return s=this.getPathToScope(o),(e.equals(n,s)||e.equals(i,s))&&(c=!0),r=this.getPathToPartialScope(o),(e.equals(n,r)||e.equals(i,r))&&(u=!0),a=t.getReferenceModel(n),l=this.getReferencePID(o),e.is(a)&&e.equals(a._attributes.type,"DELLmiHeaderOperationReference")&&this.isPartialScoped(a.id)&&e.equals(a.id,l)&&(g=!0),c||u||g},canCreateScopeLink:function(n){var i,o,r,a,l,c,u,g,f,d,m=s,p=L(),h=!0,P={};return o=n.fromSideRefPID,r=n.toSideRefPID,a=n.fromSideAbsPath,l=n.toSideAbsPath,this.isScoped(o)&&(i=this.getScopeLinks(o),e.is(i,"array")&&i.length>0&&i.some((function(n){var i=n.get("from"),s=n.get("to");return t.isInstance(s)&&(s=t.getInstanceFromCollection(s).get("isInstanceOf")),e.equals(i,o)&&e.equals(s,r)}))&&(h=!1,g=t.getReferenceModel(o),d=p.getNLSValue("ImplementBehavior.Validation.ScopeLinkExists",{objectName:g.get("PLMEntity.V_Name")}))),(h&&e.is(a,"array")&&a.length>0||e.is(l,"array")&&l.length>0)&&(f=this.hasCrossScope(o,r,a,l),e.is(f)&&f.hasCrossScope&&(f.isParentCrossScope?d=p.getNLSValue("ImplementBehavior.Validation.ParentCrossScopeExists",{implementingRef:f.implementingName,implementedRef:f.implementedName}):f.isChildCrossScope&&(d=p.getNLSValue("ImplementBehavior.Validation.ChildCrossScopeExists",{implementingRef:f.implementingName,implementedRef:f.implementedName})),h=!1)),e.is(n.fromSideInstPID)&&e.is(n.toSideInstPID)?(c=n.fromSideInstPID,u=n.toSideInstPID):(c=n.fromSideRefPID,u=n.toSideRefPID),P={canCreateLink:h,data:{type:m,implementingPID:c,implementedPID:u,implementingAbsPath:n.fromSideAbsPath,implementedAbsPath:n.toSideAbsPath,displayText:p.getNLSValue(m,null,"CreateLink"),buttonIdentifier:p.getNLSValue(m,null,"CreateLink")}},h||(P.errorMessage=d),P},getImplLinksOfImplementing:function(t){var n,i,o=[];return Array.isArray(t)&&t.length>0?(i=this.getPathToScope(t),n=this.filterImplementLinks((function(t,n){return e.equals(i,t)})),Array.isArray(n)&&(o=n)):o=null,o},getScopeLinksOfImplementing:function(e,t){var n=m.getReferencePID(e),i=[];return n&&m.getScopeLinks(n,s,t).forEach((e=>{e.getAttribute("to")!==n&&i.push(e)})),i},getPartialScopeLinksOfImplementing:function(e,t){var n=m.getReferencePID(e),i=[];return n&&m.getPartialScopeLinks(n,a,t).forEach((e=>{e.getAttribute("to")!==n&&i.push(e)})),i},canCreatePartialScopeLink:function(n){var i,o,s,r,l,c,u,g,f,d=m.getReferencePID(n),p=C(),h=S(),P=L(),y={errorMessage:null,linksData:[]};return l=h.getReference(d),p.isAKindOf(l,"DELLmiHeaderOperationReference")?(i=this.findInstanceWhoseParentIsScoped(n),0===(o=e.is(i,"object")?i.scopeLinks:[]).length?y.errorMessage=P.getNLSValue("LinkBehavior.canCreatePartialScopeLinkError.NoScopeOnParent"):(g=o[0].get("from"),f=h.getReference(g),c=p.isAKindOf(f,"DELLmiWorkPlanSystemReference")||p.isAKindOf(f,"DELLmiServiceWorkPlanSystemReference")||p.isAKindOf(f,"DELLmiHeaderWorkPlanReference")||p.isAKindOf(f,"DELLmiServiceHeaderWorkPlanReference"),u=p.isAKindOf(f,"DELLmiGeneralSystemReference"),c||u?((r=this.getImplLinksOfImplementing(n)).length>0&&(y.implLinks=r),o.forEach((function(e){t.isInstance(e.get("to"))?(s=h.getReferenceIdFromInstance(e.get("to")),h.hasConnection({from:d,to:e.get("to"),type:a})&&(y.errorMessage=P.getNLSValue("LinkBehavior.canCreatePartialScopeLinkError.LinkAlreadyExists"))):s=e.get("to"),y.linksData.push({IDFrom:d,IDTo:s,type:a,implementingAbsPath:n})})),y.linksData=y.linksData.filter((function(e){var t=function(e){var t,n=e.IDFrom,i=e.IDTo,o=(e.implementingAbsPath,S()),s=L(),r=!0,l={};return r&&o.hasConnection({from:n,to:i,type:a})&&(r=!1,t=s.getNLSValue("LinkBehavior.canCreatePartialScopeLinkError.LinkAlreadyExists")),l.canCreateLink=r,r?(delete e.implementingAbsPath,l.data=e):l.errorMessage=t,l}(e);return!0===t.canCreateLink})),0===y.linksData.length&&(y.errorMessage=P.getNLSValue("ImplementBehavior.CreateMGAPartialScopeLink.MatchedWithFirstUpperScope",{implementinRef:l.get("PLMEntity.V_Name")}))):y.errorMessage=P.getNLSValue("LinkBehavior.canCreatePartialScopeLinkError.HasImplemenLink"))):y.errorMessage=P.getNLSValue("LinkBehavior.canCreatePartialScopeLinkError.NoHeaderOperation"),y},canCreateImplementLink:function(t){var n,i,o,s,a,l=r,c=S(),u=L(),g={},f={};return i=this.isPartialScoped(t.fromSideAbsPath)?[t.fromSideRefPID]:t.fromSideAbsPath,o=t.toSideAbsPath,n=D.call(this,i,o),f={canCreateLink:n,data:[]},n&&(g={type:l,implementingAbsPath:i,implementedAbsPath:o,displayText:u.getNLSValue(l,null,"CreateLink"),buttonIdentifier:u.getNLSValue(l,null,"CreateLink")},g=e.merge(g,e.clone(t)),f.data.push(g),s=o[o.length-1],a=c.getReferenceModel(s).get("type"),y(a).forEach((function(n){var s,r,a,c;s=u.getNLSValue("Role."+n),r=u.getNLSValue(l+".roles",{role:s},"CreateLink"),U.forEach((function(e){e.rolecusto===n&&(c=e.roleootb)})),a={type:l,implementingAbsPath:i,implementedAbsPath:o,displayText:r,buttonIdentifier:r,connectionParams:{role:n,roleootb:c||n}},a=e.merge(a,e.clone(t)),f.data.push(a)}))),f},hasPartialScopeLinks:function(e){var t=e.get("PID"),n=[];return C().isAKindOf(e,"DELLmiHeaderOperationReference")&&(n=this.getPartialScopeLinksOfImplementing(t)),n.length>0},createHOPMfgItemPartialScopeLink:function(n,i){var o,s,a=L(),l=S(),c=A(),u={info:[]},g=this,f=[];n.forEach((function(e){var t=l.getReference(e.IDFrom).get("PLMEntity.V_Name"),n=l.getReference(e.IDTo).get("PLMEntity.V_Name");u.info.push(t+" To "+n)})),l.getParentInstancesFromCollection(n[0].IDFrom).forEach((e=>{var t=this.getPathToScope([e.id]);Array.isArray(t)&&t.length>0&&f.push(t)})),s={connectionParams:n,instancesList:f},o={url:"dsmfg/private/V0/MfgElement/connection/CreateMGAPartialScopeLink",method:"POST",data:e.Json.encode(s),context:g,onComplete:function(n){var o=l.getConnectionParser(),s={stackedReferences:[],stackedConnections:[]};e.is(n.connections)&&n.connections.forEach((function(e){o.parse(e,s)})),s.stackedConnections.forEach((function(e){e.type===r&&k.call(g,e)})),e.is(n.deletedConnections)&&n.deletedConnections.forEach((function(e){t.removeConnection(e)})),l.addToCollections({stackedConnections:s.stackedConnections,silentMode:!1,onComplete:function(){var t=a.getNLSValue("ImplementBehavior.CreateMGAPartialScopeLink.Success",{info:u.info.join()});e.is(i.onSuccess,"function")&&i.onSuccess(t)}})},onFailure:function(){var t=a.getNLSValue("ImplementBehavior.CreateMGAPartialScopeLink.Failed",{info:u.info.join()});e.is(i.onFailure,"function")&&i.onFailure(t)}},c.webServiceRequest(o)},setUsagePoints:function(t,n,i){var o,a=A(),l=S();n===s?o="dsmfg/private/V0/MfgElement/connection/serviceProcess/createUsagePoints":n===r&&(o="dsmfg/private/V0/MfgElement/connection/serviceProcess/assignImplementLinkToUsagePoints"),a.webServiceRequest({url:o,method:"POST",data:e.Json.encode(t),onComplete:function(o){var a=!1,c=l.getConnection(t.connPID),u=l.getConnection(t.implementLinkId),g=l.getConnectionParser(),f={stackedReferences:[],stackedConnections:[]};e.is(o.connections)&&o.connections.length>0&&(n===r&&e.is(u)&&(o.connections[0].attributesValue.type=n),o.connections.forEach((function(e){g.parse(e,f)})),f.stackedConnections.forEach((function(t){e.is(t.usagePoint)?(a=!0,n===s&&e.is(c)&&e.is(c.get("usagePoint"))&&t.usagePoint.push(...c.get("usagePoint"))):a=!1})),a?l.addToCollections({stackedConnections:f.stackedConnections,silentMode:!1,onComplete:function(){e.is(i.onSuccess,"function")&&i.onSuccess()},onFailure:function(t,n){e.is(i.onSuccess,"function")&&i.onFailure(n)}}):e.is(i.onSuccess,"function")&&i.onFailure("no usage point to set"))},onFailure:function(t,n){e.is(i.onSuccess,"function")&&i.onFailure(n)}})},deleteUsagePoint:function(t,n){var i=A(),o=S();i.webServiceRequest({url:"dsmfg/private/V0/MfgElement/connection/serviceProcess/deleteUsagePoint",method:"DELETE",data:e.Json.encode(t),onComplete:function(i){var s,r,a=o.getConnection(t.pid);e.is(i.deletedConnections)&&i.deletedConnections.length>0&&i.deletedConnections.forEach((function(e){o.removeConnection(e)})),e.is(a)&&(-1!==(r=a.get("usagePoint").indexOf(t.pathOfInstanceIds[0]))&&a.get("usagePoint").splice(r,1),s={data:a,onComplete:function(){e.is(n.onSuccess,"function")&&n.onSuccess()},onFailure:function(t,i){e.is(n.onSuccess,"function")&&n.onFailure(i)}},o.updateConnection(t.pid,s))},onFailure:function(t,i){e.is(n.onSuccess,"function")&&n.onFailure(i)}})},unassignImplementLinkFromUsagePoints:function(t,n){var i=A(),o=S();i.webServiceRequest({url:"dsmfg/private/V0/MfgElement/connection/serviceProcess/unassignImplementLinkFromUsagePoints",method:"DELETE",data:e.Json.encode(t),onComplete:function(i){var s=o.getConnection(t.implementLinkId);i.isAssignmentRemoved&&e.is(s)&&e.is(s.get("usagePoint"))&&(s.get("usagePoint").splice(0,1),e.is(n.onSuccess,"function")&&n.onSuccess())},onFailure:function(t,i){e.is(n.onSuccess,"function")&&n.onFailure(i)}})},switchScope:function(t,n,i){var o=S();A().webServiceRequest({url:"dsmfg/private/V0/invoke/MfgProcess/switchScope",method:"POST",data:e.Json.encode(t),onComplete:function(s){o.setScope(s.connections[0],n,t.isRefInstRefScope),e.is(i.onSuccess,"function")&&i.onSuccess()},onFailure:function(t,n){e.is(i.onSuccess,"function")&&i.onFailure(n)}})},validateIfScoped:function(n,i){var o,r,a,l,c=!1,u=C();return e.is(n,"array")&&n.length>0?(o=t.getInstanceFromCollection(n[n.length-1]),e.is(o)&&(a=o.get("isInstanceOf"),r=this.getScopeLinks(a),e.is(r,"array")&&0===r.length&&(a=this.getScopedParent(n)))):t.isReference(n)&&(a=n),l=t.getReferenceModel(a),e.is(i,"array")&&i.length>0&&!u.isAKindOf(l,"DELLmiHeaderWorkPlanReference")&&!u.isAKindOf(l,"DELLmiServiceHeaderWorkPlanReference")&&(c=i.slice().reverse().some((function(n){var i=!1,o=t.getInstanceFromCollection(n);return e.is(o)&&(i=t.hasConnection({to:o.get("isAggregatedBy"),from:a,type:s})),i}))),c},validateIfPartialScoped:function(n,i){var o,s,r,l,c=!1;return e.is(n,"array")&&n.length>0?(o=t.getInstanceFromCollection(n[n.length-1]),e.is(o)?(r=o.get("isInstanceOf"),s=this.getPartialScopeLinks(r),e.is(s,"array")&&0===s.length&&(r=this.getPartialScopedParent(n))):r=n[0]):t.isReference(n)&&(r=n),l=t.getReferenceModel(r),e.is(l)&&e.is(i,"array")&&i.length>0&&(c=i.slice().reverse().some((function(n){var i=!1,o=t.getInstanceFromCollection(n);return e.is(o)&&(i=t.hasConnection({to:o.get("isAggregatedBy"),from:r,type:a})),i}))),c},getPathsToScope:function(n,i){var o,s,r=null,a=null,l=null,c=null,u={},g=!1,f=function(e){var t=null;return e.some((function(e){var n=!1,o=s.lastIndexOf(e.get("to"));return o>-1&&(t=i.slice(o),n=!0),n})),t};return s=[],i.forEach((function(e){var n=t.getInstanceFromCollection(e);s.push(n.get("isAggregatedBy"))})),o=this.findInstanceWhoseParentIsPartialScoped(n),e.is(o)?(l=n.slice(o.absPathIndex),(c=f(o.scopeLinks))&&(u={implementingPathToScope:l,implementedPathToScope:c}),g=!0):1===n.length&&this.isPartialScoped(n[0])&&(l=n,(c=f(o=this.getPartialScopeLinks(n[0])))&&(u={implementingPathToScope:n,implementedPathToScope:c}),g=!0),g||(o=this.findInstanceWhoseParentIsScoped(n),e.is(o)&&(r=n.slice(o.absPathIndex),(a=f(o.scopeLinks))&&(u={implementingPathToScope:r,implementedPathToScope:a}))),u},getUsagePointsForTargetScopes:function(t){var n=[];return t.forEach((function(t){t.get("type")===s&&e.is(t.get("usagePoint"))&&t.get("usagePoint").length>0&&n.push(...t.get("usagePoint"))})),n},getRolesForTargrtObject:function(e){var t=S(),n=t.getConnection(e).get("to"),i=n[n.length-1],o=t.getReferenceModel(i).get("type");return y(o)},getRoleFromModelOrComputed:function(t){var n,i,o,s,r,a,l,c,u,g=S(),f=L(),d=g.getConnection(t),m=d.get("PLMEntity.V_usage");return e.is(m)&&"NULL"!==m?u=f.getNLSValue("Role."+m):(n=d.get("from"),i=d.get("to"),o=Array.isArray(n)?n[n.length-1]:n,s=Array.isArray(i)?i[i.length-1]:i,r=g.getReferenceModel(o),a=g.getReferenceModel(s),l=r.get("type"),c=a.get("type"),m=I(l,c),u="*"+f.getNLSValue("Role."+m)),{usage:m,nlsText:u}},getImpactedObjects:function(t,n,i,o){var l=[];return e.is(o)&&(o=Array.isArray(o)?o:[o]).forEach((function(o){var c,u,g,f,d,m=o.get("type"),p=o.get("from"),h=o.get("to");switch(m){case s:case a:d=p===t?h:p;break;case r:c=p[p.length-1],u=p.toString(),g=h[h.length-1],f=h.toString(),i=Array.isArray(i)?i.toString():i,n===c&&i.indexOf(u)>-1?d=h:n===g&&i.indexOf(f)>-1&&(d=p);break;default:console.log("Invalid Type")}e.is(d)&&l.push(d)})),l},getConnectedObjects:function(t,n,i,o){var l=[];return e.is(o)&&(o=Array.isArray(o)?o:[o]).forEach((function(o){var c,u,g,f,d,m=o.get("type"),p=o.get("from"),h=o.get("to");switch(m){case s:case a:d=p===t?h:p;break;case r:c=p[p.length-1],u=p.toString(),g=h[h.length-1],f=h.toString(),i=Array.isArray(i)?i.toString():i,n===c&&i.indexOf(u)>-1?d=h:n===g&&i.indexOf(f)>-1&&(d=p);break;default:console.log("Invalid Type")}Array.isArray(d)?l.push({ctxPath:[],occPath:d}):e.is(d)&&l.push({ctxPath:[],objectPID:d})})),l},addCustoRoleToLinkData:function(e){var t;L();if(Array.isArray(U))for(t of U)if(t.rolecusto===e["MfgProductionPlanning.V_usage"])return e["MfgProductionPlanning.V_usage"]=t.rolecusto,e["ImplementLinkUsageFamily.V_ImplLinkUsage"]=t.roleootb,e;return e["ImplementLinkUsageFamily.V_ImplLinkUsage"]=e["MfgProductionPlanning.V_usage"],e},getOotbRoleFromCustoRole:function(e){return F(e)},getCustoRoleFromNLS:function(e){return O(e)},getActions:function(){return b()},getActionsFromConnection:function(t){var n=L(),i=S().getConnection(t).get("ImplementLinkUsageFamily.V_Action"),o=[];return e.is(i,"array")&&i.forEach((e=>{let t=n.getNLSValue("Action."+e);t=t==="Action."+e?"__"+e:t,o.push({action:e,nlsText:t})})),o},getRefQuantityAttribute:function(e){return _(e)},getQuantityInfoFromConnection:function(t){const n=L(),i=S().getConnection(t),o=N(i);let s;if(e.is(o)){const[t,i]=`${o.value}`.split(" ");if(i)s=t+" "+n.getNLSForUnit(o.magnitude,i);else{const i=widget.getPreference(o.magnitude),r=e.is(i)?i.value:"Ratio"===o.magnitude?"PERCENTAGE":null;s=t+" "+(e.is(r)?n.getNLSForUnit(o.magnitude,r):n.getNLSForUnit(o.magnitude))}}return s},getQuantityInfoFromModel:function(t){const n=L(),i=N(t);let o;if(e.is(i)){const[t,s]=`${i.value}`.split(" ");if(s)o=t+" "+n.getNLSForUnit(i.magnitude,s);else{const s=widget.getPreference(i.magnitude),r=e.is(s)?s.value:"Ratio"===i.magnitude?"PERCENTAGE":null;o=t+" "+(e.is(r)?n.getNLSForUnit(i.magnitude,r):n.getNLSForUnit(i.magnitude))}}return o},getQuantityAttributeFromModel:function(e){return N(e)},getDimensionTypesForQty:function(t){var n=L(),i=S().getConnection(t).get("to"),o=B(i),s=[{Name:n.getNLSValue("ImplementBehavior.ImplementLink.Magnitude"),NLS:n.getNLSValue("ImplementBehavior.ImplementLink.Magnitude"),value:e.is(o)?o.toUpperCase():o}];return N(i)&&s.push({Name:n.getNLSValue("ImplementBehavior.ImplementLink.Ratio"),NLS:n.getNLSValue("ImplementBehavior.ImplementLink.Ratio"),value:"Ratio"}),s},getSelectedDimensionTypeFromConnection:function(t){var n,i,o,s=S().getConnection(t);return n=N(s),e.is(n)?i=n.magnitude:(o=B(s.get("to")),i=e.is(o)?o.toUpperCase():o),i},validateQuantityToEdit:function(t,n){var i,o=S().getConnection(t),s=N(o);return i=Object.keys(n).find((e=>e.includes("DELFmiContQuantity")||e.includes("DELLmiUsageQuantity"))),e.is(s)&&(e.is(i)&&""===n[i]?n[i]="0":e.is(i)||(n[s.fullName]="0")),e.is(i)&&(n[i]=""!==n[i]?n[i].replaceAll(",","."):"0"),n},getQuantityConsumedInfo:function(t){var n,i,o,s,r,a,l,c,u=S(),g=L(),f={};const d="purple",m="red",p="green",h="FullyAssigned",P="PartiallyAssigned",y="OverAssigned",I={FullyAssigned:g.getNLSValue("ImpementLink.QtyConsumedInfo.Fully_Assigned"),PartiallyAssigned:g.getNLSValue("ImpementLink.QtyConsumedInfo.Partially_Assigned"),OverAssigned:g.getNLSValue("ImpementLink.QtyConsumedInfo.Over_Assigned"),remainingQuantityInfo:function(e,t){return g.getNLSValue("ImpementLink.QtyConsumedInfo.RemainingQuantity",{remainingQuantity:e,instanceQty:t})},overAssignedQuantityInfo:function(e,t){return g.getNLSValue("ImpementLink.QtyConsumedInfo.OverAssignedQuantity",{overAssignedQuantity:e,instanceQty:t})},partiallyAssignedInfo:function(e){return g.getNLSValue("ImpementLink.QtyConsumedInfo.Partially_Assigned_Info",{remainingQuantity:e})},overAssignedInfo:function(e){return g.getNLSValue("ImpementLink.QtyConsumedInfo.Over_Assigned_Info",{overAssignedQuantity:e})}};if(n=e.is(t,"string")?u.getConnection(t).get("QuantityConsumedInfo"):t,e.is(n)&&e.is(n.IsInstanceQtyExist))if(l=n.AddRoleCount,c=n.RemoveRoleCount,n.IsInstanceQtyExist){i=n.Instance_Quantity,o=n.Instance_QtyAttr_Dimension,s=n.Total_Quantity_Consumed,r=n.RemainingQuantity,a=n.OverAssignedQuantity;let e=n.Instance_QtyAttr_FullName,t=parseFloat(i.split(" ")[0]),u=parseFloat(s.split(" ")[0]),C=s.split(" ")[1],S=g.getNLSForUnit(o,C),L=parseFloat(r.split(" ")[0])+" "+S,v=parseFloat(a.split(" ")[0])+" "+S,A=t+" "+S;u===t?(f.qtyConsumedInfo=I.remainingQuantityInfo(L,A),f.colorCode=d,f.BITooltip=I.FullyAssigned,f.BIStatus=h):u<t?(f.qtyConsumedInfo=I.remainingQuantityInfo(L,A),f.colorCode=p,f.BITooltip=I.partiallyAssignedInfo(L),f.BIStatus=P):(f.qtyConsumedInfo=I.overAssignedQuantityInfo(v,A),f.colorCode=m,f.BITooltip=I.overAssignedInfo(v),f.BIStatus=y);let k=n.AddRoleCount_With_QtyNotExist,D=n.RemoveRoleCount_With_QtyNotExist;k>=1?(1===k&&1===l?(f.BITooltip=I.FullyAssigned,f.BIStatus=h):(f.BITooltip=I.OverAssigned,f.BIStatus=y),c>=1&&1===k&&(f.BITooltip=I.PartiallyAssigned,f.BIStatus=P)):D>=1&&(f.BITooltip=I.PartiallyAssigned,f.BIStatus=P),f.instQty=i,f.totalConsumedQty=s,f.InstanceQtyAttrFullName=e}else l>=1?(f.BITooltip=I.FullyAssigned,f.BIStatus=h):c>=1&&(f.BITooltip=I.PartiallyAssigned,f.BIStatus=P);return f},computeTotalQtyConsumed:function(t,n){var i,o,s,r=v(),a=S(),l=n||{},c=function(){e.is(l.onFailure)&&l.onFailure()};s=(o=(i=a.getConnection(t)).get("to"))[o.length-1],"ProcessInstanceContinuous"!==a.getInstance(s).get("type")?c():e.is(N(s))?r.computeTotalQtyConsumed(t,{onComplete:function(t){e.is(t)&&t.hasOwnProperty("QuantityConsumedInfo")&&i.set("QuantityConsumedInfo",t.QuantityConsumedInfo,{silent:!0}),e.is(l.onComplete)&&l.onComplete()},onFailure:function(){i.set("QuantityConsumedInfo",null,{silent:!0}),e.is(l.onFailure)&&l.onFailure()}}):(i.set("QuantityConsumedInfo",null,{silent:!0}),c())},validateQtyValue:function(e){var t,n=e||{},i=Object.keys(n),o=L(),s={};for(t=0;t<i.length;t++)if(l.some((function(e){return i[t]===e}))){let e=n[i[t]].split(" "),r=parseFloat(e[0]);(r<=0||!isFinite(r))&&(s.errorMsg=o.getNLSValue("Error.InvalidQuantity.Title"));break}return s},getDimensionOfItem:function(e){return B(e)},getAllScopedOrImplementedItems:function(t){let n=S(),i=[],o=[],s=[];return i=n.getImpacted(t.getReferencePID(),!0,{relationTypes:["ProcessImplementLink"]}),0===i.length&&e.is(t.getInstancePID())?(o=n.getImpacted(t.getInstancePID(),!0,{relationTypes:["ProcessImplementLinkOcc"]}),0===o.length?s=Q(t,s):o.forEach((function(e){let t=n.transformToRIROccurrencePath(e);s.push(t)}))):i.forEach((function(e){let t=n.transformToRIROccurrencePath(e);s.push(t)})),s},findUpperScopeLinks:function(e){return this.findInstanceWhoseParentIsScoped(e)},findUpperPartialScopeLinks:function(e){return this.findInstanceWhoseParentIsPartialScoped(e)}})}})),define("DS/DELPPWProcessModelPlugins/Graph/GraphCollection",["UWA/Class/Collection","UWA/Class/Debug","DS/DELPPWProcessModelPlugins/Graph/GraphModel"],(function(e,t,n){"use strict";return e.extend(t,{name:"GraphCollection",model:n,setup:function(){}})})),define("DS/DELPPWProcessModelPlugins/Graph/EGraphUtils",["UWA/Core","UWA/Class","DS/DELPPWModelServices/CollectionUtils","DS/DELPPWProcessModelPlugins/Graph/GraphCollection"],(function(e,t,n,i){"use strict";const o=[{img:"ProcessImplementLink",linkType:"scope",displayed:!0},{img:"PartialProcessImplementLink",linkType:"partialscopeOnHeaderOperation",displayed:!0},{img:"ProcessImplementLinkOcc",linkType:"implement",displayed:!0},{img:"DELLmiProductionSystemOutputCnxToMBOM",linkType:"output",displayed:!0},{img:"MfgProcessAlternate",linkType:"alternate",displayed:!0},{img:"HistorizationLinkRefRef",linkType:"origin",displayed:!0},{img:"DELAsmProcessCanUseCnx",linkType:"capableResources",displayed:!0},{img:"SecondaryCandidateResourceLink",linkType:"secondaryCapableResources",displayed:!0},{img:"DELLmiTimeConstraintCnx",linkType:"productFlow",displayed:!0},{img:"CapableResourcesStructureLink",linkType:"capableResourcesStructure",displayed:!0},{img:"DELAssetsStructureLink",linkType:"capableResourceAssetStructure",displayed:!0},{img:"AllocatedResourceLink",linkType:"preAssignedWorkcenterLink",displayed:!0}],s=[{name:"scope",typeAssociated:"ProductImplementLink"},{name:"scope",typeAssociated:"ProcessImplementLink"},{name:"partialscopeOnHeaderOperation",typeAssociated:"PartialProcessImplementLink"},{name:"implement",typeAssociated:"ProcessImplementLinkOcc"},{name:"origin",typeAssociated:"HistorizationLinkRefRef"},{name:"alternate",typeAssociated:"MfgProcessAlternate"},{name:"output",typeAssociated:"DELLmiProductionSystemOutputCnxToMBOM"},{name:"capableResources",typeAssociated:"DELAsmProcessCanUseCnx"},{name:"secondaryCapableResources",typeAssociated:"SecondaryCandidateResourceLink"},{name:"productFlow",typeAssociated:"DELLmiTimeConstraintCnx"},{name:"productFlow",typeAssociated:"DELLmiMaterialPathCnxCust"},{name:"productFlow",typeAssociated:"LinearProductFlowCnx"},{name:"capableResourcesStructure",typeAssociated:"CapableResourcesStructureLink"},{name:"capableResourceAssetStructure",typeAssociated:"DELAssetsStructureLink"},{name:"preAssignedWorkcenterLink",typeAssociated:"AllocatedResourceLink"}];var r=function(e,t){var n={PID:"",links:[],childOccurencePath:"",index:0};return n.PID=e.get("isInstanceOf"),n.instancePID=e.get("PID"),n.childOccurencePath=t.concat([e.get("PID")]).toString(),n};return t.singleton({name:"EGraphUtils",init:function(e){e=e||{},this._parent(e)},setup:function(t){var n;n=(t=t||{}).supportedLinks||[],this.linkTypeName=new e.Class.Collection([],{}),s.forEach((e=>{n.includes(e.typeAssociated)&&this.linkTypeName.add(e)})),this.creatableTypesOfLink=new e.Class.Collection([],{}),o.forEach((e=>{n.includes(e.img)&&this.creatableTypesOfLink.add(e)}))},addInstances:function(t,i,o,s,r){var a,l,c,u,g=null,f=null,d=0,m=null,p=null,h=null,P=null;if(e.is(i)){if(g=i,f=i,d=t.findWhere({referencePID:i.get("PID")}).get("X")+1,e.is(i.id))for(P=n.getInstancesFromCollection(i.id),n.sortInstancesByTreeOrder(P),u=P.length-1;u>=0;u--)c=P[u],h=n.getReferenceModelFromInstance(c),e.is(h)&&-1!==this.getType(h.get("PPRTYPE"))&&(a=e.is(r)?r+","+c.id:c.id,s.unshift([h,d,g.id,a,c.id]));e.is(s[0],"array")&&s[0].length>=5&&(e.is(s[0][0])&&(m=e.is(s[0][0].id)?s[0][0].id:null,p=s[0][3]),t.add({PID:p,X:s[0][1],Type:o,isAggregatedBy:s[0][2],childOccurencePath:s[0][3],instancePID:s[0][4],referencePID:m,LINKS:this.getReferenceReferenceLinks(m)}),f=s[0][0],l=s[0][3],s.shift(),this.addInstances(t,f,o,s,l))}},getInstanceInstanceLink:function(t){var i,o,s,r,a,l,c,u,g,f,d=[],m=this;Array.prototype.push.apply(d,n.connections.where({type:"ProcessImplementLinkOcc"})),Array.prototype.push.apply(d,n.connections.where({type:"DELLmiMaterialPathCnxCust"})),Array.prototype.push.apply(d,n.connections.where({type:"DELLmiTimeConstraintCnx"})),Array.prototype.push.apply(d,n.connections.where({type:"LinearProductFlowCnx"})),Array.prototype.push.apply(d,n.connections.where({type:"AllocatedResourceLink"})),Array.prototype.push.apply(d,n.connections.where({type:"DEFAULT"})),d.forEach((function(d){if(i=d.get("from").toString(),o=d.get("to").toString(),"DELLmiTimeConstraintCnx"===d.get("type")||"LinearProductFlowCnx"===d.get("type")||"DELLmiMaterialPathCnxCust"===d.get("type"))for(s=t.filter((function(e){return(u=e.get("PID")).length-u.indexOf(i)-i.length==0})),a=t.filter((function(e){return(u=e.get("PID")).length-u.indexOf(o)-o.length==0})),c=new e.Class.Collection([],{}),g=0;g<s.length;g++)for(r=s[g].get("PID").split(",")[0],r=n.getInstanceFromCollection(r),f=0;f<a.length;f++)l=a[f].get("PID").split(",")[0],l=n.getInstanceFromCollection(l),r.get("isAggregatedBy")===l.get("isAggregatedBy")&&(c.add({PID:d.get("PID"),from:s[g].get("PID"),to:a[f].get("PID"),type:d.get("type")}),c.add(s[g].get("LINKS")._models),m.isConnectionTypeAllowed(c._models[0]._attributes.type)&&s[g].set({LINKS:c}));else s=t.filter((function(e){return e.id.contains(i)})),a="AllocatedResourceLink"===d.get("type")?n.references.where({PID:d.get("to")}):t.filter((function(e){return e.id.contains(o)})),s.length>0&&a.length>0&&((c=new e.Class.Collection([],{})).add({PID:d.get("PID"),from:i,to:o,type:d.get("type")}),c.add(s[0].get("LINKS")._models),m.isConnectionTypeAllowed(c._models[0]._attributes.type)&&s[0].set({LINKS:c}))}))},getReferenceReferenceLinks:function(t){var i,o,s=new e.Class.Collection([],{}),r=n.connections.where({from:t});for(i=0;i<r.length;i++)"DELAsmProcessCanUseCnx"===(o=r[i]).get("type")&&n.connections.where({from:o.get("PID")}).forEach((function(e){(e=e.clone()).set("from",t),r.push(e)})),this.isConnectionTypeAllowed(o.get("type"))&&n.references.where({PID:o.get("to")}).length>0&&s.add(o);return s},getType:function(e){switch(e){case"PRODUCT":return 0;case"PROCESS":case"SERVICE":case"CONSTRUCTION":return 1;case"SYSTEM":case"OPERATION":return 2;case"RESOURCE":return 3;default:return-1}},isConnectionTypeAllowed:function(t){var n,i;return(i=this.linkTypeName.findWhere({typeAssociated:t}))&&(n=this.creatableTypesOfLink.findWhere({linkType:i._attributes.name})),!!e.is(n)&&n._attributes.displayed},setLinkDisplayStatus:function(e,t){this.creatableTypesOfLink.findWhere({linkType:e}).set("displayed",t)},getCreatableTypesOfLink:function(){return this.creatableTypesOfLink},getEGraphData:function(e){var t,o,s=new i,r=[],a=this;return e.forEach((function(e){t=n.getReferenceFromCollection(e),o=a.getType(t.get("PPRTYPE")),s.add({PID:t.id,X:0,Type:o,isAggregatedBy:null,referencePID:t.id,LINKS:a.getReferenceReferenceLinks(t.id)}),a.addInstances(s,t,o,r)})),this.getInstanceInstanceLink(s),s},getProductFlowData:function(t,i){var o,s,a=n.references,l=n.connections,c=n.instances.where({isAggregatedBy:t}),u=new e.Class.Collection([],{}),g=this;return c.forEach((function(t){var n=a.findWhere({PID:t.get("isInstanceOf")}).get("PPRTYPE");n=e.is(n)?n:"",2===g.getType(n)&&(s=r(t,i),l.filter((function(e){var n=e.get("from");return n[n.length-1]===t.get("PID")})).forEach((function(t){o=c.find((function(e){var n=t.get("to");return n[n.length-1]===e.get("PID")})),e.is(o)&&a.where({PID:o.get("isInstanceOf")}).forEach((function(e){s.links.push([e.get("PID"),t])}))})),u.push(s))})),u},isProductFlowLooped:function(t){var n,i,o,s,r,a,l=[],c=new e.Class.Collection([],{}),u=new e.Class.Collection([],{}),g=0;for(i=function(e){return e.get("links").length>0},n=t.filter(i),l=n;l.length>0;)s=o,o=l[0],c.add(o),o.get("links").forEach((function(n){a=c.findWhere({PID:n[0]}),e.is(a)||(r=t.findWhere({PID:n[0]}),e.is(r)&&r.set({index:o.get("index")+1})),u.add({from:o.get("PID"),to:n[0]}),u.where({from:o.get("PID"),to:n[0]}).length>5*t.length?(u.reset(),e.is(s)&&s.set({loopNode:!0}),g++):e.is(a)&&l.splice(1,0,t.findWhere({PID:n[0]}))})),l.shift();return g},getProductFlowGraphInstance:function(e,t){return r(e,t)}})})),define("DS/DELPPWProcessModelPlugins/Graph/EGraphPlugin",["UWA/Core","DS/DELPPWProcessModelPlugins/Graph/EGraphUtils"],(function(e,t){"use strict";return function(n){var i,o;return o=function(){return e.is(i)||(i=n.getPlugins("DicoPlugin").instance),i},{name:"EGraphPlugin",onStart:function(){var e,i=o(),s=[];n.getLogger().debug("EGraphPlugin - onStart"),["PRODUCT","PROCESS","SERVICE","SYSTEM","OPERATION","RESOURCE","CONSTRUCTION"].forEach((t=>{e=i.getAllConfiguredRelations(t,"read"),s=[...new Set([...s,...e])]})),t.setup({supportedLinks:s})},getEGraphDataToDisplay:function(e){return t.getEGraphData(e)},setLinkDisplayStatus:function(e,n){t.setLinkDisplayStatus(e,n)},getCreatableTypesOfLink:function(){return t.getCreatableTypesOfLink()},getProductFlowDataToDisplay:function(e,n){return t.getProductFlowData(e,n)},isProductFlowDataLooped:function(e){return t.isProductFlowLooped(e)},getType:function(e){return t.getType(e)},getProductFlowGraphInstance:function(e,n){return t.getProductFlowGraphInstance(e,n)}}}}));