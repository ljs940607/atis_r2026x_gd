define("DS/3DPlayDMUExperience/3DPlayDMUExperience",["DS/3DPlayExperienceModule/PlayExperience3D","DS/Visualization/ThreeJS_DS","DS/DMUReadPersistence/DMUReviewPersistenceServices","DS/DMUBaseUIControllers/DMUReviewContextInitializer","DS/DMUBaseUIServices/DMUSlidePreferences","DS/DMUBaseExperience/EXPImportServices","DS/DMUControls/EXPNotify","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMU2DSheetManager","DS/DMUBaseExperience/EXPManagerSet","DS/DMUPlaySlide/controllers/DMUSlideShowController","DS/CATWebUXComponents/DMUCommandsManager","DS/DMUBaseUIControllers/DMUSlidesController","DS/DMUBaseUIControllers/DMUCommentsController","DS/DMUReadPersistence/DMUWebServicesUtils","DS/DMUBaseUIControllers/DMUApplicativeContextManager","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/CATWebUXSelectionManager/CATWebUXSelectionManager","DS/CATWebUXComponents/CATWebUXUtils","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUReadPersistence/DMULoadingContextController","DS/CATWebUXSlideDrop/CATWebUXSlideDropServices","DS/3DPlay/3DPlay","DS/DMUBaseUIWafrComponents/DMUApplicativeManagerComponent","i18n!DS/3DPlayDMUExperience/assets/nls/3DPlayDMUExperience"],(function(e,t,n,o,r,i,a,l,s,c,d,p,u,D,m,g,C,f,w,y,x,M,h,v,P,S){"use strict";var V;return e.extend({init:function(e){var b,A,U,R,I,T,k,E,W,F,O,L,j,_=new n,B=!1,X=this,N=!0,G=!1,q=!1,H={},J="";let z,K,Q=null,Y=!1,Z="Perspective",$=!1,ee=!1,te="selectParentReference",ne=!1;function oe(e){var t={lastCommand:[],currentCommand:null,defaultCommand:null},n=X.pad3DViewer.getCommandContext();n?p._commandsState[n]=t:p._commandsState=t,p.resetDefaultCommand(n),p._isCommandEnding=!1,p._ignoreCommandBeginWhileEndingCommand=!1,["_commands","_cmdCheckHeader"].forEach((function(e){var t=n&&p[e]?p[e][n]:p[e];t&&Object.keys(t).forEach((function(e){var n=t[e];n&&n._destroy&&n._destroy(),delete t[e]}))}));var o=X.pad3DViewer.getFrameWindow().getActionBar(),r=o.onActionBarReady((function(){o.removeCallback(r),setTimeout(e.actionBarReadyCb,500)}));X.pad3DViewer.loadActionBar({file:e.file,module:e.module})}function re(e,t){var n=function(){if(X.pad3DViewer){var e=p.getCommandCheckHeader("WebDocumentBookmarksPanelCmdHdr",X.pad3DViewer.getCommandContext());if(e){let n=localStorage.getItem("DMUBookmarksPanelDisplayed");"true"!==n&&("false"===n||"Requirement"!==t&&"Requirement Specification"!==t)||e.setState(!0),A&&A.documentHasBookmarks()?e.enable():e.disable()}const s=D.giveDMUCommentsController({context:X.frmWindow,commandContext:X.pad3DViewer.getCommandContext()});var n;(e=p.getCommand("WebDocumentRotatePagesLeftCmdHdr",X.pad3DViewer.getCommandContext()))&&(A&&"Document"===A.getDocumentType()?e.enable():e.disable()),(e=p.getCommand("WebDocumentRotatePagesRightCmdHdr",X.pad3DViewer.getCommandContext()))&&(A&&"Document"===A.getDocumentType()?e.enable():e.disable()),(e=p.getCommand("DMUNextCommentCmdHdr",X.pad3DViewer.getCommandContext()))&&(s&&s.hasComments()?e.enable():e.disable()),(e=p.getCommand("DMUPreviousCommentCmdHdr",X.pad3DViewer.getCommandContext()))&&(s&&s.hasComments()?e.enable():e.disable()),l.getReviewContext({context:X.pad3DViewer})&&l.getReviewContext({context:X.pad3DViewer}).getCurrentSessionMarkup()&&(n=l.getReviewContext({context:X.pad3DViewer}).getCurrentSessionMarkup());let c,d=void 0!==T?JSON.parse(T):void 0;if(d&&d.asset&&d.asset.Play3DXContent&&d.asset.Play3DXContent.data&&d.asset.Play3DXContent.data.items[0]&&(c=d.asset.Play3DXContent.data.items[0].currentSlideId),n){var o=n.getSlides();!1===(c&&o.some((e=>e.getAttribute("sID")===c)))&&(c=void 0);var r=c||n.getAttribute("sCurrentSlideId"),i=u.giveDMUSlidesController({context:X.frmWindow});if(X.autoReframe=!1,i){if("string"==typeof r){for(var a=0;a<o.length;a++)if(o[a].getAttribute("sID")===r){i.setActiveSlide(o[a]);break}}else o.length&&i.setActiveSlide(o[0]);i.updateHeaderCommandsAvailability()}}s&&s.updateHeaderCommandsAvailability()}};J!==e?("ITF"===e?oe({file:"3DPlayDMUAndITFSection.xml",module:"3DPlayDMUExperience",actionBarReadyCb:n}):"Document"===e?oe({file:"3DPlayDMUExperienceDocument.xml",module:"3DPlayDMUExperience",actionBarReadyCb:n}):"3D"===e?oe({file:"3DPlayDMUExperience.xml",module:"3DPlayDMUExperience",actionBarReadyCb:n}):"2D"===e?oe({file:"3DPlayDMUDrawingExperience.xml",module:"3DPlayDMUExperience",actionBarReadyCb:n}):"MSR"===e?oe({file:"3DPlayDMUMSRExperience.xml",module:"3DPlayDMUExperience",actionBarReadyCb:n}):"2DTable"===e&&oe({file:"3DPlayDMUFMEAExperience.xml",module:"3DPlayDMUExperience",actionBarReadyCb:n}),J=e):n()}function ie(e){R||(R=g.getDMUApplicativeContextManager({context:X.pad3DViewer})).initApplicativeContainer(e,{onReady:function(e){e&&e.length&&e.forEach((function(e){"POI"!==e.getApplicativeContainerID()&&e.setActiveState(!0)}))}})}function ae(){if(G&&q){var e;X.pad3DViewer.getRootBagPath().getChildrenPathes()[0]&&(e=x.getNodeType(X.pad3DViewer.getRootBagPath().getChildrenPathes()[0].getLastElement(!0)));var t=X.pad3DViewer.getApplicativeData().getLoadedItfData&&X.pad3DViewer.getApplicativeData().getLoadedItfData().data.length?"ITF":"Drawing"===e||"DIFLayout"===e||"DIFSheet"===e?"2D":"FailureModesEffectsAnalysis"===e?"2DTable":"Document"===e||"Requirement"===e||"Requirement Specification"===e?"Document":"DesignSight"===e?"MSR":"3D";ie(t),"Document"!==t||"DXF"!==U.getLoadMarkupCtxType()&&"DWG"!==U.getLoadMarkupCtxType()||(t="2D"),re(t),"Document"===t&&X.pad3DViewer.getViewpoint().setDefaultController(!0,"CATIA"),(L=w.getSelectionManager({context:X.pad3DViewer})).setActiveState(!0),(O=C.getPreferenceManager({context:X.pad3DViewer.getFrameWindow()}))&&(O.setUnitsPreferencesDisplayFlag(!0),O.setDisplayPreferencesDisplayFlag(!0),O.set3DSelectionPreferencesDisplayFlag(!0),O.set2DSelectionPreferencesDisplayFlag(!0),O.setMeasurePreferencesDisplayFlag(!0),O.setClippingPreferencesDisplayFlag(!0),O.addPreferences([{nls:S.preferences.markupSectionTitle,id:"MarkupPreferences",type:"section",preferences:[{nls:S.preferences.SlideTitleDisplayLbl,id:"DisplaySlideTitle",type:"checkbox",getValue:function(){return"true"===localStorage.getItem("CATWebUXMePreferences_DisplaySlideTitle")},getDefaultValue:function(){return!1},setValue:function(e){e!==("true"===localStorage.getItem("CATWebUXMePreferences_DisplaySlideTitle"))&&localStorage.setItem("CATWebUXMePreferences_DisplaySlideTitle",e?"true":"false")}},{nls:S.preferences.compareSectionTitle,id:"ComparePreferences",type:"section",preferences:[{nls:S.preferences.firstProductColor,id:"CompareFirstColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_CompareFirstColor")?localStorage.getItem("CATWebUXMePreferences_CompareFirstColor"):"#CC092F"},getDefaultValue:function(){return"#CC092F"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_CompareFirstColor",e)}},{nls:S.preferences.secondProductColor,id:"CompareSecondColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_CompareSecondColor")?localStorage.getItem("CATWebUXMePreferences_CompareSecondColor"):"#6FBC4B"},getDefaultValue:function(){return"#6FBC4B"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_CompareSecondColor",e)}},{nls:S.preferences.compare3DCommonColor,id:"Compare3DCommonColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_Compare3DCommonColor")?localStorage.getItem("CATWebUXMePreferences_Compare3DCommonColor"):"#D3D3D3"},getDefaultValue:function(){return"#D3D3D3"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_Compare3DCommonColor",e)}},{nls:S.preferences.compare2DCommonColor,id:"Compare2DCommonColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_Compare2DCommonColor")?localStorage.getItem("CATWebUXMePreferences_Compare2DCommonColor"):"#000000"},getDefaultValue:function(){return"#000000"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_Compare2DCommonColor",e)}}]}]}]),O.setPreferredPreferenceContainersOrder(["MarkupPreferences","MeasurePreferences","SectionPreferences","ComparePreferences"]),Q=O.subscribe("com.ds.mep:onPrefUpdate",(function(e){let t=JSON.parse(e[1].preferences);for(let e=0;e<t.repositories.length;e++)for(let n=0;n<t.repositories[e].preferences.length;n++)"SelectParentReferenceOr3DShape"===t.repositories[e].preferences[n].name?(te=t.repositories[e].preferences[n].value,L&&L.selectParentReference("select3DShape"!==te)):"Select3DGeometry"===t.repositories[e].preferences[n].name?($="true"===t.repositories[e].preferences[n].value,L&&L.setPicking($?0:1)):"Select2DGeometry"===t.repositories[e].preferences[n].name?(ee="true"===t.repositories[e].preferences[n].value,L&&X.pad3DViewer.getViewer().get2DMode()&&L.setPicking(ee?0:1)):"ProjectionType"===t.repositories[e].preferences[n].name?(Z=t.repositories[e].preferences[n].value,X.pad3DViewer&&X.pad3DViewer.getViewer()&&X.pad3DViewer.getViewer().currentViewpoint&&X.pad3DViewer.getViewer().currentViewpoint.setProjectionType("Perspective"===Z?0:1)):"Gravity"===t.repositories[e].preferences[n].name&&(Y="true"===t.repositories[e].preferences[n].value,X.pad3DViewer&&X.pad3DViewer.getViewer()&&X.pad3DViewer.getViewer().currentViewpoint&&X.pad3DViewer.getViewer().currentViewpoint.control&&(X.pad3DViewer.getViewer().currentViewpoint.getControl().setRotationRolling(!Y),X.pad3DViewer.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!Y)))})),f.readPreferences([{Repository:"VisualizationRepository",PreferenceNames:["Gravity"]},{Repository:"FrameGeneral",PreferenceNames:["ProjectionType"]},{Repository:"SelectionRepository",PreferenceNames:["Select3DGeometry","SelectParentReferenceOr3DShape","Select2DGeometry"]}]).then((e=>{let t=e.repositories;for(let e=0;e<t.length;e++)if("VisualizationRepository"===t[e].name)Y="true"===t[e].preferences[0].value;else if("FrameGeneral"===t[e].name)Z=t[e].preferences[0].value;else if("SelectionRepository"===t[e].name){let n=t[e].preferences;for(let e=0;e<n.length;e++)"Select3DGeometry"===n[e].name?$="true"===n[e].value:"Select2DGeometry"===n[e].name?ee=n[e].value:"SelectParentReferenceOr3DShape"===n[e].name&&(te=n[e].value)}X.pad3DViewer.getViewer().get2DMode()?L&&L.setPicking(ee?0:1):("boolean"==typeof Y&&(X.pad3DViewer.getViewer().currentViewpoint.getControl().setRotationRolling(!Y),X.pad3DViewer.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!Y)),"Perspective"!==Z&&"Parallel"!==Z||X.pad3DViewer.getViewer().currentViewpoint.setProjectionType("Perspective"===Z?0:1),L&&L.setPicking($?0:1),L&&L.selectParentReference("select3DShape"!==te))})).catch((e=>{X.pad3DViewer.getViewer().get2DMode()?(L&&L.setPicking(ee?0:1),window.console.warn("Could not get server value, default value set instead.",e)):("boolean"==typeof Y&&(X.pad3DViewer.getViewer().currentViewpoint.getControl().setRotationRolling(!Y),X.pad3DViewer.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!Y)),"Perspective"!==Z&&"Parallel"!==Z||X.pad3DViewer.getViewer().currentViewpoint.setProjectionType("Perspective"===Z?0:1),L&&L.setPicking($?0:1),L&&L.selectParentReference("select3DShape"!==te),window.console.warn("Could not get server value, default value set instead.",e))})))}}function le(){if(!q){if(q=!0,l.getReviewContext({context:X.pad3DViewer})&&l.getReviewContext({context:X.pad3DViewer}).getCurrentSessionMarkup()){var e;X.pad3DViewer.getRootBagPath().getChildrenPathes()[0]&&(e=x.getNodeType(X.pad3DViewer.getRootBagPath().getChildrenPathes()[0].getLastElement(!0)));var t=X.pad3DViewer.getApplicativeData().getLoadedItfData&&X.pad3DViewer.getApplicativeData().getLoadedItfData().data.length?"ITF":"Drawing"===e||"DIFLayout"===e||"DIFSheet"===e?"2D":"FailureModesEffectsAnalysis"===e?"2DTable":"Document"===e||"Requirement"===e||"Requirement Specification"===e?"Document":"DesignSight"===e?"MSR":"3D";if(U||(U=M.getLoadingContextController({context:X.pad3DViewer})),"DXF"!==U.getLoadMarkupCtxType()&&"DWG"!==U.getLoadMarkupCtxType()||(t="2D"),ie(t),re(t,e),"Document"===t&&(X.pad3DViewer.getViewpoint().setDefaultController(!0,"CATIA"),A||(A=c.getManager({name:"DMU2DSheetManager",context:X.frmWindow})),!A.isADocumentDisplayed())){let n=l.giveEventsController({viewer:X.pad3DViewer.getViewer()}),o=n.addEvent("on2DDocumentLoadSuccess",(()=>{n.removeEvent(o),re(t,e)}))}k||(k=new d({context:X.pad3DViewer})).subscribe("onActiveStateModified",(function(e){N=!e.state})),B||(r.setSlidePreferences({context:X.frmWindow,preferences:{displayNominal:!0}}),B=!0)}ae()}}function se(e,t){return t?Promise.resolve(e):(n={objectId:e,serviceId:"r2vsurvey"},new Promise(((e,t)=>{require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt"],(function(o,r){require("DS/WAFData/WAFData").authenticatedRequest(o.getPlatformURL(n.serviceId)+"/enovia/resources/r2v/modeler/v2/featureofinterest/"+n.objectId+"/activities",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":r.getSetting("lang")},timeout:6e4,onComplete:function(t){let n=JSON.parse(t);e(n)},onFailure:t,onTimeout:t})}))}))).then((e=>e.result[0].resourceid));var n}function ce(e){if(!G&&void 0!==e.reviewId){let t;t="Markup"===e.reviewType?_.getDnDReviewAndJSONFile:_.getMarkupStream,t({markupId:e.reviewId,markupType:e.reviewType,markupOwner:e.owner,relatedSubContext:e.subContext},(function(t){var n,a={},s=null,c=null,p=async function(){var n=l.getReviewContext({viewer:X.pad3DViewer.getViewer()});let a;n||(n=await o.createReviewContext({context:X.pad3DViewer})),e&&e.Play3DXContent&&e.Play3DXContent.data&&e.Play3DXContent.data.items[0]&&(a=e.Play3DXContent.data.items[0].currentSlideId);let s=t.jsonObj.Model[0].Slides;a&&s?.some((e=>e.id===a))&&(t.jsonObj.Model[0].CurrentSlideId=a);var c=new i({viewer:X.frmWindow.getViewer(),experience:n,appType:"3dPlay"});c.importDataModel(t.jsonObj,(function(o){c.postImport();const i=o[0].getMarkupContent?o[0].getMarkupContent():o[0];i&&i.setMaturityState(e.reviewState),n.setCurrentSessionMarkup(i),n.setReadOnly(!0),n.refreshNode(),U||(U=M.getLoadingContextController({context:X.pad3DViewer})),n.setReviewCtxInformation({contextId:e.physicalid,subContextId:e.subContext&&e.subContext.id?e.subContext.id:void 0,subContext:e.subContext,contextType:U?U.getLoadMarkupCtxType():j,reviewId:t.reviewPid,reviewName:e.displayname,reviewType:t.reviewType,modifiable:t.modifiable,owner:t.owner,tempObjectInfo:U?U.getTempObjectInformations():void 0}),G=!0,r.setSlidePreferences({context:X.frmWindow,preferences:{panelTitle:e.displayname}}),ae()}))};t.jsonObj.Contexts?(e.refresh&&p(),U||(U=M.getLoadingContextController({context:X.pad3DViewer})),"Document"===e.dtype||"Specification Report"===e.dtype?(t.jsonObj.Contexts[0].documentVersionInfos&&(n=t.jsonObj.Contexts[0].documentVersionInfos),a.objectId=e.physicalid,a.objectType="Document",e.subContext&&e.subContext.id&&(a.subContext=e.subContext),a.documentType=t.jsonObj.Contexts[0].documentType,a.fileId=n?n.fileId:"",a.displayName=e.relatedObjectTitle,a.cbOK=async function(){await p()},a.appInfo="X3DPLAW_AP",U.load({data:a})):(c=t.jsonObj.Contexts[0].listData,s=t.jsonObj.Contexts[0].loadingInfos,c&&0!==c.length?(a.objectId=c,a.objectType="PLMPIMMetricReference",a.loadMode=s,a.appInfo="X3DPLAW_AP",a.cbOK=function(){p()},U.load({data:a})):(a.objectId=e.physicalid,a.objectType="SIMItfSimulation",a.loadMode=s,a.appInfo="X3DPLAW_AP",a.cbOK=function(){p()},U.load({data:a})))):"Requirement"===e.dtype||"Requirement Specification"===e.dtype?(U||(U=M.getLoadingContextController({context:X.pad3DViewer})),a.objectId=e.physicalid,a.objectType=e.dtype,a.displayName=e.relatedObjectTitle,a.cbOK=function(){p()},a.appInfo="X3DPLAW_AP",U.load({data:a})):"FailureModesEffectsAnalysis"===e.dtype?(U||(U=M.getLoadingContextController({context:X.pad3DViewer})),a.objectId=e.physicalid,a.objectType=e.dtype,a.loadMarkup=p,a.cbFmeaLoaderLoaded=function(e){(I=new P({applicativeCommentControllerIDs:["FMEALoaderForDesignValidation"]})).getExecutionContext=function(){let t={getComponent:function(t){switch(t){case"FMEALoaderForDesignValidation":return e;case"Viewer":return X.pad3DViewer}}};return t},I.initialize(),X.onModelLoadingStarted(),X.onModelLoadingCompleted()},U.load({data:a})):p();k||(k=new d({context:X.pad3DViewer})).subscribe("onActiveStateModified",(function(e){N=!e.state})),B||(r.setSlidePreferences({context:X.frmWindow,preferences:{displayNominal:!0}}),B=!0)}),(function(){b&&b.destroy(),b=new a({body:X.frmWindow.getUIFrame(),type:"error",message:S.noMarkup})}))}}V=null,this.internalLoad=function(e){if(K||window.require(["DS/PADUtils/PADCommandProxy"],(e=>{K=e.create({events:{onSelect:function(e){let t=l.giveEventsController({viewer:X.pad3DViewer.getViewer()});t&&t.fireEvent("onCrossWidgetSelection",e)}}})})),l.removeReviewContext({context:X.pad3DViewer}),T=e?JSON.stringify(e):null,e){var t=e.asset.physicalid,n=e.asset.type;if(t){var o=function(){b&&b.destroy(),b=new a({body:X.frmWindow.getUIFrame(),type:"error",message:S.loadError})};let r;r="Markup"===e.asset.type?_.getProductByMarkerId:_.getMarkupInfos,r(e.asset,(function(r){var i,a,d,p=e.asset;if(r&&r.MarkupContext&&r.MarkupContext.contexts&&r.MarkupContext.contexts.length&&r.MarkupContext.contexts.length>1)for(var u=0;u<r.MarkupContext.contexts.length;u++)"Specification Report"===r.MarkupContext.contexts[u].type?(i=r.MarkupContext.contexts[u].id,d=r.MarkupContext.contexts[u].type):a={id:r.MarkupContext.contexts[u].id,type:r.MarkupContext.contexts[u].type,label:r.MarkupContext.contexts[u].name};"r2vsurvey"===r.MarkupContext.serviceID?(p.physicalid=r.MarkupContext.contextIds&&r.MarkupContext.contextIds.length>0?r.MarkupContext.contextIds[0]:r.MarkupContext.contextId,p.dtype="R2V_Activity"):(p.physicalid=i||r.MarkupContext.contexts[0].id,p.dtype=d||r.MarkupContext.contexts[0].type,a&&a.id&&(p.subContext=a)),p.dtype=r.MarkupContext.serviceID&&"r2vsurvey"===r.MarkupContext.serviceID?"R2V_Activity":r.MarkupContext.contexts[0].type,p.reviewId=t,p.reviewType=n,p.relatedObjectTitle="r2vsurvey"===r.MarkupContext.serviceID?r.name:r.MarkupContext.contexts[0].name,p.reviewState=r.currentState,p.owner=r.owner,j=p.dtype;var D,g,C=function(){E||(E=X.pad3DViewer.subscribe({event:"onRootAdded"},(function(e){!function(e){A&&require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt"],(function(t,n){t&&n&&A.load2DDocument({phyID:e.physicalid,serverUrl:t.get3DSpaceUrl(),securityContext:n.getSetting("pad_security_ctx"),dataType:e.dtype,is2DCompareActive:ne,parentNode:X.pad3DViewer.getRootBagPath().getChildrenPathes()[X.pad3DViewer.getRootBagPath().getChildrenPathes().length-1].getLastElement(!0),onLoadingStarted:function(){ne||X.onModelLoadingStarted(!0)},onComplete:e.onComplete,onFailure:e.onFailure})}))}({physicalid:e.id,dtype:x.getNodeType(e.path.getLastElement(!0)),onComplete:function(){ne||(ne=!0,X.onModelLoadingCompleted(),le(),ce(p))},onFailure:function(){ne||(ne=!0,X.onModelLoadingCompleted(),X.clearView(),o())}})}))),W||(W=X.pad3DViewer.subscribe({event:"onRootRemoved"},(function(e){A&&A.clean2DDocument(e)}))),(A=c.getManager({name:"DMU2DSheetManager",context:X.frmWindow}))||(A=new s({ctxViewer:X.pad3DViewer}),c.addManager({name:"DMU2DSheetManager",context:X.frmWindow,manager:A})),X.pad3DViewer.addRoots({objects:[{path:[p.physicalid]}]})};D=p.dtype,g=function(e){e&&e.length&&-1!==e.indexOf("SIMItfSimulation")?ce(p):e&&e.length&&-1!==e.indexOf("DesignSight")?function(){U||(U=M.getLoadingContextController({context:X.pad3DViewer}));var e={};e.objectId=p.physicalid,e.objectType=p.dtype,U.load({data:e}),ce(p)}():e&&e.length&&(-1!==e.indexOf("Drawing")||-1!==e.indexOf("CATDrawing"))?C():-1!==e.indexOf("DIFLayout")||-1!==e.indexOf("DIFSheet")?function(){U||(U=M.getLoadingContextController({context:X.pad3DViewer}));var e={};e.objectId=p.physicalid,e.objectType=p.dtype,U.load({data:e}),ce(p)}():e&&e.length&&(e.includes("Document")||e.includes("Requirement")||e.includes("Requirement Specification")||e.includes("Specification Report"))?function(){E||(E=X.pad3DViewer.subscribe({event:"onRootAdded"},(function(){le()}))),(A=c.getManager({name:"DMU2DSheetManager",context:X.frmWindow}))||(A=new s({ctxViewer:X.pad3DViewer}),c.addManager({name:"DMU2DSheetManager",context:X.frmWindow,manager:A}));let e=l.giveEventsController({viewer:X.pad3DViewer.getViewer()});z||(z=e.addEvent("onFireCrossWidgetSelection",(e=>{K&&K.select(e)}))),ce(p)}():e&&e.length&&-1!==e.indexOf("R2V_Activity")?require(["DS/PADUtils/PADSettingsMgt"],(function(e){e&&e.setSetting("eno3dview_r2vservices_v2",!0),E||(E=X.pad3DViewer.subscribe({event:"onRootAdded"},(function(){X.onModelLoadingCompleted(),le(),ce(p)}))),se(p.physicalid,r.MarkupContext.contextURI).then((e=>{X.pad3DViewer.addR2Vs({objects:[{displayName:"r2vName",objectId:e,objectType:"R2V_Activity",path:[{resourceid:e,type:"R2V_Activity"}],serviceId:"r2vsurvey"}],reframe:!1,displayNotif:!0,dispatch:!0})}))})):e&&e.length&&-1!==e.indexOf("FailureModesEffectsAnalysis")?function(){let e=l.giveEventsController({viewer:X.pad3DViewer.getViewer()});F||(F=e.addEvent("onFMEALoadSuccess",(()=>{le()}))),ce(p)}():(E||(E=X.pad3DViewer.subscribe({event:"onRootAdded"},(function(){X.onModelLoadingCompleted(),le(),ce(p)}))),"ENOStrRefinementSpecification"===j?X.pad3DViewer.addFilter([{objectId:p.physicalid}]):X.pad3DViewer.addRoots({objects:[{path:[p.physicalid]}]}))},m.getParentTypes(D).then((function(e){g([D].concat(e))})).catch((function(){g([D])}))}),o)}}},this.internalClear=function(e){K&&(K.destroy(),K=null);let t=l.giveEventsController({viewer:X.pad3DViewer.getViewer()});if(z&&(t&&t.removeEvent(z),z=null),F&&(t&&t.removeEvent(F),F=null),O){O.removePreferences(["MarkupPreferences"]);var n=Object.keys(H);for(let e=0;e<n.length;e++)O.unsubscribe(H[n[e]]);H={}}if(X.pad3DViewer&&E&&X.pad3DViewer.unsubscribe(E),E=null,X.pad3DViewer&&W&&X.pad3DViewer.unsubscribe(W),W=null,Q&&(O.unsubscribe(Q),Q=null),k&&(k.clean(),k=null),R&&g.unreferenceDMUApplicativeContextManager({context:X.pad3DViewer}),e){C.unreferencePreferenceManager({context:X.pad3DViewer.getFrameWindow()}),O=null,w.unreferenceSelectionManager({context:X.pad3DViewer}),L=null,l.removeReviewContext({context:X.pad3DViewer}),A&&A.clean2DDocument();const e=D.giveDMUCommentsController({context:X.frmWindow,commandContext:X.pad3DViewer.getCommandContext()});if(e&&e.cleanCommentsPanel(),X.pad3DViewer.getRootBagPath().getChildrenPathes()[0]){var o=x.getNodeID(X.pad3DViewer.getRootBagPath().getChildrenPathes()[0].getLastElement(!0));if("FailureModesEffectsAnalysis"===x.getNodeType(X.pad3DViewer.getRootBagPath().getChildrenPathes()[0].getLastElement(!0))){let e=I.getExecutionContext().getComponent("FMEALoaderForDesignValidation");e&&e.remove&&e.remove().then((()=>{let e=X.pad3DViewer.getRootBagPath().externalPath[0].path.getChildrenPathes().length;if(e){let t=X.pad3DViewer.getRootBagPath().externalPath[0].path.getChildrenPathes()[e-1].externalPath.find((e=>"RootBag"===e.name));t&&(t.removeChildren(),t.remove())}}))}else X.pad3DViewer.getController().removeRoots({pids:[o]})}c.removeManager({name:"DMU2DSheetManager",context:X.frmWindow})}G=!1,q=!1,ne=!1,A=R=null,I&&(I.clean(),I.destroy(),I=null)},this.internalDispose=function(e){const t=X.pad3DViewer&&X.pad3DViewer.getCommandContext(),n=v.getExperience(t);n&&n.executeScriptingFunction("showAll"),T=null,X.frmWindow.getContextualUIManager().unregister("3DPlayDMUExperience"),r.removeSlidePreferences({context:X.frmWindow}),X.internalClear&&X.internalClear("ENOR3D_AP"!==e),_=null,B=!1},this.internalRefresh=function(){T&&(X.internalClear(!0),X.internalLoad(JSON.parse(T),!0))},this.internalGetDropDelegations=function(){return h.getDelegation(X.pad3DViewer,(()=>{let e=l.giveEventsController({viewer:X.pad3DViewer.getViewer()});e&&e.fireEvent("onApplyingSlideView")}))},this.internalPostCreate=function(){X.frmWindow.getContextualUIManager().register({subscriberId:"3DPlayDMUExperience",workbenchName:"3DPlayDMUExperience",context:X.pad3DViewer.getCommandContext(),cmdPrefix:"",fileName:"3DPlayDMUExperience.xml",module:"3DPlayDMUExperience",onContextualMenuReady:function(e,n){var o=[];if(N&&n&&n.XmousePosition){var r=new t.Vector2(n.XmousePosition,n.YmousePosition),i=X.frmWindow.getViewer().getMousePosition(r);0===X.frmWindow.getViewer().pick(i,"mesh",!0).path.length&&(y.isMobile()||(o=[{line:1,name:"DMU3DReviewDisplaySubMenu",resourceFile:"DMUBaseCommands/3DPlayPro",hdr_list:["VisuQMCommand"]}]),o=o.concat([{line:1,name:"DMU3DReviewAmbiencesSubMenu",resourceFile:"DMUBaseCommands/3DPlayPro",hdr_list:["VisuPureWhiteOCACmd","VisuWhiteMirrorOCACmd","VisuWhiteReviewOCACmd","VisuWhiteExperienceOCACmd","VisuStudioOCACmd","VisuDarkMirrorOCACmd","VisuDarkReviewOCACmd","VisuWhiteDesignOCACmd","VisuBlueDesignOCACmd","VisuDarkDesignOCACmd","VisuIndoorOCACmd","VisuCityOCACmd","VisuRoadOCACmd","VisuOutdoorOCACmd","VisuBasicOCACmd"]}]))}return{cmdList:o}}})},this.onLightboxReady=function(){X.lightbox.useDefaultActions(!1),X.lightbox.addAction({name:S.publishToSwym,text:S.publishToSwym,fonticon:"share-alt",handler:function(){let e=p.getCommand("DMUPublishToSwymCmdHdr",X.pad3DViewer.getCommandContext());e&&e.begin()}}),X.lightbox.addAction({name:S.information,text:S.information,fonticon:"info",handler:function(){X.lightbox._lightbox.onClickInformation().execute()}}),X.lightbox.addAction({name:S.more,text:S.more,fonticon:"chevron-down",items:[{name:S.copyScreenshot,text:S.copyScreenshot,fonticon:"copy",handler:function(){let e=p.getCommand("DMUCaptureCmdHdr",X.pad3DViewer.getCommandContext());e&&e.begin()}},{name:S.saveScreenshot,text:S.saveScreenshot,fonticon:"picture-export",handler:function(){X.lightbox._lightbox.onClickSaveScreenshot()}},{name:S.printScreenshot,text:S.printScreenshot,fonticon:"print",handler:function(){X.lightbox._lightbox.onClickPrintScreenshot()}}]})},e.commandApplication=!1,e.workbenchs=e.workbenchs||[],e.options.pad3DViewer||e.workbenchs.push({name:"3DPlayDMUExperience",module:"3DPlayDMUExperience"}),this._parent(e),this.subscribe("ASSET/LOADINGFINISHED",le,!0)},clearView:function(){this.internalClear&&this.internalClear(!0),this._parent()},onPreCreate:function(){this.args.visu={fetchMePreferenceSettings:!0}},getDropDelegations:function(){return this.internalGetDropDelegations()},onPostCreate:function(){this.pad3DViewer.getViewer().setPrePicking({activated:!0,displayHL:!0}),window.widget.setMetas({helpPath:"3DPlayDMUExperience/assets/help"}),window.widget.dispatchEvent("onPlayExperienceReady",[{pad3DViewer:this.pad3DViewer}]),this.internalPostCreate&&this.internalPostCreate()},dispose:function(e){window.widget.setMetas({helpPath:void 0}),this.internalDispose&&this.internalDispose(V),V=null,this._parent(e)},refresh:function(){return this.internalRefresh&&this.internalRefresh(),!0},loadAsset:function(e){e&&e.asset&&e.asset.physicalid&&this.internalLoad&&(this.clearView(),this.internalLoad(e))},acceptSwitch:function(e){var t=!1;return e&&e.options&&e.options.id&&("ENOR3D_AP"!==(V=e.options.id)&&"CATC3D_AP"!==V&&"CATA3I_AP"!==V||(t=!0)),t}})}));