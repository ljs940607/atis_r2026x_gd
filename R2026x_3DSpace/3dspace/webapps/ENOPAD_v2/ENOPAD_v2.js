/*!  COPYRIGHT DASSAULT SYSTEMES 2016   */
define("DS/ENOPAD_v2/features/MaturityAndLockAtCreation",["DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADSession","DS/PADUtils/PADSettingsMgt","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/ENXNav/utils/TwoDAppEvents","DS/PADUtils/views/PADAlert","DS/PADServices/utils/PConfigUtils"],(function(e,t,n,i,o,s,r,a){"use strict";function d(e){this.options=e,this.__timeoutToken,this.__setup()}return d.prototype={__setup:function(){i.getSetting("lockControlByAdmin");widget.addEvent("onLockStatusAtContentCreation",this.__onLockStatusAtContentCreation.bind(this));widget.hasPreference("lockStatusAtContentCreation")&&widget.getValue("lockStatusAtContentCreation"),i.addEvent("onLockStatusAtContentCreation",function(e){this.__onLockStatusAtContentCreation("",e,!1)}.bind(this))},__onLockStatusAtContentCreation:function(e,t,n=!0){this.__addLockStatusPreference(t),n&&widget.dispatchEvent("onEdit")},__addLockStatusPreference:function(e){const t={name:"lockStatusLabels",defaultValue:"0",type:"list",label:"lockStatusLabel",options:[{label:"lockedLabel",value:"1"},{label:"unlockedLabel",value:"0"}]};!1===e&&(t.disabled="true"),widget.addPreference(t)}},d})),define("DS/ENOPAD_v2/models/mixins/PADDocOccExcludesDisabled",["DS/PADUtils/PADSettingsMgt","DS/PADUtils/views/PADAlert","i18n!DS/ENXNav/assets/nls/ENXNav.json"],(function(e,t,n){"use strict";function i(){}return i.prototype={triggerExcludePathsUpdate:function(){return Promise.resolve()},bubbleStaticMapMessageOnce:function(){if(e.getSetting("activateExcludeOccWarning")&&e.getSetting("staticMappingEnabled")){let e=n.staticMappingFoundinSession2D;e.eventID="warning",t.displayNotification(e)}}},i})),define("DS/ENOPAD_v2/models/mixins/PADDocProxy",["UWA/Core","DS/PADServices/utils/Generics","DS/PADServices/utils/Iterator","DS/ENXNav/models/NodeUtils","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/GlobalUtils","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/modules/common/Constants","DS/ENOXParser/modules/TwoDParser","DS/PADUtils/views/PADAlert","DS/PADUtils/PADSession","i18n!DS/PADUtils/assets/nls/PADUtils.json"],(function(e,t,n,i,o,s,r,a,d,l,c,u,p){"use strict";const g="insertExisting",h="detach",f="reParent",D="replaceInstances",v="updateRevision",m="TitleInfo";function P(){}return P.prototype={_appendToCommandProxy:function(){if(this._cmdProxy){let e={events:{onRefresh:this._onRefresh.bind(this),onPadRefresh:this._onPadRefresh.bind(this)}};this._cmdProxy.addProxyEvents(e)}},_handleSplitAndRefresh:function(e){if(e&&e.modified&&e.created){for(var t,n=[],i={},o=0;o<e.modified.length;o++)t={oldId:e.modified[o].physicalid,newId:e.created[o].physicalid},n.push(t);i.couples=n,i.cb=e.cb,this.splitInstance(i)}else console.warn("refreshInstance: no input")},_onRefresh:function(e){let i=this,o=this.options.context;if(t.checks.array(e.authored.modified)&&o.options.isDeEnabled&&o.hasActiveDesignExp()){if(o.getActiveDesignExp().getID()==e.authored.modified[0])return o.getPseService().updateDesignExpTitle(e.authored.modified[0]),!1;let t=o.getPseService().app.core.contextManager.getDesignExpItem(e.authored.modified[0]);t?.length&&o.getPseService().app.core.contextManager.isFilter(t[0])&&o.getPseService().updateFilterAssetTitle(t[0])}if((t.checks.array(e.authored.created)||t.checks.array(e.authored.modified))&&(e.authored.originWidgetId&&e.authored.originWidgetId===r.getWidgetId()||this.refreshNodeById({created:e.authored.created,modified:e.authored.modified})),t.checks.array(e.authored)&&e.authored.length&&e.authored[0].previous)for(var a=0;a<e.authored.length;a++){var d=e.authored[a].previous,l=e.authored[a].modified;if(d!==l){var c={modified:[{physicalid:d}],created:[{physicalid:l}]};i._handleSplitAndRefresh(c)}}if(t.checks.array(e.authored.deleted)){var u=[],p=[];n.iterate(e.authored.deleted,(function(e){var t=i.getNodesById(e);n.iterate(t,(function(t){-1===p.indexOf(e)&&p.push(e)})),u=u.concat(i.getNodesById(e))})),i.deleteNodes(u,!0),s.publish({event:"ENXViews/WelcomePanel/cleanup",data:{item2remove:e.authored.deleted}})}},_onPadRefresh:function(e){if(!0===o.getSetting("activateFUN076708")){var t=this,i=function(n){var i=Object.getOwnPropertyNames(n);for(var o in i){let s=i[o];switch(s){case g:e.origin&&"CCP"===e.origin||(n.insertExisting&&n.insertExisting.modified&&n.insertExisting.created&&n.insertExisting.inserted?t._viewInsertExisting(n.insertExisting):console.warn("onPadRefresh missing insertExisting "+s));break;case h:n.detach&&n.detach.deleted?t._viewDetach(n.detach):console.warn("onPadRefresh missing detach "+s);break;case f:t._viewReParent(n.reParent);break;case D:t.splitInstance(n.replaceInstances);break;case m:break;case v:t.updateRevision(n);break;default:console.warn("onPadRefresh unknown "+s)}}};e.transactions?n.iterate(e.transactions,(function(e){i(e)})):i(e),o.getSetting("activateAutoSwitchAuthoringToIndex")&&u.determineAuthoredFlag()&&u.setAuthoringState(!0)}},_viewDetach:function(e){var t=this;let i=e.deleted.map((function(e){return t.getNodesByRelId(e)})).reduce((function(e,t){return e=e.concat(t)}),[]);this.withTransactionUpdate((function(){n.iterate(i,(function(e){let t=e.getParent();t&&t.removeChild(e)}))}))},_viewReParent:function(e){this._viewInsertExisting(e),this._viewDetach(e)},_viewInsertExisting:function(e){},_viewSplitInstance:function(t){var n=this;function i(e){if(!e.hasChildren())return e.getDepth();var t=1;return e.getChildren().forEach((function(e){var n=i(e);n>t&&(t=n)})),t}var s,a,d,l,c,u,p,g,h=[],f=[],D=[];this._insertFlag=!0,this.withTransactionUpdate((function(){try{for(var o=0;o<t.couples.length;o++){var r=n.getNodesByRelId(t.couples[o].oldId);if(r&&r.length>0)for(var v=0;v<r.length;v++)if(s=r[v]){if((g=s.getOccurencePath())&&g.length&&h.push(g),s.isExpanded()){var m=i(s)-s.getDepth();m=parseInt(m),D.push(m)}if(f.push(s.getRelationID()),d=s.getParent()){l=d.getChildren(),a=s.options.relationtype,c=l.indexOf(s)+1,u=e.clone(s.options,!1);var P=e.clone(s.options.grid,!1);u.grid=P,u.children&&(u.children=[]),u.relationid=t.couples[o].newId,(p=n.createNodeModel(u)).setRelationID(t.couples[o].newId,a),f.push(t.couples[o].newId),c===l.length?d.addChild(p):t.editVariant?d.insertBefore(p,s):d.insertBefore(p,l[c]),d.isExpanded()||d.options.padstate&&"partiallyExpanded"===d.options.padstate||(d.setState({state:"partiallyExpanded"}),d.options.padstate="partiallyExpanded"),p.isSelected()||p.select(),s.isSelected()&&s.unselect(),(g=p.getOccurencePath())&&g.length&&h.push(g)}}}}catch(e){console.error("error >>:",e)}finally{console.info("splitInstance done")}})),n.invalidateViewPort();var v=o.getSetting("modelOcc")||"true"===r.getURLParameter("modelOcc");t.editVariant&&n.updateInstance({occurencePaths:h,expandStates:D,newRelIds:f,editCfg:!0,isOccModel:v}),t.cb&&t.cb({occurencePaths:h,expandStates:D,newRelIds:f,isOccModel:v})},splitInstance:function(t){var n=this;t.editVariant||t.cb||(t.cb=function(t){e.is(n.updateInstance,"function")&&n.updateInstance(t)}),this._viewSplitInstance(t)}},P})),define("DS/ENOPAD_v2/utils/PADClipboard",["UWA/Class","UWA/Class/Events","DS/Logger/Logger"],(function(e,t,n){"use strict";var i=n.getLogger("DS/ENOPAD_v2/utils/PADClipboard"),o={OBJECT:null,POSITION:null},s=e.extend(t,{init:function(){this._parent();var e=this;document&&document.addEventListener&&document.addEventListener("keyup",(function(t){27===t.keyCode&&(i.log("Clear the Clipboard"),e.clear())}))},_checkpageAndThrow:function(e){if(i.debug('Checking if "%s" is a valid page',e),!o.hasOwnProperty(e))throw i.error("Check failed"),new Error('"'+e+'" is not a valid page')},setData:function(e,t){i.info('Setting data in page "%s"',e),i.debug("  Data %o",t),this._checkpageAndThrow(e),this.dispatchEvent("pre_setData",arguments),o[e]=UWA.clone(t),this.dispatchEvent("post_setData",arguments)},getData:function(e){return i.info('Getting data in page "%s"',e),this._checkpageAndThrow(e),UWA.clone(o[e])},consumeData:function(e,t){i.info('Consuming data in page "%s"',e);var n=this.getData(e);return t&&this.clear(e),n},clear:function(e){if(e)i.info('Clearing clipboard page "%s"',e),this._checkpageAndThrow(e),this.dispatchEvent("pre_clear",arguments),o[e]=void 0;else for(var t in i.info("Clearing clipboard"),this.dispatchEvent("pre_clear",arguments),o)o.hasOwnProperty(t)&&(o[t]=void 0);this.dispatchEvent("post_clear",arguments)},isEmpty:function(e){if(e){if(this._checkpageAndThrow(e),o[e])return!1}else for(var t in o)if(o.hasOwnProperty(t)&&o[t])return!1;return!0}}),r=s.singleton({init:function(){this._parent()}});for(var a in o)o.hasOwnProperty(a)&&(r[a]=a);return r})),define("DS/ENOPAD_v2/commands/edit/_Cut",["UWA/Class"],(function(e){"use strict";return{execute:function(e){e.context.cut()}}})),define("DS/ENOPAD_v2/mixins/_PADRefresh",["UWA/Class","DS/PADUtils/PADSettingsMgt"],(function(e,t){"use strict";var n=n=e.extend({});return!0!==t.getSetting("refresh_v2")&&(n.prototype.refresh=function(e){var n=this;if(e=void 0===e||e,require(["DS/ApplicationFrame/CommandsManager"],(function(e){e.getCommand("Uncut").begin()})),e)if(n.hasActiveDesignExp()){let e=[];this.getPADTreeDocument()._getAuthoringFlag()?(this.getRoots().forEach((t=>{t.options.isReadOnly||e.push(t.options.resourceid)})),this._commandProxy.refreshModel(e)):this._commandProxy.refreshModel()}else this._commandProxy.refreshModel();var i=n.getPADTreeListView(),o=n.getPADDGVView();o.options.shouldClearSort=!1,o&&o.removeFilterView();let s=Promise.resolve();t.getSetting("staticMappingEnabled")&&"2.0"===this.getPADTreeDocument().version&&(s=this.options.model.triggerExcludePathsUpdate());let r,a={treelist:i,datagrid:o,dispatch:!1},d=this.getPADTreeDocument();r=d.refresh.bind(d),s.then((()=>{r(a)}))}),n})),define("DS/ENOPAD_v2/models/mixins/PADDocInserts",["DS/PADServices/ws/WSAccess","DS/PADServices/utils/Iterator","DS/PADServices/utils/PromiseHook","DS/ENOXParser/modules/TwoDParser","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/modules/common/Constants","DS/ENOXParser/modules/PADParser","DS/ENOXParser/modules/ClientDataParser","DS/PADServices/utils/Generics","DS/PADServices/settings/AppSettings","DS/ENXNav/models/xNavNodeModel","DS/ENXNav/utils/TwoDAppEvents","DS/PADUtils/PADSession","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADPredicatesNls","DS/PADUtils/views/PADAlert","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],(function(e,t,n,i,o,s,r,a,d,l,c,u,p,g,h,f,D,v){"use strict";const m=["owner","ds6w:globalType"];function P(e){let t=i.parseAttributes(e.attributes);if(d.checks.number(t.relcount)&&t.relcount>0&&(t.children=[]),t.padgrid&&d.checks.string(t.padgrid.relcount)){parseInt(t.padgrid.relcount)>0&&(t.children=[])}return e.relationid&&(t.relationid=e.relationid),t}function _(e,n,i,o){t.iterate(n,(function(n){let o=e.getRoots().map((function(e){return e.getNodesById(n.parent_id)})).reduce((function(e,t){return e=e.concat(t)}),[]);t.iterate(o,(function(o){let r=n.children.map(P);t.iterate(r,(function(t){let n=[];var r={insertExisting:{modified:[],inserted:[],created:[]}};t.grid["ds6w:reserved-Instance"]||(t.grid["ds6w:reserved-Instance"]="FALSE");var a=e.createNodeModel(t);o.addChild(a),o.setState(s.NODE_STATES.PARTIALLY_EXPANDED),o.options.padstate=s.NODE_STATES.PARTIALLY_EXPANDED.state,r.insertExisting.modified.push(o.getID());let d=a.getOccurencePath();n.push(d),r.insertExisting.inserted.push(d),r.insertExisting.created.push(a.getRelationID()),r.insertExisting.withContext=!1,e.updatePaths({paths:n}),e.isGroupingApplied()&&o.isRoot()&&function(e,t){let n=e.grpGetOtherNode(t.getRoot());n.addChild(t),n.isExpanded()||n.setState(s.NODE_STATES.PARTIALLY_EXPANDED)}(e,a),h.updateNLS(a),i.transactions.push(r)}))}))})),e._cmdProxy.padRefresh(i)}function A(){}return A.prototype={insertNodes:function(e,n){var i=this,o=[];var s={transactions:[]};return this.wrapInTransaction((function(){d.checks.array(e.created)||d.checks.array(e.inserted)?(console.info("INFO: insertNodes() attributes provided"),i.withTransactionUpdate((function(){e.created&&function(e,n,i){let o=n.map(P);p.setAuthoringState(!0);var s=[];t.iterate(o,(function(t){let n=e.createNodeModel(t),o=e.addRoot(n);o.select(),s.push(o.getID()),i.push(o),h.updateNLS(o),e.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.getRoots().length,added_node:o}})})),e.updateNodesAttrValue(s,m,(function(){}));let r={pids:s,already_added_in_PS:!0};e._cmdProxy.drop(r)}(i,e.created,o),e.inserted&&_(i,e.inserted,s)}))):(console.info("INFO: insertNodes() attributes to be gotten"),i._insertWithLessInfo({parameters:e,noNotification:e.noNotification,callback:n}))})),o},_insertWithLessInfo:function(e){let i=this,c=e.callback,p=e.parameters.isProdConfig;if(delete e.parameters.isProdConfig,!0===l.getSetting("useLWCWebServices")){console.info("INFO: insertNodes() attributes with expand"),this.unselectAll();let c={docPtr:this,padRefreshData:{transactions:[]},insertedNodes:[],pathToFetch:[],rootNodesIds:[],rootNodes:[],objects:e.parameters,parentOccurencePaths:[],orderInfos:[]};!function(e){t.iterateObj(e.objects,(function(n,i){if(d.checks.array(n)){let o={insertExisting:{modified:[],inserted:[],created:[]}};if(t.iterate(n,(function(t){let n=[i,t.relationid,t.resourceid];-1===e.pathToFetch.indexOf(n)&&(e.pathToFetch.push(n),o.insertExisting.modified.push(i),o.insertExisting.inserted.push(t.resourceid),e.insertedNodes.push(t.relationid),o.insertExisting.created.push(t.relationid),o.insertExisting.withContext=!1);let s=t.clientTaskData;if(s&&new a(s).appendPaths(e.pathToFetch),t.ordering){let i=t.ordering,o={nodePath:n};if(i.before){o.before=e.docPtr.getNodesByRelId(i.before)[0];let n=o.before.getParent().getOccurencePath();n.push(t.relationid),n.push(t.resourceid),o.nodePath=n}i.after&&(o.after=e.docPtr.getNodesByRelId(i.after)[0]),e.orderInfos.push(o)}})),-1===e.rootNodesIds.indexOf(i)){e.rootNodesIds.push(i);let n=e.docPtr.getNodesById(i);n&&(e.rootNodes=e.rootNodes.concat(n),t.iterate(n,(function(t){var n=t.getOccurencePath();-1===e.parentOccurencePaths.indexOf(n)&&e.parentOccurencePaths.push(n)})))}e.padRefreshData.transactions.push(o)}}))}(c);e.noNotification;delete e.noNotification,this._beginBlockingTransaction(D.inserting_nodes);let g=i._getAuthoringFlag();this._getExpandFunc(g)({pathIds:c.pathToFetch,data:{expandLevel:"0"},FBIProxy:this.options.FBIProxy,timeout:l.getSetting("webapi_timeout")}).then((function(e){var a=o.data.jsonParse(e);i._parseLoadModel=!0;let d=r.insertNodesExpand({treeDoc:i,expandedNodes:c.rootNodes,FBIProxy:i.options.FBIProxy,wsResponse:a,expandLevel:0});new n(d,i.boundClearFlag);d.then((function(){i._endBlockingTransaction(),c.orderInfos.length&&function(e,t){for(let n=0;n<e.length;n++){let i=e[n],o=t.getNodeByOccurencePath(i.nodePath);if(i.before){let e=i.before.getParent();e.insertBefore(o,i.before),e.setState(s.NODE_STATES.PARTIALLY_EXPANDED),e.options.padstate=s.NODE_STATES.PARTIALLY_EXPANDED.state,e.options.childComputed=!1}}}(c.orderInfos,i),function(e){if(e.insertedNodes.length){var n=[];t.iterate(e.insertedNodes,(function(t){let i=e.docPtr.getNodesByRelId(t);i&&i.length&&n.push(i[0].getOccurencePath())})),e.padRefreshData.transactions[0].insertExisting.inserted=n}}(c),i._cmdProxy.padRefresh(c.padRefreshData),u.addChild(),p&&i.bubbleStaticMapMessageOnce()}))}))}else{console.info("INFO: insertNodes() attributes with fetch");var g=[];t.iterateObj(e.parameters,(function(e){d.checks.array(e)&&function(e,n){t.iterate(n,(function(t){o.array.unique(e,t.resourceid),o.array.unique(e,t.relationid)}))}(g,e)}));let n=e.noNotification;delete e.noNotification,delete e.parameters.noNotification,this._beginBlockingTransaction(D.inserting_nodes);l.getSetting("enopad_webapis_debug");let s=i._getAuthoringFlag();this._getFetchFunc(s)({data:{physicalid:g},autoAttSelection:!0}).then((function(t){let s=o.data.jsonParse(t);if(i.invalidateViewPort(),0===s.results.length)throw new Error("Cannot find object with the physicalid "+g);i.wrapInTransaction((function(){var t=r.insertNodes({treedocument:i,response:s,insert_parameters:e.parameters});i._cmdProxy.padRefresh(t),u.addChild()}),"insert_nodes"),i._endBlockingTransaction(),c&&c(),!0!==n&&f.displayNotification({msg:D.insert_existing_succeeded,eventID:"info"})})).catch((function(e){f.displayNotification({msg:v.generic_service_failure,eventID:"error"}),i._endBlockingTransaction()}))}}},A})),define("DS/ENOPAD_v2/models/mixins/PADDocRefreshOcc",["i18n!DS/PADServices/assets/nls/PADServices","i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/PADServices/utils/Meas","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/Generics","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/TrackerInsert","DS/PADServices/settings/AppSettings","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/ParserCV","DS/ENOXParser/modules/PADParserOcc","DS/ENXNav/utils/TwoDAppEvents","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/PConfigUtils","DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/DictionaryAccess","DS/ENXNav/models/xNavNodeModel","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],(function(e,t,n,o,s,r,a,d,l,c,u,p,g,h,f,D,v,m,P,_){"use strict";const A=o.addOrGetSection("ENOPAD.PADDocRefreshOcc"),S=/ResponseCode with value \"(\d+)\"/g;function b(){r.publish({event:"ENXModel/refresh/complete"}),r.publish({event:"ENXModel/parseEnded"})}function I(e){let t=[],n=e.filter((e=>function(e){if(e.hasChildren()){let t=e.getChildren();return 1!==t.length||!t[0].isRelationsObjectGroupingNode}return!1}(e)));if(n.length===e.length)t.push(n);else{let i=e.filter((e=>!n.includes(e)));n.length&&t.push(n),t.push(i)}return t}function N(e,t){for(let n=t.length;n>1;n-=2){let i=t.slice(0,n),o=e.getNodeFromPath(i);if(!o||o.hasChildren())break;o.remove()}}function E(e,t){e.options.removeChildrenInProgress=!0;let n=t.map((t=>e.getNodeFromPath(t))),i=n.length>0;for(let t=0;t<n.length;t++){let i=n[t],o=i.getParent();if(i.remove(),o&&"ds6w:Document"===o.options.globaltype&&!o.hasChildren()&&(o.options.children=null,o.setState({state:"noChildren"})),o&&!o.isRoot()&&!o.hasChildren()){let t=o.getRoot();if(t&&!0===t.options.filtered){let t=o.getOccurencePath();t&&t.length>=3?N(e,t):(o.removeChildren(),o.remove())}else o.removeChildren(),o.remove()}}return e.options.removeChildrenInProgress=!1,r.getModelEvents().publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"removeFromView",removedFromViewIds:t}}),i}function y(){s.displayNotif({message:e.warnings.removeNodeDuringRefresh,level:"warning"})}function x(e,n,i,o){let r=e&&e.message||"";if(r.includes("NetworkError:")){let e=S.exec(r);if(e){let r=parseInt(e[1]);if(r>=300&&r<=400){let e=n.map((function(e){return i.searchRootById(e)}));!function(e,n,i){for(let e=0;e<n.length;e++)n[e].remove();let o={detach:{deleted:n.map((e=>e.getID()))}};e._cmdProxy.padRefresh(o);let r=t.cannot_insert_branch;i&&(r=t.cannot_access_after_changeowner),s.displayNotif({message:r,level:"error",key:"xNavDoc-refresh-removeRoots"}),e._triggerTitleUpdate()}(i,e,o)}}}}function C(){s.displayNotif({message:e.infos.refreshOK,level:"info"})}function O(e){let t=!1,i=!1,o=!1,r=e.filter((e=>{if("rejected"===e.status&&e.reason&&(e.reason.isReadOnlyRoot&&(t=!!e.reason.isReadOnlyRoot),e.reason.hasNoResult&&(i=e.reason.hasNoResult),e.reason.timeoutOccurs&&e.reason.isAuthoring&&(o=e.reason.timeoutOccurs&&e.reason.isAuthoring),t||i||o))return!1;if("rejected"===e.status){let t=e.reason;return t&&t.isApiError}}));return t&&s.displayNotif({message:n.refresh_wip_only}),o&&s.displayNotif({title:_.refreshTimeoutDB.title,subtitle:_.refreshTimeoutDB.message,level:"error"}),r.length&&s.displayNotif({message:n.refresh_failure,level:"error",key:"xNavDoc-refresh-error"}),!t&&!i&&!o&&0===r.length}function w(){}return w.prototype={refresh:async function(e){if(this._isAuthoring()&&this.isBSDGroupingApplied()){return void this.options.context.features.bsdIntegration.displayRefreshMessage()}let t=[];r.publish({event:"ENXModel/refresh/begin"});let n=new l(A,"Refresh.refresh","2d_app_refresh",{eventCategory:"performance",eventAction:"refresh"});if(!this._isAuthoring()){let e=I(this.getRoots());for(let n=0;n<e.length;n++){let i=e[n];this.refreshDispatch({roots:i,promisesExpandWS:t})}return void Promise.allSettled(t).then((e=>{O(e)&&C(),b(),n.end()}))}let i=this.getRoots(),o=i.filter((function(e){return!1===e.options.isReadOnly&&!e.validFilter})),s=i.filter((function(e){return!0===e.options.isReadOnly&&!e.validFilter})),a=D.isMultiRootSupported()?i.filter((e=>e.validFilter)):[],d=[];o.length&&d.push({roots:o,isAuthoring:!0}),s.length&&d.push({roots:s,isAuthoring:!1}),a.length&&a.forEach((e=>d.push({roots:[e],isAuthoring:!0}))),d.forEach((e=>{let n=I(e.roots);for(let i=0;i<n.length;i++){let o=n[i];this.refreshDispatch({roots:o,isAuthoring:e.isAuthoring,promisesExpandWS:t,readOnlyRoot:!e.isAuthoring})}})),Promise.allSettled(t).then((e=>{O(e)&&C(),b(),n.end()}))},refreshDispatch:async function(e){let t=this,n=0,i=e.promisesExpandWS,o=e&&e.roots?e.roots:this.getRoots(),s=function(e,t){let n=[],i=!1;for(let o=0;o<e.length;o++){n.push(e[o]);let s=e[o].getLeaves(),r=[],a=[],d=[],l=[];for(let e=0;e<s.length;e++){let t=s[e],n=!0===t.isGroupingNode&&void 0!==t.options.bsIntent;if(n&&(i=!0),!0!==s[e].isRelationsObjectNode||n)n||-1===l.indexOf(s[e].getID())&&(r.push(s[e]),l.push(s[e].getID()));else{let t=!0===s[e].isRelationsObjectGroupingNode?s[e]:s[e].getParent();for(;!0===t.getParent().isGroupingNode;)t=s[e].getParent();-1===d.indexOf(t.getID())&&(a.push(t),d.push(t.getID()));let n=t.getParent();n&&!n.isRoot()&&-1===l.indexOf(n.getID())&&(r.push(n),l.push(n.getID()))}}a.length&&t.withTransactionUpdate((()=>{for(let e=0;e<a.length;e++){let t=a[e];if(!0!==t.isRoot()){let e=t.getParent();e&&e.alreadyGetFakeNode&&(e.alreadyGetFakeNode=!1),t.remove()}}})),n=n.concat(r)}return{allPaths:n,hasBsdNodes:i}}(o,t),r=s.allPaths.map((e=>{let t=e.getOccurencePath(),i=(t.length-1)/2;return n<i&&(n=i),t})),a=e.readOnlyRoot;if(this._isAuthoring()&&o.forEach((function(e){t.prodConfigSupportInAuth&&!0===f.getSetting("keepFilterAuthoring")?t.prodConfigSupportInAuth&&e.validFilter&&!e.keepFilterBadge&&(e.keepFilterBadge=!0):e.validFilter&&e.keepFilterBadge&&(e.keepFilterBadge=!1)})),0===o.length)return void b();let d=e&&void 0!==e.isAuthoring?e.isAuthoring:this._isAuthoring();if(0===n){let e=o.map((e=>e.getID())),n={pids:e,autoAttSelection:!0};d&&(n={data:{physicalid:e},autoAttSelection:!0});let l={apiParams:n,isAuthoring:d};i.push(new Promise((function(e,n){t._performWorkRefreshFetch(l).then((n=>{let i=r.filter((e=>!n.refreshPaths.includes(e.join("/"))));if(E(t,i)&&y(),!s.hasBsdNodes)for(let e=0;e<n.refreshPaths.length;e++){let i=t.getNodeByOccurencePath([n.refreshPaths[e]]);i&&i.setState(v.NODE_STATES.COLLAPSED)}e()})).catch((e=>{console.warn(e),!a&&e.hasNoResult&&E(t,r)&&y(),a&&n({...e,isReadOnlyRoot:a}),n(e)})).finally((()=>{t.getModelEvents().publish({event:"titleRecalc"})}))})))}else{let e={pathIds:o.map((e=>e.getOccurencePath())),data:{expandLevel:d?""+n:n},FBIProxy:this._getFBI(),timeout:c.getSetting("webapi_timeout"),select_relation:["ro.plminstance.v_treeorder"],withOccResponse:!0};t.prodConfigSupportInAuth&&(e.data.prodConfigSupportInAuth=t.prodConfigSupportInAuth),t.options.context.xNavPersistFilterSpec.readOnlyRootsFilterSpec&&t.options.context.xNavPersistFilterSpec.readOnlyRootsFilterSpec.size>0&&(e.data.readOnlyRootsFilterSpec=t.options.context.xNavPersistFilterSpec.readOnlyRootsFilterSpec);let s={apiParams:e,isAuthoring:d};s.isBsdApplied=t.isBSDGroupingApplied(),i.push(new Promise((function(e,n){t._performWorkRefreshExpand(s).then((n=>{let i=r.filter((e=>!n.refreshPaths.includes(e.join("/")))),o=!1;for(let e=0;e<r.length;e++){if(!0===t.options.FBIProxy.HasFilter(r[e][0]).hasFilter){o=!0;break}}E(t,i)&&!o&&y(),e()})).catch((e=>{!a&&e.hasNoResult&&E(t,r)&&y(),a&&n({...e,isReadOnlyRoot:a}),n(e)})).finally((()=>{t.getModelEvents().publish({event:"titleRecalc"})}))})))}},_performWorkRefreshFetch:function(e){let t=this;return new Promise(((n,i)=>{t._getFetchFunc(e.isAuthoring)(e.apiParams).then((e=>{let o=u.data.jsonParse(e);o.errors&&o.errors.length?i({isApiError:!0,errors:o.errors}):!o.results||o.results&&0===o.results.length?i({hasNoResult:!0}):(t._parseLoadModel=!0,p.parseRefreshOcc({treeDoc:t,FBIProxy:t._getFBI(),wsResponse:o}).then((e=>{t._parseLoadModel=!1,n(e)})).catch((e=>{t._parseLoadModel=!1,i({isApiError:!1,isParseError:!0,error:e})})))})).catch((e=>{i({isApiError:!0,error:e})}))}))},_performWorkRefreshExpand:function(e){let t=this;return new Promise(((n,i)=>{t._getExpandFunc(e.isAuthoring)(e.apiParams).then((o=>{let s=u.data.jsonParse(o);s.errors&&s.errors.length?i({isApiError:!0,errors:s.errors}):!s.results||s.results&&0===s.results.length?i({hasNoResult:!0}):(t._parseLoadModel=!0,g.refreshWithInserts({treeDoc:t,FBIProxy:t._getFBI(),wsResponse:s,isBsdApplied:e.isBsdApplied}).then((e=>{t._parseLoadModel=!1,n(e)})).catch((e=>{t._parseLoadModel=!1,i({isApiError:!1,isParseError:!0,error:e})})))})).catch((e=>{i({isApiError:!0,isAuthoring:t._isAuthoring(),timeoutOccurs:!(!e||!e.timeoutOccurs),error:e})}))}))},refreshNodeById:function(e){console.log(e);let t=this;if(e.created&&e.created.length){let n=e.created.slice();this._getFetchFunc(this._isAuthoring())({data:{physicalid:n},autoAttSelection:!0}).then((e=>{let n=u.data.jsonParse(e),o=n.results.filter((e=>e.attributes.find((e=>"#DENIED!"===e.value))));if(o.length){let e=o.map((e=>{let n=e.attributes.find((e=>"resourceid"===e.name)),i=t.getNodesById(n);if(i.length)return i[0]}));for(let n=0;n<e.length;n++){let n=e[i];t.removeRoot(n)}if(e.length){let t=e.map((e=>e.getID()));r.publish({event:"ENXViews/WelcomePanel/cleanup",data:{item2remove:t}})}t._parseLoadModel=!0,p.parseRefreshOcc({treeDoc:t,FBIProxy:t._getFBI(),wsResponse:n}).then((e=>{t._parseLoadModel=!1})).catch((e=>{t._parseLoadModel=!1}))}}))}if(e.modified&&e.modified.length){let n=e.modified.filter((e=>a.checks.object(e)&&a.checks.array(e.attributes))),i=e.modified.filter((e=>a.checks.string(e))),o=d.getAvailableColumns(),s=(d.getTreeColumn(),!(!o.includes("ds6w:reserved-Instance")&&!o.includes("ds6w:reservedBy-Instance")));if(n.length===e.modified.length){let n,i=e.modified.map((e=>e.physicalid)),r=function(e){let t=e.treeDoc,n=e.ids,i=t.getAllDescendants(),o={relNodes:{},resNodes:{}};for(var s=0;s<n.length;s++)o.relNodes[n[s]]=[],o.resNodes[n[s]]=[];for(s=0;s<i.length;s++){let e=i[s];if(e instanceof P){let t=e.getID(),i=e.getRelationID();n.includes(t)&&o.resNodes[t].push(e),n.includes(i)&&o.relNodes[i].push(e)}}return o}({treeDoc:t,ids:i});n=s?e.modified.map((e=>{let t=!1,n=r.resNodes[e.physicalid];if(0===n.length){n=r.relNodes[e.physicalid];for(let t=0;t<e.attributes.length;t++){let n=e.attributes[t];switch(n.name){case"ds6w:reserved":n.name="ds6w:reserved-Instance";break;case"ds6w:reservedBy":n.name="ds6w:reservedBy-Instance"}}t=!0}return{isByRel:t,nodes:n,mod:e}})):e.modified.map((e=>({isByRel:!1,nodes:r.resNodes[e.physicalid],mod:e})));let a=n;s||(a=n.filter((e=>e.nodes.length>0))),this.withTransactionUpdate((function(){t.withTransactionUpdate((function(){for(let e=0;e<a.length;e++){let t=a[e];for(let e=0;e<t.nodes.length;e++){t.nodes[e].updateAttributes(t.mod.attributes,o)}}}))}))}if(i.length===e.modified.length){t._switchToAuthoring();let n=e.modified.map((e=>t.searchRootById(e))).filter((e=>e)),o=!0;if(n.length&&n.length===i.length){let n=e.modified.map((e=>t.getNodesById(e)));n.length&&n[0].length>1&&(o=!1)}if(n.length&&n.length===i.length&&o){let e=n.map((e=>e.getID()));t.updatePids({pids:e}).then((e=>{for(let e=0;e<n.length;e++)m.updateNLS(n[e])})).catch((n=>{if(n.isApiError){x(n.error,e,t,!1)}}))}else{let n=e.modified.map((e=>{let n=t.getNodesById(e);return 0===n.length&&(n=t.getNodesByRelId(e)),n.map((e=>e.getOccurencePath()))})).reduce(((e,t)=>e.concat(t)),[]);t.updatePaths({paths:n}).then((()=>{t.isDGVGroupingApplied()&&t.triggerDGVGroupingReapply()})).catch((e=>{console.error(e)}))}}}},updatePaths:function(e){let t=this,n=this._getExpandFunc();return new Promise(((i,o)=>{e.paths.map((e=>{let n=t.getNodeFromPath(e);return n.options.waiting4validation=!0,n}));let s=t._getWebApiTimeout(),r={pathIds:e.paths,data:{expandLevel:"0"},FBIProxy:t._getFBI(),timeout:s,select_relation:["ro.plminstance.v_treeorder"],withOccResponse:!0};n(r).then((n=>{let s=u.data.jsonParse(n);s.errors&&s.errors.length||!s.results||s.results&&0===s.results.length?o({errorsResult:!0,errors:s.errors}):p.parsePathsOcc({treeDoc:t,FBIProxy:t._getFBI(),wsResponse:s,nodeModelClass:t._getClass(),state:e.state?e.state:"partiallyExpanded"}).then((e=>{i()}))})).catch((e=>{o({err:e,isApiError:!0})}))}))},updatePids:function(e){let t=this._isAuthoring(),n=this._getFetchFunc(t),i=this,o={pids:e.pids,autoAttSelection:!0};return t&&(o={data:{physicalid:e.pids},autoAttSelection:!0}),new Promise(((e,t)=>{n(o).then((n=>{let o=u.data.jsonParse(n);i._parseLoadModel=!0,p.parseRefreshOcc({treeDoc:i,FBIProxy:i._getFBI(),wsResponse:o}).then((t=>{i._parseLoadModel=!1,e()})).catch((e=>{i._parseLoadModel=!1,t({isApiError:!1,isParseError:!0,error:e})}))})).catch((e=>{t({isApiError:!0,error:e})}))}))}},w})),define("DS/ENOPAD_v2/commands/edit/_Uncut",["UWA/Class"],(function(e){"use strict";return{execute:function(e){e.context.uncut()}}})),define("DS/ENOPAD_v2/features/AutoSwitchAuthoringToIndex",["DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADSession","DS/PADUtils/PADSettingsMgt","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/ENXNav/utils/TwoDAppEvents","DS/PADUtils/views/PADAlert","DS/PADServices/utils/PConfigUtils"],(function(e,t,n,i,o,s,r,a){"use strict";const d="switchAuthoringToIndex";function l(e){this.options=e,this.__timeoutToken,this.__setup()}return l.prototype={__setup:function(){var e=this;t.subscribe({event:"ENXApp/SettingsModification/onSwitchAuthoringToIndex"},this.__setWaitPeriodForSwitch.bind(this)),widget.addEvent("onUseIndexPrefClick",this.__onUseIndexPrefClick.bind(this)),widget.addEvent("endEdit",(function(t){!1===t.submitted&&e.__onUseIndexPrefClick("",widget.getPreference("useIndexAccleration").value,!1)}));var o=widget.getPreference("useIndexAccleration").value;this.__onUseIndexPrefClick("",o,!1),i.addEvent("onUseIndexAccleration",function(e){this.__onUseIndexPrefClick("",e,!1)}.bind(this)),n.subscribe({event:"applySwitchTimeout"},this.__setWaitPeriodForSwitch.bind(this)),!a.isMultiRootSupported()&&s.onAddRoot(this.__removePConfigSupportInAuthForMultiRoot.bind(this))},__setWaitPeriodForSwitch:function(t,i=!0){let s=widget.getPreference(d)?widget.getPreference(d):null,r=t.prefValue?t.prefValue:s.value,a=s.options.filter((e=>e.value==r))[0].label;a=o[a]?o[a]:a;let l={title:o.PADSession_enabling_index_after_auto_switch_title,msg:o.replace(o.get("PADSession_enabling_index_after_auto_switch_msg"),{timeInterval:a})};if(n.determineAuthoredFlag()&&r&&0!=r){let o=!!t.doPolling&&t.doPolling;i&&this.timeoutToken&&(console.log("previous timeout killed!!"),clearTimeout(this.timeoutToken),this.timeoutToken=null),this.timeoutToken=setTimeout((()=>{console.log("NEw timeout started"),o?e.isDataIndexed().then((e=>{e&&n.setAuthoringState(!1,l)})).catch((e=>{console.log(e)})):n._useIndexPreference&&n.determineAuthoredFlag()&&n.setAuthoringState(!1,l)}),1e3*r)}0==r&&this.timeoutToken&&clearTimeout(this.timeoutToken)},__removePConfigSupportInAuthForMultiRoot:function(){var e=this.options.context.options.model.getRoots(),i=[];if(n.determineAuthoredFlag()&&e.length>1&&this.options.context.options.model.prodConfigSupportInAuth&&!a.isMultiRootSupported()){this.options.context.options.model.prodConfigSupportInAuth=!1;let n=e.filter((function(e){return e.validFilter&&e.keepFilterBadge}));n.length&&(n.forEach((function(e){e.keepFilterBadge=!1,i.push(e.getID())})),i.length&&(r.displayNotification({msg:o.configFilterForMultiRoots,eventID:"info"}),this.options.context._biFilter.removeRoots(i),t.publish({event:"__removePConfigSupportInAuthForMultiRoot",data:i})))}},__onUseIndexPrefClick:function(e,t,n=!0){this.__addSwitchAuthoringToIndexPref(t),n&&widget.dispatchEvent("onEdit")},__addSwitchAuthoringToIndexPref:function(e){const t={name:"switchAuthoringToIndex",defaultValue:"0",type:"list",label:"switchAuthoringToIndexLabel",options:[{label:"one_minute",value:"60"},{label:"three_minutes",value:"180"},{label:"five_minutes",value:"300"},{label:"ten_minutes",value:"600"},{label:"manually",value:"0"}]};!1===e&&(t.disabled="true",widget.setValue("switchAuthoringToIndex","0")),widget.addPreference(t)}},l})),define("DS/ENOPAD_v2/models/_PADModelParser",["DS/ENXNav/models/_xNavCVParser","DS/ENXNav/models/xNavNodeModel","DS/PADServices/utils/AttributesMgt","DS/PADUtils/PADPredicatesNls"],(function(e,t,n,i){"use strict";return e.process.insert_nodes=function(o){var s={transactions:[]},r=n.getAvailableColumns(),a=o.treedocument,d=a.getRoots(),l=o.response.results;console.log("replace insert response_results",l);var c,u,p,g=UWA.clone(o.insert_parameters,!1),h=Object.keys(g),f={},D={},v={};Date.now();function m(){for(var e,t,n,i,o,s,r,a=function(e,t){for(var n={beforeNodes:[],afterNodes:[],afterPosition:-1},i=e.length;i--;){var o=(u=e[i])._options.relationid;if(o===t.after){n.afterNodes=[u],n.afterPosition=i;break}if(o===t.before){n.beforeNodes=[u];break}}return n},d=h.length;d--;){e=h[d];for(var l=(n=f[e]).length;l--&&((t=n[l].getChildren())&&0!==t.length);){s=g[e],o=t[0];for(var c=s.length;c--&&(i=(r=s[c]).resourceid,r.ordering);){var p,D=r.ordering.before,m=r.ordering.after,P=!(!D||""===D),_=!(!m||""===m),A=a(t,r.ordering),S=A.beforeNodes.length>0,b=-1!==A.afterPosition;P&&_?(S&&(v[i]={before:A.beforeNodes}),b&&(p=A.afterPosition+2,v[i]={after:[p]})):P?S?v[i]={before:A.beforeNodes}:o&&(v[i]={before:[o]}):_&&b&&(p=A.afterPosition+2,v[i]={after:[p]})}}}}function P(t){var i,o,s=t.relationid;if((i=D[t.resourceid])&&((o=e.parse_attributes(i.attributes,r,n.getTreeColumn())).relationid=s,-1!==r.indexOf("instanceName")&&s&&D[s])){var a=e.parse_attributes(D[s].attributes,r,n.getTreeColumn());o.grid.instanceName=a.label}return UWA.clone(o,!1)}!function(){for(var e,t,n=h.length;n--;){t=h[n];for(var i=d.length;i--;)if((e=d[i].getNodesById(t)).length>0){f[t]=e;break}}}(),function(){for(var e,t,n,i,o=l.length;o--;){e=l[o],console.log("insert result",e);for(var s=(t=e.attributes).length;s--;)if("resourceid"===(n=t[s]).name){i=n.value,D[i]=e;break}}}(),m();Date.now();for(var _,A=h.length;A--;){_=h[A];var S=[],b={insertExisting:{modified:[],inserted:[],created:[]}},I=f[_],N=g[_];if(a.withTransactionUpdate((function(){for(var e,n,o=N.length;o--;){n=(p=N[o]).resourceid,e=P(p);for(var s=I.length;s--;){c=I[s];var r=new t(e);if(p.ordering){var a=v[n];a?a.before?c.insertBefore(r,a.before[0]):a.after?c.addChild(r,a.after[0]):c.addChild(r):c.addChild(r)}else c.addChild(r);"expanded"!==c.options.padstate&&(c.setState({state:"partiallyExpanded"}),c.options.padstate="partiallyExpanded"),"noChildren"===c.options.padstate&&(c.setState({state:"expanded"}),c.options.padstate="expanded"),(c._isExpanded||"expandState"===c._expandState)&&(c.options.padstate="expanded",c.setState({state:"expanded"})),b.insertExisting.modified.push(c.getID()),b.insertExisting.inserted.push(r.getID()),S.push(r.getRelationID()),b.insertExisting.created.push(r.getRelationID()),b.insertExisting.withContext=!1,i.updateNLS(r),m()}}})),s.transactions.push(b),S.length){var E=[];S.forEach((function(e){var t=a.getNodesByRelId(e);t&&E.push(t[0].getOccurencePath())})),s.transactions[0].insertExisting.inserted=E}}return s},e})),define("DS/ENOPAD_v2/features/CreateOptionsBuilder",["DS/PADUtils/PADSession","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/Storage","DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/ConfigurationCache","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],(function(e,t,n,i,o,s,r,a,d){"use strict";const l="DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext";function c(){e.setAuthoringState(!0,"PADSession_enabling_authoring_mode")}function u(e,t,n){let i=e.map((function(e){return e.identifier}));c(),o.publish({event:"ENXViews/WelcomePanel/closeLandingPage"}),t.add({pids:i,callback:function(e){if("error"!==e){let e=t.getRoots(),o=e.filter((function(e){return i.includes(e.getID())}));for(let s=0;s<o.length;s++){let r=o[s];r.select(),t.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.length,added_node:r}}),n.dispatchEvent("onAddPaths",{addedPaths:[[r.getID()]]});let a={pids:i,already_added_in_PS:!0};t._cmdProxy.drop(a)}}}})}function p(e,t){let n=e.grpGetOtherNode(t.getRoot());n.addChild(t),n.isExpanded()||n.setState(r.NODE_STATES.PARTIALLY_EXPANDED)}function g(e,t,n){let i=n.AuthoringContextHeader[t];i&&(e.header[t]=i)}function h(e){this._internalOptions=e,this._internalOptions.isInsert=!1,this._setup(),this._internalOptions.storageKey=i.getAppId()+".typeSelection."+this._internalOptions.typeDetails.newType,this._internalOptions.repeatKey=s.buildKey(i.getAppId(),"activateCreateAnother",!0),this.options=function(e){let t={},n=s.local.get(e);return n&&(t.preferedType=n),t}(this._internalOptions.storageKey),this.facets=function(e,t){let n=[];return n.push({name:"classificationFacet",facetoptions:{isBookmark:!0,isLibrary:!0,isExportControl:!0}}),!a.isEnabled("xRevisionActivation")||e||t||n.push({name:"revisionFacet"}),n}("drawing"===this._internalOptions.typeDetails.newType,"component"===this._internalOptions.typeDetails.newType),this.viewType="tabView",this.context=function(){let e={};e.tenant=n.getPlatformId(),e.header={SecurityContext:i.getSecurityContext()};try{let t=require(l).get();t&&t.AuthoringContextHeader&&(g(e,"DS-Change-Authoring-Context",t),g(e,"DS-Configuration-Authoring-Context",t))}catch(e){console.log("Cfg Auth fails",e)}return e}(),"component"===e.typeDetails.newType&&(this.context.isAdminUser=i.getAdminUser()),this.manageMaturityAndLock=function(e){this.activateDraftMode={show:!1},this.activatelock={show:!1,preference:""};let n=t.getSetting("maturityControlByAdmin");if(t.getSetting("lockControlByAdmin")&&widget.hasPreference("lockStatusAtContentCreation")&&!0===widget.getValue("lockStatusAtContentCreation")&&(this.activatelock.show=!0,widget.hasPreference("lockStatusLabels"))){let e=widget.getPreference("lockStatusLabels").value;"1"===e&&(this.activatelock.preference="LOCK"),"0"===e&&(this.activatelock.preference="UNLOCK")}widget.hasPreference("maturityStateAtContentCreation")&&!0===widget.getValue("maturityStateAtContentCreation")&&(this.activateDraftMode.show=!0),"Disabled"===n&&(this.activateDraftMode.preference="PRIVATE"),"Enabled"===n&&(this.activateDraftMode.preference="IN_WORK")},!0===t.getSetting("activate_FUN141510")&&this.manageMaturityAndLock(e),!0===t.getSetting("activateFUN153004")&&widget.hasPreference("inheritReferenceLock")&&!0===widget.getPreference("inheritReferenceLock").value&&(this.leadingappspecific={lockConnectionAsFather:!0});let o=s.local.get(this._internalOptions.repeatKey);void 0!==o&&(this.activateCreateAnother=o);let r=this._model.getSelectedNodes().filter((e=>!i.isFakeTreeNodeModel(e)&&!0!==e.isGroupingNode));if(r.length){let e=r.map((function(e){return e.getID()})).filter(((e,t,n)=>n.indexOf(e)===t));this.options.parentPIDs=e,this._internalOptions.isInsert=!0}this.events={onSuccess:this._onSuccess.bind(this),onFailure:this._onFailure.bind(this),onCancel:this._onCancel.bind(this)}}function f(e){this.options=e,this._setup()}return h.prototype={_setup:function(){this._model=this._internalOptions.model,this._component=this._internalOptions.component,this._typeDetails=this._internalOptions.typeDetails},_onSuccess:function(e){if("success"===e.status){if(e.result.length){let t=e.result[0].type;s.local.set(this._internalOptions.storageKey,t)}this._internalOptions.isInsert?function(e,t){let n=[],i={transactions:[]};for(let o=0;o<e.length;o++){let s=e[o],r={insertExisting:{modified:[],inserted:[],created:[],withContext:!1}};for(let e=0;e<s.relations.length;e++){let o=s.relations[e],a=t.getNodesById(o.fromID);for(let e=0;e<a.length;e++){let t=a[e];r.insertExisting.modified.push(o.fromID);let s=t.getOccurencePath();s.push(o.relationshipID),s.push(o.toID),r.insertExisting.created.push(o.relationshipID),n.push(s),r.insertExisting.inserted.push(s),i.transactions.push(r)}}}c(),t.addPaths({paths:n,isInsert:!0,callback:function(e){if(e&&e.success){t._cmdProxy.padRefresh(i);let e=t.isGroupingApplied(),o=n.map((function(e){return t.getNodeByOccurencePath(e)}));for(let n=0;n<o.length;n++){let i=o[n],s=i.getParent();if(e)for(;s.isGroupingNode;)s=s.getParent();s.setState(r.NODE_STATES.PARTIALLY_EXPANDED),e&&p(t,i)}t.isOccModel&&t.isDGVGroupingApplied()&&t.triggerDGVGroupingReapply()}}})}(e.result,this._model):u(e.result,this._model,this._component),i.displayNotif({level:"success",message:d.plmnew.creationSuccess})}},_onFailure:function(e){},_onCancel:function(e){e.activateCreateAnother=!1;let t=e.activateCreateAnother;void 0!==t&&s.local.set(this._internalOptions.repeatKey,t)}},f.prototype={_setup:function(){this._model=this.options.model,this._typeDetails=this.options.typeDetails},execute:function(){return new h(this.options)}},f})),define("DS/ENOPAD_v2/utils/ReadWriteAccessController",["DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADCommandProxy","DS/PADServices/utils/GlobalModelEvents"],(function(e,t,n){const i={icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-pencil"},label:"write"},o={icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-pencil-block"},label:"read"},s={icon:{iconClasses:""},label:"not root"};function r(){}var a;return r.prototype={determineReadOnlyIcon:function(e){return e.isRoot()?e.options.isReadOnly&&!0===e.options.isReadOnly?o:i:s}},a||(a=new r),a})),define("DS/ENOPAD_v2/models/mixins/PADDocReplace",["DS/PADServices/utils/Batches","DS/PADServices/utils/Generics","DS/PADServices/utils/GlobalModelEvents","DS/ENXNav/utils/TwoDAppEvents","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],(function(e,t,n,i,o){"use strict";function s(){}return s.prototype={replaceNodesOcc:function(s){let r=this;return new Promise(((a,d)=>{let l,c=!1,u=!1;s.toInsert&&(s.toInsert.isProdConfig&&(c=!0,delete s.toInsert.isProdConfig),s.toInsert.noNotification&&(u=!0,delete s.toInsert.noNotification));let p=Promise.resolve(),g=r.isDGVGroupingApplied();g&&(l=r.getDGVGroupingApply(),p=new Promise(((e,t)=>{r.getModelEvents().subscribeOnce({event:"groupNodes"},(()=>{e()}))})),r.triggerDGVGroupingClear()),p.then((()=>{let d=Object.keys(s.toInsert).map((e=>{let n=s.toInsert[e];return t.checks.array(n)?{start:e,array:n}:null})).filter((e=>null!==e)),u={transactions:[]},p=[],h=d.reduce(((e,t)=>{let n=t.array.map((e=>{let n=[...r.getNodesById(t.start)[0].getOccurencePath(),e.relationid,e.resourceid],i={insertExisting:{modified:[],inserted:[],created:[],withContext:!1}};return i.insertExisting.modified.push(t.start),i.insertExisting.inserted.push(n),i.insertExisting.created.push(e.relationid),u.transactions.push(i),e.ordering&&p.push({path:n,ordering:e.ordering}),n}));return e=e.concat(n)}),[]);r._beginBlockingTransaction(o.inserting_nodes);let f=e.breakup(h,1e3,1e3),D=e.stepper(f,{},(function(e){r.wrappedAddPaths({paths:e}).then((()=>{D()})).catch((()=>{D()}))}),(function(){let e=s.toDelete.map((e=>e.physicalid)),t=e.reduce(((e,t)=>{let n=r.getNodesByRelId(t);return e=e.concat(n)}),[]),o=t.length>0;for(let e=0;e<t.length;e++){let n=t[e],i=n.getParent();"partiallyExpanded"!==i.getState()&&i.setState({state:"partiallyExpanded"}),n.remove()}if(o){let e=function(){r._pendingAttr?setTimeout(e,10):n.publish({event:"ENXModel/SyncModel",data:{refresh:!0}})};e()}let d={detach:{deleted:e}};r._cmdProxy.padRefresh(d),r._cmdProxy.padRefresh(u);for(let e=0;e<p.length;e++){let t=p[e],n=r.getNodeFromPath(t.path);if(n){let e=n.getParent(),i=t.ordering;if(i.before){let t=e.getChildren().filter((e=>e.options.relationid===i.before));t.length&&e.insertBefore(n,t[0])}if(i.after){let t=e.getChildren().filter((e=>e.options.relationid===i.after));t.length&&e.insertAfter(n,t[0])}"partiallyExpanded"!=e.getState()&&e.setState({state:"partiallyExpanded"})}}if(r.isBSDGroupingApplied()){let e=r.options.context.features.bsdIntegration,t=h.map((e=>r.getNodeFromPath(e)));e.replaceMaybeAssign({nodes:t})}g&&r.triggerDGVGroupingReapply(l),i.addChild(),r._endBlockingTransaction(),c&&r.bubbleStaticMapMessageOnce(),a()}));D()}))}))}},s})),define("DS/ENOPAD_v2/models/mixins/PADDocOccExcludes",["DS/PADUtils/PADWSAccess","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/views/PADAlert","i18n!DS/ENXNav/assets/nls/ENXNav.json"],(function(e,t,n,i,o){"use strict";function s(){n.publish({event:"ENXModel/refresh/complete",data:{skipSyncModel:!0}})}var r=!1;function a(){}return a.prototype={triggerExcludePathsUpdate:function(){let e=this;return new Promise(((i,o)=>{if(t.getSetting("activateExcludeOccurrences")&&t.getSetting("activateExcludeOccRefresh")&&!0!==this.isOccModel){n.publish({event:"ENXModel/refresh/begin",data:{}});let t=e.getRoots(),o=[];for(let n=0;n<t.length;n++){let i=t[n];o.push(e._performGetExcluded(i))}Promise.allSettled(o).then((()=>{s(),i()})).catch((()=>{s(),i()}))}else i()}))},_performGetExcluded:function(t){let n=this;return new Promise(((i,o)=>{let s=t.getID();const r={serviceId:"3DSpace",data:{select_bo:["physicalid"],select_rel:["physicalid"],root_path_physicalid:[[s]],rootPhID:s},FBIProxy:n.options.FBIProxy,intent:"explore_2D",onComplete:function(e){try{if(e&&!e.contains("error")){let n=JSON.parse(e),o=[];for(let e=0;e<n.results.length;++e){let t=n.results[e];if(o.push(t.Path),t.matching_lengths)for(let e=0;e<t.matching_lengths.length;++e)o.push(t.Path.slice(0,t.matching_lengths[e]))}t.setExcludedOccurrences(o),i()}else console.error("Error while getting excluded occurrences"),o()}catch(e){console.error(e),o()}},onFailure:function(e){console.log("getExcludedOcc##Failure"),o()},onTimeout:function(){console.log("getExcludedOcc##Timeout"),o()}};e.getStaticMappingExcludedOccurrences(r)}))},bubbleStaticMapMessageOnce:function(){if(t.getSetting("activateExcludeOccWarning")&&t.getSetting("staticMappingEnabled")&&!r){r=!0;let e=o.staticMappingFoundinSession2D;e.eventID="warning",i.displayNotification(e)}}},a})),define("DS/ENOPAD_v2/models/mixins/PADDocInsertsOcc",["DS/ENOXParser/modules/PADParserOcc","DS/ENOXParser/modules/ClientDataParser","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/Generics","DS/PADServices/utils/Iterator","DS/PADServices/settings/AppSettings","DS/ENXNav/utils/TwoDAppEvents","DS/PADUtils/views/PADAlert","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],(function(e,t,n,i,o,s,r,a,d,l,c){"use strict";function u(){}return u.prototype={insertNodes:function(e,n){this.unselectAll();let r=e.isProdConfig;delete e.isProdConfig;let u={docPtr:this,padRefreshData:{transactions:[]},insertedNodes:[],pathToFetch:[],rootNodesIds:[],rootNodes:[],objects:e,parentOccurencePaths:[],orderInfos:[]};!function(e){s.iterateObj(e.objects,(function(n,i){if(o.checks.array(n)){let o={insertExisting:{modified:[],inserted:[],created:[]}};if(s.iterate(n,(function(n){let r=e.docPtr.getNodesById(i);s.iterate(r,(function(s){let r=s.getOccurencePath().slice();r.push(n.relationid),r.push(n.resourceid),-1===e.pathToFetch.indexOf(r)&&(e.pathToFetch.push(r),o.insertExisting.modified.push(i),o.insertExisting.inserted.push(n.resourceid),e.insertedNodes.push(n.relationid),o.insertExisting.created.push(n.relationid),o.insertExisting.withContext=!1);let a=n.clientTaskData;if(a){new t(a).appendPaths(e.pathToFetch);let n=e.pathToFetch.filter((t=>e.docPtr.getNodesById(t[0])[0].isRoot()));e.pathToFetch=n}if(n.ordering){let t=n.ordering,i={nodePath:r};if(t.before){i.before=e.docPtr.getNodesByRelId(t.before)[0];let o=i.before.getParent().getOccurencePath();o.push(n.relationid),o.push(n.resourceid),i.nodePath=o}t.after&&(i.after=e.docPtr.getNodesByRelId(t.after)[0]),e.orderInfos.push(i)}}))})),-1===e.rootNodesIds.indexOf(i)){e.rootNodesIds.push(i);let t=e.docPtr.getNodesById(i);t&&(e.rootNodes=e.rootNodes.concat(t),s.iterate(t,(function(t){var n=t.getOccurencePath();-1===e.parentOccurencePaths.indexOf(n)&&e.parentOccurencePaths.push(n)})))}e.padRefreshData.transactions.push(o)}}))}(u);e.noNotification;delete e.noNotification,this._beginBlockingTransaction(l.inserting_nodes);let p=this;this.wrappedAddPaths({paths:u.pathToFetch,isInsert:!0}).then((e=>{p._endBlockingTransaction(),u.orderInfos.length?function(e,t){for(let n=0;n<e.length;n++){let o=e[n],s=t.getNodeFromPath(o.nodePath);if(o.before){let e=o.before.getParent();e.insertBefore(s,o.before),e.setState(i.NODE_STATES.PARTIALLY_EXPANDED),e.options.padstate=i.NODE_STATES.PARTIALLY_EXPANDED.state,e.options.childComputed=!1}}}(u.orderInfos,p):function(e,t){let n=e.map((e=>t.getNodeFromPath(e)));for(let e=0;e<n.length;e++){let t=n[e].getParent();t.setState(i.NODE_STATES.PARTIALLY_EXPANDED),t.options.padstate=i.NODE_STATES.PARTIALLY_EXPANDED.state,t.options.childComputed=!1}}(u.pathToFetch,p),function(e){if(e.insertedNodes.length){var t=[];s.iterate(e.insertedNodes,(function(n){let i=e.docPtr.getNodesByRelId(n);i&&i.length&&t.push(i[0].getOccurencePath())})),e.padRefreshData.transactions[0].insertExisting.inserted=t}}(u),p._cmdProxy.padRefresh(u.padRefreshData),p.isDGVGroupingApplied()&&p.triggerDGVGroupingReapply(),a.addChild(),r&&p.bubbleStaticMapMessageOnce()})).catch((e=>{p._endBlockingTransaction(),d.displayNotification({msg:c.generic_service_failure,eventID:"error"})}))}},u})),define("DS/ENOPAD_v2/models/mixins/PADDocProductToPartOcc",["DS/PADServices/ws/WSAccess","DS/PADServices/utils/PlatformURL","DS/PADUtils/views/PADAlert","DS/ENOXParser/ParserCV","DS/ENXNav/utils/TwoDAppEvents","i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/ENXNav/assets/nls/ENXNav"],(function(e,t,n,i,o,s,r){"use strict";function a(){}return a.prototype={productToPart:function(a){try{var d=this;d.parameters=a,e.productToPart({enopad_webapis:!0,data:{intent:"explore_2D",select_predicate:["ds6w:type"],select_file:["icon","thumbnail_2d"]},pids:d.parameters.pid,template:d.parameters.template,onComplete:function(e){var l=UWA.is(e,"string")?JSON.parse(e):e;if(l.results&&1===l.results.length){if(1==l.results.length){const e=l.results.map((e=>e.attributes.filter((e=>"resourceid"===e.name))))[0];d.wrapInTransaction((function(){d._switchToAuthoring(),i.parseAddOcc({treeDoc:d,FBIProxy:d._getFBI(),wsResponse:l}).then((function(i){d._parseLoadModel=!1,o.addRoot(),n.displayNotification({eventID:"success",msg:r.productToPartCmd.successNotif});const s=d.getNodesById(e[0].value);var a=d.options.context;if(s.length){var l=s[0].getOccurencePath();a.dispatchEvent("onAddPaths",{addedPaths:[l]})}var c={tenant:t.getPlatformId(),pids:l};a._commandProxy.drop(c),d.unselectAll(),d.getNodeByOccurencePath(l).select()})).catch((function(e){d._parseLoadModel=!1,console.error(e)}))}))}}else n.displayNotification({msg:s.object_not_found_in_db,eventID:"error",key:"enxNav-productToPart-object-not-found-in-db"}),a.callback&&a.callback("error")},onFailure:function(e,t){var i=r.productToPartCmd.err_generic_server;if((t=UWA.is(t,"string")?JSON.parse(t):t)&&t.attributeMap&&t.attributeMap.error_code)switch(t.attributeMap.error_code.value){case 3:i=r.productToPartCmd.err_product_under_change;break;case 4:i=r.productToPartCmd.err_product_with_conf}n.displayNotification({msg:i,eventID:"error",key:"enxNav-productToPart-err-product"}),a.callback&&a.callback("error")}})}catch(e){console.warn(e)}}},a})),define("DS/ENOPAD_v2/mixins/_PADKBInput",["UWA/Core","UWA/Class","UWA/Event","DS/ApplicationFrame/CommandsManager","DS/PADUtils/views/PADAlert","DS/Utilities/Dom","i18n!DS/PADUtils/assets/nls/PADUtils.json"],(function(e,t,n,i,o,s,r){"use strict";return t.extend({_component:null,init:function(e){this._parent(e),this._component=e.component,this._onKeyDown_binded=this._onKeyDown.bind(this)},startObservingKeyboard:function(t){e.Element.addEvent.call(t,"keydown",this._onKeyDown_binded)},_onKeyDown:function(e){var t=this,a=n.whichKey(e),d=function(a,d){if((u=document.activeElement)&&"INPUT"===u.tagName){if("esc"===a)if(s.firstParentWithClass(document.activeElement,"xnav_treelst")&&t._component){var l=document.activeElement.getParent();t._component.getPADTreeListView().cancelModification(l.getAttribute("row-id"),l.getAttribute("column-id"))}}else{var c=i.getCommand(d);c&&(c.isEnabled()||"Uncut"===d)?(c.begin(),n.stop(e)):"Paste"===d&&(!1===t._component.getEditMode()?o.displayNotification({msg:r.edit_mode_disabled,eventID:"warning"}):o.displayNotification({msg:r.must_select,eventID:"warning"}))}var u};switch(a){case"ctrl+a":d(a,"SelectAll");break;case"ctrl+c":d(a,"Copy");break;case"ctrl+x":d(a,"Cut");break;case"ctrl+v":d(a,"Paste");break;case"ctrl+z":case"esc":d(a,"Uncut");break;case"alt+return":case"alt+enter":d(a,"ActionBar_Attributes")}}})})),define("DS/ENOPAD_v2/features/CreateOptionsForDesignExp",["DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],((e,t,n)=>{var i,o="ENXModel/Root/addTile",s="ENXModel/DesignEnv/add";return class{constructor(e){this.model=e.model,this.component=e.component,this.typeDetails=e.typeDetails,this.options=e,i=this}_onSuccess(e){return"success"===e.status&&(this.component.addCommandHit(self.widget.deCreationFromWP?"DGX-CreateDEFromWP":"DGX-CreateDEFromActionBar"),self.widget.deCreationFromWP=!1,e.result&&e.result.length&&(t.displayNotif({level:"success",message:n.plmnew.creationSuccess}),self.widget.newDesignExpCreated=!0,this.openCreatedDesignExp(e.result[0]))),!1}_onFailure(e){console.log(e)}_onCancel(e){console.log(`${e.newType} creation dialog has been closed.`)}fetchDB(e){let t=i.model._getFetchFunc(!0);return new Promise((n=>{t({data:{physicalid:[e]},autoAttSelection:!0}).then((e=>{let t="string"==typeof e?JSON.parse(e):e;n(t.results&&t.results.length?t.results[0].attributes.find((e=>"ds6w:label"==e.name)).value:"")}))}))}execute(){return this.creationResultsProcessor(this.options),this}openCreatedDesignExp(e){var t=JSON.parse(e.identifier);this.fetchDB(t).then((n=>{e.displayName=n;let r=(a=e,{protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",widgetId:"preview-c185fc",data:{items:[{envId:i.context.tenant,serviceId:"3DSpace",contextId:i.context.header.SecurityContext,objectId:t,objectType:a.type,displayName:e.displayName,displayType:a.type}]}});var a;self.widget.newDesignExpCreated=!0,i.model.deFetchDB=i.fetchDB,i.model.getModelEvents().publish({event:o,data:{unserializedData:r,behavior:"WITHOUT_CONTEXT",broadcast:!0}});require(["DS/PADServices/utils/GlobalModelEvents"],(e=>{e.publish({event:s,data:{designEnv:r.data.items}}),e.publish({event:"ENXModel/DesignEnv/addToRecents",data:{designEnvIds:[t]}}),e.publish({event:"ENXModel/DesignEnv/removeColumn"})}))}))}creationResultsProcessor(n){this._internalOptions=n,this.options={},this.facets=[],this.viewType="tabView",this.context={tenant:e.getPlatformId(),header:{SecurityContext:t.getSecurityContext()}},this.events={onSuccess:this._onSuccess.bind(this),onFailure:this._onFailure.bind(this),onCancel:this._onCancel.bind(this)}}}})),define("DS/ENOPAD_v2/commands/_PADActionBarCmds",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/PADServices/utils/GlobalUtils","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],(function(e,t,n,i){"use strict";var o=["Copy","Cut","PADOpen","DownloadStructure"];return e.extend({init:function(e){this._parent(e);var n=this;if(-1!==o.indexOf(this.options.ID)){this._check_select(),this._boundSelect=this._check_select.bind(this);let e=t.get().options.model.getXSO();e.onPostAdd(this._boundSelect),e.onPostRemove(this._boundSelect)}"RemoveAndResetExpand"===this.options.ID&&(this.options.label=i.grouping.commandTitle),"Paste"===this.options.ID&&require(["DS/ENOPAD_v2/utils/PADClipboard"],(function(e){n._boundActivate=n._activate_paste.bind(n);let i=t.get().getPADTreeDocument().getXSO();i.onPostAdd(n._boundActivate),i.onPostRemove(n._boundActivate),e.addEvent("post_setData",n._activate_paste.bind(n)),e.addEvent("post_clear",n._activate_paste.bind(n)),n._activate_paste()})),"DownloadStructure"!==this.options.ID&&(!0!==t.get().getEditMode()&&n.disable(),t.get().addEvent("editModeModified",(function(e){"Paste"===n.options.ID?n._activate_paste():n._check_select()})))},execute:function(){var e=this;switch(this.options.ID){case"Copy":require(["DS/ENOPAD_v2/commands/edit/_Copy"],(function(n){n.execute({command_id:e.options.ID,context:t.get()})}));break;case"Cut":require(["DS/ENOPAD_v2/commands/edit/_Cut"],(function(n){n.execute({command_id:e.options.ID,context:t.get()})}));break;case"Paste":require(["DS/ENOPAD_v2/commands/edit/_Paste"],(function(n){n.execute({command_id:e.options.ID,context:t.get()})}));break;case"Uncut":require(["DS/ENOPAD_v2/commands/edit/_Uncut"],(function(n){n.execute({command_id:e.options.ID,context:t.get()})}));break;case"DownloadStructure":require(["DS/ENOPAD_v2/commands/tools/DownloadStructure"],(function(n){n.execute({command_id:e.options.ID,context:t.get()})}));break;case"RemoveAndResetExpand":let n=t.get(),i=n.features.bsdIntegration;i&&i.executeCommand({id:this.options.ID,context:n,model:n.getPADTreeDocument()});break;default:throw new Error("Unknown command")}},isCommandAvailable:function(e){if("RemoveAndResetExpand"===e.cmdId){let e=t.get().getPADTreeDocument();return!(!e.isBSDGroupingApplied()||!function(e){let t=e.getXSO().get(),n=!0;for(let e=0;e<t.length;e++)if(t[e].isGroupingNode){n=!1;break}return n}(e))}return!0},_check_select:function(){var e=!t.get().options.model.getXSO().isEmpty();if(!0===t.get().getEditMode()){let i=t.get().options.model.getXSO().get(),o=i.filter((e=>!n.isFakeTreeNodeModel(e)&&!0!==e.isGroupingNode));i.length!==o.length?this.disable():!0===e&&"DownloadStructure"!==this.options.ID?this.enable():this.disable()}else this.disable()},_activate_paste:function(){var e=require("DS/ENOPAD_v2/utils/PADClipboard"),n=!t.get().options.model.getXSO().isEmpty(),i=t.get().getEditMode();!0!==e.isEmpty(e.OBJECT)&&!0===n&&!0===i?this.enable():this.disable()}})})),define("DS/ENOPAD_v2/commands/edit/_Paste",["UWA/Class"],(function(e){"use strict";return{execute:function(e){e.context.paste()}}})),define("DS/ENOPAD_v2/models/mixins/PADDocEndPoints",["i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADServices/settings/AppSettings","DS/PADServices/utils/PConfigUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADSession","DS/PADServices/ws/WSAccess"],(function(e,t,n,i,o,s){"use strict";function r(){}return r.prototype={_isAuthoring:function(){return o.determineAuthoredFlag()},_getExpandFunc:function(e){let t=void 0!==e?e:this._isAuthoring(),n=void 0!==window.jasmine;return(!this._boundExpandIndex&&!this._boundExpandDB||n)&&(this._boundExpandDB=s.expandv2DBprogressive.bind(s),this._boundExpandIndex=s.expandv2.bind(s)),t?this._boundExpandDB:this._boundExpandIndex},_getFetchFunc:function(e){let t=void 0!==e?e:this._isAuthoring(),n=void 0!==window.jasmine;return(!this._boundFetchIndex&&!this._boundFetchDB||n)&&(this._boundFetchDB=s.fetchDB.bind(s),this._boundFetchIndex=s.fetch.bind(s)),t?this._boundFetchDB:this._boundFetchIndex},_hasMultiRootSupport:function(){return n.isMultiRootSupported()},_getFBI:function(){return this.options.FBIProxy},_getClass:function(){return this.options.nodeModelClass},_getWebApiTimeout:function(){return this._webApiTimeout||(this._webApiTimeout=t.getSetting("webapi_timeout")),this._webApiTimeout},_switchToAuthoring:function(){o.setAuthoringState(!0,e.PADSession_enabling_authoring_mode)},_getAuthoringFlag:function(){return o.determineAuthoredFlag()},_getCmdProxyPtr:function(){return this._cmdProxy},isBSDGroupingApplied:function(){let e=this.options.context.features,t=e&&e.bsdIntegration;return!!t&&t.isBSDGroupingApplied()},isDGVGroupingApplied:function(){let e=this.options.context;if(e){let t=e.getPADDGVView();if(t){return void 0!==t.options.dgv.groupingApplied}}},triggerDGVGroupingReapplySpecific:function(e){let t,n=this.options.context,i=!1;if(n){let o=n.getPADDGVView();if(o){let n=o.options.dgv;t=window.structuredClone(n.groupingApplied),i=n.groupingApplied===e}}i&&(this.triggerDGVGroupingClear(),this.getModelEvents().subscribeOnce({event:"groupNodes"},(()=>{this.triggerDGVGroupingReapply(t)})))},triggerDGVGroupingReapply:function(e){if(e){let t=this.options.context;if(t){let n=t.getPADDGVView();if(n){n.options.dgv.groupingApplied=e}}}i.publish({event:"ENXModel/parseEnded"})},triggerDGVGroupingClear:function(){i.publish({event:"ENXViews/DatagridView/ClearViewGrouping"})},getDGVGroupingApply:function(){let e,t=this.options.context;if(t){let n=t.getPADDGVView();if(n){let t=n.options.dgv;e=window.structuredClone(t.groupingApplied)}}return e}},r})),define("DS/ENOPAD_v2/features/private/BsdApi",["DS/PADServices/utils/Iterator","DS/ENOXParser/modules/BsdTree"],(function(e,t){"use strict";const n="DS/TerminologySelector/service/TerminologyWebService",i=new Map([["resourceid","id"],["ds6w:label","label"],["predicatename","predicatename"],["type_icon_url","icon"],["sourceid","sourceid"]]);function o(t){let n={};return t.attributes&&e.iterate(t.attributes,(function(e){let t=i.get(e.name);t&&(n[t]=e.value)})),n}return{getBrowsingStructureTree:function(e){let i=e.predicateToMatch;return new Promise(((s,r)=>{require(["DS/BrowsingStructureAPI/service/BrowsingStructureAPI",n],(function(n,a){a.searchTerminologies({searchTerms:!1,onComplete:function(a){let d=("string"==typeof a?JSON.parse(a):a).results.map(o).filter((t=>{let n=t.predicatename;return n.startsWith("ds6w:")||(n="ds6w:"+n),0===n.localeCompare(i,e.lang,{sensitivity:"base"})}));if(d.length){let e=d[0].id;n.getBrowsingStructureTree({itemsID:e}).then((e=>{console.log(e);let n=new t({wsResponse:e,predicate:i});s(n)})).catch((e=>{console.error(e),r({isApiError:!0,err:e})}))}}})}))}))},getBSDNodesForProductNodes:function(e){return new Promise(((t,i)=>{require([n],(function(n){n.getAssociatedTermsPerInstance({itemsID:e.relationIds}).then((e=>{t(e)})).catch((e=>{i(e)}))}))}))}}})),define("DS/ENOPAD_v2/views/PADDropConfirm",["css!DS/UIKIT/UIKIT","css!DS/ENOPAD_v2/ENOPAD_v2","i18n!DS/PADUtils/assets/nls/PADUtils.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","DS/UIKIT/SuperModal","DS/UIKIT/Input/Button","DS/Utilities/Utils"],(function(e,t,n,i,o,s,r,a,d){return o.extend(s,{name:"dropConfirm",defaultOptions:{},init:function(e){var t={MOVE:n.MOVE_label,COPY:n.COPY_label,Reorder:n.Reorder_label},i={top:n.before_label,bottom:n.after_label},o=t[e.copyMode];e.isOutsideWidget?o=t.COPY:(e.isReordering&&(o=t.Reorder,e.isReparent&&(o=t.MOVE)),"COPY"===e.copyMode&&(o=t.COPY));var s=i[e.dropPosition]||"before",a=new r({className:this.name+"_modal",closable:!0,okButtonText:o,koButtonText:n.cancel,animate:!0,renderTo:document.body}),d={};d.title=o,e.isReparent&&e.isReordering?d.message=n.replace(n.get("confirmation_message_move_in_order"),{dndMode:o.toLowerCase(),source:e.dropName,position:s,target:e.targetName}):e.isReordering?d.message=n.replace(n.get("confirmation_message_reorder"),{dndMode:o.toLowerCase(),source:e.dropName,position:s,target:e.targetName}):d.message=o===t.MOVE?n.replace(n.get("confirmation_message_move"),{dndMode:o.toLowerCase(),source:e.dropName,target:e.targetName}):n.replace(n.get("confirmation_message"),{dndMode:o.toLowerCase(),source:e.dropName,target:e.targetName}),d.callback=function(t){e.callback(t)},a.confirm(d)}})})),define("DS/ENOPAD_v2/features/private/EditorTools",[],(function(){"use strict";function e(){}let t;return e.prototype={expandAndWait:function(e){return new Promise(((t,n)=>{e.getModelEvents().subscribeOnce({event:"postExpand"},(n=>{let i=n.data.nodeModel;i===e&&t({success:!0,node:i,parent:e})})),e.expand({expandAll:!1,interactiveExpandAll:!1,numberOfLevelsToExpand:1})}))},multipleSubscribe:function(e){return new Promise(((e,t)=>{e()}))}},t||(t=new e)})),define("DS/ENOPAD_v2/commands/EditMode",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/PADUtils/PADContext","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalModelEvents"],(function(e,t,n,i,o){"use strict";return t.extend({_triggerFromCmd:null,_context:null,_toolbarActivated:!1,init:function(e){this._parent(e,{});var t=this;this._context=n.get(),this._toolbarActivated=this._context.isToolbarActivated(),!0===this._toolbarActivated?!0===this._context.getEditMode()?this.setState(!1,!1):this.setState(!0,!1):!0===this._context.getEditMode()?this.setState(!0,!1):this.setState(!1,!1),this.onStateChange((function(){t._triggerFromCmd=!1;var e=t.getState();!0===t._toolbarActivated&&(e=!e),t._context.setEditMode(e)})),o.getModelEvents().subscribe({event:"ENXModel/ReadWriteTriggered"},(function(e){var n=t.getState();e&&t.isEnabled()&&(t.disable(),t.previousState=n,t.setState(!1)),e||null==t.previousState||(t.enable(),t.setState(t.previousState),delete t.previousState)}))}})})),define("DS/ENOPAD_v2/models/mixins/PADDocAddAndAddPaths",["i18n!DS/PADServices/assets/nls/PADServices","DS/PADServices/utils/Meas","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/PADTrackerManager","DS/PADServices/settings/AppSettings","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/ParserCV","DS/ENXNav/utils/TwoDAppEvents"],(function(e,t,n,i,o,s,r,a,d){"use strict";const l=t.addOrGetSection("PADModel.PADDocAdd");function c(e){let t;for(let n=0;n<e.length&&!t;n++){let i=e[n];"resourceid"===i.name&&(t=i.value)}return t}function u(){n.displayNotif({message:e.errors.genericWSFailure,level:"error",key:"xNavDoc-addOcc"})}function p(t,i){let o=function(e){return e.reduce(((e,t)=>{let n=!0;e.push(t);let i=t.slice();for(;n;){let t=i.slice(0,i.length-2);e.push(t),1===t.length&&(n=!1),i=t}return e}),[])}(i),s=o.map((e=>t.getNodeFromPath(e))).filter((e=>e&&!0===e.options.waiting4validation)),r=!1;for(let e=0;e<s.length;e++){s[e].remove(),r=!0}r&&n.displayNotif({message:e.errors.cannotInsertBranch,level:"error",key:"xNavDoc-addPaths-cannot-add-branch"})}function g(){}return g.prototype={add:async function(t){let o=l.create("addFull",{stats:!0}),s=function(e,n){o.end(),t.callback&&t.callback(e,n)},r=this;return new Promise(((o,a)=>{r._directSelection=!0;let d={alreadyLoadedRoots:[]},l=function(e){return e.pids.filter((function(t,n){return e.pids.indexOf(t)===n}))}(t),c=function(e,t,n){let i=e.getRoots().map((function(e){return e.getID()}));return t.filter((function(e){let t=i.includes(e);return t&&n.alreadyLoadedRoots.push(e),!t}))}(r,l,d);if(c.length!==l.length&&(n.displayNotif({message:e.infos.rootAlreadyLoaded}),d.noNotif=!0),0===c.length)return d.noNotif=!0,s(d),void o();{let t={pids:c},l=r._isAuthoring();r._performAddWork(t).then((function(e){s(d),o()})).catch((function(c){if(c.typeInvalid)s("error"),a(c);else if(l){let e=!1,t=r.getSelectedNodes();if(t&&t.length>0){let n=!1;for(let i=0;i<t.length;i++)!0!==t[i].isRelationsObjectNode?n=!0:e=!0;!0===n&&u()}else c.resultsLess&&c.pidsFailed&&c.pidsFailed.length&&i.publish({event:"ENXViews/WelcomePanel/cleanup",data:{item2remove:c.pidsFailed}}),u();s("error",e)}else r._switchToAuthoring(),r._performAddWork(t).then((()=>{s(d),o()})).catch((t=>{t.resultsGreater?(n.displayNotif({message:e.errors.tooManyResults,level:"error",key:"xNavDoc-add-too-many-results"}),s("error"),a(t)):t.resultsLess?(n.displayNotif({message:e.errors.objectNotFoundInDB,level:"error",key:"xNavDoc-add-obj-not-found"}),s("error"),a(t)):(u(),s("error"),a(t))}))}))}}))},_performAddWork:function(e){let t=this,n=t._isAuthoring(),i=e.pids,o={pids:i,autoAttSelection:!0};n&&(o={data:{physicalid:i},autoAttSelection:!0});let s=this._getFetchFunc(n);return new Promise(((e,n)=>{let u=l.create("addAPI",{stats:!0});s(o).then((function(o){let s=r.data.jsonParse(o);if(u.end(),s.results&&s.results.length===i.length)t._validateTypes({json:s}).then((o=>{t._parseLoadModel=!0;let r=l.create("addParse",{stats:!0}),u=function(e,t){let n;return n=e.length>1?e.map((e=>t.results.filter((t=>c(t.attributes)===e))[0])):t.results,{results:n}}(i,s);a.parseAddOcc({treeDoc:t,FBIProxy:t.options.FBIProxy,wsResponse:u}).then((function(){t._parseLoadModel=!1,r.end(),d.addRoot(),e()})).catch((function(e){t._parseLoadModel=!1,n({isParseError:!0,err:e})}))})).catch((e=>{n({typeInvalid:!0,err:e})}));else if(s.results){if(s.results.length>i.length)n({resultsGreater:!0});else if(s.results.length<i.length){let e=[];s.results.length&&(e=s.results.map((e=>c(e.attributes))));let t=i.filter((t=>!e.includes(t)));n({pidsFailed:t,resultsLess:!0})}}else n({isEmpty:!0})})).catch((function(e){n({isApiFailure:!0})}))}))},_validateTypes:function(e){return new Promise(((t,n)=>{let i=[];for(let t=0;t<e.json.results.length;t++){let n=a.parseAttributes(e.json.results[t].attributes).type;i.push({type:n})}require(["DS/PADUtils/PADTypesMgt"],(function(e){e.isTypesAuthorized(i,(function(e){0!==e.length?t({validTypes:e}):n()}),!1,!1,"1.0")}))}))},addPaths:async function(t){o.addCommandHit("addPaths",""+t.paths.length);let n=l.create("addPathsFull",{stats:!0}),i=function(e,i){n.end();let o={success:e};t.callback&&t.callback(o,i)},s=this;return new Promise(((n,o)=>{let r={alreadyLoadedRoots:[]},l=s._isAuthoring(),c=t.paths;if(0===c.length)return i(!1,r),void n();t.isInsert&&function(e,t){for(let n=0;n<t.length;n++){let i=t[n];for(let t=i.length-1;t>=0;t-=2){let n=i.slice(0,t+1),o=e.getNodeFromPath(n);o&&(o.options.waiting4validation=!0)}}}(s,c),a.insertTempPaths({treeDoc:s,FBIProxy:s.options.FBIProxy,paths:t.paths,nodeModelClass:s.options.nodeModelClass,nls:e.parser,state:t.state?t.state:"partiallyExpanded"}).then((()=>{let e={paths:t.paths};s._performAddPathsWork(t).then((e=>{d.addRoot(),i(!0,{...r,json:e}),n()})).catch((t=>{l?(p(s,c),i(!1,r),o()):(s._switchToAuthoring(),s._performAddPathsWork(e).then((()=>{i(!0,{...r,json:json}),n()})).catch((()=>{p(s,c),i(!1,r),o()})))}))}))}))},_performAddPathsWork:function(e){let t=this,n=this._getExpandFunc(this._isAuthoring());return new Promise(((i,o)=>{e.paths;let d={pathIds:e.paths,data:{expandLevel:"0"},FBIProxy:t.options.FBIProxy,timeout:s.getSetting("webapi_timeout"),select_relation:["ro.plminstance.v_treeorder"],withOccResponse:!0};n(d).then((n=>{let s=r.data.jsonParse(n);s.errors&&s.errors.length||!s.results||s.results&&0===s.results.length?o({errorsResult:!0,errors:s.errors}):a.parsePathsOcc({treeDoc:t,FBIProxy:t._getFBI(),wsResponse:s,nodeModelClass:t._getClass(),state:e.state?e.state:"partiallyExpanded"}).then((e=>{let n=e.rootIds.map((e=>t.getNodeById(e))),o=t.getModelEvents(),r=t.getRoots().length;for(let e=0;e<n.length;e++){let t=n[e];o.publish({event:"onRootAdded",data:{nb_root:r,added_node:t}})}i(s)}))})).catch((()=>{o({isApiError:!0})}))}))},wrappedAddPaths:function(e){let t=this;return new Promise(((n,i)=>{e.callback=function(e,t){e.success?n({msg:e,addParamsCB:t}):i()},t.addPaths(e)}))}},g})),define("DS/ENOPAD_v2/mixins/_PADFolder",["UWA/Core","UWA/Class","DS/PlatformAPI/PlatformAPI","DS/PADUtils/PADSettingsMgt"],(function(e,t,n,i){"use strict";return t.extend({requestCurrentFolder:function(){n.publish("FolderEditor.RequestCurrentFolder")},setFolderCommunicationChannel:function(){n.subscribe("FolderEditor.CurrentFolder",this.setCurrentFolder.bind(this)),this.requestCurrentFolder()},getCurrentFolder:function(){return this.getOption("current_folder")&&this.getOption("current_folder")!=={}?this.getOption("current_folder"):null},setCurrentFolder:function(e){this.setOption("current_folder",e);var t="string"==typeof e?JSON.parse(e):e;widget&&i.getSetting("syncSecCtxOnFolderChange")&&(widget.setValue("pad_security_ctx",t.SecurityContext),i.setSetting("pad_security_ctx",t.SecurityContext))},getSecurityContext:function(){return{SecurityContext:i.getSetting("pad_security_ctx"),tenant:i.getSetting("x3dPlatformId")}}})})),define("DS/ENOPAD_v2/models/mixins/PADDocSupport",["DS/PADUtils/PADSession","DS/PADServices/settings/AppSettings","DS/ENOXParser/modules/TwoDParser","DS/ENOXParser/modules/common/Helpers"],(function(e,t,n,i){"use strict";function o(){}return o.prototype={doRefreshCV:function(e,o){let s=this;return new Promise((function(o,r){let a={pathIds:e.map((function(e){return e.getOccurencePath()})),data:{expandLevel:-1},FBIProxy:s.options.FBIProxy,timeout:t.getSetting("webapi_timeout")};s._getExpandFunc(!1)(a).then((function(t){let r=i.data.jsonParse(t);n.refresh({roots:e,treeDoc:s,FBIProxy:s.options.FBIProxy,wsResponse:r,expandLevel:-1}).then((function(){s.isGroupingApplied()&&s.__applyGrouping({roots:e,groups:s.options.groups}),o()}))})).catch((function(e){r(e)}))}))},_getAuthoringFlag:function(){return e.determineAuthoredFlag()}},o})),define("DS/ENOPAD_v2/commands/edit/_Copy",["UWA/Class"],(function(e){"use strict";return{execute:function(e){e.context.copy()}}})),define("DS/ENOPAD_v2/utils/PADBulkEdit",["css!DS/ENOPAD_v2/ENOPAD_v2","UWA/Core","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/UIKIT/Mask","DS/PADUtils/PADWSAccess","DS/PADUtils/views/PADAlert","DS/PADUtils/PADSession","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices"],(function(e,t,n,i,o,s,r,a,d,l){"use strict";var c="DS/ENOFloatingPanel/ENOFloatingPanel",u=/^\d+$/;const p=["\v","\t","\n","\r","\f","\v"];function g(e){let t=e,n=p.length;for(let e=0;e<n;e++)t=t.replace(p[e],"");return t}function h(e,t){return parseInt(e.valueItem)-parseInt(t.valueItem)}function f(){var e=document.getElementsByClassName("xnav_component");return e&&1===e.length?e[0]:document.body}var D={cleanStr:g,execute:function(e){var i=e.padcomponent,a=i.getPADDGVView().options,l=a.dgv,c=i.getPADTreeDocument(),u=i.getSelectedNodes(),p=e.cellInfos,h=l.getColumnOrGroup(p.columnID),f=h.dataIndex,v=d.getSetting("bulkEditPCSLimit");if(u.length>v)r.displayNotification({msg:n.replace(n.get("bulkEditPCSLimitExceeded"),{limit:v}),eventID:"warning"});else{var m=require("DS/ENOPAD_v2/utils/PADDGVDirectEdition");switch(f){case"ds6w:responsible":m.changeOwnerCmd(p);break;case"ds6w:reserved":m.reservedCmd(p);break;case"ds6w:status":m.changeMaturityCmd(p);break;case"ds6wg:EnterpriseExtension.V_PartNumber":m.setThePartNumberCmd(p);break;default:o.mask(l.getContent(),n.checkingRights);for(var P={lIds:[],busIDs:[],relIDs:[],attributes:"true"},_=!1,A=0;A<u.length;A++){var S;f.endsWith("-Instance")?(S=u[A].getRelationID())&&S.length>0&&(_=!0,-1===P.relIDs.indexOf(S)&&P.relIDs.push(S)):(S=u[A].getID(),-1===P.busIDs.indexOf(S)&&P.busIDs.push(S))}if(0===P.busIDs.length&&0===P.relIDs.length)return void o.unmask(l.getContent());s.read({data:P,onComplete:function(e){"string"==typeof e&&(e=g(e));var i=t.is(e,"string")?JSON.parse(e):e;o.unmask(l.getContent());for(var s,d,u=[],v=!1,P=0;P<i.results.length;P++){var A,S=i.results[P];if((A=_?c.getNodesByRelId(S.physicalID):c.getNodesById(S.physicalID)).length){var b=A[0],I=d=m._updateNodeModel(A[0],S,_,a),N=!0;I.isEditable&&b.options.edit.editableColumns[f]&&!1===b.options.edit.editableColumns[f].readOnly&&(N=!1,u.push(S.physicalID)),N?(r.displayNotification({msg:n.replace(n.get("accessrightAttrenoteditable_2"),{attr:h.text,label:A[0].getLabel()}),eventID:"warning"}),delete A[0].options.edit):(v=!0,s=I.editableColumns[f].kind,I.editableColumns[f].maxLength)}}if(v)switch(s){case"integer":case"float":case"string":D.editStringAttribute({cellInfos:p,editableIds:u,model:c,dgv:l,editOptions:d,isInstance:_,colOpt:h});break;case"timestamp":D.editDateAttribute({cellInfos:p,editableIds:u,model:c,dgv:l,editOptions:d,isInstance:_,colOpt:h});break;case"boolean":D.editBoolAttribute({cellInfos:p,editableIds:u,model:c,dgv:l,editOptions:d,isInstance:_,colOpt:h});break;case"enum":D.editEnumAttribute({cellInfos:p,editableIds:u,model:c,dgv:l,editOptions:d,isInstance:_,colOpt:h});break;default:console.error("Unknown kind of attribute")}i.notification&&"ERROR"===i.notification.type&&r.displayNotification({msg:i.notification.message,eventID:"info"})},onTimeout:function(){r.displayNotification({msg:n.accessrightCheckTimeout,eventID:"error"}),o.unmask(l.getContent())},onFailure:function(){r.displayNotification({msg:n.accessrightCheckFailed,eventID:"error"}),o.unmask(l.getContent())}})}}},editStringAttribute:function(e){require([c,"DS/Controls/LineEditor","DS/Controls/Button"],(function(i,o,s){var r,a="",d=t.createElement("div",{class:"PADEditModalBody stringEdit"}),l=e.editOptions.editableColumns[e.colOpt.dataIndex].mandatory;l=void 0!==l&&l;var c=e.editOptions.editableColumns[e.colOpt.dataIndex].kind;new t.Element("div",{class:"ellipsis",html:e.colOpt.text}).inject(d),l&&new t.createElement("div",{class:"mandIcon  wux-ui-3ds wux-ui-3ds-new-create"}).inject(d),new o({placeholder:e.cellInfos.cellModel,value:e.cellInfos.cellModel,requiredFlag:l,selectAllOnFocus:!0,sizeInCharNumber:e.editOptions.editableColumns[e.colOpt.dataIndex].maxLength}).inject(d).addEventListener("uncommittedChange",(function(e){var t=!0;a=e.dsModel.valueToCommit,"integer"===c||"real"===c?t=!isNaN(Number(a)):""===a&&e.dsModel.requiredFlag&&(t=!1),r.disabled=!t}));var u=t.createElement("div",{class:"PADEditModalFooter"});(r=new s({label:n.save,emphasize:"primary",touchMode:!0,disabled:l,onClick:function(){D.updateModelOnServer({model:e.model,cellInfos:e.cellInfos,newValue:a,editableIds:e.editableIds,editOptions:e.editOptions,isInstance:e.isInstance,colOpt:e.colOpt}),g.destroy()}})).inject(u),new s({label:n.cancel,touchMode:!0,onClick:function(){g.destroy()}}).inject(u);let p=n.replace(n.get("editAttribute"),{attr:e.cellInfos.cellModel});e.editableIds&&e.editableIds.length>1&&(p=n.replace(n.get("editAttributeNoOfObjects"),{attr:e.editableIds.length}));var g=new i({className:"PADEditModal stringEdit",title:p,body:d,footer:u,overlay:!0,closable:!0,animate:!0,resizable:!1,visible:!0,autocenter:!0,events:{onClose:function(){g.destroy()}}});document.addEventListener("keyup",(function(e){27===e.keyCode&&g&&(g.destroy(),g=null)})),g.inject(f())}))},editDateAttribute:function(e){var i=this;require([c,"DS/Controls/DatePicker","DS/Controls/Button"],(function(o,s,r){var a,d,l=t.createElement("div",{class:"PADEditModalBody dateEdit"}),c=(new Date(Date.now()),e.cellInfos.nodeModel.options.grid[e.colOpt.dataIndex]),u=e.editOptions.editableColumns[e.colOpt.dataIndex]?.mandatory;c&&new Date(c),new t.Element("div",{html:e.colOpt.text}).inject(l),u&&new t.createElement("div",{class:"mandIcon  wux-ui-3ds wux-ui-3ds-new-create"}).inject(l);var p=new s({value:e.cellInfos.cellModel,timePickerFlag:!0}).inject(l),g=i.buildCancelClosure(e.cellInfos.nodeModel);p.addEventListener("change",(function(e){a=e.dsModel.value,d.disabled=!1}));var h=t.createElement("div",{class:"PADEditModalFooter"});d=new r({label:n.save,emphasize:"primary",touchMode:!0,disabled:!0,onClick:function(){require([v],(function(t){var n=t.convertDateToStandard(a,!0);D.updateModelOnServer({model:e.model,cellInfos:e.cellInfos,newValue:n.valueDB,editableIds:e.editableIds,editOptions:e.editOptions,isInstance:e.isInstance,colOpt:e.colOpt})})),P.destroy()}});var v="DS/WidgetServices/WidgetServices";d.inject(h),new r({label:n.cancel,touchMode:!0,onClick:function(){g(),P.destroy()}}).inject(h);let m=n.replace(n.get("editAttribute"),{attr:e.cellInfos.cellModel});e.editableIds&&e.editableIds.length>1&&(m=n.replace(n.get("editAttributeNoOfObjects"),{attr:e.editableIds.length}));var P=new o({className:"PADEditModal stringEdit",title:m,body:l,footer:h,overlay:!0,closable:!0,animate:!0,resizable:!1,visible:!0,autocenter:!0,events:{onClose:function(){g(),P.destroy()}}});document.addEventListener("keyup",(function(e){27===e.keyCode&&P&&(g(),P.destroy(),P=null)})),P.inject(f())}))},editBoolAttribute:function(e){var i=this;require([c,"DS/Controls/ButtonGroup","DS/Controls/Button"],(function(o,s,r){var a,d,l=t.createElement("div",{class:"PADEditModalBody boolEdit"}),c=e.editOptions.editableColumns[e.colOpt.dataIndex]?.mandatory;new t.createElement("div",{class:"text",html:e.colOpt.text}).inject(l),c&&new t.createElement("div",{class:"mandIcon  wux-ui-3ds wux-ui-3ds-new-create"}).inject(l);let u=e.cellInfos.nodeModel.options.grid[e.colOpt.dataIndex],p=!("boolean"!=typeof u||!u)||"string"==typeof u&&"TRUE"===u.toUpperCase(),g="boolean"==typeof u&&!u||"string"==typeof u&&"FALSE"===u.toUpperCase();var h=(new s).inject(l);h.addChild(new r({type:"radio",touchMode:!0,label:n.True,value:!0,checkFlag:p,displayStyle:"lite-borders",icon:{iconName:"check",fontIconSize:"2x",fontIconFamily:WUXManagedFontIcons.Font3DS}})),h.addChild(new r({type:"radio",touchMode:!0,label:n.False,value:!1,checkFlag:g,displayStyle:"lite-borders",icon:{iconName:"wrong",fontIconSize:"2x",fontIconFamily:WUXManagedFontIcons.Font3DS}})),h.addEventListener("change",(function(e){a=e.dsModel.value,d.disabled=!1}));var v=i.buildCancelClosure(e.cellInfos.nodeModel),m=t.createElement("div",{class:"PADEditModalFooter"});(d=new r({label:n.save,emphasize:"primary",touchMode:!0,disabled:!0,onClick:function(){D.updateModelOnServer({model:e.model,cellInfos:e.cellInfos,newValue:a,isBoolean:!0,editableIds:e.editableIds,editOptions:e.editOptions,isInstance:e.isInstance,colOpt:e.colOpt}),_.destroy()}})).inject(m),new r({label:n.cancel,touchMode:!0,onClick:function(){v(),_.destroy()}}).inject(m);let P=n.replace(n.get("editAttribute"),{attr:e.cellInfos.cellModel});e.editableIds&&e.editableIds.length>1&&(P=n.replace(n.get("editAttributeNoOfObjects"),{attr:e.editableIds.length}));var _=new o({className:"PADEditModal boolEdit",title:P,body:l,footer:m,overlay:!0,closable:!0,animate:!0,resizable:!1,visible:!0,autocenter:!0,events:{onClose:function(){v(),_.destroy()}}});document.addEventListener("keyup",(function(e){27===e.keyCode&&_&&(v(),_.destroy(),_=null)})),_.inject(f())}))},editEnumAttribute:function(e){var i=this;require([c,"DS/Controls/ComboBox","DS/Controls/Button","DS/Controls/ButtonGroup","DS/Controls/Toggle"],(function(o,s,r,a,d){for(var l,c=e.editOptions.editableColumns[e.colOpt.dataIndex],p=t.createElement("div",{class:"PADEditModalBody PADEditModalBody comboEdit"}),g=function(e){for(var t=0,n=0;n<e.length;n++)u.test(e[n])&&t++;return t===e.length}(c.range),v=[],m=0;m<c.range.length;m++)v.push({labelItem:c.displayRange[m],valueItem:c.range[m]});g&&v.sort(h);var P=e.editOptions.editableColumns[e.colOpt.dataIndex]?.mandatory,_=i.buildCancelClosure(e.cellInfos.nodeModel);new t.createElement("div",{class:"boolEdit text",html:e.colOpt.text}).inject(p),P&&new t.createElement("div",{class:"mandIconEnum  wux-ui-3ds wux-ui-3ds-new-create"}).inject(p);var A=new s({elementsList:v,currentValue:c.current,enableSearchFlag:!1}).inject(p),S=t.createElement("div",{class:"PADEditModalFooter"});l=new r({label:n.save,emphasize:"primary",touchMode:!0,disabled:!1,onClick:function(){var t=A.value;D.updateModelOnServer({model:e.model,cellInfos:e.cellInfos,newValue:t,editableIds:e.editableIds,editOptions:e.editOptions,isInstance:e.isInstance,colOpt:e.colOpt}),I.destroy()}}),l.inject(S),new r({label:n.cancel,touchMode:!0,onClick:function(){_(),I.destroy()}}).inject(S);let b=n.replace(n.get("editAttribute"),{attr:e.cellInfos.cellModel});e.editableIds&&e.editableIds.length>1&&(b=n.replace(n.get("editAttributeNoOfObjects"),{attr:e.editableIds.length}));var I=new o({className:"PADEditModal  PADEditModalBody comboEdit",title:b,body:p,footer:S,overlay:!0,closable:!0,animate:!0,resizable:!1,visible:!0,autocenter:!0,events:{onClose:function(){_(),I.destroy()}}});document.addEventListener("keyup",(function(e){27===e.keyCode&&I&&(_(),I.destroy(),I=null)})),I.inject(f())}))},buildCancelClosure:function(e){return function(){delete e._updateFromEdit,delete e._editDataIndex,delete e.options.edit}},updateModelOnServer:function(e){var o=[],d=e.colOpt.dataIndex,c="model/bus/";e.isInstance&&(c="model/rel/");for(var u=e.editOptions.editableColumns[d].path,p=e.editOptions.editableColumns[d].selectable,g=0;g<e.editableIds?.length;g++){var h={path:c+e.editableIds[g],method:"PATCH",body:[{op:"replace",path:u,value:e.newValue}],queryParams:{select:["physicalid","modified",p]}};o.push(h)}var f={UXName:"Data Grid",client_app_domain:"3DEXPERIENCE 3DDashboard",client_app_name:l.getAppId()};e.model._beginBlockingTransaction(n.updateAttribute),s.update({data:{metrics:f,requests:o},onComplete:function(o){e.model._endBlockingTransaction(),a.setAuthoringState(!0,i.PADSession_disabling_index_authoring);var s=t.is(o,"string")?JSON.parse(o):o;if(!s.results)throw new Error("Invalid update answer");for(var l=e.model,c=0;c<s.results.length;c++){var u,p=s.results[c],g=p.body.physicalid;u=e.isInstance?l.getNodesByRelId(g):l.getNodesById(g);for(var f,D=h.body[0].path,v=Object.keys(p.body),m=[],P=0;P<v.length;P++){var _=v[P];-1!==_.indexOf(D)&&(f=p.body[_]).notification&&m.push(f.notification)}if(p.body.errors&&p.body.errors.length>0)for(P=0;P<p.body.errors.length;P++)m.push(p.body.errors[P]);if(m&&m.length>0)for(P=0;P<m.length;P++)r.displayNotification({msg:m[P].message,eventID:"warning"});else if(p.body.oldInstancePhysicalid){let e={authored:[{modified:p.body.physicalid,previous:p.body.oldInstancePhysicalid}]};l._onRefresh(e)}else if(u&&u.length>0){if(p.body.oldInstancePhysicalid){let e={authored:[{modified:p.body.physicalid,previous:p.body.oldInstancePhysicalid}]};l._onRefresh(e)}l.withTransactionUpdate((function(){for(var t,n=require("DS/WidgetServices/WidgetServices"),i=e.editOptions,o=0;o<u.length;o++){var s=u[o];if(!t){t={grid:{}};for(var r=Object.getOwnPropertyNames(i.editableColumns),a=0;a<r.length;a++)i.editableColumns[r[a]].selectable&&p.body[i.editableColumns[r[a]].selectable]&&("tree"===r[a]?(t.label=p.body[i.editableColumns[r[a]].selectable].value[0],t.display=t.label,t.oldLabel=t.label):s.options.grid.hasOwnProperty(r[a])&&(p.body[i.editableColumns[r[a]].selectable].value?(t.grid[r[a]]=p.body[i.editableColumns[r[a]].selectable].value[0],"timestamp"===i.editableColumns[r[a]].kind&&(t.grid[r[a]]=n.formatDate(t.grid[r[a]]))):t.grid[r[a]]=""));s.options.grid["ds6w:modified"]&&p.body.modified&&p.body.modified.value&&(t.grid["ds6w:modified"]=n.formatDateObj(p.body.modified.value[0]))}s._updateFromEdit&&delete s._updateFromEdit,s._editDataIndex&&delete s._editDataIndex,s.options.edit&&delete s.options.edit,!0===e.isBoolean&&(t.grid[d]=e.newValue[0]),s.updateOptions(t)}})),r.displayNotification({msg:n.attributeModified,eventID:"success"}),e.model.triggerDGVGroupingReapplySpecific(e.colOpt.dataIndex)}}},onFailure:function(){r.displayNotification({msg:n.attributeModificationFailed,eventID:"warning"}),e.model&&e.editableIds.length&&(e.model._endBlockingTransaction(),e.editableIds.forEach((function(t){var n,i=e.model;(n=i.getNodesById(t)?i.getNodesById(t)[0]:i.getNodesByRelId(t)[0])._updateFromEdit&&delete n._updateFromEdit,n._editDataIndex&&delete n._editDataIndex,n.options.edit&&delete n.options.edit})))}})}};return D})),define("DS/ENOPAD_v2/models/mixins/PADDocExpand",["i18n!DS/PADServices/assets/nls/PADServices","DS/PADServices/utils/Meas","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/PADTrackerManager","DS/PADServices/settings/AppSettings","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/modules/PADParserOcc","DS/PADServices/utils/PConfigUtils","DS/ENXNav/utils/TwoDAppEvents","DS/ENOXParser/modules/common/Constants","DS/TreeModel/TreeNodeModel","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],(function(e,t,n,i,o,s,r,a,d,l,c,u,p){"use strict";const g=t.addOrGetSection("PADModel.PADDocExpand");let h;function f(){if(h)return h;{const e=require("DS/PADUtils/PADContext");return h=e.get(),h}}function D(e){let t=!1;return t=null!=e&&e,t}const v="expanded",m="collapsed";function P(e,t,n){let i;i=e.getNodeSource()===u.NODE_SOURCE.GROUPING?e.getNodeDepth():e.getDepth();let o=!0;const s=-1===t||i<t,r=D(e.options.childComputed);if(s&&r){(function(e,t){if(e.options.childComputed){var n=e.getChildren();if(n&&1===n.length)return!(t&&t.has(e)||"ds6w:Document"!==n[0].options.globaltype)}})(e,n)||e.isRelationsObjectNode&&1!==t||e.setState({state:v});const s=!e.isRelationsObjectNode&&(-1===t||i+1<=t);o=!(!s||!e.hasChildren())&&function(i){if(i){const i=e.getChildren();let s=!1;for(let r=0;i&&r<i.length;r++)P(i[r],t,n)?(e.setState({state:v}),o=!0,s=!0):s||(o=!1)}else localOverride||(o=!1,e.setState({state:"collapsed"}));return o}(s)}else if(function(e){const t="ds6w:globalType",n="ds6w:Document";return e.options.grid[t]===n||e.options.padgrid&&e.options.padgrid[t]===n}(e)){if(o=!1,e&&e.getParent()){const n=e.getParent(),i=n.getState();1===n.getChildren().length&&-1===t?D(n.options.childComputed)||n.setState({state:m}):i!==v?"Rendering Representation"===e.options.type?(o=!0,n.setState({state:v})):n.setState({state:m}):i!==v||"Drawing"!==e.options.type||n.getChildren().length>1||(o=!0)}}else i===t&&r?o=!1:e&&void 0===r&&(o=!0);return o}function _(){i.publish({event:"ENXNav/parser/expandAll/begin"})}function A(){i.publish({event:"ENXNav/parser/expandNLevel/begin"})}function S(){i.publish({event:"ENXNav/parser/expandNLevel/complete"})}function b(){i.publish({event:"ENXNav/parser/expandAll/complete"})}function I(e){for(let t=0;t<e.length;t++){delete e[t]._expandAllPending}}function N(){}return N.prototype={__expandCB:async function(e){let t=e.data,n=t.nodeModel,r=!!t.expandAll&&t.expandAll,a=t.numberOfLevelsToExpand?t.numberOfLevelsToExpand.toString():s.getSetting("expand_iter");if(n.getNodeSource()===u.NODE_SOURCE.GROUPING)return e.target.preExpandDone({preventExpandAll:!0,state:"expanded"}),void(n.options.isGroupingNode=!0);r&&(a="-1"),o.addCommandHit("ExpandOcc","ExpandCB-"+a=="-1"?"all":a),r&&(n._expandAllPending=!0,_()),a>=1&&(n._expandAllPending=!0,A());let d=a,c=parseInt(a,10),p=!0;const h=r?-1:n.getDepth()+c;let D=g.create("validateExistingTree",{stats:!0}),v=this._was3DShapeExpanded;p=P(n,h,v),D.end();let m=n.getRoot(),I=!1;m.options.isReadOnly&&(I=!0);let N=m.options.filtered;N||(N=!1);let E=!1;if("partiallyExpanded"!==m.options.padstate||N||(E=!0),!1===p)e.target.preExpandDone({preventExpandAll:!0}),this._selectOccurence(),function(){let e=f();return!(!e||!e.colorMap)}()&&this._colorize3D(this),delete n._expandAllPending,r&&b(),a>=1&&S();else{let t=this._isAuthoring();I&&(t=!1);let o=this.prodConfigSupportInAuth,s=this.options.context.xNavPersistFilterSpec.readOnlyRootsFilterSpec,u=this,p={nodeModels:[n],expandLevel:a,expandLevelInt:c,originalRequest:d,expandAll:r,isFiltered:N,isAuthoring:t,modelEvents:e,prodConfigSupportInAuth:o,readOnlyRootsFilterSpec:s,isReadOnlyRoot:I};this._performApiAndParse(p).then((t=>{l.expand(),E&&this._cmdProxy.padExpand({paths:t.paths,expand_level:c}),1===c&&(n.options.childComputed=!0),e.target.preExpandDone({preventExpandAll:!0,state:"expanded"}),a>=1&&S(),b(),i.publish({event:"ENXModel/parseEnded"}),u._selectOccurence()})).catch((()=>{e.target.preExpandDone({preventExpandAll:!0,state:"collapsed"}),a>=1&&S(),b()}))}},expandMultiSelect:function(e){let t=this,n=e.expandAll,i=e.numberOfLevelsToExpand?e.numberOfLevelsToExpand.toString():s.getSetting("expand_iter");n&&(i="-1");let o=this.prodConfigSupportInAuth;o||(o=!1);let r=this.options.context.xNavPersistFilterSpec.readOnlyRootsFilterSpec,a=[],d=function(){e.callback&&e.callback()};var l=parseInt(i);let u=this._was3DShapeExpanded,p=e.nodes2Expand.filter((e=>P(e,l,u))),g=this._isAuthoring();if(0===p.length)return function(e){for(let t=0;t<e.length;t++){let n=e[t];n.isExpanded()||n.setState({state:v})}}(e.nodes2Expand),void d();if(n&&_(),i>=1&&A(),g){let e=p.map((e=>{let t=e.getRoot(),i=!!t.options.isReadOnly,o=!!t.options.filtered,s=!!t.validFilter;return n&&(e._expandAllPending=!0),{node:e,root:t,isReadOnly:i,isFiltered:o,hasConfig:s}})),s=[];this._hasMultiRootSupport()&&(s=e.filter((e=>e.hasConfig)));let d=e.filter((e=>e.isReadOnly&&!s.includes(e))),c=e.filter((e=>!d.includes(e)&&!s.includes(e))),u={nodeModels:[],expandLevel:i,expandLevelInt:l,originalRequest:i,expandAll:n,isFiltered:!1,isAuthoring:!1,prodConfigSupportInAuth:o,readOnlyRootsFilterSpec:r};d.length&&(u.isReadOnlyRoot=!0,d.reduce(((e,t)=>(e.nodeModels.push(t.node),t.isFiltered&&(e.isFiltered=!0),e)),u),a.push(this._performApiAndParse(u)));let g={nodeModels:[],expandLevel:i,expandLevelInt:l,originalRequest:i,expandAll:n,isFiltered:!1,isAuthoring:!0,prodConfigSupportInAuth:o};if(c.length&&(c.reduce(((e,t)=>(e.nodeModels.push(t.node),t.isFiltered&&(e.isFiltered=!0),e)),g),a.push(this._performApiAndParse(g))),s.length){let e=s.map((e=>{let s={nodeModels:[e.node],expandLevel:i,expandLevelInt:l,originalRequest:i,expandAll:n,isFiltered:!1,isAuthoring:!0,prodConfigSupportInAuth:o};return t._performApiAndParse(s)}));a=a.concat(e)}}else{let e={nodeModels:p,expandLevel:i,expandLevelInt:l,originalRequest:i,expandAll:n,isFiltered:!1,isAuthoring:!1,prodConfigSupportInAuth:o};a.push(this._performApiAndParse(e))}Promise.allSettled(a).then((e=>{e.forEach((e=>{"rejected"===e.status?(n&&(b(),I(p)),i>=1&&S(),d()):(n&&(p.forEach((e=>e.setState(c.NODE_STATES.EXPANDED))),b(),I(p)),i>=1&&S(),d())}))})).catch((()=>{n&&(b(),I(p)),i>=1&&S(),d()}))},_performApiAndParse:function(t){let o=this;return new Promise(((s,d)=>{let l=t.nodeModels,c=t.expandLevel,u=t.originalRequest,g=t.expandLevelInt,h=t.isAuthoring,f=t.isFiltered,D=t.modelEvents,v=t.isReadOnlyRoot,m=l.map((e=>e.getOccurencePath())),P=o._getWebApiTimeout();const _={pathIds:m,data:{expandLevel:c},FBIProxy:o._getFBI(),timeout:P,select_relation:["ro.plminstance.v_treeorder"],withOccResponse:!0};t.prodConfigSupportInAuth&&(_.data.prodConfigSupportInAuth=!0),t.readOnlyRootsFilterSpec&&t.readOnlyRootsFilterSpec.size>0&&(_.data.readOnlyRootsFilterSpec=t.readOnlyRootsFilterSpec),o._getExpandFunc(h)(_).then((t=>{let p=r.data.jsonParse(t);if(p.timeoutOccurs)throw p;if(p.results&&p.results.length)o._parseLoadModel=!0,a.expandWithSort({treeDoc:o,expandedNodes:l,FBIProxy:o._getFBI(),wsResponse:p,nodeModelClass:o._getClass(),expandLevel:g,expandLevelRequest:parseInt(u,10),filter:f,isAuthoring:h}).then((()=>{o._parseLoadModel=!1,s({paths:m})})).catch((e=>{o._parseLoadModel=!1,d({isParseError:!0,isApiError:!1,e:e})}));else{if(p.errors){if(o.dontPopExpandError=!1,o.options.context.hasActiveDesignExp()&&v&&!h&&l.length){o.dontPopExpandError=!0;let t=1==l.length;n.displayNotif({title:e.replace(e.warnings.unindexedRootExpand[t?"singleRootTitle":"multiRootTitle"],{product:t?l[0].options.label:""}),subtitle:e.warnings.unindexedRootExpand.subtitle})}let t=function(e){let t={unknownMetaNameDisplay:"",isUnknownMetas:!1,unknownMetas:[]},n=e.filter((e=>"UNKNOWN_META"===e.code)),i=new Set;t.isUnknownMetas=n.length>0;for(let e=0;e<n.length;e++){let o=n[e];if(void 0!==o.unknownmetas)i.add(...o.unknownmetas);else if("string"==typeof o.unknownMetas){let e=o.unknownMetas.length,t=o.unknownMetas.substring(1,e-1).split(",");for(let e=0;e<t.length;e++){let n=t[e];i.add(n.trim())}}else if(o.reason){let e=o.reason;const n="com.exalead.expand.progressive.ProgressiveExpandException: [",s=e.indexOf(n)+n.length;let r=e.substring(s,e.length-1);t.unknownMetaNameDisplay=r;let a=r.replace(/,\s+/g,",");i.add(a)}}return t.unknownMetas=Array.from(i),t}(p.errors);t.isUnknownMetas?function(t,o,s){i.subscribeOnce({event:"ENXViews/DatagridView/CheckColumns/Done"},(()=>{o&&o.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete s._expandAllPending,s.setState({state:"collapsed"}),i.publish({event:"ENXNav/parser/expandAll/complete"});let r=require("DS/PADServices/utils/PlatformURL");n.displayNotif({title:e.replace(e.warnings.unknownMeta2.title,{metaName:t.unknownMetaNameDisplay,envId:r.getPlatformId()}),subtitle:e.warnings.unknownMeta2.subtitle})})),i.publish({event:"ENXViews/DatagridView/CheckColumns",data:{colsToRemove:t.unknownMetas}})}(t,D,l[0]):function(t,o,s,r){o&&o.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete t._expandAllPending,t.setState({state:"collapsed"}),r||n.displayNotif({message:e.replace(e.errors.cannotExpandObject,{rootLabel:t.getLabel(),expandLevel:"-1"===s?"all":s}),level:"error",key:"xNavDoc-expand-api-error"}),i.publish({event:enxNavParserExpandAllComplete})}(l[0],D,c,o.dontPopExpandError)}(!p.results||p.results&&0===p.results.length)&&(f?n.displayNotif({message:e.infos.findInCtxNoResult,level:"info"}):n.displayNotif({message:e.errors.genericWSFailure,level:"error",key:"xNavDoc-expand-generic-error"})),d({isBadResponse:!0,isParseError:!1,isApiError:!0})}})).catch((t=>{if(t&&t.timeoutOccurs)o._isAuthoring()?n.displayNotif({title:p.expandTimeoutDB.title,message:p.expandTimeoutDB.message,level:"error",key:"xNavDoc-expand-request-timeout"}):n.displayNotif({title:e.errors.requesttimeoutTitle,message:e.errors.requesttimeout,level:"error",key:"xNavDoc-expand-request-timeout"});else{let t=l[0].getLabel();!o.dontPopExpandError&&function(t,i){n.displayNotif({message:e.replace(e.errors.cannotExpandObject,{rootLabel:t,expandLevel:"-1"===i?"all":i}),level:"error",key:"xNavDoc-expand-parse-error"})}(t,c),o.dontPopExpandError=!1}d({isParseError:!1,isApiError:!0,e:t})}))}))}},N})),define("DS/ENOPAD_v2/models/mixins/PADDocCfgHook",["DS/PADUtils/PADUtilsServices","DS/PADServices/utils/Iterator"],(function(e,t){"use strict";const n="SUCCESS";function i(){}return i.prototype={subscribeToCfgHook:function(){let i=this;e.subscribeCfgModifyEvent({handler:function(e){let o=e.commandName,s=e.response.results,r=[];switch(o){case"cfgExtendEvolutionEffectivity":s=e.response.resources,function(e,i){t.iterate(e,(function(e){e.status===n&&e.identifier&&i.push(e.identifier)}))}(s,r),r.length&&i.additionalColumnUpdateByModule("CfgEffectivityColumns",{relids:r});break;case"cfgEditEvolution":case"cfgPasteEvolution":!function(e,i){t.iterate(e,(function(e){e.status===n&&e.existing&&i.push(e.existing.pid)}))}(s,r),r.length&&i.additionalColumnUpdateByModule("CfgEffectivityColumns",{relids:r});break;case"cfgEditConfigurationContext":i.additionalColumnUpdateByModule("CfgConfigurationContextColumn",{pids:e.data.pids});break;case"cfgRevManualComposition":i.additionalColumnUpdateByModule("CfgConfigurationRevisionColumn",{pids:e.data.pids});break;case"cfgReplaceInstantiatedConfigurationByRevision":i.additionalColumnUpdateByModule("CfgProductConfigurationColumn",{relids:e.data.relids});break;default:let o=[];!function(e,i,o){t.iterate(e,(function(e){e.status===n&&(e.new?i.push({oldId:e.existing.pid,newId:e.new.pid}):o.push(e.existing.pid))}))}(s,o,r),o.length&&i.splitInstance({couples:o,editVariant:!0}),r.length&&i.additionalColumnUpdateByModule("CfgEffectivityColumns",{relids:r})}}})},refreshCfgValues:function(e){this.additionalColumnUpdateByModule("CfgEffectivityColumns",e)}},i})),define("DS/ENOPAD_v2/utils/UrlParams",[],(function(){"use strict";function e(e){this.options=e,this._build()}return e.prototype={_build:function(){let e=window.top.location.href,t=new URL(e).searchParams;this._map=new Map;for(const[e,n]of t)this._map.set(e,n)},has:function(e){return this._map.has(e)},get:function(e){return this._map.get(e)}},e})),define("DS/ENOPAD_v2/models/mixins/PADDocRefresh",["DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/Iterator","DS/ENXNav/models/RefreshMask","DS/PADServices/utils/private/TreeDocUpdate","DS/ENXNav/models/NodeUtils","DS/ENXNav/models/SmartNodeOptions","DS/PADUtils/PADSession","DS/PADServices/utils/PConfigUtils","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],(function(e,t,n,i,o,s,r,a,d,l,c,u){"use strict";function p(){}return p.prototype={refresh:function(){let e=this.getRoots(),t=this._getAuthoringFlag();if(t&&this.isGroupingApplied()){let e=this.options.context.features.grouping;e&&e.displayRefreshMessage()}else if(t){let t=e.filter((function(e){return 0==e.options.isReadOnly&&!e.validFilter})),s=e.filter((function(e){return 1==e.options.isReadOnly&&!e.validFilter})),r=c.isMultiRootSupported()?e.filter((e=>e.validFilter)):[];t.map((function(e){return e.getOccurencePath()}));var n=s.map((function(e){return e.getOccurencePath()})),i=new Map;t.length>0&&i.set("Author",t),n.length>0&&i.set("Index",s),r.length&&i.set("AuthPConf",r);var o=this;i.forEach((function(e,t){if("AuthPConf"===t)for(var n=0;n<e.length;n++)o._parent({roots:[e[n]],isEditor:!0,isReadOnlyRoot:!1});else{let n;void 0!==o&&void 0!==o.options&&(n=o.options.context),void 0!==n&&void 0!==n.options&&n.options.isDeEnabled&&n.hasActiveDesignExp()?"Index"!=t&&o._parent({roots:e,isEditor:!0,isReadOnlyRoot:!1}):o._parent({roots:e,isEditor:!0,isReadOnlyRoot:"Index"===t})}}))}else this._parent({roots:e,isEditor:!0})}},p})),define("DS/ENOPAD_v2/models/PADDocTree",["UWA/Core","DS/ENXNav/models/xNavTreeDoc","DS/ENXNav/models/xNavNodeModel","DS/ENXNav/utils/TwoDAppEvents","DS/PADServices/utils/AttributesMgt","DS/PADServices/utils/CompassUtils","DS/PADServices/utils/HideShowController","DS/ENOXParser/modules/common/Constants","DS/ENOPAD_v2/models/_PADModelParser","DS/ENOXParser/modules/ClientDataParser","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSession","DS/PADUtils/PADWSAccess","DS/PADUtils/PADPredicatesNls","DS/PADUtils/PADUtilsServices","DS/PADUtils/views/PADAlert","DS/PADUtils/utilsWS/WSUtils","DS/ENOPAD_v2/models/mixins/PADDocInserts","DS/ENOPAD_v2/models/mixins/PADDocRefresh","DS/ENOPAD_v2/models/mixins/PADDocProxy","DS/ENOPAD_v2/models/mixins/PADDocCfgHook","DS/ENOPAD_v2/models/mixins/PADDocSupport","DS/ENOPAD_v2/models/mixins/PADDocOccExcludes","DS/PADServices/utils/Generics","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],(function(e,t,n,i,o,s,r,a,d,l,c,u,p,g,h,f,D,v,m,P,_,A,S,b,I,N){"use strict";function E(){}return E.prototype=Object.assign(E.prototype,v.prototype),E.prototype=Object.assign(E.prototype,m.prototype),E.prototype=Object.assign(E.prototype,A.prototype),E.prototype=Object.assign(E.prototype,P.prototype),E.prototype=Object.assign(E.prototype,_.prototype),E.prototype=Object.assign(E.prototype,S.prototype),t.extend(E,{_active_cutting_nodes:[],init:function(t){var n=c.getSetting("activateEditInTable");!0!==n||e.is(t.shouldBeEditable)||(t.shouldBeEditable=function(e){return!0},t.shouldBeSelected=function(e){return!e.ghostMode}),this._parent(t);var i=this;this._commandProxy=this._cmdProxy,!0===n&&!0!==c.getSetting("activateDGV")&&require(["DS/ENOPAD_v2/mixins/_PADEditInLst"],(function(e){i.onNodeModelUpdate(e.onNodeModelUpdate.bind(i))})),this._commandProxy&&this._appendToCommandProxy(),this.subscribeToCfgHook()},broadcastSelect:function(e){this._broadcastSelect=e,!0===this._broadcastSelect&&!0===this.options.authorize_setStructure&&s.setObject({nodes:this.getSelectedNodes()})},setDnDBehavior:function(e){this._copyMode=e},setConfirmdDialog:function(e){this._confirmDialog=e},setCuttingNodes:function(e){this._active_cutting_nodes=e},instantiate:function(t,i,o){let s=t.updatePids||[];var d=t.instanceName?t.instanceName:"",l=o?o.newRelationIDs:[],c=o?o.tgtParentIds:[],p=o?o.removedNodeIds:[],g={},h=i||[],f=t.node,D=t.parent,v=t.behavior,m=t.newRelationID,P=t.ordering,_=D.getID(),A=e.clone(f.options,!1);let S="MOVE"===t.behavior;"COPY"===t.behavior&&(A.childComputed=!1);var b=e.clone(f.options.grid,!1);A.grid=b,S&&!A.children&&(A.children=[],A.childComputed=!1);var I=f.getRelationID(),E=f.options.relationtype,y=!Boolean(I),x=f.getParent()?f.getParent().getID():"",C=this.getRoots(),O=!1,w=this;!!!P&&y||"COPY"===v||(C.forEach((function(e){var t=[];h&&0!==h.length?-1!==h.indexOf(e.getID())||x&&-1!==h.indexOf(x)?t=e.getNodesByRelId(I):c.length>0?-1===c.indexOf(e.getID())&&(l.length>0?-1===l.indexOf(I)&&(t=e.getNodesByRelId(I)):t=e.getNodesByRelId(I)):t=e.getNodesByRelId(I):t=e.getNodesByRelId(I),t.length>0&&t.forEach((function(e){var t=e.getParent();e.isRoot()||(h&&0!==h.length?-1!==h.indexOf(t.getID())&&t.removeChild(e):t.removeChild(e))}))})),f.setRelationID(m,E));var R=function(t,n,i){if(n&&n.before&&""!==n.before){var o,s=t.getChildren();for(o=0;o<s.length;o++){var r=s[o];if(r.options.relationid===n.before){try{t.insertBefore(i,r),O=!0}catch(e){throw console.log(e),e}break}}}e.is(t.options.relcount,"number")||(t.options.relcount=0),t.options.relcount=t.options.relcount+1,O||t.addChild(i),S&&t.setState(a.NODE_STATES.PARTIALLY_EXPANDED)};C.forEach((function(i){y&&p.length>0&&-1!==p.indexOf(i.getID())&&(g[i.getID()]=!0);var o=i.getNodesById(_);o&&0!==o.length&&o.forEach((function(i){if(i===D||i.isExpanded()||null===i.options.children||0===i.options.children.length){if(y||"COPY"===v||i!==D){var o=e.clone(f.options,!1);("COPY"===t.behavior||S)&&(o.childComputed=!1),"COPY"===t.behavior&&o.isHiddenStateFrom!==r.FROMS.PGP&&(o.isHiddenState=r.STATES.SHOWN,o.isPADHidden=!1);var s=e.clone(f.options.grid,!1);(e.is(o.relcount,"number")&&o.relcount>0||e.is(o.children,"array")&&o.children.length>0)&&(o.children=[]),(h&&-1===h.indexOf(i.getID())||"COPY"===v)&&(s.CurrentEvolutionEffectivity="",s.Effectivity="",s.ProjectedEvolutionEffectivity="",s.VariantEffectivity=""),d&&(s.instanceName=d),o.grid=e.clone(s,!1);var a=new n(o),l=o.relationtype;(y||"COPY"===v||c&&c.length>1)&&a.setRelationID(m,l),R(i,P,a)}else if(c&&c.length>1){var u=e.clone(A,!1),p=w.createNodeModel(u),g=f.options.relationtype;p.setRelationID(m,g),R(i,P,p)}else R(i,P,f);i.isExpanded()||i.options.padstate&&"partiallyExpanded"===i.options.padstate||(i.setState({state:"partiallyExpanded"}),i.options.padstate="partiallyExpanded")}else console.log("**3 =========",i)}))})),D.isExpanded()||D.options.padstate&&"partiallyExpanded"===D.options.padstate||(D.setState({state:"partiallyExpanded"}),D.options.padstate="partiallyExpanded"),u.setAuthoringState(!0,N.PADSession_disabling_index_authoring),y&&"COPY"!==v&&(0===p.length||g[f.getID()])&&this.removeRoot(f),this.invalidateViewPort(),s.length&&w.refreshNodeById({modified:s})},_distinguishInsertReparentCases:function(e){var t={insertExisting:[],reparent:[]},n=this._copyMode;return e.forEach((function(e){!e.getRelationID()||"COPY"===n?t.insertExisting.push(e):t.reparent.push(e)})),t},_inputData:function(e,t){var n=[];return e.forEach((function(e){n.push(e.getOccurencePath())})),{children:n,parents:[t.getOccurencePath()],commit:!0}},_onInsert:function(t,n,o){var s=this._copyMode;"function"==typeof n.getID&&n.getID();var r=this;function a(e,t,n){var i;for(i=0;i<e.length;i++){var o=e[i];let s=o.options;if(s.resourceid===t&&s.relationid===n)return o}return null}function d(e){var d;let u=[];for(d=0;d<e.length;d++){var p=e[d].relationid,g=e[d].resourceid;let f=e[d].originalRelationid;var h=a(t,g,f),D=e[d].instanceName||"";let A=e[d].clientTaskData;if(!h)return void c();if(A){new l(A).appendPids(u)}var v={node:h,parent:n,next:o,behavior:s,newRelationID:p,instanceName:D},m=(h.getID(),n.getID()),P=h.getRelationID(),_=!Boolean(P);r._endBlockingTransaction(),r.wrapInTransaction((function(){r.withTransactionUpdate((function(){r.instantiate(v);var e={transactions:[]},t=r.getNodesByRelId(p)[0].getOccurencePath();_||"COPY"===s?e.transactions.push({insertExisting:{modified:[m],inserted:[t],created:[p],withContext:!_}}):e.transactions.push({reParent:{modified:[m],inserted:[t],created:[p],deleted:[P]}}),r._commandProxy.padRefresh(e),i.addChild()}),r)}))}u.length&&r.refreshNodeById({modified:u}),f.displayNotification({msg:I.insert_existing_succeeded,eventID:"info"})}function c(t){if(r._endBlockingTransaction(),t&&e.is(t.messages,"array")){var n=[];t.messages.forEach((function(e){-1===n.indexOf(e)&&n.push(e)})),f.displayNotification({msg:n.join(""),eventID:"error"})}r.dropInvitContainer&&r.dropInvitContainer.hide()}function u(e){var d;let c=[];for(d=0;d<e.length;d++){var u=e[d].relationid,g=e[d].resourceid;let A=e[d].originalRelationid;var h=a(t,g,A),D=e[d].instanceName||"";let S=e[d].clientTaskData;if(S){new l(S).appendPids(c)}if(!h)return void p();try{var v={node:h,parent:n,next:o,behavior:s,newRelationID:u,instanceName:D},m=(h.getID(),n.getID()),P=h.getRelationID(),_=!Boolean(P);r._endBlockingTransaction(),r.wrapInTransaction((function(){r.withTransactionUpdate((function(){r.instantiate(v);var e={transactions:[]},t=r.getNodesByRelId(u)[0].getOccurencePath();_?e.transactions.push({insertExisting:{modified:[m],inserted:[t],created:[u],withContext:!_}}):e.transactions.push({reParent:{modified:[m],inserted:[t],created:[u],deleted:[P]}}),r._commandProxy.padRefresh(e),i.addChild()}),r),f.displayNotification({msg:I.reparent_succeeded,eventID:"info"})}))}catch(e){r._endBlockingTransaction(),f.displayNotification({msg:N.generic_service_failure,eventID:"error"})}}c.length&&r.refreshNodeById({modified:c})}function p(t){if(r._endBlockingTransaction(),t&&e.is(t.messages,"array")){var n=[];t.messages.forEach((function(e){-1===n.indexOf(e)&&n.push(e)})),f.displayNotification({msg:n.join(""),eventID:"error"})}}var g=r._distinguishInsertReparentCases(t);return g.insertExisting.length>0&&(this._beginBlockingTransaction(I.inserting_nodes),require(["DS/ApplicationFrame/CommandsManager"],(function(e){e.getCommand("InsertExisting").execute({mode:"CopyPaste",internal_call:!0,data:r._inputData(t,n),onSuccess:d,onFailure:c})}))),g.reparent.length>0&&(this._beginBlockingTransaction(I.reparenting),require(["DS/ApplicationFrame/CommandsManager"],(function(e){e.getCommand("InsertExisting").execute({mode:"CutPaste",internal_call:!0,data:r._inputData(t,n),onSuccess:u,onFailure:p})}))),!1},getOrdering:function(e){var t={};if(!e)return ordering;var n,i,o,s=-1,r=-1,a=-1;return e.forEach((function(e){var d={};(n=e.getParent().getChildren())&&n.length>1&&((s=n.indexOf(e))>-1&&(r=s-1,a=s+1),o=n[r],i=n[a],d.after=o?o.getRelationID():"",d.before=i?i.getRelationID():"",t[e.getRelationID()]=d)})),t},getFetches:function(t){var n=e.clone(t,!1);return n.cbOnProcess=function(e,t){var n={intent:"explore_2D",debug:c.getSetting("enopad_webapis_debug")},i={enopad_webapis:c.getSetting("enopad_webapis"),data:n,pids:t,onComplete:function(n){var i="string"==typeof n?JSON.parse(n):n;if(i.results)for(var o=0,s=i.results.length;o<s;o++){var r=i.results[o];e.setAnswer(t[o],r)}else console.log("handle error in the future")},onFailure:function(t,n){console.log("getFetches.onFailure"),e.reprocess()}};return p.fetch(i)},new D.MassChunkedRequests(n)},getNavigates:function(t){var n=e.clone(t,!1);return n.cbOnProcess=function(t,n){if(n&&n.length>0){var i=e.extend({root_path_physicalid:n,expand_iter:"1",intent:"explore_2D"},c.getWebAPI_Options("navigate"),!0),o={enopad_webapis:c.getSetting("enopad_webapis"),data:i,onComplete:function(e){var i="string"==typeof e?JSON.parse(e):e;i.results?t.setAnswers(n,i.results):console.log("handle error in the future")},onFailure:function(e,t){console.error("getNavigates.onFailure networkError",e),console.error("getNavigates.onFailure serverError ",t)}};return p.navigate(o)}},new D.MassChunkedRequestsLWC(n)},insertNodesSplitFetch:function(t,n){t.toDelete;var o=t.callack,s=t.callback2,r=t.occurencePaths,a=t.parentNodes,l=t.toInsert,u=this,p=[];function g(e){-1===p.indexOf(e.resourceid)&&p.push(e.resourceid),-1===p.indexOf(e.relationid)&&p.push(e.relationid)}var h=[],D={transactions:[]},v=[],m=[],P=[],_={};function A(){f.displayNotification({msg:N.generic_service_failure,eventID:"error"}),u._endBlockingTransaction()}this.wrapInTransaction((function(){var t,n;if(!0===c.getSetting("useLWCWebServices"))!function(){for(var t=Object.keys(l),n=0;n<t.length;n++){var i=t[n];if(e.is(l[i],"array")){for(var o={insertExisting:{modified:[],inserted:[],created:[]}},s=l[i],r=0,a=s.length;r<a;r++){var d=s[r],c=[i,d.relationid,d.resourceid];-1===v.indexOf(c)&&(h.push(d.relationid),v.push(c),o.insertExisting.modified.push(i),o.insertExisting.inserted.push(c),o.insertExisting.created.push(d.relationid),o.insertExisting.withContext=!1),_[d.relationid]||(_[d.relationid]=d.ordering)}if(-1===m.indexOf(i)){m.push(i);var p=u.getNodesById(i);p&&(P=P.concat(p))}D.transactions.push(o)}}}(),t=l.noNotification,delete l.noNotification,u._beginBlockingTransaction(I.inserting_nodes),n={chunkSize:1e3,requests:v,cbOnComplete:function(n){var l;try{var c=n.getAnswers(),p=e.is(c,"string")?JSON.parse(c):c;p.results&&p.results.length>0&&!p.error?(l=u.startTransaction("expand"),d.process.expand({treedocument:u,response:p,root_nodes:a,occurencePaths:r,pathOrdering:_,expand_level:1,mode:"insert"}),!0!==t&&f.displayNotification({msg:I.insert_existing_succeeded,eventID:"info"}),u._endBlockingTransaction(),u._commandProxy.padRefresh(D),i.addChild(),o&&o(),s&&s({expandNodeIds:h})):A()}catch(e){A()}finally{l&&l.end()}},cbOnProgress:function(e,t,n){}},u.getNavigates(n);else{for(var S in l)l.hasOwnProperty(S)&&e.is(l[S],"array")&&l[S].forEach(g);t=l.noNotification,delete l.noNotification,u._beginBlockingTransaction(I.inserting_nodes),n={chunkSize:30,requests:p,cbOnComplete:function(n){p.length;var s=n.getAnswers(),r=e.is(s,"string")?JSON.parse(s):s,a=r.results.length;if(0===a)throw new Error("Cannot find object with the physicalid "+p);if(a!=a)throw new Error("More results than input objects");u.invalidateViewPort(),u.wrapInTransaction((function(){var e=d.process.insert_nodes({treedocument:u,response:r,insert_parameters:l});u._commandProxy.padRefresh(e),i.addChild()}),"insert_nodes"),u._endBlockingTransaction(),o&&o(),!0!==t&&f.displayNotification({msg:I.insert_existing_succeeded,eventID:"info"})},cbOnProgress:function(e,t,n){}},u.getFetches(n)}}))},updateInstance:function(t){var n=this,i=[],o=t.occurencePaths;o&&(i=o),i&&i.length&&(this.wrapInTransaction((function(){var s=e.extend({root_path_physicalid:i,expand_iter:"0",intent:"explore_2D"},c.getWebAPI_Options("navigate"),!0);console.time("ws-navigate"),p.navigate({enopad_webapis:c.getSetting("enopad_webapis"),data:s,onComplete:function(i){var s;console.timeEnd("ws-navigate");try{var r=e.is(i,"string")?JSON.parse(i):i;r.results&&r.results.length&&(r.error?(console.error("ws-navigate",r.error),t.editCfg&&(console.time("partial_update_instances"),d.update_instances({treedocument:n,response:r,occurencePaths:o,newRelIds:t.newRelIds,editCfg:t.editCfg}),console.timeEnd("partial_update_instances"))):(s=n.startTransaction("update"),console.time("update_instances"),d.update_instances({treedocument:n,response:r,occurencePaths:o,newRelIds:t.newRelIds,editCfg:t.editCfg||!1}),console.timeEnd("update_instances")))}catch(e){console.error("updateInstance:",e)}finally{s&&s.end()}},onFailure:function(e){console.error("ws navigate ",e)}})})),t.expandStates&&t.expandStates.length&&t.expandStates.forEach((function(e){o&&o.forEach((function(t){var i=n.getNodeByOccurencePath(t);if(i&&!i.isExpanded()){var o={numberOfLevelsToExpand:e};i.expandNLevels(o)}}))})))},updateRevision:function(e){console.count("updateRevision");if(b.checks.array(e.updateRevision))for(let t=0;t<e.updateRevision.length;t++){let n=e.updateRevision[t];if(n.existing&&n.new&&n.newRevison){let e=this.getNodesById(n.existing)[0],t={};this.withTransactionUpdate((function(){e.updateOptions(t)}))}}},_clearSortOrders:function(e){if(e&&e.treelist){var t=e.treelist.getManager();t.getColumns().forEach((function(e){var n=t.getColumnIDFromDataIndex(e.dataIndex);"none"!==t.getColumnOrderState(n)&&t.setColumnOrderState(n,"none")}))}},sortInTreeOrder:function(e){e&&e.forEach((function(e){e.sortChildren({isRecursive:!0,sortFunction:function(e,t){if(e.options&&t.options){if(e.options.relationOrder<t.options.relationOrder)return-1;if(e.options.relationOrder>t.options.relationOrder)return 1}return 0}})}))},_compositeOrder:function(t,n,o){"function"==typeof n.getID()?n.getID():n.options.resourceid;var s,r=!t.getRelationID(),a=this._copyMode,d=this;function l(s){try{e.is(s)&&e.is(s,"array")&&s.length>0&&(s=s[0].relationid);var r={node:t,parent:n,behavior:a,newRelationID:s,ordering:o},l=(t.getID(),n.getID()),c=t.getRelationID(),u=!Boolean(c);d._endBlockingTransaction(),d.wrapInTransaction((function(){d.withTransactionUpdate((function(){d.instantiate(r);var e={transactions:[]},t=d.getNodesByRelId(s)[0].getOccurencePath();u||"COPY"===a?e.transactions.push({insertExisting:{modified:[l],inserted:[t],created:[s],withContext:!u}}):e.transactions.push({reParent:{modified:[l],inserted:[t],created:[s],deleted:[c]}}),d._commandProxy.padRefresh(e),i.addChild()}),d)}))}catch(e){d._endBlockingTransaction(),f.displayNotification({msg:N.generic_service_failure,eventID:"error"})}}function c(t){d._endBlockingTransaction(),t&&e.is(t.messages,"array")&&t.messages.forEach((function(e){f.displayNotification({msg:e,eventID:"error"})}))}r||"COPY"===a?(s={children:[t.getOccurencePath()],parents:[n.getOccurencePath()],ordering:o,commit:!0},this._beginBlockingTransaction(I.inserting_nodes),require(["DS/ApplicationFrame/CommandsManager"],(function(e){e.getCommand("InsertExisting").execute({mode:"CopyPaste",internal_call:!0,data:s,onSuccess:l,onFailure:c})}))):(s={children:[t.getOccurencePath()],parents:[n.getOccurencePath()],ordering:o,commit:!0},this._beginBlockingTransaction(I.reparenting),require(["DS/ApplicationFrame/CommandsManager"],(function(e){e.getCommand("InsertExisting").execute({mode:"CutPaste",internal_call:!0,data:s,onSuccess:l,onFailure:c})})))},_beginBlockingTransaction:function(e){this.getModelEvents().publish({event:"beginBlockingTransaction",data:e,context:this})},_endBlockingTransaction:function(){this.getModelEvents().publish({event:"endBlockingTransaction",context:this})},_triggerTitleUpdate:function(){var e=this.getRoots();this.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.length,added_node:e[e.length-1]}})},isEditor:function(){return!0}})})),define("DS/ENOPAD_v2/views/ReadWriteCmd",["css!DS/ENXNav/ENXNav.css","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/ENOPAD_v2/utils/ReadWriteAccessController","DS/Controls/Button","DS/Utilities/Dom","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents"],(function(e,t,n,i,o,s,r){"use strict";return{getTypeRepresentation:function(){return{findInCtx:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"find dgv-find",fontIconFamily:1}}}}},read_write:{getCellTooltip:function(e){let t={shortHelp:"Read Write",updateModel:!1};return-1!==e.rowID&&(t=e.nodeModel.options.isReadOnly?{shortHelp:"Index root",updateModel:!1}:{shortHelp:"Authoring root",updateModel:!1}),t},buildColumn:function(e){return Object.assign({dataIndex:"read_write",kind:"findInCtx",width:50,minWidth:50,editableFlag:!1,typeRepresentation:"findInCtx",alignment:"center",customisation:{exportable:{lock:!0,value:!1}},getCellSemantics:function(e){return n.determineReadOnlyIcon(e.nodeModel)}},e)},actionOnClick:function(e,t){var n=e.nodeModel;n.isRoot()&&(void 0!==n.options.isReadOnly&&!0===n.options.isReadOnly?(t.onWrite({paths:[n.getOccurencePath()],fromUI:!0}),r.getModelEvents().publish({event:"ENXModel/ReadWriteTriggered",data:!1})):(t.onRead({paths:[n.getOccurencePath()],fromUI:!0}),r.getModelEvents().publish({event:"ENXModel/ReadWriteTriggered",data:!0})))}}}})),define("DS/ENOPAD_v2/utils/PADCtxMenuUtilsV2",["i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","DS/WebappsUtils/WebappsUtils","DS/ENOPAD_v2/utils/PADClipboard","DS/ENXNav/utils/CtxMenuUtilsV2"],(function(e,t,n,i){"use strict";var o={RESETPOS:"url("+t.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_ResetPosition.png")+")",COPYRELPOS:"url("+t.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_CopyPosition.png")+")",PASTEPOS:"url("+t.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_PastePosition.png")+")"};return i.psePositionCtxCmd=function(t,i){var s,r,a={available:!1,menu:[]};if(!i.collectionView)return a;if(s=i.cellInfos.nodeModel,r=i.cellInfos,!1===s.isRoot()){s.isSelected()||s.select(!0),a.available=!0;for(var d=t.getSelectedNodes(),l=!1,c=0;c<d.length&&!1===l;c++)d[c].options.grid["positionMatrix-Instance"]&&(l=!0);l&&(a.menu.push({type:"PushItem",title:e.PAD_CMDResetPosition,icon:o.RESETPOS,state:t.getEditMode()?"enabled":"disabled",action:{this:this,context:{node:s,cellInfos:r},callback:function(e){t.resetPosition()}}}),1===d.length&&a.menu.push({type:"PushItem",title:e.PAD_CMDCopyRelativePosition,icon:o.COPYRELPOS,state:t.getEditMode()?"enabled":"disabled",action:{this:this,context:{node:s,cellInfos:r},callback:function(e){var t={matrix:e.context.node.options.grid["positionMatrix-Instance"]};n.setData(n.POSITION,t)}}})),!1===n.isEmpty(n.POSITION)&&("VPMRepInstance"!==s.options.relationtype||""===s.options.relationtype&&"3DShape"!==s.options.type&&"Drawing"!==s.options.type)&&a.menu.push({type:"PushItem",title:e.PAD_CMDPastePosition,icon:o.PASTEPOS,state:t.getEditMode()?"enabled":"disabled",action:{this:this,context:{node:s,cellInfos:r},callback:function(e){t.pastePosition()}}}),0===a.menu.length&&a.menu.push({type:"PushItem",title:e.PAD_CMDNoPositionAction,state:"disabled"})}else a.isRoot=!0;return a},i})),define("DS/ENOPAD_v2/utils/PADDGVDirectEdition",["UWA/Core","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","text!DS/ENOPAD_v2/assets/PADEditInList.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADUtils/PADSettingsMgt","DS/UIKIT/Mask","DS/PADUtils/PADWSAccess","DS/PADUtils/PADSession","DS/ApplicationFrame/CommandsManager","DS/PADUtils/views/PADAlert","DS/ENOPAD_v2/utils/PADBulkEdit","DS/PADServices/utils/AttributesMgt","DS/PADUtils/PADUtilsServices"],(function(e,t,n,i,o,s,r,a,d,l,c,u,p){"use strict";var g=["ds6w:type","ds6wg:revision","ds6w:responsible","ds6w:status","ds6w:cadMaster","ds6w:identifier"],h=["ds6w:reserved","ds6w:manufacturable"],f=JSON.parse(n),D=[],v=0,m=[],P=[];let _;const A=["tree","ds6w:description"];function S(e){let t;if("tree"===e)t="ds6w:label";else t=e;return t}var b={editCtxMenuAvailable:function(e,t){var n=b.canColumnBeEditable(e,t);if(!n){var i=e.options.views.datagridview.options.dgv.getColumnOrGroup(t.columnID).dataIndex;-1!==h.indexOf(i)&&(n=!0)}return n},canColumnBeEditable:function(e,t,n){var i=!1,o=e.options.views.datagridview.options.dgv,s=!0===n?t:o.getColumnOrGroup(t.columnID),r=s.dataIndex;if(_=s,!0===s.isAdditionalColumn)i=!1;else if(u.isAttributeColumn(r)||"ds6w:label_Instance"===r){if(-1!==g.indexOf(r))i=!1;else if(-1!==h.indexOf(r))i=!0;else if(-1!==f.editableColumnsDataIndex.indexOf(r)&&"inline"===f.editBehavior[r].mode)i=!0;else if(!0===u.isAttributeColumn(r)&&-1===f.editableColumnsDataIndex.indexOf(r)){i=!0;var a=r.split(":"),d=(a=a[a.length-1].split("."))[a.length-1];f.editableColumnsDataIndex.push(r),f.editableColumnsAttribute.push(d),f.editBehavior[r]={mode:"inline",attribute:d}}}else i=!1;return i},_updateSpecialExtensionColumns:function(e){let t=_.selectable;if(t&&0!==e.data.filter((e=>t.split(".")[0]===e.extension)).length){let e=t.split(".")[1],i=_.dataIndex.split(":")[1];for(var n=0;n<f.editableColumnsAttribute.length;n++)f.editableColumnsAttribute[n]!==i&&f.editableColumnsAttribute[n]!==e||(i&&i.endsWith("-Instance")&&e&&!e.endsWith("-Instance")?f.editableColumnsAttribute[n]=e+"-Instance":f.editableColumnsAttribute[n]=e)}},editCell:function(n){var i=this,o=n.context.options.views.datagridview.options.dgv,a=n.context.options.views.datagridview.options.dgvLayout,d=o.getColumnOrGroup(n.cellInfos.columnID).dataIndex,u=n.cellInfos,p=(n.context,u.nodeModel);switch(u.dataIndex=d,d){case"ds6w:responsible":b.changeOwnerCmd(u);break;case"ds6w:reserved":b.reservedCmd(u);break;case"ds6w:status":b.changeMaturityCmd(u);break;default:var g={lIds:[p.getID()],attributes:"true"},h=a.getColumnTypeRepresentation(u.columnID),f=!1;if(u.dataIndex.endsWith("-Instance")){if(!u.nodeModel.options.relationid)return;g.lIds=[u.nodeModel.options.relationid],f=!0}r.read({data:g,onComplete:function(s){"string"==typeof s&&(s=c.cleanStr(s));var r=e.is(s,"string")?JSON.parse(s):s;if(console.log("Edit attribute ["+d+"] of type:["+h+"]"),!r.results)throw new Error("Invalid read WS response: no Results");if(r.results.length!==g.lIds.length)throw new Error("Invalid read WS response: Incoherent answer");i._updateNodeModel(u.nodeModel,r.results[0],f,n),o.getColumnOrGroup(n.cellInfos.columnID).getCellEditableState=function(e){if(!n.context.getEditMode())return!1;var t=!1;if(e.nodeModel&&1!==e.nodeModel.getNodeSource()){var i=e.nodeModel.getID();m[i]&&m[i].editableColumns[d]&&!1===m[i].editableColumns[d].readOnly&&(t=!0)}return t};var a=u.nodeModel.getID();P[a]||(P[a]={displayNotif:!1}),u.nodeModel.options.edit.editableColumns[d]&&!1===u.nodeModel.options.edit.editableColumns[d].readOnly?(o.setCellInEdition(n.cellInfos.cellID),P[a].displayNotif=!1):P[a].displayNotif||(P[a].displayNotif=!0,l.displayNotification({msg:t.editionNotSupported,eventID:"warning"}))},onFailure:function(){s.unmask(o.getContent()),l.displayNotification({msg:t.accessrightfailed,eventID:"warning"})}})}},reservedCmd:function(e){if(!e.nodeModel.isGroupingNode){var t=e.nodeModel.getReferenceValue("ds6w:reserved"),n="ActionBar_ReserveCmd";!0===("boolean"!=typeof t?function(e){if("string"==typeof e)return"TRUE"===e}(t):t)&&(n="ActionBar_UnreserveCmd");var i=d.getCommand(n);i&&i.begin()}},changeMaturityCmd:function(e){if(!e.nodeModel.isGroupingNode){var t=d.getCommand("MaturityHdr");t&&t.begin()}},setThePartNumberCmd:function(e){var t=d.getCommand("SetThePartNumber");t&&t.begin()},changeOwnerCmd:function(e){if(!e.nodeModel.isGroupingNode){var t=d.getCommand("ActionBar_ChangeOwner");t&&t.begin()}},_updateNodeModel:function(e,t,n,i){this._updateSpecialExtensionColumns(t);var o=e,s=0,r={isEditable:t.modifyAccess,editableColumns:{}},a=i.context.options.views.datagridview.options;for(s=0;s<t.basicData.length;s++){var d=t.basicData[s],l=!0===n?d.name+"-Instance":d.name;-1!==f.editableColumnsAttribute.indexOf(l)&&(r.editableColumns[f.editableColumnsDataIndex[f.editableColumnsAttribute.indexOf(l)]]={mandatory:d.mandatory,readOnly:d.readOnly,maxLength:d.maxlength,path:d.path,selectable:d.selectable,kind:d.type,mode:f.editBehavior[f.editableColumnsDataIndex[f.editableColumnsAttribute.indexOf(d.name)]].mode,command:f.editBehavior[f.editableColumnsDataIndex[f.editableColumnsAttribute.indexOf(d.name)]].command})}for(t.groupData&&(t.data=t.data.concat(t.groupData)),s=0;s<t.data.length;s++){var c=!1;(d=t.data[s]).range&&(c=!0);l=!0===n?d.name+"-Instance":d.name;if(-1!==f.editableColumnsAttribute.indexOf(l)){var u={mandatory:d.mandatory,readOnly:d.readOnly,maxLength:d.maxlength,path:d.path,selectable:d.selectable,kind:d.type,mode:f.editBehavior[f.editableColumnsDataIndex[f.editableColumnsAttribute.indexOf(l)]].mode,command:f.editBehavior[f.editableColumnsDataIndex[f.editableColumnsAttribute.indexOf(l)]].command};c&&"boolean"!==u.kind&&(u.kind="enum",u.range=d.range.slice(),u.displayRange=d.rangeNLS.slice(),d.value?u.current=d.value[0]:u.current=""),"real"==u.kind&&(u.kind="float"),r.editableColumns[f.editableColumnsDataIndex[f.editableColumnsAttribute.indexOf(l)]]=u}}r.editableColumns["ds6w:reserved"]={mode:f.editBehavior["ds6w:reserved"].mode,commands:f.editBehavior["ds6w:reserved"].commands,readOnly:!1},f.editOptions=r,o.options.edit=r;var p=o.getID();if(m[p]=r,i.cellInfos){if(!o.options.grid.hasOwnProperty(i.cellInfos.dataIndex)){let e={grid:{}};e.grid[i.cellInfos.dataIndex]=void 0,o.updateOptions(e)}if(r.editableColumns[i.cellInfos.dataIndex])switch(r.editableColumns[i.cellInfos.dataIndex].kind){case"enum":var g={},h="enum"+v++;if(g[h]={stdTemplate:"enumCombo",semantics:{possibleValues:[],valueType:"enumString"}},r.editableColumns[i.cellInfos.dataIndex].range.forEach((function(e,t){g[h].semantics.possibleValues.push({name:e,value:r.editableColumns[i.cellInfos.dataIndex].displayRange[t]})})),-1===D.indexOf(i.cellInfos.dataIndex))if(D.push(i.cellInfos.dataIndex),i.cellInfos)a.dgv.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(g)),a.dgvLayout.setColumnTypeRepresentation(i.cellInfos.columnID,h),a.dgv.getColumnOrGroup(i.cellInfos.columnID).editionPolicy="EditionOnDoubleClick";break;case"boolean":case"timestamp":a.dgv.getColumnOrGroup(i.cellInfos.columnID).editionPolicy="EditionOnDoubleClick"}}return r},saveModification:function(n,o){return new Promise((function(s,d){var u=n.options.views.datagridview.options.dgv,g=(n.options.views.datagridview.options.dgvLayout,u.getColumnOrGroup(o.columnID).dataIndex),h=o.nodeModel,D=h.options.edit;D||(D=f.editOptions);var v=D.editableColumns[g].kind,m=D.editableColumns[g].path,P=D.editableColumns[g].selectable,_=h.getID(),b="tree"===g?h.getLabel():h.options.grid[g];if("integer"!=v&&"real"!=v&&"float"!=v||(b=b.toString()),"timestamp"===v){var I=require("DS/WidgetServices/WidgetServices").convertDateToStandard(b,!0);b=I.valueDB}if("enum"===v){var N=D.editableColumns[g].displayRange.findIndex((e=>e===b));b=D.editableColumns[g].range[N]}b=c.cleanStr(b);var E="model/bus/"+_;let y=!1;g.endsWith("-Instance")&&(y=!0,E="model/rel/"+h.getRelationID());var x={UXName:"Data Grid",client_app_domain:"3DEXPERIENCE 3DDashboard",client_app_name:p.getAppId()},C={path:E,method:"PATCH",body:[{op:"replace",path:m,value:b}],queryParams:{select:["physicalid","modified",P]}};r.update({data:{metrics:x,requests:[C]},onComplete:function(r){var d=e.is(r,"string")?JSON.parse(r):r;if(!d.results||1!==d.results.length){s({message:"Invalid update answer",type:"ERROR"})}for(var c,u=C.body[0].path,p=d.results[0],f=Object.keys(p.body),v=[],m=0;m<f.length;m++){var P=f[m];-1!==P.indexOf(u)&&(c=p.body[P]).notification&&v.push(c.notification)}if("tree"==g&&n.hasActiveDesignExp()&&n.getPseService().updateModifiedAssetTitle(b,_),p.body.errors&&d.UXMessage&&Array.isArray(d.UXMessage))d.UXMessage.forEach((e=>{e&&l.displayNotification({title:i.cannotModifyObject,subtitle:i.ERR_getPredicates,msg:e,eventID:"error"})})),s();else if(p.body.errors&&p.body.errors.length>0)for(m=0;m<p.body.errors.length;m++)v.push(p.body.errors[m]);if(v&&v.length>0)for(m=0;m<v.length;m++)l.displayNotification({msg:v[m].message,eventID:"warning"}),"ERROR"===v[m].type&&s(v[m]);else if(200!==p.status){s({message:"Invalid update answer",type:"ERROR"})}else{a.setAuthoringState(!0,i.PADSession_disabling_index_authoring);var I,N=h.getTreeDocument();if(p.body.oldInstancePhysicalid){let e={authored:[{modified:p.body.physicalid,previous:p.body.oldInstancePhysicalid}]};N._onRefresh(e)}if(h.isRoot()&&function(e){return-1!==A.indexOf(e)}(g)){let e=N._getCmdProxyPtr(),t={modifiedIds:[_],fetchAnswer:{results:[{attributes:[]}]}};t.fetchAnswer.results[0].attributes.push({name:S(g),value:b}),t.fetchAnswer.results[0].attributes.push({name:"resourceid",value:_});let n=Object.keys(h.options.grid);for(m=0;m<n.length;m++)t.fetchAnswer.results[0].attributes.push({name:n[m],value:h.options.grid[n[m]]});e.updatePreviousContent(t)}y?(_=p.body.physicalid,I=N.getNodesByRelId(_)):I=N.getNodesById(_),I&&I.length>0&&(N.withTransactionUpdate((function(){var t,n=require("DS/WidgetServices/WidgetServices"),i=I.map((function(e){if(e.options.edit)return e.options.edit})).filter((function(e){return void 0!==e}))[0];i||(i=D);for(var s=0;s<I.length;s++){var r=I[s];if(!t){t={grid:{}};for(var a=Object.getOwnPropertyNames(i.editableColumns),d=0;d<a.length;d++)i.editableColumns[a[d]].selectable&&p.body[i.editableColumns[a[d]].selectable]&&("tree"===a[d]?(t.label=p.body[i.editableColumns[a[d]].selectable].value[0],t.display=t.label,t.oldLabel=t.label,N._triggerTitleUpdate()):e.is(r.options.grid[a[d]])&&(p.body[i.editableColumns[a[d]].selectable].value?(t.grid[a[d]]=p.body[i.editableColumns[a[d]].selectable].value[0],"timestamp"===i.editableColumns[a[d]].kind&&(t.grid[a[d]]=n.formatDate(t.grid[a[d]]))):t.grid[a[d]]=""));r.options.grid["ds6w:modified"]&&p.body.modified&&p.body.modified.value&&(t.grid["ds6w:modified"]=n.formatDateObj(p.body.modified.value[0]))}if(r._updateFromEdit&&delete r._updateFromEdit,r._editDataIndex&&delete r._editDataIndex,r.options.edit&&delete r.options.edit,!0===o.change&&void 0!==o.nodeModel.options.grid[g]){var l=o.nodeModel.options.grid[g];l="boolean"==typeof l?l:"TRUE"===l.toUpperCase(),t.grid[g]=l}r.updateOptions(t)}})),l.displayNotification({msg:t.attributeModified,eventID:"success"})),s({success:!0,dataIndex:g})}},onFailure:function(){h._updateFromEdit&&delete h._updateFromEdit,h._editDataIndex&&delete h._editDataIndex,h.options.edit&&delete h.options.edit,l.displayNotification({msg:t.attributeModificationFailed,eventID:"warning"});s({type:"ERROR"})}})}))},notifyCantEdit:function(){l.displayNotification({msg:t.editionNotSupported,eventID:"warning"})}};return b})),define("DS/ENOPAD_v2/views/PADDataGridView",["css!DS/ENOPAD_v2/ENOPAD_v2","DS/ENXNav/views/xNavDataGridView","DS/ApplicationFrame/CommandsManager","DS/ENOPAD_v2/utils/PADDGVDirectEdition","DS/Core/PointerEvents"],(function(e,t,n,i,o){"use strict";function s(e){e=Object.assign(e,{doubleClickEvent:{"ds6w:reserved":i.reservedCmd,"ds6w:responsible":i.changeOwnerCmd,"ds6w:status":i.changeMaturityCmd}}),t.call(this,e)}s.prototype=Object.assign(s.prototype,t.prototype),s.prototype=Object.create(t.prototype);const r=["hide_show","ContextualMenuColumn","ds6w:responsible","ds6w:status","ds6wg:revision"];return s.prototype.completeCB=function(){var e=this;return new Promise((function(t){var s=e.options.dgv;e.previousValues={},s.addEventListener("preEdit",(function(t,n){e.previousValues[n.cellID]=n.cellModel;e.options.context})),s.addEventListener("postEdit",(function(t,n){i.saveModification(e.options.context,n).then((function(t){if(t&&"ERROR"===t.type)throw t.message?new Error(t.message):new Error(t);if(t){delete e.previousValues[n.cellID],n.nodeModel.getTreeDocument().triggerDGVGroupingReapplySpecific(t.dataIndex)}})).catch((function(t){var i=s.getColumnOrGroup(n.columnID).dataIndex;if("tree"===i)n.nodeModel.setLabel(e.previousValues[n.cellID]);else{var o={grid:{}};o.grid[i]=e.previousValues[n.cellID],n.nodeModel.updateOptions(o),n.nodeModel.setReferenceValue(i,e.previousValues[n.cellID])}delete e.previousValues[n.cellID]}))})),s.addEventListener("change",(function(t,n){if(-1!==n.columnID&&"boolean"===s.getColumnOrGroup(n.columnID).kind){var o=s.getColumnOrGroup(n.columnID).dataIndex;!0===n.nodeModel.options.grid[o]||"TRUE"===n.nodeModel.options.grid[o]?n.nodeModel.options.grid[o]="TRUE":n.nodeModel.options.grid[o]="FALSE",n.change=!0,i.saveModification(e.options.context,n).then((function(t){if(t&&"ERROR"===t.type&&t.message)throw new Error(t.message);delete e.previousValues[n.cellID],n.nodeModel.getTreeDocument().triggerDGVGroupingReapplySpecific(t.dataIndex)})).catch((function(t){var i=s.getColumnOrGroup(n.columnID).dataIndex;if("tree"===i)n.nodeModel.setLabel(e.previousValues[n.cellID]);else{var o={grid:{}};o.grid[i]=e.previousValues[n.cellID],n.nodeModel.updateOptions(o),n.nodeModel.setReferenceValue(i,e.previousValues[n.cellID])}delete e.previousValues[n.cellID]}))}})),s.addEventListener(o.POINTERHIT,(function(t,n){if(2===t.multipleHitCount&&!n.isHeader&&n.nodeModel&&-1!==n.columnID&&e.options.context.getEditMode()&&!0!==n.nodeModel.isGroupingNode&&1!==n.nodeModel.getNodeSource()){if(i.editCtxMenuAvailable(e.options.context,n)){let t={context:e.options.context,cellInfos:n};i.editCell(t)}else{var o=s.getColumnOrGroup(n.columnID),a=o.dataIndex;r.includes(a)||o.isAdditionalColumn||i.notifyCantEdit()}}})),s.onCopy=function(e){n.getCommand("Copy").begin()},s.onPaste=function(t){s.setUseClipboardFlag(!1);var i=n.getCommand("Paste");i.isEnabled()?i.begin():require(["DS/PADUtils/views/PADAlert","i18n!DS/PADUtils/assets/nls/PADUtils.json"],(function(t,n){!1===e.options.context.getEditMode()?t.displayNotification({msg:n.edit_mode_disabled,eventID:"warning"}):t.displayNotification({msg:n.must_select,eventID:"warning"})}))},s.onCut=function(e){n.getCommand("Cut").begin()},t()}))},s.prototype.rowReorder=function(e,t){var n=this;return new Promise((function(i){n.options.dgv.onDropRowHeaderDefault(e,t),i()}))},s})),define("DS/ENOPAD_v2/commands/EditInTableCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/ENOPAD_v2/utils/PADDGVDirectEdition"],(function(e,t,n,i){"use strict";return t.extend({init:function(e){this._parent(e),this.context=n.get()},currentState:function(){return this.context.getEditMode()?"enabled":"disabled"},isCommandAvailable:function(e){var t=!1;"datagridview"===this.context.getCurrentView()&&(this.context.getSelectedNodes().length>0&&e&&e.params&&e.params.cellInfos&&(t=i.editCtxMenuAvailable(this.context,e.params.cellInfos)));return t},setViewParams:function(e){this.viewParams=e},execute:function(){var e=this;e.viewParams?require(["DS/ENOPAD_v2/utils/PADBulkEdit"],(function(t){var n=e.viewParams.cellInfos;e.viewParams=null,t.execute({padcomponent:e.context,cellInfos:n})})):console.warn("View parameters not defined")}})})),define("DS/ENOPAD_v2/features/BSDIntegration",["DS/PlatformAPI/PlatformAPI","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/WaitingPromise","DS/ENOXParser/modules/BsdParser","DS/ENXNav/utils/TwoDAppEvents","DS/ENOPAD_v2/utils/UrlParams","DS/ENOPAD_v2/features/private/EditorTools","DS/ENOPAD_v2/features/private/BsdApi","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],(function(e,t,n,i,o,s,r,a,d){"use strict";const l={FLATTEN:"/"};function c(e){return!0===e.isGroupingNode&&void 0!==e.options.bsIntent}function u(e,t){return e.structureID===t.structureID&&e.ds6w===t.ds6w}function p(e,t){let n=t.group,i=t.predicate,o=t.bsdPredicate,s={isGroupingNode:!0,resourceid:"xnav-BSDNode-"+n+"-"+t.parentId,label:t.groupLabel,grid:{groupValue:n,groupBy:i},ds6w:i,grp:n,bsIntent:o,fakeCreationGuid:window.crypto.randomUUID()},r=e.createNodeModel(s);return o.mapBSNodes[n]=r,r}function g(e,t,n){n=void 0!==n&&n;let i=t.ds6w+"-Instance";e.options.grid[i]=n?void 0:t.nodeTitle}function h(e){if(e&&function(e){if(e.hasChildren())return!e.getChildren().filter((e=>!e.isHidden())).length;return!0}(e)&&c(e)){e.hide(),h(e.getParent())}}function f(e,t){e.isHidden()&&e.show();let n=e.getChildren().filter((e=>!c(e))).map((e=>({relationOrder:e.options.relationOrder,node:e})));n.sort(((e,t)=>e.relationOrder-t.relationOrder));let i=n.filter((e=>e.relationOrder<t.options.relationOrder)),o=t.getParent();if(i.length){let n=i[i.length-1];e.insertAfter(t,n.node)}else{let i=n.filter((e=>e.relationOrder>t.options.relationOrder));if(i.length){let n=i[0];e.insertBefore(t,n.node)}else e.addChild(t)}o&&h(o)}function D(e,t,n,i,o,s){for(let r=0;r<e.datas.length;r++){let a=e.datas[r];if(a.info.label===t.structureTitle&&a.info.predicate===t.ds6w){let e=a.node;if(o?i.getRealParent()===e:e.getChildren().includes(i)){let o=n.get(e.getOccurencePath().join(l.FLATTEN));if(o){s&&(s.data=a,s.bsdLookup=o);let e=o.mapBSNodes[t.revpathTitle.join("/")];if(e&&e.getRoot()===i.getRoot())return e}}}}return null}function v(e){let t=e.parser,n=e.ptr,i=e.relNodes,o=e.model,s=e.mappedBsdNodes,r=function(e,t){let n=[];for(let i=0;i<e.length;i++){let o=e[i],s=t.filter((e=>u(e,o)));s.length&&n.push({add:o,remove:s[0]})}return n}(t.addNodes,t.removeNodes);for(let e=0;e<r.length;e++){let t=r[e],a=t.add,d=t.remove,l=n._predicateInfoMap.get(d.structureTitle),c=[],u=new A;if(l){for(let e=0;e<i.length;e++){let t=i[e],n=D(l,a,s,t,!0);g(t,a),n?u.addChild(n,t):c.push(t)}let e=u.processParents();Promise.allSettled(e).then((()=>{for(let e=0;e<c.length;e++){let t=c[e],n=D(l,a,s,t,!0);if(n)n.addChild(t);else{let e=t.getRealParent();e.isGroupingNode&&(e=e.getParent());let n=e.getChildren().filter((e=>e.isGroupingNode));if(n.length){let i=s.get(e.getOccurencePath().join("/")),r=e;for(let e=0;e<a.revpathTitle.length;e++){let t=a.revpathTitle[e],s=a.revpathTitle.slice(0,e+1).join("/");if(i.mapBSNodes[s]);else{let d=p(o,{group:s,groupLabel:t,predicate:a.structureTitle,bsdPredicate:i,parentId:r.getID()});if(d.setState({state:"expanded"}),0===e){let e=n[n.length-1];e&&r.insertAfter(d,e)}else r.addChild(d);r=d}}let d=t.getParent(),l=d.isGroupingNode;r.addChild(t),l&&h(d)}}}}))}}}function m(e){let t=e.node,n=e.model,i=e.mappedBsdNodes,o=e.groupPath,s=e.predicate,r=e.coordinator,a=t.getRealParent(),d=a.getChildren().filter((e=>e.isGroupingNode));if(d.length){let e=i.get(a.getOccurencePath().join(l.FLATTEN)),c=a,u=o.length-1;for(let i=0;i<o.length;i++){let a,g=o[i],h=o.slice(0,i+1).join(l.FLATTEN),f=e.mapBSNodes[h];if(f)i===u?r.addChild(f,t):(c=f,f.isExpanded()||f.setState({state:"expanded"}));else{if(a=p(n,{group:h,groupLabel:g,predicate:s,bsdPredicate:e,parentId:c.getID()}),a.setState({state:"expanded"}),0===i){let e=d[d.length-1];e&&c.insertAfter(a,e)}else c.addChild(a);c=a}}c.moveChild(t)}}function P(e){return e.options.mappedNodes}function _(e,t){let n=t.getOccurencePath().join("/");return e.get(n)}function A(e){this.options=e,this.options||(this.options={}),this._map=new Map,this._prevParent=new Map,this._parents=[]}function S(e){this.options=e,this._nodeToPredicate=new Map,this._predicateInfoMap=new Map,this._predicateDataCache=new Map,this._isBSDGroupingApplied=!1,this._urlParams=new s,this._setup()}return A.prototype={addChild:function(e,t){if(e.isExpanded())this._smartAddChild(e,t);else{let n=this._map.get(e);n?n.push(t):(this._map.set(e,[t]),this._parents.push(e))}},processParents:function(){let e=[];for(let t=0;t<this._parents.length;t++){let n=this._parents[t],i=this._map.get(n);e.push(this._expandThenInsert(n,i)),n.isVisible()||e.push(r.expandAndWait(n.getParent()))}if(this.options.hasParentCache)for(const e of this._prevParent.values())this._smartHideParentTree(e);return e},_expandThenInsert:function(e,t){let n=this;return new Promise(((i,o)=>{r.expandAndWait(e).then((e=>{let o=e.parent,s=n._smartGatherChildrenParents(t);o.addChild(t),n._smartHideParentsIfEmpty(s),i()}))}))},cachePreviousGroupParent:function(e){let t=e.getParent();t&&c(t)&&this._prevParent.set(e,t)},_smartGatherChildrenParents:function(e){let t=[];for(let n=0;n<e.length;n++){let i=e[n],o=this.options.hasParentCache?this._prevParent.get(i):i.getParent();o&&o.isGroupingNode&&(t.includes(o)||t.push(o))}return t},_smartHideParentsIfEmpty:function(e){for(let t=0;t<e.length;t++){let n=e[t];n.hasChildren()||n.hide()}},_smartHideParentTree:h,_smartAddChild:f},S.prototype={_setup:function(){let n=this;e.subscribe("BrowsingStructureAssociationUpdate",(function(e){e.widgetID===t.getWidgetId()&&n.isBSDGroupingApplied()&&n._processUpdate(e)})),e.subscribe("groupByBSSelection.Select",this._BSDApply.bind(this)),o.onBsdApply(this._bsdApplySuccess.bind(this)),o.onBsdFail(this._bsdApplyFail.bind(this))},_getModel:function(){return this._model?this._model:this._model=this.options.context.options.model},_processUpdate:function(e){let t=new i({data:e}),n=this._getModel(),o=n.options.mappedNodes,s=t.relidsAffected.map((e=>{let t=n.getNodesByRelId(e);if(t.length)return t[0]})).filter((e=>e));t.hasNodeAdds&&t.hasNodeRemoves?v({parser:t,ptr:this,mappedBsdNodes:o,model:n,relNodes:s}):(t.hasNodeAdds&&function(e){let t=e.parser,n=e.mappedBsdNodes,i=e.relNodes,o=e.model,s=e.ptr,r=t.addNodes;for(let e=0;e<r.length;e++){let t=r[e],a=s._predicateInfoMap.get(t.structureTitle),d=[],l=new A;if(a){for(let e=0;e<i.length;e++){let o=i[e],s={},r=c(o.getParent()),u=D(a,t,n,o,r,s);if(g(o,t),u)l.addChild(u,o);else{let e=o.getRoot();n.has(e.getID())&&s.bsdLookup&&d.push(o)}}let e=l.processParents();Promise.allSettled(e).then((()=>{for(let e=0;e<d.length;e++){let i=d[e],s=D(a,t,n,i,!1);if(s)s.addChild(i);else{let e=i.getParent(),s=e.getChildren(),r=s.filter((e=>e.isGroupingNode));if(r.length){let s=n.get(e.getOccurencePath().join("/")),a=e;for(let e=0;e<t.revpathTitle.length;e++){let n=t.revpathTitle[e],i=t.revpathTitle.slice(0,e+1).join("/"),d=s.mapBSNodes[i];if(d)a=d,d.isExpanded()||d.setState({state:"expanded"});else{let d=p(o,{group:i,groupLabel:n,predicate:t.structureTitle,bsdPredicate:s,parentId:a.getID()});if(d.setState({state:"expanded"}),0===e){let e=r[r.length-1];e&&a.insertAfter(d,e)}else a.addChild(d);a=d}}a.addChild(i)}else{let r={predicate:{label:t.nodeTitle,name:t.ds6w},mapBSNodes:{}};n.set(e.getOccurencePath().join("/"),r);let a=e;for(let e=0;e<t.revpathTitle.length;e++){let n=t.revpathTitle[e],i=t.revpathTitle.slice(0,e+1).join("/");if(r.mapBSNodes[i]);else{let d=p(o,{group:i,groupLabel:n,predicate:t.structureTitle,bsdPredicate:r,parentId:a.getID()});if(d.setState({state:"expanded"}),0===e){let e=s[0];e&&a.insertBefore(d,e)}else a.addChild(d);a=d}}a.addChild(i)}}}}))}}}({parser:t,mappedBsdNodes:o,ptr:this,model:n,relNodes:s}),t.hasNodeRemoves&&function(e){let t=e.parser,n=e.mappedBsdNodes,i=e.relNodes,o=e.ptr,s=t.removeNodes;for(let e=0;e<s.length;e++){let t=s[e],r=!1,a=o._predicateInfoMap.get(t.structureTitle);if(a)for(let e=0;e<a.datas.length&&!r;e++){let o=a.datas[e];if(o.info.label===t.structureTitle&&o.info.predicate===t.ds6w){let e=o.node,s=n.get(e.getOccurencePath().join("/")).mapBSNodes[t.revpathTitle.join("/")];if(s)for(let e=0;e<i.length;e++){let n=i[e];n.getParent()===s&&(g(n,t,!0),f(s.getRealParent(),n),r=!0)}}}}}({parser:t,mappedBsdNodes:o,relNodes:s,ptr:this})),n._switchToAuthoring()},_BSDApply:function(e){e.predicate&&this._applyBSDGrouping(e)},_bsdApplySuccess:function(e){},_bsdApplyFail:function(e){this._cleanBSDGrouping(e)},isBSDGroupingApplied:function(){return this._isBSDGroupingApplied},_applyBSDGrouping:function(e){let n=e.predicate,i=this.options.context.options.model.getSelectedNodes();if(i.length){let t=i[0],n=t.getOccurencePath().join("/");if(this._nodeToPredicate.get(n))for(let[e,n]of this._predicateInfoMap)for(let e=0;e<n.datas.length;e++){let i=n.datas[e];i.node===t&&this._cleanBSDGrouping({predicateInfo:i.info,node:t})}this._isBSDGroupingApplied=!0,this._nodeToPredicate.set(n,e.predicate);let o=this._predicateInfoMap.get(e.label);o?o.datas.push({node:t,info:e}):this._predicateInfoMap.set(e.label,{datas:[{node:t,info:e}]})}this._performCache({predicateToMatch:n,lang:t.getLang()})},_performCache:function(e){let t=this;this._predicateDataCache.has(e.predicateToMatch)||a.getBrowsingStructureTree(e).then((n=>{let i=n.getFinalRoot();t._predicateDataCache.set(e.predicateToMatch,i),console.log(n)})).catch((e=>{console.error(e)}))},_wipeBSDGrouping:function(){console.log("BSD: clear grouping"),this._isBSDGroupingApplied=!1,this._predicateInfoMap.clear(),this._nodeToPredicate.clear()},_cleanBSDGrouping:function(e){e.node;let t=e.predicateInfo,n=t.predicate;if(n||(n=t.name),t){let e=this._predicateInfoMap.get(t.label);if(e){let i=[];for(let t=0;t<e.datas.length;t++){e.datas[t].info.predicate===n&&i.push(t)}i.sort(((e,t)=>t-e));for(let t=0;t<i.length;t++){let n=i[t];e.datas.splice(n,1)}0===e.datas.length&&(this._predicateInfoMap.delete(t.label),this._predicateDataCache.delete(t.predicate),0===this._predicateInfoMap.size&&this._wipeBSDGrouping())}}},executeCommand:function(e){if("RemoveAndResetExpand"===e.id)this._executeRemoveAndResetExpand(e)},_executeRemoveAndResetExpand:function(e){let t=this.options.context.getPADTreeDocument(),n=t.getXSO(),i=n.get();for(let e=0;e<i.length;e++){let n=i[e];t.isDGVGroupingApplied()&&n.ungroupChildren(),delete n.options.childComputed,t.cleanGroupingForNodes({node:n}),t.triggerDGVGroupingClear();let o=n.getOccurencePath().join(l.FLATTEN);if(this._nodeToPredicate.has(o)?(t.options.groupingFilterInProgress=!0,t.removeGrouping({selectedNode:n}),t.options.groupingFilterInProgress=!1):n.removeChildren(),n.options&&n.options.grid&&n.options.grid.groupValue){let e=this._predicateInfoMap.get(n);e&&this._cleanBSDGrouping({node:n,predicateInfo:{predicate:e.predicate,label:e.label}})}n.updateOptions({children:[]}),n.collapse()}0===t.options.mappedNodes.size&&this._wipeBSDGrouping(),n.remove(i),n.add(i)},displayRefreshMessage:function(e){t.displayNotif({title:d.grouping.refreshTitle,message:d.grouping.refreshMessage,level:"info"})},displayNoExternalDropMessage:function(e){t.displayNotif({title:d.noDropsOutsideBsdgrouping.title,message:d.noDropsOutsideBsdgrouping.message,level:"info"})},replaceMaybeAssign:function(e){let t=this,n=e.nodes,i=P(this._getModel()),o=n.map((e=>{let n,o,s=e.getParent();if(s){let e=s.getOccurencePath().join(l.FLATTEN);n=t._nodeToPredicate.get(e),n&&(o=i.get(e))}return{relationid:e.getRelationID(),predicate:n,lookup:o,node:e}})),s=o.map((e=>e.relationid));a.getBSDNodesForProductNodes({relationIds:s}).then((e=>{console.log(e);for(let n=0;n<o.length;n++){let i=o[n],s=e.nodesPerInstances[i.relationid],r=t._predicateDataCache.get(i.predicate);if(s&&r)for(let e=0;e<s.length;e++){let t=s[e],n=r.flatMap.get(t);if(n){let e=n.buildLabelPath().join(l.FLATTEN),t=i.lookup.mapBSNodes[e];t&&f(t,i.node)}}}}))},pasteMaybeAssign:function(e){let t=this;return new Promise(((n,i)=>{let o=t._getModel(),s=P(o),r=_(s,e.parent);if(r){let i=e.parent.getOccurencePath().join(l.FLATTEN),d=t._nodeToPredicate.get(i);if(d){let i=e.node.getRelationID();a.getBSDNodesForProductNodes({relationIds:[i]}).then((a=>{let c=a.nodesPerInstances[i],u=t._predicateDataCache.get(d);if(u&&c){for(let t=0;t<c.length;t++){let n=c[t],i=u.flatMap.get(n);if(i){let t=i.buildLabelPath(),n=t.join(l.FLATTEN),a=r.mapBSNodes[n];a?e.coordinator.addChild(a,e.node):m({node:e.node,model:o,predicate:d,groupPath:t,coordinator:e.coordinator,mappedBsdNodes:s})}}n()}else n()}))}}}))},createCoordinator:function(e){return new A({hasParentCache:e=void 0!==e&&e})},dndIsGroupDrop:function(e){return c(e)},dndHasBsdGroups:function(e){return e.filter((e=>c(e))).length>0},dndCheckReassign:function(e){let t=e.nodes;e.target;return t.map((e=>({isNodeInBsdGroup:c(e.getParent())}))).filter((e=>!0===e.isNodeInBsdGroup)).length>0},dndQueueReassign:function(e){let t=this,i=e.nodes,o=e.target,s={};e.isMove&&(s={hasParentCache:!0});let r=new A(s);if(e.isMove)for(let e=0;e<i.length;e++)r.cachePreviousGroupParent(i[e]);let d=o.getModelEvents(),c=t._getModel(),u=P(c),p=new n;p.then((()=>{r.processParents()}));let g=[],h=i.length,f=d.subscribe({event:"addChild"},(n=>{let s=n.data.nodeModel;if(function(t,n){return e.isMove?t===o&&i.includes(n):e.isCopy?t===o:void 0}(n.parent,s)){let e=!1;h--,0===h&&(d.unsubscribe(f),e=!0);let n=function(e){let t=e.node,n=e.target,i=e.mappedBsdNodes,o=e.ptr,s=e.coordinator,r=e.model,d=null,c=_(i,n);if(c){let u=n.getOccurencePath().join(l.FLATTEN),p=o._nodeToPredicate.get(u);p&&(d=new Promise(((n,d)=>{let u=t.getRelationID();a.getBSDNodesForProductNodes({relationIds:[u]}).then((a=>{let d=a.nodesPerInstances[u],g=o._predicateDataCache.get(p);if(g&&d){for(let n=0;n<d.length;n++){let o=d[n],a=g.flatMap.get(o);if(a){let n=a.buildLabelPath(),o=n.join(l.FLATTEN),d=c.mapBSNodes[o];d?s.addChild(d,t):m({node:e.node,model:r,predicate:p,groupPath:n,coordinator:s,mappedBsdNodes:i})}}n()}else n()}))})))}return d}({node:s,target:o,model:c,coordinator:r,mappedBsdNodes:u,ptr:t});n&&g.push(n),e&&(g.length?Promise.allSettled(g).then((()=>{p.resolve()})):p.resolve())}}))}},S})),define("DS/ENOPAD_v2/mixins/PlmNew",["DS/ENOPAD_v2/features/CreateOptionsBuilder","DS/ENOPAD_v2/features/CreateOptionsForDesignExp","DS/ApplicationFrame/CommandsManager"],(function(e,t,n){"use strict";const i=["DS/TopBarProxy/TopBarProxy","DS/TopBarProxy/MenuItem"],o=["DS/ENONewWidget/ENONew/Events"],s=["ENONewProductHdr","ENONewPartHdr","ENONewDrawingHdr"];function r(){}return r.prototype={getCreateOptions:function(n){let i={};return i="ENOExpDesignExperience"==n.newType?new t({model:this.options.model,component:this,typeDetails:n}):new e({model:this.options.model,component:this,typeDetails:n}),i.execute()},postActionBar:function(){if(this.options.isPlmNew){let e=this,t=this.options.model.getXSO();require(o,(function(n){let i=function(t){!function(e,t){let n={editMode:t.getEditMode(),selectedNodes:[]},i=t.getSelectedNodes().map((function(e){return{pid:e.getID(),type:e.options.type,cadMaster:e.options.grid["ds6w:cadMaster"]}}));n.selectedNodes=i,e.dispatchEvent("onSelection",n)}(n,e)};t.onEmpty(i),t.onPostAdd(i),t.onPostRemove(i),e.addEvent("editModeModified",i),!1===e.getEditMode()&&i()})),require(i,(function(e,t){let i=new e({id:widget.id}),o=s.map((function(e){let i=n.getCommand(e);var o;return{add:new t({label:(o=i,o.getCommandLabel?o.getCommandLabel():o.labelTopBar),onExecute:function(){i.execute()}})}}));for(let e=0;e<o.length;e++){let t=o[e];i.addContent(t)}}))}}},r})),define("DS/ENOPAD_v2/mixins/_PADCCP",["UWA/Class","DS/ENOPAD_v2/utils/PADClipboard","DS/PADUtils/views/PADAlert","DS/ENOPAD_v2/views/PADDropConfirm","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/AttributesMgtV2","DS/PADUtils/PADSettingsMgt","DS/ENXNav/utils/TwoDAppEvents","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/modules/ClientDataParser","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],(function(e,t,n,i,o,s,r,a,d,l,c,u){"use strict";var p=e.extend({init:function(){this._parent(arguments),this._acceptedNodes={},this._rejectedNodes={}},acceptNode:function(e){var t=!1;if(!0===e.isRelationsObjectNode)t=!0,this._rejectedNodes.nonPSNodes||(this._rejectedNodes.nonPSNodes={nodes:[]}),this._rejectedNodes.nonPSNodes.nodes.push(e);else{var n=e.getPath(),i=n.length,o=n[0].getID();if(this._acceptedNodes.hasOwnProperty(o)){var s=this._acceptedNodes[o];if(s.depth<=i)s.nodes.push(e);else{var r=e.getFirstCommonAncestor(s.nodes[0]);s.nodes.length=0,s.nodes.push(r),s.depth=r.getPath().length,t=!0}}else this._acceptedNodes[o]={depth:i,nodes:[e]}}return t},applyOnAcceptedNodes:function(e){var t=!0,i=!1,o=!1;for(var s in this._acceptedNodes)if(i=!0,UWA.is(s,"string"))for(var r=this._acceptedNodes[s].nodes,a=0;a<r.length;a++)e(r[a]);return this._rejectedNodes.nonPSNodes&&(o=!0,1===this._rejectedNodes.nonPSNodes.nodes.length?n.displayNotification({msg:c.replace(c.copyNonPSNode,{label:this._rejectedNodes.nonPSNodes.nodes[0].getLabel()}),eventID:"warning"}):this._rejectedNodes.nonPSNodes.nodes.length>=1&&n.displayNotification({msg:c.replace(c.copyNonPSNodes,{length:this._rejectedNodes.nonPSNodes.nodes.length}),eventID:"warning"})),!0===o&&!1===i&&(t=!1),t}});function g(e,t){Date.now();e.withBroadcastSelect((function(){var t=e.getXSO();if(!t.isEmpty()){var i=t.get(),o=!1;i.sort(((e,t)=>e._rowID-t._rowID)),i.sort((function(e,t){var n=e.getDepth(),i=t.getDepth();return n===i?0:n<i?-1:n>i?1:void 0}));var s=new p;if(i.forEach((function(e){o=s.acceptNode(e)||o})),o){Date.now();e.unselectAll();Date.now();!0===s.applyOnAcceptedNodes((function(e){Date.now();e.select()}))&&n.displayNotification({msg:c.reselectionFeedback,eventID:"warning"})}}}))}function h(e,n){var i=e.getXSO();if(!i.isEmpty()){var o,s=i.get(),r={action:n,objects:[]},a=[];s.forEach((function(e){e.isVisible()&&!0!==e.isRelationsObjectNode&&(o=e.getOccurencePath(),r.objects.push({path:o,labelPath:e.buildPath()}),a.push(e))})),t.setData(t.OBJECT,r),"cut"===n&&D(a)}}var f=[];function D(e){f=e}function v(){return f}return e.extend({activeCutting:!1,activeNodes:[],getActiveNodes:function(){return v()},setStateCuttingNodes:function(e){e&&(this.activeCutting&&this.activeNodes.length>0&&this.setStaUncuttingNodes(this.activeNodes),e.forEach((function(e){e.updateOptions({isBeingCut:!0})})),this.activeCutting=!0,this.activeNodes=e)},setStaUncuttingNodes:function(e){e.length>0&&e.forEach((function(e){e.options.isBeingCut&&e.updateOptions({isBeingCut:!1})})),this.activeCutting=!1,this.activeNodes=[]},copy:function(){var e=this.getPADTreeDocument(),t=e.getSelectedNodes();this.uncut(),D([]),e.withBroadcastSelect((function(){e.withTransactionUpdate((function(){t.forEach((function(e){e.select()}))}))})),g(e),h(e,"copy")},cut:function(){var e=this.getPADTreeDocument();g(e),h(e,"cut"),this.options.model.setCuttingNodes(v()),this.setStateCuttingNodes(v())},uncut:function(){this.activeCutting&&(this.options.model.setCuttingNodes([]),this.setStaUncuttingNodes(this.activeNodes)),this.getPADTreeDocument().unselectAll(),t.isEmpty(t.OBJECT)||t.clear(t.OBJECT)},resetClipboard:function(){this.uncut()},_processTargets:function(e){var t,n=[],i=[];return e.forEach((function(e){e.isRoot()?n.push(e):(t=e.getID(),i.indexOf(t)<0&&(n.push(e),i.push(t)))})),n},_inputData:function(e,t){var n=[],i=[],o=[];return e.forEach((function(e){var t=e.getRelationID();""===t?n.push(e.getOccurencePath()):-1===i.indexOf(t)&&(i.push(t),n.push(e.getOccurencePath()))})),t.forEach((function(e){o.push(e.getOccurencePath())})),{children:n,parents:o,commit:!0}},_inputDataCopy:function(e,t){var n=[],i=[];return e.forEach((function(e){n.push(e.getOccurencePath())})),t.forEach((function(e){i.push(e.getOccurencePath())})),{children:n,parents:i,commit:!0}},_distinguishInsertReparentCases:function(e,t){var n={insertExisting:[],reparent:[]};return e.forEach((function(e){!e.getRelationID()||"copy"===t?n.insertExisting.push(e):n.reparent.push(e)})),n},paste:function(){var e,p,g=this;let h,f,D=[];function m(e){var t,n=[];return e.forEach((function(e){o.isFakeTreeNodeModel(e)||e.getRelationID()&&(t=e.getRealParent().getID(),-1===n.indexOf(t)&&n.push(t))})),n}function P(e,t){var n;for(n=0;n<e.length;n++){var i=e[n];if(i.options.resourceid===t)return e.splice(n,1),i}return null}function _(e,t){var n,i,o,s=e.length;if(t){for(n=0;n<s;n++)if((i=e[n]).options.resourceid===t){o=i;break}}else 1===s&&(o=e[0]);return o}function A(e,t){var n,i,o,s=e.length;if(t){var r=[];for(n=0;n<s;n++)(i=e[n]).options.resourceid===t&&r.push(i);if(1==r.length)o=r[0];else if(r.length>1){o=r[0];e.indexOf(o)}}else 1===s&&(o=e[0]);return o}function S(e){for(var t=[],n=g.getPADTreeDocument(),i=0;i<e.length;i++){var o=e[i],s=n.getNodeByOccurencePath(o);s&&t.push(s.getLabel())}return t}this.features.bsdIntegration&&this.features.bsdIntegration.isBSDGroupingApplied()&&(h=this.features.bsdIntegration),this.setStaUncuttingNodes(v());var b=this.getPADTreeDocument(),I=b._confirmDialog||!1,N=0,E=0,y=0,x=b.getXSO();if(!x.isEmpty()){var C=x.get();if(C.some((function(e){return"Drawing"===e.options.type})))return n.displayNotification({msg:u.msg_warning_invalid_parent,eventID:"warning"}),!1;E=(C=this._processTargets(C)).length;var O=u.selected_target;if(E>1&&(O=u.selected_targets),!t.isEmpty(t.OBJECT)){var w=!1;v().length>0&&(w=!0);var R=t.consumeData(t.OBJECT,w),T=R.action;if(T&&(p="copy"===T?"COPY":"MOVE",e=function(e,t){var i=[];return e.objects.forEach((function(e){var o=d.node.exactNodeByPath(t,e.path);if(o&&o.getOccurencePath().length===e.path.length)i.push(o);else{var s=e.labelPath.replace(/\/$/,"");n.displayNotification({msg:s+c.pasteObjectNotInView,eventID:"error"})}})),i}(R,b)),e.length<R.objects.length)return;if(e.length>0&&("MOVE"===p?(N=e.length,y=0):(N=0,y=e.length)),E*N>1e3)return void n.displayNotification({msg:u.limit_cut_paste,eventID:"error"});var M=function(t){t&&(y>0&&(g.beginBlockingTransaction(c.composite),require(["DS/ApplicationFrame/CommandsManager"],(function(t){var i=t.getCommand("InsertExisting"),o=m(e);i.execute({mode:"CopyPaste",internal_call:!0,data:g._inputDataCopy(e,C),onSuccess:function(t){!function(t,i,o){var s,r,d,u,v,m,S,b,I=t.length,N=(i.length,[]),E=g.getPADTreeDocument(),y=[];let x=[];for(s=0;s<I;s++){d=t[s].hasParent,u=t[s].relationid,v=t[s].resourceid,m=t[s].instanceName?t[s].instanceName:"",S=d+"_"+u+"_"+v,r=P(e,v);let n=t[s].clientTaskData;if(n)new l(n).appendPids(x);else{let e=t[s].relationid?t[s].relationid:t[s].resourceid;x.push(e)}r?N.push(r):r=_(N,v);var C,O,w,R=r.getID(),T=r.getRelationID(),M=!Boolean(T);E.wrapInTransaction((function(){E.withTransactionUpdate((function(){if(C=A(i,d))if(O=C.getID(),w={node:r,parent:C,behavior:p,newRelationID:u,instanceName:m},b=d+"_"+C.options.relationid?C.options.relationid:"",S=b+S,y.indexOf(S)<0){if(E.instantiate(w,o),y.push(S),h){let e=w.parent.getNodesByRelId(w.newRelationID);if(f||(f=h.createCoordinator("MOVE"===p)),e.length){let t=h.pasteMaybeAssign({node:e[0],parent:w.parent,coordinator:f,behavior:p,operation:"insert"});D.push(t)}}var e=[],t={transactions:[],origin:"CCP"},n={detach:{}};if(t.transactions.push({insertExisting:{modified:[O],inserted:[R],created:[u],withContext:!M}}),e.push(u),e.length){var s=[];e.forEach((function(e){var t=E.getNodesByRelId(e);t&&s.push(t[0].getOccurencePath())})),t.transactions[0].insertExisting.inserted=s}M||"COPY"===p?(g._commandProxy.padRefresh(t),a.addChild()):(n.detach.deleted=[T],g._commandProxy.padRefresh(t),g._commandProxy.padRefresh(n),a.addChild())}else console.log("already added to targets",w)}),g),g.endBlockingTransaction()}))}E.refreshNodeById({modified:x}),E.isOccModel&&E.isDGVGroupingApplied()&&E.triggerDGVGroupingReapply(),n.displayNotification({msg:c.pasteSucceeded,eventID:"info"}),f&&Promise.allSettled(D).then((e=>{f.processParents()}))}(t,C,o)},onFailure:function(e){!function(e){var t=[],i=[];e&&e.targets&&(t=S(e.targets)),e&&UWA.is(e.messages,"array")?(e.messages.forEach((function(e){-1===i.indexOf(e)&&i.push(e)})),n.displayNotification({msg:i.join(""),eventID:"error"})):t&&t.length>0&&n.displayNotification({msg:"Failed insert operation in "+t.join(""),eventID:"error"}),g.resetClipboard&&g.resetClipboard(),g.endBlockingTransaction()}(e)}})}))),N>0&&(g.beginBlockingTransaction(c.composite),require(["DS/ApplicationFrame/CommandsManager"],(function(t){var i=t.getCommand("InsertExisting"),o=m(e);i.execute({mode:"CutPaste",internal_call:!0,data:g._inputData(e,C),onSuccess:function(t){!function(t,i,o){var d,u,v,m,S,b,I,N,E,y,x,C,O,w=t.length,R=(i.length,[]),T=g.getPADTreeDocument(),M=[],B=!0,k=[],F=[],U=[],j=[];let L=[];t.forEach((function(e){var t=e.relationid,n=e.hasParent,i=e.resourceid;t&&-1===k.indexOf(t)&&k.push(t),n&&-1===F.indexOf(n)&&F.push(n),i&&-1===j.indexOf(i)&&j.push(i);let o=e.clientTaskData;o&&new l(o).appendPids(L)}));var V={newRelationIDs:k,tgtParentIds:F,removedNodeIds:j};let G=[],W=r.getSetting("activateFUN153004"),X=r.getSetting("lockControlByAdmin"),q=!!s.getColumn("ds6w:reserved-Instance");for(d=0;d<w;d++){S=t[d].hasParent,u=t[d].relationid;let s=v=t[d].resourceid;C=S+"_"+u+"_"+v,(m=P(e,v))?R.push(m):m=_(R,v),(m&&m._options.grid["positionMatrix-Instance"]||b&&b._options.grid["positionMatrix-Instance"])&&G.push(s),!0===W&&X&&m&&!1===G.includes(s)&&!0===q&&G.push(s);try{E=m.getID(),y=m.getRelationID(),x=!Boolean(y),T.wrapInTransaction((function(){T.withTransactionUpdate((function(){if(b=A(i,S))if(I=b.getID(),N={node:m,parent:b,behavior:p,newRelationID:u},O=S+"_"+b.options.relationid?b.options.relationid:"",C=O+C,M.indexOf(C)<0){if(h&&(f||(f=h.createCoordinator("MOVE"===p)),f.cachePreviousGroupParent(m)),T.instantiate(N,o,V),T.refreshNodeById({modified:L}),M.push(C),h){let e=h.pasteMaybeAssign({node:m,parent:b,coordinator:f,behavior:p,operation:"reparent"});D.push(e)}var e=[],t={transactions:[],origin:"CCP"},n={detach:{deleted:[]}};if(t.transactions.push({insertExisting:{modified:[I],inserted:[E],created:[u],withContext:!x}}),e.push(u),e.length){var s=[];e.forEach((function(e){var t=T.getNodesByRelId(e);t&&t.length&&t.forEach((function(e){s.push(e.getOccurencePath())}))})),t.transactions[0].insertExisting.inserted=s}x||"COPY"===p?(g._commandProxy.padRefresh(t),a.addChild()):(g._commandProxy.padRefresh(t),-1===k.indexOf(y)&&-1===U.indexOf(y)&&(U.push(y),n.detach.deleted.push(y),g._commandProxy.padRefresh(n)),a.addChild())}else console.log("already done ")}),g)})),G&&G.length&&T.refreshNodeById({modified:G}),g.endBlockingTransaction()}catch(e){g.endBlockingTransaction(),g.resetClipboard&&g.resetClipboard(),n.displayNotification({msg:c.pasteFailed,eventID:"error"}),B=!1}}f&&Promise.allSettled(D).then((e=>{f.processParents()})),T.isOccModel&&T.isDGVGroupingApplied()&&T.triggerDGVGroupingReapply(),B&&n.displayNotification({msg:c.pasteSucceeded,eventID:"info"})}(t,C,o)},onFailure:function(e){!function(e){g.endBlockingTransaction();var t=[],i=[];e&&e.targets&&(t=S(e.targets)),e&&UWA.is(e.messages,"array")?(e.messages.forEach((function(e){-1===i.indexOf(e)&&i.push(e)})),n.displayNotification({msg:i.join(""),eventID:"error"})):t&&t.length>0&&n.displayNotification({msg:"Failed reparent operation in "+t.join(""),eventID:"error"}),g.resetClipboard&&g.resetClipboard()}(e)}})}))))};if(I){var B=u.all_selected_objects;1===e.length&&(B=e[0]._options.display||e[0]._options.label),1===C.length&&(O=C[0]._options.display||C[0]._options.label);new i({copyMode:p,dropName:B,targetName:O,callback:M})}else M(!0)}}},resetPosition:function(){this._doMove([1,0,0,0,1,0,0,0,1,0,0,0],"RESETPOSITION")},pastePosition:function(){for(var e=t.getData(t.POSITION).matrix.split(","),n=[],i=0;i<e.length;i++)n.push(parseFloat(e[i]));this._doMove(n,"PASTEPOSITION"),t.clear(t.POSITION)},_doMove:function(e,t){var i=this,o=i.getPADTreeDocument();require(["DS/UPSCommands/UPSCmdUtils","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSession"],(function(s,r,a){var d={instances:[],onComplete:function(s){if("success"===s.status){for(var d,l=e.toString(),p=0;p<s.results.length;p++)for(var g=o.getNodesByRelId(s.results[p].instance),h=0;h<g.length;h++){var f={relationId:s.results[p].instanceOut,grid:{"positionMatrix-Instance":r.checkNotIdentity(l)?l:void 0}};g[h].updateOptions(f)}switch(t){case"RESETPOSITION":d=c.resetPositionSucceeded;break;case"PASTEPOSITION":d=c.pastePositionSucceeded}n.displayNotification({msg:d,eventID:"info"}),a.setAuthoringState(!0,u.PADSession_disabling_index_authoring),o.pushUpdate(),i._commandProxy.updatePosMatrix(i.newParams),delete i.newParams}else"failure"===s.status&&(n.displayNotification({msg:s.message,eventID:"error"}),o.pushUpdate())},onFailure:function(e){var i,s="";switch(e.messages&&(s=Array.isArray(e.messages)?e.messages[0]:e.messages),t){case"RESETPOSITION":i=s.length>0?c.resetPositionFailedWithError:nlskeys.resetPositionFailed;break;case"PASTEPOSITION":i=s.length>0?c.pastePositionFailedWithError:c.pastePositionFailed}s.length>0&&(i=i.replace("{error}",s)),n.displayNotification({msg:i,eventID:"error"}),o.pushUpdate()}},l=i.getPADTreeDocument(),p=(l._confirmDialog,l.getXSO());if(!p.isEmpty()){for(var g=p.get(),h=0;h<g.length;h++){var f=g[h];("VPMRepInstance"!==f.options.relationtype||""===f.options.relationtype&&"3DShape"!==f.options.type&&"Drawing"!==f.options.type)&&f.getRelationID()&&d.instances.push({instance:f.getRelationID(),nodePath:f.getOccurencePath(),hasPositioningMatrix:e})}if(d.instances.length){!0&&(o.prepareUpdate(),i.newParams={instances:d.instances},s.move3D(d))}}}))}})})),define("DS/ENOPAD_v2/models/mixins/PADDocBasics",["DS/ENOXParser/modules/common/Constants","DS/ENOPAD_v2/models/_PADModelParser","DS/ENOXParser/modules/ClientDataParser","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSession","DS/PADUtils/PADWSAccess","DS/PADUtils/PADPredicatesNls","DS/PADUtils/PADUtilsServices","DS/PADUtils/views/PADAlert","DS/PADUtils/utilsWS/WSUtils","DS/ENXNav/utils/TwoDAppEvents","DS/PADServices/utils/CompassUtils","DS/PADServices/utils/AttributesMgtV2","DS/ENOXParser/ParserCV","DS/ENOXParser/modules/PADParserOcc","DS/ENXNav/models/xNavNodeModel","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADServices/utils/Generics"],(function(e,t,n,i,o,s,r,a,d,l,c,u,p,g,h,f,D,v,m){function P(){}return P.prototype={broadcastSelect:function(e){this._broadcastSelect=e,!0===this._broadcastSelect&&!0===this.options.authorize_setStructure&&(u.setObject({nodes:this.getSelectedNodes()}),this.setTypesForOFW())},setDnDBehavior:function(e){this._copyMode=e},setConfirmdDialog:function(e){this._confirmDialog=e},setCuttingNodes:function(e){this._active_cutting_nodes=e},instantiate:function(t,n,i){let s=t.updatePids||[];console.log("updatePids=",s);var r=t.instanceName?t.instanceName:"",a=i?i.newRelationIDs:[],d=i?i.tgtParentIds:[],l=i?i.removedNodeIds:[],c={},u=n||[],p=t.node,g=t.parent,h=t.behavior,D=t.newRelationID,m=t.ordering,P=g.getID(),_=UWA.clone(p.options,!1);let A="MOVE"===t.behavior;"COPY"===t.behavior&&(_.childComputed=!1);var S=UWA.clone(p.options.grid,!1);_.grid=S,A&&!_.children&&(_.children=[],_.childComputed=!1);var b=p.getRelationID(),I=p.options.relationtype,N=!Boolean(b);let E=p.getRealParent();var y=E?E.getID():"",x=this.getRoots(),C=!1,O=this;!!!m&&N||"COPY"===h||(x.forEach((function(e){var t=[];u&&0!==u.length?-1!==u.indexOf(e.getID())||y&&-1!==u.indexOf(y)?t=e.getNodesByRelId(b):d.length>0?-1===d.indexOf(e.getID())&&(a.length>0?-1===a.indexOf(b)&&(t=e.getNodesByRelId(b)):t=e.getNodesByRelId(b)):t=e.getNodesByRelId(b):t=e.getNodesByRelId(b),t.length>0&&t.forEach((function(e){var t=e.getRealParent();e.isRoot()||(u&&0!==u.length?-1!==u.indexOf(t.getID())&&e.remove():e.remove())}))})),p.setRelationID(D,I));var w=function(t,n,i){if(n&&n.before&&""!==n.before){var o,s=t.getChildren();for(o=0;o<s.length;o++){var r=s[o];if(r.options.relationid===n.before){try{t.insertBefore(i,r),C=!0}catch(e){throw console.log(e),e}break}}}UWA.is(t.options.relcount,"number")||(t.options.relcount=0),t.options.relcount=t.options.relcount+1,C||t.addChild(i),A&&t.setState(e.NODE_STATES.PARTIALLY_EXPANDED)};x.forEach((function(e){N&&l.length>0&&-1!==l.indexOf(e.getID())&&(c[e.getID()]=!0);var n=e.getNodesById(P);n&&0!==n.length&&n.forEach((function(e){if(e===g||e.isExpanded()||null===e.options.children||0===e.options.children.length){if(N||"COPY"===h||e!==g){var n=UWA.clone(p.options,!1);("COPY"===t.behavior||A)&&(n.childComputed=!1);var i=UWA.clone(p.options.grid,!1);(UWA.is(n.relcount,"number")&&n.relcount>0||UWA.is(n.children,"array")&&n.children.length>0)&&(n.children=[]),(u&&-1===u.indexOf(e.getID())||"COPY"===h)&&(i.CurrentEvolutionEffectivity="",i.Effectivity="",i.ProjectedEvolutionEffectivity="",i.VariantEffectivity=""),r&&(i.instanceName=r),n.grid=UWA.clone(i,!1);var o=new f(n),s=n.relationtype;(N||"COPY"===h||d&&d.length>1)&&o.setRelationID(D,s),w(e,m,o)}else if(d&&d.length>1){var a=UWA.clone(_,!1),l=O.createNodeModel(a),c=p.options.relationtype;l.setRelationID(D,c),w(e,m,l)}else w(e,m,p);e.isExpanded()||e.options.padstate&&"partiallyExpanded"===e.options.padstate||(e.setState({state:"partiallyExpanded"}),e.options.padstate="partiallyExpanded")}else console.log("**3 =========",e)}))})),g.isExpanded()||g.options.padstate&&"partiallyExpanded"===g.options.padstate||(g.setState({state:"partiallyExpanded"}),g.options.padstate="partiallyExpanded"),o.setAuthoringState(!0,v.PADSession_disabling_index_authoring),N&&"COPY"!==h&&(0===l.length||c[p.getID()])&&this.removeRoot(p),this.invalidateViewPort(),s.length&&O.refreshNodeById({modified:s})},_distinguishInsertReparentCases:function(e){var t={insertExisting:[],reparent:[]};let n="COPY"===this._copyMode;e.reduce(((e,t)=>(t.isRoot()||n?e.insertExisting.push(t):e.reparent.push(t),e)),t);return t},_inputData:function(e,t){var n=[];return e.forEach((function(e){n.push(e.getOccurencePath())})),{children:n,parents:[t.getOccurencePath()],commit:!0}},_onInsert:function(e,t,o){var s=this._copyMode;"function"==typeof t.getID&&t.getID();var r=this;function a(e,t,n){var i;for(i=0;i<e.length;i++){var o=e[i];let s=o.options;if(s.resourceid===t&&s.relationid===n)return o}return null}function l(e){if(r._endBlockingTransaction(),e&&UWA.is(e.messages,"array")){var t=[];e.messages.forEach((function(e){-1===t.indexOf(e)&&t.push(e)})),d.displayNotification({msg:t.join(""),eventID:"error"})}r.dropInvitContainer&&r.dropInvitContainer.hide()}function u(e){if(r._endBlockingTransaction(),e&&UWA.is(e.messages,"array")){var t=[];e.messages.forEach((function(e){-1===t.indexOf(e)&&t.push(e)})),d.displayNotification({msg:t.join(""),eventID:"error"})}}var g=r._distinguishInsertReparentCases(e);return g.insertExisting.length>0&&(this._beginBlockingTransaction(D.inserting_nodes),this._triggerInsertExisting({mode:"CopyPaste",data:r._inputData(g.insertExisting,t),successCallback:function(u){var g;let h=[],f=[],v=(r.options.context,i.getSetting("activateFUN153004")),m=i.getSetting("lockControlByAdmin"),P=!!p.getColumn("ds6w:reserved-Instance");for(g=0;g<u.length;g++){var _=u[g].relationid,A=u[g].resourceid;let i=u[g].originalRelationid;var S=a(e,A,i),b=u[g].instanceName||"";let d=u[g].clientTaskData,p=A;if((S&&S._options.grid["positionMatrix-Instance"]||t&&t._options.grid["positionMatrix-Instance"])&&f.push(p),!0===v&&m&&S&&!1===f.includes(p)&&!0===P&&f.push(p),!S)return void l();d&&new n(d).appendPids(h);var I={node:S,parent:t,next:o,behavior:s,newRelationID:_,instanceName:b},N=(S.getID(),t.getID()),E=S.getRelationID(),y=!Boolean(E);r._endBlockingTransaction(),r.wrapInTransaction((function(){r.withTransactionUpdate((function(){r.instantiate(I);var e={transactions:[]},t=r.getNodesByRelId(_)[0].getOccurencePath();y||"COPY"===s?e.transactions.push({insertExisting:{modified:[N],inserted:[t],created:[_],withContext:!y}}):e.transactions.push({reParent:{modified:[N],inserted:[t],created:[_],deleted:[E]}}),r._getCmdProxyPtr().padRefresh(e),c.addChild()}),r)}))}h.length&&r.refreshNodeById({modified:h}),f&&f.length&&r.refreshNodeById({modified:f}),d.displayNotification({msg:D.insert_existing_succeeded,eventID:"info"})},failureCallback:l})),g.reparent.length>0&&(this._beginBlockingTransaction(D.reparenting),this._triggerInsertExisting({mode:"CutPaste",data:r._inputData(g.reparent,t),successCallback:function(l){var g;let h=[],f=[],m=(r.options.context,i.getSetting("activateFUN153004")),P=i.getSetting("lockControlByAdmin"),_=!!p.getColumn("ds6w:reserved-Instance");for(g=0;g<l.length;g++){var A=l[g].relationid,S=l[g].resourceid;let i=l[g].originalRelationid;var b=a(e,S,i),I=l[g].instanceName||"";let p=l[g].clientTaskData,C=S;if((b&&b._options.grid["positionMatrix-Instance"]||t&&t._options.grid["positionMatrix-Instance"])&&f.push(C),!0===m&&P&&b&&!1===f.includes(C)&&!0===_&&f.push(C),p&&new n(p).appendPids(h),!b)return void u();try{var N={node:b,parent:t,next:o,behavior:s,newRelationID:A,instanceName:I},E=(b.getID(),t.getID()),y=b.getRelationID(),x=!Boolean(y);r._endBlockingTransaction(),r.wrapInTransaction((function(){r.withTransactionUpdate((function(){r.instantiate(N);var e={transactions:[]},t=r.getNodesByRelId(A)[0].getOccurencePath();x?e.transactions.push({insertExisting:{modified:[E],inserted:[t],created:[A],withContext:!x}}):e.transactions.push({reParent:{modified:[E],inserted:[t],created:[A],deleted:[y]}}),r._commandProxy.padRefresh(e),c.addChild()}),r),d.displayNotification({msg:D.reparent_succeeded,eventID:"info"})}))}catch(e){r._endBlockingTransaction(),d.displayNotification({msg:v.generic_service_failure,eventID:"error"})}}h.length&&r.refreshNodeById({modified:h}),f&&f.length&&r.refreshNodeById({modified:f})},failureCallback:u})),!1},_triggerInsertExisting:function(e){require(["DS/ApplicationFrame/CommandsManager"],(function(t){t.getCommand("InsertExisting").execute({mode:e.mode,internal_call:!0,data:e.data,onSuccess:e.successCallback,onFailure:e.failureCallback})}))},getOrdering:function(e){var t={};if(!e)return ordering;var n,i,o,s=-1,r=-1,a=-1;return e.forEach((function(e){var d={};(n=e.getParent().getChildren())&&n.length>1&&((s=n.indexOf(e))>-1&&(r=s-1,a=s+1),o=n[r],i=n[a],d.after=o?o.getRelationID():"",d.before=i?i.getRelationID():"",t[e.getRelationID()]=d)})),t},getFetches:function(e){var t=UWA.clone(e,!1);return t.cbOnProcess=function(e,t){var n={intent:"explore_2D",debug:i.getSetting("enopad_webapis_debug")},o={enopad_webapis:i.getSetting("enopad_webapis"),data:n,pids:t,onComplete:function(n){var i="string"==typeof n?JSON.parse(n):n;if(i.results)for(var o=0,s=i.results.length;o<s;o++){var r=i.results[o];e.setAnswer(t[o],r)}else console.log("handle error in the future")},onFailure:function(t,n){console.log("getFetches.onFailure"),e.reprocess()}};return s.fetch(o)},new l.MassChunkedRequests(t)},getNavigates:function(e){var t=UWA.clone(e,!1);return t.cbOnProcess=function(e,t){if(t&&t.length>0){var n=UWA.extend({root_path_physicalid:t,expand_iter:"1",intent:"explore_2D"},i.getWebAPI_Options("navigate"),!0),o={enopad_webapis:i.getSetting("enopad_webapis"),data:n,onComplete:function(n){var i="string"==typeof n?JSON.parse(n):n;i.results?e.setAnswers(t,i.results):console.log("handle error in the future")},onFailure:function(e,t){console.error("getNavigates.onFailure networkError",e),console.error("getNavigates.onFailure serverError ",t)}};return s.navigate(o)}},new l.MassChunkedRequestsLWC(t)},insertNodesSplitFetch:function(e,n){e.toDelete;var o=e.callack,s=e.callback2,r=e.occurencePaths,a=e.parentNodes,l=e.toInsert,u=this,p=[];function g(e){-1===p.indexOf(e.resourceid)&&p.push(e.resourceid),-1===p.indexOf(e.relationid)&&p.push(e.relationid)}var h=[],f={transactions:[]},m=[],P=[],_=[],A={};function S(){d.displayNotification({msg:v.generic_service_failure,eventID:"error"}),u._endBlockingTransaction()}this.wrapInTransaction((function(){var e,n;if(!0===i.getSetting("useLWCWebServices"))!function(){for(var e=Object.keys(l),t=0;t<e.length;t++){var n=e[t];if(UWA.is(l[n],"array")){for(var i={insertExisting:{modified:[],inserted:[],created:[]}},o=l[n],s=0,r=o.length;s<r;s++){var a=o[s],d=[n,a.relationid,a.resourceid];-1===m.indexOf(d)&&(h.push(a.relationid),m.push(d),i.insertExisting.modified.push(n),i.insertExisting.inserted.push(d),i.insertExisting.created.push(a.relationid),i.insertExisting.withContext=!1),A[a.relationid]||(A[a.relationid]=a.ordering)}if(-1===P.indexOf(n)){P.push(n);var c=u.getNodesById(n);c&&(_=_.concat(c))}f.transactions.push(i)}}}(),e=l.noNotification,delete l.noNotification,u._beginBlockingTransaction(D.inserting_nodes),n={chunkSize:1e3,requests:m,cbOnComplete:function(n){var i;try{var l=n.getAnswers(),p=UWA.is(l,"string")?JSON.parse(l):l;p.results&&p.results.length>0&&!p.error?(i=u.startTransaction("expand"),t.process.expand({treedocument:u,response:p,root_nodes:a,occurencePaths:r,pathOrdering:A,expand_level:1,mode:"insert"}),!0!==e&&d.displayNotification({msg:D.insert_existing_succeeded,eventID:"info"}),u._endBlockingTransaction(),u._cmdProxy.padRefresh(f),c.addChild(),o&&o(),s&&s({expandNodeIds:h})):S()}catch(e){S()}finally{i&&i.end()}},cbOnProgress:function(e,t,n){}},u.getNavigates(n);else{for(var v in l)l.hasOwnProperty(v)&&UWA.is(l[v],"array")&&l[v].forEach(g);e=l.noNotification,delete l.noNotification,u._beginBlockingTransaction(D.inserting_nodes),n={chunkSize:30,requests:p,cbOnComplete:function(n){p.length;var i=n.getAnswers(),s=UWA.is(i,"string")?JSON.parse(i):i,r=s.results.length;if(0===r)throw new Error("Cannot find object with the physicalid "+p);if(r!=r)throw new Error("More results than input objects");u.invalidateViewPort(),u.wrapInTransaction((function(){var e=t.process.insert_nodes({treedocument:u,response:s,insert_parameters:l});u._commandProxy.padRefresh(e),c.addChild()}),"insert_nodes"),u._endBlockingTransaction(),o&&o(),!0!==e&&d.displayNotification({msg:D.insert_existing_succeeded,eventID:"info"})},cbOnProgress:function(e,t,n){}},u.getFetches(n)}}))},updateInstance:function(e){e.isOccModel?this.updateInstanceOcc(e):this.updateInstanceV1(e)},updateInstanceOcc:function(e){var t=this;let n={paths:e.occurencePaths,callback:function(n,i){if(n.success&&i.json){let n=i.json.results;e.results=[],n.forEach((t=>{let n=!(!t.from||!t.to)||void 0,i=g.parseNodeOptions_V2({node:t},n);e.results.push(i)})),e.treeDoc=t,h.parseUpdateInstance(e)}}};this.addPaths(n)},updateInstanceV1:function(e){var n=this,o=[],r=e.occurencePaths;r&&(o=r),o&&o.length&&(this.wrapInTransaction((function(){var a=UWA.extend({root_path_physicalid:o,expand_iter:"0",intent:"explore_2D"},i.getWebAPI_Options("navigate"),!0);s.navigate({enopad_webapis:i.getSetting("enopad_webapis"),data:a,onComplete:function(i){var o;try{var s=UWA.is(i,"string")?JSON.parse(i):i;s.results&&s.results.length&&(s.error?(console.error("ws-navigate",s.error),e.editCfg&&(console.time("partial_update_instances"),t.update_instances({treedocument:n,response:s,occurencePaths:r,newRelIds:e.newRelIds,editCfg:e.editCfg}))):(o=n.startTransaction("update"),t.update_instances({treedocument:n,response:s,occurencePaths:r,newRelIds:e.newRelIds,editCfg:e.editCfg||!1})))}catch(e){console.error("updateInstance:",e)}finally{o&&o.end()}},onFailure:function(e){console.error("ws navigate ",e)}})})),e.expandStates&&e.expandStates.length&&e.expandStates.forEach((function(e){r&&r.forEach((function(t){var i=n.getNodeByOccurencePath(t);if(i&&!i.isExpanded()){var o={numberOfLevelsToExpand:e};i.expandNLevels(o)}}))})))},updateRevision:function(e){if(e.updateRevision=e.operations&&"updateRevision"==e.action?e.operations:void 0,m.checks.array(e.updateRevision))for(let t=0;t<e.updateRevision.length;t++){let n=e.updateRevision[t];if(n.existing&&n.new&&n.newRevison){let e=this.getNodesById(n.existing)[0];if(e){let t={grid:{"ds6w:isLastRevision":"FALSE"}};this.withTransactionUpdate((function(){e.updateOptions(t)}))}}}},_compositeOrder:function(e,t,n,i){var o=null;o="function"==typeof t.getID?t.getID():t.options.resourceid;var s,r=e.getRelationID(),a=!r,l=this._copyMode,u=this;function p(i){try{UWA.is(i)&&UWA.is(i,"array")&&i.length>0&&(i=i[0].relationid,console.log("from object newRelationID=",i)),console.log("newRelationID=>",i);var o={node:e,parent:t,behavior:l,newRelationID:i,ordering:n},s=(e.getID(),t.getID()),r=e.getRelationID(),a=!Boolean(r);u._endBlockingTransaction(),u.wrapInTransaction((function(){u.withTransactionUpdate((function(){u.instantiate(o);var e={transactions:[]},t=u.getNodesByRelId(i)[0].getOccurencePath();a||"COPY"===l?e.transactions.push({insertExisting:{modified:[s],inserted:[t],created:[i],withContext:!a}}):e.transactions.push({reParent:{modified:[s],inserted:[t],created:[i],deleted:[r]}}),u._commandProxy.padRefresh(e),c.addChild()}),u)}))}catch(e){u._endBlockingTransaction(),d.displayNotification({msg:v.generic_service_failure,eventID:"error"})}}function g(e){u._endBlockingTransaction(),e&&UWA.is(e.messages,"array")&&e.messages.forEach((function(e){d.displayNotification({msg:e,eventID:"error"})}))}if(a||"COPY"===l)s={children:[e.getOccurencePath()],parents:[t.getOccurencePath()],ordering:n,commit:!0},this._beginBlockingTransaction(D.inserting_nodes),require(["DS/ApplicationFrame/CommandsManager"],(function(e){e.getCommand("InsertExisting").execute({mode:"CopyPaste",internal_call:!0,data:s,onSuccess:p,onFailure:g})}));else if(null==i||0==i.length)s={children:[e.getOccurencePath()],parents:[t.getOccurencePath()],ordering:n,commit:!0},this._beginBlockingTransaction(D.reparenting),require(["DS/ApplicationFrame/CommandsManager"],(function(e){e.getCommand("InsertExisting").execute({mode:"CutPaste",internal_call:!0,data:s,onSuccess:p,onFailure:g})}));else{var h={version:"1.0",order:{type:"RTInstance",count:i.length,children:i}};require(["DS/AuthGenericCommands/AuthGenericCmdWSAccess"],(function(e){e.reorder({data:h,modeler:"product",optionalURL:o,onComplete:function(e){"success"===(UWA.is(e,"string")?JSON.parse(e):e).status&&(console.log("reorder successful",e),p(r))},onFailure:function(e){console.warn("reorder_error",h),g(e)}})}))}},_beginBlockingTransaction:function(e){this.getModelEvents().publish({event:"beginBlockingTransaction",data:e,context:this})},_endBlockingTransaction:function(){this.getModelEvents().publish({event:"endBlockingTransaction",context:this})},_triggerTitleUpdate:function(){var e=this.getRoots();this.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.length,added_node:e[e.length-1]}})},isEditor:function(){return!0}},P})),define("DS/ENOPAD_v2/models/PADDocOcc",["DS/ENXNav/models/xNavTreeDocOcc","DS/PADUtils/PADSettingsMgt","DS/ENOPAD_v2/models/mixins/PADDocAddAndAddPaths","DS/ENOPAD_v2/models/mixins/PADDocExpand","DS/ENOPAD_v2/models/mixins/PADDocRefreshOcc","DS/ENOPAD_v2/models/mixins/PADDocEndPoints","DS/ENOPAD_v2/models/mixins/PADDocBasics","DS/ENOPAD_v2/models/mixins/PADDocInsertsOcc","DS/ENOPAD_v2/models/mixins/PADDocReplace","DS/ENOPAD_v2/models/mixins/PADDocProxy","DS/ENOPAD_v2/models/mixins/PADDocCfgHook","DS/ENOPAD_v2/models/mixins/PADDocOccExcludesDisabled","DS/ENOPAD_v2/models/mixins/PADDocProductToPartOcc"],(function(e,t,n,i,o,s,r,a,d,l,c,u,p){function g(){}return g.prototype=Object.assign(g.prototype,n.prototype,i.prototype,o.prototype,s.prototype,r.prototype,a.prototype,d.prototype,l.prototype,c.prototype,u.prototype,p.prototype),e.extend(g,{_active_cutting_nodes:[],init:function(e){!0!==t.getSetting("activateEditInTable")||e.shouldBeEditable||(e.shouldBeSelected=function(e){return!e.ghostMode}),this._parent(e),this._commandProxy=this._cmdProxy,this._appendToCommandProxy(),this.subscribeToCfgHook()}})})),define("DS/ENOPAD_v2/mixins/_PADDnD",["DS/ENXNav/mixins/_xNavDnD","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADWSAccess","DS/PADUtils/views/PADAlert","DS/ENOPAD_v2/views/PADDropConfirm","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADSettingsMgt","DS/PADUtils/Utility","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/Storage","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],(function(e,t,n,i,o,s,r,a,d,l,c,u){"use strict";const p=l.local.get("PSE.debug.dnd");function g(e){this._name=e,console.group(this._name)}return g.prototype={end:function(){console.groupCollapsed(this._name)}},e.extend({shouldAcceptDnDDrop:function(e,t,n,i){if(!0===i.isRoot){var o={shiftKey:2===i.modifiers};this._add_drop_invite(o),this.options.dndLA&&this.dropInvitContainer&&this.dropInvitContainer.hide("insert")}else this.dropInvitContainer.show("insert");return!0},doDnDDrop:function(e,n,s,r){if(console.log("donDnDDrop called!"),p){let t=new g("graphview");console.log("dataTransfer",e),console.log("parent",n),console.log("next",s),console.log("next",r),t.end()}var a={dataTransfer:e},d=this,l=d._parent;t.retrieveDroppedDataAsync(a,(function(a){var p=!0,g=!1;s&&s._parentNode&&n&&s._parentNode.options.resourceid===n.options.resourceid&&(g=!0);var h=!1;t.getWidgetId()===a.unserializedData.widgetId&&(h=!0,p=!1);var f=function(t){if(t){var o,c=!1;if(a.unserializedData.data.items.forEach((function(e){if(n){var t=n.options.resourceid;if(e.path)for(var i=0;i<e.path.length;i++)if(t===e.path[i].resourceid){c=!0;break}}})),r.isRoot||c&&!h)e.params=a,d._parent=l,d._parent(e,n,s,r);else a.authorized_objects&&a.authorized_objects.length>0?s&&s._parentNode&&n&&s._parentNode.options.resourceid===n.options.resourceid?(o={dropInfos:{nodeModel:s,dropPosition:"top"},dropped_data:a.authorized_objects,source_data:a.source_data},1===a.authorized_objects.length?(console.log("doDnDdrop ->",o),d._dropOnCellCompositeOrder(o)):(i.displayNotification({msg:u.multi_reordering,eventID:"warning"}),d.dropInvitContainer&&d.dropInvitContainer.hide())):(o={dropInfos:{nodeModel:n},dropped_data:a.authorized_objects,source_data:a.source_data},d._dropOnTreeColumn(o)):d.dropInvitContainer&&d.dropInvitContainer.hide()}else d.dropInvitContainer&&d.dropInvitContainer.hide()};if(!0===d.getEditMode()||r.isRoot){var D=d.getPADTreeDocument(),v=D._confirmDialog||!1;if(r.isRoot&&(v=!1),v){var m=D._copyMode,P=u.all_selected_objects,_=a.authorized_objects;if(_&&1===_.length&&(P=_[0].displayName),0!==_.length){var A=n.options.label||n.options.display;new o({copyMode:m,isReordering:g,isOutsideWidget:p,dropName:P,targetName:A,callback:f})}else d.dropInvitContainer&&d.dropInvitContainer.hide()}else f(!0)}else i.displayNotification({msg:c.editmodedeactivated,eventID:"info"})}))},onDragOverCell:function(e,t){if(p){let n=new g("odOverCell");console.log("e",e),console.log("dropInfos",t),console.log("dropInfos.nodeModel",t.nodeModel),console.log("e.dataTransfer",e.dataTransfer),n.end()}if(t&&t.nodeModel&&(t.nodeModel.isRelationsObjectGroupingNode||t.nodeModel.isRelationsObjectNode))return e.dataTransfer?(e.dataTransfer.dropEffect="none",e.preventDefault(),!1):void 0;if(this.features.bsdIntegration&&this.features.bsdIntegration.isBSDGroupingApplied()){if(this.features.bsdIntegration.dndIsGroupDrop(t.nodeModel))return e.dataTransfer?(e.dataTransfer.dropEffect="none",e.preventDefault(),!1):void 0}return e.dataTransfer&&("copyMove"!==e.dataTransfer.effectAllowed&&"copy"!==e.dataTransfer.effectAllowed||(e.dataTransfer.dropEffect="copy",e.preventDefault())),!!this._isDroppableInBody()&&("find_in_ctx"===t.dataIndex?this.dropInvitContainer.show("find"):this.dropInvitContainer.show("insert"),e.preventDefault(),!0)},onDragStartCell:function(e,t){if(p){let n=new g("odStartCell");console.log("e",e),console.log("dropInfos",t),console.log("dropInfos.draggedNodes",t.draggedNodes),console.log("e.dataTransfer",e.dataTransfer),n.end()}if(this.features.bsdIntegration&&this.features.bsdIntegration.isBSDGroupingApplied())if(this.features.bsdIntegration.dndHasBsdGroups(t.draggedNodes)){if(e.dataTransfer)return e.dataTransfer.dropEffect="none",e.preventDefault(),!1}else this._parent(e,t);else this._parent(e,t)},onDropCell:function(e,n){if(p){let t=new g("onDropCell");console.log("e",e),console.log("dropInfos",n),console.log("dropInfos.nodeModel",n.nodeModel),console.log("dropInfos.draggedNodes",n.draggedNodes),console.log("e.dataTransfer",e.dataTransfer),console.log("e.dataTransfer.getData('text/plain')",e.dataTransfer.getData("text/plain")),t.end()}var d=this,l=[],h=!1,f=!1;if(n.nodeModel.getParent()&&n.nodeModel.getParent().isRelationsObjectNode)return e.dataTransfer.dropEffect="none",e.preventDefault(),!1;if((t.isTouchDevice()||t.isSurface())&&(this._dnd_leaveCell||this._dnd_startCell)&&(this._dnd_leaveCell=!1,this._dnd_startCell=!1,a.elementIsOrIsWithin(e.target,this._dnd_start_target)))return this._dnd_start_target=null,void(this.dropInvitContainer&&this.dropInvitContainer.hide(this.dropInvitContainer.active_invite));if(n.nodeModel&&n.nodeModel.options){var D=n.nodeModel.options.type;if(D&&"Drawing"===D)return i.displayNotification({msg:u.msg_warning_invalid_parent,eventID:"warning"}),this.dropInvitContainer&&this.dropInvitContainer.hide(this.dropInvitContainer.active_invite),!1}if(this.hasActiveDesignExp()&&(n.nodeModel.options.isReadOnly||!n.nodeModel.isRoot()&&n.nodeModel.getPath()[0].options.isReadOnly))return i.displayNotification({msg:u.msg_info_editing_readonlyroots,eventID:"info"}),this.dropInvitContainer&&this.dropInvitContainer.hide(this.dropInvitContainer.active_invite),!1;function v(){return l}n.nodeModel._parentNode&&(f=n.nodeModel._parentNode.options._isTrueRoot||!n.nodeModel._parentNode.options.resourceid);var m="find_in_ctx"===n.dataIndex,P="top"===n.dropPosition||"bottom"===n.dropPosition;return P&&f&&(h=!0),s.retrieveAuthorizedObjects({dnd_event:e,isFindInCtx:m,callback:function(e){var s=function(t){if(t){var o=r.getSetting("x3dPlatformId");if(!P||m){var s=0;if(m){for(s=0;s<e.authorized_objects.length;s++)l.push([e.authorized_objects[s].objectId]);l.length&&(n.nodeModel.options.partialPreExpand=v,n.nodeModel.expand())}else o===(e.authorized_objects[0]?e.authorized_objects[0].envId:"")?d._dropOnTreeColumn({dropped_data:e.authorized_objects,source_data:e.source_data,dropInfos:n}):i.displayNotification({msg:u.Tenant_InsertError,eventID:"error"})}else 1===e.authorized_objects.length?o===e.authorized_objects[0].envId?d._dropOnCellCompositeOrder({dropped_data:e.authorized_objects,source_data:e.source_data,dropInfos:n}):i.displayNotification({msg:u.Tenant_InsertError,eventID:"error"}):(d.getPADTreeDocument()._active_cutting_nodes.length>0&&d.uncut.call(d),0===e.authorized_objects.length?i.displayNotification({msg:u.no_authorized_object,eventID:"warning"}):i.displayNotification({msg:u.multi_reordering,eventID:"warning"}))}};if(!0===d.getEditMode()||m){var a=!0;t.getWidgetId()===e.source_data.widgetId&&(a=!1);var p=d.getPADTreeDocument(),g=p._confirmDialog||!1;if(!m&&g&&!h||!0===e.unsupportedDropNotified){var f=p._copyMode,D=u.all_selected_objects,_=e.authorized_objects,A="";if(_&&1===_.length&&(D=_[0].displayName,A=_[0].objectId),0!==_.length){var S=n.nodeModel.options.label||n.nodeModel.options.display,b=n.nodeModel.options.resourceid;let e="",t="",r="",d=!1;if(r=n.nodeModel.getParent().getID(),n.droppedNodes&&n.droppedNodes[0]&&(e=n.droppedNodes[0].getParent().getID(),t=n.droppedNodes[0].getParent().getLabel()),e!==r&&(d=!0),A===b)i.displayNotification({msg:u.msg_warning_dndnotsupported,eventID:"warning"});else new o({copyMode:f,isReordering:P,isOutsideWidget:a,dropName:D,targetName:S,dropPosition:n.dropPosition,isReparent:d,callback:s})}}else s(!0)}else i.displayNotification({msg:c.editmodedeactivated,eventID:"info"})}}),this.onDragLeaveCell(e),e.preventDefault(),e.stopPropagation(),!1},onDragStartRowHeader:function(e,n){if(p){let t=new g("odStartRowHeader");console.log("e",e),console.log("dndInfos",n),console.log("dndInfos.nodeModel",n.nodeModel),t.end()}var i=n.nodeModel,o=this.options.model.getXSO().get().slice(0);if(o[0]!==i){var s=o.indexOf(i),r=o[0];o[0]=i,o[s]=r}var a=t.dropdata_from_selected_nodes(o);a.fromRowID=n.rowID,a.data.DataGridView_Row_Options={"dswebux/x-datagridview.row.options.label+json":n.nodeModel.options.label,"dswebux/x-datagridview.row.options.icons+json":n.nodeModel.options.icons,"dswebux/x-datagridview.row.options.grid+json":n.nodeModel.options.grid,"dswebux/x-datagridview.row.id+json":n.rowID},e.dataTransfer.setData("text/plain",JSON.stringify(a))},onDropRowHeader:function(e,n){if(console.log("onDropRowHeader called"),p){let t=new g("odDropRowHeader");console.log("e",e),console.log("dropInfos",n),console.log("dropInfos.nodeModel",n.nodeModel),t.end()}var a,d,l,h=this,f=!1,D=!1,v="",m=n.nodeModel.options.resourceid;n.nodeModel._parentNode&&(a=n.nodeModel._parentNode.options.resourceid,D=n.nodeModel._parentNode.options._isTrueRoot||!n.nodeModel._parentNode.options.resourceid),D&&(f=!0);var P=r.getSetting("x3dPlatformId");s.retrieveAuthorizedObjects({dnd_event:e,isFindInCtx:!1,callback:function(e){n.dropPosition="top";var s=e.authorized_objects;if(s&&1===s.length){var r=s[0].path.length;if(r>2&&(d=s[0].path[r-3].resourceid),v=s[0].objectId,l=e.authorized_objects[0].envId,a===d)if(v!==m)if(P===l){var p=function(t){t&&(console.log("onDropRowHeader->",n),h._dropOnCellCompositeOrder({dropped_data:e.authorized_objects,source_data:e.source_data,dropInfos:n}))};if(!0===h.getEditMode()){var g=!0;t.getWidgetId()===e.source_data.widgetId&&(g=!1);var D=h.getPADTreeDocument();if(!(D._confirmDialog||!1)||f)p(!0);else{var _=D._copyMode,A=u.all_selected_objects;if(s&&1===s.length&&(A=s[0].displayName,v=s[0].objectId),0!==s.length){var S=n.nodeModel.options.label||n.nodeModel.options.display;new o({copyMode:_,isReordering:!0,isOutsideWidget:g,dropName:A,targetName:S,dropPosition:n.dropPosition,callback:p})}}}else i.displayNotification({msg:c.editmodedeactivated,eventID:"info"})}else i.displayNotification({msg:u.Tenant_InsertError,eventID:"error"});else i.displayNotification({msg:u.msg_warning_dndnotsupported,eventID:"warning"});else i.displayNotification({msg:u.msg_warning_dndnotsupported,eventID:"warning"})}else 0===e.authorized_objects.length?i.displayNotification({msg:u.no_authorized_object,eventID:"warning"}):(h.getPADTreeDocument()._active_cutting_nodes.length>0&&h.uncut.call(h),i.displayNotification({msg:u.multi_reordering,eventID:"warning"}))}}),e.preventDefault()},_distinguishInsideOutsideCases:function(e){var n={insideView:[],outsideView:[]},i=this.getPADTreeDocument(),o=i.getSelectedNodes();if(e.dropped_data.forEach((function(o){var s=o.path;if(s&&s.length>0&&UWA.is(s[0],"object")){var r=[];s.forEach((function(e){r.push(e.resourceid)})),s=r}var a=s?i.getNodeByOccurencePath(s):null;a&&e.source_data&&t.getWidgetId()===e.source_data.widgetId?n.insideView.push(a):n.outsideView.push(o)})),o.length>1&&n.insideView.length===o.length&&(n.insideView=o),e.dropInfos.droppedNodes){let t=e.dropInfos.droppedNodes;n.insideView.sort((function(e,n){let i=t.indexOf(e),o=t.indexOf(n);return i>o?1:i<o?-1:0}))}return n},_handleNodeNotInView:function(e,t,n){var i;i=UWA.is(e.path)?e.path.map((function(e){return e.resourceid?e.resourceid:e})):[e.objectId],n&&n.options._isTrueRoot?treeDocument.add({pids:[i],callback:function(){}}):t.push(i)},_handleNodesNotInView:function(e,t){var n=this,o=[];function s(e){var i,o={},s=t.getID();for(o[s]=[],i=0;i<e.length;i++){var r=e[i].relationid,a=e[i].resourceid;let t=e[i].clientTaskData;o[s].push({resourceid:a,relationid:r,clientTaskData:t})}n.insertNodes(o)}function r(e){if(n.getPADTreeDocument()._endBlockingTransaction(),e&&UWA.is(e.messages,"array")){var t=[];e.messages.forEach((function(e){-1===t.indexOf(e)&&t.push(e)})),i.displayNotification({msg:t.join(""),eventID:"error"})}n.dropInvitContainer&&n.dropInvitContainer.hide()}if(e.forEach((function(e){n._handleNodeNotInView(e,o,t)})),o.length>0){var a={parents:[t.getOccurencePath()],children:o,commit:!0};n.getPADTreeDocument()._beginBlockingTransaction(c.inserting_nodes),require(["DS/ApplicationFrame/CommandsManager"],(function(e){e.getCommand("InsertExisting").execute({mode:"CopyPaste",internal_call:!0,scenario:"externalDnD",data:a,onSuccess:s,onFailure:r})}))}},_dropOnTreeColumn:function(e){console.log("_dropOnTreeColumn called");var t=this,n=t.getPADTreeDocument();e.dropInfos;let i=this.features.bsdIntegration,o=i&&i.isBSDGroupingApplied();n._active_cutting_nodes.length>0&&t.uncut.call(this);var s=t._distinguishInsideOutsideCases(e);if(s.insideView.length>0)if(o){let t={nodes:s.insideView,target:e.dropInfos.nodeModel,isMove:"MOVE"===n._copyMode,isCopy:"COPY"===n._copyMode};i.dndCheckReassign(t)&&i.dndQueueReassign(t),n._onInsert(s.insideView,e.dropInfos.nodeModel,null)}else n._onInsert(s.insideView,e.dropInfos.nodeModel,null);if(s.outsideView.length>0)if(o)i.displayNoExternalDropMessage();else{var r=e.dropInfos.nodeModel;t._handleNodesNotInView(s.outsideView,r)}t.dropInvitContainer&&t.dropInvitContainer.hide()},_handleNodesNotInViewOrder:function(e,t,n){var o=this,s=[];function r(e){var i,s={},r=t.getID();for(s[r]=[],i=0;i<e.length;i++){var a=e[i].relationid,d=e[i].resourceid;let t=e[i].clientTaskData;s[r].push({resourceid:d,relationid:a,ordering:n,clientTaskData:t})}o.insertNodes(s)}function a(e){if(o.getPADTreeDocument()._endBlockingTransaction(),e&&UWA.is(e.messages,"array")){var t=[];e.messages.forEach((function(e){-1===t.indexOf(e)&&t.push(e)})),i.displayNotification({msg:t.join(""),eventID:"error"})}o.dropInvitContainer&&o.dropInvitContainer.hide()}if(e.forEach((function(e){o._handleNodeNotInView(e,s,null)})),s.length>0){var d={parents:[t.getOccurencePath()],children:s,ordering:n,commit:!0};o.getPADTreeDocument()._beginBlockingTransaction(c.inserting_nodes),require(["DS/ApplicationFrame/CommandsManager"],(function(e){e.getCommand("InsertExisting").execute({mode:"CopyPaste",internal_call:!0,scenario:"externalDnD",data:d,onSuccess:r,onFailure:a})}))}},_dropOnCellCompositeOrder:function(e){function t(e,t,n){console.log("fromIndex=",t),console.log("toIndex=",n);const i=e.splice(t,1)[0];return e.splice(n,0,i),e}var n=this;n.getPADTreeDocument()._active_cutting_nodes.length>0&&n.uncut.call(this);let o="",s="",r="",a=!1;if(e.dropInfos&&e.dropInfos.nodeModel){r=e.dropInfos.nodeModel.getParent().getID(),e.dropInfos.droppedNodes&&1==e.dropInfos.droppedNodes.length&&(o=e.dropInfos.droppedNodes[0].getParent().getID(),s=e.dropInfos.droppedNodes[0].getParent().getLabel()),o!==r&&(a=!0),console.log("DnD isDifferentRoot:",a);var d=this.getPADTreeDocument(),l=e.dropped_data[0].path;if(l&&l.length>0&&UWA.is(l[0],"object")){var c=[];l.forEach((function(e){e.resourceid&&c.push(e.resourceid)})),l=c}var p=l?d.getNodeByOccurencePath(l):null,g=e.dropInfos.nodeModel._parentNode,h={};if(g&&!g.options._isTrueRoot){var f=e.dropInfos.nodeModel.getRelationID(),D=g.getChildren().indexOf(e.dropInfos.nodeModel);let o=e.dropInfos.nodeModel;o.getLabel(),o.getID(),o.options.relationOrder;var v,m,P=-1,_=-1;D>-1&&(P=D,_=D);var A=g.getChildren();let s=[];const r=new Map;if(Array.isArray(A))for(const e of A){let t=e.getRelationID(),n=e.getLabel();console.log(n+" - "+t),t&&(r.set(t,n),s.push(t))}const l=s.slice();let c="",b="";if(p&&(c=p.getRelationID(),b=l.indexOf(c)),"top"===e.dropInfos.dropPosition?(m=A?A[P-1]:null,!f&&p&&g.insertBefore(p,e.dropInfos.nodeModel),h.before=f,h.after=m?m.getRelationID():"",b&&(s=t(l,b,P))):"bottom"===e.dropInfos.dropPosition?(v=A?A[_+1]:null,!f&&p&&g.addChild(p,g.getChildren().indexOf(e.dropInfos.nodeModel)+1),h.after=f,h.before=v?v.getRelationID():"",b&&(s=t(l,b,_))):i.displayNotification({msg:u.drop_between_lines,eventID:"warning"}),f)if(p)if(a)d._compositeOrder(p,g,h);else{if(s.length<10){console.log("reordering:");for(const e of s)console.log(r.get(e))}d._compositeOrder(p,g,h,s)}else{var S=n._distinguishInsideOutsideCases(e);S.outsideView.length>0&&n._handleNodesNotInViewOrder(S.outsideView,g,h)}}else i.displayNotification({msg:u.drop_between_lines,eventID:"warning"});n.dropInvitContainer&&n.dropInvitContainer.hide()}}})})),define("DS/ENOPAD_v2/PADComponent",["i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","DS/ENXNav/XNavComponent","DS/PADUtils/PADSession","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/ENOPAD_v2/mixins/_PADCCP","DS/ENOPAD_v2/mixins/_PADFolder","DS/ENOPAD_v2/mixins/_PADDnD","DS/ENOPAD_v2/mixins/_PADRefresh","DS/ENOPAD_v2/mixins/PlmNew","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/ENOPAD_v2/features/BSDIntegration","DS/ENOPAD_v2/features/AutoSwitchAuthoringToIndex","DS/ENOPAD_v2/features/MaturityAndLockAtCreation"],(function(e,t,n,i,o,s,r,a,d,l,c,u,p,g,h,f){"use strict";return n.softInit(),t.extend(o,s,r,a,d,{name:"pad_component",init:function(e){var t,n,i=(t=e,(n={x3dAppId:"ENOPAD",widget:widget,amd_custo:{TileGridView:"DS/ENXNav/views/xNavResponsiveTilesView",ThumbnailGridView:"DS/ENXNav/views/xNavResponsiveThumbnailsView",DataGridView:"DS/ENXNav/views/xNavDataGridView"},layout:{}}).layout=UWA.clone(t.layout_opts),delete(n=UWA.extend(n,t,!0)).layout_opts,n),o=Promise.resolve();i.configuration&&!0===i.configuration.dynamicCtxActivated&&(o=new Promise((function(e){require(["DS/ENOPAD_v2/utils/PADCtxMenuUtilsV2"],e)}))),this.staticMappingEnabled=c.getSetting("staticMappingServer"),(c.getSetting("grpBSD")||"true"===u.getURLParameter("grpBSD"))&&(this.features||(this.features={}),this.features.bsdIntegration=new g({context:this})),(c.getSetting("activateAutoSwitchAuthoringToIndex")||"true"===u.getURLParameter("activateAutoSwitchAuthoringToIndex"))&&(this.features||(this.features={}),this.features.autoSwitchAuthoringToIndex=new h({context:this})),c.getSetting("activate_FUN141510")&&(this.features||(this.features={}),this.features.maturityAndLockAtCreation=new f({context:this})),(c.getSetting("activateMePref")||"true"===u.getURLParameter("activateMePref"))&&(p.subscribe({event:"DS/ENXViews/SwitchTableView"},this._switchTableView.bind(this)),p.subscribe({event:"ENXViews/DGV/store"},this._storeTablePrefs.bind(this)),p.subscribe({event:"DS/ENXViews/reapplyView"},this._reapplyTableView.bind(this)));var s=this._parent.bind(this);let r=e.isPlmNew?(a=this,new Promise((function(e,t){require(["DS/ENONewWidget/command/NewContentAppOptions"],(function(t){t.setAppContext(a),e()}),e)}))):Promise.resolve();var a;o.then(function(){this.setFolderCommunicationChannel(),r.then((function(){require(["UWA/Utils/Client"],(function(t){!1!==i.layout.action_bar&&(e.settings.action_bar.touch&&e.settings.action_bar.standard?i.action_bar_opts=t.Features.touchEvents&&!t.Features.pointerEvents?e.settings.action_bar.touch:e.settings.action_bar.standard:i.action_bar_opts=e.settings.action_bar,i.action_bar_opts.language=e.lang),s(i)}))}))}.bind(this))},_reapplyTableView:function(t){this._storeTablePrefs(null),this.beginBlockingTransaction(e.switchingTableView);let n=this;require("DS/PADServices/utils/AttributesMgtV2").initializeFromMePrefEditor({mePrefsData:this.options.mePrefTableCusto,custoView:null,activeView:this.options.activeTableView}).then((()=>{n.updateTableView(n.options.activeTableView).then((()=>{n.endBlockingTransaction(),n.refresh()}))}))},_switchTableView:function(t){if(this.beginBlockingTransaction(e.switchingTableView),!0===t.updateActiveView){this.options.activeTableView=t.view,this.options.widget.setValue("Editor_Active_TableView",t.view)}let n=this;p.subscribeOnce({event:"App/Editor/requestView/response"},(function(e){let t=e;t&&t.currentTableView!==e.view&&(t=void 0),require("DS/PADServices/utils/AttributesMgtV2").initializeFromMePrefEditor({mePrefsData:n.options.mePrefTableCusto,custoView:t,activeView:n.options.activeTableView}).then((()=>{n.updateTableView(n.options.activeTableView).then((()=>{n.endBlockingTransaction(),n.refresh()}))}))})),p.publish({event:"App/Editor/requestView"})},_storeTablePrefs:function(e){if(e){e.currentTableView=this.options.activeTableView;let t,n=this.options.mePrefTableCusto;if("ENO2D_DEFAULT"===this.options.activeTableView)t=n.default.ENO2D_VIEW_TS;else{let e=n.views.find((e=>e.ENO2D_VIEW_NAME===this.options.activeTableView));t=e?e.ENO2D_VIEW_TS:void 0}t&&(e.tableViewTS=t)}p.publish({event:"App/Editor/saveView",data:e}),this.options.widget.deleteValue("ap_custo")},displayConfirmationOnRemove:function(){var e=require("DS/PADUtils/PADSettingsMgt");return e.getSetting("addRemoveMessagePreference")?e.getSetting("displayConfirmationOnRemove"):void 0},getPADTreeListView:function(){return this.options.views.treelistview},getPADDGVView:function(){return this.options.views.datagridview},getPADTreeGraph:function(){return this.options?this.options.views.graphview:null},getEditMode:function(){return require("DS/PADUtils/PADSettingsMgt").getSetting("EditModeActivated")},setEditMode:function(e){require("DS/PADUtils/PADSettingsMgt").setSetting("EditModeActivated",e,!0),this.dispatchEvent("editModeModified",e)},add:function(e,t,n){e.content||(e.content="idslist"),void 0===t&&e.callback&&(t=e.callback),void 0===n&&(n=e.broadcast),e.callback=function(e,n){t&&t(e,n)},e.broadcast=n,this._parent(e)},getOrdering:function(e){return this.options.model.getOrdering(e)},replaceNodes:function(e){let t=this.options.model;t.isOccModel?t.replaceNodesOcc(e):this.replaceNodesV1(e)},replaceNodesV1:function(e){console.time("replaceNodes");var t=this,n=[],i={},o=[],s=[];let r=!(!e.toInsert||!e.toInsert.isProdConfig);function a(e){if(!e.hasChildren())return e.getDepth();var t=1;return e.getChildren().forEach((function(e){var n=a(e);n>t&&(t=n)})),t}var d,l,c,u,p;r&&delete e.toInsert.isProdConfig,e.toDelete&&(e.toDelete.forEach((function(e){n.push(e.physicalid)})),d=e.toDelete,p=0,d.forEach((function(e){(l=t.getPADTreeDocument().getNodesByRelId(e.physicalid))&&l.forEach((function(t){if(t){var n=t.getParent();if(n){s.push(n);var r=n.getOccurencePath();if(r){o.push(r),c=t.isExpanded(),u=t.options.padstate;var d={};c&&(p=a(t)-t.getDepth(),p=parseInt(p),e.newrelid&&(d[e.newrelid]={isExpanded:c,padState:u,expandLevel:p},r=r.join("_"),i[r]?i[r].push(d):i[r]=[d]))}}}}))})));var g={};e.callack=function(){g.detach={deleted:n},t._commandProxy.padRefresh(g)},e.callback2=function(o){try{console.timeLog("replaceNodes"),t.processPathExpand(o,i),console.timeEnd("replaceNodes")}catch(e){console.error("error",e)}finally{var s,r;if(n.length>0)for(var a=0;a<n.length;a++)if((s=t.getPADTreeDocument().getNodesByRelId(n[a]))&&s.length>0){r=!0;break}if(r){console.count("needCleanUp");var d={deleted:e.toDelete};t.refreshView(d)}}},e.occurencePaths=o,e.parentNodes=s,r&&this.options.model.bubbleStaticMapMessageOnce(),this.options.model.insertNodesSplitFetch(e)},processPathExpand:function(e,t){var n=this,i=Object.keys(t);if(0!==i.length){var o,s,r,a,d=e.expandNodeIds;if(d&&0!==d.length)d.forEach((function(e){i.forEach((function(i){s=t[i],i=i.split("_"),r=n.getPADTreeDocument().getNodeByOccurencePath(i),s&&r&&s.forEach((function(t){(o=t[e])&&o.isExpanded&&0!==o.expandLevel&&r.getNodesByRelId(e).forEach((function(e){e.isExpanded()||(a={numberOfLevelsToExpand:o.expandLevel},e.expandNLevels(a))}))}))}))}))}},insertNodes:function(e){this.options.model.insertNodes(e);"graphview"===this.options.active_view&&(this.options.views.graphview.reframeAll(),this.dropInvitContainer&&this.dropInvitContainer.hide()),require(["DS/ENXNav/utils/TwoDAppEvents"],(function(e){e.addRoot()}))},author:function(e){n.setAuthoringState(e,i.PADSession_disabling_index_authoring)},setDnDBehavior:function(e){this.options.model.setDnDBehavior(e)},setConfirmdDialog:function(e){this.options.model.setConfirmdDialog(e)},displayNotification:function(e){require(["DS/PADUtils/views/PADAlert"],(function(t){t.displayNotification(e)}))},broadcastSelect:function(e){this.options.model.broadcastSelect(e)},getSelectedNodes:function(){return this.options.model.getSelectedNodes().filter((function(e){return 1!==e.getNodeSource()}))},getActiveView:function(){return this.options?this.options.active_view:"treelistview"},refreshView:function(e){var t,n={updateRevision:[]},i=this,o=Promise.resolve(),s=e.modified;s&&((t={}).modified=s);var r,a,d,c=e.created;c&&(t||(t={}),t.created=[],c.forEach((function(e){if(e.sourceObjectId){e.operation&&"Revise"===e.operation&&(r={existing:e.sourceObjectId,new:e.physicalid,newRevison:"Z.8"},n.updateRevision.push(r));var s=i.getPADTreeDocument().getNodesById(e.sourceObjectId);if(s&&s.length>0)for(var a=0;a<s.length;a++){var d=s[a],c=[];c.push({type:d.options.type}),o=new Promise((n=>{l.isTypesAuthorized(c,(function(i){i.length>0&&-1===t.created.indexOf(e.physicalid)&&t.created.push(e.physicalid),n()}))}))}}else t.created.push(e.physicalid)})));var u=e.deleted;(u&&u.forEach((function(e){var t=e.physicalid,n=i.getPADTreeDocument().getNodesById(t);n&&0!==n.length||(n=i.getPADTreeDocument().getNodesByRelId(t)),n.forEach((function(e){e.isRoot()?(a||(a=[]),a.push(t)):(d||(d=[]),d.push(e))}))})),o.then((function(){t&&(t.created&&t.created.length&&(t.onAddPaths=function(e){i.dispatchEvent("onAddPaths",{addedPaths:e}),require(["DS/ENXNav/utils/TwoDAppEvents"],(function(e){e.addRoot()}))}),i.getPADTreeDocument().refreshNodeById(t))})),d&&this.getPADTreeDocument().deleteNodes(d),a)&&(this._onRemoveRoot({pids:a}),a.length&&require("DS/PADServices/utils/GlobalModelEvents").publish({event:"ENXViews/WelcomePanel/cleanup",data:{item2remove:a}}));n.updateRevision.length&&this.getPADTreeDocument().updateRevision(n);let p=this.getPADTreeDocument();p.isOccModel&&p.isDGVGroupingApplied()&&p.triggerDGVGroupingReapply()},refreshInstance:function(e){if(e&&e.modified&&e.created){for(var t,n={},i=0;i<e.modifed.length;i++)t={oldId:e.modified[i].physicalid,newId:e.created[i].physicalid},coulples.push(t);n.coulpes=[],n.cb=e.cb,this.getPADTreeDocument().splitInstance(n)}else console.warn("refreshInstance: no input")},_dispatchReady:function(e){!0===this.options.isReady.model&&!0!==this.options.isReady.PADmodel&&(this._buildENOPADModel(),this.options.isReady.PADmodel=!0),!0===this.options.isReady.model&&this._probes.probe_model.end(),!0===this.options.isReady[this.options.active_view]&&this._probes.probe_view.end(),!0===this.options.isReady.actionbar&&this._probes.probe_actionbar&&this._probes.probe_actionbar.end(),!0===this._dispatchReady_NotDone&&!0===this.options.isReady.model&&!0===this.options.isReady.actionbar&&!0===this.options.isReady[this.options.active_view]&&(this.dispatchEvent.call(this,"onReady",{addInView:e}),this.dispatchEvent("onActionBarReadyToBuild"),this._probes.probe_init.end(),this._dispatchReady_NotDone=!1)},setKeyboardListenerOnGraph:function(){var e=this;e._keyboardListener||require(["DS/ENOPAD_v2/mixins/_PADKBInput"],(function(t){e._keyboardListener=new t({component:e}),e._keyboardListener.startObservingKeyboard(e.options.views.graphview.elements.container)}))},_buildENOPADModel:function(){var e=this;e.getContent().addEventListener("dragleave",(function(t){var n=t.relatedTarget,i=n?n.className:" ";if(!(!i||-1===i.indexOf("paddnd_invite")))return t.preventDefault(),t.stopPropagation(),!1;e.dropInvitContainer&&e.dropInvitContainer.hide(),0===e.options.model.getRoots().length&&e.dropInvitContainer.show("drop")}),!1)},onRead:function(e){var t=this.options.model;t.withTransactionUpdate(function(){for(var n=0;n<e.paths.length;n++){var i=t.getNodeByOccurencePath(e.paths[n]);if(i){i.updateOptions({isReadOnly:!0})}}}.bind(t))},onWrite:function(e){var t=this.options.model;t.withTransactionUpdate(function(){for(var n=0;n<e.paths.length;n++){var i=t.getNodeByOccurencePath(e.paths[n]);if(i){i.updateOptions({isReadOnly:!1})}}}.bind(t))},destroy:function(){this._parent()}})}));