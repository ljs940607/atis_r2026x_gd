/*!  Copyright 2014 Dassault Systemes. All rights reserved. */
define("DS/CAT3DWebStoreyComponents/CAT3DWebRequestServices",["UWA/Core","UWA/Controls/Abstract","UWA/Promise","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WAFData/WAFData"],(function(e,t,n,i,o){"use strict";var r=t.singleton({init:function(){r._cacheUrlMap=new Map,r._objectId=0,r._cacheSecurityContext=""},refreshSecurityContext:function(e){r._cacheSecurityContext=e},getSecurityContext:function(){return r._cacheSecurityContext.replace("ctx::","")},initServiceManager:function(){return this.getTenantId().then(function(e){return r._cacheTenantId=e,r.get3DSpaceAndLoginTicket(e)}.bind(this)).then(function(e){r._cacheLoginTicket=e.loginTicket}.bind(this)).catch((function(e){console.error(e)}))},get3DSpaceAndLoginTicket:function(e){return this.get3DSpace(e).then(function(t){r._cacheUrl3DSpace=t;let n=r.getSecurityContext();return this.getLoginTicket(t,n,e,!0)}.bind(this))},getLoginTicket:async function(e,t,i,a){var s;return!0===a&&(r._cacheLoginTicket=null),"string"==typeof r._cacheLoginTicket?s=r._cacheLoginTicket:this._getLoginTicketPromise?s=this._getLoginTicketPromise:widget.uwaUrl?(s=new n(function(n,a){var s={timeout:15e3,cache:-1,method:"GET",type:"json",headers:{Accept:"application/json","Accept-Language":null},onComplete:function(t){var i={loginTicket:t.ticket,url3DSpace:e};r._cacheLoginTicket=t.ticket,this._getLoginTicketPromise=null,n(i)}.bind(this),onFailure:function(){this._getLoginTicketPromise=null,a(new Error("GetLoginTicket failed"))}.bind(this)},c=e+"/ticket/get?";c+=t?"runasctx="+encodeURIComponent(t):"runasctx=preferred",i&&(c+="&tenant="+encodeURIComponent(i)),o.authenticatedRequest(c,s)}.bind(this)),this._getLoginTicketPromise=s):(r._cacheLoginTicket="",s=r._cacheLoginTicket),s},get3DSpace:async function(e){var t;return"string"==typeof r._cacheUrl3DSpace?t=r._cacheUrl3DSpace:this._get3DSpacePromise?t=this._get3DSpacePromise:widget.uwaUrl?(t=new n(function(t,n){i.getServiceUrl({serviceName:"3DSpace",platformId:e,onComplete:function(e){r._cacheUrl3DSpace=e,this._get3DSpacePromise=null,t(r._cacheUrl3DSpace)}.bind(this),onFailure:function(){this._get3DSpacePromise=null,n(new Error("get3DSpace failed"))}.bind(this)})}.bind(this)),this._get3DSpacePromise=t):(r._cacheUrl3DSpace="",t=r._cacheUrl3DSpace),t},getTenantId:async function(){var e;return r._cacheTenantId?e=r._cacheTenantId:this._getTenantIdPromise?e=this._getTenantIdPromise:widget.uwaUrl?(void 0===r._cacheTenantId&&(r._cacheTenantId=widget.getValue("x3dPlatformId")),r._cacheTenantId?e=r._cacheTenantId:(e=new n(function(e,t){i.getServiceUrl({serviceName:"3DDesign",onComplete:function(t){r._cacheTenantId=t[0].platformId,this._getTenantIdPromise=null,e(t)}.bind(this),onFailure:function(){this._getTenantIdPromise=null,t(new Error("getTenantId failed"))}.bind(this)})}.bind(this)),this._getTenantIdPromise=e)):(r._cacheTenantId="TST",e=r._cacheTenantId),e}});return e.namespace("DS/CAT3DWebStoreyComponents/CAT3DWebRequestServices",r)})),define("DS/CAT3DWebStoreyComponents/CAT3DWebStoreyNavigator",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS","DS/Controls/Slider","DS/Controls/Button","DS/WebappsUtils/WebappsUtils","DS/Utilities/Dom","DS/Controls/TooltipModel","i18n!DS/CAT3DWebStoreyComponents/assets/nls/CAT3DWebStoreyComponents","css!DS/CAT3DWebStoreyComponents/CAT3DWebStoreyComponents"],(function(e,t,n,i,o,r,a,s,c){"use strict";return t.extend({init:function(t){var r=this,l=t||{};if(l.frameWindow&&l.viewer){r._parent(l),r.silentValue=!1;var u,d,f,S,h,g,m,D,p;r._reverseView=new n.Vector3(0,0,1),r._storeyContainer=t.storeyContainer,r._offsetBase=1e3,r._offset=r._offsetBase;var y={},v=!1,C=!0,w="";this.display=function(t){if(0!=r._storeyContainer.length){if(w=t.style||"","function"==typeof t.compactDisplay?t.compactDisplay:null,!u){u=e.createElement("div",{class:"CAT3DWebStoreyNavigator",id:"MyMainId"}),l.frameWindow.getUIFrame().appendChild(u),r._storeySelector=new i({domId:"idStoreyNavigator",value:0,minValue:0,maxValue:r._storeyContainer.length-1,stepValue:1,displayStyle:"vertical",valuePopupFlag:!1}),r._storeySelector.customOffset=r._offset,r._storeySelector.addEventListener("change",(function(e){var t=e.dsModel.value,i=r._storeyContainer.at(t);r.silentValue?r.silentValue=!1:function(e){if(void 0===e)return;let t=new n.Vector3(e.aPosition.x,e.aPosition.y,e.aPosition.z);t.z+=r._offsetBase;const i=new CustomEvent("custom:slider:StoreyChanged",{detail:{UUID:e.aUUID,OrientedDirection:r._reverseView,Position3D:t}});dispatchEvent(i)}(i),m.setHTML(i.aName),D.setHTML((i.aPosition.z/1e3).toFixed(2)+"m"),p.setHTML(r._offsetBase/1e3+"m")})),r._storeySelector.getTextFromValue=function(){return r._storeyContainer.at(this.value).aName},r._storeySelector.inject(u),d=e.createElement("div",{class:"CAT3DWebStoreyNavigatorMainDiv"}).inject(u),f=e.createElement("div",{class:"CAT3DWebStoreyNavigatorButtonContainer"}).inject(d),m=e.createElement("p",{class:"CAT3DWebStoreyNavigatorLabelPara"}).inject(d),S=e.createElement("div",{class:"CAT3DWebStoreyNavigatorSubInfoContainer"}).inject(d),g=e.createElement("div",{class:"CAT3DWebStoreyNavigatorSubInfoElevationContainer"}).inject(S),h=e.createElement("div",{class:"CAT3DWebStoreyNavigatorSubInfoOffsetContainer"}).inject(S);var b=a.generateIcon("mountains");b.tooltipInfos=new s({title:c.Slider.Icon.Elevation,shortHelp:c.Slider.Icon.ElevationShort,mouseRelativePosition:!0}),b.inject(g),D=e.createElement("p",{class:"CAT3DWebStoreyNavigatorLabelElevation"}).inject(g);var T=a.generateIcon("ruler-vertical");T.tooltipInfos=new s({title:c.Slider.Icon.Offset,shortHelp:c.Slider.Icon.OffsetShort,mouseRelativePosition:!0}),T.inject(h),p=e.createElement("p",{class:"CAT3DWebStoreyNavigatorLabelOffset"}).inject(h),D.setHTML((r._storeyContainer[0].aPosition.z/1e3).toFixed(2)+"m"),p.setHTML(r._offsetBase/1e3+"m"),m.setHTML(r._storeyContainer[0].aName),r._getDownstairButton=new o({domId:"idDownButton",displayStyle:"icon",showLabelFlag:!1,icon:{iconName:"expand-down",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},emphasize:"secondary",tooltipInfos:new s({title:c.Slider.Button.Downstair,shortHelp:c.Slider.Button.DownstairShort,mouseRelativePosition:!0})}).inject(f),r._getDownstairButton.addEventListener("buttonclick",(function(){r._storeySelector.value-=1})),r._getUpstairButton=new o({domId:"idUpButton",displayStyle:"icon",showLabelFlag:!1,icon:{iconName:"expand-up",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},tooltipInfos:new s({title:c.Slider.Button.Upstair,shortHelp:c.Slider.Button.UpstairShort,mouseRelativePosition:!0}),emphasize:"secondary"}).inject(f),r._getUpstairButton.addEventListener("buttonclick",(function(){r._storeySelector.value+=1})),r._reverseViewButton=new o({domId:"idReverseButton",displayStyle:"icon",showLabelFlag:!1,icon:{iconName:"swap-right",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},emphasize:"secondary",tooltipInfos:new s({title:c.Slider.Button.Inverse,shortHelp:c.Slider.Button.InverseShort,mouseRelativePosition:!0})}).inject(f),r._reverseViewButton.addEventListener("buttonclick",(function(){r._reverseView.z=-1*r._reverseView.z,r.DefineView(r._reverseView);const e=new CustomEvent("custom:slider:OrientationChanged",{detail:{OrientedDirection:r._reverseView}});dispatchEvent(e)})),y.onFreeZoneResize||(l.frameWindow.getImmersiveFrame().addEventListener("freeZoneResize",I),y.onFreeZoneResize=1)}I(),u.setStyles({display:C?"":"none",opacity:1}),v=!0,"webUXStyle"===w&&(m.setStyles({fontSize:"12px",marginTop:"0px"}),D.setStyles({fontSize:"12px",marginTop:"0px"}),p.setStyles({fontSize:"12px",marginTop:"0px"}))}},this.hide=function(){u&&v&&(v=!1,u.setStyles({opacity:0}),setTimeout((function(){!v&&u&&u.setStyles({display:"none"})}),200))},this.EditMode=function(e){r._getDownstairButton.disabled=!e,r._getUpstairButton.disabled=!e,r._reverseViewButton.disabled=!e,r._storeySelector.disabled=!e},this.isDisplayed=function(){return v},this.setVisibleFlag=function(e){C=e,u&&u.setStyles({display:C&&v?"":"none"})},this.getVisibleFlag=function(){return C},this.DefineStoreys=function(e){r._storeyContainer=e},this.DefineCurrentStorey=function(e){let t=r._storeyContainer.findIndex((t=>t.aUUID==e));t>=0&&r._storeySelector.value!==t&&(r.silentValue=!0,r._storeySelector.value=t)},this.DefinePosition=function(e){let t=r._storeySelector.value,n=r._storeyContainer.at(t),i=r._offset;void 0!==n&&(i=e.z-n.aPosition.z),r._offset=i,p.setHTML((r._offset/1e3).toFixed(2)+"m")},this.DefineView=function(e){r._reverseView=e;let t=r._reverseView.z>0?"swap-right":"swap-left";r._reverseViewButton.icon={iconName:t,fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"}},this.GetOffset=function(){return r._offset},this.GetViewVector=function(){return r._reverseView},this.clean=function(){r.hide(),l&&l.frameWindow&&l.frameWindow.getUIFrame()&&u&&l.frameWindow.getUIFrame().removeChild(u),y.onFreeZoneResize&&l.frameWindow&&l.frameWindow.getImmersiveFrame().removeEventListener("freeZoneResize",I),u=m=D=p=f=S=h=g=null,y={}}}function I(){if(u&&l.frameWindow.getImmersiveFrame().getFreeZone().getSize().width){var e=0,t=l.frameWindow.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.RightDockArea),n=t.getContainedWindows();if(n&&(1===n.length&&n[0].isAWindowGroup()&&n[0].getEmbeddedWindows().length||1===n.length&&!n[0].isAWindowGroup())){for(var i=n[0].getEmbeddedWindows?n[0].getEmbeddedWindows():n,o=!1,r=0;r<i.length;r++)i[r].visibleFlag&&(o=!0);if(o&&!t.collapseDockingZoneFlag){var a=t._collapserSize;e=t.dockingZoneSize+a}}else e=t._collapserSize,t.visibleDockingZoneFlag&&!t.collapseDockingZoneFlag&&(e+=t.dockingZoneSize);u.setStyles({right:e+"px"})}}}})})),define("DS/CAT3DWebStoreyComponents/CAT3DWebApiRequestServices",["UWA/Core","UWA/Controls/Abstract","UWA/Promise","DS/WAFData/WAFData","DS/CAT3DWebStoreyComponents/CAT3DWebRequestServices"],(function(e,t,n,i,o){"use strict";var r=t.singleton({init:function(){},GET:function(e){return new n(function(t,n){var r={timeout:6e4,cache:-1,method:"GET",type:"json",headers:{Accept:"application/json","Accept-Language":null,SecurityContext:o.getSecurityContext()},onComplete:function(e){t(e)}.bind(this),onFailure:function(){n(new Error("get failed"))}.bind(this)};o.getTenantId().then((function(t){o.get3DSpace(t.toLowerCase()).then((function(t){var n=t+e;i.authenticatedRequest(n,r)}))}))}.bind(this))}});return e.namespace("DS/CAT3DWebStoreyComponents/CAT3DWebApiRequestServices",r)})),define("DS/CAT3DWebStoreyComponents/CAT3DWebTreeNavigationServices",["UWA/Core","UWA/Controls/Abstract","DS/Visualization/ThreeJS_DS","DS/CAT3DWebStoreyComponents/CAT3DWebApiRequestServices"],(function(e,t,n,i){"use strict";var o=t.singleton({init:function(){},getIFCExtension:function(e,t){var n="/resources/v1/modeler/dscstr/dscstr:CstrItem/"+e+"/dsifc:"+t;return i.GET(n)},getDriverJsonAttr:function(e){var t="/resources/Construction/v1/Site/"+e+"/Drivers";return i.GET(t)},getInstances:function(e){var t="/resources/v1/modeler/dscstr/dscstr:CstrItem/"+e+"/dscstr:CstrInstance?$mask=dsmvcstr:CstrItemMask.Instance&$fields=dsmveno:attribute.instance.name";return i.GET(t).then((function(t){var n=[];return t.member&&t.member.forEach((t=>{t.parentId=e,n.push(t)})),n})).catch((e=>{throw console.log(e),e}))},getFullDataAxisOf:function(e,t){let i=[],r=[];return function e(t,a,s){return o.getInstances(a).then((function(o){var a=[];if(o)return o.forEach((o=>{i.push({parentId:s,id:o.id,translation:new n.Vector3(parseFloat(o.matrix_10),parseFloat(o.matrix_11),parseFloat(o.matrix_12)),rotation:new n.Matrix3(parseFloat(o.matrix_1),parseFloat(o.matrix_4),parseFloat(o.matrix_7),parseFloat(o.matrix_2),parseFloat(o.matrix_5),parseFloat(o.matrix_8),parseFloat(o.matrix_3),parseFloat(o.matrix_6),parseFloat(o.matrix_9))}),o.referenceType===t?r.push(o):a.push(e(t,o.reference,o.id))})),Promise.all(a)})).catch((e=>{throw console.log(e),e}))}(e,t).then((function(){var e=[],t=[];return r.forEach((r=>{var a=i.findIndex((e=>e.id==r.id));if(-1!==a){console.log("");var s=i[a];t.push(o.getIFCExtension(r.reference,"IfcBuildingStorey").then((function(t){let a=o.getPrdAttributes(t,"elevation");0==s.translation.z?s.translation.z=a:s.translation.z!=a&&(s.translation.z+=a);let c=new n.Vector3(s.translation.x,s.translation.y,s.translation.z);!function e(t){let n=i.findIndex((e=>e.id===t));if(-1===n)return;let o=i[n];c.add(o.translation),e(o.parentId)}(s.parentId),r.vectorPos=c,e.push(r)})).catch((e=>{throw console.log(e),e})))}})),Promise.all(t).then((function(){return e}))}))},getPrdName:function(e){return e.name},getPrdRefID:function(e){return e.reference},getPrdAttributes:function(e,t){if(!(e.totalItems>1||e.member.length>1))return e.member[0][t]}});return e.namespace("DS/CAT3DWebStoreyComponents/CAT3DWebTreeNavigationServices",o)})),define("DS/CAT3DWebStoreyComponents/CAT3DWebStoreyNavigatorControler",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/CAT3DWebStoreyComponents/CAT3DWebStoreyNavigator","DS/CAT3DWebStoreyComponents/CAT3DWebRequestServices","DS/CAT3DWebStoreyComponents/CAT3DWebTreeNavigationServices","UWA/Core","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/SpinBox","DS/Controls/TooltipModel","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/Controls/ProgressBar","i18n!DS/CAT3DWebStoreyComponents/assets/nls/CAT3DWebStoreyComponents","css!DS/CAT3DWebStoreyComponents/CAT3DWebStoreyComponents"],(function(e,t,n,i,o,r,a,s,c,l,u,d,f,S){"use strict";return e.extend({init:function(e){var h,g,m=e||{};function D(){if(g&&m.frameWindow.getImmersiveFrame().getFreeZone().getSize().width){var e=0,t=m.frameWindow.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.RightDockArea),n=t.getContainedWindows();if(n&&(1===n.length&&n[0].isAWindowGroup()&&n[0].getEmbeddedWindows().length||1===n.length&&!n[0].isAWindowGroup())){for(var i=n[0].getEmbeddedWindows?n[0].getEmbeddedWindows():n,o=!1,r=0;r<i.length;r++)i[r].visibleFlag&&(o=!0);if(o&&!t.collapseDockingZoneFlag){var a=t._collapserSize;e=t.dockingZoneSize+a}}else e=t._collapserSize,t.visibleDockingZoneFlag&&!t.collapseDockingZoneFlag&&(e+=t.dockingZoneSize);g.setStyles({right:e+40+"px"})}}this.securityContext=e.securityContext,this.frameWindow=e.frameWindow,this.viewer=m.viewer,d.setNotificationManager(u),i.refreshSecurityContext(this.securityContext),this._RootStorey="",this.refStoreyArr=[],this.storeyContainer=[{aUUID:"111111",aName:"R0",aPosition:new t.Vector3(0,0,0)},{aUUID:"222222",aName:"R1",aPosition:new t.Vector3(0,0,2500)},{aUUID:"333333",aName:"R2",aPosition:new t.Vector3(0,0,3700)},{aUUID:"444444",aName:"R3",aPosition:new t.Vector3(0,0,6200)}],this._parent(m),this._LoadingPromise=void 0,this.currentStorey={aUUID:this.storeyContainer[0].aUUID,aPosition:this.storeyContainer[0].aPosition},this.CreateStoreyNavigator=function(e,i){this.DestroyStoreyNavigator(),e.storeyContainer=this.storeyContainer,h=new n(e),addEventListener("custom:slider:StoreyChanged",(e=>this.StoreyChanged(e))),addEventListener("custom:slider:OrientationChanged",(e=>this.OrientationChanged(e))),this.ShowStoreyNavigator(),this.currentStorey.aUUID=this.storeyContainer[0].aUUID,this.currentStorey.aDirection=h.GetViewVector();let o=new t.Vector3(this.storeyContainer[0].aPosition.x,this.storeyContainer[0].aPosition.y,this.storeyContainer[0].aPosition.z);o.z+=h.GetOffset(),this.currentStorey.aPosition=o},this.RefreshSC=function(e){this.securityContext=e,CAT3DWebRequestServices.refreshSecurityContext(e)},this.DestroyStoreyNavigator=function(){h&&h.clean()},this.ShowStoreyNavigator=function(){h&&h.display({style:"webUXStyle"})},this.DisplayLoadingCircle=function(){if(g||(g=r.createElement("div",{class:"CAT3DWebStoreyNavigatorLoadingCircleContainer"})),!g)return;m.frameWindow.getUIFrame().appendChild(g),D(),m.frameWindow.getImmersiveFrame().addEventListener("freeZoneResize",D),new f({shape:"circular",infiniteFlag:!0}).inject(g)},this.RemoveLoadingCircle=function(){g&&m.frameWindow.getUIFrame().removeChild(g),m.frameWindow.getImmersiveFrame().removeEventListener("freeZoneResize",D),g=null},this.HideStoreyNavigator=function(){h&&h.hide()},this.SetEditMode=function(e){h&&h.EditMode(e)},this.GetStoreys=function(e){let t=this;return t._LoadingPromise?t._LoadingPromise.then((function(){return t.storeyContainer})):Promise.resolve(t.storeyContainer)},this.SetRootForStoreys=function(e){0!=e.length&&(this._RootStorey=e[0],this.LoadStoreysWithDriver())},this.GetCurrentStorey=function(){return this.currentStorey.aUUID},this.SetCurrentStorey=function(e){let t=this.storeyContainer.findIndex((t=>t.aUUID==e));-1!==t&&(this.currentStorey.aUUID=e,this.currentStorey.aPosition=this.storeyContainer[t].aPosition,h&&h.DefineCurrentStorey(e))},this.GetPosition3D=function(){return{orientedDirection:h?h.GetViewVector():new t.Vector3(0,0,1),position:this.currentStorey.aPosition}},this.SetPosition3D=function(e,t){this.currentStorey.aDirection=e,this.currentStorey.aPosition=t,h&&(h.DefinePosition(t),h.DefineView(e))},this.StoreyChanged=function(e){this.currentStorey.aUUID=e.detail.UUID,this.currentStorey.aPosition=e.detail.Position3D;const t=new CustomEvent("custom:StoreyChanged",{detail:e.detail});dispatchEvent(t)},this.OrientationChanged=function(e){const t=new CustomEvent("custom:OrientationChanged",{detail:e.detail});dispatchEvent(t)},this.DisplaySuccessNotification=function(e){this.viewer&&this.viewer.displayNotification({eventID:"success",msg:S.Notification.RequestSuccessNotif[e]})},this.DisplayWarningNotification=function(e){this.viewer&&this.viewer.displayNotification({eventID:"warning",msg:S.Notification.RequestWarningNotif[e]})},this.DisplayErrorNotification=function(e){this.viewer&&this.viewer.displayNotification({eventID:"error",msg:S.Notification.RequestErrorNotif[e]})},this.LoadStoreysWithDriver=function(){var e=this;e._LoadingPromise=i.initServiceManager().then((function(){return e.storeyContainer.length=0,o.getDriverJsonAttr(e._RootStorey).then((function(n){if(1==n.totalItems.length){let i=n.totalItems[0].constructionInformation;if(i.Drivers)for(let n of i.Drivers)for(let i of n.Levels)e.storeyContainer.push({aUUID:i.ID,aName:i.Name,aPosition:new t.Vector3(parseFloat(i.Elevation),parseFloat(i.Elevation),parseFloat(i.Elevation))})}if(0===e.storeyContainer.length)return e.DisplayWarningNotification("DriverLoadingFail"),e.LoadStoreys();e.DisplaySuccessNotification("DriverLoadingOK"),e.storeyContainer.sort(((e,t)=>e.aPosition.z-t.aPosition.z)),e.RefreshNavigatorStorey()})).catch((t=>(console.log("Error getting storeys from driver",t),e.DisplayWarningNotification("DriverMissing"),e.LoadStoreys())))}))},this.LoadStoreys=function(){var e=this;return i.initServiceManager().then((function(){return e.DisplayLoadingCircle(),o.getFullDataAxisOf("BuildingStorey",e._RootStorey).then((function(n){e.storeyContainer.length=0;let i=[];return n.forEach((n=>{let r=o.getPrdRefID(n);i.push(o.getIFCExtension(r,"IfcBuildingStorey").then((function(i){"2"===o.getPrdAttributes(i,"compositionType")&&(n.vectorPos.z,e.storeyContainer.push({aUUID:r,aName:o.getPrdName(n),aPosition:new t.Vector3(1e3*n.vectorPos.z,1e3*n.vectorPos.z,1e3*n.vectorPos.z)}))})).catch((e=>{throw console.log(e),e})))})),Promise.all(i).then((function(){if(e.RemoveLoadingCircle(),0===e.storeyContainer.length)return e.DisplayErrorNotification("LoadingFail"),e.UserDefaultStoreyCreation();d&&d.removeNotifications(),e.DisplaySuccessNotification("StoreysLoadingOK"),e.storeyContainer.sort(((e,t)=>e.aPosition.z-t.aPosition.z)),e.RefreshNavigatorStorey()}))})).catch((t=>{console.log(t),e.DisplayErrorNotification("LoadingFail")}))}))},this.UserDefaultStoreyCreation=function(){var e=this;if(e.frameWindow)return new Promise((function(n,i){var o=new r.createElement("div",{class:"CAT3DWebDefaultStoreyContainer"}),u=new r.createElement("div",{class:"CAT3DWebDefaultStoreyNumberContainer"}),d=new r.createElement("div",{class:"CAT3DWebDefaultStoreyElevationContainer"}),f=new r.createElement("div",{class:"CAT3DWebDefaultStoreyOffsetContainer"});r.createElement("p",{class:"CAT3DWebDefaultStoreyNumberLabel"}).inject(u).setHTML(S.Dialog.Spinbox.Numbers),r.createElement("p",{class:"CAT3DWebDefaultStoreyElevationLabel"}).inject(d).setHTML(S.Dialog.Spinbox.Elevation),r.createElement("p",{class:"CAT3DWebDefaultStoreyOffsetLabel"}).inject(f).setHTML(S.Dialog.Spinbox.Offset);var h=new c({domId:"idSpinStorey",value:3,minValue:1,maxValue:200,stepValue:1,pageStepValue:1,tooltipInfos:new l({title:S.Dialog.Spinbox.Numbers,shortHelp:S.Dialog.Spinbox.NumbersShort})});h.inject(u);var g=new c({domId:"idSpinStoreyElevation",value:2.5,units:"m",minValue:0,maxValue:100,stepValue:.1,pageStepValue:1,tooltipInfos:new l({title:S.Dialog.Spinbox.Elevation,shortHelp:S.Dialog.Spinbox.ElevationShort})});g.inject(d);var m=new c({domId:"idSpinStoreyOffset",value:0,units:"m",minValue:-1e4,maxValue:1e4,stepValue:.1,pageStepValue:1,tooltipInfos:new l({title:S.Dialog.Spinbox.Offset,shortHelp:S.Dialog.Spinbox.OffsetShort})});m.inject(f),u.inject(o),f.inject(o),d.inject(o);var D=new a({immersiveFrame:e.frameWindow.getImmersiveFrame(),height:"auto",buttons:{Ok:new s({onClick:function(i){let o=h.value,r=m.value,a=g.value;for(let n=0;n<o;++n)e.storeyContainer.push({aUUID:S.Dialog.Storey.DefaultName+n,aName:S.Dialog.Storey.DefaultName+n,aPosition:new t.Vector3(0,0,1e3*r+a*n*1e3)});e.RefreshNavigatorStorey(),n(),D.close()},tooltipInfos:new l({title:S.Dialog.Button.Ok,shortHelp:S.Dialog.Button.OkShort})}),Cancel:new s({onClick:function(e){i(),D.close()},tooltipInfos:new l({title:S.Dialog.Button.Cancel,shortHelp:S.Dialog.Button.CancelShort})})},content:o,title:S.Dialog.Title})}))},this.RefreshNavigatorStorey=function(){var e=this;let n=e.storeyContainer;if(h){h.clean(),h.DefineStoreys(n),this.ShowStoreyNavigator(),e.currentStorey.aUUID=n[0].aUUID,e.currentStorey.aDirection=h.GetViewVector();let i=new t.Vector3(n[0].aPosition.x,n[0].aPosition.y,n[0].aPosition.z);i.z+=h.GetOffset(),e.currentStorey.aPosition=i;const o=new CustomEvent("custom:StoreyChanged",{detail:{UUID:e.currentStorey.aUUID,OrientedDirection:h.GetViewVector(),Position3D:e.currentStorey.aPosition}});dispatchEvent(o)}const i=new CustomEvent("custom:LoadingComplete",{detail:{succeeded:e.storeyContainer.length>0,elements:e.storeyContainer.length}});dispatchEvent(i)}}})}));