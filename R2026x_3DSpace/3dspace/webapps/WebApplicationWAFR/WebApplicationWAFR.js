define("DS/WebApplicationWAFR/VCXUtilsThread",["require","exports"],(function(e,t){"use strict";return class{constructor(e={keepOnlyLast:!1}){this._queue=[],this._isLocked=!1,this.keepOnlyLast=e.keepOnlyLast,this.resolveToCall=[]}acquire(){return new Promise((e=>{this._queue.push({resolve:e}),this._dispatch()}))}async runExclusive(e){const t=await this.acquire();try{if(!t.allowExecute){let e=this._generateDeferredPromise();return this.resolveToCall.push(e.resolve),e.promise}let n=await e();return this.keepOnlyLast&&this.resolveToCall.forEach((e=>e(n))),this.resolveToCall=[],n}finally{t.callbackEnd()}}_generateDeferredPromise(){let e,t;return{promise:new Promise(((n,i)=>{[e,t]=[n,i]})),reject:t,resolve:e}}_dispatch(){if(this._isLocked)return;let e=this._queue.shift(),t=!0;this.keepOnlyLast&&(t=0===this._queue.length),e&&(this._isLocked=!0,e.resolve({allowExecute:t,callbackEnd:this._buildRelease()}))}_buildRelease(){return()=>{this._isLocked=!1,this._dispatch()}}}})),define("DS/WebApplicationWAFR/VCXOverrideCommandManager",["DS/ApplicationFrame/CommandsManager","DS/WebApplicationWAFR/VCXUtilsThread"],(function(e,t){"use strict";return new class{do(n){this.mutex=new t,e.__proto__.getCommand=e=>{let t=n.executionContext.getComponent("AFR_HandlerComponent"),i=t.hasHandler(e);if(i||(i=t.hasCheckHandler(e)),!i)return console.warn("Not found handler : "+e),null;let a=async(n=null)=>{if(!t.hasHandler(e))throw new Error("You can't use .begin() on a checkHandler, use activateCheck, activateCheck, toggleCheck instead");return this.lastKnownHandler&&console.warn("There is one existing handler running : "+this.lastKnownHandler+", it will be executed after"),this.mutex.runExclusive((async()=>{this.lastKnownHandler=e,await t.executeHandler(n?{id:e,args:n}:{id:e}),this.lastKnownHandler=null}))},o=async(n=null,i=void 0)=>{if(!t.hasCheckHandler(e))throw new Error("You can't use that method on a handler, use begin() instead");void 0===i?await t.toggleCheck(n?{id:e,args:n}:{id:e}):await t.setCheckState(n?{id:e,args:n,state:i}:{id:e,state:i})};return{name:e,begin:a,execute:a,enable:()=>{t.hasHandler(e)&&t.enableHandler(e),t.hasCheckHandler(e)&&t.enableCheck(e)},disable:()=>{t.hasHandler(e)&&t.disableHandler(e),t.hasCheckHandler(e)&&t.disableCheck(e)},isEnabled:()=>t.isHandlerExecutable(e),isRunning:()=>n.executionContext.getComponent("AFR_CommandsManager").getRunningCommand()===e,isWAFR:()=>!0,end:()=>{n.executionContext.getComponent("AFR_CommandsManager").getRunningCommand()===e&&document.dispatchEvent(new KeyboardEvent("keydown",{keyCode:27}))},getCheckState:(n=null)=>{if(!t.hasCheckHandler(e))throw new Error("You can't use that method on a handler, use begin() instead");return t.getCheckState(n?{id:e,args:n}:{id:e})},activateCheck:async(e=null)=>o(e,!0),disactivateCheck:async(e=null)=>o(e,!1),toggleCheck:async(e=null)=>o(e),options:{arguments:[],args:{}}}}}}})),define("DS/WebApplicationWAFR/VCXAdaptatorFrWindow",["DS/WebApplicationWAFR/VCXOverrideCommandManager"],(function(e){"use strict";return class{constructor(t){this.options=t,this.lastKnownHandler=null,this.elements={container:this.options.frWindow},e.do(this.options)}getExecutionContext(){return this.options.executionContext}getActionBar(){return null}getViewer(){let e=this.options.executionContext.getComponent("Viewer");return e?e.getViewer?e.getViewer():e.get3DViewer?e.get3DViewer():null:null}getViewpoint(){return this.getViewer().getViewpoints()[0]}getUIFrame(){return this.options.executionContext.getComponent("AFR_UIFrameManager").getUIFrame()}getImmersiveFrame(){return this.options.executionContext.getComponent("AFR_UIFrameManager").getImmersiveFrame()}getContextualUIManager(){let e=this.options.executionContext.getComponent("Afr_UIComponent"),t=e&&e.getContextualUIComponentManager();if(!t)return null;if(!t._vcxAddons){t._vcxAddons=!0;let e=t.getContextualBar();e.setHideWithDistance=t=>e.options.hideWithDistance=t,t.showContextualBar=t._showContextualBar}return t}getContent(){return this.elements.container}}})),define("DS/WebApplicationWAFR/VCXAbstractWebApplicationComponent",["DS/WebApplication/WebApplication","DS/WebApplicationWAFR/VCXAdaptatorFrWindow","DS/WebApplicationWAFR/VCXUtilsThread"],(function(e,t,n){"use strict";return class{constructor(e,t){this.options=e,this._app=null,this._wapp=null,this.mutex=new n,widget.enopadViewer||(widget.enopadViewer=e&&e.enopad),e.appRequire&&(t=e.appRequire),this._appRequire=t}async initialize(){let e=this.getExecutionContext();await this.getWebApplication(),e.getComponent("Widget")&&e.getComponent("Widget").hideLayerLoading&&e.getComponent("Widget").hideLayerLoading()}async getWebApplication(){return this.mutex.runExclusive((()=>new Promise((n=>{if(this._app)return void n(this._app);let i=document.getElementsByClassName("wux-afr-framewindow")[0];try{this._wapp=new e({container:i,application:this._appRequire,Async:!0,frmWindow:new t({context:"_Context",executionContext:this.getExecutionContext(),frWindow:i}),onAppInitialize:(e,t)=>{console.log("ON APP INIT "),this._app=e,n(e)}})}catch(e){return console.error(e),null}}))))}enableSwitchApp(){console.log("enableSwitchApp AbstractWebApplicationComponent")}async clean(){this._app=null,this._wapp&&await this._wapp.dispose({}),this._wapp=null}destroy(){}getExperienceBase(){return this._app?this._app._experienceBase:null}configure(){}}}));