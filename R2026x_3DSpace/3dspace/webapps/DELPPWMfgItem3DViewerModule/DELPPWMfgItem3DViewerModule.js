define("DS/DELPPWMfgItem3DViewerModule/ScopedProductSelectionUI",["UWA/Core"],(function(e){"use strict";return function(t,n,i){const o="rootField",s="occField",r="scopedMfgItemField";var a,c,l,d,u=1,f=2,h=n.getComponent("Element"),g=n.getComponent("Accordeon"),p=n.getComponent("Button"),I=n.getComponent("ComboBox"),P=n.getComponent("TooltipModel"),m=null,v=null,b=null;return a=function(a){var c,l,d;c=function(n){switch(n){case u:return function(){v.close()};case f:return function(){var t=b[o],n=b[s],i=b[r];e.is(a,"function")&&e.is(t)&&e.is(n)&&e.is(i)&&a(t.value,n.value,i.value),v.close()};default:t.log("wrong option")}},l={No:new p({label:i.getNLSValue("ScopedProductSelectionUI.Close.Title"),onClick:c(u)}),Yes:new p({disabled:!1,label:i.getNLSValue("ScopedProductSelectionUI.Load.Title"),onClick:c(f)})},e.is(n)?(d={title:i.getNLSValue("ScopedProductSelectionUI.Dialog.Title"),domId:"ScopedProductSelectionUI-dialog",content:m,resizableFlag:!0,modalFlag:!1,minWidth:290,width:400,buttons:l,visibleFlag:!1},(v=n.create("Dialog",d)).close=function(){e.is(m)&&m.destroy(),this.destroy(),v=null,b=null}):t.debug("uxFactoryBehavior is not available.")},c=function(t){var n,i;return n=new e.Element("div",{class:"accordeon-section-container"}),i=new h("div",{class:"section-container"}),n.inject(m),new g({items:[{header:t,content:i,expandedFlag:!0}],style:"filled-separate"}).inject(n),i.addEvent("resize",(function(){var t,n,o;o=i.getElements(".wux-field-container"),i.clientWidth<290?(t="inline-container",n="block-container"):(t="block-container",n="inline-container"),e.is(o)&&o.forEach((function(e){e.removeClassName(t),e.addClassName(n)}))})),i},l=function(t,n){t.forEach((function(t){var i,o;i=new e.Element("div",{class:"wux-field-container inline-container"}),new e.Element("h6",{class:"wux-textElement",text:t.label}).inject(i).tooltipInfos=new P({shortHelp:t.label}),o=new I({elementsList:t.elementsList,actionOnClickFlag:!1,enableSearchFlag:!1,value:t.value,disabled:t.disabled}),e.is(t.onChange,"function")&&o.addEventListener("change",t.onChange.bind(null,b)),b[t.name]=o,o.inject(i),i.inject(n)}))},d=function(t){var n,a,d,u,f,h={},g={};Array.isArray(t)&&t.length>0&&(d={name:o,label:i.getNLSValue("ScopedProductSelectionUI.Field.Root.Title"),elementsList:[],disabled:!0,onChange:function(t){var n,i,a,c,l,d,u;n=t[o],a=t[s],d=t[r],e.is(n)&&e.is(a)&&e.is(d)&&(i=n.value,e.is(h[i])&&(l=(c=h[i])[0].valueItem,a.setProperties({elementsList:c,value:l}),e.is(g[l])&&(u=g[l],d.setProperties({elementsList:u,value:u[0].valueItem}))))}},u={name:s,label:i.getNLSValue("ScopedProductSelectionUI.Field.Occurence.Title"),elementsList:[],disabled:!0,onChange:function(t){var n,i,o,a;n=t[s],o=t[r],e.is(n)&&e.is(o)&&(i=n.value,e.is(g[i])&&(a=g[i],o.setProperties({elementsList:a,value:a[0].valueItem})))}},f={name:r,label:i.getNLSValue("ScopedProductSelectionUI.Field.ScopedMfgItem.Title"),elementsList:[],disabled:!0},t.forEach((function(e){var t=[];e.occurences.forEach((function(e){var n=[];t.push({labelItem:e.label,valueItem:e.pid}),e.scopedPrd.forEach((function(e){n.push({labelItem:e.label,valueItem:e.pid})})),g[e.pid]=n})),h[e.pid]=t})),a=t[0],d.disabled=!1,d.value=a.pid,d.elementsList=t.map((function(e){return{labelItem:e.label,valueItem:e.pid}})),e.is(h[d.value])&&(u.disabled=!1,u.elementsList=h[d.value],u.value=u.elementsList[0].valueItem,e.is(g[u.value])&&(f.disabled=!1,f.elementsList=g[u.value],f.value=f.elementsList[0].valueItem)),b=[],n=c(i.getNLSValue("ImplementUI.Implementing")),l([d,u],n),n=c(i.getNLSValue("Type.VPMReference")),l([f],n))},{createDialog:function(t){!e.is(v)&&e.is(t)&&e.is(t.data)&&e.is(t.onSelectCallback)&&(m=new h("div",{class:"ScopedProductSelectionUI-Container"}),a(t.onSelectCallback),d(t.data),v.show())},isActive:function(){return!!e.is(v)&&v.visibleFlag},destroyUI:function(){e.is(v)&&v.close()}}}})),define("DS/DELPPWMfgItem3DViewerModule/MfgItem3DViewerModule",["UWA/Core","DS/TransientWidget/TransientWidget","DS/DELPPWMfgItem3DViewerModule/ScopedProductSelectionUI"],(function(e,t,n){"use strict";return{behaviors:["InterWidgetComBehavior","UXFactoryBehavior","ResourceBehavior","ModelBehavior","RootsBehavior","ProductImplementBehavior","Viewer3DBehavior","LinkBehavior","SelectionBehavior"],creator:function(i,o,s,r,a,c,l,d,u,f){const h="VPMInstance",g="VPMReference",p="ProductImplementLink",I="ProductImplementLinkOcc",P="PartialProductImplementLink";var m,v,b,D,S,E,y,L,w,R,A,O,C,V,k,M,W,F,x,U,j,T,N,B,H,_,z,G,K,X,Y,q,J,Q,Z,$,ee,te,ne,ie,oe,se,re,ae,ce,le="MfgItem3DViewerModule_Preferences",de=o.isCloud()?"DELOERC_AP":"DELOER_AP";return F=function(){o.isWidgetLinked(de)?i.warn(r.getNLSValue("MfgItem3DOperationViewer.IsAlreadyAvailable")):t.showWidget(de,"",{},{mode:"transient"})},Y=function(){var t,n,i,s;const r=t=>{if(n=D(),i=n.loadedObjInfos,e.is(t.occurences)&&1===t.occurences.length){const n=t.occurences[0];if(e.is(n.scopedPrd)&&1===n.scopedPrd.length){return n.scopedPrd[0].pid===i.scopedPrdPID}}return!1};if(o.isOpsViewerWidgetLinked())if(t=c.getRoots()[0],s=L(t)){const t=s.find(r);e.is(t)?V(t.pid,t.occurences[0].scopedPrd[0].pid):y()}else y()},x=function(t){var n,i;o.isOpsViewerWidgetLinked()&&(i=D(),e.is(i)||(n=L([t]),O(n)))},H=function(e){var t;if(o.isWidgetLinked(de)){const n=e.absPath;if(n.length>0){const e=n[0],i=a.getInstance(e);t=a.getAggregatingReferenceModelFromInstance(i)}else t=a.getReference(e.nodeId);const i=[t.get("PID")],o=L(i);O(o)}},_=function(t){if(o.isWidgetLinked(de)){const n=D();if(e.is(n)&&e.is(t.impactedChildren)){const i=t.impactedChildren,o=n.loadedObjInfos;if(e.is(i)&&e.is(o)){const e=i[i.length-1];e!==o.rootPID&&e!==o.scopedPrdPID||V(o.rootPID,o.scopedPrdPID)}}}},D=function(){return d.getPreferences()},E=function(e,t){var n={loadedObjInfos:{rootPID:e,scopedPrdPID:t}};widget.setValue(le,n),d.updatePreferences(n),i.notify("set3DVisibilityState",[{isVisible:!0,parentPID:t}])},y=function(){var t;S=D(),d.updatePreferences(),widget.setValue(le),e.is(S)&&(t=S.loadedObjInfos,e.is(t)&&i.notify("set3DVisibilityState",[{isVisible:!1,parentPID:t.scopedPrdPID}]))},B=function(e){var t,n=[];if(1===e.length)n=e;else for(t=0;t<e.length;t++)t%2==1&&n.push(e[t]);return n},L=function(t){let n=[];return Array.isArray(t)&&t.length>0&&t.forEach((function(t){let i;const o=a.getReference(t);let s=l.getScopeLinksOfImplementing(t);if(0===s.length&&(s=l.getPartialScopeLinksOfImplementing(t)),s.length>0){const e=s[0].get("to");let n=[];const r=a.getReference(e);n.push({pid:e,label:r.get("PLMEntity.V_Name")}),i={pid:t,label:o.get("PLMEntity.V_Name"),occurences:[{pid:t,label:o.get("PLMEntity.V_Name"),scopedPrd:n}]}}e.is(i)&&n.push(i)})),n},O=function(t){var o;if(o=function(){var t,n;t=D(),e.is(t)&&(n=t.loadedObjInfos,e.is(n.scopedPrdPID)&&G(n.scopedPrdPID))},t.length>0){if(1===t.length){const n=t[0];if(e.is(n.occurences)&&1===n.occurences.length){const t=n.occurences[0];if(e.is(t.scopedPrd)&&1===t.scopedPrd.length){const e=t.scopedPrd[0].pid;return o(),void V(n.pid,e)}}}(v=new n(i,s,r)).createDialog({data:t,onSelectCallback:function(t,n,i){e.is(t)&&e.is(n)&&e.is(i)&&(o(),V(t,i))}})}},C=function(t,n){e.is(t)&&o.publishEvent("DS/DELExternalWidgetCom/"+t,n)},V=function(t,n){const i=a.getReferenceModel(t);if(e.is(i)){E(t,n),C("Remove2DStructure");C("LoadData",{items:[{id:n}]})}},k=function(){setTimeout((function(){C("GetAppStatus")}),10)},M=function(){e.is(v)&&v.isActive()&&v.destroyUI(),y(),i.notify("widgetUnlinked")},W=function(){var e,t;t=c.getRoots()[0],e=L(t),C("Remove2DStructure"),e.length>0&&O(e),i.notify("widgetLinked")},U=function(t,n){let i=!1;const o=n.loadedObjInfos;if(e.is(o.rootPID))if(t===o.rootPID||t===o.scopedPrdPID)i=!0;else{i=a.getInstancesFromCollection(t).some((function(e){let t=!1;return a.getReferenceModelFromInstance(e).get("PID")===o.rootPID&&(t=!0),t}))}return i},j=function(t){var n,o,s,r,c,l,d,u={};if(n=this.isSelected,o=n?"selectNodes":"unSelectNodes",d=function(){n&&i.notify("addOccurrece",[s]),i.notify(o,[l])},e.is(t.path))if(s=t.path,r=[],c=[],l=[],s.forEach((function(i){var o=!1,s=i.filter((function(i,s){var c,l,d=s%2!=0,u=!1,f=!1;return c=d?a.getInstance(i):a.getReferenceModel(i),e.is(c)?l=c.get("type"):e.is(t.attributes)&&e.is(t.attributes[i])&&(l=t.attributes[i].type),e.is(l)&&(f=a.isAKindOf(l,g),u=a.isAKindOf(l,h)),n&&!e.is(c)&&(f||u)&&(r.push(i),o=!0),d&&u}));o&&c.push(i),0===s.length&&(s=i),l.push(s)})),c.length>0){let e=function(){i.notify("stopProgress",u),d()},t=function(){i.debug("Fetching getDescendantsFromServer for missing occurence failed."),i.notify("stopProgress",u)};i.notify("startProgress",u),a.getDescendantsFromServer(r,e,{onFailure:t,silentMode:!0,expandLevel:0,forceDBMode:!0})}else d()},T=function(e){var t=[],n=[];o.isOpsViewerWidgetLinked()&&((e=Array.isArray(e)?e:[e]).forEach((function(e){e.isVisible?n.push(e.rirPath):t.push(e.rirPath)})),t.length>0&&C("Hide",{path:t}),n.length>0&&C("Show",{path:n}))},N=function(t){var n,o=this.isDisplayed,s={},r=[];e.is(t.attributes)&&(t.path.forEach((function(e){n=B(e),s={absPath:n,isVisible:o},r.push(s)})),i.notify("update3DVisibilityState",[r]))},w=function(e,t){const n=Array.isArray(e)?e:e.split(",");let i=0,o=!1;if(t.length>0)for(let e=0;e<n.length;e++){const s=n[e];if(t[i].indexOf(s)>-1&&(i++,i===t.length)){o=!0;break}}else o=!0;return o},R=function(t,n,i){var o,s,r,c,l=[],d=t.absPath,f=d[d.length-1],h=e.is(f)?f:t.nodeId,g=a.getReference(h);if(e.is(g)||(c=a.getInstance(f),e.is(c)&&(g=a.getReferenceModelFromInstance(c),r=c.id,h=g.id)),s=Array.isArray(t.absPath)&&t.absPath.length>0?a.getParentReferenceIdFromInstance(t.absPath[0]):t.nodeId,e.is(h)&&(s===n||s===i))switch(a.getPPRType(g)){case"PROCESS":case"CONSTRUCTION":case"SERVICE":u.getConnectedObjects(r||h,d,{relationTypes:[p,P,I,"DELMBOMContextualImplementCnx"]}).forEach((t=>{var n,o=[];e.is(t.occPath)?n=(n=a.transformToRIROccurrencePath(t.occPath)).length===2*t.occPath.length+1?n:null:e.is(t.objectPID)?n=a.transformToRIROccurrencePath(t.objectPID):e.is(t.rirPath)&&(n=t.rirPath),e.is(n)&&(o=a.findAllRIRPaths(n)),o.forEach((e=>{var n=e.indexOf(i);n>-1&&(e=e.slice(n)),Array.isArray(t.ctxPath)&&t.ctxPath.length>0?w(e,t.ctxPath)&&l.push(e):l.push(e)}))}));break;case"PRODUCT":case"RESOURCE":d.length>0?(o=a.transformToRIROccurrencePath(d),l.push(o)):l=l.concat(a.findAllRIRPaths(h))}return l},A=function(t){var n,i,s,r,a,c,l;n=D(),o.isOpsViewerWidgetLinked()&&e.is(n)&&e.is(n.loadedObjInfos)&&(i=n.loadedObjInfos.rootPID,s=n.loadedObjInfos.scopedPrdPID,(t=Array.isArray(t)?t:[t]).forEach((e=>{r=e.changed.isSelected,c=Array.isArray(e.changed.absPath)?e.changed.absPath:[],a=c.length>0?c.toString():e.changed.nodeId,r?b[a]=R(e.changed,i,s):delete b[a]})),C("Highlight",{path:[],clear:!0}),(l=Object.values(b).reduce(((e,t)=>e.concat(t)),[])).length>0&&C("Highlight",{path:l}))},z=function(t){var n,i;n=D(),e.is(n)&&t.some((function(e){return U(e.get("PID"),n)}))&&(i=n.loadedObjInfos,G(i.scopedPrdPID))},G=function(t){var n=a.getReferenceModel(t);e.is(n)&&"PRODUCT"===a.getPPRType(n)&&(y(),C("RemoveRoots",{items:[{id:t}]}))},K=function(){X()},X=function(){C("RemoveAll")},J=function(t){var n,i,s=[];o.isOpsViewerWidgetLinked()&&(n=(n=(n=(n=[]).concat(f.getSelectionsWithPaths()[0]||[])).concat(f.getSelectionsWithPaths()[1]||[])).map((e=>{var t=Array.isArray(e.path)?e.path:[];return t.length>0?(e.leafInstPID=t[t.length-1],e.leafRefPID=a.getReferenceIdFromInstance(e.leafInstPID)):e.leafRefPID=e.id,e})),(Array.isArray(t)?t:[t]).forEach((t=>{var i,o,r,a,c;switch(t.get("type")){case p:case P:i=t.get("from"),r=t.get("to"),n=n.filter((t=>{var n=!1;return!e.is(t.leafRefPID)||t.leafRefPID!==i&&t.leafRefPID!==r||(n=!0,s.push(t)),!n}));break;case I:o=t.get("from"),c=t.get("to"),a=c[c.length-1],n=n.filter((t=>{var n=!1;return!e.is(t.leafInstPID)||t.leafInstPID!==o&&t.leafInstPID!==a||(n=!0,s.push(t)),!n}))}})),s.length>0&&(i=s.map((e=>({changed:{isSelected:!0,absPath:e.path,nodeId:e.id}}))),A(i)))},ee=function(e){var t=[],n=[],i=function(e,t){let n=[];return n=ce(e),n.length>0&&n.forEach((function(e){t.push(e)})),t};e.forEach((function(e){let o=[],s=[],r=[];e.length>0&&(o.push(e),o=o.concat(ae(e,!0)),i(e,s),r=re(e),r.length>1&&r.forEach((function(e){o.push(e),e.length>2&&i(e,s)})),t=t.concat(o),n=n.concat(s))})),C("Hide",{path:n}),C("Show",{path:t})},te=function(e){var t=[];t=t.concat(e),e.forEach((function(e){t=t.concat(ae(e,!0))})),C("Show",{path:t})},re=function(e){let t=[],n=[];for(let i=0;i<e.length-2;i++){const o=e[i];n.push(o),i%2==0&&t.push(n.slice())}return t},ae=function e(t,n){let i,o,s=[];return o=t[t.length-1],i=a.getInstancesFromCollection(o),Array.isArray(i)&&i.length>0&&i.forEach((i=>{let o,r,a=[];if(a=a.concat(t),o=i.get("PID"),a.push(o),r=i.get("isInstanceOf"),a.push(r),s.push(a),n){let t=[];t=e(a,!0),t.length>0&&t.forEach((function(e){s.push(e)}))}})),s},ce=function(e){let t,n,i=[];return n=e[e.length-3],t=a.getInstancesFromCollection(n),Array.isArray(t)&&t.length>0&&t.forEach((t=>{if(t.get("PID")!==e[e.length-2]){let n,o,s=[];s=s.concat(e),s.splice(s.length-2,2),n=t.get("PID"),s.push(n),o=t.get("isInstanceOf"),s.push(o),i.push(s)}})),i},Z=function(t){var n,i,s,r,a,c=[];return n=D(),o.isOpsViewerWidgetLinked()&&e.is(n)&&e.is(n.loadedObjInfos)&&(i=n.loadedObjInfos.rootPID,s=n.loadedObjInfos.scopedPrdPID,(t=Array.isArray(t)?t:[t]).forEach((t=>{var n;a=Array.isArray(t.absPath)?t.absPath:[],r=a.length>0?a.toString():t.referencePID,e.is(b[r])?c=c.concat(b[r]):(n={absPath:a,nodeId:a.length>0?t.instancePID:t.referencePID},c=c.concat(R(n,i,s)))}))),c},$=function(e,t){var n;(n=Z(t)).length>0&&"showOnly"===e?ee(n):n.length>0&&"showAll"===e&&te(n)},Q=function(e,t){var n;n=Z(t),C(e,{path:n})},ne=function(e){return Q("Hide",e)},ie=function(e){return Q("Show",e)},oe=function(e){return $("showOnly",e)},se=function(e){return $("showAll",e)},q=function(e){return Q("Reframe",e)},{listenTo:function(){return{select:A,addRootNode:x,hideRootNode:z,Show3DViewerCmd:F,change3DVisibilityfromEBOMview:T,LoadIn3DViewer:H,refreshImpacted:_,HideIn3D:ne,ShowIn3D:ie,ShowOnlyIn3D:oe,ShowAllIn3D:se,HideAll:K,connectionAdded:J,connectionRemoved:J,onRecentContentLoaded:Y,ReframeIn3DViewer:q}},onStart:function(t,n){m=e.extend(m,t),b={},o.isOpsViewerWidgetLinked()&&(i.notify("widgetLinked"),C("Remove2DStructure")),o.subscribeEvent("DS/DELExternalWidgetCom/onGetAppStatus",(function(e){!0===e.status?W():o.subscribeEvent("DS/DELExternalWidgetCom/onAppReady",W)})),o.addEventListener("link",k),o.addEventListener("unlink",M),o.subscribeEvent("DS/DELExternalWidgetCom/onSelect",j.bind({isSelected:!0})),o.subscribeEvent("DS/DELExternalWidgetCom/onUnSelect",j.bind({isSelected:!1})),o.subscribeEvent("DS/DELExternalWidgetCom/onUnHighlight",j.bind({isSelected:!1})),o.subscribeEvent("DS/DELExternalWidgetCom/onShow",N.bind({isDisplayed:!0})),o.subscribeEvent("DS/DELExternalWidgetCom/onHide",N.bind({isDisplayed:!1})),n()},onStop:function(){b=null}}}}}));