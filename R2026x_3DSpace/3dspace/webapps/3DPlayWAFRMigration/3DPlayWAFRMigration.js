define("DS/3DPlayWAFRMigration/commandEnabler",["DS/3DPlayWAFRMigration/CommandsManager","DS/WebUtils/Logger"],(function(t,e){"use strict";var n=e("3DPlay.commandEnabler");function i(e,n){if(!e||!e.cmdId)return;let i=t.getCommand(e.cmdId,e.exp.ctx);if(!i)return void(e.ready.cmd=!1);(void 0!==n?n:e.condition)?i.enable():i.disable()}function r(t){t.ready.cmd&&t.ready.event?(t.cb&&(t.condition=t.cb(t.condition)),null!=t.condition&&i(t)):(t.ready.cmd||n.warn(`Waiting cmd for ${t.cmdId}`),t.ready.event||n.warn(`Waiting event for ${t.cmdId}`))}return UWA.Class.extend({init:function(e){if(!e)throw"No options";if(!e.event)throw"No options.event";if(!e.cmdId)throw"No options.cmdId";if(!e.experience)throw"No options.experience";this.cmdId=e.cmdId,this.exp=e.experience,this.cb=e.callBack,this.ready={},void 0!==e.defaultActivation&&i(this,e.defaultActivation);var n=function(){this.cmdId&&(t.hasCommand(this.cmdId,this.exp.ctx)?(this.ready.cmd=!0,r(this)):setTimeout(n,100))}.bind(this);n(),this.token=this.exp.subscribe(e.event,function(t){this.cmdId&&(this.ready.event=!0,this.condition=t,r(this))}.bind(this))},update:function(){r(this)},dispose:function(){this.exp.unsubscribe(this.token),this.token=null,this.cmdId=null,this.exp=null,this.cb=null,this.ready=null}})})),define("DS/3DPlayWAFRMigration/3DPlayCommandsTools",[],(function(){return{isActionBarOpen:function(t){return!(!t||!t.elements||"true"!==t.elements.container.getAttribute("data-open").toLowerCase())}}})),define("DS/3DPlayWAFRMigration/CommandEvent",[],(function(){"use strict";return function(t){return"/WUX/AFR/CMD/"+(t.context||"Default")+"/"+t.ID+"/"}})),define("DS/3DPlayWAFRMigration/WAFR2Utils",["DS/WebUtils/Logger"],(function(t){"use strict";var e=t("3DPlay.WAFR2Utils"),n={disableAFR2:function(t){this.disabled=void 0===t||t},isDisabled:function(){return!this.disabled},isAFR2:function(){return this.isDisabled()&&void 0!==this.getExecutionContext()},setExecutionContext:function(t){this.executionContext=t},getExecutionContext:function(){return this.executionContext},getComponentFromIdentifier:function(t){try{return this.getExecutionContext().getComponent(t)}catch(t){return null}},switchSpecialization:function(t){let e=this.getExecutionContext().switchApp("X3DPLAW_AP",t);return e.then((()=>{n.setCurrentSpecialization(t)})),e},setCurrentSpecialization:function(t){return this.currentSpec=t},getCurrentSpecialization:function(){return this.currentSpec},handleSpecialization:function(t){return new Promise((i=>{require([].concat("DS/3DPlaySupport/ExperiencesList"),(function(r){let o;Object.keys(r).forEach((e=>{r[e].module===t&&(o=r[e].specialisation)})),o||(o="X3DPLAW_AP",this.disableAFR2()),o!==n.getCurrentSpecialization()?(e.log("3DPlay : New specialisazation : ",o,"from",n.getCurrentSpecialization()),n.switchSpecialization(o).then((function(){e.log("3DPlay : Switch done"),i()}))):i()}))}))}};return n})),define("DS/3DPlayWAFRMigration/Framewindow",["DS/3DPlayWAFRMigration/WAFR2Utils","DS/WAfrUIStandardComponents/UIFrame"],(function(t,e){"use strict";return t.setViewer=function(t){this.currentViewer=t},t.onActionBarReady=function(t){t()},t._getAFRUIFrame=function(){return this.getComponentFromIdentifier(e.DEFAULT_COMPONENT_NAME)},t.getActionBar=function(){return null},t.getExperience=function(){return this.experience},t.setExperience=function(t){this.experience=t,this.options={context:t.ctx}},t.getMAB=function(){return this.getExperience().MAB},t.getViewpoint=function(){return this.getViewer().currentViewpoint},t.getContent=function(){return this.getUIFrame().parentElement.parentElement},t.getUIFrame=function(){return this._getAFRUIFrame().getUIFrame()},t.getViewerFrame=function(){return this._getAFRUIFrame().getViewerLayout()},t.getImmersiveFrame=function(){return this._getAFRUIFrame().getImmersiveFrame()},t.setViewer=function(t){this.currentViewer=t},t.getViewer=function(){return this.currentViewer?this.currentViewer:this.getViewerComponent().get3DViewer()},t.getViewerComponent=function(){return this.getExecutionContext().getComponent("Viewer")},t.getContextualUIManager=function(){return this.getComponentFromIdentifier(WAfrStandardComponentKey.UIComponent).getContextualUIComponentManager()},t})),define("DS/3DPlayWAFRMigration/CommandBase",["UWA/Class","DS/3DPlayWAFRMigration/WAFR2Utils","DS/CoreEvents/Events","DS/3DPlayWAFRMigration/CommandEvent"],(function(t,e,n,i){"use strict";return t.extend({subscribeEventCommand:function(t,e){this.tokens.push(n.subscribe({event:this.eventPath+t},e))},destroy:function(){this.tokens.forEach(n.unsubscribe),delete this.tokens,this._destroy&&this._destroy()},enable:function(){n.publish({event:this.eventPath+"ENABLE"})},disable:function(){n.publish({event:this.eventPath+"DISABLE"})},isRunning(){return this.running},isCanceled:function(){return!0===this.canceled},init:function(t,n){if(t.executionContext)this.canceled=!1,this.tokens=[],this.executionContext=t.executionContext,this.getFrameWindow=function(){return e},this.eventPath=i(t),this.subscribeEventCommand("END",function(){this.end()}.bind(this)),this.subscribeEventCommand("CANCEL",function(){this.end()}.bind(this)),this.subscribeEventCommand("CANCELEXECUTE",function(){this.end()}.bind(this)),this.subscribeEventCommand("PAUSEXECUTE",function(){this.running=!1}.bind(this)),this.subscribeEventCommand("RESUMEEXECUTE",function(){this.running=!0}.bind(this));else if(this._parent(t,n),t.arguments)for(var r in t.args={},t.arguments)t.args[t.arguments[r].ID]=t.arguments[r].Value}})})),define("DS/3DPlayWAFRMigration/3DPlayCommandBase",["UWA/Class","DS/CoreEvents/Events","DS/3DPlayWAFRMigration/CommandEvent"],(function(t,e,n){"use strict";return t.extend({destroy:function(){this.token.forEach(e.unsubscribe)},dispose:function(){this.destroy()},init:function(t){if(this.context="Default",!t.commandManager)throw"No commandmanger";if(this.commandManager=t.commandManager,!t.ID)throw"No ID";this.ID=t.ID,this._evtID=n(t),this.enable(),this.token=[e.subscribe({event:this._evtID+"DISABLE"},function(){this.disable()}.bind(this)),e.subscribe({event:this._evtID+"ENABLE"},function(){this.enable()}.bind(this))]},publish:function(t,n){e.publish({event:this._evtID+t,data:n})},globalPublish:function(t){e.publish({event:this._evtID+t,data:this})},subscribe:function(t,n){return e.subscribe({event:this._evtId+t},n)},begin:function(){this.publish("BEGIN")},beginExecute:function(){this.publish("BEGINEXECUTE")},execute:function(){this.publish("EXECUTE")},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},isEnabled:function(){return this.enabled},isRunning:function(){return this.commandManager.getCurrentCmdId()===this.ID},pauseExecute:function(){return this.publish("PAUSEEXECUTE"),!0},resumeExecute:function(){return this.publish("RESUMEEXECUTE"),!0},cancel:function(){this.publish("CANCEL")},cancelExecute:function(){this.publish("CANCELEXECUTE")},end:function(){this.publish("END")},endExecute:function(){this.publish("ENDEXECUTE")},onCommandStart:function(t,e){this.subscribe("BEGIN",t)},onBeginExecute:function(t){this.subscribe("BEGINEXECUTE",t)},onEnd:function(t){this.subscribe("END",t)},onEndExecute:function(t){this.subscribe("ENDEXECUTE",t)}})})),define("DS/3DPlayWAFRMigration/3DPlayCommand",["DS/3DPlayWAFRMigration/3DPlayCommandBase"],(function(t){"use strict";return t.extend({begin:function(){this._parent(),this.commandManager.executeCommand({handlerId:this.ID,args:this.args})},beginExecute:function(){this._parent(),this.commandManager.executeCommand({handlerId:this.ID,args:this.args})},execute:function(){this._parent(),this.commandManager.executeCommand({handlerId:this.ID,args:this.args})}})})),define("DS/3DPlayWAFRMigration/3DPlayCommandCheck",["DS/3DPlayWAFRMigration/3DPlayCommandBase"],(function(t){"use strict";return t.extend({getState:function(){return this.commandManager._getCommandHandler().getCheckState({id:this.ID})},setState:function(t){let e,n=this.commandManager._getCommandHandler();try{e=n.setCheckState({id:this.ID,state:t})}catch(t){console.error(t)}return e},toggleState:function(){return this.commandManager._getCommandHandler().toggleCheck({id:this.ID})},onStateChange:function(t){this.subscribe("UPDATE",t)}})})),define("DS/3DPlayWAFRMigration/CommandsManager",["DS/3DPlayWAFRMigration/WAFR2Utils","DS/ApplicationFrame/CommandsManager","DS/3DPlayWAFRMigration/3DPlayCommand","DS/3DPlayWAFRMigration/3DPlayCommandCheck","DS/WebUtils/Logger"],(function(t,e,n,i,r){var o=r("3DPlay.WAFR2CommandsManagerPolyfill");return t.dispose=function(){Object.keys(this.cmds).forEach((t=>{this.cmds[t].dispose()}))},t.cmds={},t._commandsState={},t._getCommandHandler=function(){return this.getComponentFromIdentifier(WAfrStandardComponentKey.HandlerComponent)},t._getCommandManager=function(){return this.getExecutionContext().getComponent(WAfrStandardComponentKey.CommandsManagerComponent)},t.hasCommand=function(t,n){if(this.isAFR2())return this._getCommandHandler().hasHandler(t);n||(n="Default",o.error("DS/3DPlayWAFRMigration/CommandsManager:hasCommand ctx is undefined"));let i=e.getCommands(n);return i&&void 0!==i[t]},t.hasCheckHandler=function(t){return this._getCommandHandler().hasCheckHandler(t)},t.executeCommand=function(t){return new Promise(function(t,e){let n=0,i=this.cmds[this._getCommandManager().getRunningCommand()];i&&(o.warn("executeCommand.endCommand:",this._getCommandManager().getRunningCommand()),i.end(),n=500),setTimeout(t,n)}.bind(this)).then(function(){o.warn("executeCommand.executeHandler:",t.handlerId),this._getCommandHandler().executeHandler({id:t.handlerId,args:t.args}).then((e=>{o.warn("executeCommand.ended",t.handlerId,e.getReturnValue(),e.getError()?e.getError():""),e.getReturnValue&&"SUCCEEDED"!==e.getReturnValue().internalValue&&o.warn(e.getError(),e.getDescription(),e.getReturnValue(),t)})).catch((e=>(e?o.error(t.handlerId,e.getReturnValue?e.getReturnValue():"",e.getError()?e.getError():""):o.error(t.handlerId),Promise.reject(e))))}.bind(this))},t.getCommandCheckHeader=function(t,n){let r;return this.isAFR2()?(r=this.cmds[t],!r&&this.hasCheckHandler(t)&&(r=new i({ID:t,context:n,commandManager:this}),this.cmds[t]=r)):r=e.getCommandCheckHeader(t,n),r},t.getCommand=function(t,i){let r;return this.isAFR2()?(r=this.cmds[t],!r&&this.hasCommand(t)&&(r=new n({ID:t,context:i,commandManager:this}),this.cmds[t]=r)):(i||(i="Default",o.warn("DS/3DPlayWAFRMigration/CommandsManager:getCommand ctx is undefined")),r=e.getCommand(t,i)),r},t.getCommands=function(t){if(this.isAFR2())throw new Error("GetCommands is not supported anymore in WebAFR");return e.getCommands(t)},t.getCommandCheckHeaders=function(t,n){if(this.isAFR2())throw new Error("getCommandCheckHeaders is not supported anymore in WebAFR");return e.getCommandCheckHeaders(n)},t.getCurrentCmdId=function(t){return this.isAFR2()?this._getCommandManager().getRunningCommand():e.getCurrentCmdId(t)},t.searchCommand=function(t,e){let n=this.getCommand(t,e);return n||(n=this.getCommandCheckHeader(t,e)),n||o.warn(t+" NOT found in "+e),n},t.endAll=function(t,n){this.isAFR2()?document.dispatchEvent(new KeyboardEvent("keydown",{keyCode:27})):e.endAll(t,n)},t.resetDefaultCommand=function(t){this.isAFR2()?o.warn("resetDefaultCommand is there something to do ?"):e.resetDefaultCommand(t)},t._reset=function(){this.isAFR2()?o.warn("resetDefaultCommand is there something to do ?"):e._reset()},t})),define("DS/3DPlayWAFRMigration/CommandCheckHeader",["DS/ApplicationFrame/CommandCheckHeader","DS/3DPlayWAFRMigration/CommandBase","DS/CoreEvents/Events","DS/3DPlayWAFRMigration/CommandsManager"],(function(t,e,n,i){"use strict";return i.isAFR2()?e.extend({init:function(t,e){this._parent(t,e),t.executionContext&&(this.getState=function(){return this.state},this.setState=function(t){this.state!=t&&(this.state=t,n.publish({event:this.eventPath+"UPDATE"}))},this.onStateChange=function(t){return n.subscribe({event:this.eventPath+"UPDATE"},t)},this.subscribeEventCommand("TOGGLECHECK",function(){this.end(),this.done()}.bind(this)))}}):t})),define("DS/3DPlayWAFRMigration/Command",["DS/ApplicationFrame/Command","DS/3DPlayWAFRMigration/CommandBase","DS/3DPlayWAFRMigration/CommandsManager"],(function(t,e,n){"use strict";return(n.isAFR2()?e:t.extend({init:function(t,e){if(this._parent(t,e),t.arguments)for(var n in t.args={},t.arguments)t.args[t.arguments[n].ID]=t.arguments[n].Value}})).extend({beginExecute:function(){this.executionContext&&this.execute()},end:function(){this.executionContext?(this.isEndExectute||(this.isEndExectute=!0,this.endExecute()),this.running=!1,this.cancelled=!0,this.isEndExectute=!1,this.done()):this._parent()},AFR2_Done:function(){this.executionContext&&this.done()},AFR2_Execute:function(){this.executionContext&&this.execute()},AFR2_isRunning:function(){return!!this.executionContext}})}));