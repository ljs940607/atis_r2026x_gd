"use strict";define("DS/VCXWebTracks/VCXKey",["require","exports"],(function(e,t){class r{constructor(e,t){this._isVolatile=!1,this._easing="EEasingLinear",this._frame=e,this._value=t}Copy(e){this._frame=e._frame,this._value=e._value}SetFrame(e){this._frame=e}GetFrame(){return this._frame}SetIsVolatile(e){this._isVolatile=e}GetIsVolatile(){return this._isVolatile}SetEasing(e){this._easing=e}GetEasing(){return this._easing}SetValue(e){this._value=e}GetValue(){if(!this._value)throw new Error("Unsupported getValue");return this._value}Clone(){return new r(this._frame,this._value)}}return r})),define("DS/VCXWebTracks/VCXEasing",["require","exports"],(function(e,t){return class{static easeInOutPower3(e,t,r){return e<.5?t+e*e*e*4*(r-t):r+(e=1-e)*e*e*4*(t-r)}static easeLinear(e){return e}static easeInCubic(e){return Math.pow(e,3)}static easeOutCubic(e){return 1-Math.pow(1-e,3)}static easeInOutCubic(e){return e<.5?4*Math.pow(e,3):1-Math.pow(-2*e+2,3)/2}}})),define("DS/VCXWebTracks/VCXInterpolator",["require","exports"],(function(e,t){class r{}return function(e){let t;!function(e){e[e.Linear=0]="Linear",e[e.Cubic=1]="Cubic",e[e.Custom=2]="Custom",e[e.Smooth=5]="Smooth"}(t=e.EInterpolationType||(e.EInterpolationType={}))}(r||(r={})),r}));var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebTracks/VCXInterpolatorConstant",["require","exports","DS/VCXWebTracks/VCXInterpolator"],(function(e,t,r){r=__importDefault(r);class a extends r.default{GetType(){return"VCXInterpolatorConstant"}GetInterpolatedValue(e,t,r,a){var n=null;a&&(n=a[t]);var l=null;if(n&&(l=n.GetPreviousKey(r)),l)return l.GetValue();if(e){var i=e.GetProperty(t);if(i)return i.GetPropertyValue()}return null}}return a}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebTracks/VCXTrack",["require","exports","DS/WebRBTree/WebRBTree","DS/WebRBTree/WebRBIterator","DS/VCXWebTracks/VCXKey"],(function(e,t,r,a,n){n=__importDefault(n);let l=(e,t)=>e.GetFrame()-t.GetFrame();class i{constructor(){this.easing=null,this._objectAnimation=null,this._treekeys=new r(l),this._rangeok=!1,this._lastKeyInf=null,this._lastKeySup=null}unInitialize(){this._objectAnimation=null,this._rangeok=!1,this._lastKeyInf=null,this._lastKeySup=null,this._treekeys=null}SetObjectAnimation(e){this._objectAnimation=e}GetObjectAnimation(){return this._objectAnimation}SetBoostDirty(){this._objectAnimation&&this._objectAnimation.SetBoostDirty()}AddKey(e){this.SetBoostDirty();var t=this._treekeys.findIter(e);if(t){var r=t.data();r?.SetValue(e.GetValue())}else this._treekeys.insert(e);this._rangeok=!1,this._lastKeyInf=null,this._lastKeySup=null}RemoveKey(e){this.SetBoostDirty();var t=new n.default(e);t.SetFrame(e),this._treekeys.remove(t),this._rangeok=!1,this._lastKeyInf=null,this._lastKeySup=null}GetKey(e){var t=new n.default(e),r=this._treekeys.findIter(t);return r?r.data():null}GetKeysForLinearInterpolationREF(e){if(this._rangeok&&(this._lastKeyInf&&e<this._lastKeyInf.GetFrame()&&(this._rangeok=!1),this._lastKeySup&&e>=this._lastKeySup.GetFrame()&&(this._rangeok=!1),this._rangeok))return{keyInf:this._lastKeyInf,keySup:this._lastKeySup,bRangeChanged:!1};var t=new n.default(e),r=this._treekeys.lowerBound(t),a=r.data();r.next();var l=r.data();return this._rangeok=!0,this._lastKeyInf=a??null,this._lastKeySup=l??null,{keyInf:this._lastKeyInf,keySup:this._lastKeySup,bRangeChanged:!0}}GetKeysForCubicInterpolation(e){let t=new n.default(e),r=this._treekeys.lowerBound(t),a=r.data(),l=this._treekeys.lowerBound(t).prev();r.next();let i=r.data(),u=r._cursor,o=r.next();return{keyInf:a?.Clone()??null,keyInf2:l?.Clone()??null,keySup:i?.Clone()??null,keySup2:void 0!==u&&o?o.Clone():null}}GetSize(){return this._treekeys.size}GetPreviousKey(e){var t=new n.default(e),r=this._treekeys.lowerBound(t).data();return null===r?null:r}GetPreviousStrictKey(e){var t=new n.default(e),r=this._treekeys.lowerBound(t).data();return null===r?null:(r.GetFrame()===e&&(r=this._treekeys.lowerBound(t).prev()),r)}GetNextStrictKey(e){var t=new n.default(e),r=this._treekeys.upperBound(t).data();return null===r?null:(r.GetFrame()===e&&(r=this._treekeys.lowerBound(t).next()),r)}GetMaxFrame(){var e=0,t=this._treekeys.max();return null!==t&&(e=t.GetFrame()),e}IsEmpty(){return null===this._treekeys.max()}GetIterator(){var e=this._treekeys;return new a(e)}IsConstant(){let e=null;for(var t=this.GetIterator(),r=t.next();null!==r;){var a=r.GetValue();if(console.log("            "+r.GetFrame()+"   "+a.ToString()),e){if(!e.IsEqualTo(a))return!1}else e=a;r=t.next()}return!0}Clone(){for(var e=new i,t=this._treekeys,r=new a(t),n=r.next();null!==n;){var l=n.Clone();e.AddKey(l),n=r.next()}return e}ResetRangeCache(){this._rangeok=!1}}return i}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebTracks/VCXInterpolatorCubic",["require","exports","DS/VCXWebTracks/VCXInterpolator","DS/VCXWebTracks/VCXKey"],(function(e,t,r,a){r=__importDefault(r),a=__importDefault(a);class n extends r.default{GetType(){return"VCXInterpolatorCubic"}GetInterpolatedValue(e,t,r,n){let l=null;n&&(l=n[t]);let{keyInf:i,keyInf2:u,keySup:o,keySup2:s}=l?.GetKeysForCubicInterpolation(r)??{keyInf:null,keyInf2:null,keySup:null,keySup2:null};if(null===i){var h=e?.GetProperty(t);if(!h)return null;i=new a.default(0,h.GetPropertyValue())}null===u&&(u=i.Clone()),null===o&&(o=i.Clone()),null===s&&(s=o.Clone());var p=u.GetValue(),_=i.GetValue(),y=o.GetValue(),f=s.GetValue(),m=1;return o.GetFrame()!==i.GetFrame()&&(m=(r-i.GetFrame())/(o.GetFrame()-i.GetFrame())),_.GetCubicInterpolatedValue(p,_,y,f,u.GetFrame(),i.GetFrame(),o.GetFrame(),s.GetFrame(),m)}}return n}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebTracks/VCXInterpolatorLinear",["require","exports","DS/VCXWebTracks/VCXInterpolator","DS/VCXWebTracks/VCXKey","DS/VCXWebTracks/VCXEasing"],(function(e,t,r,a,n){r=__importDefault(r),a=__importDefault(a),n=__importDefault(n);class l extends r.default{constructor(){super(),this._rangeChanged=!1}GetType(){return"VCXInterpolatorLinear"}SetRangeChanged(e){this._rangeChanged!==e&&(this._rangeChanged=e)}GetRangeChanged(){return this._rangeChanged}GetInterpolatedValue(e,t,r,l){var i=null;l&&(i=l[t]);let{keyInf:u,keySup:o,bRangeChanged:s}=i?.GetKeysForLinearInterpolationREF(r)??{keyInf:null,keySup:null,bRangeChanged:!1};if(this.SetRangeChanged(s),null===u){var h=e?.GetProperty(t);if(!h)return null;u=new a.default(0,h.GetPropertyValue())}if(!o)return u.GetValue();var p=u.GetValue(),_=o.GetValue(),y=(r-u.GetFrame())/(o.GetFrame()-u.GetFrame());if(i?.easing)y=i.easing(y,0,1);else switch(u.GetEasing()){case"EEasingInCubic":y=n.default.easeInCubic(y);break;case"EEasingOutCubic":y=n.default.easeOutCubic(y);break;case"EEasingInOutCubic":y=n.default.easeInOutCubic(y);break;default:y=n.default.easeLinear(y)}return p.GetInterpolatedValue(p,_,y)}}return l}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebTracks/VCXInterpolatorSpherical",["require","exports","DS/VCXWebTracks/VCXInterpolator","DS/VCXWebProperties/VCXPropertyValueFrame","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebTracks/VCXKey","DS/VCXWebTracks/VCXInterpolatorLinear"],(function(e,t,r,a,n,l,i,u){r=__importDefault(r),a=__importDefault(a),l=__importDefault(l),i=__importDefault(i),u=__importDefault(u);class o extends r.default{constructor(){super(...arguments),this._targetPropertyName="",this._positionPropertyName="",this._orthoPropertyName="",this._anglePropertyName="",this._heightPropertyName=""}GetType(){return"VCXInterpolatorSpherical"}setTargetPropertyName(e){this._targetPropertyName=e}setPositionPropertyName(e){this._positionPropertyName=e}setOrthoPropertyName(e){this._orthoPropertyName=e}setAnglePropertyName(e){this._anglePropertyName=e}setHeightPropertyName(e){this._heightPropertyName=e}GetInterpolatedValue(e,t,r,o){if(null===o){if(e){let t=this._positionPropertyName&&e.GetProperty(this._positionPropertyName);if(t)return t.GetPropertyValue().GetValueFrame()}return null}var s=o[this._positionPropertyName],h=o[this._targetPropertyName];if(!s||!h){if(!s&&!h)return null;console.warn("Case not handled. Show this to ITY")}let{keyInf:p,keySup:_}=s?.GetKeysForLinearInterpolationREF(r)??{keyInf:null,keySup:null};if(null===p){var y=e?.GetProperty(this._positionPropertyName);y&&(p=new i.default(0,y.GetPropertyValue()))}let f=p||_,m=_||p;if(!f||!m)return null;var V=f.GetValue(),d=m.GetValue();if(!(V instanceof l.default&&d instanceof l.default))throw new Error("Illegal Argument, interpolatorCylindrical is only compatible with VCXPropertyValueFrame");var G=0;m.GetFrame()-f.GetFrame()&&(G=(r-f.GetFrame())/(m.GetFrame()-f.GetFrame())),s?.easing&&(G=s.easing(G,0,1));var c=new u.default,C=c.GetInterpolatedValue(e,this._targetPropertyName,f.GetFrame(),o),I=c.GetInterpolatedValue(e,this._targetPropertyName,m.GetFrame(),o);if(!C||!I)return null;var g,k,S,b,F=C.GetInterpolatedValue(C,I,G),P=(new n.Matrix4).getInverse(C.GetValueFrame().Value).multiply(V.GetValueFrame().Value),D=(new n.Matrix4).getInverse(I.GetValueFrame().Value).multiply(d.GetValueFrame().Value),v=new a.default(P),X=new a.default(D),w=v.GetInterpolatedValue(v,X,G),K=(new n.Vector3).getPositionFromMatrix(v.Value).length(),T=c.GetInterpolatedValue(e,this._orthoPropertyName,f.GetFrame(),o);T?.Value?(k=c.GetInterpolatedValue(e,this._heightPropertyName,f.GetFrame(),o)?.Value,g=360*Math.atan(k/K)/Math.PI):(g=c.GetInterpolatedValue(e,this._anglePropertyName,f.GetFrame(),o)?.Value,k=Math.tan(.5*g*Math.PI/180)*K);var x=(new n.Vector3).getPositionFromMatrix(X.Value).length(),N=c.GetInterpolatedValue(e,this._orthoPropertyName,m.GetFrame(),o);N?.Value?(b=c.GetInterpolatedValue(e,this._heightPropertyName,m.GetFrame(),o)?.Value,S=360*Math.atan(b/x)/Math.PI):(S=c.GetInterpolatedValue(e,this._anglePropertyName,m.GetFrame(),o)?.Value,b=Math.tan(.5*S*Math.PI/180)*x);var M=g*(1-G)+S*G,W=(k*(1-G)+b*G)/Math.tan(.5*M*Math.PI/180);return w.Value.elements[14]=W,new a.default((new n.Matrix4).multiplyMatrices(F.GetValueFrame().Value,w.Value))}}return o}));