define("DS/DELWKOProductFlowSequenceModule/DELWKOProductFlowComponent",["UWA/Core"],(function(e){"use strict";return function(t,n){var o,i,r,a,c,s,d,l,u,f,g,p,h,m,y,P,I,v,D,E,C,L,N,w,R,S,T,k,A,b,F,x,M,O,V,B,G,j,W,_=t.getComponent("EGraphCore"),U=t.getComponent("EGraphViews"),K=t.getComponent("EGraphIact"),H=t.getComponent("EGraphUtils"),Y=(t.getComponent("Button"),t.getComponent("Breadcrumb"),t.getComponent("ContextualMenuManager")),X=t.getComponent("TooltipModel"),Q="SEQUENCE",q="HIERARCHY",z=0,$=!1,Z={},J=[];return r=!!e.is(n.readOnly)&&n.readOnly,s=e.is(n.nodes)?n.nodes:[],d=e.is(n.links)?n.links:[],!!e.is(n.detectLoop,"boolean")&&n.detectLoop,a=e.is(n.nodeOptions)?n.nodeOptions:[],l=e.is(n.identifier)?n.identifier:"",u=e.is(n.getNodeContextMenu,"function")?n.getNodeContextMenu:null,f=e.is(n.getLinkContextMenu,"function")?n.getLinkContextMenu:null,p=e.is(n.onConnectingNodes)?n.onConnectingNodes:null,e.is(n.onNodeSelection)?n.onNodeSelection:null,A=e.is(n.onNodeDoubleClick,"function")?n.onNodeDoubleClick:null,B=e.is(n.onNodeSelectionChange,"function")?n.onNodeSelectionChange:null,i=function(){U.HTMLNodeView.call(this)},o=function(e){U.SVGEdgeView.call(this,e)},function(){}.prototype.onupdate=function(e){var t,n,o,i,r;t=e.cl1.c.aleft,i=e.cl1.c.atop,o=e.cl2.c.aleft,r=e.cl2.c.atop,n=.5*(t+o),e.set("path",[_.PathCmd.M,t,i,_.PathCmd.L,n,i,_.PathCmd.L,n,r,_.PathCmd.L,o,r])},o.prototype.createTextEdgeView=function(e,t,n){var o,i="http://www.w3.org/2000/svg";(o=document.createElementNS(i,"textPath")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.display.elt.id),o.setAttribute("startOffset","10%"),""===e.mark?o.appendChild(document.createTextNode("")):e.mark.hasOwnProperty(t)&&(o.appendChild(document.createTextNode(e.mark[t])),n++),this.display.text=document.createElementNS(i,"text"),this.display.text.setAttribute("dy",-14*(n-1)+12),this.display.text.grElt=e,H.classListAdd(this.display.text,"edge-text"),this.display.text.appendChild(o),""!==o.innerHTML&&this.structure.root.appendChild(this.display.text)},o.prototype.oncreateDisplay=function(e){var t=this,n=0;U.SVGEdgeView.prototype.oncreateDisplay.apply(this,arguments),this.display.elt.id=Math.random(),this.display.elt.textContent="official",infos="Type",Array.isArray(infos)||(infos=[infos]),infos.forEach((function(o){t.createTextEdgeView(e,o,n),n++}))},v=function(e){return/^(auto|0)$|^[+-]?[0-9]+.?([0-9]+)?(px|em|ex|%|in|cm|mm|pt|pc|rem)$/.test(e)},k=function(){return c===Q},m=function(){var t=e.createElement("div",{class:"input-node my-node"}),n=e.createElement("img",{class:"my-node-type-img"}),o=e.createElement("div",{class:"my-node-container"}),i=e.createElement("div",{class:"my-node-col left"}),r=e.createElement("div",{class:"my-node-col right"}),a=e.createElement("div",{class:"myNodeLinkEdit"}),c=e.createElement("div",{class:"my-node-text"});return t.setStyles({width:"50px",height:"50px"}),c.setStyles({top:"0px"}),r.appendChild(c),t.appendChild(n),t.appendChild(o),t.appendChild(i),t.appendChild(r),t.appendChild(a),t},P=function(t,n){var o,i=n.grElt,a=n.clientPos[0],c=n.clientPos[1];e.is(i)&&!r&&(i.type===_.Type.NODE?(e.is(i.gr.selection.first)&&i.gr.selection.first.PID!==i.PID?(h.removeFromSelection(i.gr.selection.first),h.addToSelection(i)):null===i.gr.selection.first&&h.addToSelection(i),u&&(o=u(i.model))):i.type===_.Type.EDGE&&e.is(i.mark)&&f&&(o=f(i.mark)),e.is(o)&&(o=Array.isArray(o)?o:[o],Array.isArray(o)&&Y.show({nodes:o},[a,c])))},N=function(e,t,n){var o;return 40,o=new _.Connector,!0===n&&(o.views.main=new U.SVGConnView("egraph_views_SVGConnView egraph_views_mySVGConnView")),o.multiset(["cstr","attach"],e,["cstr","offset"],40),o},w=function(t){e.is(t.connectors)||(t.connectors={}),t.connectors.in=N(_.BorderCstr.LEFT,0,!0),t.connectors.in.id="in_"+t.id,t.appendConnector(t.connectors.in),t.connectors.out=N(_.BorderCstr.RIGHT,0,!0),t.connectors.out.id="out_"+t.id,t.appendConnector(t.connectors.out),c===q&&(t.connectors.outInstance=N(_.BorderCstr.BOTTOM,0,!1),t.appendConnector(t.connectors.outInstance))},R=function(t,n,i){var r,a;return a="-productFlow",e.is(i.linkInfo.subType)&&("DELLmiTimeConstraintCnx_FinishToStart"===i.linkInfo.subType||"DELLmiTimeConstraintCnx_StartToStart"===i.linkInfo.subType||"DELLmiTimeConstraintCnx_FinishToFinish"===i.linkInfo.subType?a="-timeConstraint":"DELLmiExecTimeConstraintFailed"===i.linkInfo.subType||"Failed"===i.linkInfo.subType?a="-timeConstraint-Failed":"DELLmiExecTimeConstraintAlternative"===i.linkInfo.subType||"Alternative"===i.linkInfo.subType?a="-timeConstraint-Alternative":"DELLmiExecTimeConstraintScrapped"!==i.linkInfo.subType&&"Scrapped"!==i.linkInfo.subType||(a="-timeConstraint-Scrapped")),(r=new _.Edge).set("geometry",new _.AutoBezierGeometry),r.views.main=new o("egraph_views_SVGEdgeView my-sec-edge-view"+a),r.mark=i,h.addEdge(t,n,r),r},G=function(t,n){var o="";a.forEach((function(i){var r=Array.isArray(i)?i:[i],a=new e.Element("div",{class:"my-node-line"});r.forEach((function(n){var i,c,s=new e.Element("span",{class:"my-node-word"}),d="";n.fontSize&&v(n.fontSize)&&(c=n.fontSize),i=n.maxWidth&&v(n.maxWidth)?n.maxWidth:100/r.length+"%",e.is(t[n.property])&&(n.displayTitle&&(d=n.title+" : "),d+=t[n.property]),s.setText(d),s.setStyles({fontWeight:n.fontWeight,color:n.color,maxWidth:i,fontSize:c}),o+=d,o+=" ",s.inject(a)})),o+="\n",a.inject(n)})),n.tooltipInfos=new X({shortHelp:o})},I=function(t,n,o){var r=new _.Node,c=t.id;return c=c.replace(new RegExp(",","g"),"_"),r.views.main=new i,r.model=t,r.PID=t.id,r.id="node_"+c,r.multiset("left",n,"top",o,"width",250,"height",90),w(r),i.prototype.buildNodeElement=function(t){var n,o,i,r;return e.is(t)&&(o=t.model,(n=m()).addClassName("egraph_views_HTMLNodeView_Node "+o.className+" "+o.id),e.is(o.icon)&&e.is(o.icon.iconPath)&&(i=n.getElementsByClassName("my-node-type-img")[0],e.is(i)&&(i.src=o.icon.iconPath))),r=n.getElementsByClassName("my-node-container")[0],e.is(o)&&e.is(r)&&a.length>0&&G(o,r),n},r},L=function(){var t,n,o,i,r=e.extendElement(document.createElementNS("http://www.w3.org/2000/svg","svg")),a=e.extendElement(document.createElementNS("http://www.w3.org/2000/svg","defs")),c=e.extendElement(document.createElementNS("http://www.w3.org/2000/svg","marker")),s=e.extendElement(document.createElementNS("http://www.w3.org/2000/svg","path"));r.appendChild(a),a.appendChild(c),c.appendChild(s),r.setAttribute("width","0"),r.setAttribute("height","0"),r.setAttribute("style","position:absolute;"),c.setAttribute("id","arrow-edge-end-marker"),c.setAttribute("markerWidth","10"),c.setAttribute("markerHeight","8"),c.setAttribute("refX","8"),c.setAttribute("refY","4"),c.setAttribute("orient","auto"),s.setAttribute("d","M 0 0 L 10 4 L 0 8"),s.setAttribute("fill","#777"),s.setAttribute("stroke","none"),s.setAttribute("z-index","10"),(t=c.cloneNode(!0)).setAttribute("id","arrow-edge-end-productFlowMarker"),a.appendChild(t),(n=c.cloneNode(!0)).setAttribute("id","arrow-edge-end-timeConstraintMarker"),a.appendChild(n),(o=c.cloneNode(!0)).setAttribute("id","arrow-edge-end-timeConstraint-Alternative-Marker"),a.appendChild(o),(i=c.cloneNode(!0)).setAttribute("id","arrow-edge-end-timeConstraint-Failed-Marker"),a.appendChild(i),(D=e.createElement("div",{class:"canvas-gv",id:"canvas-"+l})).addEvent("contextmenu",(function(t){e.Event.stop(t)})),D.setStyles({width:"100%",height:"calc(100% - 52px)","background-color":"white",position:"relatve"}),D.appendChild(r)},W=function(e){U.SVGEdgeView.prototype.oncreateDisplay.apply(this,arguments),this.display.elt.textContent="official",this.display.elt.setAttribute("data-link-type-nls",e.mark.linkInfo.NLS),this.display.elt.setAttribute("data-link-from",e.mark.fromNodeId),this.display.elt.setAttribute("data-link-to",e.mark.toNodeId)},y=function(){var e,t;return H.inherit(i,U.HTMLNodeView),H.inherit(o,U.SVGEdgeView),o.prototype.oncreateDisplay=W,(e=new _.EGraph).setViewOpts({addTopologicalIds:!0}),e.addView("main",new U.HTMLGraphView(D)),(t=new K.StateMachine(e,null,null,e.views.main)).rootState&&(A&&(t.rootState.doubleClickOnNode=A),t.rootState.oncontextmenu=P),e.setZoomOpts({customMgt:!0}),t.state.onwheel=function(e,t){if(t.inside){var n=e.graphView;if(n.zoominc){var o=D.getBoundingClientRect();n.zoominc(.5*t.wheelDelta,t.clientPos[0]-o.x,t.clientPos[1]-o.y)}}},e.updateLock(),e},C=function(){var e,t,n;for(n=new H.BoundingRect,e=h.nodes.first;e;e=_.dftNext(h,e))n.update(e,e.actualLeft-300,e.actualLeft+e.actualWidth,e.actualTop,e.actualTop+e.actualHeight);t=H.reframeViewpoint(h.views.main.getSize(),n,{padding:15,minSize:50,horizontal:-1,vertical:-1,aliasing:0,defaultVpt:h.views.main.vpt,maxScale:1}),h.views.main.setViewpoint(t,!0)},g=function(){var t,n,o,i=!0;h.addChangeListener((function(a){var c,s;"edges"===a[0].path[0]&&(c=a[0].child.cl2.c,s=a[0].child.cl1.c,null!==c&&null!==s&&e.is(c.node.model)&&e.is(s.node.model)&&(e.is(a[0].child.geometry)||!p||r||p(s.node.model,c.node.model),setTimeout((function(){if(e.is(D))for(t=D.getElements("path"),n=0;n<t.length;n++)"official"!==t[n].innerHTML&&(o=window.getComputedStyle(t[n]),"none"===o.getPropertyValue("marker-end")&&"arrow-edge-end-marker"!==t[n].parentElement.id&&t[n].parentElement.removeChild(t[n]))}),500))),i||(i=a.some((function(e){return"selection"===e.path[0]})))})),h.addListener("update",(function(t){var n,o,a,c=[];if(i&&!r){if(i=!1,$)return void($=!1);for(var s in Z)Z.hasOwnProperty(s)&&Z[s]&&c.push(s);for(Z={},n=h.selection.first;n;n=n.nextSel)o=n.model,e.is(o)&&!Z[n.PID]&&(a=o,Z[n.PID]=!0);B&&(e.is(a)||c.length>0)&&B(a,c)}}))},S=function(e){var t,n={},o=0;for(e=Array.isArray(e)?e:[e],t=h.nodes.first;t&&(e.indexOf(t.PID)>-1&&(n[t.PID]=t,o++),o!==e.length);t=_.dftNext(h,t));return n},x=function(e){var t,n=[];for(e=Array.isArray(e)?e:[e],t=h.edges.first;t;t=t.next)e.indexOf(t.mark.id)>-1&&n.push(t);return n},b=function(){d.forEach((function(e){var t=S([e.fromNodeId,e.toNodeId]);R(t[e.fromNodeId].connectors.out,t[e.toNodeId].connectors.in,e)}))},F=function(){var t,n,o={},i={},r={},a={},c={},l={},u={},f=function c(s){if(t=r[s],n=a[s],!e.is(i[s])){if(e.is(o[n+","+t])){for(;e.is(o[n+","+t]);)n++;o[n+","+t]=s}else o[n+","+t]=s;if(i[s]={x:n,y:t},!e.is(u[s]))return;u[s].forEach((function(e){c(e)}))}};d.forEach((function(t){e.is(u[t.fromNodeId])||(u[t.fromNodeId]=[]),u[t.fromNodeId].push(t.toNodeId)})),s.forEach((function(o,i){t=parseInt(o.position.x),n=parseInt(o.position.y),r[o.id]=t,l[o.id]=i,e.is(a[o.id])?n=a[o.id]:a[o.id]=n,c[o.id]=!0,e.is(u[o.id])&&u[o.id].forEach((function(e){c[e]=!1}))})),(c=e.Object.keys(c).filter((function(e){return c[e]}))).forEach((function(e){f(e),z++})),s.forEach((function(e){var t=I(e,450*i[e.id].x,150*i[e.id].y);h.addNode(t)}))},T=function(){return s.some((function(t){return-1==J.indexOf(t.PPRType)&&J.push(t.PPRType),e.is(t.parentId)}))?q:Q},E=function(){if(!e.is(h)){h=y(),c=T();try{k()&&F(),b()}finally{h.updateUnlock()}g(),C()}},M=function(t){var n=S([t.fromNodeId,t.toNodeId]);2==e.Object.keys(n).length&&R(n[t.fromNodeId].connectors.out,n[t.toNodeId].connectors.in,t)},O=function(e){var t;try{k()&&(h.updateLock(),t=I(e,0,150*z),z++,h.addNode(t))}finally{h.updateUnlock()}},V=function(e){var t,n=S([e]);for(t in n)n.hasOwnProperty(t)&&h.removeNode(n[t])},j=function(t,n){var o,i=S([t]);i=i[t],e.is(i)&&(i.model=e.extend(i.model,n),(o=i.view.elts.node.getElementsByClassName("my-node-container")[0]).innerHTML="",G(i.model,o))},{init:function(){L()},inject:function(e){D.inject(e)},createGraphComponent:function(){E()},destroy:function(){D.remove(),D.destroy(),D=void 0},addLink:function(e){M(e)},removeLink:function(e){x(e).forEach((function(e){e.remove()}))},addNode:function(e){O(e)},removeNode:function(e){V(e)},selectNode:function(e){var t,n=S([e]);for(t in n)n.hasOwnProperty(t)&&(Z[t]=!0,$=!0,h.addToSelection(n[t]))},unselectNode:function(e){var t,n=S([e]);for(t in n)n.hasOwnProperty(t)&&(Z[t]=!1,$=!0,h.removeFromSelection(n[t]))},updateNode:function(e,t){j(e,t)}}}})),define("DS/DELWKOProductFlowSequenceModule/DELWKOProductFlowSequenceModuleCloud",["UWA/Core","DS/DELWKOProductFlowSequenceModule/DELWKOProductFlowComponent","DS/DELPPWProductFlowSequenceModule_FD02/GraphPanel","DS/DELWKONavigationServices/DELWKONavigateUtil"],(function(e,t,n,o){"use strict";return{behaviors:["UXFactoryBehavior","ModelBehavior","ResourceBehavior","SelectionBehavior","EditAttributeBehavior","LinkBehavior","ProductFlowLinkBehavior","RootsBehavior"],creator:function(i,r,a,c,s,d,l,u,f){var g,p,h,m,y,P,I,v,D,E,C,L=["WORKORDER","EXECHEADER","OPERATION","STEP"],N="PPR-PERTVIEW",w=!1,R=!1,S=!1,T=r.getComponent("Breadcrumb"),k=r.create("WUXLoader",{showButtonFlag:!1}),A=r.getComponent("ModalContainer"),b=e.createElement("div",{class:"pert-loading-cont"}),F=r.getComponent("WUXCommandsManager"),x=u.getProductFlowRelationTypes(),M=function(){var t=c.getIconURLFromKey("Refresh"),n=e.createElement("img",{src:t,class:"GraphViewBar refresh-btn"});e.is(v)&&(v.remove(),v.empty(!0)),v=e.createElement("div",{class:"egraph-toobar"}),n.addEvent("click",(function(){Y()})),V(y.id,y.path).inject(v),n.inject(v),v.inject(D)},O=function(t){var n=t.model,o={objectId:n.referencePID};e.is(C)&&(o.filterQuery=C),K(o).then((function(){y.id=e.is(n.instancePID)?n.instancePID:n.referencePID,y.path=n.occcurancePath,X()}))},V=function(t,n){var o,r,s,d,l,u=e.createElement("div",{class:"egraph-navigator"}),f=[],g=function(e,t,n){s&&f.unshift({label:s.get("V_Name"),icon:c.getIconURLFromKey(s.get("type")),id:t,path:n})};if(e.is(n,"string")&&(n=n.split(",")),0===n.length)g(0,(s=a.getReference(t)).get("PID"),[]);else for(l=n.length-1;l>=0;l--)d=n[l],s=a.getReferenceModel(d),g(0,d,n.slice(0,l+1)),0===l&&(r=a.getInstance(d),g(0,(s=a.getAggregatingReferenceModelFromInstance(r)).get("PID"),[]));return f.length>0&&(o=new T({value:f,mode:T.MODE.NAVIGATION})).addEventListener("selectionChange",(function(){var e;i.notify("EGraphNodeSelect",{selectedNodeIds:[y.id]}),R=!0,e=o.selectedValues[0],y=e,Y()})),o.inject(u),u},B=function(t,n){var o,i,r=[],s=[],d=[],u=[];return o=a.getReferenceModel(t),((i=function(){var t,n,o;return e.is(C)?t=C:e.is(y)&&(0===y.path.length?n=y.id:(o=a.getInstance(y.path[0]),n=(o=a.getReference(o.get("isAggregatedBy"))).get("PID")),n&&(t=f.getRootFilter(n),t=e.is(t)&&e.is(t.originalFilterQuery)?t.originalFilterQuery:void 0)),t}())?a.getFilteredInstancesFromCollection(o.get("PID"),i):a.getInstancesFromCollection(o.get("PID"))).forEach((function(t){var o,i,s,l=t.get("PID"),f=n.concat([l]);s=a.getReferenceModelFromInstance(t),L.indexOf(s.get("PPRTYPE"))>-1&&(r.push(l),u.push({id:l}),o={id:f.toString(),PPRType:s.get("PPRTYPE"),instancePID:l,referencePID:s.get("PID"),occcurancePath:f,className:" EGraph_obj_"+s.get("PPRTYPE"),icon:{iconPath:c.getIconURLFromKey(s.get("type"))},position:{x:t.get("V_X2DPos")?t.get("V_X2DPos"):0,y:t.get("V_Y2DPos")?t.get("V_Y2DPos"):0}},P.forEach((function(n){(Array.isArray(n)?n:[n]).forEach((function(n){i=t.get(n.property),o[n.property]="NULL"!==i&&e.is(i)?i:s.get(n.property)}))})),d.push(o))})),function(t){return a.isNavigateOnDemand()?(t.push({id:y.id,path:y.path}),l.getRelations(t)):e.Promise.resolve()}(u).then((function(){return a.getImpactedConnections(r,!1,{relationTypes:x}).forEach((function(t){var n,o;if(d.every((function(i){return i.id=i.referencePID,i.id.includes(t.get("from"))?n=i.id:i.id.includes(t.get("to"))&&(o=i.id),!(e.is(n)&&e.is(o))})),e.is(n)&&e.is(o)){var i=l.getLinkInfo(t);s.push({id:t.get("PID"),fromNodeId:n,toNodeId:o,linkType:t.get("type"),linkInfo:i})}})),{nodes:d,links:s}}))},G=function(t){var n="DisplayProperties",o=i.getAppContext();return{icon:"url("+c.getIconURLFromKey(n)+")",label:c.getNLSValue("Cmd.DisplayProperties.Title"),sensitivity:"enabled",callback:function(){var i=F.getCommandCheckHeader(n,o),r=a.getReferenceIdFromInstance(t.instancePID);e.is(i)&&!1===i.getState()&&(i.options.node={referencePID:r,instancePID:t.instancePID,absPath:t.occcurancePath},i.toggleState())}}},j=function(e){c.getIconURLFromKey("GeneralDelete"),c.getNLSValue("LinksUI.DeleteLink"),e.linkType;var t={icon:"url("+c.getIconURLFromKey("EditAttribute")+")",label:c.getNLSValue("LinksUI.Attribute"),sensitivity:d.hasEditConfiguration(e.id)?"enabled":"disabled",callback:function(){d.editConfiguredAttributes(e.id)}},n="DisplayProperties";i.getAppContext(),c.getIconURLFromKey(n),c.getNLSValue("Cmd.DisplayProperties.Title");return[t]},W=function(t,n){var o={allowMove:!0},r=[];t&&(o.targetInstancePID=t.instancePID,o.targetInstancePIDsArray=t.occcurancePath,o.targetReferencePID=a.getReferenceIdFromInstance(t.instancePID),o.targetRootReferencePID=a.getInstance(t.occcurancePath[0]),o.targetRootReferencePID=e.is(o.rootReferencePID)?o.rootReferencePID.get("isAggregatedBy"):null),n&&(o.instancePID=n.instancePID,o.instancePIDsArray=n.occcurancePath,o.referencePID=a.getReferenceIdFromInstance(n.instancePID),o.rootReferencePID=a.getInstance(n.occcurancePath[0]),o.rootReferencePID=e.is(o.targetRootReferencePID)?o.targetRootReferencePID.get("isAggregatedBy"):null),("OPERATION"===t.PPRType&&"OPERATION"===n.PPRType||"SYSTEM"===t.PPRType&&"SYSTEM"===n.PPRType)&&(o.linkType=u.getProductFlowRelationTypeByPPRType(n.PPRType)),r.push(o),i.notify("CreateLinkOrInstance",[r])},_=function(t,n){var o={};s.getSelections()[0].indexOf(y.id)>-1&&n.push(y.id),n.length>0&&(n=n.map((function(e){var t=e.split(",");return t[t.length-1]})),R=!0),o.selectedNodeIds=n,t&&(o.changed={nodeId:a.getReferenceIdFromInstance(t.instancePID),childOccurencePath:e.is(t.occcurancePath)?t.occcurancePath:null,isSelected:!0},w=!0),i.notify("EGraphNodeSelect",o)},U=function(){e.is(m)&&(m.destroy(),m=void 0)},K=function(t){return t=t||{},new e.Promise((function(n,o){var i,r={},c=!!e.is(g.forceFetch)&&g.forceFetch,s=t.objectId;c&&e.is(t.objectId)?(i=function(){e.is(D)&&(k.off(),A.removeModal(b),b.remove()),n()},e.is(D)&&(b.inject(D),A.createModal(b,k.elements.container),k.on()),e.is(g.expandLevel)&&(r.expandLevel=g.expandLevel),e.is(g.withLinks)&&(r.withLinks=g.withLinks),e.is(g.withLinksResolved)&&(r.withLinksResolved=g.withLinksResolved),e.is(g.relationTypes)&&(r.gridIDs=g.relationTypes),e.is(g.forceDBMode)&&(r.forceDBMode=g.forceDBMode),e.is(t.filterQuery)&&(r.filterQuery=t.filterQuery),a.getDescendantsFromServer([s],i,r)):a.needToQueryForChildren(s)?(i=function(){e.is(D)&&(k.off(),A.removeModal(b),b.remove()),n()},a.getDescendantsFromServer([s],i,r)):n()}))},H=function(){return B(y.id,y.path).then((function(e){p=e.nodes,h=e.links,U(),(m=new t(r,{nodes:p,links:h,readOnly:E,identifier:N,nodeOptions:P,getNodeContextMenu:G,getLinkContextMenu:j,onNodeDoubleClick:O,onConnectingNodes:W,onNodeSelectionChange:_})).init()}))},Y=function(){return H().then((function(){m.inject(D),m.createGraphComponent()}))},X=function(){M(),Y()},Q=function(t){var n,o,i;S||Array.isArray(t)||!e.is(p)||(p.every((function(i){var r=t.get("from"),a=t.get("to");return r=Array.isArray(r)?r.join(","):r,a=Array.isArray(a)?a.join(","):a,i.id.includes(r)?n=i.id:i.id.includes(a)&&(o=i.id),!(e.is(n)&&e.is(o))})),e.is(n)&&e.is(o)&&(i=l.getLinkInfo(t),m.addLink({fromNodeId:n,toNodeId:o,id:t.get("PID"),linkType:t.get("type"),linkInfo:i})))},q=function(e){(Array.isArray(e)?e:[e]).forEach((function(e){m.removeLink(e.get("PID"))}))},z=function(t){var n,o,i,r=t.get("isInstanceOf"),s=t.get("PID"),d=a.getReferenceIdFromInstance(y.id);d||(d=y.id),t.get("isAggregatedBy")===d&&(n=a.getReference(r),i={id:(o=y.path.concat([s])).toString(),V_Name:n.get("V_Name"),PPRType:n.get("PPRTYPE"),instancePID:s,referencePID:r,occcurancePath:o,className:" EGraph_obj_"+n.get("PPRTYPE"),icon:{iconPath:c.getIconURLFromKey(n.get("type"))}},m.addNode(i),p.push(e.clone(i)))},$=function(e){(Array.isArray(e)?e:[e]).forEach((function(e){var t=y.path.concat([e.get("PID")]).toString();m.removeNode(t)}))},Z=function(t){var n=t.changed,o=n.absPath.toString();e.is(m)&&(n.isSelected?(w||m.selectNode(o),w=!1):(R||m.unselectNode(o),R=!1))},J=function(){Y()},ee=function(){},te=function(){e.is(v)&&(v.destroy(),v=void 0),U()},ne=function(e){S=!0,U()},oe=function(t){var n={};(t=Array.isArray(t)?t:[t]).forEach((function(t){P.forEach((function(e){(Array.isArray(e)?e:[e]).forEach((function(e){a.isEntityInstance(e.dicoType)||(n[e.property]=t.get(e.property))}))})),p.forEach((function(o,i){o.referencePID===t.get("PID")&&(p[i]=e.clone(e.extend(p[i],n)),m.updateNode(p[i].id,n))}))}))},ie=function(t){!e.is(y)||y.id!==t&&y.path[0]!==t||(S=!S&&S,a.getDescendantsFromServer([t],(function(){e.is(v)||M(),Y()}),{expandLevel:1,forceDBMode:!0}))};return{name:"ProductFlowViewModule",listenTo:function(){return{select:Z,addConnection:Q,removeConnection:q,addInstance:z,removeInstance:$,refreshImpacted:J,Hide:ee,HideAll:te,refreshAll:ne,addRootNode:ie,changeReference:oe}},onStart:function(t,d){var u,f,p;g=t=t||{},e.is(t.displayNodeConfigXML)&&(u=l.getXMLValues(t.displayNodeConfigXML),e.is(u.Config.Preferences)&&(P=[],e.is(u.Config.Preferences.Node)&&e.is(u.Config.Preferences.Node.Lines)&&e.is(u.Config.Preferences.Node.Lines.Line)&&(P=(P=u.Config.Preferences.Node.Lines.Line).map((function(t){var n,o=t.Info;return o.displayAttributeName&&(o.displayTitle=!0,n=e.is(o.dicoType)?o.dicoType+"."+o.property:o.property,o.title=c.getNLSValue(n)),o}))),e.is(u.Config.Preferences.Link)&&u.Config.Preferences.Link)),t.showPanel&&(f=c.getNLSValue(t.titleGraph),(I=new n(i,r,c)).init({title:f,identifier:N,className:"PERTVIEW-panel-container",onClose:function(){e.is(t.toggleCmdId)?i.notify("toggleCmdCheckHeaderState",{cmdName:t.toggleCmdId,cmdState:!1}):I.hide()}}),D=I.getContainer(),p=s.getSelectedRefs()[0],function(e,t){if(a.needToQueryForChildren(e)){var n={excludeBOTypes:["DELLmiProdSystemIOPort"],expandLevel:1};o.getDescendantsFromServer(e,t,n)}else t.call()}((y={reference:p,id:p.id,path:[]}).reference,(function(){I.buildSkeleton(),I.show(),X()}))),d()},onStop:function(){e.is(m)&&(m.destroy(),m=void 0),e.is(I)&&(I.destroy(),I=void 0)},createSequence:function(e){return K(e).then((function(){var t=e.objectId;return y={id:t,path:[]},C=e.filterQuery,H()}))},inject:function(e){D=e,M(),m.inject(D),m.createGraphComponent()},setReadOnly:function(e){E=e}}}}})),define("DS/DELWKOProductFlowSequenceModule/DELWKOProductFlowSequenceModule",["UWA/Core","DS/DELWKOProductFlowSequenceModule/DELWKOProductFlowComponent","DS/DELPPWProductFlowSequenceModule_FD02/GraphPanel","DS/DELWKONavigationServices/DELWKONavigateUtil"],(function(e,t,n,o){"use strict";return{behaviors:["UXFactoryBehavior","ModelBehavior","ResourceBehavior","SelectionBehavior","EditAttributeBehavior","LinkBehavior","ProductFlowLinkBehavior","RootsBehavior"],creator:function(i,r,a,c,s,d,l,u,f){var g,p,h,m,y,P,I,v,D,E,C,L=["WORKORDER","EXECHEADER"],N="PPR-PERTVIEW",w=!1,R=!1,S=!1,T=r.getComponent("Breadcrumb"),k=r.create("WUXLoader",{showButtonFlag:!1}),A=r.getComponent("ModalContainer"),b=e.createElement("div",{class:"pert-loading-cont"}),F=r.getComponent("WUXCommandsManager"),x=u.getProductFlowRelationTypes(),M=function(){var t=c.getIconURLFromKey("Refresh"),n=e.createElement("img",{src:t,class:"GraphViewBar refresh-btn"});e.is(v)&&(v.remove(),v.empty(!0)),v=e.createElement("div",{class:"egraph-toobar"}),n.addEvent("click",(function(){Y()})),V(y.id,y.path).inject(v),n.inject(v),v.inject(D)},O=function(t){var n=t.model,o={objectId:n.referencePID};e.is(C)&&(o.filterQuery=C),K(o).then((function(){y.id=e.is(n.instancePID)?n.instancePID:n.referencePID,y.path=n.occcurancePath,X()}))},V=function(t,n){var o,r,s,d,l,u=e.createElement("div",{class:"egraph-navigator"}),f=[],g=function(e,t,n){s&&f.unshift({label:s.get("V_Name"),icon:c.getIconURLFromKey(s.get("type")),id:t,path:n})};if(e.is(n,"string")&&(n=n.split(",")),0===n.length)g(0,(s=a.getReference(t)).get("PID"),[]);else for(l=n.length-1;l>=0;l--)d=n[l],s=a.getReferenceModel(d),g(0,d,n.slice(0,l+1)),0===l&&(r=a.getInstance(d),g(0,(s=a.getAggregatingReferenceModelFromInstance(r)).get("PID"),[]));return f.length>0&&(o=new T({value:f,mode:T.MODE.NAVIGATION})).addEventListener("selectionChange",(function(){var e;i.notify("EGraphNodeSelect",{selectedNodeIds:[y.id]}),R=!0,e=o.selectedValues[0],y=e,Y()})),o.inject(u),u},B=function(t,n){var o,i,r=[],s=[],d=[],u=[];return o=a.getReferenceModel(t),((i=function(){var t,n,o;return e.is(C)?t=C:e.is(y)&&(0===y.path.length?n=y.id:(o=a.getInstance(y.path[0]),n=(o=a.getReference(o.get("isAggregatedBy"))).get("PID")),n&&(t=f.getRootFilter(n),t=e.is(t)&&e.is(t.originalFilterQuery)?t.originalFilterQuery:void 0)),t}())?a.getFilteredInstancesFromCollection(o.get("PID"),i):a.getInstancesFromCollection(o.get("PID"))).forEach((function(t){var o,i,s,l=t.get("PID"),f=n.concat([l]);s=a.getReferenceModelFromInstance(t),L.indexOf(s.get("PPRTYPE"))>-1&&(r.push(l),u.push({id:l}),o={id:f.toString(),PPRType:s.get("PPRTYPE"),instancePID:l,referencePID:s.get("PID"),occcurancePath:f,className:" EGraph_obj_"+s.get("PPRTYPE"),icon:{iconPath:c.getIconURLFromKey(s.get("type"))},position:{x:t.get("V_X2DPos"),y:t.get("V_Y2DPos")}},P.forEach((function(n){(Array.isArray(n)?n:[n]).forEach((function(n){i=t.get(n.property),o[n.property]="NULL"!==i&&e.is(i)?i:s.get(n.property)}))})),d.push(o))})),function(t){return a.isNavigateOnDemand()?(t.push({id:y.id,path:y.path}),l.getRelations(t)):e.Promise.resolve()}(u).then((function(){return a.getImpactedConnections(r,!1,{relationTypes:x}).forEach((function(t){var n,o;if(d.every((function(i){return i.id=i.referencePID,i.id.includes(t.get("from"))?n=i.id:i.id.includes(t.get("to"))&&(o=i.id),!(e.is(n)&&e.is(o))})),e.is(n)&&e.is(o)){var i=l.getLinkInfo(t);s.push({id:t.get("PID"),fromNodeId:n,toNodeId:o,linkType:t.get("type"),linkInfo:i})}})),{nodes:d,links:s}}))},G=function(t){var n="DisplayProperties",o=i.getAppContext();return{icon:"url("+c.getIconURLFromKey(n)+")",label:c.getNLSValue("Cmd.DisplayProperties.Title"),sensitivity:"enabled",callback:function(){var i=F.getCommandCheckHeader(n,o),r=a.getReferenceIdFromInstance(t.instancePID);e.is(i)&&!1===i.getState()&&(i.options.node={referencePID:r,instancePID:t.instancePID,absPath:t.occcurancePath},i.toggleState())}}},j=function(e){c.getIconURLFromKey("GeneralDelete"),c.getNLSValue("LinksUI.DeleteLink"),e.linkType;var t={icon:"url("+c.getIconURLFromKey("EditAttribute")+")",label:c.getNLSValue("LinksUI.Attribute"),sensitivity:d.hasEditConfiguration(e.id)?"enabled":"disabled",callback:function(){d.editConfiguredAttributes(e.id)}},n="DisplayProperties";i.getAppContext(),c.getIconURLFromKey(n),c.getNLSValue("Cmd.DisplayProperties.Title");return[t]},W=function(t,n){var o={allowMove:!0},r=[];t&&(o.targetInstancePID=t.instancePID,o.targetInstancePIDsArray=t.occcurancePath,o.targetReferencePID=a.getReferenceIdFromInstance(t.instancePID),o.targetRootReferencePID=a.getInstance(t.occcurancePath[0]),o.targetRootReferencePID=e.is(o.rootReferencePID)?o.rootReferencePID.get("isAggregatedBy"):null),n&&(o.instancePID=n.instancePID,o.instancePIDsArray=n.occcurancePath,o.referencePID=a.getReferenceIdFromInstance(n.instancePID),o.rootReferencePID=a.getInstance(n.occcurancePath[0]),o.rootReferencePID=e.is(o.targetRootReferencePID)?o.targetRootReferencePID.get("isAggregatedBy"):null),("OPERATION"===t.PPRType&&"OPERATION"===n.PPRType||"SYSTEM"===t.PPRType&&"SYSTEM"===n.PPRType)&&(o.linkType=u.getProductFlowRelationTypeByPPRType(n.PPRType)),r.push(o),i.notify("CreateLinkOrInstance",[r])},_=function(t,n){var o={};s.getSelections()[0].indexOf(y.id)>-1&&n.push(y.id),n.length>0&&(n=n.map((function(e){var t=e.split(",");return t[t.length-1]})),R=!0),o.selectedNodeIds=n,t&&(o.changed={nodeId:a.getReferenceIdFromInstance(t.instancePID),childOccurencePath:e.is(t.occcurancePath)?t.occcurancePath:null,isSelected:!0},w=!0),i.notify("EGraphNodeSelect",o)},U=function(){e.is(m)&&(m.destroy(),m=void 0)},K=function(t){return t=t||{},new e.Promise((function(n,o){var i,r,c={};!!e.is(g.forceFetch)&&g.forceFetch&&e.is(t.objectId)?(i=t.objectId,r=function(){e.is(D)&&(k.off(),A.removeModal(b),b.remove()),n()},e.is(D)&&(b.inject(D),A.createModal(b,k.elements.container),k.on()),e.is(g.expandLevel)&&(c.expandLevel=g.expandLevel),e.is(g.withLinks)&&(c.withLinks=g.withLinks),e.is(g.withLinksResolved)&&(c.withLinksResolved=g.withLinksResolved),e.is(g.relationTypes)&&(c.gridIDs=g.relationTypes),e.is(g.forceDBMode)&&(c.forceDBMode=g.forceDBMode),e.is(t.filterQuery)&&(c.filterQuery=t.filterQuery),a.getDescendantsFromServer([i],r,c)):n()}))},H=function(){return B(y.id,y.path).then((function(e){p=e.nodes,h=e.links,U(),(m=new t(r,{nodes:p,links:h,readOnly:E,identifier:N,nodeOptions:P,getNodeContextMenu:G,getLinkContextMenu:j,onNodeDoubleClick:O,onConnectingNodes:W,onNodeSelectionChange:_})).init()}))},Y=function(){return H().then((function(){m.inject(D),m.createGraphComponent()}))},X=function(){M(),Y()},Q=function(t){var n,o,i;S||Array.isArray(t)||!e.is(p)||(p.every((function(i){var r=t.get("from"),a=t.get("to");return r=Array.isArray(r)?r.join(","):r,a=Array.isArray(a)?a.join(","):a,i.id.includes(r)?n=i.id:i.id.includes(a)&&(o=i.id),!(e.is(n)&&e.is(o))})),e.is(n)&&e.is(o)&&(i=l.getLinkInfo(t),m.addLink({fromNodeId:n,toNodeId:o,id:t.get("PID"),linkType:t.get("type"),linkInfo:i})))},q=function(e){(Array.isArray(e)?e:[e]).forEach((function(e){m.removeLink(e.get("PID"))}))},z=function(t){var n,o,i,r=t.get("isInstanceOf"),s=t.get("PID"),d=a.getReferenceIdFromInstance(y.id);d||(d=y.id),t.get("isAggregatedBy")===d&&(n=a.getReference(r),i={id:(o=y.path.concat([s])).toString(),V_Name:n.get("V_Name"),PPRType:n.get("PPRTYPE"),instancePID:s,referencePID:r,occcurancePath:o,className:" EGraph_obj_"+n.get("PPRTYPE"),icon:{iconPath:c.getIconURLFromKey(n.get("type"))}},m.addNode(i),p.push(e.clone(i)))},$=function(e){(Array.isArray(e)?e:[e]).forEach((function(e){var t=y.path.concat([e.get("PID")]).toString();m.removeNode(t)}))},Z=function(t){var n=t.changed,o=n.absPath.toString();e.is(m)&&(n.isSelected?(w||m.selectNode(o),w=!1):(R||m.unselectNode(o),R=!1))},J=function(){Y()},ee=function(){},te=function(){e.is(v)&&(v.destroy(),v=void 0),U()},ne=function(e){S=!0,U()},oe=function(t){var n={};(t=Array.isArray(t)?t:[t]).forEach((function(t){P.forEach((function(e){(Array.isArray(e)?e:[e]).forEach((function(e){a.isEntityInstance(e.dicoType)||(n[e.property]=t.get(e.property))}))})),p.forEach((function(o,i){o.referencePID===t.get("PID")&&(p[i]=e.clone(e.extend(p[i],n)),m.updateNode(p[i].id,n))}))}))},ie=function(t){!e.is(y)||y.id!==t&&y.path[0]!==t||(S=!S&&S,a.getDescendantsFromServer([t],(function(){e.is(v)||M(),Y()}),{expandLevel:1,forceDBMode:!0}))};return{name:"ProductFlowViewModule",listenTo:function(){return{select:Z,addConnection:Q,removeConnection:q,addInstance:z,removeInstance:$,refreshImpacted:J,Hide:ee,HideAll:te,refreshAll:ne,addRootNode:ie,changeReference:oe}},onStart:function(t,a){var d,u,f,p,h,m;g=t=t||{},e.is(t.displayNodeConfigXML)&&(d=l.getXMLValues(t.displayNodeConfigXML),e.is(d.Config.Preferences)&&(P=[],e.is(d.Config.Preferences.Node)&&e.is(d.Config.Preferences.Node.Lines)&&e.is(d.Config.Preferences.Node.Lines.Line)&&(P=(P=d.Config.Preferences.Node.Lines.Line).map((function(t){var n,o=t.Info;return o.displayAttributeName&&(o.displayTitle=!0,n=e.is(o.dicoType)?o.dicoType+"."+o.property:o.property,o.title=c.getNLSValue(n)),o}))),e.is(d.Config.Preferences.Link)&&d.Config.Preferences.Link)),t.showPanel&&(u=c.getNLSValue(t.titleGraph),(I=new n(i,r,c)).init({title:u,identifier:N,className:"PERTVIEW-panel-container",onClose:function(){e.is(t.toggleCmdId)?i.notify("toggleCmdCheckHeaderState",{cmdName:t.toggleCmdId,cmdState:!1}):I.hide()}}),D=I.getContainer(),m=s.getSelectionsWithPaths()[0][0],y={id:m.id,path:m.path},f=y.id,p=function(){I.buildSkeleton(),I.show(),X()},h={excludeBOTypes:["DELLmiProdSystemIOPort"],forceDBMode:!0},o.getDescendantsFromServer(f,p,h)),a()},onStop:function(){e.is(m)&&(m.destroy(),m=void 0),e.is(I)&&(I.destroy(),I=void 0)},createSequence:function(e){return K(e).then((function(){var t=e.objectId;return y={id:t,path:[]},C=e.filterQuery,H()}))},inject:function(e){D=e,M(),m.inject(D),m.createGraphComponent()},setReadOnly:function(e){E=e}}}}}));