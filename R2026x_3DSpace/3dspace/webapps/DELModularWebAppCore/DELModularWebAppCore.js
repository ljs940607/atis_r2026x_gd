define("DS/DELModularWebAppCore/FacadeBase",["UWA/Core"],(function(e){"use strict";return function(t,n,r){if(!r.id)throw new Error("Element id property is not defined module for "+n);return{name:"FacadeBase",_element:r,_moduleName:n,_moduleId:r.id,getElement:function(){return this._element},setProperties:function(n){var r=t.getService("LayoutService");e.is(r)?r.setProperties(this._moduleId,n):t.getLogger().debug("Recipe","LayoutService Not available")},getName:function(){return this._moduleName},getId:function(){return this._moduleId},getPreferenceValue:function(n){const r=t.getService("PreferenceService");if(t.isServiceStarted("PreferenceService")&&e.is(r))return r.getPreferenceValue(n)},getAppContext:function(){return t.getConfig().appContext},getBehavior:function(e){return t.getBehavior(this.getId(),e)},notify:function(e,n){t.getMediator().notify(e,n,{sourceModuleId:this.getId()})},stop:function(){t.stop(this.getId())},log:function(n,r,o){if(!e.is(r))return t.getLogger().log(this.getId(),n);t.getLogger().log(this.getId(),n,r,o)},debug:function(){Array.prototype.unshift.apply(arguments,[this.getId()]),t.getLogger().debug.apply(null,arguments)},warn:function(){Array.prototype.unshift.apply(arguments,[this.getId()]),t.getLogger().warn.apply(null,arguments)},info:function(){Array.prototype.unshift.apply(arguments,[this.getId()]),t.getLogger().info.apply(null,arguments)},printDuration:function(e,n){return t.getLogger().printDuration(e,n)},printCurrentDateTime:function(e){return t.getLogger().printCurrentDateTime(e)}}}})),define("DS/DELModularWebAppCore/Mediator",["UWA/Core","text!DS/DELModularWebAppCore/assets/json/AuthorizedEvents_Core.json"],(function(e,t){"use strict";return function(n){var r,o,i,a,s,u,c,f,l,d,g=!0,p="",h={},v=[];if(a=function(){for(var e;v.length>0;)e=v.shift(),n.getLogger().debug("Mediator","App started. Processing event: %s\n",e.eventName),n.getMediator().notify(e.eventName,e.eventData,e.eventInfo)},s=function(t,r,o){return e.is(t)&&p===t?(g=!0,v.unshift({eventName:t,eventData:r,eventInfo:o}),a()):(v.push({eventName:t,eventData:r,eventInfo:o}),n.getLogger().debug("Mediator","App not started. Adding events to Queue: %s\n",t)),!0},u=function(e,t,r){var o,i;if(e.listenTo instanceof Function)for(o in i=e.listenTo())Object.prototype.hasOwnProperty.call(i,t)&&o===t&&(!r||r instanceof Array)&&function(o){try{o.apply(e,r)}catch(e){n.getLogger().debug("Mediator","Exception on event: %s\nMessage: %s\nStack: %s",t,e.message,e.stack)}}(i[t])},c=function(t,r){var o,i,a,s=e.is(r)?r.sourceModuleId:null,u={};return i=h[t],e.is(i)&&e.is(s)?(a=i[s],e.is(a)&&a.forEach((function(t){o=n.getInstance(t),e.is(o)&&(u[t]=o)}))):u=n.getInstance(),u},f=function(e,t,r){var o=!0;return-1===i.indexOf(e)?(n.getLogger().debug("Mediator","Event: "+e+", is not in the authorized event list"),o=!1):g||(s(e,t,r),o=!1),o},l=function(e,t){var r=n.getExternalListenerData(e),o=t instanceof Array?t:[t];r instanceof Array&&r.forEach((function(t){try{t&&t.func&&t.func.apply(n,o)}catch(t){n.getLogger().debug("Mediator","Exception on event: %s\nMessage: %s\nStack: %s",e,t.message,t.stack)}}))},d=function(e,t,r){var o,i=c(e,r),a=t instanceof Array?t:[t];try{for(o in i){var s;Object.hasOwnProperty.call(i,o)&&(s=i[o]).isStarted&&(s.behaviors instanceof Array&&s.behaviors.forEach((function(t){u(t.instance,e,a)})),u(s.instance,e,a))}}catch(e){n.getLogger().debug("Mediator",e.message)}},t=e.Json.decode(t),i=[],e.is(t))for(o in t)Object.hasOwnProperty.call(t,o)&&(i=i.concat(t[o]));if(n.getConfig().Mediator){if(r=n.getConfig().Mediator,g=!e.is(r)||!e.is(r.WaitForWidgetLoading)||!r.WaitForWidgetLoading,p=e.is(r.LoadingCompleteEvent)?r.LoadingCompleteEvent:"endLoadingWidget",e.is(r)&&e.is(r.authorizedEvents))for(o in r.authorizedEvents)Object.hasOwnProperty.call(r.authorizedEvents,o)&&(i=i.concat(r.authorizedEvents[o]));e.is(r)&&e.is(r.eventsMapping)&&(h=r.eventsMapping)}return{notify:function(t,n,r){const o=function(){f(t,n,r)&&(d(t,n,r),l(t,n))};if(e.is(n)&&e.owns(n,"notifyAsynchronously")&&!0===n.notifyAsynchronously){const e=function(e=0){let t;function n(){o()}return function(){clearTimeout(t),t=setTimeout(n,e)}};e()()}else o()}}}})),define("DS/DELModularWebAppCore/Logger",["DS/Logger/Logger","UWA/Core","UWA/Date"],(function(e,t,n){"use strict";return function(){return{log:function(t){e.getLogger(t).log(Array.prototype.slice.call(arguments,1))},debug:function(t){var n=e.getLogger(t);n.debug.apply(n,Array.prototype.slice.call(arguments,1))},warn:function(t){e.getLogger(t).warn(Array.prototype.slice.call(arguments,1))},info:function(t){e.getLogger(t).info(Array.prototype.slice.call(arguments,1))},error:function(t){var n=e.getLogger(t);n.error.apply(n,Array.prototype.slice.call(arguments,1))},printDuration:function(r,o){var i=n.now()-r.getTime(),a="Duration: ";return t.is(o)&&(a="Duration (for "+o+"): "),e.getLogger().log(a+i+" ms"),i},printCurrentDateTime:function(t){var r=new n;return e.getLogger().log(t+r.toISOString()),r}}}})),define("DS/DELModularWebAppCore/Core",["UWA/Core","UWA/Utils","UWA/Promise","DS/DELModularWebAppCore/Mediator","DS/DELModularWebAppCore/Logger","DS/DELModularWebAppCore/FacadeBase"],(function(e,t,n,r,o,i){"use strict";return function(a){var s,u={},c={},f={},l={},d=new o,g=-1,p={},h={},v=function(e,t,r){var o,i,a=e[t];return r=r||{},i=isNaN(r.asyncLength)?-1:r.asyncLength,o=r.arguments instanceof Array?r.arguments:[],new n((function(n,r){var s=!1;if("function"==typeof a)try{i===a.length?(o.push((function(){n(),s=!0})),a.apply(e,o),setTimeout((function(){var n=e.name?e.name:"";try{if(!s)throw new Error("Timeout: No response within specified time period")}catch(e){d.error("Core","Exception calling method: %s, Instance: %s\nMessage: %s\nStack: %s",t,n,e.message,e.stack)}}),2e4)):(a.apply(e,o),n())}catch(e){d.error("Core","Exception calling method: %s\nMessage: %s\nStack: %s",t,e.message,e.stack),r()}else n()}))},y=function(e,t){var n=a.require[e],r={},o=[];if(!n)throw new Error(e+" map is not defined in app config");return t.forEach((function(t){var i=n[t];if(!i)throw new Error("Path to "+e+" "+t+" is not defined");o.push(i),r[i]=t})),{paths:o,nameMap:r}},m=function(e){return e?c[e]:c},S=function(e){return e?u[e]:u},b=function(e){var t=[];return e?e instanceof Array?(e.forEach((function(e){var n=f[e];if(!n)throw new Error("Plugin "+e+" was not found");t.push(n)})),t):f[e]:f},E=function(e){return e?l[e]:l},L=function(e,t){Object.prototype.hasOwnProperty.call(l,e)?d.debug("Core","Service: %s is already registered",e):l[e]={instance:t,isStarted:!1}},A=function(e,t){Object.prototype.hasOwnProperty.call(f,e)?d.debug("Core","Plugin: %s is already registered",e):f[e]={instance:t,isStarted:!1}},w=function(e,t,n){var r,o=y("plugin",t);(r=o.paths.filter((function(e){return!b(o.nameMap[e])}))).length>0?require(r,(function(){var t,i,a,s,u;for(t=0;t<arguments.length;t++){if(u=arguments[t],s=r[t],i=o.nameMap[s],!u)throw new Error("Plugin "+i+" was not loaded");b(i)||(a=new u(e),A(i,a))}n()})):n()};return a||(a={require:{}}),{getConfig:function(){return a},getLogger:function(){return d},getMediator:function(){return s||(s=new r(this)),s},getInstance:function(e){return m(e)},getBehavior:function(e,t){var n,r=m(e);return r&&r.behaviors.some((function(e){return e.id===t&&(n=e.instance,!0)})),n},getPlugins:function(e){return b(e)},getService:function(t){var n,r=E(t);return e.is(r)&&r.instance&&(n=r.instance),n},getAllServiceNames:function(){var e=E();return Object.keys(e)},getExternalListenerData:function(t){return t?e.clone(p[t]):e.clone(p)},addExternalListener:function(e,t){var n;if(e&&t)return p[e]instanceof Array||(p[e]=[]),n=(++g).toString(),p[e].push({token:n,func:t}),n},addExternalListenerOnce:function(e,t){var n,r=this;n=this.addExternalListener(e,(function(e){r.removeExternalListener(n),t.call(this,e)}))},removeExternalListener:function(e){var t,n,r,o=!1;if(!e)return o;for(t in p)if(p[t])for(n=0,r=p[t].length;n<r;n++)p[t][n]&&p[t][n].token===e&&(p[t].splice(n,1),o=!0,r--);return o},createModule:function(t,n,r,o){var a,s,f=this,l=S(t),g=function(a,s){var l;!function(e,t,n){S(e)?d.debug("Core","Module: %s is already registered",e):u[e]={creator:t,behaviorNames:n,counter:0}}(t,a,s),l=S(t),!function(t){return!!e.is(t)&&-1===Object.keys(c).indexOf(t)}(n)?r.id="mod-"+t+"-"+l.counter:r.id=n,l.counter++,function(e,t,n,r,o){var a=y("behavior",r),s=new i(e,t,n),u=[];require(a.paths,(function(){var t,n,i,c,f,l;if(arguments.length>0)for(t=0;t<arguments.length;t++){if(n=arguments[t],f=a.paths[t],l=a.nameMap[f],!n)throw new Error("Behavior "+l+" was not loaded");i=n.creator,(c=n.plugins)instanceof Array||(d.error("Core","%s (behavior) plugins property is not an array",l),c=[]),function(t,n,i){w(e,t,(function(){var a=b(t).map((function(e){return e.instance})),c=[null,e,s].concat(a),f=new(Function.prototype.bind.apply(n,c));if(u.push({name:i,pluginNames:t,instance:f,isStarted:!1}),u.length!==r.length)return!1;o(s,u)}))}(c,i,l)}else o(s)}))}(f,t,r,s,(function(n,i){var u,f,l=[],g=[],p={};s.forEach((function(e,t){var n=!1;if(i.some((function(r,o){if(isNaN(p[r.name])&&(p[r.name]=1),r.name===e){if(-1===g.indexOf(o))return g.push(o),r.id=p[e]>1?r.name+"-"+p[e]:r.name,n=!0,r.index=t,!0;p[r.name]+=1}return!1})),!n)throw new Error("Behavior: "+e+" was not instantiated")})),i instanceof Array&&(i.sort((function(e,t){return e.index-t.index})),l=i.map((function(e){return e.instance}))),u=[null,n].concat(l),f=new(Function.prototype.bind.apply(a,u)),function(t,n,r,o){if(!e.is(n.id))throw new Error("Element Id is not defined for module: "+t);c[n.id]?d.debug("Core","Module instance of %s is already registered",t):c[n.id]={instance:r,behaviors:o,moduleName:t,element:n,isStarted:!1}}(t,r,f,i),o&&o(r.id)}))};l?(r.id&&(a=m(r.id)),a?o&&o(r.id):g(l.creator,l.behaviorNames)):(s=y("module",[t]),require(s.paths,(function(e){e.behaviors instanceof Array||(d.error("Core","%s behaviors property is not an array",t),e.behaviors=[]),g(e.creator,e.behaviors)})))},isStarted:function(e){var t=m(e),n=!1;return t&&(n=t.isStarted),n},isServiceStarted:function(e){var t=E(e),n=!1;return t&&(n=t.isStarted),n},start:function(e,t,r){var o,i,a=function(e){var t,n=c[e];return n&&(t=n.moduleName),t}(e),s="function"==typeof r?r:null,u=t||{},f=[],l=function(){d.printDuration(o,"Module Name: "+a+", Module Id: "+e),d.debug("Core","Module %s (module Id: %s) started successfully.",a,e),"function"==typeof s&&s.call(null,[{status:"OK",name:a,id:e}])},g=function(){var t=Array.prototype.slice.call(arguments);t.unshift("Core"),d.error.apply(d,t),"function"==typeof s&&s.call(null,[{status:"KO",name:a,id:e}])};a&&S(a)?this.isStarted(e)||(o=d.printCurrentDateTime("Module Name:"+a+", Module Id:"+e+" START - "),(i=m(e)).behaviors instanceof Array&&(i.behaviors.forEach((function(e){b(e.pluginNames).forEach((function(e){var t;e.isStarted||(e.onStartPromise?t=e.onStartPromise:(t=v(e.instance,"onStart",{asyncLength:1}).then((function(){e.isStarted=!0,e.onStartPromise&&delete e.onStartPromise})),e.onStartPromise=t),f.push(t))}))})),n.all(f).then((function(){var t=[];i.behaviors.forEach((function(e){var n;e.isStarted||(n=v(e.instance,"onStart",{arguments:[u],asyncLength:2}),t.push(n),e.isStarted=!0)})),n.all(t).then((function(){i.isStarted=!0,v(i.instance,"onStart",{arguments:[u],asyncLength:2}).then(l,(function(){g("Failed to start module.\nModule Name: %s \nModule Id: ",a,e)}))}),(function(){g("Failed to start module (as behavior failed to start). \nModule Name: %s \nModule Id: %s",a,e)}))}),(function(){g("Failed to start module (as plugin failed to start). \nModule Name: %s \nModule Id: %s",a,e)})))):g("Cannot start module: %s, it needs to be created before",e)},startService:function(e){var t,n=E(e);if(n&&n.instance)return n.isStarted?void 0:(t=d.printCurrentDateTime("Service Name:"+e+" START - "),v(n.instance,"onStart",{asyncLength:1}).then((function(){n.isStarted=!0,d.printDuration(t,"Service Name: "+e),d.debug("Core","Service %s started successfully.",e)}),(function(){d.debug("Core","Service %s failed to start.",e)})));d.error(this.name,"Cannot start service: %s, it needs to be created before",e)},startAll:function(){var e=this,t=Object.keys(c),n=arguments;t.forEach((function(t){e.start(t,n)}))},startAllServices:function(e){var t=this,r=0,o=n.resolve(),i=Object.keys(l);i.forEach((function(n){o=o.then((function(){return t.startService(n)})).then((function(){++r===i.length&&"function"==typeof e&&e.apply(null,null)})).catch((function(e){throw new Error("Failed to load the service "+i[r]+" Error description: "+e)}))}))},stop:function(e){var t=m(e);if(!t)return d.error(this.name,"Error stopping module instance: %s",e),!1;this.isStarted(e)&&(t.behaviors.forEach((function(e){e.isStarted&&(v(e.instance,"onStop"),e.isStarted=!1)})),v(t.instance,"onStop"),t.isStarted=!1)},stopAll:function(){var e,t=this,n=Object.keys(l),r=Object.keys(f),o=Object.keys(c);n.forEach((function(t){(e=E(t))&&(v(e.instance,"onStop"),e.isStarted=!1)})),o.forEach((function(e){t.stop(e)})),r.forEach((function(t){(e=b(t))&&e.isStarted&&(v(e.instance,"onStop"),e.isStarted=!1)}))},end:function(e){this.stop(e),m(e)&&delete c[e]},endAll:function(){var e=this;Object.keys(c).forEach((function(t){e.end(t)}))},useServices:function(t,n,r){var o,i=this,s=r||{},u=y("service",t);(o=u.paths.filter((function(e){return!E(u.nameMap[e])}))).length>0?require(o,(function(){var t,r,c,f,l;for(setTimeout((()=>{var t,n,r,o;o=[],e.is(a)&&e.is(a.require)&&(t=a.require.module||{},o=o.concat(Object.values(t)),n=a.require.behavior||{},o=o.concat(Object.values(n)),r=a.require.plugin||{},(o=o.concat(Object.values(r))).length>0&&require(o,(function(){d.debug("Core","PreFetched Module infos successfully")})))}),10),t=0;t<arguments.length;t++){if(l=arguments[t],f=o[t],r=u.nameMap[f],!l)throw new Error("Service "+r+" was not loaded");E(r)||(c=new l(i,s),L(r,c))}i.startAllServices(n)})):i.startAllServices(n)},updateAppContext:function(t){var n=t||{};e.is(a)&&e.is(a.appContext)&&(a.appContext=e.extend(a.appContext,n,!0))},watchBackgroundTasks:function(e){var n=t.getUUID();return e.then((()=>{delete h[n]})).catch((()=>{delete h[n]})),h[n]=e,n},waitForBackgroundTasks:function(){return n.allSettled(Object.values(h))}}}}));