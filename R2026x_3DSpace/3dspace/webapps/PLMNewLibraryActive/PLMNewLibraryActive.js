define("DS/PLMNewLibraryActive/PLMNewLibraryActiveController",["DS/ClassificationsFacet/PLMNewCommomCmpUXController","DS/ClassificationsFacet/service/PLMNewCommonWebService","i18n!DS/LibraryActive/assets/nls/LibraryActive","DS/LibraryActive/service/LibraryTypeService","DS/IPClassifyUtil/IPClassifyUtility","DS/WidgetServices/WidgetServices","DS/LibraryActive/service/LibraryActiveWebService","DS/LibraryActive/LibraryActive","DS/IPClassifyUtil/service/IPClassifyUtilWebService","DS/IPClassifyUXUtil/IPClassifyConfirmation","DS/Controls/TooltipModel","i18n!DS/ClassificationsFacet/assets/nls/PLMNewCommCmpSel","DS/LibraryEditor/service/LibraryEditorWebService","DS/ClassificationProp/utils/ClassifPropControl","DS/IPClassifyUtil/IPClassifyAlert"],(function(e,t,s,a,o,i,n,l,r,c,d,u,p,m,f){let g=!1;return e.extend({name:"PLMNewLibraryActive",_rootNodeFavorite:null,_rootNodeFolders:null,_rootNodeTrash:null,_requestInfo:{},_searchKeys:{},_pathInfo:{},_nodesData:{},_isResetInProgress:!1,_addAttributeSection:!1,_subBookmarkExpand:{},_favoriteSection:a.TYPE_FAVORITES_SECTION,_allSection:a.TYPE_LIBRARIES_SECTION,_supportedTypesForDropAtFindIn:["General Class"],_classPathMap:new Map,_attributeMap:new Map,_classUsageMap:new Map,_parentOptions:null,_parentInitMethod:null,_classNameMap:new Map,init:function(e){this.plmNewContextProvider=e.securityContext,this._nodesData={},this.PLMNewCommonWebService=Object.assign({},t),this.PLMNewCommonWebService.setSecurityContext(this.plmNewContextProvider),this.PLMNewCommonWebService.getSearchQuery=function(){if(e.multiSelectionComponent&&e.multiSelectionComponent.rootLibraries){var t=e.multiSelectionComponent.rootLibraries;if(Array.isArray(t)&&t.length>0){var s="";return t.forEach((function(e){s=s?s+" OR "+e:e})),"physicalid: ("+s+') AND flattenedtaxonomies:"types/General Library"'}return'flattenedtaxonomies:"types/General Library"'}return'flattenedtaxonomies:("types/General Class")'},this.PLMNewCommonWebService.navigatePathRelArray=function(){return["Subclass"]},this.PLMNewCommonWebService.getType_filter_bo=function(){return["General Library","General Class"]},this.PLMNewCommonWebService.generateSearchQuery=function(e,t){return'(flattenedtaxonomies:("types/General Library" OR "types/General Class")) AND (label: *'+e+"*)"+(t?' AND NOT physicalid: "'+t+'"':"")},this.PLMNewCommonWebService.getLabel=function(e){return"IPClass-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime()},this.PLMNewCommonWebService.getRefineSearch=function(){var e=m.getSearchQueryFilter();return e?{"ds6w:what/ds6w:status":[{object:"Classification.Active",type:"string",field:"internal"}],"ds6w:what/ds6w:classificationUsage":[{object:e,type:"string",field:"internal"}]}:{"ds6w:what/ds6w:status":[{object:"Classification.Active",type:"string",field:"internal"}]}},this.PLMNewCommonWebService.getSpecific_source_parameter=function(e,t){return{"3dspace":{search_in_context:{expand:{root_physicalid:e,expand_iter:t?"-1":"1",type_filter_bo:["General Library","General Class"]}}}}},this._parent(e),this._parentOptions=e,this._parentInitMethod=this._parent},_getWebServiceRef:function(){return this.PLMNewCommonWebService},_getIcon:function(e){var t="Definition";if(!e)return{iconName:"library-class"};t=e.classUsage||e["ds6w:classificationUsage"];var s="";return"General Class"==e.type||"General Class"==e["ds6w:type"]||"General Class"==e.plmType?(s={iconName:"library-class"},"Definition"==t&&(s={iconName:"library-class-filled"})):"General Library"!=e.type&&"General Library"!=e["ds6w:type"]&&"General Library"!=e.plmType||(s={iconName:"library"},"Standard"==t&&(s={iconName:"library-lined"})),s},couldBeValid:function(e){e&&e.getID&&e.getID();if(e&&e.getType){if(e.getType())return"General Class"===e.getType();if("General Class"===e.plmType)return!0}return!1},_getComponentName:function(){return s.name_Section_AllLibraries},_autoCompleteName:function(){return s.name_Section_AllLibraries},_getAutocomplete:function(e){return this.autocompleteLibrary},couldBeSelected:function(e){return!!["General Class"].includes(e)},_autocompleteComponent:function(e){var t=this;return t.autocompleteLibrary=t.createAutocompleteComponent(t._getComponentName(),[],e,t.browseAssociations.bind(t,!0,!0)),t.autocompleteLibrary},saveRespectiveAssociations:function(e,t,s){return new Promise((function(a,o){const i=[];i.push(new Promise((function(a,o){n.performMultiClassify({data:{Classifications:t,ItemsToClassify:[e]},plmNewContextProvider:s,onComplete:function(e){e&&e.failedIds.length>0&&a("fail"),a(e)},onFailure:function(e,t){a("fail")}})}))),Promise.all(i).then((function(e){a(e)})).catch((()=>{console.log("Issue with the Save Classification")}))}))},onClickSelector:function(){var e=this;widget&&widget.addEvent("onLoad",(function(e){g=!1})),g||(e.libraryActiveActionBar=new l({multiSelectionComponent:{withClassify:!0,launchDialog:!0,componentTitle:s.multiSelectionComponent.PLMNewLibraryWidgetName,OKButtonLabel:s.multiSelectionComponent.PLMNewbutton_OK,immersiveFrame:null},popOverDialogProperties:{width:250,height:350,minHeight:250,modalFlag:!0,minWidth:400,icon:"none"},dialogButtons:!0,selectionMode:"DefaultMulti",favoriteButton:!0,handleClassification:!0,isRootSelectable:!0,isClassifyMultiEveDispatch:!0,isonSetActiveEveDispatch:!1,container:widget.body,widgetName:s.multiSelectionComponent.PLMNewLibraryWidgetName,tenant:e._parentOptions.tenant}),e.libraryActiveActionBar.addEvent("onClassifyMultiple",(function(t){var s=t.nodeData,a=[];e.autoComplete.selectedItems&&e.autoComplete.selectedItems.length?e.autoComplete.selectedItems.forEach((e=>{a.push(e.id)})):a=[];var o=[];if(s.forEach((function(t){a.includes(t.getID())||o.push(t.getID()),t.updateOptions({label:t.options.label,subLabel:u.loading,icon:[t.options.icons]}),t._options&&t._options.classUsage&&(e._classUsageMap.set(t.getID(),t._options.classUsage),m.getInformationPanel()?e.classifPropertiesUIInfo.setClassUsage(e.getClassUsage()):e.classifPropertiesUI.setClassUsage(e.getClassUsage())),g=!1})),o.length)e.PLMNewCommonWebService.getClassPaths({id:o,plmNewContextProvider:e.plmNewContextProvider,onComplete:function(t){const a=e.PLMNewCommonWebService.constructPath(t,"idPathMap");console.log(a);let i=m.getInformationPanel();s.forEach((t=>{e._classPathMap.set(t.id,a.get(t.id)),e._classNameMap.set(t.id,t.options.label),i?e.classifPropertiesUIInfo.setClassPath(e.getClassPath()):e.classifPropertiesUI.setClassPath(e.getClassPath())})),i?(e._isResetInProgress=!0,e.addContents({classId:o},s,null,!0).then((function(t){t.status&&"reset"==t.status||(e._addAttributeSection=!0,s.forEach((s=>{if(a.has(s.id)&&t.successIds.includes(s.id)){s.updateOptions({tooltip:new d({title:s.options.label,shortHelp:a.get(s.id),mouseRelativePosition:!0}),value:{subLabel:a.get(s.id)}}),e.autoComplete._model.prepareUpdate();let t=e.insertInAutocomplete(e._getAutocomplete(),s,a.get(s.id));e._nodesData[s.id]=t,e.autoComplete._model.pushUpdate();var o=e.autoComplete._model.getChildren().length;e.autoComplete._model.getNthRoot(o-1).select()}})),t.successIds.forEach(((s,a,o)=>{p.getClassificationAttributesForClassifedObjectOnOneClass({data:{classId:s,objId:m.getObjectId()},informationPanelContext:e.plmNewContextProvider,onComplete:function(e){try{var s=JSON.parse(e);if(s&&m.getClassifPropController())m.getClassifPropController().onAttributesLoad(s[0])}catch(e){console.log("Merging models error ",e)}t.successIds.length},onFailure:function(t){e._isProcessing=!1,e._parentInitMethod({...e._parentOptions,isRefreshContainer:!0})}})})),e._addAttributeSection=!1),e._isResetInProgress=!1}))):s.forEach((t=>{if(a.has(t.id)){t.updateOptions({tooltip:new d({title:t.options.label,shortHelp:a.get(t.id),mouseRelativePosition:!0}),subLabel:a.get(t.id),value:{subLabel:a.get(t.id)}}),e.autoComplete._model.prepareUpdate();let o=e.insertInAutocomplete(e._getAutocomplete(),t,a.get(t.id));e._nodesData[t.id]=o,e.autoComplete._model.pushUpdate();var s=e.autoComplete._model.getChildren().length;e.autoComplete._model.getNthRoot(s-1).select()}}))},onFailure:function(e){console.error(e)}});else{let e="";e=1==s.length?u.replace(u.classAlreadyExist,{classname:s[0].options.label}):u.classesAlreadyExist,f.displayNotification({message:e,className:"info"})}t.handleUI()})),e.libraryActiveActionBar.nestedMenuInContext.addEvent("onSelectorCancel",(function(e){g=!1})),g=!0)},getAdditionalNodesAtInit:async function(e,t,s){let a=this;return t&&new Promise(((e,o)=>{p.fetchExistingClassesAndAttributes({objectId:s,informationPanelContext:a.plmNewContextProvider,onComplete:function(s){if(s){let o=JSON.parse(s),i=[];o.length>0&&(o.forEach(((e,t)=>{i.push(e.id),a._classNameMap.set(e.id,e.label)})),a.PLMNewCommonWebService.getClassPaths({id:i,plmNewContextProvider:a.plmNewContextProvider,onComplete:function(s){const i=a.PLMNewCommonWebService.constructPath(s,"idPathMap");let n=[];o.forEach((e=>{let t={...e};t.icons=[{iconName:a._getIcon(t).iconName,fontIconFamily:1}],t.plmType=e.type,t.id=e.id,a._attributeMap.set(e.id,{attribute:e.attribute,isExisting:!0}),a._classUsageMap.set(e.id,e.classUsage),n.push(t)})),a._classPathMap=i,"function"==typeof a.getAttribute&&(m.getInformationPanel()?(a.classifPropertiesUIInfo.setClassPath(a.getClassPath()),a.classifPropertiesUIInfo.setExistingClassAttributes(a.getAttribute()),a.classifPropertiesUIInfo.setClassUsage(a.getClassUsage()),a.classifPropertiesUIInfo.setIsInformationPanel(t)):(a.classifPropertiesUI.setClassPath(a.getClassPath()),a.classifPropertiesUI.setExistingClassAttributes(a.getAttribute()),a.classifPropertiesUI.setClassUsage(a.getClassUsage()),a.classifPropertiesUI.setIsInformationPanel(t))),e(n)},onFailure:function(e){console.log("================",e)}}))}},onFailure:function(e){console.log("================",e)}})}))},getAttributesandClassPathsForExistingClasses:function(){return{_attributeMap:this._attributeMap,_classPathMap:this._classPathMap}},setClassPathForSearchData:function(e){console.log("data===",e),e.results.forEach((e=>{const t=e.attributes.find((e=>"physicalid"===e.name)),s=e.attributes.find((e=>"ds6w:classificationUsage"===e.name||"ds6w:what/ds6w:classificationUsage"===e.name));s&&this._classUsageMap.set(t.value,s.value)}))},saveNodes:function(e){this._nodesData[e.id]=e},isResetInProgress:function(e){return this._isResetInProgress},isAddAttributesSection:function(e){return this._addAttributeSection},isConfirmModel:function(e){return this._nodesData.accordianData=e,!0},removeContents:function(e,t){var s=this,a=[];e.accordianData=s._nodesData.accordianData;var o=s._nodesData;delete o.accordianData;for(let e in o)a.push(o[e]);let i=[];e.classId.forEach((e=>{i.push(o[e])}));var n=s.hasDefinitionClass(i);function l(e,a){if(a);else if(e.accordianData){var o=e.accordianData;1==o.removedIds.length?t.nodeHandler(o.removedIds[0],o.isNodeAdded,o.selectedIdsLabelMap.get(o.removedIds[0])):t.multiNodeHandler(o.removedIds,o.isNodeAdded,o.selectedIdsLabelMap)}e.classId.forEach((t=>{s._attributeMap.delete(t),s._classUsageMap.delete(t),s._classPathMap.delete(t);var a=s._classNameMap.get(t);p.removecontent({pid:t,IDs:e.IDs,informationPanelContext:s.plmNewContextProvider,onComplete:function(e){if(JSON.parse(e).failedCount)f.displayNotification({title:u.replace(u.declassificationFailureMesaageTitle,{classname:a}),subtitle:u.declassificationFailureMesaageSubTitle,className:"error"}),s._isProcessing=!1,s._parentInitMethod({...s._parentOptions,isRefreshContainer:!0});else{var o=JSON.parse(e);if(o&&"failure"==o.status){var i=u.declassificationFailureMesaageSubTitle;o.error&&(i=o.error.errorMsg),f.displayNotification({title:u.replace(u.declassificationFailureMesaageTitle,{classname:a}),subtitle:i,className:"error"}),s._isProcessing=!1,s._parentInitMethod({...s._parentOptions,isRefreshContainer:!0})}else delete s._nodesData[t],f.displayNotification({message:u.replace(u.declassificationSuccessMesaage,{number:1,classname:a}),className:"success"})}},onFailure:function(e){console.log("failed to remove the class ",e),f.displayNotification({title:u.replace(u.declassificationFailureMesaageTitle,{classname:a}),subtitle:u.declassificationFailureMesaageSubTitle,className:"error"}),s._isProcessing=!1,s._parentInitMethod({...s._parentOptions,isRefreshContainer:!0})}})}))}function r(e){s._isResetInProgress=!0,s.autoComplete._model.prepareUpdate();var t=s.autoComplete._model.getChildren().length;for(let e=0;e<t;e++)s.autoComplete._model.prepareUpdate(),s.autoComplete._model.nodeModel_reset=!0,s.autoComplete._model.removeRoot(0),s.autoComplete._model.pushUpdate(),s.autoComplete._model.nodeModel_reset=!1;s.autoComplete._model.nodeModel_reset=!0,s.autoComplete.selectedItems=[],s.autoComplete._model.nodeModel_reset=!1,s.previousPresentIds=[],e.forEach((e=>{let t;s.autoComplete._model.prepareUpdate(),e.options.tooltip&&e.options.tooltip.shortHelp&&(t=e.options.tooltip.shortHelp),s.insertInAutocomplete(s._getAutocomplete(),e,t),s.autoComplete._model.pushUpdate();var a=s.autoComplete._model.getChildren().length;a>0&&s.autoComplete._model.getNthRoot(a-1).select()})),s._isResetInProgress=!1}p.checkModifyAccessOnItems({withChangeCtx:!0,objectIds:e.IDs,informationPanelContext:s.plmNewContextProvider,onComplete:function(t){var o=e.classId.length,i=t?JSON.parse(t):void 0,d={buttonColor:"blue",deleteButtonLabel:u.titleRemove,moreInfo:u.msg_removeInfo,titleLabel:u.titleRemove+" - "+s._nodesData[e.classId[0]].label,warningMessage:u.replace(u.msg_removeSingleClass,{className:s._nodesData[e.classId[0]].label})};o>1&&(d.warningMessage=u.replace(u.msg_removeMultipleClass,{number:o}),d.titleLabel=u.titleRemove+" - "+o+" "+u.classes),i.unModifiableIds.length>0&&n&&(d.confirmationBoxText=u.confirmationMsg,d.moreInfo=u.msg_removeContentMoreInfo,d.enableConfirmationBox=!0,d.buttonColor="red"),o>1&&i.unModifiableIds.length>0&&n&&(d.confirmationBoxText=u.confirmationMsgMul),s.autoComplete.hidePopup(),c.confirmDialog(d,l,r,e,a)},onFailure:function(e){console.log(" Error while fetching modify access on items")}})},setClassUsageForSearchData:function(e){this._classPathMap=e},hasDefinitionClass:function(e){var t=!1;return e.forEach((e=>{"Definition"!=e._options.classUsage||(t=!0)})),t},addContents:function(e,t,a,o){m.setProvider(this);let i=this,l=e.classId.length;var r=t,d={};return d.accordianData=i._nodesData.accordianData,d.nodeHandlers=a,new Promise((t=>{var a={},g=l,C=!1;a.deleteButtonLabel=u.title_Add,a.buttonColor="blue",g>1?(C=!0,a.titleLabel=u.title_Add+" - "+g+" classes",a.warningMessage=s.replace(u.msg_addClasses,{number:g})):(a.titleLabel=u.title_Add+" - "+r[0]._options.label,a.warningMessage=u.replace(u.msg_addClass,{className:r[0]._options.label}));var h=i.hasDefinitionClass(r);function b(e){n.performMultiClassify({data:{Classifications:e.classId,ItemsToClassify:[m.getObjectId()]},plmNewContextProvider:()=>i.plmNewContextProvider,onComplete:function(e){if(e){if(e.failedIds.length>0){var s=null;e.errorMsg&&e.errorMsg.contains("BL Error")&&(s=e.errorMsg),e.errorMsg&&e.errorMsg.contains("relationship does not allow type of business object or relationship")&&(s=u.errorForAddContentTypeFail),1==e.failedIds.length?f.displayNotification({title:u.classificationFailureMesaageTitle,subtitle:s||u.replace(u.classificationFailureMesaageSubTitle,{classname:i._classNameMap.get(e.failedIds[0])}),className:"error"}):f.displayNotification({title:u.replace(u.classificationFailureForMultipleClassesMessageTitle,{classCount:e.failedIds.length}),subtitle:s||u.classificationFailureForMultipleClassesMessageSubTitle,className:"error"})}e.successIds.length>0&&(1==e.successIds.length?f.displayNotification({subtitle:u.replace(u.classificationSuccessMesaage,{classname:i._classNameMap.get(e.successIds[0])}),className:"success"}):f.displayNotification({subtitle:u.replace(u.classificationSuccessForMultipleClassesMessageSubTitle,{classCount:e.successIds.length}),className:"success"})),e.successIds.length>0&&1!=o?e.successIds.forEach(((s,a,o)=>{p.getClassificationAttributesForClassifedObjectOnOneClass({data:{classId:s,objId:m.getObjectId()},informationPanelContext:i.plmNewContextProvider,onComplete:function(s){try{var o=JSON.parse(s);if(o&&m.getClassifPropController())m.getClassifPropController().onAttributesLoad(o[0])}catch(e){console.log("Merging models error ",e)}a==e.successIds.length-1&&(i._addAttributeSection=!0,t(e))},onFailure:function(e){i._isProcessing=!1,i._parentInitMethod({...i._parentOptions,isRefreshContainer:!0}),reject(e)}})})):(1==l&&1==e.failedIds.length&&(i._isProcessing=!1,i._parentInitMethod({...i._parentOptions,isRefreshContainer:!0})),t(e))}},onFailure:function(t){f.displayNotification({title:u.classificationFailureMesaageTitle,subtitle:u.replace(u.classificationFailureMesaageSubTitle,{classname:i._classNameMap.get(e.classId[0])}),className:"error"}),i._isProcessing=!1,i._parentInitMethod({...i._parentOptions,isRefreshContainer:!0}),reject(t)}})}function _(e){i._isResetInProgress=!0;var s=[];if(i.autoComplete._model.getSelectedNodes().forEach((e=>{const t=i.previousPresentIds.indexOf(e.id);t>-1&&(s=i.previousPresentIds.splice(t,1))})),i.autoComplete._model.getSelectedNodes().length>0){if(delete i._nodesData[s[0]],e.accordianData){var a=e.accordianData;1==a.removedIds.length?e.nodeHandlers.nodeHandler(a.removedIds[0],!1,a.selectedIdsLabelMap.get(a.removedIds[0])):e.nodeHandlers.multiNodeHandler(a.removedIds,!1,a.selectedIdsLabelMap)}i.autoComplete._model.prepareUpdate(),i.autoComplete._model.nodeModel_reset=!0,i.autoComplete._model.getSelectedNodes()[0].remove(),i.autoComplete._model.pushUpdate(),i.autoComplete._model.nodeModel_reset=!1}i._isResetInProgress=!1,t({status:"reset"})}h?p.checkModifyAccessOnItems({withChangeCtx:!0,objectIds:[m.getObjectId()],informationPanelContext:i.plmNewContextProvider,onComplete:function(t){var s=t?JSON.parse(t):void 0;i.autoComplete.hidePopup(),C&&s.unModifiableIds.length>0&&h&&(a.moreInfo=u.msg_addContentsMoreInfo),s.unModifiableIds.length>0&&h?(a.moreInfo=u.msg_addContentMoreInfo,c.confirmDialog(a,b,_,e,d)):b(e)},onFailure:function(e){console.log(" Error while fetching modify access on items"),reject(e)}}):b(e)}))},getClassUsage:function(){return this._classUsageMap},getClassPath:function(){return this._classPathMap},getAttribute:function(){return this._attributeMap},updateAttribute:function(e){return p.updateAttributesFromInformationPanel(e)},getClassificationAttributesForAClass:function(e){return p.getClassificationAttributesForClassifedObjectOnOneClass({data:e.payload,informationPanelContext:that.plmNewContextProvider,onComplete:function(e){return e},onFailure:function(e){console.log(e)}})},setClassNameForSearchData:function(e){e.results.forEach((e=>{const t=e.attributes.find((e=>"physicalid"===e.name)),s=e.attributes.find((e=>"ds6w:label"===e.name));s&&this._classNameMap.set(t.value,s.value)}))}})}));