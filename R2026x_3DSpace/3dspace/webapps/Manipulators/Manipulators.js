define("DS/Manipulators/Manipulator",["UWA/Class","DS/VisuEvents/EventsManager","DS/Visualization/ThreeJS_DS","DS/CoreEvents/Events","DS/Visualization/PathElement","DS/CoreEvents/ModelEvents","DS/VisuEvents/ScreenEvent"],(function(t,i,e,n,a,r,o){"use strict";var s=0,l=0,u=t.extend({init:function(t,i){return this.viewer=t,this._uid=s++,this.active=!0,this.a2xLocal=!1,this.hasPriority=!1,this._pickingPriority=!0,this._pickingInManip=!1,this._selectionAllowed=!1,this._prePickingDuringManip=!0,this._preActivationDuringManip=!0,this._pickingDuringManip=!0,this._checkManipsWhenEnabled=!1,this.links={},this.manipulatedPaths=[],this.preactivated={path:null,node:null},this._modelEvent=new r,this._isDynamic=void 0!==i&&i,this},enable:function(){this.active=!0},disable:function(){this.active=!1},setExclusive:function(t){this.hasPriority=t},setDynamic:function(t){this._isDynamic=t},setA2XLocalManipulator:function(t){this.a2xLocal=t},getA2XLocalManipulator:function(){return this.a2xLocal},getPriority:function(){return this.hasPriority},getPickingPriority:function(){return this._pickingPriority},setPickingPriority:function(t){this._pickingPriority=t},setPickingInManipulation:function(t){this._pickingInManip=t},getPickingInManipulation:function(){return this._pickingInManip},setSelectionAllowed:function(t){this._selectionAllowed=t},getSelectionAllowed:function(){return this._selectionAllowed},setPrePickingDuringManipulation:function(t){this._prePickingDuringManip=t},getPrePickingDuringManipulation:function(){return this._prePickingDuringManip},setPreActivationDuringManipulation:function(t){this._preActivationDuringManip=t},getPreActivationDuringManipulation:function(){return this._preActivationDuringManip},setPickingDuringManipulation:function(t){this._pickingDuringManip=t},getPickingDuringManipulation:function(){return this._pickingDuringManip},checkManipulatorsOnCreation:function(t){this._checkManipsWhenEnabled=t},getUID:function(){return this._uid},linkToNode:function(t){t.setIsManipulator?t.setIsManipulator(!0):t.isManipulator=!0;var i=this._buildLink({node:t});return this.activate(i),i},linkToPath:function(t){t.getLastElement().setIsManipulator(!0);var i=this._buildLink({path:t});return this.activate(i),i},_linkToViewer:function(){var t=this._buildLink({viewer:this.viewer});return this.activate(t),t},_buildLink:function(t){var i=l++;return this.links[i]={path:t.path,node:t.node,viewer:t.viewer,states:{manipulateState:u.State.NONE,preActivateState:u.State.NONE}},i},unlink:function(t){if(this.links[t]){var i=this.links[t];if(i.node?i.node.setIsManipulator?i.node.setIsManipulator(!1):i.node.isManipulator=!1:i.path&&i.path.getLastElement().setIsManipulator(!1),this.deactivate(t))return delete this.links[t],!0}return!1},activate:function(t){if(void 0===t)return!1;var e=this.links[t];if(!e)return!1;if(e.viewer)e.viewer._addManipulator(this,t);else{for(var n=e.node?e.node:e.path,r=n instanceof a?n._getOccurrences():n._occurrences,o=[],s={},l=0;l<r.length;l++){(v=r[l])._manipulators[t]=this;for(var c=v._getRenderableOccurrences(),p=0;p<c.length;p++)o.push(c[p])}for(var h=0;h<o.length;h++){var v,d=o[h];void 0===d._manipulators&&(d._manipulators={}),d._manipulators[t]=this,(v=d._occurrence)&&v.scene3js&&v.scene3js.viewer&&v.scene3js.viewer.manipulatorManager&&(s[v.scene3js.viewer.id]=v.scene3js.viewer)}if(this._checkManipsWhenEnabled&&e.states.manipulateState===u.State.NONE)for(var w in s){var P=s[w],m=i.getMouseEvents(-1,P.canvas);m.length&&P.manipulatorManager._onMove({from:[m[0]],viewer:P},!0)}}return!0},deactivate:function(t){if(void 0===t)return!1;var i=this.links[t];if(!i)return!1;if(i.viewer)i.viewer._removeManipulator(t);else{for(var e=i.node?i.node:i.path,n=e instanceof a?e._getOccurrences():e._occurrences,r=[],o=0;o<n.length;o++){var s=n[o];s._manipulators[t]&&delete s._manipulators[t];var l=s._getRenderableOccurrences();for(u=0;u<l.length;u++)r.push(l[u])}for(var u=0;u<r.length;u++){var c=r[u];c._manipulators&&c._manipulators[t]&&delete c._manipulators[t]}}return!0},BeginManipulate:function(t,i,e,n){if(this.hasPriority&&i.viewer&&null!==i.viewer._viewpointManager.getManipulatedViewpoint()?i.viewer._viewpointManager.getManipulatedViewpoint().control._onStopManip(i):this.hasPriority&&i.viewer&&i.viewer.currentViewpoint&&i.viewer.currentViewpoint.control&&i.viewer.currentViewpoint.control._onStopManip(i),t)if(t instanceof a)this.manipulatedPaths.push(t);else for(var r=0;r<t._occurrences.length;r++){var o=t._occurrences[r],s=new a;s.setFromOccurrence(o);for(var l=s._getRenderableOccurrences(),u=0;u<l.length;u++){var c=new a;c.setFromOccurrence(l[u]._occurrence),this.manipulatedPaths.push(c)}}},Manipulate:function(t,i,e,n){},EndManipulate:function(t,i,e,n){this.manipulatedPaths=[]},HandleLongHold:function(t,i){return!1},PrimaryPointerClick:function(t,i,e,n){},PrimaryPointerDoubleClick:function(t,i,e,n){},RightClick:function(t,i,e,n){},BeginPreactivate:function(t,i,e,n){},Preactivate:function(t,i,e,n){},EndPreactivate:function(t,i,e,n){},onBeginManipulate:function(t){return this._modelEvent.subscribe({event:"BeginManipulate"},t)},onManipulate:function(t){return this._modelEvent.subscribe({event:"Manipulate"},t)},onEndManipulate:function(t){return this._modelEvent.subscribe({event:"EndManipulate"},t)},onBeginPreactivate:function(t){return this._modelEvent.subscribe({event:"BeginPreactivate"},t)},onPreactivate:function(t){return this._modelEvent.subscribe({event:"Preactivate"},t)},onEndPreactivate:function(t){return this._modelEvent.subscribe({event:"EndPreactivate"},t)},onPrimaryPointerClick:function(t){return this._modelEvent.subscribe({event:"PrimaryPointerClick"},t)},onPrimaryPointerDoubleClick:function(t){return this._modelEvent.subscribe({event:"PrimaryPointerDoubleClick"},t)},subscribe:function(t,i){return this._modelEvent.subscribe({event:t},i)},unsubscribe:function(t){this._modelEvent.unsubscribe(t)},publish:function(t,i){return this._modelEvent.publish({event:t,data:i,context:this})},reset:function(t){if(0!=this.manipulatedPaths.length){var i=this.manipulatedPaths[0].getLastElement(!0)._occurrences,e=t.viewer||i[0].scene3js.viewer,n=t.viewpoint||i[0]._getViewpoint();e&&e.manipulatorManager._resetManipulatorAssociatedViewpoint(this,n)}},DEPRECATED_CONSTRUCTOR:function(t){return!!(t&&t[0]instanceof THREEDS.WebGLV6Viewer)&&(c>0&&(c--,console.log("[Manipulators] DEPRECATED Manipulator construction: "+(new Error).stack)),!0)}}),c=50;return u.State={NONE:0,BEGIN:1,MOVE:2,END:3},UWA.namespace("THREEDS/Nodes/Manipulator",u)})),define("Manipulators/Manipulator",["DS/Manipulators/Manipulator","DS/DSMigration/DSMigration"],(function(t,i){return i.deprecateModule("Manipulators/Manipulator"),t})),define("DS/Manipulators/TrapSelectionManipulator",["DS/Manipulators/Manipulator"],(function(t){"use strict";return t.extend({init:function(t,i){this._parent(t),this.extremities={xPix:0,x:0,yPix:0,y:0},this.originPoint=null,this.startTime=null,this.divTrap=this.setupDivTrap(t.divTrap),this.noCursorChange=!0,this.isActive=!0,this.advancedSelection=!!i,this.forwardSelect=!1,this.showDivTrap=!0,this.setPreActivationDuringManipulation(!1)},setAdvanced:function(t){this.advancedSelection=t,t||(this.setupDivTrap(this.divTrap),this.forwardSelect=!1)},setShowDivTrap:function(t){this.showDivTrap=t},BeginManipulate:function(t,i,e,n){n=n||i.viewer.currentViewpoint,this.viewer.setCursor("TrapSelection",100),this.originPoint=this.viewer.getMousePosition(i.from[0].getCurrentPosition(this.viewer.canvas)),this.setExtremities(this.originPoint),this.startTime=Date.now(),this.manipIndex=0},Manipulate:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a=this.viewer.getMousePosition(i.from[0].getCurrentPosition(this.viewer.canvas)),r=this.viewer.devicePixelRatio;this.setExtremities(this.originPoint,a),this.divTrap&&(this.showDivTrap&&this.divTrap.show(),this.divTrap.setStyles({width:(this.extremities.pt.xPix-this.extremities.xPix)/r,height:(this.extremities.pt.yPix-this.extremities.yPix)/r,left:this.extremities.xPix/r,top:this.extremities.yPix/r,pointerEvents:"none"}))},EndManipulate:function(t,i,e,n){n=n||i.viewer.currentViewpoint,this.viewer.setCursor("Auto"),this.extremities&&this.divTrap&&(this.divTrap.hide(),this.divTrap.setStyles({width:"0px",height:"0px",left:"0px",top:"0px",pointerEvents:"none"}),this.viewer._doPickingFromMouseEvent(i.from[0],this.viewer.currentViewpoint.control,this)),this.setExtremities(null)},HandleLongHold:function(t,i){return!0},setupDivTrap:function(t){return t.setStyles({position:"absolute",opacity:"0.8",pointerEvents:"none",border:"1px dashed black",backgroundColor:"transparent"}),t.hide(),t},setExtremities:function(t,i){if(t)if(i){var e,n={},a={},r=!0;if(t.xPix<i.xPix?(r=!0,n.xPix=t.xPix,n.x=t.x,a.xPix=i.xPix,a.x=i.x):(r=!1,n.xPix=i.xPix,n.x=i.x,a.xPix=t.xPix,a.x=t.x),t.yPix<i.yPix?(n.yPix=t.yPix,n.y=t.y,a.yPix=i.yPix,a.y=i.y):(n.yPix=i.yPix,n.y=i.y,a.yPix=t.yPix,a.y=t.y),this.extremities=n,this.extremities.pt=a,this.advancedSelection&&this.divTrap&&this.forwardSelect!==r)e=r?{border:"2px solid #f5c77e",backgroundColor:"rgba(245, 200, 125, 0.5)"}:{border:"2px dashed #75cdf0",backgroundColor:"rgba(117, 205, 240, 0.5)"},this.divTrap.setStyles(e),this.forwardSelect=r}else this.extremities=t;else this.extremities=null},getExtremities:function(){return this.extremities}})})),define("DS/Manipulators/HandlePointManipulator",["DS/Visualization/ThreeJS_DS","DS/CoreEvents/Events","DS/Manipulators/Manipulator"],(function(t,i,e){"use strict";var n=e.extend({init:function(){return this.DEPRECATED_CONSTRUCTOR(arguments),this._parent(),this},BeginManipulate:function(t,i,e,n){n=n||i.viewer.currentViewpoint,this._parent(t,i,e);var a={viewer:i.viewer,eventChannel:"BeginManipulate",event:i,paths:this.manipulatedPaths,intersection:e,viewpoint:n,manipulator:this};this.publish("BeginManipulate",a)},Manipulate:function(t,i,e,n){n=n||i.viewer.currentViewpoint,this._parent(t,i,e);var a={viewer:i.viewer,eventChannel:"Manipulate",event:i,paths:this.manipulatedPaths,intersection:e,viewpoint:n,manipulator:this};this.publish("Manipulate",a)},EndManipulate:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"EndManipulate",event:i,paths:this.manipulatedPaths,intersection:e,viewpoint:n,manipulator:this};this.publish("EndManipulate",a),this._parent(t,i,e)},BeginPreactivate:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"BeginPreactivate",event:i,preactivated:this.preactivated,intersection:e,viewpoint:n,manipulator:this};this.publish("BeginPreactivate",a)},Preactivate:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"Preactivate",event:i,preactivated:this.preactivated,intersection:e,viewpoint:n,manipulator:this};this.publish("Preactivate",a)},EndPreactivate:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"EndPreactivate",event:i,preactivated:this.preactivated,intersection:e,viewpoint:n,manipulator:this};this.publish("EndPreactivate",a)},PrimaryPointerClick:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"PrimaryPointerClick",event:i,intersection:e,viewpoint:n,manipulator:this};this.publish("PrimaryPointerClick",a)},PrimaryPointerDoubleClick:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"PrimaryPointerDoubleClick",event:i,intersection:e,viewpoint:n,manipulator:this};this.publish("PrimaryPointerDoubleClick",a)}});return UWA.namespace("THREEDS/Manipulators/HandlePointManipulator",n)})),define("Manipulators/HandlePointManipulator",["DS/Manipulators/HandlePointManipulator","DS/DSMigration/DSMigration"],(function(t,i){return i.deprecateModule("Manipulators/HandlePointManipulator"),t})),define("DS/Manipulators/PlaneTranslationManipulator",["DS/Visualization/ThreeJS_DS","DS/CoreEvents/Events","DS/Manipulators/Manipulator","DS/Visualization/PathElement"],(function(t,i,e,n){"use strict";var a=e.extend({init:function(i){var e;return e=this.DEPRECATED_CONSTRUCTOR(arguments)?{axis:arguments[1]}:i||{},this._parent(),this.axis=e.axis,this.axis.normalize(),this.projector=new t.Projector,this},BeginManipulate:function(i,e,n,a){a=a||e.viewer.currentViewpoint,this._parent(i,e,n),this.initial3dIntersectionPoint=n.position,this.plane=(new t.Plane).setFromNormalAndCoplanarPoint(this.axis,n.position);var r={viewer:e.viewer,eventChannel:"BeginManipulate",event:e,paths:this.manipulatedPaths,intersection:n,viewpoint:a,manipulator:this};this.publish("BeginManipulate",r)},_getTranslationVector:function(i,e){var n=(new t.Vector2).copy(i.from[0].getCurrentPosition(i.viewer.canvas)),a=e.create3DRayFrom2DPoint(n),r=a.intersectPlane(this.plane);let o=Math.abs(this.plane.normal.dot(a.direction))<1e-7;if(!r||o){var s=(r=new t.Vector3).subVectors(this.initial3dIntersectionPoint,a.origin).dot(a.direction);r.copy(a.direction).multiplyScalar(s).add(a.origin)}var l=(new t.Vector3).subVectors(r,this.initial3dIntersectionPoint);return l.projectOnPlane(this.axis),l},Manipulate:function(t,i,e,n){n=n||i.viewer.currentViewpoint,this._parent(t,i,e);var a=this._getTranslationVector(i,n),r={viewer:i.viewer,eventChannel:"Manipulate",event:i,paths:this.manipulatedPaths,translationVector:a,intersection:e,viewpoint:n,manipulator:this};this.publish("Manipulate",r)},EndManipulate:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a=this._getTranslationVector(i,n),r={viewer:i.viewer,eventChannel:"EndManipulate",event:i,paths:this.manipulatedPaths,translationVector:a,intersection:e,viewpoint:n,manipulator:this};this.publish("EndManipulate",r),this._parent(t,i,e)},BeginPreactivate:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"BeginPreactivate",event:i,preactivated:this.preactivated,intersection:e,viewpoint:n,manipulator:this};this.publish("BeginPreactivate",a)},Preactivate:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"Preactivate",event:i,preactivated:this.preactivated,intersection:e,viewpoint:n,manipulator:this};this.publish("Preactivate",a)},EndPreactivate:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"EndPreactivate",event:i,preactivated:this.preactivated,intersection:e,viewpoint:n,manipulator:this};this.publish("EndPreactivate",a)},PrimaryPointerClick:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"PrimaryPointerClick",event:i,intersection:e,viewpoint:n,manipulator:this};this.publish("PrimaryPointerClick",a)},PrimaryPointerDoubleClick:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"PrimaryPointerDoubleClick",event:i,intersection:e,viewpoint:n,manipulator:this};this.publish("PrimaryPointerDoubleClick",a)}});return UWA.namespace("THREEDS/Nodes/PlaneTranslationManipulator",a)})),define("Manipulators/PlaneTranslationManipulator",["DS/Manipulators/PlaneTranslationManipulator","DS/DSMigration/DSMigration"],(function(t,i){return i.deprecateModule("Manipulators/PlaneTranslationManipulator"),t})),define("DS/Manipulators/ManipulatorManager",["UWA/Class","DS/CoreEvents/Events","DS/VisuEvents/EventsManager","DS/Visualization/ThreeJS_DS","DS/Visualization/TrackballControls","DS/Manipulators/Manipulator"],(function(t,i,e,n,a,r){"use strict";var o=5,s=function(t,i){this._path=null,this._position=null,this._normal=null,this._tangent=null,this._uv=null,this._ray=null,this.__viewer=t,this.__event=i},l=function(t){var i;if(i=new Error,0!==o&&(console.log("[Manipulator] Manipulate method does not define the intersection argument anymore.\nIf you really need the picking result, you have to explicitly call setPickingDuringManipulation(true) on your manipulator.\n"+i.stack),o--),!t._path&&t.__viewer&&t.__event){var e;if(t.__event.gesture)e=t.__event.gesture.getEvents()[0];else e=t.__event.from[0];var n=t.__viewer.getMousePosition(e.getCurrentPosition(t.__viewer.canvas));n.event=e;var a=t.__viewer.pick(n,"mesh",!0);t._path=a.path,t._position=a.position,t._normal=a.normal,t._tangent=a.tangent,t._uv=a.uv,t._ray=a.ray,c(a,t.__viewer,n)}};Object.defineProperty(s.prototype,"path",{get:function(){return l(this),this._path}}),Object.defineProperty(s.prototype,"position",{get:function(){return l(this),this._position}}),Object.defineProperty(s.prototype,"normal",{get:function(){return l(this),this._normal}}),Object.defineProperty(s.prototype,"tangent",{get:function(){return l(this),this._tangent}}),Object.defineProperty(s.prototype,"uv",{get:function(){return l(this),this._uv}}),Object.defineProperty(s.prototype,"ray",{get:function(){return l(this),this._ray}});var u=t.extend({init:function(t){this.viewer=t,this.currentDocument=t.contextDocument,this.enabled=!0,this.preActivation=!0,this.manipulatedManipulators={},this.manipulatedManipulatorsAssociatedViewpoints={},this.hoveredManipulator=null,this._attachEvents()},getActivate:function(){return this.enabled},setActivate:function(t){this.enabled=t},setPreActivate:function(t){this.preActivation=t},isInManipulation:function(t,i){for(var e in this.manipulatedManipulators){var n=this.manipulatedManipulators[e],a=n.links[e];if(!t||a&&a.states.manipulateState!==r.State.END)if(!i&&!n.getPickingInManipulation()||i&&!n.getPrePickingDuringManipulation())return!0}return!1},isPreActivationDisabledOnManipulatedManipulators:function(){for(var t in this.manipulatedManipulators){var i=this.manipulatedManipulators[t],e=i.links[t];if(e&&e.states.manipulateState!==r.State.END&&!i.getPreActivationDuringManipulation())return!0}return!1},_attachEvents:function(){var t=this;this.onPrimaryPointerEventCB=function(i){t._resetManipulatedManipulators(),i.viewer=t.viewer,t._onEdit.call(t,i,1)},e.addEvent(this.currentDocument,"onPrimaryPointerDownUnique",this.onPrimaryPointerEventCB),this.onLeftClickCB=function(i){i.viewer=t.viewer,t._resetManipulatedManipulators(),t._onLeftClick.call(t,i)},e.addEvent(this.currentDocument,"onPrimaryPointerClick",this.onLeftClickCB),this.onLeftDoubleClickCB=function(i){i.viewer=t.viewer,t._resetManipulatedManipulators(),t._onLeftDoubleClick.call(t,i)},e.addEvent(this.currentDocument,"onPrimaryPointerDoubleClick",this.onLeftDoubleClickCB),this.onRightClickCB=function(i){i.viewer=t.viewer,t._resetManipulatedManipulators(),t._onRightClick.call(t,i)},e.addEvent(this.currentDocument,"onRightClick",this.onRightClickCB),this.onEditCB=function(i){i.viewer=t.viewer,t._resetManipulatedManipulators(),t._onEdit.call(t,i,0)},e.addEvent(this.currentDocument,"onEdit",this.onEditCB),this.onSmartEditCB=function(i){i.viewer=t.viewer,t._resetManipulatedManipulators(),t._onEdit.call(t,i,2)},e.addEvent(this.currentDocument,"onSmartEdit",this.onSmartEditCB),this.onMouseMoveCB=function(i){i.viewer=t.viewer,t._onMove.call(t,i,!0)},e.addEvent(this.currentDocument,"onMouseMove",this.onMouseMoveCB),this.onSwipeCB=function(i){i.viewer=t.viewer,t._onMove.call(t,i,!1)},e.addEvent(this.viewer.div,"onSwipe",this.onSwipeCB),this.onLeftMouseUpCB=function(i){i.viewer=t.viewer,t._onRelease.call(t,i)},e.addEvent(this.currentDocument,"onLeftMouseUp",this.onLeftMouseUpCB),this.onReleaseCB=function(i){i.viewer=t.viewer,t._onRelease.call(t,i)},e.addEvent(this.currentDocument,"onRelease",this.onReleaseCB),this.onEditEvent=i.subscribe({event:"/VISU/onEdit"},(function(i){i.viewer=t.viewer})),this.onMouseMoveEvent=i.subscribe({event:"/VISU/onMouseMove"},(function(i){i.viewer=t.viewer})),this.onSwipeEvent=i.subscribe({event:"/VISU/onSwipe"},(function(i){i.viewer=t.viewer})),this.onLeftMouseUpEvent=i.subscribe({event:"/VISU/onLeftMouseUp"},(function(i){i.viewer=t.viewer})),this.onReleaseEvent=i.subscribe({event:"/VISU/onRelease"},(function(i){i.viewer=t.viewer})),this.onLongHoldCB=function(i){i.viewer=t.viewer,t._onLongHold.call(t,i)},e.addEvent(this.currentDocument,"onLongHold",this.onLongHoldCB)},_detachEvents:function(){e.removeEvent(this.currentDocument,"onPrimaryPointerDownUnique",this.onPrimaryPointerEventCB),e.removeEvent(this.currentDocument,"onPrimaryPointerClick",this.onLeftClickCB),e.removeEvent(this.currentDocument,"onPrimaryPointerDoubleClick",this.onLeftDoubleClickCB),e.removeEvent(this.currentDocument,"onLongHold",this.onLongHoldCB),e.removeEvent(this.currentDocument,"onEdit",this.onEditCB),e.removeEvent(this.currentDocument,"onMouseMove",this.onMouseMoveCB),e.removeEvent(this.viewer.div,"onSwipe",this.onSwipeCB),e.removeEvent(this.currentDocument,"onLeftMouseUp",this.onLeftMouseUpCB),e.removeEvent(this.currentDocument,"onRelease",this.onReleaseCB)},_addToManipulators:function(t,i,e){this.manipulatedManipulators[i]||(this.manipulatedManipulators[i]=t,this.manipulatedManipulatorsAssociatedViewpoints[i]=e)},_resetManipulatedManipulators:function(){for(var t in this.manipulatedManipulators){var i=this.manipulatedManipulators[t].links[t];i&&i.states.manipulateState!==r.State.END||(delete this.manipulatedManipulators[t],delete this.manipulatedManipulatorsAssociatedViewpoints[t])}},_getManipulatedManipulator:function(){for(var t in this.manipulatedManipulators){var i=this.manipulatedManipulators[t];if(i)return i}return null},_getManipulators:function(t){var i={};if(!t)return i;if(t._manipulators)for(var e in t._manipulators)i[e]=t._manipulators[e];for(var n=t._occurrence;n.parent;)if((n=n.parent)._manipulators)for(var e in n._manipulators){var a=n._manipulators[e];a._isDynamic&&(i[e]=a)}return i},_applyToManipulatorsOverPointer:function(t,i,e,n){if(this.viewer&&this.viewer.canvas){var a,r,o;if(t.gesture)o=t.gesture.getEvents()[0];else o=t.from[0];if((a=this.viewer.getMousePosition(n?o.getStartPosition(this.viewer.canvas):o.getCurrentPosition(this.viewer.canvas))).event=o,null!==this.viewer.currentViewpoint){var s,l=o.isInView([this.viewer.canvas,this.viewer.divCssElement]);if(l&&c(r=this.viewer.pick(a,"mesh",!0),this.viewer,a),l&&r.path.length){var u=r.path[0]._getRenderableOccurrences(this.viewer);if(1!==u.length)return;var p=u[0],h=!1,v=this._getManipulators(p),d=this.viewer.currentViewpoint;for(s in p&&p._occurrence&&(d=p._occurrence._getViewpoint()||d),v){var w;(w=v[s]).active&&(h=!0,i.call(this,w,s,r,d))}if(h)return}if(l)for(s in this.viewer._manipulators)if((w=this.viewer._manipulators[s]).active)return void i.call(this,w,s,r,this.viewer.currentViewpoint);e&&e.call(this,r)}}},_applyToManipulatedManipulators:function(t,i,e){var n,a,o,s=null;t.gesture?a=t.gesture.getEvents()[0]:a=t.from[0];if((n=this.viewer.getMousePosition(a.getCurrentPosition(this.viewer.canvas))).event=a,null!==this.viewer.currentViewpoint)for(o in this.manipulatedManipulators){var l=this.manipulatedManipulators[o],u=l.links[o],p=this.manipulatedManipulatorsAssociatedViewpoints[o];u&&u.states.manipulateState!==r.State.END&&(l.active&&((e||l.getPickingDuringManipulation())&&c(s=this.viewer.pick(n,"mesh",!0),this.viewer,n),i.call(this,l,o,s,p)))}},_onLeftClick:function(t){this.enabled&&this._applyToManipulatorsOverPointer(t,(function(i,e,n,a){var o=i.links[e];if(o){var s=o.states.manipulateState;s!==r.State.NONE&&s!==r.State.END||i.PrimaryPointerClick(o.path?o.path:o.node,t,n,a)}}))},_onLeftDoubleClick:function(t){this.enabled&&this._applyToManipulatorsOverPointer(t,(function(i,e,n,a){var o=i.links[e];if(o){var s=o.states.manipulateState;s!==r.State.NONE&&s!==r.State.END||i.PrimaryPointerDoubleClick(o.path?o.path:o.node,t,n,a)}}))},_onRightClick:function(t){this.enabled&&this._applyToManipulatorsOverPointer(t,(function(i,e,n,a){var o=i.links[e];if(o){var s=o.states.manipulateState;s!==r.State.NONE&&s!==r.State.END||i.RightClick(o.path?o.path:o.node,t,n,a)}}))},_onEdit:function(t,i){if(this.enabled){var e=!0,n=!1,a=!1,o=!1;this._applyToManipulatorsOverPointer(t,(function(s,l,u,c){let p=this.viewer._viewpointManager.getManipulatedViewpoint();!p&&this.viewer.currentViewpoint&&(p=this.viewer.currentViewpoint);var h=p.control,v=!s._selectionAllowed&&1===i&&s.hasPriority,d=!s._selectionAllowed&&!i&&!s.hasPriority,w=s._selectionAllowed&&2===i;if(v||d||w){var P=s.links[l];if(!P)return;var m=P.states.manipulateState;if(m===r.State.NONE||m===r.State.END){if(e)for(var M in e=!1,this.manipulatedManipulators)n=!0;if(n)return;s.BeginManipulate(P.path?P.path:P.node,t,u,c),P.states.manipulateState=r.State.BEGIN,this._addToManipulators(s,l,c),o||s.noCursorChange||(this.viewer.setCursor("Grab"),o=!0)}}s._selectionAllowed&&1===i&&h&&h._onStopManip(t),s._selectionAllowed||1!==i||s.hasPriority||!h||a||h._showSpinnerOnHold||(h._onEditEventBegin(t),a=!0)}),null,2===i)}},_onMove:function(t,i){this.enabled&&(i&&this.viewer&&this.preActivation&&!this.isPreActivationDisabledOnManipulatedManipulators()&&(!this.viewer.pPicking.disableWhileMoving||this.viewer.pPicking.disableWhileMoving&&!this.viewer.isManipulatedViewpointMoving())&&this._applyToManipulatorsOverPointer(t,(function(i,e,n,a){if(i.active){var o=i.links[e];if(!o)return;this.hoveredManipulator?e!==this.hoveredManipulator.token?(this.lastLink=this.hoveredManipulator.manip.links[this.hoveredManipulator.token],this.lastLink&&(this.hoveredManipulator.manip.EndPreactivate(this.lastLink.path?this.lastLink.path:this.lastLink.node,t,n,a),this.lastLink.states.preActivateState=r.State.END),i.preactivated.path=n.path[0],i.BeginPreactivate(o.path?o.path:o.node,t,n,a),o.states.preActivateState=r.State.BEGIN,this.hoveredManipulator={token:e,manip:i}):(o.states.preActivateState=r.State.MOVE,i.Preactivate(o.path?o.path:o.node,t,n,a)):(i.preactivated.path=n.path[0],i.BeginPreactivate(o.path?o.path:o.node,t,n,a),o.states.preActivateState=r.State.BEGIN,this.hoveredManipulator={token:e,manip:i})}}),(function(i){this.hoveredManipulator&&(this.lastLink=this.hoveredManipulator.manip.links[this.hoveredManipulator.token],this.lastLink&&(this.hoveredManipulator.manip.EndPreactivate(this.lastLink.path?this.lastLink.path:this.lastLink.node,t,i),this.lastLink.states.preActivateState=r.State.END),this.hoveredManipulator=null)})),this._applyToManipulatedManipulators(t,(function(i,e,n,a){var o=i.links[e];o&&(o.states.manipulateState!==r.State.BEGIN&&o.states.manipulateState!==r.State.MOVE||(n||(n=new s(this.viewer,t)),i.Manipulate(o.path?o.path:o.node,t,n,a),o.states.manipulateState=r.State.MOVE))}),!1))},_onRelease:function(t){this.enabled&&this._applyToManipulatedManipulators(t,(function(i,e,n,a){var o=i.links[e];o&&(o.states.manipulateState!==r.State.BEGIN&&o.states.manipulateState!==r.State.MOVE||(i.EndManipulate(o.path?o.path:o.node,t,n,a),o.states.manipulateState=r.State.END))}),!0)},_onLongHold:function(t){this.enabled&&this._applyToManipulatedManipulators(t,(function(i,e,n,a){var o=i.links[e];o&&(o.states.manipulateState!==r.State.BEGIN&&o.states.manipulateState!==r.State.MOVE||i.HandleLongHold(o.path?o.path:o.node,t)&&(o.states.manipulateState=r.State.END))}),!1)},_resetManipulatorAssociatedViewpoint:function(t,i){for(let r in this.manipulatedManipulators){var e=this.manipulatedManipulators[r];if(e===t){var n=e.links[r];if(!i){var a=n.node?n.node:n.path;i=(a instanceof PathElement?a._getOccurrences():a._occurrences)[0]._getViewpoint()}this.manipulatedManipulatorsAssociatedViewpoints[r]=i}}}});function c(t,i,e){t&&(t.computeCPUIntersection=i.pick.bind(i,e,"meshCPU",!0))}return UWA.namespace("THREEDS/ManipulatorManager",u)})),define("Manipulators/ManipulatorManager",["DS/Manipulators/ManipulatorManager","DS/DSMigration/DSMigration"],(function(t,i){return i.deprecateModule("Manipulators/ManipulatorManager"),t})),define("DS/Manipulators/LineTranslationManipulator",["DS/Visualization/ThreeJS_DS","DS/CoreEvents/Events","DS/Manipulators/Manipulator"],(function(t,i,e){"use strict";var n=e.extend({init:function(i){var e;return e=this.DEPRECATED_CONSTRUCTOR(arguments)?{axis:arguments[1]}:i||{},this._parent(),this.axis=e.axis,this.axis.normalize(),this.projector=new t.Projector,this.robotOrthoState=!1,this},BeginManipulate:function(i,e,n,a){a=a||e.viewer.currentViewpoint,this._parent(i,e,n),this.initial3dIntersectionPoint=n.position,this.initial3dIntersectionPointTranslated=(new t.Vector3).copy(this.initial3dIntersectionPoint),this.initial3dIntersectionPointTranslated.add(this.axis),this.initial3dPosition=null,this.translationSensitivity=1,this.robotOrthoState&&(this.initial3dPosition=(new t.Vector3).copy(this.getCurrentPositionForRobotCameraOrtho(e)),this.translationSensitivity=Math.abs(e.viewer.currentViewpoint.getTargetDistance()/e.viewer.currentViewpoint.robotCameraOrtho.visualizedHeight));var r={viewer:e.viewer,eventChannel:"BeginManipulate",event:e,paths:this.manipulatedPaths,intersection:n,viewpoint:a,manipulator:this};this.publish("BeginManipulate",r)},Manipulate:function(i,e,n,a){a=a||e.viewer.currentViewpoint,this._parent(i,e,n);var r=(new t.Vector2).copy(e.from[0].getCurrentPosition(e.viewer.canvas));this.last3DIntersectionPoint=null;var o=null;if(this.robotOrthoState)this.last3DIntersectionPoint=(new t.Vector3).copy(this.getCurrentPositionForRobotCameraOrtho(e)),o=(new t.Vector3).subVectors(this.last3DIntersectionPoint,this.initial3dPosition).multiply(this.axis).multiplyScalar(-1*this.translationSensitivity);else{var s=a.create3DRayFrom2DPoint(r).computeShortestPointToLine(this.initial3dIntersectionPoint,this.initial3dIntersectionPointTranslated);o=(new t.Vector3).subVectors(s,this.initial3dIntersectionPoint)}var l={viewer:e.viewer,eventChannel:"Manipulate",event:e,paths:this.manipulatedPaths,translationVector:o,intersection:n,viewpoint:a,manipulator:this};this.publish("Manipulate",l)},EndManipulate:function(i,e,n,a){a=a||e.viewer.currentViewpoint;var r=(new t.Vector2).copy(e.from[0].getCurrentPosition(e.viewer.canvas)),o=a.create3DRayFrom2DPoint(r).computeShortestPointToLine(this.initial3dIntersectionPoint,this.initial3dIntersectionPointTranslated),s=(new t.Vector3).subVectors(o,this.initial3dIntersectionPoint),l={viewer:e.viewer,eventChannel:"EndManipulate",event:e,paths:this.manipulatedPaths,translationVector:s,intersection:n,viewpoint:a,manipulator:this};this.publish("EndManipulate",l),this._parent(i,e,n)},BeginPreactivate:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"BeginPreactivate",event:i,preactivated:this.preactivated,intersection:e,viewpoint:n,manipulator:this};this.publish("BeginPreactivate",a)},Preactivate:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"Preactivate",event:i,preactivated:this.preactivated,intersection:e,viewpoint:n,manipulator:this};this.publish("Preactivate",a)},EndPreactivate:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"EndPreactivate",event:i,preactivated:this.preactivated,intersection:e,viewpoint:n,manipulator:this};this.publish("EndPreactivate",a)},PrimaryPointerClick:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"PrimaryPointerClick",event:i,intersection:e,viewpoint:n,manipulator:this};this.publish("PrimaryPointerClick",a)},setRobotOrthoState:function(t){this.robotOrthoState=t},getCurrentPositionForRobotCameraOrtho:function(i){var e=(new t.Vector2).copy(i.from[0].getCurrentPosition(i.viewer.canvas)),n=i.viewer.devicePixelRatio,a=2*(1-n*e.y/i.viewer.canvas.height)-1,r=2*n*e.x/i.viewer.canvas.width-1,o=i.viewer.currentViewpoint.robotCameraOrtho,s=new t.Vector3(r,a,o.getProjectedDepthCenter());return(new t.Projector).unprojectVector(s,o),s},PrimaryPointerDoubleClick:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"PrimaryPointerDoubleClick",event:i,intersection:e,viewpoint:n,manipulator:this};this.publish("PrimaryPointerDoubleClick",a)}});return UWA.namespace("THREEDS/Nodes/LineTranslationManipulator",n)})),define("Manipulators/LineTranslationManipulator",["DS/Manipulators/LineTranslationManipulator","DS/DSMigration/DSMigration"],(function(t,i){return i.deprecateModule("Manipulators/LineTranslationManipulator"),t})),define("DS/Manipulators/PointHandle",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","WebappsUtils/WebappsUtils","DS/Visualization/GeometryHelper","DS/SceneGraphNodes/BillBoardNode3D","DS/Manipulators/HandlePointManipulator","DS/Mesh/MeshUtils","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","DS/SceneGraphNodes/FixedSizeNode3D","DS/Visualization/SceneGraphFactory"],(function(t,i,e,n,a,r,o,s,l,u,c){"use strict";var p=i.extend({init:function(i){this._parent(i.name),this.sceneGraph=i.sceneGraph,this.size=i.size?i.size:20,this.fillColor=i.fillColor?i.fillColor:new t.Color("#FFFFFF"),this.opacity=i.opacity?i.opacity:1,this._modelEvent=new l,this.isPreactivated=!1,this.isManipulated=!1,this.handleCursor=!0;var o=void 0===i.noz||i.noz,s=this,p={width:1,height:1,fill:!0,fillColor:null,noEdge:!0,layerNb:o?1:0},h=(new n).createRectangle(p),v=e.getWebappsAssetUrl("Robot",""),d=new t.ImageUtils._loadTextureWithProxy(v+"models/textures/Point.png",void 0,null,null,t.ImageUtils.crossOriginPolicy);d.flipY=!1,d.minFilter=t.LinearMipMapLinearFilter,this.pointMat=new t.MeshBasicMaterial({map:d,side:t.DoubleSide,transparent:!0,alphaTest:.05,enableClipPlanes:!1,opacity:this.opacity}),this.pointMat.force=!0;var w=c.createMeshNode(h,this.pointMat);w.setShadow(!1),w.setFrustumCulled(!1),w.name="diskNode",w.excludeFromCSO(!0),w.excludeFromHighlight(!0,!0),w.setMatrix((new t.Matrix4).setPosition(new t.Vector3(-.5,-.5,0))),this.diskNode=w;var P={position:this.position,name:"billBoard1",type:"Spherical"};this.billBoardNode=new a(P),this.billBoardNode.add(w),this.fixedSizeNode=new u({name:"fixedSizeNode3D",ratio:this.size}),this.fixedSizeNode.add(this.billBoardNode),this.add(this.fixedSizeNode),this.sceneGraph.add(this),this.manipulator=new r,this.manipulator.setExclusive(!0),this.manipToken=this.manipulator.linkToNode(this),this.manipulator.onBeginManipulate((function(i){s._modelEvent.publish({event:"BeginManipulate",data:i,context:this}),s.pointMat.setColor(new t.Color("#1B6E9C")),s.handleCursor&&i.viewer.setCursor("-webkit-grabbing"),s.isManipulated=!0,s.fixedSizeNode.setRatio(1.2*s.size),i.viewer.render()})),this.manipulator.onManipulate((function(t){s._modelEvent.publish({event:"Manipulate",data:t,context:this}),s.handleCursor&&t.viewer.setCursor("-webkit-grabbing")})),this.manipulator.onEndManipulate((function(i){s._modelEvent.publish({event:"EndManipulate",data:i,context:this}),s.isPreactivated?(s.handleCursor&&i.viewer.setCursor("pointer"),s.pointMat.setColor(new t.Color("#A1D9ED"))):(s.handleCursor&&i.viewer.setCursor("auto"),s.pointMat.setColor(s.fillColor),s.fixedSizeNode.setRatio(s.size)),s.isManipulated=!1,i.viewer.render()})),this.manipulator.onBeginPreactivate((function(i){s._modelEvent.publish({event:"BeginPreactivate",data:i,context:this}),s.handleCursor&&i.viewer.setCursor("pointer"),s.isPreactivated=!0,s.isManipulated||s.pointMat.setColor(new t.Color("#A1D9ED")),s.fixedSizeNode.setRatio(1.2*s.size),i.viewer.render()})),this.manipulator.onPreactivate((function(t){s._modelEvent.publish({event:"Preactivate",data:t,context:this})})),this.manipulator.onEndPreactivate((function(t){s._modelEvent.publish({event:"EndPreactivate",data:t,context:this}),s.handleCursor&&t.viewer.setCursor("auto"),s.isPreactivated=!1,s.isManipulated||(s.pointMat.setColor(s.fillColor),s.fixedSizeNode.setRatio(s.size)),t.viewer.render()}))},setCursor:function(t){this.handleCursor=t,this.manipulator.noCursorChange=!t},setSize:function(t){this.size=t,this.fixedSizeNode.setRatio(this.size)},setFillColor:function(t){this.fillColor=t,this.pointMat.setColor(this.fillColor)},setOpacity:function(t){this.opacity=t,this.pointMat.setOpacity(this.opacity)},subscribe:function(t,i){return this._modelEvent.subscribe({event:t},i)},unsubscribe:function(t){this._modelEvent.unsubscribe(t)},dispose:function(){this.manipulator&&(this.manipulator.unlink(this.manipToken),this.manipulator=null),this.sceneGraph.remove(this)}});return UWA.namespace("THREEDS/Nodes/PointHandle",p)})),define("Manipulators/PointHandle",["DS/Manipulators/PointHandle","DS/DSMigration/DSMigration"],(function(t,i){return i.deprecateModule("Manipulators/PointHandle"),t})),define("DS/Manipulators/RotationManipulator",["DS/Visualization/ThreeJS_DS","DS/CoreEvents/Events","DS/Manipulators/Manipulator"],(function(t,i,e){"use strict";var n=e.extend({init:function(i){var e;return e=this.DEPRECATED_CONSTRUCTOR(arguments)?{axis:arguments[1]}:i||{},this._parent(),this.axis=e.axis,this.axis.normalize(),this.centerPosition=new t.Vector3,this.fixedCenter=new t.Vector3,this.fromCenterToInitial=new t.Vector3,this.plane=new t.Plane,this.projector=new t.Projector,this.robotOrthoState=!1,this},BeginManipulate:function(i,e,n,a){a=a||e.viewer.currentViewpoint,this._parent(i,e,n),this.initial3dIntersectionPoint=n.position,this.robotOrthoState?(this.initial3dIntersectionPoint=null,this.fixedCenter=(new t.Vector3).copy(this.centerPosition),this.camera=e.viewer.currentViewpoint.robotCameraOrtho.clone(),this.initial3dIntersectionPoint=(new t.Vector3).copy(this.getCurrentPositionForRobotCameraOrtho(e)),this.fromCenterToInitial.subVectors(this.initial3dIntersectionPoint,this.fixedCenter),this.fromCenterToInitial.projectOnPlane(this.axis),this.fromCenterToInitial.normalize()):(this.plane.setFromNormalAndCoplanarPoint(this.axis,this.initial3dIntersectionPoint),this.fromCenterToInitial.subVectors(this.initial3dIntersectionPoint,this.centerPosition),this.fromCenterToInitial.projectOnPlane(this.axis),this.fromCenterToInitial.normalize());var r={viewer:e.viewer,eventChannel:"BeginManipulate",event:e,paths:this.manipulatedPaths,intersection:n,viewpoint:a,manipulator:this};this.publish("BeginManipulate",r)},Manipulate:function(i,e,n,a){a=a||e.viewer.currentViewpoint,this._parent(i,e,n);var r=(new t.Vector2).copy(e.from[0].getCurrentPosition(e.viewer.canvas)),o=null,s=new t.Vector3;if(this.robotOrthoState){this.last3DIntersectionPoint=(new t.Vector3).copy(this.getCurrentPositionForRobotCameraOrtho(e)),(l=(new t.Vector3).subVectors(this.last3DIntersectionPoint,this.fixedCenter)).projectOnPlane(this.axis),l.normalize(),o=-1*this.fromCenterToInitial.angleTo(l),s.crossVectors(this.fromCenterToInitial,l),s.normalize()}else{var l,u=a.create3DRayFrom2DPoint(r).intersectPlane(this.plane);if(u)(l=(new t.Vector3).subVectors(u,this.centerPosition)).projectOnPlane(this.axis),l.normalize(),o=this.fromCenterToInitial.angleTo(l),s.crossVectors(this.fromCenterToInitial,l),s.normalize();else s.set(1,0,0),o=0}var c=(new t.Matrix4).makeRotationAxis(s,o),p={viewer:e.viewer,eventChannel:"Manipulate",event:e,paths:this.manipulatedPaths,rotationMatrix:c,angle:o||0,axis:s,center:this.centerPosition,intersection:n,viewpoint:a,manipulator:this};this.publish("Manipulate",p)},EndManipulate:function(i,e,n,a){a=a||e.viewer.currentViewpoint;var r=(new t.Vector2).copy(e.from[0].getCurrentPosition(e.viewer.canvas)),o=n.viewpoint.create3DRayFrom2DPoint(r).intersectPlane(this.plane),s=new t.Vector3,l=0;if(o){var u=(new t.Vector3).subVectors(o,this.centerPosition);u.projectOnPlane(this.axis),u.normalize(),s.crossVectors(this.fromCenterToInitial,u),s.normalize(),l=this.fromCenterToInitial.angleTo(u)}else s.set(1,0,0);var c=(new t.Matrix4).makeRotationAxis(s,l),p={viewer:e.viewer,eventChannel:"EndManipulate",event:e,paths:this.manipulatedPaths,rotationMatrix:c,angle:l,axis:s,center:this.centerPosition,intersection:n,viewpoint:a,manipulator:this};this.publish("EndManipulate",p),this._parent(i,e,n)},setCenter:function(t){this.centerPosition=t},setAxis:function(t){this.axis=t},setRobotOrthoState:function(t){this.robotOrthoState=t},getCurrentPositionForRobotCameraOrtho:function(i){var e=(new t.Vector2).copy(i.from[0].getCurrentPosition(i.viewer.canvas)),n=i.viewer.devicePixelRatio,a=2*(1-n*e.y/i.viewer.canvas.height)-1,r=2*n*e.x/i.viewer.canvas.width-1,o=new t.Vector3(r,a,this.camera.getProjectedDepthCenter());return this.projector.unprojectVector(o,this.camera),o},BeginPreactivate:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"BeginPreactivate",event:i,preactivated:this.preactivated,intersection:e,viewpoint:n,manipulator:this};this.publish("BeginPreactivate",a)},Preactivate:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"Preactivate",event:i,preactivated:this.preactivated,intersection:e,viewpoint:n,manipulator:this};this.publish("Preactivate",a)},EndPreactivate:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"EndPreactivate",event:i,preactivated:this.preactivated,intersection:e,viewpoint:n,manipulator:this};this.publish("EndPreactivate",a)},PrimaryPointerClick:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"PrimaryPointerClick",event:i,intersection:e,viewpoint:n,manipulator:this};this.publish("PrimaryPointerClick",a)},PrimaryPointerDoubleClick:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"PrimaryPointerDoubleClick",event:i,intersection:e,viewpoint:n,manipulator:this};this.publish("PrimaryPointerDoubleClick",a)}});return UWA.namespace("THREEDS/Nodes/RotationManipulator",n)})),define("Manipulators/RotationManipulator",["DS/Manipulators/RotationManipulator","DS/DSMigration/DSMigration"],(function(t,i){return i.deprecateModule("Manipulators/RotationManipulator"),t})),define("DS/Manipulators/ScreenPlaneManipulator",["DS/Visualization/ThreeJS_DS","DS/CoreEvents/Events","DS/Manipulators/Manipulator","DS/Visualization/PathElement"],(function(t,i,e,n){"use strict";var a=e.extend({init:function(i){var e;return e=this.DEPRECATED_CONSTRUCTOR(arguments)?{cameraName:arguments[1]}:i||{},this._parent(),this.projector=new t.Projector,this.setCameraName(e.cameraName),this},BeginManipulate:function(t,i,e,n){n=n||i.viewer.currentViewpoint,this._parent(t,i,e),this.initial3dIntersectionPoint=e.position;var a={viewer:i.viewer,eventChannel:"BeginManipulate",event:i,position:this.initial3dIntersectionPoint,paths:this.manipulatedPaths,intersection:e,viewpoint:n,manipulator:this};this.publish("BeginManipulate",a)},Manipulate:function(i,e,n,a){a=a||e.viewer.currentViewpoint,this._parent(i,e,n);var r=(new t.Vector2).copy(e.from[0].getCurrentPosition(e.viewer.canvas)),o=a.create3DRayFrom2DPoint(r,a[this.cameraName]),s=a[this.cameraName],l=(new t.Vector3).copy(s.getLookAt()),u=(new t.Plane).setFromNormalAndCoplanarPoint(l.multiplyScalar(-1),this.initial3dIntersectionPoint),c=o.intersectPlane(u),p=(new t.Vector3).subVectors(c,this.initial3dIntersectionPoint),h={viewer:e.viewer,eventChannel:"Manipulate",event:e,paths:this.manipulatedPaths,translationVector:p,intersection:n,viewpoint:a,manipulator:this};this.publish("Manipulate",h)},EndManipulate:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"EndManipulate",event:i,paths:this.manipulatedPaths,intersection:e,viewpoint:n,manipulator:this};this.publish("EndManipulate",a),this._parent(t,i,e)},BeginPreactivate:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"BeginPreactivate",event:i,preactivated:this.preactivated,intersection:e,viewpoint:n,manipulator:this};this.publish("BeginPreactivate",a)},Preactivate:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"Preactivate",event:i,preactivated:this.preactivated,intersection:e,viewpoint:n,manipulator:this};this.publish("Preactivate",a)},EndPreactivate:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"EndPreactivate",event:i,preactivated:this.preactivated,intersection:e,viewpoint:n,manipulator:this};this.publish("EndPreactivate",a)},PrimaryPointerClick:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"PrimaryPointerClick",event:i,intersection:e,viewpoint:n,manipulator:this};this.publish("PrimaryPointerClick",a)},PrimaryPointerDoubleClick:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"PrimaryPointerDoubleClick",event:i,intersection:e,viewpoint:n,manipulator:this};this.publish("PrimaryPointerDoubleClick",a)},setCameraName:function(t){this.cameraName=t||"camera"},reset:function(t){this._parent(t),this.initial3dIntersectionPoint=t.position}});return UWA.namespace("THREEDS/Nodes/ScreenPlaneManipulator",a)})),define("Manipulators/ScreenPlaneManipulator",["DS/Manipulators/ScreenPlaneManipulator","DS/DSMigration/DSMigration"],(function(t,i){return i.deprecateModule("Manipulators/ScreenPlaneManipulator"),t})),define("DS/Manipulators/ScalingManipulator",["DS/Visualization/ThreeJS_DS","DS/CoreEvents/Events","DS/Manipulators/Manipulator"],(function(t,i,e){"use strict";var n=e.extend({init:function(i){var e;return e=this.DEPRECATED_CONSTRUCTOR(arguments)?{axis:arguments[1]}:i||{},this._parent(),this.axis=e.axis,this.axis.normalize(),this.centerPosition=new t.Vector3,this.offset=0,this.projector=new t.Projector,this.scalingFactor=1,this},BeginManipulate:function(i,e,n,a){a=a||e.viewer.currentViewpoint,this._parent(i,e,n),this.initial3dIntersectionPoint=(new t.Vector3).copy(n.position),this.lastProjectionPoint3D=this.initial3dIntersectionPoint,this.initial3dIntersectionPointTranslated=(new t.Vector3).copy(this.initial3dIntersectionPoint),this.initial3dIntersectionPointTranslated.add(this.axis),this.offset=(new t.Vector3).subVectors(this.initial3dIntersectionPoint,this.centerPosition).length();var r={viewer:e.viewer,eventChannel:"BeginManipulate",event:e,paths:this.manipulatedPaths,intersection:n,viewpoint:a,manipulator:this};this.publish("BeginManipulate",r)},Manipulate:function(i,e,n,a){a=a||e.viewer.currentViewpoint,this._parent(i,e,n);var r=(new t.Vector2).copy(e.from[0].getCurrentPosition(e.viewer.canvas)),o=a.create3DRayFrom2DPoint(r);this.lastProjectionPoint3D=o.computeShortestPointToLine(this.initial3dIntersectionPoint,this.initial3dIntersectionPointTranslated);var s=(new t.Vector3).subVectors(this.lastProjectionPoint3D,this.initial3dIntersectionPoint);s.projectOnVector(this.axis);var l=s.dot(this.axis),u=new t.Matrix4;this.offset>0&&(this.scalingFactor=Math.max((this.offset+l)/this.offset,.1),u.setPosition((new t.Vector3).copy(this.centerPosition)).scale(new t.Vector3(this.scalingFactor,this.scalingFactor,this.scalingFactor)).multiply((new t.Matrix4).setPosition((new t.Vector3).copy(this.centerPosition).multiplyScalar(-1))));var c={viewer:e.viewer,eventChannel:"Manipulate",event:e,paths:this.manipulatedPaths,scalingMatrix:u,scalingFactor:this.scalingFactor,translationVector:s,center:this.centerPosition,intersection:n,viewpoint:a,manipulator:this};this.publish("Manipulate",c)},EndManipulate:function(t,i,e,n){n=n||i.viewer.currentViewpoint,this.scalingFactor=1;var a={viewer:i.viewer,eventChannel:"EndManipulate",event:i,paths:this.manipulatedPaths,intersection:e,viewpoint:n,manipulator:this};this.publish("EndManipulate",a),this._parent(t,i,e)},BeginPreactivate:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"BeginPreactivate",event:i,preactivated:this.preactivated,intersection:e,viewpoint:n,manipulator:this};this.publish("BeginPreactivate",a)},Preactivate:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"Preactivate",event:i,preactivated:this.preactivated,intersection:e,viewpoint:n,manipulator:this};this.publish("Preactivate",a)},EndPreactivate:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"EndPreactivate",event:i,preactivated:this.preactivated,intersection:e,viewpoint:n,manipulator:this};this.publish("EndPreactivate",a)},PrimaryPointerClick:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"PrimaryPointerClick",event:i,intersection:e,viewpoint:n,manipulator:this};this.publish("PrimaryPointerClick",a)},PrimaryPointerDoubleClick:function(t,i,e,n){n=n||i.viewer.currentViewpoint;var a={viewer:i.viewer,eventChannel:"PrimaryPointerDoubleClick",event:i,intersection:e,viewpoint:n,manipulator:this};this.publish("PrimaryPointerDoubleClick",a)},setCenter:function(t){this.centerPosition=t},setAxis:function(t){this.axis=t&&t.clone(),this.axis&&this.axis.normalize()}});return UWA.namespace("THREEDS/Nodes/ScalingManipulator",n)})),define("Manipulators/ScalingManipulator",["DS/Manipulators/ScalingManipulator","DS/DSMigration/DSMigration"],(function(t,i){return i.deprecateModule("Manipulators/ScalingManipulator"),t}));