define("DS/SearchWidget/SearchWidgetConstant",[],(function(){return{TYPE_FULL:"all",TYPE_PERSON:"user",TYPE_PROJECT:"collabspace",TYPE_ORGANIZATION:"org",EXTTYPE_USERGRP:"userGrp"}})),define("DS/SearchWidget/models/SW_ItemModel",["UWA/Controls/Abstract"],(function(e){"use strict";return e.extend({init:function(e){for(var t in this.itemTitle="",this.itemId="",this.itemIcon="",this.isSW_ItemModel=!0,e)this[t]=e[t]},getTitle:function(){return this.itemTitle},getId:function(){return this.itemId},getIcon:function(){return this.itemIcon},setTitle:function(e){this.itemTitle=e},setId:function(e){this.itemId=e},setIcon:function(e){this.itemIcon=e}})})),define("DS/SearchWidget/componentUI/SearchWidgetUI",["UWA/Core","UWA/Controls/Abstract","UWA/Json","DS/WidgetServices/WidgetServices","DS/UIKIT/Spinner","DS/UIKIT/Input/Text","DS/UIKIT/Input/Button","DS/UIKIT/Scroller","i18n!DS/SearchWidget/assets/nls/langSW"],(function(e,t,n,r,i,o,s,a,l){"use strict";var c="js-selected";return t.extend({_timerLastKey:null,defaultOptions:{className:"SW_InputWithFilter",id:"SW_SearchPeople",Label:"",hint:"",MaxNumber:"6",MaxSize:"",position:"auto",acceptEmpty:!1,setBorderColor:!1,wintop:!1,CSE:!1,IsMoveSearch:!1,autocomplete:"off",currentUser:"",FED:!1},init:function(e){this._parent(e),this._currentNotif=null,this.parentBody=r.getWidgetBody(),this._currentPosition="auto","auto"===this.options.position?this._currentPosition="top":this._currentPosition=this.options.position,this.mainScrollerSearch=null,this.currentChoice=null,this.initUI(),this.mouseIsInBlock=!1},_timeEnd:function(){this._timerLastKey=null,this.dispatchEvent("onUserChoice")},_elementIsButton:function(e){return e&&e.hasClassName("SW_ButtonMoreContainer")},initUI:function(){var e=this;r.get3DSwymUrlAsync({onComplete:function(t){e.options.SwymUrl=t}});var t=e.parentBody.getParent("body");t=t||e.parentBody,e.container=UWA.createElement("div",{class:"SW_upperContainer "+e.options.className,html:""}),e.labelArea=UWA.createElement("label",{id:"label_"+e.options.id,html:e.options.Label}),""==e.options.Label&&e.labelArea.hide(),e.searchDiv=UWA.createElement("div",{class:"SW_SearchInputClass",id:e.options.id,"data-rec-id":"RecSearchsearchDiv"}),e.inputDiv=UWA.createElement("div",{class:"SW_inputDivClass input-group","data-rec-id":"RecSearchinputDiv"}),e.saveIDUser=UWA.createElement("span",{class:"SW_SaveIDUser",text:""}),""==e.options.hint&&(e.options.hint=l.get("hintSearch")),"Empty"==e.options.hint&&(e.options.hint="");var n=null;e.searchInput=new o({value:"",name:"SW_SearchInput",className:"SW_SearchInput",attributes:{placeholder:e.options.hint+" ",autocomplete:"off","data-rec-id":"RecSearchinputText"},events:{onKeyDown:function(t){t.stopPropagation(),e.currentOwner=null;if(13==t.which){var n=e.filterAreaContent.getElement("."+c);if(n)e._elementIsButton(n)?(e.selectNextOrPreviousResult("previous"),n.click(),e.selectNextOrPreviousResult("next")):e.__setInput(n);else e.dispatchEvent("onUserChoice")}else 40===t.which?e.selectNextOrPreviousResult("next"):38===t.which?e.selectNextOrPreviousResult("previous"):[39,37,16,9,20].indexOf(t.which)<0&&!t.ctrlKey&&!t.altKey&&(e.currentChoice=null,setTimeout((function(){var t=e.searchInput.getValue();!e.options.setBorderColor||e.options.acceptEmpty&&""===t?e.container.removeClassName("SW_unvalid"):e.container.addClassName("SW_unvalid")})),32!==t.which&&e._removeAllSelections(),null!=e._timerLastKey&&clearTimeout(e._timerLastKey),e._timerLastKey=setTimeout((function(){e._timeEnd()}),200),setTimeout((function(){e.dispatchEvent("onUnvalid")}),100))},onClick:function(){e.dispatchEvent("onUserChoice")}}}),e.searchInput.elements&&e.searchInput.elements.input&&(e.searchInput.elements.input.addEvent("mouseup",(function(){setTimeout((function(){""===e.getCurrentValue()&&(e.currentOwner=null,e.dispatchEvent("onUnvalid"))}),100)})),e.searchInput.elements.input.addEvent("drop",(function(e){e.preventDefault()})),e.searchInput.elements.input.addEvent("paste",(function(t){e.getCurrentValue()!==t.clipboardData.getData("text/plain")&&setTimeout((function(){e.dispatchEvent("onUnvalid")}),0)}))),(n=new s({attributes:{title:l.get("AR_SearchButton")},value:"",className:"default AR_SearchButton",icon:"search",name:"SW_SearchInputButton"})).getContent().setAttribute("data-rec-id","dataRecSearchInputButton"),n.addEvents({onClick:function(){e.searchInput.setFocus(!0),e.closeDialog(),e.currentOwner=null,e.dispatchEvent("onUserChoiceNoCharLimit")}});var u=this.options.className?" SWD_"+this.options.className:"";if(e.filterContainer=UWA.createElement("div",{class:"searchComponent_filter dropdown-menu dropdown dropup"+u,"data-rec-id":"datarecfilterContainer",html:""}),this._handleStopPropagation=function(e){e.stopPropagation()},this._handleCloseDialog=function(t){e.mouseIsInBlock||e.closeDialog()},e.searchInput.elements.input.addEvents({mousedown:e._handleStopPropagation,touchstart:e._handleStopPropagation}),document.addEventListener("mousedown",e._handleCloseDialog,!1),document.addEventListener("touchstart",e._handleCloseDialog,!1),e.filterContainer.addEvents({mousedown:e._handleStopPropagation,touchstart:e._handleStopPropagation}),e.warningArea=UWA.createElement("div",{class:"SW_warningArea"}).inject(e.filterContainer).hide(),e.warningArea.addEventListener("click",e.warningArea.hide),e.filterAreaMaster=UWA.createElement("div",{name:"masterFilterArea",class:"masterFilterArea","data-rec-id":"datarecfilterAreaMaster",html:""}).inject(e.filterContainer),e.tempFilterArea=UWA.createElement("div",{class:"tempFilterAreaContent  dropdown-menu dropdown dropup"}).inject(t),e.filterArea=UWA.createElement("div",{name:"filterArea",class:"filterArea","data-rec-id":"datarecfilterArea",html:""}).inject(e.filterAreaMaster),e.filterAreaContent=UWA.createElement("div",{class:"filterAreaContent atLeastOneIcon","data-rec-id":"datarecfilterAreaContent"}),e.filterAreaContent.inject(e.filterArea),e.mainScrollerSearch=new a({element:e.filterArea}).inject(e.filterAreaMaster),e.mainScrollerSearch.elements.content.setAttribute("data-rec-id","dataRecmainScrollerSearch"),e.loadingGif=new i({className:"SW_filterSpinner",visible:!0}),e.loadingGif.inject(e.filterContainer),e.filterContainer.hide(),e.searchInput.inject(e.inputDiv),e.inputDiv.setStyle("width","100%"),null!=n){var p=UWA.createElement("span",{class:"input-group-btn"});n.inject(p),p.inject(e.inputDiv)}e.filterContainer.inject(t),e.saveIDUser.inject(e.searchDiv),e.labelArea.inject(e.searchDiv),e.inputDiv.inject(e.searchDiv),e.searchDiv.inject(e.container),this._actionOnMoveOrResize=function(){e._dialogIsOpened()&&e.openDialog()},r.addWidgetResizeEvent(e._actionOnMoveOrResize)},actionOnMove:function(){this.closeDialog()},selectNextOrPreviousResult:function(e){var t=this.filterAreaContent.getElement("."+c),n=this._elementIsButton(t),r=null;if(t){if(n&&"next"!==e)(o=t.previousSibling.getElements(".SW_LiData:not(.SW_hiddenLine)"))&&o.length>0&&(r=o[o.length-1]);if(r||(r=n?null:"next"===e?t.nextSibling:t.previousSibling),!r||"none"===r.getStyle("display")){var i=t.getParent(".SW_DivPeople");if(n||"next"!==e||(r=(r=i.getElement(".SW_ButtonMoreContainer"))&&"none"!==r.getStyle("display")?r:null),!r&&i){var o,s="next"===e?i.nextSibling:i.previousSibling;if(s)if(r=null,"next"===e)r=s.getElement(".SW_LiData");else if(null===(r=(r=s.getElement(".SW_ButtonMoreContainer"))&&"none"!==r.getStyle("display")?r:null))(o=s.getElements(".SW_LiData:not(.SW_hiddenLine)"))&&o.length>0&&(r=o[o.length-1])}}}else r=this.filterAreaContent.getElement(".SW_LiData");if(r&&"none"!==r.getStyle("display")){r.addClassName(c),t&&t.removeClassName(c);var a=this._getElementPositionInScroller(r);null!=a&&this.mainScrollerSearch.scrollTo(0,a-25)}},_removeAllSelections:function(){this.filterAreaContent.getElements("."+c).forEach((function(e){e.removeClassName(c)}))},_escapeRegExp:function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},getAvatarDetails:function(e){var t={},n=[[7,139,250],[249,87,83],[111,188,75],[158,132,106],[170,75,178],[26,153,123],[245,100,163],[255,138,46]],r=e;r.contains("<b>")&&(r=r.replace("<b>","")).contains("</b>")&&(r=r.replace("</b>",""));var i=r.match(/\b\w/g),o=i[0].toUpperCase(),s=i[i.length-1].toUpperCase();r.contains("/")&&(s=" "!=r.charAt(r.indexOf("/")+1)?r.charAt(r.indexOf("/")+1).toUpperCase():r.charAt(r.indexOf("/")+2).toUpperCase());var a=o+s,l=Math.ceil((o.charCodeAt(0)+s.charCodeAt(0))%n.length),c="rgb("+n[l][0]+","+n[l][1]+","+n[l][2]+")";return t.name=e,t.avatarStr=a,t.avatarColor=c,t},setData:function(e){var t=this,n=this.getCurrentChoiceId();e.forEach((function(e){var i=e.getClass(),o=UWA.createElement("div",{class:"SW_DivPeople "+i,"data-rec-id":"datarecdivPeople",html:{tag:"div",text:e.getTitle(),class:"SW_TitleSection"}}).inject(t.filterAreaContent);""!=i&&(i+=i+"List");var s=UWA.createElement("ul",{class:"filterSSArea dropdown-menu-wrap "+i,"data-rec-id":"datarecfilterSSArea",html:""}).inject(o),a=!1;e.getListItems().forEach((function(e,c){if(c==t.options.MaxNumber){var u=UWA.createElement("div",{class:"SW_ButtonMoreContainer fonticon fonticon-down-open",events:{click:function(e){t.displayMore(e,i)}}}).inject(o);new UWA.createElement("a",{class:"SW_MoreButton","data-rec-id":"datarecMoreButton",html:l.get("MoreButton")}).inject(u),a=!0}var p=e.getId(),h=e.getTitle();h||(h=p);var d=t.getListOfSearchingWord();1==t.options.CSE&&(d.listWord=[],t.tempFilterArea.empty());for(var g=d.listWord,S=g.length,f=0;f<S;f++){var m=new RegExp("("+t._escapeRegExp(g[f])+")","ig");h&&(h=h.replace(m,"<b>$1</b>"))}if(""!=h){var v=[];if(n===p&&v.push({tag:"span",class:"SW_liSelected"}),null!=t.options)if(t.options.hasOwnProperty("topClassHeight"))if(t.options.topClassHeight.contains("SHP_PopupDial")){var w="";e.hasOwnProperty("itemIcon")&&e.itemIcon.hasOwnProperty("class")&&e.itemIcon.class.contains("fonticon-user")&&(w=p).contains("_PRJ")&&(w=w.slice(0,w.length-4));var y=t.getAvatarDetails(h),C=y.avatarColor,b=y.avatarStr;if(""!=w)if(w.contains("uuid:")){"";var _=r.getRealPath("SearchWidget/assets/User_Group_Search.png",widget,!1),O=UWA.createElement("div");UWA.createElement("img",{src:_,class:"search_suggest-img"}).inject(O);v.push(O)}else{if("",t.options.hasOwnProperty("SwymUrl")&&""!=t.options.SwymUrl){_=t.options.SwymUrl+"/api/user/getpicture/login/"+w+"/format/normal",O=UWA.createElement("div"),UWA.createElement("img",{src:_,class:"search_suggest-img"}).inject(O);v.push(O)}else{O=UWA.createElement("div");UWA.createElement("div",{class:"search-team-profile-picture search-team-profile-text",text:b}).inject(O).setStyle("background-color",C),v.push(O)}}else{O=UWA.createElement("div");UWA.createElement("div",{class:"search-team-profile-picture search-team-profile-text",text:b}).inject(O).setStyle("background-color",C),v.push(O)}}else v.push(e.getIcon());else v.push(e.getIcon());else v.push(e.getIcon());v.push({tag:"span","data-rec-id":"RecdataUser",class:"userName",html:h});var I=UWA.createElement("li",{class:"SW_LiData item ","data-rec-id":"RecSearchLiData"+c,IDOwner:p,title:e.getTitle(),html:v});1==a&&t._hideLine(I),I.inject(s),I.addEvent("click",(function(e){t._setInput(e)}))}}))})),this.selectNextOrPreviousResult("next")},_getElementPositionInScroller:function(e){var t=null;if(e){var n=e.getOffsets(),r=this.filterAreaContent.getOffsets();t=n.y-r.y}return t},getCurrentValue:function(){return this.searchInput.getValue()},getListOfSearchingWord:function(){var e=this.searchInput.getValue();e=(e=(e=e.trim()).replace(/\s+/g," ")).replace(/\*/g,".*"),window.__karma__||(e=(e=e.replace(/\)/g," ")).replace(/\(/g," "));var t=[];""!=e&&(t=e.split(" "));for(var n=t.length-1;n>=0;n--)t[n].search(/^<?([/b]|\/b)>?$/i)>=0&&t.splice(n,1);return{valueSearched:e,listWord:t}},_hideLine:function(e){e.addClassName("SW_hiddenLine")},_showLine:function(e){e.removeClassName("SW_hiddenLine")},displayMore:function(e,t){var n=this,r=e.target.getClosest(".SW_DivPeople").getElements("li"),i=0,o=!0;r.every((function(e,t){return"none"==e.getStyle("display")&&(n._showLine(e),i++),!(i>=n.options.MaxNumber)||(t!=r.length-1&&(o=!1),!1)})),1==o&&e.target.getClosest(".SW_ButtonMoreContainer").hide(),this.updateScroller()},getCurrentChoiceId:function(){return this.currentChoice},_setInput:function(e){var t=e.currentTarget.getClosest(".SW_LiData");this.__setInput(t)},__setInput:function(e){if(this._removeAllSelections(),e){var t=e.getElement(".userName").getText(),n=e.getAttribute("IDOwner");this.currentChoice=n,this.setDisplayValue(t),this.closeDialog(),this.options.setBorderColor&&this.container.removeClassName("SW_unvalid"),this.dispatchEvent("onValid")}},setDisplayValue:function(e){this.searchInput.setValue(e)},getDisplayValue:function(){this.searchInput.getValue()},_dialogIsOpened:function(){return!!this.filterContainer&&"none"!==this.filterContainer.getStyle("display")},openDialog:function(){var e=this.searchDiv.getSize().height,t=this._getMaxSize();"auto"===this.options.position&&(this._currentPosition="top",null!=t&&(t.top>t.bottom?this._currentPosition="top":this._currentPosition="bottom")),this.filterContainer.setStyle("left",t.left+"px"),"top"===this._currentPosition?(this.filterContainer.setStyle("bottom",t.bottom+e+"px"),this.filterContainer.setStyle("top","auto")):(this.filterContainer.setStyle("top",t.top+e+"px"),this.filterContainer.setStyle("bottom","auto")),this.filterContainer.show(),this.filterArea.hide(),this.warningArea.hide(),this._currentNotif?(this.filterContainer.addClassName("SW_FilterWithNotif"),this.warningArea.setText(this._currentNotif.message),this.warningArea.show()):(this.filterContainer.removeClassName("SW_FilterWithNotif"),this.filterArea.show()),this.mouseIsInBlock=!1,this.updateScroller()},destroy:function(){var e=this;e.searchInput.elements.input.removeEvents({mousedown:e._handleStopPropagation,touchstart:e._handleStopPropagation}),this.parentBody&&this.parentBody.removeEvents({mousedown:e._handleCloseDialog,touchstart:e._handleCloseDialog}),e.filterContainer.removeEvents({mousedown:e._handleStopPropagation,touchstart:e._handleStopPropagation}),this.tempFilterArea.destroy(),this.filterContainer.destroy(),r.removeWidgetResizeEvent(this._actionOnMoveOrResize),this._parent()},updateScroller:function(){var t=this,n=e.clone(t.filterAreaContent);t.tempFilterArea.empty(),t.tempFilterArea.appendChild(n);this.searchDiv.getSize().width;var r=t.tempFilterArea.getSize(),i=null,o=this._getMaxSize(),s=(r.width,this.parentBody.getSize()),a=o.right>0?s.width-o.right:s.width,l=t.filterAreaMaster.getDimensions(),c=l.outerWidth-l.innerWidth,u=a-o.left;o&&(t.filterContainer.setStyle("max-width",u+"px"),i="top"===this._currentPosition?o.top:o.bottom,r.width+c>u-c||r.width),(""!=t.options.MaxSize&&t.options.MaxSize<i||null==i)&&(i=t.options.MaxSize);var p=r.height;(r.height>i||r.width>u)&&(p=r.height>i?i:r.height),t.filterArea.setStyle("height",p)},showLoadingGif:function(){this.openDialog(!1),this.filterAreaMaster.hide(),this.loadingGif.show()},hideLoadingGif:function(){this.filterAreaMaster.show(),this.loadingGif.hide()},clearAllResult:function(){this.filterAreaContent.empty()},isResultEmpty:function(){return""===this.filterAreaContent.getHTML()},ClearDialog:function(){this.clearAllResult(),this.filterContainer.hide()},closeDialog:function(){this._removeAllSelections(),this.filterArea.hide(),this.filterContainer.hide()},resetError:function(){this._currentNotif=null},raiseError:function(e){"warning"===e.eventID?(this._currentNotif=e,this.openDialog()):this.dispatchEvent("onError",e)},clearTextArea:function(){this.ClearDialog(),this.clearInput()},clearInput:function(){this.searchInput.setValue(""),this.currentChoice=null,this.dispatchEvent("onUnvalid")},_getMaxSize:function(){var e=null,t=this.searchDiv.getBoundingClientRect(),n=this.parentBody.getBoundingClientRect();return(e={}).bottom=n.height+n.top-t.bottom,e.right=n.width+n.left-t.right,e.top=t.top,e.left=t.left,e}})})),define("DS/SearchWidget/models/SW_GroupModel",["UWA/Controls/Abstract"],(function(e){"use strict";return e.extend({init:function(e){for(var t in this.groupTitle="",this.groupClass="",this.groupItems=[],this.isSW_GroupModel=!0,e)this[t]=e[t]},getTitle:function(){return this.groupTitle},getClass:function(){return this.groupClass},getListItems:function(){return this.groupItems},setTitle:function(e){this.groupTitle=e},setClass:function(e){this.groupClass=e},setListItems:function(e){this.groupItems=e}})})),define("DS/SearchWidget/componentUI/SearchWidgetUIWebUX",["UWA/Core","UWA/Controls/Abstract","UWA/Json","DS/WidgetServices/WidgetServices","DS/WUXAutoComplete/AutoComplete","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","i18n!DS/SearchWidget/assets/nls/langSW"],(function(e,t,n,r,i,o,s,a){"use strict";return t.extend({_timerLastKey:null,defaultOptions:{className:"SW_InputWithFilter",id:"SW_SearchPeople",Label:"",hint:"",MaxNumber:"6",MaxSize:"",position:"auto",acceptEmpty:!1,setBorderColor:!1,wintop:!1,CSE:!1,IsMoveSearch:!1,autocomplete:"off",currentUser:"",FED:!1},init:function(e){this._parent(e),this._currentNotif=null,this.parentBody=r.getWidgetBody(),this.responseForPerson=[],this.mapToStoreResponse=new Map,this._currentPosition="auto","auto"===this.options.position?this._currentPosition="top":this._currentPosition=this.options.position,this.mainScrollerSearch=null,this.currentChoice=null,this.initUI(),this.mouseIsInBlock=!1},initUI:function(){var e=this;r.get3DSwymUrlAsync({onComplete:function(t){e.options.SwymUrl=t}});var t=e.parentBody.getParent("body");t=t||e.parentBody,e.container=UWA.createElement("div",{class:"SW_upperContainer "+e.options.className,html:""}),e.labelArea=UWA.createElement("label",{id:"label_"+e.options.id,html:e.options.Label}),""==e.options.Label&&e.labelArea.hide(),e.searchDiv=UWA.createElement("div",{class:"SW_SearchInputClass",id:e.options.id,"data-rec-id":"RecSearchsearchDiv"}),e.inputDiv=UWA.createElement("div",{class:"SW_inputDivClass input-group","data-rec-id":"RecSearchinputDiv"}),e.saveIDUser=UWA.createElement("span",{class:"SW_SaveIDUser",text:""}),""==e.options.hint&&(e.options.hint=a.get("hintSearch")),"Empty"==e.options.hint&&(e.options.hint=""),e.searchInput=new i({elementsTree:function(t){return t&&""!==t&&t!==this.value&&t!==e.mapToStoreResponse.get(e.searchInput.value)&&(setTimeout((function(){e.dispatchEvent("onUserChoice")}),200),setTimeout((function(){e.dispatchEvent("onUnvalid")}),100)),new Promise((function(t,n){e.dispatchEvent("onUserChoice");var r=e;setTimeout((async function(){var e=await r._getResponseForPerson(),n=await r.formatResponseData(e);t(n)}),1e3)}))},multiSearchMode:!1,minLengthBeforeSearch:3,allowFreeInputFlag:!1,customFilterMessage:a.get("WarningNotFound")}),e.searchInput.getContent().addClassName("SW_SearchInput"),e.searchInput.addEventListener("change",(function(t){var n=t.dsModel.value;e.setOrRemoveCSSErrorField(),n?(e.currentChoice=n,e.dispatchEvent("onValid")):(e.currentChoice=null,e.dispatchEvent("onUnvalid"))})),e.searchInput._editor.elements.inputField.addEventListener("input",(function(t){var n=e.searchInput.getValueToCommit();""===n&&(e.searchInput.value=void 0),e.setOrRemoveCSSErrorField(),n!==e.searchInput.value&&n!==e.mapToStoreResponse.get(e.searchInput.value)&&e.dispatchEvent("onUnvalid")})),e.searchInput._editor.addEventListener("change",(function(t){t.dsModel.value||(e.searchInput.value=void 0)})),e.searchInput._editor.elements.inputField.addEventListener("blur",(function(t){var n=e.searchInput.getValueToCommit();""===n&&(e.searchInput.value=void 0),e.mapToStoreResponse.has(e.searchInput.value)&&n===e.mapToStoreResponse.get(e.searchInput.value)&&e.dispatchEvent("onValid")}));this.options.className&&this.options.className;e.searchInput.inject(e.inputDiv),e.inputDiv.setStyle("width","100%"),e.saveIDUser.inject(e.searchDiv),e.labelArea.inject(e.searchDiv),e.inputDiv.inject(e.searchDiv),e.searchDiv.inject(e.container)},actionOnMove:function(){},_escapeRegExp:function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},getAvatarDetails:function(e){},setData:function(e){},_getElementPositionInScroller:function(e){},getCurrentValue:function(){return this.searchInput.getValueToCommit()},getListOfSearchingWord:function(){var e=this.searchInput.getValueToCommit(),t=[];""!=(e=(e=(e=e.trim()).replace(/\s+/g," ")).replace(/\*/g,".*"))&&(t=e.split(" "));for(var n=t.length-1;n>=0;n--)t[n].search(/^<?([/b]|\/b)>?$/i)>=0&&t.splice(n,1);return{valueSearched:e,listWord:t}},_hideLine:function(e){},_showLine:function(e){},displayMore:function(e,t){},getCurrentChoiceId:function(){return this.currentChoice},setDisplayValue:function(e){e&&(this.searchInput.value=e)},getDisplayValue:function(){this.searchInput.getValueToCommit()},_dialogIsOpened:function(){},openDialog:function(){},destroy:function(){delete this.searchInput,this._parent()},updateScroller:function(){},showLoadingGif:function(){},hideLoadingGif:function(){},clearAllResult:function(){},isResultEmpty:function(){},ClearDialog:function(){},closeDialog:function(){},resetError:function(){this._currentNotif=null},raiseError:function(e){"warning"===e.eventID?this._currentNotif=e:this.dispatchEvent("onError",e)},clearTextArea:function(){},clearInput:function(){},_getMaxSize:function(){},_setResponseForPerson:function(e){e&&(this.responseForPerson=e)},_getResponseForPerson:function(){return this.responseForPerson},formatResponseData:function(e){var t=this,n=new o({shouldBeSelected:function(e){return"group title"!==e.options.sectionName}});return n.prepareUpdate(),e.forEach((function(e){var r=t.createTreeDocNodeModel(e.groupTitle,void 0,void 0,"group title");n.addRoot(r),e.groupItems.forEach((function(n){var i=n.itemTitle.split("\n"),o=i[0]+" "+i[1],s=n.itemId,a=n.itemIcon.class,l=null;"People"===e.groupTitle?(l=t.createTreeDocNodeModel(o,s,a,"user"),t.mapToStoreResponse.set(s,o)):l=t.createTreeDocNodeModel(o,s,a),r.addChild(l)}))})),n.pushUpdate(),n.expandAll(),n},createTreeDocNodeModel:function(e,t,n,r){var i={};return e&&(i.label=e),t&&(i.value=t),n&&(i.icons=[n]),r&&(i.sectionName=r),new s(i)},getImageForWUXPerson:function(e,t){},setOrRemoveCSSErrorField:function(){var e=this;""===e.searchInput.getValueToCommit()&&void 0===e.searchInput.value?e.searchInput._editor.elements.inputField.addClassName("error-field"):e.searchInput._editor.elements.inputField.removeClassName("error-field")}})})),define("DS/SearchWidget/controllers/SW_Base_Controller",["UWA/Controls/Abstract","UWA/Json","DS/SearchWidget/SearchWidgetConstant","DS/WidgetServices/WidgetServices","DS/SearchWidget/models/SW_GroupModel","DS/SearchWidget/models/SW_ItemModel","DS/SearchWidget/componentUI/SearchWidgetUI","DS/SearchWidget/componentUI/SearchWidgetUIWebUX","i18n!DS/SearchWidget/assets/nls/langSW"],(function(e,t,n,r,i,o,s,a,l){"use strict";return e.extend({defaultOptions:{serverName:"",serverUri:"",showEmptyCategory:!0,ForbiddenChar:'"#$@%*,?\\<>[]|:',urlService:"",wintop:!1,webParams:null,dropdown:!1,CSE:!1,IsMoveSearch:!1,autocomplete:"off",currentUser:"",currentCollabSpace:"",currentOrg:"",listOwnerObject:[],FED:!1},searchWidgetUI:null,addOptions:function(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;n++){var r=t[n];this.options[r]=e[r]}},init:function(e){var t=this;void 0===e.type&&(e.type=n.TYPE_FULL),this._parent(e);var r=e.events;null==r&&(r={}),r.onUserChoice=function(){t.filter(3)},r.onUserChoiceNoCharLimit=function(){t.filter(0)},e.events=r,"person_wux"===e.tw_type?this.searchWidgetUI=this.container=new a(e):this.searchWidgetUI=this.container=new s(e),this.searchWidgetUI.hideLoadingGif(),this.folder="SearchWidget",this._initVariables(),this.searchCacheObject={}},switchDropdownMode:function(e){this.options.dropdown=!0===e},_showDropdown:function(){return this.options.dropdown},_initVariables:function(){this._selectedItems=[],this.requestObject=null,this.currentSearch=null,this.lastSearch="",this.initSearch="",this.listLastSearch={},this.listInitSearch={},this.CSEListOfOrg={},this.CSEListOfCs={},this.listOwner=[],this.searchContainsParenthesis=!1,this.originalParenthesisSearchWord="",this.repeatSearch=0,this.currentSearchResultSize=0,this.serverSearchCalled=!0},destroy:function(){this.searchWidgetUI&&this.searchWidgetUI.destroy(),this._parent()},actionOnMove:function(){this.searchWidgetUI&&this.searchWidgetUI.actionOnMove()},actionOnScroll:function(){this.actionOnMove()},clearTextArea:function(){this.searchWidgetUI.clearTextArea()},clearInput:function(){this.searchWidgetUI.clearInput()},sortResponse:function(e){var t=this,r=e.owner,i={person:[],securityContext:[],collabSpace:[],organization:[],userGrp:[]},o=r.length;if(r&&0!=o)for(var s=0;s<o;s++)t.options.type!=n.TYPE_FULL&&t.options.type!=n.TYPE_PERSON||!r[s].hasOwnProperty("person")?t.options.type==n.TYPE_FULL&&r[s].hasOwnProperty("collabSpace")&&r[s].hasOwnProperty("organization")?i.securityContext.push(r[s]):t.options.type!=n.TYPE_FULL&&t.options.type!=n.TYPE_PROJECT||!r[s].hasOwnProperty("collabSpace")?t.options.type!=n.TYPE_FULL&&t.options.type!=n.TYPE_ORGANIZATION||!r[s].hasOwnProperty("organization")?t.options.exttype==n.EXTTYPE_USERGRP&&r[s].hasOwnProperty("userGrp")&&i.userGrp.push(r[s]):i.organization.push(r[s]):i.collabSpace.push(r[s]):i.person.push(r[s]);return i},getOwnerProperties:function(e){var t="",n="",r="";return e.hasOwnProperty("person")?(t=e.person.personID,n=e.person.personFullName):e.hasOwnProperty("collabSpace")||e.hasOwnProperty("organization")?e.hasOwnProperty("collabSpace")&&e.hasOwnProperty("organization")?(t=e.collabSpace.collabSpaceID+e.organization.orgID,n=e.organization.orgID+" / "+e.collabSpace.collabSpaceID,e.organization.hasOwnProperty("orgTitle")&&e.collabSpace.hasOwnProperty("collabSpaceTitle")&&(r=e.organization.orgTitle+" / "+e.collabSpace.collabSpaceTitle)):e.hasOwnProperty("collabSpace")?(t=e.collabSpace.collabSpaceID,n=e.collabSpace.collabSpaceID,""!==(r=e.collabSpace.collabSpaceTitle)&&(n=r)):e.hasOwnProperty("organization")&&(t=e.organization.orgID,n=e.organization.orgID,""!==(r=e.organization.orgTitle)&&(n=r)):e.hasOwnProperty("userGrp")&&(t=e.userGrp.id,n=e.userGrp.label),{IDOwner:t,Name:n,Title:r}},JSFilterPerson:function(e,t){var n=[],r=!0,i=!0;return e.forEach((function(e){r=!0,i=!0;var o=e.person.personID.toLowerCase(),s=e.person.personFullName.toLowerCase();t.every((function(e){return e=e.toLowerCase(),r&&o.indexOf(e)<0&&(r=!1),i&&s.indexOf(e)<0&&(i=!1),0!=r||0!=i})),(r||i)&&n.push(e)})),n},JSFilterSC:function(e,t){var n=[],r=!0;return e.forEach((function(e){r=!0;var i="",o="";e.hasOwnProperty("collabSpace")&&(i=e.collabSpace.hasOwnProperty("collabSpaceTitle")&&e.collabSpace.collabSpaceTitle?e.collabSpace.collabSpaceTitle.toLowerCase():e.collabSpace.collabSpaceID.toLowerCase()),e.hasOwnProperty("organization")&&(o=e.organization.hasOwnProperty("orgTitle")&&e.organization.orgTitle?e.organization.orgTitle.toLowerCase():e.organization.orgID.toLowerCase()),t.every((function(e){return e=e.toLowerCase(),!(i.indexOf(e)<0&&o.indexOf(e)<0)||(r=!1,!1)})),r&&n.push(e)})),n},JSFilterUserGrp:function(e,t){var n=[],r=!0;return e.forEach((function(e){r=!0;var i="";e.hasOwnProperty("userGrp")&&(i=e.userGrp.label.toLowerCase()),t.every((function(e){return e=e.toLowerCase(),i.indexOf(e)<0&&(r=!1),r})),r&&n.push(e)})),n},getDisplayedResult:function(){return this.searchWidgetUI.getCurrentValue()},setValue:function(e){this.searchWidgetUI.setDisplayValue(e)},getValue:function(){return this.searchWidgetUI.getDisplayValue()},updateFilter:function(e,t){var n=!1;this.listOwner=[],this.searchWidgetUI.clearAllResult();var s="",a=[];if(null!=this.searchWidgetUI){var c=this.searchWidgetUI.getListOfSearchingWord();s=c.valueSearched,a=c.listWord}this.lastSearch=s;var u=UWA.clone(e);this.listLastSearch=u,1==t?(this.initSearch=s,this.listInitSearch=UWA.clone(e)):(this.listLastSearch.person&&(this.listLastSearch.person=this.JSFilterPerson(this.listLastSearch.person,a)),this.listLastSearch.collabSpace&&(this.listLastSearch.collabSpace=this.JSFilterSC(this.listLastSearch.collabSpace,a)),this.listLastSearch.organization&&(this.listLastSearch.organization=this.JSFilterSC(this.listLastSearch.organization,a)),this.listLastSearch.securityContext&&(this.listLastSearch.securityContext=this.JSFilterSC(this.listLastSearch.securityContext,a)),this.listLastSearch.userGrp&&(this.listLastSearch.userGrp=this.JSFilterUserGrp(this.listLastSearch.userGrp,a)));for(var p=[],h=!1,d=0;d<4;d++){var g=null,S=[],f="",m="";if(this.options.type&&0==d){if(g=r.getImageUser(1,"small"),S=u.person,0==this.options.showEmptyCategory&&0==S.length)continue;f=l.get("peopleTile"),m="SW_DivPerson"}else if(this.options.type&&1==d){if(g=r.getImageUser(2,"small"),0==(S=u.collabSpace).length?S=u.securityContext:h=!0,0==this.options.showEmptyCategory&&0==S.length)continue;f=l.get("CSORGTitle"),m="SW_DivCS"}else if(this.options.type&&2==d){if(g=r.getImageUser(2,"small"),0==(S=u.organization).length&&(0==h||0==this.options.showEmptyCategory))continue;f=l.get("OrgTitle"),m="SW_DivOrg"}else{if(!this.options.exttype||3!=d)continue;if(g=r.getImageUser(3,"small"),0==(S=u.userGrp).length&&0==this.options.showEmptyCategory)continue;f=l.get("UserGrpTitle"),m="SW_DivUserGrp"}var v=[],w=S.length;if(S&&0!=w){n=!0,!1;for(var y="",C=0;C<w;C++){var b=this.getOwnerProperties(S[C]),_=b.IDOwner;y="";if(""!=(y=""!=b.Title?b.Title:b.Name)){var O=new o;O.setTitle(y),O.setId(_),O.setIcon(g),v.push(O),this.listOwner.push({owner:S[C],IDOwner:_,category:d})}}}var I=new i;I.setTitle(f),I.setClass(m),I.setListItems(v),p.push(I)}if("person_wux"===this.options.tw_type?this.searchWidgetUI._setResponseForPerson(p):this.searchWidgetUI.setData(p),n)this.searchWidgetUI.resetError(),this.searchWidgetUI.openDialog();else{var D={message:l.get("WarningNotFound"),code:"WARN",customClass:"SW_WarningNotFound",type:"warning",eventID:"warning"};this.searchWidgetUI.raiseError(D),window.__karma__||this.searchContainsParenthesis&&this.searchWidgetUI.dispatchEvent("onUnvalid")}},getOwnerElementFromId:function(e){var t=null;return this.listOwner.every((function(n){return n.IDOwner!=e||(t=n,!1)})),t},getNewOwner:function(){var e={},t=this.searchWidgetUI.getCurrentChoiceId(),n=this.getOwnerElementFromId(t);return null!=n&&((e=n.owner).comment="-"),e},_onComplete:function(e){this.requestObject=null;var t=this;if(this.currentSearch=null,this.repeatSearch=0,this.searchWidgetUI.hideLoadingGif(),this.searchWidgetUI.ClearDialog(),1==e.success){var n=t.sortResponse(e);t.updateFilter(n,!this._showDropdown()),t.hasOwnProperty("ODTResultForPersonSearchTest")&&(t.ODTResultForPersonSearchTest="Success")}else e.hasOwnProperty("error")&&this.searchWidgetUI.raiseError(e.error)},_onTimeout:function(){this.requestObject=null;this.currentSearch=null,this.searchWidgetUI.hideLoadingGif();var e={message:l.get("ErrorTimeOut"),code:"TO"};this.searchWidgetUI.raiseError(e),this.searchWidgetUI.ClearDialog()},_onFailure:function(e,t,n){this.requestObject=null;this.currentSearch=null,this.searchWidgetUI.hideLoadingGif();var r={};r=null!=t&&t.hasOwnProperty("error")?t.error:{message:l.get("UnknownError"),code:"ERROR"},this.searchWidgetUI.raiseError(r),this.searchWidgetUI.ClearDialog()},_onCancel:function(){this.requestObject=null,this.currentSearch=null,this.searchWidgetUI.hideLoadingGif(),this.searchWidgetUI.ClearDialog()}})})),define("DS/SearchWidget/controllers/SW_BasePnO_Controller",["DS/SearchWidget/controllers/SW_Base_Controller","DS/WAFData/WAFData","UWA/Json","DS/SearchWidget/SearchWidgetConstant","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WidgetServices/WidgetServices","DS/WidgetServices/MultipleAsynchronousRequests","i18n!DS/SearchWidget/assets/nls/langSW"],(function(e,t,n,r,i,o,s,a){"use strict";var l=0;let c=!0;return e.extend({getData:function(){},canBeLaunched:function(){return!0},getWebservicesParam:function(){},setSelectedItemList:function(e){this._selectedItems=e,this.lastSearch="",this.initSearch="",this.stringSearchedInService="",this.listLastSearch={},this.listInitSearch={},this.CSE_ListORGCSPair={},l=0},_ajaxCall:function(e){var r=this,i=e.serverUrl,s=e.query,a=e.securityContext,l=this.getWebservicesParam(),c=this.options.webParams;1==r.options.CSE&&(l.url=r.options.urlService);var u=c&&"function"==typeof c.getQueryParams?c.getQueryParams():{};if(u.pattern=s,r.stringSearchedInService=s,console.log("_ajaxCall",s),1==r.options.CSE&&("collabspace"==r.options.type||"org"==r.options.type)){var p=r.options.currentUser;""!=p&&null!=p&&(u.pattern=p)}h&&(u.tenant=h);var h=o.getTenantID(),d=i+l.url,g="?";for(var S in u)d+=g+S+"="+u[S],g="&";d.contains("/resources/v1/collabServices/base/transferOwnership/owner")&&(d+="&limit=100"),d+="&searchType="+r.options.type;var f=l.method,m={Accept:"application/json","Content-Type":"application/json"};a&&(m.SecurityContext=encodeURIComponent(a.SecurityContext));var v=c&&"function"==typeof c.getData?c.getData():{};v.businessObject=r._selectedItems;var w="GET"==f?"":n.encode(v),y="";0==r.options.wintop&&(y="passport"),r.searchWidgetUI.showLoadingGif(),m["Accept-Language"]=o.getLanguage(),r.requestObject=t.authenticatedRequest(d,{type:"json",method:f,proxy:y,data:w,headers:m,timeout:36e5,onComplete:function(t){e.onComplete(t)},onFailure:function(e,t,n){r._onFailure(e,t,n)},onCancel:function(){r._onCancel()},onTimeout:function(e){r._onTimeout()}})},_OrgFedSearch:function(e){var n=this,r=Object.keys(n.searchCacheObject),i={};if(r&&r.length>0){for(var s=0;s<r.length;s++)if(e.query.indexOf(r[s])>-1){var a=r[s];i=n.searchCacheObject[a]}if(!1===(e=>e&&0===Object.keys(e).length&&e.constructor===Object)(i))return n.serverSearchCalled=!1,void e.onComplete(i);n.searchCacheObject={},n.serverSearchCalled=!0}o.get3DSearchUrlAsync({wintop:n.options.wintop,serverUrl:n.options.serverUrl,onComplete:function(r){var i="";i=r.contains("odtUrl")?r+"/federated/search":r+"/search";var s=o.getTenantID();s&&(i+="?tenant="+s);var a=o.getLanguage();e.query=e.query.substring(1,e.query.length-1),n.stringSearchedInService=e.query;var l="3DSpaceSearch-"+widget.getValue("x3dAppId"),c="TOTO";"undefined"==typeof dscef&&(c=window.dsDashboardWindow&&window.dsDashboardWindow.top&&window.dsDashboardWindow.top.dsUserLogin?window.dsDashboardWindow.top.dsUserLogin:window.top.dsUserLogin?window.top.dsUserLogin:"unknown");var u={with_indexing_date:!0,with_nls:!1,label:l+"-"+c+"-"+(new Date).getTime(),locale:a,select_predicate:["ds6w:label","ds6w:identifier"],select_file:["icon","thumbnail_2d"],query:"[label]:(*"+e.query+"*)",login:{"3dspace":{SecurityContext:e.securityContext.SecurityContext}},order_by:"desc",order_field:"relevance",nresults:100,start:"0",source:["3dspace"],specific_source_parameter:{"3dspace":{additional_query:'AND ((flattenedtaxonomies:"types/Organization"))'}},tenant:s},p={Accept:"application/json","content-type":"application/json","Accept-Language":a},h=0==n.options.wintop?"passport":"";n.searchWidgetUI.showLoadingGif(),n.requestObject=t.authenticatedRequest(i,{type:"json",method:"POST",proxy:h,data:JSON.stringify(u),headers:p,onComplete:function(t){1==n.serverSearchCalled&&(t.infos.nresults>=100?n.searchCacheObject={}:n.searchCacheObject[e.query]=t),e.onComplete(t)},onFailure:function(e,t,r){n._onFailure(e,t,r)},onCancel:function(){n._onCancel()},onTimeout:function(e){n._onTimeout()}})}})},_allSearch:function(e){var n=this,r=Object.keys(n.searchCacheObject),i={};if(r&&r.length>0){for(var s=0;s<r.length;s++)if(e.query.indexOf(r[s])>-1){var a=r[s];i=n.searchCacheObject[a]}if(!1===(e=>e&&0===Object.keys(e).length&&e.constructor===Object)(i))return n.serverSearchCalled=!1,void e.onComplete(i);n.searchCacheObject={},n.serverSearchCalled=!0}o.get3DSearchUrlAsync({wintop:n.options.wintop,serverUrl:n.options.serverUrl,onComplete:function(r){var i="";i=r.contains("odtUrl")?r+"/federated/search":r+"/search";var s=o.getTenantID();s&&(i+="?tenant="+s);var a=o.getLanguage();e.query=e.query.substring(1,e.query.length-1),n.stringSearchedInService=e.query;var l="3DSpaceSearch-"+widget.getValue("x3dAppId"),c="TOTO";"undefined"==typeof dscef&&(c=window.dsDashboardWindow&&window.dsDashboardWindow.top&&window.dsDashboardWindow.top.dsUserLogin?window.dsDashboardWindow.top.dsUserLogin:window.top.dsUserLogin?window.top.dsUserLogin:"unknown");var u=l+"-"+c+"-"+(new Date).getTime(),p='((([ds6w:type]:"Person" AND [ds6w:identifier]:(*'+e.query+'*)) OR ([ds6w:type]:"Person" AND [ds6w:responsible]:(*'+e.query+'*)) OR ([ds6w:type]:"Person" AND [ds6wg:fullname]:(*'+e.query+'*)) OR ([ds6w:type]:"Person" AND [firstname]:(*'+e.query+'*)) OR ([ds6w:type]:"Person" AND [lastname]:(*'+e.query+'*))) AND policycurrent:"Person.Active") OR ([ds6w:type]:"Security Context" AND ([projtitle]:(*'+e.query+'*) )) OR ([ds6w:type]:"Security Context" AND ([orgtitle]:(*'+e.query+"*) ))";"user"==n.options.type&&(p='(([ds6w:type]:"Person" AND [ds6w:identifier]:(*'+e.query+'*)) OR ([ds6w:type]:"Person" AND [ds6w:responsible]:(*'+e.query+'*)) OR ([ds6w:type]:"Person" AND [ds6wg:fullname]:(*'+e.query+'*)) OR ([ds6w:type]:"Person" AND [firstname]:(*'+e.query+'*)) OR ([ds6w:type]:"Person" AND [lastname]:(*'+e.query+'*))) AND policycurrent:"Person.Active"');var h={with_indexing_date:!0,with_nls:!1,label:u,locale:a,select_predicate:["ds6w:label","ds6w:type","ds6w:description","ds6w:identifier","ds6w:responsible","ds6wg:fullname","firstname","lastname"],select_file:["icon","thumbnail_2d"],query:p,login:{"3dspace":{SecurityContext:e.securityContext.SecurityContext}},order_by:"desc",order_field:"relevance",nresults:1e3,start:"0",source:["3dspace"],tenant:s},d={Accept:"application/json","content-type":"application/json","Accept-Language":a},g=0==n.options.wintop?"passport":"";n.searchWidgetUI.showLoadingGif(),n.requestObject=t.authenticatedRequest(i,{type:"json",method:"POST",proxy:g,data:JSON.stringify(h),headers:d,onComplete:function(t){1==n.serverSearchCalled&&(t.infos.nresults>=100?n.searchCacheObject={}:n.searchCacheObject[e.query]=t),e.onComplete(t)},onFailure:function(e,t,r){n._onFailure(e,t,r)},onCancel:function(){n._onCancel()},onTimeout:function(e){n._onTimeout()}})}})},_CustomFedSearch:function(e){var n=this,r="",i="";this.options.type.contains("user")?(r='AND ((flattenedtaxonomies:"types/Person" AND policycurrent:"Person.Active"))',e.source&&"swym"===e.source&&(i='[ds6w:type]:( "pno:Person")',r="AND personOrGroup:("+e.query+")",e.query=i)):this.options.type.contains("collabspace")?e.query="("+e.query+') (flattenedtaxonomies:"types/Security Context")':this.options.type.contains("org")&&(r='AND ((flattenedtaxonomies:"types/Organization"))'),o.get3DSearchUrlAsync({wintop:n.options.wintop,serverUrl:n.options.serverUrl,onComplete:function(i){var s="";s=i.contains("odtUrl")?i+"/federated/search":i+"/search";var a=o.getTenantID();a&&(s+="?tenant="+a);var l=o.getLanguage(),c="3DSpaceSearch-"+widget.getValue("x3dAppId"),u="TOTO";"undefined"==typeof dscef&&(u=window.dsDashboardWindow&&window.dsDashboardWindow.top&&window.dsDashboardWindow.top.dsUserLogin?window.dsDashboardWindow.top.dsUserLogin:window.top.dsUserLogin?window.top.dsUserLogin:"unknown");var p=c+"-"+u+"-"+(new Date).getTime(),h="";h="3dspace"==e.source?{"3dspace":{additional_query:r}}:{swym:{additional_query:r}};var d=["ds6w:label","ds6w:resourceUid","resourceid","ds6w:type","ds6w:description","ds6w:identifier","ds6w:responsible","ds6wg:fullname"];"3dspace"===e.source?(d.push("firstname"),d.push("lastname")):"swym"===e.source&&(d.push("first_name"),d.push("last_name"));var g={with_indexing_date:!0,with_nls:!1,label:p,locale:l,select_predicate:d,select_file:["icon","thumbnail_2d"],query:e.query,order_by:"desc",order_field:"relevance",nresults:100,start:"0",source:[e.source],specific_source_parameter:h,tenant:a},S={Accept:"application/json","content-type":"application/json","Accept-Language":l},f=0==n.options.wintop?"passport":"";n.requestObject=t.authenticatedRequest(s,{type:"json",method:"POST",proxy:f,data:JSON.stringify(g),headers:S,onComplete:function(t){e.onComplete(t)},onFailure:function(e,t,r){n._onFailure(e,t,r)},onCancel:function(){n._onCancel()},onTimeout:function(e){n._onTimeout()}})}})},_spaceSearch:function(e){var t=this;o.get3DSpaceUrlAsync({wintop:t.options.wintop,serverUrl:t.options.serverUrl,onComplete:function(n){t.options.odtMode&&1==t.options.odtMode&&(c=!1),c?i.getInstance().getValidSecurityContext({onSuccess:function(r){if(e.securityContext=r,e.serverUrl=n,1==t.options.CSE&&t.options.listOwnerObject&&t.options.listOwnerObject.length>0){function p(e,t,n){for(const r in e)if(e.hasOwnProperty(r)&&t&&"string"==typeof e[r]&&r===n){if(!0===((e,t)=>new RegExp(t,"i").test(e))(e[r],t))return!0}return!1}var i=e.query.replaceAll("*",""),o={};if(t.options.type.contains("collabspace")){var s=[],a=!1;t.options.currentOrg&&(a=!0);for(var l=!1,c=0;c<t.options.listOwnerObject.length;c++)if(t.options.listOwnerObject[c].hasOwnProperty("collabSpace")&&t.options.listOwnerObject[c].hasOwnProperty("organization"))if(!0===a)t.options.listOwnerObject[c].organization.hasOwnProperty("orgID")&&t.options.listOwnerObject[c].organization.orgID.contains(t.options.currentOrg)&&!0===p(t.options.listOwnerObject[c].collabSpace,i,"collabSpaceTitle")&&(s.push({collabSpace:t.options.listOwnerObject[c].collabSpace}),l=!0);else{void 0===s.find((e=>e.collabSpace.collabSpaceID===t.options.listOwnerObject[c].collabSpace.collabSpaceID))&&s.push({collabSpace:t.options.listOwnerObject[c].collabSpace})}if(s.length>0)return s=[...new Set(s)],o.owner=s,o.success=!0,void t._onComplete(o)}if(t.options.type.contains("org")){s=[];var u=!1;t.options.currentCollabSpace&&(u=!0);for(l=!1,c=0;c<t.options.listOwnerObject.length;c++)if(t.options.listOwnerObject[c].hasOwnProperty("collabSpace")&&t.options.listOwnerObject[c].hasOwnProperty("organization"))if(!0===u)t.options.listOwnerObject[c].collabSpace.hasOwnProperty("collabSpaceID")&&t.options.listOwnerObject[c].collabSpace.collabSpaceID.contains(t.options.currentCollabSpace)&&!0===p(t.options.listOwnerObject[c].organization,i,"orgTitle")&&(s.push({organization:t.options.listOwnerObject[c].organization}),l=!0);else{void 0===s.find((e=>e.organization.orgID===t.options.listOwnerObject[c].organization.orgID))&&s.push({organization:t.options.listOwnerObject[c].organization})}if(s.length>0)return s=[...new Set(s)],o.owner=s,o.success=!0,void t._onComplete(o);if(0==l&&!0===a)return o.owner=s,o.success=!0,void t._onComplete(o)}}t._ajaxCall(e)},onFailure:function(n){t._ajaxCall(e)}}):i.getInstance().getSecurityContext({onSuccess:function(r){e.securityContext=r,e.serverUrl=n,t._ajaxCall(e)},onFailure:function(n){t._ajaxCall(e)}})}})},parseResponse:function(e){var t=e=>e.reduce((function(e,n){return e.concat(Array.isArray(n)?t(n):n)}),[]);let n=[];if(!UWA.is(e.collabspaces,"array"))return n;let r=[...new Set(t(e.collabspaces.map((e=>e.couples.map((e=>e.organization.name))))))].length>1;return e.collabspaces.forEach((e=>{e.couples.forEach((t=>{var i=null==t.role.nls||""==t.role.nls?t.role.name:t.role.nls,o=t.role.name,s=t.organization.name,a=t.organization.title,l=e.name,c=e.title?e.title:e.name;let u=r?c+" ● "+a+" ● "+i:c+" ● "+i,p="ctx::"+o+"."+s+"."+l;n.push({displayName:u,ctx:p})}))})),n.sort(((e,t)=>e.displayName.localeCompare(t.displayName,void 0,{numeric:!0,sensitivity:"base"})))},_allSearchSecurityContext:function(e){var n=this;o.get3DSpaceUrlAsync({wintop:n.options.wintop,serverUrl:n.options.serverUrl,onComplete:function(r){if(n.options.odtmode&&1==n.options.odtmode&&(c=!1),c){let o={source:n.options&&n.options.source?n.options.source:void 0};i.getInstance(o).getValidSecurityContext({onSuccess:function(t){e.securityContext=t,e.serverUrl=r,"org"===n.options.type?n._OrgFedSearch(e):n._allSearch(e)},onFailure:function(i){var o=widget.getValue("x3dPlatformId"),s=r+"/resources/modeler/pno/person?current=true&select=collabspaces&tenant="+o,a={Accept:"application/json","Content-Type":"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang")};n.requestObject=t.authenticatedRequest(s,{method:"GET",headers:a,onComplete:function(t){var i=n.parseResponse(JSON.parse(t));i.length<0||!UWA.is(i,"array")?console.error("Missing credentials"):null!=i[0]&&null!=i[0]&&i[0].hasOwnProperty("ctx")&&(e.securityContext={SecurityContext:i[0].ctx,tenant:""},e.serverUrl=r,n._allSearch(e))},onFailure:function(e,t,r){n._onFailure(e,t,r)},onCancel:function(){n._onCancel()},onTimeout:function(e){n._onTimeout()}})}})}else i.getInstance().getSecurityContext({onSuccess:function(t){e.securityContext=t,e.serverUrl=r,"org"===n.options.type?n._OrgFedSearch(e):n._allSearch(e)},onFailure:function(i){var o=widget.getValue("x3dPlatformId"),s=r+"/resources/modeler/pno/person?tenant="+o+"&current=true&select=preferredcredentials&select=collabspaces",a={Accept:"application/json","Content-Type":"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang")};n.requestObject=t.authenticatedRequest(s,{method:"GET",headers:a,onComplete:function(t){var i=n.parseResponse(JSON.parse(t));i.length<0||!UWA.is(i,"array")?console.error("Missing credentials"):null!=i[0]&&null!=i[0]&&i[0].hasOwnProperty("ctx")&&(e.securityContext={SecurityContext:i[0].ctx,tenant:""},e.serverUrl=r,n._allSearch(e))},onFailure:function(e,t,r){n._onFailure(e,t,r)},onCancel:function(){n._onCancel()},onTimeout:function(e){n._onTimeout()}})}})}})},_fedSearch:function(e){var n=this;o.get3DSearchUrlAsync({wintop:n.options.wintop,serverUrl:n.options.serverUrl,onComplete:function(r){var i=r+"/search",s=o.getTenantID();s&&(i+="?tenant="+s);var a=o.getLanguage(),l={select_predicate:["groupuri","ds6w:label","dsaccess:groupMemberCount","identifier"]};l.locale=a,l.nresults=100,l.tenant=s,l.query='([ds6w:type]:"Group" AND [ds6w:label]:('+e.query+')) OR ([ds6w:type]:"foaf:Group" AND [ds6w:label]:('+e.query+"))",l.start=0,l.order_field="ds6w:label",l.order_by="asc";var c={Accept:"application/json","content-type":"application/json","Accept-Language":a},u=0==n.options.wintop?"passport":"",p="TOTO";"undefined"==typeof dscef&&(p=window.dsDashboardWindow&&window.dsDashboardWindow.top&&window.dsDashboardWindow.top.dsUserLogin?window.dsDashboardWindow.top.dsUserLogin:window.top.dsUserLogin?window.top.dsUserLogin:"unknown");var h="searchUserGrp-"+p+"-"+(new Date).getTime();l.label=h,n.requestObject=t.authenticatedRequest(i,{type:"json",method:"POST",proxy:u,data:UWA.Json.encode(l),headers:c,onComplete:function(t){e.onComplete(t)},onFailure:function(e,t,r){n._onFailure(e,t,r)},onCancel:function(){n._onCancel()},onTimeout:function(e){n._onTimeout()}})}})},filter:function(e){for(var t=this,n=this.searchWidgetUI.getCurrentValue(),i=!0,o=t.options.ForbiddenChar.length,c=0;c<o;c++){var u=t.options.ForbiddenChar[c];if(-1!=n.indexOf(u)){i=!1;var p={code:"",message:a.get("This character is forbidden : {0}").format(u)};this.searchWidgetUI.raiseError(p);break}}window.__karma__||(n.indexOf("(")>-1||n.indexOf(")")>-1?(this.searchContainsParenthesis=!0,this.originalParenthesisSearchWord=n):(this.searchContainsParenthesis=!1,this.originalParenthesisSearchWord=""),n=(n=n.replace(/\(/g," ")).replace(/\)/g," "));var h=(n=n.trim()).replace(/\s+/g," ");if(!this._showDropdown()&&h.length<e&&(i=!1,h.length<e&&this.options.hasOwnProperty("IsMoveSearch")&&this.options.IsMoveSearch)){var d={message:a.get("AutocompleteWarning"),code:"WARN",customClass:"SW_WarningNotFound",type:"warning",eventID:"warning"};this.searchWidgetUI.raiseError(d)}n="*"+n+"*",console.log("valueToSearch: ",n);var g=null!==this.currentSearch&&h.toLowerCase()===this.currentSearch.toLowerCase(),S=!1;if(S=""!=this.stringSearchedInService?h.toLowerCase()===this.stringSearchedInService.toLowerCase()&&(""!==this.stringSearchedInService||!this._showDropdown()):h.toLowerCase()===this.lastSearch.toLowerCase()&&(""!==this.lastSearch||!this._showDropdown()),null!=this.requestObject){if(S||g)return void this.searchWidgetUI.openDialog();this.requestObject.cancel()}if(!(!this._showDropdown()&&h.length<=0||!this.canBeLaunched())&&n&&i)if(g)this._showDropdown()&&this.searchWidgetUI.openDialog();else if(l<2&&S&&!this.searchWidgetUI.isResultEmpty())l++,this.searchWidgetUI.openDialog(),console.log("listLastSearch: ",this.listLastSearch);else{l=0;var f=null;if(f=new s([],(function(){t.currentSearch=h;var e=this.getAnswer("A"),n=null;(n=e?UWA.clone(e):{success:!0}).owner=n.owner?n.owner:[];var i=this.getAnswer("CSE");if(i&&i.owner){var o=i.owner?i.owner:[];function _(e,t,n){for(const r in e)if(e.hasOwnProperty(r)&&t&&"string"==typeof e[r]&&r===n){if(!0===((e,t)=>new RegExp(t,"i").test(e))(e[r],t))return!0}return!1}t.options.listOwnerObject=o,t.searchWidgetUI.dispatchEvent("onCSEListOwnerObjectFilled");const O=t.currentSearch;if(t.options.type==r.TYPE_PROJECT){t.options.currentOrg&&!0;var s="";t.options.currentOrg&&(s=t.options.currentOrg,console.log("currentOrgSelection = ",s));var l={};t.CSEListOfOrg={};for(var c=0;c<o.length;c++){var u="";(S=o[c].collabSpace).hasOwnProperty("collabSpaceID")&&(u=S.collabSpaceID,console.log("id= ",u));var p=null;if((g=o[c].organization).hasOwnProperty("orgID")&&(p=g.orgID),t.CSEListOfOrg.hasOwnProperty(u))t.CSEListOfOrg[u].push(p);else{var d=[];p&&d.push(p),t.CSEListOfOrg[u]=d}!0===_(o[c].collabSpace,O,"collabSpaceTitle")&&(t.options.currentOrg?t.options.currentOrg==o[c].organization.orgID&&n.owner.push({collabSpace:o[c].collabSpace}):n.owner.push({collabSpace:o[c].collabSpace}))}function I(e){const t=new Map;return e.filter((e=>!t.has(e.collabSpace.collabSpaceID)&&(t.set(e.collabSpace.collabSpaceID,!0),!0)))}n.owner=I(n.owner)}else if(t.options.type==r.TYPE_ORGANIZATION){l={};t.CSEListOfCs={};for(c=0;c<o.length;c++){var g,S;u="";if((g=o[c].organization).hasOwnProperty("orgID")&&(u=g.orgID),0==Object.keys(l).length)var f=null;if((g=o[c].organization).hasOwnProperty("orgID")&&(p=g.orgID),(S=o[c].collabSpace).hasOwnProperty("collabSpaceID")&&(f=S.collabSpaceID),t.CSEListOfOrg.hasOwnProperty(p))t.CSEListOfOrg[p].push(f);else{var m=[];f&&m.push(f),t.CSEListOfCs[p]=m}!0===_(o[c].organization,t.currentSearch,"orgTitle")&&(t.options.currentCollabSpace?t.options.currentCollabSpace==o[c].collabSpace.collabSpaceID&&n.owner.push({organization:o[c].organization}):n.owner.push({organization:o[c].organization}))}function D(e){const t=new Map;return e.filter((e=>!t.has(e.organization.orgID)&&(t.set(e.organization.orgID,!0),!0)))}n.owner=D(n.owner)}else n.owner=i.owner}var v=[],w=this.getAnswer("CUSTOMFEDSEARCH");w&&w.results&&w.results.forEach((function(e){if(e.attributes&&Array.isArray(e.attributes)){var r=null,i=null,o=null,s=null,a=null,l=null;if(e.attributes.every((function(e){return"ds6w:identifier"===e.name&&"3dspace"==t.options.searchSource&&(r=e.value),"ds6wg:fullname"===e.name&&(i=e.value),"3dspace"!=t.options.searchSource?("resourceid"==e.name&&0===(r=e.value).indexOf("iam:")&&(r=r.slice(4)),"first_name"===e.name&&(o=e.value),"last_name"===e.name&&(s=e.value),"ds6w:label"===e.name&&(i=e.value)):("firstname"===e.name&&(o=e.value),"lastname"===e.name&&(s=e.value),"ds6w:label"===e.name&&(l=e.value)),"ds6w:identifier"===e.name&&(a=e.value),null===r||null===i||null===o||null===s||null===a||null===l})),t.options.type.contains("user")&&null!=i&&null!=r&&("3dspace"===t.options.searchSource&&(r+="_PRJ"),n.owner.push({person:{personFirstName:o,personFullName:i,personID:r,personLastName:s}})),t.options.type.contains("collabspace")&&null!=l){var c="",u=l.split(".");null!=u&&null!=u&&3==u.length&&(c=u[2]),-1==v.indexOf(c)&&v.push(c)}t.options.type.contains("org")&&null!=r&&n.owner.push({organization:{orgID:r}})}})),v.length>0&&t.options.type.contains("collabspace")&&v.forEach((function(e){n.owner.push({collabSpace:{collabSpaceID:e}})}));var y=this.getAnswer("C");y&&y.results&&y.results.forEach((function(e){if(e.attributes){var t=null,r=null,i=null,o=null,s=null,a=null;if(e.attributes.every((function(e){return"ds6w:identifier"===e.name&&(t=e.value),"ds6wg:fullname"===e.name&&(r=e.value),"firstname"===e.name&&(i=e.value),"lastname"===e.name&&(o=e.value),"ds6w:identifier"===e.name&&(s=e.value),"ds6w:label"===e.name&&(a=e.value),null===t||null===r||null===i||null===o||null===s||null===a})),null!=r){var l=o+" "+i,c=r+"\n("+t.toLowerCase()+")";null===(t+="_PRJ")&&null===r||(t.toLowerCase().contains(h.toLowerCase())||r.toLowerCase().contains(h.toLowerCase())||l.toLowerCase().contains(h.toLowerCase()))&&n.owner.push({person:{personFirstName:i,personFullName:c,personID:t,personLastName:o}})}else if(null!=s&&null!=a){var u=a.substring(a.indexOf(".")+1,a.length),p=u.lastIndexOf("."),d=u.substring(0,p),g=u.substring(p+1,u.length);p=s.indexOf("."),p=(s=s.substring(p+1,s.length)).indexOf(".");var S=s.substring(0,p),f=s.substring(p+1,s.length),m={collabSpace:{collabSpaceID:f,collabSpaceTitle:g},organization:{orgID:S,orgTitle:d}};if(g.toLowerCase().contains(h.toLowerCase())||d.toLowerCase().contains(h.toLowerCase()))if(n.owner.length>0){var v=!1;n.owner.forEach((function(e){e.hasOwnProperty("collabSpace")&&e.hasOwnProperty("organization")&&e.collabSpace.collabSpaceID===m.collabSpace.collabSpaceID&&e.organization.orgID===m.organization.orgID&&(v=!0)})),0==v&&n.owner.push({collabSpace:{collabSpaceID:f,collabSpaceTitle:g},organization:{orgID:S,orgTitle:d}})}else n.owner.push({collabSpace:{collabSpaceID:f,collabSpaceTitle:g},organization:{orgID:S,orgTitle:d}})}}}));var C=this.getAnswer("ORGFEDSEARCH");C&&C.results&&(n.results&&(this.currentSearchResultSize=n.results.length),C.results.forEach((function(e){if(e.attributes){var t=null,r=null;e.attributes.every((function(e){return"ds6w:label"===e.name&&(t=e.value),"ds6w:identifier"===e.name&&(r=e.value),null===t||null===r})),null!=t&&null!=r&&n.owner.push({organization:{orgID:r,orgTitle:t}})}})));var b=this.getAnswer("B");b&&b.results&&b.results.forEach((function(e){if(e.attributes){var t=null,r=null,i=0,o=0,s=null;e.attributes.every((function(e){return"ds6w:label"===e.name&&(r=e.value),"groupuri"===e.name&&(t=e.value),"dsaccess:groupMemberCount"===e.name&&(o=e.value),"ds6w:who/ds6w:hasMember"===e.name&&(i+=1),"identifier"==e.name&&(s=e.value),null===t||null===r||0===i||null===s})),null===t&&e.attributes.every((function(e){return"resourceid"===e.name&&(t=e.value),null===t})),0!=o&&(i=o),null!==r&&(r=0===i||1===i?r+"\n("+i+" "+a.get("member")+")":i>50&&0==o?r+"\n(50+ "+a.get("members")+")":r+"\n("+i+" "+a.get("members")+")"),null===t&&null===r&&null==s||n.owner.push({userGrp:{id:t,label:r,identifier:s}})}})),t._onComplete(n)})),this.options.hasOwnProperty("IsMoveSearch")&&1==this.options.IsMoveSearch?(this.options.type.contains("user")||this.options.type.contains("collabspace")||this.options.type.contains("org"))&&(this.options.FED&&1==this.options.FED?f.addRequest("CUSTOMFEDSEARCH"):this.options.hasOwnProperty("CSE")&&0==this.options.CSE?f.addRequest("A"):this.options.hasOwnProperty("CSE")&&1==this.options.CSE&&f.addRequest("CSE")):this.options.hasOwnProperty("IsMoveSearch")&&0==this.options.IsMoveSearch&&("all"==this.options.type||"user"==this.options.type?f.addRequest("C"):this.options.type.contains("org")&&f.addRequest("ORGFEDSEARCH")),this.options.exttype&&f.addRequest("B"),this.options.hasOwnProperty("IsMoveSearch")&&1==this.options.IsMoveSearch){if(this.options.type.contains("user")||this.options.type.contains("collabspace")||this.options.type.contains("org"))if(this.options.hasOwnProperty("FED")&&1==this.options.FED){var m=this.options.searchSource?this.options.searchSource:"3dspace";this._CustomFedSearch({query:n,source:m,onComplete:function(e){f.setAnswer("CUSTOMFEDSEARCH",e)}})}else this.options.hasOwnProperty("CSE")&&1==this.options.CSE?this._spaceSearch({query:n,onComplete:function(e){f.setAnswer("CSE",e)}}):this.options.hasOwnProperty("CSE")&&0==this.options.CSE&&this._spaceSearch({query:n,onComplete:function(e){f.setAnswer("A",e)}})}else this.options.hasOwnProperty("IsMoveSearch")&&0==this.options.IsMoveSearch&&("all"==this.options.type||"user"==this.options.type?this._allSearchSecurityContext({query:n,onComplete:function(e){f.setAnswer("C",e)}}):this.options.type.contains("org")&&this._allSearchSecurityContext({query:n,onComplete:function(e){f.setAnswer("ORGFEDSEARCH",e)}}));this.options.exttype&&this._fedSearch({query:n,onComplete:function(e){f.setAnswer("B",e)}})}}})})),define("DS/SearchWidget/controllers/SW_Restricted_Controller",["DS/SearchWidget/controllers/SW_BasePnO_Controller","DS/WAFData/WAFData","UWA/Json","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WidgetServices/WidgetServices"],(function(e,t,n,r,i){"use strict";return e.extend({requestObject:null,defaultOptions:{methodType:"POST"},init:function(e){this._parent(e)},getWebservicesParam:function(){var e=this.options.urlService,t=this.options.methodType,n=e.indexOf("/");return e||0!==n&&(e="/resources/v1/collabServices/base/transferOwnership/owner"),{method:t,url:e}},canBeLaunched:function(){return this._selectedItems.length>0}})})),define("DS/SearchWidget/controllers/SW_FullPos_Controller",["DS/SearchWidget/controllers/SW_BasePnO_Controller","DS/WAFData/WAFData","UWA/Json","DS/SearchWidget/SearchWidgetConstant","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WidgetServices/WidgetServices"],(function(e,t,n,r,i,o){"use strict";return e.extend({requestObject:null,defaultOptions:{type:r.TYPE_FULL,data:null,methodType:"GET"},init:function(e){e.data&&(e.data=this._formatData(e.data)),this._parent(e)},setData:function(e){this._initVariables(),this.options.data=this._formatData(e)},setWebParams:function(e){e&&e.hasOwnProperty("getQueryParams")&&"function"===e.getQueryParams&&(this.options.webParams=e)},getData:function(){return this.options.data},_formatData:function(e){var t=null;if(e){t={person:[],securityContext:[],collabSpace:[],organization:[]};var n={persons:"person",collabSpaces:"collabSpace",organizations:"organization",securityContexts:"securityContext"};for(var r in n)if(e[r]){var i=n[r];e[r].forEach((function(e){var n={};n[i]=e,t[i].push(n)}))}}return t},getWebservicesParam:function(){var e=this.options.urlService,t=this.options.methodType,n=e.indexOf("/");return e||0!==n&&(this.options.type==r.TYPE_PERSON?(t="POST",e="/resources/v1/collabServices/base/transferOwnership/owner"):e="/resources/pno/ownership/transfertarget/"+this.options.type),{method:t,url:e}}})})),define("DS/SearchWidget/SearchWidget",["UWA/Controls/Abstract","DS/SearchWidget/controllers/SW_FullPos_Controller","DS/SearchWidget/controllers/SW_Restricted_Controller","css!DS/SearchWidget/SearchWidget.css","i18n!DS/SearchWidget/assets/nls/langSW"],(function(e,t,n){"use strict";return{FULL:"FullTriplet",RESTRICTED:"Restrict",getSearchWidget:function(e,r){return e==this.FULL?new t(r):e==this.RESTRICTED?new n(r):void 0}}}));