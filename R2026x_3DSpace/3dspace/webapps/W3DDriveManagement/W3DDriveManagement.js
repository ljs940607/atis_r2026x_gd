define("DS/W3DDriveManagement/view/ShareTableLayout",["UWA/Core","UWA/Class/View","UWA/Controls/Pager","UWA/Class/Promise","DS/UIKIT/Scroller","DS/UIKIT/SuperModal","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/WAFData/WAFData","DS/Handlebars/Handlebars","text!DS/W3DDriveManagement/template/ShareTableLayout.html","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement","css!DS/UIKIT/UIKIT.css"],(function(e,t,n,i,a,s,r,o,c,l,u,h){"use strict";var d=new s({renderTo:document.body}),m=t.extend({searchString:"",lastFetchedIndex:0,paginationSize:50,pager:{},domEvents:{"click .restricted__available":"_showRestrictedEmails","click .revoke__access__icon":"_revokeAccess"},setup:function(e){var t=this;this.alert=e.alert,this.template=l.compile(u),this.listenTo(this.collection,"onChange",this.render),this.listenTo(this.collection,"onSync",this.render),this.listenTo(this.collection,"onAdd",this.render),this.listenTo(this.collection,"onRemove",this.render),this.pager=new n({limit:this.paginationSize,offset:0,type:1,showPageLinks:!0,max:this.collection.length,events:{onOffsetChange:function(e){if(t.render(),e+this.limit>=this.length){var n=t.lastFetchedIndex+1;t.fetchMoreSharedLinks({index:n}).then((function(){t.pager.length!==t.collection.length&&(t.lastFetchedIndex++,t.pager.setLength(t.collection.length),t.pager.onRefresh())}))}}}})},refresh:function(){var e=this;return new i((function(t){e.collection.fetch({onComplete:function(){e.pager.setLength(e.collection.length),e.pager.onRefresh(),t()}})}))},render:function(){var e=this.pager.offset;this.currentModel=this.collection;var t=this.collection.length>0;if(t&&(this.currentModel=this.collection.toJSON().slice(e,e+this.paginationSize)),this.container.innerHTML=this.template({isDataAvailable:t,links:this.currentModel,NLS:h}),this.pager.elements.container.parentNode!==this.container.parentElement.querySelector(".pager")){var n=this.container.parentElement.querySelector(".pager");if(!n)return;n.appendChild(this.pager.elements.container)}},_revokeAccess:function(e){var t=this,n=e.target.dataset.modelId,i=this.collection.findWhere({id:n});d.dialog({body:h.revokeAccessMessage,title:h.replace(h.revokeAccessFor,{name:i.get("sharedObjectName")}),buttons:[{className:"primary",value:h.revoke,action:function(e){e.hide(),i.destroy({onComplete:function(){t.alert.add({message:h.revokeAccessSuccess,className:"success"})},onFailure:function(){t.alert.add({message:h.revokeAccessError,className:"error"})},wait:!0})}},{className:"default",value:h.cancel,action:function(e){e.hide()}}]})},_showRestrictedEmails:function(e){var t=e.target.dataset.modelId,n=this.collection.findWhere({id:t}),i=document.createElement("div");0===n.get("restrictions").length?i.innerText=h.emptyRestrictions:n.get("restrictions").map((function(e){var t=document.createElement("div");t.innerText=e.mail,i.appendChild(t)})),d.dialog({body:i,title:h.replace(h.restrictionsFor,{name:n.get("sharedObjectName")}),buttons:[{className:"primary",value:h.ok,action:function(e){e.hide()}}]})},fetchMoreSharedLinks:function(e){var t=this,n=e.index;return o.mask(this.container),new i((function(e,i){if(t.collection.last)return o.unmask(t.container),e({offset:t.collection.length-t.paginationSize});n="number"==typeof n&&isNaN(n)?0:n,t.collection.fetch({page:n,remove:!1,onComplete:function(){o.unmask(t.container),e({offset:t.collection.length})},onFailure:function(){i(arguments)}})}))}});return m})),define("DS/W3DDriveManagement/Utils/WAFDataForDriveMgt",["DS/WAFData/WAFData"],(function(e){"use strict";var t,n={};return{authenticatedRequest:function(i,a){if(!i.includes("tenant=")){const e="tenant="+n.tenant;i+=`${i.includes("?")?"&":"?"}${e}`}var s=Object.assign({},a);s.headers=Object.assign({},s.headers),s.headers["X-DS-CSRFTOKEN"]=t||"";var r=s.onComplete;return s.onComplete=function(e,n,i){var a=Object.keys(n).filter((function(e){return-1!==e.search(/x-ds-csrftoken/i)}));t=a.length>0?n[a[0]]:t,"function"==typeof r&&r(e,n,i)},e.authenticatedRequest(i,s)},getPlatform:function(){return n},setPlatform:function(e){n=e}}})),define("DS/W3DDriveManagement/W3DDriveManagementWidget",["UWA/Array","UWA/Class/Promise","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/PlatformAPI/PlatformAPI","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],(function(e,t,n,i,a){"use strict";var s,r,o=!1,c=[];function l(){return new t((function(e,t){const i="true"===new URLSearchParams(window.parent.location.search).get("drivecore");n.getPlatformServices({onComplete:t=>{if(!t||!Array.isArray(t))return e([]);const n=t.filter((e=>e?.[i?"3ddrivecore":"3DDrive"])).map((e=>({tenant:e.platformId,displayName:e.displayName,url:e[i?"3ddrivecore":"3DDrive"],urlSwym:e["3DSwym"],urlDriveshub:e.driveshub||null})));e(n)},onFailure:t})}))}function u(){return new t(((e,i)=>{new t(((e,t)=>{const i="true"===new URLSearchParams(window.parent.location.search).get("drivecore");return n.getPlatformServices({platformId:s.getValue("x3dPlatformId"),onComplete:function(t){const n=c.find((e=>e.id===t.platformId));if(n)return e(n);if(t){const n={tenant:t.platformId,displayName:t.displayName,url:t[i?"3ddrivecore":"3DDrive"],urlSwym:t["3DSwym"],urlDriveshub:t.driveshub};n.tenant&&c.push(n),e(c)}else l().then((t=>e(t[0])))},onFailure:t})})).then((t=>{l().then((t=>{t.forEach((e=>{c.includes(e)||c.push(e)})),e(c)}))})).catch((e=>i(e)))}))}function h(n){return new t((function(t,r){n||r("Unexpected error");var c={type:"list",name:"collab-storage",label:"3DEXPERIENCE Platform",options:[],onchange:"onStorageChange"},l=s.getValue("collab-storage");if(""===l){var u,h=s.getValue("x3dPlatformId");(u=e.detect(n,(function(e){return e.tenant===h})))||(u=n[0]),u&&s.setValue("collab-storage",u.tenant)}else u=e.detect(n,(function(e){return e.tenant===l}));n.forEach((function(e){c.options.push({label:e.displayName,value:e.tenant})})),1===n.length&&u?c.type="hidden":c.options.length>1&&c.options.sort(((e,t)=>e.label.localeCompare(t.label))),s.addPreference(c),o&&(s.dispatchEvent("onEdit",["refreshPrefs"]),u||(u=n[0])),i.subscribe("PlatformManagement.renamePlatformName",(function(e){u.set("displayName",e)})),u?(s.setValue("x3dPlatformId",u.tenant),t(u)):r(a.updatePreference)}))}function d(e){e&&"fullscreen"===e.type?document.body.querySelector(".moduleContent").addClassName("widget-fullscreen-view"):document.body.querySelector(".moduleContent").removeClassName("widget-fullscreen-view")}return{init:function(t,n){var i=this;s=t,require([n],(function(t){(r=new t({container:s.body})).render(),s._view&&d(s._view),s.addEvents({onRefresh:function(){if(i.storageChange){var t=i.storageChange;delete i.storageChange,l().then((function(n){var i=e.detect(n,(function(e){return e.tenant===t}));s.setValue("x3dPlatformId",i.tenant),r.refresh({platform:i})})).catch((function(e){r.error(e)}))}else r.refresh()},onStorageChange:function(e,t){i.storageChange=t},onEdit:function(e){if(o=!0,"refreshPrefs"!==e){s.addPreference({type:"list",name:"collab-storage",label:"3DEXPERIENCE Platform",options:[{label:"Loading",value:""}],onchange:"onStorageChange"}),s.dispatchEvent("onEdit",["refreshPrefs"]),l().then(h).catch((function(e){r.error(e)}))}},endEdit:function(e){o=!1},onViewChange:function(e){d(e)}}),u().then(h).then((function(e){r.refresh({platform:e})})).catch((function(e){r.error(a.fetchError)}))}))}}})),define("DS/W3DDriveManagement/Utils/Helpers",["i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],(function(e){"use strict";return{computeNLSSize:function(t){let n,i;t=Number(t);if(isNaN(t))throw new Error("Size input is not a number");if(t<0)throw new Error("Size input is negative");if(0===t)n=0,i=0;else{if(i=Math.floor(Math.log(t)/Math.log(1024)),i>5)throw new Error("Size input is too big");const e=t/Math.pow(2,10*i),a=Math.pow(10,i>0?2:0);n=Math.round(e*a)/a,1024===n&&i<8&&(n=1,i++)}return e.replace(e[["sizeB","sizeKB","sizeMB","sizeGB","sizeTB","sizePB"][i]],{size:n})}}})),define("DS/W3DDriveManagement/Models/ActiveExtDrive",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],(function(e,t){"use strict";return e.extend({defaults:{},idAttribute:"externaldrives",url:function(){return t.getPlatform().url+"/resources/3ddrive/v1/admin/config?tenant="+t.getPlatform().tenant},fetch:function(e){var n=Object.assign({ajax:t.authenticatedRequest},e);return this._parent(n)},parse:function(e){return e}})})),define("DS/W3DDriveManagement/Models/Quota",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],(function(e,t){"use strict";return e.extend({defaults:{defaultquota:0,quota:0},idAttribute:"defaultquota",url:function(){return t.getPlatform().url+"/resources/3ddrive/v1/admin/quota?tenant="+t.getPlatform().tenant},fetch:function(e){var n=Object.assign({ajax:t.authenticatedRequest},e);return this._parent(n)},parse:function(e){return e.defaultquota=parseInt(e.defaultquota),e}})})),define("DS/W3DDriveManagement/Models/IterationsNumber",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],(function(e,t){"use strict";return e.extend({defaults:{iterationsnumber:0},idAttribute:"iterationsnumber",url:function(){return t.getPlatform().url+"/resources/3ddrive/v1/admin/iterationsnumber?tenant="+t.getPlatform().tenant},fetch:function(e){var n=Object.assign({ajax:t.authenticatedRequest},e);return this._parent(n)},parse:function(e){return e}})})),define("DS/W3DDriveManagement/Models/IterationsDays",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],(function(e,t){"use strict";return e.extend({defaults:{iterationsdays:0},idAttribute:"iterationsdays",url:function(){return t.getPlatform().url+"/resources/3ddrive/v1/admin/iterationsdays?tenant="+t.getPlatform().tenant},fetch:function(e){var n=Object.assign({ajax:t.authenticatedRequest},e);return this._parent(n)},parse:function(e){return e}})})),define("DS/W3DDriveManagement/Models/AccessCapacity",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],(function(e,t){return e.extend({defaults:{quota:0,total:0},url:function(){return t.getPlatform().url+"/resources/share/admin/accesscapacity"},sync:function(e,n,i){var a=Object.assign({ajax:t.authenticatedRequest},i);return this._parent(e,n,a)},parse:function(e){return e}})})),define("DS/W3DDriveManagement/Models/SharedLink",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],(function(e,t){"use strict";return e.extend({default:{expirationDate:"",id:"",modificationDate:"",platform:{},restricted:!1,restrictions:[],service:"",sharedObjectName:"",sharer:"",sharerFullName:"",tenant:"",url:""},idAttribute:"id",url:function(){return t.getPlatform().url+"/resources/share/admin/accesses/"+this.get("id")},setup:function(e){var t=this.collection;return t&&(this.platform=t.platform),this._parent(e)},parse:function(e){return{expirationDate:new Date(e.expiration).toLocaleString(),id:e.objectid,modificationDate:new Date(e.modified).toLocaleString(),restricted:e.restricted,restrictions:e.restrictions,service:e.service,sharedObjectName:e.objectName,sharer:e.sharer,sharerFullName:e.sharerFullName,tenant:e.tenant,url:e.url}},destroy:function(e){var n=Object.assign({method:"DELETE",ajax:t.authenticatedRequest},e);return this._parent(n)}})})),define("DS/W3DDriveManagement/Models/ShareAccess",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],(function(e,t){"use strict";return e.extend({defaults:{sharebylink:!1},idAttribute:"sharebylink",url:function(){return t.getPlatform().url+"/resources/3ddrive/v1/admin/sharebylink?tenant="+t.getPlatform().tenant},parse:function(e){if(e)return{sharebylink:"true"===e.sharebylink}},sync:function(e,t,n){return"update"===e&&(n.data=JSON.stringify({sharebylink:t.get("sharebylink")?"true":"false"}),n.headers={"Content-Type":"application/json"}),this._parent(e,t,n)},fetch:function(e){var n=Object.assign({ajax:t.authenticatedRequest},e);return this._parent(n)}})})),define("DS/W3DDriveManagement/view/DriveInformationLayout",["UWA/Core","UWA/Class/View","DS/UIKIT/Tooltip","DS/Handlebars/Handlebars","text!DS/W3DDriveManagement/template/DriveInformationLayout.html","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],(function(e,t,n,i,a,s,r){"use strict";return t.extend({domEvents:{"click .fonticon-pencil.rename-drive":"_renameDrive","click .btn-rename-drive .btn-primary":"_performRenameDrive","click .btn-rename-drive .btn-default":"_cancelRenameDrive","click .fonticon-pencil.edit-quota":"_editQuota","click .btn-edit-quota .btn-primary":"_performEditQuota","click .btn-edit-quota .btn-default":"_cancelEditQuota","keyup #drive-rename input":"_onKeyUpRenameDrive","keyup .quota-input":"_onQuotaEdit","mouseup .quota-input":"_onQuotaEdit"},setup:function(e){this.template=i.compile(a),this.alert=e.alert,this.drive=e.drive,this.listenTo(this.drive,"onAnyEvent",this.render)},render:function(){var e=this.drive.toJSON();e&&(e.ownerstatus=r[e.ownerstatus]),this.container.innerHTML=this.template({drive:e,NLS:r});var t=this.container.querySelector(".information-table .fonticon.fonticon-pencil");new n({position:"right",target:t,body:r.rename})},_renameDrive:function(){var e=this.container.querySelector("#drive-rename");e.style.display="table-row",this.container.querySelector("#drive-title").style.display="none",e.querySelector("input").focus()},_editQuota:function(){var e=this.container.querySelector("#quota-edit");this.container.querySelector("#drive-quota").style.display="none",e.style.display="table-row",e.querySelector("input").focus()},_performRenameDrive:function(){var e=this,t=this.container.querySelector("#drive-rename input").value;t!==this.drive.get("title")&&e.drive.save({title:t},{ajax:s.authenticatedRequest,onComplete:function(){e.alert.add({message:r.saveSuccess,className:"success"}),e._cancelRenameDrive()},onFailure:function(){e.alert.add({message:r.saveError,className:"error"})},wait:!0})},_performEditQuota:function(){var e=this,t=parseInt(this.container.querySelector("#quota-edit input").value);t!==this.drive.get("quota")&&e.drive.save({quota:t},{ajax:s.authenticatedRequest,onComplete:function(){e.alert.add({message:r.saveSuccess,className:"success"}),e._cancelEditQuota()},onFailure:function(){e.alert.add({message:r.saveError,className:"error"})},wait:!0})},_cancelEditQuota:function(){this.container.querySelector("#quota-edit").style.display="none",this.container.querySelector("#drive-quota").style.display=""},_onKeyUpRenameDrive:function(){this.container.querySelector("#drive-rename input").value!==this.drive.get("title")?(this._enableRenameDriveButtons(),"Enter"!==event.key||this._performRenameDrive()):this._disableRenameDriveButton()},_onQuotaEdit:function(){var e=this.container.querySelector(".quota-input");parseInt(e.value)!==this.drive.get("quota")?"Enter"!==event.key?this._checkQuotaInput():this._performEditQuota():this._disableEditQuotaButtons()},_checkQuotaInput:function(){var e=this.container.querySelector(".quota-input");if(e.checkValidity())return this._enableEditQuotaButtons(),this.container.querySelector(".quota-error-message").style.display="none",void(e.style.border="");this._disableEditQuotaButtons(),e.style.border="1px solid red",this.container.querySelector(".quota-error-message").style.display="block"},_cancelRenameDrive:function(){this.container.querySelector("#drive-rename").style.display="none",this.container.querySelector("#drive-title").style.display=""},_disableRenameDriveButtons:function(){this.container.querySelector(".btn-rename-drive > .btn-primary").disabled=!0,this.container.querySelector(".btn-rename-drive > .btn-default").disabled=!0},_enableRenameDriveButtons:function(){this.container.querySelector(".btn-rename-drive > .btn-primary").disabled=!1,this.container.querySelector(".btn-rename-drive > .btn-default").disabled=!1},_disableEditQuotaButtons:function(){this.container.querySelector(".btn-edit-quota > .btn-primary").disabled=!0,this.container.querySelector(".btn-edit-quota > .btn-default").disabled=!1},_enableEditQuotaButtons:function(){this.container.querySelector(".btn-edit-quota > .btn-primary").disabled=!1,this.container.querySelector(".btn-edit-quota > .btn-default").disabled=!1},_enableRenameDriveButton:function(){this.container.querySelector(".btn-rename-drive > .btn-primary").disabled=!1},_disableRenameDriveButton:function(){this.container.querySelector(".btn-rename-drive > .btn-primary").disabled=!0}})})),define("DS/W3DDriveManagement/Collections/SharedLinks",["UWA/Class/Collection","DS/W3DDriveManagement/Models/SharedLink","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],(function(e,t,n){"use strict";return e.extend({model:t,default:{last:!1,first:!0},url:function(e){var t=e||{},i="limit=",a="&page=";return n.getPlatform().url+"/resources/share/admin/accesses?"+(i+=t.limit?t.limit:51)+(a+=t.page?t.page:0)},fetch:function(e){var t=Object.assign({ajax:n.authenticatedRequest,url:this.url(e)},e);return this._parent(t)},parse:function(e){return Object.assign(this,{last:e.last,first:e.first}),e.content}})})),define("DS/W3DDriveManagement/Models/Block",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],(function(e,t){"use strict";return e.extend({defaults:{blockactions:!1},idAttribute:"blockactions",url:function(){return t.getPlatform().url+"/resources/3ddrive/v1/admin/block?tenant="+t.getPlatform().tenant},fetch:function(e){var n=Object.assign({ajax:t.authenticatedRequest},e);return this._parent(n)},parse:function(e){return e}})})),define("DS/W3DDriveManagement/Models/Drive",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","DS/W3DDriveManagement/Utils/Helpers"],(function(e,t,n){"use strict";return e.extend({defaults:{physicalid:"",email:"",fullnameowner:"",fname:"",lname:"",title:"",status:"",ownerstatus:"",usage:"",actions:[]},idAttribute:"physicalid",url:function(e){var n=this.get("physicalid")?this.get("physicalid"):e.driveid;return t.getPlatform().url+"/resources/3ddrive/v1/admin/drives/"+n+"?withactions=true&tenant="+t.getPlatform().tenant},fetch:function(e){var n=Object.assign({ajax:t.authenticatedRequest,url:this.url(e)},e);return this._parent(n)},parse:function(e,t){var i,a,s=parseInt(e.quota);return-1===s&&t.quota?(i=t.quota.get("defaultquota"),i/=1e3):i=s,a=e.usage<0?"-":Math.round(e.usage/(1073741824*i)*100),{physicalid:e.physicalid,email:e.email,fullnameowner:e.fullnameowner,fname:e.fname,lname:e.lname,title:e.title,status:e.status,ownerstatus:e.ownerstatus,usage:e.usage,usageNLS:e.usage<0?"-":n.computeNLSSize(e.usage),ratio:a,actions:e.actions,quota:i}},destroy:function(e){var n=Object.assign({method:"DELETE",ajax:t.authenticatedRequest},e);return this._parent(n)}})})),define("DS/W3DDriveManagement/view/W3DDriveManagementSettings",["UWA/Core","UWA/Class/View","UWA/Class/Promise","DS/WAFData/WAFData","DS/Handlebars/Handlebars","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/UIKIT/Tooltip","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","DS/W3DDriveManagement/Models/AccessCapacity","DS/W3DDriveManagement/Models/Block","text!DS/W3DDriveManagement/template/W3DDriveManagementSettings.html","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],(function(e,t,n,i,a,s,r,o,c,l,u,h,d,m){"use strict";var v=t.extend({domEvents:{"change .blockactions .toggle-switch":"_onChangeSettings","keyup .quota-input":"_onChangeSettings","keyup .iterations-number input":"_onChangeSettings","keyup .iterations-days input":"_onChangeSettings","change .external-drive-container.settings-section .toggle-switch":"_onChangeSettings","click .button-container .save-button":"_saveConfigurations","click .button-container .cancel-button":"_cancelConfigurations"},setup:function(e){var t=this;e&&(this.alert=e.alert),this.template=a.compile(d),"ifCond"in a.helpers||a.registerHelper("ifCond",(function(e,t,n,i){switch(t){case"==":return e==n?i.fn(this):i.inverse(this);case"===":return e===n?i.fn(this):i.inverse(this);case"!=":return e!=n?i.fn(this):i.inverse(this);case"!==":return e!==n?i.fn(this):i.inverse(this);case"<":return e<n?i.fn(this):i.inverse(this);case"<=":return e<=n?i.fn(this):i.inverse(this);case">":return e>n?i.fn(this):i.inverse(this);case">=":return e>=n?i.fn(this):i.inverse(this);case"&&":return e&&n?i.fn(this):i.inverse(this);case"||":return e||n?i.fn(this):i.inverse(this);default:return i.inverse(this)}}));var n=window.parent.location.search;"false"===new URLSearchParams(n).get("blockactions")&&(this.hideBlockactions=!0),this.block=new h,this.driveProviders=this.options.driveProviders,this.providers=[],this.activeExtDrive=this.options.drivesConfigurationModel,this.activeDrives=[],this.listenTo(this.activeExtDrive,"onSync",this._updateConfiguations),this.accessCapacity=new u,this._fetchDriveProviders().finally((function(){t.render()}))},refresh:function(){var e=this,t=this.container.children[0];return r.mask(t),this._fetchConfiguration().then((()=>r.unmask(t))).catch((()=>e.alert.add({message:m.fetchError,className:"error"})))},render:function(e){this.buildView(e);const t=this.container.children[0];return r.mask(t),new c({target:this.container.querySelector(".blockactions .fonticon-info"),body:'<span style="display:block;text-align:left">'+m.restrictedActions+'</span><span style="display:block;font-weight:bold">'+m.restrictedActionsList+"</span>",position:"bottom",trigger:"touch",autoHide:!1}),this._fetchConfiguration().then((()=>{r.unmask(t)})).catch((()=>{this.alert.add({message:m.fetchError,className:"error"})}))},buildView:function(){this.container.innerHTML="",this.container.innerHTML=this.template({driveProviders:this.providers,providersLength:this.providers.length,NLS:m}),this._buildView(),this._addScroller()},_addScroller:function(){var e=this.container,t=this.getElement(".drive__management__settings__content");new o({element:t}).inject(e)},_buildView:function(){let e=this.container.querySelector.bind(this.container);this.elements.quota={input:e(".quota-input")},this.elements.iterationsNumber={input:e(".iterations-number input")},this.elements.iterationsDays={input:e(".iterations-days input")},this.elements.footerButtons={buttonCancel:e(".button-container .cancel-button"),buttonValidation:e(".button-container .save-button")},this.elements.blockactions={input:e(".toggle-switch.blockactions__toggle input")}},_enableButtonValidation:function(){this.elements.footerButtons.buttonValidation.disabled=!1},_disableButtonValidation:function(){this.elements.footerButtons.buttonValidation.disabled=!0},_enableButtonCancel:function(){this.elements.footerButtons.buttonCancel.disabled=!1},_disableButtonCancel:function(){this.elements.footerButtons.buttonCancel.disabled=!0},_onChangeSettings:function(e){this.currentActiveDrives=this.providers.filter((e=>this.container.querySelector(`.external-drive-container.settings-section .toggle-switch #${e.driveId}`).checked)).map((e=>e.driveId));const t=Number(this.elements.quota.input.value)!==Number(this.activeExtDrive.get("defaultquota"))/1e3,n=this.elements.iterationsNumber.input.value!==this.activeExtDrive.get("iterationsnumber"),i=this.elements.iterationsDays.input.value!==this.activeExtDrive.get("iterationsdays"),a=this.elements.quota.input.checkValidity(),s=this.elements.iterationsNumber.input.checkValidity(),r=this.elements.iterationsDays.input.checkValidity(),o=0===this.activeDrives.length&&0===this.currentActiveDrives.length||!this.activeDrives.every((e=>this.currentActiveDrives.includes(e)))||this.currentActiveDrives.length!==this.activeDrives.length,c=String(this.elements.blockactions.input.checked)!==this.activeExtDrive.get("blockactions");(t||n||i||o||c)&&a&&s&&r?e&&"Enter"===e.key?this._saveConfigurations():(this._enableButtonValidation(),this._enableButtonCancel()):(this._disableButtonValidation(),this._enableButtonCancel())},_updateConfiguations:function(){this.elements.quota.input.value=this.activeExtDrive.get("defaultquota")/1e3,this.elements.iterationsDays.input.value=this.activeExtDrive.get("iterationsdays"),this.elements.iterationsNumber.input.value=this.activeExtDrive.get("iterationsnumber"),this._updateActiveDrives(),this.hideBlockactions||this._updateToggleBlockActions(),this._disableButtonCancel(),this._disableButtonValidation()},_saveConfigurations:function(){let e=this,t=this.elements.quota.input,n=this.elements.iterationsNumber.input,i=this.elements.iterationsDays.input,a=this.elements.blockactions.input,s=this.activeExtDrive.get("defaultquota")/1e3,r=this.activeExtDrive.get("iterationsnumber"),o=this.activeExtDrive.get("iterationsdays"),c=this.activeExtDrive.get("blockactions");!1!==t.checkValidity()?!1!==n.checkValidity()&&!1!==i.checkValidity()?(this._disableButtonValidation(),this._disableButtonCancel(),this.activeExtDrive.save({defaultquota:String(1e3*t.value),iterationsnumber:n.value,iterationsdays:i.value,externaldrives:String(e.currentActiveDrives.length?e.currentActiveDrives.join():""),blockactions:String(e.hideBlockactions?c:a.checked)},{ajax:l.authenticatedRequest,onComplete:function(){e.alert.add({message:m.saveSuccess,className:"success"})},onFailure:function(){e.alert.add({message:m.saveError,className:"error"}),t.value=s,n.value=r,i.value=o},wait:!0})):this.alert.add({message:m.iterationsWrongValue,className:"error"}):this.alert.add({message:m.quotaWrongValue,className:"error"})},_cancelConfigurations:function(){this._disableButtonCancel(),this._disableButtonValidation(),this._updateConfiguations()},_unitRound:function(e){return e<5?5:10},_roundFunc:function(e){if("number"!=typeof e||isNaN(e))return NaN;if(e%5==0||e%10==0)return e;if(e<10)return this._unitRound(e);var t=String(e)[0],n=String(e)[1],i=this._unitRound(Number(n));return 10===i?10*Number(t)+10:Number(t+i)},_updateToggleBlockActions:function(){var e=this.container.querySelector(".blockactions #checkbox-limitActions"),t=this.container.querySelector(".blockActions__label");e&&t&&("true"!==this.activeExtDrive.get("blockactions")?e.checked=!1:e.checked=!0)},_updateActiveDrives:function(){if(!this.container.querySelector(".external-drive-container.settings-section .toggle-switch"))return;const e=this.container.querySelectorAll('.external-drive-container.settings-section .toggle-switch input[type="checkbox"]');let t=this.activeExtDrive.get("externaldrives");t.length>0&&(this.activeDrives=t.split(","),e.forEach((e=>{const t=e.id,n=this.activeDrives.includes(t);e.checked=n})))},_fetchDriveProviders:function(){var e=this;return new n((function(t,n){e.driveProviders.fetch({onComplete:function(n,i){e.providers=i.filter((function(e){return"3ddrive"!==e.driveId})),t()},onFailure:function(){n(arguments)}})}))},_fetchConfiguration:function(){var e=this;return new n((function(t,n){e.activeExtDrive.fetch({onComplete:function(e,n){t(n)},onFailure:function(){n(arguments[1])}})}))},mathTrunc:function(e){return Math.trunc?Math.trunc(e):function(e){return isNaN(e)?NaN:e>0?Math.floor(e):Math.ceil(e)}(e)}});return v})),define("DS/W3DDriveManagement/Collections/Drives",["UWA/Class/Collection","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","DS/W3DDriveManagement/Models/Drive"],(function(e,t,n){"use strict";return e.extend({model:n,date:"",total:0,url:function(){return t.getPlatform().url+"/resources/3ddrive/v1/admin/drives?tenant="+t.getPlatform().tenant+"&"+(new Date).getTime()},fetch:function(e){var n=Object.assign({ajax:t.authenticatedRequest},e);return this._parent(n)},parse:function(e){return this.total=e.total,e.items}})})),define("DS/W3DDriveManagement/view/W3DDriveManagementShare",["UWA/Core","UWA/Class/View","UWA/Class/Promise","DS/WAFData/WAFData","DS/Handlebars/Handlebars","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","DS/W3DDriveManagement/view/ShareTableLayout","DS/W3DDriveManagement/Models/AccessCapacity","text!DS/W3DDriveManagement/template/W3DDriveManagementShare.html","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],(function(e,t,n,i,a,s,r,o,c,l,u,h){"use strict";var d=t.extend({domEvents:{"change .shareaccess .toggle-switch":"_onChangeShareByLinkValue","change .commentsaccess .toggle-switch":"_onChangeCommentAccess"},setup:function(e){e&&(this.alert=e.alert),this.template=a.compile(u),this.sharedLinks=this.options.sharedLinks,this.shareAccess=this.options.shareAccess,this.listenTo(this.shareAccess,"onChange",this._updateShareUsage),this.listenTo(this.shareAccess,"onChange",this._updateGuestComments),this.listenTo(this.shareAccess,"onSync",this._updateToggleShareByLink),this.accessCapacity=new l,this.activeExtDrive=this.options.drivesConfigurationModel},refresh:function(){var e=this;return this._updateAccessCapacity(),this._fetchCommentsAccess(),n.all([this._fetchShareByLinkActivated().then((function(){!0===e.shareAccess.get("sharebylink")&&e.shareTableLayout&&e.shareTableLayout.refresh()}))]).catch((function(){e.alert.add({message:h.fetchError,className:"error"})}))},render:function(e){var t=this;this.buildView(e);var i=this.container.children[0];s.mask(i);var a=[this._fetchShareByLinkActivated()];return n.all(a).catch((function(){t.alert.add({message:h.fetchError,className:"error"})})).finally((function(){s.unmask(i)}))},buildView:function(){this.container.innerHTML="",this.container.innerHTML=this.template({NLS:h}),this._updateShareUsage(),this._updateGuestComments(),this._fetchCommentsAccess(),this._addScroller()},_addScroller:function(){var e=this.container,t=this.getElement(".share_link_content");new r({element:t}).inject(e)},_fetchShareByLinkActivated:function(){var e=this;return new n((function(t,n){e.shareAccess.fetch({onComplete:function(e,n){t(n)},onFailure:function(){n(arguments)}})}))},_onChangeShareByLinkValue:function(e){var t=this,n=e.target.checked,i=!n;this.shareAccess.save({sharebylink:n},{ajax:o.authenticatedRequest,onComplete:function(){var e="";e=n?h.shareByLinkActivationSuccess:h.shareByLinkDeactivationSuccess,t.alert.add({message:e,className:"success"})},onFailure:function(){var a="";(e.srcElement||e.target).checked=i,a=n?h.shareByLinkActivationError:h.shareByLinkDeactivationError,t.alert.add({message:a,className:"error"})},wait:!0})},_updateShareUsage:function(){const e=this.container.querySelector(".share-usage-container");e&&(this.shareAccess.get("sharebylink")?(e.classList.remove("share-usage-container--hidden"),this._updateSharedLinksTable(),this._updateAccessCapacity()):e.classList.add("share-usage-container--hidden"))},_updateSharedLinksTable:function(){this.container.querySelector(".drive__share__table")&&(this.shareTableLayout||(this.shareTableLayout=new c({container:this.container.getElement(".drive__sharetable"),collection:this.sharedLinks,platform:o.getPlatform(),alert:this.alert})),this.shareTableLayout.refresh())},_unitRound:function(e){return e<5?5:10},_roundFunc:function(e){if("number"!=typeof e||isNaN(e))return NaN;if(e%5==0||e%10==0)return e;if(e<10)return this._unitRound(e);var t=String(e)[0],n=String(e)[1],i=this._unitRound(Number(n));return 10===i?10*Number(t)+10:Number(t+i)},_updateAccessCapacity:function(){var e=this;this.elements.accessCapacitySection=this.container.querySelector(".accesscapacity"),this.elements.accessCapacityProgress=this.container.querySelector(".accesscapacity__progress"),this.elements.accessCapacityProgressValue=this.container.querySelector(".accesscapacity__progress .progress-bar"),this.elements.accessCapacityUsed=this.container.querySelector(".accesscapacity__used"),this.elements.accessCapacityTotal=this.container.querySelector(".accesscapacity__total"),this.elements.accessCapacitySection&&this.accessCapacity.fetch({onComplete:function(t){var n=t.get("quota"),i=t.get("total"),a=e.mathTrunc(100*n/i);e.elements.accessCapacityUsed.innerText=h.replace(h.usedCapacity,{used:e.mathTrunc(n)}),e.elements.accessCapacityTotal.innerText=h.replace(h.totalCapacity,{total:i}),e.elements.accessCapacityProgress.classList.remove("w-0-percent"),e.elements.accessCapacityProgress.classList.add("w-"+e._roundFunc(a)+"-percent"),e.elements.accessCapacityProgressValue.innerText=a+"%"},onFailure:function(){e.elements.accessCapacityProgress.classList.add("w-0-percent")}})},_updateToggleShareByLink:function(){var e=this.container.querySelector(".shareaccess #checkbox-sharebylink"),t=this.container.querySelector(".shareaccess__label");e&&t&&(this.shareAccess.get("sharebylink")?e.checked=!0:e.checked=!1)},_updateGuestComments:function(){var e=this.container.querySelector(".commentsaccess");e&&(this.shareAccess.get("sharebylink")?(e.classList.remove("commentsaccess--hidden"),this._fetchCommentsAccess()):e.classList.add("commentsaccess--hidden"))},_fetchCommentsAccess:function(){var e=this;return new n((function(t,n){e.activeExtDrive.fetch({onComplete:function(n,i){var a="true"===i.guestcomments;e.container.querySelector(".commentsaccess .toggle-switch #checkbox-guestcomment").checked=a,t(i)},onFailure:function(){n(arguments[1])}})}))},_onChangeCommentAccess:function(e){var t=this,n=e.target.checked;this.activeExtDrive.save({guestcomments:n.toString()},{ajax:o.authenticatedRequest,onComplete:function(){var e="";e=n?h.commentActivationSuccess:h.commentDeactivationSuccess,t.container.querySelector(".commentsaccess .toggle-switch #checkbox-guestcomment").checked=n,t.alert.add({message:e,className:"success"})},onFailure:function(i,a){var s="";(e.srcElement||e.target).checked=!n,s=n?h.commentActivationError:h.commentDeactivationError,t.alert.add({message:s,className:"error"})},wait:!0})},mathTrunc:function(e){return Math.trunc?Math.trunc(e):function(e){return isNaN(e)?NaN:e>0?Math.floor(e):Math.ceil(e)}(e)}});return d})),define("DS/W3DDriveManagement/Models/DrivesConfiguration",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],(function(e,t){"use strict";return e.extend({defaults:{},idAttribute:"externaldrives",url:function(){return t.getPlatform().url+"/resources/3ddrive/v1/admin/config?tenant="+t.getPlatform().tenant},fetch:function(e){var n=Object.assign({ajax:t.authenticatedRequest},e);return this._parent(n)},parse:function(e){return e}})})),define("DS/W3DDriveManagement/Models/Access",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],(function(e,t){"use strict";return e.extend({default:{id:"",login:"",name:"",fname:"",lname:"",email:"",accessright:"",actions:[]},idAttribute:"id",url:function(e){var n=e||{},i=t.getPlatform().url+"/resources/3ddrive/v1/admin/drives/"+n.driveid+"/shares";"delete"===n.action&&(i+="/"+n.userid);return i+"?withactions=true"},parse:function(e){var n,i=(n=e.id,t.getPlatform().urlSwym+"/api/user/getpicture/login/"+n+"/format/normal");return Object.assign(e,{picture:i})},save:function(e,n){var i=Object.assign({ajax:t.authenticatedRequest,url:this.url(Object.assign(n,{userid:this.get("userid")})),headers:{"Content-Type":"application/json"},method:"POST"},n);i.data=JSON.stringify(n.data),this._parent(this,i)},destroy:function(e){var n=Object.assign({method:"DELETE",ajax:t.authenticatedRequest,url:this.url(Object.assign(e,{action:"delete"}))},e);return this._parent(n)}})})),define("DS/W3DDriveManagement/Models/DriveProvider",["UWA/Class/Model","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","DS/W3DDriveManagement/Utils/Helpers"],(function(e,t,n){"use strict";return e.extend({defaults:{driveName:"",driveId:"",driveIcon:""},url:function(e){},fetch:function(e){var n=Object.assign({ajax:t.authenticatedRequest,url:this.url(e)},e);return this._parent(n)},parse:function(e,t){return{driveName:e.driveName,driveId:e.driveId,driveIcon:e.driveIcon}},destroy:function(e){var n=Object.assign({method:"DELETE",ajax:t.authenticatedRequest},e);return this._parent(n)}})})),define("DS/W3DDriveManagement/Collections/Accesses",["UWA/String","UWA/Class/Collection","DS/W3DDriveManagement/Models/Access","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt"],(function(e,t,n,i){"use strict";return t.extend({model:n,url:function(t){var n=t||{};return e.format("{0}/resources/3ddrive/v1/admin/drives/{1}/shares?withactions=true&tenant={2}",i.getPlatform().url,n.driveid,i.getPlatform().tenant)},fetch:function(e){var t=Object.assign({ajax:i.authenticatedRequest,url:this.url(e)},e);return this._parent(t)},parse:function(e){return e.items},create:function(e,t){var n=Object.assign({data:e},t);return this._parent(this,n)}})})),define("DS/W3DDriveManagement/Collections/DriveProviders",["UWA/Class/Collection","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","DS/W3DDriveManagement/Models/DriveProvider"],(function(e,t,n){"use strict";return e.extend({model:n,date:"",total:0,url:function(){return t.getPlatform().urlDriveshub+"/drive/v1/providers?tenant="+t.getPlatform().tenant+"&expand=true"},fetch:function(e){var n=Object.assign({ajax:t.authenticatedRequest},e);return this._parent(n)},parse:function(e){return e}})})),define("DS/W3DDriveManagement/view/DriveAccessLayout",["UWA/Core","UWA/String","UWA/Class/View","DS/UIKIT/Scroller","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/Handlebars/Handlebars","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","DS/WAFData/WAFData","DS/W3DXComponents/Views/Item/PanelAddMemberView","DS/W3DDriveManagement/Collections/Accesses","text!DS/W3DDriveManagement/template/DriveAccessLayout.html","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],(function(e,t,n,i,a,s,r,o,c,l,u,h,d,m){"use strict";var v=n.extend({domEvents:{"click .fonticon-user-add":"_addAccess","click .paneladdmember-item-view-buttons .btn-default":"_cancelShare","click .fonticon-open-down":"_manageOptions"},setup:function(e){this.template=r.compile(h),this.alert=e.alert,this.drive=e.drive,this.accesses=new u,this.listenTo(this.accesses,"onAnyEvent",this.render),this._fetchAccesses(),this.tenant=o.getPlatform().tenant},render:function(){var e=this,t=e.drive.toJSON();e.currentCollection=e.accesses;var n=e.accesses.length>0;n&&(e.currentCollection=e.currentCollection.toJSON(),e.currentCollection.forEach((function(e){e.accessright=m[e.accessright]}))),this.container.innerHTML=e.template({drive:t,hasAccesses:n,accesses:e.currentCollection,NLS:m});var a=this.container.querySelector(".access-view > .fonticon.fonticon-user-add");new s({position:"right",target:a,body:m.share}),this._addPanelMemberView();var r=this.getElement(".access-scroller-view"),o=this.getElement(".members-list");new i({element:o}).inject(r)},_fetchAccesses:function(){var e=this;return new Promise((function(t,n){e.accesses.fetch({driveid:e.drive.get("physicalid"),onComplete:function(e,n){t(n)},onFailure:function(){n(arguments)}})}))},_get3DSearchURL:function(){var e=this;return new Promise((function(t,n){d.getPlatformServices({onComplete:function(i){var a=i.filter((function(t){return t.platformId===e.tenant}));0!=a.length?t(a.map((function(e){return e["3DSearch"]}))):n("3DSearch url not found")},onFailure:n})}))},_addPanelMemberView:function(){var e,n,i=this,a={categories:[{id:"giveEditAccess",name:m.edit_share}],suggestFormat:"{label}",suggestKey:"resourceid",labelFormat:"{label}",placeholder:m.get("enterName"),typeDelay:500,minLength:2,getSuggestions:function(t,n,i){if(e=function(){Object.keys(n).map((function(e){delete n[e]}))},!t)return;if(n[t])return i(n[t]);s(t).then(i,(function(){}))},saveProcess:function(e){"My Files"===i.drive.get("title")&&i.drive.save({title:i.drive.get("fullnameowner")+"'s files"},{ajax:o.authenticatedRequest,onComplete:function(){},onFailure:function(){i.alert.add({message:m.saveError,className:"error"})},wait:!0});return e.map((function(e){let t=e.item.resourceUid;t.startsWith("iam:")&&(t=t.replace(/^iam:/,"")),i.accesses.create({id:e.item.resourceid,type:"Person",accessright:"edit_share",message:"",uid:t},{driveid:i.drive.get("physicalid"),ajax:o.authenticatedRequest,onComplete:function(){i.alert.add({message:m.replace(m.shareSuccess,{drive:i.drive.get("title")}),className:"success"})},onFailure:function(){i.alert.add({message:m.replace(m.shareError,{drive:i.drive.get("title")}),className:"error"})},wait:!0})}))}},s=function(e){return n&&(n.cancel(),n=null),i._get3DSearchURL().then((function(n){return new Promise((function(a,s){var r=t.format("{0}/search",n),o=Date.now(),l=JSON.stringify({query:'[ds6w:type]:"pno:Person" AND personOrGroup:('+e.trim()+") AND ut_state:1",source:["swym"],order_by:"desc",order_field:"relevance",select_predicate:["ds6w:label","resourceid","ds6w:resourceUid"],nresults:8,tenant:i.tenant,label:"DrivesControlCenter-"+o,with_synthesis:!1,with_synthesis_attribute:!1});c.authenticatedRequest(r,{method:"POST",type:"json",headers:{Accept:"application/json","Content-Type":"application/json"},data:l,onComplete:function(e){var t=[];e.hasOwnProperty("results")&&(t=e.results.filter((function(e){return e.hasOwnProperty("attributes")})).map((function(e){return e.attributes.filter((function(e){return e.hasOwnProperty("format")&&e.hasOwnProperty("name")&&e.hasOwnProperty("value")})).map((function(e){return-1!==e.name.indexOf("ds6w:")&&(e.name=e.name.split("ds6w:")[e.name.split("ds6w:").length-1]),"resourceid"===e.name&&(e.value=e.value.split("iam:")[e.value.split("iam:").length-1]),e})).filter((function(e){return"resourceid"===e.name||"label"===e.name||"resourceUid"===e.name})).reduce((function(e,t){return e[t.name]=t.value,e}),{})})).filter((function(e){return e.resourceid!==i.drive.get("fullnameowner")}))),a(t)},onFailure:s})}))}))},r=new l(Object.assign(a,{})),u=r.container.querySelector("button.btn-primary"),h=r.container.querySelector("button.btn-default");u.textContent=m.share,h.textContent=m.cancel;var d=r.render.apply(r,arguments);return r.show(),i.container.getElement("#access-members").appendChild(r.container),r.destroy=function(){return"function"==typeof e&&e(),destroy.apply(this,arguments)},d},_addAccess:function(){this.container.querySelector(".paneladdmember-item-view-container").addClassName("expanded"),this.container.querySelector("#access-members").style.display="initial",this.container.querySelector(".access-scroller-view").addClassName("expanded"),this.container.querySelector(".paneladdmember-item-view-body input").focus()},_cancelShare:function(){this.container.querySelector("#access-members").style.display="none",this.container.querySelector(".access-scroller-view").removeClassName("expanded")},_manageOptions:function(e){var t=this,n=e.target,i=n.dataset.modelId,s=this.accesses.findWhere({id:i}),r=new a({target:n,renderTo:n.parentNode,position:"bottom right",items:[{text:m.remove,fonticon:"cancel",handler:function(){t._removeAccess(s)}}],events:{onHide:function(){r.destroy()}}}).show()},_removeAccess:function(e){var t=this;e.destroy({driveid:t.drive.get("physicalid"),userid:e.get("physicalid"),onComplete:function(){t.alert.add({message:m.replace(m.shareRemoveSuccess,{username:e.get("title")}),className:"success"})},onFailure:function(){t.alert.add({message:m.replace(m.shareRemoveError,{username:e.get("title")}),className:"error"})},wait:!0})}});return v})),define("DS/W3DDriveManagement/view/DriveManager",["UWA/Core","UWA/Class/View","DS/Handlebars/Handlebars","DS/UIKIT/SuperModal","DS/W3DDriveManagement/view/DriveInformationLayout","DS/W3DDriveManagement/view/DriveAccessLayout","text!DS/W3DDriveManagement/template/DriveManager.html","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],(function(e,t,n,i,a,s,r,o){"use strict";return t.extend({domEvents:{"click .information":"_renderInformationView","click .access":"_renderAccessView"},classes:{informationTab:"information",accessTab:"access",informationView:"drive-manager-information",accessView:"drive-manager-access",active:"active"},dotClasses:function(e){return"."+this.classes[e]},setup:function(e){this.template=n.compile(r),this.alert=e.alert,this.drive=e.drive,this.listenTo(this.drive,"onSync",this._renderInformationView)},render:function(){this.container.innerHTML=this.template({NLS:o}),new i({renderTo:document.body}).dialog({title:o.replace(o.manageDriveTitle,{username:this.drive.get("fullnameowner")}),body:this.container}),this._renderInformationView()},_renderInformationView:function(){this.informationView||(this.informationView=new a({alert:this.alert,container:this.container.getElement(this.dotClasses("informationView")),drive:this.drive}),this.informationView.render()),this.container.getElement(this.dotClasses("accessView")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("informationView")).addClassName(this.classes.active),this.container.getElement(this.dotClasses("accessTab")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("informationTab")).addClassName(this.classes.active)},_renderAccessView:function(){this.accessView||(this.accessView=new s({alert:this.alert,container:this.container.getElement(this.dotClasses("accessView")),drive:this.drive}),this.accessView.render()),this.container.getElement(this.dotClasses("informationView")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("accessView")).addClassName(this.classes.active),this.container.getElement(this.dotClasses("informationTab")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("accessTab")).addClassName(this.classes.active)}})})),define("DS/W3DDriveManagement/view/TableLayout",["UWA/Core","UWA/Class/View","DS/UIKIT/Scroller","DS/Handlebars/Handlebars","DS/UIKIT/SuperModal","DS/W3DDriveManagement/view/DriveManager","text!DS/W3DDriveManagement/template/TableLayout.html","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],(function(e,t,n,i,a,s,r,o){"use strict";return t.extend({searchString:"",domEvents:{"click .sortable.fonticon":"_sort","click .fonticon.action":"_manageOptions"},setup:function(e){var t=this;t.alert=e.alert,t.template=i.compile(r),t.quota=e.quota,"ifCond"in i.helpers||i.registerHelper("ifCond",(function(e,t,n,i){switch(t){case"==":return e==n?i.fn(this):i.inverse(this);case"===":return e===n?i.fn(this):i.inverse(this);case"!=":return e!=n?i.fn(this):i.inverse(this);case"!==":return e!==n?i.fn(this):i.inverse(this);case"<":return e<n?i.fn(this):i.inverse(this);case"<=":return e<=n?i.fn(this):i.inverse(this);case">":return e>n?i.fn(this):i.inverse(this);case">=":return e>=n?i.fn(this):i.inverse(this);case"&&":return e&&n?i.fn(this):i.inverse(this);case"||":return e||n?i.fn(this):i.inverse(this);default:return i.inverse(this)}}))},render:function(){this.currentModel=this.collection.toJSON(),this.container.innerHTML=this.template({users:this.currentModel,NLS:o});var e=this.options.pager;if(e){if(null==this.container.parentElement)return;var t=this.container.parentElement.querySelector(".pager");e.limit<e.length&&t.appendChild(e.elements.container)}var i=this.container,a=this.getElement(".table-layout");if(new n({element:a}).inject(i),this.options.activeSortClassname&&""!==this.options.activeSortClassname){var s=this.container.getElementsByClassName(this.options.activeSortClassname)[0];"up"===this.options.sortState?s.classList.add("active"):"down"===this.options.sortState&&(s.classList.add("fonticon-expand-down"),s.classList.remove("fonticon-expand-up"),s.classList.add("active"))}},_sort:function(e){var t,n,i=e.target.classList,a="sortable fonticon fonticon-clickable ";i.contains("fname")?t="fname":i.contains("lname")?t="lname":i.contains("ownerstatus")&&(t="ownerstatus"),a+=t,i.contains("fonticon-expand-down")&&(t="a"+t,n="up"),i.contains("fonticon-expand-up")&&(t="d"+t,n="down"),this.dispatchEvent("onSort",{sortAttribute:t,activeSortClassname:a,sortState:n})},_manageOptions:function(e){var t=e.target,n=t.dataset.modelId,i=this.collection.findWhere({physicalid:n});t.className.includes("fonticon-cog")&&this._manageDrive(i),t.className.includes("fonticon-trash")&&"active"!==i.get("ownerstatus")&&this._deleteDrive(i)},_manageDrive:function(e){this.listenTo(e,"onSync",this.render);e&&(this.driveManager=new s({drive:e,alert:this.alert}),this.driveManager.render())},_deleteDrive:function(e){var t=this;new a({className:"delete-drive",renderTo:document.body}).dialog({title:o.replace(o.deleteDriveTitle,{username:e.get("fullnameowner")}),body:o.deleteDriveMessage,buttons:[{className:"primary",value:o.deleteText,action:function(n){n.hide(),e.destroy({driveid:e.get("physicalid"),onComplete:function(){t.alert.add({message:o.replace(o.deleteDriveSuccess,{username:e.get("fullnameowner")}),className:"success"}),t.dispatchEvent("onDelete")},onFailure:function(){t.alert.add({message:o.replace(o.deleteDriveError,{username:e.get("fullnameowner")}),className:"error"})},wait:!0})}},{className:"default",value:o.cancel,action:function(e){e.hide()}}]})}})})),define("DS/W3DDriveManagement/view/W3DDriveManagementDrives",["UWA/Core","UWA/Class/View","DS/Handlebars/Handlebars","UWA/Controls/Pager","DS/UIKIT/Dropdown","DS/UIKIT/DropdownMenu","DS/UIKIT/Badge","DS/UIKIT/Mask","DS/W3DDriveManagement/view/TableLayout","DS/W3DDriveManagement/Collections/Drives","text!DS/W3DDriveManagement/template/W3DDriveManagementDrives.html","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement"],(function(e,t,n,i,a,s,r,o,c,l,u,h){"use strict";return t.extend({pager:{},pagination:!1,paginationSize:15,sortAttribute:"alname",searchAttribute:"fullnameowner",searchValue:"",filterAttribute:"ownerstatus",filterValue:"",clearBtnShown:!1,fetchOnOffsetChange:!0,activeSortClassname:"sortable fonticon fonticon-expand-up lname",sortState:"up",KEY_UP_THRESHOLD:400,domEvents:{"click   .clear-search-input":"_clearSearchInput","input  form.usage-form":"_search","submit form.usage-form":"_search","keyup .search-input":"_handleSearchInputKeyup","click .search-icon":"_searchBox"},setup:function(e){var t=this;this.alert=e.alert,this.quota=e.drivesConfigurationModel,t.template=n.compile(u),this.collection=new l,this.timer=null,this.pager=new i({limit:t.paginationSize,offset:0,type:1,showPageLinks:!0,events:{onOffsetChange:function(e){if(t.fetchOnOffsetChange){var n,i=e/t.pager.limit;n=t._handleRequestOptions({page:i}),t._fetchDrives(n).then((function(){t._handleSearchbarState()}))}}}}),this.pagination=!0,this.listenTo(this.collection,"onReset",this.render)},render:function(){var e=this,t=e.collection.length>0,n=e.collection.total;e.container.innerHTML=e.template({hasDrives:t,NLS:h}),""!=this.filterValue&&this._addBadge(this.filterValue),t?(e.pager.setLength(e.collection.total),e.pager.onRefresh(),this.tableLayout=new c({alert:e.alert,container:e.container.getElement(".drive__table"),collection:e.collection,pager:e.pager,quota:e.quota,activeSortClassname:e.activeSortClassname,sortState:e.sortState}),this.listenTo(this.tableLayout,"onSort",this._sort),this.listenTo(this.tableLayout,"onDelete",this.refresh),this.tableLayout.render()):""!==this.searchValue||""!==this.filterValue?this.container.querySelector(".no-drives").innerHTML=h.get("noResult"):n>0&&(this.container.querySelector(".no-drives").innerHTML=h.get("largeNumberOfDrives",{drives:n})),new s({target:e.container.getElement(".fonticon-filter"),closeOnClick:!0,items:[{text:h.get("active"),selectable:!0,selected:"active"===this.filterValue},{text:h.get("inactive"),selectable:!0,selected:"inactive"===this.filterValue}],events:{onClick:function(t,n){var i=n.text.toLowerCase();i&&(e._filter(i),e.render())}}})},refresh:function(){var e=this,t=this._handleRequestOptions({page:0});this._fetchDrives(t).then((function(){e._resetPagerOffset(),e._handleSearchbarState(),o.isMasked(e.container)&&o.unmask(e.container)}))},_searchBox:function(){this.container.getElement(".search-text-box").classList.remove("box-visiblity"),this.container.getElement(".search-input").focus()},_filter:function(e){this.fetchOnOffsetChange=!1,this.filterValue=e,o.mask(this.container),this.refresh()},_search:function(e){e.preventDefault();var t=this;clearTimeout(this.timer),this.timer=setTimeout((function(){t.fetchOnOffsetChange=!1;var e=t.container.getElement(".search-input").value;e.length>=2?(t.searchValue=e.trim(),o.mask(t.container),t.refresh()):0===e.length&&(t.searchValue="",o.mask(t.container),t.refresh())}),this.KEY_UP_THRESHOLD)},_sort:function(e){var t=this;t.fetchOnOffsetChange=!1,0===Object.keys(e).length?(t.sortAttribute="",t.activeSortClassname=""):(t.sortAttribute=e.sortAttribute,t.activeSortClassname=e.activeSortClassname,t.sortState=e.sortState),this.refresh()},_fetchDrives:function(e){var t=this;return new Promise((function(n,i){t.collection.fetch({reset:!0,data:e,quota:t.quota,onComplete:function(e,t,i){n()},onTimeout:function(){t.error(h.fetchTimeout),t.render()},onFailure:function(e,n,a){a.request&&a.request.xhr&&204===a.request.xhr.status?t.error(h.fetchEmpty):t.error(h.fetchError),i()}})}))},error:function(e){null!==this.alert&&this.alert.add({message:e,className:"error"})},_handleRequestOptions:function(e){return""!=this.filterValue&&""!=this.searchValue?(e.filteron=this.filterAttribute+","+this.searchAttribute,e.filter=this.filterValue+","+this.searchValue):(""!=this.filterValue&&(e.filteron=this.filterAttribute,e.filter=this.filterValue),""!=this.searchValue&&(e.filteron=this.searchAttribute,e.filter=this.searchValue)),""!=this.sortAttribute&&(e.sort=this.sortAttribute),this.pagination&&(e.limit=this.paginationSize),e},_handleSearchbarState:function(){""!==this.searchValue&&(this.container.getElement(".search-input").value=this.searchValue,this.clearBtnShown=!0,this.container.getElement(".clear-search-input").classList.remove("hidden"),this.container.getElement(".search-text-box").classList.remove("box-visiblity"),this.container.getElement(".search-input").focus())},_resetPagerOffset:function(){this.pager.setOffset(0),this.fetchOnOffsetChange=!0},_handleSearchInputKeyup:function(e){var t=this.container.getElement(".search-input").value,n=this.container.getElement(".clear-search-input");""===t?this.clearBtnShown&&(this.clearBtnShown=!1,n.classList.add("hidden")):this.clearBtnShown||(this.clearBtnShown=!0,n.classList.remove("hidden"))},_clearSearchInput:function(){this.container.getElement(".search-input").value="",this.clearBtnShown=!1,this.container.getElement(".clear-search-input").classList.add("hidden"),""!==this.searchValue&&(this.fetchOnOffsetChange=!1,this.searchValue="",o.mask(this.container),this.refresh())},_addBadge:function(e){var t=this;new r({content:e,className:"primary",selectable:!0,closable:!0,icon:"tag",events:{onClose:function(e){t.filterValue="",t.refresh()}}}).inject(this.container.querySelector(".usage-form .input-group"))}})})),define("DS/W3DDriveManagement/view/W3DDriveManagement",["UWA/Core","UWA/Class/View","UWA/Class/Promise","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/Handlebars/Handlebars","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/W3DDriveManagement/Utils/WAFDataForDriveMgt","DS/W3DDriveManagement/Collections/SharedLinks","DS/W3DDriveManagement/Models/ShareAccess","DS/W3DDriveManagement/Models/DrivesConfiguration","DS/W3DDriveManagement/view/W3DDriveManagementSettings","DS/W3DDriveManagement/view/W3DDriveManagementDrives","DS/W3DDriveManagement/view/W3DDriveManagementShare","DS/W3DDriveManagement/Collections/DriveProviders","text!DS/W3DDriveManagement/template/W3DDriveManagement.html","i18n!DS/W3DDriveManagement/assets/nls/W3DDriveManagement","css!DS/W3DDriveManagement/W3DDriveManagement.css","css!DS/UIKIT/UIKIT.css"],(function(e,t,n,i,a,s,r,o,c,l,u,h,d,m,v,f,g){"use strict";return t.extend({domEvents:{"click .usage":"_renderDrives","click .settings":"_renderSetting","click .share":"_renderShare"},classes:{driveManagementUsage:"drive-management-usage",driveManagementSettings:"drive-management-settings",driveManagementShare:"drive-management-share",active:"active",usage:"usage",settings:"settings",share:"share",removeDisplay:"remove-display"},dotClasses:function(e){return"."+this.classes[e]},setup:function(){this.template=s.compile(f),this.shareAccess=new l,this.sharedLinks=new c,this.driveProviders=new v,this.drivesConfiguration=new u},refresh:function(e){var t=this;a.mask(this.container),e&&e.platform&&(this.platform=e.platform),this.platform&&(o.setPlatform(this.platform),this._fetchConfig().then((function(){var e=[];t.drivesView&&e.push(t.drivesView.refresh()),t.settingsView&&e.push(t.settingsView.refresh()),t.shareView&&e.push(t.shareView.refresh()),n.all(e).then(a.unmask(t.container))}),(function(){})))},_fetchConfig:function(){var e=this;return new n((function(t,n){e.drivesConfiguration.fetch({onComplete:function(n,i,a){e.platform.csrf=a.responseHeaders,t()},onFailure:function(t,i,s){403===s.request.xhr.status?(e.error(g.drivesAccessDenied),e.drivesView.container.innerHTML=""):i&&i.error&&i.error.message?e.error(i.error.message):e.error(g.fetchError),a.unmask(e.container),n()}})}))},render:function(){this.container.innerHTML=this.template({NLS:g}),a.mask(this.container),this.alert=new i({className:"drive-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!0,messageClassName:"error",maximumVisibleMessages:1}),this._renderDrives(),this._shareByLinkService()},_shareByLinkService:function(){var e=this;return new n((function(t,n){r.getServiceUrl({serviceName:"scdatamgt",platformId:widget.getValue("x3dPlatformId"),onComplete:function(n){!n&&e.container.querySelector(".tab-item.share.share-font")?(e.container.querySelector(".tab-item.share.share-font").addClassName(e.classes.removeDisplay),t()):t(n)},onFailure:n})}))},error:function(e){this.alert.add({message:e,className:"error"})},_renderDrives:function(){this.drivesView||(this.drivesView=new d({alert:this.alert,drivesConfigurationModel:this.drivesConfiguration,container:this.container.getElement(this.dotClasses("driveManagementUsage"))})),this.container.getElement(this.dotClasses("driveManagementSettings")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("driveManagementShare")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("driveManagementUsage")).addClassName(this.classes.active),this.container.getElement(this.dotClasses("settings")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("share")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("usage")).addClassName(this.classes.active)},_renderSetting:function(){this.settingsView||(this.settingsView=new h({alert:this.alert,container:this.container.getElement(this.dotClasses("driveManagementSettings")),driveProviders:this.driveProviders,drivesConfigurationModel:this.drivesConfiguration})),this.container.getElement(this.dotClasses("driveManagementUsage")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("driveManagementShare")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("driveManagementSettings")).addClassName(this.classes.active),this.container.getElement(this.dotClasses("usage")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("share")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("settings")).addClassName(this.classes.active)},_renderShare:function(){this.shareView||(this.shareView=new m({alert:this.alert,container:this.container.getElement(this.dotClasses("driveManagementShare")),shareAccess:this.shareAccess,sharedLinks:this.sharedLinks,drivesConfigurationModel:this.drivesConfiguration}),this.shareView.render()),this.container.getElement(this.dotClasses("driveManagementUsage")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("driveManagementSettings")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("driveManagementShare")).addClassName(this.classes.active),this.container.getElement(this.dotClasses("usage")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("settings")).removeClassName(this.classes.active),this.container.getElement(this.dotClasses("share")).addClassName(this.classes.active)}})}));