define("DS/ENOMadeFromUX/utils/MBMFUtils",["UWA/Class","DS/ENOMadeFromUX/service/MBMFServiceProvider","DS/XSRCommonComponents/utils/Notification","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/TypeUtils","DS/XSRCommonComponents/utils/Constants","i18n!DS/ENOMadeFromUX/assets/nls/MadeFromUX"],(function(e,n,t,o,r,M,i){return e.singleton({getMsgAddNodeOnMBMFParent:function(){t.displayNotification({eventID:"error",msg:i.Error_AddNodeOn_MBMFParent})},getMsgAddNodeOnRM:function(){t.displayNotification({eventID:"error",msg:i.Error_AddNodeOn_RM})},getMsgAddNodeOnRMFromDragandDrop:function(){t.displayNotification({eventID:"error",msg:i.Error_AddNodeOn_RM_Drag_Drop})},getMsgAddNodeOnMBMF:function(){t.displayNotification({eventID:"error",msg:i.Error_AddNodeOn_MBMF})},getMsgAddNodeOnLayeredProd:function(){t.displayNotification({eventID:"error",msg:i.Error_AddOn_SpecilizedMakeFrom})},getMBMFUpdateService:function(e,o){var r=o.getParentId(),M=o.getID();return e.madeFromPID=M,o.options.grid.madeFromRelationId&&(e.connectionId=o.options.grid.madeFromRelationId),new Promise((function(o,s){(new n).updateMBMFInfo(e,r,M).then((function(e){return e&&e.success&&t.displayNotification({eventID:"success",msg:e?e.result.message:i.Success_UpdateMBMF}),o(e)})).catch((function(e){return o(e)}))}))},getMBMFDetails:function(e,r,M,s,a,d){var f=this;return f.MBMFService=new n(d),new Promise((function(n,M){f.MBMFService.getMBMFInfo(e).then((function(t){if(t&&t.success&&200===t.statusCode){if(!(t.result.MadeFromConnections&&t.result.MadeFromConnections.length>0))return n(null);for(var M=[],i=new Map,s=0;s<t.result.MadeFromConnections.length;s++){var a=t.result.MadeFromConnections[s];M.push(a.madeFromProductID),i.set(a.madeFromRelationId,a)}var d=o.removeDuplicatesFromArr(M);n(f.postMBMFInfo(d,i,r,e))}})).catch((function(e){var n;n=e&&e.result?e.result.message:i.Error_Get_MBMF,t.displayNotification({eventID:"error",msg:n})}))}))},postMBMFInfo:function(e,n,o,s){let a=this;return new Promise(((d,f)=>{a.MBMFService.fetchItemInfo(e,!0).then((function(e){if(e&&e.length>0){let f=[];for(var t=0;t<e.length;t++){var i=e[t];for(let e of n.values())if(e.madeFromProductID===i.resourceid){MBMFInfo=Object.assign(e,i);var a=MBMFInfo.madeFromProductType.dbName;MBMFInfo.asRequired?MBMFInfo.asRequired=MBMFInfo.asRequired:r.isRawMaterial(a)&&(MBMFInfo.asRequired=!1),MBMFInfo.madeFrom=!0,o&&(MBMFInfo.UOMUnitsDBNLSMap=o),MBMFInfo.quantityUOM&&(MBMFInfo.unit=MBMFInfo.quantityUOM),MBMFInfo.dimensionType===M.RECTANGULAR_DIMENSION?(MBMFInfo.quantityLength=MBMFInfo.quantityLength,MBMFInfo.quantityWidth=MBMFInfo.quantityWidth,MBMFInfo.lenQty_unit=MBMFInfo.unit?MBMFInfo.quantityLength+" "+MBMFInfo.unit.dbName:"",MBMFInfo.widthQty_unit=MBMFInfo.unit?MBMFInfo.quantityWidth+" "+MBMFInfo.unit.dbName:""):(MBMFInfo.quantity=MBMFInfo.quantity,MBMFInfo.qty_unit=MBMFInfo.unit?MBMFInfo.quantity+" "+MBMFInfo.unit.dbName:""),MBMFInfo["ds6w:created"]=MBMFInfo["ds6w:created"],MBMFInfo["ds6w:modified"]=MBMFInfo["ds6w:modified"],MBMFInfo["ds6w:responsible"]=MBMFInfo["ds6w:responsible"],MBMFInfo["ds6w:cadMaster"]=MBMFInfo["ds6w:cadMaster"],MBMFInfo["ds6w:status"]=MBMFInfo["ds6w:status"],MBMFInfo.parentid=s,MBMFInfo.quantityType&&(MBMFInfo.dimensionType=MBMFInfo.quantityType);let{quantityType:n,quantityUOM:t,...d}=MBMFInfo;f.push(d)}}return d(f)}})).catch((function(e){t.displayNotification({eventID:"error",msg:e?e.result.message:i.Error_Get_MBMF})}))}))},getNLSLabels:function(e){var n=e;if(n)for(var t=0;t<n.length;t++)n[t].text=n[t].text&&i[n[t].text]?i[n[t].text]:n[t].text;return n},async getReferenceList(e){let t=await(new n).getReferenceMap(e),o=new Set;return t.success&&Object.keys(t.result.MadeFromConnections).forEach((e=>{t.result.MadeFromConnections[e]&&t.result.MadeFromConnections[e].forEach((e=>{o.add(e)}))})),Array.from(o)}})}));