define("DS/WebPolyMaths/WebPolyCurves",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/Mesh/Mesh","DS/Visualization/SceneGraphFactory"],(function(e,t,i,n){"use strict";return e.extend({init:function(e){return this._Polycurves=e||[],this},AddPolyCurve:function(e){this._Polycurves.push(e)},createSGNode:function(e,t=3,r){let o=this._Polycurves,a=[],s=[];for(var c=0;c<o.length;c++){let e=o[c].GetAllVertices();s.push(e.length);for(var l=0;l<e.length;l++)a.push(e[l])}var u=this._createLineMesh({points:a,primitiveLengths:s,color:e||new i.Color(1,0,0,1),drawMode:i.ConnectivityTypeEnum.LINE_STRIP,width:t});return n.createMeshNode(u,void 0,void 0,void 0,r)},GetAllPolyCurves:function(){return this._Polycurves},move:function(e){for(let t=0,i=this._Polycurves.length;t<i;++t)this._Polycurves[t].move(e)},_createLineMesh:function(e){var t,n,r,o,a,s,c,l=i.ConnectivityTypeEnum.LINE_STRIP;if(t=e.points,n=e.idx?e.idx:[],r=e.primitiveLengths,(l=e.drawMode)===i.ConnectivityTypeEnum.LINES&&0===n.length)for(var u=0;u<t.length-1;u++)n.push(u),n.push(u+1);o=e.width,s=void 0!==e.color?e.color:new i.Color(.5,.5,.5,1),c=e.layerNb?e.layerNb:0;var p=t.length,h=n.length;if(!p)return null;var d=new i.PrimitiveGroup;d.fillAttr=new i.FillAttributes,d.lineAttr=new i.LineAttributes(s,o),d.pointAttr=new i.PointAttributes;var m,y,g,f,P,v=0,_=(m=3,y=p,g=i.VertexComponentEnum.POSITION,f=i.DataTypeEnum.FLOAT,(P=new i.Buffer).size=m*y,P.component=g,P.format=f,P.dimension=m,P.data=new Float32Array(P.size),P),T=v++;d.addBuffer(T,_),a=_.data;for(u=0;u<p;u++){var M=t[u];a[3*u]=M.x,a[3*u+1]=M.y,a[3*u+2]=M.z}var C=!1,b=0;if(h){b=v++,C=function(e){var t=new i.Buffer;return t.indexBuffer=!0,t.size=e,t.format=i.DataTypeEnum.UINT,t.dimension=1,t.data=e>65535?new Uint32Array(t.size):new Uint16Array(t.size),t}(n.length),d.addBuffer(b,C),a=C.data;for(u=0;u<h;u++)a[u]=n[u]}var E=function(e,t,n,r,o,a){var s=new i.VertexComponent;return s.component=e.component,s.nbValuesPerVertex=e.dim,s.format=e.format,s.nbVertices=n,s.cardinality=0,s.bufferId=t,r?(s.indices=new i.IndexArray,s.indices.format=r.format,s.indices.bufferId=o,s.indices.offset=a):s.offset=a,s};let A=0;for(let e=0;e<r.length;++e){var S=new i.Primitive;S.nbIndices=r[e],S.connectivity=l,S.attr={fill:new i.FillAttributes(s),line:new i.LineAttributes(s,o),point:new i.PointAttributes};var x=E(_,T,r[e],C,b,A);S.addVertexComponent(x),d.addPrimitive(S),A+=r[e]}return d.noz=c>0,d.editable=!1,d}})})),define("DS/WebPolyMaths/WebToolsMaths",["DS/Visualization/ThreeJS_DS"],(function(e){"use strict";var t=.001,i={isZero:function(e){return Math.abs(e)<t},areEqual:function(e,i,n,r){var o=void 0!==r?r:t,a=!0,s=void 0!==n?n:"float";switch(s){case"float":a=Math.abs(e-i)<o;break;case"Vector3":a=Math.abs(e.x-i.x)<o&&Math.abs(e.y-i.y)<o&&Math.abs(e.z-i.z)<o;break;case"Matrix4":for(var c=0;c<16&&a;c++)a=Math.abs(e.elements[c]-i.elements[c])<o;break;default:console.log("areEqual used with unknown type: "+s)}return a},isLessOrEqual:function(e,i,n){return e<=i+(void 0!==n?n:t)},isLessThan:function(e,i,n){return e<i+(void 0!==n?n:t)},computeMatrixFromLines:function(t,n,r,o){var a,s,c=n.clone().normalize();return void 0!==r?(s=(new e.Vector3).crossVectors(c,r),a=(new e.Vector3).crossVectors(s,c)):void 0!==o?(a=(new e.Vector3).crossVectors(c,o),s=(new e.Vector3).crossVectors(c,a)):(a=(new e.Vector3).crossVectors(c,new e.Vector3(0,0,1)),i.isZero(a.length())&&(a=(new e.Vector3).crossVectors(c,new e.Vector3(0,1,0))),s=(new e.Vector3).crossVectors(c,a)),new e.Matrix4(c.x,a.x,s.x,t.x,c.y,a.y,s.y,t.y,c.z,a.z,s.z,t.z,0,0,0,1)},computeTransformationBetweenTwoLines:function(t,n,r,o){var a={returnCode:1};if(t&&n&&r&&o){var s=n.clone().normalize(),c=o.clone().normalize(),l=(new e.Matrix4).makeTranslation(-t.x,-t.y,-t.z),u=(new e.Vector3).crossVectors(s,c);i.isZero(u.length())&&(u=(new e.Vector3).crossVectors(s,new e.Vector3(1,0,0)),i.isZero(u.length())&&(u=(new e.Vector3).crossVectors(s,new e.Vector3(0,1,0))));var p=Math.acos(c.dot(s)),h=(new e.Matrix4).makeRotationAxis(u.normalize(),p),d=(new e.Matrix4).makeTranslation(r.x,r.y,r.z).clone().multiply(h).multiply(l);a.returnCode=0,a.transformation=d}return a},isIdentity:function(e,t=0){let i=e.elements;return Math.abs(i[0]-1)<=t&&Math.abs(i[1])<=t&&Math.abs(i[2])<=t&&Math.abs(i[3])<=t&&Math.abs(i[4])<=t&&Math.abs(i[5]-1)<=t&&Math.abs(i[6])<=t&&Math.abs(i[7])<=t&&Math.abs(i[8])<=t&&Math.abs(i[9])<=t&&Math.abs(i[10]-1)<=t&&Math.abs(i[11])<=t&&Math.abs(i[12])<=t&&Math.abs(i[13])<=t&&Math.abs(i[14])<=t&&Math.abs(i[15]-1)<=t},isTranslation:function(e,t=1e-9){let i=e.elements;return Math.abs(i[0]-1)<=t&&Math.abs(i[1])<=t&&Math.abs(i[2])<=t&&Math.abs(i[3])<=t&&Math.abs(i[4])<=t&&Math.abs(i[5]-1)<=t&&Math.abs(i[6])<=t&&Math.abs(i[7])<=t&&Math.abs(i[8])<=t&&Math.abs(i[9])<=t&&Math.abs(i[10]-1)<=t&&Math.abs(i[11])<=t&&Math.abs(i[15]-1)<=t},quaternionToAxisSystem:function(t){var i={},n=(new e.Matrix4).setRotationFromQuaternion(t.clone()).elements;return i.X=new e.Vector3(n[0],n[1],n[2]),i.Y=new e.Vector3(n[4],n[5],n[6]),i.Z=new e.Vector3(n[8],n[9],n[10]),i.Origin=new e.Vector3(n[12],n[13],n[14]),i}};return i})),define("DS/WebPolyMaths/WebMathsVector3D",[],(function(){"use strict";var e=.001,t=1e-6;return{modifyEpsilon:function(i){var n=e;return i>0&&(e=i,t=i*i),n},isNull:function(t){return Math.abs(t[0])<e&&Math.abs(t[1])<e&&Math.abs(t[2])<e},clone:function(e){var t=[];return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},length:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},squaredLength:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},normalize:function(e,i){var n,r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(Math.abs(r-1)<t)(n=i||[0,0,0])[0]=e[0],n[1]=e[1],n[2]=e[2];else if(r>t){var o=Math.sqrt(r);(n=i||[0,0,0])[0]=e[0]/o,n[1]=e[1]/o,n[2]=e[2]/o}return n},multiply:function(e,t,i){var n=i||[0,0,0];return n[0]=t*e[0],n[1]=t*e[1],n[2]=t*e[2],n},areEqual:function(t,i){return Math.abs(i[0]-t[0])<e&&Math.abs(i[1]-t[1])<e&&Math.abs(i[2]-t[2])<e},add:function(e,t,i){var n=i||[0,0,0];return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n},sub:function(e,t,i){var n=i||[0,0,0];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n},angle:function(t,i){var n,r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),o=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);if(r>e&&o>e){var a=(t[0]*i[0]+t[1]*i[1]+t[2]*i[2])/(r*o);n=Math.acos(Math.min(Math.max(a,-1),1))}return n},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},cross:function(e,t,i){var n=i||[0,0,0],r=e[0],o=e[1],a=e[2],s=t[0],c=t[1],l=t[2];return n[0]=o*l-a*c,n[1]=a*s-r*l,n[2]=r*c-o*s,n},subAndLength:function(e,t,i){var n=i||[0,0,0];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2])},subAndSquaredLength:function(e,t,i){var n=i||[0,0,0];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n[0]*n[0]+n[1]*n[1]+n[2]*n[2]},multiplyAndAdd:function(e,t,i,n){var r=n||[0,0,0];return r[0]=e[0]*t+i[0],r[1]=e[1]*t+i[1],r[2]=e[2]*t+i[2],r},isIdentity:function(t){return Math.abs(t[0]-1)<e&&Math.abs(t[1])<e&&Math.abs(t[2])<e&&Math.abs(t[3])<e&&Math.abs(t[4])<e&&Math.abs(t[5]-1)<e&&Math.abs(t[6])<e&&Math.abs(t[7])<e&&Math.abs(t[8])<e&&Math.abs(t[9])<e&&Math.abs(t[10]-1)<e&&Math.abs(t[11])<e&&Math.abs(t[12])<e&&Math.abs(t[13])<e&&Math.abs(t[14])<e&&Math.abs(t[15]-1)<e},isTranslation:function(t){return Math.abs(t[0]-1)<e&&Math.abs(t[1])<e&&Math.abs(t[2])<e&&Math.abs(t[3])<e&&Math.abs(t[4])<e&&Math.abs(t[5]-1)<e&&Math.abs(t[6])<e&&Math.abs(t[7])<e&&Math.abs(t[8])<e&&Math.abs(t[9])<e&&Math.abs(t[10]-1)<e&&Math.abs(t[11])<e&&Math.abs(t[15]-1)<e},areMatrixEqual:function(t,i){return Math.abs(t[0]-i[0])<e&&Math.abs(t[1]-i[1])<e&&Math.abs(t[2]-i[2])<e&&Math.abs(t[3]-i[3])<e&&Math.abs(t[4]-i[4])<e&&Math.abs(t[5]-i[5])<e&&Math.abs(t[6]-i[6])<e&&Math.abs(t[7]-i[7])<e&&Math.abs(t[8]-i[8])<e&&Math.abs(t[9]-i[9])<e&&Math.abs(t[10]-i[10])<e&&Math.abs(t[11]-i[11])<e&&Math.abs(t[12]-i[12])<e&&Math.abs(t[13]-i[13])<e&&Math.abs(t[14]-i[14])<e&&Math.abs(t[15]-i[15])<e},transformVector:function(e,t,i){var n=i||[0,0,0],r=e[0],o=e[1],a=e[2];return n[0]=t[0]*r+t[4]*o+t[8]*a,n[1]=t[1]*r+t[5]*o+t[9]*a,n[2]=t[2]*r+t[6]*o+t[10]*a,n},transformPoint:function(e,t,i){var n=i||[0,0,0],r=e[0],o=e[1],a=e[2];return n[0]=t[0]*r+t[4]*o+t[8]*a+t[12],n[1]=t[1]*r+t[5]*o+t[9]*a+t[13],n[2]=t[2]*r+t[6]*o+t[10]*a+t[14],n}}})),define("DS/WebPolyMaths/WebGeometryEnums",[],(function(){"use strict";var e=e||{REVISION:"1"};return e.GeometryType={POINT:0,PICKINGPT:1,CURVE:2,LINE:3,CIRCLE:4,SURFACE:5,PLANE:6,CYLINDER:7,CONE:8,SPHERE:9,PRODUCT:10},e.Relationship={NONE:0,COINCIDENT:1,PARRALLEL:2,INTERSECTING:3},e.Mode={EXACT:0,FACETTED:1},e})),define("DS/WebPolyMaths/WebMeasureEnums",[],(function(){"use strict";var e=e||{REVISION:"1"};return e.ResultType={POINT:0,PICKINGPT:1,CENTER:2,CURVE:3,LINE:4,AXIS:5,CIRCLE:6,SURFACE:7,PLANE:8,CYLINDER:9,CONE:10,SPHERE:11,PRODUCT:12},e.ViewedType={POINT:0,CENTER:1,AXIS:2,CURVE:3,INFPLANE:4,SURFACE:5,PRODUCT:6,CIRCLE:7,CYCOSP:8},e.RadiusResultDisplayType={CENTER:0,TANGENT:1},e})),define("DS/WebPolyMaths/WebPolyCurve",["UWA/Class","DS/Visualization/ThreeJS_DS"],(function(e,t){"use strict";return e.extend({init:function(e){if(this._Vertices=[],e instanceof Array&&e.length&&e[0]instanceof t.Vector3)this._Vertices=e;else if(this._Vertices=[],e instanceof Array)for(let t=0,i=e.length;t<i;++t)this.AddVertex(e[t]);return this},AddVertex:function(e){e instanceof t.Vector3?this._Vertices.push(e):this._Vertices.push(new t.Vector3(e[0],e[1],e[2]))},GetAllVertices:function(){return this._Vertices},move:function(e){for(let t=0,i=this._Vertices.length;t<i;++t)this._Vertices[t].applyMatrix4(e)}})})),define("DS/WebPolyMaths/WebMeshCreation",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Mesh/MeshUtils","DS/WebPolyMaths/WebToolsMaths"],(function(e,t,i,n){"use strict";var r={createPolylines:function(e,t,n,r){var o=new i.PrimitiveGroup,a=new i.Color(t[0].r,t[0].g,t[0].b,1);o.fillAttr=new i.FillAttributes,o.lineAttr=new i.LineAttributes(a,n,r),o.pointAttr=new i.PointAttributes;for(var s=0,c=e.length,l=0;l<c;l++)for(var u=(P=e[l]).length,p=0;p<u;p++)s+=P[p].length;var h=new i.Buffer;h.size=3*s,h.component=i.VertexComponentEnum.POSITION,h.format=i.DataTypeEnum.FLOAT,h.dimension=3,h.data=new Float32Array(h.size);var d=h.data,m=0;for(l=0;l<c;l++)for(u=(P=e[l]).length,p=0;p<u;p++){s=(v=P[p]).length;for(var y=0;y<s;y++){var g=v[y];d[m]=g[0],d[m+1]=g[1],d[m+2]=g[2],m+=3}}o.addBuffer(0,h);var f=0;for(l=0;l<c;l++){var P=e[l];for(a=new i.Color(t[l].r,t[l].g,t[l].b,1),u=P.length,p=0;p<u;p++){var v;s=(v=P[p]).length;var _=new i.Primitive;_.nbIndices=s,_.connectivity=i.ConnectivityTypeEnum.LINE_STRIP,_.attr={fill:new i.FillAttributes(a),line:new i.LineAttributes(a,n,r),point:new i.PointAttributes};var T=new i.VertexComponent;T.component=i.VertexComponentEnum.POSITION,T.nbVertices=s,T.nbValuesPerVertex=3,T.format=i.DataTypeEnum.FLOAT,T.cardinality=0,T.bufferId=0,T.offset=f,f+=s,_.addVertexComponent(T),o.addPrimitive(_)}}return o},createRectangle:function(e,t,i,n,o,a){var s=[],c=0;s[c++]=0,s[c++]=0,s[c++]=0,s[c++]=e,s[c++]=0,s[c++]=0,s[c++]=e,s[c++]=t,s[c++]=0,s[c++]=0,s[c++]=t,s[c++]=0;var l=[];l[0]=0,l[1]=0,l[2]=1;var u=[];c=0;return u[c++]=0,u[c++]=1,u[c++]=1,u[c++]=0,r.createPlanarPolygon(s,l,u,!1,i,n,o,a)},createArrow:function(e,t,i,n,o,a,s){var c=(1-i)*t,l=e/2,u=[],p=0;u[p++]=0,u[p++]=0,u[p++]=0,u[p++]=c,u[p++]=-e,u[p++]=0,u[p++]=c,u[p++]=-l,u[p++]=0,u[p++]=t,u[p++]=-l,u[p++]=0,u[p++]=t,u[p++]=l,u[p++]=0,u[p++]=c,u[p++]=l,u[p++]=0,u[p++]=c,u[p++]=e,u[p++]=0;var h=[];h[0]=0,h[1]=0,h[2]=1;var d=[];p=0;return d[p++]=1,d[p++]=1,d[p++]=1,d[p++]=0,d[p++]=0,d[p++]=1,d[p++]=1,r.createPlanarPolygon(u,h,d,!1,n,o,a,s)},createRing:function(e,t,i,o,a,s,c,l,u,p){var h=(o-i)/a,d=[],m=0,y=[],g=0,f=p?1:0,P=1-f,v=n.isZero(e);v&&(d[m++]=0,d[m++]=0,d[m++]=0,y[g++]=f);for(var _=0;_<=a;_++){var T=i+_*h;v||(d[m++]=e*Math.cos(T),d[m++]=e*Math.sin(T),d[m++]=0,y[g++]=f),d[m++]=t*Math.cos(T),d[m++]=t*Math.sin(T),d[m++]=0,y[g++]=P}var M=[];return M[0]=0,M[1]=0,M[2]=1,r.createPlanarPolygon(d,M,y,!v,s,c,l,u)},createPlanarPolygon:function(e,t,n,r,o,a,s,c){var l=e.length/3,u=o?l+1:0,p=s?l:0,h=r?i.ConnectivityTypeEnum.TRIANGLE_STRIP:i.ConnectivityTypeEnum.TRIANGLE_FAN,d=void 0!==c?c:new i.Color(.5,.5,.5,1),m=void 0!==a?a:new i.Color(.5,.5,.5,1),y=new i.PrimitiveGroup;y.fillAttr=new i.FillAttributes,y.lineAttr=new i.LineAttributes,y.pointAttr=new i.PointAttributes;var g=new i.Buffer;g.size=3*l,g.component=i.VertexComponentEnum.POSITION,g.format=i.DataTypeEnum.FLOAT,g.dimension=3,g.data=new Float32Array(g.size);var f=new i.Buffer;f.size=3,f.component=i.VertexComponentEnum.NORMAL,f.format=i.DataTypeEnum.FLOAT,f.dimension=3,f.data=new Float32Array(f.size);var P=new i.Buffer;P.size=6,P.component=i.VertexComponentEnum.TEX_COORD_0,P.format=i.DataTypeEnum.FLOAT,P.dimension=3,P.data=new Float32Array(P.size);var v=new i.Buffer;v.indexBuffer=!0,v.size=u+p,v.format=i.DataTypeEnum.UINT,v.dimension=1,v.data=new Uint16Array(v.size);var _=new i.Buffer;_.indexBuffer=!0,_.size=p,_.format=i.DataTypeEnum.UINT,_.dimension=1,_.data=new Uint16Array(_.size);var T=new i.Buffer;T.indexBuffer=!0,T.size=u+p,T.format=i.DataTypeEnum.UINT,T.dimension=1,T.data=new Uint16Array(T.size);y.addBuffer(0,g),y.addBuffer(1,f),y.addBuffer(2,v),y.addBuffer(3,_),y.addBuffer(4,P),y.addBuffer(5,T);var M=v.data,C=0,b=0;if(o){for(b=0;b<l;b++)M[C++]=b;M[C++]=0}if(s)for(b=0;b<l;b++)M[C++]=b;if(M=_.data,C=0,s)for(b=0;b<l;b++)M[C++]=0;if(M=T.data,C=0,s)for(b=0;b<l;b++)M[C++]=n[b];for(M=g.data,C=0;C<3*l;C++)M[C]=e[C];if(C=0,(M=f.data)[C++]=t[0],M[C++]=t[1],M[C++]=t[2],C=0,(M=P.data)[C++]=0,M[C++]=0,M[C++]=0,M[C++]=1,M[C++]=0,M[C++]=0,o){var E=new i.Primitive;E.nbIndices=l+1,E.connectivity=i.ConnectivityTypeEnum.LINE_STRIP,E.attr={fill:new i.FillAttributes(m),line:new i.LineAttributes(m),point:new i.PointAttributes};var A=new i.VertexComponent;A.component=i.VertexComponentEnum.POSITION,A.nbVertices=l,A.nbValuesPerVertex=3,A.format=i.DataTypeEnum.FLOAT,A.cardinality=0,A.bufferId=0,A.indices=new i.IndexArray,A.indices.format=i.DataTypeEnum.UINT,A.indices.bufferId=2,A.indices.offset=0,E.addVertexComponent(A),y.addPrimitive(E)}if(s){var S=new i.Primitive;S.nbIndices=l,S.connectivity=h,S.attr={fill:new i.FillAttributes(d),line:new i.LineAttributes,point:new i.PointAttributes};var x=new i.VertexComponent;x.component=i.VertexComponentEnum.POSITION,x.nbVertices=l,x.nbValuesPerVertex=3,x.format=i.DataTypeEnum.FLOAT,x.cardinality=0,x.bufferId=0,x.indices=new i.IndexArray,x.indices.format=i.DataTypeEnum.UINT,x.indices.bufferId=2,x.indices.offset=u;var I=new i.VertexComponent;I.component=i.VertexComponentEnum.NORMAL,I.nbVertices=1,I.nbValuesPerVertex=3,I.format=i.DataTypeEnum.FLOAT,I.cardinality=0,I.bufferId=1,I.indices=new i.IndexArray,I.indices.format=i.DataTypeEnum.UINT,I.indices.bufferId=3,I.indices.offset=0;var V=new i.VertexComponent;V.component=i.VertexComponentEnum.TEX_COORD_0,V.nbVertices=2,V.nbValuesPerVertex=3,V.format=i.DataTypeEnum.FLOAT,V.cardinality=0,V.bufferId=4,V.indices=new i.IndexArray,V.indices.format=i.DataTypeEnum.UINT,V.indices.bufferId=5,V.indices.offset=0,S.addVertexComponent(x),S.addVertexComponent(I),S.addVertexComponent(V),y.addPrimitive(S)}return y},_computeTotalLength:function(e){var t=[];if(e.length>0){t.push(0);for(var i=0,n=1;n<e.length;n++)i+=e[n-1].distanceTo(e[n]),t.push(i)}return t},_intersection:function(t,i,n){var r=((t.x-n.x)*i.x-(n.y-t.y)*i.y)/(-i.x*i.x-i.y*i.y);return new e.Vector2(t.x+r*i.x,t.y+r*i.y)},boundingBoxCompute:function(t){for(var i=Number.MAX_VALUE,n=[],r=[],o=0,a=0,s=0,c=0,l=0;l<t.length;l++)r.push(t[(l+1)%t.length].clone().sub(t[l]).normalize()),t[l].x<t[o].x&&(o=l),t[l].x>t[a].x&&(a=l),t[l].y<t[c].y&&(c=l),t[l].y>t[s].y&&(s=l);var u=new e.Vector2(-1,0),p=new e.Vector2(0,-1);for(l=0;l<t.length;l++){var h=[p.dot(r[o]),-p.dot(r[a]),u.dot(r[s]),-u.dot(r[c])];switch(h.indexOf(Math.max.apply(Math,h))){case 0:(u=r[o].clone()).set(u.y,-u.x),o=(o+1)%t.length;break;case 1:(u=r[a].clone().negate()).set(u.y,-u.x),a=(a+1)%t.length;break;case 2:u=r[s].clone(),s=(s+1)%t.length;break;case 3:u=r[c].clone().negate(),c=(c+1)%t.length}(p=u.clone().negate()).set(p.y,-p.x);var d=this._intersection(t[o],p,t[s]),m=this._intersection(t[a],p,t[s]),y=this._intersection(t[c],u,t[o]),g=this._intersection(t[c],u,t[a]),f=d.distanceTo(y),P=d.distanceTo(m),v=P*f;v<i&&(n=[d,y,g,m,P,f],i=v)}return n}};return r})),define("DS/WebPolyMaths/WebMathsInfiniteGeometry",["DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebGeometryEnums"],(function(e,t){"use strict";var i=.001,n=1e-6,r={computeTwoPointsDistance:function(n,r){var o={returnCode:1};return n&&r&&(o.returnCode=0,o.distance=e.subAndLength(n,r),o.relationship=o.distance<i?t.Relationship.COINCIDENT:t.Relationship.NONE),o},computePointLineDistance:function(r,o,a){var s={returnCode:1};if(r&&o&&a){var c=e.squaredLength(a);if(c>n){s.returnCode=0;var l=e.dot(e.sub(o,r),a)/c;s.aPosition=e.multiplyAndAdd(a,l,o),s.distance=e.subAndLength(r,s.aPosition),s.relationship=s.distance<i?t.Relationship.COINCIDENT:t.Relationship.NONE}}return s},computePointPlaneDistance:function(r,o,a){var s={returnCode:1};if(r&&o&&a){var c=e.squaredLength(a);if(c>n){s.returnCode=0;var l=e.dot(e.sub(r,o),a)/c;s.aPosition=e.multiplyAndAdd(a,l,r),s.distance=e.subAndLength(r,s.aPosition),s.relationship=s.distance<i?t.Relationship.COINCIDENT:t.Relationship.NONE}}return s},computeTwoLinesDistance:function(n,r,o,a){var s={returnCode:1};if(n&&r&&o&&a){s.returnCode=0;var c=e.sub(o,n),l=e.squaredLength(r),u=e.dot(r,a),p=e.squaredLength(a),h=e.dot(r,c),d=e.dot(a,c),m=l*p-u*u,y=0,g=0;m<i?(y=0,g=u>p?h/u:d/p,s.aPosition1=e.clone(n),s.aPosition2=e.multiplyAndAdd(a,g,o),s.distance=e.subAndLength(s.aPosition1,s.aPosition2),s.relationship=s.distance<i?t.Relationship.COINCIDENT:t.Relationship.PARRALLEL,s.angle=0):(y=(u*d-p*h)/m,g=(l*d-u*h)/m,s.aPosition1=e.multiplyAndAdd(r,y,n),s.aPosition2=e.multiplyAndAdd(a,g,o),s.distance=e.subAndLength(s.aPosition1,s.aPosition2),s.relationship=s.distance<i?t.Relationship.INTERSECTING:t.Relationship.NONE,s.angle=e.angle(r,a))}return s},computeLinePlaneDistance:function(n,o,a,s){var c={returnCode:1};if(n&&o&&a&&s){c.returnCode=0;var l=e.normalize(o),u=e.normalize(s),p=e.dot(l,u);if(Math.abs(p)<i){c.angle=0;var h=r.computePointPlaneDistance(n,a,u);0===h.returnCode&&h.distance<i?(c.distance=0,c.aPosition=e.clone(n),c.relationship=t.Relationship.COINCIDENT):(c.distance=h.distance,c.aPosition=h.aPosition,c.relationship=t.Relationship.PARRALLEL)}else{c.distance=0,c.angle=Math.asin(p);var d=e.dot(e.sub(n,a),u)/p;c.aPosition=e.multiplyAndAdd(l,d,n),c.relationship=t.Relationship.INTERSECTING}}return c},computeTwoPlanesDistance:function(n,o,a,s){var c={returnCode:1};if(n&&o&&a&&s){c.returnCode=0;var l=e.normalize(o),u=e.normalize(s);if(e.areEqual(l,u)||e.isNull(e.add(l,u))){c.angle=0;var p=e.areEqual(l,u)?1:-1,h=e.dot(n,l),d=e.dot(a,u);c.distance=Math.abs(h-p*d);var m=r.computePointPlaneDistance(a,n,l);c.aPosition1=m.aPosition;var y=r.computePointPlaneDistance(n,a,u);c.aPosition2=y.aPosition,c.relationship=c.distance<i?t.Relationship.COINCIDENT:t.Relationship.PARRALLEL}else{c.distance=0,c.angle=Math.acos(e.dot(l,u));var g=e.cross(l,u),f=e.cross(l,g),P=e.cross(u,g),v=r.computeLinePlaneDistance(a,P,n,l);c.aPosition1=v.aPosition;var _=r.computeLinePlaneDistance(n,f,a,u);c.aPosition2=_.aPosition,c.relationship=t.Relationship.INTERSECTING}}return c}};return r})),define("DS/WebPolyMaths/WebMathsBoundingGeometry",["DS/Visualization/ThreeJS_DS","DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebToolsMaths"],(function(e,t,i){"use strict";var n=.001,r={areEqualAABB:function(e,t){return Math.abs(t[0]-e[0])<n&&Math.abs(t[1]-e[1])<n&&Math.abs(t[2]-e[2])<n&&Math.abs(t[3]-e[3])<n&&Math.abs(t[4]-e[4])<n&&Math.abs(t[5]-e[5])<n},AABBVolume:function(e){return(e.max.x-e.min.x)*(e.max.y-e.min.y)*(e.max.z-e.min.z)},areAABBInClash:function(e,t,n,o){if(null==t||i.isIdentity(t))return r._areAABBInClash(e,n,o);if(i.isTranslation(t)){r._aabbClashBuffer.u.getPositionFromMatrix(t);var a=e.clone();return a.translate(r._aabbClashBuffer.u),r._areAABBInClash(a,n,o)}var s=r._aabbClashBuffer.O,c=r._aabbClashBuffer.u,l=r._aabbClashBuffer.v,u=r._aabbClashBuffer.w,p=r._aabbClashBuffer.dim1;s.copy(e.min),s.addScalar(-o),e.size(p),p.addScalar(2*o),s.applyMatrix4(t),t.extractBasis(c,l,u);var h=r._aabbClashBuffer.minA,d=r._aabbClashBuffer.maxA;if(h[0]=s.x,h[1]=s.y,h[2]=s.z,d[0]=s.x,d[1]=s.y,d[2]=s.z,c.x<0?h[0]+=c.x*p.x:d[0]+=c.x*p.x,c.y<0?h[1]+=c.y*p.x:d[1]+=c.y*p.x,c.z<0?h[2]+=c.z*p.x:d[2]+=c.z*p.x,l.x<0?h[0]+=l.x*p.y:d[0]+=l.x*p.y,l.y<0?h[1]+=l.y*p.y:d[1]+=l.y*p.y,l.z<0?h[2]+=l.z*p.y:d[2]+=l.z*p.y,u.x<0?h[0]+=u.x*p.z:d[0]+=u.x*p.z,u.y<0?h[1]+=u.y*p.z:d[1]+=u.y*p.z,u.z<0?h[2]+=u.z*p.z:d[2]+=u.z*p.z,h[0]<=n.max.x&&n.min.x<=d[0]&&h[1]<=n.max.y&&n.min.y<=d[1]&&h[2]<=n.max.z&&n.min.z<=d[2]&&r._isAABBInClashWithPlanesInterval(n,s,c,p.x)&&r._isAABBInClashWithPlanesInterval(n,s,l,p.y)&&r._isAABBInClashWithPlanesInterval(n,s,u,p.z)){let e=r._aabbClashBuffer.dim2,t=r._aabbClashBuffer.OO,i=r._aabbClashBuffer.normal;if(n.size(e),t.subVectors(n.min,s),i.set(0,-c.z,c.y),0==r._testEdgeCouplePlaneRejection(t,i,e,l,p.y,u,p.z,o)&&(i.set(0,-l.z,l.y),0==r._testEdgeCouplePlaneRejection(t,i,e,c,p.x,u,p.z,o)&&(i.set(0,-u.z,u.y),0==r._testEdgeCouplePlaneRejection(t,i,e,c,p.x,l,p.y,o)&&(i.set(c.z,0,-c.x),0==r._testEdgeCouplePlaneRejection(t,i,e,l,p.y,u,p.z,o)&&(i.set(l.z,0,-l.x),0==r._testEdgeCouplePlaneRejection(t,i,e,c,p.x,u,p.z,o)&&(i.set(u.z,0,-u.x),0==r._testEdgeCouplePlaneRejection(t,i,e,c,p.x,l,p.y,o)&&(i.set(-c.y,c.x,0),0==r._testEdgeCouplePlaneRejection(t,i,e,l,p.y,u,p.z,o)&&(i.set(-l.y,l.x,0),0==r._testEdgeCouplePlaneRejection(t,i,e,c,p.x,u,p.z,o)&&(i.set(-u.y,u.x,0),0==r._testEdgeCouplePlaneRejection(t,i,e,c,p.x,l,p.y,o))))))))))return!0}return!1},_areAABBInClash:function(e,t,i){return e.min.x-i<=t.max.x&&t.min.x<=e.max.x+i&&e.min.y-i<=t.max.y&&t.min.y<=e.max.y+i&&e.min.z-i<=t.max.z&&t.min.z<=e.max.z+i},AABBOverlap:function(e,t){return e[0]<=t[3]&&t[0]<=e[3]&&e[1]<=t[4]&&t[1]<=e[4]&&e[2]<=t[5]&&t[2]<=e[5]},AABBSphereOverlap:function(e,t){let i=0,n=0;return t.center.x<e[0]?(i=e[0]-t.center.x,n+=i*i):t.center.x>e[3]&&(i=t.center.x-e[3],n+=i*i),t.center.y<e[1]?(i=e[1]-t.center.y,n+=i*i):t.center.y>e[4]&&(i=t.center.y-e[4],n+=i*i),t.center.z<e[2]?(i=e[2]-t.center.z,n+=i*i):t.center.z>e[5]&&(i=t.center.z-e[5],n+=i*i),n<=t.radius*t.radius},_isAABBInClashWithPlanesInterval:function(e,t,i,n){let o=r._aabbClashBuffer;return o.offset=t.x*i.x+t.y*i.y+t.z*i.z,i.x<0?(o.min=e.max.x*i.x,o.max=e.min.x*i.x):(o.min=e.min.x*i.x,o.max=e.max.x*i.x),i.y<0?(o.min+=e.max.y*i.y,o.max+=e.min.y*i.y):(o.min+=e.min.y*i.y,o.max+=e.max.y*i.y),i.z<0?(o.min+=e.max.z*i.z,o.max+=e.min.z*i.z):(o.min+=e.min.z*i.z,o.max+=e.max.z*i.z),o.min<=o.offset+n&&o.max>=o.offset},_testEdgeCouplePlaneRejection:function(e,t,i,n,r,o,a,s){let c=t.lengthSq();if(c<s*s)return!1;c=Math.sqrt(c),t.x/=c,t.y/=c,t.z/=c;let l,u=e.dot(t);return u<0?(u=-u,t.x>0&&(u-=i.x*t.x),t.y>0&&(u-=i.y*t.y),t.z>0&&(u-=i.z*t.z),l=n.dot(t),l<0&&(u+=r*l),l=o.dot(t),l<0&&(u+=a*l)):(t.x<0&&(u+=i.x*t.x),t.y<0&&(u+=i.y*t.y),t.z<0&&(u+=i.z*t.z),l=n.dot(t),l>0&&(u-=r*l),l=o.dot(t),l>0&&(u-=a*l)),u>0},_aabbClashBuffer:{O:new e.Vector3,OO:new e.Vector3,u:new e.Vector3,v:new e.Vector3,w:new e.Vector3,dim1:new e.Vector3,dim2:new e.Vector3,normal:new e.Vector3,minA:[0,0,0],maxA:[0,0,0],offset:0,min:0,max:0},computeAABBDistance:function(e,t){return Math.sqrt(r.computeAABBSquaredDistance(e,t))},computeAABBSquaredDistance:function(e,t){var i=0,n=0,r=0,o=0;return e[3]<t[0]?n=t[0]-e[3]:e[0]>t[3]&&(n=e[0]-t[3]),e[4]<t[1]?r=t[1]-e[4]:e[1]>t[4]&&(r=e[1]-t[4]),e[5]<t[2]?o=t[2]-e[5]:e[2]>t[5]&&(o=e[2]-t[5]),0===n&&0===r&&0===o||(i=n*n+r*r+o*o),i},computeAABBSquaredMaxDistance:function(e,t){var i=Math.max(Math.abs(t[0]-e[3]),Math.abs(t[3]-e[0])),n=Math.max(Math.abs(t[1]-e[4]),Math.abs(t[4]-e[1])),r=Math.max(Math.abs(t[2]-e[5]),Math.abs(t[5]-e[2]));return i*i+n*n+r*r},computeAABBForPoint:function(e){var t=[];return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[0],t[4]=e[1],t[5]=e[2],t},computeAABBForPoints:function(e){var t,i,n,r=[],o=e.length;r[0]=e[0][0],r[1]=e[0][1],r[2]=e[0][2],r[3]=r[0],r[4]=r[1],r[5]=r[2];for(var a=1;a<o;a++)t=e[a][0],i=e[a][1],n=e[a][2],t<r[0]?r[0]=t:t>r[3]&&(r[3]=t),i<r[1]?r[1]=i:i>r[4]&&(r[4]=i),n<r[2]?r[2]=n:n>r[5]&&(r[5]=n);return r},computeAABBForUnsortedPoints:function(e,i,n,r,o){var a,s,c,l,u=[];if(o&&!t.isIdentity(o)){a=3*n[i],(u=t.transformPoint([r[a],r[a+1],r[a+2]],o))[3]=u[0],u[4]=u[1],u[5]=u[2];for(var p=1;p<e;p++){a=3*n[i+p];var h=t.transformPoint([r[a],r[a+1],r[a+2]],o);s=h[0],c=h[1],l=h[2],s<u[0]?u[0]=s:s>u[3]&&(u[3]=s),c<u[1]?u[1]=c:c>u[4]&&(u[4]=c),l<u[2]?u[2]=l:l>u[5]&&(u[5]=l)}}else{a=3*n[i],u[0]=r[a],u[1]=r[a+1],u[2]=r[a+2],u[3]=u[0],u[4]=u[1],u[5]=u[2];for(p=1;p<e;p++)s=r[a=3*n[i+p]],c=r[a+1],l=r[a+2],s<u[0]?u[0]=s:s>u[3]&&(u[3]=s),c<u[1]?u[1]=c:c>u[4]&&(u[4]=c),l<u[2]?u[2]=l:l>u[5]&&(u[5]=l)}return u},computeAABBForSegment:function(e,t){var i=[];return i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.min(e[2],t[2]),i[3]=Math.max(e[0],t[0]),i[4]=Math.max(e[1],t[1]),i[5]=Math.max(e[2],t[2]),i},computeAABBForTriangle:function(e,t,i){var n=[];return n[0]=Math.min(e[0],t[0],i[0]),n[1]=Math.min(e[1],t[1],i[1]),n[2]=Math.min(e[2],t[2],i[2]),n[3]=Math.max(e[0],t[0],i[0]),n[4]=Math.max(e[1],t[1],i[1]),n[5]=Math.max(e[2],t[2],i[2]),n},intersectAABBWithRay:function(e,t,i){var r,o,a,s,c,l=!1;(Math.abs(i[0])>n||t[0]>e[0]&&t[0]<e[3])&&(Math.abs(i[1])>n||t[1]>e[1]&&t[1]<e[4])&&(Math.abs(i[2])>n||t[2]>e[2]&&t[2]<e[5])&&(Math.abs(i[0])<n?(r=-Number.MAX_VALUE,o=Number.MAX_VALUE):(c=1/i[0])>=0?(r=(e[0]-t[0])*c,o=(e[3]-t[0])*c):(r=(e[3]-t[0])*c,o=(e[0]-t[0])*c),Math.abs(i[1])<n?(a=-Number.MAX_VALUE,s=Number.MAX_VALUE):(c=1/i[1])>=0?(a=(e[1]-t[1])*c,s=(e[4]-t[1])*c):(a=(e[4]-t[1])*c,s=(e[1]-t[1])*c),r<s&&a<o&&(a>r&&(r=a),s<o&&(o=s),Math.abs(i[2])<n?(a=-Number.MAX_VALUE,s=Number.MAX_VALUE):(c=1/i[2])>=0?(a=(e[2]-t[2])*c,s=(e[5]-t[2])*c):(a=(e[5]-t[2])*c,s=(e[2]-t[2])*c),r<s&&a<o&&(a>r&&(r=a),s<o&&(o=s),o>0&&(l=!0))));return l},areEqualBoundingSpheres:function(e,t){return Math.abs(t[0]-e[0])<n&&Math.abs(t[1]-e[1])<n&&Math.abs(t[2]-e[2])<n&&Math.abs(t[3]-e[3])<n},computeBoundingSpheresDistance:function(e,i){return Math.max(0,t.subAndLength(e,i)-e[3]-i[3])},computeBoundingSpheresSquaredDistance:function(e,t){var i=r.computeBoundingSpheresDistance(e,t);return i*i},computeBoundingSphereForPoint:function(e){var t=[];return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t},computeBoundingSphereForPoints:function(e){var t=r.computeAABBForPoints(e),i=[t[3],t[4],t[5]];return r.computeBoundingSphereForSegment(t,i)},computeBoundingSphereForSegment:function(e,i){var n=[];return n[0]=(e[0]+i[0])/2,n[1]=(e[1]+i[1])/2,n[2]=(e[2]+i[2])/2,n[3]=t.subAndLength(e,i)/2,n},computeBoundingSphereForTriangle:function(e,i,n){var o,a=[],s=t.sub(e,i),c=t.sub(e,n),l=t.squaredLength(s),u=t.squaredLength(c),p=t.dot(s,c),h=2*(l*u-p*p);if(Math.abs(h)<=1e-6){var d=r.computeAABBForTriangle(e,i,n);o=[d[3],d[4],d[5]],a=r.computeBoundingSphereForSegment(d,o)}else{var m=(l*u-u*p)/h,y=(u*l-l*p)/h;m<=0?(o=t.add(e,n),a=t.multiply(o,.5)):y<=0?(o=t.add(e,i),a=t.multiply(o,.5)):m+y>=1?(o=t.add(i,n),a=t.multiply(o,.5),i):(o=t.multiplyAndAdd(s,m,e),a=t.multiplyAndAdd(c,y,o)),a[3]=t.subAndLength(a,e)}return a}};return r})),define("DS/WebPolyMaths/WebMeshServices",["DS/Visualization/ThreeJS_DS","DS/WebPolyMaths/WebToolsMaths","DS/WebPolyMaths/WebGeometryEnums","DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebMathsInfiniteGeometry","DS/WebPolyMaths/WebMathsBoundingGeometry"],(function(e,t,i,n,r,o){"use strict";var a={verifyMesh:function(e){var t=void 0!==e&&void 0!==e.getGroup()&&void 0!==e.getGroup().glType&&void 0!==e.getGroup().geometry;return t=t&&void 0!==e.getCount()&&e.getCount()>0&&void 0!==e.getGroup().geometry.vertexIndexArray},extractMeshVertices:function(e,t,i,r){var o=[],a=e.getCount();i&&i<a&&(a=i);var s=r||!1,c=e.getStart(),l=e.getGroup().geometry;if(l&&l.vertexIndexArray&&l.vertexPositionArray){var u,p=l.vertexIndexArray,h=l.vertexPositionArray,d=0,m=0;if(t&&!n.isIdentity(t))if(s){var y=[];for(d=0;d<a;d++){u=3*p[c+d];var g=!1;for(m=0;!g&&m<y.length;m++)g=u===y[m];g||(o.push(n.transformPoint([h[u],h[u+1],h[u+2]],t)),y.push(u))}}else for(d=0;d<a;d++)u=3*p[c+d],o[d]=n.transformPoint([h[u],h[u+1],h[u+2]],t);else if(s){var f=[];for(d=0;d<a;d++){u=3*p[c+d];var P=!1;for(m=0;!P&&m<f.length;m++)P=u===f[m];P||(o.push([h[u],h[u+1],h[u+2]]),f.push(u))}}else for(m=0;m<a;m++)u=3*p[c+m],o[m]=[h[u],h[u+1],h[u+2]]}return o},extractMeshNormals:function(e,t,i,r){var o=[];if(a.verifyMesh(e)){var s=e.getCount();i&&i<s&&(s=i);var c,l=r||!1,u=e.getStart(),p=e.getGroup().geometry,h=p.vertexIndexArray,d=p.vertexNormalArray,m=0,y=0;if(t&&!n.isIdentity(t))if(l){var g=[];for(m=0;m<s;m++){c=3*h[u+m];var f=!1;for(y=0;!f&&y<g.length;y++)f=c===g[y];f||(o.push(n.transformVector([d[c],d[c+1],d[c+2]],t)),g.push(c))}}else for(m=0;m<s;m++)c=3*h[u+m],o[m]=n.transformVector([d[c],d[c+1],d[c+2]],t);else if(l){var P=[];for(m=0;m<s;m++){c=3*h[u+m];var v=!1;for(y=0;!v&&y<P.length;y++)v=c===P[y];v||(o.push([d[c],d[c+1],d[c+2]]),P.push(c))}}else for(y=0;y<s;y++)c=3*h[u+y],o[y]=[d[c],d[c+1],d[c+2]]}return o},computeAABB:function(e,t){var i=e.getCount(),n=e.getStart(),r=e.getGroup().geometry,a=r.vertexIndexArray,s=r.vertexPositionArray;return o.computeAABBForUnsortedPoints(i,n,a,s,t)},computeBoundingSphere:function(e,t){var i=a.extractMeshVertices(e,t);return o.computeBoundingSphereForPoints(i)},_computeVolume:function(e,i){var r={returnCode:1};if(4===e.getGroup().glType){for(var o=a.extractMeshVertices(e),s=o.length/3,c=0,l=[0,0,0],u=[0,0,0],p=[0,0,0],h=[0,0,0],d=[0,0,0],m=[0,0,0],y=0;y<s;y++){u=n.sub(i,o[3*y],u),p=n.sub(i,o[3*y+1],p);var g=-(h=n.sub(i,o[3*y+2],h))[0]*p[1]*u[2]+p[0]*h[1]*u[2]+h[0]*u[1]*p[2]-u[0]*h[1]*p[2]-p[0]*u[1]*h[2]+u[0]*p[1]*h[2];d=n.add(u,n.add(p,h,d),d),c+=g,l=n.multiplyAndAdd(d,g,l,m)}r.returnCode=0,r.volume=c/6,r.aCog=t.isZero(c)?[0,0,0]:n.multiplyAndAdd(l,1/(4*c),i)}return r},_computePerimeter:function(t){var i={returnCode:1},n=new Array,r=null;if(4===t.getGroup().glType){var o=new Map;!function(){var e=t.getCount(),i=t.getStart(),o=t.getGroup().geometry;if(o&&o.vertexIndexArray&&o.vertexPositionArray){var a=o.vertexIndexArray;r=o.vertexPositionArray;for(let t=0;t<e;t++)n.push(a[i+t]);return!0}}();var a=n.length/3,s=[0,0];for(let e=0;e<a;++e)for(let t=0;t<3;++t)s[0]=n[3*e+t],s[1]=n[3*e+(t+1)%3],s[0]>s[1]&&(s[0]=s[1],s[1]=n[3*e+t]),o.has(s[0]+","+s[1])?o.set(s[0]+","+s[1],!1):o.set(s[0]+","+s[1],!0);var c,l=0,u=new e.Vector3,p=new e.Vector3;for(const e of o)e[1]&&(c=JSON.parse("["+e[0]+"]"),u.set(r[3*c[0]],r[3*c[0]+1],r[3*c[0]+2]),p.set(r[3*c[1]],r[3*c[1]+1],r[3*c[1]+2]),l+=u.distanceTo(p));i.returnCode=0,i.perimeter=l}return i}};return a})),define("DS/WebPolyMaths/WebMeshRecognition",["DS/WebPolyMaths/WebToolsMaths","DS/WebPolyMaths/WebGeometryEnums","DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebMathsInfiniteGeometry","DS/WebPolyMaths/WebMathsBoundingGeometry","DS/WebPolyMaths/WebMeshServices","DS/Visualization/ThreeJS_DS","DS/Visualization/Measurable"],(function(e,t,i,n,r,o,a,s){"use strict";var c=.1,l=.02,u={recognizeCanonicGeometry:function(e,i,n){var r={returnCode:1};if(e.getDecoration()){var a=new s(e);switch(a.getType()){case s.TYPEUNKNOWN:1===(p=o.extractMeshVertices(e)).length&&(r.returnCode=0,r.type=t.GeometryType.POINT,r.position=u._buildVector3(p[0]).applyMatrix4(i));break;case s.TYPEPLANE:var c=a.getPlane();c&&(r.returnCode=0,r.type=t.GeometryType.PLANE,r.origin=u._buildVector3(c.position).applyMatrix4(i),r.normal=u._buildVector3(c.normal).transformDirection(i));break;case s.TYPECYLINDER:var l=a.getCylinder();if(l)if(r.returnCode=0,r.type=t.GeometryType.CYLINDER,r.radius=l.radius,n){var p=o.extractMeshVertices(e);0===(T=u._computeMinMaxProjection(p,l.axis,l.center)).returnCode&&(r.point1=u._buildVector3(T.aPoint1).applyMatrix4(i),r.point2=u._buildVector3(T.aPoint2).applyMatrix4(i))}else r.point1=u._buildVector3(l.center).applyMatrix4(i),r.point2=r.point1.clone().sub(u._buildVector3(l.axis)).applyMatrix4(i);break;case s.TYPECONE:var h=a.getCone();if(h){if(r.returnCode=0,r.type=t.GeometryType.CONE,r.semiAngle=h.semiAngle>Math.PI?h.semiAngle*Math.PI/180:h.semiAngle,r.apex=u._buildVector3(h.center).applyMatrix4(i),r.axis=u._buildVector3(h.axis).transformDirection(i),n){p=o.extractMeshVertices(e);var d=!0;r.semiAngle>Math.PI/2&&(d=!1),0===(T=u._computeMinMaxProjection(p,h.axis,h.center,d)).returnCode&&(r.point1=u._buildVector3(T.aPoint1).applyMatrix4(i),r.point2=u._buildVector3(T.aPoint2).applyMatrix4(i))}else r.point1=u._buildVector3(h.center).applyMatrix4(i),r.point2=r.point1.clone().sub(u._buildVector3(h.axis)).applyMatrix4(i);if(T&&void 0!==T.baseRadius){var m=T.baseRadius/Math.tan(r.semiAngle),y=r.axis.clone().normalize().negate().multiplyScalar(m);r.apex=r.point2.clone().add(y)}}break;case s.TYPESPHERE:var g=a.getSphere();g&&(r.returnCode=0,r.type=t.GeometryType.SPHERE,r.radius=g.radius,r.center=u._buildVector3(g.center).applyMatrix4(i));break;case s.TYPELINE:var f=a.getLine();f&&(r.returnCode=0,r.type=t.GeometryType.LINE,r.point1=u._buildVector3(f.startPosition).applyMatrix4(i),r.point2=u._buildVector3(f.endPosition).applyMatrix4(i));break;case s.TYPECIRCLE:var P=a.getCircle();P&&(r.returnCode=0,r.type=t.GeometryType.CIRCLE,r.radius=P.radius,r.center=u._buildVector3(P.center).applyMatrix4(i),r.normal=u._buildVector3(P.axis).transformDirection(i))}r.exact=0===r.returnCode}if(1===r.returnCode){if(void 0===e._bNotRecognized){if(o.verifyMesh(e)){p=o.extractMeshVertices(e);var v=e.getGroup().glType,_=p.length;if(1===_)r.returnCode=0,r.type=t.GeometryType.POINT,r.position=u._buildVector3(p[0]).applyMatrix4(i);else if(2===_)0===(r=u._recognizeLine(p)).returnCode&&(r.point1=u._buildVector3(r.aPoint1).applyMatrix4(i),r.point2=u._buildVector3(r.aPoint2).applyMatrix4(i));else{if(1===v)0===(T=u._recognizeCircle(p)).returnCode?((r=T).center=u._buildVector3(r.aCenter).applyMatrix4(i),r.normal=u._buildVector3(r.aNormal).transformDirection(i)):0===(r=u._recognizeLine(p)).returnCode&&(r.point1=u._buildVector3(r.aPoint1).applyMatrix4(i),r.point2=u._buildVector3(r.aPoint2).applyMatrix4(i));else if(4===v){var T;if(0===(T=u._recognizePlane(p)).returnCode)(r=T).origin=u._buildVector3(r.aOrigin).applyMatrix4(i),r.normal=u._buildVector3(r.aNormal).transformDirection(i);else{var M=o.extractMeshNormals(e);0===(r=u._recognizeCylinder(p,M)).returnCode?(r.point1=u._buildVector3(r.aPoint1).applyMatrix4(i),r.point2=u._buildVector3(r.aPoint2).applyMatrix4(i)):0===(r=u._recognizeSphere(p,M)).returnCode?r.center=u._buildVector3(r.aCenter).applyMatrix4(i):0===(r=u._recognizeCone(p,M)).returnCode&&(r.apex=u._buildVector3(r.aApex).applyMatrix4(i),r.axis=u._buildVector3(r.aAxis).applyMatrix4(i),r.point1=u._buildVector3(r.aPoint1).applyMatrix4(i),r.point2=u._buildVector3(r.aPoint2).applyMatrix4(i))}}}}1===r.returnCode&&(e._bNotRecognized=!0)}r.exact=!1}return r},recognizeNonCanonicGeometry:function(e,t,i){var n={returnCode:1};if(o.verifyMesh(e)){var r=o.extractMeshVertices(e,t.elements),a=e.getGroup().glType;if(1===a){var s=u._recognizeCircle(r,i);0===s.returnCode&&i?((n=s).center=u._buildVector3(n.aCenter).applyMatrix4(t),n.normal=u._buildVector3(n.aNormal).transformDirection(t)):0===(n=u._recognizeCurve(r,i)).returnCode&&i&&(n.point1=u._buildVector3(n.aPoint1),n.point2=u._buildVector3(n.aPoint2))}else if(4===a&&0===(n=u._recognizeSurface(r,i)).returnCode&&i){n.cog=u._buildVector3(n.aCog);var c=o._computePerimeter(e);0===c.returnCode&&(n.perimeter=c.perimeter)}}return n},_recognizeLine:function(n){var r={returnCode:1},o=n.length;if(2===o)r.returnCode=0,r.type=t.GeometryType.LINE,r.aPoint1=n[0],r.aPoint2=n[1];else if(o>2){for(var a,s=i.sub(n[1],n[0]),c=!0,l=1;c&&l<o;l++)a=i.sub(n[l],n[0]),c=e.isZero(i.length(i.cross(s,a)));if(c){for(var u=0,p=1,h=0,d=i.dot(s,s),m=2;m<o;m++){a=i.sub(n[m],n[0]);var y=i.dot(s,a);y<h?(u=m,h=y):y>d&&(p=m,d=y)}r.returnCode=0,r.type=t.GeometryType.LINE,r.aPoint1=n[u],r.aPoint2=n[p]}}return r},_recognizePlane:function(n){for(var r,o,a={returnCode:1},s=n.length,u=0,p=0,h=1;h<s&&0===p;h++)if(0===u)r=i.sub(n[0],n[h]),i.length(r)>c&&(u=h);else if(0===p&&(o=i.sub(n[0],n[h]),i.length(o)>c)){var d=i.angle(r,o);d>l&&d<Math.PI-l&&(p=h)}if(0!==u&&0!==p){for(var m=i.cross(r,o),y=!0,g=0;y&&g<s;g++)if(0!==g&&g!==u&&g!==p){var f=i.sub(n[0],n[g]),P=i.cross(r,f);if(!e.isZero(i.length(P))){var v=i.angle(m,P);y=!(v>l&&v<Math.PI-l)}}y&&(a.returnCode=0,a.type=t.GeometryType.PLANE,a.aOrigin=n[0],a.aNormal=i.normalize(m))}return a},_recognizeCircle:function(n){var r={returnCode:1},o=n.length;if(o>6){var a=u._recognizePlane(n);if(a&&a.type===t.GeometryType.PLANE){var s=a.aNormal,c=Math.floor(2*o/3),l=Math.floor(o/3),p=u._computeCircleThru3Points(n[0],n[l],n[c]);if(0===p.returnCode){for(var h=p.radius,d=p.aCenter,m=!0,y=0;m&&y<o;y++){var g=i.length(i.sub(n[y],d));m=e.areEqual(h,g,"float",.0017)}if(m){r.returnCode=0,r.type=t.GeometryType.CIRCLE,r.radius=p.radius,r.aCenter=p.aCenter,r.aNormal=s,r.length=2*Math.PI*p.radius;var f=i.sub(n[0],p.aCenter),P=Math.ceil(o/2),v=i.sub(n[P-1],p.aCenter),_=i.sub(n[o-1],p.aCenter),T=i.angle(f,v)+i.angle(v,_);r.arcLength=r.length*(T/(2*Math.PI))}}}}return r},_recognizeCylinder:function(e,n,r){var o={returnCode:1},a=r&&r<=e.length?r:e.length,s=!0;if(a>50){var p=u._recognizeCylinder(e,n,50);s=void 0!==p&&void 0!==p.type&&p.type===t.GeometryType.CYLINDER}if(s){var h,d,m,y=!1;if(a>7)for(var g=0;g<a;g++)for(var f=g+1;f<a;f++)if(d=i.cross(n[g],n[f]),y){var P=i.dot(m,d);h=i.add(h,i.multiply(d,P))}else i.length(d)>c&&(y=!0,m=d,h=d);if(h){m=i.normalize(h),h=[0,0,0];for(var v=0,_=[],T=0;T<a;T++)d=i.cross(n[T],m),i.length(d)/i.length(n[T])>.7?(v++,_[T]=1):_[T]=0;var M=!0;if(v>1){for(var C=0;C<a&&1===_[C];C++)for(var b=C+1;b<a&&1===_[b];b++)if(d=i.cross(n[C],n[b]),y){var E=i.dot(m,d);h=i.add(h,i.multiply(d,E))}else i.length(d)>c&&(y=!0,m=d,h=d);h=i.normalize(h);for(var A=0;A<a&&1===_[A]&&M;A++)d=i.cross(n[A],h),1-i.length(d)/i.length(n[A])>l&&(M=!1)}else M=!1;if(c>=i.length(h)&&(M=!1),M){for(var S,x=0,I=[],V=0,D=0,R=0,N=0,L=0;L<a;L++){S=i.dot(i.sub(e[0],e[L]),h);for(var w=i.sub(i.multiply(h,S),e[L]),G=!1,B=0;B<x&&!G;B++){G=i.subAndLength(I[B],w)<c}G||(I[x]=w,x++),S>R&&(R=S,N=L),S<V&&(V=S,D=L)}var O=u._recognizeCircle(I);if(O&&O.type===t.GeometryType.CIRCLE){S=i.dot(i.sub(O.aCenter,e[D]),h);var z=i.add(i.multiply(h,S),O.aCenter);S=i.dot(i.sub(O.aCenter,e[N]),h);var q=i.add(i.multiply(h,S),O.aCenter);o.returnCode=0,o.type=t.GeometryType.CYLINDER,o.radius=O.radius,o.aPoint1=z,o.aPoint2=q}}}}return o},_recognizeCone:function(r,o,a,s){var c={returnCode:1},p=a&&a<=r.length?a:r.length,h=s&&s<=o.length?s:o.length,d=!0;if(p>50){var m=u._recognizeCone(r,o,50,50);d=void 0!==m&&void 0!==m.type&&m.type===t.GeometryType.CONE}if(d){if(3<p){for(var y=[],g=1;g<p;g++)i.areEqual(r[0],r[g])||y.push(r[g]);var f=u._recognizeCircle(y);if(f&&f.type===t.GeometryType.CIRCLE){var P=i.sub(f.aCenter,r[0]);i.areEqual(i.normalize(P),f.aNormal)&&(c.returnCode=0,c.type=t.GeometryType.CONE,c.aApex=r[0],c.aPoint1=r[0],c.aPoint2=f.aCenter,c.aAxis=f.aNormal,c.semiAngle=i.angle(i.sub(r[1],r[0]),P))}}if(0!==c.returnCode&&p===h){for(var v=!1,_=-1,T=-1,M=-1,C=-1,b=0;b<h&&!v;b++)for(var E=b+1;E<h&&!v;E++)i.areEqual(o[b],o[E])&&!i.areEqual(r[b],r[E])&&(0>_?(_=b,M=E):i.areEqual(o[_],o[b])||(T=b,C=E,v=!0));if(0<=_&&0<=M&&0<=T&&0<=C){var A,S,x=i.sub(r[_],r[M]),I=i.cross(x,o[_]),V=i.sub(r[T],r[C]),D=i.cross(V,o[T]),R=!1,N=i.angle(I,D);if(N>l&&N<Math.PI-l){if(0===(A=n.computeLinePlaneDistance(r[_],x,r[T],D)).returnCode&&A.relationship===t.Relationship.INTERSECTING)0===(S=n.computeLinePlaneDistance(r[_],o[_],r[T],D)).returnCode&&S.relationship===t.Relationship.INTERSECTING&&(R=!0,c.aApex=A.aPosition,c.aAxis=i.normalize(i.sub(A.aPosition,S.aPosition)))}else if(0===(A=n.computeTwoLinesDistance(r[_],x,r[T],V)).returnCode&&A.relationship===t.Relationship.INTERSECTING)0===(S=n.computeTwoLinesDistance(r[_],o[_],r[T],o[T])).returnCode&&S.relationship===t.Relationship.INTERSECTING&&(R=!0,c.aApex=A.aPosition1,c.aAxis=i.normalize(i.sub(A.aPosition1,S.aPosition1)));if(R&&c.aAxis){c.semiAngle=i.angle(x,c.aAxis);for(var L=0;L<p&&R;L++)P=i.sub(c.aApex,r[L]),N=i.angle(P,c.aAxis),R=e.areEqual(c.semiAngle,N);if(R){c.returnCode=0,c.type=t.GeometryType.CONE;var w=u._computeMinMaxProjection(r,c.aAxis,c.aApex);c.aPoint1=w.aPoint1,c.aPoint2=w.aPoint2}}}}}return c},_recognizeSphere:function(n,r){var o={returnCode:1},a=n.length;if(a===r.length){for(var s,p,h,d,m,y=0,g=0,f=0,P=1;P<a&&0===f;P++)0===y?(s=i.sub(n[0],n[P]),i.length(s)>c&&(y=P)):0===g?(p=i.sub(n[0],n[P]),i.length(p)>c&&(m=i.angle(s,p))>l&&m<Math.PI-l&&(g=P,d=i.cross(s,p))):0===f&&(h=i.sub(n[0],n[P]),i.length(h)>c&&(m=i.angle(d,i.cross(s,h)))>l&&m<Math.PI-l&&(f=P));if(0!==y&&0!==g&&0!==f){var v=u._computeSphereThru4Points(n[0],n[y],n[g],n[f]);if(0===v.returnCode){for(var _,T,M=!0,C=0;C<a&&M;C++)T=i.sub(n[C],v.aCenter),_=i.length(T),M=e.areEqual(v.radius,_)&&i.areEqual(i.normalize(T),i.normalize(r[C]));M&&(o.returnCode=0,o.type=t.GeometryType.SPHERE,o.aCenter=v.aCenter,o.radius=v.radius)}}}return o},_recognizeCurve:function(e,n){var r={returnCode:0};if(r.type=t.GeometryType.CURVE,r.length=0,n){for(var o=e.length,a=0,s=0;s<o;s+=2)a+=i.length(i.sub(e[s],e[s+1]));r.length=a,r.aPoint1=e[0],r.aPoint2=e[o-1]}return r},_recognizeSurface:function(n,r){var o={returnCode:1};if(o.type=t.GeometryType.SURFACE,o.area=0,r){for(var a=n.length/3,s=0,c=[0,0,0],l=0;l<a;l++){var u=i.sub(n[3*l],n[3*l+1]),p=i.sub(n[3*l],n[3*l+2]),h=i.length(i.cross(u,p)),d=i.add(n[3*l],i.add(n[3*l+1],n[3*l+2]));s+=h,c=i.multiplyAndAdd(d,h,c)}o.returnCode=0,o.area=s/2,o.aCog=e.isZero(s)?[0,0,0]:i.multiply(c,1/(3*s))}return o},_computeMinMaxProjection:function(e,t,r,o){for(var a,s={returnCode:0},c=e.length,l=i.normalize(t),u=Number.MAX_VALUE,p=-Number.MAX_VALUE,h=[0,0,0],d=0,m=0;m<c;m++)if((a=i.dot(i.sub(r,e[m],h),l))>p&&(p=a),a<u&&(u=a),o){var y=n.computePointLineDistance(e[m],r,t);y.distance>d&&(d=y.distance)}return s.aPoint1=i.multiplyAndAdd(l,u,r),s.aPoint2=i.multiplyAndAdd(l,p,r),o&&(s.baseRadius=d),s},_computeCircleThru3Points:function(e,n,r){var o={returnCode:1},a=i.sub(e,n),s=i.sub(n,r),c=i.cross(a,s);if(i.areEqual(e,n))o.aCenter=i.multiply(i.add(e,r),.5),c=i.cross([0,0,1],s);else if(i.areEqual(e,r))o.aCenter=i.multiply(i.add(e,n),.5),c=i.cross([0,0,1],a);else if(i.areEqual(n,r))o.aCenter=i.multiply(i.add(e,n),.5),c=i.cross([0,0,1],a);else{var l=i.squaredLength(c);if(l>1e-6){var u=(.5*i.squaredLength(s)+.5*i.dot(a,s))/l,p=i.multiplyAndAdd(a,.5,e);o.aCenter=i.multiplyAndAdd(i.cross(a,c),-u,p)}}return void 0!==o.aCenter&&(o.returnCode=0,o.type=t.GeometryType.CIRCLE,o.radius=i.subAndLength(o.aCenter,e),o.aNormal=i.normalize(c)),o},_computeSphereThru4Points:function(e,r,o,a){var s={returnCode:1},c=u._computeCircleThru3Points(e,r,o);if(0===c.returnCode){var l=u._computeCircleThru3Points(r,o,a);if(0===l.returnCode){var p=n.computeTwoLinesDistance(c.aCenter,c.aNormal,l.aCenter,l.aNormal);0===p.returnCode&&p.relationship===t.Relationship.INTERSECTING&&(s.returnCode=0,s.type=t.GeometryType.SPHERE,s.aCenter=p.aPosition1,s.radius=i.subAndLength(s.aCenter,e))}}return s},_buildVector3:function(e){return new a.Vector3(e[0],e[1],e[2])},verifyMesh:function(e){return console.log("DEPRECATED: use WebMeshServices.verifyMesh"),o.verifyMesh(e)},extractMeshVertices:function(e,t){return console.log("DEPRECATED: use WebMeshServices.extractMeshVertices"),o.extractMeshVertices(e,t)},extractMeshNormals:function(e,t){return console.log("DEPRECATED: use WebMeshServices.extractMeshNormals"),o.extractMeshNormals(e,t)},_computeVolume:function(e,t){return console.log("DEPRECATED: use WebMeshServices._computeVolume"),o._computeVolume(e,t)}};return u})),define("DS/WebPolyMaths/WebMathsFiniteGeometry",["DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebMathsInfiniteGeometry","DS/WebPolyMaths/WebGeometryEnums"],(function(e,t,i){"use strict";var n=1e-6,r={computePointSegmentDistance:function(t,r,o,a){var s={returnCode:1};if(t&&r&&o){s.returnCode=2;var c=void 0!==a?a:Number.MAX_VALUE;if(c>n){var l=e.sub(t,r),u=e.sub(r,o),p=-e.dot(l,u);if(p<=0)s.aPosition=e.clone(r),c=e.squaredLength(l);else{var h=e.squaredLength(u);h<n?(s.aPosition=e.clone(r),c=e.squaredLength(l)):(p/=h)>=1?(s.aPosition=e.clone(o),c=e.subAndSquaredLength(o,t)):(s.aPosition=e.multiplyAndAdd(u,p,r),c=e.subAndSquaredLength(s.aPosition,t))}(void 0===a||a>c)&&(s.returnCode=0,s.squaredDistance=c,s.distance=Math.sqrt(c),s.relationship=c<n?i.Relationship.COINCIDENT:i.Relationship.NONE)}}return s},computePointTriangleDistance:function(t,o,a,s,c){var l={returnCode:1};if(t&&o&&a&&s){l.returnCode=2;var u=e.sub(o,a),p=e.squaredLength(u),h=e.sub(o,s),d=e.squaredLength(h),m=e.sub(a,s),y=e.squaredLength(m);if(p<n)l=r.computePointSegmentDistance(t,o,s);else if(d<n||y<n)l=r.computePointSegmentDistance(t,o,a);else{var g=e.sub(t,o),f=e.dot(u,h),P=e.dot(u,g),v=e.dot(h,g),_=p*d-f*f,T=f*v-d*P,M=f*P-p*v;if(T+M<=_)T<0?M<0?P<0?(M=0,T=-P>=p?1:-P/p):(T=0,M=v>=0?0:-v>=d?1:M=-v/d):(T=0,M=v>=0?0:-v>=d?1:-v/d):M<0?(M=0,T=P>=0?0:-P>=p?1:-P/p):(T*=_=1/_,M*=_);else{var C=0,b=0,E=0,A=0;T<0||M<0?(b=d+v)>(C=f+P)?M=1-(T=(E=b-C)>=(A=p-2*f+d)?1:E/A):(T=0,M=b<=0?1:v>=0?0:-v/d):M=1-(T=(E=d+v-f-P)<=0?0:E>=(A=p-2*f+d)?1:E/A)}l.aPosition=e.multiplyAndAdd(h,M,e.multiplyAndAdd(u,T,o)),l.squaredDistance=e.subAndSquaredLength(l.aPosition,t),(void 0===c||l.squaredDistance<c)&&(l.relationship=l.squaredDistance<n?i.Relationship.COINCIDENT:i.Relationship.NONE,l.returnCode=0)}}return l},computeTwoSegmentsDistance:function(t,o,a,s,c){var l={returnCode:1};if(t&&o&&a&&s){if(l.returnCode=2,e.areEqual(t,o))return(l=r.computePointSegmentDistance(t,a,s,c)).angle=0,l.aPosition1=e.clone(t),l.aPosition2=l.aPosition,l;if(e.areEqual(a,s))return(l=r.computePointSegmentDistance(a,t,o,c)).angle=0,l.aPosition1=l.aPosition,l.aPosition2=e.clone(a),l;var u=!1,p=e.sub(t,o),h=e.sub(a,s),d=e.cross(p,h),m=e.squaredLength(d),y=0,g=0,f=0,P=0,v=0,_=0,T=0,M=0,C=0,b=0;if(m>n*e.squaredLength(p)*e.squaredLength(h)){if(f=e.sub(t,a),b=e.dot(f,d),b*=b,void 0!==c&&b>c*m)return l;var E=e.cross(d,f);_=e.dot(E,p),T=e.dot(E,h);var A=!1;_<=0?v=e.clone(a):_>=m?v=e.clone(s):A=1;var S=!1;if(T<=0?P=e.clone(t):T>=m?P=e.clone(o):S=1,A||S)if(M=0,A&&S){var x=1/m;_*=x,T*=x,v=e.multiplyAndAdd(h,_,a),P=e.multiplyAndAdd(p,T,t),b*=x}else if(A){if(y=e.sub(a,P),M=e.squaredLength(h),d=e.cross(h,y),b=e.squaredLength(d),void 0!==c&&b>c*M)return l;if((C=e.dot(h,y))<=0){if(v=e.clone(a),b=e.squaredLength(e.sub(v,P)),void 0!==c&&b>c*M)return l}else if(C>=M){if(v=e.clone(s),b=e.squaredLength(e.sub(v,P)),void 0!==c&&b>c*M)return l}else b*=M=1/M,C*=M,v=e.multiplyAndAdd(h,C,a)}else{if(g=e.sub(v,t),M=e.squaredLength(p),d=e.cross(p,g),b=e.squaredLength(d),void 0!==c&&b>c*M)return l;if((C=-(C=e.dot(p,g)))<=0){if(P=e.clone(t),b=e.squaredLength(e.sub(v,P)),void 0!==c&&b>c*M)return l}else if(C>=M){if(P=e.clone(o),b=e.squaredLength(e.sub(v,P)),void 0!==c&&b>c*M)return l}else b*=M=1/M,C*=M,P=e.multiplyAndAdd(p,C,t)}else{var I;g=e.sub(v,t),T=-e.dot(g,p),M=e.squaredLength(p),T<=0?I=e.clone(t):T>=M?I=e.clone(o):(T/=M,I=e.multiplyAndAdd(p,T,t));var V,D=e.subAndSquaredLength(v,I);y=e.sub(a,P),_=e.dot(y,h),C=e.squaredLength(h),_<=0?V=e.clone(a):_>=C?V=e.clone(s):(_/=C,V=e.multiplyAndAdd(h,_,a));var R=e.subAndSquaredLength(P,V);if(D<=R){if(void 0!==c&&D>c)return l;b=D,P=I}else{if(void 0!==c&&R>c)return l;b=R,v=V}}}else{u=!0,M=e.squaredLength(h),f=e.sub(a,t),_=e.dot(f,h);var N=e.sub(a,o);if(T=e.dot(N,h),M<n||Math.abs(_-T)<n)return l;if(_>M?T>M?(v=e.clone(s),P=T>=_?e.clone(t):e.clone(o)):T>=0?(P=e.clone(o),T/=M,v=e.multiplyAndAdd(h,T,a)):(v=e.clone(a),T=_/(_-T),P=e.multiplyAndAdd(p,T,t)):_<0?T<0?(v=e.clone(a),P=T<_?e.clone(t):e.clone(o)):T<=M?(P=e.clone(o),T/=M,v=e.multiplyAndAdd(h,T,a)):(v=e.clone(a),T=_/(_-T),P=e.multiplyAndAdd(p,T,t)):(P=e.clone(t),_/=M,v=e.multiplyAndAdd(h,_,a)),b=e.squaredLength(e.sub(v,P)),void 0!==c&&b>c)return l}(void 0===c||b<c)&&(l.squaredDistance=b,l.distance=Math.sqrt(b),u?(l.relationship=l.distance<.001?i.Relationship.COINCIDENT:i.Relationship.PARRALLEL,l.angle=0):(l.relationship=l.distance<.001?i.Relationship.INTERSECTING:i.Relationship.NONE,l.angle=e.angle(p,h)),l.aPosition1=P,l.aPosition2=v,l.returnCode=0)}return l},computeSegmentTriangleSquaredDistance:function(o,a,s,c,l,u){var p={returnCode:1};if(o&&a&&s&&c&&l){p.returnCode=2;var h=void 0!==u?u:Number.MAX_VALUE;if(h>n){var d,m,y=!1,g=e.sub(s,c),f=e.sub(s,l),P=e.cross(g,f);e.normalize(P)||(P=e.multiply(P,1e3));var v=e.sub(s,o),_=e.sub(s,a),T=e.dot(P,v),M=e.dot(P,_);if(T>0&&M<0||T<0&&M>0){var C=e.sub(o,a);0===(b=t.computeLinePlaneDistance(o,C,s,P)).returnCode&&b.aPosition&&2!==(b=r.computePointTriangleDistance(b.aPosition,s,c,l,h)).returnCode&&b.relationship===i.Relationship.COINCIDENT&&(h=b.squaredDistance,d=e.clone(b.aPosition),m=e.clone(b.aPosition),y=!0)}if(!y){for(var b,E=[o,a],A=[s,c,l,s],S=0;S<3&&h>n;S++)2!==(b=r.computeTwoSegmentsDistance(o,a,A[S],A[S+1],h)).returnCode&&(h=b.squaredDistance,d=e.clone(b.aPosition1),m=e.clone(b.aPosition2),y=!0);for(var x=0;x<2&&h>n;x++)2!==(b=r.computePointTriangleDistance(E[x],s,c,l,h)).returnCode&&(h=b.squaredDistance,d=e.clone(E[x]),m=e.clone(b.aPosition),y=!0)}y&&(p.returnCode=0,p.squaredDistance=h,p.aPosition1=d,p.aPosition2=m,p.angle=0,p.relationship=p.squaredDistance<n?i.Relationship.INTERSECTING:i.Relationship.NONE)}}return p},computeTwoTrianglesSquaredDistance:function(t,o,a,s,c,l,u){var p={returnCode:1};if(t&&o&&s&&c&&l){p.returnCode=2;var h=void 0!==u?u:Number.MAX_VALUE;if(h>n){for(var d,m,y,g=[t,o,a,t],f=[s,c,l,s],P=!1,v=0;v<3&&h>n;v++)2!==(y=r.computeSegmentTriangleSquaredDistance(g[v],g[v+1],s,c,l,h)).returnCode&&(h=y.squaredDistance,d=e.clone(y.aPosition1),m=e.clone(y.aPosition2),P=!0);for(var _=0;_<3&&h>n;_++)2!==(y=r.computeSegmentTriangleSquaredDistance(f[_],f[_+1],t,o,a,h)).returnCode&&(h=y.squaredDistance,d=e.clone(y.aPosition2),m=e.clone(y.aPosition1),P=!0);P&&(p.returnCode=0,p.squaredDistance=h,p.aPosition1=d,p.aPosition2=m,p.angle=0,p.relationship=i.Relationship.NONE)}}return p}};return r})),define("DS/WebPolyMaths/WebMeshMeasure",["DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebMathsFiniteGeometry","DS/WebPolyMaths/WebMathsBoundingGeometry","DS/WebPolyMaths/WebMeshServices"],(function(e,t,i,n){"use strict";var r=1e-6,o={computePointMeshSquaredDistance:function(e,t,i,r){var a={returnCode:1};if(t&&t.getGroup()&&t.getGroup().geometry&&void 0!==t.getStart()&&void 0!==t.getCount()&&t.getCount()>0){var s=t.getCount(),c=t.getGroup().glType,l=n.extractMeshVertices(t,i.elements),u=1===c?s/2:s/3;1===c?a=o._computePointCurveSquaredDistance(e,u,l,r):4===c&&(a=o._computePointSurfaceSquaredDistance(e,u,l,r))}return a},_computePointMeshSquaredMaxDistance:function(t,r,o,a){var s={returnCode:1};if(r&&r.getGroup()&&r.getGroup().geometry&&void 0!==r.getStart()&&void 0!==r.getCount()&&r.getCount()>0){s.returnCode=2;var c,l=n.extractMeshVertices(r,o.elements,void 0,!0),u=l.length,p=a||0,h=[0,0,0],d=i.computeAABBForPoint(t),m=i.computeAABBForPoints(l),y=i.computeAABBSquaredMaxDistance(d,m);if(y>p){for(var g=0;g<u;g++)(y=e.subAndSquaredLength(t,l[g],h))>p&&(p=y,c=e.clone(l[g]),s.returnCode=0);0===s.returnCode&&(s.squaredMaxDistance=p,s.aPosition1=t,s.aPosition2=c)}}return s},computeTwoMeshesSquaredDistance:function(e,t,i,r,a){var s={returnCode:1},c=e&&e.getGroup()&&e.getGroup().geometry&&void 0!==e.getStart()&&void 0!==e.getCount()&&e.getCount()>0,l=i&&i.getGroup()&&i.getGroup().geometry&&void 0!==i.getStart()&&void 0!==i.getCount()&&i.getCount()>0;if(c&&l){var u=e.getCount(),p=e.getGroup().glType,h=n.extractMeshVertices(e,t.elements),d=1===p?u/2:u/3,m=i.getCount(),y=i.getGroup().glType,g=n.extractMeshVertices(i,r.elements),f=1===y?m/2:m/3;if(1===p)1===y?s=o._computeTwoCurvesSquaredDistance(d,h,f,g,a):4===y&&(s=o._computeCurveSurfaceSquaredDistance(d,h,f,g,a));else if(4===p)if(1===y){var P=(s=o._computeCurveSurfaceSquaredDistance(f,g,d,h,a)).aPosition1;s.aPosition1=s.aPosition2,s.aPosition2=P}else 4===y&&(s=o._computeSurfaceSurfaceSquaredDistance(d,h,f,g,a))}return s},_computeTwoMeshesSquaredMaxDistance:function(t,r,o,a,s){var c={returnCode:1},l=t&&t.getGroup()&&t.getGroup().geometry&&void 0!==t.getStart()&&void 0!==t.getCount()&&t.getCount()>0,u=o&&o.getGroup()&&o.getGroup().geometry&&void 0!==o.getStart()&&void 0!==o.getCount()&&o.getCount()>0;if(l&&u){c.returnCode=2;var p,h,d=n.extractMeshVertices(t,r.elements),m=d.length,y=n.extractMeshVertices(o,a.elements),g=y.length,f=s||0,P=[0,0,0],v=i.computeAABBForPoints(d),_=i.computeAABBForPoints(y),T=i.computeAABBSquaredMaxDistance(v,_);if(T>f){for(var M=0;M<m;M++)for(var C=0;C<g;C++)(T=e.subAndSquaredLength(d[M],y[C],P))>f&&(f=T,p=e.clone(d[M]),h=e.clone(y[C]),c.returnCode=0);0===c.returnCode&&(c.squaredMaxDistance=f,c.aPosition1=p,c.aPosition2=h)}}return c},_computePointCurveSquaredDistance:function(n,o,a,s){var c={returnCode:1};if(void 0!==o&&a){c.returnCode=2;for(var l,u=s||Number.MAX_VALUE,p=i.computeAABBForPoint(n),h=0;h<o&&u>r;h++){var d=i.computeAABBForSegment(a[2*h],a[2*h+1]);if(i.computeAABBSquaredDistance(p,d)<u){var m=t.computePointSegmentDistance(n,a[2*h],a[2*h+1],u);2!==m.returnCode&&(c.returnCode=0,u=m.squaredDistance,l=e.clone(m.aPosition))}}0===c.returnCode&&(c.squaredDistance=u,c.aPosition1=n,c.aPosition2=l)}return c},_computePointSurfaceSquaredDistance:function(n,o,a,s){var c={returnCode:1};if(void 0!==o&&a){c.returnCode=2;for(var l,u=s||Number.MAX_VALUE,p=i.computeAABBForPoint(n),h=0;h<o&&u>r;h++){var d=i.computeAABBForTriangle(a[3*h],a[3*h+1],a[3*h+2]);if(i.computeAABBSquaredDistance(p,d)<u){var m=t.computePointTriangleDistance(n,a[3*h],a[3*h+1],a[3*h+2],u);2!==m.returnCode&&(c.returnCode=0,u=m.squaredDistance,l=e.clone(m.aPosition))}}0===c.returnCode&&(c.squaredDistance=u,c.aPosition1=n,c.aPosition2=l)}return c},_computeTwoCurvesSquaredDistance:function(n,o,a,s,c){var l={returnCode:1};if(void 0!==n&&o&&void 0!==a&&s){l.returnCode=2;for(var u,p,h=c||Number.MAX_VALUE,d=0;d<n&&h>r;d++)for(var m=i.computeAABBForSegment(o[2*d],o[2*d+1]),y=0;y<a&&h>r;y++){var g=i.computeAABBForSegment(s[2*y],s[2*y+1]);if(i.computeAABBSquaredDistance(m,g)<h){var f=t.computeTwoSegmentsDistance(o[2*d],o[2*d+1],s[2*y],s[2*y+1],h);2!==f.returnCode&&(l.returnCode=0,h=f.squaredDistance,u=e.clone(f.aPosition1),p=e.clone(f.aPosition2))}}0===l.returnCode&&(l.squaredDistance=h,l.aPosition1=u,l.aPosition2=p)}return l},_computeCurveSurfaceSquaredDistance:function(n,o,a,s,c){var l={returnCode:1};if(void 0!==n&&o&&void 0!==a&&s){l.returnCode=2;for(var u,p,h=c||Number.MAX_VALUE,d=0;d<n&&h>r;d++)for(var m=i.computeAABBForSegment(o[2*d],o[2*d+1]),y=0;y<a&&h>r;y++){var g=i.computeAABBForTriangle(s[3*y],s[3*y+1],s[3*y+2]);if(i.computeAABBSquaredDistance(m,g)<h){var f=t.computeSegmentTriangleSquaredDistance(o[2*d],o[2*d+1],s[3*y],s[3*y+1],s[3*y+2],h);2!==f.returnCode&&(l.returnCode=0,h=f.squaredDistance,u=e.clone(f.aPosition1),p=e.clone(f.aPosition2))}}0===l.returnCode&&(l.squaredDistance=h,l.aPosition1=u,l.aPosition2=p)}return l},_computeSurfaceSurfaceSquaredDistance:function(n,o,a,s,c){var l={returnCode:1};if(void 0!==n&&o&&void 0!==a&&s){l.returnCode=2;var u,p,h,d,m,y,g=c||Number.MAX_VALUE,f=[];n>a?(u=n,p=a,h=o,d=s):(u=a,p=n,h=s,d=o);for(var P=0;P<u&&g>r;P++)for(var v=i.computeAABBForTriangle(h[3*P],h[3*P+1],h[3*P+2]),_=0;_<p&&g>r;_++){if(void 0===f[_]&&(f[_]=i.computeAABBForTriangle(d[3*_],d[3*_+1],d[3*_+2])),i.computeAABBSquaredDistance(v,f[_])<g){var T=t.computeTwoTrianglesSquaredDistance(h[3*P],h[3*P+1],h[3*P+2],d[3*_],d[3*_+1],d[3*_+2],g);2!==T.returnCode&&(l.returnCode=0,g=T.squaredDistance,m=e.clone(T.aPosition1),y=e.clone(T.aPosition2))}}0===l.returnCode&&(l.squaredDistance=g,n>a?(l.aPosition1=m,l.aPosition2=y):(l.aPosition1=y,l.aPosition2=m))}return l},_computePointCurveSquaredMaxDistance:function(n,o,a,s){var c={returnCode:1};if(void 0!==o&&a){c.returnCode=2;for(var l,u=s||Number.MAX_VALUE,p=i.computeAABBForPoint(n),h=0;h<o&&u>r;h++){var d=i.computeAABBForSegment(a[2*h],a[2*h+1]);if(i.computeAABBSquaredMaxDistance(p,d)<u){var m=t.computePointSegmentDistance(n,a[2*h],a[2*h+1],u);2!==m.returnCode&&(c.returnCode=0,u=m.squaredMaxDistance,l=e.clone(m.aPosition))}}0===c.returnCode&&(c.squaredMaxDistance=u,c.aPosition1=n,c.aPosition2=l)}return c}};return o})),define("DS/WebPolyMaths/WebToolsSceneGraph",["DS/Visualization/PathElement","DS/Visualization/SubElement","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/Visualization/IdPath","DS/Visualization/IdPathMatcher","DS/Visualization/ThreeJS_DS","DS/WebPolyMaths/WebToolsMaths"],(function(e,t,i,n,r,o,a){"use strict";var s=void 0,c={callPad3DViewerModelServices:function(e,t){return!s&&require.defined("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices")&&(s=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices")),s&&e&&s[e]?s[e](t):void 0},isReference:function(e){var t=!1;return e&&((t=c.callPad3DViewerModelServices("isReference",e))||(t=void 0!==e.productType?"Reference3D"===e.productType||"ReferenceRep"===e.productType:t),t||(t=void 0!==e.isPLMReference?e.isPLMReference():t)),t},isRepReference:function(e){var t=!1;return e&&((t=c.callPad3DViewerModelServices("isRepReference",e))||(t=void 0!==e.productType?"RepReference3D"===e.productType||"ReferenceRep"===e.productType:t),t||(t=void 0!==e.isPLMRepReference?e.isPLMRepReference():t)),t},isRepInstance:function(e){var t=!1;return e&&((t=c.callPad3DViewerModelServices("isRepInstance",e))||(t=void 0!==e.productType?"RepInstance3D"===e.productType||"InstanceRep"===e.productType:t),t||(t=void 0!==e.isPLMRepInstance?e.isPLMRepInstance():t)),t},isInstance:function(e){var t=!1;return e&&((t=c.callPad3DViewerModelServices("isInstance",e))||(t=void 0!==e.productType?"Instance3D"===e.productType||"InstanceRep"===e.productType:t),t||(t=void 0!==e.isPLMInstance?e.isPLMInstance():t)),t},isReferenceOrInstance:function(e,t){var i=c.isReference(e);return i||(i=c.isInstance(e)),i||(i=c.isRepInstance(e)),!i&&t&&(i=c.isRepReference(e)),i},isLeaf:function(e,t){var i=!0;if(t&&c.isPLMNode(e))(i=c.is3DLeaf(e))||(i=c.isRepReference(e));else if(e){for(var n=!1,r=0;r<e.children.length;r++)if(c.isReferenceOrInstance(e.children[r],t)){n=!0;break}i=!n}return i},is3DLeaf:function(e){var t=c.callPad3DViewerModelServices("is3DLeaf",e);return!t&&e&&e.is3DLeaf&&(t=e.is3DLeaf()),t},isPLMNode:function(e,t){var i=c.callPad3DViewerModelServices("isPLMNode",e);return i||t||(i=c.isReferenceOrInstance(e,!0)),i},isAModelPath:function(e){return c.callPad3DViewerModelServices("isAModelPath",e)},getNodeType:function(e){var t=c.callPad3DViewerModelServices("getNodeType",e);return!t&&e&&e.getType&&(t=e.getType()),t},getNodeID:function(e){var t=c.callPad3DViewerModelServices("getNodeID",e);return t||(t=e&&"string"==typeof e.persistentId?e.persistentId:t),t||(t=e&&e.getID?e.getID():t),"string"==typeof t?t:""},isVisible:function(e,t){var i=!1;if(t&&e){var n=e.getSceneGraphOverrideSetManager().getCurrentVisibility(t);i=null==n||n}return i},parseForLeafNodes:function(e,t,i,n){if(e&&t){var r=e.clone(),o=r.getChildrenPathes();if(c.isLeaf(r.getLastElement(!0),!0)||0===o.length)c.isVisible(t,r)?i&&i.push(r):n&&n.push(r);else for(var a=0;a<o.length;a++)c.isReferenceOrInstance(o[a].getLastElement(!0),!0)&&(c.isVisible(t,o[a])?c.parseForLeafNodes(o[a],t,i,n):n&&n.push(o[a].clone()))}},parseForLeafNodesOfScene:function(e,t,i){for(var n=e?e.getRootBagPath().getChildrenPathes():[],r=0;r<n.length;r++)c.parseForLeafNodes(n[r],e.getViewer(),t,i)},getName:function(e,t,i,n){var r=n||"";if(e&&t){for(var o=[],a=[],s=!0,l=e.length,u=0;u<l;u++){var p=e[u],h=c.callPad3DViewerModelServices("getNodeID",p);h?(s=!1,(c.isInstance(p)||c.isRepInstance(p))&&(p=p.children[0]),a.push(h),o.push(r)):o.push(p.name)}if(t(o),!s){var d=[];for(u=0;u<a.length;u++){for(var m=!1,y=0;!m&&y<u;y++)m=a[u]===a[y];m||d.push(a[u])}var g=i.getController(),f="ds6w:label";g.getAttributes({ids:d,attributes:[f],callbacks:{onComplete:function(e){o=[];for(var i=0;i<a.length;i++){var n=e[a[i]];o.push(n[f])}t(o)},onFailure:function(){return null}}})}}},getNameWithInstances:function(e,t,i,n,r){var o=r;if(e&&t){var a,s=[],l=e;if(l){var u=c.getLastReference(l),p=u.getLastElement(!0);if(c.isPLMNode(p)&&(c.isReference(p)||c.is3DLeaf(p))){a={pathElement:l,idRef:c.getNodeID(p)},s.push(a.idRef);var h=c.getLastInstance(u).getLastElement(!0);c.isPLMNode(h)&&c.isInstance(h)&&s.push(a.idInst=c.getNodeID(h))}}if(!s.length)return;i.getController().getAttributes({ids:s,attributes:["ds6w:label"],callbacks:{onComplete:function(e){i=void 0;var i=e[a.idRef]?e[a.idRef]["ds6w:label"]:"";a.idInst&&e[a.idInst]&&e[a.idInst]["ds6w:label"]&&(i+=" ("+e[a.idInst]["ds6w:label"]+")"),t({name:i,forPathNum:o})},onFailure:function(){return null}}})}},getRoots:function(e){var t=c.callPad3DViewerModelServices("getRoots",e);return void 0===t&&e.getRoots&&(t=e.getRoots()),t},getProductRoots:function(e){var t=[];return c._recursiveGetProductRoots(e.getRootNode(),t,!0),t},_recursiveGetProductRoots:function(e,t,i){for(var n=e.children,r=n.length,o=0;o<r;o++)if(!0===c.isReference(n[o])){if(!i){t.push(e);break}t.push(n[o])}else c._recursiveGetProductRoots(n[o],t,!1)},getRootReferences:function(e){var t=[];return c._recursiveGetRootReferences(e.getRootNode(),t),t},_recursiveGetRootReferences:function(e,t){if(c.isReference(e)||c.isRepReference(e))t.push(e);else for(var i=e.children,n=i.length,r=0;r<n;r++)c._recursiveGetRootReferences(i[r],t)},getSceneRoot:function(e){return e.getRootNode()},getViewerRoot:function(e){return e.getRootNode()},getRootBag:function(e){var t=require("DS/PADUtils/PADContext").get();return t&&t.getViewer()===e?t.getRootBagPath().getElement(0):e.getRootNode().getChildByName("RootBag")},recursiveGetPathElementVisibility:function(e,t){var i;if(e.hasSceneGraphOverrideSet()){var n=e.getSceneGraphOverrideSetManager();if(n)for(var r=n.getNumberOfSceneGraphOverrideSets(),o=0;o<r;o++){var a=n.getSceneGraphOverrideSetAt(o);if(a){var s=a.getOverridesFromPathElement(t);if(s)for(var l=0;l<s.length&&null===(i=s[l].getVisibility());l++);else{var u=t.getChildrenPathes();for(l=0;l<u.length&&null===(i=c.recursiveGetPathElementVisibility(e,u[l]));l++);}}}else if(e&&t&&e.sceneGraphState&&null===(i=e.sceneGraphState.getAppliedVisibility(t))){var p=t.getChildrenPathes();for(l=0;l<p.length&&null===(i=c.recursiveGetPathElementVisibility(e,p[l]));l++);}}return i},isVisible:function(e,t){var i=!1;if(t&&e){var n=e.getSceneGraphOverrideSetManager().getCurrentVisibility(t);i=null==n||n}return i},getFirstReference:function(t){for(var i=new e,n=t.getLength(),r=0;r<n;r++){var o=t.getElement(r);if(c.isReference(o)||c.isRepReference(o)){i.addElement(o);break}}return i},getLastReference:function(t){return t.getLength()>1?c.isReference(t.getLastElement(!0))?t.clone():c.getLastReference(t.getParentPath()):new e},getLastRepReference:function(t){return t.getLength()>1?c.isRepReference(t.getLastElement(!0))?t.clone():c.getLastRepReference(t.getParentPath()):new e},getLastInstance:function(t){return t.getLength()>1?c.isInstance(t.getLastElement(!0))||c.isRepInstance(t.getLastElement(!0))?t.clone():c.getLastInstance(t.getParentPath()):new e},truncatePathElement:function(t,i){for(var n=new e,r=Math.min(t.getLength(),i),o=0;o<r;o++)n.addElement(t.getElement(o));return n},buildPathElement:function(t){for(var i=new e,n=[],r=t;r&&!r.notAllowedInPathElement;)n.splice(0,0,r),r=r.parents[0];return i.setFromArray(n),i},isDescendant:function(e,t){var i=!1,n=e.getLength();if(t.getLength()>=n){i=!0;for(var r=0;i&&r<n;r++)i=t.getElement(r)===e.getElement(r)}return i},getAllOthers:function(e){for(var t=[],i=e;i&&this.isReferenceOrInstance(i.getLastElement());)t=t.concat(this._getBrothers(i)),i=i.getParentPath();return t},_getBrothers:function(e){var t=[],i=e.getParentPath();return i&&(t=i.getChildrenPathes(e)),t},getRenderables:function(e,t){return e._getRenderableOccurrences(t)},getRootBagId:function(){var e=require("DS/PADUtils/PADContext").get();return e&&e.getController()&&e.getController().getRootBagId?e.getController().getRootBagId():"rootBag"},getContextViewer:function(e){var t=require("DS/PADUtils/PADContext").get();return t&&t.getViewer()===e.viewer?t:null},initIdPathMatcher:function(e){var t=function(e,i){if(c.getNodeID(i)===e)return i;var n,r=i.children;if(r&&r.length)for(var o=0;o<r.length;o++)if(n=t(e,r[o]))return n};e.setIdPathMatcher(new r({idToNodeCB:function(i){var n=require("DS/PADUtils/PADContext").get();if(n)return i===c.getRootBagId()?c.getRootBag(e):n&&n.getController().getNode({id:i})?n.getController().getNode({id:i}):t(i,c.getRootBag(e))},nodeToIdCB:function(t){return t===c.getRootBag(e)?c.getRootBagId():c.getNodeID(t)},isNodeRepRefCB:function(t){return t!==c.getRootBag(e)&&c.isRepReference(t)}}))},createSceneGraphOverrideSet:function(e){e.getIdPathMatcher()||c.initIdPathMatcher(e);var t,n=e.getSceneGraphOverrideSetManager(),r=c.getRootBag(e);return r&&n&&(t=new i(r,c.getRootBagId()),n.pushSceneGraphOverrideSet(t)),t},ensurePriorityOfSceneGraphOverrideSet:function(e,t){if(e&&t){var i=e.getSceneGraphOverrideSetManager();i&&i.getSceneGraphOverrideSetIndex(t)!==i.getNumberOfSceneGraphOverrideSets()-1&&(i.removeSceneGraphOverrideSet(t),i.pushSceneGraphOverrideSet(t))}},removeSceneGraphOverrideSet:function(e,t){if(e&&t){var i=e.getSceneGraphOverrideSetManager();i&&i.removeSceneGraphOverrideSet(t)}},getIdPath:function(e){var t=[];return e&&e.externalPath.forEach((function(e){if("RootBag"!==e.name){var i=c.getNodeID(e);i&&c.isPLMNode(e)&&t.push(i)}})),t},getOverrides:function(e,t,i){var r,o,a,s=[];if(e&&t)if(t.pathElements&&t.pathElements.length)t.pathElements.forEach((function(t){if(o=t.clone(),e._viewers[0]){var n=c.getRootBag(e._viewers[0].viewer);o.getElement(0).id!==n.id&&o.externalPath.unshift(n)}(r=e.getUniqueOverrideFromPathElement(o))||i||(r=e.createOverride({pathes:[o]})),r&&s.push(r)}));else if(t.idPaths&&t.idPaths.length){var l=c.getRootBagId();t.idPaths.forEach((function(t){Array.isArray(t)&&((o=t.slice())[0]!==l&&o.unshift(l),a=new n(o),(r=e.getUniqueOverrideFromIdPath(a))||i||(r=e.createIdPathOverride({idPathes:[a]})),r&&s.push(r))}))}return s},removeOverride:function(e,t){if(e&&t){var i;if(t.pathElement){var r=t.pathElement.clone();if(e._viewers[0]){var o=c.getRootBag(e._viewers[0].viewer);r.getElement(0).id!==o.id&&r.externalPath.unshift(o)}i=e.getUniqueOverrideFromPathElement(r)}else if(t.idPath){var a=t.idPath.slice(),s=c.getRootBagId();a[0]!==s&&a.unshift(s),i=e.getUniqueOverrideFromIdPath(new n(a))}i&&e.deleteOverride(i)}},computeBoundingBox:function(e,t){var i,n,r,o=0;if(t&&(o=t.length)>0){var a,s,l;for(r=0;r<o;r++)(l=t[r])&&(a=c.getLastReference(l).getLastElement())&&(n=a.getBoundingBox(),(s=l.getWorldMatrix())&&n.applyMatrix4(s),0===r?i=n:i.mergeWithBox(n))}else{var u=c.getRootReferences(e);for(o=u.length,r=0;r<o;r++)n=u[r].getBoundingBox(),0===r?i=n:i.mergeWithBox(n)}return i},computeBoundingSphere:function(e){var t,i,n,r,o=c.getRootReferences(e);for(n=o.length,r=0;r<n;r++)i=o[r].getBoundingSphere(),t?i&&i.radius&&t.mergeWithSphere(i,t):t=i;return t},getXYAxisDirFromZ:function(e){if(e){var t,i;e.normalize();var n=(t=new o.Vector3(1,0,0).projectOnPlane(e)).length(),r=(i=new o.Vector3(0,1,0).projectOnPlane(e)).length(),s=(new o.Vector3).crossVectors(new o.Vector3(0,0,1),e),c=new o.Vector3(0,0,1).dot(e);return a.areEqual(Math.abs(c),1,"float")?a.areEqual(n,r,"float")?(t.normalize(),i=(new o.Vector3).crossVectors(e,t).normalize()):n<r?(i.normalize(),t=(new o.Vector3).crossVectors(i,e).normalize()):(t.normalize(),i=(new o.Vector3).crossVectors(e,t).normalize()):(t=s.normalize(),i=(new o.Vector3).crossVectors(e,t).normalize()),{xDir:t,yDir:i}}},getMatFromNormWithPos:function(e,t){if(e&&t){var i=e.clone().negate().normalize(),n=c.getXYAxisDirFromZ(i),r=n.xDir,a=n.yDir,s=(new o.Matrix4).makeBasis(r,a,i.negate()),l=(new o.Vector3).copy(t);return s.setPosition(l),s}},checkPathInclusion:function(e,i){let n=!1;if(e.isAParentOf(i)||i.isAParentOf(e)){n=!0;let r=e.getLastElement(),o=i.getLastElement();if(r instanceof t&&o instanceof t){n=!1;let e=r.getPrimitives(),t=o.getPrimitives();for(let i=0,r=e.length;i<r&&!1===n;++i)for(let r=0,o=t.length;r<o;++r)if(e[i].isEqual(t[r])){n=!0;break}}}return n}};return c})),define("DS/WebPolyMaths/WebMeshIntersection",["DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebToolsMaths","DS/WebPolyMaths/WebMathsBoundingGeometry","DS/WebPolyMaths/WebMathsInfiniteGeometry","DS/WebPolyMaths/WebMeshServices","DS/WebPolyMaths/WebMeshMeasure","DS/Visualization/ThreeJS_DS"],(function(e,t,i,n,r,o,a){"use strict";var s=.001,c=1e-6,l={computeSectionCurves:function(t,i,n,r){for(var o,a,s,c,u,p={returnCode:2,nbIntersections:0,nbTotTriangles:0,aPolylines:[]},h=[n[12],n[13],n[14]],d=[n[8],n[9],n[10]],m=-e.dot(h,d),y=t.getCount(),g=t.getStart(),f=t.getGroup().geometry,P=f.vertexIndexArray,v=f.vertexPositionArray,_=[0,0,0],T=[0,0,0],M=[0,0,0],C=[],b=[0,0,0,0,0,0],E=y/3,A=0;A<E;A++){p.nbTotTriangles++,u=3*P[c=g+3*A],_[0]=v[u],_[1]=v[u+1],_[2]=v[u+2],u=3*P[c+1],T[0]=v[u],T[1]=v[u+1],T[2]=v[u+2],u=3*P[c+2],M[0]=v[u],M[1]=v[u+1],M[2]=v[u+2],o=_[0]*d[0]+_[1]*d[1]+_[2]*d[2]+m,a=T[0]*d[0]+T[1]*d[1]+T[2]*d[2]+m,s=M[0]*d[0]+M[1]*d[1]+M[2]*d[2]+m;var S,x=0;if(o>0?a>0?s<=0&&(x=-3):x=s>0?-2:1:a>0?x=s>0?-1:2:s>0&&(x=3),0!==x)!0!==r&&(x=Math.abs(x)),p.nbIntersections++,(S=1===x?l._computeIntersectionTrianglePlane(_,T,M,h,d,b):2===x?l._computeIntersectionTrianglePlane(T,M,_,h,d,b):3===x?l._computeIntersectionTrianglePlane(M,_,T,h,d,b):-1===x?l._computeIntersectionTrianglePlane(_,M,T,h,d,b):-2===x?l._computeIntersectionTrianglePlane(T,_,M,h,d,b):l._computeIntersectionTrianglePlane(M,T,_,h,d,b))&&2===S.length&&C.push([S[0],S[1]])}if(C.length>0){p.returnCode=0,l._mergePolylines(C,r);for(var I=0;I<C.length;I++)l._simplifyPolylinePerpendicularDistance(C[I],4e-4,b);for(var V=C.length,D=0;D<V;D++){for(var R=C[D].length,N=0;N<R;N++)C[D][N]=e.transformPoint(C[D][N],i,C[D][N]);p.aPolylines[D]=C[D]}}return p},_computeIntersectionTrianglePlane:function(e,t,i,n,r,o){var a,c=o||[0,0,0,0,0,0];c[0]=e[0]-t[0],c[1]=e[1]-t[1],c[2]=e[2]-t[2],c[3]=e[0]-i[0],c[4]=e[1]-i[1],c[5]=e[2]-i[2];var l=c[0]*r[0]+c[1]*r[1]+c[2]*r[2],u=c[3]*r[0]+c[4]*r[1]+c[5]*r[2];if(Math.abs(l)>s&&Math.abs(u)>s){var p=(n[0]-e[0])*r[0]+(n[1]-e[1])*r[1]+(n[2]-e[2])*r[2],h=p/l,d=p/u,m=c[0]*h,y=c[1]*h,g=c[2]*h,f=c[3]*d,P=c[4]*d,v=c[5]*d;(Math.abs(m-f)>s||Math.abs(y-P)>s||Math.abs(g-v)>s)&&((a=[])[0]=[m+e[0],y+e[1],g+e[2]],a[1]=[f+e[0],P+e[1],v+e[2]])}return a},_mergePolylines:function(e,t){for(var i,n,r,o,a=!0;a;){a=!1;for(var s=0;s<e.length;s++){i=e[s][0],n=e[s][e[s].length-1];for(var l=s+1;l<e.length;l++)if(r=e[l][0],o=e[l][e[l].length-1],(i[0]-o[0])*(i[0]-o[0])+(i[1]-o[1])*(i[1]-o[1])+(i[2]-o[2])*(i[2]-o[2])<c){for(var u=e[l].length-2;0<=u;u--)e[s].unshift(e[l][u]);i=e[s][0],e.splice(l,1),a=!0,l--}else if((n[0]-r[0])*(n[0]-r[0])+(n[1]-r[1])*(n[1]-r[1])+(n[2]-r[2])*(n[2]-r[2])<c){u=1;for(var p=e[l].length;u<p;u++)e[s].push(e[l][u]);n=e[s][e[s].length-1],e.splice(l,1),a=!0,l--}else if(!0!==t)if((i[0]-r[0])*(i[0]-r[0])+(i[1]-r[1])*(i[1]-r[1])+(i[2]-r[2])*(i[2]-r[2])<c){for(u=1,p=e[l].length;u<p;u++)e[s].unshift(e[l][u]);i=e[s][0],e.splice(l,1),a=!0,l--}else if((n[0]-o[0])*(n[0]-o[0])+(n[1]-o[1])*(n[1]-o[1])+(n[2]-o[2])*(n[2]-o[2])<c){for(u=e[l].length-2;0<=u;u--)e[s].push(e[l][u]);n=e[s][e[s].length-1],e.splice(l,1),a=!0,l--}}}},_simplifyPolylines:function(e,t=1e-6){for(var i,n,r,o,a=!0,s=function(e,i){return Math.abs(e[0]-i[0])<t&&Math.abs(e[1]-i[1])<t&&Math.abs(e[2]-i[2])<t},c=0;c<e.length;c++)2==e[c].length&&s(e[c][0],e[c][1])&&(e.splice(c,1),c--);for(c=0;c<e.length;c++)if(2==e[c].length){i=e[c][0],n=e[c][1];for(var l=c+1;l<e.length;l++)2==e[l].length&&(r=e[l][0],(s(i,o=e[l][1])&&s(n,r)||s(i,r)&&s(n,o))&&(e.splice(l,1),l--))}for(;a;){a=!1;for(c=0;c<e.length;c++){i=e[c][0],n=e[c][e[c].length-1];for(l=c+1;l<e.length;l++)if(r=e[l][0],o=e[l][e[l].length-1],s(i,r)){for(var u=1,p=e[l].length;u<p;u++)e[c].unshift(e[l][u]);i=e[c][0],e.splice(l,1),a=!0,l--}else if(s(i,o)){for(u=e[l].length-2;0<=u;u--)e[c].unshift(e[l][u]);i=e[c][0],e.splice(l,1),a=!0,l--}else if(s(n,r)){for(u=1,p=e[l].length;u<p;u++)e[c].push(e[l][u]);n=e[c][e[c].length-1],e.splice(l,1),a=!0,l--}else if(s(n,o)){for(u=e[l].length-2;0<=u;u--)e[c].push(e[l][u]);n=e[c][e[c].length-1],e.splice(l,1),a=!0,l--}}}},_simplifyPolylinePerpendicularDistance:function(e,t,i){for(var n,r,o,a,s,l=i||[0,0,0,0,0,0],u=1;u<e.length-1;u++)if(n=e[u-1],r=e[u],o=e[u+1],l[0]=o[0]-n[0],l[1]=o[1]-n[1],l[2]=o[2]-n[2],(a=l[0]*l[0]+l[1]*l[1]+l[2]*l[2])>c&&(s=((r[0]-n[0])*l[0]+(r[1]-n[1])*l[1]+(r[2]-n[2])*l[2])/a,l[3]=l[0]*s+n[0]-r[0],l[4]=l[1]*s+n[1]-r[1],l[5]=l[2]*s+n[2]-r[2],l[3]*l[3]+l[4]*l[4]+l[5]*l[5]<t)){for(var p=u+1;p<e.length;p++)e[p-1]=e[p];e.length=e.length-1,u--}},detectTwoMeshesInterference:function(e,t,i,n,a){var s=1,l=e&&e.getGroup()&&e.getGroup().geometry&&void 0!==e.getStart()&&void 0!==e.getCount()&&e.getCount()>0,u=i&&i.getGroup()&&i.getGroup().geometry&&void 0!==i.getStart()&&void 0!==i.getCount()&&i.getCount()>0;if(l&&u){s=0;var p=e.getGroup().glType,h=i.getGroup().glType;if(4===p&&4===h){var d=e.getCount(),m=r.extractMeshVertices(e,t.elements),y=d/3,g=i.getCount(),f=r.extractMeshVertices(i,n.elements),P=g/3,v=o._computeSurfaceSurfaceSquaredDistance(y,m,P,f,a);s=0===v.returnCode&&v.squaredDistance<c?2:0}}return s},computeRayMeshIntersection:function(t,n,r){var o={returnCode:1,aParameters:[]};if(t&&n&&r&&r.getGroup()&&r.getGroup().glType&&4===r.getGroup().glType){o.returnCode=0;var a=r.getCount(),c=r.getStart(),l=r.getGroup().geometry,u=l.vertexIndexArray,p=l.vertexPositionArray,h=i.computeAABBForUnsortedPoints(a,c,u,p);if(i.intersectAABBWithRay(h,t,n)){var d,m,y,g,f,P,v,_,T,M,C,b,E,A,S,x,I,V,D,R,N=a/3,L=[],w=[0,0,0],G=[!0,!0,!0],B=[!0,!0,!0];for(d=0;d<N;d++)if(f=3*u[g=c+3*d],L[0]=[p[f],p[f+1],p[f+2]],f=3*u[g+1],L[1]=[p[f],p[f+1],p[f+2]],f=3*u[g+2],L[2]=[p[f],p[f+1],p[f+2]],L[3]=L[0],P=L[1][0]-L[0][0],v=L[1][1]-L[0][1],_=L[1][2]-L[0][2],T=L[2][0]-L[0][0],M=L[2][1]-L[0][1],C=L[2][2]-L[0][2],C=L[2][2]-L[0][2],w[0]=v*C-_*M,w[1]=_*T-P*C,w[2]=P*M-v*T,b=w[0]*n[0]+w[1]*n[1]+w[2]*n[2],Math.abs(b)>s&&(E=w[0]*(t[0]-L[0][0])+w[1]*(t[1]-L[0][1])+w[2]*(t[2]-L[0][2]),b>0&&E<0||b<0&&E>0)){for(m=0;m<3;m++)P=L[m][0]-t[0],v=L[m][1]-t[1],_=L[m][2]-t[2],T=L[m+1][0]-t[0],M=L[m+1][1]-t[1],A=(v*(C=L[m+1][2]-t[2])-_*M)*n[0]+(_*T-P*C)*n[1]+(P*M-v*T)*n[2],G[m]=Math.abs(A)<s,B[m]=A>0;if(S=!1,G[0]?(S=!0,x=G[1]?B[2]:G[2]?B[1]:B[1]&&B[2]):G[1]?(S=!0,x=(G[2]||B[2])&&B[0]):G[2]?(S=!0,x=B[0]&&B[1]):B[0]&&B[1]&&B[2]?(S=!0,x=!0):B[0]||B[1]||B[2]||(S=!0,x=!1),S){for(I=e.dot(n,w),V=e.dot(e.sub(t,L[0]),w)/I,x&&(V=-V),D=o.aParameters.length,R=!0,y=0;R&&y<D;y++)R=Math.abs(o.aParameters[y]-V)>s;R&&o.aParameters.push(V)}}}}return o},computeRayIntersection:function(e,t,i,n,r){for(var o=new a.Ray(e,t),s=o.intersectMeshInstances({object:i},n,o.origin,1),c=s[0].object.id,l=[],u=0;u<s.length;u++)c===s[u].object.id&&l.push(s[u]);return r?l:l[0]}};return l})),define("DS/WebPolyMaths/WebMathPlucker",["DS/WebPolyMaths/WebMeshIntersection"],(function(e){"use strict";var t={_buf:{sidesPP:[0,0,0,0,0,0],sidesLL:[0,0,0],Ext:[[[0,0,0,0],[0,0,0,0],[0,0,0,0]],[[0,0,0,0],[0,0,0,0],[0,0,0,0]]],sidesCoP:[[[0,0,0],[0,0,0],[0,0,0]],[[0,0,0],[0,0,0],[0,0,0]]]},newPluckerBuffer:function(){return{E:[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]],P:[0,0,0,0]}},pluckerTriangle:function(e,i,n,r=1e-6){var o=t.newPluckerBuffer();return t.pluckerTriangleBuf(e,i,n,o,r)?o:null},pluckerTriangleBuf:function(e,i,n,r,o=1e-6){return!!(t._pluckerLine(e,i,r.E[0],o)&&t._pluckerLine(i,n,r.E[1],o)&&t._pluckerLine(n,e,r.E[2],o))&&t._pluckerPlane(r.E[0],n,r.P,o)},computeIntersectionTriangleTriangle:function(e,i,n,r=1e-6){var o=t.pluckerTriangle(e[0],e[1],e[2],r),a=t.pluckerTriangle(i[0],i[1],i[2],r);return _computeIntersectionTriangleTriangleBuf(e,o,i,a,n,r)},computeIntersectionTriangleTriangleBuf:function(e,i,n,r,o,a=1e-6){var s=o?[]:null,c=this;let l=c._buf.sidesPP;l[0]=t.pluckerSidePointPlane(e[0],r.P,a),l[1]=t.pluckerSidePointPlane(e[1],r.P,a),l[2]=t.pluckerSidePointPlane(e[2],r.P,a),l[3]=t.pluckerSidePointPlane(n[0],i.P,a),l[4]=t.pluckerSidePointPlane(n[1],i.P,a),l[5]=t.pluckerSidePointPlane(n[2],i.P,a);let u=l[0]+l[1]+l[2],p=l[3]+l[4]+l[5];if(u>=2||u<=-2||p>=2||p<=-2)return{returnCode:!1};if(0==l[0]&&0==l[1]&&0==l[2]||0==l[3]&&0==l[4]&&0==l[5])return c._computeIntersectionCoplanarTriangles(e,i,n,r,o,a);var h=c._computeIntersectionBarTriangle(e[0],l[0],e[1],l[1],i.E[0],r,a,s);return 2!=(h+=c._computeIntersectionBarTriangle(e[1],l[1],e[2],l[2],i.E[1],r,a,s))&&(h+=c._computeIntersectionBarTriangle(e[2],l[2],e[0],l[0],i.E[2],r,a,s)),2!=h&&(h+=c._computeIntersectionBarTriangle(n[0],l[3],n[1],l[4],r.E[0],i,a,s)),2!=h&&(h+=c._computeIntersectionBarTriangle(n[1],l[4],n[2],l[5],r.E[1],i,a,s)),2!=h&&(h+=c._computeIntersectionBarTriangle(n[2],l[5],n[0],l[3],r.E[2],i,a,s)),o?{returnCode:2===h,Segment:s}:{returnCode:2===h}},pluckerSideLineLine:function(e,t,i=0){var n=e[0]*t[3]+e[1]*t[4]+e[2]*t[5]+e[3]*t[0]+e[4]*t[1]+e[5]*t[2];return n<-i?-1:n>i?1:0},pluckerSidePointPlane:function(e,t,i=0){var n=e[0]*t[0]+e[1]*t[1]+e[2]*t[2]-t[3];return n<-i?-1:n>i?1:0},pluckerIntersection:function(e,t,i=1e-6){var n=e[0]*t[0]+e[1]*t[1]+e[2]*t[2];if(n>i||n<-i)return[(e[0]*t[3]+e[4]*t[2]-e[5]*t[1])/n,(e[1]*t[3]+e[5]*t[0]-e[3]*t[2])/n,(e[2]*t[3]+e[3]*t[1]-e[4]*t[0])/n]},_computeIntersectionCoplanarTriangles:function(t,i,n,r,o,a){let s,c,l=this,u=this._buf.Ext,p=this._buf.sidesCoP,h=!1;for(s=0;s<3;++s)l._pluckerPlane(i.E[s],i.P,u[0][s],a),l._pluckerPlane(r.E[s],r.P,u[1][s],a);for(s=0;s<3;++s)for(let e=0;e<3;++e)p[0][s][e]=l.pluckerSidePointPlane(t[s],u[1][e],a),p[1][s][e]=l.pluckerSidePointPlane(n[s],u[0][e],a);var d=o?[]:void 0;for(s=0;s<3&&(o||0==h);++s)c=(s+1)%3,h|=l._clampEdge(t[s],t[c],i.E[s],p[0][s],p[0][c],p[1][0][s],p[1][1][s],p[1][2][s],u[1],d,.01*a,!1),h|=l._clampEdge(n[s],n[c],r.E[s],p[1][s],p[1][c],p[0][0][s],p[0][1][s],p[0][2][s],u[0],d,.01*a,!0);return d&&e._mergePolylines(d),o?{returnCode:h,Segment:d.length>0?d[0]:d}:{returnCode:h}},_clampEdge:function(e,t,i,n,r,o,a,s,c,l,u,p){var h=!1,d=void 0!==l?[]:void 0;return!(Math.abs(o+a+s)>=2)&&(!(p?-1!=n[0]&&-1!=r[0]||-1!=n[1]&&-1!=r[1]||-1!=n[2]&&-1!=r[2]:1==n[0]&&-1!=r[0]||1==r[0]&&-1!=n[0]||1==n[1]&&-1!=r[1]||1==r[1]&&-1!=n[1]||1==n[2]&&-1!=r[2]||1==r[2]&&-1!=n[2])&&(1!=n[0]&&1!=n[1]&&1!=n[2]&&(h=!0,d&&d.push([e[0],e[1],e[2]])),1!=r[0]&&1!=r[1]&&1!=r[2]&&(h=!0,d&&d.push([t[0],t[1],t[2]])),o!=a&&n[0]*r[0]==-1&&(h=!0,d&&d.push(this.pluckerIntersection(i,c[0],u))),a==s||n[1]*r[1]!=-1||0==a&&n[0]*r[0]==-1||(h=!0,d&&d.push(this.pluckerIntersection(i,c[1],u))),s==o||n[2]*r[2]!=-1||0==o&&n[0]*r[0]==-1||0==s&&n[1]*r[1]==-1||(h=!0,d&&d.push(this.pluckerIntersection(i,c[2],u))),l&&h&&l.push(d),h))},_computeIntersectionBarTriangle:function(e,i,n,r,o,a,s,c){if(i!=r){var l=this._buf.sidesLL;if(l[0]=t.pluckerSideLineLine(o,a.E[0],s*s),l[1]=t.pluckerSideLineLine(o,a.E[1],s*s),l[2]=t.pluckerSideLineLine(o,a.E[2],s*s),l[0]*l[1]!=-1&&l[1]*l[2]!=-1&&l[2]*l[0]!=-1){if(null!==c){let l=t.pluckerIntersection(o,a.P,.01*s);if(0===i){let t=Math.abs(o[0])>Math.abs(o[1])?Math.abs(o[0])>Math.abs(o[2])?0:2:Math.abs(o[1])>Math.abs(o[2])?1:2;(o[t]<0&&l[t]<e[t]||o[t]>0&&l[t]>e[t])&&(l[0]=e[0],l[1]=e[1],l[2]=e[2])}else if(0===r){let e=Math.abs(o[0])>Math.abs(o[1])?Math.abs(o[0])>Math.abs(o[2])?0:2:Math.abs(o[1])>Math.abs(o[2])?1:2;(o[e]<0&&l[e]>n[e]||o[e]>0&&l[e]<n[e])&&(l[0]=n[0],l[1]=n[1],l[2]=n[2])}if(!l||!(0===c.length||Math.abs(l[0]-c[0][0])>s||Math.abs(l[1]-c[0][1])>s||Math.abs(l[2]-c[0][2])>s))return 0;c.push(l)}return 1}}return 0},_pluckerLine:function(e,t,i,n){i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i[3]=e[1]*t[2]-e[2]*t[1],i[4]=e[2]*t[0]-e[0]*t[2],i[5]=e[0]*t[1]-e[1]*t[0];var r=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);return r>n&&(i[0]=i[0]/r,i[1]=i[1]/r,i[2]=i[2]/r,i[3]=i[3]/r,i[4]=i[4]/r,i[5]=i[5]/r,!0)},_pluckerPlane:function(e,t,i,n){3==t.length?(i[0]=e[3]-e[1]*t[2]+e[2]*t[1],i[1]=e[4]-e[2]*t[0]+e[0]*t[2],i[2]=e[5]-e[0]*t[1]+e[1]*t[0],i[3]=e[5]*t[2]+e[4]*t[1]+e[3]*t[0]):(i[0]=e[2]*t[1]-e[1]*t[2],i[1]=e[0]*t[2]-e[2]*t[0],i[2]=e[1]*t[0]-e[0]*t[1],i[3]=e[5]*t[2]+e[4]*t[1]+e[3]*t[0]);let r=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);return r>n&&(i[0]/=r,i[1]/=r,i[2]/=r,i[3]/=r,!0)}};return t})),define("DS/WebPolyMaths/WebToolsMeasure",["DS/WebPolyMaths/WebMathsInfiniteGeometry","DS/WebPolyMaths/WebMathsBoundingGeometry","DS/WebPolyMaths/WebGeometryEnums","DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebToolsSceneGraph","DS/WebPolyMaths/WebMeshServices","DS/WebPolyMaths/WebMeshRecognition","DS/WebPolyMaths/WebMeshMeasure","DS/WebPolyMaths/WebToolsMaths","DS/WebPolyMaths/WebMeasureEnums","DS/Visualization/ThreeJS_DS","DS/Visualization/PathElement","DS/Visualization/SubElement","DS/Mesh/MeshUtils"],(function(e,t,i,n,r,o,a,s,c,l,u,p,h,d){"use strict";var m=1e-6,y=.001,g=function(e){var t=r.getLastReference(e);return t&&t.getLastElement(!0)||(t=r.getLastRepReference(e))&&t.getLastElement(!0)?t:e.clone()},f={measureItem:function(e,t,n,o){var a,s={};o&&!0===o&&(a=(new Date).getTime());var c,u=e.getPathElement(),p=e.getLevel();p?(s.product=u.getElement(p-1),c=r.truncatePathElement(u,p)):(c=g(u))&&c.getLastElement(!0)&&(s.product=c.getLastElement(!0));var h=e.getType();if(void 0!==t&&t===l.ViewedType.PRODUCT){e.updateProductMeasurable(),s.type=i.GeometryType.PRODUCT,s.position=e.getSelPoint(),s.aabb=f.retrieveProductAABB(s.product,c.getWorldMatrix()),s.volume=e.getVolume(),s.area=e.getArea(),s.perimeter=e.getPerimeter(),s.cog=e.getCoG(),s.length=e.getLength();var d=e.getPoints();d&&d.beginPoint&&d.endPoint&&(s.startpoint=d.beginPoint,s.endpoint=d.endPoint),s.originPoint=e.getOriginPoint()}else if(void 0!==t&&t===l.ViewedType.POINT||h===i.GeometryType.POINT||h===i.GeometryType.PICKINGPT)s.type=i.GeometryType.POINT,s.position=e.getPoint(),s.position||(s.position=e.getSelPoint());else if(h===i.GeometryType.LINE){s.type=h,s.length=e.getLength();var m=e.getPoints();s.point1=m.beginPoint,s.point2=m.endPoint,s.position=s.point1.clone().add(s.point2).multiplyScalar(.5)}else if(h===i.GeometryType.CIRCLE)s.type=h,s.length=e.getLength(),s.position=e.getSelPoint(),s.radius=e.getRadius(),s.center=e.getCenter(),s.normal=e.getAxis(),s.arcLength=e.getArcLength(),s.arcMidPoint=e.getArcMidPoint();else if(h===i.GeometryType.CYLINDER){s.type=h,s.area=e.getArea(),s.perimeter=e.getPerimeter(),s.cog=e.getCoG(),s.position=e.getSelPoint(),s.radius=e.getRadius();var y=e.getPoints();s.point1=y.beginPoint,s.point2=y.endPoint}else if(h===i.GeometryType.CONE){s.type=h,s.area=e.getArea(),s.perimeter=e.getPerimeter(),s.cog=e.getCoG(),s.position=e.getSelPoint(),s.apex=e.getApex(),s.semiAngle=e.getSemiAngle(),s.axis=e.getAxis();var P=e.getPoints();s.point1=P.beginPoint,s.point2=P.endPoint}else if(h===i.GeometryType.SPHERE)s.type=h,s.area=e.getArea(),s.perimeter=e.getPerimeter(),s.cog=e.getCoG(),s.position=e.getSelPoint(),s.radius=e.getRadius(),s.center=e.getCenter();else if(h===i.GeometryType.PLANE){s.type=h,s.area=e.getArea(),s.perimeter=e.getPerimeter(),s.cog=e.getCoG(),s.position=e.getSelPoint();var v=e.getPlane();s.origin=v.origin,s.normal=v.normal}else h===i.GeometryType.CURVE?(s.type=h,s.length=e.getLength(),s.position=e.getSelPoint()):h===i.GeometryType.SURFACE&&(s.type=h,s.area=e.getArea(),s.perimeter=e.getPerimeter(),s.cog=e.getCoG(),s.position=e.getSelPoint());return o&&!0===o&&console.log("PCS measureItem="+((new Date).getTime()-a)),s},measureProduct:function(e){var t,i={},s=e.getPathElement(),l=e.getLevel();t=l?r.truncatePathElement(s,l):g(s);var p,m=r.getRenderables(t),y=0,f=0,P=0,v=0,_=[0,0,0],T=[0,0,0],M=0,C=[0,0,0],b=[0,0,0],E=[0,0,0],A=0,S=0,x=!1,I=!1,V=m.length;s&&(i.originPoint=new u.Vector3,i.originPoint.getPositionFromMatrix(s.getMatrix()));for(var D=0;D<V;D++)for(var R=m[D].matrix.elements,N=m[D].geometry,L=N.length,w=0;w<L;w++){N[w].startIteration();for(var G=N[w].drawingGroups,B=G.length,O=0;O<B;O++)if(G[O]._geomType&&("FACE"===d.GeomTypeString[G[O]._geomType]||"EDGE"===d.GeomTypeString[G[O]._geomType]||"WIRE_EDGE"===d.GeomTypeString[G[O]._geomType]||"FREE_POINT"===d.GeomTypeString[G[O]._geomType]))for(var z=G[O].getPrimitivesCount(),q=0;q<z;q++){var W=new d.SGPrimitiveHelper;W.set(G[O],q);var U=h.getFromSGNode(W),F=a.recognizeNonCanonicGeometry(W,new u.Matrix4,!0);if("FACE"===d.GeomTypeString[G[O]._geomType]){x=!0;var k=U.getBodyDimension();if(3===k){f+=F.area||0;var X=o._computeVolume(W,E);y+=X.volume||0;var H=n.transformPoint(X.aCog,R);_=n.multiplyAndAdd(H,X.volume,_)}else if(2===k&&0===F.returnCode){P+=F.area,v+=F.perimeter;var Y=n.transformPoint(F.aCog,R);T=n.multiplyAndAdd(Y,F.area,T)}}else if(x||"EDGE"!==d.GeomTypeString[G[O]._geomType]&&"WIRE_EDGE"!==d.GeomTypeString[G[O]._geomType]){if(!x&&!I&&"FREE_POINT"===d.GeomTypeString[G[O]._geomType]&&1===++S&&o.verifyMesh(W)){var j=new u.Matrix4;p=o.extractMeshVertices(W,j.elements)}}else if(I=!0,A++,F.length&&F.length>0&&(M+=F.length,1===A)){if(void 0===F.point1&&void 0===F.point2&&o.verifyMesh(W)){var Z=new u.Matrix4,J=o.extractMeshVertices(W,Z.elements),K=a._recognizeCurve(J,!0);0===K.returnCode&&(F.point1=a._buildVector3(K.aPoint1),F.point2=a._buildVector3(K.aPoint2))}if(F.point1&&F.point2){var Q=[F.point1.x,F.point1.y,F.point1.z],$=[F.point2.x,F.point2.y,F.point2.z];C=n.transformPoint(Q,R),b=n.transformPoint($,R)}}}N[w].endIteration()}return x?(y>0&&(i.volume=y),(f>0||P>0)&&(i.area=y>0?f>0?f:0:P>0?P:0),(y>0||f>0||P>0)&&(_=c.isZero(y)?c.isZero(P)?[0,0,0]:n.multiply(T,1/P):n.multiply(_,1/y),i.cog=new u.Vector3(_[0],_[1],_[2])),v>0&&(i.perimeter=v)):!x&&I&&M>0?(i.length=M,1===A&&(i.startpoint=new u.Vector3(C[0],C[1],C[2]),i.endpoint=new u.Vector3(b[0],b[1],b[2]))):x||I||1!==S||(i.cog=new u.Vector3(p[0][0],p[0][1],p[0][2])),i},measureBetween2DGeometries:function(t,n,r,o,a){var c,p,h={},d=n._type,m=o._type;if("Angle"===t)h=f.measureBetween(n,l.ViewedType.AXIS,o,l.ViewedType.AXIS);else if("Distance"===t)if(c=n.getSelPoint().toArray(),p=o.getSelPoint().toArray(),d===i.GeometryType.CIRCLE&&(c=n.getCenter().toArray(),r=l.ViewedType.CENTER),m===i.GeometryType.CIRCLE&&(p=o.getCenter().toArray(),a=l.ViewedType.CENTER),d!==i.GeometryType.CIRCLE&&d!==i.GeometryType.POINT||m!==i.GeometryType.CIRCLE&&m!==i.GeometryType.POINT){if(d===i.GeometryType.CIRCLE)(h=s.computePointMeshSquaredDistance(c,o.getPrimitive(),o.getReferentialPosition())).type1=l.ViewedType.POINT,h.type2=f.MeasuredType.CURVE,h.distance=Math.sqrt(h.squaredDistance);else if(m===i.GeometryType.CIRCLE){(h=s.computePointMeshSquaredDistance(p,n.getPrimitive(),n.getReferentialPosition())).type1=f.MeasuredType.CURVE,h.type2=l.ViewedType.POINT;var P=h.aPosition1;h.aPosition1=h.aPosition2,h.aPosition2=P,h.distance=Math.sqrt(h.squaredDistance)}else if(d===i.GeometryType.LINE&&m===i.GeometryType.LINE){var v={};if((v=f.measureBetween(n,r,o,a)).position1&&v.position2){var _=o.getPoints().endPoint,T=_.clone().sub(o.getPoints().beginPoint),M=v.position1.clone(),C=e.computePointLineDistance(M.toArray(),_.toArray(),T.toArray());0===C.returnCode&&(v.position2=new u.Vector3(C.aPosition[0],C.aPosition[1],C.aPosition[2]),v.distance=C.distance)}h=v}}else(h=e.computeTwoPointsDistance(c,p)).type2=a,h.type1=r,h.aPosition1=c,h.aPosition2=p;else if("MinimumDistance"===t||"MaximumDistance"===t){if(d===i.GeometryType.CIRCLE&&(r=l.ViewedType.CURVE),m===i.GeometryType.CIRCLE&&(a=l.ViewedType.CURVE),d===i.GeometryType.POINT)c=n.getSelPoint().toArray(),(h="MaximumDistance"===t?s._computePointMeshSquaredMaxDistance(c,o.getPrimitive(),o.getReferentialPosition()):s.computePointMeshSquaredDistance(c,o.getPrimitive(),o.getReferentialPosition())).type1=l.ViewedType.POINT,h.type2=f.MeasuredType.CURVE;else if(m===i.GeometryType.POINT){p=o.getSelPoint().toArray(),(h="MaximumDistance"===t?s._computePointMeshSquaredMaxDistance(p,n.getPrimitive(),n.getReferentialPosition()):s.computePointMeshSquaredDistance(p,n.getPrimitive(),n.getReferentialPosition())).type1=f.MeasuredType.CURVE,h.type2=l.ViewedType.POINT;var b=h.aPosition1;h.aPosition1=h.aPosition2,h.aPosition2=b}else{if(h="MaximumDistance"===t?s._computeTwoMeshesSquaredMaxDistance(n.getPrimitive(),n.getReferentialPosition(),o.getPrimitive(),o.getReferentialPosition()):s.computeTwoMeshesSquaredDistance(n.getPrimitive(),n.getReferentialPosition(),o.getPrimitive(),o.getReferentialPosition()),n._normal&&o._normal){var E=new u.Vector3(h.aPosition1[0],h.aPosition1[1],h.aPosition1[2]),A=new u.Vector3(h.aPosition2[0],h.aPosition2[1],h.aPosition2[2]);Math.abs(n._normal.angleTo(A.clone().sub(E))-Math.PI/2)<y&&(h.aExtension=n._normal.clone().toArray())}if(h.type1=l.ViewedType.CURVE,h.type2=l.ViewedType.CURVE,d===i.GeometryType.LINE&&m===i.GeometryType.LINE){var S=n.getPoints().endPoint.clone().sub(n.getPoints().beginPoint),x=o.getPoints().endPoint.clone().sub(o.getPoints().beginPoint),I=S.normalize().dot(x.normalize());1!==Math.abs(I)&&(h.angle=1)}}h.distance="MaximumDistance"===t?Math.sqrt(h.squaredMaxDistance):Math.sqrt(h.squaredDistance)}if(!h.product1){var V=n.getPathElement();V&&(h.product1=g(V).getLastElement())}if(!h.product2){var D=o.getPathElement();D&&(h.product2=g(D).getLastElement())}return h.aPosition1&&!h.position1&&(h.position1=new u.Vector3(h.aPosition1[0],h.aPosition1[1],h.aPosition1[2])),h.aPosition2&&!h.position2&&(h.position2=new u.Vector3(h.aPosition2[0],h.aPosition2[1],h.aPosition2[2])),h.aExtension&&!h.extensionDirection&&(h.extensionDirection=new u.Vector3(h.aExtension[0],h.aExtension[1],h.aExtension[2])),n.get2DScale&&h.distance&&(h.distance=h.distance/n.get2DScale()),h},measureBetween:function(t,n,r,o,a){var c={};if(n!==l.ViewedType.POINT&&n!==l.ViewedType.AXIS&&n!==l.ViewedType.CENTER&&n!==l.ViewedType.INFPLANE||o!==l.ViewedType.POINT&&o!==l.ViewedType.AXIS&&o!==l.ViewedType.CENTER&&o!==l.ViewedType.INFPLANE)if(n===l.ViewedType.PRODUCT||o===l.ViewedType.PRODUCT){var p=Number.MAX_VALUE;if(t.getSelPoint()&&r.getSelPoint()){var h=e.computeTwoPointsDistance(t.getSelPoint().toArray(),r.getSelPoint().toArray());p=h.distance*h.distance}if(n===l.ViewedType.PRODUCT&&o===l.ViewedType.PRODUCT)(c=f.measureBetweenWithProducts(f.MeasuredType.PRODUCT,t,r,p,a)).type1=n,c.type2=o;else if(n!==l.ViewedType.PRODUCT||o!==i.GeometryType.POINT&&o!==l.ViewedType.CENTER)if(o!==l.ViewedType.PRODUCT||n!==i.GeometryType.POINT&&n!==l.ViewedType.CENTER)if(n===l.ViewedType.PRODUCT){(c=f.measureBetweenWithProducts(f.MeasuredType.MESH,r,t,p,a)).type1=f.MeasuredType.MESH,c.type2=f.MeasuredType.MESH;var d=c.aPosition1;c.aPosition1=c.aPosition2,c.aPosition2=d;var m=c.product1;c.product1=c.product2,c.product2=m}else(c=f.measureBetweenWithProducts(f.MeasuredType.MESH,t,r,p,a)).type1=f.MeasuredType.MESH,c.type2=f.MeasuredType.MESH;else(c=f.measureBetweenWithProducts(f.MeasuredType.POINT,t,r,p,a)).type1=l.ViewedType.POINT,c.type2=o;else{(c=f.measureBetweenWithProducts(f.MeasuredType.POINT,r,t,p,a)).type1=n,c.type2=l.ViewedType.POINT;var P=c.aPosition1;c.aPosition1=c.aPosition2,c.aPosition2=P;var v=c.product1;c.product1=c.product2,c.product2=v}c.distance=Math.sqrt(c.squaredDistance)}else{if(n!==l.ViewedType.POINT&&n!==l.ViewedType.CENTER||o!==l.ViewedType.CURVE&&o!==l.ViewedType.SURFACE&&o!==l.ViewedType.CIRCLE&&o!==l.ViewedType.CYCOSP)if(o!==l.ViewedType.POINT&&o!==l.ViewedType.CENTER||n!==l.ViewedType.CURVE&&n!==l.ViewedType.SURFACE&&n!==l.ViewedType.CIRCLE&&n!==l.ViewedType.CYCOSP){if(c=s.computeTwoMeshesSquaredDistance(t.getPrimitive(),t.getReferentialPosition(),r.getPrimitive(),r.getReferentialPosition()),t._normal&&r._normal){var _=new u.Vector3(c.aPosition1[0],c.aPosition1[1],c.aPosition1[2]),T=new u.Vector3(c.aPosition2[0],c.aPosition2[1],c.aPosition2[2]);Math.abs(t._normal.angleTo(T.clone().sub(_))-Math.PI/2)<y&&(c.aExtension=t._normal.clone().toArray())}c.type1=f.MeasuredType.MESH,c.type2=f.MeasuredType.MESH}else{C=o===l.ViewedType.CENTER?r.getCenter().toArray():r.getSelPoint().toArray();(c=s.computePointMeshSquaredDistance(C,t.getPrimitive(),t.getReferentialPosition())).type1=f.MeasuredType.MESH,c.type2=l.ViewedType.POINT;var M=c.aPosition1;c.aPosition1=c.aPosition2,c.aPosition2=M}else{var C=n===l.ViewedType.CENTER?t.getCenter().toArray():t.getSelPoint().toArray();(c=s.computePointMeshSquaredDistance(C,r.getPrimitive(),r.getReferentialPosition())).type1=l.ViewedType.POINT,c.type2=f.MeasuredType.MESH}c.distance=Math.sqrt(c.squaredDistance)}else c=f.measureBetweenInfinite(t,n,r,o);if(c.type1===f.MeasuredType.MESH){var b=t.getType();b===i.GeometryType.CURVE||b===i.GeometryType.LINE||b===i.GeometryType.CIRCLE?c.type1=l.ViewedType.CURVE:c.type1=l.ViewedType.SURFACE}if(c.type2===f.MeasuredType.MESH){var E=r.getType();E===i.GeometryType.CURVE||E===i.GeometryType.LINE||E===i.GeometryType.CIRCLE?c.type2=l.ViewedType.CURVE:c.type2=l.ViewedType.SURFACE}if(void 0===c.product1){var A=t.getPathElement();A&&(c.product1=g(A).getLastElement())}if(void 0===c.product2){var S=r.getPathElement();S&&(c.product2=g(S).getLastElement())}return c.aPosition1&&(c.position1=new u.Vector3(c.aPosition1[0],c.aPosition1[1],c.aPosition1[2])),c.aPosition2&&(c.position2=new u.Vector3(c.aPosition2[0],c.aPosition2[1],c.aPosition2[2])),c.aExtension&&(c.extensionDirection=new u.Vector3(c.aExtension[0],c.aExtension[1],c.aExtension[2])),c},measureThreepoints:function(e,t,i){var r={},o=e.getSelPoint(),a=t.getSelPoint(),s=i.getSelPoint();if(o&&a&&s){var c=o.toArray(),l=a.toArray(),p=s.toArray(),h=n.sub(c,l),d=n.sub(l,p);r.angle=Math.PI-n.angle(h,d);var y,g=n.cross(h,d);if(r.normal=new u.Vector3(g[0],g[1],g[2]),n.areEqual(c,l))y=n.multiply(n.add(c,p),.5);else if(n.areEqual(c,p))y=n.multiply(n.add(c,l),.5);else if(n.areEqual(l,p))y=n.multiply(n.add(c,l),.5);else{var f=n.squaredLength(g);if(f>m){var P=(.5*n.squaredLength(d)+.5*n.dot(h,d))/f,v=n.multiplyAndAdd(h,.5,c);y=n.multiplyAndAdd(n.cross(h,g),-P,v)}}void 0!==y&&(r.radius=n.subAndLength(y,c),r.center=new u.Vector3(y[0],y[1],y[2]))}return r},measureBetweenInfinite:function(t,r,o,a){for(var s={},c=[t,o],u=[{_selectedType:r},{_selectedType:a}],p=0;p<2;p++){var h,d=c[p].getType();if(u[p].realType=d,u[p]._selectedType===l.ViewedType.POINT)u[p].type=i.GeometryType.POINT,u[p].position=c[p].getSelPoint(),d===i.GeometryType.CIRCLE||d===i.GeometryType.PLANE?u[p].normal=c[p]._normal:d!==i.GeometryType.CYLINDER&&d!==i.GeometryType.SPHERE&&d!==i.GeometryType.CONE&&d!==i.GeometryType.SURFACE||c[p].getSelNormal&&c[p]._selNormal&&(u[p].normal=c[p].getSelNormal());else if(d===i.GeometryType.POINT||d===i.GeometryType.PICKINGPT)u[p].type=i.GeometryType.POINT,u[p].position=c[p].getPoint();else if(d===i.GeometryType.LINE)u[p].type=i.GeometryType.LINE,h=c[p].getPoints(),u[p].position=c[p].getSelPoint(),u[p].direction=h.endPoint.sub(h.beginPoint);else if(d===i.GeometryType.CIRCLE)u[p]._selectedType===l.ViewedType.CENTER?(u[p].type=i.GeometryType.POINT,u[p].position=c[p].getCenter()):(u[p].type=i.GeometryType.LINE,u[p].position=c[p].getCenter(),u[p].direction=c[p].getAxis()),c[p]._normal&&(u[p].normal=c[p]._normal);else if(d===i.GeometryType.CYLINDER)u[p].type=i.GeometryType.LINE,h=c[p].getPoints(),u[p].position=h.beginPoint,u[p].direction=h.endPoint.sub(h.beginPoint);else if(d===i.GeometryType.CONE)u[p].type=i.GeometryType.LINE,h=c[p].getPoints(),u[p].position=h.beginPoint,u[p].direction=h.endPoint.sub(h.beginPoint);else if(d===i.GeometryType.SPHERE)u[p].type=i.GeometryType.POINT,u[p].position=c[p].getCenter();else if(d===i.GeometryType.PLANE){u[p].type=i.GeometryType.PLANE;var m=c[p].getPlane();u[p].origin=c[p].getSelPoint(),u[p].normal=m.normal}}var g,f=u[0],P=u[1],v=!1;(u[0].type===i.GeometryType.LINE&&u[1].type===i.GeometryType.PLANE||u[0].type===i.GeometryType.POINT||u[0].type===i.GeometryType.PICKINGPT)&&(f=u[1],P=u[0],v=!0);var _=[],T=[];if(f.type===i.GeometryType.PLANE)T[0]=l.ViewedType.INFPLANE,P.type===i.GeometryType.PLANE?(T[1]=l.ViewedType.INFPLANE,(g=e.computeTwoPlanesDistance(f.origin.toArray(),f.normal.toArray(),P.origin.toArray(),P.normal.toArray()))&&0===g.returnCode&&(s.distance=g.distance,s.angle=g.angle>Math.PI/2?Math.PI-g.angle:g.angle,s.relationship=g.relationship,g.relationship===i.Relationship.INTERSECTING?(_[0]=n.clone(g.aPosition1),_[1]=n.clone(g.aPosition2)):(_[0]=f.origin.toArray(),_[1]=g.aPosition2))):P.type===i.GeometryType.LINE?(T[1]=l.ViewedType.AXIS,(g=e.computeLinePlaneDistance(P.position.toArray(),P.direction.toArray(),f.origin.toArray(),f.normal.toArray()))&&0===g.returnCode&&(s.distance=g.distance,s.angle=g.angle>Math.PI/2?Math.PI-g.angle:g.angle,s.relationship=g.relationship,g.relationship===i.Relationship.INTERSECTING?(_[0]=g.aPosition,_[1]=g.aPosition):(_[0]=g.aPosition,_[1]=P.position.toArray()),s.aExtension=P.direction.toArray())):(T[1]=l.ViewedType.POINT,(g=e.computePointPlaneDistance(P.position.toArray(),f.origin.toArray(),f.normal.toArray()))&&0===g.returnCode&&(s.distance=g.distance,s.relationship=g.relationship,_[0]=g.aPosition,_[1]=P.position.toArray()));else if(f.type===i.GeometryType.LINE)T[0]=l.ViewedType.AXIS,P.type===i.GeometryType.LINE?(T[1]=l.ViewedType.AXIS,(g=e.computeTwoLinesDistance(f.position.toArray(),f.direction.toArray(),P.position.toArray(),P.direction.toArray()))&&0===g.returnCode&&(s.distance=g.distance,s.angle=g.angle>Math.PI/2?Math.PI-g.angle:g.angle,s.relationship=g.relationship,g.relationship===i.Relationship.INTERSECTING||g.relationship===i.Relationship.NONE?(_[0]=g.aPosition1,_[1]=g.aPosition2,s.aExtension=n.sub(f.position.toArray(),g.aPosition1)):(_[0]=f.position.toArray(),_[1]=g.aPosition2,f.realType===i.GeometryType.CIRCLE||f.realType===i.GeometryType.CYLINDER||f.realType===i.GeometryType.CONE||(f.realType,i.GeometryType.SPHERE)))):(T[1]=l.ViewedType.POINT,(g=e.computePointLineDistance(P.position.toArray(),f.position.toArray(),f.direction.toArray()))&&0===g.returnCode&&(s.distance=g.distance,s.relationship=g.relationship,_[0]=g.aPosition,_[1]=P.position.toArray())),s.aExtension=f.direction.toArray();else if(T[0]=l.ViewedType.POINT,T[1]=l.ViewedType.POINT,_[0]=f.position.toArray(),_[1]=P.position.toArray(),(g=e.computeTwoPointsDistance(_[0],_[1]))&&0===g.returnCode&&(s.distance=g.distance,s.relationship=g.relationship,P.normal&&f.normal)){var M=P.position.clone().sub(f.position),C=f.normal.angleTo(M),b=P.normal.angleTo(M);if(Math.abs(C-b)<y)Math.abs(C-Math.PI/2)<y&&(s.aExtension=f.normal.toArray())}return v?(s.aPosition1=_[1],s.aPosition2=_[0],s.type1=T[1],s.type2=T[0]):(s.aPosition1=_[0],s.aPosition2=_[1],s.type1=T[0],s.type2=T[1]),s},measureBetweenWithProducts:function(e,i,n,o,a){var s,c={};a&&!0===a&&(s=(new Date).getTime());var l=o||Number.MAX_VALUE;c.squaredDistance=l;var u,p,h,d=e===f.MeasuredType.PRODUCT,m=i.getPathElement(),y=i.getLevel();y?(u=m.getElement(y-1),p=r.truncatePathElement(m,y)):u=(p=g(m)).getLastElement();var P,v=n.getPathElement(),_=n.getLevel();_?(h=v.getElement(_-1),P=r.truncatePathElement(v,_)):h=(P=g(v)).getLastElement();var T=!1;if(d){var M,C,b,E=p.externalPath.length,A=P.externalPath.length;E<A?(M=E,C=P,b=p):(M=A,C=p,b=P),T=!0;for(var S=0;T&&S<M;S++)T=C.externalPath[S]===b.externalPath[S]}if(T)c.squaredDistance=0,c.aPosition1=i.getSelPoint().toArray(),c.aPosition2=c.aPosition1,c.product1=u,c.product2=h;else{a&&!0===a&&(d?console.log("Measure Products: "+u.name+" / "+h.name):console.log("Measure Products: "+e+" / "+h.name));var x,I,V=[],D=[],R=[],N=[],L=[],w=[],G=0;if(i.isPartial())for(G=0;G<i._partialPaths.length;G++)V.push(i._partialPaths[G]);else V.push(p);if(n.isPartial())for(G=0;G<n._partialPaths.length;G++)D.push(n._partialPaths[G]);else D.push(P);for(G=0;G<V.length;G++)for(var B=0;B<D.length;B++)R.push(V[G]),N.push(D[B]);d||(x=e===f.MeasuredType.MESH?f.retrieveMeshPrimitivesAndAABB(i):t.computeAABBForPoint(i.getSelPoint().toArray()));var O,z=!d;for(G=0;G<R.length;G++){var q,W;if(d&&(x=f.retrieveProductAABB(R[G].getLastElement(!0),i.getReferentialPosition())),I=f.retrieveProductAABB(N[G].getLastElement(!0),n.getReferentialPosition()),t.computeAABBSquaredDistance(x,I)<l)if(d&&(z=r.isLeaf(R[G].getLastElement(!0))),O=r.isLeaf(N[G].getLastElement(!0)),z&&O)d?L.push(R[G]):L.push(i),w.push(N[G]);else if(z||!O&&R[G].getLastElement(!0).bSphere.radius<N[G].getLastElement(!0).bSphere.radius){W=(q=N[G].getChildrenPathes()).length;for(var U=0;U<W;U++)r.isReferenceOrInstance(q[U].getLastElement())&&(d?R.push(R[G]):R.push(i),N.push(q[U]))}else{W=(q=R[G].getChildrenPathes()).length;for(var F=0;F<W;F++)r.isReferenceOrInstance(q[F].getLastElement())&&(R.push(q[F]),N.push(N[G]))}}for(var k=L.length,X=(new Date).getTime()-s,H=0;H<k;H++){var Y;Y=L[H];var j=w[H],Z=f.measureBetweenWithParts(e,Y,j,l,a);Z.squaredDistance<l&&(l=Z.squaredDistance,(c=Z).product1=L[H],c.product2=w[H])}!y&&d||(c.product1=u),_&&(c.product2=h),a&&!0===a&&console.log("Measure Products: Parts Couples="+k+" Scan duration="+X+" Duration="+((new Date).getTime()-s))}return c},measureBetweenWithParts:function(e,i,n,r,o){var a={},s=null;switch(e){case f.MeasuredType.PRODUCT:a=f.retrievePartPrimitivesAndAABB(i),s=i.getWorldMatrix();break;case f.MeasuredType.MESH:a=f.retrieveMeshPrimitivesAndAABB(i),s=i.getReferentialPosition();break;case f.MeasuredType.POINT:a.primitives=[],a.primitives[0]=i.getSelPoint().toArray(),a.AABB=[],a.AABB[0]=t.computeAABBForPoint(a.primitives[0]),s=null}var c=f.retrievePartPrimitivesAndAABB(n),l=n.getWorldMatrix();return f.measureBetweenPrimitivesAABB(e,a,s,c,l,r,o)},retrieveProductAABB:function(e,t){var i=[],n=e.bBox.clone().applyMatrix4(t);return i[0]=n.min.x,i[1]=n.min.y,i[2]=n.min.z,i[3]=n.max.x,i[4]=n.max.y,i[5]=n.max.z,i},retrievePartPrimitivesAndAABB:function(e){for(var t={primitives:[]},i=r.getRenderables(e),n=i.length,a=0;a<n;a++)for(var s=i[a].geometry,c=s.length,l=0;l<c;l++){s[l].startIteration();for(var p=s[l].drawingGroups,h=p.length,m=0;m<h;m++)if(p[m]._geomType&&"FACE"===d.GeomTypeString[p[m]._geomType])for(var y=p[m].getPrimitivesCount(),g=0;g<y;g++){var f=new d.SGPrimitiveHelper;f.set(p[m],g),t.primitives.push(f)}s[l].endIteration()}if(0<t.primitives.length){var P=o.extractMeshVertices(t.primitives[0],void 0,1);0<P.length&&(t.vertice=new u.Vector3(P[0][0],P[0][1],P[0][2]));var v=o.extractMeshNormals(t.primitives[0],void 0,1);0<v.length&&(t.normal=new u.Vector3(v[0][0],v[0][1],v[0][2]))}t.AABB=[];for(var _=e.getWorldMatrix().elements,T=(y=t.primitives.length,0);T<y;T++)t.AABB[T]=o.computeAABB(t.primitives[T],_);return t},retrieveMeshPrimitivesAndAABB:function(e){var t={primitives:[]};return t.primitives.push(e.getPrimitive()),t.AABB=[],t.AABB[0]=o.computeAABB(e.getPrimitive(),e.getReferentialPosition().elements),t},measureBetweenPrimitivesAABB:function(e,i,n,r,o,a,c){var l={},u=(new Date).getTime(),p=a||Number.MAX_VALUE;l.squaredDistance=p;var h,d=[],y=0,g=i.primitives.length,P=r.primitives.length,v=0;for(v=0;v<g;v++)for(var _=0;_<P;_++)(h=t.computeAABBSquaredDistance(i.AABB[v],r.AABB[_]))<p&&(d[y]=[v,_,h],y++);var T=d.length,M=0;if(e===f.MeasuredType.POINT){for(v=0;v<T&&p>m;v++)if(d[v][2]<p){var C=s.computePointMeshSquaredDistance(i.primitives[d[v][0]],r.primitives[d[v][1]],o,p);C.squaredDistance<p&&(p=C.squaredDistance,l=C),M++}}else for(v=0;v<T&&p>m;v++)if(d[v][2]<p){var b=s.computeTwoMeshesSquaredDistance(i.primitives[d[v][0]],n,r.primitives[d[v][1]],o,p);b.squaredDistance<p&&(p=b.squaredDistance,l=b),M++}return c&&!0===c&&console.log("Measure Parts: Primitives Couples="+g*P+" ("+g+"-"+P+")  Candidates="+d.length+"  MeasuredCandidates="+M+"  duration="+((new Date).getTime()-u)),l},MeasuredType:{POINT:0,MESH:1,PRODUCT:2}};return f})),define("DS/WebPolyMaths/WebMeasurable",["UWA/Core","DS/WebPolyMaths/WebGeometryEnums","DS/WebPolyMaths/WebMeshServices","DS/WebPolyMaths/WebMeshRecognition","DS/WebPolyMaths/WebToolsMeasure","DS/WebPolyMaths/WebMeasureEnums","DS/Visualization/ThreeJS_DS","DS/Visualization/PathElement"],(function(e,t,i,n,r,o,a,s){"use strict";var c=e.Class.extend({init:function(e,r){if(!r){if(this._bRealPathElement=!1,e.pathElement?(this._pathElement=e.pathElement.clone(),this._bRealPathElement=!0):this._matrix=e.position?e.position.clone():new a.Matrix4,e.selpoint){var s=(new a.Matrix4).getInverse(this._getMatrix());this._selPosition=e.selpoint.clone().applyMatrix4(s)}if(e.selnormal){var c=(new a.Matrix4).getInverse(this._getMatrix());this._selNormal=e.selnormal.clone().transformDirection(c)}var l;if(e.canonic?((l=e.canonic).exact=!0,l.returnCode=0,this._length=e.canonic.length,this._cog=e.canonic.cog,this._area=e.canonic.area,this._perimeter=e.canonic.perimeter,this._SGPrimitive=e.canonic.primitive):e.primitive&&(this._SGPrimitive=e.primitive,l=e.bAvoidRecognition?{returnCode:1}:n.recognizeCanonicGeometry(this._SGPrimitive,new a.Matrix4,!0)),0===l.returnCode){switch(this._type=l.type,l.type){case t.GeometryType.POINT:case t.GeometryType.PICKINGPT:this._selectedType=o.ViewedType.POINT,this._position=l.position,this._selPosition||(this._selPosition=l.position.clone());break;case t.GeometryType.LINE:this._selectedType=o.ViewedType.AXIS,this._point1=l.point1,this._point2=l.point2,this._selPosition||(this._selPosition=this._point1.clone());break;case t.GeometryType.CIRCLE:this._selectedType=o.ViewedType.CIRCLE,this._center=l.center,this._radius=l.radius,this._normal=l.normal;var u=i.extractMeshVertices(this._SGPrimitive),p=u.length-1;this._point1=new a.Vector3(u[0][0],u[0][1],u[0][2]),this._point2=new a.Vector3(u[p][0],u[p][1],u[p][2]);var h,d,m=0;u.length%2?(m=(u.length-1)/2-1,h=new a.Vector3(u[m][0],u[m][1],u[m][2]),d=new a.Vector3(u[m+2][0],u[m+2][1],u[m+2][2])):(m=u.length/2-1,h=new a.Vector3(u[m][0],u[m][1],u[m][2]),d=new a.Vector3(u[m+1][0],u[m+1][1],u[m+1][2]));var y=h.clone().add(d.clone()).multiplyScalar(.5).clone().sub(l.center.clone()).normalize().multiplyScalar(l.radius).clone().add(l.center.clone());this._arcMidPoint=new a.Vector3(y.x,y.y,y.z);var g=this._point1.clone().sub(this._center),f=this._point2.clone().sub(this._center),P=this._arcMidPoint.clone().sub(this._center);this._arcAngle=g.angleTo(P)+f.angleTo(P),l.arcLength||(l.arcLength=this._arcAngle*this._radius),l.length||(l.length=2*Math.PI*this._radius),this._arcLength=l.arcLength,this._length=l.length;break;case t.GeometryType.PLANE:this._selectedType=o.ViewedType.INFPLANE,this._origin=l.origin,this._normal=l.normal,this._selPosition||(this._selPosition=this._origin.clone());break;case t.GeometryType.CYLINDER:this._selectedType=o.ViewedType.CYCOSP,this._radius=l.radius,this._point1=l.point1,this._point2=l.point2;break;case t.GeometryType.CONE:this._selectedType=o.ViewedType.CYCOSP,this._apex=l.apex,this._semiAngle=l.semiAngle,this._axis=l.axis,this._point1=l.point1,this._point2=l.point2;break;case t.GeometryType.SPHERE:this._selectedType=o.ViewedType.CYCOSP,this._radius=l.radius,this._center=l.center;break;case t.GeometryType.PRODUCT:this._selectedType=o.ViewedType.PRODUCT,this._position=l.position,!this._selPosition&&l.position&&(this._selPosition=l.position.clone())}this._mode=l.exact?t.Mode.EXACT:t.Mode.FACETTED}else{switch(this._SGPrimitive.getGroup().glType){case 1:this._type=t.GeometryType.CURVE,this._selectedType=o.ViewedType.CURVE;var v=i.extractMeshVertices(this._SGPrimitive),_=v.length-1;this._point1=new a.Vector3(v[0][0],v[0][1],v[0][2]),this._point2=new a.Vector3(v[_][0],v[_][1],v[_][2]),this._selPosition||(this._selPosition=this._point1.clone());break;case 4:this._type=t.GeometryType.SURFACE,this._selectedType=o.ViewedType.SURFACE;var T=i.extractMeshVertices(this._SGPrimitive);this._selPosition||(this._selPosition=new a.Vector3(T[0][0],T[0][1],T[0][2]))}this._mode=t.Mode.FACETTED}this._isPartial=!1,this._partialPaths=[]}return this},clone:function(){var e=new c({},!0);if(e._type=this._type,e._mode=this._mode,this._SGPrimitive&&(e._SGPrimitive=this._SGPrimitive),this._pathElement&&(e._pathElement=this._pathElement.clone()),this._bRealPathElement&&(e._bRealPathElement=this._bRealPathElement),this._selPosition&&(e._selPosition=this._selPosition),this._selNormal&&(e._selNormal=this._selNormal),this._position&&(e._position=this._position),this._point1&&(e._point1=this._point1.clone()),this._point2&&(e._point2=this._point2.clone()),this._origin&&(e._origin=this._origin.clone()),this._normal&&(e._normal=this._normal.clone()),this._center&&(e._center=this._center.clone()),this._apex&&(e._apex=this._apex.clone()),this._axis&&(e._axis=this._axis.clone()),this._radius&&(e._radius=this._radius),this._semiAngle&&(e._semiAngle=this._semiAngle),this._length&&(e._length=this._length),this._area&&(e._area=this._area),void 0!==this._perimeter&&(e._perimeter=this._perimeter),this._cog&&(e._cog=this._cog),this._selectedType&&(e._selectedType=this._selectedType),this._isPartial&&(e._isPartial=this._isPartial),this._partialPaths&&(e._partialPaths=[],this._partialPaths.length>0))for(var t=0;t<this._partialPaths.length;t++)e._partialPaths.push(this._partialPaths[t].clone());return this._arcMidPoint&&(e._arcMidPoint=this._arcMidPoint.clone()),this._arcAngle&&(e._arcAngle=this._arcAngle),e},getType:function(){return this._type},getMode:function(){return this._mode},getPrimitive:function(){return this._SGPrimitive},getPathElement:function(){return this._bRealPathElement?this._pathElement.clone():new s},setLevel:function(e){this._level=e},getLevel:function(){return this._level},setPartial:function(e){this._isPartial=e},isPartial:function(){return this._isPartial},setPartialPathElements:function(e){this._partialPaths=[],this._partialPaths=e},setReferentialPosition:function(e){!this._bRealPathElement&&e&&e instanceof a.Matrix4&&(this._matrix=e.clone())},getReferentialPosition:function(){return this._getMatrix().clone()},getPoint:function(){var e=null;return this._type===t.GeometryType.POINT&&(e=this._position.clone().applyMatrix4(this._getMatrix())),e},getPoints:function(){var e=null;return this._type!==t.GeometryType.LINE&&this._type!==t.GeometryType.CURVE&&this._type!==t.GeometryType.CYLINDER&&this._type!==t.GeometryType.CONE&&this._type!==t.GeometryType.CIRCLE&&this._type!==t.GeometryType.PRODUCT||(e={},this._point1&&this._point2&&(e.beginPoint=this._point1.clone().applyMatrix4(this._getMatrix()),e.endPoint=this._point2.clone().applyMatrix4(this._getMatrix()))),e},getPlane:function(){var e=null;return this._type===t.GeometryType.PLANE&&((e={}).origin=this._origin.clone().applyMatrix4(this._getMatrix()),e.normal=this._normal.clone().transformDirection(this._getMatrix())),e},get2DScale:function(){return this._getMatrix().getScaleOnAxisX()},getRadius:function(){var e=null;return this._type!==t.GeometryType.CIRCLE&&this._type!==t.GeometryType.CYLINDER&&this._type!==t.GeometryType.SPHERE||(e=this._radius),e},getCenter:function(){var e=null;return this._type!==t.GeometryType.CIRCLE&&this._type!==t.GeometryType.SPHERE||(e=this._center.clone().applyMatrix4(this._getMatrix())),e},getAxis:function(){var e=null;return this._type===t.GeometryType.CIRCLE?e=this._normal.clone().transformDirection(this._getMatrix()):this._type!==t.GeometryType.LINE&&this._type!==t.GeometryType.CYLINDER&&this._type!==t.GeometryType.CONE||(e=this._point2.clone().sub(this._point1).normalize().transformDirection(this._getMatrix())),e},getAngle:function(){var e=null;return this._type===t.GeometryType.CIRCLE&&(e=2*Math.PI),e},getArcMidPoint:function(){var e=null;return this._type===t.GeometryType.CIRCLE&&(e=this._arcMidPoint.clone().applyMatrix4(this._getMatrix())),e},getArcAngle:function(){var e=null;return this._type===t.GeometryType.CIRCLE&&(e=this._arcAngle),e},getSemiAngle:function(){var e=null;return this._type===t.GeometryType.CONE&&(e=this._semiAngle),e},getApex:function(){var e=null;return this._type===t.GeometryType.CONE&&(e=this._apex.clone().applyMatrix4(this._getMatrix())),e},getLength:function(){var e=null;return this._type===t.GeometryType.LINE||this._type===t.GeometryType.CIRCLE||this._type===t.GeometryType.CURVE?(this._length||this._complete(),e=this._length):this._type===t.GeometryType.PRODUCT&&this._length&&(e=this._length),e},getArcLength:function(){var e=null;return this._type===t.GeometryType.CIRCLE&&(this._arcLength||this._complete(),e=this._arcLength),e},getCoG:function(){var e=null;return this._type!==t.GeometryType.SURFACE&&this._type!==t.GeometryType.CYLINDER&&this._type!==t.GeometryType.SPHERE&&this._type!==t.GeometryType.CONE&&this._type!==t.GeometryType.PLANE&&this._type!==t.GeometryType.PRODUCT||(this._cog||this._complete(),this._cog&&(e=this._cog.clone().applyMatrix4(this._getMatrix()))),e},getArea:function(){var e=null;return this._type!==t.GeometryType.SURFACE&&this._type!==t.GeometryType.CYLINDER&&this._type!==t.GeometryType.SPHERE&&this._type!==t.GeometryType.CONE&&this._type!==t.GeometryType.PLANE&&this._type!==t.GeometryType.PRODUCT||(this._area||this._complete(),this._area&&(e=this._area)),e},getPerimeter:function(){var e=null;return this._type!==t.GeometryType.SURFACE&&this._type!==t.GeometryType.CYLINDER&&this._type!==t.GeometryType.SPHERE&&this._type!==t.GeometryType.CONE&&this._type!==t.GeometryType.PLANE&&this._type!==t.GeometryType.PRODUCT||(this._perimeter||this._complete(),void 0!==this._perimeter&&(e=this._perimeter)),e},getVolume:function(){var e=null;return this.volume||this._complete(),this.volume&&(e=this.volume),e},getSelPoint:function(){var e=null;return this._type===t.GeometryType.POINT&&void 0!==this._position?e=this._position.clone().applyMatrix4(this._getMatrix()):void 0!==this._selPosition?e=this._selPosition.clone().applyMatrix4(this._getMatrix()):void 0!==this._point1&&(e=this._point1.clone().applyMatrix4(this._getMatrix())),e},getSelNormal:function(){return this._selNormal.clone().transformDirection(this._getMatrix())},getOriginPoint:function(){var e=null;return this._originPoint&&this._type===t.GeometryType.PRODUCT&&(e=this._originPoint.clone().applyMatrix4(this._getMatrix())),e},computeMinimumDistance:function(e){var t={returnCode:1};if(e){var i=r.measureBetween(this,this._selectedType,e,e._selectedType);i.position1&&(t.distance=i.distance,t.relationship=i.relationship,t.position1=i.position1,t.position2=i.position2,t.returnCode=0)}return t},computeAngle:function(e){var t={returnCode:1};if(e){var i=r.measureBetween(this,this._selectedType,e,e._selectedType);i.position1&&(t.angle=i.angle,t.returnCode=0)}return t},exportData:function(e){var i={canonic:{}};switch(i.canonic.type=e(this._type,"int"),i.canonic.mode=e(this._mode,"int"),i.canonic.selectedType=e(this._selectedType,"int"),i.canonic.matrix=e(this._getMatrix(),"Matrix4"),this._type){case t.GeometryType.POINT:case t.GeometryType.PICKINGPT:i.canonic.position=e(this._position,"Vector3");break;case t.GeometryType.LINE:i.canonic.point1=e(this._point1,"Vector3"),i.canonic.point2=e(this._point2,"Vector3"),this._length||this._complete(),i.canonic.length=e(this._length,"float");break;case t.GeometryType.CIRCLE:i.canonic.center=e(this._center,"Vector3"),i.canonic.radius=e(this._radius,"float"),i.canonic.normal=e(this._normal,"Vector3"),this._length&&this._arcLength||this._complete(),i.canonic.length=e(this._length,"float"),i.canonic.arcLength=e(this._arcLength,"float"),i.canonic.arcMidPoint=e(this._arcMidPoint,"Vector3"),i.canonic.point1=e(this._point1,"Vector3"),i.canonic.point2=e(this._point2,"Vector3"),i.canonic.arcAngle=e(this._arcAngle,"float");break;case t.GeometryType.PLANE:i.canonic.origin=e(this._origin,"Vector3"),i.canonic.normal=e(this._normal,"Vector3"),this._cog&&this._area||this._complete(),i.canonic.cog=e(this._cog,"Vector3"),i.canonic.area=e(this._area,"float"),i.canonic.perimeter=e(this._perimeter,"float");break;case t.GeometryType.CYLINDER:i.canonic.radius=e(this._radius,"float"),i.canonic.point1=e(this._point1,"Vector3"),i.canonic.point2=e(this._point2,"Vector3"),this._cog&&this._area||this._complete(),i.canonic.cog=e(this._cog,"Vector3"),i.canonic.area=e(this._area,"float"),i.canonic.perimeter=e(this._perimeter,"float");break;case t.GeometryType.CONE:i.canonic.apex=e(this._apex,"Vector3"),i.canonic.semiAngle=e(this._semiAngle,"float"),i.canonic.axis=e(this._axis,"Vector3"),i.canonic.point1=e(this._point1,"Vector3"),i.canonic.point2=e(this._point2,"Vector3"),this._cog&&this._area||this._complete(),i.canonic.cog=e(this._cog,"Vector3"),i.canonic.area=e(this._area,"float"),i.canonic.perimeter=e(this._perimeter,"float");break;case t.GeometryType.SPHERE:i.canonic.radius=e(this._radius,"float"),i.canonic.center=e(this._center,"Vector3"),this._cog&&this._area||this._complete(),i.canonic.cog=e(this._cog,"Vector3"),i.canonic.area=e(this._area,"float"),i.canonic.perimeter=e(this._perimeter,"float");break;case t.GeometryType.SURFACE:this._cog&&this._area||this._complete(),i.canonic.cog=e(this._cog,"Vector3"),i.canonic.area=e(this._area,"float"),i.canonic.perimeter=e(this._perimeter,"float");break;case t.GeometryType.CURVE:this._length||this._complete(),i.canonic.length=e(this._length,"float"),i.canonic.point1=e(this._point1,"Vector3"),i.canonic.point2=e(this._point2,"Vector3")}return i.selpoint=e(this._selPosition,"Vector3"),this._selNormal&&(i.selnormal=e(this._selNormal,"Vector3")),i},importData:function(e,t){return this._type=t(e.canonic.type,"int"),this._mode=t(e.canonic.mode,"int"),this._bRealPathElement=!1,this._pathElement={},this._matrix=e.canonic.matrix?t(e.canonic.matrix,"Matrix4"):new a.Matrix4,e.selpoint&&(this._selPosition=t(e.selpoint,"Vector3")),e.selnormal&&(this._selNormal=t(e.selnormal,"Vector3")),e.canonic.position&&(this._position=t(e.canonic.position,"Vector3")),e.canonic.point1&&(this._point1=t(e.canonic.point1,"Vector3")),e.canonic.point2&&(this._point2=t(e.canonic.point2,"Vector3")),e.canonic.origin&&(this._origin=t(e.canonic.origin,"Vector3")),e.canonic.normal&&(this._normal=t(e.canonic.normal,"Vector3")),e.canonic.center&&(this._center=t(e.canonic.center,"Vector3")),e.canonic.apex&&(this._apex=t(e.canonic.apex,"Vector3")),e.canonic.axis&&(this._axis=t(e.canonic.axis,"Vector3")),e.canonic.radius&&(this._radius=t(e.canonic.radius,"float")),e.canonic.semiAngle&&(this._semiAngle=t(e.canonic.semiAngle,"float")),e.canonic.length&&(this._length=t(e.canonic.length,"float")),e.canonic.area&&(this._area=t(e.canonic.area,"float")),void 0!==e.canonic.perimeter&&(this._perimeter=t(e.canonic.perimeter,"float")),e.canonic.cog&&(this._cog=t(e.canonic.cog,"Vector3")),e.canonic.selectedType&&(this._selectedType=t(e.canonic.selectedType,"int")),e.canonic.arcMidPoint&&(this._arcMidPoint=t(e.canonic.arcMidPoint,"Vector3")),e.canonic.arcLength&&(this._arcLength=t(e.canonic.arcLength,"float")),e.canonic.arcAngle&&(this._arcAngle=t(e.canonic.arcAngle,"float")),this},print:function(e){var i=void 0!==e?e:"Measurable";switch(console.log(i),this._type){case t.GeometryType.POINT:console.log("    type=POINT point=("+this._position.x+", "+this._position.y+", "+this._position.z+")");break;case t.GeometryType.CURVE:console.log("    type=CURVE point1=("+this._point1.x+", "+this._point1.y+", "+this._point1.z+") point2=("+this._point2.x+", "+this._point2.y+", "+this._point2.z+")");break;case t.GeometryType.LINE:console.log("    type=LINE point1=("+this._point1.x+", "+this._point1.y+", "+this._point1.z+") point2=("+this._point2.x+", "+this._point2.y+", "+this._point2.z+")");break;case t.GeometryType.CIRCLE:console.log("    type=CIRCLE radius="+this._radius+" center=("+this._center.x+", "+this._center.y+", "+this._center.z+") normal=("+this._normal.x+", "+this._normal.y+", "+this._normal.z+")");break;case t.GeometryType.SURFACE:console.log("    type=SURFACE area="+this._area+" cog=("+this._cog.x+", "+this._cog.y+", "+this._cog.z+") perimeter = "+this._perimeter);break;case t.GeometryType.PLANE:console.log("    type=PLANE origin=("+this._origin.x+", "+this._origin.y+", "+this._origin.z+") normal=("+this._normal.x+", "+this._normal.y+", "+this._normal.z+")");break;case t.GeometryType.CYLINDER:console.log("    type=CYLINDER point1=("+this._point1.x+", "+this._point1.y+", "+this._point1.z+") point2=("+this._point2.x+", "+this._point2.y+", "+this._point2.z+")");break;case t.GeometryType.CONE:console.log("    type=CONE point1=("+this._point1.x+", "+this._point1.y+", "+this._point1.z+") point2=("+this._point2.x+", "+this._point2.y+", "+this._point2.z+")");break;case t.GeometryType.SPHERE:console.log("    type=SPHERE center=("+this._center.x+", "+this._center.y+", "+this._center.z+")")}var n=this._getMatrix().elements;console.log("    transformation=("+n[0]+", "+n[4]+", "+n[8]+"), ("+n[1]+", "+n[5]+", "+n[9]+"), ("+n[2]+", "+n[6]+", "+n[10]+"), ("+n[3]+", "+n[7]+", "+n[11]+")")},_complete:function(){if(this._type===t.GeometryType.PRODUCT)this.updateProductMeasurable();else{var e=n.recognizeNonCanonicGeometry(this._SGPrimitive,new a.Matrix4,!0);this._type===t.GeometryType.CIRCLE?(this._arcLength=e.arcLength,this._length=e.length):this._type===t.GeometryType.LINE?this._length=e.length:this._type===t.GeometryType.PLANE||this._type===t.GeometryType.CYLINDER||this._type===t.GeometryType.CONE||this._type===t.GeometryType.SPHERE?(this._area=e.area,this._cog=e.cog,this._perimeter=e.perimeter):this._type===t.GeometryType.CURVE?this._length=e.length:(this._area=e.area,this._cog=e.cog,this._perimeter=e.perimeter)}},_getMatrix:function(){var e=this._bRealPathElement?this._pathElement.getWorldMatrix():this._matrix;return e||(e=new a.Matrix4),e},updateProductMeasurable:function(){var e=r.measureProduct(this);this.volume=void 0,this._area=void 0,this._cog=void 0,this._length=void 0,this._point1=void 0,this._point2=void 0,this._originPoint=void 0,void 0!==e.volume&&(this.volume=e.volume),void 0!==e.area&&(this._area=e.area),void 0!==e.perimeter&&(this._perimeter=e.perimeter),void 0!==e.length&&(this._length=e.length);var t=(new a.Matrix4).getInverse(this._getMatrix());void 0!==e.startpoint&&void 0!==e.endpoint&&(this._point1=e.startpoint.clone().applyMatrix4(t),this._point2=e.endpoint.clone().applyMatrix4(t)),void 0!==e.cog&&(this._cog=e.cog.clone().applyMatrix4(t),this._selPosition||(this._selPosition=this._cog.clone())),void 0!==e.originPoint&&(this._originPoint=e.originPoint)}});return c}));