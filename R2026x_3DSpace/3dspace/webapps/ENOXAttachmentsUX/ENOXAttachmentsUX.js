define("DS/ENOXAttachmentsUX/utils/Menus",["UWA/Core","UWA/Utils/InterCom","DS/LifecycleCmd/MaturityCmd","DS/DocumentCommands/DOCMClipboard","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],(function(e,t,n,o,a,i){"use strict";return function(e){var a={socket:null,init:function(e){this.ctrl=e},handler:function(e){a.actions[e.menuItem.methodName]&&a.actions[e.menuItem.methodName](a.ctrl,e.nodeModels,e.menuItem,e.target)},actions:{ctxRelations:function(e,n,o,i){var s=a.ctrl.helper.make3DXContent(n);s.appId="ENORIPE_AP";var r=new t.Socket("compassPageSocket");r.subscribeServer("com.ds.compass",window.parent),r.dispatchEvent("onSetX3DContent",s,"compassPageSocket"),r.addListener("launchApp",(function(e,t,n){r.unsubscribeServer("com.ds.compass"),r.disconnect()})),r.dispatchEvent("onLaunchApp",s,"compassPageSocket")},ctxCopy:function(e,t,n,i){var s=a.ctrl.helper.make3DXContent(t);o.copy(s)},ctxMaturity:function(e,t,o,a){var i={securitycontext:e.options.connectorOptions.fetchSecurityContext(),context:{}};new n(i).executeAsync(t.map((function(t){return{physicalid:t.options.data.id,serviceurl:e.options.connectorOptions.platformUrls["3DSpace"]+"/resources/lifecycle/maturity/"}})))},ctxShare:function(e,t,n,o){var a=this;require(["DS/ENOCollabSharingCmds/BaseModels/ResultElement","DS/SharePopup/SharePopup"],(function(e,n){var o=t.map((function(t){return new e({physicalId:t.options.data.id,name:t.options.data.dataelements.title||t.options.data.dataelements.secondaryTitle||t.options.data.dataelements.name})}));a.sharePanel?(a.sharePanel.show(o),a.sharePanel.container.centerIt()):(a.sharePanel=new n(widget,widget.body,{removeAtClose:!0,events:{onClose:function(){a.sharePanel=null}}}),a.sharePanel.show(o))}))},ctxProperties:function(e,t,n,o){require(["DS/ENOCollabSharingCmds/commands/EditPropCmd/EditPropCmdBase"],(function(n){var o=t.map((function(t){return{id:t.options.data.id,type:"Document Proxy"==t.options.data.type?t.options.data.type+`?parentId=${e.options.parentObject.parentId}`:t.options.data.type,tenant:e.options.connectorOptions.platformUrls.platformId,source:"Document Proxy"==t.options.data.type?"www":"3DSpace",getID:function(){return t.options.data.id}}})),a={getSelectedNodes:function(){return o},getSecurityContext:function(){return{SecurityContext:e.options.connectorOptions.fetchSecurityContext()}}};(new n).launchProperties(a)}))}}};return a.init(e),a}})),define("DS/ENOXAttachmentsUX/utils/URLDialog",["UWA/Controls/Abstract","DS/Form/Form","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Core/WebUXGlobalEnums","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],(function(e,t,n,o,a,i){return e.extend({modal:{},name:"docm-attachment-url-dialog",options:{className:""},_options:{},modelEvents:void 0,init:function(e){e.events&&(this.events=e.events,delete e.events),this._parent(e),this.events&&(e.events=this.events),this.buildSkeleton()},buildSkeleton:function(){var e=this;e.immersiveFrame=new n({identifier:"attach_url"});let s=new t({invalidDisplayPolicy:a.InvalidDisplayPolicy.OnInput,model:[{id:"title",label:i.get("Title"),typeRepresentation:"string",value:e.options.dialogCustomizations.defaultTitle?e.options.dialogCustomizations.defaultTitle:void 0,invalidFlag:!e.options.dialogCustomizations.defaultTitle,invalidTooltip:{shortHelp:i.get("CanNotBeEmpty",{field:i.get("Title")})},onNodeLiveUpdate:e=>{var t=e.id,n=e.value.length<1;n&&(s.globalInformation={text:i.get("CanNotBeEmpty",{field:i.get("TitleOrURL")}),emphasize:"error"}),s.updateModelItem(t,{invalidFlag:n}),this.DialogButtonVisibilityChecker()}},{id:"url",label:i.get("URL"),typeRepresentation:"string",value:e.options.dialogCustomizations.defaultUrl?e.options.dialogCustomizations.defaultUrl:void 0,invalidFlag:!e.options.dialogCustomizations.defaultUrl,invalidTooltip:{shortHelp:i.get("CanNotBeEmpty",{field:i.get("URL")})},semantics:{placeholder:i.get("URLPlaceHolder")},onNodeLiveUpdate:e=>{var t=e.id,n=e.value;n||(n="");var o=n.length<1,a=!0;(s.updateModelItem(t,{invalidTooltip:{shortHelp:i.get("CanNotBeEmpty",{field:i.get("TitleOrURL")})}}),o)?s.globalInformation={text:i.get("CanNotBeEmpty",{field:i.get("TitleOrURL")}),emphasize:"error"}:(a=this.ensureValidUrl(e.value))||(s.globalInformation={text:i.get("INVALID_URL"),emphasize:"error"},s.updateModelItem(t,{invalidTooltip:{shortHelp:i.get("INVALID_URL")}}));s.updateModelItem(t,{invalidFlag:!!o||!a}),this.DialogButtonVisibilityChecker()}}],usePaddingFlag:!0}),r={label:i.get("Cancel"),onClick:function(t){e.attachUrlCompleteEventToken&&(e.events.unsubscribe(e.attachUrlCompleteEventToken),e.attachUrlCompleteEventToken=void 0),t.dsModel.dialog.destroy(),e.immersiveFrame.destroy(),t.dsModel=null},role:a.WUXCustomButtonRoleEnum.Escape},l=[{label:e.options.dialogCustomizations.defaultConfirmButtonTitle?i.get(e.options.dialogCustomizations.defaultConfirmButtonTitle):i.get("Create"),emphasize:"primary",disabled:!e.options.dialogCustomizations.defaultConfirmButtonVisibility||!e.options.dialogCustomizations.defaultConfirmButtonVisibility,onClick:function(t){if(t.dsModel.dialog.getCustomButtons()[0].disabled=!0,t.dsModel.dialog.checkboxInfos.checkFlag){t.dsModel.dialog._isCreateInProgress=!0,t.dsModel.dialog.getCustomButtons()[0].setProperties({label:i.get("Creating")}),t.dsModel.dialog._requestInProgress=!0;//! to be removed
var n=t.dsModel.dialog.content.getModelItem("title").value,o=t.dsModel.dialog.content.getModelItem("url").value;o=/^[A-Za-z]+:\/\/.*$/.test(o)?o:`https://${o}`,e.options&&e.options.onConfirm&&e.options.onConfirm({title:n,url:o}),e.attachUrlCompleteEventToken&&(e.events.unsubscribe(e.attachUrlCompleteEventToken),e.attachUrlCompleteEventToken=void 0),e.attachUrlCompleteEventToken=e.events.subscribe({event:"attach-url-attachment-complete"},(function(n){if(t&&t.dsModel&&t.dsModel.dialog&&t.dsModel.dialog.content&&t.dsModel.dialog.getCustomButtons&&t.dsModel.dialog.getCustomButtons().length>0){t.dsModel.dialog._isCreateInProgress=!1;var o=t.dsModel.dialog.content.getModelItem("title").value,a=t.dsModel.dialog.content.getModelItem("url").value;a=/^[A-Za-z]+:\/\/.*$/.test(a)?a:`https://${a}`,n.urlData.title==o&&n.urlData.url==a?(t.dsModel.dialog.getCustomButtons()[0].disabled=!1,t.dsModel.dialog.getCustomButtons()[0].setProperties({label:i.get("Create")}),t.dsModel.dialog.content.updateModelItem("title",{invalidFlag:!t.dsModel.dialog.content.getModelItem("title").value.length>0}),t.dsModel.dialog.content.updateModelItem("url",{invalidFlag:!t.dsModel.dialog.content.getModelItem("url").value.length>0}),e.DialogButtonVisibilityChecker()):(t.dsModel.dialog._isCreateInProgress=!1,t.dsModel.dialog.getCustomButtons()[0].disabled=!1,t.dsModel.dialog.getCustomButtons()[0].setProperties({label:i.get("Create")}),t.dsModel.dialog.content.updateModelItem("title",{invalidFlag:!t.dsModel.dialog.content.getModelItem("title").value.length>0}),t.dsModel.dialog.content.updateModelItem("url",{invalidFlag:!t.dsModel.dialog.content.getModelItem("url").value.length>0}),e.DialogButtonVisibilityChecker())}})),e.attachUrlFailureEventToken&&(e.events.unsubscribe(e.attachUrlFailureEventToken),e.attachUrlFailureEventToken=void 0),e.attachUrlFailureEventToken=e.events.subscribe({event:"attach-url-attachment-failure"},(function(e){t&&t.dsModel&&t.dsModel.dialog&&t.dsModel.dialog.content&&t.dsModel.dialog.getCustomButtons&&t.dsModel.dialog.getCustomButtons().length>0&&(t.dsModel.dialog._isCreateInProgress=!1,t.dsModel.dialog.getCustomButtons()[0].disabled=!1,t.dsModel.dialog.getCustomButtons()[0].setProperties({label:i.get("Create")}))}))}else e.options&&e.options.onConfirm&&e.options.onConfirm({title:t.dsModel.dialog.content.getModelItem("title").value,url:t.dsModel.dialog.content.getModelItem("url").value}),t.dsModel.dialog.destroy(),e.immersiveFrame.destroy(),t.dsModel=null},role:a.WUXCustomButtonRoleEnum.Validate},r];this.DialogButtonVisibilityChecker=function(){var e=s.invalidState,t=this.myDialog.getCustomButtons()[0];e||1==this.myDialog._isCreateInProgress?t.disabled=!0:(s.globalInformation=void 0,t.disabled=!1)},e.myDialog=new o({immersiveFrame:e.immersiveFrame,identifier:"attachURLDialog",title:e.options.dialogCustomizations.defaultDialogTitle?i.get(e.options.dialogCustomizations.defaultDialogTitle):i.get("NewLink"),content:s,activeFlag:!1,resizableFlag:!0,width:420,modalFlag:!0,checkboxInfos:{label:i.get("Repeat"),checkFlag:!1},customButtonsDefinition:l}),e.myDialog._isCreateInProgress=!1,e.myDialog.addEventListener("close",(t=>{e.attachUrlCompleteEventToken&&(e.events.unsubscribe(e.attachUrlCompleteEventToken),e.attachUrlCompleteEventToken=void 0),e.immersiveFrame.destroy()})),e.immersiveFrame.inject(widget.body)},ensureValidUrl:function(e){try{return/^[A-Za-z]+:\/\/.*$/.test(e)?new URL(e):new URL("https://"+e),!0}catch(e){return!1}}})})),define("DS/ENOXAttachmentsUX/views/GridPane",["UWA/Core","DS/DataGridView/DataGridView","DS/TreeModel/DataModelSet","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],(function(e,t,n,o){"use strict";return function(a){var i={build:function(a){this.ctrl=a,i.container=e.createElement("div",{class:a.getClassNames("-gridpane"),styles:{display:"none"}}),i.container.inject(a.elements.panes),a.config.headers.forEach((e=>{"stateNLS"==e.dataIndex&&(e.getCellSemantics=function(e){return{emphasize:a.helper.getStateEmphasisClassname(e.nodeModel.options.data)}})}));var s=new n;a.config.headers.forEach((e=>{"tree"==e.dataIndex&&(e.getCellValue=function(e){if(e.nodeModel)return{label:e.nodeModel.options.label,url:e.nodeModel.options.grid.proxyurl}})}));var r="";widget.environment&&widget.environment.data&&widget.environment.data._data&&(r=widget.environment.data._data._x_appId);var l="ENOXAttachmentsUX_"+a.options.attachmentsType+"_"+(e.is(widget.data.appId)?widget.data.appId:r);i.datagridview=new t({identifier:l,treeDocument:i.ctrl.controller.attachments,dataModelSet:s,columns:a.config.headers,selectionMode:"row",showSelectionCheckBoxesFlag:!0,showRowIndexFlag:!1,cellDragEnabledFlag:!0,showContextualMenuColumnFlag:!0,rowSelection:"multiple",cellSelection:"none",layoutOptions:{useLastColumnWidthAutoFlag:!0},onDragStartCell:function(e,t){this.onDragStartCellDefault(e,t),e.dataTransfer.effectAllowed="all";var n=["Document Proxy"],s=[],r=[];i.datagridview.treeDocument.getSelectedNodes().forEach((e=>{n.includes(e.options.data.dataelements.type)?s.push(e.options.data.dataelements.type):r.push(e)})),s.length>0&&(s=[...new Set(s)]).forEach((e=>{"Document Proxy"==e&&(e="Link"),a.controller.showNotification("warning",o.get("Invalid_Content"),o.get("Selected_Objects_Invalid"),o.get("Objects_WillBE_Removed",{type:e}))})),e.dataTransfer.setData("Text",JSON.stringify(i.ctrl.helper.make3DXContent(r,i.ctrl.controller.options)))},onContextualEvent:function(e){var t=[];if(e&&e.collectionView){t=e.collectionView.buildDefaultContextualMenu(e,{});var n,o,a="event"in window?event:window.event;if(a)n=a.target,a.clientX&&(o={x:a.clientX,y:a.clientY});else if(e&&e.data&&e.data.windowPosition&&e.data.windowPosition.x&&e.data.windowPosition.y){var s=e.data.windowPosition;o={x:s.x,y:s.y}}else e&&e.data&&e.data.target?n=e.data.target:e.cellInfos&&(n=e.cellInfos.cellView.elements.container);i.datagridview.treeDocument.getSelectedNodes().length>0?i.ctrl.controller.prepareContextMenu(i.datagridview.treeDocument.getSelectedNodes(),n,o):e.cellInfos&&e.cellInfos.nodeModel?i.ctrl.controller.prepareContextMenu([e.cellInfos.nodeModel],n,o):null==e.cellInfos&&i.ctrl.controller.prepareRightClickMenuNoObjectSelection(n,o)}return t}}).inject(i.container),i.datagridview.registerReusableCellContent({id:"actionButton",buildContent:function(){var t=new e.Element("div",{class:"fonticon fonticon-chevron-down",styles:{color:"#b4b6ba",display:"list-item","font-size":"18px",width:"100%"}});return t.addEvent("click",(function(e){e.nodeModels=[e.target.cellInfos.nodeModel],i.ctrl.controller.actionMenuHandler(e)})),t}}),i.datagridview.addEventListener("copy",(e=>{console.log("copyy from grid pane"),a.controller.copyContent()})),i.datagridview.addEventListener("paste",(e=>{console.log("paste from grid pane"),a.controller.pasteContent()})),i.datagridview.sortModel=[a.topBar.currentSort],a.gridPane=i},show:function(){this.container.show()},hide:function(){this.container.hide()}};return i.build(a),i}})),define("DS/ENOXAttachmentsUX/views/TilePane",["UWA/Core","DS/CollectionView/ResponsiveLargeTilesCollectionView","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],(function(e,t,n){"use strict";return function(o){var a={build:function(o){a.ctrl=o,a.container=e.createElement("div",{class:o.getClassNames("-tilepane"),styles:{display:"none"},events:{contextmenu:function(e){e.preventDefault(),a.ctrl.controller.prepareRightClickMenuNoObjectSelection(e.target,{x:e.clientX,y:e.clientY})}}}),a.container.inject(o.elements.panes),a.rcv=a.container.rcv=new t({model:a.ctrl.controller.attachments,useDragAndDrop:!0,shouldCellAllowUnsafeHTMLContentAt:function(e,t){return["subtitle","description"].includes(t)},displayedOptionalCellProperties:["contextualMenu","description","activeFlag"],onDropBlank:function(e,t){e.preventDefault(),e.stopPropagation(),a.ctrl.dndManager.handleDrop(e),this.onDropBlankDefault(e,t)},onDragStartCell:function(e,t){this.onDragStartCellDefault(e,t),e.dataTransfer.effectAllowed="all";var i=["Document Proxy"],s=[],r=[];a.rcv.TreedocModel.getSelectedNodes().forEach((e=>{i.includes(e.options.data.dataelements.type)?s.push(e.options.data.dataelements.type):r.push(e)})),s.length>0&&(s=[...new Set(s)]).forEach((e=>{"Document Proxy"==e&&(e="Link"),o.controller.showNotification("warning",n.get("Invalid_Content"),n.get("Selected_Objects_Invalid"),n.get("Objects_WillBE_Removed",{type:e}))})),e.dataTransfer.setData("Text",JSON.stringify(a.ctrl.helper.make3DXContent(r,a.ctrl.controller.options)))},onDragEnterBlank:function(e,t){o.options.readonly||this.onDragEnterBlankDefault(e,t)}}).inject(a.container),a.rcv.getContextualMenu=function(e,t,n){return[""]},a.rcv.getLabel=function(e){return e.options.label},a.rcv.onContextualEvent={callback:function(e){if(e&&e.cellInfos){if(e.cellInfos.cellModel){var t,n,o="event"in window?event:window.event;if(o)t=o.target,o.clientX&&(n={x:o.clientX,y:o.clientY});else if(e&&e.data&&e.data.windowPosition&&e.data.windowPosition.x&&e.data.windowPosition.y){var i=e.data.windowPosition;n={x:i.x,y:i.y}}else t=e&&e.data&&e.data.target?e.data.target:e.cellInfos.cellView.elements.container;t&&t.hasClassName&&t.hasClassName("wux-controls-responsivetileview-menu")?a.rcv.TreedocModel.getSelectedNodes().length>1?a.ctrl.controller.prepareContextMenu(a.rcv.TreedocModel.getSelectedNodes(),t,n):a.ctrl.controller.prepareContextMenu([e.cellInfos.nodeModel],t,n):a.ctrl.controller.prepareContextMenu(a.rcv.TreedocModel.getSelectedNodes(),t,n)}}else e.cellCtxMenuRequired;return o.stopPropagation(),[]}},a.rcv.onSelectionAdd((function(e,t){a.ctrl.modelEvents.publish({event:"selection-add",data:e})})),a.rcv.onSelectionRemove((function(e,t){a.ctrl.modelEvents.publish({event:"selection-remove",data:e})})),a.rcv.onCellsCopy((e=>{console.log("copyy"),o.controller.copyContent()})),a.rcv.onCellsPaste((e=>{console.log("paste"),o.controller.pasteContent()})),o.tilePane=a},show:function(){this.container.show()},hide:function(){this.container.hide()},repaintUI:function(){a.rcv._modelEvents.publish({event:"ENDRESIZE",context:a.rcv})},destroy:function(){a.rcv.destroy()}};return a.build(o),a}})),define("DS/ENOXAttachmentsUX/views/UploadPane",["UWA/Core","DS/DocumentCommonInfra/Utils/GetCollabOrgConfiguration","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew","DS/Controls/Button","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],(function(e,t,n,o,a){"use strict";return function(i){var s={build:function(i){this.ctrl=i,this.container=e.createElement("div",{class:i.getClassNames("-uploadpane"),tabindex:0,events:{contextmenu:function(e){e.preventDefault(),s.ctrl.controller.prepareRightClickMenuNoObjectSelection(e.target,{x:e.clientX,y:e.clientY})}}}),this.container.addEventListener("keydown",(e=>{(e.ctrlKey||e.metaKey)&&"v"===e.key&&(i.controller.pasteContent(),e.preventDefault())})),this.container.inject(i.elements.panes);var r=e.createElement("div",{class:i.getClassNames("-uploadpane-center")});r.inject(this.container);var l=e.createElement("div",{class:i.getClassNames("-uploadpane-center-msg")});l.inject(r);var c=e.createElement("div",{class:i.getClassNames("-uploadpane-center-buttons")});i.options.readonly?l.setText(a.get("NO_DOCUMENTS_ATTACHED")):c.inject(r),s.uploadButton=this.container.uploadButton=new o({label:a.get("UPLOAD_DOCUMENTS"),emphasize:"primary"}),s.uploadButton.addEventListener("buttonclick",(async function(o){var a={securityContext:i.options.connectorOptions.fetchSecurityContext(),tenantUrl:i.options.connectorOptions.platformUrls["3DSpace"]},r="";try{r=await t.getcreateCtxValue(a).promise}catch(o){return void i.helper.showNotification("error",n.Upload_Document_Error_Title,"",n.Upload_Document_Error_Message)}if(r[0]?.minimalroles)i.helper.showNotification("error",n.Upload_Document_Error_Title,"",n.Upload_Document_Error_Message);else{var l=(window.FilePicker=e.createElement("input",{attributes:{id:"btnUpload_chooser",type:"file",multiple:!1},styles:{display:"none"},events:{change:function(e){var t=e.target.files.length>0?e.target.files:e.dataTransfer.files;s.ctrl.modelEvents.publish({event:"user-selects-files-for-upload",data:{cancelled:!1,files:t}}),l.destroy()}}})).inject(widget.body);l.click()}})),s.uploadButton.inject(c),s.attachButton=this.container.attachButton=new o({label:a.get("ATTACH_EXISTING"),emphasize:"secondary"}),s.attachButton.inject(c),s.attachButton.addEventListener("buttonclick",(function(){s.ctrl.modelEvents.publish({event:"user-clicks-attach",data:{cancelled:!1}})})),i.uploadPane=s},show:function(){this.container.show()},hide:function(){this.container.hide()}};return s.build(i),s}})),define("DS/ENOXAttachmentsUX/Actions/OpenLink",["UWA/Core","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],(function(e,t){"use strict";var n=function(e){return{id:"openLink",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"open",fontIconFamily:1},label:t.get("OpenLink"),tooltip:t.get("OpenLink"),position:"far",category:"dialog",value:function(t){t.options=e,n.execute(t)},visibleFlag:!0},execute:function(){n.execute({options:e})},updateForSelection:function(e,t){return Promise.resolve(!0)}}};return n.execute=function(e){e.options.getSelectedNodes().length>0&&window.open(e.options.getSelectedNodes()[0].options.data.dataelements.proxyurl)},n})),define("DS/ENOXAttachmentsUX/data/Constants",[],(function(){"use strict";return{ERROR:"error",PRIMARY:"primary",WARNING:"warning",INFO:"info",SUCCESS:"success",PAD_CURRENT_SECURITY_CONTEXT:"pad_security_ctx",PAD_AVAILABLE_SECURITY_CONTEXT:"pad_security_ctx_list",PAD_CSRF_TOKEN:"pad_csrf",PLATFORM_SERVICES:"platformServices",CONTEXT_USER:"context_user",CSRF:"CSRF",OBJECT_ID:"id",PHYSICAL_ID:"physicalid",REL_ID:"id[connection]",REL_NAME:"name[connection]",REL_PHYSICAL_ID:"physicalid[connection]",TYPE:"type",NAME:"name",REVISION:"revision",MODIFIED:"modified",REFERENCE_DOCUMENT:"Reference Document",SPECIFICATION_DOCUMENT:"SpecificationDocument",REL_PLMDOCCONNECTION:"PLMDocConnection",Document_Proxy:"Document Proxy",ACCEPT_APPLICATION_JSON:"application/json",SECURITY_CONTEXT_KEY:"SecurityContext",CONTENT_TYPE:"Content-Type",APPLICATION_URL_ENCODED:"application/x-www-form-urlencoded",GET:"GET",POST:"POST",PUT:"PUT",Resources:{GET_SECURITY_CONTEXT:"/resources/pno/person/getsecuritycontext?tenant=",GET_DOCS_BY_PARENT:"/resources/v1/modeler/documents/parentId/"},Query:{REFERENCE_DOCS:"?parentRelName=Reference%20Document&parentDirection=from&$include=versions"}}})),define("DS/ENOXAttachmentsUX/utils/MaturityCache",["UWA/Core","DS/WAFData/WAFData"],(function(e,t){"use strict";var n={cachedPolicies:null,setup:function(e){n.options=e,n.load()},fetchPolicies:function(e,o){if(n.cachedPolicies&&n.cachedPolicies[widget.lang]&&e.every(n.hasStateInfoForDoc))o(n.cachedPolicies);else{var a={url:n.options.platformUrls["3DSpace"]+"/resources/lifecycle/maturity/getStateGraph?tenant="+n.options.platformUrls.platformId,type:"json",method:"POST",headers:{Accept:"application/json","Accept-Language":widget.lang,"Content-Type":"application/json",securitycontext:n.options.fetchSecurityContext()?encodeURIComponent(n.options.fetchSecurityContext()):void 0},data:JSON.stringify({data:e.map((function(e){return{physicalid:e.id}}))}),onComplete:function(e){e.status&&null==e.status.errorMsg&&(n.cachedPolicies=n.cachedPolicies||{},n.cachedPolicies[widget.lang]=n.cachedPolicies[widget.lang]||{},e.data.policies.forEach((function(e){n.cachedPolicies[widget.lang][e.name]=n.cachedPolicies[widget.lang][e.name]||{},e.maturityGraph.states.forEach((function(t){n.cachedPolicies[widget.lang][e.name][t.stateSysName]=t}))})),localStorage.setItem("DocoMaturityCache:"+n.options.platformUrls["3DSpace"]+"/resources/lifecycle/maturity/getStateGraph?tenant="+n.options.platformUrls.platformId,JSON.stringify(n.cachedPolicies)),o(n.cachedPolicies))},onFailure:function(e,t){}};t.authenticatedRequest(a.url,a)}},load:function(){var e=localStorage.getItem("DocoMaturityCache:"+n.options.platformUrls["3DSpace"]+"/resources/lifecycle/maturity/getStateGraph?tenant="+n.options.platformUrls.platformId);null!=e&&null!=(e=JSON.parse(e))&&(n.cachedPolicies=e)},hasStateInfoForDoc:function(e){if(n.cachedPolicies&&n.cachedPolicies[widget.lang]&&(null!=n.cachedPolicies[widget.lang][e.dataelements.policy]&&null!=n.cachedPolicies[widget.lang][e.dataelements.policy][e.dataelements.state]))return!0;return!1}};return n})),define("DS/ENOXAttachmentsUX/views/Topbar",["UWA/Core","DS/UIKIT/Iconbar","DS/DocumentCommands/DOCMClipboard","DS/DocumentCreateNew/Utils/DocmDictionaryHandler","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],(function(e,t,n,o,a){"use strict";return function(a){var i={ctrl:void 0,build:function(a){this.ctrl=a;var s=[];a.config.actionbar.forEach((function(e){e.content&&e.content.options&&e.content.options.items&&e.content.options.items.length&&(e.content.options.events={onClick:function(e,t,n){i.handleClick(e,t,n)}},"sort"==e.name&&e.content.options.items.forEach((function(e){e.selected&&(i.currentSort={dataIndex:e.dataIndex,sort:e.order})}))),s.push(e),"ActionUpload"==e.methodName&&o.getTypeInfos({tenant:a.options.connectorOptions.platformUrls.platformId,securityContext:a.options.connectorOptions.fetchSecurityContext(),tenantUrl:a.options.connectorOptions.platformUrls["3DSpace"]},{preferredType:widget&&widget.getPreference&&widget.getPreference("lastSelected")&&widget.getPreference("lastSelected").defaultValue?widget.getPreference("lastSelected").defaultValue.typeName:"Document",subtypes:"true"})})),this.container=e.createElement("div",{class:a.getClassNames("-topbar")}),this.container.inject(a.elements.content),e.createElement("div",{class:a.getClassNames("-topbar-filler")}).inject(this.container),this.actionbar=new t({renderTo:this.container,items:s,className:a.getClassNames("-actionbar"),events:{onClick:function(e,t,n){i.handleClick(e,t,n)}}}),i.selectedItemsMenuButton=i.container.getElement("[name=actions]"),i.setPasteEnabled(),n.events.subscribe({event:"x3dcontent-copied"},(function(e){i.setPasteEnabled()})),this.setReadOnly(a.options.readonly),a.topBar=i},handleClick:function(e,t,n,o){t&&(i.actions[t.methodName]?i.actions[t.methodName](e,t,n):t.name.startsWith("viewswitch")?i.actions.SwitchView(e,t,n):t.fonticon.startsWith("sort-")&&i.actions.SwitchSort(e,t,n))},actions:{ActionActions:function(e,t,n){e.nodeModels=i.ctrl.controller.attachments.getSelectedNodes(),i.ctrl.controller.actionMenuHandler(e)},ActionUpload:function(e,t,n){i.ctrl.uploadPane.uploadButton.elements.container.click()},ActionAttach:function(e,t,n){i.ctrl.modelEvents.publish({event:"user-clicks-attach",data:{cancelled:!1}})},ActionAttachURL:function(e,t,n){i.ctrl.modelEvents.publish({event:"user-clicks-attach-url",data:{cancelled:!1}})},ActionDetach:function(e,t,n){i.ctrl.modelEvents.publish({event:"user-clicks-detach",data:{cancelled:!1}})},ActionPaste:function(e,t,o){n.paste(i.pasteX3dContent)},SwitchView:function(e,t,n){"view-list"==t.fonticon?i.ctrl.controller.switchView("grid"):i.ctrl.controller.switchView("tile")},SwitchSort:function(e,t,n){t.dataIndex==i.currentSort.dataIndex?(i.currentSort.sort="asc"==i.currentSort.sort?"desc":"asc",t.order=i.currentSort.sort,"tree"==t.dataIndex?t.elements.icon.className="fonticon fonticon-sort-alpha-"+i.currentSort.sort:t.elements.icon.className="fonticon fonticon-sort-num-"+i.currentSort.sort):i.currentSort={dataIndex:t.dataIndex,sort:t.order},i.ctrl.controller.applySortModel(i.currentSort)}},setDetachEnabled:function(e){e?i.container.getElement(".fonticon-remove").getParent().removeClassName("disabled"):i.container.getElement(".fonticon-remove").getParent().addClassName("disabled")},setPasteEnabled:function(){n.contentCopied?i.container.getElement(".fonticon-paste").getParent().removeClassName("disabled"):i.container.getElement(".fonticon-paste").getParent().addClassName("disabled")},pasteX3dContent:function(e){if(e.data){var t=e.data;if(t.data&&t.data.items&&t.data.items.length>0){var n=t.data.items.map((function(e){return{id:e.objectId,dataelements:e.dataelements}}));i.ctrl.controller.attachAttachments(n)}}else i.ctrl.controller.helper.showNotification("success","Nothing To Paste")},setReadOnly:function(e){e?(i.container.getElement(".fonticon-upload").getParent().addClassName("hidden"),i.container.getElement(".fonticon-plus").getParent().addClassName("hidden"),i.container.getElement(".fonticon-remove").getParent().addClassName("hidden"),i.container.getElement(".fonticon-link-add")&&i.container.getElement(".fonticon-link-add").getParent().addClassName("hidden")):(i.container.getElement(".fonticon-upload").getParent().removeClassName("hidden"),i.container.getElement(".fonticon-plus").getParent().removeClassName("hidden"),i.container.getElement(".fonticon-remove").getParent().removeClassName("hidden"),i.container.getElement(".fonticon-link-add")&&i.container.getElement(".fonticon-link-add").getParent().removeClassName("hidden"))}};return i.build(a),i}})),define("DS/ENOXAttachmentsUX/utils/Search",["UWA/Core","UWA/Utils/InterCom","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],(function(e,t,n){"use strict";return function(o){var a={ctrl:o,socketName:void 0,options:void 0,init:function(e){a.socketName&&a.destroy(),a.socketName="ENOXAttachmentsUX_"+(new Date).getTime(),a.setSearchOptions(e)},getdefaultOptions:function(){return{title:n.get("ATTACH_EXISTING"),multiSel:!0,source:["3dspace"],tenant:void 0,role:"",precondition:void 0,defaultSearchCriteria:void 0}},destroy:function(){a.socket&&(a.socket.dispatchEvent("unregisterSearchContext",{widget_id:widget.id}),a.socket.unsubscribeServer("SearchComServer"),a.socket.removeListener("Selected_Objects_search",a.objectsSelected),a.socket.disconnect(),delete a.socket),a.socketName=void 0},execute:function(){if(null==a.options.tenant)throw"Needs Actual Tenant ID";a.ctrl.options.parentObject&&a.ctrl.options.parentObject.parentId?a.originalSearchOptions.resourceid_not_in=[a.ctrl.options.parentObject.parentId]:a.originalSearchOptions.resourceid_not_in=[],a.originalSearchOptions.resourceid_not_in.push(a.ctrl.controller.helper.restrict(a.ctrl.controller.attachments.getRoots(),"options.data.id"));var e={cancelled:!1,options:a.originalSearchOptions};a.ctrl.modelEvents.publish({event:"user-clicks-add-existing",data:e}),e.cancelled||(a.setSearchOptions(e.options),a.ctrl.modelEvents.publish({event:"open-3dsearch-for-add-existing",data:a.options}),null==a.socket&&(a.socket=new t.Socket(a.socketName,{dispatchRetryInterval:5}),a.socket.subscribeServer("SearchComServer"),a.socket.addListener("Selected_Objects_search",a.objectsSelected)),a.socket.dispatchEvent("unregisterSearchContext",{widget_id:widget.id}),a.socket.dispatchEvent("RegisterContext",a.options),a.socket.dispatchEvent("InContextSearch",a.options))},objectsSelected:function(e,t,n){var o=e.map((function(e){return{id:e.id,dataelements:{typeNLS:e["ds6w:type"]??"",title:e["ds6w:label_value"]??"",secondaryTitle:e["ds6w:label_value"]||e["ds6w:identifier"],name:e["ds6w:identifier"]??"",type:e["ds6w:type_value"]??""}}}));a.ctrl.controller.attachAttachments(o)},setSearchOptions:function(t){e.merge(t,a.getdefaultOptions());var o=a.originalSearchOptions=t;if(a.options={},a.options.title=o.title||n.get("ATTACH_EXISTING"),a.options.mode="furtive",a.options.app_socket_id=a.socketName,a.options.widget_id=widget.id,a.options.default_with_precond=!0,a.options.multiSel=o.multiSel||!0,a.options.source=o.source||["3dspace"],a.options.tenant=o.tenant,a.options.role=o.role||"",a.options.precond=void 0,Array.isArray(o.includedTypes)&&!o.includedTypes.includes("*")){o.includedTypes.forEach((function(e,t){0!==t&&(a.options.precond+=" OR "),null==a.options.precond&&(a.options.precond=""),a.options.precond+='flattenedtaxonomies:"types/'+e+'"'}));var i=["Controlled Document Template","Rendition Document Template","Version","ProxyItem"];i.forEach(((e,t)=>{'(policy:"'+e+'")',t!=i.length-1&&" OR "}))}if(null==a.options.precond&&(a.options.precond=""),a.options.precond&&""!==a.options.precond&&(a.options.precond="("+a.options.precond+")"),Array.isArray(o.excludedTypes)){var s="";o.excludedTypes.forEach((function(e,t){0!==t&&(s+=" OR "),s+='flattenedtaxonomies:"types/'+e+'"'})),""!=s&&(s=" NOT ("+s+")"),""!=a.options.precond&&""!=s?a.options.precond="("+a.options.precond+" AND "+s+")":""!=s&&(a.options.precond="("+s+")")}o.precondition&&a.options.precond?a.options.precond="("+a.options.precond+" AND "+o.precondition+")":o.precondition&&(a.options.precond=o.precondition),o.defaultSearchCriteria&&""!==o.defaultSearchCriteria.trim()&&(a.options.default_search_criteria=o.defaultSearchCriteria),o.resourceid_in&&Array.isArray(o.resourceid_in)&&(a.options.resourceid_in=o.resourceid_in),o.resourceid_not_in&&Array.isArray(o.resourceid_not_in)&&(a.options.resourceid_not_in=o.resourceid_not_in)}};return a}})),define("DS/ENOXAttachmentsUX/ajaxRequests/DocPropertiesModel",["DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests","DS/WebappsUtils/WebappsUtils","DS/PlatformAPI/PlatformAPI","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],(function(e,t,n,o){"use strict";function a(){return t.getWebappsAssetUrl("ENOXAttachmentsUX","icons/LinkThumbnailBig.png")}return{commitModels:async function(t){var a=t.modelList;if(a.length){let r=a[0],l=r.changedValues.Title,c=r.changedValues.URL,d=r.get("objectId"),p=l?l.valueDB:null,u=c?c.valueDB:null;var i=r.get("type").split("?")[1];if(i)var s=i.split("=")[1];this.getLatestCSRF().then((a=>{t.headers={Accept:"application/json"},t.model=r,t.withSC=!0,t.withChange="silent",t.source="3DSpace";var i={csrf:a,data:[{id:d,updateAction:"MODIFY",dataelements:{title:r.get("Title").valueDB,proxyurl:r.get("URL").valueDB,parentId:s}}]};if(p&&(i.data[0].dataelements.title=p),u){u=/^[A-Za-z]+:\/\/.*$/.test(u)?u:`https://${u}`,i.data[0].dataelements.proxyurl=u}try{new URL(i.data[0].dataelements.proxyurl)}catch(e){return void t.onComplete({success:!1,results:[],error:o.get("INVALID_URL")})}t.onCompleteWS=e=>{let o={results:[]};o.results.push({status:200,body:{physicalid:e.data[0].id,Title:{selectable:"Title",name:"Title",value:[e.data[0].dataelements.title]},URL:{selectable:"URL",name:"URL",value:[e.data[0].dataelements.proxyurl]},url:"model/bus/"+e.data[0].id,errors:[]}}),t.onComplete(o),r.get("objectId")!=e.data[0].id&&(e.data[0]._oldUrlId=r.get("objectId"),r.set({objectId:e.data[0].id})),n.publish("Enox-Attachment-Refresh",{data:{platformId:t.tenant,parentId:e.data[0].dataelements.parentId,modified:e.data}})},e.createRequest(t,"POST","/resources/v1/modeler/documents/manageExternalURL",i)})).catch((e=>{console.log(e),t.onComplete({results:[],UXMessage:[""]})}))}},getLatestCSRF:function(){var t={};return new Promise(((n,o)=>{t.onCompleteWS=e=>{n(e.csrf)},e.createRequest(t,"GET","/resources/v1/application/E6WFoundation/CSRF",undefined)}))},getListOfAttributes:function(t){var n=t.modelList;if(1===n.length&&!n[0].isMergedModel()){let s=n[0],r=s.get("objectId");t.headers={Accept:"application/json","Accept-Language":widget.lang};var i="/resources/v1/modeler/documents/"+r;t.model=s,t.withSC=!0,t.withChange="silent",t.source="3DSpace",t.onCompleteWS=e=>{var n={options:{autoExpand:!1},results:[{computed:{label:{path:"Title",name:"Title",value:[e.data[0].dataelements.title]}},data:[{path:"Title",nls:o.get("Title"),maxlength:0,name:"Title",readOnly:!1,type:"string",value:[e.data[0].dataelements.title],mandatory:!0,UIPosition:2},{path:"URL",nls:o.get("URL"),maxlength:0,name:"URL",readOnly:!1,type:"string",value:[e.data[0].dataelements.proxyurl],mandatory:!0,UIPosition:3}],physicalID:e.data[0].id,metatype:"bus",type:s.get("type"),type_icon_large_url:a(),PLMParametersAvailable:!1,preview_url:"",success:!0,modifyAccess:!0,groupData:[]}]};s._currentLinkInfo=e,t.onComplete(n)},e.createRequest(t,"GET",i,undefined)}},getPreviewUrl:function(e){var t=[];t.push({id:e.modelList[0]._attributes.objectId,preview:a()}),e.onComplete(t)}}})),define("DS/ENOXAttachmentsUX/utils/Overlay",["UWA/Core"],(function(e){"use strict";return{overlay:function(t,n){var o;this.isOverlaid(t)&&this.unoverlay(t),t.addClassName("overlaid"),o=e.createElement("div",{class:"overlay"}),n=e.is(n,"string")?n:"",n=e.createElement("div",{class:"overlay-wrapper",html:{tag:"div",class:"overlay-content",html:[e.createElement("span",{class:"text",text:n})]}}).inject(o),o.inject(t)},unoverlay:function(e){var t=e.getElement(" > .overlay");t&&t.destroy(),e.removeClassName("masked")},isOverlaid:function(e){return e.hasClassName("overlaid")}}})),define("DS/ENOXAttachmentsUX/views/ProgressPane",["UWA/Core","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],(function(e,t){"use strict";return function(n){var o={build:function(n){this.ctrl=n,this.container=e.createElement("div",{class:n.getClassNames("-progresspane")}),this.container.inject(this.ctrl.elements.content);var a=e.createElement("div",{class:"progresspane-titlebar"});a.inject(this.container),e.createElement("div",{class:"progresspane-title",text:t.get("PROGRESS")}).inject(a);var i=e.createElement("button",{class:"close fonticon fonticon-chevron-down",type:"button"});i.inject(a),i.addEvent("click",(function(){i.classList.contains("fonticon-chevron-down")?(i.classList.remove("fonticon-chevron-down"),i.classList.add("fonticon-chevron-up"),o.content.hide()):(i.classList.remove("fonticon-chevron-up"),i.classList.add("fonticon-chevron-down"),o.content.show())})),this.content=e.createElement("div",{class:"progresspane-content"}),this.content.inject(this.container),this.hide(),n.progressPane=o},show:function(){this.container.show()},hide:function(){this.container.hide()},addProgress:function(t){o.show();var n=e.createElement("div",{class:"progresspane-job"}),a=e.createElement("div",{class:"progresspane-jobtitle",text:t.title,title:t.title});a.inject(n);var i=e.createElement("progress",{class:"progress progresspane-jobprogress",value:0,max:100});i.inject(n),n.inject(o.content),t.progress=n,t.progress.update=function(e,t,n){a.setText(e),i.setAttributes({value:t,max:n,title:e})}}};return o.build(n),o}})),define("DS/ENOXAttachmentsUX/Actions/DeleteLink",["UWA/Core","DS/DocumentCommonInfra/components/DeleteDialog","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],(function(e,t,n){"use strict";var o=function(e){return{id:"deleteLink",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"trash",fontIconFamily:1},label:n.get("Delete"),tooltip:n.get("Delete"),position:"far",category:"dialog",value:function(t){t.options=e,o.execute(t)},visibleFlag:!0},execute:function(){o.execute({options:e})},updateForSelection:function(e,t){return Promise.resolve(!0)}}};return o.execute=function(n){var o=this,a=e.Promise.deferred(),i={data:{data:n.options.getSelectedNodes().map((e=>({physicalid:e.options.data.id})))},onComplete:e=>{console.log(e),a.resolve(e)},onFailure:e=>{console.log(e),a.reject("Failed to fetch access rights.")}};n.options.getSelectedNodes().length>1&&n.options.events.publish({event:"fetch-url-attachment-delete-access",data:{options:i}}),o.deleteDialog&&o.deleteDialog.components.myDialog&&(o.deleteDialog.immersiveFrame&&o.deleteDialog.immersiveFrame.destroy(),o.deleteDialog.components.myDialog.destroy(),o.deleteDialog.components.myDialog=void 0);var s={getSelectedNodes:n.options.getSelectedNodes,events:n.options.events,dialogCustomizations:{customizeData:async e=>{try{var t=(await a.promise).data.reduce(((e,t)=>(t.access||e.push(t.physicalid),e)),[]);return e.forEach((e=>{t.includes(e.data.id)&&(e.grid.preCheckStatus=!1)})),e}catch(t){return e.forEach((e=>{e.grid.preCheckStatus=void 0})),e}}},platformUrls:e.clone(n.options.platformUrls,!0),onDelete:function(e){n.options.events.publish({event:"user-confirms-delete",data:{urlData:n.options.getSelectedNodes()}})}};o.deleteDialog=new t(s)},o})),define("DS/ENOXAttachmentsUX/data/Connector3DSpace",["UWA/Core","UWA/Utils","DS/ENOXAttachmentsUX/data/Constants","DS/DocumentManagement/DocumentManagement","DS/DocumentCommonInfra/TrackerAPI","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],(function(e,t,n,o,a,i,s,r,l){"use strict";return function(){var c={options:{},init:function(e,t){if(c.controller=e,c.options=t||{},!(c.options&&c.options.fetchSecurityContext&&c.options.platformUrls&&c.options.platformUrls["3DSpace"]&&c.options.platformUrls.platformId)){n=new Date-e.ctrl.attachmentsPaneStartTime;throw a.sendTrackerPageEvent({category:"docm.attachmentsPane.ready",action:"click",label:"Attachments Ready",pd:{},pv:{totalTimeTaken:n,failure:0}}),new Error("Connector Options incomplete")}var n=new Date-e.ctrl.attachmentsPaneStartTime;a.sendTrackerPageEvent({category:"docm.attachmentsPane.ready",action:"click",label:"Attachments Ready",pd:{},pv:{totalTimeTaken:n,success:1}}),c.ready=!0,c.controller.connectorReady(c.options)},loadAttachments:function(i){if(!this.ready){var s=new Date-r;throw a.sendTrackerPageEvent({category:"docm.attachments.ready",action:"auto",label:"Attachments Ready",pd:{parentId:void 0,parentObjs:void 0,parentRelName:void 0},pv:{totalTimeTaken:s,aborted:-1}}),new Error("Connector not ready")}var r=new Date;if(i){var d=t.getUUID();if(c.controller.loadToken=d,i.noParent&&e.is(i.objectIds,"array"))o.getDocuments(i.objectIds,{tenant:c.options.platformUrls.platformId,securityContext:c.options.fetchSecurityContext(),tenantUrl:c.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle,isLatestRevision,!parentId",onComplete:function(e){var t=c.controller.ctrl.options.parentObject;if(i.objectIds==t.objectIds){if(e.success){if(!Array.isArray(e.data))return;var n=new Date-r;a.sendTrackerPageEvent({category:"docm.attachments.ready",action:"auto",label:"Attachments Ready",pd:{parentId:void 0,parentObjs:i.objectIds,parentRelName:i.parentRelName},pv:{totalTimeTaken:n,success:1,numOfDocs:e.data.length}}),c.controller.loadToken==d&&c.controller.addAttachmentsToUI(e.data)}c.controller.finishLoadingAttachments()}},onFailure:function(e){var t=new Date-r;a.sendTrackerPageEvent({category:"docm.attachments.ready",action:"auto",label:"Attachments Ready",pd:{parentId:void 0,parentObjs:i.objectIds,parentRelName:i.parentRelName},pv:{totalTimeTaken:t,failure:0,numOfDocs:0}}),c.controller.finishLoadingAttachments(),e.error&&c.controller.showNotification("error",l.get("FAILED_TO_LOAD_ATTACHMENTS"),e.error)}});else{var p={relInfo:{parentId:i.parentId,parentRelName:i.relationName||n.REFERENCE_DOCUMENT,parentDirection:"from"},tenant:c.options.platformUrls.platformId,securityContext:c.options.fetchSecurityContext(),tenantUrl:c.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle,isLatestRevision,!parentId",onComplete:function(e,t){var o=c.controller.ctrl.options.parentObject;if(t.relInfo.parentId==o.parentId&&t.relInfo.parentRelName==(o.relationName||n.REFERENCE_DOCUMENT)){if(!Array.isArray(e.data))return;e.data.forEach((function(e){e.relName=p.relInfo.parentRelName}));var s=new Date-r;a.sendTrackerPageEvent({category:"docm.attachments.ready",action:"auto",label:"Attachments Ready",pd:{parentId:i.parentId,parentObjs:i.objectIds,parentRelName:p.relInfo.parentRelName},pv:{totalTimeTaken:s,success:1,numOfDocs:e.data.length}}),c.controller.loadToken==d&&c.controller.addAttachmentsToUI(e.data),c.controller.finishLoadingAttachments()}},onFailure:function(e,t){console.error(e);var n=new Date-r;a.sendTrackerPageEvent({category:"docm.attachments.ready",action:"auto",label:"Attachments Ready",pd:{parentId:i.parentId,parentObjs:i.objectIds,parentRelName:p.relInfo.parentRelName},pv:{totalTimeTaken:n,failure:1,numOfDocs:0}}),e.error&&c.controller.showNotification("error",l.get("FAILED_TO_LOAD_ATTACHMENTS"),e.error),c.controller.finishLoadingAttachments()}};o.getDocumentsFromParent(p)}}},uploadAttachments:function(e,t,o){require(["DS/DocumentCreateNew/CreateNew","DS/Windows/ImmersiveFrame"],(function(a,i){var s=new i;s.inject(widget.body),new a({tenantUrl:c.options.platformUrls["3DSpace"],securityContext:c.options.fetchSecurityContext(),tenant:c.options.platformUrls.platformId,immersiveFrame:s,parentObject:t,parentRelName:t.relationName||n.REFERENCE_DOCUMENT,connector:c,supportedTypes:o,isFromPopup:c.controller.options.isPopup,credentialsPrefName:c.options.credentialsPrefName||n.PAD_CURRENT_SECURITY_CONTEXT,onUploadStart:function(){s.destroy()},onCancel:function(){s.destroy()},onError:function(e){c.controller.showNotification("error",l.get("UPLOAD_FAILED"),e.subtitle,e.message||""),s.destroy()}}).create(e)}))},attachAttachments:async function(t,a){if(Array.isArray(t)&&t.length>0&&"string"==typeof t[0]){var i=await new Promise(((e,n)=>{o.getDocuments(t,{tenant:c.options.platformUrls.platformId,securityContext:c.options.fetchSecurityContext(),tenantUrl:c.options.platformUrls["3DSpace"],additionalURLParams:"$include=none",onComplete:function(t){t.success&&e(t.data)},onFailure:function(e){console.error(e),c.controller.showNotification("error",l.get("DOCUMENT_ATTACH_FAILED")),n("Failed")}})}));if("Failed"==i)return;t=i}var s=t.map((e=>e.id));if(s.length>0){var r=c.controller.attachments.getRoots();if(r.length)for(var p=0;p<r.length;p++){var u=r[p];if(s.includes(u.options.data.id)){c.controller.showNotification("error",l.get("TYPE_ATTACH_FAILED",{type:u.options.data.dataelements.typeNLS}),l.get("X_IS_ALREADY_ATTACHED",{title:u.options.data.dataelements.title||u.options.data.dataelements.secondaryTitle||u.options.data.dataelements.name}));var m=s.indexOf(u.options.data.id);m>-1&&(s.splice(m,1),t.splice(m,1))}}for(var h=[],f=0;f<t.length;f++){var g=t[f];g.dataelements.type||(g.dataelements.type=g.type),t[f].dataelements.relName=a.relationName||n.REFERENCE_DOCUMENT;if(a&&a.parentId&&g.id===a.parentId){c.controller.showNotification("error",l.get("TYPE_ATTACH_FAILED",{type:g.dataelements.typeNLS}),l.get("CANNOT_ATTACH_X_TO_ITSELF",{title:g.dataelements.title||g.dataelements.secondaryTitle||g.dataelements.name})),!1;break}if(!c.controller.options.supportedTypes.includedTypes.includes("*")&&!c.controller.options.supportedTypes.includedTypes.includes(g.dataelements.type)||c.controller.options.supportedTypes.excludedTypes.includes(g.dataelements.type))c.controller.showNotification("error",l.get("DOCUMENT_NOT_ALLOWED",{type:g.dataelements.typeNLS}),l.get("X_CANNOT_BE_ATTACHED",{type:g.dataelements.type}));else{var v=new Promise((function(t,n){if(a.noParent){var o={onFailure:function(t){console.error(t),e.is(t,"string")&&c.controller.showNotification("error",l.get("FAILED_TO_ATTACH_ATTACHMENT"),t),n(t)},onSuccess:function(e){c.controller.addAttachmentsToUI([e]),c.controller.showNotification("success",l.get("DOCUMENT_ATTACHED",{type:e.dataelements.typeNLS}),l.get("X_ATTACHED_SUCCESSFULLY",{title:e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name})),t(e)}};c.controller.events.publish({event:"attach-document-requested",data:{document:g,parentObject:a,callback:o}})}else d(g,a,t,n)}));h.push(v)}}Promise.allSettled(h).then((function(t){var i=[];t.forEach((function(e){"fulfilled"===e.status&&i.push(e.value.id)})),i.length&&o.getDocuments(i,{tenant:c.options.platformUrls.platformId,securityContext:c.options.fetchSecurityContext(),tenantUrl:c.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle,isLatestRevision,!parentId",onComplete:function(e){if(e.success)for(var t=0;t<e.data.length;t++){var o=e.data[t];e.data[t].relName=a.relationName||n.REFERENCE_DOCUMENT,c.controller.addAttachmentsToUI([o])}},onFailure:function(t){if(t.error)if((t.error.match(/\n/g)||[]).length>2){for(var n=t.error.split("\n"),o=[],a=2;a<n.length;a++)o.push(n[a]);o=o.join("<br/>"),c.controller.showNotification("error",n[0],n[1],o,void 0,!0)}else c.controller.showNotification("error",l.get("DOCUMENT_ATTACH_FAILED"),t.error);else e.is(t,"string")?c.controller.showNotification("error",l.get("DOCUMENT_ATTACH_FAILED"),t):c.controller.showNotification("error",l.get("DOCUMENT_ATTACH_FAILED"))}})}))}},detachAttachments:function(e,t){if(t.noParent){var n={onSuccess:function(t){e.forEach((function(e){t.forEach((function(t){e.options.data.id==t&&(c.controller.attachments.removeRoot(e),c.controller.showNotification("success",l.get("DOCUMENT_DETACHED",{type:e.options.data.dataelements.typeNLS}),l.get("X_DETACHED_SUCCESSFULLY",{title:e.options.data.dataelements.title||e.options.data.dataelements.secondaryTitle||e.options.data.dataelements.name})))}))}))}};c.controller.events.publish({event:"detach-attachments-requested",data:{ids:c.controller.helper.restrict(e,"options.data.id"),parentObject:t,callback:n}})}else for(var o=0;o<e.length;o++){p(e[o],t)}},getUpdatedAttachment:function(t,a){o.getDocuments([t.id],{tenant:c.options.platformUrls.platformId,securityContext:c.options.fetchSecurityContext(),tenantUrl:c.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle,isLatestRevision,!parentId",onComplete:function(e){if(e.success){if(!Array.isArray(e.data))return;e.data.forEach((function(e){e.relName=t.relName||n.REFERENCE_DOCUMENT})),a(e.data)}},onFailure:function(t){t.error?c.controller.showNotification("error",l.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),t.error):e.is(t,"string")?c.controller.showNotification("error",l.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),t):c.controller.showNotification("error",l.get("FAILED_TO_GET_UPDATED_ATTACHMENT"))}})},getUpdatedAttachments:function(t,n,a){o.getDocuments(t.map((function(e){return e.id})),{tenant:c.options.platformUrls.platformId,securityContext:c.options.fetchSecurityContext(),tenantUrl:c.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle,isLatestRevision,!parentId",onComplete:function(e){if(e.success){if(!Array.isArray(e.data))return;n(e.data)}},onFailure:function(t){e.is(a,"function")?a(t):t.error?c.controller.showNotification("error",l.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),t.error):e.is(t,"string")?c.controller.showNotification("error",l.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),t):c.controller.showNotification("error",l.get("FAILED_TO_GET_UPDATED_ATTACHMENT"))}})},ready:!1,uploadAttachment:function(t,n,s){if(c.ready){var r=e.is(c.options.getWorkUnderHeaders,"function")?c.options.getWorkUnderHeaders():function(){let t=i.get(),n=e.is(t)&&e.is(t.change.id)?t.change.id:null;return""!=n?{"DS-Change-Authoring-Context":"pid:"+n}:{}}();s&&(r.SecurityContext=encodeURIComponent(s));var d={customDocumentObject:t.custom_attributes?{dataelements:t.custom_attributes}:void 0,tenant:c.options.platformUrls.platformId,securityContext:s,tenantUrl:c.options.platformUrls["3DSpace"],additionalURLParams:"disableOwnershipInheritance=1",additionalHeaders:r,onFailure:function(e){var o=new Date-p.attachmentUploadStart;if(a.sendTrackerPageEvent({category:"docm.attachment.upload.complete",action:"click",label:"Attachment Upload Done",pd:{parentId:t.relInfo?t.relInfo.parentId||"":void 0,parentRelName:t.relInfo?t.relInfo.parentRelName||"":void 0,securityContext:s,docType:t.type,fileType:t.fileInfo.file.name.substring(t.fileInfo.file.name.lastIndexOf(".")+1,t.fileInfo.file.name.length)||t.fileInfo.file.name,filesize:t.fileInfo.file.size},pv:{totalTimeTaken:o,failure:0}}),e.error)if((e.error.match(/\n/g)||[]).length>2){for(var i=e.error.split("\n"),r=[],d=2;d<i.length;d++)r.push(i[d]);r=r.join("<br/>"),c.controller.showNotification("error",i[0],i[1],r,void 0,!0)}else c.controller.showNotification("error",l.get("UPLOAD_FAILED"),e.error);else t.dataelements||(t.dataelements={title:t.title}),c.controller.showNotification("error",l.get("UPLOAD_FAILED"),e.error?e.error:l.get("X_UPLOAD_FAILED",{title:t.dataelements.title||t.dataelements.secondaryTitle||t.dataelements.name}));c.controller.events.publish({event:"upload-attachment-failure",data:{document:t,parentObject:n}}),c.controller.jobs.finishJob(p,"failed")},onProgress:function(e){c.controller.events.publish({event:"upload-attachment-progress",data:{document:t,parentObject:n}}),p.update(e)},onComplete:function(e){var o=new Date-p.attachmentUploadStart;a.sendTrackerPageEvent({category:"docm.attachment.upload.complete",action:"click",label:"Attachment Upload Done",pd:{parentId:t.relInfo?t.relInfo.parentId||"":void 0,parentRelName:t.relInfo?t.relInfo.parentRelName||"":void 0,securityContext:s,docType:t.type,fileType:t.fileInfo.file.name.substring(t.fileInfo.file.name.lastIndexOf(".")+1,t.fileInfo.file.name.length)||t.fileInfo.file.name,filesize:t.fileInfo.file.size},pv:{totalTimeTaken:o,success:1}}),e.data&&(e.data[0].dataelements.isDocumentType="TRUE");var i=e.data;i.forEach((function(e){e.delayLoadThumbnails=!0,t.relInfo&&(e.relName=t.relInfo.parentRelName)}));var r=function(e){e[0].dataelements.parentId&&c.controller.options.parentObject.parentId?e[0].dataelements.parentId.includes(c.controller.options.parentObject.parentId)&&c.controller.addAttachmentsToUI(e):c.controller.addAttachmentsToUI(e),1==e.length?c.controller.showNotification("success",l.get("DOCUMENT_ATTACHED",{type:e[0].dataelements.typeNLS}),l.get("X_ATTACHED_SUCCESSFULLY",{title:e[0].dataelements.title||e[0].dataelements.secondaryTitle||e[0].dataelements.name})):e.length>1&&c.controller.showNotification("success",l.get("DOCUMENTS_ATTACHED"),l.get("X_DOCUMENTS_ATTACHED_SUCCESSFULLY",{num:e.length}))},d={event:"upload-attachment-complete",data:{documents:i,parentObject:n}};n.noParent&&(d.data.callback=r),c.controller.events.publish(d),c.controller.jobs.finishJob(p),n.noParent||r(i)}},p={title:l.get("UPLOADING_X",{title:t.title}),ui:!0,process:function(){p.attachmentUploadStart=new Date,o.createDocument(t,d)}};c.controller.jobs.addJob(p)}},attachUrlAsAttachment:function(t,o){if(c.ready){var a={csrf:{name:"ENO_CSRF_TOKEN",value:""},data:[{dataelements:{policy:"ProxyItem",title:t.title,proxyurl:t.url,parentId:o.parentId,parentRelName:o.relationName||n.REFERENCE_DOCUMENT,parentDirection:"from"},type:n.Document_Proxy}]},i={method:"POST",timeout:3e4,headers:{"Content-Type":"application/json","Accept-Language":widget.lang,SecurityContext:encodeURIComponent(c.options.fetchSecurityContext())},data:a,type:"json",tenant:c.options.platformUrls.platformId,onFailure:function(n,a){c.controller.showNotification("error",l.get("TYPE_ATTACH_FAILED",{type:"Link"}),l.get("X_ATTACH_FAILED",{title:t.title,reason:a&&e.is(a.internalError,"string")&&a.internalError.includes("No fromconnect access")?l.get("INSUFFICIENT_ACCESS"):""})),c.controller.events.publish({event:"attach-url-attachment-failure",data:{document:void 0,urlData:t,parentObject:o}}),c.controller.jobs.finishJob(r)},onProgress:function(e){c.controller.events.publish({event:"attach-url-attachment-progress",data:{document:void 0,urlData:t,parentObject:o}})},onComplete:function(e){c.controller.showNotification("success",l.get("URL_ATTACHED"),l.get("X_ATTACHED_SUCCESSFULLY",{title:t.title})),c.controller.jobs.finishJob(r),e.data[0].dataelements.parentId==c.controller.options.parentObject.parentId&&c.controller.addAttachmentsToUI(e.data),c.controller.events.publish({event:"attach-url-attachment-complete",data:{document:void 0,urlData:t,parentObject:o}})}},r={title:t.title,ui:!1,process:function(){u().then((e=>{i.data.csrf=e,i.data=JSON.stringify(i.data),s.authenticatedRequest(c.options.platformUrls["3DSpace"]+"/resources/v1/modeler/documents/?disableOwnershipInheritance=1",i)})).catch((e=>{c.controller.jobs.finishJob(r)}))}};c.controller.jobs.addJob(r)}},deleteUrlAttachment:function(t,n){if(c.ready){var o={csrf:{name:"ENO_CSRF_TOKEN",value:""},data:[]},a=[];t.forEach((e=>{a.push(e.options.data.id),o.data.push({id:e.options.data.id,updateAction:"DELETE",dataelements:{parentId:n.parentId}})}));var i={method:"POST",timeout:3e4,headers:{"Content-Type":"application/json","Accept-Language":widget.lang,SecurityContext:encodeURIComponent(c.options.fetchSecurityContext())},data:o,type:"json",tenant:c.options.platformUrls.platformId,onFailure:function(o,a){c.controller.showNotification("error",l.get("URL_Delete_Failed"),l.get("URL_Delete_Failed_MSG",{title:t.length>1?l.get("SELECTED_LINKS"):t[0].options.data.dataelements.title,reason:a&&e.is(a.internalError,"string")&&a.internalError.includes("No fromdisconnect access")?l.get("INSUFFICIENT_ACCESS"):""})),c.controller.events.publish({event:"delete-url-attachment-failure",data:{document:void 0,urlData:t,parentObject:n}}),c.controller.jobs.finishJob(d)},onProgress:function(e){c.controller.events.publish({event:"delete-url-attachment-progress",data:{document:void 0,urlData:t,parentObject:n}})},onComplete:function(e){c.controller.jobs.finishJob(d),e.data.forEach((function(e){c.controller.attachments.getRoots().forEach((function(t){t.options.data.id==e.id&&(c.controller.events.publish({event:"delete-url-attachment-complete",data:{id:c.controller.helper.restrict(t,"options.data.id"),parentObject:n}}),r.publish("Enox-Attachment-Refresh",{data:{platformId:c.options.platformUrls.platformId,parentId:e.dataelements.parentId,deleted:e}}),c.controller.showNotification("success",l.get("Link_Deleted"),l.get("X_DELETED_SUCCESSFULLY",{title:t.options.grid.title})),c.controller.attachments.removeRoot(t))}))}))}},d={title:t[0].title,ui:!1,process:function(){u().then((e=>{i.data.csrf=e,i.data=JSON.stringify(i.data),s.authenticatedRequest(c.options.platformUrls["3DSpace"]+"/resources/v1/modeler/documents/manageExternalURL",i)})).catch((e=>{c.controller.jobs.finishJob(d)}))}};c.controller.jobs.addJob(d)}},fetchURLAttachmentDeleteAccess:function(e,t){e.data.parentId||(e.data.parentId=t.parentId),s.authenticatedRequest(c.options.platformUrls["3DSpace"]+"/resources/v1/modeler/documents/checkURLDeleteAccess",{method:"POST",headers:{Accept:"application/json","content-type":"application/json","Accept-Language":widget.lang,SecurityContext:c.options.fetchSecurityContext()?encodeURIComponent(c.options.fetchSecurityContext()):void 0},type:"json",data:JSON.stringify(e.data),onComplete:function(t){e.onComplete(t)},onFailure:function(t){e.onFailure(t),console.error(t)}})}};function d(e,t,a,i){if(c.ready){var s={relInfo:{parentId:t.parentId,parentRelName:t.relationName||n.REFERENCE_DOCUMENT,parentDirection:"from"},tenant:c.options.platformUrls.platformId,securityContext:c.options.fetchSecurityContext(),tenantUrl:c.options.platformUrls["3DSpace"],additionalURLParams:"disableOwnershipInheritance=1",additionalHeaders:{SecurityContext:c.options.fetchSecurityContext()?encodeURIComponent(c.options.fetchSecurityContext()):void 0},onFailure:function(n){if(n.error)if((n.error.match(/\n/g)||[]).length>2){for(var o=n.error.split("\n"),a=[],s=2;s<o.length;s++)a.push(o[s]);a=a.join("<br/>"),c.controller.showNotification("error",o[0],o[1],a,void 0,!0)}else c.controller.showNotification("error",l.get("TYPE_ATTACH_FAILED",{type:e.dataelements.typeNLS}),n.error);else c.controller.showNotification("error",l.get("TYPE_ATTACH_FAILED",{type:e.dataelements.typeNLS}),l.get("X_ATTACH_FAILED",{title:e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name}));c.controller.events.publish({event:"attach-attachment-failure",data:{document:e,parentObject:t}}),i(n),c.controller.jobs.finishJob(r)},onProgress:function(n){c.controller.events.publish({event:"attach-attachment-progress",data:{document:e,parentObject:t}}),r.update(n)},onComplete:function(n){c.controller.events.publish({event:"attach-attachment-complete",data:{document:e,parentObject:t}}),e.relName=s.relInfo.parentRelName,c.controller.jobs.finishJob(r),t.parentId,c.controller.options.parentObject.parentId,a(e),c.controller.showNotification("success",l.get("DOCUMENT_ATTACHED",{type:e.dataelements.typeNLS}),l.get("X_ATTACHED_SUCCESSFULLY",{title:e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name}))}},r={title:l.get("ATTACHING_X",{title:e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name}),ui:!1,process:function(){o.connectDocumentToParent(e.id,s)}};c.controller.jobs.addJob(r)}}function p(t,a){if(c.ready){var i={relInfo:{parentId:a.parentId,parentRelName:t.options.data.relName||n.REFERENCE_DOCUMENT,parentDirection:"from"},tenant:c.options.platformUrls.platformId,securityContext:c.options.fetchSecurityContext(),tenantUrl:c.options.platformUrls["3DSpace"],additionalHeaders:{SecurityContext:c.options.fetchSecurityContext()?encodeURIComponent(c.options.fetchSecurityContext()):void 0},onFailure:function(n){if(c.controller.events.publish({event:"detach-attachment-failure",data:{id:c.controller.helper.restrict(t,"options.data.id"),parentObject:a}}),c.controller.jobs.finishJob(s),n.error)if((n.error.match(/\n/g)||[]).length>2){for(var o=n.error.split("\n"),i=[],r=2;r<o.length;r++)i.push(o[r]);i=i.join("<br/>"),c.controller.showNotification("error",o[0],o[1],i,void 0,!0)}else c.controller.showNotification("error",l.get("FAILED_TO_DETACH_ATTACHMENT",{type:t.options.data.dataelements.typeNLS}),n.error);else e.is(n,"string")?c.controller.showNotification("error",l.get("FAILED_TO_DETACH_ATTACHMENT",{type:t.options.data.dataelements.typeNLS}),n):c.controller.showNotification("error",l.get("FAILED_TO_DETACH_ATTACHMENT",{type:t.options.data.dataelements.typeNLS}))},onProgress:function(e){c.controller.events.publish({event:"detach-attachment-progress",data:{id:c.controller.helper.restrict(t,"options.data.id"),parentObject:a}}),s.update(e)},onComplete:function(e){c.controller.jobs.finishJob(s),e.success&&c.controller.attachments.getRoots().forEach((function(t){e.data.forEach((function(e){t.options.data.id==e.id&&(c.controller.events.publish({event:"detach-attachment-complete",data:{id:c.controller.helper.restrict(t,"options.data.id"),parentObject:a}}),c.controller.attachments.removeRoot(t),c.controller.showNotification("success",l.get("DOCUMENT_DETACHED",{type:t.options.data.dataelements.typeNLS}),l.get("X_DETACHED_SUCCESSFULLY",{title:t.options.data.dataelements.title||t.options.data.dataelements.secondaryTitle||t.options.data.dataelements.name})))}))}))}},s={title:l.get("DETACHING_X",{title:t.options.data.dataelements.title||t.options.data.dataelements.secondaryTitle||t.options.data.dataelements.name}),ui:!1,process:function(){o.disconnectDocumentFromParent(t.options.data.id,i)}};c.controller.jobs.addJob(s)}}function u(){return new e.Promise((function(e,t){s.authenticatedRequest(c.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",onComplete:function(t){e(JSON.parse(t).csrf)},onFailure:function(e){console.warn("Failed to get CSRF"),t(e)}})}))}return c}})),define("DS/ENOXAttachmentsUX/data/Model",["DS/TreeModel/TreeNodeModel","DS/ENOXAttachmentsUX/utils/MaturityCache","DS/Tweakers/TypeRepresentationFactory"],(function(e,t,n){"use strict";var o=new n;return function(t,n){function a(e){if("Document Proxy"==e.type&&e.dataelements&&"ProxyItem"==e.dataelements.policy){e.dataelements||(e.dataelements={});var t={title:e.dataelements.title||e.dataelements.name||"",proxyurl:e.dataelements.proxyurl,modified:e.dataelements.modified,originated:e.dataelements.originated};return e.dataelements.type=e.type,(a={data:e,grid:t}).label=e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name||e.title,a.title=e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name||e.title,a.icons=[{iconName:"link"}],a.link=e.dataelements.proxyurl||e.url,n.controller&&n.controller.options&&n.controller.options.connectorOptions&&n.controller.options.connectorOptions.platformUrls&&(a.thumbnail=n.controller.options.connectorOptions.platformUrls["3DSpace"]+"/webapps/ENOXAttachmentsUX/assets/icons/LinkThumbnail.png"),o.generateView(e.dataelements.modified,{readOnly:!0,typePath:"datetime",onViewCreated:function(e){a.subLabel=e.getContent().getText()}}),a}var a;if(e.dataelements.originated=new Date(e.dataelements.originated),e.dataelements.modified=new Date(e.dataelements.modified),e.dataelements.type=e.type,(a={data:e,grid:e.dataelements}).label=e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name,a.title=e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name,a.icons=[{iconName:"doc-text"}],a.grid.tree=a.title,a.thumbnail=e.dataelements.indexedImage||e.dataelements.image,a.taxonomies=[e.type],"TRUE"!=e.dataelements.isDocumentType||a.taxonomies.includes("Document")||a.taxonomies.push("Document"),a.thumbnail.endsWith("snresources/images/icons/small/I_CDM_Document.png")&&(a.thumbnail=a.thumbnail.replace("small/I_CDM_Document.png","large/I_TextDoc200x150.png")),a.icons=[e.dataelements.indexedTypeicon||e.dataelements.typeicon],o.generateView(e.dataelements.modified,{readOnly:!0,typePath:"datetime",onViewCreated:function(t){a.subLabel=e.dataelements.typeNLS+" | "+e.dataelements.revision+" | "+t.getContent().getText()}}),a.description=n.helper.getNameAndState(e),e.relateddata&&e.relateddata.files&&e.relateddata.files.length>0){var i=[];e.relateddata.files.forEach((e=>{var t;e.dataelements&&UWA.is(e.dataelements.title,"string")&&i.push((t=e.dataelements.title).substring(t.lastIndexOf(".")+1,t.length)||t)})),"TRUE"==e.dataelements.isDocumentType?e.dataelements.fileExtension=i.join(", "):e.dataelements.fileExtension=""}return a}var i=a(t);i.reloadFromNewData=function(e){s.updateOptions(a(e))};var s=new e(i);return s}})),define("DS/ENOXAttachmentsUX/Actions/CreateLinkDialog",["UWA/Core","DS/ENOXAttachmentsUX/utils/URLDialog","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],(function(e,t,n){"use strict";var o=function(e){return{id:"createLinkDialog",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"link-add",fontIconFamily:1},label:n.get("CreateLink"),tooltip:n.get("CreateLink"),position:"far",category:"dialog",value:function(t){t.options=e,o.execute(t)},visibleFlag:!0},execute:function(){o.execute({options:e})},updateForSelection:function(e,t){return Promise.resolve(!0)}}};return o.execute=function(e){var n=this;n.createLinkDialog&&n.createLinkDialog.myDialog&&(n.createLinkDialog.immersiveFrame&&n.createLinkDialog.immersiveFrame.destroy(),n.createLinkDialog.myDialog.destroy(),n.createLinkDialog.myDialog=void 0);var o={getSelectedNodes:e.options.getSelectedNodes,events:e.options.events,dialogCustomizations:e.options.dialogCustomizations?e.options.dialogCustomizations:{},onConfirm:e.options.onConfirm?e.options.onConfirm:function(t){t.url=/^[A-Za-z]+:\/\/.*$/.test(t.url)?t.url:`https://${t.url}`,e.options.events.publish({event:"user-attaches-url-Attachement",data:{urlData:t}})}};n.createLinkDialog=new t(o)},o})),define("DS/ENOXAttachmentsUX/data/Collection",["DS/TreeModel/TreeDocument","DS/ENOXAttachmentsUX/data/Model","DS/DocumentCommonInfra/MaturityColors"],(function(e,t,n){"use strict";return function(o){var a=new e({useAsyncPreExpand:!0,shouldAcceptDrag:function(e,t){return!0},shouldAcceptDrop:function(e,t){return!0}});n.setup(o.options.connectorOptions);var i=o.helper.debounce(5e3,(function(e){var t=this.data.map((function(e){return e[0].options.data})),n=this.data.map((function(e){return e[0]}));o.controller.connector.getUpdatedAttachments(t,(function(e){e.forEach((function(e){var t=n.find((function(t){return t.options.data.id==e.id}));t&&t.options.reloadFromNewData(e)}))}))}),!0);return a.addAttachments=function(e){a.prepareUpdate();var s=[],r=[],l=e.length>10?10:e.length;e.forEach((function(n,c){var d=!1;if(c>=e.length-l&&(d=a.isDuplicate(n)),"Document Proxy"==n.type&&"ProxyItem"==n.dataelements.policy){if(!d){var p=new t(n,o);a.addRoot(p)}}else if(s.includes(n.dataelements.policy)||(s.push(n.dataelements.policy),r.push(n)),!d){p=new t(n,o);a.addRoot(p),n.delayLoadThumbnails&&i(p)}})),a.pushUpdate(),n.fetchPolicies(r,(function(e,t,n){}))},a.isDuplicate=function(e){var t=!1;a.search({match:function(n){return n.nodeModel.options.data.id==e.id&&(t=!0),n.nodeModel.options.data.id==e.id},shouldStop:function(e){return t}});return t&&console.log("Attachment & Specification: Duplicate node found and removed !"),window&&window.preventDuplicateCheck&&(t=!1),t},require(["DS/PlatformAPI/PlatformAPI"],(function(e){a.enoRefreshToken&&e.unsubscribe(a.enoRefreshToken),a.enoRefreshToken=e.subscribe("DS/ENO/refresh",(function(e){if(e.data&&e.data.authored){if(UWA.is(e.data.authored.modified,"array")&&e.data.authored.modified.length>0){var t=[];a.getRoots().forEach((n=>{e.data.authored.modified.includes(n.options.data.id)&&t.push(n)})),t.length>0&&o.controller.connector.getUpdatedAttachments(t.map((e=>e.options.data)),(function(e){e.forEach((function(e){var n=t.find((function(t){return t.options.data.id==e.id}));n&&n.options.reloadFromNewData(e)}))}))}UWA.is(e.data.authored.deleted,"array")&&e.data.authored.deleted.length>0&&a.getRoots().forEach((t=>{e.data.authored.deleted.includes(t.options.data.id)&&setTimeout((()=>{t.remove()}),1)}))}})),a.urlAttachmentRefreshToken&&e.unsubscribe(a.urlAttachmentRefreshToken),a.urlAttachmentRefreshToken=e.subscribe("Enox-Attachment-Refresh",(function(e){e.data&&e.data.platformId&&e.data.platformId==o.options.connectorOptions.platformUrls.platformId&&e.data.parentId&&e.data.parentId==o.options.parentObject.parentId&&(UWA.is(e.data.modified,"array")&&e.data.modified.length>0&&a.getRoots().forEach((t=>{e.data.modified.forEach((e=>{e.id!=t.options.data.id&&e._oldUrlId!=t.options.data.id||t.options.reloadFromNewData(e)}))})),UWA.is(e.data.deleted,"array")&&e.data.deleted.length>0&&e.data.deleted.forEach((e=>{a.getRoots().forEach((t=>{e.id==t.options.data.id&&a.removeRoot(t)}))})))})),a.lifeCycleModificationToken&&e.unsubscribe(a.lifeCycleModificationToken),a.lifeCycleModificationToken=e.subscribe("Lifecycle.Modification",(function(e){if("Lifecycle"==(e="string"==typeof e?JSON.parse(e):e).From&&e.Refresh&&e.Refresh.deleted&&Array.isArray(e.Refresh.deleted)){var t=e.Refresh.deleted.map((function(e){return e.physicalid}));t.length>0&&a.getRoots().forEach((e=>{t.includes(e.options.data.id)&&setTimeout((()=>{e.remove()}),1)}))}}))})),a}})),define("DS/ENOXAttachmentsUX/utils/Helper",["UWA/Core","DS/LifecycleCmd/MaturityCmd","DS/Notifications/NotificationsManagerViewOnScreen","DS/Notifications/NotificationsManagerUXMessages","DS/ENOXAttachmentsUX/utils/MaturityCache","DS/ENOXAttachmentsUX/data/Constants","DS/WAFData/WAFData","DS/Controls/Label"],(function(e,t,n,o,a,i,s,r){"use strict";return function(t){var a={getStateEmphasisClassname:function(e){return"class-name-of-no-use doco-state-badge doco-state-"+e.dataelements.policy.replace(/ /g,"_")+"-"+e.dataelements.state.replace(/ /g,"_")},getNameAndState:function(t,n){var o=e.createElement("span",{class:"NameAndState",styles:{position:"relative"}});return a.getDisplayName(t.relateddata.ownerInfo[0].dataelements.firstname+" "+t.relateddata.ownerInfo[0].dataelements.lastname,t.relateddata.ownerInfo[0]).inject(o),e.createElement("span",{class:"divider",text:"|"}).inject(o),new r({value:t.dataelements.stateNLS,emphasize:a.getStateEmphasisClassname(t)}).inject(o),o},updateStateSpan:function(e,t){},getDisplayName:function(t,n){var o;o=a.ctrl.options.connectorOptions.platformUrls["3DSwym"]?{avatarStr:"",avatarColor:""}:a.getNonSwymAvatarDetails(t);var i=e.createElement("span",{title:t}),s=e.createElement("span",{html:o.avatarStr,class:"avatarIcon"});return a.ctrl.options.connectorOptions.platformUrls["3DSwym"]?s.style.setProperty("background-image","url('"+a.ctrl.options.connectorOptions.platformUrls["3DSwym"]+"/api/user/getpicture/login/"+n.dataelements.name+"/format/mini')"):s.style.setProperty("background",o.avatarColor),s.inject(i),e.createElement("span",{class:"userName",text:t}).inject(i),i},getNonSwymAvatarDetails:function(e){var t,n,o={},a=[[7,139,250],[249,87,83],[111,188,75],[158,132,106],[170,75,178],[26,153,123],[245,100,163],[255,138,46]],i=e.split(" "),s=i[0].toUpperCase(),r=i[i.length-1].toUpperCase(),l=(t=s[0])+(n=r[0]),c=Math.ceil((t.charCodeAt(0)+n.charCodeAt(0))%a.length),d="rgb("+a[c][0]+","+a[c][1]+","+a[c][2]+")";return o.name=e,o.avatarStr=l,o.avatarColor=d,o},showNotification:function(e,t,a,i,s,r){var l={level:e,title:t,subtitle:a,message:i,sticky:s,allowUnsafeHTML:r||!1};console.log(window.notifs,"notifs"),window.notifs||(window.notifs=o,n.setNotificationManager(window.notifs)),n.setStackingPolicy(5),window.notifs.addNotif(l)},make3DXContent:function(e,t){var n={protocol:"3DXContent",version:"2.0",source:"ENOXATTACHMENTS",widgetId:widget.id,data:{items:[]}};return e.forEach((function(e){var o={envId:a.ctrl.options.connectorOptions.platformUrls.platformId,serviceId:"3DSpace",contextId:a.ctrl.options.connectorOptions.fetchSecurityContext(),dataelements:e.options.data.dataelements,objectId:e.options.data.id,objectType:e.options.data.type};t&&t.includeObjectTaxonomies&&(o.objectTaxonomies=e.options.taxonomies),n.data.items.push(o)})),n},restrict:function(t,n){if(e.is(t,"array")){if("id"==n)return t.map((function(e){return e.id}));if("options.data.id"==n)return t.map((function(e){return e.options.data.id}))}else{if("id"==n)return t.id;if("options.data.id"==n)return t.options.data.id}},debounce:function(e,t,n){var o=null,a=[];return function(){if(n){for(var i=[],s=0;s<arguments.length;++s)i.push(arguments[s]);a.push(i)}o&&clearTimeout(o);var r=arguments;o=setTimeout((function(){t.apply(n?{data:a}:null,r),a=[],o=null}),e)}},saveViewMode:function(n){var o=localStorage.getItem("ENOXAttachmentsUXViewMode"),a="";widget.environment&&widget.environment.data&&widget.environment.data._data&&(a=widget.environment.data._data._x_appId),(o=e.Json.isJson(o)?JSON.parse(o):{})[t.options.attachmentsType+"_"+(e.is(widget.data.appId)?widget.data.appId:a)]=n,localStorage.setItem("ENOXAttachmentsUXViewMode",JSON.stringify(o))},loadViewMode:function(){var n=localStorage.getItem("ENOXAttachmentsUXViewMode"),o="";if(widget.environment&&widget.environment.data&&widget.environment.data._data&&(o=widget.environment.data._data._x_appId),e.Json.isJson(n)){var a=(n=JSON.parse(n))[t.options.attachmentsType+"_"+(e.is(widget.data.appId)?widget.data.appId:o)];return"tile"==a||"grid"==a?a:"tile"}return"tile"}};return a.ctrl=t,t.helper=a,a}})),define("DS/ENOXAttachmentsUX/data/Controller",["UWA/Core","DS/ENOXAttachmentsUX/data/Collection","DS/UIKIT/DropdownMenu","DS/ENOXAttachmentsUX/utils/Search","DS/ENOXAttachmentsUX/utils/Helper","DS/ENOXAttachmentsUX/utils/Menus","DS/DocumentCommands/ENOXDocumentCommands","DS/DocumentCommands/DocumentCommandsV2","DS/DocumentCommands/Constants","DS/i3DXCompassPlatformServices/OpenWith","DS/Utilities/Utils","DS/DocumentCommands/TypeDerivativesCache","DS/UIKIT/Modal","DS/ENOXAttachmentsUX/Actions/CreateLinkDialog","DS/ENOXAttachmentsUX/Actions/DeleteLink","DS/ENOXAttachmentsUX/Actions/OpenLink","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX","text!DS/ENOXAttachmentsUX/assets/searchFilter.json"],(function(e,t,n,o,a,i,s,r,l,c,d,p,u,m,h,f,g,v){"use strict";const y=["Document","Quality System Document","Technical Document"];var C={};return e.Class.extend({ready:!1,ctrl:void 0,attachments:void 0,init:function(e){this.ready=!1,this.ctrl=e,this.ctrl.controller=this,this.helper=new a(e),this.attachments=new t(e)},initialize:function(t,n){var a=this;p.setup(t.options.connectorOptions.platformUrls),this.attachments.getModelEvents().subscribe({event:"addChild"},(function(e){a.switchView(a.view)})),this.attachments.getModelEvents().subscribe({event:"removeChild"},(function(e){a.switchView(a.view)})),this._hackRepaint=d.debounce((function(){}),500),this.options=t.options,this.initContextMenu(),widget&&widget.app&&widget.app.jobs&&"doco-jobs"==widget.app.jobs.name&&widget.app.progressPane&&"doco-progress"==widget.app.progressPane.name?((C=widget.app).jobs.MAX_PARALLEL_JOBS=1,this.jobs=C.jobs):(null==C.jobs?require(["DS/DocumentCommands/Jobs"],(function(e){null==C.jobs?(C.jobs=new e(C),C.jobs.MAX_PARALLEL_JOBS=1,a.jobs=C.jobs):a.jobs=C.jobs})):a.jobs=C.jobs,null==C.progressPane&&require(["DS/DocumentCommands/ProgressPane"],(function(e){null==C.progressPane&&(C.progressPane=new e(C),C.progressPane.inject(widget.body))}))),this.events=this.ctrl.modelEvents,this.hookEvents(),this.ctrl.topBar.selectedItemsMenuButton.style.display="none",this.connector=n,this.view=this.helper.loadViewMode(),this.connector.init(this,t.options.connectorOptions),this.options.supportedTypes=this.options.supportedTypes||{};var s={includedTypes:[],excludedTypes:[]};try{this.typesFilter=JSON.parse(v),this.typesFilter[t.options.attachmentsType].includedTypes&&this.typesFilter[t.options.attachmentsType].includedTypes.length>0&&(s.includedTypes=this.typesFilter[t.options.attachmentsType].includedTypes),this.typesFilter[t.options.attachmentsType].excludedTypes&&(s.excludedTypes=this.typesFilter[t.options.attachmentsType].excludedTypes)}catch(e){console.warn("No filter types found")}s.includedTypes&&s.includedTypes.length>0||s.excludedTypes&&s.excludedTypes.length>0?(this.options.supportedTypes=s,0==this.options.supportedTypes.includedTypes.length&&(this.options.supportedTypes.includedTypes=["*"])):e.merge(this.options.supportedTypes,{includedTypes:y,excludedTypes:[]}),this.PLMDMTDocumentTypes=["PLMDMTDocument"],this.options.searchOptions=this.options.searchOptions||{},e.merge(this.options.searchOptions,{tenant:t.options.connectorOptions.platformUrls.platformId}),e.merge(this.options.searchOptions,this.options.supportedTypes),this.search=new o(this.ctrl),this.search.init(this.options.searchOptions),this.menus=new i(this.ctrl);var c=[];this.options.supportedTypes.includedTypes.length>0&&!this.options.supportedTypes.includedTypes.includes("*")&&c.push(...this.options.supportedTypes.includedTypes),this.options.supportedTypes.excludedTypes.length>0&&c.push(...this.options.supportedTypes.excludedTypes),c.push(...this.PLMDMTDocumentTypes),c.push(...y),p.getTypeDerivatives(c,(function(e){var t=[],n=[];a.options.supportedTypes.includedTypes.length>0&&!a.options.supportedTypes.includedTypes.includes("*")&&(a.options.supportedTypes.includedTypes.forEach((n=>{e[n]&&e[n].length>0&&t.push(...e[n])})),a.options.supportedTypes.includedTypes=t),a.options.supportedTypes.excludedTypes.length>0&&(a.options.supportedTypes.excludedTypes.forEach((t=>{e[t]&&e[t].length>0&&n.push(...e[t])})),a.options.supportedTypes.excludedTypes=n),e.PLMDMTDocument&&e.PLMDMTDocument.length>0&&a.PLMDMTDocumentTypes.push(...e.PLMDMTDocument)}),t.options.connectorOptions.platformUrls["3DSpace"]);var u={fetchSecurityContext:t.options.connectorOptions.fetchSecurityContext,getWorkUnderHeaders:t.options.connectorOptions.getWorkUnderHeaders,getSelectedNodes:function(){return a.attachments.getSelectedNodes()},getDocumentFromNodeModel:function(e){return e.options.data},platformUrls:t.options.connectorOptions.platformUrls,events:a.events,isFromContextMenu:!0,uaSource:"attachments & specifications"};a.documentCommands=new r(u);var g=a.documentCommands.commands;a.activatedCmds=[g[l.PREVIEW],g[l.SHARE],g[l.DOWNLOAD],g[l.OFFICE_WEB_EDITION],g[l.EDIT],g[l.LOCK_AND_DOWNLOAD],g[l.UNDO_EDIT],g[l.UNLOCK],g[l.UPDATE_AND_UNLOCK],g[l.UPDATE]],a.createLinkDialogCommand=new m(u),a.openLinksCommand=new f(u),a.deleteLinksCommand=new h(u),a.urlCommands=[a.openLinksCommand,a.deleteLinksCommand]},loadAttachments:function(){window.loadAttachmentsStartTime=new Date,this.connector.loadAttachments(this.ctrl.options.parentObject)},uploadAttachments:function(e){e.length>this.ctrl.config.limits.maxFilesUploadsAtATime?this.showNotification("error",g.get("UPLOAD_FAILED"),g.get("CANNOT_UPLOAD_MORE_THAN_X",{count:this.ctrl.config.limits.maxFilesUploadsAtATime})):this.connector.uploadAttachments(e,this.ctrl.options.parentObject,this.options.supportedTypes)},attachAttachments:function(e){e.length>0&&this.connector.attachAttachments(e,this.ctrl.options.parentObject)},detachAttachments:function(e){var t=!1,n=this;if(e.forEach((e=>{n.PLMDMTDocumentTypes.includes(e.options.data.type)&&(t=!0)})),t){var o='<div style="display: flex;"><span class="fonticon fonticon-attention text-warning fonticon-2x"></span><p style="margin-left: 10px; white-space: pre-line">'+g.get("RemoveConfirmationMsg")+"</p></div>",a=new u({className:"site-reset",header:g.get("DETACH"),body:o,footer:'<button type="button" class="btn btn-primary">'+g.get("DETACH")+'</button> <button type="button" class="btn btn-default">'+g.get("Cancel")+"</button>",animate:!0,resizable:!0,autocenter:!0,visible:!0,limitParent:!0,overlay:!0,closable:!1});a.show(),a.elements.container.setStyle("z-index","50000"),a.inject(widget.body),a.getContent().getElements(".btn.btn-primary").forEach((function(t){t.addEvent("click",(function(){var t={cancelled:!1,ids:n.helper.restrict(e,"options.data.id")};n.events.publish({event:"user-clicks-remove",data:t}),t.cancelled||(n.connector.detachAttachments(e,n.ctrl.options.parentObject),a.hide(),a.destroy())}))})),a.getContent().getElements(".btn.btn-default").forEach((function(e){e.addEvent("click",(function(){a.hide(),a.destroy()}))}))}else{var i={cancelled:!1,ids:this.helper.restrict(e,"options.data.id")};if(this.events.publish({event:"user-clicks-remove",data:i}),i.cancelled)return;this.connector.detachAttachments(e,this.ctrl.options.parentObject)}},selectionChanged:function(e){var t=this.attachments.getSelectedNodes(),n=t.length,o=t.filter((e=>"Document Proxy"==e.options.data.dataelements.type&&"ProxyItem"==e.options.data.dataelements.policy));n>0&&0==o.length?(this.ctrl.topBar.setDetachEnabled(!0),this.ctrl.topBar.selectedItemsMenuButton.style.display=""):(this.ctrl.topBar.setDetachEnabled(!1),this.ctrl.topBar.selectedItemsMenuButton.style.display="none"),n>0&&o.length==n&&(this.ctrl.topBar.selectedItemsMenuButton.style.display=""),this._hackRepaint()},switchView:function(e){this.attachments.getRoots().length>0?"grid"==e?(this.ctrl.tilePane.hide(),this.ctrl.uploadPane.hide(),this.ctrl.gridPane.show(),this.view=e,this.ctrl.topBar.container.getElement("[name=viewmenu] span").className="fonticon fonticon-view-list",this.ctrl.topBar.actionbar.menu.items.find((e=>"viewmenu"==e.name)).tooltip.setBody(g.get("GRIDVIEW")),this.helper.saveViewMode(e)):"tile"!=e&&null!=e||(this.ctrl.uploadPane.hide(),this.ctrl.gridPane.hide(),this.ctrl.tilePane.show(),this.view="tile",this.ctrl.topBar.container.getElement("[name=viewmenu] span").className="fonticon fonticon-view-small-tile",this.ctrl.topBar.actionbar.menu.items.find((e=>"viewmenu"==e.name)).tooltip.setBody(g.get("TILEVIEW")),this.helper.saveViewMode(this.view)):("grid"!=e&&"tile"!=e||(this.view=e,"grid"==e?(this.ctrl.topBar.container.getElement("[name=viewmenu] span").className="fonticon fonticon-view-list",this.ctrl.topBar.actionbar.menu.items.find((e=>"viewmenu"==e.name)).tooltip.setBody(g.get("GRIDVIEW"))):(this.ctrl.topBar.container.getElement("[name=viewmenu] span").className="fonticon fonticon-view-small-tile",this.ctrl.topBar.actionbar.menu.items.find((e=>"viewmenu"==e.name)).tooltip.setBody(g.get("TILEVIEW"))),this.helper.saveViewMode(this.view)),this.ctrl.gridPane.hide(),this.ctrl.tilePane.hide(),this.ctrl.uploadPane.show())},actionMenuHandler:function(e){this.prepareContextMenu(e.nodeModels,e.target)},applySortModel:function(e){this.ctrl.gridPane.datagridview.sortModel=[e],this.ctrl.gridPane.datagridview.reapplySortModel()},prepareContextMenu:function(e,t,n){this.contextMenu.hide(),this.manipulateMenuItemsThenShowContextMenu(e,t,n)},prepareRightClickMenuNoObjectSelection:function(e,t){this.contextMenu.hide(),this.manipulateRightClickMenuItemsNoObjectSelection(e),this.showContextMenu(void 0,e,t)},manipulateRightClickMenuItemsNoObjectSelection:function(t){var n=this;this.contextMenu.removeItem(this.contextMenu.items.map((function(e){return e.id})));var o={};o.document={id:n.ctrl.options.parentObject.parentId,contextId:n.connector.options.fetchSecurityContext(),serviceId:"3DSpace",envId:n.connector.options.platformUrls.platformId},o.platformUrls=n.connector.options.platformUrls,o.onComplete=function(e){if("Paste"===e.action)if(e.data){var t=e.data;if(t.data&&t.data.items&&t.data.items.length>0){var o=t.data.items.map((function(e){return{id:e.objectId,dataelements:e.dataelements}}));n.attachAttachments(o)}}else n.helper.showNotification("success",g.get("Nothing_To_Paste"))};var a=new s;a.init(o);var i=a.render(),r={},c=0;i[l.PASTE]&&(r={index:++c},n.contextMenu.addItem(e.merge(r,i[l.PASTE])))},manipulateMenuItemsThenShowContextMenu:function(t,n,o){var a=this;this.contextMenu.removeItem(this.contextMenu.items.map((function(e){return e.id})));var i,r,c,d,p=-1,u=!1,m=0;t.forEach((e=>{a.PLMDMTDocumentTypes.includes(e.options.data.type)?u=!0:m++})),this.ctrl.config.contextMenu.forEach((function(e){"OpenWith"==e.name?p=a.options.webinwin&&e.hiddenInWebInWin||u&&!m?-1:0:(e.handler=function(o,i,s){a.menus.handler({nodeModels:t,menuItem:e,target:n})},"Maturity"==e.name?r=e:"Relations"==e.name?i=e:"Share"==e.name?e:"Copy"==e.name?c=e:"Properties"==e.name&&(d=e))}));var h={},f=e.clone(t[0].options.data);f=e.merge(f,{parentId:a.ctrl.options.parentObject.parentId,parentDirection:"from",relName:t[0].options.data.relName}),h.getWorkUnderHeaders=a.connector.options.getWorkUnderHeaders,h.document={id:t[0].options.data.id,contextId:a.connector.options.fetchSecurityContext(),serviceId:"3DSpace",envId:a.connector.options.platformUrls.platformId,data:f,type:t[0].options.data.type},h.onComplete=function(e){if("ReplacebyRevision"===e.action||"ReplacebyLatestRevision"===e.action)if(t[0].options.data.id==e.targetDocumentId)console.log("same revision selected. Do nothing. only show notification");else{var n=a.ctrl.controller.attachments.getRoots().find((function(e){return e.options.data.id==t[0].options.data.id}));n.remove(),a.ctrl.controller.connector.getUpdatedAttachment({id:e.targetDocumentId},(function(t){a.ctrl.controller.attachments.addAttachments(t,n._rowID),a.ctrl.setSelection([e.targetDocumentId])}))}else"Update"!==e.action&&"Edit"!==e.action&&"UndoEdit"!==e.action||a.connector.getUpdatedAttachment(t[0].options.data,(function(e){1==e.length&&(t[0].options.data.relateddata.files=e[0].relateddata.files)}));var o=e.result.message;a.helper.showNotification("info",t[0].options.data.dataelements.title||t[0].options.data.dataelements.secondaryTitle||t[0].options.data.dataelements.name,o,"",!1)},h.onFailure=function(e){console.log(e.action+" failed for "+e.targetDocumentId),a.helper.showNotification("error",e.message?e.message:e.error.message,"","",!1)},h.platformUrls=a.connector.options.platformUrls;var g,v=t.every((e=>"TRUE"==e.options.data.dataelements.isDocumentType)),y=t.filter((e=>"Document Proxy"==e.options.data.dataelements.type&&"ProxyItem"==e.options.data.dataelements.policy)),C=[],D=new s;g=v?a.documentCommands.getUIKitItemsForCurrentSelection(a.activatedCmds,!1):new e.Promise((function(e){e([])}));var E=D.init(h);e.Promise.all([E,g]).then((function(s){C=s[1];var m=D.render(),h={},f=0;if(-1!=p){f++;var v=a.helper.make3DXContent(t,{includeObjectTaxonomies:!0});a.openWith.set3DXContent(v).render(a.contextMenu)}if(t[0].options.data.type){if(!u){y.length||0==t[0].options.data.relateddata.files.length||""!=t[0].options.data.relateddata.files[0].dataelements.locker,!y.length&&t[0].options.data.relateddata.files.length>1&&!0,0!=a.contextMenu.items.length?(f++,h={index:f},a.contextMenu.addItem(e.merge(h,{className:"divider"}))):f=0,a.options.webinwin||C.forEach((t=>{t.name==l.PREVIEW&&(f++,h={index:f},a.contextMenu.addItem(e.merge(h,t)))})),f++,h={index:f},a.contextMenu.addItem(e.merge(h,{className:"divider"})),window.dscef||C.forEach((t=>{t.name==l.OFFICE_WEB_EDITION&&(f++,h={index:f},a.contextMenu.addItem(e.merge(h,t)))})),C.forEach((t=>{t.name==l.UPDATE&&(f++,h={index:f},a.contextMenu.addItem(e.merge(h,t))),t.name==l.UPDATE_AND_UNLOCK&&(f++,h={index:f},a.contextMenu.addItem(e.merge(h,t))),t.name==l.LOCK_AND_DOWNLOAD&&(f++,h={index:f},a.contextMenu.addItem(e.merge(h,t))),t.name==l.EDIT&&(f++,h={index:f},a.contextMenu.addItem(e.merge(h,t))),t.name==l.UNDO_EDIT&&(f++,h={index:f},a.contextMenu.addItem(e.merge(h,t))),t.name==l.UNLOCK&&(f++,h={index:f},a.contextMenu.addItem(e.merge(h,t)))})),f++,h={index:f},a.contextMenu.addItem(e.merge(h,c)),m[l.REPLACE_BY_REVISION]&&(f++,h={index:f},a.contextMenu.addItem(e.merge(h,m[l.REPLACE_BY_REVISION]))),f++,h={index:f},a.contextMenu.addItem(e.merge(h,{className:"divider"})),f++,h={index:f},a.contextMenu.addItem(e.merge(h,r)),f++,h={index:f},a.contextMenu.addItem(e.merge(h,{className:"divider"})),C.forEach((t=>{t.name==l.SHARE&&(f++,h={index:f},t.acceptsMultiSelection=!0,a.contextMenu.addItem(e.merge(h,t)))})),m[l.COPY_LINK]&&(f++,h={index:f},a.contextMenu.addItem(e.merge(h,m[l.COPY_LINK]))),f++,h={index:f},a.contextMenu.addItem(e.merge(h,{className:"divider"}))}f++,h={index:f},a.contextMenu.addItem(e.merge(h,i)),u||C.forEach((t=>{t.name==l.DOWNLOAD&&(f++,h={index:f},t.acceptsMultiSelection=!0,a.contextMenu.addItem(e.merge(h,t)))})),f++,h={index:f},a.contextMenu.addItem(e.merge(h,d))}a.contextMenu.removeItem(a.contextMenu.items.filter((function(n){return!(!a.options.webinwin||!n.hiddenInWebInWin)||(!(!a.options.readonly||!n.hiddenInReadOnly)||(t.length>1?!n.acceptsMultiSelection:!!e.is(n.supportedTypes,"array")&&!n.supportedTypes.includes(t[0].options.data.type)))})).map((function(e){return e.id}))),a.contextMenu.removeItem(a.contextMenu.items.filter((function(e,t,n){return 0!==t&&(e.className&&"divider"===e.className&&"divider"===n[t-1].className)})).map((function(e){return e.id}))),a.contextMenu.items.length>0&&a.contextMenu.items[0].className&&"divider"===a.contextMenu.items[0].className&&a.contextMenu.removeItem(a.contextMenu.items[0].id),a.events.publish({event:"context-menu-requested",data:{contextMenu:a.contextMenu,data:t.map((function(e){return e.options.data})),PLMDMTDocumentTypes:a.PLMDMTDocumentTypes}}),y.length>0?(a.contextMenu.removeItem(a.contextMenu.items.map((function(e){return e.id}))),g=a.documentCommands.getUIKitItemsForCurrentSelection(a.urlCommands,!1),y.length==t.length&&t.length>0&&g.then((i=>{f=0,i.forEach(((t,n)=>{f++,h={index:f},a.contextMenu.addItem(e.merge(h,t)),0==n&&(f++,h={index:f},a.contextMenu.addItem(e.merge(h,d)))})),y.length>1&&a.contextMenu.removeItem(a.contextMenu.items.filter((e=>"deleteLink"!=e.name)).map((e=>e.id))),a.connector.controller.options.readonly&&a.contextMenu.removeItem(a.contextMenu.items.filter((e=>"deleteLink"==e.name)).map((e=>e.id))),a.showContextMenu(t,n,o)}))):a.showContextMenu(t,n,o)}))},showContextMenu:function(e,t,n){null==n?delete this.contextMenu.options.altPosition:this.contextMenu.options.altPosition=n,this.contextMenu.nodeModels=e,this.contextMenu.options.target=t;var o=void 0;n?(o={pageX:n.x,pageY:n.y},this.contextMenu.options.contextual=!0,delete this.contextMenu.options.altPosition,this.contextMenu.show(!1,o)):(this.contextMenu.options.contextual=!1,this.contextMenu.show())},attachExistingAttachments:function(){this.search.execute()},clearAll:function(){this.attachments.removeRoots()},addAttachmentsToUI:function(e){this.attachments.addAttachments(e),this.events.publish({event:"on-add-attachments-to-ui",data:{ids:this.helper.restrict(e,"id")}}),this.ctrl.gridPane.datagridview.reapplySortModel()},finishLoadingAttachments:function(){this.ctrl.finishLoading(),this._hackRepaint()},showNotification:function(e,t,n,o,a,i){this.helper.showNotification(e,t,n,o,a,i)},connectorReady:function(e){this.connector.options=e,this.events.publish({event:"on-connector-ready",data:e}),this.loadAttachments()},destroy:function(){this.ctrl.tilePane.destroy(),this.search.destroy()},copyContent:function(){var e=this.attachments.getSelectedNodes();this.menus.actions.ctxCopy(this.ctrl,e),console.log("selected nodes",e)},pasteContent:function(){this.ctrl.topBar.actions.ActionPaste(),console.log("paste middleware")},_hackRepaint:null,initContextMenu:function(){var e=this,t=[],o=-1,a=-1;this.ctrl.config.contextMenu.forEach((function(n){o++,"OpenWith"==n.name?a=e.options.webinwin&&n.hiddenInWebInWin?-1:o:(n.handler=function(t,o,a){e.menus.handler({nodeModels:e.contextMenu.nodeModels,menuItem:n,target:e.contextMenu.options.target})},t.push(n))})),this.contextMenu=new n({items:t,events:{onClickOutside:function(e,t){}}});var i={protocol:"3DXContent",version:"2.0",source:"ENOXATTACHMENTS",data:{items:[{envId:void 0,serviceId:void 0,contextId:void 0,objectId:void 0,objectType:void 0}]}};-1!=a&&(this.openWith=this.openWith||new c,this.openWith.set3DXContent(i).setIndex(a+1).render(this.contextMenu))},hookEvents:function(){var e=this;if(this.events.subscribe({event:"user-clicks-attach"},(function(t){0==t.cancelled&&e.attachExistingAttachments()})),this.events.subscribe({event:"user-clicks-attach-url"},(function(t){e.createLinkDialogCommand.execute()})),this.events.subscribe({event:"user-attaches-url-Attachement"},(function(t){e.connector.attachUrlAsAttachment(t.urlData,e.ctrl.options.parentObject)})),
//! TO BE REMOVED
this.events.subscribe({event:"user-modifies-url"},(function(t){e.connector.updateUrlAttachment(t.urlData,t.updatedNodeId)})),this.events.subscribe({event:"fetch-url-attachment-delete-access"},(function(t){e.connector.fetchURLAttachmentDeleteAccess(t.options,e.ctrl.options.parentObject)})),this.events.subscribe({event:"user-confirms-delete"},(function(t){e.connector.deleteUrlAttachment(t.urlData,e.ctrl.options.parentObject)})),this.events.subscribe({event:"user-clicks-detach"},(function(t){var n=e.attachments.getSelectedNodes().filter((e=>"Document Proxy"==e.options.data.dataelements.type&&"ProxyItem"==e.options.data.dataelements.policy));0==t.cancelled&&0==n.length&&e.detachAttachments(e.attachments.getSelectedNodes())})),this.events.subscribe({event:"user-selects-files-for-upload"},(function(t){0==t.cancelled&&e.uploadAttachments(t.files)})),this.events.subscribe({event:"user-dropped-files"},(function(t){0==t.cancelled&&e.uploadAttachments(t.files)})),this.events.subscribe({event:"user-dropped-x3dcontent"},(function(t){if(0==t.cancelled&&t.x3dcontent.data&&t.x3dcontent.data.items&&t.x3dcontent.data.items.length>0){var n=t.x3dcontent.data.items.map((function(e){return{id:e.objectId,dataelements:{typeNLS:e.objectType,title:e.displayName,secondaryTitle:e.displayName,name:e.displayName,type:e.objectType}}}));e.attachAttachments(n)}})),this.events.subscribe({event:"selection-add"},(function(t){e.selectionChanged(t)})),this.events.subscribe({event:"selection-remove"},(function(t){e.selectionChanged(t)})),this.attachments.getModelEvents().subscribe({event:"addChild"},(function(t){e.events.publish({event:"attachments-count-changed",data:e.attachments.getRoots().length})})),this.attachments.getModelEvents().subscribe({event:"removeChild"},(function(t){e.events.publish({event:"attachments-count-changed",data:e.attachments.getRoots().length})})),this.events.subscribe({event:"docv2-edit-complete"},(function(t){e.connector.getUpdatedAttachment(t.nodeModel.options.data,(function(n){1==n.length&&(t.nodeModel.options.data.relateddata.files=n[0].relateddata.files,e.events.publish({event:"docv2-preview-reload-toolbar",data:{nodeModel:t.nodeModel}}))}))})),this.events.subscribe({event:"docv2-update-complete"},(function(t){e.connector.getUpdatedAttachment(t.nodeModel.options.data,(function(n){1==n.length&&(t.nodeModel.options.data.relateddata.files=n[0].relateddata.files,e.events.publish({event:"docv2-preview-reload-toolbar",data:{nodeModel:t.nodeModel}}),e.events.publish({event:"docv2-preview-reload-viewer",data:{nodeModel:t.nodeModel}}))}))})),this.events.subscribe({event:"docv2-undoedit-complete"},(function(t){e.connector.getUpdatedAttachment(t.nodeModel.options.data,(function(n){1==n.length&&(t.nodeModel.options.data.relateddata.files=n[0].relateddata.files,e.events.publish({event:"docv2-preview-reload-toolbar",data:{nodeModel:t.nodeModel}}))}))})),!this.events.addSingletonEventListener){var t={};e.events.addSingletonEventListener=function(n,o,a){t[n]&&e.events.unsubscribe(t[n]),t[n]=e.events.addEventListener(o,a)}}this.events.addSingletonEventListener("doc-cmd-evts-show-notification","docv2-show-notification",(function(t){e.helper.showNotification(t.level,t.title,t.subtitle,t.message,t.sticky,t.allowUnsafeHTML)}))}})})),define("DS/ENOXAttachmentsUX/data/DnDManager",["UWA/Core","DS/DataDragAndDrop/DataDragAndDrop","DS/ENOXAttachmentsUX/data/Controller","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],(function(e,t,n,o){"use strict";return function(e){var n={init:function(e){this.ctrl=e;var o=e.uploadPane.container,a=e.gridPane.container,i=e.getClassNames("-drag-over"),s={drop:function(t,s,r){e.options.readonly||(o.removeClassName(i),a.removeClassName(i),n.handleDrop(r))},enter:function(t,n){e.options.readonly||(o.addClassName(i),a.addClassName(i))},over:function(t,n){e.options.readonly||(o.addClassName(i),a.addClassName(i))},leave:function(t,n){e.options.readonly||(o.removeClassName(i),a.removeClassName(i))}};t.droppable(o,s),t.droppable(a,s),e.dndManager=this,this.restrictedTypes=["Document Proxy"]},handleDrop:function(t){var a=this;if(!e.options.readonly)if(t.dataTransfer.files&&t.dataTransfer.files.length>0)n.ctrl.modelEvents.publish({event:"user-dropped-files",data:{cancelled:!1,files:t.dataTransfer.files}});else if(""!=t.dataTransfer.getData("text")){var i=t.dataTransfer.getData("text"),s=JSON.parse(i);if(null!=s&&"3DXContent"==s.protocol){var r=s.data.items.filter((e=>a.restrictedTypes.includes(e.objectType)));s.data.items=s.data.items.filter((e=>!a.restrictedTypes.includes(e.objectType))),r.forEach((e=>{a.ctrl.helper.showNotification("error",o.get("TYPE_ATTACH_NOT_ALLOWED",{type:"Link"}),o.get("SELECT_SUPPORTED_TYPE_MSG"))})),n.ctrl.modelEvents.publish({event:"user-dropped-x3dcontent",data:{cancelled:!1,x3dcontent:s}})}}}};return n.init(e),n}})),define("DS/ENOXAttachmentsUX/AttachmentsPane",["UWA/Core","DS/ENOXAttachmentsUX/data/Controller","DS/ENOXAttachmentsUX/data/Connector3DSpace","DS/ENOXAttachmentsUX/views/Topbar","DS/ENOXAttachmentsUX/views/UploadPane","DS/ENOXAttachmentsUX/views/GridPane","DS/ENOXAttachmentsUX/views/TilePane","text!DS/ENOXAttachmentsUX/assets/config.json","DS/ENOXAttachmentsUX/data/DnDManager","DS/CoreEvents/ModelEvents","DS/UIKIT/Mask","DS/ENOXAttachmentsUX/utils/Overlay","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX","css!DS/ENOXAttachmentsUX/ENOXAttachmentsUX.css"],(function(e,t,n,o,a,i,s,r,l,c,d,p,u,m){"use strict";return(r=JSON.parse(r)).actionbar.forEach((function(e){e.text=u.get(e.nls),e.title=u.get(e.nls),e.content&&e.content.options&&e.content.options.items&&e.content.options.items.forEach((function(e){e.text=u.get(e.nls),e.description=u.get(e.nls)}))})),r.headers.forEach((function(e){e.text=u.get(e.nls)})),r.contextMenu.forEach((function(e){e.text=u.get(e.nls),e.title=u.get(e.nls)})),e.Controls.Abstract.extend({name:"enox-attachments",options:{className:""},_options:{},modelEvents:void 0,init:function(t){this.attachmentsPaneStartTime=new Date,this.modelEvents=t.events||new c,this.config=e.clone(r),this._parent(t),this._options=t,this.buildSkeleton()},buildSkeleton:function(){this.elements.container=e.createElement("div",{class:this.getClassNames()}),this.options.parentObject?this.startLoading():this.showNoParentSelected(),this.elements.content=e.createElement("div",{class:this.getClassNames("-content")}),this.elements.content.inject(this.elements.container),this.options.attachmentsType="attachments",new t(this),new o(this),this.buildContentPanes(),new l(this),this._options.delayInitialize?console.log("Waiting for initialize to be called"):this.initialize()},buildContentPanes:function(){this.elements.panes=e.createElement("div",{class:this.getClassNames("-panes")}),this.elements.panes.inject(this.elements.content),new a(this),new i(this),new s(this)},setParentObject:function(e,t){var n=!1;"true"==t&&(n=!0),this.options.parentObject=e,this.finishLoading(),n?this.showNotSupportedParent():this.options.parentObject?this.startLoading():this.showNoParentSelected(),this.controller.clearAll(),n||this.controller.loadAttachments()},getParentObject:function(){return this.options.parentObject},setConnectorOptions:function(t){e.merge(this.options.connectorOptions,t)},setSupportedTypes:function(t){e.merge(this.options.supportedTypes,t),e.merge(this.options.searchOptions,this.options.supportedTypes)},initialize:function(){this.controller.initialize(this,this._options.connector||new n)},attachAttachments:function(e){this.controller.attachAttachments(e)},startLoading:function(){d.mask(this.elements.container)},finishLoading:function(){d.unmask(this.elements.container),p.unoverlay(this.elements.container)},showNoParentSelected:function(){p.overlay(this.elements.container,u.get("NOPARENTOBJECT"))},showNotSupportedParent:function(){p.overlay(this.elements.container,u.get("NOTSUPPORTEDSELECTION"))},destroy:function(){this.controller.destroy(),this._parent()},onRemoved:function(){this.destroy()},setSelection:function(e){this.controller.attachments.processDescendants({processNode:function(t){e.includes(t.nodeModel.options.data.id)?t.nodeModel.select():t.nodeModel.unselect()},onlyVisibleNodes:!1})},getSelection:function(){return this.controller.helper.restrict(this.controller.attachments.getSelectedNodes(),"options.data.id")}})})),define("DS/ENOXAttachmentsUX/AttachmentsFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/ENOXAttachmentsUX/AttachmentsPane"],(function(e,t,n,o,a){return t.extend(n,o,{init:function(e){this._parent(e),this.componentRefresh=!1,this.buildView(e)},buildView:function(t){var n=this;this.elements.container=e.createElement("div",{class:"attachments"});var o={parentObject:{parentId:t.appContext.getDocumentId()},connectorOptions:{fetchSecurityContext:function(){return t.appContext.options.securityContext},platformUrls:t.appContext.options.platformUrls,credentialsPrefName:"credentials"},isPopup:!1};n.attachmentsPane=new a(o),n.attachmentsPane.inject(n.elements.container),n.attachmentsPane.modelEvents.subscribe({event:"context-menu-requested"},(function(e){var t;if(e.contextMenu.items.forEach((function(e){e.name&&e.name.startsWith("open-with")&&(t=e)})),t){var n=[];e.contextMenu.items.forEach((function(e){e.parentItemId&&e.parentItemId==t.id&&n.push(e)})),n.length>0&&1==n.length&&"ENXWDOC_AP"==n[0].name&&e.contextMenu.removeItem([t.id,n[0].name])}}))},updateFacet:function(){this.selectionModified(this.options.appContext.getDocumentId())},selectionModified:function(e){if(e){var t={parentId:e};this.attachmentsPane&&this.attachmentsPane.getParentObject().parentId!==e&&this.attachmentsPane.setParentObject(t),this.componentRefresh=!0}},onResize:function(){},onRefresh:function(){}})}));