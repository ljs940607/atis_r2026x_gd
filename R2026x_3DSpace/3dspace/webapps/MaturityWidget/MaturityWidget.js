define("DS/MaturityWidget/MaturityConfirmationDialogFilter",["UWA/Promise","DS/LifecycleServices/Utils","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],(function(t,e,i){"use strict";function s(){}return s.prototype={showConfirmationDialog:function(s,o){if(null!=o&&o.hasOwnProperty("maturityWidget")&&!(void 0===o.maturityWidget||null===o.maturityWidget||o.maturityWidget.displayWorkflowGraph&&o.maturityWidget.model.isConfirmationDialogEnabled)){for(var a=[],n=0;n<s.length;n++)a[s[n].physicalid]="";return t.resolve(a)}var r=new t((function(t,a){var n=[],r=document.getElementById("sampleFilterId");r&&(r.parentNode.removeChild(r),r=void 0);for(var l=e.htmlFromString("<div id='sampleFilterId' class='lcm-confirmation-dialog-filter-transition'><div class='lcm-filter-title'>"+i.maturityConfirmationDialogTitle+"</div><div class='lcm-filter-msg'></div><div class='lcm-filter-buttons'><button class='lcm-filter-ok-button lcm-transition-confirm-button-base'>"+i.okButton+"</button><button class='lcm-filter-cancel-button lcm-transition-confirm-button-base'>"+i.cancelButton+"</button></div></div>"),c=(l.querySelector(".lcm-filter-transition"),l.querySelector(".lcm-filter-ok-button")),d=l.querySelector(".lcm-filter-cancel-button"),h=l.querySelector(".lcm-filter-msg"),u=0;u<s.length;u++){var p=o.maturityWidget.model.getStateUserNameFromStateSystemName(s[u].physicalid,s[u].tostate);h.innerHTML+=p}["mousedown","touchstart"].forEach((function(e){c.addEventListener(e,(function(e){var i=document.getElementById("sampleFilterId");if(i){for(var o=0;o<s.length;o++)n[s[o].physicalid]="";i.style.display="none",t(n)}e.stopPropagation()})),d.addEventListener(e,(function(e){var i=document.getElementById("sampleFilterId");i&&(i.style.display="none",t(n)),e.stopPropagation()}))})),o.maturityWidget.elements.container.appendChild(l)}));return r}},new s})),define("DS/MaturityWidget/MultiselUI",["css!DS/MaturityWidget/MaturityWidget","UWA/Controls/Abstract","DS/LifecycleServices/LifecycleServicesSettings","DS/UIKIT/Input/Select","DS/LifecycleControls/DataGridViewContainer","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","text!DS/LifecycleWidget/assets/MaturityStatePriority.json"],(function(t,e,i,s,o,a,n){"use strict";return e.extend({isPromotePayload:!0,create:function(t,e,s,n){var r=this;this.model=t,this.maturityWidget=s,this.setTitle=n,i.app_initialization((function(){}));var l=this.model.getObjects();this.container=UWA.createElement("div",{class:"lcm-maturity-container lcm-maturity-container-multisel lcm-maturity-table-container"}),this.container.inject(e);var c=this.promotion={},d={},h=[];if(this._prepareAndSort(l,c,d,h),this.maturityTable=UWA.createElement("table",{class:"MaturityTable"}),this.commandSpan=UWA.createElement("tr",{class:"MaturityCommandSpan"}).inject(this.maturityTable),this.tableSpan=UWA.createElement("tr",{class:"MaturityTableSpan"}).inject(this.maturityTable),this.maturityTable.inject(this.container),h.length>0){var u=document.createElement("p");u.textContent=a.changeMaturityTo,u.style.display="inline",this.maturityChangeDiv=UWA.createElement("div",{class:"maturity-change-txt"}),this.maturityChangeDiv.appendChild(u),this.commandSpan.appendChild(this.maturityChangeDiv)}if(!(h.length>=1)){var p=UWA.createElement("p",{text:a.noAvailTransition,class:"maturity-info-msg"});return this.commandSpan.appendChild(p),!1}this._createStateSelCombo(c,d,h);var m=document.createElement("p");m.textContent=a.stateQ,m.style.display="inline",this.maturityStateDiv=UWA.createElement("div",{class:"maturity-state-txt"}),this.maturityStateDiv.appendChild(m),this.commandSpan.appendChild(this.maturityStateDiv),this.objectListDiv=UWA.createElement("div",{class:"maturity-objectList"});var f=this._getUpdatedObjectsForState(c,this.toState);return this.objectsList=new o({idName:"dgvContainer",clickToShowDGV:!1,showLock:!0,showRowSelect:!1,showPreStatus:!1,showRouteStatus:!0},f),this.objectsList.inject(this.objectListDiv),this.tableSpan.appendChild(this.objectListDiv),this.objectsList.dataGridView.addEventListener("click",(function(t,e){var i=e.nodeModel._options;r._onDoubleClickLine(t,i)})),this._updateObjectListUI(c,f),this.onPanelResize(),!0},getPromotePayload:function(){var t=this,e=this.toState,i=[];this.promotion[e].forEach((function(s){if(!s.excludeFromPromote&&!s.isDemote&&t.model.getApplyTransition(s.phid)){var o=t.model.getAttribute(s.phid,"type"),a=t.model.getAttribute(s.phid,"revision"),n=t.model.getAttribute(s.phid,"policy"),r=t.model.getAttribute(s.phid,"name"),l=t.model.getAttribute(s.phid,"coretype"),c=t.model.getAttribute(s.phid,"interfaceHash"),d=t.model.getAttribute(s.phid,"cadMaster"),h="",u=t.model.getAttribute(s.phid,"signatures");if(u.hasOwnProperty([s.fromstate])){var p=u[s.fromstate];if(p.hasOwnProperty([e])){var m=Object.keys(p[e]);m.length>0&&"undefined"!=m[0]&&(h=m[0])}}i.push({physicalid:s.phid,tostate:e,fromstate:s.fromstate,type:o,revision:a,policy:n,name:r,coretype:l,interfaceHash:c,signature:h,cadMaster:d})}}));var s={};return s.data=i,s},getDemotePayload:function(){var t=this,e=this.toState,i=[];this.promotion[e].forEach((function(s){if(!s.excludeFromPromote&&s.isDemote&&t.model.getApplyTransition(s.phid)){var o=t.model.getAttribute(s.phid,"type"),a=t.model.getAttribute(s.phid,"revision"),n=t.model.getAttribute(s.phid,"policy"),r=t.model.getAttribute(s.phid,"name"),l=t.model.getAttribute(s.phid,"coretype"),c=t.model.getAttribute(s.phid,"interfaceHash");i.push({physicalid:s.phid,tostate:e,fromstate:s.fromstate,type:o,revision:a,policy:n,name:r,coretype:l,interfaceHash:c})}}));var s={};return s.data=i,s},onPanelResize:function(){if(void 0!==this.objectsList&&null!==this.objectsList&&void 0!==this.objectsList.objectsTable&&null!==this.objectsList.objectsTable){this.objectsList.objectsTable.resizeTable();var t=document.querySelectorAll("div.lcm-maturity-content");if(null!=t&&t.length>0){var e=t[0].getSize(),i=document.querySelectorAll('div.DivSSTableBody.objectlist-ReviseBody[data-rec-id="dataRecSSTable2"] div.no-native-scrollbars.scroller-content');if(null!=i&&i.length>0)for(var s=0;s<i.length;s++){var o=e.height-80;o>0&&(i[0].style.height=o+"px")}}}},_updateOKButton:function(){var t=this.getPromotePayload(),e=this.getDemotePayload();t.data.length>0||e.data.length>0?this.maturityWidget.updateOKButton(!0):this.maturityWidget.updateOKButton(!1)},_onDoubleClickLine:function(t,e){var s=e.grid,o=s.id;if(this._isTransitionApplicable(o)&&"wux-layouts-datagridview-icon wux-ui-genereatedicon-backgroundimage"==t.srcElement.className){var a=!this.model.getApplyTransition(o);this.model.setApplyTransition(o,a);var n=this.model.getCurrentTenantFromObject(this.model.objects[o]),r=i.get3DSpaceBaseUrl(n),l=this._getApplicablePromoteIcon(r,a);s.imageUrl=l,e.icons[0]=l,t.srcElement.setStyle("background-image","url("+l+")"),this._updateOKButton()}},_getApplicablePromoteIcon:function(t,e){return e?t+"/webapps/LifecycleWidget/assets/icons/16/I_ApplyPromote.png":t+"/webapps/LifecycleWidget/assets/icons/16/I_NotApplyPromote.png"},_createObjectForList:function(t,e){var s=this.model.getApplyTransition(t),o=this._isTransitionApplicable(t),a=UWA.createElement("img",{src:this.model.getAttribute(t,"imageUrl")}),n=this.model.getAttribute(t,"displayName");("string"!=typeof n||0==n.trim().length)&&(n=this.model.getAttribute(t,"name"));var r=UWA.createElement("div",{text:n}),l=UWA.createElement("div",{class:"TitleDiv"});r.setStyles({display:"inline-block","padding-left":"6px"}),l.appendChild(a),l.appendChild(r);var c=null,d=this.model.getCurrentTenantFromObject(this.model.objects[t]),h=i.get3DSpaceBaseUrl(d);c=h+"/webapps/LifecycleWidget/assets/icons/16/I_NotAvailablePromote.png",o&&(c=this._getApplicablePromoteIcon(h,s));var u=this.model.getAttribute(t,"current_internal");null!=u&&null!=u||(u=this.model.getAttribute(t,"current"));var p=this.model.getAttribute(t,"lockedBy");null==p&&(p="");var m=void 0,f=void 0;if(this.model.objects[t].hasOwnProperty("routes")&&this.model.objects[t].routes.length>0)for(let i=0;i<this.model.objects[t].routes.length;i++)this.model.objects[t].routes[i].hasOwnProperty("routestatuses")?e===this.model.objects[t].routes[i].toState&&(m=this.model.objects[t].routes[i].routestatuses[0].status,f=this.model.objects[t].routes[i].routestatuses[0].routeId,"RouteCreated"==m&&this.model.objects[t].routes[i].toState!=this.toState&&(m="Promote")):m=this.model.objects[t].routes[i].status;return{physicalid:t,name:n,revision:this.model.getAttribute(t,"revision"),type:this.model.getAttribute(t,"typeDisplayName"),current:this.model.getAttribute(t,"currentStateUserName"),current_internal:u,locked:this.model.getAttribute(t,"locked"),lockedBy:p,imageUrl:c,policy:this.model.getAttribute(t,"policy"),routeStatus:m,routeId:f}},_isTransitionApplicable:function(t){for(var e=this.promotion[this.toState],i=0;i<e.length;i++){if(e[i].phid==t)return!0}return!1},_getUpdatedObjectsForState:function(t,e){var i,s=this,o=[],a=new Set,n=this.toState;return this.maturityWidget.initialSelection.forEach((function(t){a.add(t.physicalid)})),a.forEach((function(t){var e=s._createObjectForList(t,n);o.push(e)})),t[this.toState]&&t[this.toState].forEach((function(t){var e=t.phid,o=s.model.objects[e];if(o.hasOwnProperty("coretype")&&"Entity"==o.coretype){var a=this.model.maturityGraphs[o.policy];void 0!==a.states&&null!==a.states&&a.hasOwnProperty("states")&&(i=a.states);t.fromstate;for(var r in i){var l=i[r];if(null!=l&&l.hasOwnProperty("info")){var c=l.info;if(null!=c&&c.hasOwnProperty("stateUserName")&&c.hasOwnProperty("visuorder")&&c.stateSysName==t.fromstate){i[n].info.visuorder<c.visuorder?t.isDemote=!0:t.isDemote=!1;break}}}}}),this),o},_createStateSelCombo:function(t,e,i){var o=this,a=new s({value:0,className:"small",placeholder:!1}),n=!0;i.forEach((function(t){var i={};!0===n&&(o.toState=t,i.value=t,i.selected="true"),n=!1,i.value=t,i.label=e[t].stateUserName,a.add(i)}));a.addEvent("onChange",(function(){var e=this.getSelection(!0);if(e.length>0){o.toState=e[0].value;var i=o._getUpdatedObjectsForState(t,o.toState);o._updateObjectListUI(t,i)}}));var r=UWA.createElement("div",{class:"maturity-Combo-Container-div"});a.inject(r),this.commandSpan.appendChild(r)},_updateObjectListUI:function(t,e){e||(e=this._getUpdatedObjectsForState(t,this.toState)),null!==this.objectsList&&(this.objectsList.modelUpdate(e),this.maturityWidget.options.isWebInWin?this.setTitle(t[this.toState].length+" "+a.Objects):this.setTitle(a.maturity+" - "+t[this.toState].length+" "+a.Objects),this.objectListDiv.show(),this._updateOKButton())},_prepareAndSort:function(t,e,i,s){var o=JSON.parse(n),a=[];for(var r in t){var l=t[r].current,c=this.model.getPolicy(t[r].policy),d=JSON.parse(JSON.stringify(c.maturityGraph.transitions)),h=c.maturityGraph.states,u=t[r].current;if("Entity"==t[r].coretype)for(var p=d.length,m=0;m<p;m++)"Obsolete"!=d[m].sourceState&&"Obsolete"!=d[m].targetState&&d.push({targetState:d[m].sourceState,sourceState:d[m].targetState,signatures:d[m].signatures});var f=t[r].excludeFromPromote;d.forEach((function(t){if(t.sourceState===l){var n=t.targetState;h.forEach((function(t){t.stateSysName===n&&(i[n]={},i[n].stateUserName=t.stateUserName)}));var c={phid:r,excludeFromPromote:f,fromstate:u};if(-1===s.indexOf(n)){var d=0;o.hasOwnProperty(n)&&(d=o[n].priority),a.push({name:n,priority:d}),s.push(n),e[n]=[c]}else-1===e[n].findIndex((function(t){return t.phid==c.phid}))&&e[n].push(c)}})),a.sort((function(t,e){return t.name==e.name?0:t.priority>e.priority?1:t.priority<e.priority?-1:0})),s.length=0,a.forEach((function(t){s.push(t.name)}))}}})})),define("DS/MaturityWidget/SampleFiltersAndActions",["UWA/Promise","DS/LifecycleServices/Utils"],(function(t,e){})),define("DS/MaturityWidget/MaturityModel",["UWA/Controls/Abstract","DS/LifecycleServices/LifecycleServicesSettings","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],(function(t,e,i){"use strict";return t.extend({isSingleIRPCAssembly:!1,isWebInWin:!1,init:function(){this.clear()},clear:function(){this.maturityGraphs={},this.objects={},this.policies={}},getAttribute:function(t,e){return void 0!==this.objects[t]?this.objects[t][e]:void 0},getAttributes:function(t){return this.objects[t]},setAttributes:function(t,e){this.objects[t]=e},setAttribute:function(t,e,i){void 0!==this.objects[t]&&(this.objects[t][e]=i)},setObjects:function(t){for(var e=0;e<t.length;e++)this.objects[t[e].physicalid]={},this.originalPid=t[e].physicalid,void 0!==t[e].serviceurl&&t[e].serviceurl&&(this.serviceurl=t[e].serviceurl),t[e].hasOwnProperty("locked")||t[e].hasOwnProperty("reserved")||(t[e].reserved=""),t[e].hasOwnProperty("lockedby")||t[e].hasOwnProperty("reservedby")||t[e].hasOwnProperty("reservedBy")||(t[e].reservedby="")},setChangeAction:function(t){this.changeAction=t},getChangeActionId:function(){var t=null;return void 0!==this.changeAction&&null!==this.changeAction&&this.changeAction.hasOwnProperty("id")&&(t=this.changeAction.id),t},getApplyTransition:function(t){return this.getAttribute(t,"applyTransition")},setApplyTransition:function(t,e){this.setAttribute(t,"applyTransition",e)},getObjects:function(){return this.objects},changeCurrentObjectState:function(t,e){var i=this.objects[t];if(i)if(i.current=e,i.maturityGraph)i.maturityGraph.states&&i.maturityGraph.states.forEach((function(t){t.stateSysName===e?(t.isCurrent=!0,i.currentStateUserName=t.stateUserName):t.isCurrent=!1}));else if(this.getMaturityGraph(i.policy)){var s=this.getMaturityGraph(i.policy).states[e];s&&(i.currentStateUserName=s.info.stateUserName)}},getStateUserNameFromStateSystemName:function(t,e){var i=null,s=this.objects[t];if(!s)return i;if(!s.maturityGraph&&this.getMaturityGraph(s.policy)){var o=this.getMaturityGraph(s.policy).states[e];o&&(i=o.info.stateUserName)}return i},setMaturityGraph:function(t){if(this.clear(),0==t.data.policies.length){console.log("ERROR: No policies in json");var s={};s.errorMsg=i.maturityGraphFailed,s.type="error",this.dispatchEvent("onError",s)}else{this.policies=t.data.policies,this.isConfirmationDialogEnabled=t.data.isConfirmationDialogEnabled;for(var o=!1,a=0;a<t.data.objects.length;a++){var n=t.data.objects[a].physicalid,r=t.data.objects[a];this.objects[n]=r,this.objects[n].signatures={};var l=[];if(t.data.objects[a].hasOwnProperty("routes")&&t.data.objects[a].routes.length>0){for(var c=0;c<t.data.objects[a].routes.length;c++)t.data.objects[a].routes[c].hasOwnProperty("routestatuses")&&l.push(this.objects[n].routes[c]);l.length>0&&(this.objects[n].routes=l)}else this.objects[n].routes=[];for(var d in this.objects[n].applyTransition=!0,this.objects[n].interfaceHash=[],r.InterfaceList)this.objects[n].interfaceHash[d]=d;if(void 0!==this.objects[n].isSingleIRPCAssembly&&null!==this.objects[n].isSingleIRPCAssembly&&this.objects[n].hasOwnProperty("isSingleIRPCAssembly")&&(o=o||this.objects[n].isSingleIRPCAssembly),this.objects[n].hasOwnProperty("imageUrl")&&void 0!==this.objects[n].imageUrl&&null!==this.objects[n].imageUrl){var h=this.objects[n].imageUrl,u=this.getCurrentTenantFromObject(this.objects[n]);if(h.startsWith("/")){var p=e.get3DSpaceBaseUrl(u);this.objects[n].imageUrl=p+h}}this.objects[n].excludeFromPromote=null!=r.isAggregateRep&&r.isAggregateRep,this.objects[n].excludeFromPromote||null!=r.usage&&"3DPart"==r.usage&&null!=r.isOnceInstantiable&&r.isOnceInstantiable&&(this.objects[n].excludeFromPromote=!0);var m=0;for(m=0;m<this.policies.length&&this.policies[m].name!==r.policy;m++);var f=this.policies[m].maturityGraph.transitions,g=this.policies[m].maturityGraph.states;this.actionnames={};for(var y=0;y<g.length;y++)!0===g[y].isCurrent&&this.setAttribute(n,"current",g[y].stateSysName),this.actionnames[g[y].stateSysName]={},this.objects[n].signatures[g[y].stateSysName]={};for(var v=0;v<f.length;v++){for(var S=f[v].sourceState,b=f[v].targetState,C=f[v].signatures,I={},_=0;_<C.length;_++)I[C[_].name]=C[_],C[_].username.includes("emxFramework")?this.actionnames[S][b]=C[_].name:this.actionnames[S][b]=C[_].username;this.objects[n].signatures[S][b]=I}var A=r.policy;if(void 0===this.maturityGraphs[A]){var w={};for(_=0;_<g.length;_++){var x=g[_].stateSysName,P=g[_].activeColor,T=g[_].inactiveColor,D=g[_].tooltip,E={connectors_out:{},connectors_in:{},info:{},actionnames:{},activecolor:{},inactivecolor:{},tooltip:{}};for(v=0;v<f.length;v++){S=f[v].sourceState,b=f[v].targetState,C=f[v].signatures;if(S===x){var M={};if(this.objects[n].routes.length>0)for(var O=0;O<this.objects[n].routes.length;O++)this.objects[n].routes[O].fromState===S&&this.objects[n].routes[O].toState===b&&(M=this.objects[n].routes[O],E.connectors_out[b]=M);E.connectors_out[b]=M}b===x&&(E.connectors_in[S]={})}E.info=g[_],E.actionnames=this.actionnames,E.activecolor=P,E.inactivecolor=T,E.tooltip=D,w[x]=E}var k=0;for(_=0;_<g.length;_++){void 0!==w[x=g[_].stateSysName]&&(w[x].info.visuorder=k,k++)}this.maturityGraphs[A]={},this.maturityGraphs[A].states=w,this.maturityGraphs[A].infos={};var W=this.objects[n].coretype,U=this.objects[n].isOnceInstantiable;this.maturityGraphs[A].infos.isPromoteAuthorized=!1,this.maturityGraphs[A].infos.isDemoteAuthorized=!1,"Entity"===W&&(this.maturityGraphs[A].infos.isDemoteAuthorized=!0),("Entity"===W||"Reference"===W&&!U||"Reference"===W&&void 0!==r.usage&&null!==r.usage&&("DraftingRepresentation"===r.usage||"Kinematics"===r.usage))&&(this.maturityGraphs[A].infos.isPromoteAuthorized=!0)}else if(!this.maturityGraphs[A].infos.isPromoteAuthorized){W=this.objects[n].coretype,U=this.objects[n].isOnceInstantiable;("Entity"===W||"Reference"===W&&!U)&&(this.maturityGraphs[A].infos.isPromoteAuthorized=!0)}}this.isSingleIRPCAssembly=o}},getMaturityGraph:function(t){return this.maturityGraphs[t]},getCurrentTenantFromObject:function(t){var i=window.widget.getValue("x3dPlatformId");return(null==i||i.trim().length<1)&&(i=e.getTenant()),t&&t.hasOwnProperty("tenant")?t.tenant:i},getPolicy:function(t){for(var e=0;e<this.policies.length;e++)if(this.policies[e].name===t)return this.policies[e]},getAllStates:function(){var t=[];for(var e in this.maturityGraphs)if(this.maturityGraphs.hasOwnProperty(e)){var i=this.getMaturityGraph(e);for(var s in i.states)i.states.hasOwnProperty(s)&&t.push(s)}return t}})})),define("DS/MaturityWidget/MaturityGraph",["UWA/Controls/Abstract","DS/LifecycleCmd/Dictionary","DS/LifecycleControls/AdaptiveLayout","DS/LifecycleServices/Utils","DS/LifecycleServices/LifecyclePerfTimer","DS/UIKIT/Mask","DS/UIKIT/Tooltip","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],(function(t,e,i,s,o,a,n,r){"use strict";return t.extend({pendingUpdate:!1,create:function(t,e){this.pendingTransition=!1,this.MainContainer=t,this._injectHTML(t,e),this._setupAdaptiveUI(t)},destroy:function(){null!=this&&(void 0!==this.adaptiveLayout&&null!==this.adaptiveLayout&&(this.adaptiveLayout.stop(),this.adaptiveLayout=null),void 0!==this.SVG_container&&null!==this.SVG_container&&(this.SVG_container.destroy(),this.SVG_container=null),void 0!==this.state_container&&null!==this.state_container&&(this.state_container.destroy(),this.state_container=null),this.paths=[],this.stateToElement=null)},updateGraph:function(t){this._updateStateElements(t),this.pendingUpdate||(this.pendingUpdate=!0,this._deleteConnectors(),this._createConnectors(t),this.paths.forEach((function(t){""!=t.path.id&&t.path.classList.add("fade-in")})),this.adaptiveLayout.restart(["active-path","inactive-path"]),this._drawConnectors(),this.pendingUpdate=!1)},onStartTransition:function(t){this.svgDoc1=document.getElementsByClassName("textclass"),a.unmask(this.MainContainer.getParent());for(var e=0;e<this.svgDoc1.length;e++){this.svgDoc1[e].style.pointerEvents="none"}this.pendingTransition=!0,this._enableStateElements(!1);var i=this.stateToElement.find(t);i&&(this.changeToMasked=i.element,this.changeToMasked.addClassName("lcm-state-pulse"),a.mask(this.changeToMasked,"")),this._animatePath(t,!1)},onEndTransition:function(t){this.pendingTransition=!1,this.changeToMasked&&(this.changeToMasked.removeClassName("lcm-state-pulse"),a.unmask(this.changeToMasked),this.changeToMasked=null),this._animatePath(t,!0),this._enableStateElements(!0);for(var e=0;e<this.svgDoc1.length;e++){this.svgDoc1[e].style.pointerEvents="auto"}},changeRouteIcon:function(t){for(var e in t){var i=t[e];if(t[i.info.stateSysName].connectors_out[transition]){var s=null;if(t[i.info.stateSysName].connectors_out[transition]&&t[i.info.stateSysName].connectors_out[transition].hasOwnProperty("routestatuses"))if("Block"===t[i.info.stateSysName].connectors_out[transition].routestatuses[0].status){s="&#xE510; ";var o=this._createSVGEl("title");o.innerHTML=r.routeBlocking,text.appendChild(o)}else"RouteCreated"===t[i.info.stateSysName].connectors_out[transition].routestatuses[0].status&&(s="&#xE511; ");s?(tspan1.removeAttribute("stroke"),tspan1.removeAttribute("stroke-width"),tspan1.removeAttribute("fill"),tspan1.removeAttribute("font-weight"),tspan1.setAttribute("font-family","3DS Fonticon"),tspan1.setAttribute("class","wux-ui-3ds"),tspan1.innerHTML=s):tspan1.textContent="» "}else tspan1.textContent="» "}},_onStyleChanged:function(t,e){this.currentConnectorMargins=this.connectorMargins.find(t),this._drawConnectors(),this.changeToMasked&&(a.unmask(this.changeToMasked),a.mask(this.changeToMasked,"")),this._enableStateTooltips(!0)},_setupAdaptiveConnectorMargins:function(){this.connectorMargins=new e,this.connectorMargins.add("lcm-state",{height:16,padding:18,connectorSize:20}),this.connectorMargins.add("lcm-state-m",{height:14,padding:3,connectorSize:10}),this.connectorMargins.add("lcm-state-s",{height:8,padding:0,connectorSize:4}),this.connectorMargins.add("lcm-state-hidden",{height:0,padding:0,connectorSize:0})},_setupAdaptiveUI:function(t){this._setupAdaptiveConnectorMargins(),this.parentContainer=t;var e=this._calcWidth(this.state_container,"lcm-state","lcm-state-connector",this.numStates),s=(this._calcWidth(this.state_container,"lcm-state-m","lcm-state-connector-m",this.numStates),this._calcWidth(this.state_container,"lcm-state-s","lcm-state-connector-s",this.numStates)),o=this._calcHeight(this.state_container,"lcm-state"),a=(this._calcHeight(this.state_container,"lcm-state-m"),this._calcHeight(this.state_container,"lcm-state-s"));o+=2*this.connectorMargins.find("lcm-state").height,this.connectorMargins.find("lcm-state-m").height;a+=2*this.connectorMargins.find("lcm-state-s").height;var n="max-width:"+e+";max-height:"+o;var r=e+50+"px";t.setStyles({height:"122px",width:r});var l=document.getElementsByClassName("lcm-maturity-content")[0].getParent(),c=document.getElementsByClassName("lcm-state-current");-1==navigator.userAgent.indexOf("Firefox")&&-1==navigator.userAgent.indexOf("MSIE")&&-1==navigator.userAgent.indexOf("rv:")&&null!=l&&"lifecycle-content maturity"!=l.className&&c[0].scrollIntoViewIfNeeded({behavior:"smooth",block:"nearest",inline:"start"});var d=this;this.adaptiveLayout=new i("lcm-state",t).onSizeChanged((function(t,e){t||d._drawConnectors(),d.confirmationUI.isVisible&&d.confirmationUI.position()})).onStyleChanged((function(t,e){d._onStyleChanged(t,e)})).start()},_injectHTML:function(t,e){this._createContainers(t),this._createStateElements(e),this._createTransitionConfirmationUI(t),this._createSVGCanvas(),this._createSVGEndArrows(),this._createConnectors(e)},_calcWidth:function(t,e,i,s){var o=function(t,e){var i=document.createElement("div");i.className=e,t.appendChild(i);var s=window.getComputedStyle(i),o=parseInt(s.marginLeft,10)+parseInt(s.marginRight,10)+i.getBoundingClientRect().width;return t.removeChild(i),o};return o(t,e)*s+o(t,i)*(s-1)+8*s},_calcHeight:function(t,e){var i=document.createElement("div");i.className=e,t.appendChild(i);var s=window.getComputedStyle(i),o=parseInt(s.marginTop,10)+parseInt(s.marginBottom,10)+i.getBoundingClientRect().height;t.removeChild(i);var a=this.connectorMargins.find(e);return a&&a.height&&(o+=a.height),o},_createContainers:function(t){for(var e=document.getElementsByClassName("lcm-svg-container");e.length>0;)e[0].remove();for(var i=document.getElementsByClassName("lcm-state-container");i.length>0;)i[0].remove();this.SVG_container=UWA.createElement("div",{class:"lcm-svg-container"}),this.state_container=UWA.createElement("div",{class:"lcm-state-container"}),this.SVG_container.inject(t),this.state_container.inject(t)},_getStateClass:function(t,e){if(t.info.isCurrent)return"lcm-state-current";if(t.isDisabled)return"lcm-state-unreachable";if(t.isDemote)return"lcm-state-transitionable";for(var i in t.connectors_in)if(i===e)return"lcm-state-transitionable";return"lcm-state-unreachable"},_getCurrentState:function(t){for(var e in t)if(t[e].info.isCurrent)return e;return""},_animatePath:function(t,e){if(!this._isIE11()){var i='path[*|to="'+t+'"]',s=this.SVGCanvas.querySelector(i);if(s){var o=UWA.extendElement(s);if(e)o.removeAttribute("style","stroke-width"),o.removeClassName("animate-path");else{if(o.hasClassName("animate-path"))return;var a=getComputedStyle(o).strokeWidth,n=parseFloat(a)+1;o.setAttribute("style","stroke-width:"+n+"px"),o.removeClassName("fade-in"),o.addClassName("animate-path")}this._patchIEPathBug(o)}}},_getTransitionConfirmText:function(t,e){return e[t].isDemote?r.demoteTo+e[t].info.stateUserName+"?":e[t].isPromote?r.promoteTo+e[t].info.stateUserName+"?":r.changeMaturityTo+e[t].info.stateUserName+"?"},_setStateColor:function(t){this.stateColor={},this.transitionColor="","Draft"===t||"Prepare"===t||"PRIVATE"===t||"Prepare"===t||"Create"===t?(this.stateColor=" private",this.transitionColor="#9B2C98"):"In Work"===t||"IN_WORK"===t||"In Work"===t||"Assign"===t?(this.stateColor=" inwork",this.transitionColor="#007DA3"):"In Approval"===t||"FROZEN"===t||"In Approval"===t||"Active"===t?(this.stateColor=" frozen",this.transitionColor="#018308"):"Completed"===t||"RELEASED"===t||"Complete"===t||"Closed"===t||"OBSOLETE"===t?(this.stateColor=" released",this.transitionColor="#757575"):"Approved"===t||"Review"===t?(this.stateColor=" approved",this.transitionColor="#E03400"):this.stateColor=""},_createStateElements:function(t){this.stateToElement=new e;var i=this._getCurrentState(t),s=!0,o=0;for(var a in t){var r=this._getStateClass(t[a],i);this._setStateColor(a);var l="",c=UWA.createElement("span",{class:"lcm-state-text",html:t[a].info.stateUserName});if("lcm-state-current"===r||s?(t[a].activecolor.includes("emxFramework")?l="#757575":"#FFFFFF"===(l=t[a].activecolor)&&(c.style.color="black"),"lcm-state-current"===r&&(s=!1)):t[a].inactivecolor.includes("emxFramework")?l="#BABABA":"#FFFFFF"===(l=t[a].inactivecolor)&&(c.style.color="gray"),0!==o)UWA.createElement("div",{class:"lcm-state-connector"}).inject(this.state_container);var d=UWA.createElement("div",{class:"lcm-state-base lcm-state "+r+" lcm-"+this.stateColor.trim(),styles:{backgroundColor:l}});"#FFFFFF"===l&&(d.style.border="lcm-state-current"===r?"2px solid black":"1px solid #B4B6BA"),c.inject(d),d.inject(this.state_container);this._getTransitionConfirmText(a,t);var h="";h=t[a].tooltip.includes("emxFramework")?t[a].info.stateUserName:t[a].tooltip;var u=new n({target:d,body:h,position:"bottom"});u.elements.container.style.display="none",u.elements.container.style.zIndex=99999,this.stateToElement.add(a,{element:d,tooltip:u,order:o++,numConnectors:{right:0,left:0,top:0,bottom:0}})}this.numStates=o},_updateStateElements:function(t){var e=this,i=this._getCurrentState(t),s=!0;this._forEachStateElement((function(o,a){o.removeClassName("lcm-state-unreachable"),o.removeClassName("lcm-state-transitionable"),o.removeClassName("lcm-state-current");var n=e._getStateClass(t[a],i);o.addClassName(n);var r="";"lcm-state-current"===n||s?(t[a].activecolor.includes("emxFramework")?r="#757575":"#FFFFFF"===(r=t[a].activecolor)&&(void 0!==o.children[0]&&(o.children[0].style.color="black"),o.style.border="2px solid black"),"lcm-state-current"===n&&(s=!1)):r=t[a].inactivecolor.includes("emxFramework")?"#BABABA":t[a].inactivecolor,o.confirmText=e._getTransitionConfirmText(a,t),o.action=t[a].action,o.setStyle("backgroundColor",r)}))},_enableStateTooltips:function(t){var e=this;this._forEachStateElement((function(i,s){var o=e.stateToElement.find(s);o&&(o.tooltip.elements.container.style.display=t?"":"none")}))},_enableStateElements:function(t){this._forEachStateElement((function(e){e.disabled=!t,e.setAttribute("data-disabled",(!t).toString()),t?e.hasClassName("lcm-state-disabled")&&e.removeClassName("lcm-state-disabled"):e.hasClassName("lcm-state-transitionable")&&e.addClassName("lcm-state-disabled")}))},_forEachStateElement:function(t){var e=this;void 0!==this.stateToElement&&null!==this.stateToElement&&this.stateToElement.each((function(i){var s=e.stateToElement.find(i).element;t(s,i)}))},_createTransitionConfirmationUI:function(t){var e=this,i=function(){},s=this._injectTransitionConfirmationUI(t,(function(){i()}),(function(){e.confirmationUI.isVisible=!1})),o=s.querySelector(".lcm-transition-confirm-button"),a=s.querySelector(".lcm-confirm-msg");this.confirmationUI={isVisible:!1,show:function(t,e,n){i=n,s.style.display="inline-block",o.focus(),a.innerText=e,this.currentEl=t,this.position(),this.isVisible=!0},hide:function(){this.currentEl=null,s.style.display="inline-block",this.isVisible=!1},position:function(){this.currentEl&&(s.style.left=this.currentEl.offsetLeft-0+"px",s.style.top=this.currentEl.offsetTop-1+"px")}}},_injectTransitionConfirmationUI:function(t,e,i){var o=s.htmlFromString("<div class='lcm-confirm-transition'><div class='lcm-confirm-msg'></div><button class='lcm-transition-confirm-button lcm-transition-confirm-button-base'>"+r.maturityConfirmTransition+"</button></div>"),a=o.querySelector(".lcm-confirm-transition"),n=o.querySelector(".lcm-transition-confirm-button");return["mousedown","touchstart"].forEach((function(t){n.addEventListener(t,(function(t){"inline-block"===a.style.display&&(t.stopPropagation(),a.style.display="none",e())}))})),n.addEventListener("blur",(function(){a.style.display="none","function"==typeof i&&i()})),t.appendChild(o),a},_deleteConnectors:function(){var t=this;this.paths.forEach((function(e){var i=e.path.parentNode;i&&(""!=e.path.id&&i.removeChild(t.text[e.path.id]),i.removeChild(e.path))})),this.paths=[];t=this;this.stateToElement&&this.stateToElement.count()>0&&this.stateToElement.each((function(e){t.stateToElement.find(e).numConnectors={right:0,left:0,top:0,bottom:0}}))},_createSVGEndArrows:function(){this.SVGCanvas.appendChild(this._createSVGEndArrow("arrow-active")),this.SVGCanvas.appendChild(this._createSVGEndArrow("arrow-inactive"))},_createConnectors:function(t){var e=this;this.Mask=a,this.paths=[],this.text={},this.tspan1={};var i,s=this,n=function(t,e){t.addEventListener("mouseover",(function(){"true"!==t.getAttribute("data-disabled")&&s._animatePath(e,!1)})),t.addEventListener("mouseout",(function(){s.pendingTransition||s._animatePath(e,!0)}))},l=function(t,i,s,n){t.confirmText=i,t.action=s,t.filter=n;var r=function(){},l=function(){};r=s,l=n,t.addEventListener("click",(function(){"true"!==t.getAttribute("data-disabled")&&(a.mask(e.MainContainer.getParent()),l().then((function(t){var i=!1;for(var s in t){i=!0;break}i?(e._perfTimer=o,e._perfTimer.start("CommandExecutionDurationMaturity"),r(t)):a.unmask(e.MainContainer.getParent())})))}))};for(var c in t){var d=t[c],h={},u=0,p=0,m=0,f={};for(var g in d.connectors_out){var y;h[(y=t[g]).info.visuorder]={},h[y.info.visuorder]=g,y.info.visuorder<d.info.visuorder?(f[y.info.visuorder]="bottom",u++):y.info.visuorder>d.info.visuorder+1&&(f[y.info.visuorder]="top",p++)}if(d.info.isCurrent&&void 0!==i)d.connectors_out[i]={},console.log(d.connectors_out),h[(y=t[i]).info.visuorder]={},h[y.info.visuorder]=i,y.info.visuorder<d.info.visuorder?(f[y.info.visuorder]="bottom",u++):y.info.visuorder>d.info.visuorder+1&&(f[y.info.visuorder]="top",p++);for(var v in this.totTop=p,this.totBot=u,h){g=h[v];var S=this._createSVGEl("path");this.SVGCanvas.appendChild(S);var b=this._createSVGEl("tspan");if(d.info.isCurrent){s._setStateColor(g),t[g].activecolor.includes("emxFramework")?this.transitionColor="#757575":this.transitionColor=t[g].activecolor,S.setAttribute("marker-end","url(#arrow-active)"),S.setAttribute("class","active-path"),S.setAttribute("id",g),S.setAttributeNS("state","to",d.isDemote?c:g);var C=this._createSVGEl("text"),I=this._createSVGEl("tspan");b.setAttribute("font-weight","bold"),"#FFFFFF"===this.transitionColor?(b.setAttribute("stroke","gray"),b.setAttribute("stroke-opacity","50%"),b.setAttribute("stroke-width","0.5%"),b.setAttribute("fill","none")):(b.setAttribute("stroke",this.transitionColor),b.setAttribute("stroke-width","0.5%"),b.setAttribute("fill","none")),d.info.visuorder>t[g].info.visuorder?(C.appendChild(I),C.appendChild(b)):(C.appendChild(b),C.appendChild(I)),"function"==typeof t[g].action&&(void 0!==d.actionnames[c][g]?I.textContent=d.actionnames[c][g]+" ":I.textContent=r.setTo+" "+t[g].info.stateUserName+" "),this.SVGCanvas.appendChild(C),this.text[g]=C,this.tspan1[g]=b;var _=this._getTransitionConfirmText(c,t);n(C,g),"function"==typeof t[g].action&&"function"==typeof t[g].action&&"function"==typeof t[g].filter&&l(C,_,t[g].action,t[g].filter)}else d.isDemote?(s._setStateColor(c),i=c,S.setAttribute("marker-end","url(#arrow-inactive)"),S.setAttribute("class","inactive-path")):this.stateToElement.find(g)&&this.stateToElement.find(c)&&this.stateToElement.find(g).order===this.stateToElement.find(c).order+1?(S.setAttribute("marker-end","url(#arrow-inactive)"),S.setAttribute("class","inactive-path")):(S.setAttribute("marker-end","url(#arrow-hidden)"),S.setAttribute("class","hidden-path"));var A,w,x=d.connectors_in.hasOwnProperty(g),P=this.stateToElement.find(g).order-this.stateToElement.find(c).order;if(1===P?(A="right",w="left"):-1===P?x?(A="bottom",w="bottom"):(A="left",w="right"):P>1?(A="top",w="top"):P<-1&&(A="bottom",w="bottom"),"function"==typeof t[g].action)if(d.info.visuorder>t[g].info.visuorder)b.textContent="« ";else if(d.isDemote)b.textContent="« ";else if(t[d.info.stateSysName].connectors_out[g]){var T=null;if(t[d.info.stateSysName].connectors_out[g]&&t[d.info.stateSysName].connectors_out[g].hasOwnProperty("routestatuses"))if("Block"===t[d.info.stateSysName].connectors_out[g].routestatuses[0].status||"real"==t[d.info.stateSysName].connectors_out[g].mode&&"RouteCreated"===t[d.info.stateSysName].connectors_out[g].routestatuses[0].status)T="&#xE510; ",(D=this._createSVGEl("title")).innerHTML=r.routeBlocking,C.appendChild(D);else if("RouteCreated"===t[d.info.stateSysName].connectors_out[g].routestatuses[0].status){var D;T="&#xE511; ",(D=this._createSVGEl("title")).innerHTML=r.routeToBeCreated,C.appendChild(D)}T?(b.removeAttribute("stroke"),b.removeAttribute("stroke-width"),b.removeAttribute("fill"),b.removeAttribute("font-weight"),b.setAttribute("font-family","3DS Fonticon"),b.setAttribute("class","wux-ui-3ds"),b.innerHTML=T):b.textContent="» "}else b.textContent="» ";if("top"===w){var E=p,M=++this.stateToElement.find(g).numConnectors[w];p--,m++}else if("bottom"===w){E=u,M=++this.stateToElement.find(g).numConnectors[w];this.space=u,u--}else E=++this.stateToElement.find(c).numConnectors[A],M=++this.stateToElement.find(g).numConnectors[w];this.paths.push({path:S,from:c,fromConnectOrder:E,to:g,toConnectOrder:M,opts:{connectFrom:A,connectTo:w,numConn:E,topHeight:m,totTop:this.totTop,totBot:this.totBot}})}}},_drawConnectors:function(){if(this.currentConnectorMargins){var t={ptsTop:[],ptsBottom:[],height:this.currentConnectorMargins.height,padding:this.currentConnectorMargins.padding,calcHeight:function(t,e,i){var s=0,o=this.normalizePt(t);return"top"===e?(s=this.numIntersects(o,this.ptsTop),this.ptsTop.push(o)):"bottom"===e&&(s=this.numIntersects(o,this.ptsBottom),this.ptsBottom.push(o)),this.height+this.padding*s+i*i*i*s},numIntersects:function(t,e){var i=0,s=function(t,e){return t<e.p2&&t>e.p1};return e.forEach((function(e){(s(t.p1,e)||s(t.p2,e)||s(e.p1,t)||s(e.p2,t))&&(i=1)})),i},normalizePt:function(t){return{p1:Math.min(t.p1,t.p2),p2:Math.max(t.p1,t.p2)}}};this.paths.forEach((function(e){var i=this.stateToElement.find(e.from),s=i.element,o=this.stateToElement.find(e.to),a=o.element,n={fromConnectorOrder:e.fromConnectOrder,toConnectorOrder:e.toConnectOrder,numConnectorsFrom:i.numConnectors[e.opts.connectFrom],numConnectorsTo:o.numConnectors[e.opts.connectTo],connectorSize:this.currentConnectorMargins.connectorSize,heightCalc:t},r={};UWA.extend(r,e.opts),UWA.extend(r,n),(""!=e.path.id||"bottom"!=r.connectTo&&"top"!=r.connectTo)&&this._drawLine(e.path,s,a,r)}),this);for(var e=document.getElementsByClassName("active-path"),i=0,s=0;s<e.length;s++){var o=e[s].getBoundingClientRect().height;o>i&&(i=o)}var a=2*i+80+5+"px";this.parentContainer.setStyles({height:a})}},_drawLine:function(t,e,i,s){var o=function(t,e,i){var s=function(t,e,i){return 1===i.numConnectors?t+e/2:t+(e-i.numConnectors*i.size)/2+i.size/2+i.size*(i.connectOrder-1)},o={x:0,y:0},a=t.getBoundingClientRect(),n=a.right-a.left,r=a.bottom-a.top,l=t.offsetLeft,c=t.offsetTop;return"right"===e?(o.x=l+n,o.y=s(c,r,i)):"top"===e?(i.p2?o.x=l+n/2:o.x=l+n/(i.totTop+1)*i.numConn-i.numConn,o.y=c):"bottom"===e?(i.p2?o.x=l+n/2:o.x=l+n/(i.totBot+1)*i.numConn-i.numConn,o.y=c+r):"left"===e&&(o.x=l,o.y=s(c,r,i)),o},a=function(t,e){return t+" "+e.x+" "+e.y+" "},n=o(e,s.connectFrom,{connectOrder:s.fromConnectorOrder,numConnectors:s.numConnectorsFrom,size:s.connectorSize,totTop:s.totTop,totBot:s.totBot,numConn:s.numConn,p2:!1}),r=a("M",n),l=o(i,s.connectTo,{connectOrder:s.toConnectorOrder,numConnectors:s.numConnectorsTo,size:s.connectorSize,totTop:s.totTop,totBot:s.totBot,numConn:s.numConn,p2:!0}),c=a("L",l),d="";if("bottom"===s.connectTo||"top"===s.connectTo){var h=this.currentConnectorMargins.height*s.topHeight+5*s.topHeight;"bottom"===s.connectTo&&(h=this.currentConnectorMargins.height*s.numConn+5*s.numConn);var u={};u.x=n.x,u.y=n.y+("top"===s.connectTo?-h:h);var p=a("L",u),m={};m.x=l.x,m.y=l.y+("top"===s.connectTo?-h:h);var f=a("L",m);if(""!=t.id){if(this.text[t.id].setAttribute("class","textclass"),this.text[t.id].setAttribute("font-family","Arial"),e.hasClassName("lcm-state")?(this.text[t.id].setAttribute("font-size","12"),this.tspan1[t.id].setAttribute("font-size","22")):e.hasClassName("lcm-state-m")?(this.text[t.id].setAttribute("font-size","9"),this.tspan1[t.id].setAttribute("font-size","16")):(this.text[t.id].setAttribute("font-size","6"),this.tspan1[t.id].setAttribute("font-size","14")),this.text[t.id].setAttribute("fill","#368ec4"),"top"===s.connectTo){var g=u.x>m.x?m.x:u.x;this.text[t.id].setAttribute("text-anchor","start")}else{g=u.x>m.x?u.x:m.x;this.text[t.id].setAttribute("text-anchor","end")}this.text[t.id].setAttribute("x",g),this.text[t.id].setAttribute("y",m.y+("top"===s.connectTo?-5:15))}d=r+p+f+c}else{var y={x:0,y:0},v="";if(n.y!==l.y&&n.x!==l.x&&(y.x=n.x,y.y=l.y),0!==y.x&&(v=a("L",y)),""!=t.id){h=s.heightCalc.calcHeight({p1:n.x,p2:l.x},s.connectTo);this.text[t.id].setAttribute("class","textclass fade-in"),this.text[t.id].setAttribute("font-family","Arial"),e.hasClassName("lcm-state")?(this.text[t.id].setAttribute("font-size","12"),this.tspan1[t.id].setAttribute("font-size","22")):e.hasClassName("lcm-state-m")?(this.text[t.id].setAttribute("font-size","9"),this.tspan1[t.id].setAttribute("font-size","16")):(this.text[t.id].setAttribute("font-size","6"),this.tspan1[t.id].setAttribute("font-size","14")),this.text[t.id].setAttribute("fill","#368ec4");g=l.x;this.text[t.id].setAttribute("text-anchor","start"),this.text[t.id].setAttribute("x",g),this.text[t.id].setAttribute("y",l.y+40)}d=r+v+c}t.setAttribute("d",d),this._patchIEPathBug(t)},_isIE11:function(){return this._browserCheck=this._browserCheck||{isIE11:/Trident\/7\./.test(navigator.userAgent)},this._browserCheck.isIE11},_patchIEPathBug:function(t){if(this._isIE11()){var e=t.parentNode;e.removeChild(t),e.appendChild(t)}},_createSVGEl:function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)},_createSVGEndArrow:function(t){var e=this._createSVGEl("marker"),i=this._createSVGEl("defs"),s=this._createSVGEl("path");return e.appendChild(s),i.appendChild(e),e.setAttribute("id",t),e.setAttribute("markerWidth","10"),e.setAttribute("markerHeight","8"),e.setAttribute("refX","9"),e.setAttribute("refY","4"),e.setAttribute("orient","auto"),s.setAttribute("d","M 3 1 L 10 4 L 3 7"),s.setAttribute("class",t),i},_createSVGCanvas:function(){var t=this._createSVGEl("svg");t.setAttribute("id","svgCanvas"),t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("xmlns:state","http://www.lc.com/state"),UWA.extendElement(t).inject(this.SVG_container),this.SVGCanvas=t}})})),define("DS/MaturityWidget/MaturityTransitionFilters",["UWA/Promise","DS/LifecycleServices/LifecycleServices"],(function(t,e){"use strict";function i(){var t=[],i=[],s=[];i=[];t.VPMReference=[],t.Drawing=[],t.SoftwareLogicalItem=[],t.SemiconductorLogicalItem=[],t.MaturityAllTypes=[],i.VPMReference=[],i.Drawing=[],i.SoftwareLogicalItem=[],i.SemiconductorLogicalItem=[],i.MaturityAllTypes=[],require(["DS/MaturityWidget/MaturityConfirmationDialogFilter"],(function(e){s["MaturityConfirmation.showConfirmationDialog"]=e.showConfirmationDialog,t.MaturityAllTypes.push("MaturityConfirmation.showConfirmationDialog")}),(function(){}));var o="DS/ENOXSoftwareExt/Lifecycle/MaturityFilters";require([o],(function(e){s["ENOSoftExt.PromoteDynamicSelector"]=e.PromoteDynamicSelector,t.SoftwareLogicalItem.push("ENOSoftExt.PromoteDynamicSelector"),t.VPMReference.push("ENOSoftExt.PromoteDynamicSelector")}),(function(){}));o=["DS/ENOXSemiExt/Lifecycle/MaturityFilters"];require(o,(function(o){s["ENOSemiExt.PromoteDynamicSelector"]=o.PromoteDynamicSelector,t.SemiconductorLogicalItem.push("ENOSemiExt.PromoteDynamicSelector");var a=function(e){for(var s=e.SemiconductorLogicalItem?e.SemiconductorLogicalItem:[],o=s.length,a=0;a<o;a++){var n=s[a];i[n]=[],t[n]=[],t[n].push("ENOSemiExt.PromoteDynamicSelector")}};if(window.__karma__){var n={SemiconductorLogicalItem:null};a(n)}else try{e.fetchSubTypesFromServer({payload:{types:["SemiconductorLogicalItem"]}},a,(function(t){console.log("Timeout error in fetchSubTypesFromServer")}),(function(t,e){console.log("Failed to retrieve data from the server"),console.log(t)}))}catch(t){console.log(t)}}),(function(){})),this.typeFilterKeys=t,this.typeActionKeys=i,this.filterMap=s,this.actionMap=[],this.interfaceMap=[]}return i.prototype={fetchTypeFilterKeys:function(t,e){var i=[];if("MaturityAllTypes"in this.typeFilterKeys)for(var s=this.typeFilterKeys.MaturityAllTypes,o=0;o<s.length;o++)if(s[o]in this.interfaceMap){var a=this.interfaceMap[s[o]];for(var n in e)if(n in a){i.push(s[o]);break}}else i.push(s[o]);if(t in this.typeFilterKeys)for(s=this.typeFilterKeys[t],o=0;o<s.length;o++)if(s[o]in this.interfaceMap){a=this.interfaceMap[s[o]];for(var n in e)if(n in a){i.push(s[o]);break}}else i.push(s[o]);return i.length>0?i:["default"]},fetchTypeFilter:function(e){return e in this.filterMap?this.filterMap[e]:function(e,i){return new t((function(t,i){for(var s=[],o=0;o<e.length;o++)s[e[o].physicalid]="";t(s)}))}},fetchTypeActionKeys:function(t,e){if(t in this.typeActionKeys){for(var i=this.typeActionKeys[t],s=[],o=0;o<i.length;o++)if(i[o]in this.interfaceMap){var a=this.interfaceMap[i[o]];for(var n in e)if(n in a){s.push(i[o]);break}}else s.push(i[o]);if(s.length>0)return s}return["default"]},fetchActionFilter:function(t){return t in this.actionMap?this.actionMap[t]:null}},new i})),define("DS/MaturityWidget/MaturityController",["UWA/Controls/Abstract","UWA/Class/Promise","DS/PlatformAPI/PlatformAPI","DS/MaturityWidget/MaturityModel","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/LifecyclePerfTimer","DS/WAFData/WAFData","DS/LifecycleServices/AssemblyJson","DS/LifecycleCmd/AssemblySelectionUtil","DS/ENOCollabToolsUI/tracker/ENOCollabTrackerBackEnd","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","i18n!DS/LifecycleServices/assets/nls/LifecycleServicesNls","DS/ReportingPanel/ReportingPanel","DS/LifecycleServices/Expandv2Parser","DS/LifecycleCmd/SelectionUtil"],(function(t,e,i,s,o,a,n,r,l,c,d,h,u,p,m,f){"use strict";const g=36e5;var y=null;function v(){return null==y&&(y=i.getUser()),y}return t.extend({tenant:null,isEmbeddedUI:!1,init:function(t){this._context=t;this.model=new s,this.policy="VPLM_SMB_Definition",this.tenant=null,this._perfTimer=n,this.selectedItems={},this.isPromoteDeomoteBothServiceUsed=!1,this.dataForReportingPanel=[],this.counterforPromoteDemote=0,this.initialSelections={},this.includeStructureFlag=!1,this.statusNls=h.get("MATURITY_Status"),this.titleNls=h.get("MATURITY_Title"),this.typeNls=h.get("MATURITY_Sum_Type"),this.revisionNls=h.get("MATURITY_Revision"),this.maturityNls=u.maturitystate,this.maturityLockNls=h.Lock,this.orgNls=h.get("MATURITY_Sum_Org"),this.collabNls=h.get("MATURITY_Sum_Collab"),this.completionNls=h.get("MATURITY_Result"),this.cols=[{text:"ID",dataIndex:"ID",isHidden:!0},{text:"StatusToolTipColumn",dataIndex:"statusTooltip",isHidden:!0,tooltipColumn:"Status"},{text:this.statusNls,dataIndex:"Status",typeRepresentation:"icon"},{text:this.titleNls,dataIndex:this.titleNls},{text:this.typeNls,dataIndex:this.typeNls},{text:this.revisionNls,dataIndex:this.revisionNls},{text:this.maturityNls,dataIndex:"Current"},{text:this.maturityLockNls,dataIndex:"Reserved",typeRepresentation:"icon",width:50,resizableFlag:!1},{text:this.orgNls,dataIndex:this.orgNls},{text:this.collabNls,dataIndex:this.collabNls},{text:this.completionNls,dataIndex:this.completionNls},{text:h.deleteObjects,dataIndex:"Selected",isHidden:!0,isFilter:!0,filterOptions:[{value:h.deleteSelected,default:"on",tooltip:h.deleteSelectedToolTip},{value:h.deleteAdded,default:"off",tooltip:h.deleteAddedToolTip}]},{text:h.deleteResults,dataIndex:"Results",isHidden:!0,isFilter:!0,filterOptions:[{value:h.deleteSuccessfulShort,default:"on",tooltip:h.deleteSuccessfulShort},{value:h.deleteFailedShort,default:"on",tooltip:h.deleteFailedShort}]}]},initGraph:function(t,e){var i=this;i.initialSelections=t,o.getSecurityContextPromise(this.tenant,this._context).then((function(s){null==s&&i.dispatchEvent("onError",{errorMsg:h.ErrorSecurityContextEmpty}),i.securityContext=s,i._getMaturityGraph(t,null,e,s,!0)}))},promote:function(t){var e=this;o.getSecurityContextPromise(this.tenant,this._context).then((function(i){e._changeMaturity("promote",t,i)}))},demote:function(t){var e=this;o.getSecurityContextPromise(this.tenant,this._context).then((function(i){e._changeMaturity("demote",t,i)}))},expandStructure:function(t,e,i,s){var a=this;o.getSecurityContextPromise(this.tenant,this._context).then((function(o){a._getExpandedStructure(o,t,e,i,s)}))},getLockIcon:function(t,e){var i,s,o=void 0,a=t,n=e;if("TRUE"==a?a=!0:"FALSE"!=a&&""!==a||(a=!1),void 0===a)o="";else if(!0===a){var r=(i=v(),s="",void 0!==i&&(s=i.login),s),l=function(){var t=v(),e="";return void 0!==t&&(e=t.firstName+" "+t.lastName),e}(),c=!0;null!=n&&n.trim().length>0&&((c=n.toUpperCase().trim()===r.toUpperCase().trim()||!1)||(c=n.toUpperCase().trim()===l.toUpperCase().trim()||!1)),o=c?"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-key lc_dgv_lock":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock lc_dgv_lock_other"}else!1===a&&(o="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock-open lc_dgv_unlock");return o},_getExpandedStructure:function(t,e,i,s,o){var n={command:"duplicate",ids:[e],authoring:"true",select_bo:[],select_rel:[]},l=a.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/expand/federated",null),c=this;r.authenticatedRequest(l,{method:"POST",headers:a.getHeaders(encodeURIComponent(t)),timeout:g,data:JSON.stringify(n),type:"json",onComplete:function(e){console.log("expandStructure: "+e);var i=m.parse(e,{returnIdCounters:!0}),a=c._parseLCExpandStructure(i,t);a&&Array.isArray(a)&&a.length>0?c._getMaturityGraph({data:a,wholeStructure:!0},s,o,t,!1):this.onFailure(e)},onFailure:function(t){console.error("expandStructure: onFailure -> "+t);var e={errorMsg:"Expand failed",type:"error"};c.dispatchEvent("onError",e)},onTimeout:function(){var t={};t.errorMsg=h.connectionTimeout,t.type="warning",c.dispatchEvent("onError",t)}})},_parseLCExpandStructure:function(t,e){var i=null;if(null!=t&&t.hasOwnProperty("nodes")){var s=t.nodes;if(null!=(i=(new c).getSelection(e,s))&&Array.isArray(i)&&i.length>0)for(var o=0;o<i.length;o++){var a=this.model.getAttributes(i[o].physicalid);if(null!=a){i[o]=a;break}}}return i},_getMaturityGraph:function(t,e,i,s,n){var l,c=this;this.selectionSize="",null!=t&&(t instanceof Array?this.selectionSize=t.length:t.hasOwnProperty("data")&&t.data instanceof Array&&(this.selectionSize=t.data.length));var p=a.getHeaders(encodeURIComponent(s));if(p["X-Requested-With"]="XMLHttpRequest",void 0!==this.model.serviceurl&&this.model.serviceurl){var m=this.model.serviceurl+"getStateGraph";l=m+(m.indexOf("?")<0?"?":"&")+"tenant="+c.tenant,void 0!==this.multiservicSecurityContext&&this.multiservicSecurityContext&&(p.SecurityContext=this.multiservicSecurityContext)}else l=a.get3DSpaceWSUrl(c.tenant,"/resources/lifecycle/maturity/getStateGraph",null);var f=function(t){"function"==typeof e&&e(t)},y=function(t){"function"==typeof i&&i(t)};this.selectionSize>0?(d.enrichRequestWithMetricsWebInWin(t,c.collabTrackerBackEndOptions),c._perfTimer.start("Maturity: getStateGraph"),r.authenticatedRequest(l,{method:"POST",type:"json",headers:p,timeout:g,data:JSON.stringify(t),onComplete:function(t){c._perfTimer.stop("Maturity: getStateGraph"),console.log("MaturityInfos: COMPLETED"),console.log(t);var e=t.status,i=e.code;e.hasOwnProperty("errorMsg")?null!==e.errorMsg?(y(e.errorMsg),c._perfTimer.stop("CommandUIDurationMaturity")):0===i&&(c.selectedItems.data=t.data.objects,c.model.setMaturityGraph(t),n?c.dispatchEvent("onGraphInfoChanged"):(f(t),c._perfTimer.stop("CommandUIDurationMaturity"))):(c.model.clear(),y(h.maturityGraphFailed),c._perfTimer.stop("CommandUIDurationMaturity"))},onFailure:function(t,e){c._perfTimer.stop("Maturity: getStateGraph"),console.log("attributes:Failure..."+t);var i=t;if(t instanceof Error&&(i=t.message),i.endsWith('return ResponseCode with value "504".')){var s=u.replace(u.getStateGraphSelection,{numberOfSelectedItems:c.selectionSize})+"."+u.getStateGraphSelectionTimeout,a={};a.errorMsg=s,a.type="warning",a.sticky=!0,c.dispatchEvent("onError",a)}else y(o.parseWebServiceError(t,e));c._perfTimer.stop("CommandUIDurationMaturity")},onTimeout:function(){c._perfTimer.stop("Maturity: getStateGraph");var t={};t.errorMsg=u.maturityTimeoutInfo,t.type="info",t.sticky=!0,c.dispatchEvent("onError",t),c._perfTimer.stop("CommandUIDurationMaturity")}})):f()},checkLaunchOfReportingPanel:function(t){for(var e=!1,i=0;i<t.length;i++)if("Failed"==t[i][2]){e=!0;break}return e},_generateReportingData:function(t,e,i){var s=[];if(s.push(t.physicalid),"Failed"===e?s.push(h.get("MATURITY_FAIL_STATUS")):"Success"===e&&s.push(h.get("MaturitySuccess")),s.push(e),null!=t.displayName||null!=t.displayName?s.push(t.displayName):s.push(t.name),s.push(t.typeDisplayName),s.push(t.revision),t.hasOwnProperty("currentStateUserName")&&null!=t.currentStateUserName&&null!=t.currentStateUserName&&t.currentStateUserName.trim().length>0&&s.push(t.currentStateUserName),t.hasOwnProperty("locked")&&t.hasOwnProperty("lockedBy")){var o=this.getLockIcon(t.locked,t.lockedBy);s.push(o)}else if(t.hasOwnProperty("reserved")&&t.hasOwnProperty("reservedby")){o=this.getLockIcon(t.reserved,t.reservedby);s.push(o)}return null==t.organizationTitle||"null"==t.organizationTitle||null==t.organizationTitle||""==t.organizationTitle?s.push(t.organization):s.push(t.organizationTitle),null==t.projectTitle||null==t.projectTitle||""==t.projectTitle?s.push(t.project):s.push(t.projectTitle),s.push(i),s.push(h.deleteSelected),"Failed"===e?s.push(h.get("deleteFailedShort")):"Success"===e&&s.push(h.get("MaturitySuccess")),s},_changeMaturity:function(t,e,i){var s=this;this.data=e;var n,l="null",c=a.getHeaders(encodeURIComponent(i));if(c["X-Requested-With"]="XMLHttpRequest",void 0!==this.model.serviceurl&&this.model.serviceurl){var m=this.model.serviceurl+t;n=m+(m.indexOf("?")<0?"?":"&")+"tenant="+s.tenant,void 0!==this.multiservicSecurityContext&&this.multiservicSecurityContext&&(c.SecurityContext=this.multiservicSecurityContext)}else n=a.get3DSpaceWSUrl(s.tenant,"/resources/lifecycle/maturity/"+t,null);var f=s.model.getChangeActionId();return f&&f.trim().length>0&&(c["DS-Change-Authoring-Context"]="pid:"+f),d.enrichRequestWithMetricsWebInWin(e,s.collabTrackerBackEndOptions),e.notificationTimeout=3600,console.log(t+":"),console.log(e),s.dataToSend=e,s._perfTimer.start("Maturity: "+t),r.authenticatedRequest(n,{method:"POST",type:"json",headers:c,timeout:g,data:JSON.stringify(e),onComplete:function(e){s._perfTimer.stop("Maturity: "+t),console.log(t+": COMPLETED"),console.log(e),l=e,e.data=[];for(var i=e.results,o={data:[]},a=0;a<i.length;a++){var n=s.model.getAttribute(i[a].physicalid,"current");void 0===n&&(n=i[a].current);var r=i[a].current,c=null;i[a].hasOwnProperty("cestamp")&&(c=i[a].cestamp);var d=null;i[a].hasOwnProperty("modified")&&(d=i[a].modified),s.model.setAttribute(i[a].physicalid,"current",i[a].current),s.model.setAttribute(i[a].physicalid,"cestamp",c),s.model.setAttribute(i[a].physicalid,"modified",d);var u={physicalid:i[a].physicalid,tostate:r,fromstate:n};o.data.push(u),e.data.push(u)}if(s.model.isWebInWin)s.dispatchEvent("onStateChanged",e);else{if(s.includeStructureFlag){if("success"==e.status)return o.dontshowsuccess=!1,void s.dispatchEvent("onStateChanged",o);if("failure"==e.status){o.dontshowsuccess=!0;for(a=0;a<s.selectedItems.data.length;a++)if(s.selectedItems.data[a].physicalid===s.initialSelections.data[0].physicalid&&e.report[0].hasOwnProperty("error")){var m=e.report[0].error;m.contains("\n")&&(m=m.replaceAll("\n"," ")).contains("1500168")&&(m=m.replaceAll("1500168",""));var f=s._generateReportingData(s.selectedItems.data[a],"Failed",m);return s.dataForReportingPanel.push(f),p.launchReportingPanel(s.dataForReportingPanel,s.cols,null),void s.dispatchEvent("onStateChanged",o)}}}var g={},y=!1;if(s.counterforPromoteDemote=s.counterforPromoteDemote+1,"failure"===e.status){var v=e.report,S=v.length,b=[],C="";1==S&&((C=v[0].error).contains("1500168")||C.contains("all requirements not satisfied"))&&(C=h.get("MATURITY_FAIL_PERMISSION"));var I=[],_=[],A=!1,w="";for(a=0;a<s.selectedItems.data.length;a++)for(var x=0;x<v.length;x++){var P=1==s.selectedItems.data[a].isOnceInstantiable&&"3DShape"==s.selectedItems.data[a].type;s.selectedItems.data[a].physicalid===v[x].physicalids[0]&&0==P&&(w=null!=s.selectedItems.data[a].displayName?s.selectedItems.data[a].displayName:s.selectedItems.data[a].name)}for(a=0;a<s.selectedItems.data.length;a++){A=!1;for(x=0;x<v.length;x++){I=[];P=1==s.selectedItems.data[a].isOnceInstantiable&&"3DShape"==s.selectedItems.data[a].type;if(s.selectedItems.data[a].physicalid===v[x].physicalids[0]&&0==P){((C=v[x].error).contains("1500168")||C.contains("all requirements not satisfied"))&&(C=h.get("MATURITY_FAIL_PERMISSION")),I=s._generateReportingData(s.selectedItems.data[a],"Failed",C),w=null!=s.selectedItems.data[a].displayName?s.selectedItems.data[a].displayName:s.selectedItems.data[a].name,_.push(I),s.dataForReportingPanel.push(I),console.log("1:  "+I),A=!0;for(var T=0;T<s.dataToSend.data.length;T++)s.dataToSend.data[T].physicalid===v[x].physicalids[0]&&s.dataToSend.data.splice(T,1)}for(var D=0;D<s.dataForReportingPanel.length;D++)s.dataForReportingPanel[D]&&s.dataForReportingPanel[D][0]===v[x].physicalids[0]&&"Success"===s.dataForReportingPanel[D][1]&&s.dataForReportingPanel.splice(D,1)}if(0==A)for(var E=0;E<o.data.length;E++){I=[];P=1==s.selectedItems.data[a].isOnceInstantiable&&"3DShape"==s.selectedItems.data[a].type;if(s.selectedItems.data[a].physicalid===o.data[E].physicalid&&0==P){I=o.data[E].fromstate==o.data[E].tostate&&o.data[E].fromstate==s.selectedItems.data[a].current?""==w&&""!=C?s._generateReportingData(s.selectedItems.data[a],"Failed",h.get("MaturityFailedDependencyDoc")):s._generateReportingData(s.selectedItems.data[a],"Failed",h.get("MaturityFailedDependency{0}").format(w)):s._generateReportingData(s.selectedItems.data[a],"Success",h.get("MaturitySuccess")),_.push(I),s.dataForReportingPanel.push(I),console.log("31:  "+I),A=!0;for(T=0;T<s.dataToSend.data.length;T++)s.dataToSend.data[T].physicalid===o.data[E].physicalid&&s.dataToSend.data.splice(T,1)}}if(0==A){for(x=0;x<s.dataToSend.data.length;x++){I=[];P=1==s.selectedItems.data[a].isOnceInstantiable&&"3DShape"==s.selectedItems.data[a].type;if(s.selectedItems.data[a].physicalid===s.dataToSend.data[x].physicalid&&0==P){I=""==w&&""!=C?s._generateReportingData(s.selectedItems.data[a],"Failed",h.get("MATURITY_FAIL_PERMISSION")):s._generateReportingData(s.selectedItems.data[a],"Failed",h.get("MaturityFailedDependency{0}").format(w)),_.push(I);for(T=0;T<s.dataForReportingPanel.length;T++)if(s.dataForReportingPanel[T][0]===I[0]){s.dataForReportingPanel.splice(T,1);break}s.dataForReportingPanel.push(I),console.log("11:  "+I),A=!0}}if(0==A)if(2==s.counterforPromoteDemote&&s.isPromoteDeomoteBothServiceUsed||0==s.isPromoteDeomoteBothServiceUsed)if(0==(P=1==s.selectedItems.data[a].isOnceInstantiable&&"3DShape"==s.selectedItems.data[a].type)){var M=!0;if(0==s.isPromoteDeomoteBothServiceUsed)M=!0;else if(2==s.counterforPromoteDemote&&s.isPromoteDeomoteBothServiceUsed){var O=!1;for(x=0;x<s.dataForReportingPanel.length;x++)if(s.dataForReportingPanel[x][0]===s.selectedItems.data[a].physicalid){O=!0;break}M=0==O}M&&(I=""==w&&""!=C?s._generateReportingData(s.selectedItems.data[a],"Failed",h.get("MATURITY_FAIL_PERMISSION")):s._generateReportingData(s.selectedItems.data[a],"Failed",h.get("MaturityFailed")),s.dataForReportingPanel.push(I),_.push(I),console.log("2:  "+I))}}}o.dontshowsuccess=!1,s.selectedItems.data[0].hasOwnProperty("isODT")||(s.cols.length>9&&(s.cols=[{text:"ID",dataIndex:"ID",isHidden:!0},{text:"StatusToolTipColumn",dataIndex:"statusTooltip",isHidden:!0,tooltipColumn:"Status"},{text:s.statusNls,dataIndex:"Status",typeRepresentation:"icon"},{text:s.titleNls,dataIndex:s.titleNls},{text:s.typeNls,dataIndex:s.typeNls},{text:s.revisionNls,dataIndex:s.revisionNls},{text:s.maturityNls,dataIndex:s.maturityNls},{text:s.maturityLockNls,dataIndex:"Reserved",typeRepresentation:"icon",width:50,resizableFlag:!1},{text:s.orgNls,dataIndex:s.orgNls},{text:s.collabNls,dataIndex:s.collabNls},{text:s.completionNls,dataIndex:s.completionNls},{text:h.deleteObjects,dataIndex:"Selected",isHidden:!0,isFilter:!0,filterOptions:[{value:h.deleteSelected,default:"on",tooltip:h.deleteSelectedToolTip},{value:h.deleteAdded,default:"off",tooltip:h.deleteAddedToolTip}]},{text:h.deleteResults,dataIndex:"Results",isHidden:!0,isFilter:!0,filterOptions:[{value:h.deleteSuccessfulShort,default:"on",tooltip:h.deleteSuccessfulShort},{value:h.deleteFailedShort,default:"on",tooltip:h.deleteFailedShort}]}]),s.isPromoteDeomoteBothServiceUsed?2==s.counterforPromoteDemote&&(s.checkLaunchOfReportingPanel(s.dataForReportingPanel)&&(o.dontshowsuccess=!0),p.launchReportingPanel(s.dataForReportingPanel,s.cols,null),s.dataForReportingPanel=[]):"promote"===t&&!1===s.isPromoteDeomoteBothServiceUsed?s.checkLaunchOfReportingPanel(s.dataForReportingPanel)&&(o.dontshowsuccess=!0,p.launchReportingPanel(s.dataForReportingPanel,s.cols,null),s.dataForReportingPanel=[]):"demote"===t&&!1===s.isPromoteDeomoteBothServiceUsed&&s.checkLaunchOfReportingPanel(s.dataForReportingPanel)&&(o.dontshowsuccess=!0,p.launchReportingPanel(s.dataForReportingPanel,s.cols,null),s.dataForReportingPanel=[]));for(a=0;a<S&&a<10;a++)s.model.objects[v[a].physicalids]&&s.model.objects[v[a].physicalids].displayName&&!v[a].error.contains(s.model.objects[v[a].physicalids].displayName)?b.push(s.model.objects[v[a].physicalids].displayName+": "+v[a].error+" "+h.maturityFailure):b.push(v[a].error+"\n\n"+h.maturityFailure);S>10&&b.push(h.replace(h.maturityAdditionalErrorMessage,{maxErrors:10..toString(),lineBreak:"\n",numErrors:(S-10).toString()})+"\n\n"+h.maturityFailure),g.errorMsg=b,g.type="error",g.dontshowsuccess=!0,s.dispatchEvent("onError",g),o.data.length>0&&s.dispatchEvent("onStateChanged",o)}else if(o.data.length>0){for(I=[],_=[],A=!1,a=0;a<s.selectedItems.data.length;a++){if(A=!1,s.selectedItems.data[a]&&s.selectedItems.data[a].hasOwnProperty("routes")&&s.selectedItems.data[a].routes&&Array.isArray(s.selectedItems.data[a].routes)&&s.selectedItems.data[a].routes.length>0){var k="",W="",U="";s.selectedItems.data[a].routes[0].hasOwnProperty("routestatuses")&&s.selectedItems.data[a].routes[0].routestatuses.length>0?(k=s.selectedItems.data[a].routes[0].routestatuses[0].status,W=s.selectedItems.data[a].routes[0].routestatuses[0].message,U=s.selectedItems.data[a].routes[0].toState):(k=s.selectedItems.data[a].routes[0].status,W=s.selectedItems.data[a].routes[0].message,U=s.selectedItems.data[a].routes[0].toState),"RouteCreated"===k&&s.selectedItems.data[a].routes[0].fromState===s.selectedItems.data[a].current?(g.errorMsg=W,g.type="info",g.dontshowsuccess=!0,i[a]&&i[a].hasOwnProperty("routes")&&i[a].routes&&Array.isArray(i[a].routes)&&i[a].routes.length>0&&(s.model.setAttribute(i[a].physicalid,"routes_before",s.selectedItems.data[a].routes),s.model.setAttribute(i[a].physicalid,"routes",i[a].routes),s.model.maturityGraphs[i[a].policy].states[i[a].fromstate].connectors_out[i[a].tostate]=i[a].routes[0]),1==s.selectedItems.data.length&&(s.dispatchEvent("onBlockingRoute",g),y=!0),o.dontshowsuccess=!0):("Block"===k&&i[a]&&i[a].tostate===U||"BlockedByRequiredRouteRule"===k&&i[a]&&i[a].tostate===U)&&(g.errorMsg=W,g.type="error",g.dontshowsuccess=!0,o.dontshowsuccess=!0)}for(x=0;x<o.data.length;x++){I=[];P=1==s.selectedItems.data[a].isOnceInstantiable&&"3DShape"==s.selectedItems.data[a].type;if(s.selectedItems.data[a].physicalid===o.data[x].physicalid&&0==P){A=!0;var N="",j=(W="",""),R="";s.selectedItems.data[a].hasOwnProperty("routes_before")&&Array.isArray(s.selectedItems.data[a].routes_before)&&s.selectedItems.data[a].routes_before.length>0&&s.selectedItems.data[a].routes_before[0].hasOwnProperty("routestatuses")&&s.selectedItems.data[a].routes_before[0].routestatuses.length>0?(j=s.selectedItems.data[a].routes_before[0].routestatuses[0].status,R=s.selectedItems.data[a].routes_before[0].routestatuses[0].message):s.selectedItems.data[a].hasOwnProperty("routes_before")&&Array.isArray(s.selectedItems.data[a].routes_before)&&s.selectedItems.data[a].routes_before.length>0&&(j=s.selectedItems.data[a].routes_before[0].status,R=s.selectedItems.data[a].routes_before[0].message),s.selectedItems.data[a].hasOwnProperty("routes")&&Array.isArray(s.selectedItems.data[a].routes)&&s.selectedItems.data[a].routes.length>0&&s.selectedItems.data[a].routes[0].hasOwnProperty("routestatuses")&&s.selectedItems.data[a].routes[0].routestatuses.length>0?s.selectedItems.data[a].routes[0].toState==o.data[x].tostate&&(N=s.selectedItems.data[a].routes[0].routestatuses[0].status,W=s.selectedItems.data[a].routes[0].routestatuses[0].message):s.selectedItems.data[a].hasOwnProperty("routes")&&Array.isArray(s.selectedItems.data[a].routes)&&s.selectedItems.data[a].routes.length>0&&s.selectedItems.data[a].routes[0].toState==o.data[x].tostate&&(N=s.selectedItems.data[a].routes[0].status,W=s.selectedItems.data[a].routes[0].message),I="Block"===N&&"RouteCreated"===j?s._generateReportingData(s.selectedItems.data[a],"Success",R):"RouteCreated"===N?s._generateReportingData(s.selectedItems.data[a],"Success",W):"Block"===N||"BlockedByRequiredRouteRule"===N?s._generateReportingData(s.selectedItems.data[a],"Failed",W):s._generateReportingData(s.selectedItems.data[a],"Success",h.get("MaturitySuccess")),_.push(I);for(T=0;T<s.dataForReportingPanel.length;T++)if(s.dataForReportingPanel[T][0]===I[0]){s.dataForReportingPanel.splice(T,1);break}s.dataForReportingPanel.push(I),console.log("3:  "+I);for(T=0;T<s.dataToSend.data.length;T++)s.dataToSend.data[T].physicalid===o.data[x].physicalid&&s.dataToSend.data.splice(T,1)}}if(0==A)if(2==s.counterforPromoteDemote&&s.isPromoteDeomoteBothServiceUsed||0==s.isPromoteDeomoteBothServiceUsed)if(0==(P=1==s.selectedItems.data[a].isOnceInstantiable&&"3DShape"==s.selectedItems.data[a].type)){M=!0;if(0==s.isPromoteDeomoteBothServiceUsed)M=!0;else if(2==s.counterforPromoteDemote&&s.isPromoteDeomoteBothServiceUsed){for(O=!1,x=0;x<s.dataForReportingPanel.length;x++)if(s.dataForReportingPanel[x][0]===s.selectedItems.data[a].physicalid){O=!0;break}M=0==O}M&&(I=s._generateReportingData(s.selectedItems.data[a],"Failed",h.get("MaturityFailed")),_.push(I),s.dataForReportingPanel.push(I),console.log("4:  "+I))}}o.dontshowsuccess||(o.dontshowsuccess=!1),s.selectedItems.data[0].hasOwnProperty("isODT")||(s.cols.length>9&&(s.cols=[{text:"ID",dataIndex:"ID",isHidden:!0},{text:"StatusToolTipColumn",dataIndex:"statusTooltip",isHidden:!0,tooltipColumn:"Status"},{text:s.statusNls,dataIndex:"Status",typeRepresentation:"icon"},{text:s.titleNls,dataIndex:s.titleNls},{text:s.typeNls,dataIndex:s.typeNls},{text:s.revisionNls,dataIndex:s.revisionNls},{text:s.maturityNls,dataIndex:s.maturityNls},{text:s.maturityLockNls,dataIndex:"Reserved",typeRepresentation:"icon",width:50,resizableFlag:!1},{text:s.orgNls,dataIndex:s.orgNls},{text:s.collabNls,dataIndex:s.collabNls},{text:s.completionNls,dataIndex:s.completionNls},{text:h.deleteObjects,dataIndex:"Selected",isHidden:!0,isFilter:!0,filterOptions:[{value:h.deleteSelected,default:"on",tooltip:h.deleteSelectedToolTip},{value:h.deleteAdded,default:"off",tooltip:h.deleteAddedToolTip}]},{text:h.deleteResults,dataIndex:"Results",isHidden:!0,isFilter:!0,filterOptions:[{value:h.deleteSuccessfulShort,default:"on",tooltip:h.deleteSuccessfulShort},{value:h.deleteFailedShort,default:"on",tooltip:h.deleteFailedShort}]}]),s.isPromoteDeomoteBothServiceUsed?2==s.counterforPromoteDemote&&s.checkLaunchOfReportingPanel(s.dataForReportingPanel)&&(o.dontshowsuccess=!0,p.launchReportingPanel(s.dataForReportingPanel,s.cols,null),s.dataForReportingPanel=[]):"promote"===t&&!1===s.isPromoteDeomoteBothServiceUsed?s.checkLaunchOfReportingPanel(s.dataForReportingPanel)?(o.dontshowsuccess=!0,p.launchReportingPanel(s.dataForReportingPanel,s.cols,null),s.dataForReportingPanel=[]):o.dontshowsuccess&&(y||s.dispatchEvent("onBlockingRoute",g)):"demote"===t&&!1===s.isPromoteDeomoteBothServiceUsed&&s.checkLaunchOfReportingPanel(s.dataForReportingPanel)&&(o.dontshowsuccess=!0,p.launchReportingPanel(s.dataForReportingPanel,s.cols,null),s.dataForReportingPanel=[])),s.isEmbeddedUI&&1==o.data.length&&1==s.selectedItems.data.length&&s.initGraph(s.selectedItems),s.dispatchEvent("onStateChanged",o)}}},onFailure:function(e,i){s._perfTimer.stop("Maturity: "+t),console.log(t+":Failure..."+e);var a=o._parseWebServiceError(e,i,!0,"Maturity");void 0!==a&&void 0!==a&&a.hasOwnProperty("message")?(a.errorMsg=a.message,a.type="error",a.hasOwnProperty("isNotificationInfo")&&a.isNotificationInfo&&(a.type="info",a.sticky=!0)):a.errorMsg=o.parseWebServiceError(e,i,!0),s.dispatchEvent("onError",a)},onTimeout:function(){s._perfTimer.stop("Maturity: "+t),console.log(t+": A connection timeout occured.");var e={};e.errorMsg=u.maturityTimeoutInfo,e.type="info",e.sticky=!0,s.dispatchEvent("onError",e)}}),l},getGraphInfo:function(){return this.model.getGraphInfo()},getStateInfos:function(t){return this.model.getStateInfos(t)},setTenant:function(t){this.tenant=t}})})),define("DS/MaturityWidget/MaturityWidget",["css!DS/MaturityWidget/MaturityWidget","UWA/Controls/Abstract","UWA/Promise","DS/Controls/Toggle","DS/PlatformAPI/PlatformAPI","DS/MaturityWidget/MaturityController","DS/MaturityWidget/MaturityModel","DS/MaturityWidget/MaturityGraph","DS/MaturityWidget/MultiselUI","DS/MaturityWidget/MaturityTransitionFilters","DS/LifecycleControls/CommandDialog","DS/LifecycleServices/Utils","DS/LifecycleServices/LifecyclePerfTimer","DS/LifecycleCmd/MessageMediator","DS/LifecycleControls/ProgressDialog","DS/LifecycleServices/LifecycleAlert","DS/LifecycleServices/UUIDGenerator","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/ENOCollabToolsUI/tracker/ENOCollabTracker","UWA/Utils/InterCom","DS/UIKIT/Mask","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],(function(t,e,i,s,o,a,n,r,l,c,d,h,u,p,m,f,g,y,v,S,b,C,I){"use strict";var _=!0;return e.extend({displayWorkflowGraph:!0,hostedInDialog:!1,context:null,uuid:null,maskDelay:500,onKeyDownHandler:null,multiSelUITitle:null,sizePrefKey:"maturityDlgSize",isWebInWin:!1,canPromoteOrDemote:!0,numInitSelection:0,isEmbeddedUI:!1,PADSession:null,hasRequestedPADSession:!1,initialSelection:null,isMultipleSelection:!1,sizebeforeadvanced:null,init:function(t){this.uuid=g.create();var e=t||{type:""};this._parent(e),this._perfTimer=u,this._perfTimer.init("Maturity"),this._perfTimer.start("CommandUIDurationMaturity"),this.elements.content=UWA.createElement("div",{class:"lcm-maturity-content"}),this.elements.container=this.elements.content,this.maturityGraphContainer=UWA.createElement("div",{class:"lcm-maturity-container"}),this.maturityGraphContainer.inject(this.elements.content,"top"),void 0!==e.context&&null!=e.context&&(this.context=e.context),void 0!==e.isWebInWin&&null!=e.isWebInWin&&(this.isWebInWin=e.isWebInWin);var i=null;e&&e.hasOwnProperty("externalSettings")&&e.externalSettings&&(i=e.externalSettings),v.app_initialization((function(){}),i),this.controller=new a(this.context),this.controller.multiservicSecurityContext=e.securitycontext;var s={UXName:"Maturity",isWebInWin:!1};e.wintop&&(s.isWebInWin=e.wintop),e.client_app_domain&&(s.client_app_domain=e.client_app_domain),e.client_app_name&&(s.client_app_name=e.client_app_name),this.controller.collabTrackerBackEndOptions=s,this.model=this.controller.model,this.model.isWebInWin=this.isWebInWin,this._setupEventSubscriptions()},_setupEventSubscriptions:function(){var t=this;o.subscribe("Lifecycle.Modification",(function(e){t._externalRefresh(JSON.parse(e))})),this.addEvent("onPostInject",(function(){t.isEmbeddedUI=!0,t.controller.isEmbeddedUI=!0}));var e=this.controller;e.addEvent("onStateChanged",(function(e){document.body.style.cursor="default";var i=[],s=[];for(var o in e.data.forEach((function(e){var o=t.model.getAttribute(e.physicalid,"type"),a=t.model.getAttribute(e.physicalid,"revision"),n=t.model.getAttribute(e.physicalid,"policy"),r=t.model.getAttribute(e.physicalid,"name"),l=t.model.getAttribute(e.physicalid,"coretype"),d=t.model.getAttribute(e.physicalid,"interfaceHash"),h=t.model.getAttribute(e.physicalid,"cestamp"),u=t.model.getAttribute(e.physicalid,"current"),p=t.model.getAttribute(e.physicalid,"modified"),m={physicalid:e.physicalid,tostate:e.tostate,fromstate:e.fromstate,type:o,revision:a,policy:n,name:r,coretype:l,interfaceHash:d},f={physicalid:e.physicalid,cestamp:h,current:u,modified:p};s.push(f);for(var g=c.fetchTypeActionKeys(o,d),y=0;y<g.length;y++){var v=g[y];v in i||(i[v]=[]),i[v].push(m)}})),i){var a=i[o],n=function(){};if(null!==(n=c.fetchActionFilter(o)))n(a,{maturityWidget:t,securityContext:t.controller.securityContext,maturityGraphContainer:t.maturityGraphContainer})}if(t.isWebInWin&&t.options.webInWinHelper&&(e.dontshowsuccess=!0,t.options.webInWinHelper.fireWintopMaturityCompletedCommandWithArgs(t.options.webToWinComSocket,e,t.options.OnCompletedFireCommand),t.options.webInWinHelper.closePanel(t.options.webToWinComSocket)),t.options.wintop&&t.options.webInWinHelper){var r;if(e.dontshowsuccess=!0,t.options.webToWinComSocket)null!=s&&s.length>0&&(r=t.options.webInWinHelper.createMaturityJSONArray(s)),t.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"onDisplayErrorMessage",notif_parameters:{severity:"warning",message:I.maturitySuccess}},"lf_web_in_win"),t.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"onMaturityModification",notif_parameters:r},"lf_web_in_win");t.options.webInWinHelper.closePanel(t.options.webToWinComSocket)}if(e.hasOwnProperty("dontshowsuccess")&&0==e.dontshowsuccess&&this._showNotification("success",I.maturitySuccess),this.maturityGraph&&this.displayWorkflowGraph&&e.hasOwnProperty("data")&&e.data.length>0&&(this.maturityGraph.onEndTransition(e.data[0].tostate),_=!0,this.dialog&&(this.dialog.updateUI(),this.dialog._disableOK(),this.dialog.destroy())),e.hasOwnProperty("data")&&e.data.length>0&&this.newStateInaccessible(e.data)){if(this.context.refresh&&"lifecycle"!=this.context.app)try{this.context.refresh()}catch(t){console.error(t)}var l={created:[],deleted:[],modified:[]};l.context=this,e.data.forEach((function(t){var e={physicalid:t.physicalid,operation:"Promote"};l.deleted.push(e)})),p.dispatchEvent("onModification",l),this._closeDialog(),this.isEmbeddedUI||this._onComplete()}else{if(e.hasOwnProperty("data")&&e.data.length>0&&this._refresh(e.data),e.hasOwnProperty("data")&&e.data.length>0&&this.displayWorkflowGraph){var d;for(d=0;d<e.data.length;d++){var h=this.model.getAttribute(e.data[d].physicalid,"isAggregateRep");if(this.model.getAttribute(e.data[d].physicalid,"policy")&&!h)break}d==e.data.length&&(d=0);var u=this.model.getAttribute(e.data[d].physicalid,"policy"),m=e.data[d].tostate;this._updateGraph(u,m)}this.isEmbeddedUI||(this.dialog&&this.dialog.destroy(),this._onComplete()),t.dispatchEvent("onMaturityTransitionEnd",e)}t._perfTimer.stop("CommandExecutionDurationMaturity");t._perfTimer.printTimeShowDialogAndProcess(["CommandUIDurationMaturity","CommandExecutionDurationMaturity","Maturity: promote","Maturity: demote","Maturity: getStateGraph"],t.controller.securityContext)}),this),e.addEvent("updateMaturityProgressDialog",(function(t){this.progressDialog&&(this.progressDialog.close(),this.progressDialog=null),t&&(this.progressDialog=new m,this.progressDialog.showDelay(document.body,t,0))}),this),e.addEvent("onBlockingRoute",(function(t){document.body.style.cursor="default",this._showNotification("success",t.errorMsg),this.enableCancel=!0,this.multiSelUI||(this.maturityGraph.onEndTransition(),this._refreshGraph())}),this),e.addEvent("onError",(function(e){if(document.body.style.cursor="default",null!=this.maturityGraph&&this.maturityGraph.hasOwnProperty("MainContainer")){var i=this.maturityGraph.MainContainer.getParent();i&&C.unmask(i)}if(t.options.wintop){var s="";if(e&&e.hasOwnProperty("errorMsg"))if(Array.isArray(e.errorMsg))for(const t of e.errorMsg)s+=t;else s=e.errorMsg;var o=I.maturityFailure;s.trim().length>0&&(o=s),t.options.webToWinComSocket&&t.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"onDisplayErrorMessage",notif_parameters:{severity:"warning",message:o}},"lf_web_in_win"),t.options.webInWinHelper.closePanel(t.options.webToWinComSocket)}else{if(null!=e&&e.hasOwnProperty("type"))var a=e.type;e.hasOwnProperty("dontshowsuccess")||this.displayError(e,a)}this._closeDialog(),this.maturityGraph&&(this.maturityGraph.onEndTransition(),_=!0,this.dialog&&(this.dialog.updateUI(),this.dialog._disableOK(),this.dialog.destroy())),this.isEmbeddedUI?this._refreshGraph():this._onComplete(),t._perfTimer.stop("CommandExecutionDurationMaturity");t._perfTimer.printTimeShowDialogAndProcess(["CommandUIDurationMaturity","CommandExecutionDurationMaturity","Maturity: promote","Maturity: demote","Maturity: getStateGraph"],t.controller.securityContext)}),this),e.addEvent("onGraphInfoChanged",(function(){this._postInitGraph(),this._buildGraph(),this._perfTimer.stop("CommandUIDurationMaturity")}),this),this.model=this.controller.model},executeCmd:function(t,e,i){this.addEvent("onReady",(function(t){this._showCommandUI(t.displayWorkflowGraph,t.policy)}),this),this.addEvent("onComplete",(function(){i()})),this.context=e.context,this.controller._context=this.context,this.hostedInDialog=!0,this.setObjects(t),this.isWebInWin?e.context.options&&e.context.options.hasOwnProperty("change")&&this.model.setChangeAction(e.context.options.change):this.options.wintop?e.context.options&&e.context.options.hasOwnProperty("ChangeActionId")&&this.model.setChangeAction({id:e.context.options.ChangeActionId}):e&&e.hasOwnProperty("change")&&this.model.setChangeAction(e.change)},getUUID:function(){return this.uuid},onResize:function(){this.isWebInWin&&this.dialog},setWidgetSize:function(t){this.floatingDlg._maximize(),this.floatingDlg.centerIt(),this.options.wintop?this.floatingDlg.setNewBodySize(t):this.isWebInWin&&this.floatingDlg.setNewSize(t),this.elements.content.setStyle("width",t.width+"px")},_onOk:function(){this.onOkClicked&&this.onOkClicked(this),this._onComplete()},_onComplete:function(){this.dispatchEvent("onComplete"),this.maturityGraph&&this.maturityGraph.destroy(),this.onKeyDownHandler&&(document.onkeydown=this.onKeyDownHandler),this.refreshSub&&(this.refreshSub.unsubscribe(),this.refreshSub=null)},_showCommandUI:function(t,e){var i=this;this.displayWorkflowGraph=t;var s=t,o=this,a=new d,n=!0,r=!0;this.isWebInWin&&(n=!1),this.options.wintop&&(r=!1);var l=a.create(this.elements.content,{title:I.maturity,className:"ENO_Maturity",closeButton:n,maximizable:!1,resizable:r,buttonStyle:s?a.buttonStyle.cancel:a.buttonStyle.okCancel,enableCmd:function(){return this.canPromoteOrDemote},onOk:function(){i._perfTimer.start("CommandExecutionDurationMaturity"),o._saveDlgSize(),a._disableUI(),o._onOk()},onClose:function(){o._saveDlgSize(),o._onComplete(),o._closeDialog(),i.isWebInWin||i.options.wintop?i.options.webInWinHelper&&i.options.webInWinHelper.closePanel(i.options.webToWinComSocket):i.dispatchEvent("onMaturityCanceled")},onCloseOverride:function(){1==_&&(a._disableUI(),a._onCloseHandler.apply(this._fnContext),a.destroy())},events:{onResizeFloating:function(t){void 0!==o.multiSelUI&&null!==o.multiSelUI&&o.multiSelUI.onPanelResize()}}},this);if(l.inject(widget.body),this.isWebInWin||this.options.wintop)l._maximize();else{var c=this._loadSize(),h=c.width,u=c.height;h<650&&(h=650),u<305&&(u=305);var p=this.displayWorkflowGraph?500:600,m=this.displayWorkflowGraph?250:400;l.setNewSize({width:h,height:u})}setTimeout((function(){if(i.isWebInWin||i.options.wintop){i.floatingDlg._maximize(),i.floatingDlg.centerIt(),i.floatingDlg.setMinSize({width:"100%",height:"100%"});var t=i.floatingDlg.getModalBodySize();t.height=t.maxHeight,t.width=t.maxWidth,i.floatingDlg.setNewBodySize(t),i.elements.content.setStyle("width",t.width+"px")}else l.setMinSize(p,m)}),10),this.dialog=a,this.floatingDlg=l,t?(this._createSingleObjectGraphUI(this.model.getMaturityGraph(e)),a.setTitle(this._getCurrentObjectTitleRevision()),this.dialog._cancelButton&&this.dialog._disableOK()):(this.maturityGraphContainer.addClassName("lcm-maturity-container-multisel"),this._createMultiSelectionUI(this.maturityGraphContainer)),this.isWebInWin&&this.options.webInWinHelper?this.options.webInWinHelper.fireWintopCommand(i.options.webToWinComSocket,null,i.options.OnViewReadyFireCommand):i.dispatchEvent("onMaturityUIReady")},_getCurrentObjectTitleRevision:function(){var t=I.maturity,e=this.model.getObjects();if(null!=e){Object.keys(e);var i=e[this.model.originalPid];null!=i&&i.hasOwnProperty("externalMaturityTitle")&&void 0!==i.externalMaturityTitle&&null!==i.externalMaturityTitle?(t=this.isWebInWin?i.externalMaturityTitle:t+" - "+i.externalMaturityTitle,i.hasOwnProperty("revision")&&null!=i.revision&&(t=t+" "+i.revision)):null!=i&&i.hasOwnProperty("name")&&(t=this.isWebInWin?i.name:t+" - "+i.name,i.hasOwnProperty("revision")&&null!=i.revision&&(t=t+" "+i.revision))}return t},_saveDlgSize:function(){if(this.floatingDlg){var t=this.floatingDlg.getModalBodySize();t.height=this.floatingDlg.getContainerHeight(),t.hasOwnProperty("width")&&t.width>0&&(t.width=t.width+2),this._storeSize(t)}},_loadSize:function(){var t=widget.getValue(this.sizePrefKey);return t?JSON.parse(t):{width:820,height:260}},_storeSize:function(t){widget.getValue(this.sizePrefKey)||widget.addPreference({name:this.sizePrefKey,type:"hidden",defaultValue:"{}"}),widget.setValue(this.sizePrefKey,JSON.stringify(t))},_externalRefresh:function(t){if(this.displayWorkflowGraph&&UWA.is(t.Refresh,"object")&&UWA.is(t.Refresh.modified,"array")&&this.getUUID()!==t.OriginID&&1==t.Refresh.modified.length){var e=t.Refresh.modified[0];if("Promote"===e.operation){var i=this.model.getObjects()[e.physicalid];null!=i&&i.current!==e.state&&(this.model.changeCurrentObjectState(e.physicalid,e.state),this.isEmbeddedUI?this.controller._getMaturityGraph({data:[{physicalid:e.physicalid}]},null,null,this.controller.securityContext,!1):this._updateGraph(e.policy,e.state))}}},_refresh:function(t){var e=this.model,i={created:[],deleted:[],modified:[]};i.context=this,t.forEach((function(t){var s={physicalid:t.physicalid,operation:"Promote",state:t.tostate,policy:e.getAttribute(t.physicalid,"policy")};i.modified.push(s)})),p.dispatchEvent("onModification",i)},_closeDialog:function(){this.progressDialog&&(this.progressDialog.close(),this.progressDialog=null),this.dialog&&this.dialog.destroy()},newStateInaccessible:function(t){return null===t[0].tostate||void 0===t[0].tostate},setTitle:function(t){this.dialog&&this.dialog.setTitle(t)},_postInitGraph:function(){this.progressDialog&&(this.progressDialog.close(),this.progressDialog=null);this.model.getObjects()},_addIncludeChildrenCheckbox:function(){var t=this;if(null==this.includeChildrenCheckbox){this.optionDlg=document.createElement("div"),this.optionDlg.className="lifecycle-options",this.elements.content.appendChild(this.optionDlg);var e=I.includeDescendants;this.includeChildrenCheckbox=new s({type:"checkbox",label:e}).inject(this.optionDlg)}this.includeChildrenCheckbox.addEventListener("change",(function(e){if(e&&e.hasOwnProperty("dsModel")){var i=e.dsModel.checkFlag;t.isWebInWin&&t.options.webInWinHelper?i?t.options.webInWinHelper.fireWintopCommand(t.options.webToWinComSocket,null,t.options.OnIncludeChildrenFireCommand):t.options.webInWinHelper.fireWintopCommand(t.options.webToWinComSocket,null,t.options.OnExcludeChildrenFireCommand):t.dispatchEvent("onIncludeChildrenChanged",{includeChildren:i})}else if(e){i=e.detail.dsModel.checkFlag;t.dispatchEvent("onIncludeChildrenChanged",{includeChildren:i})}})),this.model.isSingleIRPCAssembly?this.includeChildrenCheckbox.show():null!=this.includeChildrenCheckbox&&this.includeChildrenCheckbox.hide()},getPADSessionPromise:function(){var t=this;return new UWA.Class.Promise((function(e,i){require(["DS/PADUtils/PADSession"],(function(i){t.hasRequestedPADSession=!0,t.PADSession=i,e(t.PADSession)}),(function(i){t.hasRequestedPADSession=!0,t.PADSession=null,e(t.PADSession)}))}))},_getPADSession:function(){return this.hasRequestedPADSession?UWA.Class.Promise.resolve(this.PADSession):this.getPADSessionPromise()},empty:function(){this.maturityGraph&&this.maturityGraph.destroy(),this.model.clear()},_showNotification:function(t,e,i){var s=this;Array.isArray(e)||"string"!=typeof e||(e=[e]),Array.isArray(e)&&e.length&&e.forEach((function(e){var o={eventID:t,msg:e.split?e.split("\n").join("<br>"):e,sticky:i};null!=s.context&&"function"==typeof s.context.displayNotification?s.context.displayNotification(o):f.displayNotification(o)}))},displayError:function(t,e){var i=t;t.hasOwnProperty("errorMsg")&&(i=null!==t.errorMsg?t.errorMsg:t),void 0===e&&t.hasOwnProperty("type")?e=t.type:void 0===e&&(e="warning");var s=!1;null!=t&&t.hasOwnProperty("sticky")&&(s=t.sticky),this._showNotification(e,i,s)},_getFilteredObjects:function(){return this.model.getObjects((function(t){return!t.isOnceInstantiable}))},_isObjectsAlreadyLoaded:function(t){var e=!1,i=h.toMaturityArray(this._getFilteredObjects());return 0!==i.length&&(i=i[0],null!=t&&0!==t.length&&(Array.isArray(t)&&t.forEach((function(t){t.hasOwnProperty("physicalid")&&i.hasOwnProperty("physicalid")&&t.hasOwnProperty("current")&&i.hasOwnProperty("current")&&t.physicalid==i.physicalid&&t.current==i.current&&(e=!0)})),e))},setObject:function(t){return this.setObjects([t])},setObjects:function(t){if(this._isObjectsAlreadyLoaded(t))return!1;if(this.numInitSelection=t.length,this.initialSelection=t,this.isEmbeddedUI&&this.empty(),0===t.length)throw I.noObject;var e={};e.data=t;var i=t[0];if(""===i.physicalid)throw I.epmtyPhysicalId;if(this.isWebInWin)this.controller.setTenant(this.options.tenant);else if(null!=i&&i.hasOwnProperty("tenant")&&void 0!==i.tenant&&null!==i.tenant&&i.tenant.trim().length>0)this.controller.setTenant(i.tenant);else if(this.options&&this.options.hasOwnProperty("externalSettings")&&void 0!==this.options.externalSettings&&null!==this.options.externalSettings&&Array.isArray(this.options.externalSettings)&&this.options.externalSettings.length>0){var s=this.options.externalSettings[0];s&&s.hasOwnProperty("platformId")&&this.controller.setTenant(this.options.externalSettings[0].platformId)}this.model.setObjects(t),this.progressDialog&&(this.progressDialog.close(),this.progressDialog=null),this.progressDialog=new m,this.progressDialog.showDelay(document.body,I.maturityGraphInit,this.maskDelay);var o=this;return this.controller.initGraph(e,(function(t){o._postInitGraph(),o.displayError(t),o._onComplete()})),o.trackAppContent(t),!0},_createPromotePayload:function(t,e){var i=[];for(var s in e)i.push({physicalid:s,tostate:t,fromstate:e[s].current,type:e[s].type,revision:e[s].revision,policy:e[s].policy,name:e[s].name,coretype:e[s].coretype,interfaceHash:e[s].interfaceHash});var o={};return o.data=i,o},_createGraphStates:function(t,e){var s=this,o=this._getFilteredObjects(),a=UWA.clone(t.states),n=o[this.model.originalPid].current,r=h.toArray(a[n].connectors_in);r.contains=function(t){return this.find((function(e){return e===t}))};var l=function(t,e){for(var i=t.data[0].physicalid,s=t.data[0].fromstate,o=t.data[0].tostate,a=!1,n={data:[]},r=0;r<t.data.length;r++)e.hasOwnProperty(t.data[r].physicalid)&&n.data.push(t.data[r]);if(this.model.objects[i].hasOwnProperty("routes")&&Array.isArray(this.model.objects[i].routes)&&this.model.objects[i].routes.length>0)for(let t=0;t<this.model.objects[i].routes.length;t++)if(s===this.model.objects[i].routes[t].fromState&&o===this.model.objects[i].routes[t].toState){var l="",c="",d="";if(this.model.objects[i].routes[t].hasOwnProperty("routestatuses")&&Array.isArray(this.model.objects[i].routes[t].routestatuses)&&this.model.objects[i].routes[t].routestatuses.length>0?(l=this.model.objects[i].routes[t].routestatuses[0].status,c=this.model.objects[i].routes[t].routestatuses[0].message,d=this.model.objects[i].routes[t].routestatuses[0].routeId):(l=this.model.objects[i].routes[t].status,c=this.model.objects[i].routes[t].message,d=this.model.objects[i].routes[t].routeId),"Block"===l){a=!0;var h=[];h.push({envId:this.controller.tenant,serviceId:"3DSpace",contextId:this.context.securitycontext,objectId:d,objectType:"Route",path:[{resourceid:d,type:"Route"}]});var u={items:h},p={protocol:"3DXContent",version:"2.0",source:"ENOLCMI_AP",widgetId:widget.id,data:u},m=new b.Socket("compassPageSocket");m.subscribeServer("com.ds.compass",window.parent),m.dispatchEvent("onSetX3DContent",p,"compassPageSocket");m.dispatchEvent("onLaunchApp",{appId:"ENXROUT_AP"},"compassPageSocket")}else if("BlockedByRequiredRouteRule"===l){a=!0;var f=c;this.displayError(f,"error"),this.dialog&&(this.dialog.updateUI(),this.dialog._disableOK(),this.dialog.destroy())}}n.data[0].fromstate;if(a){if(this._closeDialog(),this.isEmbeddedUI){var g=this.maturityGraph.MainContainer.getParent();g&&C.unmask(g)}}else this._promote(n)},c=function(t){return new i((function(e,i){s._filter(t).then((function(t){e(t)}))}))},d=function(t){var e=!1,i=t.data[0].fromstate,s=t.data[0].tostate,o=t.data[0].physicalid;if(Array.isArray(this.model.objects[o].routes)&&this.model.objects[o].routes.length>0&&i===this.model.objects[o].routes[0].fromState&&s===this.model.objects[o].routes[0].toState){var a="",n="",r="";if(this.model.objects[o].routes[0].hasOwnProperty("routestatuses")&&Array.isArray(this.model.objects[o].routes[0].routestatuses)?(a=this.model.objects[o].routes[0].routestatuses[0].status,n=this.model.objects[o].routes[0].routestatuses[0].routeId,r=this.model.objects[o].routes[0].routestatuses[0].message):(a=this.model.objects[o].routes[0].status,n=this.model.objects[o].routes[0].routeId,r=this.model.objects[o].routes[0].message),"Block"===a){e=!0;var l=[];l.push({envId:this.controller.tenant,serviceId:"3DSpace",contextId:this.context.securitycontext,objectId:n,objectType:"Route",path:[{resourceid:n,type:"Route"}]});var c={items:l},d={protocol:"3DXContent",version:"2.0",source:"ENOLCMI_AP",widgetId:widget.id,data:c},h=new b.Socket("compassPageSocket");h.subscribeServer("com.ds.compass",window.parent),h.dispatchEvent("onSetX3DContent",d,"compassPageSocket");h.dispatchEvent("onLaunchApp",{appId:"ENXROUT_AP"},"compassPageSocket")}else if("BlockedByRequiredRouteRule"===a){e=!0;var u=r;this.displayError(u,"error"),this.dialog&&(this.dialog.updateUI(),this.dialog._disableOK(),this.dialog.destroy())}}if(e){var p=this.maturityGraph.MainContainer.getParent();p&&C.unmask(p)}else this._perfTimer.start("CommandExecutionDurationMaturity"),this._promote(t)},u=function(t){var e=!1,i=t.data[0].fromstate,s=t.data[0].tostate,o=t.data[0].physicalid;if(Array.isArray(this.model.objects[o].routes)&&this.model.objects[o].routes.length>0&&i===this.model.objects[o].routes[0].fromState&&s===this.model.objects[o].routes[0].toState){var a="",n="";if(this.model.objects[o].routes[0].hasOwnProperty("routestatuses")&&Array.isArray(this.model.objects[o].routes[0].routestatuses)?(a=this.model.objects[o].routes[0].routestatuses[0].status,this.model.objects[o].routes[0].routestatuses[0].routeId,n=this.model.objects[o].routes[0].routestatuses[0].message):(a=this.model.objects[o].routes[0].status,this.model.objects[o].routes[0].routeId,n=this.model.objects[o].routes[0].message),"Block"===a){e=!0;var r=n;this.displayError(r,"error"),this.dialog&&(this.dialog.updateUI(),this.dialog._disableOK(),this.dialog.destroy())}else if("BlockedByRequiredRouteRule"===a){e=!0;r=n;this.displayError(r,"error"),this.dialog&&(this.dialog.updateUI(),this.dialog._disableOK(),this.dialog.destroy())}}e||(this._perfTimer.start("CommandExecutionDurationMaturity"),this._demote(t))};for(var p in a){var m=!1,f=!1,g=!1,y=this._createPromotePayload(p,o);a[p].filter=c.bind(this,y),t.infos.isDemoteAuthorized&&r.contains(p)?(a[p].action=u.bind(this,y),m=!0):t.infos.isDemoteAuthorized?(a[p].action=d.bind(this,y),f=!0):t.infos.isPromoteAuthorized&&(a[p].action=l.bind(this,y),g=!0),a[p].isDemote=m,a[p].isPromote=f,a[p].isDisabled=!(f||m||g),a[p].info.isCurrent=p===n}if(e)for(var v in a)a[v].info.isCurrent=v===e;return a},_buildGraph:function(){var t=[],e=[],i=this.model.getObjects(),s=!0,o=0,a=null;for(var n in i){void 0!==i[n].isAggregateRep&&0!=i[n].isAggregateRep||o++,"Reference"!==i[n].coretype&&(a=!0);var r=i[n].policy;-1===t.indexOf(r)&&t.push(r);var l=i[n].current;-1===e.indexOf(l)&&e.push(l)}var c=I.multipleSelection;if(!0===a){var d=null;for(var h in t)null==d&&(d=this.model.getPolicy(t[h]).maturityGraph.states.length),d!=this.model.getPolicy(r).maturityGraph.states.length&&(s=!1,c=I.multipleSelectionNotSimilar)}o>this.numInitSelection&&!this.isEmbeddedUI&&this._showNotification("info",I.maturityAddedAggReps);var u=i[this.initialSelection[0].physicalid].policy,p={displayWorkflowGraph:!0,policy:u};if(1===o||this.isEmbeddedUI&&o>0)this.hostedInDialog?this.dispatchEvent("onReady",p):this._createSingleObjectGraphUI(this.model.getMaturityGraph(u));else if(!0===s&&o>=1)p.displayWorkflowGraph=!1,this.dispatchEvent("onReady",p);else if(o>=1){var m={};m.errorMsg=c,this.displayError(m,"primary"),this._closeDialog(),this.isEmbeddedUI||this._onComplete()}this.dispatchEvent("buildGraphComplete")},updateOKButton:function(t){this.canPromoteOrDemote=t,this.dialog.updateUI()},_createMultiSelectionUI:function(t){var e=this;this.multiSelUI=new l,this.multiSelUI.create(this.model,t,this,(function(t){e.multiSelUITitle=t,e.setTitle(t)}))?this.onOkClicked=function(t){e.model.isWebInWin?e.options.webInWinHelper.fireWintopCommand(e.options.webToWinComSocket,null,e.options.OnOkFireCommand):e.dispatchEvent("onMaturityTransitionStart");for(var i=this.multiSelUI.getPromotePayload(),s=this.multiSelUI.getDemotePayload(),o={data:[]},a=0;a<i.data.length;a++)o.data.push(i.data[a]);for(a=0;a<s.data.length;a++)o.data.push(s.data[a]);e._filter(o).then((function(o){var a=!1;for(var n in o){a=!0;break}if(a){for(var r={data:[]},l=0;l<i.data.length;l++)o.hasOwnProperty(i.data[l].physicalid)&&r.data.push(i.data[l]);var c={data:[]};for(l=0;l<s.data.length;l++)o.hasOwnProperty(s.data[l].physicalid)&&c.data.push(s.data[l]);r.data.length>0&&c.data.length>0?t.controller.isPromoteDeomoteBothServiceUsed=!0:t.controller.isPromoteDeomoteBothServiceUsed=!1,document.body.style.cursor="progress",r.data.length>0&&t.controller.promote(r),c.data.length>0&&t.controller.demote(c)}else e.updateOKButton(!0)}))}:(this.canPromoteOrDemote=!1,this.dialog.updateUI())},_objectHasWorkflow:function(t){var e,i=0;for(e in t.states)t.states.hasOwnProperty(e)&&i++;return 0!=i},_createSingleObjectGraphUI:function(t){if(this._objectHasWorkflow(t)){void 0!==this.maturityGraph&&null!==this.maturityGraph&&this.maturityGraph.destroy(),this.maturityGraph=new r;var e=this._createGraphStates(t);this.maturityGraph.create(this.maturityGraphContainer,e)}else{var i={};i.errorMsg=I.noMaturityGraph,this.displayError(i,"primary"),this._closeDialog(),this.isEmbeddedUI||this._onComplete()}this._addIncludeChildrenCheckbox()},_updatePendingOperationUI:function(t){this.maturityGraph&&(this.dialog&&this.dialog._disableUI(),_=!1,this.maturityGraph.onStartTransition(t),this.options.webInWinHelper?this.options.webInWinHelper.fireWintopCommand(this.options.webToWinComSocket,null,this.options.OnOkFireCommand):this.dispatchEvent("onMaturityTransitionStart"))},_refreshGraph:function(){if(this.displayWorkflowGraph){var t=this._getFilteredObjects();for(var e in t){var i=t[e].policy,s=t[e].current;this._updateGraph(i,s)}}},_preparePromoteData:function(t,e,i){var s=this.model.originalPid;this.includeChildrenCheckbox.checkFlag?(this.controller.includeStructureFlag=!0,widget&&y.isInPSEditorWidget(widget)?this._getPADSession().then(function(t){var o=!0;t&&(o=t.determineAuthoredFlag()),this.controller.expandStructure(s,o,e,i)}.bind(this)):this.controller.expandStructure(s,!0,e,i)):e()},_filter:function(t){var e=this;return new i((function(s,o){if(0==t.data.length){for(var a=[],n=0;n<t.data.length;n++)a[t.data[n].physicalid]="";s(a)}else{var r=[];for(n=0;n<t.data.length;n++)for(var l=c.fetchTypeFilterKeys(t.data[n].type,t.data[n].interfaceHash),d=0;d<l.length;d++){var h=l[d];h in r||(r[h]=[]);var u=t.data[n];r[h].push(u)}var p=[];for(var m in r){(u=r[m]).filterKey=m,p.push(u)}var f={maturityWidget:e,securityContext:e.controller.securityContext,maturityGraphContainer:e.maturityGraphContainer},g=i.deferred();a=[];e.filterRecurse(p,0,f,g,a,[]),g.promise.then((function(t){s(t)}))}}))},filterRecurse:function(t,e,s,o,a,n){for(var r=this,l=t[e],d=l.filterKey,h=[],u=0;u<l.length;u++){l[u].physicalid in n||h.push(l[u])}var p=function(){};p=c.fetchTypeFilter(d);var m=new i((function(t,e){p(h,s).then((function(e){t(e)}))})).then((function(i){e++;for(var l=0;l<h.length;l++){(c=h[l].physicalid)in i||(n[c]="")}for(var c in n)c in a&&delete a[c];for(var c in i)a[c]=i[c];if(e<t.length)r.filterRecurse(t,e,s,o,a,n);else o.resolve(a)}));return m},_promote:function(t){var e=this;e._preparePromoteData(t,(function(){e.progressDialog&&(e.progressDialog.close(),e.progressDialog=null);var i=t.data[0].tostate,s={data:[]};for(var o in e.model.objects){var a=e.model.objects[o];if(a.current==i)a.displayName+"<br>";else if(!a.excludeFromPromote){var n=!1,r="",l=e.model.getAttribute(a.physicalid,"signatures");if(l.hasOwnProperty([a.current])){var c=l[a.current];if(c.hasOwnProperty([i])){var d=Object.keys(c[i]);d.length>0&&"undefined"!=d[0]?r=d[0]:d.length>0&&"undefined"==d[0]&&(n=!0)}}(""!=r||n)&&s.data.push({physicalid:a.physicalid,tostate:i,fromstate:a.current,type:a.type,revision:a.revision,policy:a.policy,name:a.name,coretype:a.coretype,signature:r,cadMaster:a.cadMaster})}}e._updatePendingOperationUI(s.data[0].tostate),e.controller.promote(s)}),(function(t){e.displayError(t,"primary")}))},_demote:function(t){var e=this;e._preparePromoteData(t,(function(){var i=t.data[0].tostate,s={data:[]};for(var o in e.model.objects){var a=e.model.objects[o];a.current==i?a.displayName+"<br>":a.excludeFromPromote||s.data.push({physicalid:a.physicalid,tostate:i,fromstate:a.current})}e._updatePendingOperationUI(s.data[0].tostate),e.controller.demote(s)}),(function(t){e.displayError(t,"primary")}))},_updateGraph:function(t,e){if("#DENIED!"!=e){var i=this.model.getMaturityGraph(t),s=this._createGraphStates(i,e);this.maturityGraph.updateGraph(s)}},trackAppContent:function(t){var e={UXName:"Maturity",UXSub:"Main",models:t};this.trackerEvent=S.createInitActionEvent(e,this.trackerEvent),S.checkAndTrackPageEvent(this.trackerEvent)}})}));