define("DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorServices",["DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/DataModelSet","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgColumnManager","DS/CfgBaseUX/scripts/CfgUXEnvVariables","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUXNLS","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","i18n!DS/CfgMassVariantEffectivityEditor/assets/nls/CfgMassVariantEffectivityEditor"],(function(e,t,i,n,a,o,s,r,l,d){var c={processAttachedModels:function(e){for(var t=[],i=e.modelInfo,n=0;n<i.length;n++){var a={displayName:"",name:"",revision:""};a.physicalId=i[n].physicalID;for(var o=0;o<i[n].data.length;o++)"Marketing Name"==i[n].data[o].name&&i[n].data[o].value&&(a.displayName=i[n].data[o].value[0]);for(o=0;o<i[n].basicData.length;o++)"name"==i[n].basicData[o].name&&(a.name=i[n].basicData[o].value[0]);""==a.displayName&&(a.displayName=a.name),t.push(a)}return t},buildFeature:function(e,t){return'<Feature Type = "ConfigFeature" Name = "'+e+'">'+t+"</Feature>"},buildOption:function(e){return'<Feature Type = "ConfigFeature" Name = "'+e+'"/>'},buildContext:function(e,t){return'<Context HolderType = "Model" HolderName = "'+e+'">'+t+"</Context>"},buildGlobalExpression:function(e){return'<CfgEffectivityExpression xs:schemaLocation = "urn:com:dassault_systemes:config CfgEffectivityExpression.xsd" xmlns:xs = "http://www.w3.org/2001/XMLSchema-instance" xmlns = "urn:com:dassault_systemes:config"><Expression Domain="ConfigChange_Variant">'+e+"</Expression></CfgEffectivityExpression>"},getFilterablesVariantGrid:function(e,t){for(var i=[],a=0;a<t.length;a++)i.push({instancePID:t[a].instanceId});return new Promise((function(t,a){var o={version:"1.0",mode:"Display",modelPID:e,withBinaries:"NO",instances:i,modelMask:"",featureMask:"Read",optionMask:"Read"},s=JSON.stringify(o);n.makeWSCall("/resources/modeler/configuration/navigationServices/getFilterablesVariantGrid","POST","enovia","application/json",s,(function(e){t(e)}),(function(e,t){a(t||e)}),!0)}))},loadDictionary:async function(e,t,i,o,r,l,d){var c=this;c.isEvolutionBasedOn=o;let u=s.getCfgUXEnvVariables().CFGUseGetAvailableFeaturesOptions;if("xRevision"===o||u){if(options={version:"1.0",referencePID:r,modelPIDs:[e.id]},l&&l.length<=0){let t=e.collection.selectedInstances.map((t=>({instancePID:t.instanceId,effectivityCompiledForm:e.collection.evolutionExpression?"":"No Effectivity"})));options.instances=t}if(l&&l.length>0){let e={operationheader:{key:l[0].key,value:l[0].value}};options.wsHeaderOptions=e}try{let t,a=await n.getAvailableFeaturesAndOptions(options);a&&a.result&&a.result.length>0&&a.result.forEach((i=>{i.modelPID===e.id&&(t=c.processDictionary(i,o))})),e.set("dictionary",t);var f=c.createDictionaryTreeDocument(t);e.set("treeDocumentVariantView",f),i(e.get("id"))}catch(e){console.log("Error",e)}}else{null!=e.get("dictionary")&&i(e.get("id"));var p=e.get("configurationContext"),h="",g=t.getEvolutionExpressionFromModelName(p.name);""!==g&&(h={evolutionExpression:JSON.stringify({filterExpression:a.getValidXmlWithoutDescId(g)})}),n.getLegacyCfgDico(e.get("id"),h,d).then((function(t){var n=c.processDictionary(t);e.set("dictionary",n);var a=c.createDictionaryTreeDocument(n);e.set("treeDocumentVariantView",a),i(e.get("id"))}))}},processDictionary:function(e,t){var i=[];let n=s.getCfgUXEnvVariables().CFGUseGetAvailableFeaturesOptions;for(var a=0;a<e.features.length;a++){var o=e.features[a],r={name:o.name,displayName:o.displayValue,revision:o.revision,options:[],type:o.type_NLS,current:o.current_NLS,originated:o.originated,description:null!=o.description?o.description:"",selectionType:o.selectionType,check:!1,physicalID:("xRevision"===t||n)&&o.physicalid?o.physicalid:o.id.replace("pid:","")};if("Preliminary"!==o.current&&"Obsolete"!==o.current){for(var l=0;l<o.options.length;l++){var d=o.options[l];r.options.push({name:d.name,displayName:d.displayValue,type:d.type_NLS,current:d.current_NLS,originated:d.originated,description:null!=d.description?d.description:"",selectionType:o.selectionType,check:!1,physicalID:("xRevision"===t||n)&&d.physicalid?d.physicalid:d.id.replace("pid:","")})}i.push(r)}}return i},updateAttributes:function(e,t){for(var i=e._options.grid,n=o.getColumnIndexes("VariantsAndOptionGroups"),a=0;a<n.length;a++){var s=n[a];"type"!=n[a]&&"current"!=n[a]||(s+="_NLS"),null==t[s]&&(s=n[a]),i[n[a]]=t[s]}e.updateOptions({grid:i})},createDictionaryTreeDocument:function(n){var a=new i,s=new e({dataModelSet:a});s.prepareUpdate();for(var r=0;r<n.length;r++){for(var l=n[r],d={},c=o.getColumnIndexes("VariantsAndOptionGroups"),u=0;u<c.length;u++)d[c[u]]="";var f=new t({label:l.displayName,grid:{name:l.name,type:l.type,typeNLS:l.type,id:l.physicalID,checkbx:!1},data:{self:l,feature:l}});this.updateAttributes(f,l),s.addRoot(f);for(var p=0;p<l.options.length;p++){var h=l.options[p],g=new t({label:h.displayName,grid:{name:h.name,type:h.type,typeNLS:h.type,id:h.physicalID,checkbx:!1},data:{self:h,feature:l}});this.updateAttributes(g,h),f.addChild(g)}}return s.expandAll(),s.pushUpdate(),s},setEffectivity:function(e,t,i,n,a){this.numberOfModifiedInstances=t,c.unsetEffectivitySuccessfulCount=0,c.unsetEffectivityFailedCount=0,c.effectivityExpression=[],c.unsetEffectivityExpression=[],c.PADContext=n;c.instanceIds=Object.keys(e);for(var o=0;o<c.instanceIds.length;o++)if(-1!=t.indexOf(e[c.instanceIds[o]].data.instance.instanceId)){var s={};s.pid=e[c.instanceIds[o]].data.instance.instanceId,s.expressions=[{VariantContent:e[c.instanceIds[o]].xml}],""!=e[c.instanceIds[o]].xml?c.effectivityExpression.push(s):c.unsetEffectivityExpression.push(s)}0==c.unsetEffectivityExpression.length&&0==c.effectivityExpression.length&&i(),c.unsetEffectivityExpression.length>0&&this._unsetEffectivities(c.unsetEffectivityExpression,i,a),0!=c.effectivityExpression.length&&this._setEffectivity(c.effectivityExpression,i,a)},_unsetEffectivities:function(e,t,i){return new Promise((function(a,o){var s=[];for(counter=0;counter<e.length;counter++)s.push(e[counter].pid);var r;r={version:"2.0",unsetList:s,domain:"Variant"};var u=JSON.stringify(r),f=[],p=l.get();if(p&&p.AuthoringContextHeader)for(var h in p.AuthoringContextHeader)f.push({key:h,value:p.AuthoringContextHeader[h]});var g=null;f.length>0&&(g={operationheader:{key:f[0].key,value:f[0].value}}),n.makeWSCall("/resources/modeler/configuration/authoringServices/unsetVariantEffectivities","POST","enovia","json",u,(function(e){if(void 0===e.GlobalStatus||"SUCCESS"!=e.GlobalStatus&&"ATLEAST_ONEFAILURE"!=e.GlobalStatus)t(),0==c.effectivityExpression&&e.results&&e.results[0]&&e.results[0].errorDetails&&n.showwarning(e.results[0].errorDetails,"error");else{for(var o=[],s=0;s<e.results.length;s++){var r=e.results[s],l=r.existing,u=r.new;"SUCCESS"==e.results[s].status&&null!=u&&null!=u.pid&&null!=l&&null!=l.pid&&o.push(l.pid)}var f={commandName:"cfgMassEditVariant",widgetId:widget.id,response:e,data:{}};n.publishPostProcessingEventForApplications(f),o.length>0&&n.showwarning(d.CFG_Application_Refresh_For_Instance_Evolved,"info"),c.emptyInstanceID=[],c.unsetEffectivityExpression.forEach((function(e){c.emptyInstanceID.push(e.pid)})),t(),i.resetCommandClickProbesData(),i.initiateCurrentEffectivityXmls(),i.resetModifiedInstances(),0==c.effectivityExpression&&(void 0!==e.GlobalStatus&&"SUCCESS"==e.GlobalStatus?n.showwarning(d.CFG_Unset_Effectivity_Successful,"success"):void 0!==e.GlobalStatus&&"ATLEAST_ONEFAILURE"==e.GlobalStatus&&n.showwarning(d.CFG_Unset_Effectivity_Partially_Successful,"info"))}a(e)}),(function(e){t(),i.resetCommandClickProbesData(),0==c.effectivityExpression&&(n.isDefined(e)&&n.isDefined(e.errorMessage)?n.showwarning(d.CFG_Unset_Effectivity_Failed+"\n"+e.errorMessage,"error"):n.showwarning(d.CFG_Unset_Effectivity_Failed,"error")),o(e)}),!0,g)}))},_setEffectivity:function(e,t,i){return new Promise((function(a,o){var s=[],u=l.get();if(u&&u.AuthoringContextHeader)for(var f in u.AuthoringContextHeader)s.push({key:f,value:u.AuthoringContextHeader[f]});var p=null;s.length>0&&(p={operationheader:{key:s[0].key,value:s[0].value}});var h={},g=[];for(counter=0;counter<e.length;counter++)g.push({pid:e[counter].pid,VariantContent:e[counter].expressions[0].VariantContent});h={version:"1.1",output:{domains:"Variant",view:"Current",targetFormat:"TXT"},domain:"Variant",view:"All",expressionList:g},"xRevision"===c.isEvolutionBasedOn&&(h.version="2.0");var v=JSON.stringify(h);n.makeWSCall("/resources/modeler/configuration/authoringServices/setVariantEffectivities?traces=0&perfo=0 HTTP/1.1","POST","enovia","application/json",v,(function(e){for(var o=[],s=0;s<e.results.length;s++){var l=e.results[s],c=l.existing,u=l.new;"SUCCESS"==e.results[s].status&&null!=u&&null!=u.pid&&null!=c&&null!=c.pid&&o.push(c.pid)}var f={commandName:"cfgMassEditVariant",widgetId:widget.id,response:e,data:{}};if(n.publishPostProcessingEventForApplications(f),o.length>0&&n.showwarning(d.CFG_Application_Refresh_For_Instance_Evolved,"info"),t(),i.resetCommandClickProbesData(),i.initiateCurrentEffectivityXmls(),i.resetModifiedInstances(),null!=e.GlobalStatus&&"ERROR"==e.GlobalStatus)if(null!=e.results&&null!=e.results[0]){let t="";126==e.results[0].errorCode?(t=d.CFG_Mass_EditVariant_Failed_WorkUnder_Different_Criteria_Message+"<b>"+r.CfgHeaderEditConfigurationContext+"</b>",n.showNotifs("error",d.CFG_Mass_EditVariant_Failed_WorkUnder_Different_Criteria_Title,"",t)):(t=e.results[0].message,n.showwarning(t,"error")),console.log("Mass Edit Variant Effectivity operation error = "+e.results[0].errorDetails)}else n.showwarning(d.CFG_Edit_Effectivity_AllFailed,"error");else null!=e.GlobalStatus&&"ATLEAST_ONEFAILURE"==e.GlobalStatus?n.showwarning(d.CFG_Edit_Effectivity_Partially_Successful,"info"):n.showwarning(d.CFG_Edit_Effectivity_AllSuccessful,"success");a(e)}),(function(e){t(),i.resetCommandClickProbesData(),n.isDefined(e)&&n.isDefined(e.errorMessage)?n.showwarning(d.CFG_Edit_Effectivity_AllFailed+"\n"+e.errorMessage,"error"):n.showwarning(d.CFG_Edit_Effectivity_AllFailed,"error"),o(e)}),!0,p)}))},isKarmaOdtMode:function(){return void 0!==window.__karma__}};return c})),define("DS/CfgMassVariantEffectivityEditor/scripts/CfgTweakerTristate",["UWA/Core","DS/Tweakers/TweakerBase","DS/Utilities/Dom","DS/Utilities/Utils","DS/Core/PointerEvents"],(function(e,t,i,n,a){"use strict";var o=t.inherit({name:"TweakerTristate",publishedProperties:{value:{defaultValue:!1,type:"boolean",advancedSetter:!0},valueType:{defaultValue:"boolean",type:"string"},displayStyle:{defaultValue:"checkbox",type:"string"}},computeTweakerContentLength:function(){return this._getCurrentTouchMode()?19:14},_upgradeValue:function(e){return"1"===e||1===e||"true"===e||!0===e||"0"!==e&&0!==e&&"false"!==e&&!1!==e&&"undefined"}}),s=function(e,i){t.prototype.baseViewModule.call(this,e,i)};n.applyMixin(s,t.prototype.baseViewModule);var r=function(e,t){s.call(this,e,t)};n.applyMixin(r,s),r.prototype.buildView=function(){if(this._tweaker.elements.container){var t,i=this._options.viewOptions||{};i.type=this._options.viewOptions.displayStyle,i.touchMode=this._tweaker._getCurrentTouchMode(),i.fireOnlyFromUIInteractionFlag=!0,this._view=new e.Element("div"),this.icon=new e.Element("div"),this.icon.inject(this._view),this.icon.setStyles({height:"100%",width:"100%"}),"undefined"===this._tweaker.value?t="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon":!0===this._tweaker.value?t="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check wux-ui-3ds-lg checkIcon":!1===this._tweaker.value&&(t="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong wux-ui-3ds-lg notIcon"),this.icon.addClassName(t),this.setValue(this._tweaker.value)}},r.prototype.handleEvents=function(){var e=this._view,t=this.icon,n=this._tweaker;i.addEventOnElement(n,e,a.POINTERHIT,(function(e){e.stopPropagation(),t.className="";var i="";!1===n.value||!0===n.value?(i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon",n.value="undefined"):"undefined"===n.value&&(n.value=!0,i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check wux-ui-3ds-lg checkIcon"),t.addClassName(i)}))},r.prototype.setValue=function(e,t){if(this.icon){var i="";"undefined"===this._tweaker.value?i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon":!0===this._tweaker.value?i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check wux-ui-3ds-lg checkIcon":!1===this._tweaker.value&&(i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong wux-ui-3ds-lg notIcon"),this.icon.className="",this.icon.addClassName(i)}},r.prototype.setTouchMode=function(e,t){this.icon&&(this.icon.touchMode=e)};var l=function(e,t){s.call(this,e,t)};return n.applyMixin(l,s),l.prototype.buildView=function(){var t;this._tweaker.elements.container&&(this._view=new e.Element("span"),"undefined"===this._tweaker.value?t="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon":!0===this._tweaker.value?t="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check wux-ui-3ds-lg ":!1===this._tweaker.value&&(t="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong wux-ui-3ds-lg "),this._view.addClassName(t),this.setValue(this._tweaker.value),this.setTouchMode(this._tweaker._getCurrentTouchMode()))},l.prototype.setValue=function(e,t){if(this._view){var i="";"undefined"===this._tweaker.value?i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon":!0===this._tweaker.value?i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check wux-ui-3ds-lg ":!1===this._tweaker.value&&(i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong wux-ui-3ds-lg "),this._view.className="",this._view.addClassName(i)}},l.prototype.setTouchMode=function(e,t){this._view&&(this._tweaker.readOnly?this._view.style.paddingLeft=e?"14px":"7px":this._view.touchMode=e)},o.prototype.baseViewModule=s,o.prototype.VIEW_MODULES={switch:{classObject:r,options:{viewOptions:{displayStyle:"switch"}}},readOnly:{classObject:l,options:{viewOptions:{displayStyle:"switch"}}},checkbox:{classObject:r,options:{viewOptions:{displayStyle:"checkbox"}}}},o.prototype.registerViewModule=function(e,t){},o})),define("DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEffectivityEditorModelSelector",["UWA/Drivers/Alone","DS/Core/Core","DS/Controls/ComboBox","UWA/Class/View","i18n!DS/CfgMassVariantEffectivityEditor/assets/nls/CfgMassVariantEffectivityEditor"],(function(e,t,i,n,a){"use strict";return n.extend({_textNode:null,setup:function(e){this._parent(e)},enable:function(){1!=this.options.data.length&&(this._wuxComboBox.disabled=!1)},disable:function(){this._wuxComboBox.disabled=!0},render:function(){var e=this;this.options.processedData=[];for(var t=0;t<this.options.data.length;t++){var n=this.options.data[t];this.options.processedData.push({valueItem:n,labelItem:n.displayName})}return this._wuxComboBox=new i({enableSearchFlag:!1,actionOnClickFlag:!1,elementsList:this.options.processedData,placeholder:a.CFG_Select_Model,selectedIndex:0}),this._wuxComboBox.addEventListener("change",(function(t){e.options.onChangeCB(e._wuxComboBox.currentValue),console.log(t)})),1==this.options.data.length&&(this._wuxComboBox.hide(),this._text=this.options.data[0].displayName,void 0!==this.options.data[0].revision&&""!==this.options.data[0].revision&&(this._text=this._text+" "+this.options.data[0].revision)),this}})})),define("DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",["DS/CfgBaseUX/scripts/CfgDialog","DS/Controls/Toggle","i18n!DS/CfgMassVariantEffectivityEditor/assets/nls/CfgMassVariantEffectivityEditor"],(function(e,t,i){var n=Object.create(null);return n.toolbar=null,n.isPasteEffectivityWarningToShow=!0,n.writetoolbarDefination=function(){var e={entries:[{id:"ID_ColumnText",dataElements:{typeRepresentation:"string",value:"",label:i.CFG_SearchColumns,tooltip:i.CFG_SearchColumns,placeholder:i.CFG_SearchColumns,overflowPriority:"none",visibleFlag:!1,displayLabel:!1,category:"other",class:"CfgMassVariantSearchOptionTextBox"},position:"far",children:[]},{id:"ID_Search",dataElements:{typeRepresentation:"functionIcon",tooltip:i.CFG_SearchColumns,disabled:!1,icon:{iconName:"search",fontIconFamily:1},category:"other",action:{module:"DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",func:"onSearchClick"}},position:"far",children:[]},{id:"ID_Plus",dataElements:{typeRepresentation:"functionIcon",tooltip:i.CFG_AddORConditions,disabled:!0,icon:{iconName:"plus",fontIconFamily:1},category:"Touch",action:{module:"DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",func:"onPlusClick"}},position:"far",children:[]},{id:"ID_Copy",dataElements:{typeRepresentation:"functionIcon",tooltip:i.CFG_CopyEffectivityConditions,disabled:!0,icon:{iconName:"copy",fontIconFamily:1},category:"Touch",action:{module:"DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",func:"onCopyClick"}},position:"far",children:[]},{id:"ID_Paste",dataElements:{typeRepresentation:"functionIcon",tooltip:i.CFG_PasteEffectivityConditions,disabled:!0,icon:{iconName:"paste",fontIconFamily:1},category:"Touch",action:{module:"DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",func:"onPasteClick"}},position:"far",children:[]},{id:"ID_Duplicate",dataElements:{typeRepresentation:"functionIcon",tooltip:i.CFG_DuplicateEffectivityConditions,disabled:!0,icon:{iconName:"duplicate",fontIconFamily:1},category:"Touch",action:{module:"DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",func:"onDuplicateClick"}},position:"far",children:[]},{id:"ID_Minus",dataElements:{tooltip:i.CFG_DeleteORConditions,typeRepresentation:"functionIcon",disabled:!0,icon:{iconName:"trash",fontIconFamily:1},category:"Touch",action:{module:"DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",func:"onMinusClick"}},position:"far",children:[]},{id:"ID_SwitchView",dataElements:{typeRepresentation:"functionIcon",tooltip:i.CFG_VerticalSwitchView,disabled:!1,visibleFlag:!1,icon:{iconName:"table-vertical",fontIconFamily:1},category:"Touch",action:{module:"DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",func:"onSwitchViewClick"}},position:"far",children:[]},{id:"ID_Dictionary",dataElements:{typeRepresentation:"functionIcon",tooltip:i.CFG_AddVariantsOptions,disabled:!1,visibleFlag:!1,icon:{iconName:"book-open",fontIconFamily:1},category:"Touch",action:{module:"DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",func:"onShowDictionaryClick"}},position:"far",children:[]},{id:"ID_TableView",dataElements:{typeRepresentation:"functionIcon",tooltip:i.ColumnPropertiesManagerHeader,disabled:!1,visibleFlag:!1,icon:{iconName:"cog",fontIconFamily:1},category:"other",action:{module:"DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar",func:"onlaunchCustomColumnManager"}},position:"far",children:[]}]};return JSON.stringify(e)},n.onPlusClick=function(e){n.toolbar.currentModel.addORCondition(),n.toolbar.currentModel.onModelUpdateCallback&&n.toolbar.currentModel.onModelUpdateCallback()},n.onSearchClick=function(e){1==n.toolbar.getNodeModelByID("ID_ColumnText").options.visibleFlag?n.toolbar.updateNodeModel("ID_ColumnText",{visibleFlag:!1}):n.toolbar.updateNodeModel("ID_ColumnText",{visibleFlag:!0})},n.onCopyClick=function(e){n.toolbar.currentModel.addCopyCondition(),n.toolbar.isCopyOperationPerformed="YES"},n.performPasteOperation=function(){n.toolbar.currentModel.addPasteCondition();var e=[{IdValue:"ID_Paste",StateValue:!0}];n.setToolbarState(e),n.toolbar.isCopyOperationPerformed="NO",n.toolbar.currentModel.set("copiedInstances",[]),n.toolbar.currentModel.onModelUpdateCallback&&n.toolbar.currentModel.onModelUpdateCallback()},n.onPasteClick=function(e){1!=n.isPasteEffectivityWarningToShow?(n.performPasteOperation(),n.toolbar.currentModel.onModelUpdateCallback&&n.toolbar.currentModel.onModelUpdateCallback()):n.showPasteEffectivityWarningDialog()},n.onDuplicateClick=function(e){n.toolbar.currentModel.addDuplicateCondition();var t=[{IdValue:"ID_Duplicate",StateValue:!0},{IdValue:"ID_Paste",StateValue:!0}];n.setToolbarState(t),n.toolbar.currentModel.onModelUpdateCallback&&n.toolbar.currentModel.onModelUpdateCallback()},n.onMinusClick=function(e){n.toolbar.currentModel.removeORCondition(),n.toolbar.currentModel.onModelUpdateCallback&&n.toolbar.currentModel.onModelUpdateCallback()},n.setToolbarState=function(e){if(e)for(var t=0;t<e.length;t++){var i=e[t];n.toolbar.updateNodeModel(i.IdValue,{disabled:i.StateValue})}},n.showPasteEffectivityWarningDialog=function(){var a=function(){s.closeDialog()},o={width:446,height:215,isResizable:!1,dialogue:{header:i.CFG_Paste_Effectivity_Heading,buttonArray:[{label:"Ok",labelValue:i.Ok,handler:function(){n.performPasteOperation(),s.closeDialog()},className:"primary"},{label:"Cancel",labelValue:i.Cancel,handler:a,className:"default"}],target:widget.body,object:null,postCrossHandler:a}},s=new e(o);s.render(),s.container.setStyle("overflow","auto"),s.container.setHTML(i.CFG_Paste_Effectivity_Warning+"<br><br>"+i.CFG_Paste_Effectivity_Question+"<br>"),s.footerButton.Ok.domId="cfgWarningOKBtn",s.footerButton.Cancel.domId="cfgWarningCloseBtn";var r=new t({label:i.CFG_Paste_Effectivity_Preference_Warning});r.addEventListener("change",(function(e){1==e.dsModel.checkFlag?n.isPasteEffectivityWarningToShow=!1:n.isPasteEffectivityWarningToShow=!0})),r.inject(s.container)},n.onlaunchCustomColumnManager=function(e){n.toolbar.currentModel&&n.toolbar.currentModel.launchCustomViewManager&&n.toolbar.currentModel.launchCustomViewManager()},n})),define("DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorModel",["UWA/Class/Model","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/DataModelSet","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorServices","i18n!DS/CfgMassVariantEffectivityEditor/assets/nls/CfgMassVariantEffectivityEditor"],(function(e,t,i,n,a,o,s){return e.extend({_onNodeModelUpdateSubscriptionToken:"",_processedAttributes:{},probesData:[],defaults:function(){return{gridEffectivityForConfigurationContext:null,treeDocumentEffectivityGridView:null,treeDocumentVariantView:null,gridViewEffectivityColumns:[],configurationContext:{},selectedInstances:[],copiedInstances:[],dictionary:null,probesData:[]}},_addExpressionColumn:function(){var e="350";return window.matchMedia("(max-width: 767px)").matches&&(e="100"),{text:s.CFG_Expression,dataIndex:"Expression",pinned:"right",width:e,editionPolicy:"none"}},_addInstanceColumn:function(){var e="250";return window.matchMedia("(max-width: 767px)").matches&&(e="100"),{text:s.CFG_Instance,dataIndex:"instance",pinned:"left",alwaysVisibleFlag:"true",width:e,editionPolicy:""}},addFeatureColumn:function(e,t,i,n,a,o){this.modifiedFeatureIds&&this.modifiedFeatureIds.push(a);for(var s=0;s<e.length;s++)if(e[s].dataIndex==a)return e[s];var r=this.getColumnDefination();return r.name=t,r.text=i,r.dataIndex=a,r.typeRepresentation="string",r.editionPolicy="",r.columnType="Feature",r.featureType=o,e.push(r),r},addOptionColumn:function(e,t,i,n,a,s){this.modifiedOptionIds&&this.modifiedOptionIds.push(s);var r=this.getColumnDefination();r.name=t,r.text=i,r.dataIndex=s,r.typeRepresentation="tristate",r.editionPolicy="EditionInPlace",r.columnType="Option",r.featureType="",r.parentId=a,1==o.isReadOnlyMode&&(r.editionPolicy="none"),void 0===e.children&&(e.children=[]),e.children.push(r)},getColumnDefination:function(){return{name:"",text:"",dataIndex:"",typeRepresentation:"string",editionPolicy:"",columnType:"",featureType:"",parentId:""}},createColumns:function(e){var t=[];if(t.push(this._addInstanceColumn()),null!=e.criterias)for(var i=e.criterias.features,n=0;n<i.length;n++){var a=i[n].featureAttributes.results[0];(l=this._extractAttributes(a)).parentId="",null!=i[n].featureType?l.featureType=i[n].featureType:l.featureType="NonExclusive",this._processedAttributes[i[n].featurePID]=l;var s=this.addFeatureColumn(t,l.name,l.displayName,l.type,l.physicalId,l.featureType);s.children=[];for(var r=0;r<i[n].options.length;r++){var l;a=i[n].options[r].optionAttributes.results[0];(l=this._extractAttributes(a)).parentId=i[n].featurePID,this._processedAttributes[i[n].options[r].optionPID]=l;var d=this.getColumnDefination();d.name=l.name,d.text=l.displayName,d.dataIndex=l.physicalId,d.typeRepresentation="tristate",d.editionPolicy="EditionInPlace",d.columnType="Option",d.featureType=l.type,d.parentId=l.parentId,1==o.isReadOnlyMode&&(d.editionPolicy="none"),s.children.push(d)}}t.push(this._addExpressionColumn()),this.set("gridViewEffectivityColumns",t)},_extractAttributes:function(e){var t={};return t.physicalId=e.physicalID,e.data.forEach((function(e){"Display Name"==e.name&&(t.displayName=e.value[0])})),e.basicData.forEach((function(e){"name"==e.name&&(t.name=e.value[0])})),t.type=e.type,t},getProcessedInstances:function(){for(var e={},t=this.get("selectedInstances"),i=0;i<t.length;i++)e[t[i].instanceId]=t[i];return e},createTreeDocument:function(e){for(var o=this.get("gridViewEffectivityColumns"),r={},l=0;l<o.length;l++){r[o[l].dataIndex]="";for(var d=0;null!=o[l].children&&d<o[l].children.length;d++)r[o[l].children[d].dataIndex]="undefined"}r.instance="",r.Expression="",r.interfaces=e.extenstionsList;var c=!1,u=this.getProcessedInstances(),f=new n,p=new t({dataModelSet:f});p.prepareUpdate();var h=[];if(null!=e.expressions)for(var g=0;g<e.expressions.length;g++)h[e.expressions[g].instancePID]=e.expressions[g];if(null!=e.classification)for(g=0;g<e.classification.length;g++){"LEGACY_EFF"!=e.classification[g].classificationCode?h[e.classification[g].instancePID]={effectivity:[]}:c=!0}for(var v in u)if(u.hasOwnProperty(v)){if(void 0===h[v])continue;var m=h[v].effectivity;if(void 0===m)continue;for(var C=u[v],y=0;y<m.length;y++){for(var E=m[y].optionSelection,V=Object.assign({},r),w={},I=C.name,D=0;D<E.length;D++){var _=E[D],b=_.isSelected;"YES"==b&&(b=!0),"NOT"==b&&(b=!1),V[this._processedAttributes[_.optionPID].physicalId]=b,w.instance=C,w.isModified=!1,w.isAllowed=!0,0!=y&&(I="")}V.instance=I,V.id=C.instanceId,V.type=C.instanceType,V.typeNLS=C.instanceTypeNLS,V.refType=C.referenceType,V.refTypeNLS=C.referenceTypeNLS,V.referenceId=C.referenceId;var x=new i({label:I,grid:V,data:w});this.updateDisplayExpression(x),x.options.data.isModified=!1,p.addChild(x)}if(0===m.length){(w={}).instance=C;var M=Object.assign({},r);M.instance=C.name,M.id=C.instanceId,M.type=C.instanceType,M.typeNLS=C.instanceTypeNLS,M.refType=C.referenceType,M.refTypeNLS=C.referenceTypeNLS,M.referenceId=C.referenceId,w.isModified=!1,w.isAllowed=!0;x=new i({label:C.name,grid:M,data:w});p.addChild(x)}}p.expandAll(),p.pushUpdate(),this.set("treeDocumentEffectivityGridView",p),this.registeronNodeUpdateEvent(),0==p.getAllDescendants().length?a.showwarning(s.CFG_Invalid_All_Objects,"info"):1==c&&a.showwarning(s.CFG_Invalid_Objects,"info")},updateDisplayExpression:function(e){var t=this.get("configurationContext"),i=this.get("gridViewEffectivityColumns"),n=this.getORConditionXML(i,e,"TXT"),s=a.escapeSpecialCharacters(t.displayName);""!=n&&(n=o.buildContext(s,n)),n=o.buildGlobalExpression(n);var r=a.getDisplayExpressionUsingXSLT(n,"TRUE");e.prepareUpdate(),e.options.data.isModified=!0,e.updateOptions({grid:{Expression:r}}),e.pushUpdate()},getORConditionXML:function(e,t,i){for(var n=t.options.grid,s=[],r=[],l=!1,d=0;d<e.length;d++){e[d].dataIndex;var c=e[d].name;if("TXT"==i&&(c=a.escapeSpecialCharacters(e[d].text)),s=[],l=!1,void 0!==e[d].children){for(var u=0;u<e[d].children.length;u++){var f=n[e[d].children[u].dataIndex],p=(e[d].children[u].dataIndex,e[d].children[u].name);"TXT"==i&&(p=a.escapeSpecialCharacters(e[d].children[u].text)),1!=f&&0!=f||(0==f&&(l=!0),s.push({isNOT:l,xml:o.buildOption(p)}),l=!1)}if(0!=s.length)if("NonExclusive"==e[d].featureType)for(var h=0;h<s.length;h++){var g=o.buildFeature(c,s[h].xml);1==s[h].isNOT&&(g="<NOT>"+g+"</NOT>"),r.push(g)}else{for(var v="",m=(l=!1,0);m<s.length;m++)v+=s[m].xml,l=s[m].isNOT;g=o.buildFeature(c,v);1==l&&(g="<NOT>"+g+"</NOT>"),r.push(g)}}}s="";for(var C=0;C<r.length;C++)s+=r[C];return""!=s&&r.length>1&&(s="<AND>"+s+"</AND>"),s},registeronNodeUpdateEvent:function(){var e=this;this._onNodeModelUpdateSubscriptionToken=this.get("treeDocumentEffectivityGridView").onNodeModelUpdate((function(t){e.undoRegisteronNodeUpdateEvent(),e.updateVariantsSelection(t.data.nodeModel),e.updateDisplayExpression(t.data.nodeModel),e.onModelUpdateCallback&&e.onModelUpdateCallback(),e.registeronNodeUpdateEvent()}))},updateVariantsSelection:function(e){for(var t=this.get("gridViewEffectivityColumns"),i=0;i<t.length;i++)if(void 0!==t[i].children){var n={};for(childrenCount=0;null!=t[i].children&&"Exclusive"==t[i].featureType&&childrenCount<t[i].children.length;childrenCount++){var a=e.options.grid[t[i].children[childrenCount].dataIndex];"undefined"!=a&&(n[""+a]="")}if(Object.keys(n).length>1)for(childrenCount=0;null!=t[i].children&&"Exclusive"==t[i].featureType&&childrenCount<t[i].children.length;childrenCount++)0==e.options.grid[t[i].children[childrenCount].dataIndex]&&(e.options.grid[t[i].children[childrenCount].dataIndex]="undefined")}},undoRegisteronNodeUpdateEvent:function(){this.get("treeDocumentEffectivityGridView").unsubscribe(this._onNodeModelUpdateSubscriptionToken)},treeUpdateForAddOR:function(e){e.prepareUpdate();var t=e.getSelectedNodes(),n=t[0]._rowID+1,a={};for(var o in Object.assign(a,t[0].options.grid),a)a.hasOwnProperty(o)&&(!0!==a[o]&&!1!==a[o]||(a[o]="undefined"),"instance"==o&&(a[o]=""),"Expression"==o&&(a[o]=""));var s=new i({label:"",grid:a,icons:"",data:t[0].options.data});e.addChild(s,n),e.pushUpdate()},addORCondition:function(){this.probesData.push("Edit_Variant_Effectivity_Mass_Add_OR_Condition"),this.set("probesData",this.probesData);var e=this.get("treeDocumentEffectivityGridView");1==this.isRowSelectionValidForAdd()&&this.treeUpdateForAddOR(e)},processSelectedDataForCopyOperation:function(e){for(var t=[],i=0;i<e.length;i++){var n={grid:JSON.parse(JSON.stringify(e[i].options.grid))};t.push(n)}return t},addCopyCondition:function(){this.probesData.push("Edit_Variant_Effectivity_Mass_Copy_Effectivity_Condition"),this.set("probesData",this.probesData);var e=this.get("treeDocumentEffectivityGridView"),t=e.getSelectedNodes(),i=this.processSelectedDataForCopyOperation(t);i.length>0&&(this.set("copiedInstances",i),e._xso.empty())},sortNumber:function(e,t){return e-t},getDataForPasteOperation:function(){for(var e=this.get("treeDocumentEffectivityGridView").getSelectedNodes(),t=[],i=[],n=0;n<e.length;n++){var a=e[n].options.data.instance.instanceId;-1==t.indexOf(a)&&t.push(a)}for(n=0;n<t.length;n++){for(var o=t[n],s=[],r=0;r<e.length;r++)e[r].options.data.instance.instanceId==o&&s.push(e[r]._rowID);s.sort(this.sortNumber),i.push({instanceId:o,rowIds:s})}return i},setModifiedInstances:function(e){for(var t=this.get("treeDocumentEffectivityGridView").getAllDescendants(),i=0;i<t.length;i++)-1!=e.indexOf(t[i].options.data.instance.instanceId)&&(t[i].options.data.isModified=!0)},getInstancesForPasteScenario:function(){var e=this.get("copiedInstances"),t=this.getDataForPasteOperation(),i=this.get("treeDocumentEffectivityGridView").getSelectedNodes(),n=[],a=[],o={};i.forEach((function(e){o[""+e._rowID]=e}));for(var s=0;s<t.length;s++){var r=t[s].instanceId,l=t[s].rowIds.length,d=t[s].rowIds,c=e.length;if(l>=c)for(var u=0;u<c;u++){var f=JSON.parse(JSON.stringify(e[u].grid)),p=d[u];n.push(o[p].options.data.instance.instanceId),f.instance=o[p].options.grid.instance,o[p].updateOptions({grid:f})}else{for(u=0;u<l;u++){f=JSON.parse(JSON.stringify(e[u].grid)),p=d[u];n.push(o[p].options.data.instance.instanceId),f.instance=o[p].options.grid.instance,o[p].updateOptions({grid:f})}a.push({instanceId:r,pasteCount:l,copyCount:c})}}return this.setModifiedInstances(n),a},addPasteCondition:function(){this.probesData.push("Edit_Variant_Effectivity_Mass_Paste_Effectivity_Condition"),this.set("probesData",this.probesData);var e=this.get("copiedInstances"),t=this.get("treeDocumentEffectivityGridView"),n=t.getSelectedNodes(),a=this.getInstancesForPasteScenario();t.prepareUpdate();for(var o=a.length-1;o>=0;o--)for(var s=a[o].instanceId,r=a[o].pasteCount,l=a[o].copyCount,d=n.length-1;d>=0;d--)if(n[d].options.data.instance.instanceId==s){for(var c=n[d]._rowID+1,u=0;u<l;u++)if(u>=r){var f=JSON.parse(JSON.stringify(e[u].grid));for(var p in f)f.hasOwnProperty(p)&&"instance"==p&&(f[p]="");var h=new i({label:"",grid:f,icons:"",data:n[d].options.data});t.addChild(h,c),c++}break}t.pushUpdate(),t._xso.empty()},treeUpdateForAddDuplicate:function(e,t){e.prepareUpdate();var n=e.getSelectedNodes(),a={},o=[];n.forEach((function(e){o.push(e._rowID),a[""+e._rowID]=e})),o.sort(this.sortNumber);for(var s=o.length-1;s>=0;s--){var r=o[s];t.push(a[r].options.data.instance.instanceId);var l=r+1,d=JSON.parse(JSON.stringify(a[r].options.grid));for(var c in d)d.hasOwnProperty(c)&&"instance"==c&&(d[c]="");var u=new i({label:"",grid:d,icons:"",data:a[r].options.data});e.addChild(u,l)}return e.pushUpdate(),t},addDuplicateCondition:function(){this.probesData.push("Edit_Variant_Effectivity_Mass_Add_Duplicate_Condition"),this.set("probesData",this.probesData);var e=this.get("treeDocumentEffectivityGridView"),t=[];1==this.isRowSelectionValidForDelete()&&(t=this.treeUpdateForAddDuplicate(e,t)),this.setModifiedInstances(t),e._xso.empty()},treeUpdateForRemoveOR:function(e,t){e.prepareUpdate();for(var i=e.getSelectedNodes(),n=0;n<i.length;n++)if(t.push(i[n].options.data.instance.instanceId),""==i[n].options.grid.instance)e.removeRoot(i[n]);else{var a=i[n].options.grid;for(var o in a)if(a.hasOwnProperty(o)){if("instance"==o)continue;"Expression"==o&&(a[o]=""),!0!==a[o]&&!1!==a[o]||(a[o]="undefined")}i[n].updateOptions({grid:a})}return e.pushUpdate(),t},removeORCondition:function(){this.probesData.push("Edit_Variant_Effectivity_Mass_Remove_OR_Condition"),this.set("probesData",this.probesData);var e=this.get("treeDocumentEffectivityGridView"),t=[];1==this.isRowSelectionValidForDelete()&&(t=this.treeUpdateForRemoveOR(e,t));for(var i=this.get("treeDocumentEffectivityGridView").getAllDescendants(),n=0;n<i.length;n++)-1!=t.indexOf(i[n].options.data.instance.instanceId)&&(i[n].options.data.isModified=!0)},isRowSelectionValidForDelete:function(){var e=this.get("treeDocumentEffectivityGridView").getSelectedNodes();if(0==e.length)return a.showwarning(s.CFG_No_Selection,"error"),!1;for(var t=0;t<e.length;t++)if(0==e[t].options.data.isAllowed)return a.showwarning(s.CFG_Select_Valid_Object,"error"),!1;return!0},isRowSelectionValidForAdd:function(){var e=this.get("treeDocumentEffectivityGridView").getSelectedNodes();return 0==e.length?(a.showwarning(s.CFG_No_Selection,"error"),!1):e.length>1?(a.showwarning(s.CFG_MultiSelection_Not_Allowed,"error"),!1):0!=e[0].options.data.isAllowed||(a.showwarning(s.CFG_Select_Valid_Object,"error"),!1)},addEffectivityGridViewColumn:function(e){this.undoRegisteronNodeUpdateEvent();var t={},i=this.get("gridViewEffectivityColumns"),n=this.get("treeDocumentEffectivityGridView");n.prepareUpdate();var a=e.feature.selectionType;"Single"==a?a="Exclusive":"Multiple"==a&&(a="NonExclusive");var o=this.addFeatureColumn(i,e.feature.name,e.feature.displayName,e.feature.type,e.feature.physicalID,a);if(t[e.feature.physicalID]="",null!=e.self.options)for(var s=0;s<e.feature.options.length;s++)this.addOptionColumn(o,e.feature.options[s].name,e.feature.options[s].displayName,e.feature.name,e.feature.physicalID,e.feature.options[s].physicalID),t[e.feature.options[s].physicalID]="undefined";else this.addOptionColumn(o,e.self.name,e.self.displayName,e.feature.name,e.feature.physicalID,e.self.physicalID),t[e.self.physicalID]="undefined";var r=n.getAllDescendants();for(s=0;s<r.length;s++){var l=r[s].options.grid;0!=r[s].options.data.isAllowed&&(Object.assign(l,t),r[s].updateOptions({grid:l}))}n.pushUpdate(),this.registeronNodeUpdateEvent()},addEffectivityGridViewColumnWUX:function(e){this.undoRegisteronNodeUpdateEvent();var t={};let i=[];this.modifiedFeatureIds=[],this.modifiedOptionIds=[];var n=this.get("gridViewEffectivityColumns"),a=this.get("treeDocumentEffectivityGridView");a.prepareUpdate();var o=e.feature.selectionType;"Single"==o?o="Exclusive":"Multiple"==o&&(o="NonExclusive");var s=this.addFeatureColumn(n,e.feature.name,e.feature.displayName,e.feature.type,e.feature.physicalID,o);if(s&&s.children&&s.children.forEach((e=>{i.push(e.name)})),t[e.feature.physicalID]="",null!=e.self.options)for(var r=0;r<e.feature.options.length;r++)i.includes(e.feature.options[r].name)||(this.addOptionColumn(s,e.feature.options[r].name,e.feature.options[r].displayName,e.feature.name,e.feature.physicalID,e.feature.options[r].physicalID),t[e.feature.options[r].physicalID]="undefined");else this.addOptionColumn(s,e.self.name,e.self.displayName,e.feature.name,e.feature.physicalID,e.self.physicalID),t[e.self.physicalID]="undefined";var l=a.getAllDescendants();for(r=0;r<l.length;r++){var d=l[r].options.grid;0!=l[r].options.data.isAllowed&&(Object.assign(d,t),l[r].updateOptions({grid:d}))}a.pushUpdate(),this.registeronNodeUpdateEvent()},removeEffectivityGridViewColumn:function(e){this.undoRegisteronNodeUpdateEvent();var t={},i=this.get("gridViewEffectivityColumns"),n=this.get("treeDocumentEffectivityGridView");if(n.prepareUpdate(),null!=e.self.options){t[e.feature.physicalID]="";for(var a=0;a<e.feature.options.length;a++)t[e.feature.options[a].physicalID]=""}else t[e.self.physicalID]="";var o=n.getAllDescendants();for(a=0;a<o.length;a++){var s=o[a].options.grid;Object.keys(t).forEach((function(e,t){delete s[e]})),o[a].updateOptions({grid:s})}this.modifiedFeatureIds=[],this.modifiedOptionIds=[],null!=e.self.options?this._removeFeatureColumn(i,e.feature.physicalID):this._removeOptionColumn(i,e.self.physicalID),n.pushUpdate();var r=this;o.forEach((function(e){r.updateDisplayExpression(e)})),this.registeronNodeUpdateEvent()},_removeFeatureColumn:function(e,t){for(var i=e.length-1;i>=0;i--)if(e[i].dataIndex===t){e.splice(i,1),this.modifiedFeatureIds.push(t);break}},_removeOptionColumn:function(e,t){for(var i=e.length-1;i>=0;i--)for(var n=0;null!=e[i].children&&n<e[i].children.length;n++)if(e[i].children[n].dataIndex===t){e[i].children.splice(n,1),this.modifiedOptionIds.push(t);break}},filterColumns:function(e){console.log("filter columns")}})})),define("DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridView",["UWA/Class/View","DS/DataGridView/DataGridView","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorServices","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridViewToolbar","DS/Core/PointerEvents","DS/CfgBaseUX/scripts/CfgDialog","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgCustomAttributeUtility","DS/CfgBaseUX/scripts/CfgUXEnvVariables","i18n!DS/CfgMassVariantEffectivityEditor/assets/nls/CfgMassVariantEffectivityEditor"],(function(e,t,n,a,o,s,r,l,d,c){return e.extend({toolbar:null,processedColumns:null,isExpressionColumnAvailable:!0,init:function(e){this._parent(e)},render:async function(){"function"==typeof structuredClone?this.columnsDeepCloned=structuredClone(this.options.columns):this.columnsDeepCloned=JSON.parse(JSON.stringify(this.options.columns)),this.isMassVariant_customAttribute_Enabled=d.getCfgUXEnvVariables().isMassVariant_customAttribute_Enabled,this.massVariantGridView=new t({treeDocument:this.options.treeDocument,columns:this.columnsDeepCloned,initialEffectivitiesOfInstances:this.options.initialEffectivitiesOfInstances,selectionMode:"cell",defaultColumnDef:{width:"auto",typeRepresentation:"string",editableFlag:!0,resizableFlag:!0,sortableFlag:!1},identifier:"mass_edit_variant_DatagridView"});return this.massVariantGridView.getTypeRepresentationFactory().registerTypeTemplates({tristatetemplate:{path:"DS/CfgMassVariantEffectivityEditor/scripts/CfgTweakerTristate",options:{}}}),this.massVariantGridView.getTypeRepresentationFactory().registerTypeRepresentations({tristate:{stdTemplate:"tristatetemplate"}}),this.massVariantGridView.showEditableFeedbackFlag=!1,this.massVariantGridView.layout.rowsHeader=!0,0==n.isReadOnlyMode&&!1===n.isKarmaOdtMode()&&(a.toolbar=this.massVariantGridView.setToolbar(a.writetoolbarDefination())),this.toolbar=a.toolbar,this.toolbarExportExtentionsForCallbacks=a,this.isMassVariant_customAttribute_Enabled&&this.toolbar&&"function"==typeof this.toolbar.updateModel&&this.toolbar.updateNodeModel("ID_TableView",{visibleFlag:!0}),this.registerUpdateToolbarCommandStatesEvent(),this.registerLiveChangeEvent(),this.buildContextualMenu(),this},setToolbarStateOnPostAdd:function(){var e=[{IdValue:"ID_Plus",StateValue:!1},{IdValue:"ID_Copy",StateValue:!1},{IdValue:"ID_Duplicate",StateValue:!1},{IdValue:"ID_Minus",StateValue:!1}];null!=this.toolbar.isCopyOperationPerformed&&"YES"==this.toolbar.isCopyOperationPerformed&&e.push({IdValue:"ID_Paste",StateValue:!1}),a.setToolbarState(e)},setToolbarStateOnPostRemove:function(){if(this.massVariantGridView.treeDocument.getXSO().isEmpty()){var e=[{IdValue:"ID_Plus",StateValue:!0},{IdValue:"ID_Copy",StateValue:!0},{IdValue:"ID_Paste",StateValue:!0},{IdValue:"ID_Duplicate",StateValue:!0},{IdValue:"ID_Minus",StateValue:!0}];a.setToolbarState(e)}},registerUpdateToolbarCommandStatesEvent:function(){var e=this;this.massVariantGridView.treeDocument.getXSO().onPostAdd((function(){e.setToolbarStateOnPostAdd(e)})),this.massVariantGridView.treeDocument.getXSO().onPostRemove((function(){e.setToolbarStateOnPostRemove(e)}))},registerLiveChangeEvent:function(){if(this.toolbar){var e=this;this.toolbar.addEventListener("liveChange",(function(t){1==t.dsModel._properties.value.dirty&&e.filterColumns(t.dsModel._properties.value.value)}))}},filterColumns:function(e){for(var t=this.massVariantGridView.layout,i=this.massVariantGridView.layout.getLeafColumns(),n=0;null!=i&&n<i.length;n++)"Expression"!==i[n].name&&"instance"!==i[n].name&&void 0!==i[n].name&&(t.setColumnVisibleFlag(i[n].dataIndex,!1,{isUserInteraction:!0}),-1!=i[n].text.toUpperCase().indexOf(e.toUpperCase())&&t.setColumnVisibleFlag(i[n].dataIndex,!0,{isUserInteraction:!0}))},filterRows:function(e){this.massVariantGridView.layout;for(var t=this.options.treeDocument.getAllDescendants(),i=0;i<t.length;i++)t[i].show(),-1===t[i]._options.data.instance.name.toUpperCase().indexOf(e.toUpperCase())&&t[i].hide()},isValidNotMenuCell:function(e){if(!0===e.cellInfos.cellModel||!1===e.cellInfos.cellModel||"undefined"===e.cellInfos.cellModel)return!0},updateCellValues:function(e,t,i){var n={};if("Exclusive"==this.massVariantGridView.columns[i.parentIndex].featureType&&"undefined"!=e){var a=this.massVariantGridView.columns[i.parentIndex].children;if(void 0===a)return;for(var o="undefined",s=0;s<a.length;s++){var r=this.massVariantGridView.columns[i.parentIndex].children[s];"undefined"!=t.options.grid[r.dataIndex]&&(o=t.options.grid[r.dataIndex])}if(o!=e)for(s=0;s<a.length;s++){n[(r=this.massVariantGridView.columns[i.parentIndex].children[s]).dataIndex]="undefined"}}n[this.massVariantGridView.columns[i.parentIndex].children[i.childIndex].dataIndex]=e,t.options.data.isModified=!0,t.updateOptions({grid:n}),t.pushUpdate()},setCellValues:function(e,t){var i=this.options.treeDocument.getNthRoot(e.cellInfos.rowID);i.prepareUpdate();var n=this.getColumnFromcolumnID(e.cellInfos.columnID);if(-1!=n.childIndex){this.updateCellValues(t,i,n)}},getColumnFromcolumnID:function(e){for(var t=-1,i=null,n=-1,a=0,o=this.massVariantGridView.columns,s=0;s<o.length;s++){for(void 0===o[s].children&&t++,i=s,childrenCount=0;null!=o[s].children&&childrenCount<o[s].children.length;childrenCount++)if(e==++t){n=childrenCount,a=1;break}if(1==a)break}return{parentIndex:i,childIndex:n}},buildCellSelectionContextualMenu:function(e){var t=this,i=[];return i.push({type:"PushItem",title:c.CFG_Set_Not,fonticon:"",state:"",action:{callback:function(i){i&&i.context&&i.context.id&&t.setCellValues(e,!1)},context:{id:"NOT"}}},{type:"PushItem",title:c.CFG_Set_Selected,fonticon:"",state:"",action:{callback:function(i){i&&i.context&&i.context.id&&t.setCellValues(e,!0)},context:{id:"Select"}}},{type:"PushItem",title:c.CFG_Set_Unselected,fonticon:"",state:"",action:{callback:function(i){i&&i.context&&i.context.id&&t.setCellValues(e,"undefined")},context:{id:"Unselect"}}}),i},buildHeaderContextualMenu:function(e){var t=[];if(0==this.isExpressionColumnAvailable)return t;var i=this.massVariantGridView,n="";return 1==i.layout.getColumnVisibleFlag("Expression")&&(n={family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-check"}),"Expression"!=e.cellInfos.cellModel&&e.cellInfos.cellModel,t.push({type:"PushItem",title:c.CFG_Expression,fonticon:n,state:"",action:{callback:function(e){if(e&&e.context&&e.context.id){var t=i.layout.getColumnVisibleFlag(e.context.id);i.layout.setColumnVisibleFlag(e.context.id,!t,{isUserInteraction:!0})}},context:{id:"Expression"}}}),t},buildInformationContextualMenu:function(e){var t=[],i=this;return t.push({type:"PushItem",title:c.CFG_Information,fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-info"},state:"",action:{callback:function(t){if(t&&t.context&&t.context.id){var n=i.options.treeDocument.getNthRoot(e.cellInfos.rowID)._options.data.instance.currentEffectivityXmls.xml,a=c.Effectivity_Not_Set;""!=n&&(a=r.getDisplayExpressionUsingXSLT(n)),a=a.replace(/\n/gi,"<br/><br/>"),i.showGlobalEffectivityDialog(a,e.cellInfos.nodeModel.options.grid.instance)}},context:{id:"globalEffectivity"}}}),t},contextualMenuCall:function(e){return 1==this.isValidNotMenuCell(e)?this.buildCellSelectionContextualMenu(e):0===e.cellInfos.columnID&&null!=e.cellInfos.nodeModel?this.buildInformationContextualMenu(e):void 0===e.cellInfos.nodeModel?this.isMassVariant_customAttribute_Enabled?this.massVariantGridView.buildDefaultContextualMenu(e,{pin:!1,firstColumnsVisibility:!1,columnsManagement:!1,sizeColumnToFit:!0,insertRow:!1}):this.massVariantGridView.buildDefaultContextualMenu(e,{}):void 0},buildContextualMenu:function(){var e=this;this.massVariantGridView.onContextualEvent=function(t){return e.contextualMenuCall(t)}},cssAdjustmentsForLayout:function(e){e?this.massVariantGridView.getContent(".wux-layouts-collectionview").setStyle("top","48px"):this.massVariantGridView.getContent(".wux-layouts-collectionview").setStyle("top","34px")},refreshColumns:function(e,t,i,n){if(this.isMassVariant_customAttribute_Enabled){var a=this.massVariantGridView.layout.getColumnVisibleFlag("Expression");if(t)if(i.length>0){let e=this.massVariantGridView.columns.filter((e=>e.dataIndex===i[0]));e.length>0&&this.massVariantGridView.removeColumnOrGroup(e[0])}else n.length>0&&this.massVariantGridView.columns.map((e=>{if("Feature"===e.columnType){let t=e.children.filter((e=>e.dataIndex===n[0]));t.length>0&&this.massVariantGridView.removeColumnOrGroup(t[0]),e.children||this.massVariantGridView.removeColumnOrGroup(e)}}));else e.forEach((e=>{let t=this.isColumnExist(this.massVariantGridView.columns,e);t||this.massVariantGridView.addColumnOrGroup(e),t&&n.length>0&&e.children&&this.massVariantGridView.addColumnOrGroup(e)}));this.massVariantGridView.layout.applyColumns(),this.massVariantGridView.layout.setColumnVisibleFlag("Expression",a,{isUserInteraction:!0})}else{var o=JSON.parse(JSON.stringify(e));a=this.massVariantGridView.layout.getColumnVisibleFlag("Expression");this.massVariantGridView.columns=o,this.massVariantGridView.layout.setColumnVisibleFlag("Expression",a,{isUserInteraction:!0})}},isColumnExist:function(e,t){let n=!1;for(i=0;i<e.length;i++)if(e[i].dataIndex===t.dataIndex){n=!0;break}return n},updateVisibilityFlag:function(e){e.forEach((e=>{e.children&&e.children.forEach((e=>{e.alwaysVisibleFlag="true"}))}))},showGlobalEffectivityDialog:function(e,t){var i={width:481,height:212,dialogue:{header:c.Current_Variant_Effectivity+" - "+t,buttonArray:[],target:widget.body,object:null,postCloseHandler:null}},n=new s(i);n.render(),n.container.setStyle("overflow","auto"),n.container.setHTML(e)}})})),define("DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorModelsCollection",["UWA/Class/Collection","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorModel","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorServices","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgUtility","i18n!DS/CfgMassVariantEffectivityEditor/assets/nls/CfgMassVariantEffectivityEditor"],(function(e,t,i,n,a,o){return e.extend({model:t,attachedModels:[],selectedInstances:[],evolutionXmlsPerModel:{contextsFilterXML:[]},evolutionExpression:"",init:function(e){this._parent(e)},setEvolutionExpression:function(e){this.evolutionExpression=e,this.evolutionXmlsPerModel=n.EvolutionXMLtoJSONforFilterVariant(e)},getEvolutionExpressionFromModelName:function(e){Array.isArray(e)&&(e=e[0]);var t="";if(this.evolutionExpression)for(var i=0;i<this.evolutionXmlsPerModel.contextsFilterXML.length;i++)if(this.evolutionXmlsPerModel.contextsFilterXML[i].name==e){t=this.evolutionXmlsPerModel.contextsFilterXML[i].expression;break}return t},setSelectedInstances:function(e){evolutionXmlsPerModel=this.selectedInstances=e},setAttachedModels:function(e){this.attachedModels=e},initialiseModels:function(){for(var e=0;e<this.attachedModels.length;e++){var i=new t({id:this.attachedModels[e].physicalId,treeDocumentEffectivityGridView:null,gridViewEffectivityColumns:[],configurationContext:this.attachedModels[e],selectedInstances:this.selectedInstances});this.add(i)}},getProbesInfoDetailsWithXML:function(){let e=[],t=this.processJsonToXml("XML");for(let t=0;t<this.length;t++){let i=this.at(t),n=this.at(t).get("dictionary");null!=n&&e.push({currentModelId:i.id,currentModelFeatures:n})}return n.getProbesMassVariantCriteria(t,e)},resetCommandClickProbesData:function(){for(let e=0;e<this.length;e++)this.at(e).probesData=[]},processJsonToXml:function(e){for(var t={},n=0;n<this.length;n++){var o=this.at(n).get("gridViewEffectivityColumns");if(null!=this.at(n).get("treeDocumentEffectivityGridView"))for(var s=this.at(n).get("treeDocumentEffectivityGridView").getAllDescendants(),r=this.at(n).get("configurationContext"),l="",d=0,c=0;c<s.length;c++)if(0!=s[c].options.data.isAllowed){var u=this.at(n).getORConditionXML(o,s[c],e);if(""!=u&&d++,l+=u,null==s[c+1]||s[c].options.data.instance.instanceId!=s[c+1].options.data.instance.instanceId){d>1&&(l="<OR>"+l+"</OR>"),d=0;var f="";f="XML"==e?r.name:a.escapeSpecialCharacters(r.displayName),""!=l&&(l=i.buildContext(f,l)),void 0===t[s[c].options.data.instance.instanceId]&&(t[s[c].options.data.instance.instanceId]={xmls:[],data:s[c].options.data}),t[s[c].options.data.instance.instanceId].xmls.push(l),l=""}}}var p={};for(var h in t)if(t.hasOwnProperty(h)){for(var g="",v=t[h].xmls,m=0;m<v.length;m++)g+=v[m];v.length>1&&""!=g&&(g="<MultiContextView>"+g+"</MultiContextView>"),""!=g&&(g=i.buildGlobalExpression(g)),p[h]={xml:g,data:t[h].data}}return p},initiateCurrentEffectivityXmls:function(){for(var e=this.processJsonToXml("TXT"),t=0;t<this.length;t++)if(null!=this.at(t).get("treeDocumentEffectivityGridView")){var i=this.at(t).get("treeDocumentEffectivityGridView").getAllDescendants();for(cnt=0;cnt<i.length;cnt++)i[cnt].options.data.instance.currentEffectivityXmls=e[i[cnt].options.data.instance.instanceId]}},getModifiedInstances:function(){for(var e=[],t=0;t<this.length;t++)if(null!=this.at(t).get("treeDocumentEffectivityGridView")){var i=this.at(t).get("treeDocumentEffectivityGridView").getAllDescendants();for(cnt=0;cnt<i.length;cnt++){if(1==i[cnt].options.data.isModified)-1==e.indexOf(i[cnt].options.data.instance.instanceId)&&e.push(i[cnt].options.data.instance.instanceId)}}return e},resetModifiedInstances:function(){for(var e=0;e<this.length;e++)if(null!=this.at(e).get("treeDocumentEffectivityGridView")){var t=this.at(e).get("treeDocumentEffectivityGridView").getAllDescendants();for(cnt=0;cnt<t.length;cnt++)t[cnt].options.data.isModified=!1}}})})),define("DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEffectivityEditorLayout",["UWA/Class/View","DS/Handlebars/Handlebars4","DS/CfgBaseUX/scripts/CfgSliderView","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEffectivityEditorModelSelector","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridView","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorServices","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorModelsCollection","DS/Utilities/TouchUtils","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgFeatureOptionsView","DS/CfgTracker/CfgTracker","DS/CfgTracker/CfgDimension","DS/CfgTracker/CfgValue","DS/CfgBaseUX/scripts/CfgUXEnvVariables","DS/ENOCustomAttributeUtils/scripts/CustomAttributeUtils","DS/CfgBaseUX/scripts/CfgCustomAttributeUtility","i18n!DS/CfgMassVariantEffectivityEditor/assets/nls/CfgMassVariantEffectivityEditor","css!DS/CfgMassVariantEffectivityEditor/assets/styles/CfgMassVariantEffectivityEditor.css"],(function(e,t,i,n,a,o,s,r,l,d,c,u,f,p,h,g,v){"use strict";var m={gridView:null,featureOptionsView:null,sliderView:null,collection:null,render:function(e){this.options=e,o.isReadOnlyMode=!1,this.isWebUXAutocompleteEnabled=p.getCfgUXEnvVariables().isWebUXAutocompleteEnabled,this.isMassVariant_customAttribute_Enabled=p.getCfgUXEnvVariables().isMassVariant_customAttribute_Enabled,!0===o.isKarmaOdtMode()&&(o.isReadOnlyMode=!1),this.collection=new s;var t=o.processAttachedModels(e.attachedModels);return this.collection.setAttachedModels(t),this.collection.setSelectedInstances(e.selectedInstances),this.collection.setEvolutionExpression(e.evolutionExpression),this.collection.initialiseModels(),this.buildSelector(),this.buildSlider(),o.getFilterablesVariantGrid(t[0].physicalId,e.selectedInstances).then((async function(i){var n=m.collection.at(0);if(!0===m.isMassVariant_customAttribute_Enabled){let t=e.selectedInstances.map((e=>e.referenceId)),n=await g.getExtensions(t);i.extenstionsList=n}n.createColumns(i),n.createTreeDocument(i),n.launchCustomViewManager=m.launchCustomViewManager,m.initialiseGridView(),m.sliderView.clearRightLayout(),m.sliderView.disableRightLayout(),o.loadDictionary(n,m.collection,m.onLoadDictionaryComplete,m.options.attachedModels.isEvolutionBasedOn,e.parentID,e.WorkUnderDetails,m.options.attachedModels.onlyModelVersion),1==t.length?m.collection.initiateCurrentEffectivityXmls():m.loadNextModelsEffectivitiesAsyncronously(t,e)}),(function(e){console.log(e),l.isDefined(e)&&l.isDefined(e.errorMessage)&&l.showwarning(e.errorMessage,"error"),m.sliderView.clearLeftLayout(),m.sliderView.clearRightLayout(),m.sliderView.disablePrimaryButtons()})),m},loadNextModelsEffectivitiesAsyncronously:function(e,t){for(var i=[],n=1;n<e.length;n++)i.push(o.getFilterablesVariantGrid(e[n].physicalId,t.selectedInstances));Promise.all(i).then((function(e){for(var t=0;t<e.length;t++)if(null!=e[t].criterias){var i=e[t].criterias.modelPID,n=m.collection.get(i);n.createColumns(e[t]),n.createTreeDocument(e[t])}m.collection.initiateCurrentEffectivityXmls()}))},initialiseGridView:function(){this.buildGridView()},onLoadDictionaryComplete:function(e){m.buildfeatureOptionView(e);var t=m.collection.get(e);m.featureOptionsView.selectColumns(t.get("gridViewEffectivityColumns")),m.modelSelector.enable()},onToolbarClickCallback:function(e){"ID_USERSETTINGS"==e._event&&m.isMassVariant_customAttribute_Enabled&&h.launchCustomViewManager(m.featureOptionsView.custom_view_options)},onColumnManagerComplete:function(e){"SAVE"==e._event&&m.featureOptionsView.updateColumnsFromSettings(),m.buildfeatureOptionView(m.currentSelectedModelId)},buildfeatureOptionView:async function(e){var t=this.collection.get(e),i={treeDocument:t.get("treeDocumentVariantView"),onFeatureOptionSelectionChange:this.onFeatureOptionSelectionChange,features:t.get("dictionary"),onToolbarClickCallback:m.onToolbarClickCallback};this.featureOptionsView=new d(i),await this.featureOptionsView.render(),this.featureOptionsView.setColumnRemoveWarningToShow(!0);let n={dgvDiv:this.sliderView._rightPanel.getElement(".gridViewContainer"),ootb_columns:[...this.featureOptionsView.featureOptionGridView.columns],dgvHandle:this.featureOptionsView.featureOptionGridView,settings:{url:enoviaServerFilterWidget.baseURL,securityContext:enoviaServerFilterWidget.mySecurityContext,refRequired:!1,isNative:enoviaServerFilterWidget.isNative,iterateRootNodesOnly:!1,tenant:enoviaServerFilterWidget.tenant}};if(this.featureOptionsView.custom_view_options=n,g.registerCustomEventsOnDGV(this.featureOptionsView.custom_view_options),localStorage.getItem("wux-collectionView-dataGridView")){let e=JSON.parse(localStorage.getItem("wux-collectionView-dataGridView"))[this.featureOptionsView.custom_view_options.dgvHandle.identifier];e&&e.customViews&&(e.currentCustomViewIdentifier=e.currentCustomViewId,h.restoreCustomViews(e,this.featureOptionsView.custom_view_options))}this.featureOptionsView.featureOptionGridView.getCustomViewsManager().onCustomViewsSave=(e,t)=>{h.applyCustomAttributes(e,t,this.featureOptionsView.custom_view_options)},this.sliderView.clearRightLayout(),this.sliderView.setRightView(this.featureOptionsView.featureOptionGridView,this.featureOptionsView.toolbar);var a=r.getTouchMode();0==o.isReadOnlyMode&&this.featureOptionsView.cssAdjustmentsForLayout(a)},onFeatureOptionSelectionChange:function(e,t){m.gridView.toolbar.isCopyOperationPerformed="NO",m.gridView.toolbar.currentModel.set("copiedInstances",[]),m.gridView.options.treeDocument.unselectAll();var i=m.collection.get(m.modelSelector._wuxComboBox.currentValue.physicalId);0==t?(i.probesData.push("Edit_Variant_Effectivity_Mass_Add_Feature_Options"),m.isWebUXAutocompleteEnabled?i.addEffectivityGridViewColumnWUX(e):i.addEffectivityGridViewColumn(e)):(i.probesData.push("Edit_Variant_Effectivity_Mass_Remove_Feature_Options"),i.removeEffectivityGridViewColumn(e)),m.refreshDataGridView(m.modelSelector._wuxComboBox.currentValue.physicalId,t,i.modifiedFeatureIds,i.modifiedOptionIds)},refreshDataGridView:function(e,t,i,n){var a=null;a=void 0===e?this.collection.at(0):this.collection.get(e),this.gridView.refreshColumns(a.get("gridViewEffectivityColumns"),t,i,n)},buildSlider:function(){var e=!0;1==o.isReadOnlyMode&&(e=!1);var t={isReadOnlyMode:o.isReadOnlyMode,position:"absolute",gridpadding:"0px",leftHeader:v.GridHeader,rightHeader:v.DictionaryHeader,Apply:v.ApplyAndClose,Verify:v.Apply,Cancel:v.Cancel,onButtonClickCB:this.onButtonClickCB,isRightFooter:!1,isLeftFooter:e,headerControl:this.modelSelector._wuxComboBox,headerText:this.modelSelector._text,parent:this.options.parent,cfgVarDialog:this.options.cfgVarDialog};null!=this.options.WorkUnderDetails&&this.options.WorkUnderDetails.length>0&&delete t.Verify,this.sliderView=new i(t).render()},buildSelector:function(){var e={onChangeCB:this.onHeaderControlChangeCB,data:this.collection.attachedModels};this.modelSelector=new n(e),this.modelSelector.render(),this.modelSelector.disable()},buildGridView:function(e){var t=null;t=void 0===e?this.collection.at(0):this.collection.get(e),m.currentSelectedModelId=t.id;var i={treeDocument:t.get("treeDocumentEffectivityGridView"),columns:t.get("gridViewEffectivityColumns"),context:t.get("configurationContext"),initialEffectivitiesOfInstances:t.get("initialEffectivitiesOfInstances"),selectedInstances:this.options.selectedInstances,updateColumnsCallback:this.updateColumnsCallback};if(this.gridView=new a(i),this.gridView.render(),this.isMassVariant_customAttribute_Enabled){let e={dgvDiv:this.sliderView._leftPanel.getElement(".gridViewContainer"),ootb_columns:[...this.gridView.columnsDeepCloned],dgvHandle:this.gridView.massVariantGridView,settings:{url:enoviaServerFilterWidget.baseURL,securityContext:enoviaServerFilterWidget.mySecurityContext,refRequired:!0,isNative:enoviaServerFilterWidget.isNative,iterateRootNodesOnly:!1,tenant:enoviaServerFilterWidget.tenant}};if(this.custom_view_options=e,g.registerCustomEventsOnDGV(this.custom_view_options),localStorage.getItem("wux-collectionView-dataGridView")){let e=JSON.parse(localStorage.getItem("wux-collectionView-dataGridView"))[this.custom_view_options.dgvHandle.identifier];e&&e.customViews&&(e.currentCustomViewIdentifier=e.currentCustomViewId,h.restoreCustomViews(e,this.custom_view_options).then((async()=>{let e=this.options.selectedInstances.map((e=>e.referenceId));g.getValuesForReferenceAttributes(this.custom_view_options,e)})))}this.gridView.massVariantGridView.getCustomViewsManager().onCustomViewsSave=async(e,t)=>{await h.applyCustomAttributes(e,t,this.custom_view_options);let i=this.options.selectedInstances.map((e=>e.referenceId));g.getValuesForReferenceAttributes(this.custom_view_options,i)}}this.sliderView.clearLeftLayout(),this.sliderView.setLeftView(this.gridView.massVariantGridView,this.gridView.toolbar),null!=this.gridView.toolbar&&(this.gridView.toolbar.currentModel=t);var n=r.getTouchMode();1==o.isReadOnlyMode?this.modelSelector.enable():this.gridView.cssAdjustmentsForLayout(n)},launchCustomViewManager:function(){h.launchCustomViewManager(m.custom_view_options)},updateColumnsCallback:function(e){var t=m.collection.get(m.modelSelector._wuxComboBox.currentValue.physicalId);let i=t.get("gridViewEffectivityColumns"),n=i.map((e=>e.dataIndex));e.forEach((e=>{n.includes(e.dataIndex)||i.push(e)})),m.gridView.refreshColumns(t.get("gridViewEffectivityColumns"))},onHeaderControlChangeCB:function(e){m.refreshView(e.physicalId)},refreshView:function(e){var t=m.collection.get(e);(o.loadDictionary(t,m.collection,m.onLoadDictionaryComplete,m.options.attachedModels.isEvolutionBasedOn,m.options.parentID,m.options.WorkUnderDetails),null==t.get("treeDocumentEffectivityGridView"))?(m.modelSelector.disable(),o.getFilterablesVariantGrid(e,m.options.selectedInstances).then((function(t){var i=m.collection.get(e);i.createColumns(t),i.createTreeDocument(t),m.buildGridView(e),m.modelSelector.enable()}))):(m.buildGridView(e),m.modelSelector.enable())},sendEditVariantTrackerEvent:function(e){let t="",i="",n=e.noOfContext,a=e.noOfReference,o=e.totalVariantLength,s=e.totalVariantValueLength,r=e.totalOptionGroupLength,l=e.totalOptionLength,d=e.totalNotOperatorLength,p=e.variantComplexity,h=e.totalFeaturesLength,g=e.totalFeatureOptionsLength;"Native"==e.mode?(t="Native",i="Web In Win"):(t=widget.data.appId,i=null!=widget.options?widget.options.title:"ODT Environment");let v=c.getDeviceUsedForOperation(),m=c.ConfigOperationMode.CREATE;"Edit"==e.variantMode&&(m=c.ConfigOperationMode.EDIT);let C=c.AuthoringMode.EMPTY;"Empty"!=e.authoringMode&&(C=c.AuthoringMode[e.authoringMode]);let y=c.EditVariantMode.MULTIPLE;c.createEventBuilder({category:c.Category.USAGE,action:c.Events.CLICK,tenant:enoviaServerFilterWidget.tenant}).setLabel(c.Labels.EDIT_VARIANT_EFFECTIVITY).setAppId(t).addDimension(u.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_EFFECTIVITY_WIDGET,i).addDimension(u.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_EFFECTIVITY_MEDIA,v).addDimension(u.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_EFFECTIVITY_MODE,m).addDimension(u.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_AUTHORING_MODE,C).addDimension(u.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_EFFECTIVITY_TYPE_MODE,y).addPersonalValue(f.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_NO_OF_MODEL,n).addPersonalValue(f.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_REFERENCE_SELECTED,a).addPersonalValue(f.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_TOTAL_NO_VARIANT,o).addPersonalValue(f.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_TOTAL_NO_VARIANT_VALUE,s).addPersonalValue(f.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_TOTAL_NO_OPTION_GROUP,r).addPersonalValue(f.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_TOTAL_NO_OPTION,l).addPersonalValue(f.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_TOTAL_NO_NOT_OPERATOR,d).addPersonalValue(f.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_COMPLEXITY,p).addPersonalValue(f.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_DICTIONARY_FEATURES,h).addPersonalValue(f.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_DICTIONARY_FEATURE_OPTIONS,g).send()},callEditVariantTrackerEvent:function(e){let t={noOfContext:m.collection.length,mode:"Dashboard"};"Native"==e.mode&&(t.mode="Native"),t.variantMode="Create",e.modifiedInstances.length>0&&(t.variantMode="Edit"),t.authoringMode="Empty",m.options.WorkUnderDetails.length>0&&("DS-Change-Authoring-Context"==m.options.WorkUnderDetails[0].key?t.authoringMode="CHANGE":"DS-Configuration-Authoring-Context"==m.options.WorkUnderDetails[0].key&&(t.authoringMode="EVOLUTION")),t.noOfReference=m.options.selectedInstances.length;let i=m.collection.getProbesInfoDetailsWithXML();t.totalVariantLength=i.totalVariantLength,t.totalVariantValueLength=i.totalVariantValueLength,t.totalOptionGroupLength=i.totalOptionGroupLength,t.totalOptionLength=i.totalOptionLength,t.totalNotOperatorLength=i.totalNotOperatorLength,t.variantComplexity=i.variantComplexity,t.totalFeaturesLength=i.totalFeaturesLength,t.totalFeatureOptionsLength=i.totalFeatureOptionsLength,m.sendEditVariantTrackerEvent(t)},callCommandClickTrackerEvent:function(e){let t="Native",i="Rich Client Applications",n="DASHBOARD";if(widget&&widget.data&&widget.data.appId&&(t=widget.data.appId),widget&&widget.options&&widget.options.title&&(i=widget.options.title),"OK"==e.operation)for(let e=0;e<m.collection.length;e++)for(let a=0;a<m.collection.at(e).probesData.length;a++){let o={AppId:t,AppName:i,CommandOperation:m.collection.at(e).probesData[a],CommandName:c.Labels.EDIT_VARIANT_EFFECTIVITY,ConfigMode:c.ConfigMode.CONTEXTUAL,ApplicationMode:n};l.sendConfgurationCommandsClickEventForMagicProbes(o)}else{let e={AppId:t,AppName:i,CommandOperation:"Edit_Variant_Mass_Cancel",CommandName:c.Labels.EDIT_VARIANT_EFFECTIVITY,ConfigMode:c.ConfigMode.CONTEXTUAL,ApplicationMode:n};l.sendConfgurationCommandsClickEventForMagicProbes(e)}},onButtonClickCB:function(e){var t={};if("leftVerify"==e.buttonId||"leftApply"==e.buttonId){null!=m.gridView.toolbar&&(m.gridView.toolbar.isCopyOperationPerformed="NO",m.gridView.toolbar.currentModel.set("copiedInstances",[]),m.gridView.options.treeDocument.unselectAll()),t=m.collection.processJsonToXml("XML");var i=m.collection.getModifiedInstances();m.sliderView.disableRightLayout(),m.sliderView.disableLeftLayout(),"leftVerify"==e.buttonId?o.setEffectivity(t,i,m.enableLayout,m.options.PADContext,m.collection):o.setEffectivity(t,i,m.destroyLayout,m.options.PADContext,m.collection),m.callEditVariantTrackerEvent({mode:"Dashboard",modifiedInstances:i}),m.callCommandClickTrackerEvent({mode:"Dashboard",operation:"OK"})}else if("touch"==e.buttonId){var n=r.getTouchMode();r.setTouchMode(!n),m.gridView.cssAdjustmentsForLayout(!n),0==o.isReadOnlyMode&&m.featureOptionsView.cssAdjustmentsForLayout(!n)}else"leftCancel"==e.buttonId&&m.callCommandClickTrackerEvent({mode:"Dashboard",operation:"Cancel"})},destroyLayout:function(){m.sliderView.destroyLayout()},enableLayout:function(){m.sliderView.enableButtons()}};return m}));