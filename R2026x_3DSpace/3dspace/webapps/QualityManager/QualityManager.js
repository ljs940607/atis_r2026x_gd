!function(){var e=["UWA/Core","UWA/Class"];"file:"!==window.location.protocol&&e.push("text!DS/QualityManager/assets/mdl_GIVisualQualityPresets.json"),define("DS/QualityManager/QMGIPresetStreamer",e,(function(e,t,r){"use strict";return t.singleton({init:function(){this.GIQualityPresets=this.getQualityPresets(),e.is(this.GIQualityPresets)},setItem:function(t,r){if(e.is(localStorage)&&e.is(this.GIQualityPresets))for(var i=this.GIQualityPresets,s=t.split("/"),n=s.length,o=0;o<n;o++)o==n-1?e.is(i)&&(i[s[o]]=r):e.is(i)&&(i=i[s[o]])},getItem:function(t){if(!e.is(localStorage)||!e.is(this.GIQualityPresets))return null;for(var r=this.GIQualityPresets,i=t.split("/"),s=i.length,n=0;n<s;n++)e.is(r)&&(r=r[i[n]]);return r},getQualityPresets:function(){var t=null;if(!e.is(localStorage))return t;var r=localStorage.getItem("GIQualityPresets");if(e.is(r))try{t=JSON.parse(r)}catch(e){console.error("Error parsing GIQualityPresets:",e)}else t=this.buidQualityPresets();return t},commit:function(){e.is(localStorage)&&e.is(this.GIQualityPresets)&&localStorage.setItem("GIQualityPresets",JSON.stringify(this.GIQualityPresets))},retoreDB:function(){this.GIQualityPresets=this.getQualityPresets()},buidQualityPresets:function(){return this.GIQualityPresets=r?JSON.parse(r):null,e.is(this.GIQualityPresets)&&this.commit(),this.GIQualityPresets}})}))}(),define("DS/QualityManager/QMPresetStreamer",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS"],(function(e,t,r){"use strict";const i={AntiAliasing:{AntiAliasing:"NoAA"},PixelCulling:{PixelCulling:5},LOD:{LOD:.5},Transparency:{Transparency:"AlphaBlending"},Shadows:{AllowGroundShadows:!1,AllowInterObjectShadows:!1,AllowTransparentObjectShadows:!1,ShadowFilter:"PCFOptimized",ShadowQuality:"Low"},Reflections:{AllowGroundReflection:!1,AllowInterObjectReflections:!1},Refractions:{AllowInterObjectRefractions:!1},AmbientOcclusion:{AmbientOcclusionNbSamples:0},DepthBufferOptions:{DepthFlickeringReduction:!1},Material:{FlakesQuality:"Low",DefaultMaterialQuality:"Low"},Downsampling:{Downsampling:1},SectionCapping:{SectionCapping:r.EffectState.Auto}},s={DBVersion:0,DBRevision:0,Users:{Default:{currentPreset:"Static",isLinked:!1,Batching:!1,Preset:{Static:{currentGlobalPreset:"Default",Low:{AntiAliasing:{AntiAliasing:"NoAA"},PixelCulling:{PixelCulling:5},LOD:{LOD:.5},Transparency:{Transparency:"AlphaBlending"},Shadows:{AllowGroundShadows:!1,AllowInterObjectShadows:!1,AllowTransparentObjectShadows:!1,ShadowFilter:"PCFOptimized",ShadowQuality:"Low"},Reflections:{AllowGroundReflection:!1,AllowInterObjectReflections:!1},Refractions:{AllowInterObjectRefractions:!1},AmbientOcclusion:{AmbientOcclusionNbSamples:0},DepthBufferOptions:{DepthFlickeringReduction:!1},Material:{FlakesQuality:"Low",DefaultMaterialQuality:"Low"},Downsampling:{Downsampling:1},SectionCapping:{SectionCapping:r.EffectState.Enabled}},Medium:{AntiAliasing:{AntiAliasing:"SMAA"},PixelCulling:{PixelCulling:4.5},LOD:{LOD:.5},Transparency:{Transparency:"AlphaBlending"},Shadows:{AllowGroundShadows:!0,AllowInterObjectShadows:!0,AllowTransparentObjectShadows:!0,ShadowFilter:"PCFOptimized",ShadowQuality:"Low"},Reflections:{AllowGroundReflection:!1,AllowInterObjectReflections:!1},Refractions:{AllowInterObjectRefractions:!1},AmbientOcclusion:{AmbientOcclusionNbSamples:0},DepthBufferOptions:{DepthFlickeringReduction:!1},Material:{FlakesQuality:"Low",DefaultMaterialQuality:"Low"},Downsampling:{Downsampling:1},SectionCapping:{SectionCapping:r.EffectState.Enabled}},High:{AntiAliasing:{AntiAliasing:"SMAA"},PixelCulling:{PixelCulling:4},LOD:{LOD:.5},Transparency:{Transparency:"AlphaBlending"},Shadows:{AllowGroundShadows:!0,AllowInterObjectShadows:!0,AllowTransparentObjectShadows:!0,ShadowFilter:"PCFOptimized",ShadowQuality:"Medium"},Reflections:{AllowGroundReflection:!0,AllowInterObjectReflections:!1},Refractions:{AllowInterObjectRefractions:!1},AmbientOcclusion:{AmbientOcclusionNbSamples:16},DepthBufferOptions:{DepthFlickeringReduction:!1},Material:{FlakesQuality:"Medium",DefaultMaterialQuality:"High"},Downsampling:{Downsampling:1},SectionCapping:{SectionCapping:r.EffectState.Enabled}},Ultra:{AntiAliasing:{AntiAliasing:"SMAA"},PixelCulling:{PixelCulling:2},LOD:{LOD:.5},Transparency:{Transparency:"WeightedAverage"},Shadows:{AllowGroundShadows:!0,AllowInterObjectShadows:!0,AllowTransparentObjectShadows:!0,ShadowFilter:"PCFOptimized",ShadowQuality:"High"},Reflections:{AllowGroundReflection:!0,AllowInterObjectReflections:!0},Refractions:{AllowInterObjectRefractions:!0},AmbientOcclusion:{AmbientOcclusionNbSamples:32},DepthBufferOptions:{DepthFlickeringReduction:!1},Material:{FlakesQuality:"High",DefaultMaterialQuality:"High"},Downsampling:{Downsampling:1},SectionCapping:{SectionCapping:r.EffectState.Enabled}},Custom:{AntiAliasing:{Preset:"Medium",AntiAliasing:"SMAA"},PixelCulling:{Preset:"Medium",PixelCulling:4.5},LOD:{Preset:"Medium",LOD:.5},Transparency:{Preset:"Medium",Transparency:"AlphaBlending"},Shadows:{Preset:"Medium",AllowGroundShadows:!0,AllowInterObjectShadows:!0,AllowTransparentObjectShadows:!0,ShadowFilter:"PCFOptimized",ShadowQuality:"Medium"},Reflections:{Preset:"Medium",AllowGroundReflection:!0,AllowInterObjectReflections:!1},Refractions:{Preset:"Medium",AllowInterObjectRefractions:!1},AmbientOcclusion:{Preset:"Medium",AmbientOcclusionNbSamples:16},DepthBufferOptions:{Preset:"Medium",DepthFlickeringReduction:!1},Material:{Preset:"Medium",FlakesQuality:"Medium",DefaultMaterialQuality:"High"},Downsampling:{Preset:"Medium",Downsampling:1},SectionCapping:{SectionCapping:r.EffectState.Enabled}}},Dynamic:{currentGlobalPreset:"Default",Low:{AntiAliasing:{AntiAliasing:"NoAA"},PixelCulling:{PixelCulling:6},LOD:{LOD:3},Transparency:{Transparency:"AlphaBlending"},Shadows:{AllowGroundShadows:!1,AllowInterObjectShadows:!1,AllowTransparentObjectShadows:!1,ShadowFilter:"PCFOptimized",ShadowQuality:"Low"},Reflections:{AllowGroundReflection:!1,AllowInterObjectReflections:!1},Refractions:{AllowInterObjectRefractions:!1},AmbientOcclusion:{AmbientOcclusionNbSamples:0},DepthBufferOptions:{DepthFlickeringReduction:!1},Material:{FlakesQuality:"Low"},Downsampling:{},SectionCapping:{SectionCapping:r.EffectState.Auto}},Medium:{AntiAliasing:{AntiAliasing:"SMAA"},PixelCulling:{PixelCulling:4.5},LOD:{LOD:3},Transparency:{Transparency:"AlphaBlending"},Shadows:{AllowGroundShadows:!0,AllowInterObjectShadows:!0,AllowTransparentObjectShadows:!0,ShadowFilter:"PCFOptimized",ShadowQuality:"Low"},Reflections:{AllowGroundReflection:!1,AllowInterObjectReflections:!1},Refractions:{AllowInterObjectRefractions:!1},AmbientOcclusion:{AmbientOcclusionNbSamples:0},DepthBufferOptions:{DepthFlickeringReduction:!1},Material:{FlakesQuality:"Low"},Downsampling:{},SectionCapping:{SectionCapping:r.EffectState.Auto}},High:{AntiAliasing:{AntiAliasing:"SMAA"},PixelCulling:{PixelCulling:4},LOD:{LOD:.5},Transparency:{Transparency:"AlphaBlending"},Shadows:{AllowGroundShadows:!0,AllowInterObjectShadows:!0,AllowTransparentObjectShadows:!0,ShadowFilter:"PCFOptimized",ShadowQuality:"Medium"},Reflections:{AllowGroundReflection:!0,AllowInterObjectReflections:!1},Refractions:{AllowInterObjectRefractions:!1},AmbientOcclusion:{AmbientOcclusionNbSamples:16},DepthBufferOptions:{DepthFlickeringReduction:!1},Material:{FlakesQuality:"Medium"},Downsampling:{},SectionCapping:{SectionCapping:r.EffectState.Auto}},Ultra:{AntiAliasing:{AntiAliasing:"SMAA"},PixelCulling:{PixelCulling:2},LOD:{LOD:.5},Transparency:{Transparency:"WeightedAverage"},Shadows:{AllowGroundShadows:!0,AllowInterObjectShadows:!0,AllowTransparentObjectShadows:!0,ShadowFilter:"PCFOptimized",ShadowQuality:"High"},Reflections:{AllowGroundReflection:!0,AllowInterObjectReflections:!0},Refractions:{AllowInterObjectRefractions:!0},AmbientOcclusion:{AmbientOcclusionNbSamples:32},DepthBufferOptions:{DepthFlickeringReduction:!1},Material:{FlakesQuality:"High"},Downsampling:{},SectionCapping:{SectionCapping:r.EffectState.Auto}},Custom:{AntiAliasing:{Preset:"Medium",AntiAliasing:"SMAA"},PixelCulling:{Preset:"Medium",PixelCulling:4.5},LOD:{Preset:"Medium",LOD:3},Transparency:{Preset:"Medium",Transparency:"AlphaBlending"},Shadows:{Preset:"Medium",AllowGroundShadows:!0,AllowInterObjectShadows:!0,AllowTransparentObjectShadows:!0,ShadowFilter:"PCFOptimized",ShadowQuality:"Medium"},Reflections:{Preset:"Medium",AllowGroundReflection:!0,AllowInterObjectReflections:!1},Refractions:{Preset:"Medium",AllowInterObjectRefractions:!1},AmbientOcclusion:{Preset:"Medium",AmbientOcclusionNbSamples:32},DepthBufferOptions:{Preset:"Medium",DepthFlickeringReduction:!1},Material:{Preset:"Medium",FlakesQuality:"Medium"},Downsampling:{Preset:"Medium"},SectionCapping:{SectionCapping:r.EffectState.Auto}}}}}}},n=new Map;return t.singleton({init:function(){this.databaseKey=null,this.qualityPresets=null},initDataBase:function(t){this.databaseKey=t,null==this.databaseKey&&(this.databaseKey="default_qualityPresets"),this.qualityPresets=this.getQualityPresets(),e.is(this.qualityPresets)},setItem:function(t,r){if(e.is(localStorage)&&e.is(this.qualityPresets))for(var i=this.qualityPresets,s=t.split("/"),n=s.length,o=0;o<n;o++)o==n-1?e.is(i)&&(i[s[o]]=r):e.is(i)&&(i=i[s[o]])},_addItem:function(t,r){if(e.is(localStorage)&&e.is(this.qualityPresets))for(var i=this.qualityPresets,s=t.split("/"),n=s.length,o=0;o<n;o++)o==n-1?(e.is(i[s[o]])||(i[s[o]]={}),i[s[o]]=r):(e.is(i[s[o]])||(i[s[o]]={}),i=i[s[o]])},_renameItem:function(e,t){let r=this.getItem(e);null!=r&&(this._addItem(t,r),this._removeItem(e))},_removeItem:function(t){if(e.is(localStorage)&&e.is(this.qualityPresets))for(var r=this.qualityPresets,i=t.split("/"),s=i.length,n=0;n<s;n++)if(n==s-1){if(!e.is(r[i[n]]))break;delete r[i[n]]}else{if(!e.is(r[i[n]]))break;r=r[i[n]]}},getItem:function(t){if(!e.is(localStorage)||!e.is(this.qualityPresets))return null;for(var r=this.qualityPresets,i=t.split("/"),s=i.length,n=0;n<s&&e.is(r);n++)r=r[i[n]];return r},getQualityPresets:function(){var t=null;if(!e.is(localStorage))return t;var r=localStorage.getItem(this.databaseKey);if(e.is(r))try{t=JSON.parse(r)}catch(e){console.error("Error parsing qualityPresets:",e)}else t=this.buidQualityPresets();return t},commit:function(){e.is(localStorage)&&e.is(this.qualityPresets)&&localStorage.setItem(this.databaseKey,JSON.stringify(this.qualityPresets))},retoreDB:function(){this.qualityPresets=this.getQualityPresets()},buidQualityPresets:function(){return this.qualityPresets=JSON.parse(JSON.stringify(s)),e.is(this.qualityPresets)&&this.commit(),this.qualityPresets},_restorePresetsFromBase:function(e){var t=JSON.parse(JSON.stringify(s.Users.Default)).Preset;this.qualityPresets.Users[e].Preset.Static.Low=t.Static.Low,this.qualityPresets.Users[e].Preset.Static.Medium=t.Static.Medium,this.qualityPresets.Users[e].Preset.Static.High=t.Static.High,this.qualityPresets.Users[e].Preset.Static.Ultra=t.Static.Ultra,this.qualityPresets.Users[e].Preset.Dynamic.Low=t.Dynamic.Low,this.qualityPresets.Users[e].Preset.Dynamic.Medium=t.Dynamic.Medium,this.qualityPresets.Users[e].Preset.Dynamic.High=t.Dynamic.High,this.qualityPresets.Users[e].Preset.Dynamic.Ultra=t.Dynamic.Ultra,this.commit()},addUser:function(e){if(this.qualityPresets.Users[e])return!1;var t=JSON.parse(JSON.stringify(s.Users.Default));return this.qualityPresets.Users[e]=t,this.commit(),!0},removeUser:function(e){return!!this.qualityPresets.Users[e]&&(delete this.qualityPresets.Users[e],this.commit(),!0)},getUsers:function(){return Object.keys(this.qualityPresets.Users)},addLocalPreset:function(e,t){if(this.isGenericDBPreset(e))return console.error("Forbidden preset name "+e),!1;console.error("For testing only, DO NO USE IN PRODUCTION");let r=structuredClone(i);r.userDefined=!0;let s=structuredClone(i);s.userDefined=!0,n.set(e,{Static:r,Dynamic:s});for(let e in t.static){let i=t.static[e];if(void 0!==r[e])for(let t in i)void 0!==r[e][t]&&(r[e][t]=i[t])}for(let e in t.dynamic){let r=t.dynamic[e];if(void 0!==s[e])for(let t in r)void 0!==s[e][t]&&(s[e][t]=r[t])}return!0},removeLocalPreset:e=>(console.error("For testing only, DO NO USE IN PRODUCTION"),!!n.delete(e)),removeLocalPresets(){let e=n.size;return console.error("For testing only, DO NO USE IN PRODUCTION"),n.clear(),e>0},getLocalPreset:function(e){return n.get(e)},getLocalPresets:function(){let e=[];return n.forEach(((t,r,i)=>{e.push(r)})),e},_addLocalPresetToGlobal(t,r="Default"){if(console.error("For testing only, DO NO USE IN PRODUCTION"),e.is(this.qualityPresets)&&n.has(t)){let e=n.get(t);this.qualityPresets.Users[r].Preset.Static[t]=e.Static,this.qualityPresets.Users[r].Preset.Dynamic[t]=e.Dynamic,n.delete(t),this.commit()}},_addLocalPresetsToGlobal(t="Default"){console.error("For testing only, DO NO USE IN PRODUCTION"),e.is(this.qualityPresets)&&(n.forEach(((e,r,i)=>{this.qualityPresets.Users[t].Preset.Static[r]=e.Static,this.qualityPresets.Users[t].Preset.Dynamic[r]=e.Dynamic})),n.size>0&&this.commit(),n.clear())},isGenericDBPreset:function(e){switch(e.toLowerCase()){case"low":case"medium":case"high":case"ultra":case"default":case"custom":case"fast":case"balanced":case"quality":case"recommended":return!0;default:return!1}},isDBPreset:function(e,t="Default"){if(this.getLocalPreset(e))return!1;switch(e){case"Low":case"Medium":case"High":case"Ultra":case"Default":case"Custom":return!0;default:return!!this.getImportedPreset(e,t)}},getImportedPreset:function(e,t="Default"){let r=this.qualityPresets,i=null;return r?(i=r.Users[t].Preset.Static[e],i&&i.userDefined?i:null):i},getImportedPresets:function(e="Default"){let t=this.qualityPresets,r=[];if(!t)return r;for(let i in t.Users[e].Preset.Static)t.Users[e].Preset.Static[i].userDefined&&r.push(i);return r},removeImportedPreset(e,t="Default"){console.error("For testing only, DO NO USE IN PRODUCTION");let r=this.qualityPresets;return!(!r||!r.Users[t].Preset.Static[e]||!r.Users[t].Preset.Static[e].userDefined||(delete r.Users[t].Preset.Static[e],delete r.Users[t].Preset.Dynamic[e],this.commit(),0))},removeImportedPresets(e="Default"){console.error("For testing only, DO NO USE IN PRODUCTION");let t=this.qualityPresets;if(!t)return!1;let r=!1;for(let i in t.Users[e].Preset.Static)t.Users[e].Preset.Static[i].userDefined&&(delete t.Users[e].Preset.Static[i],delete t.Users[e].Preset.Dynamic[i],r=!0);return r&&this.commit(),r}})})),define("DS/QualityManager/QMViewerMixins",["DS/QualityManager/QMController"],(function(e){"use strict";return{lockQMSettings:function(e){this._useQM?this._viewerEffectSettings._lockSettings(e):console.warn("Lock QM Settings: Quality Manager not in use")},getQMGlobalProfileSettings:function(t){const r=this;return new Promise((function(i,s){if(!r._useQM)return void s("Quality Manager not currently in use");if(!e.isAvailablePreset(t))return void s(t+" unknown preset");var n;if(!r._QMInit)return void(n=this._modelEvent.subscribe({event:"QMSettingsInitialized"},(function(){r.unsubscribe(n);let s={_version:e.getDBVersion(),static:e.getPresetValue("Static",t),dynamic:e.getPresetValue("Dynamic",t)};i(s)})));let o={_version:e.getDBVersion(),static:e.getPresetValue("Static",t),dynamic:e.getPresetValue("Dynamic",t)};i(o)}))},_setQMGlobalProfile:function(t,r,i){if(this._useQM)if(e.isAvailablePreset(t))if("Static"===r||"Dynamic"===r||null==r)if(this.mobile&&"Custom"===t)console.warn("Custom preset is not available on mobile");else if(this._QMInit)r?e.setGlobalPreset(r,t,!1):(e.setGlobalPreset("Static",t,!1),e.setGlobalPreset("Dynamic",t,!1)),this.render();else{var s,n=this;s=this._modelEvent.subscribe({event:"QMSettingsInitialized"},(function(){n.unsubscribe(s),n[i](t,r)}))}else console.warn(r+" unknown mode");else console.warn(t+" unknown preset");else console.warn("Quality Manager not currently in use")},setQMGlobalProfile:function(t,r){this._setQMGlobalProfile(t,r,"setQMGlobalProfile"),e.commitToDB()},setTemporaryQMGlobalProfile:function(e,t){this._setQMGlobalProfile(e,t,"setTemporaryQMGlobalProfile")},getQMGlobalProfile:function(t){var r=this;return t=t||"Static",new Promise((function(i,s){var n;"Static"===t||"Dynamic"===t?r._useQM?r._QMInit?i(e.getCurrentGlobalPreset(t)):n=this._modelEvent.subscribe({event:"QMSettingsInitialized"},(function(){r.unsubscribe(n),i(e.getCurrentGlobalPreset(t))})):s("Quality Manager not currently in use"):s(t+" unknown mode")}))},onQMGlobalProfileChange:function(e){return this._modelEvent.subscribe({event:"QMGlobalProfileUpdated"},e)},getQMDefaultProfileEquivalent:function(){var t=this;return new Promise((function(r,i){var s;t._initialized?r(e.defaultPreset):s=this._modelEvent.subscribe({event:"VisualizationInitialized"},(function(){t.unsubscribe(s),r(e.defaultPreset)}))}))},getIsGenericQMProfile:function(t){var r=this;return new Promise((function(i,s){var n;r._initialized?i(e.isGenericPreset(t)):n=this._modelEvent.subscribe({event:"VisualizationInitialized"},(function(){r.unsubscribe(n),i(e.isGenericPreset(t))}))}))},addLocalQMPreset:function(t,r){var i=this;return new Promise((function(s,n){var o;i._useQM?i._QMInit?s(e.addLocalPreset(t,r)):o=this._modelEvent.subscribe({event:"QMSettingsInitialized"},(function(){i.unsubscribe(o),s(e.addLocalPreset(t,r))})):n("Quality Manager not currently in use")}))},removeLocalQMPreset:function(t){var r=this;return new Promise((function(i,s){if(!r._useQM)return void s("Quality Manager not currently in use");var n;if(!r._QMInit)return void(n=this._modelEvent.subscribe({event:"QMSettingsInitialized"},(function(){let s;r.unsubscribe(n),s=t?e.removeLocalPreset(t):e.removeLocalPresets(),i(s)})));let o;o=t?e.removeLocalPreset(t):e.removeLocalPresets(),i(o)}))},getQMCouldBeLowEndHardware:function(){var t=this;return new Promise((function(r,i){var s;t._initialized?r(e.unknownOrVeryLowGPU):s=this._modelEvent.subscribe({event:"VisualizationInitialized"},(function(){t.unsubscribe(s),r(e.unknownOrVeryLowGPU)}))}))},_applyQMSettings(t,r){var i=e.getCurrentGlobalPreset(t),s=e.getPresetValue(t,i);if(s){var n={AntiAliasing:s.AntiAliasing.AntiAliasing,PixelCulling:s.PixelCulling.PixelCulling,LOD:s.LOD.LOD,Transparency:s.Transparency.Transparency,AllowGroundShadows:s.Shadows.AllowGroundShadows,AllowInterObjectShadows:s.Shadows.AllowInterObjectShadows,AllowTransparentObjectShadows:s.Shadows.AllowTransparentObjectShadows,ShadowQuality:s.Shadows.ShadowQuality,ShadowFilter:s.Shadows.ShadowFilter,AllowGroundReflection:s.Reflections.AllowGroundReflection,SectionCapping:s.SectionCapping.SectionCapping};void 0!==s.AmbientOcclusion.AmbientOcclusionNbSamples&&(n.AmbientOcclusionNbSamples=s.AmbientOcclusion.AmbientOcclusionNbSamples),void 0!==s.DepthBufferOptions&&(n.DepthFlickeringReduction=s.DepthBufferOptions.DepthFlickeringReduction),void 0!==s.Reflections.AllowInterObjectReflections&&(n.AllowInterObjectReflections=s.Reflections.AllowInterObjectReflections),s.Refractions&&void 0!==s.Refractions.AllowInterObjectRefractions&&(n.AllowInterObjectRefractions=s.Refractions.AllowInterObjectRefractions),void 0!==s.Material&&(n.DefaultMaterialQuality=s.Material.DefaultMaterialQuality,n.FlakesQuality=s.Material.FlakesQuality),void 0!==s.Downsampling&&(n.Downsampling=s.Downsampling.Downsampling),this._setVisualSettings(n,r)}},_initQMSettings:function(){this._QMInit||(this._QMInit=!0,this.ODTMode||(this._applyQMSettings("Static","static"),this._applyQMSettings("Dynamic","dynamic"),this._modelEvent.publish({event:"QMSettingsInitialized",data:{viewer:this}})))},_getQMSetting:function(e){var t=this._getVisualSetting(e);return t?{staticValue:t.static,dynamicValue:t.dynamic}:null}}})),define("DS/QualityManager/GPULists",["DS/Mesh/ThreeJS_Base"],(function(e){"use strict";var t=["Google SwiftShader","Microsoft Basic Render","WebVisu Profile No GPU"],r=["Quadro 400","Quadro 410","Quadro 500M","Quadro 600","Quadro 1000M","Quadro 2000","Quadro 2000M","Quadro M600M","Quadro M620","Quadro M500M","Quadro M520","Quadro K600","Quadro K420","Quadro K600","Quadro K610M","Quadro K1000M","Quadro P400","Quadro P500","GeForce GTX 750","GeForce GTX 750 Ti","GeForce GTX 760","GeForce GTX 775M","GeForce GTX 780M","GeForce GTX 950","GeForce GTX 950M","GeForce GTX 960M","GeForce GTX 965M","GeForce GTX 970M","GeForce GTX 1050","GeForce GTX 1050 Ti","GeForce GTX 1650","GeForce GTX 1650 SUPER","GeForce GTX 1650 Super","GeForce GTX 1650 Ti","Graphics 530","Graphics P530","Graphics 630","Graphics P630","Graphics 730","WebVisu Profile Very Low","WebVisu Profile Unknown"],i=["Quadro 3000M","Quadro 4000","Quadro 4000M","Quadro K620","Quadro K620M","Quadro K1200","Quadro K2000M","Quadro K2100M","Quadro K1100M","Quadro M1000","Quadro M1000M","Quadro M1200","Quadro M1200M","Quadro P520","Quadro P600","Quadro P620","Quadro P1000","Quadro P1200","Quadro T400","Quadro T600","GeForce GTX 770","GeForce GTX 780","GeForce GTX 880","GeForce GTX 960","GeForce GTX 970","FirePro M5950","FirePro V4900","FirePro V3900","FirePro V4800","FirePro W4170M","FirePro M4100","FirePro W2100","Pro WX 3100","Pro WX 2100","Pro WX 4150","Pro 5300M","Pro 5500M","Pro 555X","Pro 560","Pro 560X","Mobility Radeon WX 4130","Mobility Radeon WX 4150","RX 470","RX 480","RX 480X","RX 570","RX 570X","RX 5300","RX 5300 XT","RX 5500","RX 5500 XT","RX 6500M","RX 7300M","RX 7300M XT","RX 7300S","RX 7300","RX 7300 XT","RX 7300 XTX","RX 7400M","RX 7400M XT","RX 7400S","RX 7400","RX 7400 XT","RX 7400 XTX","Graphics 540","Graphics 550","Graphics P555","Graphics 640","Graphics 645","Graphics 650","Graphics P750","A30","A30M","A310","A310M","A350","A350M","Mali-G71","Mali-G72","Mali-G610","Adreno (TM) 620","Adreno (TM) 642L","Adreno (TM) 643L","Adreno (TM) 702","WebVisu Profile Fast","WebVisu Profile Low"],s=["Quadro 5000","Quadro 5000M","Quadro 5010M","Quadro 6000","Quadro K2000","Quadro K2200","Quadro K2200M","Quadro K3000M","Quadro M2000","Quadro M2000M","Quadro M2200","Quadro P2000","Quadro P2200","Quadro T1000","Quadro T1200","T1200","GeForce GTX 980M","GeForce GTX 1060","GeForce GTX 1060 SUPER","GeForce GTX 1060 Super","GeForce GTX 1070","GeForce GTX 1650","GeForce GTX 1650 SUPER","GeForce GTX 1650 Super","GeForce GTX 1650 Ti","GeForce GTX 1660","GeForce GTX 1660 SUPER","GeForce GTX 1660 Super","GeForce GTX 2050","GeForce GTX 2050 Ti","GeForce RTX 2060","GeForce RTX 3050","RX 5600","RX 6500 XT","RX 6600S","RX 7500M","RX 7500M XT","RX 7500S","RX 7500","RX 7500 XT","RX 7500 XTX","RX 7550M","RX 7550M XT","RX 7550S","RX 7550","RX 7550 XT","RX 7550 XTX","Pro W6400","Graphics 580","Graphics P580","Graphics 655","Graphics 750","Graphics P750","Graphics 770","UHD Graphics Direct3D11","Iris(R) Plus Graphics","Iris(TM) Plus Graphics","Xe Graphics","A370","A370M","A380","A380M","A40","A40M","Mali-G76","Mali-G57","Mali-G77","Mali-G68","Mali-G78","Mali-G710","Mali-G615","Mali-G715","Immortalis-G715","Mali-G620","Mali-G720","Immortalis-G720","Adreno (TM) 540","Adreno (TM) 640","Adreno (TM) 642","Adreno (TM) 644","Adreno (TM) 650","Adreno (TM) 660","Adreno (TM) 675","Adreno (TM) 680","Adreno (TM) 685","Adreno (TM) 690","Adreno (TM) 730","Adreno (TM) 740","WebVisu Profile Balanced","WebVisu Profile Medium"],n=["Quadro K3100M","Quadro K4000","Quadro K4000M","Quadro K4100M","Quadro K4200","Quadro K5000M","Quadro K5100M","Quadro K5200","Quadro K6000","Quadro M3000M","Quadro P3000","Quadro T2000","Quadro RTX 3000","Quadro RTX A2000","Quadro RTX A3000","FirePro V8800","FirePro V7800","FirePro V7900","FirePro W7000","FirePro M8900","FirePro V5800","FirePro M7820","FirePro W5100","FirePro M6100","FirePro W4300","FirePro W4000","FirePro W5170M","FirePro M6000","FirePro M5100","FirePro W4100","FirePro W5130M","FirePro M4000","FirePro V5900","Pro WX 5100","Pro WX 4100","Pro W6600","Quadro M4000M","Quadro M5000M","Quadro P3200","Quadro T2000","Quadro T3000","Quadro RTX 3000","RTX A2000","RTX A3000","GeForce GTX 780 Ti","GeForce GTX 880 Ti","GeForce GTX 980","GeForce GTX 980 Ti","GeForce GTX 1070 Ti","GeForce RTX 1080","GeForce GTX 1660 Ti","GeForce RTX 2060 SUPER","GeForce RTX 2060 Super","GeForce RTX 2070","GeForce RTX 2070 SUPER","GeForce RTX 2070 Super","GeForce RTX 3050 Ti","GeForce RTX 3060","GeForce RTX 3060 Ti","GeForce RTX 4050","GeForce RTX 4050 Ti","GeForce RTX 4060","GeForce RTX 4060 Ti","RX 490","RX 490X","RX 580","RX 580X","RX 590","RX Vega 56","RX Vega 64","RX 5600 XT","RX 5700","RX 5700 XT","RX 5800","RX 5800 XT","RX 5900","RX 6600M","RX 6600M XT","RX 6600","RX 6600 XT","RX 6650M","RX 6650M XT","RX 6650 XT","RX 6700S","RX 6700M","RX 6700S","RX 6700","RX 6700 XT","RX 6750","RX 6750 XT","RX 6800M","RX 6800S","RX 6800","RX 7600M","RX 7600M XT","RX 7600S","RX 7600","RX 7600 XT","RX 7600 XTX","RX 7650M","RX 7650M XT","RX 7650S","RX 7650","RX 7650 XT","RX 7650 XTX","RX 7700M","RX 7700M XT","RX 7700S","RX 7700","RX 7700 XT","RX 7700 XTX","RX 7750M","RX 7750M XT","RX 7750S","RX 7750","RX 7750 XT","RX 7750 XTX","A50","A50M","A550","A550M","A580","A580M","A730","A730M","A750","A750M","A770","A770M","WebVisu Profile High","WebVisu Profile Quality"],o=["Quadro K5000","Quadro M4000","Quadro M5000","Quadro M6000","Quadro P4000","Quadro P4200","Quadro P5000","Quadro P5200","Quadro P6000","GRID K2","Quadro GP100","Quadro GV100","Quadro RTX 4000","Quadro RTX 5000","Quadro RTX 6000","Quadro RTX 8000","RTX A4000","RTX A4500","RTX A5000","RTX A5500","RTX A6000","RTX 6000 Ada","GeForce RTX 1080 Ti","GeForce GTX TITAN","GeForce RTX 2080","GeForce RTX 2080 Ti","GeForce RTX 2080 SUPER","GeForce RTX 2080 Super","GeForce RTX 3070","GeForce RTX 3070 Ti","GeForce RTX 3080","GeForce RTX 3080 Ti","GeForce RTX 3090","GeForce RTX 3090 Ti","GeForce RTX 4070","GeForce RTX 4070 Ti","GeForce RTX 4080","GeForce RTX 4080 Ti","GeForce RTX 4090","FirePro W9100","FirePro W8100","FirePro W9000","FirePro W7170M","FirePro W8000","FirePro W7100","Mobility Radeon WX 7100","Pro WX 7100","Pro W6800","Pro W7800","Pro W7900","VII","RX 5900 XT","RX 5950","RX 5950 XT","RX 6800 XT","RX 6850M","RX 6900","RX 6900 XT","RX 6950","RX 6950 XT","RX 7800M","RX 7800M XT","RX 7800S","RX 7800","RX 7800 XT","RX 7800 XTX","RX 7850M","RX 7850M XT","RX 7850S","RX 7850","RX 7850 XT","RX 7850 XTX","RX 7900M","RX 7900M XT","RX 7900S","RX 7900","RX 7900 XT","RX 7900 XTX","RX 7950M","RX 7950M XT","RX 7950S","RX 7950","RX 7950 XT","RX 7950 XTX","WebVisu Profile Fidelity","WebVisu Profile Ultra"],a=[{value:o,preset:"Ultra",unknownOrVeryLow:!1},{value:n,preset:"High",unknownOrVeryLow:!1},{value:s,preset:"Medium",unknownOrVeryLow:!1},{value:i,preset:"Low",unknownOrVeryLow:!1},{value:r,preset:"Low",unknownOrVeryLow:!0},{value:t,preset:"Low",unknownOrVeryLow:!0,warning:"Software rendering mode. Please enable hardware acceleration."}];return e.VisualizationTraces.info("Known GPUs :"+(r.length+i.length+s.length+n.length+o.length+t.length)),a})),define("DS/QualityManager/QMScoreHandler",["DS/VisuTools/SettingManager","DS/CoreEvents/ModelEvents","DS/Mesh/ThreeJS_Base"],(function(e,t,r){"use strict";const i=!localStorage.getItem("__WEBVISU_GO_POC__")||"false"!==localStorage.getItem("__WEBVISU_GO_POC__"),s="true"===localStorage.getItem("__WEBVISU_NONBLOCKING_GO_POC__");localStorage.removeItem("VisuHardwareScoresODT");const n={FRESH:0,INITIAL:1};n.LAST=Object.keys(n).length-1;const o={PixelScore:-1,TextureScore:-1,ScoreVersion:n.FRESH,BatteryAPI:!1,BatteryScore:-1,CouldBeBatteryPowerSaveMode:!0};return new class{constructor(){this._settingsManagerParams={useLocalStorage:!0,useWidget:!1,name:r.AutomatedTests()?"VisuHardwareScoresODT":"VisuHardwareScores",familiyName:null},this._modelEvent=new t,this._keyWriter=e.Write(this._settingsManagerParams),this._keyReader=e.Read(this._settingsManagerParams),this.showNotifications="true"===localStorage.getItem("WebVisu_Show_GPU_Profile"),this.useGO=i||s,this.useNonBlockingGO=!i&&s,this.GPUPriority=!this.useGO||!!localStorage.getItem("__WEBVISU_GPU_PRIORITY__")&&"true"===localStorage.getItem("__WEBVISU_GPU_PRIORITY__"),this.heatFrames=localStorage.getItem("__WEBVISU_GO_HEATFRAME__")?parseInt(localStorage.getItem("__WEBVISU_GO_HEATFRAME__")):6,this.GODuration=localStorage.getItem("__WEBVISU_GO_DURATION__")?parseInt(localStorage.getItem("__WEBVISU_GO_DURATION__")):500,this.singleGO=!localStorage.getItem("__WEBVISU_GO_SINGLE__")||"true"===localStorage.getItem("__WEBVISU_GO_SINGLE__"),this.GOValidDuration=localStorage.getItem("__WEBVISU_GO_VALIDITY__")?parseInt(localStorage.getItem("__WEBVISU_GO_VALIDITY__")):2592e6,this.GOWidth=localStorage.getItem("__WEBVISU_GO_WIDTH__")?parseInt(localStorage.getItem("__WEBVISU_GO_WIDTH__")):window.devicePixelRatio*window.screen.width,this.GOHeight=localStorage.getItem("__WEBVISU_GO_HEIGHT__")?parseInt(localStorage.getItem("__WEBVISU_GO_HEIGHT__")):window.devicePixelRatio*window.screen.height;let a="true"===localStorage.getItem("__WEBVISU_FORCE_SCORE_REMOVE__");if(this.useGO){const t=this._keyWriter;e.isEmptySettings(this._settingsManagerParams)&&(t.PixelScore=o.PixelScore,t.TextureScore=o.TextureScore,t.ScoreVersion=o.ScoreVersion,t.ContextLoss=!1,t.ScoreTime=0,t.BatteryAPI=o.BatteryAPI,t.BatteryScore=o.BatteryScore,t.CouldBeBatteryPowerSaveMode=o.CouldBeBatteryPowerSaveMode,t.GORunning=!1,t.GOFrame=-1,t.GOHeight=this.GOHeight,t.GOWidth=this.GOWidth);const r=this._keyReader;if(!(-1===r.PixelScore&&-1===r.TextureScore)){this.GOHeight===r.GOHeight&&this.GOWidth===r.GOWidth&&n.LAST===r.ScoreVersion||(a=!0,this.showNotifications&&alert("GO: configuration has changed, deleting old scores.")),a&&(t.OldPixelScore=void 0,t.OldTextureScore=void 0,this._setHardwareScores(-1,-1));let e=r.ContextLoss?this.GOValidDuration/5:this.GOValidDuration;r.ScoreTime>0&&Date.now()-r.ScoreTime>e&&this._flagHardwareScoresAsInvalid("Scores have expired")}}else this._unlock(),this.GPUPriority=!0}_unlock(){if(this._locked()){this._keyWriter.GORunning=!1}this._modelEvent.publish({event:"PerfoLockRemoved"})}onUnlock(e){return this._modelEvent.subscribe({event:"PerfoLockRemoved"},e)}_locked(){return this._keyReader.GORunning}_lock(){if(!this._locked()){const e=this._keyWriter;e.GORunning=!0,e.GOFrame=-1}this._modelEvent.publish({event:"PerfoLockAdded"})}onLock(e){return this._modelEvent.subscribe({event:"PerfoLockAdded"},e)}_setGOFrame(e){this._keyWriter.GOFrame=e}_getGOFrame(){return this._keyReader.GOFrame}unsubscribe(e){this._modelEvent.unsubscribe(e)}getHardwareScores(){const t=e.Struct(this._settingsManagerParams);if(t.ScoreVersion<n.LAST)return null;let r=t.PixelScore,i=t.TextureScore;return-1===i&&(i=r>=0?100:-1),r<0||i<0?null:{pixelScore:r,textureScore:i}}_flagHardwareScoresAsInvalid(t){const r=e.Struct(this._settingsManagerParams);if(-1===r.PixelScore&&-1===r.TextureScore)return;this.showNotifications&&(alert("GO: "+t+"."),alert("GO: scores are not valid, computing."));const i=this._keyWriter;i.OldPixelScore=r.PixelScore,i.OldTextureScore=r.TextureScore,i.PixelScore=-1,i.TextureScore=-1,i.ScoreTime=0}_contextLost(){this._setHardwareScores(1,-1);this._keyWriter.ContextLoss=!0}_setHardwareScores(e,t){const r=this._keyWriter,i=this._keyReader;i.OldPixelScore&&i.OldPixelScore>e&&(this.showNotifications&&alert("GO: Previous pixel score was better than current ("+e+")."),e=i.OldPixelScore),i.OldTextureScore&&i.OldTextureScore>t&&(this.showNotifications&&alert("GO: Previous texture score was better than current ("+t+")."),t=i.OldTextureScore),r.PixelScore=e,r.TextureScore=t,r.ContextLoss=!1,e>-1||t>-1?(r.ScoreTime=Date.now(),r.GOHeight=this.GOHeight,r.GOWidth=this.GOWidth,r.ScoreVersion=n.LAST,this.showNotifications&&alert("GO: scores updated")):(r.ScoreTime=0,r.GOHeight=0,r.GOWidth=0,r.ScoreVersion=n.FRESH,this.showNotifications&&alert("GO: scores deleted")),r.GOFrame=-1,r.OldPixelScore=void 0,r.OldTextureScore=void 0}_validateBatteryStatus(t){const i=e.Struct(this._settingsManagerParams),s=this._keyWriter,n=this;return new Promise((function(e,a){const l=()=>{i.BatteryAPI&&(s.BatteryAPI=!1,s.BatteryScore=o.BatteryScore,s.CouldBeBatteryPowerSaveMode=o.CouldBeBatteryPowerSaveMode,n._flagHardwareScoresAsInvalid("Battery API status changed to false")),e()};!r.isSamsungBrowser()&&navigator.getBattery?navigator.getBattery().catch((()=>{l()})).then((r=>{i.BatteryAPI||(s.BatteryAPI=!0,s.BatteryScore=o.BatteryScore,s.CouldBeBatteryPowerSaveMode=o.CouldBeBatteryPowerSaveMode,n._flagHardwareScoresAsInvalid("Battery API status changed to true"));let a=!1;t.mobile?r.level<.2&&void 0!==r.level&&(a=!0):r.charging||void 0===r.charging||(a=!0),!a&&i.CouldBeBatteryPowerSaveMode&&(s.CouldBeBatteryPowerSaveMode=!1,n._flagHardwareScoresAsInvalid("Battery in charge mode")),e()})):l()}))}_iteratePerformance(e){if(e.TexturePerformanceEffect&&e.TexturePerformanceEffect.enabled){if(e.TexturePerformanceEffect.done){var t=e.TexturePerformanceEffect.getScore();e.TexturePerformanceEffect.resetScore(),e.setEffect("TexturePerformance",!1),this._modelEvent.publish({event:"PerformanceDone",data:{score:t}})}return!0}if(e.PixelShaderPerformanceEffect&&e.PixelShaderPerformanceEffect.enabled){if(e.PixelShaderPerformanceEffect.done){t=e.PixelShaderPerformanceEffect.getScore();e.PixelShaderPerformanceEffect.resetScore(),e.setEffect("PixelShaderPerformance",!1),this._modelEvent.publish({event:"PerformanceDone",data:{score:t}})}return!0}return!1}_doPerformanceCheck(e,t){this._contextLost=!1;const r=this;function i(e){e.preventDefault(),r.unsubscribe(n),r.unsubscribe(o),r._contextLost(),r.showNotifications&&alert("GO: context lost."),s()}function s(){e.canvas.removeEventListener("WebVisu_contextlost",i),t()}let n,o;this.showNotifications&&alert("GO: computing."),e.canvas.addEventListener("WebVisu_contextlost",i,!1),e.renderer.setEffect("PixelShaderPerformance",!0),n=r._modelEvent.subscribe({event:"PerformanceDone"},(function(t){e.render();const i=t.score;r.unsubscribe(n),r.singleGO?(r._setHardwareScores(i,-1),r.showNotifications&&alert("GO: executed."),s()):(e.renderer.setEffect("TexturePerformance",!0),o=r._modelEvent.subscribe({event:"PerformanceDone"},(function(t){e.render();const n=t.score;r.unsubscribe(o),r._setHardwareScores(i,n),r.showNotifications&&alert("GO: executed."),s()})))}))}handleViewer(t,r,i){if(r._performanceViewer)t._initialized=!0;else{const s=e.Struct(this._settingsManagerParams);s.BatteryAPI&&s.CouldBeBatteryPowerSaveMode||i()?this._validateBatteryStatus(t).then((()=>{t._runPerformanceCheck(r)})):t._initVisualization(r)}}}})),define("DS/QualityManager/QMGIController",["UWA/Core","UWA/Class","DS/QualityManager/QMGIPresetStreamer"],(function(e,t,r){"use strict";return t.singleton({init:function(){this.isInitialized=!0,this.initPresetDB(),this.properties={},this._QMSettings={MaxSamples:{value:{Static:!0,Batch:!1}},MinSamples:{value:{Static:!0,Batch:!1}},Clamping:{value:{Static:!0,Batch:!0}},GaussFilter:{value:{Static:!0,Batch:!0}},Size:{value:{Static:!0,Batch:!0}},CenterWeight:{value:{Static:!0,Batch:!0}},MAxTraceDepth:{value:{Static:!0,Batch:!0}},GlossyThreshold:{value:{Static:!0,Batch:!0}},RenderRefractiveShadow:{value:{Static:!0,Batch:!0}},LocationBasedSampling:{value:{Static:!0,Batch:!0}},Distribution:{value:{Static:!0,Batch:!0}},Factor:{value:{Static:!0,Batch:!0}},PathTerminationDepth:{value:{Static:!0,Batch:!0}},VisualizationMode:{value:{Static:!0,Batch:!1}},EnableFinalGathering:{value:{Static:!0,Batch:!0}},NoOfPhotons:{value:{Static:!0,Batch:!0}},PathDepth:{value:{Static:!0,Batch:!0}},PhotonRadius:{value:{Static:!0,Batch:!0}},RefineMap:{value:{Static:!0,Batch:!0}},PrecalculateIrradiance:{value:{Static:!0,Batch:!0}},Caustics:{value:{Static:!0,Batch:!0}},CausticsPhotonNumber:{value:{Static:!0,Batch:!0}},CausticsPathDepth:{value:{Static:!0,Batch:!0}},CausticRadius:{value:{Static:!0,Batch:!0}},CausticRefinePhotonMap:{value:{Static:!0,Batch:!0}},RayOffset:{value:{Static:!0,Batch:!0}},AllowGroundShadows:{value:{Static:!0,Batch:!0}},AllowReflectionsOnGround:{value:{Static:!0,Batch:!0}},AllowBloom:{value:{Static:!0,Batch:!0}},AllowDepthOfField:{value:{Static:!0,Batch:!0}},DownsamplingFctor:{value:{Static:!0,Batch:!1}}}},initPresetDB:function(){r.init(),this.currentUser=r.getItem("currentUser");var e="Users/"+this.currentUser+"/currentPreset";this.currentPreset=r.getItem(e),this.prestToModify="Custom"},setCurrentUser:function(t){var i="Users/"+t,s=r.getItem(i);e.is(s)&&(r.setItem("currentUser",t),this.currentUser=t)},setCurrentPreset:function(t){var i="Users/"+this.currentUser+"/currentPreset",s=r.getItem(i);e.is(s)&&(r.setItem(i,t),this.currentPreset=t)},getCurrentUserPresetQuery:function(){return"Users/"+this.currentUser+"/Preset/"},getCurrentPreset:function(){var e="Users/"+this.currentUser+"/currentPreset";return r.getItem(e)},validateAttribute:function(e,t){var r=!0;return"ReflectionsOnGround"!=e&&"Preset"!=e||(r=!1),r},setAttribute:function(e,t,r,i,s){this.setAttributeOnDB(e,t,r,i,s)},setAttributeOnDB:function(e,t,i,s,n){var o=this.getCurrentUserPresetQuery()+e+"/"+this.prestToModify+"/"+i+"/",a=o+s;r.setItem(a,n);var l=o+"Preset";r.setItem(l,t)},setProperty:function(e,t,r){this.setPropertyOnDB(e,t,r)},setPropertyOnDB:function(t,i,s){var n=this.getCurrentUserPresetQuery()+t+"/"+i,o=r.getItem(n);if(!e.is(o))return!1;var a=o[s];if(!e.is(a))return!1;for(var l in a)if(a.hasOwnProperty(l)){var c=a[l];this.setAttributeOnDB(t,i,s,l,c)}},setGlobalPreset:function(e,t,r){this.setGlobalPresetOnDB(e,t,r)},setGlobalPresetOnDB:function(t,i,s){var n=this.getCurrentUserPresetQuery()+t+"/currentGlobalPreset";if(r.setItem(n,i),s){n=this.getCurrentUserPresetQuery()+t+"/"+i;var o=r.getItem(n);if(!e.is(o))return!1;for(var a in o)o.hasOwnProperty(a)&&this.setPropertyOnDB(t,i,a)}},getCurrentGlobalPreset:function(e){var t=this.getCurrentUserPresetQuery()+e+"/currentGlobalPreset";return r.getItem(t)},getPresetValue:function(e,t){var i=this.getCurrentUserPresetQuery()+e+"/"+t;return r.getItem(i)},commitToDB:function(){r.commit()},restoreFromDB:function(){r.retoreDB();var e=this.getCurrentPreset(),t=this.getCurrentGlobalPreset(e);this.setGlobalPreset(e,t,!1)},setQMsetting:function(e,t,r){var i=this._QMSettings[e];i.value[t]="true"==r},getQMsetting:function(e,t){return this._QMSettings[e].value[t]}})})),define("DS/QualityManager/QMController",["UWA/Core","UWA/Class","DS/QualityManager/QMPresetStreamer","DS/QualityManager/GPULists","DS/QualityManager/QMScoreHandler","DS/Mesh/ThreeJS_Base"],(function(e,t,r,i,s,n){"use strict";var o={FRESH:0,INITIAL:1,SSAO_LOW_CHANGE:2,REFRACTION:3,SS_ON_HIGH:4,TRANSPARENT_SHADOWS_ON_MEDIUM:5,HIGH_MATERIAL_MAX:6,STATIC_LOW_PIXEL_CULLING:7,__ERROR__:8,__ERROR2__:9,LOD:10,NEW_MEDIUM:11,ADD_REVISION:12,SSAO_SAMPLES_RENAMED:13,SECTIONCAPPING_ADDED:14,HIGH_MATERIAL_MAX_2:15};function a(){return"undefined"!=typeof dscef}o.LAST=Object.keys(o).length-1;var l=i;return t.singleton({init:function(e,t){"Default"!==t&&"SWYM"!==t&&(console.error("Error: invalid user key in Quality Manager "+t),t="Default"),this.isInitialized=!0,r.init(),r.initDataBase(e),this.version=-1,this.revision=0,r.addUser(t),this.currentUser=t,this.defaultPreset=null,this.unknownOrVeryLowGPU=!0,this._webGLV6Viewers=[],this._currentGlobalPreset={Static:null,Dynamic:null},this.activateLocalCache=!0,this.forceLocalCache=void 0,this.ldhOpt1=void 0,this.ldhOpt2=void 0,this.ldhOpt3=void 0},_getRoot(e,t){const i=r.getLocalPreset(t);var s;if(i)s=i[e];else{var n=this.getCurrentUserPresetQuery()+e+"/"+t;s=r.getItem(n)}return s},_checkPreset:function(e,t,r,i){for(var n=0;n<t.length;n++){var o=t[n];if(o&&0!==o.length&&(o="\\b"+(o=(o=o.replace("(","\\(")).replace(")","\\)"))+"\\b",null!==e.match(o)))return this.defaultPreset=r,this.unknownOrVeryLowGPU=i,s.showNotifications&&alert("Known GPU: "+e),this._updateDefaultPresets(),!0}return!1},computeDefaultPreset:function(e){if(!e)throw"Missing viewer in computeDefaultPreset";if(this.defaultPreset)return!0;const t=e.renderer.renderer.getRendererInfo().gpu;t&&(null!==(t.match("\\bIntel\\b")||t.match("\\bIntel(R)\\b")||t.match("\\bIntel(TM)\\b"))&&console.warn("Integrated GPU detected, please enable your dedicated GPU if possible."));if(n.AutomatedTestsOrWebDriver()&&!localStorage.getItem("WebVisu_GPU_Profile"))return this.defaultPreset="Medium",this.unknownOrVeryLowGPU=n.AutomatedTests(),this._modifyAttributeOnDB("Static","Low","Material","DefaultMaterialQuality",this.unknownOrVeryLowGPU?"Low":"High"),this._modifyAttributeOnDB("Static","Low","PixelCulling","PixelCulling",6),this._modifyAttributeOnDB("Static","Medium","Material","DefaultMaterialQuality",this.unknownOrVeryLowGPU?"Low":"High"),this._modifyAttributeOnDB("Static","Medium","Material","FlakesQuality","Medium"),this._modifyAttributeOnDB("Static","Medium","AntiAliasing","AntiAliasing","SMAA"),this._modifyAttributeOnDB("Static","Medium","Shadows","ShadowQuality","Medium"),this._modifyAttributeOnDB("Static","Medium","AmbientOcclusion","AmbientOcclusionNbSamples",16),this._modifyAttributeOnDB("Static","Medium","Reflections","AllowGroundReflection",!0),this.setDBVersion(o.INITIAL),this.setDBRevision(0),!0;var r=localStorage.getItem("WebVisu_GPU_Profile")||(e._viewerEffectSettings._lqFallback?"WebVisu Profile Very Low":null);if(r||(r=t,s.GPUPriority||(r="WebVisu_GO")),!r||0==r.length)return s.showNotifications&&alert("No GPU \nNo Profile"),this._updateDefaultPresets(),!0;for(var i=0;i<l.length;i++){var a=l[i];if(this._checkPreset(r,a.value,a.preset,a.unknownOrVeryLow))return a.warning&&console.warn("Warning: "+a.warning),s.showNotifications&&alert("GPU: "+t+"\nDatabase Profile"),!0}if(s.useGO){var c=s.getHardwareScores();if(c){var u=c.pixelScore,h=c.textureScore;s.showNotifications&&alert("Texture Score: "+h+"\nPixel Score: "+u),this.defaultPreset="Low",this.unknownOrVeryLowGPU=!0;const d=5,f=2;function P(e,t){return u>e&&h>t||(u>e&&h>t-d?(s.showNotifications&&alert("Passed with tolerance on texture score"),!0):u>e-f&&h>t?(s.showNotifications&&alert("Passed with tolerance on pixel score"),!0):void 0)}if(e._use_webgpu){if(P(18,28))this.unknownOrVeryLowGPU=!1,(this.currentUser.includes("SWYM")?P(30,42):P(23,34))&&(this.defaultPreset="Medium",P(56,58)&&(this.defaultPreset="High",P(89,79)&&(this.defaultPreset="Ultra")))}else if(P(22,28))this.unknownOrVeryLowGPU=!1,(this.currentUser.includes("SWYM")?P(34,42):P(27,34))&&(this.defaultPreset="Medium",P(64,58)&&(this.defaultPreset="High",P(100,79)&&(this.defaultPreset="Ultra")));return s.showNotifications&&alert("GPU: "+t+"\nAutomatic Profile"),this._updateDefaultPresets(),!0}return!1}return s.showNotifications&&alert("GPU: "+t+"\nUnknown Profile"),this._updateDefaultPresets(),!0},_updateDefaultPresets:function(){this.isInitialized&&(this.defaultPreset||(this.defaultPreset="Low",this.unknownOrVeryLowGPU=!0),s.showNotifications&&alert("Default Preset: "+this.defaultPreset+"\nBasic For Design by default allowed: "+!this.unknownOrVeryLowGPU),this._modifyAttributeOnDB("Static","Low","Material","DefaultMaterialQuality",this.unknownOrVeryLowGPU?"Low":"High"),this._modifyAttributeOnDB("Static","Medium","Material","DefaultMaterialQuality","High"))},initPresetDB:function(){this.version=this.getDBVersion();var e=r.getUsers(),t=this.currentUser;r._removeItem("currentUser");for(var i=0;i<e.length;i++)"Default"===e[i]||"SWYM"===e[i]?(this.currentUser=e[i],this.version>o.LAST?console.error("Detected unknown QM database version"):(r._restorePresetsFromBase(this.currentUser),this.version<o.REFRACTION&&(this._addAttributeOnDB("Static","Custom","Refractions","AllowInterObjectRefractions",!1),this._addAttributeOnDB("Static","Custom","Refractions","Preset","Medium"),this._addAttributeOnDB("Dynamic","Custom","Refractions","AllowInterObjectRefractions",!1),this._addAttributeOnDB("Dynamic","Custom","Refractions","Preset","Medium")),this.version<o.LOD&&(this._addAttributeOnDB("Static","Custom","LOD","LOD",.5),this._addAttributeOnDB("Static","Custom","LOD","Preset","Medium"),this._addAttributeOnDB("Dynamic","Custom","LOD","LOD",3),this._addAttributeOnDB("Dynamic","Custom","LOD","Preset","Medium")),this.version<o.SECTIONCAPPING_ADDED&&(this._addAttributeOnDB("Static","Custom","SectionCapping","SectionCapping",n.EffectState.Enabled),this._addAttributeOnDB("Dynamic","Custom","SectionCapping","SectionCapping",n.EffectState.Auto)),this.version<o.HIGH_MATERIAL_MAX_2&&("Ultra"!==this.getPresetValue("Static","Custom").Material.DefaultMaterialQuality&&"Medium"!==this.getPresetValue("Static","Custom").Material.DefaultMaterialQuality||this._modifyAttributeOnDB("Static","Custom","Material","DefaultMaterialQuality","High")),this.currentUser.includes("SWYM")&&(this._modifyAttributeOnDB("Static","Medium","AntiAliasing","AntiAliasing","Iterative"),this._modifyAttributeOnDB("Static","High","AntiAliasing","AntiAliasing","Iterative"),this._modifyAttributeOnDB("Static","Ultra","AntiAliasing","AntiAliasing","Iterative"),this._modifyAttributeOnDB("Dynamic","Medium","AntiAliasing","AntiAliasing","TAA"),this._modifyAttributeOnDB("Dynamic","High","AntiAliasing","AntiAliasing","TAA"),this._modifyAttributeOnDB("Dynamic","Ultra","AntiAliasing","AntiAliasing","TAA"),this._modifyAttributeOnDB("Static","Medium","AmbientOcclusion","AmbientOcclusionNbSamples",8),this._modifyAttributeOnDB("Dynamic","Medium","AmbientOcclusion","AmbientOcclusionNbSamples",8)))):(console.error("Error: invalid user key detected in database "+e[i]+". Removing."),r.removeUser(e[i]));this.version!==o.LAST&&(this.setDBRevision(0),this.revision=this.getDBRevision()),this.setDBVersion(o.LAST),this.currentUser=t},_applyVersionning:function(e){if(void 0===e._version)return;const t=e._version;t<o.REFRACTION&&(e.static.Refractions={AllowInterObjectRefractions:!1},e.dynamic.Refractions={AllowInterObjectRefractions:!1}),t<o.LOD&&(e.static.LOD={LOD:.5},e.dynamic.LOD={LOD:3}),t<o.SECTIONCAPPING_ADDED&&(e.static.SectionCapping={SectionCapping:n.EffectState.On},e.dynamic.SectionCapping={SectionCapping:n.EffectState.Enabled})},isGenericPreset:function(e){return r.isGenericDBPreset(e)},isAvailablePreset:function(e){return r.getLocalPreset(e)||r.isDBPreset(e,this.currentUser)},_refreshPreset:function(e=!1){var t=this.getCurrentGlobalPreset("Static");return this.setGlobalPreset("Static",t,!1),t=this.getCurrentGlobalPreset("Dynamic"),this.setGlobalPreset("Dynamic",t,!1),e&&this.incrementDBRevision(),!0},getImportedPreset:function(e){return r.getImportedPreset(e,this.currentUser)},getImportedPresets:function(){return r.getImportedPresets(this.currentUser)},removeImportedPreset:function(e){return r.removeImportedPreset(e,this.currentUser)&&this._refreshPreset(!0)},removeImportedPresets:function(){return r.removeImportedPresets(this.currentUser)&&this._refreshPreset(!0)},addLocalPreset:function(e,t){return this._applyVersionning(t),r.addLocalPreset(e,t)&&this._refreshPreset(!0)},getLocalPreset:function(e){return r.getLocalPreset(e)},getLocalPresets:function(){return r.getLocalPresets()},removeLocalPreset:function(e){return!!r.removeLocalPreset(e)&&(this._refreshPreset(!0),!0)},removeLocalPresets:function(){return!!r.removeLocalPresets()&&(this._refreshPreset(!0),!0)},_addLocalPresetToGlobal:function(e){r._addLocalPresetToGlobal(e,this.currentUser),this._refreshPreset(!0)},_addLocalPresetsToGlobal:function(){r._addLocalPresetsToGlobal(this.currentUser),this._refreshPreset(!0)},setLinkedPresetStatus:function(t){var i="Users/"+this.currentUser+"/isLinked",s=r.getItem(i);e.is(s)&&r.setItem(i,t)},getLinkedPresetStatus:function(){var e="Users/"+this.currentUser+"/isLinked";return r.getItem(e)},validateAttribute:function(e,t){var r=!0;return"ReflectionsOnGround"!=e&&"Preset"!=e||(r=!1),r},setAttribute:function(e,t,r,i,s){this.setAttributeOnViewer(e,i,s),this.setAttributeOnDB(e,t,r,i,s)},setAttributeOnViewer:function(e,t,r){if(!this.validateAttribute(t,r))return!1;var i,s=!1,n="Dynamic"===e?"dynamic":"static";i="string"==typeof r?JSON.parse('{"'+t+'":"'+r+'"}'):JSON.parse('{"'+t+'":'+r+"}");for(var o=0;o<this._webGLV6Viewers.length;o++){var a=this._webGLV6Viewers[o],l=a.getVisualSetting(t);if(l[n]!==r)a._setVisualSettings(i,e),a.getVisualSetting(t)[n]!==l[n]&&(s=!0,a.render())}return s},_modifyAttributeOnDB:function(e,t,i,s,n){var o=this.getCurrentUserPresetQuery()+e+"/"+t+"/"+i+"/"+s;r.setItem(o,n),r.commit()},_addAttributeOnDB:function(e,t,i,s,n){var o=this.getCurrentUserPresetQuery()+e+"/"+t+"/"+i+"/"+s;r._addItem(o,n),r.commit()},_renameAttributeOnDB:function(e,t,i,s,n){var o=this.getCurrentUserPresetQuery()+e+"/"+t+"/"+i+"/"+s,a=this.getCurrentUserPresetQuery()+e+"/"+t+"/"+i+"/"+n;r._renameItem(o,a),r.commit()},_removeAttributeOnDB:function(e,t,i,s){var n=this.getCurrentUserPresetQuery()+e+"/"+t+"/"+i+"/"+s;r._removeItem(n),r.commit()},setAttributeOnDB:function(e,t,i,s,n){var o=this.getCurrentUserPresetQuery()+e+"/Custom/"+i+"/",a=o+s;r.setItem(a,n);var l=o+"Preset";r.setItem(l,t)},setProperty:function(e,t,r){this.setPropertyOnViewer(e,t,r),this.setPropertyOnDB(e,t,r)},setPropertyOnViewer:function(t,r,i){"Default"===r&&(r=this.defaultPreset);var s=this._getRoot(t,r);if(!e.is(s))return!1;var n=s[i];if(!e.is(n))return!1;for(var o in n)if(n.hasOwnProperty(o)){var a=n[o];this.setAttributeOnViewer(t,o,a)}},setPropertyOnDB:function(t,i,s){var n=i;"Default"===i&&(n=this.defaultPreset);var o=this.getCurrentUserPresetQuery()+t+"/"+n,a=r.getItem(o);if(!e.is(a))return!1;var l=a[s];if(!e.is(l))return!1;for(var c in l)if(l.hasOwnProperty(c)){var u=l[c];this.setAttributeOnDB(t,i,s,c,u)}},_addPropertyOnDB:function(e,t,i){var s=this.getCurrentUserPresetQuery()+e+"/"+t+"/"+i;r._addItem(s,{}),r.commit()},_removePropertyOnDB:function(e,t,i){var s=this.getCurrentUserPresetQuery()+e+"/"+t+"/"+i;r._removeItem(s),r.commit()},getCurrentUserPresetQuery:function(){return"Users/"+this.currentUser+"/Preset/"},setGlobalPreset:function(e,t,r){this.setGlobalPresetOnViewer(e,t),this.setGlobalPresetOnDB(e,t,r)},setGlobalPresetOnViewer:function(t,r){"Default"===r&&(r=this.defaultPreset);var i=this._getRoot(t,r);if(!e.is(i))return!1;for(var s in i)i.hasOwnProperty(s)&&this.setPropertyOnViewer(t,r,s)},setGlobalPresetOnDB:function(t,i,s){var n=this.getCurrentUserPresetQuery()+t+"/currentGlobalPreset",o=r.getItem(n);if(this.getLocalPreset(i)&&!this.getLocalPreset(o)&&r.setItem(this.getCurrentUserPresetQuery()+t+"/currentNonLocalGlobalPreset",i),r.setItem(n,i),o!==i){this._currentGlobalPreset[t]=null;for(var a=0;a<this._webGLV6Viewers.length;a++)this._webGLV6Viewers[a]._modelEvent.publish({event:"QMGlobalProfileUpdated",data:{viewer:this._webGLV6Viewers[a],mode:t,preset:i}})}if(s){var l=i;"Default"===i&&(l=this.defaultPreset),n=this.getCurrentUserPresetQuery()+t+"/"+l;var c=r.getItem(n);if(!e.is(c))return!1;for(var u in c)c.hasOwnProperty(u)&&this.setPropertyOnDB(t,i,u)}},getCurrentGlobalPreset:function(e){if(null===this._currentGlobalPreset[e]){var t=this.getCurrentUserPresetQuery()+e+"/currentGlobalPreset",i=r.getItem(t);if(this._currentGlobalPreset[e]=i,!this.isAvailablePreset(i)){var s=this.getCurrentUserPresetQuery()+e+"/currentNonLocalGlobalPreset",n=r.getItem(s);n&&(this._currentGlobalPreset[e]=n)}}return this.isAvailablePreset(this._currentGlobalPreset[e])||(this._currentGlobalPreset[e]="Default"),this._currentGlobalPreset[e]},getPresetValue:function(e,t){return"Default"===t&&(t=this.defaultPreset),this._getRoot(e,t)},setBatching:function(e){this.setBatchingOnDB(e,!0)},getBatchingQuery:function(){return"Users/"+this.currentUser+"/Batching"},setBatchingOnDB:function(e,t){var i=this.getBatchingQuery();r.setItem(i,!!e)},getBatching:function(){var e=this.getBatchingQuery();return!!r.getItem(e)},setLocalCache:function(e){this.setLocalCacheOnDB(e,!0)},getLocalCacheQuery:function(){return"Users/"+this.currentUser+"/LocalCache"},setLocalCacheOnDB:function(e,t){var i=this.getLocalCacheQuery();r.setItem(i,!!e)},getLocalCache:function(){if(void 0!==this.forceLocalCache)return this.forceLocalCache;if(!this.activateLocalCache||n.AutomatedTests()||a())return!1;var e=this.getLocalCacheQuery(),t=r.getItem(e);return!(void 0!==t&&!t)},getLocalCacheSizeQuery:function(){return"Users/"+this.currentUser+"/LocalCacheSize"},setLocalCacheSizeOnDB:function(e,t){var i=this.getLocalCacheSizeQuery();r.setItem(i,e)},getLocalCacheSize:function(e){let t=e&&this.getLDHOpt1ExtendMemory(),i=t?5120:2048;if(t)return i;var s=this.getLocalCacheSizeQuery(),n=r.getItem(s),o=parseInt(n);return isFinite(o)&&o>=0&&o<=i?o:i},setLDHOpt1ExtendMemory:function(e){this.setLDHOpt1ExtendMemoryOnDB(e,!0)},getLDHOpt1ExtendMemoryQuery:function(){return"Users/"+this.currentUser+"/LDHOpt1ExtendMemory"},setLDHOpt1ExtendMemoryOnDB:function(e,t){var i=this.getLDHOpt1ExtendMemoryQuery();r.setItem(i,!!e)},getLDHOpt1ExtendMemory:function(){if(void 0!==this.forceLDHOpt1ExtendMemory)return this.forceLDHOpt1ExtendMemory;if(window.__karma__||a())return!1;var e=this.getLDHOpt1ExtendMemoryQuery(),t=r.getItem(e);return!(void 0===t||!t)},setLDHOpt2SSB:function(e){this.setLDHOpt2SSBOnDB(e,!0)},getLDHOpt2SSBQuery:function(){return"Users/"+this.currentUser+"/LDHOpt2SSB"},setLDHOpt2SSBOnDB:function(e,t){var i=this.getLDHOpt2SSBQuery();r.setItem(i,!!e)},getLDHOpt2SSB:function(){if(void 0!==this.forceLDHOpt2SSB)return this.forceLDHOpt2SSB;if(window.__karma__||a())return!1;var e=this.getLDHOpt2SSBQuery(),t=r.getItem(e);return!(void 0===t||!t)},setLDHOpt3Compression:function(e){this.setLDHOpt3CompressionOnDB(e,!0)},getLDHOpt3CompressionQuery:function(){return"Users/"+this.currentUser+"/LDHOpt3Compression"},setLDHOpt3CompressionOnDB:function(e,t){var i=this.getLDHOpt3CompressionQuery();r.setItem(i,!!e)},getLDHOpt3Compression:function(){if(void 0!==this.forceLDHOpt3Compression)return this.forceLDHOpt3Compression;if(window.__karma__||a())return!1;var e=this.getLDHOpt3CompressionQuery(),t=r.getItem(e);return!(void 0===t||!t)},getDBRevision:function(){return r.getItem("DBRevision")},incrementDBRevision:function(){this.setDBRevision(this.getDBRevision()+1),this._refreshViewers()},setDBRevision:function(e){r.setItem("DBRevision",e),this.commitToDB(!1)},getDBVersion:function(){return r.getItem("DBVersion")},setDBVersion:function(e){this.version=e,r.setItem("DBVersion",e),this.commitToDB(!1)},commitToDB:function(e=!0){e?this.incrementDBRevision():r.commit()},restoreFromDB:function(){r.retoreDB(),this._refreshPreset()},_refreshViewers:function(){if(this.revision!==this.getDBRevision()){for(var e=0;e<this._webGLV6Viewers.length;e++){var t=this._webGLV6Viewers[e];t._applyQMSettings("Static","static"),t._applyQMSettings("Dynamic","dynamic")}this.revision=this.getDBRevision()}},linkToViewer:function(e){this._webGLV6Viewers.push(e)},dispose:function(e){const t=this._webGLV6Viewers.indexOf(e);t>=0&&this._webGLV6Viewers.splice(t,1)}})}));