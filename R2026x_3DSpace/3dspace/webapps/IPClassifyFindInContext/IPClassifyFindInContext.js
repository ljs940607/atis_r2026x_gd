define("DS/IPClassifyFindInContext/service/FindInTreeServices",["i18n!DS/IPClassifyFindInContext/assets/nls/FindInTree","DS/Core/PointerEvents","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUXUtil/utils/CancellablePromise"],((e,t,n,i)=>{"use strict";const s=100;let o=[];async function r(t=0,n,{paths:a,allPhysicalIds:d,objectsMapping:h}){if("string"==typeof n.nodeToFindIn&&(n.nodeToFindIn=[n.nodeToFindIn]),t<n.nodeToFindIn.length){const c=n.nodeToFindIn.slice(t,t+10);if(d.size<s){const e=function(e,t,{paths:n,allPhysicalIds:o,objectsMapping:r}){let a=e[0];["General Library","Folder","IP Protection Library","Export Control Library"].includes(t.type)&&1===e.length&&(e=e[0]);return new i(((i,l)=>{t.dataProvider.findTreeNodes({pid:e,searchFTSquery:t.searchFTSquery,rscIdToSearch:t.rscIdToSearch,type:t.type,treeNode:t.treeNode,onComplete:function(e){(e.results||[]).every((e=>{if(e.attributes){const n=e.attributes.find((e=>"resourceid"===e.name));if(n&&(!t.excludeRoot||n!==a)){let t={};e.attributes.forEach((e=>t[e.name]=e.value)),o.add(n.value)}}else if(e.Path){let i;e.matching_lengths?(i=e.matching_lengths.flatMap((t=>e.Path[t-1])),i.push(e.Path[e.Path.length-1])):i=[e.Path[e.Path.length-1]],i.forEach((e=>{t.excludeRoot&&e===a||o.add(e)})),n.push(e.Path)}else e.resourceid&&(r[e.resourceid]=e);return o.size<s})),i()},onFailure:l})}))}(c,n,{paths:a,allPhysicalIds:d,objectsMapping:h});o.push(e),await e,await r(t+10,n,{paths:a,allPhysicalIds:d,objectsMapping:h})}0===t&&d.size>=s&&l(n.dataProvider.NlsTree.msg_info_limit_FindInTree||e.msg_info_limit_FindInTree)}}function a(){o.forEach((e=>e.cancel())),o=[]}function l(e){let t={message:e};"object"==typeof e&&(t=e),n.displayNotification({...t,className:"info"})}function d(e){console.error(e),a()}return{_findsInTree:async function(i){const o=new Set;let h={},c=[];var u=i.treeLoader;const g=e=>{e.stopPropagation(),i.highLightNodes()};i.cancelObject.cancel=a,u.loader.addEventListener(t.POINTERHIT,g),u.setMessage(e.loader.retrievingPaths);let f=Array.isArray(i.nodeToFindIn);await r(0,{...i,excludeRoot:!f},{paths:c,objectsMapping:h,allPhysicalIds:o}).catch(d);let m=[...o];m.splice(s),i.dataProvider.expandStructureWithPath?(i.dataProvider.expandStructureWithPath(i.nodeToFindIn,{paths:c,objectsMapping:h,allPhysicalIds:o}),i.setNodesIdTobeHighLighted(m),i.highLightNodes(m)):i.dataProvider.expandTreeAndSelectNode({folderToFindAndSelect:{ids:m},findInTree:!0,findInTreeLoader:u,doNotSelectInTree:!0,partiallyExpandPath:!0,test:!0,onComplete:function(t){i.setNodesIdTobeHighLighted(t.folderToFindAndSelect.ids),i.highLightNodes(t.folderToFindAndSelect.ids),n.displayNotification({message:i.dataProvider.NlsTree&&i.dataProvider.NlsTree.msg_info_searchCompleted?i.dataProvider.NlsTree.msg_info_searchCompleted:e.msg_info_searchCompleted,className:"info"})},onGiveUp:i.highLightNodes,onFailure:i.highLightNodes}),u.loader&&u.loader.removeEventListener(t.POINTERHIT,g),o.size||l(i.dataProvider.NlsTree.msg_info_No_Occurrence||e.msg_info_No_Occurrence)}}})),define("DS/IPClassifyFindInContext/views/FindInCTxUI",["css!DS/IPClassifyFindInContext/IPClassifyFindInContext.css","DS/Controls/Abstract","UWA/Core","DS/Utilities/Utils","DS/Core/PointerEvents","i18n!DS/IPClassifyFindInContext/assets/nls/FindInContent","DS/Controls/Tab","DS/Controls/Button","DS/CoreEvents/ModelEvents","DS/Controls/TooltipModel","DS/WUXAutoComplete/AutoComplete","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/UIKIT/Spinner","DS/WidgetServices/WidgetServices"],(function(e,t,n,i,s,o,r,a,l,d,h,c,u,g,f){"use strict";var m=t.extend({init:function(e){this._parent(e),this.placeholder=e.placeholder,this.onDrop=e.onDrop,this.keyLocalStorage=e.keyLocalStorage,this._queryLimit=e.queryLimit?e.queryLimit:10,this.savedQueries=localStorage.getItem(this.keyLocalStorage)?JSON.parse(localStorage.getItem(this.keyLocalStorage)):[],this.launchFindInCtx=e.launchFindInCtx,this.onSelectAll=e.onSelectAll,this.onFindPreviousResult=e.onFindPreviousResult,this.onFindNextResult=e.onFindNextResult,this.errorMsgonNoFind=e.errorMsgonNoFind,this.close=e.close,this.explicitCheckforFind=e.explicitCheckforFind,this.modelEvents=e.modelEvents,this.buildSkeleton()},buildSkeleton:function(){var e=this;this.elements.container.addClassName("bookmark-controls-search-container"),this.elements.findEditor=new h({multiSearchMode:!1,placeholder:this.placeholder,allowFreeInput:!0,filterCB:function(){let t=this.getValueToCommit();t.length>0&&(e.getSearchBtn().disabled=!1),void 0!==e.getSearchBtn()&&0===t.length&&(e.getSearchBtn().disabled=!0,e._resetUI())}}).inject(this.elements.container),this.elements.findEditor.getContent().addClassName("bookmark-controls-search-editor");var t=this.savedQueries?this.savedQueries:[];this.elements.findEditor.elementsTree=this._createModel(t),this.elements.textInfo=n.createElement("div",{class:"bookmark-findin-label"}).inject(this.elements.findEditor.getContent().getChildren()[0]),f.isTouchDevice()&&this.elements.textInfo.setAttributeNode(document.createAttribute("touch-mode")),this.elements.spinner=new g({visible:!1,animate:!0,spin:!0}),this.elements.spinner=new g({visible:!1,animate:!0,spin:!0}).inject(this.elements.findEditor.getContent().getChildren()[0]),this.elements.spinner.elements.container.addClassName("bookmark-findin-spinner"),this.elements.findEditor.getContent().ondrop=function(t){e.onDrop(t)};var i=n.createElement("div",{class:"bookmark-findin-action-div"}).inject(this.elements.container);this.elements.searchBtn=new a({emphasize:"secondary",icon:{iconName:"check",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},disabled:!0}).inject(i),this.elements.searchBtn.tooltipInfos=new d({longHelp:o.findInCtxSearchView.ftssearch}),this.elements.chevronUpBtn=new a({emphasize:"secondary",icon:{iconName:"chevron-up",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"}}).inject(i),this.elements.chevronUpBtn.tooltipInfos=new d({longHelp:o.findInCtxSearchView.chevronUpBtn}),this.elements.chevronDwnBtn=new a({emphasize:"secondary",icon:{iconName:"chevron-down",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"}}).inject(i),this.elements.chevronDwnBtn.tooltipInfos=new d({longHelp:o.findInCtxSearchView.chevronDwnBtn}),this.onSelectAll&&(this.elements.selectOnBtn=new a({emphasize:"secondary",icon:{iconName:"select-on",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"}}).inject(i),this.elements.selectOnBtn.tooltipInfos=new d({longHelp:o.findInCtxSearchView.selectAll})),this._addEventListenersOnPanelElements()},_resetUI:function(){this.removeLabel(),this.elements.chevronUpBtn.disabled=!0,this.elements.chevronDwnBtn.disabled=!0,this.elements.searchBtn.disabled=!1,this.modelEvents&&this.modelEvents.publish({event:"ResetFindInCtxFilter"})},_createNode:function(e){return new u({label:e,value:e,icons:[{iconName:"clock"}]})},_createModel:function(e){var t=this._treemodel=new c;t.prepareUpdate();for(var n=0;n<e.length;n++){var i=this._createNode(e[n]);t.addRoot(i)}return t.pushUpdate(),t},addQuery:function(e){var t=this.savedQueries;-1==t.indexOf(e)&&e&&e.length&&(t.length<this._queryLimit?(t.unshift(e),localStorage.setItem(this.keyLocalStorage,JSON.stringify(t)),this._treemodel.addRoot(new u({label:e,value:e,icons:[{iconName:"clock"}]}),0)):e&&e.length&&(t.pop(),t.unshift(e),localStorage.setItem(this.keyLocalStorage,JSON.stringify(t)),this._treemodel.removeRoot(this._treemodel.getRoots().length-1),this._treemodel.addRoot(new u({label:e,value:e,icons:[{iconName:"clock"}]}),0)))},_addEventListenersOnPanelElements:function(){var e=this;this.elements.findEditor.getContent().addEventListener("keydown",(function(t){var i=n.Event.whichKey(event);"return"===i?e.elements.searchBtn.disabled||(e.launchFindInCtx(e.findStr),e.setLoadingState(!0),t.stopPropagation()):"esc"===i&&(e.close(),t.stopPropagation())})),this.elements.searchBtn.addEventListener(s.POINTERHIT,(function(t){e.elements.searchBtn.disabled||(e.launchFindInCtx(e.findStr),e.setLoadingState(!0),t.stopPropagation())})),this.elements.findEditor.addEventListener("change",e.checkforDisplayofFindButton.bind(e)),this.elements.chevronUpBtn.addEventListener(s.POINTERHIT,(function(){e.elements.chevronUpBtn.disabled||e._goToPreviousFindResult()})),this.elements.chevronDwnBtn.addEventListener(s.POINTERHIT,(function(){e.elements.chevronDwnBtn.disabled||e._goToNextFindResult()})),this.onSelectAll&&this.elements.selectOnBtn.addEventListener(s.POINTERHIT,(function(){e.elements.selectOnBtn.disabled||e.onSelectAll()}))},setLoadingState:function(e){this._setLoadingState(e)},show:function(){this._parent.apply(this,arguments),this.elements.findEditor.focus()},_setLoadingState:function(e){e?(this.elements.spinner.show(),this.elements.textInfo.hide(),this.elements.searchBtn.disabled=!0,this.elements.findEditor.disabled=!0,this.elements.findEditor._editor.disabled=!0):(this.elements.spinner.hide(),this.elements.textInfo.show(),this.checkforDisplayofFindButton(),this.elements.findEditor.disabled=!1,this.elements.findEditor._editor.disabled=!1,this.modelEvents&&this.modelEvents.publish({event:"findInCtxUXUpdated"}))},setMatchingStringCount:function(e,t){this.count=e,t||(this.currentValue=0,this.setLoadingState(!1)),this.count>0&&0===this.currentValue&&(this.currentValue=1),this._displayCurrentValue()},setCurrentValue:function(e){switch(e){case"previous":this.currentValue>1?this.currentValue=this.currentValue-1:this.currentValue=this.count;break;case"next":this.currentValue<this.count?this.currentValue=this.currentValue+1:this.currentValue=1}this._displayCurrentValue()},_displayCurrentValue:function(){var e=void 0!==this.currentValue&&void 0!==this.count&&0!==this.count?this.currentValue+"/"+this.count:"";""==e?this.removeLabel():this.setLabel(e);var t=!(this.count>1);this.elements.chevronUpBtn&&this.elements.chevronDwnBtn&&(this.elements.chevronUpBtn.disabled=t,this.elements.chevronDwnBtn.disabled=t),0===this.count?(this.onSelectAll&&(this.elements.selectOnBtn.disabled=!0),this.errorMsgonNoFind&&this.errorMsgonNoFind()):this.onSelectAll&&(this.elements.selectOnBtn.disabled=!1)},_goToPreviousFindResult:function(){var e=this.currentValue;this.count&&0!==this.count&&(this.currentValue>1?this.currentValue--:this.currentValue=this.count,this._displayCurrentValue()),this.currentValue&&e!==this.currentValue&&this.onFindPreviousResult&&this.onFindPreviousResult()},_goToNextFindResult:function(){var e=this.currentValue;this.count&&0!==this.count&&(this.currentValue<this.count?this.currentValue++:this.currentValue=1,this._displayCurrentValue()),this.currentValue&&e!==this.currentValue&&this.onFindNextResult&&this.onFindNextResult()},checkforDisplayofFindButton:function(){this.findStr=this.elements.findEditor.value?this.elements.findEditor.value.trim():this.elements.findEditor.value;var e=!this.explicitCheckforFind||this.explicitCheckforFind();this.findStr&&this.findStr.length&&!0!==this.loadingInProgress&&e?this.elements.searchBtn.disabled=!1:this.elements.searchBtn.disabled=!0},setLabel:function(e){this.elements.textInfo&&(this.elements.textInfo.innerHTML=e);var t="padding-right:"+(this.elements.textInfo.getSize().width+30+"px")+" !important; width: 100%";this.getLineEditor()&&this.getLineEditor()._myInput&&this.getLineEditor()._myInput.setAttribute("style",t)},hasLabel:function(){return!!this.elements.textInfo},removeLabel:function(){this.elements.textInfo&&(this.elements.textInfo.innerHTML="");this.getLineEditor()&&this.getLineEditor()._myInput&&this.getLineEditor()._myInput.setAttribute("style","padding-right: 20px !important; width: 100%")},getLineEditor:function(){return this.elements.findEditor._editor},getTextInfo:function(){return this.elements.textInfo},getFindEditor:function(){return this.elements.findEditor},clearEditor:function(){this.getFindEditor().value=""},getSearchBtn:function(){return this.elements.searchBtn},getPreviousBtn:function(){return this.elements.chevronUpBtn},getNextButton:function(){return this.elements.chevronDwnBtn},getSelectAllBtn:function(){return this.elements.selectOnBtn}});return m})),define("DS/IPClassifyFindInContext/FindInContent",["css!DS/IPClassifyFindInContext/IPClassifyFindInContext.css","DS/Controls/Abstract","UWA/Core","DS/Utilities/Utils","DS/IPClassifyFindInContext/views/FindInCTxUI","i18n!DS/IPClassifyFindInContext/assets/nls/FindInContent","DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPTypesMgt","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/IPClassifyUtil/IPClassifyAlert","DS/Controls/Accordeon","DS/Controls/TooltipModel","DS/Controls/ComboBox"],(function(e,t,n,i,s,o,r,a,l,d,h,c,u){var g=function(){this._selectionPanel._getMainElement().getChildren()[1].innerText=o.Allcolumns};return t.extend({name:"FindInCtx",searchWithFTS:!0,markForRecordFlag:!0,buttonFindInBookmark:!1,buttonAutoSelect:!1,init:function(){this._parent()},buidUI:function(e){var t=this;this.dataProvider=e.dataProvider,this.findInBookmark=e.findInBookmark,this.target=e.target,this.position=e.position,this.placeholder=o.placeholder_findInCtx,this.title=e.title,this._nodesForFindInCtx=e.nodesForFindInCtx,this.visibleFlag=!0,this._biFilter=this.dataProvider.getContentFilter(),this.dgv=this.dataProvider.getGridView(),this.elements.container.addClassName("bookmark-controls-search"),this.commonFindInCtxUI=new s({keyLocalStorage:"BM_FindInCtx_savedQueries",queryLimit:10,onDrop:this._onDrop.bind(this),placeholder:this.placeholder,launchFindInCtx:this._launchFindInCtxService.bind(this),onSelectAll:!1!==e.multiselection?this._onSelectAll.bind(this):void 0,onFindPreviousResult:this._goToPreviousMatchingCell.bind(this),onFindNextResult:this._goToNextMatchingCell.bind(this),errorMsgonNoFind:this.displayErrorNotification.bind(this),explicitCheckforFind:this.explicitCheckforFind.bind(this),close:function(){t.dataProvider.onContentFindClose()}}).inject(this.elements.container),this.findEditor=this.commonFindInCtxUI.getFindEditor(),this.searchBtn=this.commonFindInCtxUI.getSearchBtn(),this.previousBtn=this.commonFindInCtxUI.getPreviousBtn(),this.nextBtn=this.commonFindInCtxUI.getNextButton(),this.selectAllBtn=this.commonFindInCtxUI.getSelectAllBtn();var i=n.createElement("div",{class:"bookmark-findinCTx-options-expander"}),r=this.elements.checkButtonGroup=new l({type:"checkbox"});if(r.addChild(new a({type:"checkbox",label:o.findInCtxAutoSelect,tooltipInfos:new c({shortHelp:o.findInCtxAutoSelect}),checkFlag:t.buttonAutoSelect})),r.inject(i),r.getContent().addClassName("bookmark-findInCtx-checkbtnGrp"),this.findInBookmark&&widget.getPreference("allow-products-expand").value){let e=new a({type:"checkbox",label:o.findInCtxSearchView.checkButtonGroupLabel,tooltipInfos:new c({shortHelp:o.findInCtxSearchView.checkButtonGroupLabel}),checkFlag:t.buttonFindInBookmark});r.addChild(e)}r.addEventListener("change",(e=>{1==e.dsModel.getButtonCount()?this.buttonAutoSelect=e.dsModel.getButton(0).checkFlag:(this.buttonAutoSelect=e.dsModel.getButton(0).checkFlag,this.buttonFindInBookmark=e.dsModel.getButton(1).checkFlag,this._updateElementList())})),n.createElement("div",{class:"bookmark-findInCTx-selection-name",text:o.FindIn+" :"}).inject(i),this._getColumnSelectionPanel().inject(i);new h({items:[{header:o.Options,content:i}],style:"simple"}).inject(this.elements.container);this.findEditor.addEventListener("change",(function(){t.searchWithFTS=!0})),this.searchBtn.disabled=!0,this.previousBtn.disabled=!0,this.nextBtn.disabled=!0,this.selectAllBtn&&(this.selectAllBtn.disabled=!0),this._createPanel(),this._subscribeToTheExternalEvents()},_createPanel:function(){var e=this,t=require("DS/Windows/Dialog"),i=new n.Element("div",{styles:{"vertical-align":"top","min-height":"286px",position:"relative"}}),s=new n.Element("div",{class:"wux-control-inline-container"});i.inject(s);var r=this.dataProvider.getTreeWidth();this._panel=new t({title:o.findInCtxSearchView.title+this.title,content:e.elements.container,position:e.position?{of:e.target,my:"top left",at:"top left",offsetX:r+e.position.x,offsetY:e.position.y+30}:{of:e.target,my:"center",at:"center"},width:320,minWidth:320,minHeight:40,allowedDockAreas:0,collapsibleFlag:!1}),e._panel.getContent().querySelector(".wux-windows-window-content").setStyle("padding","3px"),this._panel.addEventListener("close",(function(t){e.dataProvider.onContentFindClose()})),this._panel.getContent().addClassName("bookmark-findInCtx-panel")},_launchSearchFTS:function(e){var t=this._isFindInBookmarkFlat(),n={biFilter:this._biFilter,query:t?e:this._constructQuery(e),nodes:this._nodesForFindInCtx,findFlatInBookmark:t,highLightNodes:this.highlightElements.bind(this)},i=this._stringTobeHighlighted=e;this.dataProvider.findContentNodes(n),n.findFlatInBookmark||0==n.nodes.length&&d.displayNotification({message:this.dataProvider.NlsContent.msg_error_FindInCtx_noValidPhysicalObject,className:"error"}),this.commonFindInCtxUI.addQuery(i)},_launchSearchID:function(e){var t={biFilter:this._biFilter,nodes:this._nodesForFindInCtx,rscIdToSearch:this.rscIdToSearch,findFlatInBookmark:this._isFindInBookmarkFlat(),highLightNodes:this.highlightElements.bind(this)};this._stringTobeHighlighted=e;this.dataProvider.findContentNodes(t)},_launchFindInCtxService:function(e){this.searchBtn.disabled||(this.searchWithFTS?this._launchSearchFTS(e):this._launchSearchID(e))},_isFindInBookmarkFlat:function(){var e=this.elements.checkButtonGroup;if(e&&2==e.getButtonCount())var t=e.getButton(1).checkFlag;return!!this.findInBookmark&&(!widget.getPreference("allow-products-expand").value||t)},_isMatchingNodeTobeSelected:function(){var e=this.elements.checkButtonGroup;return!!e&&e.getButton(0).checkFlag},closeViewafterRefresh:function(){this.dataProvider.onContentFindClose()},_onDrop:function(e){var t=this;if(e.preventDefault(),"{}"!==e.dataTransfer.getData("text/plain")){var n=JSON.parse(e.dataTransfer.getData("text/plain"));if(1===n.data.items.length){var i=[],s=n.data.items[0],a=s.objectId,l=s.objectType,h=s.displayName;l&&h?function(e,n,s){i.push({type:n}),r.isTypesAuthorized(i,(function(n){n.length>0&&(t.findEditor.value=s,setTimeout((function(){t.searchWithFTS=!1,t.rscIdToSearch=e}),300))})),"Workspace"===n&&"Workspace Vault"===n||(!widget.getPreference("allow-products-expand").value||t.elements.checkButtonGroup&&t.elements.checkButtonGroup.value[0])&&(t.findEditor.value=s,setTimeout((function(){t.searchWithFTS=!1,t.rscIdToSearch=e}),300))}(a,l,h):(this.findEditor&&(this.findEditor.value=o.findInCtxSearchView.loadingLabel),t.loadingInProgress=!0,require(["DS/PADServices/ws/WSAccess","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/ParserUtils"],(function(e,n,i){(e.fetch?Promise.resolve():n.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0})).then((function(){var n={pids:[a],data:{select_predicate:["ds6w:label","ds6w:type"],select_file:[]}};e.fetch(n).then((function(e){var n="string"==typeof e?JSON.parse(e):e;if(n.results&&1===n.results.length){var s=n.results[0],r=i.parseAttributes(s.attributes);h=r.label,delete t.loadingInProgress,t.findEditor.value=h}else d.displayNotification({message:o.findInCtxSearchView.cannotRetrieveLabel,className:"error"})})).catch((function(){d.displayNotification({message:o.findInCtxSearchView.cannotRetrieveLabel,className:"error"})}))}))})))}}},_subscribeToTheExternalEvents:function(){var e=this;this.dataProvider.onCurrentSelectionChange((function(t){e&&e.dataProvider.onContentFindClose()})),this.dataProvider.onContentSearchChange((function(){e&&e.dataProvider.onContentFindClose()}))},_onSelectAll:function(){if(this.dgv){var e=this.dgv.getMatchingFindNodeModelArray();if(e&&e.length){let n=e[0].getTreeDocument();n.prepareUpdate();for(var t=0;t<e.length;t++)e[t].isSelected()||e[t].select();n.pushUpdate()}}},displayErrorNotification:function(){d.displayNotification({message:o.msg_success_FindInCtx_NoObjectFound,className:"info"})},highlightElements:function(e,t,n){var i=this,s=[];if(t.length>0&&e.forEach((function(e){for(var n=0;n<t.length;n++){var i=e.getNodeByPath(t[n]);i&&i.isVisible()&&s.push(i)}})),n.length>0&&(s=s.concat(n)),this.dgv)if(this.dgv.closeFind(),s.length>0){var o=this.dgv;o.findWidget=i.commonFindInCtxUI,o.findNavigationMode="row",o.getNodeModelToProcessForFind=function(e,t){return s},this._selectionPanel&&this._selectionPanel.currentValue&&(o.getColumnsToProcessForFind=function(e,t){return i._getSelectedColumnDataIndex()}),o.setFindStr(this._stringTobeHighlighted,void 0,void 0,void 0,!0),this._isMatchingNodeTobeSelected()&&this._selectCurrentMatchingRow(),this.commonFindInCtxUI.setMatchingStringCount(o.matchingStringCount)}else this.commonFindInCtxUI.setMatchingStringCount(0)},_getColumnList:function(){var e=[];this.dataProvider.getContentColumnsToIgnore&&(e=this.dataProvider.getContentColumnsToIgnore()),this._isFindInBookmarkFlat()||(e=e.concat(["ds6w:type","ds6w:status","ds6w:policy","ds6w:organizationResponsible","ds6w:project"]));var t=this.dgv.layout.columns,n=[];n.push({label:o.Allcolumns,value:"All columns"});for(var i=0;i<t.length;i++){var s=t[i];let o=!1;if(s.convertInfos&&s.convertInfos.manipulationUnit&&s.convertInfos.manipulationUnit!==s.convertInfos.unit&&(o=!0),0!=s.visibleFlag&&-1==e.indexOf(s.dataIndex)&&"dateTime"!==s.kind&&"timestamp"!==s.kind&&!o){var r={label:s.text,value:s.dataIndex};n.push(r)}}return n},_updateElementList:function(){let e=this._selectionPanel.selectedIndexes,t=e.length===this._selectionPanel.elementsList.length,n=this._getColumnList();this._selectionPanel.elementsList=n,this._selectionPanel.selectedIndexes=t?Array.from(Array(n.length).keys()):e,t&&g.call(this)},_getColumnSelectionPanel:function(){var e=this;if(!this._selectionPanel){var t=this._getColumnList();this._selectionPanel=new u({placeholder:o.placeholder_noSelection,autocompleteFlag:!1,enableSearchFlag:!1,multiSelFlag:!0,elementsList:t}),this._selectionPanel.selectedIndexes=Array.from(Array(t.length).keys());var n=e._selectionPanel.currentValue;g.call(this);var i=[];t.forEach((function(e){i.push(e.value)})),this._selectionPanel.addEventListener("change",(function(t){var s=e._selectionPanel.elementsList.length,o=e._selectionPanel.selectedIndexes.length,r=e._selectionPanel.currentValue.indexOf("All columns")>-1,a=function(e,t){for(var n=[],i=[],s=0;s<e.length;s++)n[e[s]]=!0;for(s=0;s<t.length;s++)n[t[s]]?delete n[t[s]]:n[t[s]]=!0;for(var o in n)i.push(o);return i}(n,e._selectionPanel.currentValue);if(a.indexOf("All columns")>-1&&1==a.length||0==e._selectionPanel.preselectedIndex)r?(n=i,e._selectionPanel.selectedIndexes=Array.from(Array(s).keys()),g.call(e)):(n=[],e._selectionPanel.selectedIndexes=[]);else if(r||o!=s-1)if(r&&o==s-1){var l=[];e._selectionPanel.selectedIndexes.forEach((function(e){l.push(e)})),l.shift(),(n=JSON.parse(JSON.stringify(i))).shift();var d=n.indexOf(a[0]);n.splice(d,1),e._selectionPanel.selectedIndexes=l}else n=e._selectionPanel.currentValue;else n=i,e._selectionPanel.selectedIndexes=Array.from(Array(s).keys()),g.call(e)})),this._selectionPanel.addEventListener("hide",(function(){e._selectionPanel.currentValue.indexOf("All columns")>-1&&g.call(e),0==e._selectionPanel.currentValue.length?e.searchBtn.tooltipInfos.longHelp=o.error_tooltip_NoColumnSelected:e.searchBtn.tooltipInfos.longHelp=o.findInCtxSearchView.ftssearch,e.findEditor.fire("change")}))}return this._selectionPanel},_getSelectedColumnDataIndex:function(){var e=JSON.parse(JSON.stringify(this._selectionPanel.currentValue)),t=e.indexOf("All columns");return t>-1?(e.splice(t,1),e):e},_constructQuery:function(e){for(var t=this.dgv.layout.columns,n=this._getSelectedColumnDataIndex(),i="",s=!parseInt(e),o=!parseFloat(e),r=" OR ",a={},l=0;l<t.length;l++)a[t[l].dataIndex]=t[l];for(var d=0;d<n.length;d++){var h=null,c=!1;let t="*",l="*",u=a[n[d]];u&&(h=u.ds6w,o&&("real"===u.kind||u.convertInfos)&&(c=!0),s&&"integer"===u.kind&&(c=!0),("real"===u.kind||u.convertInfos||"integer"===u.kind)&&(t="",l=""),"string"!==u.kind&&"string"!==u.typeRepresentation&&"url"!==u.typeRepresentation&&"tag"!==u.typeRepresentation||(t='"*',l='*"')),c||h&&(i=i+"["+h+"]:"+t+e+l,d!==n.length-1&&(i+=r))}return i.lastIndexOf(r)===i.length-4&&(i=i.substring(0,i.length-4)),i},explicitCheckforFind:function(){return!this._selectionPanel||0!=this._selectionPanel.currentValue},_goToPreviousMatchingCell:function(){this.dgv.goToPreviousMatchingCell(),this._isMatchingNodeTobeSelected()&&this._selectCurrentMatchingRow()},_goToNextMatchingCell:function(){this.dgv.goToNextMatchingCell(),this._isMatchingNodeTobeSelected()&&this._selectCurrentMatchingRow()},_selectCurrentMatchingRow:function(){var e=this.dgv._rowModel._currentMatchingNodeModel;e&&!e.isSelected()&&e.select(!0)},close:function(){this.dgv&&this.dgv.closeFind(),this._selectionPanel.destroy(),this._selectionPanel=null,this.dgv.getNodeModelToProcessForFind=void 0,this.visibleFlag=!1,this._panel.destroy(),this._panel=null}})})),define("DS/IPClassifyFindInContext/FindInTree",["css!DS/IPClassifyFindInContext/IPClassifyFindInContext.css","DS/Controls/Abstract","UWA/Core","DS/CoreEvents/ModelEvents","DS/Controls/TooltipModel","DS/IPClassifyFindInContext/views/FindInCTxUI","DS/IPClassifyFindInContext/service/FindInTreeServices","DS/Controls/Loader","DS/Utilities/Utils","i18n!DS/IPClassifyFindInContext/assets/nls/FindInTree","DS/IPClassifyUtil/IPClassifyAlert"],(function(e,t,n,i,s,o,r,a,l,d,h){"use strict";return t.extend({_name:"folder_FindInTree",searchWithFTS:!0,_nodesIdToFindIn:null,_isComponentVisible:!1,_isTreeTaggerApplied:!1,_currentFolder:null,init:function(e){this.dataProvider=e.dataProvider,this.findInContainerDiv=e.findInContainerDiv,this._parent(e),this.options.modelEvents=e.modelEvents?e.modelEvents:new i,this._buildSkeleton(e.createButton),this.disableClickEvent="boolean"==typeof e.disableClickEvent&&e.disableClickEvent},_buildSkeleton:function(e){var t=this;this.elements.container.addClassName("folder_FindInTree"),!1!==e&&(this._findInTreeIcon=n.createElement("i",{class:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-find"}).inject(this.elements.container),this._findInTreeIcon.addEventListener("click",this.clickEvent.bind(this)),this._findInTreeIcon.tooltipInfos=new s({shortHelp:d.toolTip})),this._createFindUI();let i=l.debounce((()=>{if(this._isComponentVisible){var e=this._getNodesIdTobeHighlighted();e&&e.length>0&&this._highlightNodes(e,!1)}}),100);this.dataProvider.onTreeUpdated&&this.dataProvider.onTreeUpdated(i),this.dataProvider.onTreeFilterChange((function(e){if(t._isTreeTaggerApplied=e,t._isComponentVisible)if(t._findInTreeloader.loader&&t._findInTreeloader.loader.visibleFlag){var n=t._findInTreeloader.loader.elements.stopButton;n&&n.getContent().click(),t.hideUI(),h.displayNotification({title:d.msg_warning_TreeTagger_ClosingThefind.Title,message:d.msg_warning_TreeTagger_ClosingThefind.Details,className:"warning"})}else{var i=t._getNodesIdTobeHighlighted();i&&i.length?t._highlightNodes(i):t._highlightNodes()}})),this.options.modelEvents.subscribe({event:"ResetFindInCtxFilter"},(()=>{this.dgv&&(this.dgv.matchingStringCount=0,this.dgv.closeFind(),this.dgv.onFindReset(),this._IdsTobeHighLighted=null)})),this.options.modelEvents.subscribe({event:"findInCtxUXUpdated"},(()=>{let e=this.dataProvider.getGridView();e&&this.commonFindinTreeUI.setMatchingStringCount(e.matchingStringCount,!0)}))},clickEvent:function(e){this.disableClickEvent||(this.commonFindinTreeUI.visibleFlag?this.hideUI():this.showUI())},_updateButtonUI:async function(){let e=this.isCurrentFolderValidForFindIn();this._findInTreeIcon&&(e?this._findInTreeIcon.show():this._findInTreeIcon.hide()),this.options.modelEvents.publish({event:"findInTree button UI updated",data:{component:this,visible:e}})},_createFindUI:function(){var e=this;this.commonFindinTreeUI=new o({modelEvents:this.options.modelEvents,keyLocalStorage:e.dataProvider.autoCompleteKey,queryLimit:10,onDrop:this._onDrop.bind(this),launchFindInCtx:this._launchFindInCtxService.bind(this),onFindPreviousResult:this._goToPreviousMatchingCell.bind(this),onFindNextResult:this._goToNextMatchingCell.bind(this),close:function(){e.hideUI()}}),this.commonFindinTreeUI.elements.container.addClassName("findinTree_findcontainer"),this.commonFindinTreeUI.hide(),this.findEditor=this.commonFindinTreeUI.getFindEditor(),this.searchBtn=this.commonFindinTreeUI.getSearchBtn(),this.previousBtn=this.commonFindinTreeUI.getPreviousBtn(),this.nextBtn=this.commonFindinTreeUI.getNextButton(),this.dataProvider.onCurrentSelectionChange((()=>{if(this._isComponentVisible)if(this.isCurrentFolderValidForFindIn())if(this.dataProvider.getTreeSelectedNode()){var e=this.dataProvider.getTreeSelectedNode().getLabel();this._setNameTothePlaceholder(e)}else this._setNameTothePlaceholder(" ");else this._updateButtonUI(),this.hideUI();else this._updateButtonUI()}),{context:"tree"}),this.searchBtn.disabled=!0,this.previousBtn.disabled=!0,this.nextBtn.disabled=!0,this.findEditor.addEventListener("change",(function(){e.searchWithFTS=!0,!0===e.commonFindinTreeUI.hasLabel()&&e.commonFindinTreeUI.removeLabel()}))},hideUI:function(){this.elements.container.getParent()&&this.elements.container.getParent().getParent().removeAttribute("findInTree"),this.elements.container.removeClassName("active"),this.options.modelEvents.publish({event:"findInTree UI updated",data:{component:this,visible:!1}}),this.commonFindinTreeUI.hide(),this.findInContainerDiv&&this.findInContainerDiv.hide(),this.dgv&&(this.dgv.closeFind(),this.dgv.onFindReset(),this.commonFindinTreeUI.clearEditor()),this._isComponentVisible=!1,this._updateButtonUI()},showUI:function(){var e=this.dataProvider.getTreeSelectedNode();if(e){var t=e.getLabel();this._setNameTothePlaceholder(t),this.dgv=this.dataProvider.getGridView(),this.elements.container.getParent()&&this.elements.container.getParent().getParent().setAttribute("findInTree",!0),this.options.modelEvents.publish({event:"findInTree UI updated",data:{component:this,visible:!0}}),this.elements.container.addClassName("active"),this.findInContainerDiv&&this.findInContainerDiv.show(),this.commonFindinTreeUI.show(),this._IdsTobeHighLighted=null,this._isComponentVisible=!0,this._updateButtonUI()}else this.dataProvider.NlsTree.msg_warning_NoObjectSelected&&this.dataProvider.NlsTree.msg_warning_NoObjectSelected.Title&&h.displayNotification({title:this.dataProvider.NlsTree.msg_warning_NoObjectSelected.Title,subtitle:this.dataProvider.NlsTree.msg_warning_NoObjectSelected.Advice,message:this.dataProvider.NlsTree.msg_warning_NoObjectSelected.Details,className:"warning"})},_onDrop:function(e){var t=this;if(e.preventDefault(),"{}"!==e.dataTransfer.getData("text/plain")){var n=JSON.parse(e.dataTransfer.getData("text/plain"));if(1===n.data.items.length){var i=n.data.items[0],s=i.objectId,o=i.objectType,r=i.displayName;-1!==t.dataProvider.getSupportedTypesForDrop().indexOf(o)?(t.findEditor.value=r,setTimeout((function(){t.searchWithFTS=!1,t.rscIdToSearch=s}),300)):h.displayNotification({title:t.dataProvider.NlsTree.msg_warning_FindInTree_InvalidDrop.Title,subtitle:t.dataProvider.NlsTree.msg_warning_FindInTree_InvalidDrop.Advice,className:"warning"})}}},_launchFindInCtxService:function(e){var t=this;if(this._IdsTobeHighLighted=null,this.isCurrentFolderValidForFindIn()){this._currentFolder=this.dataProvider.getTreeSelectedNode(),this._nodesIdToFindIn=this._setNodesIdToFindIn(this._currentFolder);var n=!!this._currentFolder&&this._currentFolder.isVisible();if(this._nodesIdToFindIn&&n){var i={withCancel:!0,treeNode:this._currentFolder,commonFindinTreeUI:this.getUI(),cancelObject:{cancel:()=>{}}};this._findInTreeloader.createLoader(this.dataProvider,i),this.searchWithFTS?this._launchSearchFTS(e,i):this._launchSearchID(e,i)}else n||h.displayNotification({title:t.dataProvider.NlsTree.msg_warning_expandTotheFindInNode.Title,subtitle:t.dataProvider.NlsTree.msg_warning_expandTotheFindInNode.Advice,message:t.dataProvider.NlsTree.msg_warning_expandTotheFindInNode.Details,className:"warning"}),setTimeout((function(){t._highlightNodes()}),300)}else h.displayNotification({message:t.dataProvider.NlsTree.msg_warning_FindInTree_NoLaunchOnFavourite,className:"warning"}),setTimeout((function(){t._highlightNodes()}),300)},_launchSearchFTS:function(e,t){t={...t,nodeToFindIn:this._nodesIdToFindIn,searchFTSquery:e,type:this.currentNodeType,highLightNodes:this._highlightNodes.bind(this),setNodesIdTobeHighLighted:this._setNodesIdTobeHighLighted.bind(this),treeLoader:this._findInTreeloader,dataProvider:this.dataProvider};r._findsInTree(t);var n=this._stringTobeHighlighted=e;this.commonFindinTreeUI.addQuery(n)},_launchSearchID:function(e,t){t={...t,nodeToFindIn:this._nodesIdToFindIn,rscIdToSearch:this.rscIdToSearch,type:this.currentNodeType,highLightNodes:this._highlightNodes.bind(this),setNodesIdTobeHighLighted:this._setNodesIdTobeHighLighted.bind(this),treeLoader:this._findInTreeloader,dataProvider:this.dataProvider};this._stringTobeHighlighted=e,r._findsInTree(t)},_goToPreviousMatchingCell:function(){this.dgv.goToPreviousMatchingCell()},_goToNextMatchingCell:function(){this.dgv.goToNextMatchingCell()},_setNameTothePlaceholder:function(e){e&&this.commonFindinTreeUI&&(this.commonFindinTreeUI.getFindEditor().placeholder=d.placeholder_findInTree+" : "+e)},_highlightNodes:function(e,t){var n=this,i=[];if(e&&e.length>0&&e.forEach((function(e){var t;(t=n.dataProvider.getTreeVisibleNodesyId(e))&&i.push(t)})),i.length>0){var s=this._currentFolder.getAllDescendants(),o=[];if(s.forEach((function(e){for(var t=0;t<i.length;t++)if(i[t].id==e.id&&i[t].isVisible()){o.push(i[t]);break}})),this.dgv){this.dgv.closeFind();var r=this.dgv;r.findNavigationMode="row",r.findWidget=this.commonFindinTreeUI,r.findNavigationMode="row",r.getNodeModelToProcessForFind=function(e,t){return o},r.setFindStr(this._stringTobeHighlighted,void 0,void 0,!1===t,!0),this.commonFindinTreeUI.setMatchingStringCount(r.matchingStringCount)}}else this.dgv.closeFind(),this.dgv.matchingStringCount=0,this.commonFindinTreeUI.setMatchingStringCount(0);this._findInTreeloader.removeLoader()},_setNodesIdToFindIn:function(e){var t=this.currentNodeType=e.sectionElement&&e.sectionElement.name||e.plmType||e.getType();if(this.dataProvider.supportedSection===t){var n=this.dataProvider.getTreeSectionNodeForFind(t),i=n.getChildren();if(i.length>0&&n.isExpanded()){for(var s=[],o=0;o<i.length;o++){if(!(s.length<200)){h.displayNotification({message:this.dataProvider.NlsTree&&this.dataProvider.NlsTree.msg_info_limitToFindInRootNode?this.dataProvider.NlsTree.msg_info_limitToFindInRootNode:d.msg_info_limitToFindInRootNode,className:"info"});break}i[o].isVisible()&&s.push(i[o].options.id)}return s}if(this.dataProvider.NlsTree.msg_warning_NoObjectsUnderSection){let e=this.dataProvider.NlsTree.msg_warning_NoObjectsUnderSection.Title?{title:this.dataProvider.NlsTree.msg_warning_NoObjectsUnderSection.Title,subtitle:this.dataProvider.NlsTree.msg_warning_NoObjectsUnderSection.Advice,message:this.dataProvider.NlsTree.msg_warning_NoObjectsUnderSection.Details}:this.dataProvider.NlsTree.msg_warning_NoObjectsUnderSection;h.displayNotification({...e,className:"warning"})}return null}return e.options.id},isCurrentFolderValidForFindIn:function(){var e=this.dataProvider.getTreeSelectedNode();let t=e&&(e.sectionElement&&e.sectionElement.name||e.options.plmType||e.getType());return!(!e||t===this.dataProvider.unSupportedSection||e.isFavorite)},getUI:function(){return this.commonFindinTreeUI},isTreeTaggerApplied:function(){return this._isTreeTaggerApplied},_setNodesIdTobeHighLighted:function(e){this._IdsTobeHighLighted=e},_getNodesIdTobeHighlighted:function(){return this._IdsTobeHighLighted?this._IdsTobeHighLighted:null},_findInTreeloader:{createLoader:function(e,t){var i=e.getTreeElementToAddCommand();if(this.container=n.createElement("div",{class:"FolderEditor_findInTree_loader"}).inject(i),this.loader=new a({height:40,showButtonFlag:!0,fadeDuration:200}).inject(this.container),this.loader.on(e.NlsTree.loader.findingObjects),t&&t.withCancel){let e=()=>{t.cancelObject.cancel(),t.commonFindinTreeUI.setLoadingState(!1),this.loader.removeEventListener("buttonclick",e),this.removeLoader()};this.loader.addEventListener("buttonclick",e)}},updateLoader:function(e){this.loader&&this.loader.update(e)},removeLoader:function(){this.loader&&(this.loader.off(),delete this.loader,this.container.destroy())},setMessage:function(e){this.loader&&this.loader.on(e)}}})}));