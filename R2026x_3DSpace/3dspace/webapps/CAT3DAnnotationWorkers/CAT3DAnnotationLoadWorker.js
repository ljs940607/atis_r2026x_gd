!function(e){"use strict";var n=!1;e.onmessage=function(a){require(["DS/EasySax/EasySax","DS/Formats/CGRFile"],(function(t,s){n=!0;var i,r,l,o,d,p,g,c=a.data.xmlData,h=a.data.loadingIndex,u=a.data.ctxTypes&&a.data.ctxTypes.length?a.data.ctxTypes:null,m=0,f=!0;let x=a.data.conditions,b=a.data.nodeName;function y(e){return e?parseFloat(e.replace?e.replace(",","."):e):void 0}function k(e){var n=e;return-1!==n.indexOf("&amp;")&&(n=n.replace(/&amp;/g,"&")),-1!==n.indexOf("&gt;")&&(n=n.replace(/&gt;/g,">")),-1!==n.indexOf("&lt;")&&(n=n.replace(/&lt;/g,"<")),-1!==n.indexOf("&quot;")&&(n=n.replace(/&quot;/g,'"')),-1!==n.indexOf("&#xD;&#xA;")&&(n=n.replace(/&#xD;&#xA;/g,"&#xA;")),-1!==n.indexOf("&#xD;")&&(n=n.replace(/&#xD;/g,"&#xA;")),n}var T=function(e,n,a){for(var t=[],s=e.split(" "),i=0;i<s.length;i++)if(" "!==s[i]&&""!==s[i]){var r=a?s[i]:y(s[i]);void 0!==r&&(!n||n&&-1===t.indexOf(r))&&t.push(r)}return t};var C,v=function(e){var n=e.attributes;if(delete e.attributes,n){var a=e.type;1===e.type&&function(e,n){var a=n.indexOf("#x&amp;",0);-1!==a?e.Text=n.substring(0,a):n.length&&(e.Text=n)}(e,n),30===e.type&&function(e,n){var a="#x&amp;",t=0,s=n.indexOf(a,t);if(-1!==s){for(e.NOAText=n.substring(t,s),t=s+a.length;-1!==s;)-1!==(s=n.indexOf(a,t))&&(t=s+a.length);a=";",-1!==(s=n.indexOf(a,t))&&(e.NOAType=n.substring(s+1,n.length))}}(e,n),n=function(e,n){var a,t,s,i,r,l=0,o="#x&amp;",d={};if(1===e.type||2===e.type||30===e.type){-1!==(a=n.indexOf(o,l))&&(l=a+7),-1!==(a=n.indexOf(o,l))&&(r=n.substring(0,a),s=n.substring(l,a),d.hiddenText=s||void 0,l=a+7),a=n.indexOf(o,l);for(var p=[];-1!==a;)r||(r=n.substring(0,a)),(s=n.substring(l,a))&&(30===e.type?-1===s.indexOf(";",0)&&p.push({address:s}):p.push({address:s})),l=a+7,a=n.indexOf(o,l);-1===a&&0!==l&&(r||(r=n.substring(0,l)),(s=n.substring(l,n.length))&&30===e.type?-1===s.indexOf(";",0)&&p.push({address:s}):s&&p.push({address:s})),p.length&&(d.urls=p)}else{var g=[],c="";if(-1!==(a=n.indexOf("#x&amp;$)"))){if(r||(r=n.substring(0,a)),(t=n.split("amp;$)")).length){var h=t[1].split("#x&amp;");if(c=h[0],h.length>1)for(i=1;i<h.length;i++)g.push({address:h[i]})}}else if(-1!==(a=n.indexOf("#x&amp;"))&&(r||(r=n.substring(0,a)),(t=n.split("#x&amp;")).length>1))for(i=1;i<t.length;i++)g.push({address:t[i]});(c||g&&g.length)&&(d={urls:g.length>0?g:void 0,hiddenText:""!==c?c:void 0})}if(e.hyperlinksData&&e.hyperlinksData.length)return r||n;if((d.hiddenText||d.urls&&d.urls.length)&&(e.hyperlinksData=[],d.hiddenText&&e.hyperlinksData.push({type:-1,text:d.hiddenText}),d.urls&&d.urls.length))for(i=0;i<d.urls.length;i++)e.hyperlinksData.push({type:0,address:d.urls[i].address});return r||n}(e,n),0!==a&&1!==a&&2!==a&&30!==a&&(12===a||13===a||14===a||15===a||37===a||38===a||34===a?function(e,n){var a,t=0,s="^";if(-1!==(a=n.indexOf(s,t))&&(t=a+s.length,-1!==(a=n.indexOf(s,t))&&(t=a+s.length,-1!==(a=n.indexOf(s,t))&&(t=a+s.length),-1!==(a=n.indexOf(s,t))&&(t=a+s.length))),s=";",e.dimensionLimits={min:null,max:null},a=n.indexOf(s,t),e.dimensionLimits.min=y(n.substring(t,a)),t=a+s.length,a=n.indexOf(s,t),e.dimensionLimits.max=y(n.substring(t,a)),t=a+s.length,-1!==(a=n.indexOf(s,t)))e.nominalValue=n.substring(t,a),t=a+s.length,s="!",-1!==(a=n.indexOf(s,t))||(a=n.indexOf("#x&amp;",t)),e.tabLimit=n.substring(t,-1!==a?a:n.length);else if(s="#",-1!==(a=n.indexOf(s,t))&&-1===n.indexOf("#x&amp;",t)){a=n.indexOf(s,t),e.nominalValue=n.substring(t,a),t=a+s.length;var i={};if(-1!==(a=n.indexOf(s,t))?(i.name=n.substring(t,a),t=a+s.length,s=";",-1===(a=n.indexOf(s,t))&&(a=n.length)):(s="#x&amp;$)",-1!==(a=n.indexOf(s,t))||(s=";"),i.name=n.substring(t,a),t=a+s.length),i.name){var r=n.substring(t,a);a=r.indexOf("!",0),i.variation=r&&-1!==a?r.substring(0,a):r,e.genTol=i}}else s="!",-1!==(a=n.indexOf(s,t))?(e.nominalValue=n.substring(t,a),t=a+s.length,s="#x&amp;$)"):s="#x&amp;$)"}(e,n):5===a||6===a||33===a?function(e,n){var a,t,s="^",i=0,r=[];if(5===e.type){-1!==(a=n.indexOf(s,i))&&(i=a+s.length),-1!==(a=n.indexOf(s,i))&&(i=a+s.length),s=";";for(var l=n.indexOf(s,i);-1!==l;)i=l+s.length,(t=-1!==(l=n.indexOf(s,i))?parseInt(n.substring(i,l),10):parseInt(n.substring(i,n.length),10))&&r.push(t)}else 6===e.type&&(-1!==(a=n.indexOf(s,i))&&(i=a+s.length,-1!==(a=n.indexOf(s,i))&&(i=a+s.length,-1!==(a=n.indexOf(s,i))&&(i=a+s.length))),s="#x&amp;$)",(t=-1!==(a=n.indexOf(s,i))?parseInt(n.substring(i,a),10):parseInt(n.substring(i,n.length),10))&&r.push(t));r.length&&(e.datumTargets=r)}(e,n):7!==a&&8!==a&&9!==a&&10!==a&&11!==a&&17!==a&&18!==a&&19!==a&&20!==a&&21!==a&&22!==a&&23!==a&&24!==a&&25!==a&&26!==a&&27!==a&&28!==a||function(e,n){var a="^",t=0,s=n.indexOf(a,t);if(a="@#",-1!==(s=n.indexOf(a,0))){var i=n.split(a);i.length&&(0!==s&&i.splice(0,1),e.toleranceZoneValue=y(i[10]))}if(a=";",-1!==(s=n.indexOf("!",t))){var r,l,o=n.indexOf(":",t);t=s+a.length,s=n.indexOf(a,t),r=y(n.substring(t,s)),t=s+a.length,s=n.indexOf(a,t),l=y(-1!==o?n.substring(t,o):-1!==(s=n.indexOf("#x&amp;$)",t))?n.substring(t,s):n.substring(t,n.length)),e.toleranceUnitBasis={val1:r,val2:l}}}(e,n),function(e,n){var a=[],t=n.indexOf(":");if(-1!==t){var s=n.substring(t+1,n.length).split(":");if(s.length)for(var i=0;i<s.length;i++){var r=parseInt(s[i],10);null!=r&&a.push(r)}}0!==a.length&&(e.associatedBasicDims=a)}(e,n))}},O=function(e){return i.openSceneGraph(new Uint8Array((n=e,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t=new ArrayBuffer(n.length/4*3),function(e,n){var t,s,i,r,l,o,d,p=a.indexOf(e.charAt(e.length-1)),g=a.indexOf(e.charAt(e.length-2)),c=e.length/4*3;64===p&&c--,64===g&&c--;var h=0,u=0;for(t=n?new Uint8Array(n):new Uint8Array(c),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),h=0;h<c;h+=3)s=a.indexOf(e.charAt(u++))<<2|(l=a.indexOf(e.charAt(u++)))>>4,i=(15&l)<<4|(o=a.indexOf(e.charAt(u++)))>>2,r=(3&o)<<6|(d=a.indexOf(e.charAt(u++))),t[h]=s,64!==o&&(t[h+1]=i),64!==d&&(t[h+2]=r)}(n,t),t)),(function(){}),{processText:f,withBlankingRep:!0});var n,a,t},A=function(a){n&&(a.done&&(a.hasTesseletedTextReps=!d||o,c=null,h=null,n=!1,f=!1,i=null,r=null,l=null,u=null,o=null,d=null,m=0),a&&(a.processText=f),e.postMessage(a))},S=function(){A({done:!0,loadingIndex:h,loadingPartiallyFailed:!0})},I=function(e,a){if(n){var t,s=a();if(!1!==s)switch(p=!1,e){case"Functional_Tolerancing_Annotation":s.Version&&(g=y(s.Version)),l.push({name:e,node:{}});break;case"AnnotationSet":m++;var i={nodeXMLtype:e,version:g};s.ContextType&&(i.contextType=y(s.ContextType)),s.Standard&&(i.standard=s.Standard),u&&-1===u.indexOf(i.contextType)?A({node:i,done:!0,loadingIndex:h,loadingCancelled:!0,annotSetID:m}):!x||!b||!x[i.contextType]||!x[i.contextType].assemblyPrefix&&!x[i.contextType].assemblySuffix||x[i.contextType].assemblyPrefix&&b.startsWith(x[i.contextType].assemblyPrefix)||x[i.contextType].assemblySuffix&&b.endsWith(x[i.contextType].assemblySuffix)?l.push({name:e,node:i}):A({node:i,done:!0,loadingIndex:h,loadingCancelled:!0,annotSetID:m});break;case"RootTTRSs":case"RefFrame":l.push({name:e,node:{nodeXMLtype:e}});break;case"TPSView":var r={nodeXMLtype:e};s.Version&&(r.version=y(s.Version)),l.push({name:e,node:r});break;case"TPS":d=!0;var c={nodeXMLtype:e};s.Att&&(c.attributes=s.Att),s.Ref&&(c.ref=y(s.Ref)),s.Val&&(c.val=y(s.Val)),s.Def&&(c.def=y(s.Def)),l.push({name:e,node:c});break;case"TPSCap":var f={nodeXMLtype:e};l.push({name:e,node:f}),s.Att&&(f.attributes=s.Att),"1"===s.ActVieSt&&s.ActVie&&(f.view=y(s.ActVie)),s.RepMngt&&(f.RepMngt=y(s.RepMngt)),s.InstMngt&&(f.InstMngt=y(s.InstMngt)),s.ClipPla&&(f.ClipPla=y(s.ClipPla)),s.FavCtxMngt&&(f.FavCtxMngt=y(s.FavCtxMngt)),s.Version&&(f.version=y(s.Version)),s.FeatureVersion&&(f.FeatureVersion=y(s.FeatureVersion));break;case"TPSCG":var C={nodeXMLtype:e};l.push({name:e,node:C}),s.Att&&(C.attributes=s.Att);break;case"TPSAttribute":var v={nodeXMLtype:e};if(l.push({name:e,node:v}),s.Categ&&(v.category=s.Categ),s.AttrType){var O=s.AttrType.split(".");O&&2===O.length?v.attrType=parseFloat(O[1]):v.attrType=parseFloat(s.AttrType)}break;case"TPSAttributes":var I={nodeXMLtype:e};l.push({name:e,node:I}),s.Categ&&(I.category=s.Categ);break;case"Rep":"2"===s.Type?l.push({name:"Rep2D",node:l[l.length-1].node}):"3"===s.Type?l.push({name:"Rep",node:l[l.length-1].node}):"4"===s.Type&&l.push({name:"CappingRep",node:l[l.length-1].node});break;case"SurfaceNormalRep":l.push({name:"SurfaceNormalRep",node:l[l.length-1].node});break;case"Buf":"Rep"===l[l.length-1].name&&l.push({name:e,node:l[l.length-1].node});break;case"AlternativeTextBuf":"Rep"===l[l.length-1].name&&(o=!0,l.push({name:e,node:l[l.length-1].node}));break;case"TPSId":s.Name&&(l[l.length-1].node.name=k(s.Name)),s.Att&&(l[l.length-1].node.attributes=s.Att),s.Uuid&&(l[l.length-1].node.uuid=s.Uuid);break;case"TPSLoc":s.Status&&(l[l.length-1].node.status=y(s.Status)),s.Id&&(l[l.length-1].node.tpsID=y(s.Id)),s.Type&&(l[l.length-1].node.type=y(s.Type));break;case"GeomLink":l[l.length-1].node.geomLinks||(l[l.length-1].node.geomLinks=[]);break;case"CompRelId":l[l.length-1].node.geomLinks&&l[l.length-1].node.geomLinks.push({}),l.push({name:e,node:l[l.length-1].node});break;case"ExtGeomPath":case"Description":case"TPSs":case"Thumbnail":case"Datum":case"Views":case"Caps":case"CGs":case"HiddenBodyInst":case"VisibleBodyInst":case"Po":case"Di":case"Ze":case"Ta":case"Or":case"No":case"Center":case"Radius":case"SketchOrigin":case"SketchNormal":case"Point":case"UpperLimit":case"LowerLimit":case"ReferencedCGs":case"GeoP":case"TRep":case"Grou":case"OccId":case"OrientationPlaneDF":case"OrientationPlaneAngleTED":case"IntersectionPlaneDF":case"CollectionPlaneDF":case"OrientationPlaneAngleCG":l.push({name:e,node:l[l.length-1].node});break;case"Standard":l[l.length-1].node.standards||(l[l.length-1].node.standards=[]);var R={};s.Title&&(R.title=k(s.Title)),s.Year&&(R.year=k(s.Year)),s.Code&&(R.code=k(s.Code)),l[l.length-1].node.standards.push(R);break;case"DefaultSpec":l[l.length-1].node.standardNorms||(l[l.length-1].node.standardNorms=[]);var P={};s.Type&&(P.type=k(s.Type)),s.SubType&&(P.subtype=k(s.SubType)),s.Code&&(P.code=k(s.Code)),s.Year&&(P.year=k(s.Year)),l[l.length-1].node.standardNorms.push(P);break;case"Symbol":var D,V=l[l.length-1].node.standardNorms;V[V.length-1].symbols||(V[V.length-1].symbols=[]),s.Name&&(D=s.Name),l[l.length-1].node.standardNorms[l[l.length-1].node.standardNorms.length-1].symbols.push(D);break;case"Value":p=!0;break;case"Hyperlink":l[l.length-1].node.hyperlinksData||(l[l.length-1].node.hyperlinksData=[]);var L={};s.AnchorText&&(L.anchorText=s.AnchorText),s.Address&&(L.address=s.Address),s.Type&&(L.type=y(s.Type)),s.AddressRelId&&(L.addressRelId=s.AddressRelId),l[l.length-1].node.hyperlinksData.push(L);break;case"HiddenText":l[l.length-1].node.hyperlinksData||(l[l.length-1].node.hyperlinksData=[]);var M={type:-1};s.Text&&(M.text=k(s.Text)),l[l.length-1].node.hyperlinksData.push(M);break;case"Failure":l[l.length-1].node.failureModes||(l[l.length-1].node.failureModes=[]);var F={};null!==s.Criticity&&void 0!==s.Criticity&&(F.crit=s.Criticity),l[l.length-1].node.failureModes.push(F);break;case"VisibleCG":t="0"===s.Cut?"UncutCGs":e,l[l.length-1].node[t]||(l[l.length-1].node[t]=[]),l.push({name:e,node:l[l.length-1].node,Uncut:"0"===s.Cut});break;case"VisibleCompRelId":t="0"===s.Cut?"UncutCompRelId":e,l[l.length-1].node[t]||(l[l.length-1].node[t]=[]),l.push({name:e,node:l[l.length-1].node,Uncut:"0"===s.Cut});break;case"VisibleCompXmlId":t="0"===s.Cut?"UncutCompXmlId":e,l[l.length-1].node[t]||(l[l.length-1].node[t]=[]),l[l.length-1].node[t].push([]),l.push({name:e,node:l[l.length-1].node,Uncut:"0"===s.Cut});break;case"Cam":l[l.length-1].node.camera={},l[l.length-1].node.camera.angle=y(s.Angle),l[l.length-1].node.camera.mode=s.Mode,l[l.length-1].node.camera.type=s.Type,l[l.length-1].node.camera.zoom=y(s.Zoom),s.Nature&&(l[l.length-1].node.camera.nature=s.Nature),l.push({name:e,node:l[l.length-1].node});break;case"Math":l[l.length-1].node.planeInfos={},l.push({name:e,node:l[l.length-1].node});break;case"MultiClipping":l[l.length-1].node.multiClipping={},l[l.length-1].node.multiClipping.inverted=y(s.Inverted),l.push({name:e,node:l[l.length-1].node});break;case"CircularClipping":l[l.length-1].node.clipping2D={type:"circular"},l.push({name:e,node:l[l.length-1].node});break;case"PolygonalClipping":l[l.length-1].node.clipping2D={type:"polygonal",points:[]},l.push({name:e,node:l[l.length-1].node});break;case"PointsDef":l[l.length-1].node.multiClipping.pointsDef=[],l.push({name:e,node:l[l.length-1].node});break;case"ReframeArea":l[l.length-1].node.reframeArea={cornerX:y(s.CornerX),cornerY:y(s.CornerY),width:y(s.Width),length:y(s.Length)};break;case"SCSRestrictedArea":l[l.length-1].node.scsReframeArea={upperLimit:null,lowerLimit:null};break;case"TTRS":"RootTTRSs"===l[l.length-1].name?l.push({name:e,node:{nodeXMLtype:e}}):l.push({name:e,node:l[l.length-1].node});break;case"AttrLink":var N={};s.Name&&(N.name=s.Name),s.Uuids&&(N.uuids=T(s.Uuids,!0,!0)),l[l.length-1].node.pointedFeatureUuids||(l[l.length-1].node.pointedFeatureUuids=[]),l[l.length-1].node.pointedFeatureUuids.push(N);break;case"Param":l[l.length-1].node.params||(l[l.length-1].node.params=[]);var U={};s.Name&&(U.Name=s.Name),s.Magnitude&&(U.Magnitude=s.Magnitude),s.Value&&(U.Value="String"===U.Magnitude?k(s.Value):s.Value),s.Hidden&&(U.Hidden=s.Hidden),l[l.length-1].node.params.push(U),l.push({name:e,node:l[l.length-1].node});break;case"AuxFeatIndicator":l[l.length-1].node.auxiliaryFeatures={annotations:[],cgs:[]},l.push({name:e,node:l[l.length-1].node})}else S()}},R=function(e,a){if(n)if(p){var t=l[l.length-1].node.standardNorms;if(t){t[t.length-1].symbols||(t[t.length-1].symbols=[]);var s=k(a(e));t[t.length-1].symbols.push(s)}}else if(l.length){var i,r,o,d,g=l[l.length-1].name,c=l[l.length-2]?l[l.length-2].name:null,h=l[l.length-1].node;switch(g){case"Buf":(i=O(a(e)))&&i.reps&&(h.reps||(h.reps=[]),h.reps.push(i));break;case"AlternativeTextBuf":f=!1,(i=O(a(e)))&&i.reps&&(h.reps||(h.reps=[]),h.reps.push(i));break;case"Rep2D":"TPSCap"===c&&(i=O(a(e)))&&i.reps&&(h.cappingRep=i);break;case"CappingRep":(i=O(a(e)))&&i.reps&&(h.cappingRep=i);break;case"SurfaceNormalRep":(i=O(a(e)))&&i.reps&&(h.surfaceNormalRep=i);break;case"Thumbnail":var u=a(e);u&&(h.thumbnail=u);break;case"Caps":case"CGs":case"TPSs":(r=T(a(e),!0)).length&&(h[g]=r);break;case"VisibleCG":var m=T(a(e),!0);1===m.length&&l[l.length-1].Uncut&&h.UncutCGs.push(m[0]);break;case"UpperLimit":r=T(a(e),!0),h.scsReframeArea&&r.length&&(h.scsReframeArea.upperLimit=r);break;case"LowerLimit":r=T(a(e),!0),h.scsReframeArea&&r.length&&(h.scsReframeArea.lowerLimit=r);break;case"HiddenBodyInst":case"VisibleBodyInst":(o=T(a(e),!0)).length&&(h[g]||(h[g]=[]),h[g].push(o));break;case"CompRelId":case"VisibleCompRelId":var x=T(a(e),!0,!0);1===x.length&&(h.geomLinks?h.geomLinks[h.geomLinks.length-1].compRelId=x:l[l.length-1].Uncut?h.UncutCompRelId.push(x[0]):h[g].push(x[0]));break;case"OccId":var b=T(a(e),!0,!0);1===b.length&&(!l[l.length-2].Uncut&&h.VisibleCompXmlId?h.VisibleCompXmlId[h.VisibleCompXmlId.length-1].push(b[0].split("#")[1]):h.UncutCompXmlId&&h.UncutCompXmlId[h.UncutCompXmlId.length-1].push(b[0].split("#")[1]));break;case"Po":h.camera&&(d=T(a(e),!1),h.camera.position={x:d[0],y:d[1],z:d[2]});break;case"Di":h.camera?(d=T(a(e),!1),h.camera.direction={x:d[0],y:d[1],z:d[2]}):h.planeInfos&&(d=T(a(e),!1),h.planeInfos.direction={x:d[0],y:d[1],z:d[2]});break;case"Ze":h.camera&&(d=T(a(e),!1),h.camera.zenith={x:d[0],y:d[1],z:d[2]});break;case"Ta":h.camera&&(d=T(a(e),!1),h.camera.target={x:d[0],y:d[1],z:d[2]});break;case"Or":h.planeInfos&&(d=T(a(e),!1),h.planeInfos.origin={x:d[0],y:d[1],z:d[2]});break;case"No":h.planeInfos&&(d=T(a(e),!1),h.planeInfos.normal={x:d[0],y:d[1],z:d[2]});break;case"Views":(r=T(a(e),!0)).length&&"MultiClipping"===c?h.multiClipping.views=r:r.length&&(h[g]=r);break;case"Point":"PointsDef"===c?(d=T(a(e),!1))&&3===d.length&&h.multiClipping.pointsDef.push({x:d[0],y:d[1],z:d[2]}):"PolygonalClipping"===c&&(d=T(a(e),!1))&&2===d.length&&h.clipping2D.points.push({x:d[0],y:d[1]});break;case"Center":"CircularClipping"===c&&(d=T(a(e),!1))&&2===d.length&&(h.clipping2D.center={x:d[0],y:d[1]});break;case"Radius":"CircularClipping"===c&&(h.clipping2D.radius=y(a(e)));break;case"SketchNormal":case"SketchOrigin":"MultiClipping"===c&&(d=T(a(e),!1))&&(h.multiClipping[g]={x:d[0],y:d[1],z:d[2]});break;case"TTRS":"TPSCG"!==c&&"TPS"!==c&&"TPSAttribute"!==c||(h.ttrs=T(a(e),!0));break;case"ExtGeomPath":h.geomLinks[h.geomLinks.length-1].extGeomPath=T(a(e),!0);break;case"ReferencedCGs":"TTRS"!==c&&"TPS"!==c&&"TPSAttribute"!==c||(h.referencedCGs=T(a(e),!0));break;case"TRep":h.trep=T(a(e),!0);break;case"GeoP":var C=T(a(e),!1);C.length&&(h[g]||(h[g]=[]),h[g].push(C));break;case"Datum":h.datums=T(a(e),!0);break;case"Grou":h.grou=T(a(e),!0);break;case"Param":h.params=a(e);break;case"Description":if(h.failureModes&&h.failureModes.length){var v=h.failureModes[h.failureModes.length-1];v.descriptions||(v.descriptions=[]),v.descriptions.push(k(a(e)))}break;case"OrientationPlaneDF":case"OrientationPlaneAngleTED":case"IntersectionPlaneDF":case"CollectionPlaneDF":r=T(a(e),!0),h.auxiliaryFeatures&&r&&r.length&&(h.auxiliaryFeatures.annotations=h.auxiliaryFeatures.annotations.concat(r));break;case"OrientationPlaneAngleCG":r=T(a(e),!0),h.auxiliaryFeatures&&r&&r.length&&(h.auxiliaryFeatures.cgs=h.auxiliaryFeatures.cgs.concat(r))}}},P=function(e){if(n&&l.length){var a=l[l.length-1].name,t=l[l.length-2]?l[l.length-2].name:null,s=l[l.length-1].node;if(a===e)switch(e){case"TPS":case"TPSView":case"TPSCap":case"TPSCG":case"AnnotationSet":v(s),A({node:s,done:!1,loadingIndex:h,annotSetID:m}),l.pop();break;case"TPSAttribute":"TPSAttribute"===t||"TPSAttributes"===t?(l[l.length-2].node.childrenAttr||(l[l.length-2].node.childrenAttr=[]),l[l.length-2].node.childrenAttr.push(s)):A({node:s,done:!1,loadingIndex:h,annotSetID:m}),l.pop();break;case"TPSAttributes":case"RefFrame":A({node:s,done:!1,loadingIndex:h,annotSetID:m}),l.pop();break;case"TTRS":"RootTTRSs"===t&&A({node:s,done:!1,loadingIndex:h,annotSetID:m}),l.pop();break;case"Functional_Tolerancing_Annotation":l.pop(),A({node:s,done:!0,loadingIndex:h}),n=!1;break;default:l.pop()}else"CappingRep"!==a&&"Rep2D"!==a||"Rep"!==e||l.pop()}};C=c,l=[],r||(r=new t),i||(i=new s(void 0,void 0,void 0,!0)),r.on("startNode",I),r.on("textNode",R),r.on("endNode",P),r.on("error",S),r.parse(C)}))}}(this);