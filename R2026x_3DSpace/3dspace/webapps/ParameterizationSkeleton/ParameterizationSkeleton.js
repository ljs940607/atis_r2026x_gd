
/*@fullReview  ZUR 15/11/23 2017x Param Skeleton*/
/*global define,console*/
/*jslint nomen: true*/
define('DS/ParameterizationSkeleton/Views/ParamCollaboration/CollabItemsListView',
    [
        'DS/W3DXComponents/Views/Layout/GridScrollView',
        'DS/W3DXComponents/Views/Item/TileView',
        'DS/W3DXComponents/Views/Item/SetView',
        'css!DS/W3DXComponents/W3DXComponents'
    ], function(GridScrollView, ItemViewTile, ItemViewSet) {
        'use strict';
        var ItemsListView,
            _name = 'list';
        ItemsListView = ItemViewSet.extend({
            name : _name,
            defaultOptions : {
                contents : {
                    //defaultView: 'tile',
                    useInfiniteScroll : false,
                    usePullToRefresh : false,
                    selectionMode : 'oneToOne',
                    views : [ {
                        'id' : 'tile',
                        //'title' : 'Tile View',
                        'view' : GridScrollView,
                        'itemView' : ItemViewTile,
                        'scrollPosition' : 'center',
                        'layout' : {
                            column : 2
                        }
                    } ]
                }
            },

            destroy: function(options) {

                if (this.isDestroyed) {
                    return;
                }

                if (this.collection) {
                    this.stopListening(this.collection, this._externalEvents);
                }

                return this._parent.apply(this, arguments);
            },

            reload: function() {
                this.container.addClassName('loading');
                //  /!\ pour compenser l'absence de resetState dans la pageableCollection
                this.collection.state.totalRecords = null;
                //this.collection.reset();
                this.collection.getFirstPage();
            }
        });

        return ItemsListView;
    });

define('DS/ParameterizationSkeleton/Views/ParameterizationSystemsSafety/ParameterizationSystemsSafetyConstants', [], function() {
    'use strict';

    return Object.freeze({
        NEW_NOT_DEPLOYED: 'newNotDeployed',
        DEPLOYED: 'deployed',
        ADD: 'add',
        REMOVE: 'remove',
        MODIFY: 'modify'
    });
});

define("DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/ParameterizationModel", ["require", "exports"], function (require, exports) {
    "use strict";
        /**
     * The aim of this module is to provide a typed definition of the parameters retrieved from the server
     */
    var ParameterizationModelModule;
    (function (ParameterizationModelModule) {
        var ArgumentType;
        (function (ArgumentType) {
            ArgumentType["BOOLEAN"] = "boolean";
            ArgumentType["STRING"] = "string";
        })(ArgumentType = ParameterizationModelModule.ArgumentType || (ParameterizationModelModule.ArgumentType = {}));
        ;
        var InputTypes;
        (function (InputTypes) {
            InputTypes["CHECKBOX"] = "checkbox";
            InputTypes["MULTISELECT_COMBOBOX"] = "comboboxmultiselect";
            InputTypes["TEXTFIELD"] = "textfield";
        })(InputTypes = ParameterizationModelModule.InputTypes || (ParameterizationModelModule.InputTypes = {}));
        ;
        var BooleanArgValue;
        (function (BooleanArgValue) {
            BooleanArgValue["TRUE"] = "Enabled";
            BooleanArgValue["FALSE"] = "Disabled";
        })(BooleanArgValue = ParameterizationModelModule.BooleanArgValue || (ParameterizationModelModule.BooleanArgValue = {}));
        ;
    })(ParameterizationModelModule || (ParameterizationModelModule = {}));
    ;
    return ParameterizationModelModule;
});


define('DS/ParameterizationSkeleton/Model/DELConfigurationParameterizationModel/DELConfigurationParamTranslationModel',
// -- Module Dependancies --
[
  'UWA/Core',
  'DS/TreeModel/TreeNodeModel'
],
// -- Main function with aliases for loaded modules

function (Core, Model) {
  'use strict';

  function DELConfigurationParamTranslationModel(options) {
    var that = this;

    this.options = {
      label: '',
      nls : ''
    };

    this.options = UWA.extend(this.options, options);

    that.translateValuesToNls();
    Model.call(this, this.options);
  };

  DELConfigurationParamTranslationModel.prototype = Object.create(Model.prototype);

  DELConfigurationParamTranslationModel.prototype.getGrid = function getGrid() {
    var that = this;
    return that.options.grid;
  };

  DELConfigurationParamTranslationModel.prototype.addGridAttributes = function addGridAttributes(attr) {
    var that = this;
    var keys = Object.keys(attr);
    var values = Object.values(attr);

    if (keys.length && values.length)
      that.options.grid[keys[0]] = values[0];
  };

  DELConfigurationParamTranslationModel.prototype.getData = function getData() {
    var that = this;
    return that.options.data;
  };

  /*DELConfigurationParamTranslationModel.prototype.addData = function getData() {
    var that = this;
    return that.options.data;
  };*/

  DELConfigurationParamTranslationModel.prototype.translateValuesToNls = function translateValuesToNls() {
    var that = this;

    if (that.options.nls === null || that.options.nls === undefined)
      return;

    var nodeKeys = Object.keys(this.options.data);
    var nodeValues = Object.values(this.options.data);

    var listOfNlsKeys = Object.keys(that.options.nls);
    var listOfNlsValues = Object.values(that.options.nls);

    if (this.options.grid === undefined)
      this.options.grid = Object.assign({}, this.options.data);

    var nodeValuesLength = nodeValues.length;
    for (var j=0;j<nodeValuesLength;j++)
    {
      var idx = listOfNlsKeys.indexOf(nodeValues[j]);
      if (idx >= 0)
        this.options.grid[nodeKeys[j]] = listOfNlsValues[idx];
    }
  };

  return UWA.namespace('DS/ParameterizationSkeleton/Model/DELConfigurationParameterizationModel/DELConfigurationParamTranslationModel', DELConfigurationParamTranslationModel);
}); // -- End of require

define('DS/ParameterizationSkeleton/Views/ParameterizationXEngineering/ParameterizationXEngineerConstants', [], function () {

	'use strict';

	const contants = {
		NEW_NOT_DEPLOYED: 'NewNotDeployed',
		USER_DEFINED: 'UserDefined',
		DEPOLOYED: 'Deployed',
		ADD: 'Add',
		REMOVE: 'Remove',
		MODIFY: 'Modify',
		OPERATION: 'UserOperation',
		ORDER: 'Order',
		TYPE: 'Type',
		NAME: 'Name',
		VALUE: 'Value',
		REGEX: 'RegExpr',
		COUNTER_UNICITY: 'CounterUnicity',
		COUNTER_UNICITY_TRUE: "counterUnicityTrue",
		COUNTER_UNICITY_VALUE: "True",
		UPDATE_HIGHEST_COUNTER: 'UpdateAllCountersToHighestCounterValue',
		AVOID_DUP_COUNTER : "AvoidDupCounterUserSelectionRequired",
		AVOID_DUP_COUNTER_VALUE : "True",
		ATTRIBUTE: 'AttributeName',
		ATTRIBUTE_NLS_NAME: 'Attribute_NLS',
		COUNTER: 'CounterSize',
		FORMULA_ROW: "FormulaRow",
		FORMULA_CELL: "Formula",
		STRATEGY_ROW: "StrategyRow",
		BUSINESS_LOGIC: "BLDefined",
		STRATEGY_CELL: "Strategy",
		FORMAT_FREE: 'Free',
		FORMAT_STRING: 'String',
		FORMAT_ATTRIBUTE: 'Attribute',
		FORMAT_COUNTER: 'Counter',
		MAX_ROWS: 15,
		WIDTH_ARRAY: [15, 15, 15, 25, 15, 15, 15],
		COUNTER_UNICITY_INDEX: "counterUnicityIndex",
		COUNTER_STARTING_VALUES: "CounterStartingValues",
		RESET_COUNTER: 'ResetAllCountersToStartingCounterValue',
		MAX_COUNT_VALUE: 99999999999,
		CELLS_INDEX: {
			"name": 0,
			"order": 1,
			"type": 2,
			"value": 3,
			"action": 4,
			"counterUnicityIndex": 5,
			"deployFlag": 6,
		}

	};

	return Object.freeze(contants);

});

/**
 * @fullReview  SDM  24/11/28 IR-880779-3DEXPERIENCER2025x - With german lang, space disapears between icon and label in Reset button 
 * @fullReview  NZV  17/03/02 FUN066122 Added compareArray 
 * @fullReview  ZUR 15/07/29 2016xFD01 Param Widgetization NG
 */

/*global define, widget, document, setTimeout, console*/
/*jslint plusplus: true*/
/*jslint nomen: true*/
define('DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
    [
        'UWA/Core',
        'UWA/Controls/Accordion',
        'DS/UIKIT/Accordion',
        'DS/UIKIT/Input/Button',
        'DS/UIKIT/Modal',
        'DS/UIKIT/Alert',
        'DS/UIKIT/Popover',
        'DS/UIKIT/Spinner',
        'DS/UIKIT/Autocomplete',
        'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS'
    ],
    function (UWA,
              UWAccordion, Accordion,
              Button,
              Modal,
              Alert, Popover, Spinner, Autocomplete,
              ParamSkeletonNLS) {

        'use strict';

        var UIview = {

            createFamilyAccordion : function () {
                var iAccord = new UWAccordion({
                    className: 'visu-debug-panel-section',
                    backgroundColor : 'white',
                    multiSelect : true
                });
                return iAccord;
            },

            createFamilyUIKITAccordion : function (parentDiv) {
                var iAccord = new Accordion({
                    className: 'styled divided filled',
                    exclusive: false,
                    items : []
                }).inject(parentDiv);
                return iAccord;
            },

            createInfoDiv : function (iTooltip) {
                var isubDiv =  UWA.createElement('div', {
                    'height'     : '5%'
                });
                UWA.createElement('p', {
                    text: iTooltip,// font-3dsbold 
                    'class': ''//font-3dslight
                }).inject(isubDiv);
                return isubDiv;
            },

            createParamsContainerDiv : function () {
                var iParamsDIV =  UWA.createElement('div', {
                        'id' : 'parametersDiv'
                    });
                return iParamsDIV;
            },

            createWdgAlert : function () {
                var iAlert = new Alert({
                    closable: true,
                    visible: true,
                    autoHide : true,
                    hideDelay : 2500
                });
                return iAlert;
            },

            beingDeployed: function (imageCell, imgTitle) {
                var paramDeploySpinner = new Spinner({visible : true});
                imageCell.empty();
                paramDeploySpinner.inject(imageCell);
                imageCell.set("Title", imgTitle);
            },

            beingModified : function (imageCell, imgTitle, iconSize) {
                //var imgClass = 'fonticon fonticon-2x fonticon-pencil';
                //var imgClass = 'fonticon fonticon-' + iconSize + 'x fonticon-pencil';
                var imgClass = 'fonticon fonticon-' + iconSize + 'x fonticon-cog';

                imageCell.empty();
                UWA.createElement('span', {
                    'class' : imgClass
                }).inject(imageCell);

                imageCell.set("Title", imgTitle);
            },

            updateIcon : function(result, imageCell) {

                var imgSpan,
                    imgTitle = ParamSkeletonNLS.deployedParamtxt,
                    imgClass = 'fonticon fonticon-2x fonticon-check',
                    iconColor = 'green';

                imageCell.empty();

                if (result != true) {
                    imgClass = 'fonticon fonticon-2x fonticon-alert';
                    imgTitle = ParamSkeletonNLS.notdeployedParamtxt;
                    iconColor = 'red';
                }
                imgSpan = UWA.createElement('span', {
                    'class' : imgClass
                }).inject(imageCell);
                imgSpan.setStyle("color", iconColor);
                imageCell.set("Title", imgTitle);
            },

            computePopoverPos : function (i, familyPosition, nbofRows) {
                var popoverPosition = "left";

                if (familyPosition === "first") {
                    popoverPosition = "bottom";
                } else if ((familyPosition === "last") && (i == nbofRows - 1)) {
                    popoverPosition = "top";
                }

                return popoverPosition;
            },

            isInteger : function (str) {
                str = str.trim();
                return (/^[-+]?[0-9]+$/).test(str);
            },

            isReal : function(value) {
                return ("." != value && "-" != value && "-." != value && /^-{0,1}\d*\.{0,1}\d*$/.test(value));
            },

            testDataType : function (iValue, iType) {
                if (iType === "integer") {
                    return this.isInteger(iValue);
                }
                return true;
            },

            getTypeErrorMsgNLS : function (iType) {
                if (iType === "integer") {
                    return ParamSkeletonNLS.Not_Integer;
                }
                return "error";
            },

            inputErrorCell : function (imageCell, imgTitle, imgColor, msgPopOver) {
                var imgSpan,
                    imgClass = 'fonticon fonticon-2x fonticon-attention';
                if (msgPopOver !== null) {
                    if (msgPopOver.isVisible) { msgPopOver.hide(); }
                    msgPopOver.destroy();
                } 
                imageCell.empty();
                imgSpan = UWA.createElement('span', {
                    'class' : imgClass
                }).inject(imageCell);

                imgSpan.setStyle("color", imgColor);
                imageCell.set("Title", "");
                msgPopOver = new Popover({
                    target   : imgSpan,
                    trigger  : "hover",
                    animate  : "true",
                    position : 'top',
                    body     : imgTitle,
                    title    : ''
                });
                msgPopOver.toggle();
                if (msgPopOver.isVisible) {
                    setTimeout(function () {msgPopOver.hide(); }, 3000);
                }
                return msgPopOver;
            },

            buildPopoverSpan : function (iContainerCell, tooltipNlsTxt) {
                var popoverTooltip,
                    imgInfoSpan = UWA.createElement('span', {
                        'class' : 'fonticon fonticon-info'
                    }).inject(iContainerCell);

                imgInfoSpan.setStyle("color", "black");

                popoverTooltip = new Popover({
                    target   : imgInfoSpan,
                    trigger  : "hover",
                    animate  : "true",
                    position : "top",
                    body     : tooltipNlsTxt,
                    title    : ''
                });
            },


            buildDeployStsCell : function (isParamDeployed, cellWidth, iconSize, cellAlign) {
                var imgCell, imgSpan,
                    imgTitle = ParamSkeletonNLS.deployedParamtxt,
                    imgClass = 'fonticon fonticon-' + iconSize + 'x fonticon-check',
                    iconColor = 'green';

                if (isParamDeployed === "false") {
                    imgClass = 'fonticon fonticon-' + iconSize + 'x fonticon-cog';
                    imgTitle =  ParamSkeletonNLS.notdeployedParamtxt;
                    iconColor = 'orange';
                } else if (isParamDeployed === "NewNotDeployed") {
                    imgClass = 'fonticon fonticon-' + iconSize + 'x fonticon-cog';
                    imgTitle =  ParamSkeletonNLS.newNotdeployedParam;
                    iconColor = 'black';
                }

                imgCell = UWA.createElement('td', {
                    'width' : cellWidth, //'15%',
                    'align' : cellAlign,//'class': 'paramtd','vertical-align': 'text-bottom',
                    'title' : imgTitle
                });

                imgSpan = UWA.createElement('span', {
                    'class' : imgClass
                }).inject(imgCell);

                imgSpan.setStyle("color", iconColor);
                imgCell.setStyle("vertical-align", "text-bottom");
                imgCell.setStyle("min-width", "46px");//NZV-fixed spinner issue
                return imgCell;
            },

            buildControlCell : function (iParamID, iArgument, cellWidth) {
                var controlObjectCell = UWA.createElement('td', {
                    'width' : cellWidth,
                    'align' : 'right'//nzv-IR-574318-3DEXPERIENCER2019x
                });
                controlObjectCell.setData('argumentNode', {
                    paramid     : iParamID,
                    argumentid  : iArgument.id,
                    defaultval  : iArgument.defaultValue,
                    argtype     : iArgument.type,
                    inputtype   : iArgument.input
                });
                controlObjectCell.setStyle("vertical-align", "text-bottom");
                return controlObjectCell;
            },
            //IR-733455-3DEXPERIENCER2021x : add argument to recevice tool tip for Reset button
            createApplyResetToolbar : function (insertdivID, activateApplyBtn, applyParams, confirmationModalShow, NLSTooltipForReset) {
                var applyDiv, tableButtons, lineButtons, buttonApplyCell, applyBttn,
                    buttonResetCell, resetBbttn, resetTooltip = ParamSkeletonNLS.ResetOnServertooltip;
                //that = this;
                //resetwidth = '100%';
                //NLSTooltipForReset
                if (NLSTooltipForReset === undefined) {
                    resetTooltip = ParamSkeletonNLS.ResetOnServertooltip;
                } else {
                    resetTooltip = NLSTooltipForReset;
                }
                applyDiv =  UWA.createElement('div', {
                    'id': 'ApplyResetDiv'
                }).inject(insertdivID);
                //                            
                tableButtons = UWA.createElement('table', {
                    'class' : '',
                    'id' : '',
                    'width' : '100%'
                }).inject(applyDiv);

                lineButtons = UWA.createElement('tr').inject(tableButtons);//tbody
                
                if (activateApplyBtn === true) {
                    buttonApplyCell = UWA.createElement('td', {
                        'width' : '50%',
                        'Align' : 'left'
                    }).inject(lineButtons);

                    applyBttn =  new Button({
                        // SDM-24/11/28: IR-880779-3DEXPERIENCER2025x
                        className: 'primary apply-reset-btn-class',
                        id : 'buttonExport',
                        icon : 'export',//'download'//value: 'Button',          
                        attributes: {
                            disabled: false,
                            title: ParamSkeletonNLS.Applytooltip,//IR-651121-3DEXPERIENCER2019x/20x
                            text : ParamSkeletonNLS.Apply
                        },
                        events: {
                            onClick: function () {
                                applyParams();
                            }
                        }
                    }).inject(buttonApplyCell);
                    applyBttn.getContent().setStyle("min-width", 130);
                }

                buttonResetCell = UWA.createElement('td', {
                    'width' : '50%',
                    'Align' : 'right'//center
                }).inject(lineButtons);

                resetBbttn = new Button({
                    // SDM-24/11/28: IR-880779-3DEXPERIENCER2025x
                    className: 'warning apply-reset-btn-class',
                    icon: 'loop',
                    attributes: {
                        disabled: false,
                        title: resetTooltip,
                        text : ParamSkeletonNLS.Reset
                    },
                    events: {
                        onClick: function () {
                            //that.resetParamsinSession();//testPreviewBlock();                               
                            confirmationModalShow();
                        }
                    }
                }).inject(buttonResetCell);

                resetBbttn.getContent().setStyle("min-width", 130);
                return applyDiv;
            },

            buildFormulaLine : function () {
                var cellLabel,
                    FormulaDetail = '{' + ParamSkeletonNLS.Prefix + '}-{' + ParamSkeletonNLS.Interfix + '}-<' + ParamSkeletonNLS.Counter + '>-{' + ParamSkeletonNLS.Suffix + '}',
                    lineParam = UWA.createElement('tr', {title: ''});

                UWA.createElement('td', {
                    'width': '30%',
                    'title': ParamSkeletonNLS.FormulaTxt,
                    'html' : ParamSkeletonNLS.FormulaTxt
                }).inject(lineParam);

                cellLabel = UWA.createElement('td',
                    {'width': '70%', 'colspan': '2', 'align': 'left', 'title': ''}).inject(lineParam);

                UWA.createElement('p', {
                    text: FormulaDetail,
                    'class': 'lead'//'uwa-input'//'width':'100%'    
                }).inject(cellLabel);

                return lineParam;
            },

            UpdateFinalFormatOverView : function(iPrefix, iAffix, iSuffix, iSeparator, iAppType, iInput) {
                var previewValue;

                if (iAffix != "") {
                    iAffix  = iAffix + iSeparator;
                    if (iPrefix != "") { iPrefix = iPrefix + iSeparator; }
                } else if ((iAppType == "CBP") && (iPrefix != "")) {
                    //To fix IR-529946-3DEXPERIENCER2017x\18x removed test for iAppType == "CBP"
                    //IR-685759-3DEXPERIENCER2020x : Revert change which we made with IR-529946-3DEXPERIENCER2017x\18x 
                    iPrefix = iPrefix + iSeparator;
                }

                if (iSuffix != "") {iSuffix = iSeparator + iSuffix; }

                previewValue = iPrefix + iAffix + '<' + ParamSkeletonNLS.Counter + '>' + iSuffix;
                iInput.setValue(previewValue);
                iInput.elements.input.title = previewValue;
            },

            getNamingControlInput : function (inputControls, inputID) {
                var foundInput;
                inputControls.forEach(function (iInput) {
                    if (iInput.elements.input.id == inputID) {
                        foundInput =  iInput;
                    }
                });
                return foundInput;
            },

            getCustoNamingElement : function (custoNamingsArray, iType) {
                var i;
                for (i = 0; i < custoNamingsArray.length; i++) {
                    if (custoNamingsArray[i].objTypeID == iType) {
                        return custoNamingsArray[i];
                    }
                }
                return custoNamingsArray[0];//default
            },

            getIndexInNamingArray : function(custoNamingsArray, iType) {
                var i;
                for (i = 0; i < custoNamingsArray.length; i++) {
                    if (custoNamingsArray[i].objTypeID == iType) {
                        return i;
                    }
                }
                return 0;
            },

            getCommonNamingElementItr : function(commonNamingArray, iID) {
                var i;
                for (i = 0; i < commonNamingArray.length; i++) {
                    if (commonNamingArray[i].namingID == iID) {
                        return i;
                    }
                }
                return 0;//default
            },

            testSpecialCharacters : function (iString, iAdditionalCharsToTest) {
                var i,
                    iChars = "!#$%^&*()+=[]\\\';,/{}|\":<>?";//-

                if (typeof iAdditionalCharsToTest === 'undefined') {
                    iAdditionalCharsToTest = '';
                } else {
                    iChars += iAdditionalCharsToTest;
                }

                for (i = 0; i < iString.length; i++) {
                    if (iChars.indexOf(iString.charAt(i)) != -1) {
                        return true;
                    }
                }

                return false;
            },

            containsAccents : function (iString) {
                var i,
                    accentChars = "ÀÃÂÄÅÇÑñÇçÈÉÊËÒÓÔÕÖØáàâãäåèéêëðòóôõöøùúûüýÿÑñçÙÚÛÜìîïÎÌ";
                for (i = 0; i < iString.length; i++) {
                    if (accentChars.indexOf(iString.charAt(i)) !== -1) {
                        return true;
                    }
                }
                return false;
            },

            containsBlanks : function (iStr) {
                if (/\s/.test(iStr)) {
                    return true;
                }
                return false;
            },

            removeBlancks : function (iInputStr) {
                return iInputStr.replace(/ /g, '');
            },

            CheckforRaisedWarnings : function(warnArrays) {
                var i;
                for (i = 0; i < warnArrays.length; i++) {
                    if (warnArrays[i].warnRaised == true) {
                        return "WARN";
                    }
                }
                return "OK";
            },

            getNamingDeployCellSts : function (tbodyreflist) {
                var iLines = tbodyreflist[0].children;
                return (iLines[0].cells[2]);
            },

            compareArray : function(arr1, arr2) {
                var isBothSame = false,
                    elementsFound = 0;

                if (arr1.length != arr2.length) {
                    return isBothSame;
                }

                arr1.forEach(function (arr1Element) {
                    arr2.forEach(function (arr2Element) {
                        if (arr2Element === arr1Element) {
                            elementsFound++;
                            // break;
                        }
                    });
                });

                if (elementsFound == arr1.length) {
                    isBothSame =  true;
                }
                return isBothSame;
            },

            /*//ZUR : Proto : Array view
            computeColumnsWidths : function (columnsList, widthArray) {
                var i, meanWidth,
                    initArrayLength = widthArray.length,
                    newArrayWidth = [];

                newArrayWidth.push(widthArray[0]);
                newArrayWidth.push(widthArray[1]);

                if (columnsList.length > 0) {
                    meanWidth = Math.round(widthArray[2] / columnsList.length);
                }

                for (i = 0; i < columnsList.length; i++) {
                    if (columnsList[i].widgetSize !== undefined) {
                        newArrayWidth.push(parseInt(columnsList[i].widgetSize, 10));
                    } else {
                        newArrayWidth.push(meanWidth);
                    }
                }
                newArrayWidth.push(widthArray[initArrayLength - 1]);
                return newArrayWidth;
            },*/

            buildImgSpan : function (iconChoice, iconSize, iconColor) {
                var imgClass = 'fonticon fonticon-' + iconSize + 'x fonticon-' + iconChoice,
                    imgSpan = UWA.createElement('span', {
                        'class' : imgClass
                    });

                imgSpan.setStyle("color", iconColor);
                return imgSpan;
            },

            buildImgCell : function (iconChoice, iconSize, iconColor, imgTitle, cellWidth, cellAlign) {
                var imgCell, imgSpan;

                imgCell = UWA.createElement('td', {
                    'width' : cellWidth, //'15%',
                    'align' : cellAlign,//'class': 'paramtd','vertical-align': 'text-bottom',
                    'title' : imgTitle
                });
                imgSpan = UIview.buildImgSpan(iconChoice, iconSize, iconColor);
                imgSpan.inject(imgCell);
                imgCell.setStyle("vertical-align", "text-bottom");

                return imgCell;
            },
            //NZV : Added with FUN085423 and removed createDeleteActionElements
            createActionElements : function (iTitle, removebtn) {
                var actionelts = [], actionSpan = UWA.createElement('span'), actionBtn, actionPop;
                if (removebtn == true) {
                    actionBtn = new Button({
                        className: 'close',
                        icon: 'fonticon fonticon-trash fonticon-1.5x',//value: 'Button', //fonticon-cancel  fonticon-minus-circled    
                        attributes: {
                            disabled: false,
                            'aria-hidden' : 'true'
                        }
                    }).inject(actionSpan);
                } else {
                    actionBtn = new Button({
                        className: 'close',
                        icon: 'fonticon fonticon-pencil fonticon-1.5x',//value: 'Button', //fonticon-cancel  fonticon-minus-circled    
                       
                        attributes: {
                            disabled: false,
                            'aria-hidden' : 'true'
                        }
                    }).inject(actionSpan);                  
                }

                actionPop = new Popover({
                      //class: 'parampopover',
                    target: actionSpan,//iCell,                        
                    trigger : "hover",
                    animate: "true",
                    position: "top",
                    body: iTitle,
                    title: ''//iParamObj.nlsKey
                });

                actionelts.push(actionSpan);
                actionelts.push(actionBtn);
                actionelts.push(actionPop);
                
                return actionelts;
            },

            /* // ZUR : Proto Array View
            buildColumnsTitleLine : function (columnsList, widthArray) {
                var i, columnCell,
                    titlesLine = UWA.createElement('tr', {title: ''});

                columnCell = UWA.createElement('td', {
                    'width' : widthArray[0].toString() + '%'
                }).inject(titlesLine);

                columnCell = UWA.createElement('td', {
                    'width' : widthArray[1].toString() + '%'
                }).inject(titlesLine);

                for (i = 0; i < columnsList.length; i++) {

                    columnCell = UWA.createElement('td', {
                        'width' : widthArray[i + 2].toString() + '%',
                        'title' : columnsList[i].tooltipNlsKey,
                        'id'    : columnsList[i].id
                    }).inject(titlesLine);

                    UWA.createElement('h4', {
                        text   : columnsList[i].nlsKey,
                        'class': 'font-3dslight' // font-3dsbold
                    }).inject(columnCell);
                }

                columnCell = UWA.createElement('td', {
                    'width' : widthArray[widthArray.length - 1].toString() + '%'
                }).inject(titlesLine);

                UWA.createElement('h4', {
                    text   : 'isDeployed',
                    'class': 'font-3dslight' // font-3dsbold
                }).inject(columnCell);

                return titlesLine;
            },*/

            buildSeparationLine : function (iText) {
                var cellTitle,
                    sepLine = UWA.createElement('tr');

                cellTitle = UWA.createElement('td', {
                    'colspan': '3',
                    'align': 'left'
                }).inject(sepLine);

                UWA.createElement('h4', {
                    text: iText,
                    'class': 'font-3dslight'
                }).inject(cellTitle);

                return sepLine;
            },

            createParamMask : function (iElement, iText) {
                var imgClass = 'fonticon fonticon-1x fonticon-attention',
                    imask = new UWA.createElement('div', { 'class': 'pmask' });

                new UWA.createElement('div', {
                    'class': 'pmask-wrapper',
                    html: {
                        tag: 'div',
                        'class': 'pmask-content',
                        html: [
                            new UWA.createElement('span', {
                                'class' : imgClass
                            }),
                            new UWA.createElement('span', {
                                'class': 'text',
                                text: iText
                            })
                        ]
                    }
                }).inject(imask);

                imask.inject(iElement);
            },

            isOnTheCloud : function (platformID) {

                if ((platformID !== null) &&
                        (platformID !== "") &&
                           (platformID != "OnPremise")) {
                    return true;
                }

                return false;
            },

            buildNoLicenseUI : function () {

                var licenseAlert = new Alert({
                    className : 'param-alert',
                    closable: true,
                    visible: true,
                    renderTo : document.body,
                    autoHide : false,
                    hideDelay : 5000,
                    messageClassName : 'warning'
                });

                return licenseAlert;
            },

            // getDisplayNameForTenant : function (iTenantID, iPlaformCollection) {

            //     var iTenantName = iTenantID;

            //     iPlaformCollection.forEach(function (model) {
            //         if (model.get('id') === iTenantID) {
            //             iTenantName = model.get('displayName');
            //         }
            //     });

            //     return iTenantName;
            // },

            getObjValFromACollection : function (valueToCompare, collectionOfObject, propNameToCompare, propNameToFetch) {

                var resultValue = "";

                collectionOfObject.forEach(function (model) {
                    if (model[propNameToCompare] === valueToCompare) {
                        resultValue = model[propNameToFetch];
                    }
                });

                return resultValue;
            },

            isDashboardChoosenTenantInPreferences : function (iDashboardTenantID, iPreferences) {

                var isTenantInPreferences = false;

                iPreferences.forEach(function (iPref) {
                    if (iPref.id === iDashboardTenantID) {
                        isTenantInPreferences = true;
                    }
                });

                return isTenantInPreferences;
            },
            compareContentNamingObject : function(Obj1, Obj2) {
                if (Obj1.nlsKey !== undefined && Obj2.nlsKey !== undefined) {
                    return Obj1.nlsKey.localeCompare(Obj2.nlsKey);
                }
            },
            //ZUR - IR-518037-3DEXPERIENCER2017x\18, IR-689657-3DEXPERIENCER2019x\20x
            showContextualDeleteModal : function (iTargetElement, modalCssClass, nlsMessage, nlsMsgOnOkBtn, nlsMsgOnCancelBtn, nlsTitle, removeOperation, data) {
                var deleteConfirmModal, deleteDiv,
                    lineModal, iCell, modalDeleteBtn, modalCancelBtn, mainText;

                deleteDiv = UWA.createElement('div', {
                    'id': 'deleteAttributeConfDiv'
                });

                lineModal = UWA.createElement('tr').inject(deleteDiv);
                iCell = UWA.createElement('td').inject(lineModal);
                //FUN102019 21x FD03
                if(nlsMessage.includes("\n")) {
                    var splitedStr = nlsMessage.split('\n');
                    splitedStr.forEach(function (splitedMsg) {
                         mainText = UWA.createElement('p', {
                            text   : splitedMsg,
                            'class': 'font-3dslight'
                        }).inject(iCell);                       
                    }); 

                } else {
                    mainText = UWA.createElement('p', {
                        text   : nlsMessage,
                        'class': 'font-3dslight'
                    }).inject(iCell);
                }

                UWA.createElement('br').inject(mainText);
                UWA.createElement('br').inject(mainText);

                UWA.createElement('p', {
                    text   : ParamSkeletonNLS.AreYouWantToProceed,
                    'class': 'font-3dslight'
                }).inject(mainText);

                modalDeleteBtn = new Button({
                    value : nlsMsgOnOkBtn, //ParamSkeletonNLS.RemoveElement,
                    className: 'attrConfRemoveBtn warning',
                    id    : "modalOKButton"
                });

                modalCancelBtn = new Button({
                    value : nlsMsgOnCancelBtn, //ParamSkeletonNLS.CancelButton,
                    className: 'attrConfCancelBtn default',
                    id    : 'modalCancelButton'
                });

                deleteConfirmModal = new Modal({
                    className : modalCssClass,
                    overlay : true,
                    closable : true,
                    header : '<h4>' + nlsTitle/*ParamSkeletonNLS.ConfirmDelete*/ + '</h4>',
                    body :   deleteDiv,
                    footer  : [ modalDeleteBtn, modalCancelBtn ]
                }).inject(iTargetElement);
                //deleteConfirmModal.setStyle("width")
                deleteConfirmModal.getContent().getElements('.attrConfRemoveBtn').forEach(function (element) {
                    element.addEvent('click', function () {
                        deleteConfirmModal.destroy();
                        removeOperation(data);
                    });
                });

                deleteConfirmModal.getContent().getElements('.attrConfCancelBtn').forEach(function (element) {
                    element.addEvent('click', function () {
                        deleteConfirmModal.destroy();
                    });
                });
                deleteConfirmModal.show();
            },

            showSearchInput: function(that) {
                var root, placeHolderMsg, fragmentSearch, searchDiv, noResultsMessage,
                    prefix = that.model._attributes.domainid, selectedItem,
                    autoCompAxiom = [], searchNode = null,
                    fragmentDataSet = {
                        'name' : 'Fragments',
                        'items': [{}],
                        searchEngine: function (dataset, text) {
                            var items = dataset.items;
                            if (text.length) {
                                return items.filter(function (item) {
                                    return (item.value && (item.subLabel.toLowerCase().contains(text.toLowerCase()) || item.value.toLowerCase().contains(text.toLowerCase())));
                                });
                            }
                            return [];
                        }
                    };

                that.collection._models.forEach(function (val) {
                    autoCompAxiom.push({
                        value : val._attributes.title,
                        subLabel : val._attributes.id
                    });
                });
                if (that.model.id === "AttributeDef") {
                    placeHolderMsg =  ParamSkeletonNLS.SelectAType; 
                    noResultsMessage = ParamSkeletonNLS.NoTypeFound;
                } else if (that.model.id === "XCADParameterization") {
                    placeHolderMsg =  ParamSkeletonNLS.SelectACADConfiguration; 
                    noResultsMessage = ParamSkeletonNLS.NoCADConfigurationFound;
                } else {
                    placeHolderMsg = ParamSkeletonNLS.SelectAPolicy; 
                    noResultsMessage = ParamSkeletonNLS.NoPolicyFound;
                }
                searchNode = this.container.getElement("#searchAutoCompleteInput");
                if (searchNode !== null) {
                    searchNode.destroy();
                }
                fragmentDataSet.items = fragmentDataSet.items.concat(autoCompAxiom);
                searchDiv = UWA.createElement('div', {
                    'id': 'searchAutoCompleteInput',
                    'class':'autoCompleteSearch'
                }).inject(this.container.children[0]);

                fragmentSearch = new Autocomplete({
                    multiSelect: false,
                    showSuggestsOnFocus: true,
                    noResultsMessage: noResultsMessage,
                    allowFreeInput: false,
                    placeholder: placeHolderMsg,
                    filterEngine: function (suggestions) { 
                        return suggestions;
                    },
                    events: {
                        onSelect: function() {
                            selectedItem = fragmentSearch.getSelection();
                            root = '/domains/' + prefix + '/parentRenderer/' + selectedItem.subLabel + '/?f=0';
                            that.pSkeleton.setRoute(root);
                            fragmentSearch.reset();
                        },
                        onKeyDown: function(e) {//IR-673291-3DEXPERIENCER2019x\20x
                            if (e.keyCode === 13) {
                                e.preventDefault();
                            }
                        },
                        onKeyUp: function(e) {
                            if (e.keyCode === 13) {
                                fragmentSearch.showAll();
                            }
                        }
                    }
                }).inject(searchDiv);

                fragmentSearch.addDataset(fragmentDataSet);//fragmentSearch.focus();
            }
        };

        return UIview;
    });

/**
* @quickreview  ROW 25:02:11
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDisplayProperties/DPConfigurationTreeListViewConstants',
[
  'UWA/Class',
  'i18n!DS/ParameterizationSkeleton/assets/nls/DisplayPropertiesNLS',
],
function
(
  Class,
  Nls
)
{
  'use strict';

  var DPConfigurationTreeListViewConstants = Class.extend({

        colIndex : [],
        colName : [],
        colVisibility : [],
        fixedColIndex : ["deploystatus","edit","delete"],
        fixedColName : [Nls.deploystatus, Nls.edit, Nls.delete],

        /*
        * setColumnsNameNls
        */
        setColumnsNameNls: function setColumnsNameNls(nls) {
          this.nls = nls;
        },

        /*
        * setColumnsIndex
        */
        setColumnsIndex: function setColumnsIndex(colIndex) {
          this.colIndex = colIndex;
        },

        /*
        * getColumnsIndex
        */
        getColumnsIndex: function getColumnsIndex() {
          var returnTab = [];
          for (var i=0;i<this.colIndex.length;i++)
            returnTab.push(this.colIndex[i]);

          for (var i=0;i<this.fixedColIndex.length;i++)
            returnTab.push(this.fixedColIndex[i]);

          return returnTab;
        },

        /*
        * setColumnsName
        */
        setColumnsName: function setColumnsName(colName) {
          this.colName = colName
        },

        /*
        * getColumnsName
        */
        getColumnsName: function getColumnsName() {
          var that = this;
            var returnTab = [];
            for (var i=0;i<that.colIndex.length;i++)
            {
              if ((that.nls != undefined || that.nls != null) && (that.nls[that.colIndex[i]] != undefined || that.nls[that.colIndex[i]] != null))
                returnTab.push(that.nls[that.colIndex[i]]);
              else
                returnTab.push(that.colIndex[i]);
            }

            for (var i=0;i<that.fixedColName.length;i++)
              returnTab.push(that.fixedColName[i]);

            return returnTab;
        },

        /*
        * setColumnsVisibilityStatus
        */
        setColumnsVisibilityStatus : function setColumnsVisibilityStatus(colVisibility)
        {
          this.colVisibility = colVisibility;
        },

        /*
        * getColumnsVisibilityStatus
        */
        getColumnsVisibilityStatus : function getColumnsVisibilityStatus()
        {
          return this.colVisibility;
        }
  });
  return DPConfigurationTreeListViewConstants;
});

/*! Copyright 2017, Dassault Systemes. All rights reserved. */
/*global define, widget, document, setTimeout, console*/
/*jslint nomen: true*/
/*@fullReview  ZUR 16/02/13 2017x HL*/
define('DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/LifecycleDescriptionView',
    [
        'UWA/Core',
        'UWA/Class/View',
        'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS'
    ],
    function (UWA, View,
              ParamSkeletonNLS) {

        'use strict';

        var extendedView =  View.extend({
            tagName: 'div',
            className: 'generic-detail',

            init: function (options) {
                options = UWA.clone(options || {}, false);
                this._parent(options);
            },

            render: function () {
                var that = this;

                if (this.collection._models.length === 0) {
                    UWA.log("LifecycleDescriptionView::fist time");
                    this.listenTo(this.collection, {
                        onSync: that.onCompleteRequestDescription
                    });
                } else {
                    UWA.log("LifecycleDescriptionView::model already there");
                    that.onCompleteRequestDescription();
                }

                return this;
            },

            onCompleteRequestDescription : function () {
                UWA.log("LifecycleDescriptionView::onCompleteRequestDescription::");

                var mainDiv, newRow, newCell, SummaryTable, opTable, opTbody, optionText,
                    summaryDiv, operationsDiv, tooltiptoShow;

                mainDiv =  UWA.createElement('div', {
                    'id': 'DescriptionMainDiv'
                });

                tooltiptoShow = this.collection._models[0]._attributes.tooltip;

                if (!tooltiptoShow.startsWith("OOTBParameterization.LifecycleTopology")) {
                    summaryDiv =  UWA.createElement('div', {'id': 'summaryDiv'}).inject(mainDiv);
                    SummaryTable =  UWA.createElement('table', {
                        'padding-left': '100'
                    }).inject(summaryDiv);

                    newRow = UWA.createElement('tr', {title: ParamSkeletonNLS.SummaryText}).inject(SummaryTable);
                    //newRow.style.backgroundColor = "#659ac2";
                    newCell = UWA.createElement('td',
                            {'width': '100%', 'title': ParamSkeletonNLS.SummaryText}).inject(newRow);

                    UWA.createElement('h3', {
                        text: ParamSkeletonNLS.SummaryText,//this.collection._models[0]._attributes.title,
                        'class': ''//font-3dslight font-3dsbold  
                    }).inject(newCell);

                    newRow = UWA.createElement('tr').inject(SummaryTable);
                    newCell = UWA.createElement('td', {'width': '100%'}).inject(newRow);

                    UWA.createElement('h4', {
                        text   : tooltiptoShow,
                        'class': 'font-3dslight'
                    }).inject(newCell);
                }

                operationsDiv =  UWA.createElement('div', {
                    'id': 'operationsDiv'
                }).inject(mainDiv);

                SummaryTable =  UWA.createElement('table', {
                    'padding-left': '100'
                }).inject(operationsDiv);

                newRow = UWA.createElement('tr').inject(SummaryTable);
                //newRow.style.backgroundColor = "#659ac2";
                newCell = UWA.createElement('td', {
                    'width': '100%',
                    'title': ParamSkeletonNLS.PossibleOperationsTxt
                }).inject(newRow);

                UWA.createElement('h3', {text: ParamSkeletonNLS.PossibleOperationsTxt}).inject(newCell);

                newRow = UWA.createElement('tr').inject(SummaryTable);
                newCell = UWA.createElement('td', {'width': '100%'}).inject(newRow);
                UWA.createElement('h4', {
                    text   : ParamSkeletonNLS.possibleOperationsText + this.collection._models[0]._attributes.title,// font-3dsbold
                    'class': 'font-3dslight'
                }).inject(newCell);

                opTable = UWA.createElement('table', {
                    'id': 'optionstable',
                    'width': '30%',
                    'class': 'table table-condensed table-hover table-bordered'
                }).inject(operationsDiv);

                opTbody =  UWA.createElement('tbody', {
                    'width': '50%',
                    'class': ''
                }).inject(opTable);

                newRow = UWA.createElement('tr').inject(opTbody);
                newCell = UWA.createElement('td', {'width': '80%', 'class': 'active'}).inject(newRow);

                UWA.createElement('h4', {
                    text   : ParamSkeletonNLS.ModifyTopologyTxt,// font-3dsbold
                    'class': 'font-3dslight'
                }).inject(newCell);
                newCell = UWA.createElement('td', {'width': '20%'}).inject(newRow);

                optionText = ParamSkeletonNLS.NoText;
                if (this.model.get("modifyTopology")) {
                    optionText = ParamSkeletonNLS.YesText;

                }

                UWA.createElement('h4', {
                    text   : optionText,// font-3dsbold
                    'class': 'font-3dslight'
                }).inject(newCell);

                newRow = UWA.createElement('tr').inject(opTbody);
                newCell = UWA.createElement('td', {'width': '80%', 'class': 'active'}).inject(newRow);

                UWA.createElement('h4', {
                    text   : ParamSkeletonNLS.RenameStatesTxt,// font-3dsbold
                    'class': 'font-3dslight'
                }).inject(newCell);

                optionText = ParamSkeletonNLS.NoText;
                if (this.model.get("renameStates")) {
                    optionText = ParamSkeletonNLS.YesText;
                }

                newCell = UWA.createElement('td', {'width': '20%'}).inject(newRow);
                UWA.createElement('h4', {
                    text   : optionText,// font-3dsbold
                    'class': 'font-3dslight'
                }).inject(newCell);

                newRow = UWA.createElement('tr').inject(opTbody);
                newCell = UWA.createElement('td', {'width': '80%', 'class': 'active'}).inject(newRow);
                UWA.createElement('h4', {
                    text   : ParamSkeletonNLS.AddPromotionRulesTxt,// font-3dsbold
                    'class': 'font-3dslight'
                }).inject(newCell);

                optionText = ParamSkeletonNLS.NoText;
                if (this.model.get("supportRules")) {
                    optionText = ParamSkeletonNLS.YesText;
                }

                newCell = UWA.createElement('td', {'width': '20%'}).inject(newRow);
                UWA.createElement('h4', {
                    text   : optionText,// font-3dsbold
                    'class': 'font-3dslight'
                }).inject(newCell);

                this.container.setContent(mainDiv);
            },

            removeElement : function() {
                UWA.log(":");
            },

            restoreStates : function() {
                UWA.log(":");
            },

            showAddElementsModal : function() {
                UWA.log(":");
            },

            destroy : function() {
                this.stopListening();
                this._parent.apply(this, arguments);
            }

        });

        return extendedView;
    });

define("DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/ParameterizationPartSupplyCollectionTypes", ["require", "exports"], function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    ;
});

/*global define*/
define('DS/ParameterizationSkeleton/Model/ParameterizationDataModeling/TypeModel',
    [
        'UWA/Core',
        'UWA/Class/Model'
    ], function (UWA, Model) {
        "use strict";
        return Model.extend({
            defaults: function() {
                return {
                    id: '',
                    title : '',
                    listofAttributes : '',
                    listofSynchros : '',
                    listofSystemAttribues : '', //NZV :IR-540216-3DEXPERIENCER2018x
                    typeCategory : '' //VPM/CBP
                };
            }
        });
    });

/* Notifications are
 * 1. success
 * 2. info
 * 3. warning
 * 4. error
 * 5. clearNotifications
 */

define("DS/ParameterizationSkeleton/Utils/ParameterizationXCAD/xNotification", [
  "DS/Notifications/NotificationsManagerUXMessages",
  "DS/Notifications/NotificationsManagerViewOnScreen"
], function (NotificationsManagerUXMessages, NotificationsManagerViewOnScreen) {
  "use strict";

  var xNotifyManager = {
    _notif_manager: null,

    init: function (container) {
      if (this._notif_manager === null) {
        this._notif_manager = NotificationsManagerUXMessages;

        NotificationsManagerViewOnScreen.setNotificationManager(
          this._notif_manager
        );

        NotificationsManagerViewOnScreen.setStackingPolicy(5); // level(1) + title(4)

        NotificationsManagerViewOnScreen.setFadeOutPolicy(2);

        NotificationsManagerViewOnScreen.setRemoveStackOnFirstTimeoutFlag(true);
      }

      if (container) {
        let xContainer = document.querySelector(container);
        NotificationsManagerViewOnScreen.inject(xContainer);
      }
    },

    sucessMsg: function (title, message, container) {
      if (!this._notif_manager) this.init(container);

      this._notif_manager.addNotif({
        level: "success",
        title: title,
        message: message,
        sticky: false
      });
    },

    infoMsg: function (title, message, container) {
      if (!this._notif_manager) this.init(container);

      this._notif_manager.addNotif({
        level: "info",
        title: title,
        message: message,
        sticky: false
      });
    },

    warningMsg: function (title, message, container) {
      if (!this._notif_manager) this.init(container);

      this._notif_manager.addNotif({
        level: "warning",
        title: title,
        message: message,
        sticky: false
      });
    },

    errorMsg: function (title, message, container) {
      if (!this._notif_manager) this.init(container);

      this._notif_manager.addNotif({
        level: "error",
        title: title,
        message: message,
        sticky: false
      });
    },

    clearNotifications: function () {
      NotificationsManagerViewOnScreen.removeNotifications("", "");
    }
  };

  return xNotifyManager;
});

/*@fullReview  ZUR 15/11/23 2017x Param Skeleton*/
/*global define, widget*/
define('DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
    [
    ], function () {
        "use strict";

        var iHandler = {
            //
            init: function (url, tenant) {
                this.url = url;
                this.tenant = tenant;
            },

            setURL : function(url) {
                this.url = url;
            },

            getURL : function() {
                return this.url;
            },

            getTenant : function() {
                return this.tenant;
            },

            setTenant : function (itenant) {
                this.tenant = itenant;
            }

        };

        return iHandler;
    });

/*@fullReview  ZUR 15/11/23 2017x Param Skeleton*/
/*global define*/
/*jslint nomen: true */
/*jslint plusplus: true*/
define('DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    [
    ], function () {

        "use strict";
        var pUtils = {

            /*
            JSONreplace : function (data) {

                JSON.stringify(data, function (key, value) {
                    var k, replacement;
                    if (value && typeof value === 'object') {
                        replacement = {};
                        for (k in value) {
                            if (Object.hasOwnProperty.call(value, k)) {
                                replacement[k && k.charAt(0).toLowerCase() + k.substring(1)] = value[k];
                            }
                        }
                        return replacement;
                    }
                    return value;
                });
                return data;
            },//JSONreplace */

            paramStructBuilder: function (fields) {
                var i,
                    fields = fields.split(','),
                    count = fields.length;

                function constructor() {
                    for (i = 0; i < count; i++) {
                        this[fields[i]] = arguments[i];
                    }
                }
                return constructor;
            },

        };//pUtils

        return pUtils;

    });

/*global define*/
define('DS/ParameterizationSkeleton/Model/ParameterizationLifecycle/LifecycleDescriptionModel',
    [
        'UWA/Class/Model'
    ], function (Model) {

        'use strict';
        //
        return Model.extend({
            defaults: function() {
                return {
                    id : '',
                    text : '',
                    tooltip : ''
                };
            }
        });
    });


/*global define*/
define('DS/ParameterizationSkeleton/Model/ParameterizationDataModeling/TypesListModel',
    [
        'UWA/Class/Model'
    ], function (Model) {
        "use strict";
        return Model.extend({
            defaults: function() {
                return {
                    id: '',
                    title : '',
                    subtitle : '',
                    domainid : '',
                    image : ''
                };
            }
        });
    });

define("DS/ParameterizationSkeleton/Views/ParameterizationPartSupply/PartSupplyIndexingManagementTypes", ["require", "exports"], function (require, exports) {
    "use strict";
        /**
     * The aim of this module is to provide an interface for all objects defined in PartSupplyIndexingManagementWrapper.mweb
     * that need to be used in PartSupplyIndexingManagement.mweb
     */
    var PartSupplyIndexingManagementTypes;
    (function (PartSupplyIndexingManagementTypes) {
        ;
    })(PartSupplyIndexingManagementTypes || (PartSupplyIndexingManagementTypes = {}));
    ;
    return PartSupplyIndexingManagementTypes;
});

define('DS/ParameterizationSkeleton/Views/ParameterizationXEngineering/XENTileView', [
    'DS/W3DXComponents/Views/Layout/GridScrollView',
    'DS/W3DXComponents/Views/Item/TileView',
    'DS/W3DXComponents/Views/Item/SetView',
    'css!DS/W3DXComponents/W3DXComponents',
], (
    GridScrollView,
    ItemViewTile,
    ItemViewSet,
) => {
    const name = 'list';

    const ItemsListView = ItemViewSet.extend({
        name,
        defaultOptions: {
            contents: {
                // defaultView: 'tile',
                useInfiniteScroll: false,
                usePullToRefresh: false,
                selectionMode: 'oneToOne',
                views: [{
                    id: 'tile',
                    // 'title' : 'Tile View',
                    view: GridScrollView,
                    itemView: ItemViewTile,
                    scrollPosition: 'center',
                    layout: {
                        column: 2,
                    },
                }],
            },
        },

        destroy(options) {
            if (this.isDestroyed) {
                return;
            }
            if (this.collection) {
                this.stopListening(this.collection, this._externalEvents);
            }
            return this._parent.apply(this, arguments);
        },

        reload() {
            this.container.addClassName('loading');
            this.collection.state.totalRecords = null;
            this.collection.getFirstPage();
        },
    });

    return ItemsListView;
});

define('DS/ParameterizationSkeleton/Views/ParameterizationSystemsSafety/SystemsSafetyViewUtilities', [
    'UWA/Core'
], function(
    UWA
) {

    'use strict';

    var SystemsSafetyViewUtilities = {
        LEFT_ALIGNMENT: 'left',
        RIGHT_ALIGNMENT: 'right',
        HTML_BOLD_FORMAT: 'h5',
        HTML_PARAG_FORMAT: null
    };

    SystemsSafetyViewUtilities.buildImgSpan = function(iconChoice, iconSize, iconColor, title) {
        var imgSpan = UWA.createElement('span', {
            'class': 'fonticon fonticon-' + iconSize + 'x fonticon-' + iconChoice,
            'title': title
        });

        imgSpan.setStyle("color", iconColor);
        return imgSpan;
    };

    SystemsSafetyViewUtilities.buildTextTableCell = function(alignment, cellWidth, row, cellTag, cellText, colspan) {
        var iCell = UWA.createElement('td', {
            'Align': alignment,
            'width': cellWidth,
            'colspan': colspan || '1',
            'class': 'architectureNumberingField'
        }).inject(row);

        if (cellTag) {
            UWA.createElement(cellTag, {
                text: cellText
            }).inject(iCell);
        } else {
            iCell.appendText(cellText);
        }
        return iCell;
    };

    return SystemsSafetyViewUtilities;
});

/**
* @quickreview  KB9 21:11:09
*/

define('DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationTreeListViewConstants',
[
  'UWA/Class',
  'i18n!DS/ParameterizationSkeleton/assets/nls/DELConfigurationTreeListViewConstants',
],
function
(
  Class,
  FixedNls
)
{
  'use strict';

  var DELConfigurationTreeListViewConstants = Class.extend({

        colIndex : [],
        colName : [],
        colVisibility : [],
        fixedColIndex : ["isDeployed","edit","delete"],
        fixedColName : [FixedNls.isDeployed, FixedNls.edit, FixedNls.delete],

        /*
        * setColumnsNameNls
        */
        setColumnsNameNls: function setColumnsNameNls(nls) {
          this.nls = nls;
        },

        /*
        * setColumnsIndex
        */
        setColumnsIndex: function setColumnsIndex(colIndex) {
          this.colIndex = colIndex;
        },

        /*
        * getColumnsIndex
        */
        getColumnsIndex: function getColumnsIndex() {
          var returnTab = [];
          for (var i=0;i<this.colIndex.length;i++)
            returnTab.push(this.colIndex[i]);

          for (var i=0;i<this.fixedColIndex.length;i++)
            returnTab.push(this.fixedColIndex[i]);

          return returnTab;
        },

        /*
        * setColumnsName
        */
        setColumnsName: function setColumnsName(colName) {
          this.colName = colName
        },

        /*
        * getColumnsName
        */
        getColumnsName: function getColumnsName() {
          var that = this;
            var returnTab = [];
            for (var i=0;i<that.colIndex.length;i++)
            {
              if ((that.nls != undefined || that.nls != null) && (that.nls[that.colIndex[i]] != undefined || that.nls[that.colIndex[i]] != null))
                returnTab.push(that.nls[that.colIndex[i]]);
              else
                returnTab.push(that.colIndex[i]);
            }

            for (var i=0;i<that.fixedColName.length;i++)
              returnTab.push(that.fixedColName[i]);

            return returnTab;
        },

        /*
        * setColumnsVisibilityStatus
        */
        setColumnsVisibilityStatus : function setColumnsVisibilityStatus(colVisibility)
        {
          this.colVisibility = colVisibility;
        },

        /*
        * getColumnsVisibilityStatus
        */
        getColumnsVisibilityStatus : function getColumnsVisibilityStatus()
        {
          return this.colVisibility;
        }
  });
  return DELConfigurationTreeListViewConstants;
});

define('DS/ParameterizationSkeleton/Model/ParameterizationLifecycle/LifecycleModel',
[
    'UWA/Core',
    'UWA/Class/Model'
], function (UWA, Model) {
    return Model.extend({
        defaults: function() {
            return {
                id : '',
                states : '',
                transitions : '',
                checks: '',
                types: '',
                appCategory : '',
            	title : '',
                subtitle : '',               
            };
        }
    });
});


/*global define*/
define('DS/ParameterizationSkeleton/Model/ParamCollaboration/TypeListMappingModel',
    [
        'UWA/Core',
        'UWA/Class/Model'
    ], function (UWA, Model) {
        "use strict";
        return Model.extend({
            defaults: function() {
                return {
                    id: '',
                    title : '',
                    subtitle : '',
                    content: '',
                    domainid : '',
                    image : '',
                    icon: '',
                };
            }
        });
    });

/*global define,clearTimeout,setTimeout */
define('DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/ParamNodeView',
    [
        'UWA/Core',
        'egraph/views',
        'egraph/utils',
        'DS/UIKIT/Popover',
        'DS/UIKIT/Input/Button',
        'DS/UIKIT/Modal',
        'DS/UIKIT/Input/Text',
        'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS',
        'text!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS_en.json'
    ], function (UWA,
        views, utils, Popover, Button, Modal,
        Text,
        ParamSkeletonNLS, ParamSkeletonNLS_en) {
    // 'DS/Param/Views/LifecycleViewUtilities'
    "use strict";
    function setDefaultEnValues(langJson, langDefaultJson) {
        for (const key in langDefaultJson) {
            if(!langJson[key]) {
                langJson[key] = langDefaultJson[key];
            } else if(typeof langJson[key] === 'object') {
                setDefaultEnValues(langJson[key], langDefaultJson[key]);
            }
        }
    }

    setDefaultEnValues(ParamSkeletonNLS, JSON.parse(ParamSkeletonNLS_en));

    var callfctrename, localthat,
        exports = {},
        areStatesRenamable = true,
        modifyTopology = true;

    exports.ParamNodeView = function (that, renameStates, iModifyTopology) {
        UWA.log("ParamNodeView::Inside");
        // callfctrename = renamefct;
        callfctrename = that.handleRenamingIssues;
        localthat = that;
        areStatesRenamable = renameStates;
        modifyTopology = iModifyTopology;
        views.HTMLNodeView.call(this);
    };

    utils.inherit(exports.ParamNodeView, views.HTMLNodeView);

    //Redefining the view of a node
    exports.ParamNodeView.prototype.buildNodeElement = function (iNode) {
        UWA.log("buildNodeElement");
        UWA.log(iNode);
        return customizeNode(iNode);
    };

    //Redefining actions of node select
    exports.ParamNodeView.prototype.onselect = function (e, selected) {
        UWA.log("ParamNodeView - onselect");
        /*if (selected) return (this.selectNode(e));  */
    };

    function customizeNode(iNode) {

        var mainDiv, iTable, newRow, newCell, imgSpan, stateNameInput, timerconn, stateLockPop,
            nodeLocked = false,
            lockTitle = ParamSkeletonNLS.StateCriticalText.format(iNode.name),
            ititle = iNode.name;
            let langs = [
                "en",
                "fr",
                "de",
                "es",
                "cs",
                "it",
                "ja",
                "ko",
                "pl",
                "pt-BR",
                "ru",
                "zh-CN",
                "zh-TW",
                "tr"
            ];

        function getLangValue(name, lang) {
            let ret = '';

            if(name != null) {
                let langValues = name.split(",");
                langValues.forEach((value) => {
                    let valueAndLang = value.split("~");
                    if(valueAndLang.length == 2) {
                        if(valueAndLang[1] == lang) {
                            ret = valueAndLang[0];
                        }
                    }
                });
    
            }

            return ret;
        }

        function getI18NValues(oldValue) {
            let ret = "";
            langs.forEach((lang) => {
                let newValue = document.getElementsByName('lang_' + lang)[0].value;
                if(newValue != getLangValue(oldValue, lang)) {
                    ret += newValue + "~" + lang + ",";
                }
            });

            if(ret.length > 0) {
                ret = ret.substring(0, ret.length - 1);
            }
            return ret;
        }

        if (!areStatesRenamable) {
            ititle = ititle + " - " + ParamSkeletonNLS.StatesCannotBeRenamedText;
        }

        mainDiv = UWA.createElement("div");
        iTable = UWA.createElement("table", { 'height': '100%', 'width': '100%' }).inject(mainDiv);
        newRow = UWA.createElement('tr').inject(iTable);
        newCell = UWA.createElement('td',{
            'width': areStatesRenamable ? '80%' : '100%',/* HXE , 'colspan': '2'*/
            'text': iNode.name,
            'title': iNode.name,
            'styles': {
                'fontSize' : 'large',
                'maxWidth' : '130px',
                'overflow' : 'hidden',
                'textOverflow': 'ellipsis',
                'whiteSpace' : 'nowrap'
            }
         }).inject(newRow);

        /*
        stateNameInput = new Text({
            placeholder: "...",
            attributes: {
                value: iNode.name,
                multiline: false,
                title: ititle,
                disabled: !areStatesRenamable,
                readonly: !areStatesRenamable
            },
            events: {
                onChange: function () {
                    UWA.log("onchange");
                    this.elements.input.title = this.getValue();
                    callfctrename(iNode, localthat, this.getValue());
                    //  UIUtilities.beingModified(imgCell, ParamWdgNLS.Being_Modified);
                    //  updateParameterOnChange(this,controlObjectCell,imgCell);
                },
                onKeyDown: function () {
                    UWA.log("onKeyDown");

                    if (timerconn) { clearTimeout(timerconn); }

                    timerconn = setTimeout(function () {
                        callfctrename(iNode, localthat, stateNameInput.getValue());
                    }, 20);

                    //  UIUtilities.beingModified(imgCell, ParamWdgNLS.Being_Modified);
                }
            }
        }).inject(newCell);
        */

        // HXE add edit icon
        if (areStatesRenamable) {
            newCell = UWA.createElement('td',
                { 'width': '20%'/* HXE , 'colspan': '2'*/ }).inject(newRow);
            imgSpan = UWA.createElement('span', {
                'class': 'fonticon fonticon-2x fonticon-pencil',
                'styles': {color: 'rgb(119, 121, 124)', cursor: 'pointer'},
                'events': {
                    'mousedown': function (event) {
                        let CancelBtn = new Button({
                            value: ParamSkeletonNLS.CancelButton,
                            className: 'btn default',
                            events: {
                                'onClick': function (e) {
                                    dialog.destroy();
                                }
                            }
                        });

                        let OkBtn = new Button({
                            value: ParamSkeletonNLS.OKButton,
                            className: 'btn primary',
                            events: {
                                'onClick': function (e) {
                                    let newValue = getI18NValues(iNode.allLangNames);
                                    if(newValue.length > 0) {
                                        callfctrename(iNode, localthat, newValue);
                                    }
                                    iNode.gr.clearSelection();
                                    dialog.destroy();
                                }
                            }
                        });

                        let table = UWA.createElement('table', { 'height': '100%' });
                        for (let i = 0; i < langs.length; i = i + 2) {
                            let tr = UWA.createElement('tr', {styles: {textAlign: 'right'}}).inject(table);
                            UWA.createElement('td', { 'text': ParamSkeletonNLS.Lang[langs[i]] }).inject(tr);
                            let td = UWA.createElement('td').inject(tr);
                            let value = getLangValue(iNode.allLangNames, langs[i]);
                            new Text({
                                attributes: {
                                    value: value,
                                    multiline: false,
                                    title: value,
                                    name: "lang_" + langs[i]
                                }
                            }).inject(td);
                            UWA.createElement('td', { 'text': ParamSkeletonNLS.Lang[langs[i+1]] }).inject(tr);
                            td = UWA.createElement('td',{styles: {padding: '5px', verticalAlign : 'middle'}}).inject(tr);
                            value = getLangValue(iNode.allLangNames, langs[i+1]);
                            new Text({
                                attributes: {
                                    value: value,
                                    multiline: false,
                                    title: value,
                                    name: "lang_" + langs[i+1]
                                }
                            }).inject(td);
                        }
                        let dialog = new Modal({
                            closable: true,
                            header: UWA.createElement('h4', {
                                text: ParamSkeletonNLS.ModifyStateName,
                                'class': 'font-3dslight'
                            }),
                            body: table,
                            footer: [OkBtn, CancelBtn]
                        }).inject(localthat.contentDiv);

                        dialog.show();
                    }
                }
            }).inject(newCell);

        }

        newRow = UWA.createElement('tr').inject(iTable);
        newCell = UWA.createElement('td',
            { 'width': '50%', 'align': 'left' }).inject(newRow);

        if (!modifyTopology) {
            nodeLocked = true;
            lockTitle = ParamSkeletonNLS.TopologyNotModifiable;
        } else if (iNode.isCritical === "true") {
            nodeLocked = true;
        }

        if (nodeLocked) {
            imgSpan = UWA.createElement('span', {
                'class': 'fonticon fonticon-2x fonticon-lock'
            }).inject(newCell);

            imgSpan.setStyle("color", "#77797c");
            newCell.setStyle("vertical-align", "bottom");//"text-bottom"

            stateLockPop = new Popover({
                target: imgSpan,
                trigger: "hover",
                animate: "true",
                position: "top",
                body: lockTitle,
                title: ''//iParamObj.nlsKey
            });
        }

        UWA.createElement('td',
            { 'width': '50%' }).inject(newRow);

        mainDiv.addClassName("my-node");
        return mainDiv;
    }

    return exports;
});

/*global define*/
define('DS/ParameterizationSkeleton/Views/ParameterizationDataModeling/AttributesTypesDefine',
    [
    ], function() {
        "use strict";
        var iList = {

            getListOfHandledTypes : function () {

                var typesArray = [];
                typesArray.push({ type: 'String', length: '' });
                typesArray.push({ type: 'String', length: '16' });
                typesArray.push({ type: 'String', length: '40' });
                typesArray.push({ type: 'String', length: '80' });
                typesArray.push({ type: 'Boolean', length: '' });
                typesArray.push({ type: 'Integer', length: '' });
                typesArray.push({ type: 'Real', length: '' });
                typesArray.push({ type: 'Date', length: '' });
                return typesArray;
            },
            //IR-759885-3DEXPERIENCER2021x
            checkAvailability : function (arr, val) {
                return arr.some(function(arrVal) {
                    return val.toUpperCase() === arrVal.toUpperCase();//val.localeCompare(arrVal);
                });
            },

            forbiddenAttributeNames : ["EXTENDED_BY","REMOVE_EXT","UPDATE_EXT","KEEP_OTHER_EXT",
            "KEEP_PREVIOUS_STATE","businessobject","connection","class","relationclass","SET","CONTEXT",
            "BEGIN_TRANSACTION","END_TRANSACTION","CREATE","UPDATE","DELETE","RETURN","ONEVENTS","SR",
            "SRID","CUSTO","ALL","NONE","DS","NULL","MQL","WITH","USING","Ext","interface","composer","category",
            "composition_rel","initpovfromself","mod","path","true","false","or","and","Add","Del","Sync"],

            isAttributeForbidden : function (attributeName) {
                return iList.checkAvailability(iList.forbiddenAttributeNames, attributeName);
            }
        };

        return iList;
    });

define('DS/ParameterizationSkeleton/Views/ParamSpecificationManagement/SpecParamAlertUtility', [
	"DS/Core/Core",
    "DS/Notifications/NotificationsManagerUXMessages",
    "DS/Notifications/NotificationsManagerViewOnTreeListView",
    "DS/Notifications/NotificationsManagerViewOnScreen",
    "DS/Notifications/NotificationsManagerViewOnConsole"
], 
function (Core, NotificationsManagerUXMessages,
        WUXNotificationsManagerViewOnTreeListView,
        WUXNotificationsManagerViewOnScreen,
        WUXNotificationsManagerViewOnConsole) {
	'use strict';
	
	 WUXNotificationsManagerViewOnScreen.setNotificationManager(NotificationsManagerUXMessages);

	  /******************************************************************************
	   * Create the UI of the sample
	   *****************************************************************************/
	  //var container = new UWA.Element("div", { "class": "wux-control-inline-container", style: { "vertical-align": "top" } });
	  //container.inject(document.body);
	  //new UWA.Element("h3", { text: "Show slided notifications:" }).inject(container);
	  
	return  {

		
		alert: null,
	
	/**
	 * Create an alert
	 *   @param {String} type -success /error
	 *   @param {String} text
	 */
		message: function(type, text){
			
			 var infoOptions1 = {
				     level: type,				      
				     message: text,
					 category: "cat1"
				    };
			 // Adds the notification options.
			NotificationsManagerUXMessages.addNotif(infoOptions1);
		}
	
	}
}
);


/**
 * @author AMN14
 */
define('DS/ParameterizationSkeleton/Model/ParameterizationSAX/ParamSAXModel',
    [
        'UWA/Class/Model'
    ], function (Model) {
        "use strict";
        return Model.extend({
            defaults: function() {
                return {
                    id: '',
                    title : '',
                    subtitle : '',
                    domainid : '',
                    image : '',
                    familyid: ''
                };
            }
        });
    });

/*global define*/
define('DS/ParameterizationSkeleton/Model/ParameterizationXCAD/XCADListModel',
    [
        'UWA/Class/Model'
    ], function (Model) {
        "use strict";
        return Model.extend({
            defaults: function() {
                return {
                    id: '',
                    title : '',
                    subtitle : '',
                    domainid : '',
                    image : ''
                };
            }
        });
    });

/*global define*/
define('DS/ParameterizationSkeleton/Model/ParameterizationXCAD/XCADModel',
    [
        'UWA/Class/Model'
    ], function (Model) {
        "use strict";
        return Model.extend({
            defaults: function() {
                return {
                    id: ''
                };
            }
        });
    });

define('DS/ParameterizationSkeleton/Views/ParamConfigurationManagement/CfgParamAlertUtility', [
	'DS/UIKIT/Alert'
], 
function (Alert) {
	'use strict';
	return  {

		alert: null,
	
	/**
	 * Create an alert from UIKit
	 *   @param {String} type
	 *   @param {String} text
	 */
		message: function(type, text){
			if (!this.alert) {
                this.alert = new Alert({
                    visible: true,
										autoHide: true,
                }).inject(document.body, 'top');
            }
            this.alert.add({
                className: type,
                message: text
            });
		},
	
	}
}
);


define('DS/ParameterizationSkeleton/Views/PPRSynchronizationLifeCycle/PPRSynchroViewConstants', [], function () {

	'use strict';

	const contants = {
		TYPE: 'Type',
		COMPUTED_RESULTING_PRODUCT: 'LC_ResultingProduct',
		//SPEC_DOC:'LC_SpecificationDocument',
		CHILD_TRANSFORMATION_TYPES:'LC_ExpandMbomStructure',
		NEW_REVISION: 'Revise',
		NEW_BRANCH: 'NewBranch',
		DUPLICATE: 'Duplicate',
		DELETE: 'Delete',
		TRANSFER_OWNERSHIP: 'Change Owner',
		CHANGE_MATURIY: 'Change Status',
		LOCK: 'Lock',
		CHANGE_CONTROL: 'Change Control',
		TRANSFER: 'Transfer',
		SHARE: 'Share',
		//merged with New Revision 
		NEW_REVISION_FROM: 'New Revision From',
		//merged with Duplicate
		ADVANCE_DUPLICATE:'Advance Duplicate',
		BOOLEAN_TRUE_VALUE: 'True',
		//Type Item
		Provide: 'Provide',
			CreateAssembly: 'CreateAssembly',
			Fasten:'Fasten',
			ElementaryEndItem:'ElementaryEndItem',
			RemoveMaterial: 'RemoveMaterial',
			Predrill: 'Predrill',
			Drill: 'Drill',
			NoDrill: 'NoDrill',
			Cutting: 'Cutting',
			Grinding: 'Grinding',
			Beveling: 'Beveling',
			Transform: 'Transform',
			CreateKit: 'CreateKit',
			Marking: 'Marking',
			ContinuousProcessProvide: 'ProcessContinuousProvide',
			ContinuousProcessCreateMaterial: 'ProcessContinuousCreateMaterial',
			Installation: 'Installation',
			ServicePart: 'DELServicePartReference',
		ServiceKit: 'DELServiceKitReference',
		ServiceAssembly: 'DELServiceAssemblyReference',
		Machining: 'Machine',
		Split: 'SplitProcess',
		DetailedFasten:'DetailedFasten',
		NEW_NOT_DEPLOYED: 'NewNotDeployed',
		USER_DEFINED: 'UserDefined',
		DEPLOYED: 'Deployed',
		ADD: 'Add',
		REMOVE: 'Remove',
		MODIFY: 'Modify',
		OPERATION: 'UserOperation',
		NAME: 'Name',
		VALUE: 'Value',
		MAX_ROWS: 25,
		WIDTH_ARRAY: [10/*type*/, 7/*COMPUTED_RESULTING_PRODUCT*/, /*7 SPEC_DOC,*/ 7, 7, 7, 7, 7, 7, 7, 7/*lock*/, 7/*changecontrol*/, 7/*transfer*/, 7/*share*/, 3/*action*/, 3/*deploy*/]
	};

	return Object.freeze(contants);

});

/**
* @quickreview  ROW 25:02:11 creation
*/

define('DS/ParameterizationSkeleton/Model/ParameterizationDisplayProperties/DPConfigurationParamTranslationModel',
[
  'UWA/Core',
  'DS/TreeModel/TreeNodeModel'
],

function (Core, Model) {
  'use strict';

  function DPConfigurationParamTranslationModel(options) {
    var that = this;

    this.options = {
      label: '',
      nls : ''
    };

    this.options = UWA.extend(this.options, options);

    that.translateValuesToNls();
    Model.call(this, this.options);
  };

  DPConfigurationParamTranslationModel.prototype = Object.create(Model.prototype);

  DPConfigurationParamTranslationModel.prototype.getGrid = function getGrid() {
    var that = this;
    return that.options.grid;
  };

  DPConfigurationParamTranslationModel.prototype.addGridAttributes = function addGridAttributes(attr) {
    var that = this;
    var keys = Object.keys(attr);
    var values = Object.values(attr);

    if (keys.length && values.length)
      that.options.grid[keys[0]] = values[0];
  };

  DPConfigurationParamTranslationModel.prototype.getData = function getData() {
    var that = this;
    return that.options.data;
  };


  DPConfigurationParamTranslationModel.prototype.translateValuesToNls = function translateValuesToNls() {
    var that = this;

    if (that.options.nls === null || that.options.nls === undefined)
      return;

    var nodeKeys = Object.keys(this.options.data);
    var nodeValues = Object.values(this.options.data);

    var listOfNlsKeys = Object.keys(that.options.nls);
    var listOfNlsValues = Object.values(that.options.nls);

    if (this.options.grid === undefined)
      this.options.grid = Object.assign({}, this.options.data);

    var nodeValuesLength = nodeValues.length;
    for (var j=0;j<nodeValuesLength;j++)
    {
      var idx = listOfNlsKeys.indexOf(nodeValues[j]);
      if (idx >= 0)
        this.options.grid[nodeKeys[j]] = listOfNlsValues[idx];
    }
  };

  return UWA.namespace('DS/ParameterizationSkeleton/Model/ParameterizationDisplayProperties/DPConfigurationParamTranslationModel', DPConfigurationParamTranslationModel);
}); // -- End of require

define('DS/ParameterizationSkeleton/Views/ParameterizationSystemsSafety/SystemsSafetyModalPartner', [
    'DS/UIKIT/Modal',
    'UWA/Core',
    'DS/UIKIT/Input/Text',
    'DS/UIKIT/Alert',

    'i18n!DS/ParameterizationSkeleton/assets/nls/SystemsSafetyNLS'
], function(
    Modal,
    UWACore,
    Text,
    Alert,

    SystemsSafetyNLS
) {

    'use strict';

    var SystemsSafetyModal = function(options) {
        this.options = UWACore.extend({
            title: 'Dialog',
            className: '',
            withFooter: true
        }, options);

        this.modal = new Modal({
            className: this.options.className || '',
            closable: true,
            header: '<h4>' + this.options.title + '</h4>',
            body: '',
            footer: ''
        });
        this.modal.inject(document.querySelector('#systemsSafetyMainDiv'));
        if (this.options.withFooter) {
            this._bindFooterEvent();
        }
    };

    SystemsSafetyModal.prototype.getDefaultFields = function(_formatContent) {
        var divTagForName = document.createElement('div');
        divTagForName.className = "formats-arch";
        var labelDiv = document.createElement('div');
        labelDiv.innerText = SystemsSafetyNLS.partnerName;
        labelDiv.style.width = '20%';
        divTagForName.appendChild(labelDiv);
        var nameTextDiv = document.createElement('div');
        nameTextDiv.style.width = '80%';
        this.nameTextBox = new Text({
            placeholder: SystemsSafetyNLS.partnerNamePlaceholder
        });
        this.nameTextBox.inject(nameTextDiv);
        divTagForName.appendChild(nameTextDiv);
        _formatContent.appendChild(divTagForName);

        var divTagForUrl = document.createElement('div');
        divTagForUrl.className = "formats-arch";
        var urlLabelDiv = document.createElement('div');
        urlLabelDiv.innerText = SystemsSafetyNLS.url;
        urlLabelDiv.style.width = '20%';
        divTagForUrl.appendChild(urlLabelDiv);
        var urlFieldDiv = document.createElement('div');
        urlFieldDiv.style.width = '80%';
        this.urlTextBox = new Text({
            placeholder: SystemsSafetyNLS.urlPlaceholder
        });
        this.urlTextBox.inject(urlFieldDiv);
        divTagForUrl.appendChild(urlFieldDiv);
        _formatContent.appendChild(divTagForUrl);
    };

    SystemsSafetyModal.prototype.getModalBody = function() {
        var partNumberContent = this.modal.elements.body;

        var _errorsMessageDiv = UWACore.createElement('div');
        _errorsMessageDiv.className = "enox-part-number-error-content";

        var _formatContent = UWACore.createElement('div');
        _formatContent.className = "enox-arch-number-content";

        var _dynamicFormatContent = UWACore.createElement('div');
        _dynamicFormatContent.className = "enox-arch-number-dynamic-content";

        this.getDefaultFields(_formatContent);

        partNumberContent.appendChild(_errorsMessageDiv);
        partNumberContent.appendChild(_formatContent);
        partNumberContent.appendChild(_dynamicFormatContent);
        return partNumberContent;
    };

    SystemsSafetyModal.prototype.displayAlertMessage = function(messageToDisplay, toDisplayOver) {
        var alert = new Alert({
            visible: true,
            className: 'param-alert',
            messageClassName: 'error',
            closable: true,
            renderTo: toDisplayOver,
            autoHide: true,
            hideDelay: 2000
        });
        alert.add({
            message: messageToDisplay
        });
    };

    SystemsSafetyModal.prototype.getUserEnteredValues = function() {
        return {
            name: this.nameTextBox.getValue() || '',
            url: this.urlTextBox.getValue() || ''
        };
    };

    SystemsSafetyModal.prototype.show = function() {
        this.modal.show();
    };

    SystemsSafetyModal.prototype._bindFooterEvent = function() {
        var that = this;

        this.modal.getFooter().getElements('.btn').forEach(function(element) {
            if (element.name === 'cancelButton') {
                element.addEvent('click', function() {
                    that.modal.hide();
                });
            }
        });

    };

    SystemsSafetyModal.prototype.getContent = function() {
        return this.modal.getContent();
    };

    SystemsSafetyModal.prototype.destroy = function() {
        this.modal.destroy();
        var keys = Object.keys(this);
        for (var i = 0; i < keys.length; i++) {
            this[keys[i]] = undefined;
        }
    };

    return SystemsSafetyModal;
});

define('DS/ParameterizationSkeleton/Views/\VersionNamingLog/VersionNamingLogAlertUtility', [
	'DS/UIKIT/Alert'
], 
function (Alert) {
	'use strict';
	return {
        errorAlert: null,
        successAlert: null,

        /**
         * Create an alert from UIKit
         *   @param {String} type
         *   @param {String} text
         */
        message: function (type, text) {
            if (type==='success') {
                if (!this.successAlert) {
                    this.successAlert = new Alert({
                        className : 'param-alert',
                        messageClassName: 'success',
                        visible: true,
                        autoHide : true,
                        hideDelay : 2500
                    }).inject(document.body, "top");
                }
                this.successAlert.add(text);
            }
            else {
                if (!this.errorAlert) {
                    this.errorAlert = new Alert({
                        className : 'param-alert',
                        messageClassName: 'error',
                        visible: true
                    }).inject(document.body, "top");
                }
                this.errorAlert.add(text);
            }
        },
    };
}
);

/*@fullReview  ZUR 15/11/23 2017x Param Skeleton*/
/*global define*/
define('DS/ParameterizationSkeleton/Model/ParameterizationDomainModel',
     [
        'UWA/Core',
        'UWA/Class/Model'
    ], function (UWA, Model) {
        "use strict";
        return Model.extend({
            defaults: function() {
                return {
                    id : '',
                    family : ''
                };
            }
        });
    });


/*global define*/
define('DS/ParameterizationSkeleton/Model/ParameterizationLifecycle/LifecycleListModel',
    [
        'UWA/Class/Model'
    ], function (Model) {
        "use strict";
        return Model.extend({
            defaults: function() {
                return {
                    title : '',
                    id: '',
                    subtitle : '',
                    date : '',
                    content : '',
                    image : '',
                    icon: '',
                    modifyTopology : true,
                    renameStates: true,
                    supportRules: true
                };
            }
        });
    });


/*global define*/
define('DS/ParameterizationSkeleton/Model/PPRSynchronizationLifeCycle/PPRSyncMBOMmodel',
    [
        'UWA/Core',
        'UWA/Class/Model'
    ], function (UWA, Model) {
        "use strict";
        return Model.extend({
            defaults: function() {
                return {
                    id: '',
                    title : '',
                    Type : '',
                    ComputedResultingProduct: '',
                    //SPEC_DOC commented asked by Paul IR926203
                   // SpecDoc: '',
                    ChildTransformationTypes:'',
                    NewRevision : '',
                    NewBranch : '',
                    Duplicate: '',
                    Deletion:'',
                    TransferOwnership: '',
                    ChangeMaturity:''
                };
            }
        });
    });

/**
 * @author AMN14
 */
define('DS/ParameterizationSkeleton/Model/ParamCollaboration/CollabManagementModel',
    [
        'UWA/Class/Model'
    ], function (Model) {
        "use strict";
        return Model.extend({
            defaults: function() {
                return {
                    id: '',
                    title : '',
                    subtitle : '',
                    domainid : '',
                    image : ''
                };
            }
        });
    });

define('DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/ParameterizationFLWebConstants', [], function() {

    'use strict';


    const contants = {
    		NEW_NOT_DEPLOYED : 'NewNotDeployed',
    		USER_DEFINED : 'UserDefined',
    		DEPOLOYED : 'Deployed',
    		ADD : 'add',
    		REMOVE : 'remove',
    		MODIFY : 'modify',
    		OPERATION : 'action',
    		ORDER : 'Order',
    		TYPE : 'Type',
    		NAME : 'Name',
    		VALUE : 'Value',
    		//ATTRIBUTE : 'AttributeName',
    		ATTRIBUTE : 'Attribute',
    		ATTRIBUTE_NLS_NAME : 'Attribute_NLS',
    		//COUNTER : 'CounterSize',
    		COUNTER : 'Size',
    		FORMULA_ROW : "FormulaRow",
    		FORMULA_CELL : "Formula",
    		STRATEGY_ROW : "StrategyRow",
    		BUSINESS_LOGIC : "BLDefined",
    		STRATEGY_CELL : "Strategy",
            /*FORMAT_FREE : 'Free',
            FORMAT_STRING :'String',
            FORMAT_ATTRIBUTE : 'Attribute',
            FORMAT_COUNTER : 'Counter',
            MAX_ROWS : 15,*/
    		FORMAT_FREE : 'UI',
            FORMAT_STRING :'FT',
            FORMAT_ATTRIBUTE : 'SA',
            FORMAT_COUNTER : 'CC',
            MAX_ROWS : 10,
            WIDTH_ARRAY: [15, 15, 15, 25, 15, 15]
           // WIDTH_ARRAY: [/*15,*/ 15, 15, 25, 15, 15]

    };

    return  Object.freeze(contants);

});

/*global define*/
define('DS/ParameterizationSkeleton/Model/ParamCollaboration/TypeMappingModel',
    [
        'UWA/Core',
        'UWA/Class/Model'
    ], function (UWA, Model) {
        "use strict";
        return Model.extend({
            defaults: function() {
                return {
                    id: '',
                    title : '',
                    vpmObject : '',
                    mxObject : '',
                    KindOfMapping : '',
                    SynchDirection : '',
                    isBaseMapping : '',
					deployedStatus : '',
                    path: '',
                    invalidStatus: '',
                    isInEdition: '',
                };
            }
        });
    });

define("DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/CollabSpace", ["require", "exports", "UWA/Class/Model"], function (require, exports, Model) {
    "use strict";
    var CollabSpaceModule;
    (function (CollabSpaceModule) {
        CollabSpaceModule.CollabSpace = Model.extend({
            getId: function () {
                return this.get('name');
            },
            getLabel: function () {
                return this.get('title');
            }
        });
    })(CollabSpaceModule || (CollabSpaceModule = {}));
    ;
    return CollabSpaceModule;
});

/*global define*/
define('DS/ParameterizationSkeleton/Model/ParamCollaboration/MappingModel',
    [
        'UWA/Core',
        'UWA/Class/Model'
    ], function (UWA, Model) {
        "use strict";
        return Model.extend({
            defaults: function() {
                return {
                    id: '',
                    title : '',
                    AttributeInfo : '',
                    TypeRelInfo : '',
                    InterfaceInfo : '',
                    TypeRelMapping : '',
                    InterfaceMapping : '',
                    AttributeMapping : '',
                };
            }
        });
    });

/**
 * Server
 */
define("DS/ParameterizationSkeleton/Utils/ParameterizationXCAD/AJAXUtil", [
  "DS/WAFData/WAFData"
], function (WAFData) {
  "use strict";

  var AJAXUtil = {
    Server: function (url, options) {
      return new Promise((resolve, reject) => {
        WAFData.authenticatedRequest(url, {
          timeout: options.timeout,
          method: options.method,
          data: options.data,
          headers: options.headers,

          onFailure: function (error, backendresponse, response_hdrs) {
            reject(error, backendresponse, response_hdrs);
          },
          onComplete: function (response) {
            resolve(response);
          }
        });
      });
    }
  };

  return AJAXUtil;
});

//@fullReview  ZUR 16/02/13 2017x
/*global define, console*/
/*jslint plusplus: true*/
define('DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/ParamStepGeometry',
    [
        'egraph/core',
        'egraph/views',
        'egraph/utils'
    ],
    function(core, views, utils) {
        'use strict';

        var exports = {};

        function sign(x) {
            return typeof x === 'number' ? x ? x < 0 ? -1 : 1 : x === x ? 0 : NaN : NaN;
        }

        exports.ParamStepGeometry = function(stubScenario) {
            if (!isNaN(stubScenario)) {
                this.stubScenario = stubScenario;
            }
        };

        //StepGeometry.prototype.stubScenario = 1;   //gphSymbol
        //utils.inherit(exports.gphSymbol, views.HTMLView);
        //ParameterizationLifecycleWidget/Views

        exports.ParamStepGeometry.prototype.onupdate = function onupdate(e) {
            var x1, x2, y1, y2, stubminlength, randomHeight, iStub, signp,
                iIntervals, isum, j,
                maxLimit = 1.5;
            console.log("Build scenario " + this.stubScenario);
            console.log(e);

            x1 = e.cl1.c.aleft;
            y1 = e.cl1.c.atop;
            x2 = e.cl2.c.aleft;
            y2 = e.cl2.c.atop;

            // xm = 0.5*(x1 + x2);  //    xm = 0.9*x1 + 0.1*x2;
            stubminlength = 45;//50;
            if (this.stubScenario === 1) {
                e.set('path', [
                    core.PathCmd.M, x1, y1,
                    core.PathCmd.L, x2, y2
                ]);
            } else {
                randomHeight = 30 * Math.random();
                iStub = this.stubScenario;

                if (e.randomHeight == null) {
                    e.randomHeight = randomHeight;
                } else {
                    randomHeight = e.randomHeight;
                }

                signp = sign(iStub);
                //maxLimit = 1.5;//2
                if (Math.abs(iStub) > maxLimit) {
                    iIntervals = (Math.abs(iStub) - maxLimit);
                    isum = maxLimit;

                    for (j = 1; j <= iIntervals; j++) {
                        isum = isum + 0.5 / j;
                    }

                    iStub = signp * isum;
                }

                e.set('path', [
                    core.PathCmd.M, x1 + 3, y1,
                    core.PathCmd.L, x1 + 3, y1 + randomHeight - iStub * stubminlength,
                    core.PathCmd.L, x2, y2 + randomHeight - iStub * stubminlength,
                    core.PathCmd.L, x2, y2
                ]);
            }
        };

        return exports;
    });

define('DS/ParameterizationSkeleton/Views/\VersionNamingExt/VersionNamingExtAlertUtility', [
	'DS/UIKIT/Alert'
], 
function (Alert) {
	'use strict';
	return {
        errorAlert: null,
        successAlert: null,

        /**
         * Create an alert from UIKit
         *   @param {String} type
         *   @param {String} text
         */
        message: function (type, text) {
            if (type==='success') {
                if (!this.successAlert) {
                    this.successAlert = new Alert({
                        className : 'param-alert',
                        messageClassName: 'success',
                        visible: true,
                        autoHide : true,
                        hideDelay : 2500
                    }).inject(document.body, "top");
                }
                this.successAlert.add(text);
            }
            else {
                if (!this.errorAlert) {
                    this.errorAlert = new Alert({
                        className : 'param-alert',
                        messageClassName: 'error',
                        visible: true
                    }).inject(document.body, "top");
                }
                this.errorAlert.add(text);
            }
        },
    };
}
);

define("DS/ParameterizationSkeleton/Views/ParameterizationPartSupply/ParameterizationPartSupplyViewTypes", ["require", "exports"], function (require, exports) {
    "use strict";
    var ParameterizationPartSupplyViewTypesModule;
    (function (ParameterizationPartSupplyViewTypesModule) {
        ;
    })(ParameterizationPartSupplyViewTypesModule || (ParameterizationPartSupplyViewTypesModule = {}));
    ;
    return ParameterizationPartSupplyViewTypesModule;
});

define('DS/ParameterizationSkeleton/Views/ParameterizationSystemsSafety/SystemsSafetyModalStructureTreePattern', [
    'DS/UIKIT/Modal',
    'UWA/Core',
    'DS/UIKIT/Input/Text',
    'DS/UIKIT/Alert',
    'DS/UIKIT/Autocomplete',

    'i18n!DS/ParameterizationSkeleton/assets/nls/SystemsSafetyNLS'
], function(
    Modal,
    UWACore,
    Text,
    Alert,
    Autocomplete,

    SystemsSafetyNLS
) {

    'use strict';

    var SystemsSafetyModal = function(options) {
        this.options = UWACore.extend({
            title: 'Dialog',
            className: '',
            withFooter: true
        }, options);

        this.modal = new Modal({
            className: this.options.className || '',
            closable: true,
            header: '<h4>' + this.options.title + '</h4>',
            body: '',
            footer: ''
        });
        this.modal.inject(document.querySelector('#systemsSafetyMainDiv'));
        if (this.options.withFooter) {
            this._bindFooterEvent();
        }
    };

    SystemsSafetyModal.prototype.getDefaultFields = function(_formatContent, plmTypes, excludeTypes) {
        this._allowedTypes = [];
        if (plmTypes) {
            for (var iType = 0; iType < plmTypes.length; ++iType) {
                var plmType = plmTypes[iType];
                if (excludeTypes.indexOf(plmType.Name) < 0) {
                    this._allowedTypes.push({
                        value: plmType.Name !== plmType.nLSValue ? plmType.nLSValue + ' (' + plmType.Name + ')' : plmType.nLSValue,
                        _plmType: plmType.Name
                    });
                }
            }
            this._allowedTypes.sort(function(typeA, typeB) {
                return (typeA.value.localeCompare(typeB.value));
            });
        }

        var divTagForType = document.createElement('div');
        divTagForType.className = "formats-arch";
        var typeLabelDiv = document.createElement('div');
        typeLabelDiv.innerText = SystemsSafetyNLS.type;
        typeLabelDiv.style.width = '15%';
        divTagForType.appendChild(typeLabelDiv);
        var typeTextDiv = document.createElement('div');
        typeTextDiv.style.width = '85%';
        if (this._allowedTypes.length) {
            this.typeTextBox = new Autocomplete({
                events: {
                    onSelect: function(item) {
                        this.patternTextBox.elements.input.placeholder = item.value.indexOf('Instance') > 0 ? SystemsSafetyNLS.instanceTypePatternPlaceholder : SystemsSafetyNLS.referenceTypePatternPlaceholder;
                    }.bind(this)
                },
                allowFreeInput: false
            });
            this.typeTextBox.addDataset({
                items: this._allowedTypes
            });
        } else {
            this.typeTextBox = new Text();
        }
        this.typeTextBox.inject(typeTextDiv);
        divTagForType.appendChild(typeTextDiv);
        _formatContent.appendChild(divTagForType);

        var divTagForPattern = document.createElement('div');
        divTagForPattern.className = "formats-arch";
        var patternLabelDiv = document.createElement('div');
        patternLabelDiv.innerText = SystemsSafetyNLS.pattern;
        patternLabelDiv.style.width = '15%';
        divTagForPattern.appendChild(patternLabelDiv);
        var patternFieldDiv = document.createElement('div');
        patternFieldDiv.style.width = '85%';
        this.patternTextBox = new Text({
            placeholder: SystemsSafetyNLS.referenceTypePatternPlaceholder
        });
        this.patternTextBox.inject(patternFieldDiv);
        divTagForPattern.appendChild(patternFieldDiv);
        _formatContent.appendChild(divTagForPattern);
    };

    SystemsSafetyModal.prototype.getModalBody = function(plmTypes, excludeTypes) {
        var partNumberContent = this.modal.elements.body;

        var _errorsMessageDiv = UWACore.createElement('div');
        _errorsMessageDiv.className = "enox-part-number-error-content";

        var _formatContent = UWACore.createElement('div');
        _formatContent.className = "enox-arch-number-content";

        var _dynamicFormatContent = UWACore.createElement('div');
        _dynamicFormatContent.className = "enox-arch-number-dynamic-content";

        this.getDefaultFields(_formatContent, plmTypes, excludeTypes);

        partNumberContent.appendChild(_errorsMessageDiv);
        partNumberContent.appendChild(_formatContent);
        partNumberContent.appendChild(_dynamicFormatContent);
        return partNumberContent;
    };

    SystemsSafetyModal.prototype.displayAlertMessage = function(messageToDisplay, toDisplayOver) {
        var alert = new Alert({
            visible: true,
            className: 'param-alert',
            messageClassName: 'error',
            closable: true,
            renderTo: toDisplayOver,
            autoHide: true,
            hideDelay: 2000
        });
        alert.add({
            message: messageToDisplay
        });
    };

    SystemsSafetyModal.prototype.getUserEnteredValues = function() {
        var typeItem = typeof this.typeTextBox.getItemByLabel === 'function' ? this.typeTextBox.getItemByLabel(this.typeTextBox.getValue()) : {
            value: this.typeTextBox.getValue(),
            _plmType: this.typeTextBox._plmType
        };
        return {
            typeLabel: typeItem.value || '',
            type: typeItem._plmType || '',
            pattern: this.patternTextBox.getValue() || ''
        };
    };

    SystemsSafetyModal.prototype.show = function() {
        this.modal.show();
    };

    SystemsSafetyModal.prototype._bindFooterEvent = function() {
        var that = this;

        this.modal.getFooter().getElements('.btn').forEach(function(element) {
            if (element.name === 'cancelButton') {
                element.addEvent('click', function() {
                    that.modal.hide();
                });
            }
        });

    };

    SystemsSafetyModal.prototype.getContent = function() {
        return this.modal.getContent();
    };

    SystemsSafetyModal.prototype.destroy = function() {
        this.modal.destroy();
        var keys = Object.keys(this);
        for (var i = 0; i < keys.length; i++) {
            this[keys[i]] = undefined;
        }
    };

    return SystemsSafetyModal;
});

define('DS/ParameterizationSkeleton/Views/ParameterizationDOCM/DOCMMappingViewUtilities',
		[
			'DS/UIKIT/Alert',
			'i18n!DS/ParameterizationSkeleton/assets/nls/DOCMContentMgmtNLS'
			],
			function (Alert, DOCMContentMgmtNLS) {

	'use strict';

	var docmViewUtilites = {

			getAlertMessage: function (message, className, toDisplayOn) {

				this.alertOptions = {
						visible: true,
						className: 'param-alert',
						messageClassName: className,
						closable: true,
						renderTo: toDisplayOn,
						autoHide: true,
						hideDelay: 2000
				};

				var alert = new Alert(this.alertOptions);
				alert.add({
					message: message,
				});
			},

			getValueFromHtmlElem: function (elementInfo) {
				return elementInfo.dsModel._properties.value.value;
			},
			getDefaultValues: function(){
				return {
                    DOCMDownloadRule  : 'OneFileOneDirectory',
                    EnforceWorkUnderForDocument: 'false',
					CommentAsMandatoryValue : 'false',
                };
			},
			defaultDocumentDownloadExpression: function(){
				return 'OneFileOneDirectory';
			},
			defaultWorkUnderUIEnableOption: function (){
				return "false";
			},
			defaultCommentAsMandatoryUIEnableOption: function (){
				return 'false';
			},
			validateExpression: function(expression , value ){
				if(expression == 'DOCMDownloadRule'){
					if(value == 'OneFileOneDirectory' || value == 'Flatlist'){
						return true;
					}
					else{
						return false;
					}
				}else if(expression == 'EnforceWorkUnderForDocument'){
					if(value.toLowerCase() == "true" || value.toLowerCase() == "false" ){
						return true;
					}
					else{
						return false;
					}
				}
				else if(expression == 'CommentAsMandatoryValue'){
					if(value == "true" || value == "false" ){
						return true;
					}
					else{
						return false;
					}
				}
			},
			convertStringToBool: function(str){
				if(str.toLowerCase() == 'true'){
					return true;
				}
				else if(str.toLowerCase() == 'false'){
					return false;
				}
				
				else{
					return str;
				}
			},
			convertStringToBoolString: function(str){
				if(str.toLowerCase() == 'true'){
					return 'true';
				}
				else if(str.toLowerCase() == 'false'){
					return 'false';
				}
				else{
					return str;
				}
			}
	};
	return docmViewUtilites;

});

/**
 * @author AMN14
 */

define('DS/ParameterizationSkeleton/Model/ParamCollaboration/TypesNotSyncMappingModel',
    [
        'UWA/Core',
        'UWA/Class/Model'
    ], function (UWA, Model) {
        "use strict";
        return Model.extend({
            defaults: function() {
                return {
                    id : '',
                    TNSMapping : '',
                    SpecializationTypes : ''
                };
            }
        });
    }
);



define(
    'DS/ParameterizationSkeleton/Utils/ParameterizationUnitsAndParameters/UnitsAndParametersParameterizationDataUtils',
    [
        'UWA/Core',
        'UWA/Class'

    ],
    function (UWA, Class) {

        'use strict';

        var UnitsAndParametersParameterizationDataUtils = Class.singleton({
            _listParameters: [],
            _auTreeListView: null,

            AddToParameterList: function (paramName) {
                var that = this;
                if (!that._listParameters.includes(paramName))
                    that._listParameters.push(paramName);
            },

            
            getParametersList: function () {
                var that = this;
                return that._listParameters;
            },

            getArbitraryUnitsList: function () {
                var that = this;
                var listArbitraryUnitObjs = [];
                if (that._auTreeListView != null && that._auTreeListView != undefined) {
                    var rowModelLength = that._auTreeListView.getRowModelLength();
                    if (rowModelLength) {
                        for (var rowIndex = 0; rowIndex < rowModelLength; rowIndex++) {
                            var dataObject = {};
                            if (that._auTreeListView.getNodeModelAtRowID(rowIndex) != null && that._auTreeListView.getNodeModelAtRowID(rowIndex) != undefined)
                                var nodeModel = that._auTreeListView.getNodeModelAtRowID(rowIndex);
                            if (nodeModel != null){
                                dataObject = nodeModel.getData();
                                listArbitraryUnitObjs.push(dataObject);
                            }
                        }
                    }
                }
                return listArbitraryUnitObjs;
            },

            SetArbitraryUnitsTreeListView(i_auTreeListView){
                var that = this;
                that._auTreeListView = i_auTreeListView;
            }
            
        });
        return UnitsAndParametersParameterizationDataUtils;
    }
);

/*global define*/
define('DS/ParameterizationSkeleton/Model/ParameterizationDOCM/ParameterizationDOCMModel',
    [
        'UWA/Class/Model'
    ], function (Model) {
        "use strict";
        return Model.extend({
            defaults: function() {
                return {
                    DOCMDownloadRule  : 'OneFileOneDirectory',
                    EnforceWorkUnderForDocument: "false",
                    CommentAsMandatoryValue : 'false'
                };
            },
            getDOCMDownloadRule: function () {
                return this.get('DOCMDownloadRule');
            },
            getEnforceWorkUnderForDocument: function () {
                return this.get('EnforceWorkUnderForDocument');
            },
            getCommentAsMandatoryValueForDocument: function () {
                return this.get('CommentAsMandatoryValue');
            },
            updateRule: function (attributeName,value){
                var options ={}
                options[attributeName] = value;
                this.set(options);
            }

        });
    });


define("DS/ParameterizationSkeleton/Utils/ParameterizationPartSupply/Utils", ["require", "exports", "UWA/Core"], function (require, exports, UWA) {
    "use strict";
    var Utils;
    (function (Utils_1) {
        var Utils = /** @class */ (function () {
            function Utils() {
            }
            Utils.clone = function (obj) {
                return Object.assign({}, obj);
            };
            Utils.extend = function (original, extended, recursive) {
                return UWA.extend(original, extended, recursive);
            };
            Utils.getLang = function () {
                return window.dsLang || 'en';
            };
            return Utils;
        }());
        Utils_1.Utils = Utils;
    })(Utils || (Utils = {}));
    ;
    return Utils;
});

/*@fullReview  ZUR 15/11/23 2017x Param Skeleton*/
/*global define*/
define('DS/ParameterizationSkeleton/Model/ParameterizationDomainsListModel',
    [
        'UWA/Core',
        'UWA/Class/Model'
    ], function (UWA, Model) {
        "use strict";
        return Model.extend({
            defaults: function() {
                return {
                    id  : '',
                    title : '',
                    subtitle : '',
                    tooltip : '',
                    domainid: '',
                    familyid: '',
                    image : ''
                };
            }
        });
    });



define(
    'DS/ParameterizationSkeleton/Utils/ParameterizationDEL3DWorkbook/ParameterizationDEL3DWorkbookAttributeUtils',
    ['UWA/Core',
    'UWA/Class'
    ],
    function(UWA, Class) {

        'use strict';

        var ParameterizationDEL3DWorkbookAttributeUtils = Class.singleton({

          _itemAttributes : {"DELFmiFunctionReference":{"attributes":["name","title","description","id","revision","state","type","created","modified","owner","organization","collabspace","cestamp","estimatedTime","isLotNumberRequired","isSerialNumberRequired","outsourced","planningRequired","estimatedCost","estimatedCostCurrency","estimatedLeadTimeDescription","estimatedWeight","manufacturedItemClassification","materialCategory","spareManufacturedItem","targetReleaseDate","depthOfFeature","diameterOfFeature","mfgFastenerStrategy","magnitude","refQuantity","essentiality","estimatedMTBF","estimatedMTBUR","estimatedMTTR","lifeLimit","repairable","replaceable","replacementType"]}},
          _processAttributes : {"DELLmiPPRSystemReference":{"attributes":["name","title","description","id","revision","state","type","created","modified","owner","organization","collabspace","cestamp","sequencingMode","cycleTime","totalProductionTime","capacity","flowModeIN","flowModeOUT","meanTimeBetweenFailure","meanTimeToRepair","operationMode","queuingModeIN","queuingModeOUT","arrivalMode","initialDelay","estimatedDistance","transferMode"]}},
          _operationAttributes : {"DELLmiOperationPPRReference":{"attributes":["name","title","description","id","revision","state","type","created","modified","owner","organization","collabspace","cestamp","sequencingMode","capacity","arrivalMode","initialDelay","quantityToBeProducedPerTime","isTimeProportionalToQty","interruptible","rollup","timeMode","estimatedTime","estimatedTime_AddedValueRatio","measuredTime","trackTime","preparationTime","preProcessingTime","postProcessingTime","executionTemplate","manageVariant","materialScrap","timePerFastening","fasteningRate","inputResources","occurrenceTime","occurrenceTimeMode","restart","stopingOnGoingOp","recorderLevel","lot","proportion"]}},
          _alertAttributes : {"DELWkiAlertReference":{"attributes":["name","title","description","id","revision","state","type","created","modified","owner","organization","collabspace","cestamp","text","showMode","trackComfirmation"]}},
          _dcPlanAttributes : {"DELWkiDataCollectPlanReference":{"attributes":["name","title","description","id","revision","state","type","created","modified","owner","organization","collabspace","cestamp"]}},
          _dcAttributes : {"DELWkiDataCollectReference":{"attributes":["name","title","description","id","revision","state","type","created","modified","owner","organization","collabspace","cestamp","text","label","sampleSize","dcType","hasMaxValuated","hasMinValuated","magnitude","maxValue","minValue","possibleValues","minIncluded","maxIncluded"]}},
          _instructionAttributes : {"DELWkiInstructionReference":{"attributes":["name","title","description","id","revision","state","type","created","modified","owner","organization","collabspace","cestamp","text"]}},
          _signOffAttributes : {"DELWkiSignOffReference":{"attributes":["name","title","description","id","revision","state","type","created","modified","owner","organization","collabspace","cestamp","text","actors","isPartialSignoffAllowed","isOptional"]}},
          _dcplanRowAttributes : {"PLMSpecifyHowToCollectDataCnx":{"attributes":["id","type","dcType","created","modified","cestamp","text","label","mode","numberOfMeasurements","magnitude","maxValue","minValue","controlMaxValue","controlMinValue","nominalValue","possibleValues","minIncluded","maxIncluded","controlMinIncluded","controlMaxIncluded"]}},
          _resourceAttributes : {"Resource":{"attributes":["name","title","description","id","revision","state","type","created","modified","owner","organization","collabspace","cestamp","category","manufacturer","subType","calculatedCycleTime","consumableCost","cycleTime","energyCost","meanTimeToRepair","meanTimeBeforeFailure","maintenanceCost","purchaseCost","repairCost","setUpTime","setUpTimeReduced","targetCost","targetedCycleTime","gender","population","stature","weight","followupType","sequenceBackward","isFiniteCapacity","approachReach","controllerVersion","industrialApplications","kinematicClass","maxPayload","mountingMethod","nbDOFs","repeatability","robotmodelIDAliases"]}},
            getDefaultAttributes : function (type) {

              var that = this;

              if(type === "DELFmiFunctionReference"){
                return that._itemAttributes;
              }
              else if(type === "DELLmiPPRSystemReference"){
                return that._processAttributes;
              } else if(type === "DELLmiOperationPPRReference"){
                return that._operationAttributes;
              }else if(type === "DELWkiAlertReference"){
                return that._alertAttributes;
              }else if(type === "DELWkiDataCollectPlanReference"){
                return that._dcPlanAttributes;
              }else if(type === "DELWkiDataCollectReference"){
                return that._dcAttributes;
              }else if(type === "DELWkiInstructionReference"){
                return that._instructionAttributes;
              }else if(type === "DELWkiSignOffReference"){
                return that._signOffAttributes;
              }else if(type === "PLMSpecifyHowToCollectDataCnx"){
                return that._dcplanRowAttributes;
              }else if(type === "Resource"){
                return that._resourceAttributes;
              }
            }
        });
        return ParameterizationDEL3DWorkbookAttributeUtils;
    }
);

/*@fullReview  ZUR 15/11/23 2017x Param Skeleton*/
/*global define,console*/
/*jslint nomen: true*/
define('DS/ParameterizationSkeleton/Views/ParamItemsListView',
    [
        'DS/W3DXComponents/Views/Layout/GridScrollView',
        'DS/W3DXComponents/Views/Item/TileView',
        'DS/W3DXComponents/Views/Item/SetView',
        'css!DS/W3DXComponents/W3DXComponents'
    ], function(GridScrollView, ItemViewTile, ItemViewSet) {
        'use strict';
        var ItemsListView,
            _name = 'list';
        ItemsListView = ItemViewSet.extend({
            name : _name,
            defaultOptions : {
                contents : {
                    //defaultView: 'tile',
                    useInfiniteScroll : false,
                    usePullToRefresh : false,
                    selectionMode : 'oneToOne',
                    views : [ {
                        'id' : 'tile',
                        //'title' : 'Tile View',
                        'view' : GridScrollView,
                        'itemView' : ItemViewTile,
                        'scrollPosition' : 'center',
                        'layout' : {
                            column : 3
                        }
                    } ]
                }
            },



            /*destroy : function() {
                this.childView.destroy();
                this.stopListening();
                this._parent.apply(this, arguments);
            }
            destroy : function() {
                this.stopListening();
                this._parent.apply(this, arguments);
            }*/

            destroy: function(options) {

                if (this.isDestroyed) {
                    return;
                }

                if (this.collection) {
                    this.stopListening(this.collection, this._externalEvents);
                }

                return this._parent.apply(this, arguments);
            },

            reload: function() {
                this.container.addClassName('loading');
                //  /!\ pour compenser l'absence de resetState dans la pageableCollection
                this.collection.state.totalRecords = null;
                //this.collection.reset();
                this.collection.getFirstPage();
            }
        });

        return ItemsListView;
    });

define('DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/SAXTileView',
    [
        'DS/W3DXComponents/Views/Layout/GridScrollView',
        'DS/W3DXComponents/Views/Item/TileView',
        'DS/W3DXComponents/Views/Item/SetView',
        'css!DS/W3DXComponents/W3DXComponents'
    ], function(GridScrollView, ItemViewTile, ItemViewSet) {
        'use strict';
        var ItemsListView, _name = 'list';
        ItemsListView = ItemViewSet.extend({
            name : _name,
            defaultOptions : {
                contents : {
                    //defaultView: 'tile',
                    useInfiniteScroll : false,
                    usePullToRefresh : false,
                    selectionMode : 'oneToOne',
                    views : [ {
                        'id' : 'tile',
                        //'title' : 'Tile View',
                        'view' : GridScrollView,
                        'itemView' : ItemViewTile,
                        'scrollPosition' : 'center',
                        'layout' : {
                            column : 2
                        }
                    } ]
                }
            },

            destroy: function(options) {
                if (this.isDestroyed) {
                    return;
                }
                if (this.collection) {
                    this.stopListening(this.collection, this._externalEvents);
                }
                return this._parent.apply(this, arguments);
            },

            reload: function() {
                this.container.addClassName('loading');
                this.collection.state.totalRecords = null;
                this.collection.getFirstPage();
            }
        });

        return ItemsListView;
    });

/**
 * @author AMN14
 */
define('DS/ParameterizationSkeleton/Model/ParameterizationXEN/ParamXENModel', [
    'UWA/Class/Model',
], (Model) => Model.extend({
    defaults() {
        return {
            id: '',
            title: '',
            subtitle: '',
            domainid: '',
            image: '',
            familyid: '',
        };
    },
}));

/**
 * @author AMN14
 */

define('DS/ParameterizationSkeleton/Collection/ParamCollaboration/TypesNotSyncMappingCollection', [
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Model/ParamCollaboration/TypesNotSyncMappingModel',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
], function (
		UWA,
		Model,
		Collection,
		TypesNotSyncMappingModel,
	    ParameterizationDataUtils,
	    WAFData,
	    URLHandler
	) {
	    'use strict';

	    var TNSMappingCollection = Collection.extend({

	    	/**
	    	 * Reference to the collection's model
	    	 */
	        model : TypesNotSyncMappingModel,

	        /**
	         * Initializing collection's URL
	         */
	        setup : function(model, options) {
	            UWA.log('TypesNotSyncMappingCollection::setup');
	            UWA.log(model);
	            UWA.log(options);

	            this.url = URLHandler.getURL() + "/resources/MappingWS/mapping/tnsmappinginfo?tenant=" + URLHandler.getTenant();
	        },

	        /**
	         *
	         */
	        sync : function(method, model, options) {
	            UWA.log('TypesNotSyncMappingCollection::sync');

	            options.contentType = 'application/json';
	            options.lang = widget.lang;
	            options.headers = {
	                Accept: 'application/json',
	                'Content-Type': 'application/json',
	                'Accept-Language' : widget.lang
	            };

	            UWA.log(options);

	            options = Object.assign({
	                ajax: WAFData.authenticatedRequest
	            }, options);

	            this._parent.apply(this, [method, model, options]);
	        },

	        /**
	         * Converting HTTP request response into an array of TypesNotSyncMappingModel objects
	         */
	        parse : function(data) {
	            UWA.log("TypesNotSyncMappingCollection::parse");
	            UWA.log(data);

              var TNSModel = ParameterizationDataUtils.paramStructBuilder("id, TNSMapping, SpecializationTypes");
              var oData = new TNSModel("", "");

              oData.id = data.id;
              oData.TNSMapping = [];
              oData.SpecializationTypes = [];

              // retrieving TNS mapping
              if(Array.isArray(data.typesNotSyncMapping)){
                data.typesNotSyncMapping.forEach(function(tnsMappingValue){
                  oData.TNSMapping.push(tnsMappingValue);
                });
              }

              // retrieving Part specialization types
              // convert the list of specialization types into a tree view showing types hierarchy
              if(Array.isArray(data.partSpecializationTypes)){
                oData.SpecializationTypes['Part'] = this.listToTreeView(data.partSpecializationTypes);
                this.eludeAbstractTypes(oData.SpecializationTypes['Part']);
              }

              // retrieving VPMReference specialization types
              // convert the list of specialization types into a tree view showing types hierarchy
              if(Array.isArray(data.vpmRefSpecializationTypes)){
                oData.SpecializationTypes['VPMReference'] = this.listToTreeView(data.vpmRefSpecializationTypes);
                this.eludeAbstractTypes(oData.SpecializationTypes['VPMReference']);
              }

	            return oData;
	        },

          /**
           * Convert a list of specialization types to a tree view representing types hierarchy.
           * @param specializationTypesList The list containing related types.
           */
          listToTreeView : function(specializationTypesList){
            UWA.log("TypesNotSyncMappingCollection::listToTreeView");

            //not supported on ie
            //var rootType = specializationTypesList.find(function(type){return !type.hasOwnProperty('derivationPath')});
            var rootType = null;
            // var i=1;
            // while(rootType===undefined && i<=specializationTypesList.length)
            // {
            // 	var type=specializationTypesList[i];
            // 	if(!type.hasOwnProperty('derivationPath'))
            // 		rootType=type;
            // 	i++;
            // }

            for(var i = 0 ; i < specializationTypesList.length ; i++){
              if(!specializationTypesList[i].derivationPath){
                rootType = specializationTypesList[i];
                break;
              }
            }

            var tree = {
              typeInfo : rootType,
              specializationTypes : {}
            };

            specializationTypesList.forEach(function(type){
              if(type.derivationPath){
                var parentTypes = type.derivationPath.split('/');
                if(parentTypes.length === 1) {
                  tree.specializationTypes[type.id] = {typeInfo : type, specializationTypes : {}, parentNode : tree};
                  return;
                }
                var currentNode = tree;
                for(var i = parentTypes.length - 2 ; i >= 0 ; i--){
                  if(typeof currentNode.specializationTypes[parentTypes[i]] === 'undefined') currentNode.specializationTypes[parentTypes[i]] = {typeInfo : null, specializationTypes : {}, parentNode : currentNode };
                  currentNode = currentNode.specializationTypes[parentTypes[i]];
                }
                currentNode.specializationTypes[type.id] = {typeInfo : type, specializationTypes : {}, parentNode : currentNode};
              }
            });

            return tree;
          },

          /**
            * Modify the tree representing the sub types arborescence to remove abstract types (so types which can't be mapped).
            * @param root The root node of the tree which is wanted to be modified.
            */
          eludeAbstractTypes : function(root, lastMappableParent){
            UWA.log("TypesNotSyncMappingCollection::eludeAbstractTypes");

            if(typeof lastMappableParent === 'undefined') lastMappableParent = root;
            else if(root.parentNode !== lastMappableParent) root.parentNode = lastMappableParent;
            for(var typeName in root.specializationTypes){
              // abstract types are corresponding to nodes which don't have a complete set of data to describe the type .
              if(root.typeInfo !== null){
                this.eludeAbstractTypes(root.specializationTypes[typeName], root);
              } else this.eludeAbstractTypes(root.specializationTypes[typeName], lastMappableParent);

            }
          }

	    });

	    return TNSMappingCollection;
	}
);

/**
 * ParameterizationSustainabilityCollection
 * 5/10/2023 - kkr15 - created
 */
define('DS/ParameterizationSkeleton/Collection/ParameterizationSustainabilityCollection', [
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
], function (UWA, Model, Collection, WAFData, URLHandler) {
    'use strict';

   var handledDomain = null;
    return Collection.extend({
        model: function (modelid) {
            return Model.extend();
        },

        setup: function (models, options) {
            UWA.log('ParameterizationSustainabilityCollection::setup');

            UWA.log(models);
            UWA.log(options);
           
            var _modelKey = options._modelKey;
            var domainID = _modelKey._attributes.domainid;

            if (UWA.is(this.model, "function")) {
                this.model = this.model(domainID);               
            }
            handledDomain = domainID;
            
            this.url = URLHandler.getURL() +
                "/resources/kpiparam/getSustanabilityEvolutionPageConfig?tenant=" + URLHandler.getTenant();
        },

        sync: function (method, model, options) {
            UWA.log('ParameterizationSustainabilityCollection::sync');
            options.contentType = 'text/plain';
            options.lang = widget.lang;

            options.headers = {
                'Content-Type': 'application/json',
                'Accept': 'application/json',
                'Accept-Language': widget.lang
            };

            UWA.log(options);

            options = Object.assign({
                ajax: WAFData.authenticatedRequest
            }, options);
            this._parent.apply(this, [method, model, options]);
        },

        parse: function (data) {
		UWA.log("ParameterizationSustainabilityCollection::parse");
            UWA.log(data);

            return this.parseMappingData(data);
        },

        create: function (attributes, options) {
            options.proxy = 'passport';
            this._parent.apply(this, [attributes, options]);
        },

        parseMappingData: function (data) {
            return data;
        }

    });
});


/*@fullReview  NZV 2022/05/10 FUN124183 */
/*global define, widget, document, setTimeout, console, clearTimeout, FileReader*/
/*jslint plusplus: true*/
/*jslint nomen: true*/
define('DS/ParameterizationSkeleton/Views/ParametersErrorView',
    [
        'UWA/Core',
        'UWA/Class/View',
        'DS/UIKIT/Modal',
        'DS/UIKIT/Mask',
        'DS/UIKIT/Scroller',
        'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
        'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
        'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS'
    ],
    function (UWA, View,
              Modal,
              Mask, Scroller,
              ParameterizationDataUtils,
              ParamLayoutUtilities,
              ParamSkeletonNLS) {

        'use strict';

        var extendedView;

        extendedView = View.extend({
            tagName: 'div',
            className: 'generic-detail',

            init: function (options) {
                UWA.log('ParametersErrorView::init');
                UWA.log(options);
                var initDate =  new Date(),
                    ConnectStruct = ParameterizationDataUtils.paramStructBuilder("domainName,tenantID,env_url");

                options = UWA.clone(options || {}, false);

                this._parent(options);

            },

            setup: function(options) {
                UWA.log('ParametersErrorView::setup!');
                UWA.log(options);
            },

            render: function () {
                UWA.log("ParametersErrorView::render");
                var introDiv,
                    that = this,
                    activateApply = false;

                this.contentDiv =  UWA.createElement('div', {
                    'id': 'mainParamDiv'
                });

                Mask.mask(this.contentDiv);

                this.container.setContent(this.contentDiv);
                  ParamLayoutUtilities.createParamMask(this.contentDiv, ParamSkeletonNLS.PageOnlyForBaselineEnv);
                //  UWA.log('unmask');
                  Mask.unmask(this.contentDiv);
                return this;
            },




            onKeyDownTextField : function (event) {

                UWA.log(event);
            },


            //show: function () {},
            destroy : function() {
                this.stopListening();
                this._parent.apply(this, arguments);
            }

        });

        return extendedView;
    });

/* @fullReview  SSV1 19/06/13  FUN090928 : SSV1 Engineering Definition configuration UI */
/* global define, widget, document, setTimeout, console */
/* jslint nomen: true */
define('DS/ParameterizationSkeleton/Collection/ParameterizationXEngineeringCollection', [
    // UWA
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
    'DS/ParameterizationSkeleton/Model/ParameterizationXEN/ParamXENModel',
    'WebappsUtils/WebappsUtils',
    'i18n!DS/ParameterizationSkeleton/assets/nls/XEngineeringNLS',
], (
    UWA,
    Model,
    Collection,
    WAFData,
    URLHandler,
    ParamXENModel,
    WebappsUtils,
    XEngineeringNLS,
) => Collection.extend({

    model: ParamXENModel,

    setup(models, options) {
        UWA.log('ParameterizationXEngineering::setup');

        UWA.log(models);
        UWA.log(options);

        const { _modelKey } = options;
        const domainID = _modelKey._attributes.domainid;
        const familyID = _modelKey._attributes.familyid;

        this.url = WebappsUtils.getWebappsAssetUrl('ParameterizationSkeleton', 'ParamXEN_Entries.json');
    },

    sync(method, model, options) {
        UWA.log('ParameterizationXEngineering::sync');
        options.contentType = 'application/json';
        options.lang = widget.lang;

        options.headers = {
            Accept: 'application/json',
            'Content-Type': 'application/json',
            'Accept-Language': widget.lang,
        };

        UWA.log(options);

        options = { ajax: WAFData.authenticatedRequest, ...options };
        this._parent.apply(this, [method, model, options]);
    },

    parse(data) {
        UWA.log('ParameterizationXEngineering::parse');
        UWA.log(data);

        const XEN_Entries = [];

        if (Array.isArray(data)) {
            data.forEach((XEN_Entry) => {
                const title = XEngineeringNLS[`${XEN_Entry.familyid}Text`];
                const tooltip = XEngineeringNLS[`${XEN_Entry.familyid}Tooltip`];

                XEN_Entries.push({
                    title,
                    subtitle: tooltip,
                    image: `${URLHandler.getURL()}/webapps/ParameterizationSkeleton/assets/img/${XEN_Entry.image}`,
                    id: XEN_Entry.domainid + XEN_Entry.familyid,
                    familyid: XEN_Entry.familyid,
                    domainid: XEN_Entry.domainid,
                });
            });
        }

        return XEN_Entries;
    },

    create(attributes, options) {
        options.proxy = 'passport';
        this._parent.apply(this, [attributes, options]);
    },
}));

/*@fullReview  ZUR 15/11/23 2017x Param Widgetization NG*/
/*global define, widget, document, setTimeout, console*/
/*jslint nomen: true */
define('DS/ParameterizationSkeleton/Collection/ParameterizationDomainCollection', [
    // UWA
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Model/ParameterizationDomainModel',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
    'DS/WAFData/WAFData',
    'WebappsUtils/WebappsUtils'
], function (UWA, Model, Collection, ParameterizationDomainModel, ParamDataUtils, URLHandler, WAFData, WebappsUtils) {
    'use strict';
    //
    return Collection.extend({
        model : ParameterizationDomainModel,
        setup: function (models, options) {
            console.log("ParameterizationDomainModel::setup::");
            var iURL,
                _modelKey = options._modelKey,
                domainID = _modelKey._attributes.domainid,
                familyID = _modelKey._attributes.familyid;

            iURL = URLHandler.getURL() + "/resources/ParamWS/access/DomainElements?tenant=" + URLHandler.getTenant() + "&domainid=" + domainID;

            if ((familyID !== null) && (familyID !== "")) {
                iURL = iURL + "&familyid=" + familyID;
            }
            UWA.log(iURL);
            this.url = iURL;
            /*if (domainID === "Deployment")
                this.url= "_Blank";//a tester si besoin
            */
        },

        /*sync : function(method, model, options) {
            UWA.log("ParameterizationDomainModel::sync");
            options.contentType = 'application/json';//application/ds-json
            options.proxy = 'passport';
            options.lang = widget.lang;
            options.type = 'json';

            options.headers = {
                 Accept: 'application/json',
                 'Content-Type': 'application/json'
            };          
            UWA.log(options);
            this._parent.apply(this, [method, model, options]);
        },*/

        sync : function(method, model, options) {
            UWA.log("ParameterizationDomainCollection::sync");
           // options.contentType = 'application/json';
            //options.proxy = 'passport';
            options.lang = widget.lang;
            options.type = 'json';

            options.headers = {
                 Accept: 'application/json',
                // 'Content-Type': 'application/json'
            };       

            options = Object.assign({
                ajax: WAFData.authenticatedRequest
            }, options);   

            this._parent.apply(this, [method, model, options]);
        },


          //options.Accept = 'application/json';
            //Content-Type:application/json

        parse: function (data) {
            UWA.log("ParameterizationDomainModel::parse");
            UWA.log(data);
            var familyModel = ParamDataUtils.paramStructBuilder("id,family"),
                oData = new familyModel("", ""),
                Families = [];

            if (Array.isArray(data.family)) {
                data.family.forEach(function (rElement) {
                    Families.push(rElement);
                });
            }

            //oData.id = "TESTID";
            oData.id = data.id;
            oData.family = Families;

            return oData;

            /*id: "EngineeringCentral"
                    nlsKey: "Engineering"
                    packaging: null
                    regSuite: null
                    solution: ""
                    tooltipNlsKey: "Engineering"*/
        },

        create: function(attributes, options) {
            options.proxy = 'passport';
            this._parent.apply(this, [attributes, options]);
        }

    });
});

/**
 * @author AMN14
 */
define('DS/ParameterizationSkeleton/Collection/ParameterizationSAX/ParamSAXFormulaListCollection', [
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
    'DS/ParameterizationSkeleton/Model/ParameterizationSAX/ParamSAXModel',
    'i18n!DS/ParameterizationSkeleton/assets/nls/FLWebNLS',
    'DS/WAFData/WAFData',
    'WebappsUtils/WebappsUtils'
], function ( UWA,
              Model,
              Collection,
              ParamDataUtils,
              URLHandler,
              ParamSAXModel,
               FLWebNLS,
              WAFData,
              WebappsUtils
            ) {
              'use strict';


              var collabManagementCollection = Collection.extend({

                  model : ParamSAXModel,

                  setup : function (models, options) {
                      UWA.log('SAXCollection::setup');
                      UWA.log(options);
                      this.childCollection = null;
                      var _modelKey = options._modelKey,
                          domainID = _modelKey._attributes.domainid,
                          familyID = _modelKey._attributes.familyid;
                      this.url = URLHandler.getURL() + "/resources/ParamWS/access/DomainElements?tenant=" + URLHandler.getTenant() + "&domainid=SystemsArchitectureDefinitionOtbParameter&familyid="+familyID;
                    //  this.url = WebappsUtils.getWebappsAssetUrl('ParameterizationSkeleton', 'ParamSAX_Entries.json');
                  },


                  sync : function(method, model, options) {
                      UWA.log("SAXCollection::sync");

                      options.headers = {
                          Accept: 'application/json',
                          'Accept-Language' : widget.lang
                      };

                      options = Object.assign({
                          ajax: WAFData.authenticatedRequest
                      }, options);

                      this._parent.apply(this, [method, model, options]);
                  },


                  parse: function (data) {
                      UWA.log("SAXCollection::parse");
                      UWA.log(data);
                      const familyDetails = data;
                      // var SAX_Entries = [];
                      //
                      // if(Array.isArray(data)) {
                      //
                      //   data.forEach(function(SAX_Entry) {
                      //     var title = FLWebNLS[SAX_Entry.familyid + "Text"];
                      //     var tooltip = FLWebNLS[SAX_Entry.familyid + "Tooltip"];
                      //
                      //     SAX_Entries.push({
                      //       title              : title,
                      //       subtitle           : tooltip,
                      //       image              : URLHandler.getURL() + "/webapps/ParameterizationSkeleton/assets/img/" + SAX_Entry.image,
                      //       id                 : SAX_Entry.domainid + SAX_Entry.familyid,
                      //       familyid           : SAX_Entry.familyid,
                      //       domainid           : SAX_Entry.domainid
                      //     });
                      //   });
                      // }

                      return familyDetails;
                  },

                  create : function(attributes, options) {
                      options.proxy = 'passport';
                      this._parent.apply(this, [attributes, options]);
                  }

              }
            );

            return collabManagementCollection;
          }
);

define('DS/ParameterizationSkeleton/Collection/ParameterizationDisplayProperties/ParamDPNlsValuesCollection', [
    'UWA/Core',
    'UWA/Class/Collection',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
    'DS/ParameterizationSkeleton/Model/ParameterizationDomainsListModel',
], (
    UWA,
    Collection,
    WAFData,
    URLHandler,
    ParameterizationDomainsListModel,
) => {
    //
    let handledDomain = null;

    return Collection.extend({
        model: ParameterizationDomainsListModel,

        setup(models, options) {
            UWA.log('ParamDPNlsValuesCollection::setup');

            UWA.log(models);
            UWA.log(options);

            console.log('ParamDPNlsValuesCollection::setup, Sucessful');
            let iURL; let iObjID;
            const { _modelKey } = options;
            const domainID = _modelKey._attributes.domainid;
            const familyID = _modelKey._attributes.familyid;

            if (UWA.is(this.model, 'function')) {
                this.model = this.model(domainID);
                handledDomain = domainID;
            }

            iObjID = _modelKey._attributes.id;
            
            this.url = `${URLHandler.getURL()}/resources/v1/UXPropertiesParameterization/getParameters?tenant=${URLHandler.getTenant()}`+"&paramID="+"NLSValuesTypesAndAttriutesParam";
            
        },

        sync(method, model, options) {
            UWA.log('ParamDPNlsValuesCollection::sync');
            options.contentType = 'application/json';
            options.lang = widget.lang;

            options.headers = {
                Accept: 'application/json',
                'Content-Type': 'application/json',
                'Accept-Language': widget.lang,
            };

            UWA.log(options);

            options = { ajax: WAFData.authenticatedRequest, ...options };
            this._parent.apply(this, [method, model, options]);
        },

        parse(data) {
            UWA.log('ParamDPNlsValuesCollection::parse');
            UWA.log(data);

            return data;
        },

        create(attributes, options) {
            options.proxy = 'passport';
            this._parent.apply(this, [attributes, options]);
        }

    });
});


define('DS/ParameterizationSkeleton/Views/ParameterizationReconciliationReport/ReconciliationReportLayoutView',
	[
	'UWA/Core'
	,'UWA/Class/View'
	,"DS/UIKIT/Input/Button"
	,"DS/Controls/Toggle"
	,"DS/UIKIT/Scroller"
	,'DS/UIKIT/Mask'
	,'DS/WAFData/WAFData'
	,'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
	,'i18n!DS/ParameterizationSkeleton/assets/nls/ReconciliationReportNLS'
],
	function (
		UWA
		,View
		,Button
		,WUXToggle
		,Scroller
		,Mask
		,WAFData
		,URLHandler
		,ReconciliationReportNLS
	) {

	'use strict';

	let extendedView, cellArray;

	extendedView = View.extend({
		tagName: 'div',
		className: 'generic-detail',

		init: function (options) {
			UWA.log('ReconciliationReport Layout::init');
			options = UWA.clone(options || {}, false);
			this._parent(options);

			this.options = options;
			this.contentDiv = null;
		},

		setup: function (options) {
			UWA.log('ReconciliationReport Layout::setup!');
			UWA.log(options);
		},

		render: function () {
			UWA.log("ReconciliationReport LayoutView::render");
			let introDiv,
				that = this;

			this.contentDiv = UWA.createElement('div', {
				'id': 'titleMainDiv'
			});

			introDiv = UWA.createElement('div', {
			}).inject(this.contentDiv);

			UWA.createElement('p', {
				text: ReconciliationReportNLS.title,
				'class': 'lead'
			}).inject(introDiv);

			let reportTable = UWA.createElement('table', {
				'class': 'information'
			}).inject(this.contentDiv);

			let  reportBody = UWA.createElement('tbody', {
				'class': 'information', 'width': '100%'
			}).inject(reportTable);

			this.cellArray = [
				{ Label : ReconciliationReportNLS.statusTag },
				{ Label : ReconciliationReportNLS.startDateTag },
				{ Label : ReconciliationReportNLS.estimatedDateTag },
				{ Label : ReconciliationReportNLS.processedObjectTag },
				{ Label : ReconciliationReportNLS.currentOpTag },
				{ Label : ReconciliationReportNLS.totalOpTag },
				{ Label : ReconciliationReportNLS.durationTag }
			];

			for (let cellIdx = 0; cellIdx < this.cellArray.length; cellIdx++) {
				this.buildReportLine(this.cellArray[cellIdx]).inject(reportBody);
			}

			this.container.setContent(this.contentDiv);

			let datatoSend = JSON.parse("{\"batch\":\"CCM\"}");
			let securityContextWidget;

			const urlSecurityContext = URLHandler.getURL() + "/resources/pno/person/getsecuritycontext?tenant=" + URLHandler.getTenant();
			const url = URLHandler.getURL() + "/resources/batchReport/execute?tenant=" + URLHandler.getTenant();

			if (!this.thisisatest) {
				console.log("Get security context:");
				WAFData.authenticatedRequest(urlSecurityContext, {
					timeout: 250000,
					method: 'GET',
					data: "",
					type: 'json',
					headers: {
						'Content-Type': 'application/json',
						'Accept': 'application/json'
					},
					onFailure: function (json) {
						UWA.log('ReconciliationReport LayoutView::getContext - Failure');
						UWA.log(json);
						console.log(json);
					},
					onComplete: function (securityContext) {
						securityContextWidget = securityContext.SecurityContext;

						WAFData.authenticatedRequest(url, {
							timeout: 250000,
							method: 'POST',
							data: JSON.stringify(datatoSend),
							type: 'json',
							headers: {
								'Content-Type': 'application/json',
								'Accept': 'application/json',
								'SecurityContext': securityContext.SecurityContext,
							},
							onFailure: function (result) {
								UWA.log('ReconciliationReport LayoutView::getReport - Failure');
								UWA.log(result);
							},
							onComplete: function (result) {
								UWA.log('ReconciliationReport LayoutView::getReport - Success');
								UWA.log(result);
								that.refreshPage(result);
							}
						});
					}
				});

				let refreshButton = new Button({
					id: "refreshButton_",
					className: "primary",
					value: "Refresh report",
					icon: 'refresh'
				})
					.inject(this.contentDiv);
				refreshButton.elements.container.style.marginTop = "5px";
				refreshButton.addEvent('onClick', function () {
					WAFData.authenticatedRequest(url, {
						timeout: 250000,
						method: 'POST',
						data: JSON.stringify(datatoSend),
						type: 'json',
						headers: {
							'Content-Type': 'application/json',
							'Accept': 'application/json',
							'SecurityContext': securityContextWidget,
						},
						onFailure: function (result) {
							UWA.log('ReconciliationReport LayoutView::getReport - Failure');
							UWA.log(result);
						},
						onComplete: function (result) {
							UWA.log('ReconciliationReport LayoutView::getReport - Success');
							UWA.log(result);
							that.refreshPage(result);
						}
					});
				});
			}
			return this;
		},
		buildReportLine : function (cellElement) {
			let lineParam = UWA.createElement('tr', {title: ''});

			let label = UWA.createElement('td', {
				'width': '40%', 'align': 'left',
				'title': cellElement.Label
			}).inject(lineParam);

			UWA.createElement('p', {
				text: cellElement.Label//'uwa-input'//'width':'100%'
			}).inject(label);

			cellElement.id = UWA.createElement('td',
				{'width': '60%', 'align': 'right' }).inject(lineParam);

			return lineParam;
		},
		applyParams: function () {
			let that = this;
			let payloadToSend = "";
			Mask.mask(this.contentDiv);
		},
		resetParams: function () {
			let that = this;
			let payloadToSend = "";
			Mask.mask(this.contentDiv);
		},
		refreshPage: function (response) {
			UWA.log("ReconciliationReport LayoutView::refreshPage");
			UWA.log(JSON.stringify(response));

			let json = response.result;
			if(json.length>0) {
				for (let idx = 0; idx < json.length; idx++) {
					let value = json[idx].value;
					if (value.length > 0) {
						if (this.cellArray[idx].id.isInjected())
							this.cellArray[idx].id.empty();
						UWA.createElement('p', {
							text: value
						}).inject(this.cellArray[idx].id);
					}
				}
			}

			UWA.log("ReconciliationReport LayoutView::!refreshPage");
		}
	});

	return extendedView;
});

/*@fullReview  SSV1 19/06/13  FUN090928 : SSV1 Engineering Definition configuration UI*/
/*global define, widget, document, setTimeout, console*/
/*jslint nomen: true */
define('DS/ParameterizationSkeleton/Collection/ParameterizationSAX/ParamSAXFormulaCollection', [
    // UWA
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
], function (UWA, Model, Collection, ParameterizationDataUtils, WAFData, URLHandler) {
    'use strict';
    //

    var handledDomain = null;
	var _securityContext = null;
    return Collection.extend({
        model : function (modelid) {
           return Model.extend();
        },

        setup: function (models, options) {
            UWA.log('ParameterizationFLWeb::setup');
            UWA.log(models);
            UWA.log(options);
            var iURL, iObjID,
                _modelKey = options._modelKey,
                domainID = _modelKey._attributes.domainid,
                familyID = _modelKey._attributes.familyid;

            if (UWA.is(this.model, "function")) {
                this.model = this.model(domainID);
                handledDomain = domainID;
            }

            iObjID = _modelKey._attributes.id;
            this.url = URLHandler.getURL() +
              "/resources/v1/SystemsArchitectureDefinitionParam/getParamArchitectureNumberExpressions?tenant=" + URLHandler.getTenant();
        },

        sync : function(method, model, options) {
            UWA.log('ParameterizationFLWeb::sync');
            options.contentType = 'application/json';
            options.lang = widget.lang;

            options.headers = {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                'Accept-Language' : widget.lang
            };
            UWA.log(options);

            options = Object.assign({
                ajax: WAFData.authenticatedRequest
            }, options);
            this._parent.apply(this, [method, model, options]);
        },

        parse: function (data) {
            UWA.log("ParameterizationFLWeb::parse");
            UWA.log(data);
            return this.parseMappingData(data);
        },

        create: function(attributes, options) {
            options.proxy = 'passport';
            this._parent.apply(this, [attributes, options]);
        },

        parseMappingData: function (data) {
    			var parsedData = {};
    			var paramData = data.ParameterExpressionList;
    			var attributes = data.Attribues;
          if(paramData){
    				parsedData.ExpressionList = paramData;
    	    	parsedData.ExpressionList.sort(function(a, b){
    	    	if(a.Order && b.Order){
    	    	    return a.Order - b.Order;
	    			}
	    		});
    			parsedData.ExpressionList.forEach(function(entry){
    					entry.Deployed = 'True';
    					entry.Label = entry.Name;
    				});
          }
    			if(attributes) {
    				parsedData.PhysicalProductAttributes = attributes;
    			}
    			parsedData.UnicityCheck = data.UnicityCheck;
    			return parsedData;
        },

		/**
         * Function will retrieve the security context
         * @returns {function} calls back the promise resolve method with the security context fetched from service
         */
   //     retrieveSecurityContext: function(){
   //         var that = this;
   //         return new Promise(function (resolve, reject) {
   //             WAFData.authenticatedRequest(URLHandler.getURL() + '/resources/pno/person/getsecuritycontext', {
   //                 method: 'GET',
   //                 type: 'json',
   //                 headers : {
   //                     Accept: 'application/json',
   //                     'Content-Type': 'application/json'
   //                 },
   //                 onComplete:function(resp){
   //					_securityContext = resp.SecurityContext;
   //                     //that._securityContext = resp.SecurityContext;
   //                     resolve('Done');
   //                 },
   //                 onFailure : reject,
   //                 onTimeout: reject
   //             });
   //         });
   //     }

    });
});

define('DS/ParameterizationSkeleton/Collection/SpecificationManagementCollection', [
    // UWA
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
], function (UWA, Model, Collection, ParameterizationDataUtils, WAFData, URLHandler) {
    'use strict';

    var handledDomain = null;

    return Collection.extend({
        model : function (modelid) {
             return Model.extend();
        },

        setup: function (models, options) {
            UWA.log('SpecificationManagement::setup');

            UWA.log(models);
            UWA.log(options);

            console.log("SpecificationManagement::setup, Sucessful");
            var iURL, iObjID,
                _modelKey = options._modelKey,
                domainID = _modelKey._attributes.domainid,
                familyID = _modelKey._attributes.familyid;

            if (UWA.is(this.model, "function")) {
                this.model = this.model(domainID);
                handledDomain = domainID;
            }

                iObjID = _modelKey._attributes.id;
         },

        sync : function(method, model, options) {
            UWA.log('SpecificationManagement::sync');
            options.contentType = 'application/json';
            options.lang = widget.lang;

            options.headers = {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                'Accept-Language' : widget.lang
            };

            UWA.log(options);

            options = Object.assign({
                ajax: WAFData.authenticatedRequest
            }, options);  
            this._parent.apply(this, [method, model, options]);
        },

        parse: function (data) {
            UWA.log("SpecificationManagement::parse");
            UWA.log(data);

            return this.parseMappingData(data);
           
        },

        create: function(attributes, options) {
            options.proxy = 'passport';
            this._parent.apply(this, [attributes, options]);
        },

    

        parseMappingData: function (data) {
        	if(data.ExpressionList){
	    		data.ExpressionList.sort(function(a, b){
	    			if(a.Order && b.Order){
	    				return a.Order - b.Order;
	    			}
	    		});
        	}
        	
            return data;
        }

    });
    });



/*global define, widget*/
/*jslint nomen: true*/
define('DS/ParameterizationSkeleton/Collection/LifecycleDescriptionCollection', [
    // UWA
    'UWA/Core',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Model/ParameterizationLifecycle/LifecycleDescriptionModel',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
], function (UWA, Collection, LifecycleDescriptionModel, WAFData, URLHandler) {
    "use strict";
    return Collection.extend({
        model : LifecycleDescriptionModel,
        setup: function (models, options) {
            var ipolicyID = options._modelKey._attributes.id;
            this.url = URLHandler.getURL() + "/resources/ParamWS/lifecycle/extendeddescription?tenant=" + URLHandler.getTenant() + "&policy=" + ipolicyID;
        },

        sync : function(method, model, options) {
            UWA.log('LifecycleDescriptionCollection::sync');
            //options.contentType = 'application/json';//application/ds-json
            //options.proxy = 'passport';
            //options.lang = widget.lang;

            options.headers = {
                'Accept-Language' : widget.lang
            };//ZUR IR-454515-3DEXPERIENCER2017x

            UWA.log(options);

            options = Object.assign({
                ajax: WAFData.authenticatedRequest
            }, options);
            //console.log(model);
            //this.childCollection.sync(method, model, options);
            this._parent.apply(this, [method, model, options]);
        },

        parse: function (data) {
            UWA.log("LifecycleDescriptionCollection::parse");
            return data;
        }

        /*create: function(attributes, options) {
            options.proxy = 'passport';
            // options.headers = 'headers%5BAccept%5D=application%2Fjson&headers%5BX-Request%5D=JSON';
            this._parent.apply(this, [attributes, options]);
        }*/

    });
});

define('DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/SAXMgmtView',
    [
        'UWA/Core',
        'UWA/Class/View',
        'DS/W3DXComponents/Views/Layout/ListView',
        'DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/SAXTileView'
    ],
    function (
      UWA,
      View,
      ListView,
      SAXTileView
    ) {

        'use strict';

        return View.extend({

          defaultOptions : {
            type : 'default'
          },

          init : function(options) {
            UWA.log("SAXMgmtView::init");
            UWA.log(options);

            this.options = options;
            this.childView = null;
          },

          render : function() {
            UWA.log("SAXMgmtView::render");
            this.childView = new SAXTileView(this.options);
            return this.childView.render();
          },

          onCompletedCollabEntriesRequest : function(){
            UWA.log("SAXMgmtView::onCompletedEntriesRequest");
            console.log(this.collection);
          },

          destroy : function() {
              this.childView.destroy();
              this.stopListening();
              this._parent.apply(this, arguments);
          }

        }
      );
    }
  );

/*@fullReview  ZUR 15/11/23 2017x Param Widgetization NG*/
/*global define, widget, document, setTimeout, console*/
/*jslint nomen: true */
define('DS/ParameterizationSkeleton/Collection/ParameterizationXCADDomainsListCollection', [
    'UWA/Core',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Model/ParameterizationDomainsListModel',
    'WebappsUtils/WebappsUtils',// WebApps
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
    'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS'
], function (UWA, Collection, ParameterizationDomainsModel, WebappsUtils, URLHandler, ParamSkeletonNLS) {
    'use strict';

    return Collection.extend({
        model : ParameterizationDomainsModel,

        setup: function () {
            UWA.log("ParameterizationDomainsListCollection::setup");
            this.url = WebappsUtils.getWebappsAssetUrl('ParameterizationSkeleton', 'Integrations.json');
        },

        sync : function(method, model, options) {
            UWA.log("ParameterizationDomainsListCollection::sync");
            //options.contentType = 'application/json';
            options.proxy = 'passport';

            options.headers = {
                'Accept-Language' : widget.lang
            };
            //'Accept-Language' : widget.lang
            //options.acceptLanguage = widget.lang;
            this._parent.apply(this, [method, model, options]);
        },

        parse: function (data) {
            UWA.log("ParameterizationDomainsListCollection::parse");
            var titleText, titleTooltip, paramEntries = [];

            /*var imgClass = 'fonticon fonticon-2x fonticon-flow-cascade';
            var imgSpan = UWA.createElement('span', {
                    'class' :  imgClass
            });*/

            if (Array.isArray(data)) {
                data.forEach(function (iElement) {
                    titleText = ParamSkeletonNLS[iElement.domainid + "Text"];
                    titleTooltip = ParamSkeletonNLS[iElement.domainid + "Tooltip"];

                    if ((iElement.familyid !== null) && (iElement.familyid !== "")) {
                        titleText = ParamSkeletonNLS[iElement.familyid + "Text"];
                        titleTooltip = ParamSkeletonNLS[iElement.familyid + "Tooltip"];
                    }

                    paramEntries.push({
                        title          : titleText,
                        subtitle       : titleTooltip,
                        introduction   : titleTooltip,
                        //image          : URLHandler.getURL() + "/widget/images/MyApps/" + iElement.image,
                        image          : URLHandler.getURL() + "/webapps/ParameterizationSkeleton/assets/img/" + iElement.image,
                        domainid       : iElement.domainid,
                        familyid       : iElement.familyid,
                        id             : iElement.domainid + iElement.familyid
                    });
                });
            }
            return paramEntries;

 /* "Iteration" "ENOWMOD_AP_AppIcon.png"
    "DataAccessRight" "ENOTASK_AP_AppIcon.png"
    "ObjectIdentification" "ENOCOEX_AP_AppIcon.png"
    "ObjectIdentification//ENOWCHG_AP_AppIcon.png"
    "EngineeringCentral//ENOREPR_AP_AppIcon.png"
    "AttributeDefENOBPCO_AP_AppIcon.png"*/

        }

    });
});

/*@fullReview  SSV1 19/06/13  FUN090928 : SSV1 Engineering Definition configuration UI*/
/*global define, widget, document, setTimeout, console*/
/*jslint nomen: true */
define('DS/ParameterizationSkeleton/Collection/ParameterizationSAX/ParamSAXUnicityCollection', [
    // UWA
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
], function (UWA, Model, Collection, ParameterizationDataUtils, WAFData, URLHandler) {
    'use strict';
    //

    var handledDomain = null;
	var _securityContext = null;
    return Collection.extend({
        model : function (modelid) {
           return Model.extend();
        },

        setup: function (models, options) {
            UWA.log('ParameterizationFLWeb::setup');

            UWA.log(models);
            UWA.log(options);

            console.log("ParameterizationFLWeb::setup, Sucessful");
            var iURL, iObjID,
                _modelKey = options._modelKey,
                domainID = _modelKey._attributes.domainid,
                familyID = _modelKey._attributes.familyid;

            if (UWA.is(this.model, "function")) {
                this.model = this.model(domainID);
                handledDomain = domainID;
            }

                iObjID = _modelKey._attributes.id;
                this.url = URLHandler.getURL() +
                    "/resources/v1/SystemsArchitectureDefinitionParam/getCollaborativeSpaceGrouping?tenant=" + URLHandler.getTenant();
        },

        sync : function(method, model, options) {
            UWA.log('ParameterizationFLWebUnicity::sync');
            options.contentType = 'application/json';
            options.lang = widget.lang;

            options.headers = {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                'Accept-Language' : widget.lang
            };
		//	method = 'create';
        //    options.data = JSON.stringify({});
            UWA.log(options);

            options = Object.assign({
                ajax: WAFData.authenticatedRequest
            }, options);
            this._parent.apply(this, [method, model, options]);
        },

        parse: function (data) {
            UWA.log("ParameterizationFLWebUnicity::parse");
            UWA.log(data);
            return data;
          //  return this.parseMappingData(data);

        },

        create: function(attributes, options) {
            options.proxy = 'passport';
            this._parent.apply(this, [attributes, options]);
        },



        parseMappingData: function (data) {
			var parsedData = {};

			var paramData = data.ParameterExpressionList;
			var attributes = data.Attribues;
			//var  i = 1;
        	if(paramData){
				parsedData.ExpressionList = paramData;
	    		parsedData.ExpressionList.sort(function(a, b){
	    			if(a.Order && b.Order){
	    				return a.Order - b.Order;
	    			}
	    		});
				parsedData.ExpressionList.forEach(function(entry){
					//entry.Name = 'Name'+i;
					entry.Deployed = 'True';
					entry.Label = entry.Name;
					//i++;
				});
        	}
			if(attributes) {
				parsedData.PhysicalProductAttributes = attributes;
			}
			parsedData.UnicityCheck = data.UnicityCheck;
			return parsedData;
            //return data;
        },

		/**
         * Function will retrieve the security context
         * @returns {function} calls back the promise resolve method with the security context fetched from service
         */
   //     retrieveSecurityContext: function(){
   //         var that = this;
   //         return new Promise(function (resolve, reject) {
   //             WAFData.authenticatedRequest(URLHandler.getURL() + '/resources/pno/person/getsecuritycontext', {
   //                 method: 'GET',
   //                 type: 'json',
   //                 headers : {
   //                     Accept: 'application/json',
   //                     'Content-Type': 'application/json'
   //                 },
   //                 onComplete:function(resp){
   //					_securityContext = resp.SecurityContext;
   //                     //that._securityContext = resp.SecurityContext;
   //                     resolve('Done');
   //                 },
   //                 onFailure : reject,
   //                 onTimeout: reject
   //             });
   //         });
   //     }

    });
});

define('DS/ParameterizationSkeleton/Collection/ParameterizationXEN/ParamXENAlternateAdminCollection', [
    'UWA/Core',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
    'DS/ParameterizationSkeleton/Model/ParameterizationXEN/ParamXENModel',
    'DS/WAFData/WAFData',
], (UWA,
    Collection,
    URLHandler,
    ParamXENModel,
    WAFData,
) => {
    const collabManagementCollection = Collection.extend({

        model: ParamXENModel,

        setup(models, options) {
            UWA.log('ParamXENAlternateAdminCollection::setup');
            UWA.log(options);
            this.childCollection = null;
            const { _modelKey } = options;
            const domainID = _modelKey._attributes.domainid;
            const familyID = _modelKey._attributes.familyid;
            this.url = `${URLHandler.getURL()}/resources/ParamWS/access/DomainElements?tenant=${URLHandler.getTenant()}&domainid=ENGDefinationManagement&familyid=${familyID}`;
        },

        sync(method, model, options) {
            UWA.log('ParamXENAlternateAdminCollection::sync');

            options.headers = {
                Accept: 'application/json',
                'Accept-Language': widget.lang,
            };

            options = { ajax: WAFData.authenticatedRequest, ...options };

            this._parent.apply(this, [method, model, options]);
        },

        parse(data) {
            UWA.log('ParamXENAlternateAdminCollection::parse');
            UWA.log(data);
            const familyDetails = data;

            return familyDetails;
        },

        create(attributes, options) {
            options.proxy = 'passport';
            this._parent.apply(this, [attributes, options]);
        },

    });

    return collabManagementCollection;
});

define('DS/ParameterizationSkeleton/Collection/VersionNamingExtCollection', [
    // UWA
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
], function (UWA, Model, Collection, ParameterizationDataUtils, WAFData, URLHandler) {
    'use strict';

    var handledDomain = null;

    return Collection.extend({
        model : function (modelid) {
             return Model.extend();
        },

        setup: function (models, options) {
            console.log("VersionNamingExtCollection::setup");

            console.log("VersionNamingExtCollection::setup, Successful");
            var _modelKey = options._modelKey;

            var domainID = _modelKey._attributes.domainid;
            var familyID = _modelKey._attributes.familyid;

            if (UWA.is(this.model, "function")) {
                this.model = this.model(domainID);
                handledDomain = domainID;
            }

            this.url = "";
        },

        sync : function(method, model, options) {
            console.log('VersionNamingExtCollection::sync');
           
            var familyModel = ParameterizationDataUtils.paramStructBuilder("id,family");
            var oData = new familyModel("", "");

            oData.id = "ObjectIdentification";
            oData.family = [];

            options.onComplete(oData);

            return {
                cancel: function () {
                    return;
                }
            };
        },

        parse: function (data) {
            //UWA.log("VersionNamingExtCollection::parse");
            //UWA.log(data);
            return data;
        },

        create: function(attributes, options) {
            options.proxy = 'passport';
            this._parent.apply(this, [attributes, options]);
        },
    });
});



/* 
* @fullReview  ROW 25/01/22  FUN153906 : ROW Display Properties configuration UI 
*/


define('DS/ParameterizationSkeleton/Collection/ParameterizationDisplayPropertiesCollection', [
    'UWA/Core',
    'UWA/Class/Collection',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
    'DS/ParameterizationSkeleton/Model/ParameterizationDomainsListModel',
    'WebappsUtils/WebappsUtils',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DisplayPropertiesNLS',
], (
    UWA,
    Collection,
    WAFData,
    URLHandler,
    ParameterizationDomainsListModel,
    WebappsUtils,
    DisplayPropertiesNLS,
) => Collection.extend({

    model: ParameterizationDomainsListModel,

    setup(models, options) {
        UWA.log('ParameterizationDisplayProperties::setup');

        UWA.log(models);
        UWA.log(options);

        this.url = WebappsUtils.getWebappsAssetUrl('ParameterizationSkeleton', 'ParamDisplayProperties_Entries.json');
    },

    sync(method, model, options) {
        UWA.log('ParameterizationDisplayProperties::sync');
        options.contentType = 'application/json';
        options.lang = widget.lang;

        options.headers = {
            Accept: 'application/json',
            'Content-Type': 'application/json',
            'Accept-Language': widget.lang,
        };

        UWA.log(options);

        options = { ajax: WAFData.authenticatedRequest, ...options };
        this._parent.apply(this, [method, model, options]);
    },

    parse(data) {
        UWA.log('ParameterizationDisplayProperties::parse');
        UWA.log(data);

        const DisplayProperties_Entries = [];

        if (Array.isArray(data)) {
            data.forEach((DisplayProperties_Entry) => {
                const title = DisplayPropertiesNLS[`${DisplayProperties_Entry.familyid}Text`];
                const tooltip = DisplayPropertiesNLS[`${DisplayProperties_Entry.familyid}Tooltip`];

                DisplayProperties_Entries.push({
                    title,
                    subtitle: tooltip,
                    image: `${URLHandler.getURL()}/webapps/ParameterizationSkeleton/assets/img/${DisplayProperties_Entry.image}`,
                    id: DisplayProperties_Entry.domainid + DisplayProperties_Entry.familyid,
                    familyid: DisplayProperties_Entry.familyid,
                    domainid: DisplayProperties_Entry.domainid,
                });
            });
        }

        return DisplayProperties_Entries;
    },

    create(attributes, options) {
        options.proxy = 'passport';
        this._parent.apply(this, [attributes, options]);
    },
}));

define('DS/ParameterizationSkeleton/Collection/ParameterizationMSFCollection', [
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
], function (UWA, Model, Collection, ParameterizationDataUtils, WAFData, URLHandler) {
    'use strict';
    
    var handledDomain = null;

    return Collection.extend({
        model : function (modelid) {
             return Model.extend();
        },

        setup: function (models, options) {
        	UWA.log('ParameterizationMSFCollection::setup');

        	UWA.log(models);
        	UWA.log(options);

        	console.log("ParameterizationMSFCollection::setup, Successful");
        	var iObjID,
        	_modelKey = options._modelKey,
        	domainID = _modelKey._attributes.domainid;

        	if (UWA.is(this.model, "function")) {
        		this.model = this.model(domainID);
        		handledDomain = domainID;
        	}

        	iObjID = _modelKey._attributes.id;
        	this.url = URLHandler.getURL() +                    
        	"/resources/v1/msfParameterization/getCustomTypeMappings?tenant=" + URLHandler.getTenant();
        },

        sync : function(method, model, options) {
            UWA.log('ParameterizationMSFCollection::sync');
            options.contentType = 'application/json';
            options.lang = widget.lang;

            options.headers = {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                'Accept-Language' : widget.lang
            };

            UWA.log(options);

            options = Object.assign({
                ajax: WAFData.authenticatedRequest
            }, options);  
            this._parent.apply(this, [method, model, options]);
        },

        parse: function (data) {
            UWA.log("ParameterizationMSFCollection::parse");
            UWA.log(data);

            return this.parseMappingData(data);           
        },

        create: function(attributes, options) {
            options.proxy = 'passport';
            this._parent.apply(this, [attributes, options]);
        },   

        parseMappingData: function (data) {        	
            return data;
        }

    });
});

/*@fullReview  ZUR 15/11/23 2017x Param Widgetization NG*/
/*global define, widget, document, setTimeout, console*/
/*jslint nomen: true */
define('DS/ParameterizationSkeleton/Collection/ParameterizationDomainsListCollection', [
    'UWA/Core',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Model/ParameterizationDomainsListModel',
    'WebappsUtils/WebappsUtils',// WebApps
	'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
    'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS'
], function (UWA, Collection, ParameterizationDomainsModel, WebappsUtils, WAFData, URLHandler, ParamSkeletonNLS) {
    'use strict';

    return Collection.extend({
        model : ParameterizationDomainsModel,

        setup: function () {
            UWA.log("ParameterizationDomainsListCollection::setup");
            this.url = WebappsUtils.getWebappsAssetUrl('ParameterizationSkeleton', 'Param_Entries.json');
        },

        sync : function(method, model, options) {
            UWA.log("ParameterizationDomainsListCollection::sync");
            //options.contentType = 'application/json';
			//IR-1284096-3DEXPERIENCER2024x/25x
            //options.proxy = 'passport';
			//FUN151396 
			options = Object.assign({
                ajax: WAFData.authenticatedRequest
            }, options); 
			
            options.headers = {
                'Accept-Language' : widget.lang
            };
 

            //'Accept-Language' : widget.lang
            //options.acceptLanguage = widget.lang;
            this._parent.apply(this, [method, model, options]);
        },

        parse: function (data) {
            UWA.log("ParameterizationDomainsListCollection::parse");
            var titleText, titleTooltip, paramEntries = [];
            //FUN119391
            let fixedDomainEntries = [], lastDomainEntry, finalDomainentries = [];
            // FUN154389 - added "LifecycleAndCollaboration" domain in "Common features" section
            let fixedSequenceDomains = ["AttributeDef", "DisplayProperties", "ObjectIdentification",
                        "DataAccessRight", "LifecycleTopology", "LifecycleAndCollaboration"];
            let lastDomain = "Deployment";
            /*var imgClass = 'fonticon fonticon-2x fonticon-flow-cascade';
            var imgSpan = UWA.createElement('span', {
                    'class' :  imgClass
            });*/
            let separatorElm1 = {id: "elemSeparator1",
                            title          : ParamSkeletonNLS.CommonConfiguration,
                            disabled: 'true',
                            content:"<span id ='elemSep1'></span>",
                            domainid       : "elemSeparator",
                          };
            fixedDomainEntries.push(separatorElm1);
            if (Array.isArray(data)) {
                data.forEach(function (iElement) {
                    titleText = ParamSkeletonNLS[iElement.domainid + "Text"];
                    titleTooltip = ParamSkeletonNLS[iElement.domainid + "Tooltip"];

                    if ((iElement.familyid !== null) && (iElement.familyid !== "")) {
                        titleText = ParamSkeletonNLS[iElement.familyid + "Text"];
                        titleTooltip = ParamSkeletonNLS[iElement.familyid + "Tooltip"];
                    }
                    if ( fixedSequenceDomains.includes(iElement.domainid)) {
            						fixedDomainEntries.push({
            							title          : titleText,
            							subtitle       : titleTooltip,
            							introduction   : titleTooltip,
            							//image          : URLHandler.getURL() + "/widget/images/MyApps/" + iElement.image,
            							image          : URLHandler.getURL() + "/webapps/ParameterizationSkeleton/assets/img/" + iElement.image,
            							domainid       : iElement.domainid,
            							familyid       : iElement.familyid,
            							id             : iElement.domainid + iElement.familyid
            							});
            					}	else if ( lastDomain === iElement.domainid) {
            							lastDomainEntry = {
            								title          : titleText,
            								subtitle       : titleTooltip,
            								introduction   : titleTooltip,
                            //image          : URLHandler.getURL() + "/widget/images/MyApps/" + iElement.image,
            								image          : URLHandler.getURL() + "/webapps/ParameterizationSkeleton/assets/img/" + iElement.image,
            								domainid       : iElement.domainid,
            								familyid       : iElement.familyid,
            								id             : iElement.domainid + iElement.familyid
            							}
            					} else {
              						paramEntries.push({
              							title          : titleText,
              							subtitle       : titleTooltip,
              							introduction   : titleTooltip,
              							//image          : URLHandler.getURL() + "/widget/images/MyApps/" + iElement.image,
              							image          : URLHandler.getURL() + "/webapps/ParameterizationSkeleton/assets/img/" + iElement.image,
              							domainid       : iElement.domainid,
              							familyid       : iElement.familyid,
              							id             : iElement.domainid + iElement.familyid
              						});
                      }
                });
                fixedDomainEntries.push(lastDomainEntry);
                paramEntries.sort(function (paramEnt1, paramEnt2) {
                  if (paramEnt1.title !== undefined && paramEnt2.title !== undefined) {
                    return paramEnt1.title.localeCompare(paramEnt2.title);
                  } else {
                    // not possible case
                    console.log("sorting failed : " + paramEnt1);
                    console.log(paramEnt2);
                    return 0;
                  }
                });

                let separatorElm2 = {id: "elemSeparator2",
                                 title          : ParamSkeletonNLS.AppSpecificConfiguration,
                                 disabled: 'true',
                                 content:"<span id ='elemSep1'></span>",
                                 domainid       : "elemSeparator",
                               };
 					     fixedDomainEntries.push(separatorElm2);
           		 finalDomainentries =	fixedDomainEntries.concat(paramEntries);
            }
            return finalDomainentries;

 /* "Iteration" "ENOWMOD_AP_AppIcon.png"
    "DataAccessRight" "ENOTASK_AP_AppIcon.png"
    "ObjectIdentification" "ENOCOEX_AP_AppIcon.png"
    "ObjectIdentification//ENOWCHG_AP_AppIcon.png"
    "EngineeringCentral//ENOREPR_AP_AppIcon.png"
    "AttributeDefENOBPCO_AP_AppIcon.png"*/

        }

    });
});

/**
 * @author AMN14
 */
define('DS/ParameterizationSkeleton/Collection/ParameterizationSAX/ParamSAXOtbCollection', [
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
    'DS/ParameterizationSkeleton/Model/ParameterizationSAX/ParamSAXModel',
    'i18n!DS/ParameterizationSkeleton/assets/nls/FLWebNLS',
    'DS/WAFData/WAFData',
    'WebappsUtils/WebappsUtils'
], function ( UWA,
              Model,
              Collection,
              ParamDataUtils,
              URLHandler,
              ParamSAXModel,
               FLWebNLS,
              WAFData,
              WebappsUtils
            ) {
              'use strict';


              var collabManagementCollection = Collection.extend({

                  model : ParamSAXModel,

                  setup : function (models, options) {
                      UWA.log('SAXCollection::setup');
                      UWA.log(options);
                      this.childCollection = null;
                      var _modelKey = options._modelKey,
                          domainID = _modelKey._attributes.domainid,
                          familyID = _modelKey._attributes.familyid;
                      this.url = URLHandler.getURL() + "/resources/ParamWS/access/DomainElements?tenant=" + URLHandler.getTenant() + "&domainid=SystemsArchitectureDefinitionOtbParameter&familyid="+familyID;
                    //  this.url = WebappsUtils.getWebappsAssetUrl('ParameterizationSkeleton', 'ParamSAX_Entries.json');
                  },


                  sync : function(method, model, options) {
                      UWA.log("SAXCollection::sync");

                      options.headers = {
                          Accept: 'application/json',
                          'Accept-Language' : widget.lang
                      };

                      options = Object.assign({
                          ajax: WAFData.authenticatedRequest
                      }, options);

                      this._parent.apply(this, [method, model, options]);
                  },


                  parse: function (data) {
                      UWA.log("SAXCollection::parse");
                      UWA.log(data);
                      const familyDetails = data;
                      // var SAX_Entries = [];
                      //
                      // if(Array.isArray(data)) {
                      //
                      //   data.forEach(function(SAX_Entry) {
                      //     var title = FLWebNLS[SAX_Entry.familyid + "Text"];
                      //     var tooltip = FLWebNLS[SAX_Entry.familyid + "Tooltip"];
                      //
                      //     SAX_Entries.push({
                      //       title              : title,
                      //       subtitle           : tooltip,
                      //       image              : URLHandler.getURL() + "/webapps/ParameterizationSkeleton/assets/img/" + SAX_Entry.image,
                      //       id                 : SAX_Entry.domainid + SAX_Entry.familyid,
                      //       familyid           : SAX_Entry.familyid,
                      //       domainid           : SAX_Entry.domainid
                      //     });
                      //   });
                      // }

                      return familyDetails;
                  },

                  create : function(attributes, options) {
                      options.proxy = 'passport';
                      this._parent.apply(this, [attributes, options]);
                  }

              }
            );

            return collabManagementCollection;
          }
);

define('DS/ParameterizationSkeleton/Views/ParameterizationDOCM/DOCMConfigurationLayoutView', [
	'UWA/Core',
	'UWA/Class/View',
	"DS/Controls/ButtonGroup",
	"DS/Controls/Toggle",
	"DS/UIKIT/Scroller",
	'DS/UIKIT/Mask',
	'DS/Controls/Accordeon',
	'DS/WAFData/WAFData',
	'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
	'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
	'DS/ParameterizationSkeleton/Views/ParameterizationDOCM/DOCMMappingViewUtilities',
	'DS/ParameterizationSkeleton/Model/ParameterizationDOCM/ParameterizationDOCMModel',
	'DS/Utilities/Dom',
	'DS/Controls/TooltipModel',
	'i18n!DS/ParameterizationSkeleton/assets/nls/DOCMContentMgmtNLS'
],
function (UWA,
	View,
	WUXButtonGroup,
	WUXToggle,
	Scroller,
	Mask,
	WUXAccordeon,
	WAFData,
	URLHandler,
	ParametersLayoutViewUtilities,
	DOCMViewUtilities,
	ParameterizationDOCMModel,
	Dom,
	WUXTooltipModel,
	DOCMContentMgmtNLS) {

	'use strict';

	var extendedView;

	extendedView = View.extend({
		tagName: 'div',
		className: 'generic-detail',

		init: function (options) {
			options = UWA.clone(options || {}, false);
			this._parent(options);
			this.options = options;
			this.contentDiv = null;
			this.controlDiv = null;
		},

		setup: function (options) {
			UWA.log('DOCMConfiguration Layout::setup!');
			UWA.log(options);
			this.parameterizationDOCMModel = new ParameterizationDOCMModel();
			this.UIElements = new Map();
			// this.parameterizationDOCMModel.addEvent(
			// 	"onChange",
			// 	function (model, options) {
			// 		var changedValues = model.changedAttributes();
			// 		var previousValue = model.previousAttributes();
			// 		for(const key in changedValues){
			// 			console.log(key,changedValues[key],previousValue[key])
			// 		}
			// 	});
			this.listenTo(this.collection, {
				onSync: function(data){
				}
			});
		},

		render: function () {
			UWA.log("DOCMConfiguration LayoutView::render");
			var that = this;

			this.mainContainer = UWA.createElement('div', {
				'id': 'docm-configuration-main-container'
			});
			this.notificationDiv = UWA.createElement('div', {}).inject(that.mainContainer);


			// no need to intro : provides no value as per UX comments
			// this.createIntro();

			that.contentDiv = UWA.createElement('div', {
				'class': "docm-configuration-rules"
			}).inject(this.mainContainer);

			// RSY8: Download Rule Ui creation
			that.downloadRule1Container = UWA.createElement('div', {
					'class': "download-rule1-container docm-rule"
			}).inject(that.contentDiv);


			function getBoldTextSpan(text){
				return `<span style="font-weight: bold;">${text}</span>`;
			}

			var downloadRuleSubtitle = getBoldTextSpan(DOCMContentMgmtNLS.get("DownloadBehaviorTooltip").subtitle1Heading)+
			DOCMContentMgmtNLS.get("DownloadBehaviorTooltip").subtitle1+"\n"+
			getBoldTextSpan(DOCMContentMgmtNLS.get("DownloadBehaviorTooltip").subtitle2Heading)+
			DOCMContentMgmtNLS.get("DownloadBehaviorTooltip").subtitle2
			

			that.downloadRuleLabel = that.createBoldLabel(DOCMContentMgmtNLS.rule1,{
				title:DOCMContentMgmtNLS.get("DownloadBehaviorTooltip").title,
				subtitle:downloadRuleSubtitle,
				allowUnsafeHTMLShortHelp: true
		    });
			that.downloadRuleLabel.inject(that.downloadRule1Container);
			that.downloadRulesCheckBox = that.createGroupCheckBox('DOCMDownloadRule', [{
				type: "radio",
				label: DOCMContentMgmtNLS.option1,
				value: 'OneFileOneDirectory',
				checkFlag: true
			},
			{
				type: "radio",
				label: DOCMContentMgmtNLS.option2,
				value: 'Flatlist',
				checkFlag: false
			}], "radio");
			that.downloadRulesCheckBox.inject(that.downloadRule1Container);

			// RSY8: Work Under UI creation

			that.workUnderRule1Container = UWA.createElement('div', {
				'class': "workUnder-rule1-container docm-rule"
			}).inject(that.contentDiv);

			that.workUnderRuleLabel = that.createBoldLabel(DOCMContentMgmtNLS.Work_Under,{subtitle:DOCMContentMgmtNLS.get("WorkUnderRuleTooltip"),allowUnsafeHTMLShortHelp: false})
			that.workUnderRuleLabel.inject(that.workUnderRule1Container);
			that.uiEnableOption = that.createCheckBox('EnforceWorkUnderForDocument',DOCMContentMgmtNLS.Enable_Work_Under_Setting,'checkbox','uiEnable',false);
			that.uiEnableOption.inject(that.workUnderRule1Container);
			
			// RSY8: Mandary Comment Ui creation
			that.commentMandatoryRuleContainer = UWA.createElement('div', {
				'class': "fileComment-rule1-container docm-rule"
			}).inject(that.contentDiv);
			that.commentMandatoryRuleLabel = that.createBoldLabel(DOCMContentMgmtNLS.File_Comment_Label,{subtitle:DOCMContentMgmtNLS.get("CommentMandatoryTooltip"),allowUnsafeHTMLShortHelp: false})
			that.commentMandatoryRuleLabel.inject(that.commentMandatoryRuleContainer);
			that.uiEnableOption = that.createCheckBox('CommentAsMandatoryValue',DOCMContentMgmtNLS.Enable_Mandatory_Comment_Setting,'checkbox','uiEnable',false);
			that.uiEnableOption.inject(that.commentMandatoryRuleContainer);
			

			//RSY8: Bottom Bar creation

			this.bottomButtonBar = UWA.createElement('div', {
				'class': 'Bottom-Button-Bar',
			}).inject(this.mainContainer);

			this.controlDiv = ParametersLayoutViewUtilities.createApplyResetToolbar.call(this, this.bottomButtonBar, false, undefined, this.resetParams.bind(this));

			this.container.setContent(this.mainContainer);
			this.fetchAttributes();
			return this;
		},
		createBoldLabel : function (label,tooltipObj){
			var that = this;
			var labelcontainer = UWA.createElement('div', {
				'class': "docm-label-container",
				'styles':{
					display:'flex',
					'align-items':'center',
					gap:'5px'
				}
			}); 

			var labelSpan = UWA.createElement('span', {
				class: 'docm-label-text',
				'styles':{
					'font-weight': 'bold'
				},
				text: label
			});
			labelSpan.inject(labelcontainer);

			if(tooltipObj){
				var infoIcon = that.createInfoDiv(tooltipObj);
				infoIcon.inject(labelcontainer);
			}
			return labelcontainer;
		},
		createInfoDiv: function(tooltip){
			var iconSpan = Dom.generateIcon({
				className: "docm-para-info-icon",
				iconName: "info",
				fontIconSize: '0.5x'
			  }); 
			iconSpan.tooltipInfos =  new WUXTooltipModel({
				title:tooltip.title,
				shortHelp: tooltip.subtitle,
				allowUnsafeHTMLShortHelp:true
			  });
			return iconSpan;
		},
		createIntro: function(){
			var introDiv = UWA.createElement('div', {
				'class': 'information'
			}).inject(this.contentDiv);

			UWA.createElement('p', {
				text: DOCMContentMgmtNLS.intro
			}).inject(introDiv);
		},
		createAccordeon: function(items){
			this.accordeon = new WUXAccordeon({
				items: items,
				exclusive:false,
				style: "filled-separate"
			})
			var totalItems = this.accordeon.items.length;
			for(var i =0;i<totalItems;i++){
				this.accordeon.expandItem(i)
			}
			this.accordeon.inject(this.contentDiv);
		},
		createCheckBox: function(identifier,label,type,value,defaultFlag){
			var that = this;
			var toggle = new WUXToggle({
				type: type,
				label: label,
				value: value,
				checkFlag: defaultFlag
			});
			toggle.setOptions({
				purpose:identifier,
				updateValue: function(dsModel,value){
					dsModel.setProperties({
						checkFlag: value
					});
				}
			})

			toggle.addEventListener('change', function(e) {
				var purpose = e.dsModel.options.purpose;
				// that.parameterizationDOCMModel.updateRule(purpose,e.dsModel.checkFlag);
				var newValue = e.dsModel.checkFlag;
				var prevValue = that.parameterizationDOCMModel.get(purpose);
				if(newValue!=prevValue){
					that.updateAttributeInDb(purpose,newValue.toString(),prevValue);
				}
		     });

			this.UIElements.set(identifier,toggle);
			return toggle;
		},
		createGroupCheckBox: function(identifier,items,type){
			var that = this;
			var ButtonGroup = new WUXButtonGroup({
				type: type,
				height: "24px"
			});
			items.forEach(element => {
				ButtonGroup.addChild(new WUXToggle({
					type: type,
					label: element.label,
					value: element.value,
					checkFlag: element.checkFlag
				}))
			});

			ButtonGroup.setOptions({
				purpose:identifier,
				updateValue: function(dsModel,value){
					dsModel.selectValue(value);
				}
			});
			this.UIElements.set(identifier,ButtonGroup);

			ButtonGroup.addEventListener('change', function(e) {

				var purpose = e.dsModel.options.purpose;
				// that.parameterizationDOCMModel.updateRule(purpose,e.dsModel.checkFlag);
				var newValue = e.dsModel.value[0];
				var prevValue = that.parameterizationDOCMModel.get(purpose);
				if(newValue!=prevValue){
					that.updateAttributeInDb(purpose,newValue.toString(),prevValue);
				}
		     });

			return ButtonGroup;
		},
		fetchAttributes: function(){
			var that = this;
			var url = URLHandler.getURL() + "/resources/v1/docmParameterization/DOCMConfigurationRule?tenant=" + URLHandler.getTenant();
			WAFData.authenticatedRequest(url, {
				timeout: 250000,
				method: 'GET',
				type: 'json',
				headers: {
					'Content-Type': 'application/json',
					'Accept': 'application/json'
				},

				onFailure: function (str) {
					debugger;
				},

				onComplete: function (response) {
					if (response && response[0]) {
						const {DOCMDownloadRule,EnforceWorkUnderForDocument,CommentAsMandatoryValue} = response[0];
						var data = {DOCMDownloadRule,EnforceWorkUnderForDocument,CommentAsMandatoryValue};

						for(const key in data){
							if(DOCMViewUtilities.validateExpression(key,data[key])){
								that.parameterizationDOCMModel.updateRule(key,data[key]);
								var uiElement = that.UIElements.get(key)
								uiElement.options.updateValue(uiElement,DOCMViewUtilities.convertStringToBool(data[key]));
							}
							else{
								DOCMViewUtilities.getAlertMessage(DOCMContentMgmtNLS.Failed_Load,'error', that.notificationDiv);
							}
						}
					}
					Mask.unmask(that.contentDiv);
				}
			});
		},

		updateAttributeInDb: function (attributeName, newValue, PreviousValue) {
			var that = this;
			if (newValue != PreviousValue) {
				Mask.mask(this.contentDiv);
				var payLoad = {...that.parameterizationDOCMModel._attributes};
				payLoad[attributeName]=newValue;
				var url = URLHandler.getURL() + "/resources/v1/docmParameterization/DOCMConfigurationRule?tenant=" + URLHandler.getTenant();
				WAFData.authenticatedRequest(url, {
					timeout: 250000,
					method: 'POST',
					data:JSON.stringify(payLoad),
					type:'string',
					headers: {
						'Content-Type':'application/json',
						'Accept': 'text/plain'
					},

					onFailure: function (strRes) {
						var uiElement=that.UIElements.get(attributeName);
						uiElement.options.updateValue(uiElement,DOCMViewUtilities.convertStringToBool(PreviousValue));
						Mask.unmask(that.contentDiv);
						DOCMViewUtilities.getAlertMessage(DOCMContentMgmtNLS.ApplyError, 'error', that.notificationDiv);
					},

					onComplete: function (strRes) {
						Mask.unmask(that.contentDiv);
						if (strRes == "success") {
							that.parameterizationDOCMModel.updateRule(attributeName,newValue);
							DOCMViewUtilities.getAlertMessage(DOCMContentMgmtNLS.ApplySuccess, 'success', that.notificationDiv);
						} else {
							DOCMViewUtilities.getAlertMessage(strRes.message, 'error', that.notificationDiv);
						}
					}
				});
			}
		},
		resetParams: function () {
			var that = this;

			Mask.mask(this.contentDiv);
			var payloadToSend = DOCMViewUtilities.getDefaultValues();
			var url = URLHandler.getURL() + "/resources/v1/docmParameterization/DOCMConfigurationRule?tenant=" + URLHandler.getTenant();
			WAFData.authenticatedRequest(url, {
				timeout: 250000,
				method: 'POST',
				data: JSON.stringify(payloadToSend),
				type:'string',
				headers: {
					'Content-Type': 'application/json',
					'Accept': 'text/plain'
				},

				onFailure: function (strRes) {
					Mask.unmask(that.contentDiv);
					DOCMViewUtilities.getAlertMessage(DOCMContentMgmtNLS.ApplyError, 'error', that.notificationDiv);
				},

				onComplete: function (strRes) {
					Mask.unmask(that.contentDiv);
					if (strRes == "success") {
						for(const key in payloadToSend){
							that.parameterizationDOCMModel.updateRule(key,payloadToSend[key]);
							var uiElement = that.UIElements.get(key)
							uiElement.options.updateValue(uiElement,DOCMViewUtilities.convertStringToBool(payloadToSend[key]));
						}
						DOCMViewUtilities.getAlertMessage(DOCMContentMgmtNLS.ResetSuccess, 'success', that.notificationDiv);
					} else {
						DOCMViewUtilities.getAlertMessage(DOCMContentMgmtNLS.ApplyError, 'error', that.notificationDiv);
					}
				}
			});

		},

	});

	return extendedView;
});

/*@fullReview BXQ 2021:07:30 Widegt param Life Cycle rules on PPR Objects*/
/*global define, widget, document, setTimeout, console*/
/*jslint nomen: true */


define('DS/ParameterizationSkeleton/Collection/PPRSynchronizationLifeCycle/PPRSyncCommonParamCollection', [
    // UWA
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Model/PPRSynchronizationLifeCycle/PPRSyncMBOMmodel',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
], function (UWA, Model, Collection, PPRSynchronizationLifeCycleModel, ParameterizationDataUtils, WAFData, URLHandler) {
    'use strict';
    //

    var handledDomain = null;

    return Collection.extend({
        model : function (modelid) {
            return PPRSynchronizationLifeCycleModel;
        },

        setup: function (models, options) {
            UWA.log('ParametrizationPPRSyncRules::setup');

            UWA.log(models);
            UWA.log(options);

            console.log("ParametrizationPPRSyncRules::setup, Sucessful");
            var iURL, iObjID,
                _modelKey = options._modelKey,
                domainID = _modelKey._attributes.domainid,
                familyID = _modelKey._attributes.familyid;

            if (UWA.is(this.model, "function")) {
                this.model = this.model(domainID);
                handledDomain = domainID;
            }

            iObjID = _modelKey._attributes.id;

            //TO DO URL (java) to read Model
                //this.url = URLHandler.getURL() +
                //    "/resources/v1/xENGParameterization/getAdminPartNumberProperties?tenant=" + URLHandler.getTenant();

            this.url = URLHandler.getURL() + "/resources/DELLifecycleParametrization/lifecycle/options?modelerKey=DELLifecycleCouplingParam_MBOM"; 


        },

        sync: function (method, model, options) {
            UWA.log('ParameterizationCommonCollection::sync');
            options.contentType = 'application/json';//application/ds-json
            //options.proxy = 'passport';
            options.lang = widget.lang;

            options.headers = {
                Accept: 'application/json',
                'Content-Type': 'application/json',
                'Accept-Language': widget.lang
            };

            UWA.log(options);

            options = Object.assign({
                ajax: WAFData.authenticatedRequest
            }, options);
            //console.log(model);
            //this.childCollection.sync(method, model, options);
            this._parent.apply(this, [method, model, options]);
        },

        parse: function (data) {
  

            return this.parseMappingData(data);
           
        },

        create: function(attributes, options) {
            options.proxy = 'passport';
            this._parent.apply(this, [attributes, options]);
        },


        parseMappingData: function (data) {
            //parse method
            UWA.log("PPRSyncCommonParamCollection::parse");
            UWA.log(data);
            var parsedData = {};

            //Retrun the structure found by webservice
            parsedData.ExpressionsList = data.result.parameters;
            return parsedData;
        }
    });
});

define('DS/ParameterizationSkeleton/Collection/VersionNamingLogCollection', [
    // UWA
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
], function (UWA, Model, Collection, ParameterizationDataUtils, WAFData, URLHandler) {
    'use strict';

    var handledDomain = null;

    return Collection.extend({
        model : function (modelid) {
             return Model.extend();
        },

        setup: function (models, options) {
            console.log("VersionNamingLogCollection::setup");

            console.log("VersionNamingLogCollection::setup, Successful");
            var _modelKey = options._modelKey;

            var domainID = _modelKey._attributes.domainid;
            var familyID = _modelKey._attributes.familyid;

            if (UWA.is(this.model, "function")) {
                this.model = this.model(domainID);
                handledDomain = domainID;
            }

            this.url = "";
        },

        sync : function(method, model, options) {
            console.log('VersionNamingLogCollection::sync');
           
            var familyModel = ParameterizationDataUtils.paramStructBuilder("id,family");
            var oData = new familyModel("", "");

            oData.id = "ObjectIdentification";
            oData.family = [];

            options.onComplete(oData);

            return {
                cancel: function () {
                    return;
                }
            };
        },

        parse: function (data) {
            //UWA.log("VersionNamingLogCollection::parse");
            //UWA.log(data);
            return data;
        },

        create: function(attributes, options) {
            options.proxy = 'passport';
            this._parent.apply(this, [attributes, options]);
        },
    });
});



/*@fullReview  ZUR 15/11/23 2017x Param Widgetization NG*/
/*global define, widget, document, setTimeout, console*/
/*jslint nomen: true */
define('DS/ParameterizationSkeleton/Collection/ParameterizationCommonCollection', [
    // UWA
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Model/ParameterizationDomainModel',
    'DS/ParameterizationSkeleton/Model/ParameterizationDataModeling/TypeModel',
    'DS/ParameterizationSkeleton/Model/ParameterizationLifecycle/LifecycleModel',
    'DS/ParameterizationSkeleton/Model/ParameterizationXCAD/XCADModel',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
], function (UWA, Model, Collection, ParameterizationDomainModel, TypeModel, LifecycleModel, XCADModel,
    ParameterizationDataUtils, WAFData, URLHandler) {
    'use strict';
    //

    var handledDomain = null;

    //var  ParameterizationParentCol = 
    return Collection.extend({
        model : function (modelid) {
            UWA.log('ParameterizationCommonCollection::model = ' + modelid);
            if (modelid === "AttributeDef") {
                return TypeModel;
            }
            if (modelid === "XCADParameterization") {
                return XCADModel;
            }
            return LifecycleModel;
        },

        //model:ParameterizationDomainModel,
        setup: function (models, options) {
            UWA.log('ParameterizationCommonCollection::setup');
            //this.childCollection = null;

            UWA.log(models);
            UWA.log(options);
            /*var options2 = this.options;
            UWA.log(options2);*/

            console.log("ParameterizationCommonCollection::setup, la suite");
            var iURL, iObjID,
                _modelKey = options._modelKey,
                domainID = _modelKey._attributes.domainid,
                familyID = _modelKey._attributes.familyid;

            if (UWA.is(this.model, "function")) {
                this.model = this.model(domainID);
                handledDomain = domainID;
            }

            if (domainID === 'AttributeDef') {
                UWA.log("ParameterizationCommonCollection::Attributes!");
                iObjID = _modelKey._attributes.id;
                this.url = URLHandler.getURL() +
                    "/resources/ParamWS/datamodel/listofattributesfortype?tenant=" + URLHandler.getTenant() + "&type=" + iObjID;
            } else if (domainID === 'LifecycleTopology') {
                iObjID = _modelKey._attributes.id;
                UWA.log("ParameterizationCommonCollection::Setting lifecycle URLs");
                this.url = URLHandler.getURL() +
                    "/resources/ParamWS/lifecycle/topology?allLangs=true&tenant=" + URLHandler.getTenant() + "&policy=" + iObjID;

            } else if (domainID === 'XCADParameterization') {
                iObjID = _modelKey._attributes.id;
                UWA.log("ParameterizationCommonCollection::Setting xcad URLs");
                this.url = URLHandler.getURL() +
                    "/resources/xcadparam/gco/get?tenant=" + URLHandler.getTenant() + "&integration=" + iObjID;
           
		   } else {
                iURL = URLHandler.getURL() + "/resources/ParamWS/access/DomainElements?tenant=" + URLHandler.getTenant() + "&domainid=" + domainID;

                if ((familyID !== null) && (familyID !== "")) {
                    iURL = iURL + "&familyid=" + familyID;
                }
                this.url = iURL;
                //this.childCollection = new ParameterizationDomainCollection();
                //return this.childCollection.setup(models, options);
            }
        },

        sync : function(method, model, options) {
            UWA.log('ParameterizationCommonCollection::sync');
            options.contentType = 'application/json';//application/ds-json
            //options.proxy = 'passport';
            options.lang = widget.lang;
//IR-903905-3DEXPERIENCER2022x - revert the change no need to mention timeout
            options.headers = {
                Accept: 'application/json',
                //'Content-Type': 'application/json',
                'Accept-Language' : widget.lang
            };
            UWA.log(options);
            //IR-987186-3DEXPERIENCER2022x\23x
            options.timeout = 300000;
            options.onTimeout = function (networkError, error) {
              error = error || networkError;
              console.log("onTimeout");
              console.log(error);
            };
            options.onPassportError = function (networkError, error) {
              error = error || networkError;
              console.log("onPassportError");
              console.log(error);
            };
            options.onFailure = function(networkError, error) {
                error = error || networkError;
                console.log("onFailure");
                console.log(error);
            };

            options = Object.assign({
                ajax: WAFData.authenticatedRequest
            }, options);  
            //console.log(model);
            //this.childCollection.sync(method, model, options);
            this._parent.apply(this, [method, model, options]);
        },

        parse: function (data) {
            UWA.log("ParameterizationParentCollection::parse");
            //return this.childCollection.parse(data);
            UWA.log(data);

            if (handledDomain === "AttributeDef") {
                return this.parseTypeAttributesData(data);
            }

            if (handledDomain === "LifecycleTopology") {
                return this.parseMaturityData(data);
            }

            if (handledDomain === "XCADParameterization") {
                return this.parseXCADData(data);
            }
        },

        create: function(attributes, options) {
            options.proxy = 'passport';
            this._parent.apply(this, [attributes, options]);
        },

        parseTypeAttributesData : function (data) {
            UWA.log("ParameterizationCommonCollection::parseAttributesData");
            UWA.log(data);
            var oData = [], Attributes = [], Synchros = [], SystemAttributes = [];

            if (Array.isArray(data.attributeDescription)) {
                data.attributeDescription.forEach(function (rElement) {
                    Attributes.push(rElement);
                });
            }
			//FUN087050
			/*
            if (Array.isArray(data.attributesSynchronization)) {
                data.attributesSynchronization.forEach(function (rElement) {
                    Synchros.push(rElement);
                });
            }*/
            //NZV :IR-540216-3DEXPERIENCER2018x
            if (Array.isArray(data.attributesInSystem)) {
                data.attributesInSystem.forEach(function (rElement) {
                    SystemAttributes.push(rElement.sysAttribute);
                });
            }
			//FUN119390
            oData.push({
                id               : data.id,
                listofAttributes : Attributes,
                listofSynchros   : Synchros,
                listofSystemAttribues : SystemAttributes,
				existingConfiguredObjects : data.existingConfiguredObjects
            });
            return oData;
        },

        parseMaturityData: function (data) {
            var rPolicy, StateNodeModel,
                States  = [],
                Transitions = [],
                Checks = [],
                Types = [];

            UWA.log("LifecycleCollection::parse");
            UWA.log(data);

            StateNodeModel = ParameterizationDataUtils.paramStructBuilder("id,states");
            rPolicy = new StateNodeModel("", "");
            //:[{"id":"PRIVATE","stateUserName":"Private","isEnabled":"true","isCritical":"true","isDefault":"false","visuOrder":"0"},

            if (Array.isArray(data.state)) {
                data.state.forEach(function (rState) {
                    States.push({
                        id: rState.id,
                        stateUserName: rState.stateUserName,
                        isDefault  : rState.isDefault,
                        isEnabled  : rState.isEnabled,
                        isCritical : rState.isCritical,
                        visuOrder  : rState.visuOrder,
                        isDeployed : rState.isDeployed
                    });
                });
            }

            //":[{"name":"","sourceState":"Create","targetState":"Peer Review","isDefault":"false","isForbidden":"false","isCritical":"false"}
            if (Array.isArray(data.transition)) {
                data.transition.forEach(function (rTransition) {
                    Transitions.push({
                        name        : rTransition.name,
                        nlsname     : rTransition.nlsname,
                        sourceState : rTransition.sourceState,
                        targetState : rTransition.targetState,
                        isForbidden : rTransition.isForbidden,
                        isDefault   : rTransition.isDefault,
                        isCritical  : rTransition.isCritical,
                        isDeployed  : rTransition.isDeployed
                    });
                });
            }

            //<Check objType="Schema_Snapshot_Log" fromState="FROZEN" toState="RELEASED" ruleID="RejectOnCreator" additionalProps="NOINFO" isDeployed="true"/>
            if (Array.isArray(data.check)) {
                data.check.forEach(function (rCheck) {
                    Checks.push({
                        objType         : rCheck.objType,
                        sourceState     : rCheck.fromState,
                        targetState     : rCheck.toState,
                        ruleID          : rCheck.ruleID,
                        additionalProps : rCheck.additionalProps,
                        isDeployed      : (rCheck.isDeployed === "true"),
                        promote         : rCheck.promote //FUN087047
                    });
                });
            }

            if (Array.isArray(data.governedType)) {
                data.governedType.forEach(function (rType) {
                    Types.push(rType);
                });
            }
            //listofRules, typeCategory, typeID, typeNLS

            rPolicy.id = data.id;
            rPolicy.appCategory = data.appCategory;
            rPolicy.states = States;
            rPolicy.transitions = Transitions;
            rPolicy.checks = Checks;
            rPolicy.types = Types;
            return rPolicy;
        },

        parseXCADData : function (data) {
            UWA.log("ParameterizationCommonCollection::parseXCADData");
            UWA.log(data);
            var oData = [], Attributes = [], extension="";

            if (Array.isArray(data.Mapping)) {
                data.Mapping.forEach(function (rElement) {
                    Attributes.push(rElement);
                });
            }

			if(data.listofOOTBExtensionToShowInConsole !==null){
				extension=data.listofOOTBExtensionToShowInConsole;
			}
            oData.push({
              id               : data.Connector,
              Mapping : Attributes,
			  ExtensionList:extension
            });
            return oData;
        },



    });

    //return ParameterizationParentCol;
});

/*@fullReview  SSV1 19/06/13  FUN090928 : SSV1 Engineering Definition configuration UI*/
/*global define, widget, document, setTimeout, console*/
/*jslint nomen: true */
define('DS/ParameterizationSkeleton/Collection/ParameterizationFLWebCollection', [
    // UWA
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
], function (UWA, Model, Collection, ParameterizationDataUtils, WAFData, URLHandler) {
    'use strict';
    //

    var handledDomain = null;
	var _securityContext = null;
    return Collection.extend({
        model : function (modelid) {
           return Model.extend();
        },

        setup: function (models, options) {
            UWA.log('ParameterizationFLWeb::setup');

            UWA.log(models);
            UWA.log(options);

            console.log("ParameterizationFLWeb::setup, Sucessful");
            var iURL, iObjID,
                _modelKey = options._modelKey,
                domainID = _modelKey._attributes.domainid,
                familyID = _modelKey._attributes.familyid;

            if (UWA.is(this.model, "function")) {
                this.model = this.model(domainID);
                handledDomain = domainID;
            }

                iObjID = _modelKey._attributes.id;
                this.url = URLHandler.getURL() +
                    "/resources/v1/SystemsArchitectureDefinitionParam/getParamArchitectureNumberExpressions?tenant=" + URLHandler.getTenant();
        },

        sync : function(method, model, options) {
            UWA.log('ParameterizationFLWeb::sync');
            options.contentType = 'application/json';
            options.lang = widget.lang;

            options.headers = {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                'Accept-Language' : widget.lang
            };
		//	method = 'create';
        //    options.data = JSON.stringify({});
            UWA.log(options);

            options = Object.assign({
                ajax: WAFData.authenticatedRequest
            }, options);
            this._parent.apply(this, [method, model, options]);
        },

        parse: function (data) {
            UWA.log("ParameterizationFLWeb::parse");
            UWA.log(data);

            return this.parseMappingData(data);

        },

        create: function(attributes, options) {
            options.proxy = 'passport';
            this._parent.apply(this, [attributes, options]);
        },



        parseMappingData: function (data) {
			var parsedData = {};
			
			var paramData = data.ParameterExpressionList;
			var attributes = data.Attribues;
			//var  i = 1;
        	if(paramData){
				parsedData.ExpressionList = paramData;
	    		parsedData.ExpressionList.sort(function(a, b){
	    			if(a.Order && b.Order){
	    				return a.Order - b.Order;
	    			}
	    		});
				parsedData.ExpressionList.forEach(function(entry){
					//entry.Name = 'Name'+i;
					entry.Deployed = 'True';
					entry.Label = entry.Name;
					//i++;
				});
        	}
			if(attributes) {
				parsedData.PhysicalProductAttributes = attributes;
			}
			parsedData.UnicityCheck = data.UnicityCheck;
			return parsedData;
            //return data;
        },
		
		/**
         * Function will retrieve the security context
         * @returns {function} calls back the promise resolve method with the security context fetched from service
         */
   //     retrieveSecurityContext: function(){
   //         var that = this;
   //         return new Promise(function (resolve, reject) {
   //             WAFData.authenticatedRequest(URLHandler.getURL() + '/resources/pno/person/getsecuritycontext', {
   //                 method: 'GET',
   //                 type: 'json',
   //                 headers : {
   //                     Accept: 'application/json',
   //                     'Content-Type': 'application/json'
   //                 },
   //                 onComplete:function(resp){
   //					_securityContext = resp.SecurityContext;
   //                     //that._securityContext = resp.SecurityContext;
   //                     resolve('Done');
   //                 },
   //                 onFailure : reject,
   //                 onTimeout: reject
   //             });
   //         });
   //     }

    });
});

define('DS/ParameterizationSkeleton/Collection/ParameterizationReconciliationReportCollection', [
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
], function (UWA, Model, Collection, WAFData, URLHandler) {
    'use strict';
    
    var handledDomain = null, cellArrayValue;

    return Collection.extend({
        model : function (modelid) {
             return Model.extend();
        },

        setup: function (models, options) {
        	UWA.log('ParameterizationReconciliationReportCollection::setup');

        	UWA.log(models);
        	UWA.log(options);

            var
                _modelKey = options._modelKey,
                domainID = _modelKey._attributes.domainid;

            if (UWA.is(this.model, "function")) {
                this.model = this.model(domainID);
                handledDomain = domainID;
            }
        	console.log("ParameterizationReconciliationReportCollection::setup, Successful");

        },

        sync : function(method, model, options) {
            UWA.log('ParameterizationReconciliationReportCollection::sync');
            options.contentType = 'application/json';
            options.headers = {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
            };
            options.lang = widget.lang;

            this.url = URLHandler.getURL() + "/resources/batchReport/execute?tenant=" + URLHandler.getTenant();

            /*this.reset([
                {
                    value : "ca marche"

                },
                {
                    value : "un peu avant"
                }
            ]);*/

/*            options._modelKey.attributes.cellArrayValue = [
                {
                    value : "ca marche"

                },
                {
                    value : "un peu avant"
                }
            ];*/

            //this.dispatchEvent("onSync");

            UWA.log(options);
            console.log("ParameterizationReconciliationReportCollection::sync, Successful");
        },

        parse: function (data) {
            UWA.log("ParameterizationReconciliationReportCollection::parse");
            UWA.log(data);
            console.log("ParameterizationReconciliationReportCollection::parse, Successful");
            return this.parseMappingData(data);           
        },

        create: function(attributes, options) {
            options.proxy = 'passport';
            console.log("ParameterizationReconciliationReportCollection::create, Successful");
            //this._parent.apply(this, [attributes, options]);
        },   

        parseMappingData: function (data) {        	
            return data;
        }

    });
});

define('DS/ParameterizationSkeleton/Collection/ParameterizationDisplayProperties/ParamDPDisplayUnitsCollection', [
    'UWA/Core',
    'UWA/Class/Collection',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
    'DS/ParameterizationSkeleton/Model/ParameterizationDomainsListModel',
], (
    UWA,
    Collection,
    WAFData,
    URLHandler,
    ParameterizationDomainsListModel,
) => {
    //
    let handledDomain = null;

    return Collection.extend({
        model: ParameterizationDomainsListModel,

        setup(models, options) {
            UWA.log('ParamDPDisplayUnitsCollection::setup');

            UWA.log(models);
            UWA.log(options);

            console.log('ParamDPDisplayUnitsCollection::setup, Sucessful');
            let iURL; let iObjID;
            const { _modelKey } = options;
            const domainID = _modelKey._attributes.domainid;
            const familyID = _modelKey._attributes.familyid;

            if (UWA.is(this.model, 'function')) {
                this.model = this.model(domainID);
                handledDomain = domainID;
            }

            iObjID = _modelKey._attributes.id;
            
            //this.url = `${URLHandler.getURL()}/resources/v1/UXPropertiesParameterization/getParameters?tenant=${URLHandler.getTenant()}`+ "&familyid=" + familyID;
            this.url = `${URLHandler.getURL()}/resources/v1/UXPropertiesParameterization/getParameters?tenant=${URLHandler.getTenant()}`+"&paramID="+"DisplayUnitsParam";
        },

        sync(method, model, options) {
            UWA.log('ParamDPDisplayUnitsCollection::sync');
            options.contentType = 'application/json';
            options.lang = widget.lang;

            options.headers = {
                Accept: 'application/json',
                'Content-Type': 'application/json',
                'Accept-Language': widget.lang,
            };

            UWA.log(options);

            options = { ajax: WAFData.authenticatedRequest, ...options };
            this._parent.apply(this, [method, model, options]);
        },

        parse(data) {
            UWA.log('ParamDPDisplayUnitsCollection::parse');
            UWA.log(data);

            return data;
        },

        create(attributes, options) {
            options.proxy = 'passport';
            this._parent.apply(this, [attributes, options]);
        }

    });
});

define('DS/ParameterizationSkeleton/Collection/ParameterizationXEN/ParamXENPartNumberFormulaCollection', [
    'UWA/Core',
    'UWA/Class/Collection',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
    'DS/ParameterizationSkeleton/Model/ParameterizationXEN/ParamXENModel',
], (
    UWA,
    Collection,
    WAFData,
    URLHandler,
    ParamXENModel,
) => {
    //
    let handledDomain = null;

    return Collection.extend({
        model: ParamXENModel,

        setup(models, options) {
            UWA.log('ParamXENPartNumberFormulaCollection::setup');

            UWA.log(models);
            UWA.log(options);

            console.log('ParamXENPartNumberFormulaCollection::setup, Sucessful');
            let iURL; let iObjID;
            const { _modelKey } = options;
            const domainID = _modelKey._attributes.domainid;
            const familyID = _modelKey._attributes.familyid;

            if (UWA.is(this.model, 'function')) {
                this.model = this.model(domainID);
                handledDomain = domainID;
            }

            iObjID = _modelKey._attributes.id;
            this.url = `${URLHandler.getURL()}/resources/v1/xENGParameterization/getAdminPartNumberProperties?tenant=${URLHandler.getTenant()}`;
        },

        sync(method, model, options) {
            UWA.log('ParamXENPartNumberFormulaCollection::sync');
            options.contentType = 'application/json';
            options.lang = widget.lang;

            options.headers = {
                Accept: 'application/json',
                'Content-Type': 'application/json',
                'Accept-Language': widget.lang,
            };

            UWA.log(options);

            options = { ajax: WAFData.authenticatedRequest, ...options };
            this._parent.apply(this, [method, model, options]);
        },

        parse(data) {
            UWA.log('ParamXENPartNumberFormulaCollection::parse');
            UWA.log(data);

            return this.parseMappingData(data);
        },

        create(attributes, options) {
            options.proxy = 'passport';
            this._parent.apply(this, [attributes, options]);
        },

        parseMappingData(data) {
            if (data.ExpressionList) {
                data.ExpressionList.sort((a, b) => {
                    if (a.Order && b.Order) {
                        return a.Order - b.Order;
                    }
                });
            }

            return data;
        },

    });
});

define('DS/ParameterizationSkeleton/Collection/ParameterizationDOCMCollection', [
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
 //   'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
], function (UWA, Model, Collection, WAFData, URLHandler) {
    'use strict';
    
    var handledDomain = null;

    return Collection.extend({
        model : function (modelid) {
             return Model.extend();
        },

        setup: function (models, options) {
        	UWA.log('ParameterizationDOCMCollection::setup');

        	UWA.log(models);
        	UWA.log(options);

        	console.log("ParameterizationDOCMCollection::setup, Successful");
        	var iObjID,
        	_modelKey = options._modelKey,
        	domainID = _modelKey._attributes.domainid;

        	if (UWA.is(this.model, "function")) {
        		this.model = this.model(domainID);
        		handledDomain = domainID;
        	}

        	iObjID = _modelKey._attributes.id;
        	this.url = URLHandler.getURL() +                    
        	"/resources/v1/docmParameterization/DOCMConfigurationRule?tenant=" + URLHandler.getTenant();
        },

        sync : function(method, model, options) {
            UWA.log('ParameterizationDOCMCollection::sync');
            options.contentType = 'application/json';
            options.lang = widget.lang;

            options.headers = {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                'Accept-Language' : widget.lang
            };

            UWA.log(options);

            options = Object.assign({
                ajax: WAFData.authenticatedRequest
            }, options);  
            this._parent.apply(this, [method, model, options]);
        },

        parse: function (data) {
            UWA.log("ParameterizationDOCMCollection::parse");
            UWA.log(data);

            return this.parseMappingData(data);           
        },

        create: function(attributes, options) {
            options.proxy = 'passport';
            this._parent.apply(this, [attributes, options]);
        },   

        parseMappingData: function (data) {        	
            return data;
        }

    });
});

/* global widget */
define('DS/ParameterizationSkeleton/Collection/ParameterizationSystemsSafetyCollection', [
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
], function(
    UWA,
    Model,
    Collection,
    WAFData,
    URLHandler
) {
    'use strict';

    return Collection.extend({
        model: function() {
            return Model.extend();
        },

        setup: function(models, options) {
            UWA.log('ParameterizationSystemsSafetyCollection::setup');
            if (typeof this.model === 'function') {
                this.model = this.model(options._modelKey._attributes.domainid);
            }
            this.url = URLHandler.getURL() + '/resources/sfy/parameters?tenant=' + URLHandler.getTenant();
        },

        sync: function(method, model, options) {
            options.contentType = 'application/json';
            options.lang = widget.lang;

            options.headers = {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                'Accept-Language': widget.lang
            };
            UWA.log('ParameterizationSystemsSafetyCollection::sync');

            options = Object.assign({
                ajax: WAFData.authenticatedRequest
            }, options);
            this._parent(method, model, options);
        },

        parse: function(data) {
            UWA.log('ParameterizationSystemsSafetyCollection::parse');
            return this.parseMappingData(data);
        },

        create: function(attributes, options) {
            UWA.log('ParameterizationSystemsSafetyCollection::create');
            options.proxy = 'passport';
            this._parent(attributes, options);
        },

        parseMappingData: function(data) {
            var parsedData = {};

            var paramData = data.parameters;
            if (paramData) {
                parsedData.parameters = paramData;
                parsedData.parameters.sort(function(a, b) {
                    if (typeof a.type === 'string' && typeof b.type === 'string') {
                        return a.type.localeCompare(b.type);
                    }
                });
                parsedData.parameters.forEach(function(entry) {
                    entry.deployed = true;
                });
            }
            UWA.log('ParameterizationSystemsSafetyCollection::parsedData');
            return parsedData;
        }
    });
});

define('DS/ParameterizationSkeleton/Collection/ParameterizationXEN/ParamXENPartNumberAdminCollection', [
    'UWA/Core',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
    'DS/ParameterizationSkeleton/Model/ParameterizationXEN/ParamXENModel',
    'DS/WAFData/WAFData',
], (UWA,
    Collection,
    URLHandler,
    ParamXENModel,
    WAFData,
) => {
    const collabManagementCollection = Collection.extend({

        model: ParamXENModel,

        setup(models, options) {
            UWA.log('ParamXENPartNumberAdminCollection::setup');
            UWA.log(options);
            this.childCollection = null;
            const { _modelKey } = options;
            const domainID = _modelKey._attributes.domainid;
            const familyID = _modelKey._attributes.familyid;
            this.url = `${URLHandler.getURL()}/resources/ParamWS/access/DomainElements?tenant=${URLHandler.getTenant()}&domainid=ENGDefinationManagement&familyid=${familyID}`;
        },

        sync(method, model, options) {
            UWA.log('ParamXENPartNumberAdminCollection::sync');

            options.headers = {
                Accept: 'application/json',
                'Accept-Language': widget.lang,
            };

            options = { ajax: WAFData.authenticatedRequest, ...options };

            this._parent.apply(this, [method, model, options]);
        },

        parse(data) {
            UWA.log('ParamXENPartNumberAdminCollection::parse');
            UWA.log(data);
            const familyDetails = data;

            return familyDetails;
        },

        create(attributes, options) {
            options.proxy = 'passport';
            this._parent.apply(this, [attributes, options]);
        },

    });

    return collabManagementCollection;
});

/**
 * @author AMN14
 */
define('DS/ParameterizationSkeleton/Collection/ParamCollaboration/CollabManagementCollection', [
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
    'DS/ParameterizationSkeleton/Model/ParamCollaboration/CollabManagementModel',
    'i18n!DS/ParameterizationSkeleton/assets/nls/CollaborationManagementNLS',
    'DS/WAFData/WAFData',
    'WebappsUtils/WebappsUtils'
], function ( UWA,
              Model,
              Collection,
              ParamDataUtils,
              URLHandler,
              CollabManagementModel,
              CollabManagementNLS,
              WAFData,
              WebappsUtils
            ) {
              'use strict';


              var collabManagementCollection = Collection.extend({

                  model : CollabManagementModel,

                  setup : function (models, options) {
                      UWA.log('CollabManagementCollection::setup');
                      UWA.log(options);

                      this.childCollection = null;

                      var _modelKey = options._modelKey,
                          domainID = _modelKey._attributes.domainid,
                          familyID = _modelKey._attributes.familyid;

                      this.url = WebappsUtils.getWebappsAssetUrl('ParameterizationSkeleton', 'CollabManagement_Entries.json');
                  },


                  sync : function(method, model, options) {
                      UWA.log("CollabManagementCollection::sync");

                      options.headers = {
                          Accept: 'application/json',
                          'Accept-Language' : widget.lang
                      };

                      options = Object.assign({
                          ajax: WAFData.authenticatedRequest
                      }, options);

                      this._parent.apply(this, [method, model, options]);
                  },


                  parse: function (data) {
                      UWA.log("CollabManagementCollection::parse");
                      UWA.log(data);

                      var collabEntries = [];

                      if(Array.isArray(data)) {

                        data.forEach(function(collabEntry) {
                          var title = CollabManagementNLS.CollaborationManagement[collabEntry.domainid + "Text"];
                          var tooltip = CollabManagementNLS.CollaborationManagement[collabEntry.domainid + "Tooltip"];

                          collabEntries.push({
                            title              : title,
                            subtitle           : tooltip,
                            image              : URLHandler.getURL() + "/webapps/ParameterizationSkeleton/assets/img/" + collabEntry.image,
                            id                 : collabEntry.domainid + collabEntry.familyid,
                            domainid           : collabEntry.domainid
                          });
                        });
                      }

                      return collabEntries;
                  },

                  create : function(attributes, options) {
                      options.proxy = 'passport';
                      this._parent.apply(this, [attributes, options]);
                  }

              }
            );

            return collabManagementCollection;
          }
);

define('DS/ParameterizationSkeleton/Collection/ParameterizationFSXCollection', [
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
], function (UWA, Model, Collection, ParameterizationDataUtils, WAFData, URLHandler) {
    'use strict';

    var handledDomain = null;

    return Collection.extend({
        model: function (modelid) {
            return Model.extend();
        },

        setup: function (models, options) {
            UWA.log('ParameterizationFSXCollection::setup');

            UWA.log(models);
            UWA.log(options);
           
            var _modelKey = options._modelKey;
            var domainID = _modelKey._attributes.domainid;

            if (UWA.is(this.model, "function")) {
                this.model = this.model(domainID);               
            }
            handledDomain = domainID;
            
            this.url = URLHandler.getURL() +
                "/resources/v1/fsxparam/getStandardFsxOwnership?tenant=" + URLHandler.getTenant();
        },

        sync: function (method, model, options) {
            UWA.log('ParameterizationFSXCollection::sync');
            options.contentType = 'text/plain';
            options.lang = widget.lang;

            options.headers = {
                'Content-Type': 'application/json',
                'Accept': 'application/json',
                'Accept-Language': widget.lang
            };

            UWA.log(options);

            options = Object.assign({
                ajax: WAFData.authenticatedRequest
            }, options);
            this._parent.apply(this, [method, model, options]);
        },

        parse: function (data) {
            UWA.log("ParameterizationFSXCollection::parse");
            UWA.log(data);

            return this.parseMappingData(data);
        },

        create: function (attributes, options) {
            options.proxy = 'passport';
            this._parent.apply(this, [attributes, options]);
        },

        parseMappingData: function (data) {
            return data;
        }

    });
});

define('DS/ParameterizationSkeleton/Views/ParameterizationXEngineering/XENMgmtView', [
    'UWA/Core',
    'UWA/Class/View',
    'DS/W3DXComponents/Views/Layout/ListView',
    'DS/ParameterizationSkeleton/Views/ParameterizationXEngineering/XENTileView',
], (
    UWA,
    View,
    ListView,
    XENTileView,
) => View.extend({

    defaultOptions: {
        type: 'default',
    },

    init(options) {
        UWA.log('XENMgmtView::init');
        UWA.log(options);

        this.options = options;
        this.childView = null;
    },

    render() {
        UWA.log('XENMgmtView::render');
        this.childView = new XENTileView(this.options);
        return this.childView.render();
    },

    onCompletedCollabEntriesRequest() {
        UWA.log('XENMgmtView::onCompletedEntriesRequest');
        console.log(this.collection);
    },

    destroy() {
        this.childView.destroy();
        this.stopListening();
        this._parent.apply(this, arguments);
    },
}));

/*! Copyright 2017, Dassault Systemes. All rights reserved. */
/*global define, widget, document, setTimeout, console*/
/*jslint nomen: true */
/*@fullReview  ZUR 15/11/23 2017x Param Widgetization NG*/
/*@fullReview  NZV 17/06/12 HL FUN060421, Interface name/Attribute group name set as InterfaceID (parseAttributesData)*/
/*@quickReview ZUR 18/04/24 FUN079262 2019x : EBOM-PS Collaboration Mapping Object Widget*/

define('DS/ParameterizationSkeleton/Collection/ParameterizationParentCollection', [
    // UWA
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Model/ParameterizationDomainModel',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
    'DS/ParameterizationSkeleton/Model/ParameterizationDataModeling/TypesListModel',
    'DS/ParameterizationSkeleton/Model/ParameterizationLifecycle/LifecycleListModel',
    'DS/ParameterizationSkeleton/Model/ParameterizationXCAD/XCADListModel',
    'DS/WAFData/WAFData',
    'WebappsUtils/WebappsUtils'
], function (UWA, Model, Collection, ParameterizationDomainModel,
             ParamDataUtils, URLHandler, TypesListModel, LifecycleListModel, XCADListModel, WAFData, WebappsUtils) {
    'use strict';
    //

    var handledDomain = null;

    //var  ParameterizationParentCol = 
    return Collection.extend({
        model : function (modelid) {
            UWA.log('ParameterizationParentCollection::model');
            if (modelid === "AttributeDef") {
                UWA.log('ParameterizationParentCollection::TypesListModel');
                return TypesListModel;
            }
            if (modelid === "LifecycleTopology") {
                UWA.log('ParameterizationParentCollection::LifecycleListModel');
                return LifecycleListModel;
            }
            if (modelid === "XCADParametrization") {
                UWA.log('ParameterizationParentCollection::XCADListModel');
                return XCADListModel;
            }

            return ParameterizationDomainModel;//previously worked only with ParameterizationDomainModel 
        },

        //model:ParameterizationDomainModel,
        setup: function (models, options) {
            UWA.log('ParameterizationParentCollection::setup');
            this.childCollection = null;

            UWA.log(models);
            UWA.log(options);
            /*var options2 = this.options;
            UWA.log(options2);*/

            console.log("ParameterizationParentCollection::setup, la suite");
            var iURL,
                _modelKey = options._modelKey,
                domainID = _modelKey._attributes.domainid,
                familyID = _modelKey._attributes.familyid;

            if (UWA.is(this.model, "function")) {
                this.model = this.model(domainID);
                handledDomain = domainID;
            }

            if (domainID === 'AttributeDef') {
                this.url = URLHandler.getURL() + "/resources/ParamWS/datamodel/listofsupportedtypes?tenant=" + URLHandler.getTenant();
                UWA.log("ParameterizationParentCollection::AttributeDef");
            } else if (domainID === 'LifecycleTopology') {
                this.url = URLHandler.getURL() + "/resources/ParamWS/lifecycle/listoflifecycles?tenant=" + URLHandler.getTenant();
                UWA.log("ParameterizationParentCollection::Setting lifecycle URLs");
             } else if (domainID === 'XCADParameterization') {
                this.url = URLHandler.getURL() + "/resources/xcadparam/gco/list?tenant=" + URLHandler.getTenant();
                UWA.log("ParameterizationParentCollection::Setting lifecycle URLs");
           } else {
                iURL = URLHandler.getURL() + "/resources/ParamWS/access/DomainElements?tenant=" + URLHandler.getTenant() + "&domainid=" + domainID;

                if ((familyID !== null) && (familyID !== "")) {
                    iURL = iURL + "&familyid=" + familyID;
                }
                this.url = iURL;
                //this.childCollection = new ParameterizationDomainCollection();
                //return this.childCollection.setup(models, options);
            }


            /*
            iURL = URLHandler.getURL() + "/resources/ParamWS/access/DomainElements?tenant=" + URLHandler.getTenant() + "&domainid=" + domainID;
            if ((familyID !== null) && (familyID !== "")) {
                iURL = iURL + "&familyid=" + familyID;
            }
            UWA.log(iURL);
            this.url = iURL;*/
            /*{"domainid": "AttributeDef","familyid": "","image": "paramAttributeDef.gif"}, 
              { "domainid": "ObjectIdentification", "familyid": "VersionNaming", "image": "paramVersionNaming.gif"}*/
        },

            /*init : function (models, options) {
            UWA.log('ParameterizationParentCollection::init');
            this.childCollection = null;
            this.mychosenModel = null;
            this.setup(models, options);
        },*/
        /*model : function (options) {
            //return this.mytest(options);
            
            //return ParameterizationParentCol.mytest(options);
            return ParameterizationDomainModel;
        },*/
        //model : ParameterizationParentCol.mytest(options),
        //model : this.mychosenModel,
        //model : ParameterizationDomainModel,
        //Application.version >= 2 ? TriangleV2 : Triangle;

        /*sync : function(method, model, options) {
            UWA.log('ParameterizationParentCollection::sync');
            options.contentType = 'application/json';//application/ds-json
            options.proxy = 'passport';
            options.lang = widget.lang;

            options.headers = {
                Accept: 'application/json',
                'Content-Type': 'application/json'
            };

            UWA.log(options);
            //console.log(model);
            //this.childCollection.sync(method, model, options);
            this._parent.apply(this, [method, model, options]);
        },*/

        sync : function(method, model, options) {
            UWA.log("ParameterizationParentCollection::sync::WD");
            //options.contentType = 'application/json';
            //options.proxy = 'passport';
            //options.lang = widget.lang;
            //options.lang = I18n.getCurrentLanguage(); doesn't work correctly
            //options.lang = widget.lang;
            //options.type = 'json';

            options.headers = {
                Accept: 'application/json',
               // 'Content-Type': 'application/json',
                'Accept-Language' : widget.lang
            };
            //ZUR in options.headers 'Accept-Language' : widget.lang --> IR-454515-3DEXPERIENCER2017x

			// SDM-2023/11/30: IR-1201121-3DEXPERIENCER2024x
			options.timeout = 180000; // 3 mns
			options.onTimeout = function(e) {console.log("ERROR: WebService timeout after 3 mn!")};

            options = Object.assign({
                ajax: WAFData.authenticatedRequest
            }, options);

            this._parent.apply(this, [method, model, options]);
        },


        parse: function (data) {
            UWA.log("ParameterizationParentCollection::parse");
            //return this.childCollection.parse(data);
            UWA.log(data);

            if (handledDomain === "AttributeDef") {
                return this.parseAttributesData(data);
            }

            if (handledDomain === "LifecycleTopology") {
                return this.parseLifecylesData(data);
            }

            if (handledDomain === "XCADParameterization") {
                return this.parseXCADData(data);
            }

            var familyModel = ParamDataUtils.paramStructBuilder("id,family"),
                oData = new familyModel("", ""),
                Families = [];

            if (Array.isArray(data.family)) {
                data.family.forEach(function (rElement) {
                    Families.push(rElement);
                });
            }

            oData.id = data.id;
            oData.family = Families;
            return oData;
        },
		//FUN151396 
        /*create: function(attributes, options) {
            options.proxy = 'passport';
            this._parent.apply(this, [attributes, options]);
        },*/

        parseAttributesData : function (data) {
            var paramEntries = [], paramTitle, paramSubTitle;

            if (Array.isArray(data.typeDescription)) {
                data.typeDescription.forEach(function (iElement) {
                    if (typeof iElement.interfaceID != "undefined" && iElement.interfaceID !== "") {
                        paramTitle = iElement.nlsName + ' - ' + iElement.interfaceID;
                        paramSubTitle = iElement.interfaceID;
                    } else {
                        paramTitle = iElement.nlsName;
                        paramSubTitle = iElement.id;
                    }
                    paramEntries.push({
                        title              : paramTitle,
                        subtitle           : paramSubTitle,
                        image              : URLHandler.getURL() + "/webapps/ParameterizationSkeleton/assets/img/" + "paramAttributeDef.png",
                        id                 : iElement.id,
                        domainid           : data.domainid
                        
                    });
                });
            }
            //ZUR - FUN079262 - 2019x : Deactivating Synchro Tile in Attributes Management, functionality moved to the new domain MappingManagement
            /*paramEntries.push({
                title          : ParamSkeletonNLS.PhysicalBOMCollabTitle,
                subtitle       : ParamSkeletonNLS.PhysicalBOMCollabTitle,
                image          : URLHandler.getURL() + "/webapps/ParameterizationSkeleton/assets/img/" + "paramAttributeSynchro.gif",
                id             : 'AttributeSynchronization',
                domainid       : data.domainid,
                sixwTagDescription : ''
            });*/
            // Promoted with IR IR-651121-3DEXPERIENCER2019x
           paramEntries.sort(function (paramEnt1, paramEnt2) {
                if (paramEnt1.title !== undefined && paramEnt2.title !== undefined) {
                    return paramEnt1.title.localeCompare(paramEnt2.title);
                } else {
                    // not possible case
                    console.log("sorting failed : " + paramEnt1);
                    console.log(paramEnt2);
                    return 0;
                }                
            });
            return paramEntries;
        },

        parseLifecylesData: function (data) {
            UWA.log("LifecycleListCollection::parse");
            UWA.log(data);
            var policies;

            UWA.log(URLHandler.getURL());
            if (Array.isArray(data.lifecycleDescription)) {

                policies = [];

                data.lifecycleDescription.forEach(function (ipolicy) {

                    policies.push({
                        title          : ipolicy.title,
                        subtitle       : ipolicy.id,
                        //content        : ipolicy.content,
                        image          : URLHandler.getURL() + "/webapps/ParameterizationSkeleton/assets/img/" + "paramLifecycleTopology.png",
                        id             : ipolicy.id,
                        domainid       : data.domainid,
                        modifyTopology : (ipolicy.areTransitionsEditable === "true"),
                        renameStates   : (ipolicy.areStatesRenamable === "true"),
                        supportRules   : (ipolicy.supportsPromoteRules === "true")
                        // parent: role.parent,//    child: role.child,
                    });
                });
            }
           // Promoted with IR IR-651121-3DEXPERIENCER2019x
           policies.sort(function (paramEnt1, paramEnt2) {
                if (paramEnt1.title !== undefined && paramEnt2.title !== undefined) {
                    return paramEnt1.title.localeCompare(paramEnt2.title);
                } else {
                    // not possible case
                    console.log("sorting failed : " + paramEnt1);
                    console.log(paramEnt2);
                    return 0;
                }                
            });
            return policies;
        },

      parseXCADData : function (data) {
          var paramEntries = [];
          
          if (Array.isArray(data.xcadDescription)) {
            data.xcadDescription.forEach(function (iElement) {
              paramEntries.push({
                title              : iElement.nlsName,
                subtitle           : '',
                image              : URLHandler.getURL() + "/webapps/ParameterizationSkeleton/assets/img/paramXCAD" + iElement.icon + ".png",
                id                 : iElement.id,
                domainid           : "XCADParameterization"
                
              });
            });
          }
          return paramEntries;
        }


    });

    //return ParameterizationParentCol;
});

/**
 * @author AMN14
 */
define('DS/ParameterizationSkeleton/Collection/ParameterizationSAX/ParamSAXCollection', [
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
    'DS/ParameterizationSkeleton/Model/ParameterizationSAX/ParamSAXModel',
    'i18n!DS/ParameterizationSkeleton/assets/nls/FLWebNLS',
    'DS/WAFData/WAFData',
    'WebappsUtils/WebappsUtils'
], function ( UWA,
              Model,
              Collection,
              ParamDataUtils,
              URLHandler,
              ParamSAXModel,
               FLWebNLS,
              WAFData,
              WebappsUtils
            ) {
              'use strict';


              var collabManagementCollection = Collection.extend({

                  model : ParamSAXModel,

                  setup : function (models, options) {
                      UWA.log('SAXCollection::setup');
                      UWA.log(options);
                      this.childCollection = null;
                      var _modelKey = options._modelKey,
                          domainID = _modelKey._attributes.domainid,
                          familyID = _modelKey._attributes.familyid;
                      this.url = WebappsUtils.getWebappsAssetUrl('ParameterizationSkeleton', 'ParamSAX_Entries.json');
                  },


                  sync : function(method, model, options) {
                      UWA.log("SAXCollection::sync");

                      options.headers = {
                          Accept: 'application/json',
                          'Accept-Language' : widget.lang
                      };

                      options = Object.assign({
                          ajax: WAFData.authenticatedRequest
                      }, options);

                      this._parent.apply(this, [method, model, options]);
                  },


                  parse: function (data) {
                      UWA.log("SAXCollection::parse");
                      UWA.log(data);

                      var SAX_Entries = [];

                      if(Array.isArray(data)) {

                        data.forEach(function(SAX_Entry) {
                          var title = FLWebNLS[SAX_Entry.familyid + "Text"];
                          var tooltip = FLWebNLS[SAX_Entry.familyid + "Tooltip"];

                          SAX_Entries.push({
                            title              : title,
                            subtitle           : tooltip,
                            image              : URLHandler.getURL() + "/webapps/ParameterizationSkeleton/assets/img/" + SAX_Entry.image,
                            id                 : SAX_Entry.domainid + SAX_Entry.familyid,
                            familyid           : SAX_Entry.familyid,
                            domainid           : SAX_Entry.domainid
                          });
                        });
                      }

                      return SAX_Entries;
                  },

                  create : function(attributes, options) {
                      options.proxy = 'passport';
                      this._parent.apply(this, [attributes, options]);
                  }

              }
            );

            return collabManagementCollection;
          }
);

define('DS/ParameterizationSkeleton/Collection/ConfigurationManagementCollection', [
    // UWA
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
], function (UWA, Model, Collection, ParameterizationDataUtils, WAFData, URLHandler) {
    'use strict';
    //

    var handledDomain = null;

    return Collection.extend({
        model : function (modelid) {
             return Model.extend();
        },

        setup: function (models, options) {
            UWA.log('ConfigurationManagement::setup');

            UWA.log(models);
            UWA.log(options);

            console.log("ConfigurationManagement::setup, Sucessful");
            var iURL, iObjID,
                _modelKey = options._modelKey,
                domainID = _modelKey._attributes.domainid,
                familyID = _modelKey._attributes.familyid;

            if (UWA.is(this.model, "function")) {
                this.model = this.model(domainID);
                handledDomain = domainID;
            }

                iObjID = _modelKey._attributes.id;
               // this.url = URLHandler.getURL() + //Call WebService <- New URL Handler
                //    "/3DSpace/resources/modeler/configuration/settingsServices/getConfiguredExpressionXSLTDefault?tenant=" + URLHandler.getTenant();
        },

        sync : function(method, model, options) {
            UWA.log('ConfigurationManagement::sync');
            options.contentType = 'application/json';
            options.lang = widget.lang;

            options.headers = {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                'Accept-Language' : widget.lang
            };

            UWA.log(options);

            options = Object.assign({
                ajax: WAFData.authenticatedRequest
            }, options);  
            this._parent.apply(this, [method, model, options]);
        },

        parse: function (data) {
            UWA.log("ConfigurationManagement::parse");
            UWA.log(data);

            return this.parseMappingData(data);
           
        },

        create: function(attributes, options) {
            options.proxy = 'passport';
            this._parent.apply(this, [attributes, options]);
        },

    

        parseMappingData: function (data) {
        	if(data.ExpressionList){
	    		data.ExpressionList.sort(function(a, b){
	    			if(a.Order && b.Order){
	    				return a.Order - b.Order;
	    			}
	    		});
        	}
        	
            return data;
        }

    });
    });





define(
  'DS/ParameterizationSkeleton/Utils/DELConfigurationParameterization/DELConfigurationParameterizationWebServices',
  [
    'UWA/Core',
    'UWA/Class',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
  ],
  function(
    UWA,
    Class,
    WAFData,
    URLHandler
  ) {

    'use strict';

      var DELConfigurationParameterizationWebServices = Class.singleton({

        getEnvVar : function (callback) {
            var url = URLHandler.getURL() + "/resources/delmia/param/application/getEnvVar";

            WAFData.authenticatedRequest(url, {
                timeout: 100000,
                method: 'GET',
                type: 'json',
                headers: {
                    'Content-Type' : 'application/json',
                    'Accept' : 'application/json'
                },

                onFailure : function (json) {
                    callback.onFailure(json);
                },

                onComplete: function(json) {
                  callback.onSuccess(json);
                }
            });
        },

        getAllParameters : function (domainid, callback) {

            //var url = URLHandler.getURL() + "/resources/exchange/param/apriso/configuration/getParameters?familyID=";
            var url = URLHandler.getURL() + "/resources/delmia/param/configuration/getAllParameters";
            if ((domainid != null || domainid != undefined))
              url += "?domainID=" + domainid;

            WAFData.authenticatedRequest(url, {
                timeout: 100000,
                method: 'GET',
                type: 'json',
                headers: {
                    'Content-Type' : 'application/json',
                    'Accept' : 'application/json'
                },

                onFailure : function (json) {
                    callback.onFailure(json);
                },

                onComplete: function(json) {
                  callback.onSuccess(json);
                }
            });
        },

          getParameters : function (domainid, familyid, paramid, argid, callback) {

              //var url = URLHandler.getURL() + "/resources/exchange/param/apriso/configuration/getParameters?familyID=";
              var url = URLHandler.getURL() + "/resources/delmia/param/configuration/getParameters";
              if ((argid != null || argid != undefined) &&
                  (paramid != null || paramid != undefined) &&
                  (familyid != null || familyid != undefined) &&
                  (domainid != null || domainid != undefined))
                url += "?argID=" + argid + "&paramID=" + paramid + "&familyID=" + familyid + "&domainID=" + domainid;

              WAFData.authenticatedRequest(url, {
                  timeout: 100000,
                  method: 'GET',
                  type: 'json',
                  headers: {
                      'Content-Type' : 'application/json',
                      'Accept' : 'application/json'
                  },

                  onFailure : function (json) {
                      callback.onFailure(json);
                  },

                  onComplete: function(json) {
                    callback.onSuccess(json);
                  }
              });
          },

          setParameters : function (domainid, familyid, paramid, argid, params, callback) {

              //var url = URLHandler.getURL() + "/resources/exchange/param/apriso/configuration/setParameter";
              var url = URLHandler.getURL() + "/resources/delmia/param/configuration/setParameter";
              /*var datatoSend = {
                  params : params
              };*/

              var datatoSend = {
                domain : domainid,
                family : familyid,
                parameter : paramid,
                argument : argid,
                params : params
              }

              WAFData.authenticatedRequest(url, {
                  timeout: 100000,
                  method: 'POST',
                  data: JSON.stringify(datatoSend),
                  type: 'json',
                  headers: {
                      'Content-Type' : 'application/json',
                      'Accept' : 'application/json'
                  },

                  onFailure : function (json) {
                      callback.onFailure(json);
                  },

                  onComplete: function(json) {
                    callback.onSuccess(json);
                  }
              });
          },

          isDeployed : function (domainid, familyid, paramid, argid, params, callback) {

              //var url = URLHandler.getURL() + "/resources/exchange/param/apriso/configuration/isDeployed";
              var url = URLHandler.getURL() + "/resources/delmia/param/configuration/isDeployed";
              /*var datatoSend = {
                  params : params
              };*/

              var datatoSend = {
                domain : domainid,
                family : familyid,
                parameter : paramid,
                argument : argid,
                params : params
              }

              WAFData.authenticatedRequest(url, {
                  timeout: 100000,
                  method: 'POST',
                  data: JSON.stringify(datatoSend),
                  type: 'json',
                  headers: {
                      'Content-Type' : 'application/json',
                      'Accept' : 'application/json'
                  },

                  onFailure : function (json) {
                      callback.onFailure(json);
                  },

                  onComplete: function(json) {
                    callback.onSuccess(json);
                  }
              });
          },

          deleteParameter : function (domainid, familyid, paramid, argid, params, callback) {

              //var url = URLHandler.getURL() + "/resources/exchange/param/apriso/configuration/deleteParameter";
              var url = URLHandler.getURL() + "/resources/delmia/param/configuration/deleteParameter";
              /*var datatoSend = {
                  params : params
              };*/

              var datatoSend = {
                domain : domainid,
                family : familyid,
                parameter : paramid,
                argument : argid,
                params : params
              }

              WAFData.authenticatedRequest(url, {
                  timeout: 100000,
                  method: 'POST',
                  data: JSON.stringify(datatoSend),
                  type: 'json',
                  headers: {
                      'Content-Type' : 'application/json',
                      'Accept' : 'application/json'
                  },

                  onFailure : function (json) {
                      callback.onFailure(json);
                  },

                  onComplete: function(json) {
                    callback.onSuccess(json);
                  }
              });
          },


          deleteAllParameters : function (callback) {

              var url = URLHandler.getURL() + "/resources/exchange/param/apriso/configuration/deleteAllParameters";

              WAFData.authenticatedRequest(url, {
                  timeout: 100000,
                  method: 'DELETE',
                  type: 'json',
                  headers: {
                      'Content-Type' : 'application/json',
                      'Accept' : 'application/json'
                  },

                  onFailure : function (json) {
                      callback.onFailure(json);
                  },

                  onComplete: function(json) {
                    callback.onSuccess(json);
                  }
              });
          }

      });

      return DELConfigurationParameterizationWebServices;
    }
);

/**
* @quickreview  KB9 21:10:25 creation
* @quickreview  ROW 22:10:13 FUN129061 - removed OnPremise specific checks
*/


define('DS/ParameterizationSkeleton/Collection/ParameterizationDELCollection', [
    // UWA
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Model/ParameterizationDomainModel',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
    'DS/WAFData/WAFData',
    'WebappsUtils/WebappsUtils',
    'DS/ParameterizationSkeleton/Utils/DELConfigurationParameterization/DELConfigurationParameterizationWebServices'
], function (
  UWA,
  Model,
  Collection,
  ParameterizationDomainModel,
  ParamDataUtils,
  URLHandler,
  WAFData,
  WebappsUtils,
  DELConfigurationParameterizationWebServices
)
{
    'use strict';
    //
    return Collection.extend({
        model : ParameterizationDomainModel,
        setup: function (models, options) {
            console.log("ParameterizationDELCollection::setup::");

            var that = this;
            var _modelKey = options._modelKey;
            var domainID = _modelKey._attributes.domainid;
            that._domainID = domainID;

            var iURL = URLHandler.getURL() + "/resources/ParamWS/access/DomainElements?tenant=" + URLHandler.getTenant() + "&domainid=" + domainID;
            UWA.log(iURL);
            this.url = iURL
        },

        fetch : function (options) {
          UWA.log("ParameterizationDELCollectionList::setup");
          var that = this;

          // if (widget.getValue('x3dPlatformId') === 'OnPremise')
          // {
          var promiseTab = [];
          var promiseGetParam = new Promise(function (resolve, reject){
            DELConfigurationParameterizationWebServices.getAllParameters(that._domainID, {
              onSuccess : function(data)
              {
                that._paramdata = data;
                resolve();
              },
              onFailure : function(error)
              {
                that._paramdata = [];
                resolve();
                //reject("DELConfigurationParameterizationWebServices.getParameters");
                console.error("DELConfigurationParameterizationWebServices.getParameters");
              }
            });
          });

          promiseTab.push(promiseGetParam);

          /*var promiseConfiguration = new Promise(function (resolve, reject){
            DELConfigurationParameterizationResourceServices.initDELConfigurationProperties({
              onSuccess : function(configData)
              {
                resolve(configData);
              },
              onFailure : function(error)
              {
                reject("DELConfigurationParameterizationResourceServices.initDELConfigurationProperties");
                console.error("DELConfigurationParameterizationResourceServices.initDELConfigurationProperties");
              }
            });
          });

          promiseTab.push(promiseConfiguration);*/

          UWA.Promise.all(promiseTab).then(function(data) {
            Collection.prototype.fetch.call(that);
          });
          // }
          // else {
          //   Collection.prototype.fetch.call(that);
          // }
        },

        sync : function(method, model, options) {
            UWA.log("ParameterizationDELCollection::sync");
           // options.contentType = 'application/json';
            //options.proxy = 'passport';
            options.lang = widget.lang;
            options.type = 'json';

            options.headers = {
                 Accept: 'application/json',
                 'Accept-Language' : widget.lang
                // 'Content-Type': 'application/json'
            };

            options = Object.assign({
                ajax: WAFData.authenticatedRequest
            }, options);

            this._parent.apply(this, [method, model, options]);
        },


          //options.Accept = 'application/json';
            //Content-Type:application/json

        parse: function (data) {
            UWA.log("ParameterizationDELCollection::parse");
            UWA.log(data);

            var that = this;

            var familyModel = ParamDataUtils.paramStructBuilder("id,family"),
                oData = new familyModel("", ""),
                Families = [];

          // if (widget.getValue('x3dPlatformId') === 'OnPremise')
          // {
            if (Array.isArray(data.family)) {
                data.family.forEach(function (rElement) {
                    var listOfParams = that._paramdata;
                    var listOfParamsLength = listOfParams.length;
                    for (var i=0;i<listOfParamsLength;i++)
                    {
                      if (rElement.id === listOfParams[i].familyid)
                      {
                        var listOfAttr = rElement.parameter;
                        var listOfAttrLength = listOfAttr.length;
                        for (var j=0;j<listOfAttrLength;j++)
                        {
                          if (listOfAttr[j].id === listOfParams[i].paramid)
                          {
                            var listOfArg = listOfAttr[j].argument;
                            var listOfArgLength = listOfArg.length;
                            for (var k=0;k<listOfArgLength;k++)
                            {
                              if (listOfArg[k].id === listOfParams[i].argid && listOfParams[i].params.value !== undefined)
                                listOfArg[k].argValue = listOfParams[i].params.value;
                            }
                          }
                        }
                      }
                    }
                    Families.push(rElement);
                });
            }
          // }
          // else {
          //   if (Array.isArray(data.family)) {
          //        data.family.forEach(function (rElement) {
          //            Families.push(rElement);
          //        });
          //    }
          // }

            oData.id = data.id;
            oData.family = Families;

            return oData;
        },

        create: function(attributes, options) {
            options.proxy = 'passport';
            this._parent.apply(this, [attributes, options]);
        }

    });
});



define(
    'DS/ParameterizationSkeleton/Utils/ParameterizationDELUserExperience/ParameterizationDELUserExperienceWebServices',
    [
        'UWA/Core',
        'UWA/Class',
        'DS/WAFData/WAFData',
        'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
    ],
    function(UWA, Class, WAFData, URLHandler) {

        'use strict';

        var ParameterizationDELUserExperienceWebServices = Class.singleton({
            getlistofDELMIATypes : function (types, callback) {

                var url = URLHandler.getURL() + "/resources/delmia/mfgparam/configuration/getlistofDELMIATypes";
                var datatoSend = {
                    types : types
                };

                WAFData.authenticatedRequest(url, {
                    timeout: 100000,
                    method: 'POST',
                    data: JSON.stringify(datatoSend),
                    type: 'json',
                    headers: {
                        'Content-Type' : 'application/json',
                        'Accept' : 'application/json'
                    },

                    onFailure : function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function(json) {
                      callback.onSuccess(json);
                    }
                });
            },
            
            getlistofAllAttributes : function (types, callback) {

                var url = URLHandler.getURL() + "/resources/delmia/mfgparam/configuration/getlistofAttributes";
                var datatoSend = {
                    types : types
                };
                var defaultLanguage = 'en';
                var lang  = UWA.is(widget) ? (UWA.is(widget.lang, 'string') ? widget.lang : defaultLanguage) : defaultLanguage;

                WAFData.authenticatedRequest(url, {
                    timeout: 100000,
                    method: 'POST',
                    data: JSON.stringify(datatoSend),
                    type: 'json',
                    headers: {
                        'Accept-Language': lang,
                        'Content-Type' : 'application/json',
                        'Accept' : 'application/json'
                    },

                    onFailure : function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function(json) {
                      callback.onSuccess(json);
                    }
                });
            },

            getWidgetsCustomization : function (callback) {
                const urlSecurityContext =URLHandler.getURL() +"/resources/pno/person/getsecuritycontext?tenant=" + URLHandler.getTenant();
                console.log("Get security context:");
                WAFData.authenticatedRequest(urlSecurityContext, {
                    timeout : 250000,
                    method : 'GET',
                    data : "",
                    type : 'json',
                    headers : {
                        'Content-Type' : 'application/json',
                        'Accept' : 'application/json'
                    },
                    onFailure : function (json) {
                        console.log('ParameterizationDELUserExperienceWebServices::getWidgetsCustomization - Failure');
                        console.log(json);
                    },
                    onComplete: function(securityContext) {
                        const urlFinal =URLHandler.getURL()+ "/resources/dsmfg/private/V0/invoke/getWidgetsCustomizationForConsole" + "?tenant=" + URLHandler.getTenant();
                        WAFData.authenticatedRequest(urlFinal, {
                            timeout : 250000,
                            method : 'GET',
                            data : "",
                            type : 'json',
                            headers : {
                                'Content-Type' : 'application/json',
                                'Accept' : 'application/json',
                                'SecurityContext' : securityContext.SecurityContext,
                            },
                            onFailure : function (result) {
                                console.log('ParameterizationDELUserExperienceWebServices::getWidgetsCustomization - Failure');
                                console.log(result);
                                callback.onFailure(result);
                            },
                            onComplete: function (result) {
                                console.log('ParameterizationDELUserExperienceWebServices::getWidgetsCustomization - Success');
                                callback.onSuccess(result);
                            }
                        });
                    }
                });
            },

             getListOfLanguages: function (callback) {
                const urlSecurityContext = URLHandler.getURL() + "/resources/pno/person/getsecuritycontext?tenant=" + URLHandler.getTenant();
                console.log("Get security context:");

                WAFData.authenticatedRequest(urlSecurityContext, {
                    timeout: 250000,
                    method: 'GET',
                    data: "",
                    type: 'json',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    onFailure: function (json) {
                        console.log('ParameterizationDELUserExperienceWebServices::getListOfLanguages - Failure');
                        console.log(json);
                    },
                    onComplete: function (securityContext) {
                        const urlFinal = URLHandler.getURL() + "/resources/v1/modeler/dstrs/dstrs:Language";

                        var defaultLanguage = 'en';
                        var lang  = UWA.is(widget) ? (UWA.is(widget.lang, 'string') ? widget.lang : defaultLanguage) : defaultLanguage;

                        WAFData.authenticatedRequest(urlFinal, {
                            timeout: 100000,
                            method: 'GET',
                            data: "",
                            type: 'json',
                            headers: {
                                'Accept-Language': lang,
                                'Content-Type': 'application/json',
                                'Accept': 'application/json',
                                'SecurityContext': securityContext.SecurityContext,
                            },
                            onFailure: function (result) {
                                console.log('ParameterizationDELUserExperienceWebServices::getListOfLanguages - Failure');
                                console.log(result);
                                callback.onFailure(result);
                            },
                            onComplete: function (result) {
                                console.log('ParameterizationDELUserExperienceWebServices::getListOfLanguages - Success');
                                callback.onSuccess(result);
                            }
                        });
                    }
                });
            },
        });
        return ParameterizationDELUserExperienceWebServices;
    }
);

/*! Copyright 2017, Dassault Systemes. All rights reserved. */
/*@fullReview  NZV 17/05/09 remove getDimensions function*/
/*@fullReview  NZV 17/04/28 Add function getDimensions*/
/*@fullReview  ZUR 15/07/24 2016xFD01*/
/*@quickReview ZUR 15/11/23 2017x Param Skeleton*/
/*global define*/
define(
    'DS/ParameterizationSkeleton/Utils/ParameterizationWebServices',
    [
        'UWA/Core',
        'UWA/Promise',
        'DS/WAFData/WAFData',
        'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
    ],
    function(UWA, Promise, WAFData, URLHandler) {

        'use strict';

        var wsUtils = {

            postParamsArrOnServer : function (connectProps, jsonArr, theImageCell, onFailurefct, onSuccessfct) {

                var url = URLHandler.getURL() + "/resources/ParamWS/access/postparams?tenant=" + URLHandler.getTenant(),
                    datatoSend = {
                        domain    : connectProps.domainName,
                        parameter : jsonArr
                    };
                    //onFailurefct = onFailurefct.bind(this);
                    //onSuccessfct = onSuccessfct.bind(this);
                    //WAFData.authenticatedRequest
                    //UWA.Data.request

                WAFData.authenticatedRequest(url, {
                    timeout: 100000,
                    method: 'POST',
                    data: JSON.stringify(datatoSend),
                    type: 'json',
                    //proxy: 'passport',

                    headers: {
                        'Content-Type' : 'application/json',
                        'Accept' : 'application/json'
                    },

                    onFailure : function (json) {
                        onFailurefct(json, theImageCell); //this.onApplyFailure(json, this, theImageCell);
                    },

                    onComplete: function(json) {
                        onSuccessfct(json, theImageCell);
                    }
                });
            },//postParamsArrOnServer
            //FUN095483
            genPostParamsArrOnServer : function (connectProps, webserviceName, jsonArr, theImageCell, onFailurefct, onSuccessfct) {

                var url = URLHandler.getURL() + "/resources/ParamWS/access/"+webserviceName+"?tenant=" + URLHandler.getTenant(),
                    datatoSend = {
                        domain    : connectProps.domainName,
                        parameter : jsonArr
                    };
                    //onFailurefct = onFailurefct.bind(this);
                    //onSuccessfct = onSuccessfct.bind(this);
                    //WAFData.authenticatedRequest
                    //UWA.Data.request

                WAFData.authenticatedRequest(url, {
                    timeout: 100000,
                    method: 'POST',
                    data: JSON.stringify(datatoSend),
                    type: 'json',
                    //proxy: 'passport',

                    headers: {
                        'Content-Type' : 'application/json',
                        'Accept' : 'application/json'
                    },

                    onFailure : function (json) {
                        onFailurefct(json, theImageCell); //this.onApplyFailure(json, this, theImageCell);
                    },

                    onComplete: function(json) {
                        onSuccessfct(json, theImageCell);
                    }
                });
            },//postParamsArrOnServer
            ImportParamToServer : function (iStream, iAction, importFailurefct, importSucessfct) {
                var url = URLHandler.getURL() + "/resources/ParamWS/access/importparams?tenant=" + URLHandler.getTenant();
                url = url + "&importAction=" + iAction;

                WAFData.authenticatedRequest(url, {
                    timeout: 600000,//R-929388-3DEXPERIENCER2022x/23x
                    method: 'POST',
                    data: iStream, //JSON.stringify(datatoSend),
                    type: 'text',
                    //proxy: 'passport',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    onFailure : function (json) {
                        importFailurefct(json);
                    },
                    onComplete: function(json) {
                        importSucessfct(json, iAction);
                    }
                });
            },

            deployParamsOnServer : function (onDeployFailure, onDeploySuccess) {
                var url = URLHandler.getURL() + "/resources/ParamWS/access/deployallparams?tenant=" + URLHandler.getTenant();

                WAFData.authenticatedRequest(url, {
                    timeout: 600000,//R-929388-3DEXPERIENCER2022x/23x
                    method: 'POST',
                    type: 'json',
                    //proxy: 'passport',

                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },

                    onFailure : function (json) {
                        onDeployFailure(json);
                    },

                    onComplete: function(json) {
                        onDeploySuccess(json);
                    }
                });
            },

            postLifecycleParams : function (datatoSend, onDeployFailurefct, onDeploySuccessfct) {
                var url = URLHandler.getURL() + "/resources/ParamWS/lifecycle/postlcparams?tenant=" + URLHandler.getTenant();
                WAFData.authenticatedRequest(url, {
                    timeout: 100000,
                    method: 'POST',
                    data: JSON.stringify(datatoSend),
                    type: 'json',

                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
						'Accept-Language': widget.lang
                    },

                    onFailure : function (json) {
                        onDeployFailurefct(json);
                    },

                    onComplete: function(json) {
                        onDeploySuccessfct(json);
                    }
                });
            },

            GetTicketForDownload: function(iFileID, onSuccessfct, onFailurefct) {
                var url = URLHandler.getURL() + "/resources/ParamWS/access/getCheckoutParamGenericFileTicket";//getCheckoutParamFileTicket

                WAFData.authenticatedRequest(url, {
                    data: {
                        fileID : iFileID,
                        tenant : URLHandler.getTenant()
                    },
                    headers: {
                        'Accept': 'application/json'//,
                       // 'Content-Type': 'application/json'
                    },
                    method: 'get',
                    type: 'json',
                    //proxy: 'passport',
                    onComplete: function(json) {
                        onSuccessfct(json, iFileID); //IR-684310-3DEXPERIENCER2019x
                    },
                    onFailure: function(json) {
                        onFailurefct(json, iFileID);
                    }
                });
            },
            //FUN102019 21x FD03
            getRquestOnParamService: function(requestStr, dataInfo, onSuccessfct, onFailurefct) {
                var url = URLHandler.getURL() + "/resources/ParamWS/"+requestStr;//getCheckoutParamFileTicket
                dataInfo.tenant = URLHandler.getTenant();
                WAFData.authenticatedRequest(url, {
                    data: dataInfo,
                    headers: {
                        'Accept': 'application/json'//,
                       // 'Content-Type': 'application/json'
                    },
                    method: 'get',
                    type: 'json',
                    //proxy: 'passport',
                    onComplete: function(json) {
                        onSuccessfct(json, dataInfo); //IR-684310-3DEXPERIENCER2019x
                    },
                    onFailure: function(json) {
                        onFailurefct(json, dataInfo);
                    }
                });
            },
            postAttributesOnServer : function (jsonArr, servicePath, onFailurefct, onSuccessfct) {

                var url = URLHandler.getURL() + "/resources/ParamWS/datamodel/" + servicePath + "?tenant=" + URLHandler.getTenant();
                //postattrparams

                WAFData.authenticatedRequest(url, {
                    timeout: 250000,
                    method: 'POST',
                    data: JSON.stringify(jsonArr),
                    type: 'json',
                    //proxy: 'passport',
                    headers: {
                        'Content-Type' : 'application/ds-json',
                        'Accept' : 'application/ds-json'
                    },
                    onFailure : function (json) {
                        onFailurefct(json);
                    },
                    onComplete: function(json) {
                        onSuccessfct(json);
                    }
                });
            },//postParamsArrOnServer

            launchServiceOnServer : function (wsPath, onSuccessfct, onFailurefct) {
                var url = URLHandler.getURL() + "/resources/ParamWS/" + wsPath;

                WAFData.authenticatedRequest(url, {
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    method: 'POST',
                    type: 'json',
                    //proxy: 'passport',
                    onComplete: function(json) {
                        onSuccessfct(json);
                    },
                    onFailure: function(json) {
                        onFailurefct(json);
                    }
                });
            },
            ////R-964136-3DEXPERIENCER2022x\23:get latest info that attribute referenced on other app's parameter
            getAttributeUsedInOther : function (collectID, attrName, userName) {
              var obj = new Promise(function (resolve, reject) {
				  //IR-1439767-3DEXPERIENCER2026x : add encodeURIComponent(userName)
                  var url =  URLHandler.getURL() + "/resources/ParamWS/datamodel/isattributereferencedinother?tenant=" + URLHandler.getTenant()
                  +"&type="+collectID+"&attributeName="+attrName + "&attributeUserName="+encodeURIComponent(userName);
                  WAFData.authenticatedRequest(url, {
                    headers: {
                        'Accept' : 'application/json',
                        //'Content-Type' : 'application/json',
                        'Accept-Language' : widget.lang
                    },
                    proxy :'passport',
                    method: 'get',
                    type: 'json',
                    timeout:0,
                      onTimeout : function (networkError, error) {
                        error = error || networkError;
                        console.log("onTimeout");
                        console.log(error);
                      },

                      onComplete: function (json) {
                          if (json !== 'undefined') {
                              resolve(json);
                          }
                      },
                      onFailure: function(json) {
                          UWA.log("Paramaterization::Services falied! :" + url);
                          UWA.log(json);
                          reject(json);

                      }
                  });
              });
              return obj;
            }
        };

        return wsUtils;

    }
);

/*@fullReview  CN1 18/05/15 2019xBeta2 Mapping Widget*/
/*global define, widget, document, setTimeout, console*/
/*jslint plusplus: true*/
/*jslint nomen: true*/
define('DS/ParameterizationSkeleton/Views/ParamCollaboration/TypeMapping/TypeMappingViewUtilities',
	[
		'UWA/Core',
		'UWA/Controls/Accordion',
		'DS/UIKIT/Accordion',
		'DS/UIKIT/Input/Button',
		'DS/UIKIT/Input/Select',
		'DS/UIKIT/Input/Toggle',
		'DS/UIKIT/Modal',
		'DS/UIKIT/Alert',
		'DS/UIKIT/Popover',
		'DS/UIKIT/Tooltip',
		'DS/UIKIT/Spinner',
		'DS/UIKIT/Mask',
		'DS/UIKIT/Input/ButtonGroup',
		'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
		'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
		'DS/WAFData/WAFData',
		'i18n!DS/ParameterizationSkeleton/assets/nls/MappingManagementNLS',
	],
	function (UWA,
		UWAccordion, Accordion,
		Button, Select, Toggle,
		Modal,
		Alert, Popover, Tooltip, Spinner, Mask, ButtonGroup, ParametersLayoutViewUtilities, URLHandler, WAFData,
		MappingManagementNLS) {

		'use strict';

		var UIview = {

			init: function (isCloudEnv/*, isAlreadyCleanForCloud*/) {
				this.subTypeVPM = [];
				this.subTypeMatrix = [];
				this.subRelVPM = [];
				//this.subRelMatrix = [];
				this.subTypeVPMTree = [];
				this.subRelVPMTree = [];
				this.SubTypeRelInfoRetrieved = false;
				this.isCloudEnv = isCloudEnv;
				//this.isAlreadyCleanForCloud = isAlreadyCleanForCloud;
				this.mappableTypeReaseon = {
					1: MappingManagementNLS.ErrorAlreadyMappedTogether,
					2: MappingManagementNLS.ErrorPartTypeAlreadyUsedAsSource,
					3: MappingManagementNLS.ErrorProductTypeAlreadyUsedAsSource,
					4: MappingManagementNLS.ErrorPartTypeNIB,
					5: MappingManagementNLS.ErrorProductTypeNIB,
					6: MappingManagementNLS.ErrorProductTypeNotAvailable,
					7: MappingManagementNLS.ErrorPartTypeNotAvailable,
					8: MappingManagementNLS.ErrorProductTypeUnknown,
					9: MappingManagementNLS.ErrorPartTypeUnknown,
					10: MappingManagementNLS.IncompatibleDirectionWithAttributeMapping,
					11: MappingManagementNLS.CloudEnv
				};
			},

			initVariable: function () {
				/*this.cellsIndex = {
					"kindOfMapping": 0,
					"VPMObject": 1,
					"side": 2,
					"MatrixObject": 3,
					"action": 4,
					"deployFlag": 5,
					"Indexed": 6,
				};
				this.cellsAttrIndex = {
					"VPMAttr": 0,
					"side": 1,
					"MatrixAttr": 2,
					"info": 3,
					"action": 4,
					"deployFlag": 5,
				};

				this.direction = {
					"BOTH": "<=>",
					"VPM_To_MX": "=>",
					"MX_To_VPM": "<=",
				};

				this.enumType = "enum";
				this.PartAttrAsTarget = ["Part Classification", "Material Category", "Production Make Buy Code", "Service Make Buy Code", "Unit of Measure", "Description", "Estimated Cost", "Target Cost", "Lead Time", "Spare Part", "End Item", "End Item Override Enabled", "Lead Time Duration", "Effectivity Date", "Design Purchase", "Spare Part"];
				this.VPMAttrAsTarget = ["PLMReference.V_versionComment", "PLMEntity.V_description", "PLMReference.V_ApplicabilityDate"];
				this.mappableAttributeReaseon = {
					0: MappingManagementNLS.ErrorNotSameType,
					1: MappingManagementNLS.ErrorRange,
					2: MappingManagementNLS.ErrorAlreadyMappedTogether,
					3: MappingManagementNLS.ErrorVPMOnlyUsedAsSource,
					4: MappingManagementNLS.ErrorMxOnlyUsedAsSource,
					5: MappingManagementNLS.ErrorPartAlreadyUsedAsTarget,
					6: MappingManagementNLS.ErrorProductAlreadyUsedAsTarget,
					7: MappingManagementNLS.ErrorPartNotDeployed,
					8: MappingManagementNLS.ErrorProductNotDeployed,
					9: MappingManagementNLS.ErrorPartNotAvailable,
					10: MappingManagementNLS.ErrorProductNotAvailable,
					11: MappingManagementNLS.ErrorProductUnknown,
					12: MappingManagementNLS.ErrorPartUnknown
				};*/
			},




		


		

			addTypeMapping: function (skeleton) {

				var collection = skeleton.collection;
				collection.add({
				/*	id: "SubType1" + "/" + "SubType2",
					title: "SubType1" + "<span class=\"fonticon  fonticon-left-dir\"></span>" + "<span class=\"fonticon  fonticon-right-dir\"></span>" + "SubType2",
					subtitle: "status:" + "<span class=\"fonticon fonticon-2x fonticon-check\" style=\"color:green\"></span>",
					domainid: 'TypeMapping',
					image: URLHandler.getURL() + "/webapps/ParameterizationSkeleton/assets/img/" + "paramAttributeMapping.png",*/
					id: "EssaiVPMType" + "|" + "EssaiMatrixType",
					title: "EssaiVPMType" + "\/" + "EssaiMatrixType",
					//content : "status:"+  "<span class=\"fonticon  fonticon-check\" style=\"color:green\"></span>",
					//subtitle : "direction:" + "<span class=\"fonticon  fonticon-left-dir\"></span>"+"<span class=\"fonticon  fonticon-right-dir\"></span>",
					domainid: 'TypeMapping',
					image: URLHandler.getURL() + "/webapps/ParameterizationSkeleton/assets/img/" + "paramAttributeMapping.png",
					vpmObject: "object",
					mxObject: "object",
					KindOfMapping: "type",
					SynchDirection: "BOTH",
					isBaseMapping: false,
					deployedStatus: true,
					ancestor: [],
				})
			},

			onCompleteRequestUpdateIndexInfo: function (payload) { },
				onFailureRequestUpdateIndexInfo: function (resp) { },

			BuildAddMappingPanel: function (skeleton, collection, title, VPMSelectPlaceHolder, MatrixSelectPlaceHolder, labelVPMtxt, labelMatrixtxt, labelProductToPart, labelPartToProduct/*, listOfNotFilteredMappingForCloud*/, isAlreadyCleanForCloud) {

               

                var addMappingTitle, labelVPM, labelMatrix, iconInfoMessageBOTH, iconInfoMessageVPMENG, iconInfoMessageENGVPM, divMessageBOTH,
                    divMessageVPMENG, divMessageENGVPM, popoverInfoMappingBOTH, popoverInfoMappingVPMENG, popoverInfoMappingENGVPM,
					OKBtn, CancelBtn, modalbodydiv, modalbodyTable, modaltbody, lineModal, iCell, iCell1, toggleBoth, toggleVPM, toggleENG, selectVPM, labelMappingType, selectMatrix, addMappingModal, TypeRelButtonGroup, messagesBOTH, messagesVPMENG,messagesENGVPM,that=this;

				Mask.mask(skeleton.container);
			addMappingTitle = UWA.createElement('h4', {
				text: title,
			});

			modalbodydiv = UWA.createElement('div', {
				'class': 'PartProductAddMappingDiv',
			})

			modalbodyTable = UWA.createElement('table', {
				'id': 'PartProductAddMappingTable',
				'class': 'table table-condensed table-hover'
			}).inject(modalbodydiv);


			modaltbody = UWA.createElement('tbody', {
				'class': 'addMappingBody'
			}).inject(modalbodyTable);



				//essai
				lineModal = UWA.createElement('tr').inject(modaltbody);


				/*iCell = UWA.createElement('td', {
					'Align': 'left',
				});

				iCell1 = UWA.createElement('td', {
					'Align': 'left',
					'width': '92%'
				}).inject(iCell);

				labelMappingType = UWA.createElement('p', {
					text: "Mapping",
					'class': 'font-3dslight'// font-3dsbold
				}).inject(iCell1);

				iCell.inject(lineModal);


				iCell = UWA.createElement('td', {
					'Align': 'left',
				});

				iCell1 = UWA.createElement('td', {
					'Align': 'left',
					'width': '92%'
				}).inject(iCell);*/

				/*TypeRelButtonGroup = new ButtonGroup({
					type: "radio",
	
						buttons: [
							new Button({ value: "Type", id: "TYPE", className: "default", active: true }),
							new Button({ value: "Relationship", id: "REL", className: "default" })
						],
					events: {
						onClick: function (e, button) {
							selectVPM.remove();
							var subTypeTree = that.subTypeVPMTree;
							if (button.options.id === "REL")
								subTypeTree = that.subRelVPMTree
							that.addSelectorOptions(subTypeTree, selectVPM);
							//that.fillAddMappingSelectPanel(selectVPM, selectMatrix, button.options.id);
						}
					}
				}).inject(iCell);

				iCell.inject(lineModal);*/

				//

			lineModal = UWA.createElement('tr').inject(modaltbody);

			iCell = UWA.createElement('td', {
				'Align': 'left',
			});

			iCell1 = UWA.createElement('td', {
				'Align': 'left',
				'width': '92%'
			}).inject(iCell);

			labelVPM = UWA.createElement('p', {
				text: labelVPMtxt,
				'class': 'font-3dslight'// font-3dsbold
			}).inject(iCell1);

			iCell.inject(lineModal);


			iCell = UWA.createElement('td', {
				'Align': 'left',
			}).inject(lineModal);

				selectVPM = new Select({
				id: "selectVPMTypeMapping",
				nativeSelect: true,
				placeholder: VPMSelectPlaceHolder,
				multiple: false,
			});
				selectVPM.inject(iCell);



				selectVPM.addEvent("onChange", function (e) {

					var selectedTypes = selectVPM.getSelection(false);
					selectMatrix.select(0, true);

					if (!that.isCloudEnv) {
						toggleBoth.setDisabled(true);
						toggleVPM.setDisabled(true);
						toggleVPM.setDisabled(true);
						OKBtn.disable();
						toggleBoth.check();

						iconInfoMessageBOTH.hide();
						iconInfoMessageENGVPM.hide();
						iconInfoMessageVPMENG.hide();
					}


					if (selectedTypes.length != 0) {
						selectMatrix.enable();
						//var activeButton = TypeRelButtonGroup.getActive();
						//var typeOrRel = (activeButton.length === 1) ? activeButton[0].getContent().id : "TYPE";
						var typeOrRel = "TYPE";
						var IsnotMappableType = UIview.enableMatrixAttrAccordingRules(selectVPM, selectMatrix, collection/*skeleton.collection._models*/, typeOrRel);
						if (IsnotMappableType) infoButton.show();
						
					}
					else {
						selectMatrix.disable();
						infoButton.hide();
					}

				});



				

			lineModal = UWA.createElement('tr').inject(modaltbody);

			iCell = UWA.createElement('td', {
				'Align': 'left',
			});

			iCell1 = UWA.createElement('td', {
				'Align': 'left',
				'width': '92%'
			}).inject(iCell);

			labelMatrix = UWA.createElement('p', {
				text: labelMatrixtxt,
				'class': 'font-3dslight'// font-3dsbold
			}).inject(iCell1);

			iCell.inject(lineModal);


			iCell = UWA.createElement('td', {
				'Align': 'left',
			}).inject(lineModal);

			selectMatrix = new Select({
				nativeSelect: true,
				placeholder: MatrixSelectPlaceHolder,
				multiple: false,
			});
			selectMatrix.inject(iCell);
				selectMatrix.disable();


				iCell = UWA.createElement('td', {
					'Align': 'left',
				}).inject(lineModal);

				var infoSpan = UWA.createElement('span', {
					styles:
					{
						'min-width': '20px'
					},
				});
				var infoButton = new Button({
					className: 'close',
					icon: 'fonticon fonticon-info fonticon-1.5x',//value: 'Button', //fonticon-cancel  fonticon-minus-circled
					attributes: {
						disabled: false,
						'aria-hidden': 'true'
					}
				}).inject(infoSpan);
				var infoPop = new Popover({
					target: infoSpan,
					trigger: "hover",
					animate: "true",
					position: "top",
					body: MappingManagementNLS.NotMappableTypes,
					title: ''
				});
				infoSpan.inject(iCell);
				infoButton.hide();
				infoButton.addEvent("onClick", function (e) {
					var MatrixTypes = that.subTypeMatrix;
					addMappingModal.hide();

					var changeDirectionModal = UIview.ShowNotMappableTypes.call(that, addMappingModal, skeleton.pSkeleton.getActiveIdCard().container, skeleton.collection._models, selectVPM.getSelection(false)[0].value, MatrixTypes, "TYPE");
					//addMappingModal.show();
				}),



				selectMatrix.addEvent("onChange", function (e) {

					if (!that.isCloudEnv) {
						toggleBoth.setDisabled(true);
						toggleVPM.setDisabled(true);
						toggleENG.setDisabled(true);
					}
					var listMatrixOptions = selectMatrix.getOptions(false);

					if (listMatrixOptions.length !== 0) {

						var selectedTypes = selectMatrix.getSelection(false);


						if (selectedTypes.length != 0) {

							var selectedVPMType = (selectVPM.getSelection(false))[0].value;
							var selectedMatrixType = selectedTypes[0].value;

							//var activeButton = TypeRelButtonGroup.getActive();
							//var typeOrRel = (activeButton.length === 1) ? activeButton[0].getContent().id : "TYPE";
							var typeOrRel = "TYPE";
							var authorizedDirection = that.CheckRulesToAddTypeMapping(skeleton.collection._models, selectedVPMType, selectedMatrixType, typeOrRel);

							if (!that.isCloudEnv) {
								if (authorizedDirection.BOTH) toggleBoth.setDisabled(false);
								if (authorizedDirection.VPM_To_MX) toggleVPM.setDisabled(false);
								if (authorizedDirection.MX_To_VPM) toggleENG.setDisabled(false);


								messagesBOTH = authorizedDirection.message.BOTH;
								messagesVPMENG = authorizedDirection.message.VPM_To_MX;
								messagesENGVPM = authorizedDirection.message.MX_To_VPM;


								if (!toggleBoth.isDisabled()) toggleBoth.check();
								else if (!toggleVPM.isDisabled()) toggleVPM.check();
								else if (!toggleENG.isDisabled()) toggleENG.check();

								//display message in popover
								UIview.displayAddMappingWarningMessage(divMessageBOTH, popoverInfoMappingBOTH, messagesBOTH);
								UIview.displayAddMappingWarningMessage(divMessageVPMENG, popoverInfoMappingVPMENG, messagesVPMENG);
								UIview.displayAddMappingWarningMessage(divMessageENGVPM, popoverInfoMappingENGVPM, messagesENGVPM);
							}

							OKBtn.enable();


						}
						else
							OKBtn.disable();
			


					}
				});

				if (!this.isCloudEnv) {

					lineModal = UWA.createElement('tr').inject(modaltbody);

					iCell = UWA.createElement('td', {
						'Align': 'left',
					});

					iCell1 = UWA.createElement('td', {
						'Align': 'left',
						'width': '92%'
					}).inject(iCell);

					UWA.createElement('p', {
						text: MappingManagementNLS.side,
						'class': 'font-3dslight'// font-3dsbold
					}).inject(iCell1);

					iCell.inject(lineModal);

					iCell = UWA.createElement('td', {
						'Align': 'left',
					}).inject(lineModal);


					toggleBoth = new Toggle({ name: "optionsRadiosSide", value: MappingManagementNLS.both, className: "primary" }).inject(iCell);
					toggleBoth.setDisabled(true);
					toggleBoth.check();
					toggleVPM = new Toggle({ name: "optionsRadiosSide", value: labelProductToPart, className: "primary" }).inject(iCell);
					toggleVPM.setDisabled(true);
					toggleENG = new Toggle({ name: "optionsRadiosSide", value: labelPartToProduct, className: "primary" }).inject(iCell);
					toggleENG.setDisabled(true);

					var iCell2 = UWA.createElement('td', {
						'Align': 'left',
					}).inject(lineModal);
					divMessageBOTH = UWA.createElement('div', { 'class': 'divAddMappingMessage' }).inject(iCell2);
					divMessageVPMENG = UWA.createElement('div', { 'class': 'divAddMappingMessage' }).inject(iCell2);
					divMessageENGVPM = UWA.createElement('div', { 'class': 'divAddMappingMessage' }).inject(iCell2);


					iconInfoMessageBOTH = UWA.createElement('span', {
						'class': 'InfoAddMapping fonticon fonticon-info'
					}).inject(divMessageBOTH);
					iconInfoMessageBOTH.hide();
					popoverInfoMappingBOTH = new Popover({
						target: iconInfoMessageBOTH,
						trigger: "hover",
						animate: "true",
						position: 'left',
						body: "",
						title: 'BOTH'
					});

					iconInfoMessageVPMENG = UWA.createElement('span', {
						'class': 'InfoAddMapping fonticon fonticon-info'
					}).inject(divMessageVPMENG);
					iconInfoMessageVPMENG.hide();
					popoverInfoMappingVPMENG = new Popover({
						target: iconInfoMessageVPMENG,
						trigger: "hover",
						animate: "true",
						position: 'left',
						body: "",
						title: 'Product to Part'
					});

					iconInfoMessageENGVPM = UWA.createElement('span', {
						'class': 'InfoAddMapping fonticon fonticon-info'
					}).inject(divMessageENGVPM);
					iconInfoMessageENGVPM.hide();
					popoverInfoMappingENGVPM = new Popover({
						target: iconInfoMessageENGVPM,
						trigger: "hover",
						animate: "true",
						position: 'left',
						body: "",
						title: 'Part to Product'
					});

					UWA.createElement('ul', { 'class': 'ListAddMappingMessage' }).inject(divMessageBOTH);
					UWA.createElement('ul', { 'class': 'ListAddMappingMessage' }).inject(divMessageVPMENG);
					UWA.createElement('ul', { 'class': 'ListAddMappingMessage' }).inject(divMessageENGVPM);

				}

			OKBtn = new Button({
				value: MappingManagementNLS.Apply,
				id: "modalOKButton",
				className: 'btn primary'
			});
			OKBtn.disable();

			CancelBtn = new Button({
				value: MappingManagementNLS.Cancel,
				id: 'modalCancelButton',
				className: 'btn default'
			});


			addMappingModal = new Modal({
				className: 'add-mapping-modal',
				closable: true,
				header: addMappingTitle,
				body: modalbodydiv,
				footer: [OKBtn, CancelBtn]
			});

				if (!this.SubTypeRelInfoRetrieved)
					this.getSubTypeInfo(skeleton,collection, addMappingModal, selectVPM, selectMatrix);
				else {
					//this.fillAddMappingSelectPanel(selectVPM, selectMatrix);
					this.addSelectorOptions(collection, this.subTypeVPMTree, selectVPM);
					Mask.unmask(skeleton.container);
					addMappingModal.show();
				}

				CancelBtn.addEvent("onClick", function (e) {
					UWA.log(e);//that.onCancelCalled();
					addMappingModal.hide();
				});
				
			OKBtn.addEvent("onClick", function (e) {

				Mask.mask(skeleton.container);

				var selectedVPMTypeRel, selectedMatrixTypeRel, txtSide, selectedVPMTypeRelInfo, selectedMatrixTypeRelInfo,iconSpan;
				var selectedVPMTypeRel, selectedMatrixTypeRel, txtSide, selectedVPMTypeRelInfo, selectedMatrixTypeRelInfo,iconSpan;

				selectedVPMTypeRel = (selectVPM.getSelection(false))[0];
				selectedMatrixTypeRel = (selectMatrix.getSelection(false))[0];



				selectedVPMTypeRelInfo = that.retrieveTypeRelInfo(selectedVPMTypeRel.value, that.subTypeVPM);
				selectedMatrixTypeRelInfo = that.retrieveTypeRelInfo(selectedMatrixTypeRel.value, that.subTypeMatrix);

				if (!that.isCloudEnv) {
					if (toggleBoth.isChecked()) { txtSide = "BOTH"; iconSpan = "<span class=\"fonticon  fonticon-left-dir\"></span>" + "<span class=\"fonticon  fonticon-right-dir\"></span>" }
					else if (toggleVPM.isChecked()) { txtSide = "VPM_To_MX"; iconSpan = "<span class=\"fonticon  fonticon-left-dir\"></span>" }
					else if (toggleENG.isChecked()) { txtSide = "MX_To_VPM"; iconSpan = "<span class=\"fonticon  fonticon-right-dir\"></span>" }
					else { txtSide = "BOTH"; iconSpan = "<span class=\"fonticon  fonticon-left-dir\"></span>" + "<span class=\"fonticon  fonticon-right-dir\"></span>" };
				}
				else {
					txtSide = "VPM_To_MX"; iconSpan = "<span class=\"fonticon  fonticon-left-dir\"></span>";
					selectVPM.disable(selectedVPMTypeRel);
				}

				if (selectedVPMTypeRelInfo !== "undefined" && selectedMatrixTypeRelInfo !== "undefined") {
					var collection = skeleton.collection;

					var isMXToVPMForCloudIsFound = false;
					//In case of Cloud env, search if it existe an mapping MX to VPM with same type
					//If exists, change the direction to both instead of create a new mapping VPM to MX
					var mappingMXToVPMInCloud = null;
					var typeMappingToAdd =
					{
						id: selectedVPMTypeRelInfo.id + "|" + selectedMatrixTypeRelInfo.id,
						title: selectedVPMTypeRelInfo.name + "\/" + selectedMatrixTypeRelInfo.name,
						//content : "status:"+  "<span class=\"fonticon  fonticon-check\" style=\"color:green\"></span>",
						//subtitle : "direction:" + "<span class=\"fonticon  fonticon-left-dir\"></span>"+"<span class=\"fonticon  fonticon-right-dir\"></span>",
						domainid: 'TypeMapping',
						image: URLHandler.getURL() + "/webapps/ParameterizationSkeleton/assets/img/" + "paramMappingManagementType.png",
						vpmObject: selectedVPMTypeRelInfo,
						mxObject: selectedMatrixTypeRelInfo,
						KindOfMapping: "TYPE",
						SynchDirection: txtSide,
						isBaseMapping: false,
						deployedStatus: "Deployed",
						ancestor: [],
					};



					/*if (that.isCloudEnv) {
						var i = 0;
						while (i < listOfNotFilteredMappingForCloud.length && !isMXToVPMForCloudIsFound) {
							mappingMXToVPMInCloud = listOfNotFilteredMappingForCloud[i];
							if (mappingMXToVPMInCloud.vpmObject.id === selectedVPMTypeRelInfo.id && mappingMXToVPMInCloud.mxObject.id === selectedMatrixTypeRelInfo.id)
								isMXToVPMForCloudIsFound = true;
							i++;
						}
						//In this case, juste change the direction to VPM_To_MX in database
						if (isMXToVPMForCloudIsFound) {

							var mappingToSend = new Array();

							datatoSend = {
								VPMTypeRel: selectedVPMTypeRelInfo.id,
								MatrixTypeRel: selectedMatrixTypeRelInfo.id,
								kindOfMapping: "TYPE",
								synchDirection: mappingMXToVPMInCloud.SynchDirection,
								DirectionToModify: "VPM_To_MX",
								deployedStatus: mappingMXToVPMInCloud.deployedStatus
							};


							var url = URLHandler.getURL() + "/resources/MappingWS/mapping/modifyTypeMapping?tenant=" + URLHandler.getTenant(), datatoSend;
							WAFData.authenticatedRequest(url, {
								timeout: 250000,
								method: 'POST',
								data: JSON.stringify(datatoSend),
								type: 'json',
								//proxy: 'passport',

								headers: {
									'Content-Type': 'application/json',
									'Accept': 'application/json'
								},

								onFailure: function (json) {
									Mask.unmask(skeleton.container);
									that.onAddFailure.call(that, json);
								},

								onComplete: function (json) {
									Mask.unmask(skeleton.container);
									typeMappingToAdd.SynchDirection = "VPM_To_MX";
									that.onAddSuccess.call(that, json, skeleton, collection, typeMappingToAdd);
									listOfNotFilteredMappingForCloud.splice(i-1,1);
								},

							});

						}
					}*/

	
					//if (!isMXToVPMForCloudIsFound) {

						var mappingToSend = new Array();
						mappingToSend.push(typeMappingToAdd);

						datatoSend = {
							typeMapping: mappingToSend
						};


						var url = URLHandler.getURL() + "/resources/MappingWS/mapping/posttypemapping?tenant=" + URLHandler.getTenant() + "&isAlreadyCleanForCloud=" + isAlreadyCleanForCloud.value, datatoSend;

						WAFData.authenticatedRequest(url, {
							timeout: 250000,
							method: 'POST',
							data: JSON.stringify(datatoSend),
							type: 'json',
							//proxy: 'passport',

							headers: {
								'Content-Type': 'application/json',
								'Accept': 'application/json'
							},

							onFailure: function (json) {
								Mask.unmask(skeleton.container);
								that.onAddFailure.call(that, json);
							},

							onComplete: function (json) {
								Mask.unmask(skeleton.container);
								that.onAddSuccess.call(that, json, skeleton, collection, typeMappingToAdd);
								if (that.isCloudEnv)
									isAlreadyCleanForCloud.value = true;
							},

						});
					}
				//}

				
				addMappingModal.hide();

			});

			return [addMappingModal, { selectVPM: selectVPM, selectMatrix: selectMatrix }, { toggle: toggleVPM, div: divMessageVPMENG, popover: popoverInfoMappingVPMENG }, { toggle: toggleENG, div: divMessageENGVPM, popover: popoverInfoMappingENGVPM }, { toggle: toggleBoth, div: divMessageBOTH, popover: popoverInfoMappingBOTH }, { OKButton: OKBtn, CancelButton: CancelBtn }];
            },


            onAddFailure: function (json) {
                UWA.log(json);
				//Mask.unmask(skeleton.container);
                // this.userMessaging.add({ className: "error", message: MappingManagementNLS.applyErrorMessage });
            },

			onAddSuccess: function (json, skeleton, collection, typeMappingToAdd) { 

				collection.add(typeMappingToAdd);
				/*var buttonGroupDirectionDiv = document.getElementById("TypeMappingDirectionButton");
				if (buttonGroupDirectionDiv !== undefined) {
					UIview.disableDirectionButtonAccordingMappingRules(collection, skeleton.model._attributes, listofAttributesMapping);
				}*/

			},




			//Fill Part Select with Part attributes mappable (at least one direction is possible) with selected VPM attribute
			enableMatrixAttrAccordingRules: function (SelectVPM, SelectMatrix, collection, TypeOrRel) {

				var selectedVPMType, selectedVPMTypeOpt, cptOptions, directionAvailable, matrixOption = [], MxTypeId, IsnotMappableType=false;

				//Get the selected VPM attributes
				selectedVPMTypeOpt = SelectVPM.getSelection(false);

				//Get the selected Matrix attribute
				var matrixSelectValue = SelectMatrix.getValue()[0];

				if (selectedVPMTypeOpt.length != 0) {
					//Get VPM attribute value
					selectedVPMType = selectedVPMTypeOpt[0].value;
					//clear and remove content of Part select
					SelectMatrix.clear(true);
					SelectMatrix.remove();

					//get the list of attributes already mapped with VPM attribute
					//listOfMappedMXattr = (attrMappingMap.VPM).get(selectedVPMAttr);

					//For each Part attribute, check if it can be mapped with VPM attributes and add it in the select if it is the case
					//listMatrixOptions = SelectMatrix.getOptions(false);

					//matrixOption = (TypeOrRel === "TYPE") ? this.subTypeMatrix : this.subRelMatrix;
					matrixOption = this.subTypeMatrix;
					var compatibleMatrixType = [];
					for (cptOptions = 0; cptOptions < matrixOption.length; cptOptions++) {

						MxTypeId = matrixOption[cptOptions].id;
						
							directionAvailable = UIview.CheckRulesToAddTypeMapping(collection, selectedVPMType, MxTypeId, TypeOrRel);
						if (directionAvailable.VPM_To_MX || directionAvailable.MX_To_VPM || directionAvailable.BOTH || MxTypeId === "Part" || MxTypeId === "EBOM")
							compatibleMatrixType.push(matrixOption[cptOptions]);
						else IsnotMappableType = true;
						
						
					}

					var subTypeMatrixTree = UIview.listToTreeView(compatibleMatrixType);

					UIview.addSelectorOptions(collection, subTypeMatrixTree, SelectMatrix);
					/*for (cptOptions = 0; cptOptions < matrixOption.length; cptOptions++) {

						MxTypeId = matrixOption[cptOptions].id;
						
						directionAvailable = UIview.CheckRulesToAddTypeMapping(collection, selectedVPMType, MxTypeId, TypeOrRel);

						var option = { label: matrixOption[cptOptions].name, value: MxTypeId };
						//If at least one direction is possible, add MxAttrInfo to the select
						if (directionAvailable.VPM_To_MX || directionAvailable.MX_To_VPM || directionAvailable.BOTH) {
							SelectMatrix.add(option);
							if (matrixSelectValue === MxTypeId) {
								SelectMatrix.select(option, true, true, false);
								SelectMatrix.enable(option);

							}
						}

					}*/

				} 
				return IsnotMappableType;
			},




			CheckRulesToAddTypeMapping: function (collection, VPMType, MatrixType, TypeOrRel,  iTypeMapping,  withToBeRemoved =false) {

                var result = { VPM_To_MX: true, MX_To_VPM: true, BOTH: true, message: { VPM_To_MX: new Array(), MX_To_VPM: new Array(), BOTH: new Array() } }, message = "";

				/*if (this.isCloudEnv) {
					result.MX_To_VPM = false;
					result.message.MX_To_VPM.push(11);
					result.BOTH = false;
					result.message.BOTH.push(11)
				}*/

                for (var cpt = 0; cpt < collection.length; cpt++) {
                    var typeMapping = collection[cpt]._attributes;
                    var isTypeMapping = (iTypeMapping !== undefined && (iTypeMapping.KindOfMapping === typeMapping.KindOfMapping && iTypeMapping.SynchDirection === typeMapping.SynchDirection && iTypeMapping.id === typeMapping.id )) ? true : false;
					if (!isTypeMapping && (withToBeRemoved || typeMapping.deployedStatus.indexOf("Removed") === -1)) {
						if (typeMapping.KindOfMapping === TypeOrRel) {
							
                            if (typeMapping.vpmObject.id === VPMType && typeMapping.mxObject.id === MatrixType) //already map
							{
								result.BOTH = false; result.VPM_To_MX = false; result.MX_To_VPM = false;
								result.message.BOTH.push(1); result.message.VPM_To_MX.push(1);
								/*if (!this.isCloudEnv)*/ result.message.MX_To_VPM.push(1);
							}
                            else {
                                if (typeMapping.vpmObject.id === VPMType && (typeMapping.SynchDirection === "BOTH" || typeMapping.SynchDirection === "VPM_To_MX"))//vpmType already used as source
								{
									result.BOTH = false; result.VPM_To_MX = false;
									result.message.BOTH.push(3); result.message.VPM_To_MX.push(3);
								}
                                if (typeMapping.mxObject.id === MatrixType && (typeMapping.SynchDirection === "BOTH" || typeMapping.SynchDirection === "MX_To_VPM"))//matrixType already used as source 
								{
									if (!this.isCloudEnv) {
										result.BOTH = false; result.MX_To_VPM = false;
										result.message.BOTH.push(2);
										result.message.MX_To_VPM.push(2);
									}
								}
                            }
                        }
                    }
                }
                return result;
			},



			/*disableDirectionButton: function (disableBothDirection, disableVPMToMxDirection, disableMXToVPMDirection) {

				var buttonGroupDirectionDiv = document.getElementById("TypeMappingDirectionButton");
				var bothButton = buttonGroupDirectionDiv.getElement("#BOTH");
				var VPMToMXButton = buttonGroupDirectionDiv.getElement("#VPM_To_MX");
				var MXToVPMButton = buttonGroupDirectionDiv.getElement("#MX_To_VPM");

				//bothButton.input.disabled = disableBothDirection;
				//if(disableBothDirection)
				bothButton.toggleClassName('disabled', disableBothDirection);
				bothButton.disabled = disableBothDirection;

				//VPMToMXButton.input.disabled = disableVPMToMxDirection;
				//if(disableVPMToMxDirection)
				VPMToMXButton.toggleClassName('disabled', disableVPMToMxDirection);
				VPMToMXButton.disabled = disableVPMToMxDirection;

				//MXToVPMButton.input.disabled = disableMXToVPMDirection;
				//if(disableMXToVPMDirection)
				MXToVPMButton.toggleClassName('disabled', disableMXToVPMDirection);
				MXToVPMButton.disabled = disableMXToVPMDirection;
			},*/

			/*activeDirectionButton: function (activeBothDirection, activeVPMToMxDirection, activeMXToVPMDirection) {
				var buttonGroupDirectionDiv = document.getElementById("TypeMappingDirectionButton");
				var bothButton = buttonGroupDirectionDiv.getElement("#BOTH");
				var VPMToMXButton = buttonGroupDirectionDiv.getElement("#VPM_To_MX");
				var MXToVPMButton = buttonGroupDirectionDiv.getElement("#MX_To_VPM");

				bothButton.toggleClassName('active', activeBothDirection);
				VPMToMXButton.toggleClassName('active', activeVPMToMxDirection);
				MXToVPMButton.toggleClassName('active', activeMXToVPMDirection);
			},*/





			retrieveTypeRelInfo: function (id, listOfTypeRelInfo) {
				var EltTypeRelInfo, foundElt = false,  cpt = 0;

				while (!foundElt && cpt < listOfTypeRelInfo.length) {
					EltTypeRelInfo = listOfTypeRelInfo[cpt];
					if (EltTypeRelInfo != undefined) {
						if (id.toUpperCase() === EltTypeRelInfo.id.toUpperCase())
							foundElt = true;
						else cpt++
					}

				}
				if (!foundElt) return undefined;
				else return EltTypeRelInfo;
			},

			getSubTypeInfo: function (skeleton, collection, addMappingModal,selectVPM, selectMatrix,) {
				var that = this;
			var params = [];
			params.push("lang=" + widget.lang);
			var headers = {
				'Accept': 'application/json',
				'Content-Type': 'application/json',
				'Accept-Language': widget.lang
				//'SecurityContext': URLHandler.getSecurityContext()
			};

			var options = this.options;
			var fullPath = URLHandler.getURL() + "/resources/MappingWS/mapping/subtypeinformation?tenant=" + URLHandler.getTenant();
			WAFData.authenticatedRequest(fullPath, {
				method: 'GET',
				headers: headers,
				timeout: 1000 * 60 * 30, // ms, 30mn
				type: 'json',
				onComplete: function (payload, Obj, request) {
					console.log("subtypeinformation:onComplete");
					that.subTypeVPM = payload.subTypeVPM;
					that.subTypeVPMTree = UIview.listToTreeView(that.subTypeVPM);
					that.subTypeMatrix = payload.subTypeMatrix;
					//that.subRelVPM = payload.subRelVPM;
					//that.subRelVPMTree = UIview.listToTreeView(that.subRelVPM);
					//that.subRelMatrix = payload.subRelMatrix;
					that.SubTypeRelInfoRetrieved = true;
					that.addSelectorOptions(collection,that.subTypeVPMTree, selectVPM);
					//that.fillAddMappingSelectPanel(selectVPM, selectMatrix,"TYPE");
					Mask.unmask(skeleton.container);
					addMappingModal.show();
				},
				onFailure: function (object, data, responseStatus) {
					/*console.log("fail");
					console.log(this);
					var message = object;
					if (data && typeof data === 'object') { // null = 'object'
						if (data.error && data.error.message) {
							message = data.error.message;
						} else if (data.message) {
							message = data.message;
						}
					} else if (typeof object === 'string') {
						if (object.startsWith('NetworkError:')) {
							if (object.endsWith('return ResponseCode with value "0".')) {
								message = // "There is no Internet connection."
							} else if (object.endsWith('return ResponseCode with value "401".') ||
								object.endsWith('return ResponseCode with value "403".')) {
								message = "You are unauthorized to access the resource, please refresh the webpage to login and try again."
							} else {
								message =  "An error is returned from web service."
							}
						} else if (object === 'null') {
							message = "An error is returned from web service."
						}
					}
					onError(message);*/
				},
				onTimeout: function () {
					onError("timeout");
				},
			});
			},



			/**
	 * Convert a list of specialization types to a tree view representing types hierarchy.
	 * @param specializationTypesList The list containing related types.
	 */
			listToTreeView: function (specializationTypesList) {
				UWA.log("TypesNotSyncMappingCollection::listToTreeView");

				var rootType = null;
				
				for (var i = 0; i < specializationTypesList.length; i++) {
					if (!specializationTypesList[i].derivationPath) {
						rootType = specializationTypesList[i];
						break;
					}
				}

				var tree = {
					typeInfo: rootType,
					specializationTypes: {}
				};

				specializationTypesList.forEach(function (type) {
					if (type.derivationPath) {
						var parentTypes = type.derivationPath.split('/');
						if (parentTypes.length === 1) {
							tree.specializationTypes[type.id] = { typeInfo: type, specializationTypes: {}, parentNode: tree };
							return;
						}
						var currentNode = tree;
						for (var i = parentTypes.length - 2; i >= 0; i--) {
							if (typeof currentNode.specializationTypes[parentTypes[i]] === 'undefined') currentNode.specializationTypes[parentTypes[i]] = { typeInfo: null, specializationTypes: {}, parentNode: currentNode };
							currentNode = currentNode.specializationTypes[parentTypes[i]];
						}
						currentNode.specializationTypes[type.id] = { typeInfo: type, specializationTypes: {}, parentNode: currentNode };
					}
				});

				return tree;
			},



			/**
		   * Insert a new option into a specialization type selector.
		   * @param typeName The name of the type for which the selector's option will be created.
		   * @param specializationTypeInfo The information about the specialization type.
		   */
			addSelectorOptions: function (collection, typeTreeNode, selector) {
				UWA.log('TypesNotSyncMappingLayoutUtilities::addSelectorOptions');

					var options = [];
					this.auxAddSelectorOptions(collection, options, typeTreeNode);
					// Sort the options of the selectors
					options.sort(function (opt1, opt2) {
						if (!opt1.specializationTypeInfo || !opt2.specializationTypeInfo || !opt1.specializationTypeInfo.typeInfo || !opt2.specializationTypeInfo.typeInfo) return 0;
						if (opt1.specializationTypeInfo.typeInfo.name > opt2.specializationTypeInfo.typeInfo.name) return 1;
						return -1;
					});
					// Add options to the selector
					for (var i = 0; i < options.length; i++) {
						selector.add(options[i]);
						selector.getOption(options[i].specializationTypeInfo.typeInfo.id).specializationTypeInfo = options[i].specializationTypeInfo;
					}

			},

			/**
			 * Recursive method iterating over sub-types tree to inject new options into the type selector.
			 * @param options The options of the selector which will be added.
			 * @param treeNode The object containing information about su-types and current type.
			 * @param badgeList The list of badges currently in the associated TNS mapping line.
			 * @param nodeTobeAdded A flag saying if the current node should be added or not. "false" by default.
			 * @param path A string corresponding to the inheritance path of the sub-type. Empty by default.
			 */
			auxAddSelectorOptions: function (collection, options, treeNode , nodeTobeAdded /*= false*/, path /*= ''*/) {
				UWA.log('TypesNotSyncMappingLayoutUtilities::auxAddSelectorOptions');
				if (nodeTobeAdded === undefined) nodeTobeAdded = false;
				if (path === undefined) path = '';
				var self = this;

				if (nodeTobeAdded && treeNode.typeInfo !== null) {
					options.push({
						'label': treeNode.typeInfo.name,
						'value': treeNode.typeInfo.id,
						'group': path
					});

					var option = options[options.length - 1];
					option.specializationTypeInfo = treeNode;

					if (this.isCloudEnv) {
						var cptTypeMapping;
						for (cptTypeMapping = 0; cptTypeMapping < collection.length; cptTypeMapping++) {
							var mappingType = collection[cptTypeMapping];
							if (mappingType.get('vpmObject').id === option.value) {
								option.disabled = true;
								break;
							}
						}
					}
					

				}

				for (var subTypeName in treeNode.specializationTypes) {
					self.auxAddSelectorOptions(
						collection,
						options,
						treeNode.specializationTypes[subTypeName],
						 true,
						(treeNode.typeInfo !== null) ? ((path !== '') ? path + '/' + treeNode.typeInfo.name : treeNode.typeInfo.name) : path
					);
				}
			},



			RemoveTypeMapping: function (skeleton, collection, typeMappingToRemove, isAlreadyCleanForCloud) {

				Mask.mask(skeleton.container);
				var that = this;
                var mappingToSend = new Array();
				mappingToSend.push(typeMappingToRemove);

				//In case of "removed by import" type mapping, check if another type mapping with same VPM and MX type exist, in this case don't remove attribute
				var bwithAssociatedAttributeMapping = true;
				var cptTypeMapping = 0;
				if (typeMappingToRemove.get('deployedStatus').indexOf("Removed") !== -1) {
					for (cptTypeMapping = 0; cptTypeMapping < collection._models.length; cptTypeMapping++) {
						var mappingType = collection._models[cptTypeMapping];
						if (mappingType.get('vpmObject').id === typeMappingToRemove.get('vpmObject').id && mappingType.get('mxObject').id === typeMappingToRemove.get('mxObject').id)
							bwithAssociatedAttributeMapping = false;
					}
				}
                datatoSend = {
					typeMapping: mappingToSend,
					//withAssociatedAttributeMapping: bwithAssociatedAttributeMapping,

                };


				var url = URLHandler.getURL() + "/resources/MappingWS/mapping/removetypemapping?tenant=" + URLHandler.getTenant() + "&withAssociatedAttributeMapping=" + bwithAssociatedAttributeMapping + "&isAlreadyCleanForCloud=" + isAlreadyCleanForCloud.value, datatoSend;

                WAFData.authenticatedRequest(url, {
                    timeout: 250000,
                    method: 'POST',
                    data: JSON.stringify(datatoSend),
                    type: 'json',
                    //proxy: 'passport',

                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },

                    onFailure: function (json) {
						that.onRemoveFailure.call(that, json, skeleton);
                    },

                    onComplete: function (json) {
						that.onRemoveSuccess.call(that, json, skeleton, collection, typeMappingToRemove);
						/*if (!that.isCloudEnv) {
							var selectVPM = document.getElementById("selectVPMTypeMapping");
							var VPMTypeOption = selectVPM.getOption(typeMappingToRemove.get('vpmObject').id);
							selectVPM.enable(VPMTypeOption);
						}
						else
							isAlreadyCleanForCloud.value = true;*/
						if (that.isCloudEnv) isAlreadyCleanForCloud.value = true;
                    },
                });

			},




			

			RestoreTypeMapping: function (skeleton, collection, typeMappingToRemove, isAlreadyCleanForCloud) {

				var that = this;
				Mask.mask(skeleton.container);
				var mappingToSend = new Array();
				mappingToSend.push(typeMappingToRemove);

	
				datatoSend = {
					typeMapping: mappingToSend,
				};


				var url = URLHandler.getURL() + "/resources/MappingWS/mapping/restoretypemapping?tenant=" + URLHandler.getTenant() + "&isAlreadyCleanForCloud=" + isAlreadyCleanForCloud.value , datatoSend;

					WAFData.authenticatedRequest(url, {
						timeout: 250000,
						method: 'POST',
						data: JSON.stringify(datatoSend),
						type: 'json',
						//proxy: 'passport',

						headers: {
							'Content-Type': 'application/json',
							'Accept': 'application/json'
						},

						onFailure: function (json) {
							UIview.onRestoreTypeMappingFailure.call(that, json, skeleton);
						},

						onComplete: function (json) {
							UIview.onRestoreTypeMappingSuccess.call(that, json, skeleton);
							if (UIview.isCloudEnv)
								isAlreadyCleanForCloud.value = true;
						},

				});

			},

			onRestoreTypeMappingFailure: function (json, skeleton) {
				UWA.log(json);
				Mask.unmask(skeleton.container);
				this.userMessaging.add({ className: "error", message: MappingManagementNLS.applyErrorMessage });
			},


			onRestoreTypeMappingSuccess: function (json, skeleton) {
				//this.userMessaging.add({ className: "success", message: MappingManagementNLS.applySuccessMessage });
				Mask.unmask(skeleton.container);
				var model = skeleton.getActiveIdCard().model;
				var status = model.get('deployedStatus');
				var iconStatus = '';
				var colorIconStatus = '';
				var imgTitle = '';
				if (status.indexOf('Stored') !== -1) {
					iconStatus = 'fonticon-cog';
					colorIconStatus = 'orange';
					//imgTitle = MappingManagementNLS.Stored;
					model.set('deployedStatus', 'Stored');
				}
				else {
					iconStatus = 'fonticon-check';
					colorIconStatus = 'green';
					imgTitle = MappingManagementNLS.Deployed;
					model.set('deployedStatus', 'Deployed');
				}

				var typeMappingId = model.get('id');
				var idxRemoved = typeMappingId.indexOf('_Removed');
				if (idxRemoved !== -1) {
					var newId = typeMappingId.slice(0, idxRemoved);
					model.set('id', newId);
                }

				var typeMappingStatusDiv = document.getElementById("TypeMappingStatusIcon");
				UIview.modifySatusDirection(typeMappingStatusDiv, iconStatus, colorIconStatus, imgTitle);

			},




			DeployAllImportedMapping: function (container, skeleton, collection, isAlreadyCleanForCloud, userMessaging) {

				var that = this;
				Mask.mask(container);

				var url = URLHandler.getURL() + "/resources/MappingWS/mapping/deployAllImportedmapping?tenant=" + URLHandler.getTenant() + "&isAlreadyCleanForCloud=" + isAlreadyCleanForCloud.value;

				WAFData.authenticatedRequest(url, {
					timeout: 250000,
					method: 'POST',
					type: 'json',
					//proxy: 'passport',

					headers: {
						'Content-Type': 'application/json',
						'Accept': 'application/json'
					},

					onFailure: function (json) {
						that.onDeployAllImportedMappingFailure.call(that, json, container, skeleton, userMessaging);
					},

					onComplete: function (json) {
						that.onDeployAllImportedMappingSuccess.call(that, json, container, skeleton, collection, userMessaging);
						if (that.isCloudEnv)
							isAlreadyCleanForCloud.value = true;
					},

				});

			},



			onDeployAllImportedMappingFailure: function (json, container, skeleton, userMessaging) {
				UWA.log(json);
				Mask.unmask(container);
				userMessaging.add({ className: "error", message: MappingManagementNLS.DeployAllImportedErrorMessage });
			},


			onDeployAllImportedMappingSuccess: function (json, container, skeleton, collection, userMessaging) {
				userMessaging.add({ className: "success", message: MappingManagementNLS.DeployAllImportedSuccessMessage });

				var i = 0;
				var typeMappingToRemove = [];
				for (i = 0; i < collection._models.length; i++) {
					var typeMapping = collection._models[i];
					var deployedStatus = typeMapping.get('deployedStatus');
					if (deployedStatus === "Stored")
						typeMapping.set('deployedStatus', 'Deployed');
					else if (deployedStatus.indexOf("Removed") !== -1) {
						typeMappingToRemove.push(typeMapping);
                    }
				}


				for (i = 0; i < typeMappingToRemove.length; i++) {
					collection.remove(typeMappingToRemove[i].id);
				}

				var typeMappingStatusDiv = document.getElementById("TypeMappingStatusIcon");
				if (typeMappingStatusDiv !== null) skeleton.slideBack();

				Mask.unmask(container);
		

			},

			ResetAllImportedMapping: function (container, skeleton, collection, isAlreadyCleanForCloud, userMessaging) {

				var that = this;
				Mask.mask(container);

				var url = URLHandler.getURL() + "/resources/MappingWS/mapping/resetAllImportedmapping?tenant=" + URLHandler.getTenant() + "&isAlreadyCleanForCloud=" + isAlreadyCleanForCloud.value;

				WAFData.authenticatedRequest(url, {
					timeout: 250000,
					method: 'POST',
					type: 'json',
					//proxy: 'passport',

					headers: {
						'Content-Type': 'application/json',
						'Accept': 'application/json'
					},

					onFailure: function (json) {
						that.onResetAllImportedMappingFailure.call(that, json, container, skeleton, userMessaging);
					},

					onComplete: function (json) {
						that.onResetAllImportedMappingSuccess.call(that, json, container, skeleton, collection, userMessaging);
						if (that.isCloudEnv)
							isAlreadyCleanForCloud.value = true;
					},

				});

			},



			onResetAllImportedMappingFailure: function (json, container, skeleton, userMessaging) {
				UWA.log(json);
				Mask.unmask(container);
				userMessaging.add({ className: "error", message: MappingManagementNLS.ResetAllImportedErrorMessage });
			},


			onResetAllImportedMappingSuccess: function (json, container, skeleton, collection, userMessaging) {
				userMessaging.add({ className: "success", message: MappingManagementNLS.ResetAllImportedSuccessMessage });

				var i = 0;
				var typeMappingToRemove = [];
				for (i = 0; i < collection._models.length; i++) {
					var typeMapping = collection._models[i];
					var deployedStatus = typeMapping.get('deployedStatus');
					if (deployedStatus.indexOf("Stored") !== -1)
						typeMappingToRemove.push(typeMapping);
					else if (deployedStatus.indexOf("Removed") !== -1) {
						typeMapping.set('deployedStatus', 'Deployed');
					}
				}


				for (i = 0; i < typeMappingToRemove.length; i++) {
					collection.remove(typeMappingToRemove[i].id);
				}

				for (i = 0; i < collection._models.length; i++) {
					var resultInvalidMapping = UIview.isInvalidMapping(collection._models, collection._models[i]._attributes);
					collection._models[i].set('invalidStatus', { isInvalid: resultInvalidMapping.isInvalid, errorMessage: resultInvalidMapping.errorMessage, errorsList: resultInvalidMapping.errorsList });
				}

				var typeMappingStatusDiv = document.getElementById("TypeMappingStatusIcon");
				if (typeMappingStatusDiv !== null) skeleton.slideBack();

				Mask.unmask(container);


			},





			onRemoveFailure: function (json, skeleton) {
                UWA.log(json);
				Mask.unmask(skeleton.container);
                 this.userMessaging.add({ className: "error", message: MappingManagementNLS.applyErrorMessage });
            },

            onRemoveSuccess: function (json, skeleton, collection, typeMappingToRemove) {                      

                var cpt = 0, cptAttr = 0, item, title, line, cell, nbofLines, mappingElt, imgSpan, itemToRemove = new Array(), that = this, currDate, currTime, diffDate,i;
				//Mask.unmask(skeleton.container);
                /*currDate = new Date();
                currTime = currDate.getTime();
                diffDate = currTime - this.lastAlertDate;
                this.lastAlertDate = currTime;

                this.lastAlertDate = currTime;
                if (diffDate >= 2000) {
                    this.userMessaging.add({ className: "success", message: MappingManagementNLS.applySuccessMessage });
                }*/

				

				Mask.unmask(skeleton.container);
                skeleton.slideBack();
				collection.remove(typeMappingToRemove.id);
				for (i = 0; i < collection._models.length; i++) {
					//var resultInvalidMapping = UIview.isInvalidMapping(collection._models, collection._models[i]._attributes);
					//collection._models[i].set('invalidStatus', { isInvalid: resultInvalidMapping.isInvalid, errorMessage: resultInvalidMapping.errorMessage, errorsList: resultInvalidMapping.errorsList });
					collection._models[i].dispatchEvent("onChange", [collection._models[i]]);
				}

              
			},

			modifySatusDirection: function (div, icon, color, iconTitle) {
				div.empty();
				var imgSpanStatus = UWA.createElement('span', {
					'class': 'fonticon  ' + icon,
					'title': iconTitle
				}).inject(div);
				imgSpanStatus.setStyle("color",color);
			},

			removeResetDirectionButton: function (TypeMappingDirectionDiv) {
				if (TypeMappingDirectionDiv !== null) {
					var resetButton = TypeMappingDirectionDiv.getElement("#TypeMappingResetButton");
					if (resetButton !== null && resetButton !== undefined) resetButton.hide();
					var modifyButton = TypeMappingDirectionDiv.getElement("#TypeMappingModifyButton");
					if (modifyButton !== null && resetButton !== undefined) {
						modifyButton.setStyle('border-top-right-radius', '3px');
						modifyButton.setStyle('border-bottom-right-radius', '3px');
					}
					/*var iconright = TypeMappingDirectionDiv.getElement(".fonticon-expand-right");
					var iconleft = TypeMappingDirectionDiv.getElement(".fonticon-expand-left");
					var iconboth = TypeMappingDirectionDiv.getElement(".fonticon-arrow-combo-horizontal");
					if (iconright !== null && iconright !== undefined) iconright.remove();
					if (iconleft !== null && iconleft !== undefined) iconleft.remove();
					if (iconboth !== null && iconboth !== undefined) iconboth.remove();*/
				}
			},


			checkCompatibleDirectionwithAttributeMapping: function (attributeMapping, checkOnlyNewOrmodified) {
				var result = { VPM_To_MX: true, MX_To_VPM: true, BOTH: true, message: { VPM_To_MX: new Array(), MX_To_VPM: new Array(), BOTH: new Array() } }, message = "";

				var cptAttrMapping = 1;
				for (cptAttrMapping = 0; cptAttrMapping < attributeMapping.length; cptAttrMapping++) {
					var mappingAttr = attributeMapping[cptAttrMapping];
					if (mappingAttr.status.indexOf("Removed") === -1) {
						var checkattribute = true;
						if (checkOnlyNewOrmodified === true && mappingAttr.status.indexOf("New") === -1 && mappingAttr.status.indexOf("Modified") === -1) checkattribute = false;

						if (checkattribute)
						{
							if (mappingAttr.SynchDirection === "BOTH") { result.VPM_To_MX = false; result.MX_To_VPM = false; }
							else if (mappingAttr.SynchDirection === "VPM_To_MX") { result.MX_To_VPM = false; }
							else if (mappingAttr.SynchDirection === "MX_To_VPM") { result.VPM_To_MX = false; }
						}
					}
				}

				if (result.VPM_To_MX === false) result.message.VPM_To_MX.push(10);
				if (result.MX_To_VPM === false) result.message.MX_To_VPM.push(10);
				//   }
				return result;
			},



			/*disableDirectionButtonAccordingMappingRules: function (collection, typeMapping, listofAttributesMapping) {

				var isBaseMapping = typeMapping.isBaseMapping;
				if (!isBaseMapping) {

					var authorizedDirection = UIview.CheckRulesToAddTypeMapping(collection, typeMapping.vpmObject.id, typeMapping.mxObject.id, typeMapping.KindOfMapping, typeMapping);

					var disableBOTH = false, disableVPMToMX = false, disableMXToVPM = false;

					if (authorizedDirection.BOTH) {

						authorizedDirection = UIview.checkCompatibleDirectionwithAttributeMapping(listofAttributesMapping);
					}

					if (!authorizedDirection.BOTH) disableBOTH = true;
					if (!authorizedDirection.VPM_To_MX) disableVPMToMX = true;
					if (!authorizedDirection.MX_To_VPM) disableMXToVPM = true;

					UIview.disableDirectionButton(disableBOTH, disableVPMToMX, disableMXToVPM);


				}
			},*/


			/*setButtonDirection: function (direction, modifyDirectionButton) {
				if (direction === "BOTH") {
					modifyDirectionButton.setIcon("fonticon fonticon-arrow-combo-horizontal");
					modifyDirectionButton.elements.input.value = 'BOTH';
				}
				else if (direction === "VPM_To_MX") {
					modifyDirectionButton.setIcon("fonticon fonticon-expand-right");
					modifyDirectionButton.elements.input.value = "VPM_To_MX";
				}
				else if (direction === "MX_To_VPM") {
					modifyDirectionButton.setIcon("fonticon fonticon-expand-left");
					modifyDirectionButton.elements.input.value = 'MX_To_VPM';
				}
			},*/


			setTypeMappingDirection: function (direction, pSkeleton, isCloudEnv) {

				var TypeIdView = pSkeleton.getActiveIdCard();
				var idCardView = TypeIdView.container.getElement(".info-section");
				var directionTypeMappingButton = idCardView.getElement("#TypeMappingDirectionButton");
				var spanDirection = (directionTypeMappingButton.getChildren())[0];

				spanDirection.empty();
				var imgSpanRight = UWA.createElement('span', {
					'class': 'fonticon  fonticon-expand-right'
				})

				var imgSpanLeft = UWA.createElement('span', {
					'class': 'fonticon  fonticon-expand-left'
				})

				if (direction == "BOTH") {
					spanDirection.title = MappingManagementNLS.both;
					if (!isCloudEnv)
						imgSpanLeft.inject(spanDirection);
					imgSpanRight.inject(spanDirection);
					if (isCloudEnv)
						imgSpanRight.setStyle("margin-left", "22px");
				}
				else if (direction == "VPM_To_MX") {
					spanDirection.title = MappingManagementNLS.VPMToBOMSide;
					imgSpanRight.inject(spanDirection);
					imgSpanRight.setStyle("margin-left", "22px");
				}
				else if (direction == "MX_To_VPM") {
					spanDirection.title = MappingManagementNLS.BOMToVPMSide;
					imgSpanLeft.inject(spanDirection);
				}

				spanDirection.setStyle("vertical-align", "text-bottom");
				spanDirection.value = direction;
			},





			//Add the input list of messages in the given popover
			displayAddMappingWarningMessage: function (messageDiv, popoverInfoMapping, messages) {
				var messageList, iconInfo, cpt = 0;
				if (messageDiv != undefined) {
					iconInfo = messageDiv.getElement(".InfoAddMapping");
					if (messages.length !== 0) {
						iconInfo.show();
						messageList = UWA.createElement('ul', { 'class': 'ListAddMappingMessage' });

						for (cpt = 0; cpt < messages.length; cpt++) {
							UWA.createElement('li', {
								'text': UIview.mappableTypeReaseon[messages[cpt]],
							}).inject(messageList);
						}
						popoverInfoMapping.setBody(messageList);
					}
					else {
						popoverInfoMapping.setBody("");
						iconInfo.hide();
					}
				}
			},


			//launch not mappable attribute panel => show attributes that cannot be mapped with selected VPM attributes and why they cannot be mapped
			ShowNotMappableTypes: function (addMappingModal,container,TypeMappingCollection, selectedVPMType, listOfBOMTypes, KindOfMapping) {

				var OKBtn, CancelBtn, modalbodydiv, changeDirectionModal, modifyDirectionTitle, that = this;

				modifyDirectionTitle = UWA.createElement('h4', {
					text: MappingManagementNLS.Incompatibletypes,
				});

				modalbodydiv = UWA.createElement('div', {
					'class': 'PartProductAddMappingDiv',
				})

				//Map with all not mappable reasons as key and the attributes matching with these reasons as values
				var mapNotMappableReason = new Map();
				mapNotMappableReason.set("AlreadyMapped", new Array());
				mapNotMappableReason.set("BOMAlreadyUsedAsSource", new Array());

				var isVPMIsUsedAsSource = false;

				var i = 0;
				for (i = 0; i < listOfBOMTypes.length; i++) {
					var directionAvailable = UIview.CheckRulesToAddTypeMapping(TypeMappingCollection, selectedVPMType, listOfBOMTypes[i].id, KindOfMapping);

					var arrayToPopulate;
					//if no direction is available, put Matrix attribute in "not mappable" attribute panel
					if (!directionAvailable.BOTH && !directionAvailable.VPM_To_MX && !directionAvailable.MX_To_VPM) {
						//Put all not mappable reasons in NotMappableReason array
						var NotMappableReason = new Array();
						var j = 0;
						for (j = 0; j < directionAvailable.message.BOTH.length; j++) {
							NotMappableReason.push(directionAvailable.message.BOTH[j]);
						}
						for (j = 0; j < directionAvailable.message.VPM_To_MX.length; j++) {
							if (NotMappableReason.indexOf(directionAvailable.message.VPM_To_MX[j]) === -1)
								NotMappableReason.push(directionAvailable.message.VPM_To_MX[j]);
						}
						for (j = 0; j < directionAvailable.message.MX_To_VPM.length; j++) {
							if (NotMappableReason.indexOf(directionAvailable.message.MX_To_VPM[j]) === -1)
								NotMappableReason.push(directionAvailable.message.MX_To_VPM[j]);
						}

						//Attributes cannot be mapped for only on reason
						if (NotMappableReason.length === 1) {
							
							//the attributes are already mapped (AlreadyMapped key in the map)
							if (NotMappableReason[0] === 1) {
								arrayToPopulate = mapNotMappableReason.get("AlreadyMapped");
								arrayToPopulate.push(listOfBOMTypes[i].name);
							}
						}
						//Attributes cannot be mapped for many reasons
						else {
							//VPM attribute is read only or already used as target
							/*if (!isVPMIsUsedAsSource) {
								if (NotMappableReason.indexOf(3) !== -1) isVPMIsUsedAsSource = true;
							}*/	
							//part is alreday used as source
							if (NotMappableReason.indexOf(2) !== -1) {
								arrayToPopulate = mapNotMappableReason.get("BOMAlreadyUsedAsSource");
								arrayToPopulate.push(listOfBOMTypes[i].name);
							}
						}
					}
				}

				var resultDiv = UWA.createElement('div', { 'class': 'result' }).inject(modalbodydiv);
				///create accordion and fill it with different mapping reasons and their associated attribute
				var accordionNotMappable = ParametersLayoutViewUtilities.createFamilyUIKITAccordion(resultDiv);

				var cpt = 0;
				//For already map reason
				var alreadyMapped = mapNotMappableReason.get("AlreadyMapped");
				if (alreadyMapped.length !== 0) {
					var listAlreadyMapped = UWA.createElement('ul', { 'class': 'listNotMappableAttribute' });
					for (cpt = 0; cpt < alreadyMapped.length; cpt++) {
						UWA.createElement('li', {
							'text': alreadyMapped[cpt],
						}).inject(listAlreadyMapped);
					}

					accordionNotMappable.addItem({
						title: MappingManagementNLS.AlreadyMappedReason,
						content: listAlreadyMapped,
						selected: false,
						name: "AlreadyMapped",
					});
				}

				//For other reasons
				//var othersReasonDiv = UWA.createElement('div', { 'class': 'others' });
				//Display if Product attribute is read-only or alredy used as target
				/*var VPMMessage = "";
		        if (isVPMIsUsedAsSource) VPMMessage = MappingManagementNLS.PrdUsedAsTargetReason
				UWA.createElement('p', {
					text: VPMMessage,
					'class': 'font-3dsbold'// font-3dsbold
				}).inject(othersReasonDiv);*/

				var TargetAttribute = mapNotMappableReason.get("BOMAlreadyUsedAsSource");
				if (TargetAttribute.length !== 0) {
					var listTargetAttribute = UWA.createElement('ul', { 'class': 'listNotMappableAttribute' });
					for (cpt = 0; cpt < TargetAttribute.length; cpt++) {
						UWA.createElement('li', {
							'text': TargetAttribute[cpt],
						}).inject(listTargetAttribute);
					}


					accordionNotMappable.addItem({
						title: MappingManagementNLS.BOMUsedAsSourceReason,
						content: listTargetAttribute,
						selected: false,
						name: "BOMUsedAsSource",
					});
				}

				CancelBtn = new Button({
					value: MappingManagementNLS.Cancel,
					id: 'modalCancelButton',
					className: 'btn default'
				});

				changeDirectionModal = new Modal({
					className: 'add-mapping-modal',
					closable: true,
					header: modifyDirectionTitle,
					body: modalbodydiv,
					footer: [OKBtn, CancelBtn],
					renderTo: container,
					events: {
						onShow: function () {
						},
						onHide: function () {
							addMappingModal.show();
						}
					}

				});

				CancelBtn.addEvent("onClick", function (e) {
					UWA.log(e);//that.onCancelCalled();
					changeDirectionModal.hide();
					//addMappingModal.show();
				});


				//changeDirectionModal.inject(this.contentDiv);
				changeDirectionModal.show();
				return changeDirectionModal;

			},


			isInvalidMapping: function (collection, iTypeMapping, editedSynchDirection, withToBeRemoved = false) {

				var invalidStoredMapping = false, messageInvalidStoredMapping = "", attrVPMInfo, attrMatrixInfo, findAttribute, listofErrors = new Array();


				var isVPMAbstract = iTypeMapping.vpmObject.isAbstract;
				var isBOMAbstract = iTypeMapping.mxObject.isAbstract;
				var isVPMVisible = iTypeMapping.vpmObject.isVisible;
				var isBOMVisible = iTypeMapping.mxObject.isVisible;
				var isVPMTNS = iTypeMapping.vpmObject.isTNS;
				var isBOMTNS = iTypeMapping.mxObject.isTNS;
				var isVPMUnknown = iTypeMapping.vpmObject.isUnknown;
				var isBOMUnknown = iTypeMapping.mxObject.isUnknown;
				var SynchDirection = iTypeMapping.SynchDirection;
				if (editedSynchDirection !== undefined) SynchDirection = editedSynchDirection;


				if (isVPMAbstract || !isVPMVisible) {
					invalidStoredMapping = true;
					messageInvalidStoredMapping += MappingManagementNLS.ErrorProductTypeNotAvailable + "\n";
					listofErrors.push(6);
                }

				if (isBOMAbstract || !isBOMVisible) {
					invalidStoredMapping = true;
					messageInvalidStoredMapping += MappingManagementNLS.ErrorPartTypeNotAvailable + "\n";
					listofErrors.push(7);
				}

				if (isVPMTNS) {
					invalidStoredMapping = true;
					messageInvalidStoredMapping += MappingManagementNLS.ErrorProductTypeNIB + "\n";
					listofErrors.push(5);
				}

				if (isBOMTNS) {
					invalidStoredMapping = true;
					messageInvalidStoredMapping += MappingManagementNLS.ErrorPartTypeNIB + "\n";
					listofErrors.push(4);
				}

				if (isVPMUnknown) {
					invalidStoredMapping = true;
					messageInvalidStoredMapping += MappingManagementNLS.ErrorProductTypeUnknown + "\n";
					listofErrors.push(8);
				}

				if (isBOMUnknown) {
					invalidStoredMapping = true;
					messageInvalidStoredMapping += MappingManagementNLS.ErrorPartTypeUnknown + "\n";
					listofErrors.push(9);
				}

				//Check other rules

				var directionAvailable = UIview.CheckRulesToAddTypeMapping(collection, iTypeMapping.vpmObject.id, iTypeMapping.mxObject.id, "TYPE", iTypeMapping, withToBeRemoved);
				var i = 0;
				if (SynchDirection == "BOTH" && !directionAvailable.BOTH) {
					for (i = 0; i < directionAvailable.message.BOTH.length; i++) {
						messageInvalidStoredMapping += UIview.mappableTypeReaseon[directionAvailable.message.BOTH[i]] + "\n";
						listofErrors.push(directionAvailable.message.BOTH[i]);
					}
					invalidStoredMapping = true;
				}
				else if (SynchDirection == "VPM_To_MX" && !directionAvailable.VPM_To_MX) {
					for (i = 0; i < directionAvailable.message.VPM_To_MX.length; i++) {
						messageInvalidStoredMapping += UIview.mappableTypeReaseon[directionAvailable.message.VPM_To_MX[i]] + "\n";
						listofErrors.push(directionAvailable.message.VPM_To_MX[i]);
					}
					invalidStoredMapping = true;
				}
				else if (SynchDirection == "MX_To_VPM" && !directionAvailable.MX_To_VPM) {
					for (i = 0; i < directionAvailable.message.MX_To_VPM.length; i++) {
						messageInvalidStoredMapping += UIview.mappableTypeReaseon[directionAvailable.message.MX_To_VPM[i]] + "\n";
						listofErrors.push(directionAvailable.message.MX_To_VPM[i]);
					}
					invalidStoredMapping = true;
				}

				return { isInvalid: invalidStoredMapping, errorMessage: messageInvalidStoredMapping, errorsList: listofErrors };
			},



			showContextualDeleteTypeMappingModal: function (iTargetElement, modalCssClass, nlsMessage, nlsMsgOnOkBtn, nlsMsgOnCancelBtn, nlsTitle, pSkeleton, collection, typeModel, isAlreadyCleanForCloud ) {
				var deleteConfirmModal, deleteDiv,
					lineModal, iCell, modalDeleteBtn, modalCancelBtn, mainText;

				deleteDiv = UWA.createElement('div', {
					'id': 'deleteAttributeConfDiv'
				});

				lineModal = UWA.createElement('tr').inject(deleteDiv);
				iCell = UWA.createElement('td').inject(lineModal);

				mainText = UWA.createElement('p', {
					text: nlsMessage,
					'class': 'font-3dslight'
				}).inject(iCell);


				UWA.createElement('br').inject(mainText);
				UWA.createElement('br').inject(mainText);

				UWA.createElement('p', {
					text: MappingManagementNLS.PanelRemoveQuestion,
					'class': 'font-3dslight'
				}).inject(mainText);

				modalDeleteBtn = new Button({
					value: nlsMsgOnOkBtn, //ParamSkeletonNLS.RemoveElement,
					className: 'attrConfRemoveBtn warning',
					id: "modalOKButton"
				});

				modalCancelBtn = new Button({
					value: nlsMsgOnCancelBtn, //ParamSkeletonNLS.CancelButton,
					className: 'attrConfCancelBtn default',
					id: 'modalCancelButton'
				});

				deleteConfirmModal = new Modal({
					className: modalCssClass,
					overlay: true,
					closable: true,
					header: '<h4>' + nlsTitle/*ParamSkeletonNLS.ConfirmDelete*/ + '</h4>',
					body: deleteDiv,
					footer: [modalDeleteBtn, modalCancelBtn]
				}).inject(iTargetElement);

				deleteConfirmModal.getContent().getElements('.attrConfRemoveBtn').forEach(function (element) {
					element.addEvent('click', function () {
						deleteConfirmModal.destroy();
						UIview.RemoveTypeMapping(pSkeleton, collection, typeModel, isAlreadyCleanForCloud);
					});
				});

				deleteConfirmModal.getContent().getElements('.attrConfCancelBtn').forEach(function (element) {
					element.addEvent('click', function () {
						deleteConfirmModal.destroy();
					});
				});
				deleteConfirmModal.show();
			},



			displayMappableTypeReaseon(message,reasonList, userMessaging, className) {
				var cpt = 0;
				var messageList = "";
				var separator = "";
				for (cpt = 0; cpt < reasonList.length; cpt++) {
					messageList = messageList + separator + UIview.mappableTypeReaseon[reasonList[cpt]];
					separator = ", ";
				}
				userMessaging.add({ className: className, message: message+ ":\n" + messageList });
			},

			UpdateTypeMappingStatus(TypeMappingCollection, typeRelMapping) {

				var resultInvalidMapping = UIview.isInvalidMapping(TypeMappingCollection, typeRelMapping);

				//update type mapping status
				var typeMappingStatusDiv = document.getElementById("TypeMappingStatusIcon");
				//var status = pSkeleton.getActiveIdCard().model.get('Status');
				var status = typeRelMapping.status;
				var iconStatus = 'fonticon-check';
				var colorIconStatus = 'green';
				if (status === "Stored") {
					colorIconStatus = 'orange';
					iconStatus = 'fonticon-cog';
				}
				if (resultInvalidMapping.isInvalid) colorIconStatus = 'red';

				UIview.modifySatusDirection(typeMappingStatusDiv, iconStatus, colorIconStatus);

				if (resultInvalidMapping.isInvalid) {
					var infoInvalidMappingSpan = UWA.createElement('span', {
						'class': 'InfoInvalidMapping fonticon fonticon-info'
					}).inject(typeMappingStatusDiv);

					var popoverInfoInvalidMapping = new Popover({
						target: infoInvalidMappingSpan,
						trigger: "hover",
						animate: "true",
						position: 'left',
						body: resultInvalidMapping.errorMessage,
					});

					infoInvalidMappingSpan.setStyle("margin-left", '7px');
				}
			}

		    
	}



	return UIview;
});

/**
* @quickreview  ROW 25:02:11 creation
*/

define(
    'DS/ParameterizationSkeleton/Utils/ParameterizationDisplayProperties/ParameterizationDisplayPropertiesWebServices',
    [
        'UWA/Core',
        'UWA/Class',
        'DS/WAFData/WAFData',
        'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
    ],
    function (UWA, Class, WAFData, URLHandler) {

        'use strict';

        var ParameterizationDisplayPropertiesWebServices = Class.singleton({

            /*
            * getlistofDimensionAttributes
            */
            getlistofDimensionAttributes: function (types, isExtension, callback) {

                var url = URLHandler.getURL() + "/resources/i3dx/uxproperties/uiservices/getOOTBDimensionAttributes";
                var datatoSend = {
                    types: [types],
                    isExtension: JSON.parse(isExtension)
                };
                var defaultLanguage = 'en';
                var lang = UWA.is(widget) ? (UWA.is(widget.lang, 'string') ? widget.lang : defaultLanguage) : defaultLanguage;

                WAFData.authenticatedRequest(url, {
                    timeout: 250000,
                    method: 'POST',
                    data: JSON.stringify(datatoSend),
                    type: 'json',
                    headers: {
                        'Accept-Language': lang,
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },

                    onFailure: function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function (json) {
                        callback.onSuccess(json);
                    }
                });
            },

            /*
            * getlistofAllAttributes
            */
            getlistofAllAttributes: function (types, isExtension, callback) {

                var url = URLHandler.getURL() + "/resources/i3dx/uxproperties/uiservices/getAllOOTBAttributes";
                var datatoSend = {
                    types: [types],
                    isExtension: JSON.parse(isExtension)
                };
                var defaultLanguage = 'en';
                var lang = UWA.is(widget) ? (UWA.is(widget.lang, 'string') ? widget.lang : defaultLanguage) : defaultLanguage;

                WAFData.authenticatedRequest(url, {
                    timeout: 250000,
                    method: 'POST',
                    data: JSON.stringify(datatoSend),
                    type: 'json',
                    headers: {
                        'Accept-Language': lang,
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },

                    onFailure: function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function (json) {
                        callback.onSuccess(json);
                    }
                });
            },

            /*
            * getNLS
            */
            getNLS: function (types,attributes, callback) {

                var url = URLHandler.getURL() + "/resources/i3dx/uxproperties/uiservices/getNLS";
                var datatoSend = {
                    types: types,
                    attributes: attributes
                };

                var defaultLanguage = 'en';
                var lang = UWA.is(widget) ? (UWA.is(widget.lang, 'string') ? widget.lang : defaultLanguage) : defaultLanguage;

                WAFData.authenticatedRequest(url, {
                    timeout: 250000,
                    method: 'POST',
                    data: JSON.stringify(datatoSend),
                    type: 'json',
                    headers: {
                        'Accept-Language': lang,
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },

                    onFailure: function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function (json) {
                        callback.onSuccess(json);
                    }
                });
            },

            /*
            * getListOfTypes
            */
            getListOfTypes: function (familyID, callback) {

                var url = URLHandler.getURL() + "/resources/i3dx/uxproperties/uiservices/getTypesList";
                if ((familyID != null || familyID != undefined))
                    url = url + "?familyID=" + familyID;
                
                var defaultLanguage = 'en';
                var lang = UWA.is(widget) ? (UWA.is(widget.lang, 'string') ? widget.lang : defaultLanguage) : defaultLanguage;

                WAFData.authenticatedRequest(url, {
                    timeout: 250000,
                    method: 'GET',
                    data: "",
                    type: 'json',
                    headers: {
                        'Accept-Language': lang,
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },

                    onFailure: function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function (json) {
                        callback.onSuccess(json);
                    }
                });
            },

            /*
            * getListOfTypes
            */
            getListOfCorpusTypes: function (familyID, callback) {

                var url = URLHandler.getURL() + "/resources/i3dx/uxproperties/uiservices/getCorpusTypesList";
                if ((familyID != null || familyID != undefined))
                    url = url + "?familyID=" + familyID;

                var defaultLanguage = 'en';
                var lang = UWA.is(widget) ? (UWA.is(widget.lang, 'string') ? widget.lang : defaultLanguage) : defaultLanguage;

                WAFData.authenticatedRequest(url, {
                    timeout: 250000,
                    method: 'GET',
                    data: "",
                    type: 'json',
                    headers: {
                        'Accept-Language': lang,
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },

                    onFailure: function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function (json) {
                        callback.onSuccess(json);
                    }
                });
            },

            /*
            * getListOfTypes
            */
            getListOfTypesAndAttributesForCorpusTypes: function (types,familyID, callback) {

                var url = URLHandler.getURL() + "/resources/i3dx/uxproperties/uiservices/getTypesAndAttributes";
                
                var datatoSend = {
                    types: [types],
                    familyID: familyID
                
                };
                var defaultLanguage = 'en';
                var lang = UWA.is(widget) ? (UWA.is(widget.lang, 'string') ? widget.lang : defaultLanguage) : defaultLanguage;

                WAFData.authenticatedRequest(url, {
                    timeout: 250000,
                    method: 'POST',
                    data: JSON.stringify(datatoSend),
                    type: 'json',
                    headers: {
                        'Accept-Language': lang,
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },

                    onFailure: function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function (json) {
                        callback.onSuccess(json);
                    }
                });
            },

            /*
            * getlistofDimensions
            */
            getlistofDimensions: function (callback) {

                var url = URLHandler.getURL() + "/resources/dictionary/dimensions";

                var defaultLanguage = 'en';
                var lang = UWA.is(widget) ? (UWA.is(widget.lang, 'string') ? widget.lang : defaultLanguage) : defaultLanguage;

                WAFData.authenticatedRequest(url, {
                    timeout: 250000,
                    method: 'GET',
                    //data: JSON.stringify(datatoSend),
                    type: 'json',
                    headers: {
                        'Accept-Language': lang,
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },

                    onFailure: function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function (json) {
                        callback.onSuccess(json);
                    }
                });
            },

            /*
            * setParameters
            */
            applyParameters: function (payload, callback) {

                var url = `${URLHandler.getURL()}/resources/v1/UXPropertiesParameterization/setParameters?tenant=${URLHandler.getTenant()}`;

                WAFData.authenticatedRequest(url, {
                    timeout: 250000,
                    method: 'POST',
                    data: JSON.stringify(payload),
                    type: 'json',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },

                    onFailure: function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function (json) {
                        callback.onSuccess(json);
                    }
                });
            },

            /*
            * resetParameters
            */
            resetParameters: function (strParameterID,callback) {

                var url = `${URLHandler.getURL()}/resources/v1/UXPropertiesParameterization/resetParameters?tenant=${URLHandler.getTenant()}`;
                if ((strParameterID != null || strParameterID != undefined))
                    url += "&paramID=" + strParameterID;

                WAFData.authenticatedRequest(url, {
                    timeout: 250000,
                    method: 'GET',
                    type: 'json',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },

                    onFailure: function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function (json) {
                        callback.onSuccess(json);
                    }
                });
            },
        });
        return ParameterizationDisplayPropertiesWebServices;
    }
);



define(
    'DS/ParameterizationSkeleton/Utils/ParameterizationUnitsAndParameters/UnitsAndParametersParameterizationWebServices',
    [
        'UWA/Core',
        'UWA/Class',
        'DS/WAFData/WAFData',
        'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
    ],
    function(UWA, Class, WAFData, URLHandler) {

        'use strict';

        var UnitsAndParametersParameterizationWebServices = Class.singleton({
            getlistofCustomExtensionsAndAttributes : function (types, bAttriuteDetails,callback) {

                var url = URLHandler.getURL() + "/resources/delmia/mfgparam/configuration/getlistofDELMIATypes";
                var datatoSend = {
                    types : types,
                    attributesdetails: bAttriuteDetails
                };

                var defaultLanguage = 'en';
                var lang  = UWA.is(widget) ? (UWA.is(widget.lang, 'string') ? widget.lang : defaultLanguage) : defaultLanguage;

                WAFData.authenticatedRequest(url, {
                    timeout: 100000,
                    method: 'POST',
                    data: JSON.stringify(datatoSend),
                    type: 'json',
                    headers: {
                        'Accept-Language': lang,
                        'Content-Type' : 'application/json',
                        'Accept' : 'application/json'
                    },

                    onFailure : function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function(json) {
                      callback.onSuccess(json);
                    }
                });
            },
            
            getlistofDimensions : function (callback) {

                var url = URLHandler.getURL() + "/resources/dictionary/dimensions";
                
                var defaultLanguage = 'en';
                var lang  = UWA.is(widget) ? (UWA.is(widget.lang, 'string') ? widget.lang : defaultLanguage) : defaultLanguage;

                WAFData.authenticatedRequest(url, {
                    timeout: 100000,
                    method: 'GET',
                    //data: JSON.stringify(datatoSend),
                    type: 'json',
                    headers: {
                        'Accept-Language': lang,
                        'Content-Type' : 'application/json',
                        'Accept' : 'application/json'
                    },

                    onFailure : function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function(json) {
                      callback.onSuccess(json);
                    }
                });
            },
            getlistofArbitraryUnits : function (callback) {

                var url = URLHandler.getURL() + "/resources/uom/configuration/units";
                
                var defaultLanguage = 'en';
                var lang  = UWA.is(widget) ? (UWA.is(widget.lang, 'string') ? widget.lang : defaultLanguage) : defaultLanguage;

                WAFData.authenticatedRequest(url, {
                    timeout: 100000,
                    method: 'GET',
                    //data: JSON.stringify(datatoSend),
                    type: 'json',
                    headers: {
                        'Accept-Language': lang,
                        'Content-Type' : 'application/json',
                        'Accept' : 'application/json'
                    },

                    onFailure : function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function(json) {
                      callback.onSuccess(json);
                    }
                });
            },

            getlistofParameters : function (callback) {

                var url = URLHandler.getURL() + "/resources/uom/configuration/parameters";
                
                var defaultLanguage = 'en';
                var lang  = UWA.is(widget) ? (UWA.is(widget.lang, 'string') ? widget.lang : defaultLanguage) : defaultLanguage;

                WAFData.authenticatedRequest(url, {
                    timeout: 100000,
                    method: 'GET',
                    //data: JSON.stringify(datatoSend),
                    type: 'json',
                    headers: {
                        'Accept-Language': lang,
                        'Content-Type' : 'application/json',
                        'Accept' : 'application/json'
                    },

                    onFailure : function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function(json) {
                      callback.onSuccess(json);
                    }
                });
            }

        });
        return UnitsAndParametersParameterizationWebServices;
    }
);

define('DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/FLWebModal',
		[
			'DS/UIKIT/Modal',
			'UWA/Core',
			'DS/UIKIT/Input/Select',
			'DS/UIKIT/Input/Text',
			'DS/UIKIT/Input/Number',
			'DS/UIKIT/Alert',
			'DS/UIKIT/Tooltip',
			'DS/WAFData/WAFData',
			'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
			'DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/ParameterizationFLWebConstants',
			'i18n!DS/ParameterizationSkeleton/assets/nls/FLWebNLS'
			],
			function (Modal,
					UWACore,
					Select,
					Text,
					Number,
					Alert,
					Tooltip,
					WAFData,
					URLHandler,
					ParameterizationFLWebConstants,
					FLWebNLS) {

	'use strict';

	function _createModal(options) {
		var modal = new Modal({
			className: options.className || '',
			closable: true,
			header: '<h4>' + options.title + '</h4>',
			body: '',
			footer: ''
		});
		return modal;
	}

	function FLWebModal(options) {
		this.options = {
				title: 'Dialog',
				className: '',
				withFooter: true
		};
		this.options = UWACore.extend(this.options, options);

		this.modal = _createModal(this.options);
		this.modal.inject(document.querySelector('#typeMainDiv'));
		if (this.options.withFooter) {
			this._bindFooterEvent();
		}

	}

	FLWebModal.prototype.getPartNumberFormat = function () {

		var _formatContent = this.modal.getContent().getElement('.enox-arch-number-content');
		var that = this;

		if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationFLWebConstants.FORMAT_FREE) {
			var _dynamicFormatContent = this.modal.getContent().getElement('.enox-arch-number-dynamic-content');
			_dynamicFormatContent.empty();
			that.destroyValueFieldComponents();
		} else if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationFLWebConstants.FORMAT_STRING) {
			that.destroyValueFieldComponents();
			that.getValueField(_formatContent);
		} else if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationFLWebConstants.FORMAT_ATTRIBUTE) {
			that.destroyValueFieldComponents();
			that.getDynamicFields(_formatContent, this.partNumberTypeCombobox.getValue()[0]);
		} else if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationFLWebConstants.FORMAT_COUNTER) {
			that.destroyValueFieldComponents();
			that.getDynamicFields(_formatContent, this.partNumberTypeCombobox.getValue()[0]);
		}
	};

	FLWebModal.prototype.getDefaultFields = function (_formatContent) {

		var that = this;

		var divTag = document.createElement('div');
		divTag.className = "formats-arch";

		var labelDiv = document.createElement('div');
		labelDiv.className = "formats-arch-label";
		labelDiv.innerText = FLWebNLS.name; //formats-arch[i];

		var textBoxDiv = document.createElement('div');
		textBoxDiv.className = "formats-arch-tbox";
		var textOptions = {
				events: {
					//  onChange: that.validateEnteredNameValue.bind(that)
				}
		};

		this.nameTextBox = this.getTextBox(textOptions);
		this.nameTextBox.domId = FLWebNLS.name + "_textBox";
		this.nameTextBox.inject(textBoxDiv);

		divTag.appendChild(labelDiv);
		divTag.appendChild(textBoxDiv);

		_formatContent.appendChild(divTag);

		var divTagForNbrBox = document.createElement('div');
		divTagForNbrBox.className = "formats-arch";

		var labelDivForNbrBox = document.createElement('div');
		labelDivForNbrBox.className = "formats-arch-label";
		labelDivForNbrBox.innerText = FLWebNLS.order; //formats-arch[i];

		var textBoxDivForNbrBox = document.createElement('div');
		textBoxDivForNbrBox.className = "formats-arch-tbox";

		var numberOptions = {
				min: 1,
				max: ParameterizationFLWebConstants.MAX_ROWS,

				value: this.getHighestOrder() + 1,
				events: {}
		};

		this.numberOrderBox = this.getNumberBox(numberOptions);
		this.numberOrderBox.domId = FLWebNLS.order + "_textBox";
		this.numberOrderBox.inject(textBoxDivForNbrBox);




		divTagForNbrBox.appendChild(labelDivForNbrBox);
		divTagForNbrBox.appendChild(textBoxDivForNbrBox);

		_formatContent.appendChild(divTagForNbrBox);

		var divTagForType = document.createElement('div');
		divTagForType.className = "formats-arch";

		var typelabelDiv = document.createElement('div');
		typelabelDiv.className = "formats-arch-label";
		typelabelDiv.innerText = FLWebNLS.type;

		var typeComboBoxDiv = document.createElement('div');
		typeComboBoxDiv.className = "formats-arch-tbox";

		var selectOptions = {
				custom: false,
				placeholder: FLWebNLS.selectType,
				options: [{
					label: FLWebNLS.String,
					value: ParameterizationFLWebConstants.FORMAT_STRING
				}, {
					label: FLWebNLS.Free,
					value: ParameterizationFLWebConstants.FORMAT_FREE
				}, {
					label: FLWebNLS.Attribute,
					value: ParameterizationFLWebConstants.FORMAT_ATTRIBUTE
				}, {
					label: FLWebNLS.counterLabel,
					value: ParameterizationFLWebConstants.FORMAT_COUNTER
				}

				],
				events: {
					onChange: that.getPartNumberFormat.bind(that)
				}
		};

		this.partNumberTypeCombobox = this.getSelectComponent(selectOptions);
		this.partNumberTypeCombobox.setId(FLWebNLS.type + "_comboBox");
		this.partNumberTypeCombobox.inject(typeComboBoxDiv);

		divTagForType.appendChild(typelabelDiv);
		divTagForType.appendChild(typeComboBoxDiv);
		_formatContent.appendChild(divTagForType);

	};

	FLWebModal.prototype.getDynamicFields = function (_formatContent, format) {
		var that = this;

		var _dynamicFormatContent = this.modal.getContent().getElement('.enox-arch-number-dynamic-content');
		_dynamicFormatContent.empty();

		if (format == ParameterizationFLWebConstants.FORMAT_ATTRIBUTE) {
			that.getAttributeFormat(_formatContent, _dynamicFormatContent);

		} else if (format == ParameterizationFLWebConstants.FORMAT_COUNTER) {
			this.getCounterFormat(_formatContent, _dynamicFormatContent);
		}

	};
	FLWebModal.prototype.getAttributeFormat = function (_formatContent, _dynamicFormatContent) {

		var formatField = FLWebNLS.attribute;

		var divTag = document.createElement('div');
		divTag.className = "formats-arch";

		var labelDiv = document.createElement('div');
		labelDiv.className = "formats-arch-label";
		labelDiv.innerText = formatField;

		var comboBoxDiv = document.createElement('div');
		comboBoxDiv.className = "formats-arch-tbox";
		var allAttributes = [];

		if (typeof this.attributes.message === "undefined") {
			for (var key in this.attributes) {
				var attributes1 = {};

				attributes1["label"] = this.attributes[key]
				attributes1["value"] = key

				allAttributes.push(attributes1);
			}
		}

		var selectOptions = {
				custom: false,
				placeholder: FLWebNLS.selectAttribute,
				options: allAttributes
		};

		this.partNumberAttributeCombobox = this.getSelectComponent(selectOptions);

		this.partNumberAttributeCombobox.setId(formatField + "_comboBox");
		this.partNumberAttributeCombobox.inject(comboBoxDiv);

		divTag.appendChild(labelDiv);
		divTag.appendChild(comboBoxDiv);

		var formatFieldValue = FLWebNLS.defaultValue;
		var divTagForValue = document.createElement('div');
		divTagForValue.className = "formats-arch";

		var labelDivForValue = document.createElement('div');
		labelDivForValue.className = "formats-arch-label";
		labelDivForValue.innerText = formatFieldValue;

		var textBoxDivForValue = document.createElement('div');
		textBoxDivForValue.className = "formats-arch-tbox";
		this.valueDynTextBox = this.getTextBox();
		this.valueDynTextBox.domId = formatFieldValue + "_textBox";
		this.valueDynTextBox.inject(textBoxDivForValue);

		divTagForValue.appendChild(labelDivForValue);
		divTagForValue.appendChild(textBoxDivForValue);

		_dynamicFormatContent.appendChild(divTag);
		_dynamicFormatContent.appendChild(divTagForValue);
		_formatContent.appendChild(_dynamicFormatContent);

	};

	FLWebModal.prototype.getCounterFormat = function (_formatContent, _dynamicFormatContent) {
		var that = this;
		var divTagForNbrBox = document.createElement('div');
		divTagForNbrBox.className = "formats-arch";

		var labelDivForNbrBox = document.createElement('div');
		labelDivForNbrBox.className = "formats-arch-label";

		var divForLabel = document.createElement('div');
		divForLabel.className = 'label-counter-arch';

		var labelText = document.createElement('div');
		labelText.className = 'label-text-arch';
		labelText.innerText = FLWebNLS.digits;

		var informationDiv = document.createElement('div');
		informationDiv.className = "fonticon fonticon-attention";
		informationDiv.id = "information";
		informationDiv.style.color = "black";

		divForLabel.appendChild(labelText);
		divForLabel.appendChild(informationDiv);

		labelDivForNbrBox.appendChild(divForLabel);

		var textBoxDivForNbrBox = document.createElement('div');
		textBoxDivForNbrBox.className = "formats-arch-tbox";

		var numberOptions = {
				min: 1,
				max: ParameterizationFLWebConstants.MAX_ROWS /*Number.MAX_SAFE_INTEGER*/,
				step: 1,
				value: 6,
				events: {
					onChange: that.updateSampleText.bind(that)
				}
		};

		this.counterNumberBox = this.getNumberBox(numberOptions);
		this.counterNumberBox.domId = FLWebNLS.digits + "_textBox";
		this.counterNumberBox.inject(textBoxDivForNbrBox);

		divTagForNbrBox.appendChild(labelDivForNbrBox);
		divTagForNbrBox.appendChild(textBoxDivForNbrBox);

		_dynamicFormatContent.appendChild(divTagForNbrBox);

		var formatField = FLWebNLS.sample;

		var divTag = document.createElement('div');
		divTag.className = "formats-arch-sample";

		var labelDiv = document.createElement('div');
		labelDiv.className = "formats-arch-sample-label";
		//labelDiv.innerText = formatField;


		var sampleTextLabelSpan = document.createElement('span');
		sampleTextLabelSpan.id = "sampleTextLabel";
		sampleTextLabelSpan.innerText = formatField  +" : "  ;

		var sampleTextValueSpan = document.createElement('span');
		sampleTextValueSpan.id = "sampleValue-arch";

		var textBoxDiv = document.createElement('div');
		textBoxDiv.className = "formats-arch-sample-value";

		textBoxDiv.appendChild(sampleTextLabelSpan);
		textBoxDiv.appendChild(sampleTextValueSpan);
		//textBoxDiv.id = "sampleValue-arch";

		divTag.appendChild(labelDiv);
		divTag.appendChild(textBoxDiv);

		_dynamicFormatContent.appendChild(divTag);
		_formatContent.appendChild(_dynamicFormatContent);

		this.updateSampleText(); // sets the number of digits value

		this.modal.getContent().getElement('#information').addEvent('mouseover', function () {
			that.getInformation(that.modal.getContent().getElement("#information"), FLWebNLS.counterTooltip);
		});

		// this.modal.getContent().getElement('#sampleValue-arch').addEvent('mouseover', function () {
		//   that.getInformation(that.modal.getContent().getElement("#sampleValue-arch"), event.currentTarget.getText());
		//
		// })


		// this.modal.getContent().getElement('#sampleValue-arch').addEventListener('mouseout', function () {
		// 	//that.getInformation(that.modal.getContent().getElement("#sampleValue-arch"), event.currentTarget.getText());
		// 	console.log(that);
		// 	that.tooltip.elements.body.empty()
		//
		// })


	};

	FLWebModal.prototype.getInformation = function (targetElement, toDisplayOver) {

		var tooltipOtions = {
				target: targetElement,
				body: toDisplayOver
		};
		this.getTooltip(tooltipOtions);

	};

	FLWebModal.prototype.getValueField = function (_formatContent) {

		var _dynamicFormatContent = this.modal.getContent().getElement('.enox-arch-number-dynamic-content');

		_dynamicFormatContent.empty();

		var formatField = FLWebNLS.value;

		var divTag = document.createElement('div');
		divTag.className = "formats-arch";

		var labelDiv = document.createElement('div');
		labelDiv.className = "formats-arch-label";
		labelDiv.innerText = formatField;

		var textBoxDiv = document.createElement('div');
		textBoxDiv.className = "formats-arch-tbox";
		this.valueTextBox = this.getTextBox();
		this.valueTextBox.domId = formatField + "_textBox";
		this.valueTextBox.inject(textBoxDiv);

		divTag.appendChild(labelDiv);
		divTag.appendChild(textBoxDiv);

		_dynamicFormatContent.appendChild(divTag);
		_formatContent.appendChild(_dynamicFormatContent);

	};

	FLWebModal.prototype.getModalBody = function () {

		var partNumberContent = this.modal.elements.body;

		var _errorsMessageDiv = UWACore.createElement('div');
		_errorsMessageDiv.className = "enox-part-number-error-content";

		var _formatContent = UWACore.createElement('div');
		_formatContent.className = "enox-arch-number-content";

		var _dynamicFormatContent = UWACore.createElement('div');
		_dynamicFormatContent.className = "enox-arch-number-dynamic-content";

		this.getDefaultFields(_formatContent);

		partNumberContent.appendChild(_errorsMessageDiv);
		partNumberContent.appendChild(_formatContent);
		partNumberContent.appendChild(_dynamicFormatContent);
		return partNumberContent;
	};

	FLWebModal.prototype.createCollabUnicitySecAddFieldModalBody = function () {

		var modalBody = this.modal.elements.body;

		var _errorsMessageDiv = UWACore.createElement('div');
		_errorsMessageDiv.className = "enox-part-number-error-content";

		var _formatContent = UWACore.createElement('div');
		_formatContent.className = "enox-arch-number-content";

		// var _dynamicFormatContent = UWACore.createElement('div');
		// _dynamicFormatContent.className = "enox-arch-number-dynamic-content";

		//this.getDefaultFields(_formatContent);
		this.addDefaultFieldsToCollabUnicitySecModalBody(_formatContent);
		modalBody.appendChild(_errorsMessageDiv);
		modalBody.appendChild(_formatContent);
		//	modalBody.appendChild(_dynamicFormatContent);
		//return partNumberContent;
	};

	FLWebModal.prototype.addDefaultFieldsToCollabUnicitySecModalBody = function (_formatContent) {

		var that = this;
		var groupNameField = document.createElement('div');
		groupNameField.className = "formats-arch";

		var labelDiv = document.createElement('div');
		labelDiv.className = "formats-arch-label";
		labelDiv.innerText = FLWebNLS.label_groupName;

		var textBoxDiv = document.createElement('div');
		textBoxDiv.className = "formats-arch-tbox";
		var textOptions = {
				events: {
					//  onChange: that.validateEnteredNameValue.bind(that)
				}
		};
		this.nameTextBoxForCollabUnicity = this.getTextBox(textOptions);
		this.nameTextBoxForCollabUnicity.domId = FLWebNLS.name + "_textBox";
		this.nameTextBoxForCollabUnicity.inject(textBoxDiv);

		groupNameField.appendChild(labelDiv);
		groupNameField.appendChild(textBoxDiv);
		_formatContent.appendChild(groupNameField);

		var collabSpaceField = document.createElement('div');
		collabSpaceField.className = 'formats-arch';

		var collabSpacelabel = document.createElement('div');
		collabSpacelabel.className = 'formats-arch-label';
		collabSpacelabel.innerText = FLWebNLS.label_CSfield;

		var collabSpaceTextBoxContainer = document.createElement('div');
		collabSpaceTextBoxContainer.className = 'formats-arch-tbox';
		var csList =  JSON.parse(localStorage.getItem('csList'));
		var collabSpaceSelectOptions = {
				//placeholder: 'Select your option',
				multiple: true,
				options: csList,
				events: {
					//  onChange: that.validateEnteredNameValue.bind(that)
				}
		};
		this.collabListTextBox = this.getSelectComponent(collabSpaceSelectOptions);
		this.collabListTextBox.domId = FLWebNLS.name + "_textBox";
		this.collabListTextBox.inject(collabSpaceTextBoxContainer);

		collabSpaceField.appendChild(collabSpacelabel);
		collabSpaceField.appendChild(collabSpaceTextBoxContainer);

		_formatContent.appendChild(collabSpaceField);

	};

	FLWebModal.prototype.validateEnteredNameValue = function (operation, editingField) {
		var duplicateData = {};
		duplicateData.isValid = true;
		var userEnteredFormat = this.nameTextBox.getValue();
		var isSuccess = this.validateEnteredValues(userEnteredFormat, FLWebNLS.name, operation, editingField);
		if (!isSuccess) {
			duplicateData.isValid = false;
		}
		duplicateData.data = userEnteredFormat;
		return duplicateData;
	};

	FLWebModal.prototype.validateEnteredGroupNameValue = function (operation, editingField) {
		var duplicateData = {};
		duplicateData.isValid = true;
		var userEnteredName = this.nameTextBoxForCollabUnicity.getValue();
		var isSuccess = this.validateEnteredValuesForArchNumCollab(userEnteredName, FLWebNLS.name, operation, editingField);
		if (!isSuccess) {
			duplicateData.isValid = false;
		}
		duplicateData.data = userEnteredName;
		return duplicateData;
	};

	FLWebModal.prototype.validateEnteredOrderValue = function (operation, editingField) {

		var duplicateData = {};
		duplicateData.isValid = true;

		var userEnteredFormat = this.numberOrderBox.getValue();
		var isSuccess = this.validateEnteredValues(userEnteredFormat, FLWebNLS.order, operation, editingField);

		if (!isSuccess) {

			duplicateData.isValid = false;
		}

		duplicateData.data = userEnteredFormat;
		return duplicateData;
	};

	FLWebModal.prototype.validateEnteredValues = function (userEnteredFormat, field, operation, editingField) {
		var rowsOfMappedFields = document.querySelectorAll(".partNumberFieldMapping");
		var successFields = document.querySelector('.success');


		var isSuccess = true;

		if (operation == "edit") {
			for (var k = 0; k < rowsOfMappedFields.length; k++) {
				if (rowsOfMappedFields[k] != editingField) {
					for (var j = 0; j < 2; j++) {
						if (successFields.getChildren()[j].getText() == field && userEnteredFormat == rowsOfMappedFields[k].getChildren()[j].getText()) {
							isSuccess = false;
							break;
						}
					}
				}
			}
		} else {
			for (var k1 = 0; k1 < rowsOfMappedFields.length; k1++) {

				for (var j1 = 0; j1 < 2; j1++) {
					if (successFields.getChildren()[j1].getText() == field && userEnteredFormat == rowsOfMappedFields[k1].getChildren()[j1].getText()) {
						isSuccess = false;
						break;
					}
				}
			}
		}
		return isSuccess;
	};

	FLWebModal.prototype.validateEnteredValuesForArchNumCollab = function (userEnteredFormat, field, operation, editingField) {
		var rowsOfMappedFields = document.querySelectorAll("#archNumCollabTableRow");
		var successFields = document.querySelector('#headerRowArchNumCollab');
		var isSuccess = true;
		if (operation == "edit") {
			for (var k = 0; k < rowsOfMappedFields.length; k++) {
				if (rowsOfMappedFields[k] != editingField) {
					for (var j = 0; j < 2; j++) {
						if (successFields.getChildren()[j].getText() == field && userEnteredFormat == rowsOfMappedFields[k].getChildren()[j].getText()) {
							isSuccess = false;
							break;
						}
					}
				}
			}
		} else {
			for (var k1 = 0; k1 < rowsOfMappedFields.length; k1++) {
				for (var j1 = 0; j1 < 2; j1++) {
					if (successFields.getChildren()[j1].getText() == field && userEnteredFormat == rowsOfMappedFields[k1].getChildren()[j1].getText()) {
						isSuccess = false;
						break;
					}
				}
			}
		}
		return isSuccess;
	};

	FLWebModal.prototype.validateEnteredGroupNameValueNotNull = function () {
		var userEnteredFormat = this.nameTextBoxForCollabUnicity.getValue();
		var isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
		return isNull;
	};

	FLWebModal.prototype.validateEnteredCollabListValueNotNull = function () {
		var userEnteredFormat = this.collabListTextBox.getValue()[0];
		var isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
		return isNull;
	};

	FLWebModal.prototype.validateEnteredNameValueNotNull = function () {
		var userEnteredFormat = this.nameTextBox.getValue();
		var isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
		return isNull;
	};

	FLWebModal.prototype.validateEnteredOrderValueNotNull = function () {
		var userEnteredFormat = this.numberOrderBox.getValue();
		var isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
		return isNull;
	};

	FLWebModal.prototype.validateEnteredValueFieldValueNotNull = function () {
		var isNull = false;
		if (this.getUserEnteredValues().Type != ParameterizationFLWebConstants.FORMAT_ATTRIBUTE) {
			isNull = this.valueTextBox ? this.validateEnteredValuesNotNull(this.valueTextBox.getValue()) : this.valueDynTextBox ? this.validateEnteredValuesNotNull(this.valueDynTextBox.getValue()) : false;
		}
		return isNull;
	};

	FLWebModal.prototype.validatSelectedTypeFieldValueNotNull = function () {
		var userEnteredFormat = this.partNumberTypeCombobox.getValue()[0];
		var isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
		return isNull;
	};

	FLWebModal.prototype.validateSelectedAttributeFieldValueNotNull = function () {
		var userEnteredFormat = this.partNumberAttributeCombobox ? this.partNumberAttributeCombobox.getValue()[0] : '';
		var isNull = false;
		if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationFLWebConstants.FORMAT_ATTRIBUTE) {
			isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
		}

		return isNull;
	};

	FLWebModal.prototype.validateEnteredCounterFieldValueNotNull = function () {
		var userEnteredFormat = this.counterNumberBox ? this.counterNumberBox.getValue() : '';
		var isNull = false;
		if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationFLWebConstants.FORMAT_COUNTER) {
			isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
		}

		return isNull;
	};


	FLWebModal.prototype.validateEnteredValuesNotNull = function (userEnteredFormat) {

		var isNull = false;
		if (userEnteredFormat == '' || userEnteredFormat == "") {
			isNull = true;
		}
		return isNull;
	};

	FLWebModal.prototype.displayAlertMessage = function (messageToDisplay, toDisplayOver) {
		var alertOptions = {
				visible: true,
				className: 'param-alert',
				messageClassName: 'error',
				closable: true,
				renderTo: toDisplayOver,
				autoHide: true,
				hideDelay: 2000
		};
		var alert = this.getAlertComponent(alertOptions);

		alert.add({
			message: messageToDisplay
		});

	};

	FLWebModal.prototype.getUserEnteredValues = function () {

		var userEnteredFormatValues = {};

		var valueField = this.valueTextBox ? this.valueTextBox.getValue() : this.valueDynTextBox ? this.valueDynTextBox.getValue() : this.modal.getContent().getElement('#sampleValue-arch') ? this.modal.getContent().getElement('#sampleValue-arch').innerText : '';
		var attributeFieldLabel = this.partNumberAttributeCombobox ? this.partNumberAttributeCombobox.getOption(this.partNumberAttributeCombobox.getValue()[0]).getText() : '';
		var attributeFieldValue = this.partNumberAttributeCombobox ? this.partNumberAttributeCombobox.getValue()[0] : '';
		var numberOfDigits = this.counterNumberBox ? this.counterNumberBox.getValue() : '';

		userEnteredFormatValues[ParameterizationFLWebConstants.NAME] = this.nameTextBox.getValue();
		userEnteredFormatValues[ParameterizationFLWebConstants.ORDER] = this.numberOrderBox.getValue();
		userEnteredFormatValues[ParameterizationFLWebConstants.TYPE] = this.partNumberTypeCombobox.getValue()[0];
		userEnteredFormatValues[ParameterizationFLWebConstants.ATTRIBUTE] = attributeFieldValue;
		userEnteredFormatValues[ParameterizationFLWebConstants.ATTRIBUTE_NLS_NAME] = attributeFieldLabel;
		userEnteredFormatValues[ParameterizationFLWebConstants.COUNTER] = numberOfDigits;
		userEnteredFormatValues[ParameterizationFLWebConstants.VALUE] = valueField;

		return userEnteredFormatValues;
	};

	FLWebModal.prototype.getUserEnteredValuesForArchNumCollabUnicity = function () {
		var userEnteredFormatValues = {};
		var fieldValue = '';
		var csSelectList = this.collabListTextBox.getValue();
		if(Array.isArray(csSelectList)) {
			for(var i = 0; i < csSelectList.length-1; i++) {
				fieldValue += csSelectList[i] + ',';
			};
			fieldValue += csSelectList[i];
		} else {
			fieldValue = csSelectList;
		}
		userEnteredFormatValues[ParameterizationFLWebConstants.NAME] = this.nameTextBoxForCollabUnicity.getValue();
		userEnteredFormatValues[ParameterizationFLWebConstants.VALUE] = fieldValue;
		return userEnteredFormatValues;
	};

	FLWebModal.prototype.updateSampleText = function () {

		var sampleTextDiv = this.modal.getContent().getElement('#sampleValue-arch');
		var updatedCount = this.counterNumberBox ? this.counterNumberBox.getValue() : '';
		var noOFDigits = "";
		for (var i = 0; i < parseInt(updatedCount); i++) {
			noOFDigits = '0' + noOFDigits;
		}
		if (sampleTextDiv != null) {
			sampleTextDiv.innerText = noOFDigits;
		}

	};

	FLWebModal.prototype.getTotalFormatRows = function () {
		return document.querySelectorAll(".partNumberFieldMapping").length;
	};

	FLWebModal.prototype.getHighestOrder = function () {
		var rowsOfMappedFields = document.querySelectorAll(".partNumberFieldMapping");
		var toCheckTheExistingRows = rowsOfMappedFields.length;
		var highestOrder = 0;
		if (toCheckTheExistingRows > 0) {
			for (var k = 0; k < rowsOfMappedFields.length; k++) {
				if (parseInt(rowsOfMappedFields[k].getChildren()[1].getText()) > highestOrder) {
					highestOrder = parseInt(rowsOfMappedFields[k].getChildren()[1].getText());
				}
			}
		}

		return highestOrder;

	};
	FLWebModal.prototype.isCounterExists = function (field) {
		var rowsOfMappedFields = document.querySelectorAll(".partNumberFieldMapping");
		var toCheckTheExistingRows = rowsOfMappedFields.length;
		var isSuccess = false;
		if (toCheckTheExistingRows > 0) {
			for (var k = 0; k < rowsOfMappedFields.length; k++) {
				if (rowsOfMappedFields[k].getChildren()[2].value == ParameterizationFLWebConstants.FORMAT_COUNTER) {
					isSuccess = true;
					break;
				}
			}
		}

		return isSuccess;
	};

	FLWebModal.prototype.destroyValueFieldComponents = function () {

		this.valueTextBox = undefined;
		this.valueDynTextBox = undefined;
		this.counterNumberBox = undefined;

	};

	FLWebModal.prototype.getAttributes = function (data) {
		var that = this;
		that.storeAttributes(data);
	};

	FLWebModal.prototype.storeAttributes = function (data) {

		this.attributes = data;

	};


	FLWebModal.prototype.getTextBox = function (textBoxOptions) {

		this.textBox = new Text(textBoxOptions);
		return this.textBox;
	};
	FLWebModal.prototype.getNumberBox = function (numberOptions) {

		this.numberBox = new Number(numberOptions);
		return this.numberBox;
	};

	FLWebModal.prototype.getSelectComponent = function (selectOptions) {
		this.select = new Select(selectOptions);
		return this.select;
	};

	FLWebModal.prototype.getAlertComponent = function (alertOptions) {

		this.alert = new Alert(alertOptions);
		return this.alert;
	};

	FLWebModal.prototype.getTooltip = function (tooltipOtions) {
		this.tooltip = new Tooltip(tooltipOtions);
		return this.tooltip;
	};

	FLWebModal.prototype.show = function () {
		this.modal.show();
	};


	FLWebModal.prototype._bindFooterEvent = function () {
		var that = this;

		this.modal.getFooter().getElements('.btn').forEach(function (element) {
			if (element.name === 'cancelButton') {
				element.addEvent('click', function () {
					that.modal.hide();
				});
			}
		});

	};

	FLWebModal.prototype.getContent = function () {
		return this.modal.getContent();
	};

	FLWebModal.prototype.destroy = function () {
		this.modal.destroy();
		var keys = Object.keys(this);
		for (var i = 0; i < keys.length; i++) {
			this[keys[i]] = undefined;
		}
	};

	return FLWebModal;
});

define("DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/Attribute", ["require", "exports", "UWA/Class/Model", "DS/ParameterizationSkeleton/Utils/ParameterizationPartSupply/Utils"], function (require, exports, Model, Utils) {
    "use strict";
    var AttributeModule;
    (function (AttributeModule) {
        AttributeModule.TYPE = {
            STRING: 'String',
            BOOLEAN: 'Boolean',
            INTEGER: 'Integer',
            DOUBLE: 'Double',
            DATE: 'Date'
        };
        AttributeModule.SUPPORTED_TYPES = [AttributeModule.TYPE.STRING, AttributeModule.TYPE.INTEGER, AttributeModule.TYPE.DOUBLE, AttributeModule.TYPE.BOOLEAN];
        AttributeModule.Attribute = Model.extend({
            getId: function () {
                return this.get('Name');
            },
            getLabel: function () {
                let label = this.getId();
                if (this.get('NameNLS')) {
                    if (this.get('NameNLS')[Utils.Utils.getLang()]) {
                        label = this.get('NameNLS')[Utils.Utils.getLang()];
                    }
                    else if (this.get('NameNLS')['en']) {
                        label = this.get('NameNLS')['en'];
                    }
                }
                // if label == id => no translation => remove the id at the end in order to be readable
                if (label === this.getId()) {
                    if (label.indexOf('__') !== -1) {
                        label = label.substring(0, label.indexOf('__'));
                    }
                }
                return label;
            },
            getType: function () {
                return this.get('Type');
            },
            getOwner: function () {
                return this.get('Owner');
            },
            parse: function (data, options) {
                // add "Custom" attribute to set if it is a Custom Attribute or an OOTB Attribute
                data.Custom = options.custom;
                return this._parent(data, options);
            },
            isCustom() {
                return this.get('Custom');
            },
            isMultiValuated() {
                return this.get('MultiValuated') === 'Yes';
            },
            isMultiLine() {
                return this.get('MultiLine') === 'Yes';
            },
            hasDimension() {
                return !!this.get('Dimension');
            },
            isSupported(customOnly) {
                return (customOnly ? this.isCustom() : true) && AttributeModule.SUPPORTED_TYPES.indexOf(this.getType()) > -1 && !this.hasDimension() && !this.isMultiLine() && !this.isMultiValuated();
            },
            hasAuthorizedValues() {
                const authorizedValues = this.getAuthorizedValues();
                return authorizedValues && authorizedValues.length > 0;
            },
            getAuthorizedValues() {
                return this.get('AuthorizedValues');
            },
            getAuthorizedValueLabel(value) {
                let label = value;
                if (this.get('AuthorizedValuesNLS') && this.get('AuthorizedValuesNLS')[value]) {
                    if (this.get('AuthorizedValuesNLS')[value][Utils.Utils.getLang()]) {
                        label = this.get('AuthorizedValuesNLS')[value][Utils.Utils.getLang()];
                    }
                    else if (this.get('AuthorizedValuesNLS')[value]['en']) {
                        label = this.get('AuthorizedValuesNLS')[value]['en'];
                    }
                    return label;
                }
            }
        });
    })(AttributeModule || (AttributeModule = {}));
    ;
    return AttributeModule;
});

//@fullReview  ZUR 15/03/11 2016x HL 
//@fullReview  ZUR 16/02/13 2017x
//@fullReview  ZUR 17/07/06 2018x IR-529086-3DEXPERIENCER2018x
/*global define, document*/
/*jslint plusplus: true*/

define('DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/LifecycleViewUtilities',
    [
        'UWA/Core',
        'DS/UIKIT/Input/Button',
        'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
        'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS'
    ],
    function(UWA,
            Button,
            ParametersLayoutViewUtilities,
            ParamSkeletonNLS) {

        'use strict';
        //'UWA/Controls/Abstract',
        var lcview = {

            buildLifecycleChecksView : function(wdthArray, appCategory) {
                //UWA.log("buildLifecycleChecksView");
                var k, iTitleRowSum, AlreadySetRlsDiv, rulesTbl, tbody, newRow, newCell,
                    expandButton, reduceButton, numOfColumn = 6;

                AlreadySetRlsDiv =  UWA.createElement('div', {
                    'id': 'AlreadySetRules'
                });
                /*AlreadySetRlsDiv.style.overflowY = 'auto';
                AlreadySetRlsDiv.style.overflowX = 'auto';      
                AlreadySetRlsDiv.style.minHeight = '20%';*/
                //document.getElementsByTagName('body')[0].appendChild(AlreadySetRlsDiv);
                //
                rulesTbl =  UWA.createElement('table', {
                    'id': 'rulestable',
                    'class': 'table table-condensed table-hover'
                });
                /*      
                rulesTbl.style.width="100%";
                rulesTbl.style.height="20%";        
                rulesTbl.cellPadding="0"; rulesTbl.cellSpacing="2";
                rulesTbl.style.backgroundColor="white";*/
                tbody =  UWA.createElement('tbody', {
                    'class': 'paramtbody'
                }).inject(rulesTbl);

                newRow = UWA.createElement('tr').inject(tbody);//row1
                 //FUN087047
                if(appCategory === "CBP" ) {
                    numOfColumn = 7;                    
                }
                for (k = 0; k < numOfColumn; k++) {
                    iTitleRowSum = iTitleRowSum + wdthArray[k];
                }
                //{title: ParamSkeletonNLS.CurrentControlsTitle}
                //newRow.style.backgroundColor = "#659ac2";

                newCell = UWA.createElement('td',
                        {'width': iTitleRowSum.toString() + '%', 'colspan': numOfColumn.toString(), 'title': ParamSkeletonNLS.CurrentControlsTitle}).inject(newRow);//60%
                //
                UWA.createElement('h5', {
                    text: ParamSkeletonNLS.CurrentControlsTitle// font-3dsbold
                    //'class': 'font-3dslight'
                }).inject(newCell);

                newCell = UWA.createElement('td',
                    {'width': wdthArray[6].toString() + '%', 'align' : 'right'}).inject(newRow);//20%

                newCell.setStyle("padding-right", "15px");

                expandButton = new Button({
                    className: 'close',
                    icon: 'fonticon fonticon-resize-full',//value: 'Button', //fonticon-cancel  fonticon-minus-circled  
                    attributes: {
                        disabled: false,
                        title : ParamSkeletonNLS.Expand,//"expand",
                        'aria-hidden' : 'true'
                    }
                }).inject(newCell);

                reduceButton = new Button({
                    className: 'close',
                    icon: 'fonticon fonticon-resize-small',
                    attributes: {
                        disabled: false,
                        title : ParamSkeletonNLS.Reduce, //"reduce",
                        'aria-hidden' : 'true'
                    },
                    events: {
                        onClick: function () {
                            UWA.log(AlreadySetRlsDiv);//.log(AlreadySetRlsDiv.getStyle("height"));
                            AlreadySetRlsDiv.setStyle("height", "30%");
                            this.hide();
                            expandButton.show();
                        }
                    }
                }).inject(newCell);
                reduceButton.hide();

                expandButton.addEvent("onClick", function () {
                    AlreadySetRlsDiv.setStyle("height", "50%");
                    this.hide();
                    reduceButton.show();
                });

                newRow = UWA.createElement('tr', {title: ''}).inject(tbody);//row2                    
                //newRow.style.backgroundColor = "#CDD8EB";
                k = 0;
                newCell = UWA.createElement('td',
                    {'width': wdthArray[k++].toString() + '%', 'title': ParamSkeletonNLS.DataTypeLabel}).inject(newRow);

                UWA.createElement('h5', {
                    //'class': 'font-3dslight',//'',font-3dsregular
                    text: ParamSkeletonNLS.DataTypeLabel
                }).inject(newCell);

                newCell = UWA.createElement('td', {
                    'width': wdthArray[k++].toString() + '%',//10
                    'title': ParamSkeletonNLS.FromStatusLabel
                }).inject(newRow);

                UWA.createElement('h5', {
                    //'class': 'font-3dslight',
                    text: ParamSkeletonNLS.FromStatusLabel
                }).inject(newCell);

                newCell = UWA.createElement('td',
                        {'width': wdthArray[k++].toString() + '%', 'title': ParamSkeletonNLS.ToStatusLabel}).inject(newRow);//10

                UWA.createElement('h5', {
                    //'class': 'font-3dslight',
                    text: ParamSkeletonNLS.ToStatusLabel
                }).inject(newCell);

                newCell = UWA.createElement('td',
                        {'width': wdthArray[k++].toString() + '%', 'title': ParamSkeletonNLS.Rulelabel}).inject(newRow);//15

                UWA.createElement('h5', {
                    //'class': 'font-3dslight',
                    text: ParamSkeletonNLS.Rulelabel
                }).inject(newCell);

                //FUN087047
                if (appCategory === "CBP") {
                    newCell = UWA.createElement('td',
                        {'width': wdthArray[k++].toString() + '%', 'title': ParamSkeletonNLS.Action}).inject(newRow);//15

                    UWA.createElement('h5', {
                        //'class': 'font-3dslight',
                        text: ParamSkeletonNLS.Action
                    }).inject(newCell);
                }

                newCell = UWA.createElement('td', {
                    'width': '15%',
                    'title': ParamSkeletonNLS.AdditionalInfoTitle
                }).inject(newRow);

                UWA.createElement('h5', {
                    //'class': 'font-3dslight',
                    text: ParamSkeletonNLS.AdditionalInfoTitle
                }).inject(newCell);

                newCell = UWA.createElement('td', {
                    'width': wdthArray[k++].toString() + '%',//15
                    'title': ParamSkeletonNLS.RemoveElement //NZV:IR-629593-3DEXPERIENCER2019x
                }).inject(newRow);

                UWA.createElement('h5', {
                    //'class': 'font-3dslight',
                    text: ParamSkeletonNLS.RemoveElement
                }).inject(newCell);

                newCell = UWA.createElement('td', {
                    'width' : wdthArray[k++].toString() + '%',//7
                    'title' : ParamSkeletonNLS.DeployStatus
                }).inject(newRow);//dernière colonne : pas de titre        

                AlreadySetRlsDiv.appendChild(rulesTbl);

                return AlreadySetRlsDiv;
            },

            addDeployIndicator : function (deployStatus) {
                UWA.log("addApplyIndicator");
                var deployIndicDiv, deployTable, dtbody, newRow, imageCell, imgSpan,
                    imgTitle = ParamSkeletonNLS.deployedParamtxt,
                    imgClass = 'fonticon fonticon-2x fonticon-check',
                    iconColor = 'green';

                deployIndicDiv =  UWA.createElement('div', {
                    'id': 'IndicatorDiv'
                });

                deployTable =  UWA.createElement('table', {
                    'id': 'rulestable',
                    'class': 'table table-condensed table-hover'
                }).inject(deployIndicDiv);

                dtbody =  UWA.createElement('tbody', {
                    'class': 'indicatortbody'
                }).inject(deployTable);

                newRow = UWA.createElement('tr').inject(dtbody);//row1
                //newRow.style.backgroundColor = "#659ac2";
                imageCell = UWA.createElement('td',
                        {'width': '100%', 'title': ParamSkeletonNLS.deployedParamtxt}).inject(newRow);

                if (deployStatus === false) {
                    iconColor = "orange";
                    imgClass = 'fonticon fonticon-2x fonticon-cog';
                    imgTitle =  ParamSkeletonNLS.notdeployedParamtxt;//"Some Parameters are not Deployed"
                }

                imgSpan = UWA.createElement('span', {
                    'class' : imgClass
                }).inject(imageCell);

                imgSpan.setStyle("color", iconColor);
                imageCell.set("Title", imgTitle);

                return deployIndicDiv;
            },

            updateIcon : function(result, imageCell) {
                var imgSpan,
                    imgTitle = ParamSkeletonNLS.deployedParamtxt,
                    imgClass = 'fonticon fonticon-2x fonticon-check',
                    iconColor = 'green';

                imageCell.empty();

                if (result !== true) {
                    imgClass = 'fonticon fonticon-2x fonticon-alert';
                    imgTitle = ParamSkeletonNLS.notdeployedParamtxt;
                    iconColor = 'red';
                }
                imgSpan = UWA.createElement('span', {
                    'class' : imgClass
                }).inject(imageCell);
                imgSpan.setStyle("color", iconColor);
                imageCell.set("Title", imgTitle);
            },

            beingModified : function (imageCell, imgTitle) {
                var imgClass = 'fonticon fonticon-2x fonticon-pencil';

                imageCell.empty();
                UWA.createElement('span', {
                    'class' : imgClass
                }).inject(imageCell);

                imageCell.set("Title", imgTitle);
            },

            getNamingDeployCellSts : function (tbodyreflist) {
                var iLines = tbodyreflist[0].children;
                return (iLines[0].cells[0]);
            },

            getCurrentChecks : function(iContentDiv, appCategory) {
                var tbodyref = iContentDiv.getElements('.paramtbody')[0],
                    listofLines = tbodyref.children,
                    nbofLines = listofLines.length,
                    clistofChecks = [],
                    iadditionalinfo = "",
                    i,
                    iRule,
                    iID, promoteVal=false;

                this.clearPreviousChecksHighlighting(listofLines);

                for (i = 2; i < nbofLines; i++) {
                    iRule = listofLines[i].cells[3].value;

                    /* if ( (document.getElementById('rulestable').rows[i].cells[4].childNodes[0])==null)
                        iadditionalinfo="";
                    else
                        iadditionalinfo = document.getElementById('rulestable').rows[i].cells[4].childNodes[0].value;
    
                    if (iRule=="RejectIfAttributeNotValuated") {
                        var iID=iadditionalinfo.indexOf(":");
                        iadditionalinfo=iadditionalinfo.substring(iID+1,iadditionalinfo.length);
                    }
                
                    if ((iRule=="RejectIfAnyOfTheCommonlyGovernedChildNotOnTargetState")
                            &&(iadditionalinfo!="ALL")) {
                            iadditionalinfo = document.getElementById('rulestable').rows[i].cells[4].value; 
                    }*/
                    //FUN087047 
                    if(appCategory === "CBP") {
                        
                        if (listofLines[i].cells[5].value === null) {
                            iadditionalinfo = "";
                        } else {
                            iadditionalinfo = listofLines[i].cells[5].value;
                        }
                        promoteVal = listofLines[i].cells[4].value;
                    } else {
                        if (listofLines[i].cells[4].value === null) {
                            iadditionalinfo = "";
                        } else {
                            iadditionalinfo = listofLines[i].cells[4].value;
                        }
                        promoteVal = true;
                    }
                    // if (listofLines[i].cells[4].value === null) {
                    //     iadditionalinfo = "";
                    // } else {
                    //     iadditionalinfo = listofLines[i].cells[4].value;
                    // }
                    //
                    if (iRule === "RejectIfAttributeNotValuated") {
                        iID = iadditionalinfo.indexOf(":");
                        iadditionalinfo = iadditionalinfo.substring(iID + 1, iadditionalinfo.length);
                    }
                    //
                    if ((iRule === "RejectIfAnyOfTheCommonlyGovernedChildNotOnTargetState")
                                && (iadditionalinfo !== "ALL")) {
                        if(appCategory === "CBP") {
                            iadditionalinfo = listofLines[i].cells[5].value;
                        } else {
                            iadditionalinfo = listofLines[i].cells[4].value;
                        }
                    }
                    
                    clistofChecks.push({
                        objType         : listofLines[i].cells[0].value,
                        fromState       : listofLines[i].cells[1].value,
                        toState         : listofLines[i].cells[2].value,
                        ruleID          : iRule,
                        additionalProps : iadditionalinfo,
                        promote         : promoteVal
                    });
                }
                return clistofChecks;
            },

            printTransitionList : function (iList) {
                var e, nbofTransitions = 0;

                for (e = iList.first; e; e = e.next) {
                    UWA.log(e);
                    UWA.log("from : " + e.cl1.c.node.stateid + " to : " + e.cl2.c.node.stateid);
                    nbofTransitions++;
                }
                UWA.log("nbofTransitions = " + nbofTransitions);
            },

            printNodesList : function (iList) {
                var e, nbofstates = 0;

                for (e = iList.first; e; e = e.next) {
                    UWA.log(e);
                    UWA.log(e.stateid + "<-->" + e.name);
                    nbofstates++;
                }
                UWA.log("nbofstates =" + nbofstates);
            },

            sortArrayByKey: function(array, key) {
                return array.sort(function(a, b) {
                    var x = a[key],
                        y = b[key];
                    return ((x < y) ? -1 : ((x > y) ? 1 : 0));
                });
            },

            clearPreviousChecksHighlighting: function (iListofRows) {
                var i, nbofRows = iListofRows.length;

                for (i = 2; i < nbofRows; i++) {
                    iListofRows[i].removeClassName("info");
                }
            },

            resetLifecycleChecks : function(listofLines) {
                var i = listofLines.length - 1;
                while (i >= 2) {
					//CRK do not remove ApplyRouteTemplate as they can only be removed through Route Template Administration
					//HACK! We don't have enough informaiton here as it is only the html table row. So, checking if there is a trash icon in the the row (else it is not removable)
					if(listofLines[i].innerHTML.contains("fonticon-trash")){
						listofLines[i].remove();
					}
                    i--;
                }
            },

            populateAddInfoSelect: function (iSelect, selectedType, iListofSortedTypes) {
                var i,
                    nbofTypes = iListofSortedTypes.length,
                    currTypeCategory;

                for (i = 0; i < nbofTypes; i++) {
                    if (selectedType[0] === iListofSortedTypes[i].typeID) {
                        currTypeCategory = iListofSortedTypes[i].typeCategory;
                        break;
                    }
                }

                iSelect.remove();
                iSelect.add([{
                    label: ParamSkeletonNLS.AllChildrenTypes,
                    value: "ALL"
                }]);

                for (i = 0; i < nbofTypes; i++) {
                    if (currTypeCategory === iListofSortedTypes[i].typeCategory) {
                        iSelect.add([{
                            label: iListofSortedTypes[i].typeNLS,
                            value: iListofSortedTypes[i].typeID
                        }]);
                    }
                }

                return;
            },

            getListofAttributesForType : function(selectedType, sortedTypes) {

                var i,
                    nbofTypes = sortedTypes.length,
                    listofAttrs = "";

                for (i = 0; i < nbofTypes; i++) {
                    if (selectedType[0] === sortedTypes[i].typeID) {
                        if (sortedTypes[i].listofAddedAttributes !== undefined) {
                            listofAttrs = sortedTypes[i].listofAddedAttributes;
                        }
                        break;
                    }
                }
                return listofAttrs;
            },

            populateAttributesSelector : function (attributesSelector, iAttributes) {

                var i,
                    nbofAttr,
                    iListofAttributes;

                attributesSelector.remove();

                if (iAttributes !== "") {
                    iListofAttributes = iAttributes.split(';');
                    nbofAttr = iListofAttributes.length;

                    for (i = 0; i < nbofAttr; i++) {
                        attributesSelector.add([{
                            label: iListofAttributes[i],
                            value: iListofAttributes[i]
                        }]);
                    }
                }
            },

            updateRulesListforType : function(RulesListSelect, selectedType, iListofSortedTypes) {
                var i, rulesforType, listofRulesForType, nbofRules,
                    nbofTypes = iListofSortedTypes.length;

                for (i = 0; i < nbofTypes; i++) {
                    if (selectedType[0] == iListofSortedTypes[i].typeID) {
                        rulesforType = iListofSortedTypes[i].listofRules;
                        break;
                    }
                }

                listofRulesForType = rulesforType.split(',');
                nbofRules = listofRulesForType.length;

                RulesListSelect.remove();

                for (i = 0; i < nbofRules; i++) {
                    RulesListSelect.add([{
                        //label: eval("ParamSkeletonNLS." + listofRulesForType[i] + "Text"),
                        label: ParamSkeletonNLS[listofRulesForType[i] + "Text"],
                        value: listofRulesForType[i]
                    }]);
                }
            },

            getMatchingNode : function(iNodeList, iNodeID) {
                var e;
                for (e = iNodeList.first; e; e = e.next) {
                    if (e.stateid == iNodeID) {
                        return e;
                    }
                }
                return null;
            },

            checkforSingletonStates : function(iNodes, iEdges) {
                var eNode, itr,
                    edgeList = iEdges,//this.grph.edges,
                    isNodeConnected = false;
                    //this.grph.nodes.first
                for (eNode = iNodes.first; eNode; eNode = eNode.next) {
                    isNodeConnected = false;
                    for (itr = edgeList.first; itr; itr = itr.next) {
                        if ((itr.cl1.c.node.stateid == eNode.stateid) ||
                                (itr.cl2.c.node.stateid == eNode.stateid)) {
                            isNodeConnected = true;
                            break;
                        }
                    }
                    if (isNodeConnected === false) {//IR-529086-3DEXPERIENCER2018x
                        if (eNode.next !== null || eNode.prev !== null) {
                            UWA.log(eNode.stateid + " is not connected ");
                            return false;
                        }
                    }
                }

                return true;
            },

            removeRelatedChecksForTransition : function (iSource, iDestination, tbodyref) {
                var listofLines = tbodyref.children,
                    i = listofLines.length - 1;

                while (i >= 2) {
                    if ((listofLines[i].cells[1].value == iSource) &&
                            (listofLines[i].cells[2].value == iDestination)) {
                        listofLines[i].remove();
                    }
                    i--;
                }
            },

            removeRelatedChecksForState : function (iStateID, tbodyref) {
                var i,
                    listofLines = tbodyref.children;
                //
                i = listofLines.length - 1;
                while (i >= 2) {
                    if ((listofLines[i].cells[1].value == iStateID) ||
                            (listofLines[i].cells[2].value == iStateID)) {
                        listofLines[i].remove();
                    }
                    i--;
                }
            },

            isCheckAlreadyAdded : function (iType, iSource, iDestination, iRule, iAddinfo, tbodyref, iPromote) {
                //var tbodyref = this.contentDiv.getElements('.paramtbody')[0];
                var i,
                    listofLines = tbodyref.children,
                    nbofLines = listofLines.length, addiInfoCell = 4, promoteChk = true;

                for (i = 2; i < nbofLines; i++) {
                    if ((listofLines[i].cells[1].value == iSource) &&
                            (listofLines[i].cells[2].value == iDestination) &&
                                (listofLines[i].cells[0].value == iType) &&
                                    (listofLines[i].cells[3].value == iRule)) {
                        //FUN087047
                        addiInfoCell = 4;
                        promoteChk = true;
                        if (listofLines[i].cells.length > 7) {
                            if(listofLines[i].cells[4].value !== iPromote) {
                                promoteChk = false;
                            }
                            addiInfoCell = 5;
                        } 
                        //Additional Infos Tests
                        if (promoteChk && iAddinfo == listofLines[i].cells[addiInfoCell].value) {
                            return true;//Check Already there
                        }
                        if (promoteChk && ((iAddinfo === "ALL") ||
                                (listofLines[i].cells[addiInfoCell].value === "ALL"))) {
                            UWA.log("Check Already there::ALL");
                            return true;
                        }
                        
                    }
                }
                return false;
            },

            UpdateLifecycleChecksStsInTable : function(iContentDiv) {
                var imgSpan,
                    tbodyreflist = iContentDiv.getElements('.paramtbody'),
                    iLines = tbodyreflist[0].childNodes,
                    nbofLines = iLines.length,
                    i = nbofLines - 1;

                while (i > 1) {
                    /*if (iLines[i].cells[10].value === "DeletedNotDeployed") {
                        iLines[i].remove();
                    } else */
                    if (iLines[i].cells.length > 7) { // only when policy type is ER, appCategory is CBP
                        if (iLines[i].cells[7].value !== undefined && iLines[i].cells[7].value === "newcheck") {
                            iLines[i].cells[7].empty();
                            iLines[i].cells[7].value = true;
                            imgSpan = ParametersLayoutViewUtilities.buildImgSpan('check', '1.5', 'green');
                            imgSpan.inject(iLines[i].cells[7]);
                        }
                    } else {
                        if (iLines[i].cells[6].value === "newcheck") {
                            iLines[i].cells[6].empty();
                            iLines[i].cells[6].value = true;
                            imgSpan = ParametersLayoutViewUtilities.buildImgSpan('check', '1.5', 'green');
                            imgSpan.inject(iLines[i].cells[6]);
                        }
                    }
                    i--;
                }
            },

            disableApplyButton : function (iContentDiv) {
                var applyBttnPtr = iContentDiv.getElements('.btn-primary')[0];
                applyBttnPtr.disabled = true;
            },

            enableApplyButton : function (iContentDiv) {
                var applyBttnPtr = iContentDiv.getElements('.btn-primary')[0];
                applyBttnPtr.disabled = false;
            },

            sign: function (x) {
                return typeof x === 'number' ? x ? x < 0 ? -1 : 1 : x === x ? 0 : NaN : NaN;
            },

            transformCoordinates : function(iCoord, transVec) {
                //this.grph.views.main.vpt
                var xL, yL,
                    s = transVec[2],
                    tx = transVec[0],
                    ty = transVec[1],
                    lCoord = [];

                xL = (iCoord[0] + tx) * s;
                yL = (iCoord[1] + ty) * s;

                lCoord.push(xL);
                lCoord.push(yL);

                return lCoord;
            }

        };

        return lcview;

    });

/*@fullReview  CN1 18/05/15 2019xBeta2 Mapping Widget*/
/*global define, widget, document, setTimeout, console*/
/*jslint plusplus: true*/
/*jslint nomen: true*/
define('DS/ParameterizationSkeleton/Views/ParamCollaboration/AttributeMapping/MappingViewUtilities',
    [
        'UWA/Core',
        'DS/UIKIT/Accordion',
        'DS/UIKIT/Input/Button',
        'DS/UIKIT/Input/Select',
        'DS/UIKIT/Input/Toggle',
        'DS/UIKIT/Modal',
        'DS/UIKIT/Popover',
        'DS/UIKIT/Input/ButtonGroup',
        "DS/Controls/CustomizableDecorator",
        "DS/Controls/DecoratorManager",
        "DS/Controls/CustomizableDecoratorItems",
        "DS/Controls/Button",
        'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
        'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
        'DS/ParameterizationSkeleton/Views/ParamCollaboration/TypeMapping/TypeMappingViewUtilities',
        'DS/WAFData/WAFData',
        'i18n!DS/ParameterizationSkeleton/assets/nls/MappingManagementNLS',
        'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS'
    ],
    function (UWA,
        Accordion,
        Button, Select, Toggle,
        Modal,
        Popover, ButtonGroup, CustomizableDecorator, DecoratorManager, CustomizableDecoratorItems, AfrButton, ParametersLayoutViewUtilities, URLHandler,TypeMappingViewUtilities,WAFData,
        MappingManagementNLS, ParamSkeletonNLS) {

        'use strict';

        var UIview = {

            init: function (isCloudEnv) {
                this.cellsAttrIndex = [];
                this.cellsIndex = [];
                this.isCloudEnv = isCloudEnv;
            },

            initVariable: function () {
                this.cellsIndex = {
                    "kindOfMapping": 0,
                    "VPMObject": 1,
                    "side": 2,
                    "MatrixObject": 3,
                    "action": 4,
                    "deployFlag": 5,
                    "Indexed": 6,
                };
                this.cellsAttrIndex = {
                    "VPMAttr": 0,
                    "side": 1,
                    "MatrixAttr": 2,
                    "info": 3,
                    "action": 4,
                    "deployFlag": 5,
                };

                this.direction = {
                    "BOTH": "<=>",
                    "VPM_To_MX": "=>",
                    "MX_To_VPM": "<=",
                };

                this.enumType = "enum";
                this.PartAttrAsTarget = ["Part Classification", "Material Category", "Production Make Buy Code", "Service Make Buy Code", "Unit of Measure", "Description", "Estimated Cost", "Target Cost", "Lead Time", "Spare Part", "End Item", "End Item Override Enabled", "Lead Time Duration", "Effectivity Date", "Design Purchase", "Spare Part"];
                this.VPMAttrAsTarget = ["PLMReference.V_versionComment", "PLMEntity.V_description", "PLMReference.V_ApplicabilityDate"];
                this.mappableAttributeReaseon = {
                    0: MappingManagementNLS.ErrorNotSameType,
                    1: MappingManagementNLS.ErrorRange,
                    2: MappingManagementNLS.ErrorAlreadyMappedTogether,
                    3: MappingManagementNLS.ErrorVPMOnlyUsedAsSource,
                    4: MappingManagementNLS.ErrorMxOnlyUsedAsSource,
                    5: MappingManagementNLS.ErrorPartAlreadyUsedAsTarget,
                    6: MappingManagementNLS.ErrorProductAlreadyUsedAsTarget,
                    7: MappingManagementNLS.ErrorPartNotDeployed,
                    8: MappingManagementNLS.ErrorProductNotDeployed,
                    9: MappingManagementNLS.ErrorPartNotAvailable,
                    10: MappingManagementNLS.ErrorProductNotAvailable,
                    11: MappingManagementNLS.ErrorProductUnknown,
                    12: MappingManagementNLS.ErrorPartUnknown,
                    13: MappingManagementNLS.IncompatibleDirectionWithTypeMapping,
                    14: MappingManagementNLS.ProductIsInheritedAttribute,
                    15: MappingManagementNLS.PartIsInheritedAttribute
                };
            },




            UpdatePartComboAttributeList: function (VPMTypeRelInfo, MatrixTypeRelInfo, listofAttributesMapping, direction, attrMappingMap, listNewSelect, currentSelectVPM, currentSelectMatrix) {
                var i, j, attrLinetmp, deployCells, selectVPM, mappingEltAttr;

                var directionAvailableMap = new Map();
                var toExludeForUpdate = false;
                //For each Part attribute select, build Part attribute list mappable with selected VPM attribute
                for (i = 0; i < listNewSelect.length; i++) {
                    var newLine = listNewSelect[i];
                    if (currentSelectVPM !== undefined && newLine.VPM === currentSelectVPM && currentSelectMatrix !== undefined && newLine.Matrix === currentSelectMatrix)
                        toExludeForUpdate = true;
                    else toExludeForUpdate = false;

                    if (!toExludeForUpdate) {
                        mappingEltAttr = UIview.retrieveMappingAttrEntryFromAttrLine(newLine.NewLine, listofAttributesMapping);
                        UIview.enableMatrixAttrAccordingRules(VPMTypeRelInfo, newLine.VPM, MatrixTypeRelInfo, newLine.Matrix, direction, attrMappingMap, directionAvailableMap, mappingEltAttr);
                    }
                }

            },



            addNewAttributeLine: function (TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, kindOfMapping, attrtbody, listofAttributesMapping, widthTable, listofTypeRelMapping) {
                var iCell, removeAttributeButton, deleteSpan, removePop, position, VPMTypeRelInfo, MatrixTypeRelInfo, mappingElt, listOfLinkedMapping, attrMappingMap,
                    actionButton = [],//editElts = [],
                    lineAttr = UWA.createElement('tr', { 'class': 'AttrLineMapping' }),
                    mappingEltAttr,
                    that = this,
                    selectObj,
                    iCellStatus,
                    selectMatrix,
                    selectVPM,
                    iCellAction;

                var directionAvailableMap = new Map()
                iCell = UWA.createElement('td', {
                    'Align': 'left',
                    'width': widthTable[0],
                    'class': 'attributeMappingField font-3dslight'// font-3dsbold
                }).inject(lineAttr);

                selectVPM = new Select({
                    nativeSelect: true,
                    // placeholder: MappingManagementNLS.selectAttr.format(VPMTypeRelInfo.name),
                    placeholder: MappingManagementNLS.selectPhyAttr,
                    multiple: false,
                    className: "selectVPM",
                });
                selectVPM.inject(iCell);

                var directionCell;

                //  if (this.isCloudEnv) {

                directionCell = UWA.createElement('td', {
                    'width': widthTable[1],
                    'align': 'left',
                    'title': "",
                    'value': "",
                    'class': 'attributeMappingField font-3dslight'// font-3dsbold
                }).inject(lineAttr);

                /*var direction = "BOTH";
                if (this.isCloudEnv) direction = "VPM_To_MX";
                else UIview.getSelectedTypeRelMappingDirection(that.pSkeleton, typeMapping, that.isCloudEnv);
                UIview.setDirectionCell(directionCell, direction, VPMTypeRelInfo.name, MatrixTypeRelInfo.name);*/

                directionCell.addEvent('update', function () {
                    if (mappingEltAttr !== undefined) {
                        var direction = directionCell.value;
                        // UIview.modifyMappingDirection.call(that, TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, direction, mappingEltAttr, listofAttributesMapping, selectVPM, selectMatrix);
                        UIview.UpdateStatusAndDirectionAfterModify.call(that, TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, direction, mappingEltAttr, listofAttributesMapping, iCellStatus, iCellAction, directionCell, actionButton, selectVPM, selectMatrix);
                    }
                });

                iCell = UWA.createElement('td', {
                    'Align': 'left',
                    'width': widthTable[2],
                    'class': 'attributeMappingField font-3dslight'// font-3dsbold
                }).inject(lineAttr);

                selectMatrix = new Select({
                    nativeSelect: true,
                    //placeholder: MappingManagementNLS.selectAttr.format(MatrixTypeRelInfo.name),
                    placeholder: MappingManagementNLS.selectPrtAttr,
                    multiple: false,
                    className: "selectMatrix",
                });
                selectMatrix.inject(iCell);

                iCell = UWA.createElement('td', {
                    'Align': 'left',
                    'width': widthTable[3],
                    'class': 'attributeMappingField font-3dslight'// font-3dsbold
                }).inject(lineAttr);

                var infoSpan = UWA.createElement('span');
                var infoButton = new Button({
                    className: 'close',
                    icon: 'fonticon fonticon-info fonticon-1.5x',//value: 'Button', //fonticon-cancel  fonticon-minus-circled
                    attributes: {
                        disabled: false,
                        'aria-hidden': 'true'
                    }
                }).inject(infoSpan);
                var infoPop = new Popover({
                    target: infoSpan,
                    trigger: "hover",
                    animate: "true",
                    position: "top",
                    body: MappingManagementNLS.NotMappableAttributes,
                    title: ''
                });
                infoSpan.inject(iCell);
                infoButton.hide();


                var VPMAttributes;
                if (VPMTypeRelInfo !== undefined)
                    VPMAttributes = VPMTypeRelInfo.attributeInfo;

                var MatrixAttributes;
                if (MatrixTypeRelInfo !== undefined)
                    MatrixAttributes = MatrixTypeRelInfo.attributeInfo;


                function addEltToSelect(value, select) {
                    var i, attributeInfo, attributeName, attributeItf, position, option, listOfEnableOption = new Array(), listOfDisableOption = new Array(), attrType;
                    for (i = 0; i < value.length; i++) {
                        attributeInfo = value[i];

                        attributeItf = attributeInfo.itf;

                        //select only OOTB attribute and custo attribute (attributes coming from another interface cloud added once bug will be corrected)
                        /*HACKif(attributeItf === null || attributeItf ==="" || attributeItf === "XP_VPMReference_Ext" || attributeItf === "XP_Part_Ext")*/
                        //{
                        attributeName = attributeInfo.id;
                        if (attributeInfo.isenum === true)
                            attrType = UIview.enumType;
                        else
                            attrType = attributeInfo.type;
                        option = { label: attributeInfo.name + " (" + attrType + ")", value: attributeInfo.id };

                        listOfEnableOption.push(option);
                        //}
                    }

                    listOfEnableOption.forEach(function (optionSelect) {
                        select.add(optionSelect);
                        select.enable(optionSelect);
                    });

                    listOfDisableOption.forEach(function (optionSelect) {
                        select.add(optionSelect);
                        select.disable(optionSelect);

                    });

                }

                addEltToSelect(VPMAttributes, selectVPM);
                addEltToSelect(MatrixAttributes, selectMatrix);

                selectMatrix.disable();


                selectVPM.addEvent("onChange", function (e) {

                    actionButton[2].hide();
                    actionButton[0].elements.input.setStyle('border-radius', '3px');
                    var selectedAttributes = selectVPM.getSelection(false);
                    selectMatrix.select(0, true);
                    directionCell.empty();

                    if (selectedAttributes.length != 0) {
                        selectMatrix.enable();
                        var typeRelDirection = UIview.getSelectedTypeRelMappingDirection(that.pSkeleton, typeMapping, that.isCloudEnv);
                        UIview.enableMatrixAttrAccordingRules(VPMTypeRelInfo, selectVPM, MatrixTypeRelInfo, selectMatrix, typeRelDirection, that.attributeMappingMap, directionAvailableMap);
                        infoButton.show();
                    }
                    else {
                        selectMatrix.disable();
                        infoButton.hide();
                    }

                    if (mappingEltAttr !== undefined) {
                        UIview.removeMappingAttrInModel(TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, mappingEltAttr, listofAttributesMapping, that.attributeMappingMap, that.listNewSelect);
                        mappingEltAttr = undefined;
                    }

                });


                var directionAvailableMap = new Map();


                infoButton.addEvent("onClick", function (e) {
                    var changeDirectionModal = UIview.ShowNotMappableAttribute.call(that, typeMapping, (selectVPM.getSelection(false))[0].value, MatrixAttributes, VPMTypeRelInfo, MatrixTypeRelInfo, mappingEltAttr);
                    //changeDirectionModal.inject(that.contentDiv);
                });


                selectMatrix.addEvent("onChange", function (e) {

                    var listMatrixOptions = selectMatrix.getOptions(false);

                    directionCell.empty();

                    if (listMatrixOptions.length !== 0) {
                        var deployAttrcellSpan = lineAttr.cells[UIview.cellsAttrIndex.deployFlag].getElement('span');
                        var selectedAttributes = selectMatrix.getSelection(false);

                        //remove current associated attribute mapping
                        if (mappingEltAttr !== undefined) {
                            UIview.removeMappingAttrInModel(TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, mappingEltAttr, listofAttributesMapping, that.attributeMappingMap, that.listNewSelect);
                            mappingEltAttr = undefined;
                        }
                        if (selectedAttributes.length != 0) {
                            actionButton[0].elements.input.setStyle('border-top-right-radius', '0px');
                            actionButton[0].elements.input.setStyle('border-bottom-right-radius', '0px');

                            deployAttrcellSpan.show();
                            var selectedVPMAttr = (selectVPM.getSelection(false))[0].value;
                            var selectedMatrixAttr = selectedAttributes[0].value;

                            var attrVPMInfo = UIview.retrieveAttributeInfo(VPMTypeRelInfo, (selectVPM.getSelection(false))[0].value);
                            var attrMXInfo = UIview.retrieveAttributeInfo(MatrixTypeRelInfo, selectedAttributes[0].value);

                            var authorizedDirection;
                            if (!that.isCloudEnv) {
                                //modifyDirectionButton.setDisabled(false);
                                actionButton[2].show();
                                var listOfMappedVPMattr = (that.attributeMappingMap.MX).get(selectedMatrixAttr);
                                var listOfMappedMXattr = (that.attributeMappingMap.VPM).get(selectedVPMAttr);


                                var typeRelDirection = UIview.getSelectedTypeRelMappingDirection(that.pSkeleton, typeMapping, that.isCloudEnv);
                                authorizedDirection = UIview.CheckRulesToAddAttrMapping(VPMTypeRelInfo, attrVPMInfo, MatrixTypeRelInfo, attrMXInfo, typeRelDirection, listOfMappedMXattr, listOfMappedVPMattr);
                                var direction = 'BOTH';
                                if (authorizedDirection.BOTH) direction = 'BOTH';
                                else if (authorizedDirection.VPM_To_MX) direction = "VPM_To_MX";
                                else if (authorizedDirection.MX_To_VPM) direction = 'MX_To_VPM';
                            }
                            else authorizedDirection = { VPM_To_MX: true, MX_To_VPM: false, BOTH: false };


                            // if (this.isCloudEnv || !authorizedDirection.BOTH) {

                            var side = "BOTH";
                            if (this.isCloudEnv || !authorizedDirection.MX_To_VPM) side = "VPM_To_MX";
                            else if (!authorizedDirection.VPM_To_MX) side = "MX_To_VPM";
                            UIview.setDirectionCell(directionCell, side, VPMTypeRelInfo.name, MatrixTypeRelInfo.name);
                            mappingElt = UIview.retrieveMappingEntry(VPMTypeRelInfo.id, MatrixTypeRelInfo.id, listofTypeRelMapping);
                            if (mappingElt != undefined) {
                                var IsMappingAlreadyExist = false;
                                if (that.isCloudEnv) {

                                    var mappAttrEltMXToVPM = UIview.retrieveMappingAttrEntry(selectedVPMAttr, selectedMatrixAttr, 'MX_To_VPM', "Deployed", listofAttributesMapping);
                                    if (mappAttrEltMXToVPM == undefined)
                                        mappAttrEltMXToVPM = UIview.retrieveMappingAttrEntry(selectedVPMAttr, selectedMatrixAttr, 'MX_To_VPM', "Stored", listofAttributesMapping);
                                    if (mappAttrEltMXToVPM != undefined) {
                                        //The attribute are already mapped together with MX to VPM direction but mapping is hidden in Cloud ENV, change direction to VPM_To_MX internally
                                        //UIview.modifyMappingDirection.call(that, TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, mappingElt, "VPM_To_MX", undefined, mappAttrEltMXToVPM, listofAttributesMapping, selectVPM, selectMatrix);
                                        directionCell.value = "VPM_To_MX";
                                        mappAttrEltMXToVPM.status = "New";
                                        IsMappingAlreadyExist = true;
                                    }

                                }

                                if (!IsMappingAlreadyExist) {
                                    var directionToApply = "BOTH";
                                    if (that.isCloudEnv)
                                        directionToApply = "VPM_To_MX"
                                    else directionToApply = directionCell.value;

                                    mappingEltAttr = { MatrixAttribute: attrMXInfo, SynchDirection: directionToApply, VPMAttribute: attrVPMInfo, status: "New", isBaseMapping: false, VPMAttributeDeployed: true, MatrixAttributeDeployed: true };
                                    mappingElt.AttributeMapping.push(mappingEltAttr);
                                    // TypeMappingViewUtilities.disableDirectionButtonAccordingMappingRules(TypeMappingCollection, typeMapping, listofAttributesMapping);
                                    UIview.AddNewMappingInAttrMap(VPMTypeRelInfo, MatrixTypeRelInfo, listofAttributesMapping, mappingEltAttr, that.attributeMappingMap, that.listNewSelect);
                                }
                            }
                        }

                        else {
                            //  UIview.setButtonDirection('BOTH', modifyDirectionButton);
                            //modifyDirectionButton.setDisabled(true);
                            actionButton[2].hide();
                            deployAttrcellSpan.hide();
                        }

                        //Update Part attribute select lists to take into account removing and new mapping
                        UIview.UpdatePartComboAttributeList(VPMTypeRelInfo, MatrixTypeRelInfo, listofAttributesMapping, typeMapping.SynchDirection, that.attributeMappingMap, that.listNewSelect, selectVPM, selectMatrix);
                    }
                });

                iCellAction = UWA.createElement('td', {
                    'Align': 'left',
                    'width': widthTable[4],
                    'class': 'attributeMappingField font-3dslight'// font-3dsbold
                }).inject(lineAttr);

                iCellAction.addEventListener('click', function (e) { e.stopPropagation(); }, false);

                actionButton = UIview.createDeleteModifyActionsIcon(iCellAction);

                actionButton[0].elements.input.setStyle('border-radius', '3px');
                actionButton[2].hide();

                actionButton[0].addEvent("onClick", function (e) {
                    actionButton[0].blur();
                    UIview.removeAttrLineCallBack.call(that, TypeMappingCollection, lineAttr, mappingEltAttr, listofAttributesMapping, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, actionButton);
                });

                actionButton[1].addEvent("onClick", function (e) {
                    actionButton[1].blur();
                    UIview.reviveAttrLineCallBack.call(that, TypeMappingCollection, lineAttr, mappingEltAttr, listofAttributesMapping, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, null, null, actionButton);
                });

                actionButton[2].addEvent("onClick", function (e) {
                    actionButton[2].blur();
                    if (mappingEltAttr !== undefined) {
                        var listOfMappedVPMattr = (that.attributeMappingMap.MX).get(mappingEltAttr.MatrixAttribute.id);
                        var listOfMappedMXattr = (that.attributeMappingMap.VPM).get(mappingEltAttr.VPMAttribute.id);
                        var typeRelDirection = UIview.getSelectedTypeRelMappingDirection(that.pSkeleton, typeMapping, that.isCloudEnv);
                        var authorizedDirection = UIview.CheckRulesToAddAttrMapping(VPMTypeRelInfo, mappingEltAttr.VPMAttribute, MatrixTypeRelInfo, mappingEltAttr.MatrixAttribute, typeRelDirection, listOfMappedMXattr, listOfMappedVPMattr, mappingEltAttr);

                        if (!authorizedDirection.BOTH) {
                            var cpt = 0;
                            var messageBOTH = authorizedDirection.message.BOTH;
                            var messageList = "";
                            for (cpt = 0; cpt < messageBOTH.length; cpt++) {
                                var separator = "";
                                if (messageList !== "") separator = ", ";
                                messageList = messageList + separator + UIview.mappableAttributeReaseon[messageBOTH[cpt]];
                            }
                            that.userMessaging.add({ className: "warning", message: MappingManagementNLS.modifyDirectionNotPossible + messageList + "." });
                        }
                        else
                            if (DecoratorManager.isDecoratorDisplayed()) {
                                DecoratorManager.hideDecorator(false, true);
                            } else {
                                DecoratorManager.showDecorator(actionButton[2], actionButton[2], "mappingDirectionDecorator");
                                var decorator = DecoratorManager.getDecorator();
                                if (directionCell.value === "VPM_To_MX") {
                                    decorator.activeView = "viewB";
                                }
                                else if (directionCell.value === "MX_To_VPM") {
                                    decorator.activeView = "viewC";
                                }
                                else if (directionCell.value === "BOTH") {
                                    decorator.activeView = "viewA";
                                }
                                DecoratorManager.showDecorator(actionButton[2], actionButton[2], "mappingDirectionDecorator");
                                UIview.addTooltipToDecorator();
                            }
                    }
                });


                //Hide button to modify and revive mapping, only delete button must be displayed for new mapping line
                if (this.isCloudEnv)
                    actionButton[2].hide();
                actionButton[1].hide();
                var imgClass = 'fonticon fonticon-' + '1.5' + 'x fonticon-cog';
                var imgTitle = MappingManagementNLS.newNotdeployedParam;
                var iconColor = 'black';
                iCellStatus = UWA.createElement('td', {
                    'width': widthTable[5],
                    'align': 'center',
                    'title': imgTitle
                });
                var imgSpan = UWA.createElement('span', {
                    'class': imgClass
                }).inject(iCellStatus);
                imgSpan.setStyle("color", iconColor);
                iCellStatus.setStyle("vertical-align", "text-bottom");
                imgSpan.hide();

                iCellStatus.value = "New";
                iCellStatus.inject(lineAttr);

                //Add associated select to listNewSelect (For update selects in case of mapping modification)
                selectObj = { NewLine: lineAttr, VPM: selectVPM, Matrix: selectMatrix };
                that.listNewSelect.push(selectObj);


                return {
                    newline: lineAttr, selectVPM: selectVPM, selectMatrix: selectMatrix, directionCell: directionCell
                };
            },


            modifyDeployCellSatus: function (cell, cellValue, cellTitle, icon, color) {
                cell.empty();
                cell.value = cellValue;
                cell.title = cellTitle;

                var imgSpan = UWA.createElement('span', {
                    'class': 'fonticon fonticon-' + '1.5' + 'x ' + icon
                }).inject(cell);

                imgSpan.setStyle("color", color);
                cell.setStyle("vertical-align", "text-bottom");
            },


            buildAttributeLine: function (TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, kindOfMapping, attributeMapping, listofAttributesMapping, widthTable, listofTypeRelMapping, attrtbody, isInherieted, pSkeleton) {
                var iCell, removeAttributeButton, deleteSpan, removePop, position,
                    actionButton = [],//editElts = [],
                    lineAttr = UWA.createElement('tr', { 'class': 'AttrLineMapping' }),
                    itfVPM = "",
                    attrVPM = attributeMapping.VPMAttribute.id,
                    attrVPMInfo,
                    attrVPMName = attributeMapping.VPMAttribute.name,
                    side = attributeMapping.SynchDirection,
                    itfMatrix = "",
                    attrMatrix = attributeMapping.MatrixAttribute.id,
                    attrMatrixInfo,
                    attrMatrixName = attributeMapping.MatrixAttribute.name,
                    status = attributeMapping.status,
                    isBaseMapping = attributeMapping.isBaseMapping.toString(),
                    iCellStatus,
                    iCellAction,
                    that = this;

                UIview.initVariable();


                iCell = UWA.createElement('td', {
                    'Align': 'left',
                    'width': widthTable[0],
                    'value': attrVPM,
                    'class': 'attributeMappingField font-3dslight'// font-3dsbold
                }).inject(lineAttr);

                UWA.createElement('p', {
                    text: attrVPMName,
                    value: attrVPM,
                }).inject(iCell);
                var authorizedDirection,
                    messagesBOTH, messagesVPMENG, messagesENGVPM;
                var directionAvailable = { VPM_To_MX: false, MX_To_VPM: false, BOTH: false };

                //See if direction can be modified according to mapping rules
                if (isBaseMapping !== "true" && !isInherieted && !this.isCloudEnv && VPMTypeRelInfo !== undefined && MatrixTypeRelInfo !== undefined) {
                    //Check which direction is available
                    var attrMappingMapWithoutCurrentMapping = { VPM: new Map(this.attributeMappingMap.VPM), MX: new Map(this.attributeMappingMap.MX) };
                    listOfMappedMXattr = (attrMappingMapWithoutCurrentMapping.VPM).get(attributeMapping.VPMAttribute.id);
                    listOfMappedVPMattr = (attrMappingMapWithoutCurrentMapping.MX).get(attributeMapping.MatrixAttribute.id);

                    var typeRelDirection = UIview.getSelectedTypeRelMappingDirection(that.pSkeleton, typeMapping, that.isCloudEnv);
                    directionAvailable = UIview.CheckCoherenceRules(VPMTypeRelInfo, attributeMapping.VPMAttribute, MatrixTypeRelInfo, attributeMapping.MatrixAttribute, typeRelDirection, listOfMappedMXattr, listOfMappedVPMattr, attributeMapping);

                }

                // if (isBaseMapping === "true" || isInherieted || this.isCloudEnv ||!directionAvailable.BOTH) {
                var dirICell = UWA.createElement('td', {
                    'width': widthTable[1],
                    'align': 'left',
                    'title': "",
                    'value': "",
                    'class': 'attributeMappingField font-3dslight'// font-3dsbold
                }).inject(lineAttr);

                // var directionToDisplay = side;
                // if (this.isCloudEnv && side == "BOTH") directionToDisplay = "VPM_To_MX"
                UIview.setDirectionCell(dirICell, side, VPMTypeRelInfo.name, MatrixTypeRelInfo.name);

                //Call each time the direction is modified in the UI
                dirICell.addEvent('update', function () {
                    var direction = dirICell.value;
                    UIview.UpdateStatusAndDirectionAfterModify.call(that, TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, direction, attributeMapping, listofAttributesMapping, iCellStatus, iCellAction, dirICell, actionButton, null, null);

                });



                iCell = UWA.createElement('td', {
                    'Align': 'left',
                    'width': widthTable[2],
                    'value': attrMatrix,
                    'class': 'attributeMappingField font-3dslight'// font-3dsbold
                }).inject(lineAttr);



                UWA.createElement('p', {
                    text: attrMatrixName,
                    value: attrMatrix,
                }).inject(iCell);

                var listOfMappedMXattr = (that.attributeMappingMap.VPM).get(attributeMapping.VPMAttribute.id);
                var listOfMappedVPMattr = (that.attributeMappingMap.MX).get(attributeMapping.MatrixAttribute.id);
                var resultInvalidMapping = false;
                if (isBaseMapping === "false" && !isInherieted) {
                    var typeRelDirection = UIview.getSelectedTypeRelMappingDirection(that.pSkeleton, typeMapping, that.isCloudEnv);
                    resultInvalidMapping = UIview.isInvalidMapping(VPMTypeRelInfo, MatrixTypeRelInfo, typeRelDirection, attributeMapping, listOfMappedMXattr, listOfMappedVPMattr);
                }


                if (!isInherieted) {

                    iCell = UWA.createElement('td', {
                        'Align': 'left',
                        'width': widthTable[3],
                        'class': 'attributeMappingField font-3dslight'// font-3dsbold
                    }).inject(lineAttr);

                    iCellAction = UWA.createElement('td', {
                        'Align': 'left',
                        'width': widthTable[4],
                        'class': 'attributeMappingField font-3dslight'// font-3dsbold
                    }).inject(lineAttr);



                    iCellAction.addEventListener('click', function (e) { e.stopPropagation(); }, false);


                    //If mapping can be modified or removed, add action buttons
                    if (isBaseMapping === "false") {
                        actionButton = UIview.createDeleteModifyActionsIcon(iCellAction);
                        actionButton[0].addEvent("onClick", function (e) {
                            UIview.removeAttrLineCallBack.call(that, TypeMappingCollection, lineAttr, attributeMapping, listofAttributesMapping, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, actionButton);
                        });

                        actionButton[1].addEvent("onClick", function (e) {
                            actionButton[1].blur();
                            UIview.reviveAttrLineCallBack.call(that, TypeMappingCollection, lineAttr, attributeMapping, listofAttributesMapping, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, null, null, actionButton);
                        });


                        actionButton[2].addEvent("onClick", function (e) {
                            actionButton[2].blur();
                            listOfMappedVPMattr = (that.attributeMappingMap.MX).get(attributeMapping.MatrixAttribute.id);
                            listOfMappedMXattr = (that.attributeMappingMap.VPM).get(attributeMapping.VPMAttribute.id);
                            var typeRelDirection = UIview.getSelectedTypeRelMappingDirection(that.pSkeleton, typeMapping, that.isCloudEnv);
                            var authorizedDirection = UIview.CheckRulesToAddAttrMapping(VPMTypeRelInfo, attributeMapping.VPMAttribute, MatrixTypeRelInfo, attributeMapping.MatrixAttribute, typeRelDirection, listOfMappedMXattr, listOfMappedVPMattr, attributeMapping);


                            if (!authorizedDirection.BOTH && (authorizedDirection.VPM_To_MX && dirICell.value === "VPM_To_MX" || authorizedDirection.MX_To_VPM && dirICell.value === "MX_To_VPM")) {
                                var cpt = 0;
                                var messageBOTH = authorizedDirection.message.BOTH;
                                var messageList = "";
                                for (cpt = 0; cpt < messageBOTH.length; cpt++) {
                                    messageList = messageList + "\n" + UIview.mappableAttributeReaseon[messageBOTH[cpt]];
                                }
                                that.userMessaging.add({ className: "warning", message: MappingManagementNLS.modifyDirectionNotPossible + messageList });
                            }
                            else
                                if (DecoratorManager.isDecoratorDisplayed()) {
                                    DecoratorManager.hideDecorator(false, true);
                                } else {
                                    DecoratorManager.showDecorator(actionButton[2], actionButton[2], "mappingDirectionDecorator");
                                    var decorator = DecoratorManager.getDecorator();
                                    if (authorizedDirection.BOTH) {
                                        if (dirICell.value === "VPM_To_MX") {
                                            decorator.activeView = "viewB";
                                        }
                                        else if (dirICell.value === "MX_To_VPM") {
                                            decorator.activeView = "viewC";
                                        }
                                        else if (dirICell.value === "BOTH") {
                                            decorator.activeView = "viewA";
                                        }
                                    }
                                    else {
                                        if (authorizedDirection.MX_To_VPM) {
                                            decorator.activeView = "viewE";
                                        }
                                        else if (authorizedDirection.VPM_To_MX) {
                                            decorator.activeView = "viewD";
                                        }
                                    }
                                    UIview.addTooltipToDecorator();
                                }
                        });

                        if (this.isCloudEnv)
                            actionButton[2].hide();
                        //hide revive button
                        actionButton[1].hide();

                        if (resultInvalidMapping.isInvalid && (resultInvalidMapping.errorsList.indexOf(0) != -1 || resultInvalidMapping.errorsList.indexOf(2) != -1 || resultInvalidMapping.errorsList.indexOf(7) != -1 || resultInvalidMapping.errorsList.indexOf(8) != -1 || resultInvalidMapping.errorsList.indexOf(9) != -1 || resultInvalidMapping.errorsList.indexOf(10) != -1 || resultInvalidMapping.errorsList.indexOf(11) != -1 || resultInvalidMapping.errorsList.indexOf(12) != -1)) { //modifyDirectionButton.disable();
                            actionButton[2].hide();
                            actionButton[0].elements.input.setStyle('border-radius', '3px');
                        }

                    }
                    else {
                        imgSpan = UWA.createElement('span', {
                            'class': 'fonticon fonticon-' + '1.5' + 'x fonticon-lock'
                        }).inject(iCellAction);

                        iCellAction.setStyle("vertical-align", "text-bottom");
                        iCellAction.title = MappingManagementNLS.NotModifiable;
                    }

                }

                var isDeployed;
                if (status === "New") isDeployed = "NewNotDeployed";
                else
                    isDeployed = (status === "Deployed") ? 'true' : 'false';

                var invalidMapping;
                if (isDeployed === "true") {
                    if (!resultInvalidMapping.isInvalid || status.indexOf("Removed") !== -1) {
                        imgTitle = MappingManagementNLS.Deployed;
                        iconColor = 'green';
                    }
                    else {
                        imgTitle = MappingManagementNLS.InvalidDeployed;
                        iconColor = 'red';
                        attributeMapping.status = "InvalidDeployed";
                        status = "InvalidDeployed";
                        invalidMapping = { attrLine: lineAttr, attrMapping: attributeMapping };
                        //that.listInvalidMultipeTargetMapping.push(invalidMapping);
                    }

                    var imgSpan,
                        imgTitle = imgTitle,
                        imgClass = 'fonticon fonticon-' + '1.5' + 'x fonticon-check',
                        iconColor = iconColor,
                        iconSize = '1.5';
                }

                else if (isDeployed === "false") {
                    imgClass = 'fonticon fonticon-' + iconSize + 'x fonticon-cog';
                    if (!resultInvalidMapping.isInvalid || status.indexOf("Removed") !== -1) {
                        imgTitle = MappingManagementNLS.Stored;
                        iconColor = 'orange';
                    }
                    else {
                        imgTitle = MappingManagementNLS.InvalidStored;
                        iconColor = 'red';
                        attributeMapping.status = "InvalidStored";
                        status = "InvalidStored";
                        invalidMapping = { attrLine: lineAttr, attrMapping: attributeMapping };
                        //that.listInvalidMultipeTargetMapping.push(invalidMapping);
                    }
                } else if (isDeployed === "NewNotDeployed") {
                    imgClass = 'fonticon fonticon-' + iconSize + 'x fonticon-cog';
                    imgTitle = MappingManagementNLS.newNotdeployedParam;
                    iconColor = 'black';
                }

                var idxDeployStatus = 3;
                if (!isInherieted) idxDeployStatus = 5;
                iCellStatus = UWA.createElement('td', {
                    'width': widthTable[idxDeployStatus],
                    'align': 'center',
                    'title': imgTitle
                });

                imgSpan = UWA.createElement('span', {
                    'class': imgClass
                }).inject(iCellStatus);

                imgSpan.setStyle("color", iconColor);
                iCellStatus.setStyle("vertical-align", "text-bottom");
                iCellStatus.value = status;
                iCellStatus.inject(lineAttr);

                if (resultInvalidMapping.isInvalid) {
                    var infoInvalidMappingSpan = UWA.createElement('span', {
                        'class': 'InfoInvalidMapping fonticon fonticon-info'
                    }).inject(iCellStatus);

                    var popoverInfoInvalidMapping = new Popover({
                        target: infoInvalidMappingSpan,
                        trigger: "hover",
                        animate: "true",
                        position: 'left',
                        body: resultInvalidMapping.errorMessage,
                    });

                    infoInvalidMappingSpan.setStyle("margin-left", '7px');
                }

                if (isInherieted) {
                    iCell = UWA.createElement('td', {
                        'Align': 'left',
                        'width': widthTable[4],
                        'value': "mapping",
                        'class': 'attributeMappingField font-3dslight'// font-3dsbold
                    }).inject(lineAttr);

                    var vpmObjectName = "";
                    var vpmObjectId = "";
                    if (attributeMapping.VPMObject !== null) { vpmObjectName = attributeMapping.VPMObject.name; vpmObjectId = attributeMapping.VPMObject.id }


                    var mappingCpt = 0;

                    for (mappingCpt = 0; mappingCpt < attributeMapping.associatedTypeMappingsIds.length; mappingCpt++) {
                        var MappingId = attributeMapping.associatedTypeMappingsIds[mappingCpt];

                        var divMapping = UWA.createElement('div', {
                            "id": "divMapping"
                        }).inject(iCell);

                        var spanMapping = UWA.createElement('span', {
                            'class': "text-primary",
                            // "text": vpmObjectName + "/" + attributeMapping.MatrixObject.name,
                            "text": attributeMapping.associatedTypeMappingsName[mappingCpt],
                            "id": MappingId
                        });
                        spanMapping.setStyle("cursor", "pointer");
                        spanMapping.inject(divMapping);

                        spanMapping.onclick = function () {
                            Object.keys(pSkeleton.getViewAt(2).contentsViews.tile.nestedView.children).forEach(function (cur) {
                                var curTypeId = pSkeleton.getViewAt(2).contentsViews.tile.nestedView.children[cur].model.id;
                                var model = pSkeleton.getViewAt(2).contentsViews.tile.nestedView.children[cur].model;
                                if (MappingId == curTypeId) {
                                    var nestedView = pSkeleton.getViewAt(2).contentsViews.tile.nestedView;
                                    nestedView.dispatchEvent("onItemViewClick", [model], nestedView);
                                }
                            });
                        };

                    }
                }

                //Mapping has been removed by import
                if (status.indexOf("Removed") !== -1)
                    UIview.setToRemoveAttrLine(lineAttr, isInherieted, actionButton);
                return lineAttr;
            },



            setDirectionCell: function (directionCell, direction, VPMTypeName, MatrixTypeName) {

                directionCell.empty();

                var txtSide = MappingManagementNLS.both;
                if (direction == "BOTH" && !this.isCloudEnv)
                    txtSide = MappingManagementNLS.both;
                else if (direction == "VPM_To_MX" || this.isCloudEnv)
                    txtSide = MappingManagementNLS.unilateralDirection.format(VPMTypeName, MatrixTypeName);
                else if (direction == "MX_To_VPM")
                    txtSide = MappingManagementNLS.unilateralDirection.format(MatrixTypeName, VPMTypeName);

                directionCell.value = direction;
                directionCell.title = txtSide;

                var directionDiv = UWA.createElement('div', {
                    'class': 'attrDirectionDiv'
                }).inject(directionCell);

                /* var baseDirectionDiv = UWA.createElement('div', {
                     'class': 'attrBaseDirectionDiv'
                 }).inject(directionCell);*/

                /* var imgSpanDataBase = UWA.createElement('span', {
                     'class': 'fonticon  fonticon-database'
                 }).inject(baseDirectionDiv);
                 imgSpanDataBase.setStyle("color", "grey");
                 var imgSpanRightBase = UWA.createElement('span', {
                     'class': 'fonticon  fonticon-expand-right'
                 }).inject(baseDirectionDiv);
                 imgSpanRightBase.setStyle("color", "grey");*/

                var imgSpanRight = UWA.createElement('span', {
                    'class': 'fonticon  fonticon-expand-right'
                })

                var imgSpanLeft = UWA.createElement('span', {
                    'class': 'fonticon  fonticon-expand-left'
                })

                if (direction == "BOTH" && !this.isCloudEnv) {
                    imgSpanLeft.inject(directionDiv);
                    imgSpanRight.inject(directionDiv);
                }
                else if (direction == "VPM_To_MX" || this.isCloudEnv) {
                    imgSpanRight.inject(directionDiv);
                    imgSpanRight.setStyle("margin-left", "22px");
                }
                else if (direction == "MX_To_VPM") {
                    imgSpanLeft.inject(directionDiv);
                }

                directionDiv.setStyle("vertical-align", "text-bottom");
            },


            buildIconForDirection: function (direction) {

                var divIconDirection = UWA.createElement('div', {
                    'class': 'divDirectionIcon'
                })

                var imgSpanRight = UWA.createElement('span', {
                    'class': 'fonticon  fonticon-expand-right'
                })

                var imgSpanLeft = UWA.createElement('span', {
                    'class': 'fonticon  fonticon-expand-left'
                })

                if (direction == "BOTH") {
                    imgSpanLeft.inject(divIconDirection);
                    imgSpanRight.inject(divIconDirection);
                }
                else if (direction == "VPM_To_MX") {
                    imgSpanRight.inject(divIconDirection);
                    imgSpanRight.setStyle("margin-left", "22px");
                }
                else if (direction == "MX_To_VPM") {
                    imgSpanLeft.inject(divIconDirection);
                }
                return divIconDirection;
            },


            buildAttributeTableHeading: function (widthTable) {
                var lineTitle, iCell;

                lineTitle = UWA.createElement('tr', {
                    'class': 'success'
                });

                iCell = UWA.createElement('td', {
                    'Align': 'left',
                    'width': widthTable[0],
                }).inject(lineTitle);

                UWA.createElement('h5', {
                    text: MappingManagementNLS.ProductAttr
                    //'class': 'font-3dslight'// font-3dsbold
                }).inject(iCell);


                iCell = UWA.createElement('td', {
                    'Align': 'left',
                    'width': widthTable[1],
                }).inject(lineTitle);

                UWA.createElement('h5', {
                    text: MappingManagementNLS.side
                    //'class': 'font-3dslight'// font-3dsbold
                }).inject(iCell);


                iCell = UWA.createElement('td', {
                    'Align': 'left',
                    'width': widthTable[2],
                }).inject(lineTitle);

                UWA.createElement('h5', {
                    text: MappingManagementNLS.PartAttr
                    //'class': 'font-3dslight'// font-3dsbold
                }).inject(iCell);

                iCell = UWA.createElement('td', {
                    'Align': 'left',
                    'width': widthTable[3],
                }).inject(lineTitle);


                iCell = UWA.createElement('td', {
                    'Align': 'left',
                    'width': widthTable[4],
                }).inject(lineTitle);

                UWA.createElement('h5', {
                    text: MappingManagementNLS.actions
                    //'class': 'font-3dslight'// font-3dsbold
                }).inject(iCell);

                iCell = UWA.createElement('td', {
                    'Align': 'left',
                    'width': widthTable[5],
                }).inject(lineTitle);

                UWA.createElement('h5', {
                    text: MappingManagementNLS.deployStatus
                    //'class': 'font-3dslight'// font-3dsbold
                }).inject(iCell);

                return lineTitle;
            },

            buildInheritedAttributeTableHeading: function (widthTable) {
                var lineTitle, iCell;

                lineTitle = UWA.createElement('tr', {
                    'class': 'success'
                });

                //**Product Attr**//
                iCell = UWA.createElement('td', {
                    'Align': 'left',
                    'width': widthTable[0],
                }).inject(lineTitle);

                UWA.createElement('h5', {
                    text: MappingManagementNLS.ProductAttr
                    //'class': 'font-3dslight'// font-3dsbold
                }).inject(iCell);

                //******//

                //**Side**//
                iCell = UWA.createElement('td', {
                    'Align': 'left',
                    'width': widthTable[1],
                }).inject(lineTitle);

                UWA.createElement('h5', {
                    text: MappingManagementNLS.side
                    //'class': 'font-3dslight'// font-3dsbold
                }).inject(iCell);

                //*******//

                //**Part attr**//
                iCell = UWA.createElement('td', {
                    'Align': 'left',
                    'width': widthTable[2],
                }).inject(lineTitle);

                UWA.createElement('h5', {
                    text: MappingManagementNLS.PartAttr
                    //'class': 'font-3dslight'// font-3dsbold
                }).inject(iCell);

                //*******//

                /* iCell = UWA.createElement('td', {
                     'Align': 'left',
                     'width': widthTable[3],
                 }).inject(lineTitle);*/


                iCell = UWA.createElement('td', {
                    'Align': 'left',
                    'width': widthTable[3],
                }).inject(lineTitle);

                UWA.createElement('h5', {
                    text: MappingManagementNLS.deployStatus
                    //'class': 'font-3dslight'// font-3dsbold
                }).inject(iCell);


                iCell = UWA.createElement('td', {
                    'Align': 'left',
                    'width': widthTable[4],
                }).inject(lineTitle);

                UWA.createElement('h5', {
                    text: "mapping"
                    //'class': 'font-3dslight'// font-3dsbold
                }).inject(iCell);

                return lineTitle;
            },

            buildMappingLine: function (typeMapping) {

                var MatrixType, VPMType, side, kindOfMapping, isBaseMapping, status, mappingTable, lineMapping, txtSide, iCell, deleteIcon, deleteAction, deleteSpan,
                    removeLineMappingButton, removePropMappingButton, attributeMappingDiv, attributesTable, mappingTable, actionCol, modifySpan, modifyAttributeButton, modifyPop, modifySpan, MatrixTypeName, VPMTypeName, that = this;
                UIview.initVariable();

                /* MatrixType = eltmapping.MatrixObject;
                 VPMType = eltmapping.VPMObject;
                 MatrixTypeName = eltmapping.MatrixObjectName;
                 VPMTypeName = eltmapping.VPMObjectName;
                 side = eltmapping.SynchDirection;
                 kindOfMapping = eltmapping.KindOfMapping.toLowerCase();
                 isBaseMapping = eltmapping.isBaseMapping.toString();
                 status = eltmapping.status;*/

                MatrixType = typeMapping.mxObject.id;
                VPMType = typeMapping.vpmObject.id;
                MatrixTypeName = typeMapping.mxObject.name;
                VPMTypeName = typeMapping.vpmObject.name;
                side = typeMapping.SynchDirection;
                kindOfMapping = typeMapping.KindOfMapping.toLowerCase();
                isBaseMapping = typeMapping.isBaseMapping.toString();
                status = typeMapping.deployedStatus;

                mappingTable = UWA.createElement('table', {
                    'class': 'tableMapping'
                });//table-bordered

                lineMapping = UWA.createElement('tr', {
                    'class': 'lineMapping'
                }).inject(mappingTable);

                UWA.createElement('td', { 'class': 'colMappingType', 'text': "", 'value': "" }).inject(lineMapping);

                UWA.createElement('td', { 'class': 'colMappingVPMObject', 'text': VPMTypeName, 'value': VPMType }).inject(lineMapping);

                if (side == "BOTH")
                    txtSide = "<=>";
                else if (side == "VPM_To_MX")
                    txtSide = "=>";
                else if (side == "MX_To_VPM")
                    txtSide = "<=";


                side = UWA.createElement('td', { 'class': 'colMappingSide', 'text': txtSide, 'value': side }).inject(lineMapping);

                UWA.createElement('td', { 'class': 'colMappingMatrixObject', 'text': MatrixTypeName, 'value': MatrixType }).inject(lineMapping);

                var isDeployed = (status === "deployed") ? 'true' : 'false';
                iCell = UWA.createElement('td', { 'class': 'colMappingType', 'text': "", 'value': "deployed" }).inject(lineMapping);
                return mappingTable;
            },


            buildAttributeTable: function (TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, kindOfMapping, listofAttributesMapping, widthTable, listofTypeRelMapping, inherited, pSkeleton) {
                var attributesTable, attrtbody, iCell, lineTitle, lineAttribute, j;

                //sort mapping => 1:Deployed, 2:Stored: 3:Removed, 4:New
                function compare(attrMapping1, attrMapping2) {
                    if (attrMapping1.isBaseMapping.toString() === "true" && attrMapping2.isBaseMapping.toString() === "false")
                        return -1;
                    else if (attrMapping1.isBaseMapping.toString() === "false" && attrMapping2.isBaseMapping.toString() === "true")
                        return 1;
                    else if (attrMapping1.isBaseMapping.toString() === "true" && attrMapping2.isBaseMapping.toString() === "true")
                        return 0;
                    else if (attrMapping1.status === "Deployed" && attrMapping2.status !== "Deployed")
                        return -1;
                    else if (attrMapping1.status !== "Deployed" && attrMapping2.status === "Deployed")
                        return 1;
                    else if (attrMapping1.status === "Deployed" && attrMapping2.status === "Deployed")
                        return 0;
                    else if (attrMapping1.status === "Stored" && attrMapping2.status !== "Stored")
                        return -1;
                    else if (attrMapping1.status !== "Stored" && attrMapping2.status === "Stored")
                        return 1;
                    else if (attrMapping1.status === "Stored" && attrMapping2.status === "Stored")
                        return 0;
                    return 0;
                }

                listofAttributesMapping.sort(compare);

                attributesTable = UWA.createElement('table', {
                    'class': 'attrTableMapping table table-condensed'
                });//table-bordered

                attrtbody = UWA.createElement('tbody', {
                    'class': 'attrstbodyMapping'
                }).inject(attributesTable);

                if (!inherited)
                    lineTitle = UIview.buildAttributeTableHeading(widthTable);
                else
                    lineTitle = UIview.buildInheritedAttributeTableHeading(widthTable);

                lineTitle.inject(attrtbody);

                //Sort attributes  in alphabetical order
                function compareAttr(attrInfo1, attrInfo2) {
                    if (attrInfo1.name.toUpperCase() < attrInfo2.name.toUpperCase())
                        return -1;
                    if (attrInfo1.name.toUpperCase() > attrInfo2.name.toUpperCase())
                        return 1;
                    return 0;
                }

                var VPMAttributes;
                if (VPMTypeRelInfo !== undefined)
                    VPMTypeRelInfo.attributeInfo.sort(compareAttr);

                var MatrixAttributes;
                if (MatrixTypeRelInfo !== undefined)
                    MatrixTypeRelInfo.attributeInfo.sort(compareAttr);

                for (j = 0; j < listofAttributesMapping.length; j++)
                    if (listofAttributesMapping[j].status.indexOf("Removed") === -1)
                        UIview.AddNewMappingInAttrMap(VPMTypeRelInfo, MatrixTypeRelInfo, listofAttributesMapping, listofAttributesMapping[j], this.attributeMappingMap, this.listNewSelect);


                for (j = 0; j < listofAttributesMapping.length; j++) {
                    if (!this.isCloudEnv || listofAttributesMapping[j].SynchDirection != "MX_To_VPM") {
                        lineAttribute = UIview.buildAttributeLine.call(this, TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, kindOfMapping, listofAttributesMapping[j], listofAttributesMapping, widthTable, listofTypeRelMapping, attrtbody, inherited, pSkeleton);
                        lineAttribute.inject(attrtbody);
                    }
                }

                return attributesTable;
            },


            addChildAttributeMappingInfo: function (VPMTypeRelInfo, MatrixTypeRelInfo, listofChildAttributesMapping) {
                var i = 0;
                for (i = 0; i < listofChildAttributesMapping.length; i++)
                    if (listofChildAttributesMapping[i].status.indexOf("Removed") === -1)
                        UIview.AddNewMappingInAttrMap(VPMTypeRelInfo, MatrixTypeRelInfo, listofChildAttributesMapping, listofChildAttributesMapping[i], this.attributeMappingMap, this.listNewSelect);
            },

            retrieveMappingEntry: function (VPMTypeRel, MxTypeRel, collectionMapping) {
                var EltMapping, foundElt = false, cpt = 0;

                while (!foundElt && cpt < collectionMapping.length) {
                    EltMapping = collectionMapping[cpt];
                    if (EltMapping != undefined) {
                        if (VPMTypeRel === EltMapping.VPMObject && MxTypeRel === EltMapping.MatrixObject)
                            foundElt = true;
                        else cpt++
                    }

                }
                if (!foundElt) return undefined;
                else return EltMapping;
            },

            retrieveMappingAttrEntry: function (VPMAttr, MxAttr, direction, status, attributeMappingList) {
                var EltAttrMapping, foundElt = false, cpt = 0, VPMAttrName = VPMAttr, MxAttrName = MxAttr;

                while (!foundElt && cpt < attributeMappingList.length) {
                    EltAttrMapping = attributeMappingList[cpt];
                    if (EltAttrMapping != undefined) {
                        if (VPMAttrName === EltAttrMapping.VPMAttribute.id && MxAttrName === EltAttrMapping.MatrixAttribute.id && direction == EltAttrMapping.SynchDirection && status == EltAttrMapping.status)
                            foundElt = true;
                        else cpt++
                    }

                }
                if (!foundElt) return undefined;
                else return EltAttrMapping;
            },


            retrieveMappingAttrEntryFromAttrLine: function (attrLine, attributeMappingList) {

                var cellAttr, vpmAttr, cellVPMAttr, cellMatrixAttr, cellDirection, vpmAttr, partAttr, direction, mappingEltAttr, cellStatus;

                cellAttr = attrLine.cells[UIview.cellsAttrIndex.deployFlag];
                cellVPMAttr = attrLine.cells[UIview.cellsAttrIndex.VPMAttr];
                cellMatrixAttr = attrLine.cells[UIview.cellsAttrIndex.MatrixAttr];
                cellDirection = attrLine.cells[UIview.cellsAttrIndex.side];
                cellStatus = attrLine.cells[UIview.cellsAttrIndex.deployFlag];

                var selectVPM = cellVPMAttr.getElement('select');
                var selectPart = cellMatrixAttr.getElement('select');

                if (selectVPM !== undefined && selectVPM !== null)
                    vpmAttr = selectVPM.value;
                else
                    vpmAttr = cellVPMAttr.value;

                if (selectPart !== undefined && selectPart !== null)
                    partAttr = selectPart.value;
                else
                    partAttr = cellMatrixAttr.value;

                var directionbutton = cellDirection.getElement('button');
                if (directionbutton !== undefined && directionbutton !== null)
                    direction = directionbutton.value;
                else
                    direction = cellDirection.value;

                status = cellStatus.value;
                mappingEltAttr = UIview.retrieveMappingAttrEntry(vpmAttr, partAttr, direction, status, attributeMappingList);
                return mappingEltAttr;
            },

            retrieveAttrLineFromMappingAttrEntry: function (mappingEltAttr, attrTable) {
                var attrLine, nbofLines, VPMAttrId, MXAttrId, side, status, cptAttr;
                if (attrTable !== undefined) {
                    nbofLines = attrTable.children.length;

                    for (cptAttr = 1; cptAttr < nbofLines; cptAttr++) {
                        attrLine = attrTable.children[cptAttr];
                        VPMAttrId = attrLine.cells[UIview.cellsAttrIndex.VPMAttr].value;
                        MXAttrId = attrLine.cells[UIview.cellsAttrIndex.MatrixAttr].value;
                        side = attrLine.cells[UIview.cellsAttrIndex.side].value;
                        status = attrLine.cells[UIview.cellsAttrIndex.deployFlag].value;

                        if (mappingEltAttr.VPMAttribute.id === VPMAttrId && mappingEltAttr.MatrixAttribute.id === MXAttrId && mappingEltAttr.SynchDirection === side && mappingEltAttr.status === status)
                            break;
                    }
                }
                return attrLine;
            },

            retrieveAttributeInfo: function (typeRelInfo, attr) {
                var EltAttrInfo, foundElt = false, attributeInfo, cpt = 0;

                if (attr === "WCGEquivalentDeclaredWeightExt.V_WCG_Declared_Mass")
                    return { basic: false, id: "WCGEquivalentDeclaredWeightExt.V_WCG_Declared_Mass", itf: "WCGEquivalentDeclaredWeightExt", range: [], type: "Double" };

                attributeInfo = typeRelInfo.attributeInfo;

                while (!foundElt && cpt < attributeInfo.length) {
                    EltAttrInfo = attributeInfo[cpt];
                    if (EltAttrInfo != undefined) {
                        if (attr.toUpperCase() === EltAttrInfo.id.toUpperCase())
                            foundElt = true;
                        else cpt++
                    }

                }
                if (!foundElt) return undefined;
                else return EltAttrInfo;
            },




            //Change mapping in Deployed  state to remove State
            setToRemoveAttrLine: function (attrLine, isInherieted, actionButtonArray) {
                var deployAttrcell, imgAttrSpan, i, arrayAction;

                if (isInherieted)
                    deployAttrcell = attrLine.cells[3];
                else deployAttrcell = attrLine.cells[UIview.cellsAttrIndex.deployFlag];


                //Set the line as deleted
                UIview.setDeletedCellStyle(attrLine.cells[UIview.cellsAttrIndex.VPMAttr]);
                UIview.setDeletedCellStyle(attrLine.cells[UIview.cellsAttrIndex.MatrixAttr]);
                var buttonSide = attrLine.cells[UIview.cellsAttrIndex.side].getElements('button');

                //if (buttonSide === undefined) {

                var iconsSide = attrLine.cells[UIview.cellsAttrIndex.side].getElements('span');
                iconsSide.forEach(function (icon) {
                    icon.setStyle("color", "grey");
                });

                if (!isInherieted) {
                    actionButtonArray[0].hide();
                    actionButtonArray[1].show();
                    if (!this.isCloudEnv)
                        actionButtonArray[2].hide();
                    actionButtonArray[1].elements.input.setStyle('border-radius', '3px');
                    //UWA.Element.set.call(actionButtonArray[1].elements.input, 'title', "restore attribute mapping");
                    actionButtonArray[3].setBody(MappingManagementNLS.RestoreAttributeMapping);
                }
                //Set status cell as removed according the previous status
                var icon = 'fonticon-trash', color, cellValue, cellTitle;
                if (deployAttrcell.value.indexOf("Stored") !== -1) {
                    cellTitle = MappingManagementNLS.DeletedStoredNotApplied;
                    cellValue = "RemovedStored";
                    color = "orange";
                }
                else {
                    cellTitle = MappingManagementNLS.DeletedNotApplied;
                    color = "red";
                    cellValue = "RemovedDeployed";
                }
                UIview.modifyDeployCellSatus(deployAttrcell, cellValue, cellTitle, icon, color);




            },


            //Change mapping in remove state to deployed state
            unsetRemoveAttrLine: function (attrLine, resultInvalidStored) {
                var deployAttrcell, imgAttrSpan, i, actionCell, deleteIcon, actionButton, arrayAction, status, that = this;

                deployAttrcell = attrLine.cells[UIview.cellsAttrIndex.deployFlag];
                actionCell = attrLine.cells[UIview.cellsAttrIndex.action];

                //Set the line as not deleted
                var buttonSide = attrLine.cells[UIview.cellsAttrIndex.side].getElements('button');
                if (buttonSide === undefined) {
                    var iconsSide = attrLine.cells[UIview.cellsAttrIndex.side].getElements('span');
                    iconsSide.forEach(function (icon) {
                        icon.setStyle("color", "black");
                    });
                }
                UIview.setNormalCellStyle(attrLine.cells[UIview.cellsAttrIndex.VPMAttr]);
                UIview.setNormalCellStyle(attrLine.cells[UIview.cellsAttrIndex.MatrixAttr]);

                //Show modify and remove button, hide revive button
                arrayAction = attrLine.cells[UIview.cellsAttrIndex.action];
                var buttons = arrayAction.getElements('button');
                buttons[0].show();
                buttons[1].hide();

                buttons[1].setStyle('border-radius', '0px');


                /* if (!(resultInvalidStored.isInvalid && (resultInvalidStored.errorsList.indexOf(2) != -1 || resultInvalidStored.errorsList.indexOf(7) != -1 || resultInvalidStored.errorsList.indexOf(8) != -1 || resultInvalidStored.errorsList.indexOf(9) != -1 || resultInvalidStored.errorsList.indexOf(10) != -1 || resultInvalidStored.errorsList.indexOf(11) != -1 || resultInvalidStored.errorsList.indexOf(12) != -1)))
                     if (!that.isCloudEnv)
                         buttonSide[0].disabled = false;*/
                if (!(resultInvalidStored.isInvalid && (resultInvalidStored.errorsList.indexOf(2) != -1 || resultInvalidStored.errorsList.indexOf(7) != -1 || resultInvalidStored.errorsList.indexOf(8) != -1 || resultInvalidStored.errorsList.indexOf(9) != -1 || resultInvalidStored.errorsList.indexOf(10) != -1 || resultInvalidStored.errorsList.indexOf(11) != -1 || resultInvalidStored.errorsList.indexOf(12) != -1)))
                    if (!that.isCloudEnv)
                        buttons[2].show();

                var iconsSide = attrLine.cells[UIview.cellsAttrIndex.side].getElements('span');
                iconsSide.forEach(function (icon) {
                    icon.setStyle("color", "black");
                });



                //Set status cell  according the previous status
                var cellTitle, cellColor, status, cellIcon;
                if (deployAttrcell.value === "RemovedStored") {
                    cellTitle = MappingManagementNLS.Stored;
                    cellColor = "orange";
                    status = "Stored";
                    cellIcon = 'fonticon-cog';

                    if (resultInvalidStored.isInvalid) {
                        cellTitle = MappingManagementNLS.InvalidStored;
                        cellColor = "red";
                        status = "InvalidStored";
                    }

                }
                else //RemoveDeployed
                {
                    cellTitle = MappingManagementNLS.Deployed;
                    cellColor = "green";
                    status = "Deployed";
                    cellIcon = 'fonticon-check';

                    if (resultInvalidStored.isInvalid) {
                        cellTitle = MappingManagementNLS.InvalidDeployed;
                        cellColor = "red";
                        status = "InvalidDeployed";
                    }
                }

                UIview.modifyDeployCellSatus(deployAttrcell, status, cellTitle, cellIcon, cellColor);

                if (resultInvalidStored.isInvalid) {
                    var infoInvalidMappingSpan = UWA.createElement('span', {
                        'class': 'InfoInvalidMapping fonticon fonticon-info'
                    }).inject(deployAttrcell);

                    var popoverInfoInvalidMapping = new Popover({
                        target: infoInvalidMappingSpan,
                        trigger: "hover",
                        animate: "true",
                        position: 'left',
                        body: resultInvalidStored.errorMessage,
                    });

                    infoInvalidMappingSpan.setStyle("margin-left", '7px');
                }
            },

            isInvalidMapping: function (VPMTypeRelInfo, MatrixTypeRelInfo, typeRelDirection, attributeMapping, VPMObjMappedAttr, MXObjMappedAttr) {

                var invalidStoredMapping = false, messageInvalidStoredMapping = "", attrVPMInfo, attrMatrixInfo, findAttribute, listofErrors = new Array();

                //test authorized and deployed for Product attribute
                if (!attributeMapping.VPMAttribute.deployed) {
                    invalidStoredMapping = true;
                    messageInvalidStoredMapping += MappingManagementNLS.NonDeployedProductAttribute + "\n";
                    listofErrors.push(8);
                }
                else {
                    if (attributeMapping.VPMAttribute.isUnknown) {
                        invalidStoredMapping = true;
                        messageInvalidStoredMapping += MappingManagementNLS.ErrorProductUnknown + "\n";;
                        listofErrors.push(11);
                    }
                    else if (!attributeMapping.VPMAttribute.isauthorized) {
                        invalidStoredMapping = true;
                        messageInvalidStoredMapping += MappingManagementNLS.NonAuthorizedProductAttribute + "\n";
                        listofErrors.push(10);
                    }
                }

                //test authorized and deployed for Part attribute
                if (!attributeMapping.MatrixAttribute.deployed) {
                    invalidStoredMapping = true;
                    messageInvalidStoredMapping += MappingManagementNLS.NonDeployedPartAttribute + "\n";
                    listofErrors.push(7);
                }
                else {
                    if (attributeMapping.MatrixAttribute.isUnknown) {
                        invalidStoredMapping = true;
                        messageInvalidStoredMapping += MappingManagementNLS.ErrorPartUnknown + "\n";;
                        listofErrors.push(12);
                    }
                    else if (!attributeMapping.MatrixAttribute.isauthorized) {
                        invalidStoredMapping = true;
                        messageInvalidStoredMapping += MappingManagementNLS.NonAuthorizedPartAttribute + "\n";
                        listofErrors.push(9);
                    }
                }


                //Check other rules

                var directionAvailable = UIview.CheckRulesToAddAttrMapping(VPMTypeRelInfo, attributeMapping.VPMAttribute, MatrixTypeRelInfo, attributeMapping.MatrixAttribute, typeRelDirection, VPMObjMappedAttr, MXObjMappedAttr, attributeMapping);
                var i = 0;
                if (attributeMapping.SynchDirection == "BOTH" && !directionAvailable.BOTH) {
                    for (i = 0; i < directionAvailable.message.BOTH.length; i++) {
                        messageInvalidStoredMapping += UIview.mappableAttributeReaseon[directionAvailable.message.BOTH[i]] + "\n";
                        listofErrors.push(directionAvailable.message.BOTH[i]);
                    }
                    invalidStoredMapping = true;
                }
                else if (attributeMapping.SynchDirection == "VPM_To_MX" && !directionAvailable.VPM_To_MX) {
                    for (i = 0; i < directionAvailable.message.VPM_To_MX.length; i++) {
                        messageInvalidStoredMapping += UIview.mappableAttributeReaseon[directionAvailable.message.VPM_To_MX[i]] + "\n";
                        listofErrors.push(directionAvailable.message.VPM_To_MX[i]);
                    }
                    invalidStoredMapping = true;
                }
                else if (attributeMapping.SynchDirection == "MX_To_VPM" && !directionAvailable.MX_To_VPM) {
                    for (i = 0; i < directionAvailable.message.MX_To_VPM.length; i++) {
                        messageInvalidStoredMapping += UIview.mappableAttributeReaseon[directionAvailable.message.MX_To_VPM[i]] + "\n";
                        listofErrors.push(directionAvailable.message.MX_To_VPM[i]);
                    }
                    invalidStoredMapping = true;
                }

                return { isInvalid: invalidStoredMapping, errorMessage: messageInvalidStoredMapping, errorsList: listofErrors };
            },





            //CallBack to remove a mapping
            removeAttrLineCallBack: function (TypeMappingCollection, attrLine, attributeMapping, listofAttributesMapping, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, actionButtonArray) {
                var deployAttrcell, actionAttrcell, selectVPM, selectMatrix;
                if (attrLine != undefined) {
                    deployAttrcell = attrLine.cells[UIview.cellsAttrIndex.deployFlag];
                    actionAttrcell = attrLine.cells[UIview.cellsAttrIndex.action];
                    //If mapping in New state, delete the line
                    if (deployAttrcell.value === "New" || deployAttrcell.value === "InvalidNew") {

                        //retrieve associated select and remove it of listNewSelect
                        var indexLine = -1, selectObj, i = 0;
                        while (indexLine === -1 && i < this.listNewSelect.length) {
                            selectObj = this.listNewSelect[i];
                            if (selectObj.NewLine === attrLine)
                                indexLine = i;
                            i++;
                        }
                        if (indexLine != -1)
                            this.listNewSelect.splice(indexLine, 1);

                        //remove the line
                        attrLine.remove();
                    }
                    else {//If mapping in deployed state, change the state and the UI to removed
                        //If mapping has been modified, restore database direction
                        if (attributeMapping.status.indexOf("Modified") !== -1) {
                            UIview.resetModifyMapping.call(this, TypeMappingCollection, attrLine, attributeMapping, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, listofAttributesMapping);
                            attributeMapping.SynchDirectionBase = undefined;
                        }
                        UIview.setToRemoveAttrLine(attrLine, false, actionButtonArray);
                    }
                }
                //Update mapping model
                if (attributeMapping !== undefined) {
                    var selectVPM, selectMatrix;
                    if (selectObj !== undefined) {
                        selectVPM = selectObj.VPM;
                        selectMatrix = selectObj.Matrix;
                    }
                    UIview.removeMappingAttrInModel(TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, attributeMapping, listofAttributesMapping, this.attributeMappingMap, this.listNewSelect);
                    UIview.UpdatePartComboAttributeList(VPMTypeRelInfo, MatrixTypeRelInfo, listofAttributesMapping, typeMapping.SynchDirection, this.attributeMappingMap, this.listNewSelect, selectVPM, selectMatrix);

                    //Remove a mapping can impact invalid mapping having the same target attribute, check if some mapping exist and if they are still invalid or not
                    UIview.checkMultipleTargetMapping.call(this, typeMapping, VPMTypeRelInfo, MatrixTypeRelInfo, listofAttributesMapping, attributeMapping);
                }
            },


            //Callback to revive a removed mapping
            reviveAttrLineCallBack: function (TypeMappingCollection, attrLine, attributeMapping, listofAttributesMapping, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, selectVPM, selectMatrix, actionButtonArray) {
                var deployAttrcell, errorMessage = "",
                    listOfMappedVPMattr = (this.attributeMappingMap.MX).get(attributeMapping.MatrixAttribute.id),
                    listOfMappedMXattr = (this.attributeMappingMap.VPM).get(attributeMapping.VPMAttribute.id),
                    isPrtUsedAsTarget = false, isPrdUsedAsTarget = false, isAlreadyMapped = false, mappingToExclude;

                //if the mapping has associated line, previous operation done was "modified", in this case the associated new mapping will be removed.
                //So it must not be taking into account to check if there is conflict to revive the mapping
                /* if (attributeMapping.newAssociatedLine !== undefined)
                     mappingToExclude = UIview.retrieveMappingAttrEntryFromAttrLine(attributeMapping.newAssociatedLine, listofAttributesMapping);*/
                if (attributeMapping.SynchDirectionBase !== undefined && attributeMapping.SynchDirectionBase !== "")
                    mappingToExclude = attributeMapping;

                //Check if the mapping can be revive => no conflict with others mapping
                var typeRelDirection = UIview.getSelectedTypeRelMappingDirection(this.pSkeleton, typeMapping, this.isCloudEnv);
                var authorizedDirection = UIview.CheckRulesToAddAttrMapping(VPMTypeRelInfo, attributeMapping.VPMAttribute, MatrixTypeRelInfo, attributeMapping.MatrixAttribute, typeRelDirection, listOfMappedMXattr, listOfMappedVPMattr, mappingToExclude);

                //Another mapping exists with same attributes
                if (authorizedDirection.message.BOTH.indexOf(2) !== -1) isAlreadyMapped = true;
                //Another mapping uses Part attribute as target
                if (authorizedDirection.message.BOTH.indexOf(5) !== -1) isPrtUsedAsTarget = true;
                //Another mapping uses VPM attribute as target
                if (authorizedDirection.message.BOTH.indexOf(6) !== -1) isPrdUsedAsTarget = true;


                var directionToSet = attributeMapping.SynchDirection;
                if (attributeMapping.SynchDirectionBase !== undefined && attributeMapping.SynchDirectionBase !== "")
                    directionToSet = attributeMapping.SynchDirectionBase;

                //Don't allow restore mapping if the operation leads to an error in a New or modify mapping (multiple target error)
                var cpt = 0, isNewOrModifiedReIntroduceError = false;
                for (cpt = 0; cpt < listofAttributesMapping.length; cpt++) {
                    if ((listofAttributesMapping[cpt].status === "New" || listofAttributesMapping[cpt].status.indexOf("Modified") !== -1) &&
                        (((listofAttributesMapping[cpt].VPMAttribute.id === attributeMapping.VPMAttribute.id && (listofAttributesMapping[cpt].SynchDirection === "BOTH" || listofAttributesMapping[cpt].SynchDirection === "MX_To_VPM"))
                            ||
                            (listofAttributesMapping[cpt].MatrixAttribute.id === attributeMapping.MatrixAttribute.id && (listofAttributesMapping[cpt].SynchDirection === "BOTH" || listofAttributesMapping[cpt].SynchDirection === "VPM_To_MX"))))) {
                        //verify that listofAttributesMapping[cpt] is not attribute mapping
                        if (!(listofAttributesMapping[cpt].VPMAttribute.id === attributeMapping.VPMAttribute.id && listofAttributesMapping[cpt].MatrixAttribute.id === attributeMapping.MatrixAttribute.id && listofAttributesMapping[cpt].SynchDirection === attributeMapping.SynchDirection && listofAttributesMapping[cpt].status === attributeMapping.status)) {
                            isNewOrModifiedReIntroduceError = true;
                            break;
                        }
                    }
                }

                //If a conflict has been detected, don't revive the mapping and display error message with the reason
                if (isNewOrModifiedReIntroduceError && ((!authorizedDirection.BOTH && directionToSet === "BOTH")
                    || (!authorizedDirection.VPM_To_MX && directionToSet === "VPM_To_MX")
                    || (!authorizedDirection.MX_To_VPM && directionToSet === "MX_To_VPM"))) {

                    if (isAlreadyMapped)
                        errorMessage = MappingManagementNLS.errorReviveMappingAlreadyMapped;
                    else if (isPrtUsedAsTarget && isPrdUsedAsTarget)
                        errorMessage = MappingManagementNLS.errorReviveMappingPrdAndPrtUsedAsTarget;
                    else if (isPrtUsedAsTarget)
                        errorMessage = MappingManagementNLS.errorReviveMappingPartUsedAsTarget;
                    else if (isPrdUsedAsTarget)
                        errorMessage = MappingManagementNLS.errorReviveMappingPrdUsedAsTarget;
                    else errorMessage = MappingManagementNLS.errorReviveMappingInvalid;
                    errorMessage += MappingManagementNLS.errorReviveMapping;
                    this.userMessaging.add({ className: "warning", message: errorMessage });

                }
                else {
                    /* if (attributeMapping.newAssociatedLine !== undefined)
                         UIview.removeAttrLineCallBack.call(this, TypeMappingCollection, attributeMapping.newAssociatedLine, mappingToExclude, listofAttributesMapping, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, actionButtonArray);*/

                    if (attrLine != undefined) {
                        if (attributeMapping.SynchDirectionBase !== undefined)
                            UIview.resetModifyMapping.call(this, TypeMappingCollection, attrLine, attributeMapping, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, listofAttributesMapping)

                        //revive removed line
                        if (attributeMapping.status.indexOf("Removed") !== -1) {
                            //var resultInvalidStored = UIview.isInvalidMapping(VPMTypeRelInfo,MatrixTypeRelInfo,attributeMapping);
                            var listOfMappedMXattr = (this.attributeMappingMap.VPM).get(attributeMapping.VPMAttribute.id);
                            var listOfMappedVPMattr = (this.attributeMappingMap.MX).get(attributeMapping.MatrixAttribute.id);
                            var resultInvalidMapping = UIview.isInvalidMapping(VPMTypeRelInfo, MatrixTypeRelInfo, typeRelDirection, attributeMapping, listOfMappedMXattr, listOfMappedVPMattr);
                            //revive in UI
                            UIview.unsetRemoveAttrLine.call(this, attrLine, resultInvalidMapping);
                            //revive in model
                            if (attributeMapping !== undefined) {
                                UIview.addMappingAttrInModel(TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, attributeMapping, listofAttributesMapping, this.attributeMappingMap, this.listNewSelect, resultInvalidMapping.isInvalid);
                                //remove associated new line (in case of modify undo)
                                //attributeMapping.newAssociatedLine = undefined;
                                //Update others select list
                                UIview.UpdatePartComboAttributeList(VPMTypeRelInfo, MatrixTypeRelInfo, listofAttributesMapping, typeMapping.SynchDirection, this.attributeMappingMap, this.listNewSelect, selectVPM, selectMatrix);
                            }

                            UIview.checkMultipleTargetMapping.call(this, typeMapping, VPMTypeRelInfo, MatrixTypeRelInfo, listofAttributesMapping, attributeMapping);
                        }
                    }
                }
            },


            //Create action icon button (remove, modify, revive)
            createDeleteModifyActionsIcon: function (actionCell) {
                var deleteSpan, deleteButton, deletePop, modifySpan, modifyButton, modifyPop, undoSpan, undoButton, undoPop;

                var btnArr = [];


                var divUndoDirectionModifification = UWA.createElement('div', {
                    'class': 'divUndoDirectionModifification'
                });
                var pUndoDirectionModifification = UWA.createElement('p', {
                    'class': 'pUndoDirectionModifification',
                    'text': 'Restore database direction'
                }).inject(divUndoDirectionModifification);

                var divDataBaseDirection = UWA.createElement('div', {
                    'class': 'divDataBaseDirection'
                }).inject(divUndoDirectionModifification);


                var imgSpanDataBase = UWA.createElement('span', {
                    'class': 'fonticon  fonticon-database'
                }).inject(divDataBaseDirection);

                var pDatBaseDirection = UWA.createElement('p', {
                    'class': 'pDatBaseDirection',
                    'text': '  :  ',
                }).inject(divDataBaseDirection);

                var imgSpanRightBase = UWA.createElement('span', {
                    'class': 'fonticon  fonticon-expand-right'
                }).inject(divDataBaseDirection);
                //remove button
                deleteSpan = UWA.createElement('span');
                deleteButton = new Button({
                    id: "mappingActionDeleteButton",
                    className: 'mappingActionButton primary',
                    icon: 'fonticon fonticon-trash fonticon-1.5x',//value: 'Button', //fonticon-cancel  fonticon-minus-circled
                    attributes: {
                        disabled: false,
                        'aria-hidden': 'true',
                        title: MappingManagementNLS.deleteAttrMapping,
                    }
                })/*.inject(deleteSpan)*/;
                btnArr.push(deleteButton);
                if (this.isCloudEnv) {
                    deleteButton.elements.input.setStyle('border-top-right-radius', '3px');
                    deleteButton.elements.input.setStyle('border-bottom-right-radius', '3px');
                };

                /*  deletePop = new Popover({
                      target: deleteSpan,
                      trigger: "hover",
                      animate: "true",
                      position: "top",
                      body: MappingManagementNLS.deleteAttrMapping,
                      title: ''
                  });*/
                //deleteSpan.inject(actionCell);


                //revie button

                undoButton = new Button({
                    id: "mappingActionResetButton",
                    className: 'mappingActionButton primary',
                    icon: 'fonticon fonticon-undo fonticon-1.5x',//value: 'Button', //fonticon-cancel  fonticon-minus-circled
                    attributes: {
                        disabled: false,
                        'aria-hidden': 'true',
                        //title: MappingManagementNLS.undoOperation,
                    }
                });


                var spanUndoButton = undoButton.elements.input.childNodes[0];
                // undoSpan = UWA.createElement('span').inject(undoButton);
                btnArr.push(undoButton);
                if (this.isCloudEnv) {
                    undoButton.elements.input.setStyle('border-top-left-radius', '3px');
                    undoButton.elements.input.setStyle('border-bottom-left-radius', '3px');
                };
                undoPop = new Popover
                    ({
                        target: spanUndoButton,
                        trigger: "hover",
                        animate: "true",
                        position: "top",
                        body: MappingManagementNLS.undoOperation,
                        title: ''
                    });
                //undoSpan.inject(actionCell);


                //modify button
                /*if (!this.isCloudEnv) {*/
                modifySpan = UWA.createElement('span');
                modifyButton = new Button({
                    id: "mappingActionModifyButton",
                    className: 'mappingActionButton primary',
                    icon: 'fonticon fonticon-pencil fonticon-1.5x',//value: 'Button', //fonticon-cancel  fonticon-minus-circled
                    attributes: {
                        disabled: false,
                        'aria-hidden': 'true',
                        title: MappingManagementNLS.modifyAttrMapping,
                    }
                })/*.inject(modifySpan)*/;
                btnArr.push(modifyButton);
                /*modifyPop = new Popover({
                    target: modifySpan,
                    trigger: "hover",
                    animate: "true",
                    position: "top",
                    body: MappingManagementNLS.modifyAttrMapping,
                    title: ''
                });*/
                //}
                //modifySpan.inject(actionCell);

                //Button group
                // var btnArr = [deleteButton, undoButton, modifyButton];
                var buttonGroup = new ButtonGroup({
                    type: "none",
                    name: "toggle-proposed",
                    id: "toggle-proposed",
                    buttons: btnArr,
                    events: {
                        onClick: function (e, button) {
                            this.dispatchEvent('onButtonClick', button);
                        }
                    }
                }).inject(actionCell);

                return [deleteButton, undoButton, modifyButton, undoPop];
            },


            //remove mapping in attributeMappingList
            removeMappingAttrInModel: function (TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, eltAttrMapping, listOfAttributeMapping, attributeMappingMap, listNewSelect) {
                var index;
                //if the mapping is already in removed state, no action to do
                if (eltAttrMapping.status.indexOf("Removed") === -1) {
                    //if the mapping is New, just remove it from mapping attribute list
                    if (eltAttrMapping.status === "New" || eltAttrMapping.status === "InvalidNew") {
                        index = listOfAttributeMapping.indexOf(eltAttrMapping);
                        if (index != -1)
                            listOfAttributeMapping.splice(index, 1);
                    }
                    else if (eltAttrMapping.status === "Stored" || eltAttrMapping.status === "InvalidStored")
                        eltAttrMapping.status = "RemovedStored";
                    //if the mapping is deployed, put it in "RemoveDeployed" state
                    else
                        eltAttrMapping.status = "RemovedDeployed";

                    //Update attributeMappingMap (to compute list of available attribute in select)
                    UIview.RemoveMappingInAttrMap(VPMTypeRelInfo, MatrixTypeRelInfo, listOfAttributeMapping, eltAttrMapping, attributeMappingMap, listNewSelect);
                }
                //TypeMappingViewUtilities.disableDirectionButtonAccordingMappingRules(TypeMappingCollection,typeMapping, listOfAttributeMapping);
            },

            //remove mapping in attributeMappingList
            resetStoredMapping: function (TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, eltAttrMapping, listOfAttributeMapping, attributeMappingMap, listNewSelect) {
                var index;
                //remove stored mapping from model
                if (eltAttrMapping.status.indexOf("Stored") !== -1) {
                    index = listOfAttributeMapping.indexOf(eltAttrMapping);
                    if (index != -1)
                        listOfAttributeMapping.splice(index, 1);
                }
                // TypeMappingViewUtilities.disableDirectionButtonAccordingMappingRules(TypeMappingCollection,typeMapping,listofAttributesMapping);
                //Update attributeMappingMap (to compute list of available attribute in select)
                UIview.RemoveMappingInAttrMap(VPMTypeRelInfo, MatrixTypeRelInfo, listOfAttributeMapping, eltAttrMapping, attributeMappingMap, listNewSelect);
            },

            //add or revive a mapping in attribute mapping list
            addMappingAttrInModel: function (TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, eltAttrMapping, listOfAttributeMapping, attributeMappingMap, listNewSelect, isInvalidMapping) {
                var index;
                //if status is new, add it to attribute mapping list
                if (eltAttrMapping.status === "New" || eltAttrMapping.status === "InvalidNew") {
                    listOfAttributeMapping.push(eltAttrMapping);
                }
                //if the mapping is stored and has "RemovedStored" state, it is already in mapping attribute list
                //modify its status in Sored of InvalidStored
                else if (eltAttrMapping.status === "RemovedStored") {
                    if (!isInvalidMapping)
                        eltAttrMapping.status = "Stored";
                    else
                        eltAttrMapping.status = "InvalidStored";
                }
                //if the mapping is deployed and has "RemovedDeployed" state, it is already in mapping attribute list
                //modify its status in Deployed
                else
                    if (!isInvalidMapping)
                        eltAttrMapping.status = "Deployed";
                    else
                        eltAttrMapping.status = "InvalidDeployed";
                //Update attributeMappingMap (to compute list of available attribute in select)
                UIview.AddNewMappingInAttrMap(VPMTypeRelInfo, MatrixTypeRelInfo, listOfAttributeMapping, eltAttrMapping, attributeMappingMap, listNewSelect);
                //  TypeMappingViewUtilities.disableDirectionButtonAccordingMappingRules(TypeMappingCollection,typeMapping, listOfAttributeMapping);
            },




            //Add a mapping in attributeMappingMap. This map allows to know for each attributes (VPM and Matrix) with which attribute it is mapped and with which direction
            //This map is useful to compute the list of available attribute in select list and to detect potential conflict to revive mapping
            AddNewMappingInAttrMap: function (VPMTypeRelInfo, MatrixTypeRelInfo, listofAttributesMapping, attributeMapping, attributeMappingMap, listNewSelect) {
                var VPMAttr, MxAttr, mapValue, dirArray, VPMMap, MXMap;

                //Map for VPM attributes
                VPMMap = attributeMappingMap.VPM;
                //Map for Matrix attributes
                MXMap = attributeMappingMap.MX;

                if (attributeMapping !== undefined) {
                    VPMAttr = attributeMapping.VPMAttribute.id;
                    MxAttr = attributeMapping.MatrixAttribute.id;

                    //get the value for VPMAttr
                    mapValue = VPMMap.get(VPMAttr);
                    //If no value is retrieved, populate the map with 3 array: on for both direction, on for VPM to Mx, or for Mx to VPM
                    if (mapValue === undefined) {
                        mapValue = new Map();
                        mapValue.set("BOTH", new Array());
                        mapValue.set("VPM_To_MX", new Array());
                        mapValue.set("MX_To_VPM", new Array());
                        VPMMap.set(VPMAttr, mapValue)
                    }

                    //put MxAttr in the array corresponding to mapping direction
                    dirArray = mapValue.get(attributeMapping.SynchDirection);
                    if (dirArray != undefined) dirArray.push(MxAttr);

                    //get the value for MxAttr
                    mapValue = MXMap.get(MxAttr);
                    //If no value is retrieved, populate the map with 3 array: on for both direction, on for VPM to Mx, or for Mx to VPM
                    if (mapValue === undefined) {
                        mapValue = new Map();
                        mapValue.set("BOTH", new Array());
                        mapValue.set("VPM_To_MX", new Array());
                        mapValue.set("MX_To_VPM", new Array());
                        MXMap.set(MxAttr, mapValue)
                    }

                    //put VPMAttr in the array corresponding to mapping direction
                    dirArray = mapValue.get(attributeMapping.SynchDirection);
                    if (dirArray != undefined)
                        dirArray.push(VPMAttr);
                }
            },


            //Remove a mapping from attributeMappingMap. This map allows to know for each attributes (VPM and Matrix) with which attribute it is mapped and with which direction
            //This map is useful to compute the list of available attribute in select list and to detect potential conflict to revive mapping
            RemoveMappingInAttrMap: function (VPMTypeRelInfo, MatrixTypeRelInfo, listofAttributesMapping, attributeMapping, attributeMappingMap, listNewSelect) {
                var VPMAttr, MxAttr, mapValue, dirArray, VPMMap, MXMap, directionArray, index;

                //Map for VPM attributes
                VPMMap = attributeMappingMap.VPM;
                //Map for Matrix attributes
                MXMap = attributeMappingMap.MX;

                if (attributeMapping !== undefined) {
                    VPMAttr = attributeMapping.VPMAttribute.id;
                    MxAttr = attributeMapping.MatrixAttribute.id;

                    //get the value for VPMAttr
                    mapValue = VPMMap.get(VPMAttr);
                    if (mapValue !== undefined) {
                        //Retrieve array corresponding to mapping direction
                        directionArray = mapValue.get(attributeMapping.SynchDirection);
                        //Search index of MxAttr
                        index = directionArray.indexOf(MxAttr);
                        //Remove MxAttr from the map
                        if (index !== -1)
                            directionArray.splice(index, 1);
                    }
                    //get the value for MxAttr
                    mapValue = MXMap.get(MxAttr);
                    if (mapValue !== undefined) {
                        //Retrieve array corresponding to mapping direction
                        directionArray = mapValue.get(attributeMapping.SynchDirection);
                        //Search index of VPMAttr
                        index = directionArray.indexOf(VPMAttr);
                        //Remove VPMAttr from the map
                        if (index !== -1)
                            directionArray.splice(index, 1);
                    }
                }
            },



            getSelectedTypeRelMappingDirection: function (pSkeleton, typeMapping, isCloudEnv) {
                var selectedDirection = null;
                if (typeMapping.isBaseMapping || isCloudEnv)
                    selectedDirection = typeMapping.SynchDirection;
                else {
                    var TypeIdView = pSkeleton.getActiveIdCard();
                    var idCardView = TypeIdView.container.getElement(".info-section");
                    // var directionTypeMappingButton = idCardView.getElement("#typeMappingDirectionButton");
                    //selectedDirection = directionTypeMappingButton.value;
                    var directionTypeMappingButton = idCardView.getElement("#TypeMappingDirectionButton");
                    var spanDirection = (directionTypeMappingButton.getChildren())[0];
                    selectedDirection = spanDirection.value;
                }
                /*var vpmToMxButton = idCardView.getElement("#VPM_To_MX");
                var MxToVPMButton = idCardView.getElement("#MX_To_VPM");
                if (~(' ' + BothButton.className + ' ').indexOf(' active ')) selectedDirection = "BOTH";
                else if (~(' ' + vpmToMxButton.className + ' ').indexOf(' active ')) selectedDirection = "VPM_To_MX";
                else if (~(' ' + MxToVPMButton.className + ' ').indexOf(' active ')) selectedDirection = "MX_To_VPM";*/
                return selectedDirection;
            },




            //Check if it possible to add a mapping by respecting mapping rules
            //return for each direction, if the mapping is possible or not
            CheckRulesToAddAttrMapping: function (VPMTypeRelInfo, VPMAttrInfo, MxTypeRelInfo, MxAttrInfo, typeRelDirection, VPMObjMappedAttr, MXObjMappedAttr, attrMapping) {
                //Check blocking rules (type attribute, already mapped)
                var directionAvailable = UIview.CheckBlockingRules(VPMTypeRelInfo, VPMAttrInfo, MxTypeRelInfo, MxAttrInfo, VPMObjMappedAttr, MXObjMappedAttr, attrMapping);
                //if no blocking rules has been detected, check coherence rules
                if (directionAvailable.BOTH)
                    directionAvailable = UIview.CheckCoherenceRules(VPMTypeRelInfo, VPMAttrInfo, MxTypeRelInfo, MxAttrInfo, typeRelDirection, VPMObjMappedAttr, MXObjMappedAttr, attrMapping);
                return directionAvailable;
            },

            /*Test the following rules to map two given attributes:
             ***An attribute cannot be used twice as target
             ***An attribute is read only and cannot be used as target
             ***Compatibility range
             *Input:
             **VPMTypeRelInfo: VPM type object
             **VPMAttrInfo: the VPM attribute object  to map
             **MxTypeRelInfo: Matrix type object
             **MxAttrInfo: the Matrix attribute object to map
             **VPMObjMappedAttr: attributes already mapped with VPMAttrInfo
             **MXObjMappedAttr: attributes already mapped with MxAttrInfo
             **attrMapping: mapping to not taking into account to check the rules, can be undefined
             *Return: For each direction :
             **status true/false is returned to know if the mapping is possible for these direction
             **If the status is false, a message is returned to explain the reason
             */
            CheckCoherenceRules: function (VPMTypeRelInfo, VPMAttrInfo, MxTypeRelInfo, MxAttrInfo, typeRelMappingDirection, VPMObjMappedAttr, MXObjMappedAttr, attrMapping) {

                var VPMArrayVPMToMx = new Array(), VPMArrayMxToVPM = new Array(), VPMArrayBoth = new Array(), MXArrayVPMToMx = new Array(), MXArrayMxToVPM = new Array(), MXArrayBoth = new Array(), result, resultRule1, resultRule2, resultRule3, resultRule4, resultRule5, resultRule6, VPMAttrInfo, MxAttrInfo, VPMAttrRange = "", MxAttrRange = "", index;
                result = { VPM_To_MX: true, MX_To_VPM: true, BOTH: true, message: { VPM_To_MX: new Array(), MX_To_VPM: new Array(), BOTH: new Array() } };

                //get the already mapped attributes with VPM Attribute for each direction
                if (VPMObjMappedAttr != undefined) {
                    VPMArrayVPMToMx = VPMObjMappedAttr.get("VPM_To_MX");
                    VPMArrayMxToVPM = VPMObjMappedAttr.get("MX_To_VPM");
                    VPMArrayBoth = VPMObjMappedAttr.get("BOTH");
                }
                //get the already mapped attributes with Matrix Attribute for each direction
                if (MXObjMappedAttr != undefined) {
                    MXArrayVPMToMx = MXObjMappedAttr.get("VPM_To_MX");
                    MXArrayMxToVPM = MXObjMappedAttr.get("MX_To_VPM");
                    MXArrayBoth = MXObjMappedAttr.get("BOTH");
                }

                //if there is a mapping to exclude
                //remove the corresponding attributes from already mapped attributes array
                if (attrMapping !== undefined) {
                    var resultArray;
                    if (attrMapping.SynchDirection === "BOTH") {
                        resultArray = UIview.excludeAttributeForAlreadyMappedArray(VPMArrayBoth, MXArrayBoth, attrMapping);
                        VPMArrayBoth = resultArray[0]; MXArrayBoth = resultArray[1];
                    }

                    if (attrMapping.SynchDirection === "VPM_To_MX") {
                        resultArray = UIview.excludeAttributeForAlreadyMappedArray(VPMArrayVPMToMx, MXArrayVPMToMx, attrMapping);
                        VPMArrayVPMToMx = resultArray[0]; MXArrayVPMToMx = resultArray[1];
                    }

                    if (attrMapping.SynchDirection === "MX_To_VPM") {
                        resultArray = UIview.excludeAttributeForAlreadyMappedArray(VPMArrayMxToVPM, MXArrayMxToVPM, attrMapping);
                        VPMArrayMxToVPM = resultArray[0]; MXArrayMxToVPM = resultArray[1];
                    }

                }

                //Check "cannot be used twice as target" rule
                resultRule1 = UIview.CheckNotUsedTwiceAsTarget(VPMArrayVPMToMx, VPMArrayMxToVPM, VPMArrayBoth, MXArrayVPMToMx, MXArrayMxToVPM, MXArrayBoth);

                //Check range compatibilty rule
                if (VPMAttrInfo != undefined) VPMAttrRange = VPMAttrInfo.range;
                if (MxAttrInfo != undefined) MxAttrRange = MxAttrInfo.range;
                resultRule5 = UIview.CheckIsSameAttrRange(VPMAttrRange, MxAttrRange);

                //check read only attributes rules
                resultRule6 = UIview.CheckIsAuthorizedAsTarget(MxAttrInfo, VPMAttrInfo);

                var isCompatibleVPM_To_MXDirection = (typeRelMappingDirection == "VPM_To_MX" || typeRelMappingDirection == "BOTH") ? true : false;
                var isCompatibleMX_To_VPMDirection = (typeRelMappingDirection == "MX_To_VPM" || typeRelMappingDirection == "BOTH") ? true : false;
                //merge results of previous rules
                result.VPM_To_MX = isCompatibleVPM_To_MXDirection && resultRule1.VPM_To_MX && resultRule5.VPM_To_MX && resultRule6.VPM_To_MX;
                result.MX_To_VPM = isCompatibleMX_To_VPMDirection && resultRule1.MX_To_VPM && resultRule5.MX_To_VPM && resultRule6.MX_To_VPM;
                result.BOTH = isCompatibleMX_To_VPMDirection && isCompatibleVPM_To_MXDirection && resultRule1.BOTH && resultRule5.BOTH && resultRule6.BOTH;

                if (!isCompatibleMX_To_VPMDirection || !isCompatibleVPM_To_MXDirection)
                    result.message.BOTH.push(13);
                else { Array.prototype.push.apply(result.message.BOTH, resultRule1.message.BOTH); Array.prototype.push.apply(result.message.BOTH, resultRule5.message.BOTH); Array.prototype.push.apply(result.message.BOTH, resultRule6.message.BOTH); }

                if (!isCompatibleVPM_To_MXDirection)
                    result.message.VPM_To_MX.push(13);
                else { Array.prototype.push.apply(result.message.VPM_To_MX, resultRule1.message.VPM_To_MX); Array.prototype.push.apply(result.message.VPM_To_MX, resultRule5.message.VPM_To_MX); Array.prototype.push.apply(result.message.VPM_To_MX, resultRule6.message.VPM_To_MX); }


                if (!isCompatibleMX_To_VPMDirection)
                    result.message.MX_To_VPM.push(13);
                else { Array.prototype.push.apply(result.message.MX_To_VPM, resultRule1.message.MX_To_VPM); Array.prototype.push.apply(result.message.MX_To_VPM, resultRule5.message.MX_To_VPM); Array.prototype.push.apply(result.message.MX_To_VPM, resultRule6.message.MX_To_VPM); }

                return result;
            },



            /*Test the following rules to map two given attributes:
             ***attributes must have same type
             ***attributs must not be already mapped
             *Input:
             **VPMTypeRelInfo: VPM type object
             **VPMAttrInfo: the VPM attribute object  to map
             **MxTypeRelInfo: Matrix type object
             **MxAttrInfo: the Matrix attribute object to map
             **VPMObjMappedAttr: attributes already mapped with VPMAttrInfo
             **MXObjMappedAttr: attributes already mapped with MxAttrInfo
             **attrMapping: mapping to not taking into account to check the rules, can be undefined
             *Return: For each direction :
             **status true/false is returned to know if the mapping is possible for these direction
             **If the status is false, a message is returned to explain the reason
             */
            CheckBlockingRules: function (VPMTypeRelInfo, VPMAttrInfo, MxTypeRelInfo, MxAttrInfo, VPMObjMappedAttr, MXObjMappedAttr, attrMapping) {

                var VPMArrayVPMToMx = new Array(), VPMArrayMxToVPM = new Array(), VPMArrayBoth = new Array(), MXArrayVPMToMx = new Array(), MXArrayMxToVPM = new Array(), MXArrayBoth = new Array(), result, resultRule1, resultRule2, resultRule3, resultRule4, resultRule5, resultRule6, VPMAttrInfo, MxAttrInfo, VPMAttrRange = "", MxAttrRange = "", index;
                result = { VPM_To_MX: true, MX_To_VPM: true, BOTH: true, message: { VPM_To_MX: new Array(), MX_To_VPM: new Array(), BOTH: new Array() } };
                //get the already mapped attributes with VPM Attribute for each direction
                if (VPMObjMappedAttr != undefined) {
                    VPMArrayVPMToMx = VPMObjMappedAttr.get("VPM_To_MX");
                    VPMArrayMxToVPM = VPMObjMappedAttr.get("MX_To_VPM");
                    VPMArrayBoth = VPMObjMappedAttr.get("BOTH");
                }
                //get the already mapped attributes with Matrix Attribute for each direction
                if (MXObjMappedAttr != undefined) {
                    MXArrayVPMToMx = MXObjMappedAttr.get("VPM_To_MX");
                    MXArrayMxToVPM = MXObjMappedAttr.get("MX_To_VPM");
                    MXArrayBoth = MXObjMappedAttr.get("BOTH");
                }

                var resultArray;
                //if there is a mapping to exclude
                //remove the corresponding attributes from already mapped attributes array
                if (attrMapping !== undefined) {
                    if (attrMapping.SynchDirection === "BOTH") {
                        resultArray = UIview.excludeAttributeForAlreadyMappedArray(VPMArrayBoth, MXArrayBoth, attrMapping);
                        VPMArrayBoth = resultArray[0]; MXArrayBoth = resultArray[1];
                    }

                    if (attrMapping.SynchDirection === "VPM_To_MX") {
                        resultArray = UIview.excludeAttributeForAlreadyMappedArray(VPMArrayVPMToMx, MXArrayVPMToMx, attrMapping);
                        VPMArrayVPMToMx = resultArray[0]; MXArrayVPMToMx = resultArray[1];
                    }

                    if (attrMapping.SynchDirection === "MX_To_VPM") {
                        resultArray = UIview.excludeAttributeForAlreadyMappedArray(VPMArrayMxToVPM, MXArrayMxToVPM, attrMapping);
                        VPMArrayMxToVPM = resultArray[0]; MXArrayMxToVPM = resultArray[1];
                    }

                }

                //check if attributes has same type
                if (!VPMAttrInfo.isUnknown && !MxAttrInfo.isUnknown)
                    resultRule1 = UIview.CheckIsSameAttrType(VPMAttrInfo, MxAttrInfo);
                else resultRule1 = { VPM_To_MX: true, MX_To_VPM: true, BOTH: true, message: { VPM_To_MX: new Array(), MX_To_VPM: new Array(), BOTH: new Array() } };
                //Check if attributes are not already mapped
                resultRule2 = UIview.CheckIsNotAlreadyMappedWithMxObj(MxAttrInfo, VPMArrayVPMToMx, VPMArrayMxToVPM, VPMArrayBoth);

                //merge rules result
                result.VPM_To_MX = resultRule1.VPM_To_MX && resultRule2.VPM_To_MX;
                result.MX_To_VPM = resultRule1.MX_To_VPM && resultRule2.MX_To_VPM;
                result.BOTH = resultRule1.BOTH && resultRule2.BOTH;

                Array.prototype.push.apply(result.message.BOTH, resultRule1.message.BOTH); Array.prototype.push.apply(result.message.BOTH, resultRule2.message.BOTH);
                Array.prototype.push.apply(result.message.VPM_To_MX, resultRule1.message.VPM_To_MX); Array.prototype.push.apply(result.message.VPM_To_MX, resultRule2.message.VPM_To_MX);
                Array.prototype.push.apply(result.message.MX_To_VPM, resultRule1.message.MX_To_VPM); Array.prototype.push.apply(result.message.MX_To_VPM, resultRule2.message.MX_To_VPM);

                return result;
            },

            excludeAttributeForAlreadyMappedArray: function (VPMAlreadyMappedArray, MatrixAlreadyMappedArray, attributeMappingToExclude) {
                var ModifiedVPMAlreadyMappedArray = new Array(), ModifiedMatrixAlreadyMappedArray = new Array();
                var index = -1;
                index = VPMAlreadyMappedArray.indexOf(attributeMappingToExclude.MatrixAttribute.id);
                if (index !== -1)
                    ModifiedVPMAlreadyMappedArray = VPMAlreadyMappedArray.slice(0, index).concat(VPMAlreadyMappedArray.slice(index + 1, VPMAlreadyMappedArray.length));
                else ModifiedVPMAlreadyMappedArray = VPMAlreadyMappedArray.slice();
                index = MatrixAlreadyMappedArray.indexOf(attributeMappingToExclude.VPMAttribute.id);
                if (index !== -1)
                    ModifiedMatrixAlreadyMappedArray = MatrixAlreadyMappedArray.slice(0, index).concat(MatrixAlreadyMappedArray.slice(index + 1, MatrixAlreadyMappedArray.length));
                else ModifiedMatrixAlreadyMappedArray = MatrixAlreadyMappedArray.slice();
                return [ModifiedVPMAlreadyMappedArray, ModifiedMatrixAlreadyMappedArray];

            },


            //check if two attributes has the same type
            CheckIsSameAttrType: function (VPMAttr, MxAttr) {
                var result = { VPM_To_MX: true, MX_To_VPM: true, BOTH: true, message: { VPM_To_MX: new Array(), MX_To_VPM: new Array(), BOTH: new Array() } }, message = "";

                //VPM enum attribute must be mapped with String attribute
                if (VPMAttr.isenum === true) {
                    if (MxAttr.type !== "String") {
                        result.BOTH = false; result.VPM_To_MX = false; result.MX_To_VPM = false;
                        result.message.BOTH.push(0); result.message.VPM_To_MX.push(0); result.message.MX_To_VPM.push(0);
                    }
                }
                else if (VPMAttr.type !== MxAttr.type) {
                    message = MappingManagementNLS.ErrorNotSameType;
                    result.BOTH = false; result.VPM_To_MX = false; result.MX_To_VPM = false;
                    result.message.BOTH.push(0); result.message.VPM_To_MX.push(0); result.message.MX_To_VPM.push(0);
                }
                return result;
            },

            //Check compatibility range
            CheckIsSameAttrRange: function (VPMAttrRange, MxAttrRange) {
                var result = { VPM_To_MX: true, MX_To_VPM: true, BOTH: true, message: { VPM_To_MX: new Array(), MX_To_VPM: new Array(), BOTH: new Array() } }, message = "", isVPMRangesIncludesMxRange, isMxRangesIncludesVPMRange, cpt, range;

                //if VPM attr has range and no Matrix attr, only VPM to Mx direction is possible
                if (VPMAttrRange.length === 0 && MxAttrRange.length !== 0) {
                    result.VPM_To_MX = false; result.message.VPM_To_MX.push(1);
                    result.BOTH = false; result.message.BOTH.push(1);
                }
                //if Matrix attr has range and no VPM attr, only MX to VPM direction is possible
                else if (VPMAttrRange.length !== 0 && MxAttrRange.length === 0) {
                    result.MX_To_VPM = false; result.message.MX_To_VPM.push(1);
                    result.BOTH = false; result.message.BOTH.push(1);
                }
                //if both attributes have range, check range values compatibility
                else if (VPMAttrRange.length !== 0 && MxAttrRange.length !== 0) {
                    isVPMRangesIncludesMxRange = true;
                    isMxRangesIncludesVPMRange = true;
                    cpt = 0;
                    //check if VPM attributes ranges values are included in Matrix ranges
                    while (cpt < VPMAttrRange.length && isMxRangesIncludesVPMRange) {
                        range = VPMAttrRange[cpt];
                        if (MxAttrRange.indexOf(range) < 0) isMxRangesIncludesVPMRange = false;
                        cpt++;
                    }
                    cpt = 0;
                    //check if Matrix attributes ranges values are included in VPM ranges
                    while (cpt < MxAttrRange.length && isVPMRangesIncludesMxRange) {
                        range = MxAttrRange[cpt];
                        if (VPMAttrRange.indexOf(range) < 0) isVPMRangesIncludesMxRange = false;
                        cpt++;
                    }
                    //if ranges are not equal, at least both direction is not possible
                    if (!isVPMRangesIncludesMxRange || !isMxRangesIncludesVPMRange) {
                        result.BOTH = false;
                        result.message.BOTH.push(1);
                    }
                    //if VPM ranges is included in Matrix ranges, direction MX to VPM is possible
                    if (!isVPMRangesIncludesMxRange) {
                        result.MX_To_VPM = false;
                        result.message.MX_To_VPM.push(1);
                    }
                    //if Matrix ranges is included in VPM ranges, direction VPM to MX is possible
                    if (!isMxRangesIncludesVPMRange) {
                        result.VPM_To_MX = false;
                        result.message.VPM_To_MX.push(1);
                    }

                }

                return result;
            },

            //Check if attributes are not already mapped
            CheckIsNotAlreadyMappedWithMxObj: function (MXObj, VPMArrayVPMToMx, VPMArrayMxToVPM, VPMArrayBoth) {

                var result = { VPM_To_MX: true, MX_To_VPM: true, BOTH: true, message: { VPM_To_MX: new Array(), MX_To_VPM: new Array(), BOTH: new Array() } }, message = "";

                //if attributes are already mapped, matrix attributes must be found in VPMArrayVPMToMx or in VPMArrayMxToVPM or in VPMArrayBoth
                //For Cloud, ignore direction MX to VPM
                if (VPMArrayVPMToMx.indexOf(MXObj.id) !== -1 || (VPMArrayMxToVPM.indexOf(MXObj.id) !== -1 && !this.isCloudEnv) || VPMArrayBoth.indexOf(MXObj.id) !== -1) {
                    message = MappingManagementNLS.ErrorAlreadyMappedTogether;
                    result.BOTH = false; result.VPM_To_MX = false; result.MX_To_VPM = false;
                    result.message.BOTH.push(2); result.message.VPM_To_MX.push(2); result.message.MX_To_VPM.push(2);
                }
                return result;
            },

            //Check if an attribute can be used as target (not read only)
            CheckIsAuthorizedAsTarget: function (MXObjInfo, VPMObjInfo) {

                var result = { VPM_To_MX: true, MX_To_VPM: true, BOTH: true, message: { VPM_To_MX: new Array(), MX_To_VPM: new Array(), BOTH: new Array() } }, message = "", isVPMAuthorized, isPartAuthorized;

                //if VPM attribute is read only, direction both and MX_To_VPM are not possible

                if (VPMObjInfo.isInherited) {
                    message = MappingManagementNLS.ProductIsInheritedAttribute;
                    result.BOTH = false; result.MX_To_VPM = false;;
                    result.message.BOTH.push(14); result.message.MX_To_VPM.push(14);
                }
                else if (VPMObjInfo.isreadonly) {
                    message = MappingManagementNLS.ErrorVPMOnlyUsedAsSource;
                    result.BOTH = false; result.MX_To_VPM = false;;
                    result.message.BOTH.push(3); result.message.MX_To_VPM.push(3);
                }
                //if Matrix attribute is read only, direction both and VPM_To_MX are not possible

                if (MXObjInfo.isInherited) {
                    message = MappingManagementNLS.PartIsInheritedAttribute;
                    result.BOTH = false; result.VPM_To_MX = false;;
                    result.message.BOTH.push(15); result.message.VPM_To_MX.push(15);
                }
                else if (MXObjInfo.isreadonly) {
                    message = MappingManagementNLS.ErrorMxOnlyUsedAsSource;
                    result.BOTH = false; result.VPM_To_MX = false;;
                    result.message.BOTH.push(4); result.message.VPM_To_MX.push(4);
                }
                return result;
            },



            //Check if Part or VPM attribute are already used as target in another mapping
            CheckNotUsedTwiceAsTarget: function (VPMArrayVPMToMx, VPMArrayMxToVPM, VPMArrayBoth, MXArrayVPMToMx, MXArrayMxToVPM, MXArrayBoth) {

                var result = { VPM_To_MX: true, MX_To_VPM: true, BOTH: true, message: { VPM_To_MX: new Array(), MX_To_VPM: new Array(), BOTH: new Array() } }, message = "";

                //if Part or VPM attribute is already used as target in another mapping, both direction is not possible
                if (MXArrayBoth.length !== 0 || VPMArrayBoth.length !== 0 || VPMArrayMxToVPM.length !== 0 || MXArrayVPMToMx.length !== 0) {
                    result.BOTH = false;
                    //if Part attribute is already used as target in another mapping, VPM_To_MX is not possible
                    if (MXArrayBoth.length !== 0 || MXArrayVPMToMx.length !== 0) {
                        message = "";
                        message = message + MappingManagementNLS.ErrorPartAlreadyUsedAsTarget;
                        result.BOTH = false; result.VPM_To_MX = false;;
                        result.message.BOTH.push(5);
                        result.message.VPM_To_MX.push(5);
                    }
                    //if Product attribute is already used as target in another mapping, MX_To_VPM is not possible
                    if (VPMArrayBoth.length !== 0 || VPMArrayMxToVPM.length !== 0) {
                        message = "";
                        message = message + MappingManagementNLS.ErrorProductAlreadyUsedAsTarget;
                        result.BOTH = false; result.MX_To_VPM = false;;
                        result.message.BOTH.push(6);
                        result.message.MX_To_VPM.push(6);
                    }
                }
                return result;
            },



            //Fill Part Select with Part attributes mappable (at least one direction is possible) with selected VPM attribute
            enableMatrixAttrAccordingRules: function (VPMTypeRelInfo, attrsSelectVPM, MxTypeRelInfo, attrsSelectMatrix, typeRelDirection, attrMappingMap, directionAvailableMap, attrMapping) {

                var selectedVPMAttr, selectedVPMAttrType, selectedMxAttrType, selectedVPMAttrOpt, listOfMappedMXattr, listMatrixOptions, cptOptions, listOfMappedVPMattr, directionAvailable, matrixOption, position, listOfEnableOption = new Array(), listOfDisableOption = new Array(), group, VPMAttrInfo, MxAttrInfo;

                //Get the selected VPM attributes
                selectedVPMAttrOpt = attrsSelectVPM.getSelection(false);

                //Get the selected Matrix attribute
                var matrixSelectValue = attrsSelectMatrix.getValue()[0];

                if (selectedVPMAttrOpt.length != 0) {
                    //Get VPM attribute value
                    selectedVPMAttr = selectedVPMAttrOpt[0].value;
                    //retrieve VPM attribute object
                    VPMAttrInfo = UIview.retrieveAttributeInfo(VPMTypeRelInfo, selectedVPMAttr);
                    //clear and remove content of Part select
                    attrsSelectMatrix.clear(true);
                    attrsSelectMatrix.remove();

                    //get the list of attributes already mapped with VPM attribute
                    listOfMappedMXattr = (attrMappingMap.VPM).get(selectedVPMAttr);

                    //For each Part attribute, check if it can be mapped with VPM attributes and add it in the select if it is the case
                    listMatrixOptions = attrsSelectMatrix.getOptions(false);
                    for (cptOptions = 0; cptOptions < MxTypeRelInfo.attributeInfo.length; cptOptions++) {

                        MxAttrInfo = MxTypeRelInfo.attributeInfo[cptOptions];
                        //get the list of attributes already mapped with MxAttrInfo
                        listOfMappedVPMattr = (attrMappingMap.MX).get(MxAttrInfo.id);
                        //Check mapping rules beetwen MxAttrInfo and VPM attribute
                        directionAvailable = UIview.CheckRulesToAddAttrMapping(VPMTypeRelInfo, VPMAttrInfo, MxTypeRelInfo, MxAttrInfo, typeRelDirection, listOfMappedMXattr, listOfMappedVPMattr, attrMapping);

                        var option = { label: MxAttrInfo.name + " (" + MxAttrInfo.type + ")", value: MxAttrInfo.id };
                        //If at least one direction is possible, add MxAttrInfo to the select
                        if (directionAvailable.VPM_To_MX || (directionAvailable.MX_To_VPM && !this.isCloudEnv) || directionAvailable.BOTH) {
                            attrsSelectMatrix.add(option);
                            if (matrixSelectValue === MxAttrInfo.id) {
                                attrsSelectMatrix.select(option, true, true, false);
                                attrsSelectMatrix.enable(option);

                            }
                        }

                    }

                }
            },



            //Add the input list of messages in the given popover
            displayAddMappingWarningMessage: function (/*messageDiv,*/ popoverInfoMapping, messages) {
                var messageList, iconInfo, cpt = 0;
                // if (messageDiv != undefined) {
                // iconInfo = messageDiv.getElement(".InfoAddMapping");
                if (messages.length !== 0) {
                    //iconInfo.show();
                    messageList = UWA.createElement('ul', { 'class': 'ListAddMappingMessage' });

                    for (cpt = 0; cpt < messages.length; cpt++) {
                        UWA.createElement('li', {
                            'text': UIview.mappableAttributeReaseon[messages[cpt]],
                        }).inject(messageList);
                    }
                    popoverInfoMapping.setBody(messageList);
                    /* }
                     else {
                         popoverInfoMapping.setBody("");
                         iconInfo.hide();
                     }*/
                }
            },


            ResetModifyStatus: function (VPMTypeRelInfo, MatrixTypeRelInfo, typeRelMapping, attributeMapping, iCellAction, icellStatus) {
                /*var iconright = iCellAction.getElement(".fonticon-expand-right");
                var iconleft = iCellAction.getElement(".fonticon-expand-left");
                var iconboth = iCellAction.getElement(".fonticon-arrow-combo-horizontal");
                if (iconright !== null && iconright !== undefined) iconright.remove();
                if (iconleft !== null && iconleft !== undefined) iconleft.remove();
                if (iconboth !== null && iconboth !== undefined) iconboth.remove();*/
                var that = this;
                var listOfMappedMXattr = (this.attributeMappingMap.VPM).get(attributeMapping.VPMAttribute.id);
                var listOfMappedVPMattr = (that.attributeMappingMap.MX).get(attributeMapping.MatrixAttribute.id);
                var resultInvalidMapping = UIview.isInvalidMapping(VPMTypeRelInfo, MatrixTypeRelInfo, typeRelMapping.SynchDirection, attributeMapping, listOfMappedMXattr, listOfMappedVPMattr);

                if (resultInvalidMapping.isInvalid) {
                    if (attributeMapping.status.contains("Stored"))
                        attributeMapping.status = "InvalidStored";
                    else attributeMapping.status = "InvalidDeployed";

                }

                var color = "green";
                var icon = "fonticon-check";
                var status = "Deployed";
                var tooltip = MappingManagementNLS.Deployed;

                if (attributeMapping.status.contains('Stored')) {

                    icon = "fonticon-cog";
                    var tooltip = MappingManagementNLS.Deployed;

                    if (resultInvalidMapping.isInvalid) {
                        color = 'red';
                        status = "InvalidStored";
                    }
                    else {
                        color = 'orange';
                        status = "Stored"
                    }
                }
                else if (attributeMapping.status.contains('Deployed')) {
                    icon = "fonticon-check";
                    var tooltip = MappingManagementNLS.Deployed;

                    if (resultInvalidMapping.isInvalid) {
                        color = 'red';
                        status = "InvalidDeployed";
                    }
                    else {
                        color = 'green';
                        status = "Deployed"
                    }
                }


                attributeMapping.status = status;
                UIview.modifyDeployCellSatus(icellStatus, status, tooltip, icon, color);

                if (resultInvalidMapping.isInvalid) {
                    var infoInvalidMappingSpan = UWA.createElement('span', {
                        'class': 'InfoInvalidMapping fonticon fonticon-info'
                    }).inject(icellStatus);

                    var popoverInfoInvalidMapping = new Popover({
                        target: infoInvalidMappingSpan,
                        trigger: "hover",
                        animate: "true",
                        position: 'left',
                        body: resultInvalidMapping.errorMessage,
                    });

                    infoInvalidMappingSpan.setStyle("margin-left", '7px');

                    //Manage impacted mapping

                }

                var buttons = iCellAction.getElements('button');
                buttons[0].show();
                buttons[1].hide();
                buttons[2].show();
            },


            setAttrLineAsInvalid: function (attributeMapping, icellStatus) {
                var color = "red";
                var icon = "fonticon-check";
                var tooltip = MappingManagementNLS.Deployed;

                if (attributeMapping.Status === "Stored") {
                    icon = "fonticon-cog";
                    attributeMapping.status = "InvalidStored";
                }
                else attributeMapping.status = "InvalidDeployed";
                //that.listInvalidMultipeTargetMapping;
                UIview.modifyDeployCellSatus(icellStatus, status, tooltip, icon, color);
                /*var buttons = iCellAction.getElements('button');
                buttons[0].show();
                buttons[1].hide();
                buttons[2].show();*/
            },


            //modify direction in UI and in model
            modifyMappingDirection: function (TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, direction, attributeMapping, listofAttributesMapping, selectVPM, selectMatrix) {
                //UI modification
                //  if (modifyDirectionButton!==undefined)
                // UIview.setButtonDirection(direction, modifyDirectionButton);

                //Model modification
                UIview.RemoveMappingInAttrMap(VPMTypeRelInfo, MatrixTypeRelInfo, listofAttributesMapping, attributeMapping, this.attributeMappingMap, this.listNewSelect);
                attributeMapping.SynchDirection = direction;
                //Add only if mapping to modify is not set as removed
                if (attributeMapping.status.indexOf("Removed") === -1)
                    UIview.AddNewMappingInAttrMap(VPMTypeRelInfo, MatrixTypeRelInfo, listofAttributesMapping, attributeMapping, this.attributeMappingMap, this.listNewSelect);

                //Update attributeMappingMap
                var selectedTypeMappingDirection = UIview.getSelectedTypeRelMappingDirection(this.pSkeleton, typeMapping, this.isCloudEnv);
                UIview.UpdatePartComboAttributeList(VPMTypeRelInfo, MatrixTypeRelInfo, listofAttributesMapping, selectedTypeMappingDirection, this.attributeMappingMap, this.listNewSelect, selectVPM, selectMatrix);





                //enable/disable type mapping direction button according to attribute mapping directions
                //  TypeMappingViewUtilities.disableDirectionButtonAccordingMappingRules(TypeMappingCollection,typeMapping, listofAttributesMapping);

            },


            //launch not mappable attribute panel => show attributes that cannot be mapped with selected VPM attributes and why they cannot be mapped
            ShowNotMappableAttribute: function (typeMapping, selectedVPMAttribute, MatrixAttributes, VPMTypeRelInfo, MxTypeRelInfo, attrMapping) {

                var iconInfoMessageBOTH, iconInfoMessageVPMENG, iconInfoMessageENGVPM, divMessageBOTH,
                    divMessageVPMENG, divMessageENGVPM, popoverInfoMappingBOTH, popoverInfoMappingVPMENG, popoverInfoMappingENGVPM,
                    OKBtn, CancelBtn, modalbodydiv, modalbodyTable, modaltbody, lineModal, iCell, iCell1, toggleBoth, toggleVPM, toggleENG, changeDirectionModal, modifyDirectionTitle, that = this;

                modifyDirectionTitle = UWA.createElement('h4', {
                    text: MappingManagementNLS.Incompatibleattributes,
                });

                modalbodydiv = UWA.createElement('div', {
                    'class': 'PartProductAddMappingDiv',
                })

                //Map with all not mappable reasons as key and the attributes matching with these reasons as values
                var mapNotMappableReason = new Map();
                mapNotMappableReason.set("DifferentType", new Array());
                mapNotMappableReason.set("AlreadyMapped", new Array());
                mapNotMappableReason.set("RangeError", new Array());
                mapNotMappableReason.set("PartNotEditable", new Array());
                mapNotMappableReason.set("PartUsedAsTarget", new Array());
                mapNotMappableReason.set("PartUsedAsTargetAndRangeError", new Array());
                mapNotMappableReason.set("PartNotEditableAndRangeError", new Array());

                var isVPMIsUsedAsTarget = false;
                var isVPMNotEditable = false;
                var listOfMappedMXattr = (this.attributeMappingMap.VPM).get(selectedVPMAttribute);
                var VPMAttrInfo = UIview.retrieveAttributeInfo(VPMTypeRelInfo, selectedVPMAttribute);

                var i = 0;
                var typeRelDirection = UIview.getSelectedTypeRelMappingDirection(that.pSkeleton, typeMapping, that.isCloudEnv);
                for (i = 0; i < MatrixAttributes.length; i++) {
                    var listOfMappedVPMattr = (this.attributeMappingMap.MX).get(MatrixAttributes[i].id);
                    //Get direction available and reason for mapping beetwen selected VPM attribute and MatrixAttributes[i]
                    var directionAvailable = UIview.CheckRulesToAddAttrMapping(VPMTypeRelInfo, VPMAttrInfo, MxTypeRelInfo, MatrixAttributes[i], typeRelDirection, listOfMappedMXattr, listOfMappedVPMattr, attrMapping);

                    var arrayToPopulate;
                    //if no direction is available, put Matrix attribute in "not mappable" attribute panel
                    //For Cloud, put Matrix is "not mappable attribute" id direction VPM_To_MX is not possible
                    if ((!directionAvailable.BOTH && !directionAvailable.VPM_To_MX && !directionAvailable.MX_To_VPM) || (this.isCloudEnv && !directionAvailable.VPM_To_MX)) {
                        //Put all not mappable reasons in NotMappableReason array
                        var NotMappableReason = new Array();
                        var j = 0;
                        for (j = 0; j < directionAvailable.message.BOTH.length; j++) {
                            NotMappableReason.push(directionAvailable.message.BOTH[j]);
                        }
                        for (j = 0; j < directionAvailable.message.VPM_To_MX.length; j++) {
                            if (NotMappableReason.indexOf(directionAvailable.message.VPM_To_MX[j]) === -1)
                                NotMappableReason.push(directionAvailable.message.VPM_To_MX[j]);
                        }
                        for (j = 0; j < directionAvailable.message.MX_To_VPM.length; j++) {
                            if (NotMappableReason.indexOf(directionAvailable.message.MX_To_VPM[j]) === -1)
                                NotMappableReason.push(directionAvailable.message.MX_To_VPM[j]);
                        }



                        //Attributes cannot be mapped for only on reason
                        if (NotMappableReason.length === 1 && NotMappableReason[0] !== 5 && NotMappableReason[0] !== 4) {
                            //the attribute have different type (DifferentType in the map)
                            if (NotMappableReason[0] === 0) {
                                arrayToPopulate = mapNotMappableReason.get("DifferentType");
                                arrayToPopulate.push(MatrixAttributes[i].name + " (" + MatrixAttributes[i].type + ")");
                            }
                            //the attributes have range incompatibily (RangeError key in the map)
                            else if (NotMappableReason[0] === 1) {
                                arrayToPopulate = mapNotMappableReason.get("RangeError");
                                arrayToPopulate.push(MatrixAttributes[i].name);
                            }
                            //the attributes are already mapped (AlreadyMapped key in the map)
                            else if (NotMappableReason[0] === 2) {
                                arrayToPopulate = mapNotMappableReason.get("AlreadyMapped");
                                arrayToPopulate.push(MatrixAttributes[i].name);
                            }
                        }
                        //Attributes cannot be mapped for many reasons
                        else {
                            //For Cloud, consider that the VPM attribute is not availabe as target (as only direction VPM to BOM is availabe)
                            if (this.isCloudEnv)
                                NotMappableReason.push(3);
                            //VPM attribute is read only or already used as target
                            if (!isVPMIsUsedAsTarget && !isVPMNotEditable) {
                                if (NotMappableReason.indexOf(3) !== -1 || NotMappableReason.indexOf(14) !== -1) isVPMNotEditable = true;
                                else if (NotMappableReason.indexOf(6) !== -1) isVPMIsUsedAsTarget = true;
                            }
                            //range incompatibility exists
                            if (NotMappableReason.indexOf(1) !== -1) {
                                //and Part attribute is read_only
                                if (NotMappableReason.indexOf(4) !== -1 || NotMappableReason.indexOf(15) !== -1) {
                                    arrayToPopulate = mapNotMappableReason.get("PartNotEditableAndRangeError");
                                    arrayToPopulate.push(MatrixAttributes[i].name);
                                }
                                //and Part attribute is already used as target
                                else if (NotMappableReason.indexOf(5) !== -1) {
                                    arrayToPopulate = mapNotMappableReason.get("PartUsedAsTargetAndRangeError");
                                    arrayToPopulate.push(MatrixAttributes[i].name);
                                }
                                else {
                                    arrayToPopulate = mapNotMappableReason.get("RangeError");
                                    arrayToPopulate.push(MatrixAttributes[i].name);
                                }

                            }
                            //Part is read-only
                            else if (NotMappableReason.indexOf(4) !== -1 || NotMappableReason.indexOf(15) !== -1) {
                                arrayToPopulate = mapNotMappableReason.get("PartNotEditable");
                                arrayToPopulate.push(MatrixAttributes[i].name);
                            }
                            //part is alreday used as target
                            else if (NotMappableReason.indexOf(5) !== -1) {
                                arrayToPopulate = mapNotMappableReason.get("PartUsedAsTarget");
                                arrayToPopulate.push(MatrixAttributes[i].name);
                            }
                        }
                    }
                }



                var resultDiv = UWA.createElement('div', { 'class': 'result' }).inject(modalbodydiv);
                ///create accordion and fill it with different mapping reasons and their associated attribute
                var accordionNotMappable = ParametersLayoutViewUtilities.createFamilyUIKITAccordion(resultDiv);

                var cpt = 0;

                //For Not same type reason
                var typeIncompatibilytattributes = mapNotMappableReason.get("DifferentType");
                var listTypeIncompatibilytattributes = UWA.createElement('ul', { 'class': 'listNotMappableAttribute' });
                for (cpt = 0; cpt < typeIncompatibilytattributes.length; cpt++) {
                    UWA.createElement('li', {
                        'text': typeIncompatibilytattributes[cpt],
                    }).inject(listTypeIncompatibilytattributes);
                }


                accordionNotMappable.addItem({
                    title: MappingManagementNLS.TypeincompatibilityReason,
                    content: listTypeIncompatibilytattributes,
                    selected: false,
                    name: "TypeIncompatibility",
                });

                //For already map reason
                var alreadyMapped = mapNotMappableReason.get("AlreadyMapped");
                if (alreadyMapped.length !== 0) {
                    var listAlreadyMapped = UWA.createElement('ul', { 'class': 'listNotMappableAttribute' });
                    for (cpt = 0; cpt < alreadyMapped.length; cpt++) {
                        UWA.createElement('li', {
                            'text': alreadyMapped[cpt],
                        }).inject(listAlreadyMapped);
                    }


                    accordionNotMappable.addItem({
                        title: MappingManagementNLS.AlreadyMappedReason,
                        content: listAlreadyMapped,
                        selected: false,
                        name: "AlreadyMapped",
                    });
                }

                //For other reasons
                var othersReasonDiv = UWA.createElement('div', { 'class': 'others' });
                //Display if Product attribute is read-only or alredy used as target
                var VPMMessage = "";
                if (this.isCloudEnv) VPMMessage = "Cloud Environment: Only direction Product to Part is available. Part attributes not available as target cannot be used"
                else if (isVPMIsUsedAsTarget) VPMMessage = MappingManagementNLS.PrdUsedAsTargetReason
                else if (isVPMNotEditable) VPMMessage = MappingManagementNLS.PrdReadOnlyReason
                UWA.createElement('p', {
                    text: VPMMessage,
                    'class': 'font-3dsbold'// font-3dsbold
                }).inject(othersReasonDiv);


                //Create sub-accordions for others reason
                var accordionOthers = new Accordion({
                    className: 'accordionOthers',
                    exclusive: false,
                    items: []
                }).inject(othersReasonDiv);

                //sub-accordions dor Part read-only and range error
                var RangeAndNotEditableAttribute = mapNotMappableReason.get("PartNotEditableAndRangeError");
                if (RangeAndNotEditableAttribute.length !== 0) {
                    var listRangeAndNotEditableAttribute = UWA.createElement('ul', { 'class': 'listNotMappableAttribute' });
                    for (cpt = 0; cpt < RangeAndNotEditableAttribute.length; cpt++) {
                        UWA.createElement('li', {
                            'text': RangeAndNotEditableAttribute[cpt],
                        }).inject(listRangeAndNotEditableAttribute);
                    }

                    accordionOthers.addItem({
                        title: MappingManagementNLS.RangeIncompatibilyAndPrtReadOnlyReason,
                        content: listRangeAndNotEditableAttribute,
                        selected: false,
                        name: "PartNotEditableAndRangeError",
                    });
                }

                //sub-accordions for Part already used as target and range error
                var RangeAndAlreadyUsedAsTargetAttribute = mapNotMappableReason.get("PartUsedAsTargetAndRangeError");
                if (RangeAndAlreadyUsedAsTargetAttribute.length !== 0) {
                    var listRangeAndAlreadyUsedAsTargetAttribute = UWA.createElement('ul', { 'class': 'listNotMappableAttribute' });
                    for (cpt = 0; cpt < RangeAndAlreadyUsedAsTargetAttribute.length; cpt++) {
                        UWA.createElement('li', {
                            'text': RangeAndAlreadyUsedAsTargetAttribute[cpt],
                        }).inject(listRangeAndAlreadyUsedAsTargetAttribute);
                    }

                    accordionOthers.addItem({
                        title: MappingManagementNLS.RangeIncompatibilyAndPrtAlreadyUsedReason,
                        content: listRangeAndAlreadyUsedAsTargetAttribute,
                        selected: false,
                        name: "PartUsedAsTargetAndRangeError",
                    });
                }

                //sub-accordions for Part read-only
                var NotEditableAttribute = mapNotMappableReason.get("PartNotEditable");
                if (NotEditableAttribute.length !== 0) {
                    var listNotEditableAttribute = UWA.createElement('ul', { 'class': 'listNotMappableAttribute' });
                    for (cpt = 0; cpt < NotEditableAttribute.length; cpt++) {
                        UWA.createElement('li', {
                            'text': NotEditableAttribute[cpt],
                        }).inject(listNotEditableAttribute);
                    }

                    accordionOthers.addItem({
                        title: MappingManagementNLS.PrtReadOnlyReason,
                        content: listNotEditableAttribute,
                        selected: false,
                        name: "PartNotEditable",
                    });

                }

                //sub-accordions for Part already used as target
                var TargetAttribute = mapNotMappableReason.get("PartUsedAsTarget");
                if (TargetAttribute.length !== 0) {
                    var listTargetAttribute = UWA.createElement('ul', { 'class': 'listNotMappableAttribute' });
                    for (cpt = 0; cpt < TargetAttribute.length; cpt++) {
                        UWA.createElement('li', {
                            'text': TargetAttribute[cpt],
                        }).inject(listTargetAttribute);
                    }
                    accordionOthers.addItem({
                        title: MappingManagementNLS.PrtUsedAsTargetReason,
                        content: listTargetAttribute,
                        selected: false,
                        name: "PartUsedAsTarget",
                    });

                }

                //sub-accordion for range error
                var rangeErrorAttribute = mapNotMappableReason.get("RangeError");
                if (rangeErrorAttribute.length !== 0) {
                    var listRangeErrorAttribute = UWA.createElement('ul', { 'class': 'listNotMappableAttribute' });
                    for (cpt = 0; cpt < rangeErrorAttribute.length; cpt++) {
                        UWA.createElement('li', {
                            'text': rangeErrorAttribute[cpt],
                        }).inject(listRangeErrorAttribute);
                    }

                    accordionOthers.addItem({
                        title: MappingManagementNLS.RangeIncompatibilyReason,
                        content: listRangeErrorAttribute,
                        selected: false,
                        name: "RangeError",
                    });

                }

                if (accordionOthers.items.length !== 0)
                    accordionNotMappable.addItem({
                        title: MappingManagementNLS.RulesIncompatibilityReason,
                        content: othersReasonDiv,
                        selected: false,
                        name: "others",
                    });


                //OKBtn.disable();

                CancelBtn = new Button({
                    value: MappingManagementNLS.Cancel,
                    id: 'modalCancelButton',
                    className: 'btn default'
                });

                var container = that.pSkeleton.getActiveIdCard().container
                changeDirectionModal = new Modal({
                    className: 'add-mapping-modal',
                    closable: true,
                    header: modifyDirectionTitle,
                    body: modalbodydiv,
                    footer: [OKBtn, CancelBtn],
                    renderTo: container
                });

                CancelBtn.addEvent("onClick", function (e) {
                    UWA.log(e);//that.onCancelCalled();
                    changeDirectionModal.hide();
                });


                //changeDirectionModal.inject(this.contentDiv);
                changeDirectionModal.show();
                return changeDirectionModal;

            },


            //Build mapping to send at Apply
            BuildMappingToSend: function (typeRelMapping, attrMappingPartProduct) {
                var isInvalidMapping = false;
                var mappingToSend = new Array();
                var i = 0;

                for (i = 0; i < attrMappingPartProduct.length; i++) {
                    //exclude remove mapping (mapping find in server and not find in tool will be automatically deleted)
                    if (attrMappingPartProduct[i].status.indexOf("Removed") === -1) {
                        //Check if mapping to send has no invalid mapping
                        if (attrMappingPartProduct[i].status === "InvalidStored" || attrMappingPartProduct[i].status === "InvalidNew" || attrMappingPartProduct[i].status === "InvalidDeployed") isInvalidMapping = true;
                        else
                            mappingToSend.push(attrMappingPartProduct[i]);
                    }
                }
                return { isInvalidMapping: isInvalidMapping, mappingToSend: mappingToSend }
            },




            //Refresh UI after applying mapping in database
            onApplySuccessForAttributes: function (typeMapping, listOfAttributes, attrTable, attrTableNew) {
                var item, attrTable, nbofLines, cptAttr, attrLines, cellAttr, mappingEltAttr, imgSpan, listOfAttributes, attrLineToRemove = new Array(), attrLineInNewTable = new Array(), attrLinesToSwitch = new Array();

                //listOfAttributes = mappingElt.AttributeMapping;
                if (attrTable !== undefined) {
                    nbofLines = attrTable.children.length;
                    //for each attribute line in UI
                    //treat first table above "+" button => new mapping in this table are linked to modify action
                    for (cptAttr = 1; cptAttr < nbofLines; cptAttr++) {
                        attrLines = attrTable.children[cptAttr];
                        cellAttr = attrLines.cells[UIview.cellsAttrIndex.deployFlag];
                        mappingEltAttr = UIview.retrieveMappingAttrEntryFromAttrLine(attrLines, listOfAttributes);
                        //if the status was new, mapping is now deployed in database and cannot be modified directly => remove select and button to edit the mapping
                        if (cellAttr.value === "New") {
                            //set the line as not editable
                            if (mappingEltAttr != undefined)
                                UIview.setLineAsNoEditable(attrLines, typeMapping, mappingEltAttr);
                            else //New lines with no both attributes defined
                                attrLineToRemove.push(attrLines);
                        }

                        //if the status was new or stored, mapping is now deployed in database => mapping status icon must be set to deployed
                        if (cellAttr.value === "New" || cellAttr.value === "Stored" || cellAttr.value === "Stored" || cellAttr.value.indexOf("Modified") !== -1) {
                            if (mappingEltAttr != undefined) {

                                if (cellAttr.value.indexOf("Modified") !== -1) {
                                    var iCellAction = attrLines.cells[UIview.cellsAttrIndex.action];
                                    var iconright = iCellAction.getElement(".fonticon-expand-right");
                                    var iconleft = iCellAction.getElement(".fonticon-expand-left");
                                    var iconboth = iCellAction.getElement(".fonticon-arrow-combo-horizontal");
                                    if (iconright !== null && iconright !== undefined) iconright.remove();
                                    if (iconleft !== null && iconleft !== undefined) iconleft.remove();
                                    if (iconboth !== null && iconboth !== undefined) iconboth.remove();
                                    var buttons = iCellAction.getElements('button');
                                    buttons[0].show();
                                    buttons[1].hide();
                                    buttons[2].show();
                                }
                                mappingEltAttr.status = "Deployed";
                                /**
                                 * IR : IR-734449-3DEXPERIENCER2020x
                                 * Description : When modifying the direction of a mapping and applying it, the concerned mapping is visible as deployed.
                                 *								But if we change the direction again using the old value (which isn't the DB value anymore), the mapping
                                 *								isn't seen as 'modified'.
                                 * AMN14 : The stored value corresponding to the mapping direction in DB should always be the same as the one displayed
                                 * 					(as the apply operation succeed).
                                 */
                                mappingEltAttr.SynchDirectionBase = undefined;

                                UIview.modifyDeployCellSatus(cellAttr, "Deployed", MappingManagementNLS.Deployed, 'fonticon-check', 'green');

                            }
                        }

                        //if the status was "To removed", mapping is now removed from the database => mapping line must be remove in UI
                        else if (cellAttr.value.indexOf("Removed") !== -1) {
                            attrLineToRemove.push(attrLines);
                            var index = listOfAttributes.indexOf(mappingEltAttr);
                            if (index != -1)
                                listOfAttributes.splice(index, 1);
                        }


                    }

                    attrLineToRemove.forEach(function (attrMapping) {
                        attrMapping.remove();
                    });
                }

                //treat table under "+" button, only new mapping
                //As new mapping are added under "+" button, they must be go back up  above "+" button once they are deployed
                if (attrTableNew !== undefined) {
                    for (cptAttr = 0; cptAttr < attrTableNew.children.length; cptAttr++) {
                        attrLines = attrTableNew.children[cptAttr];
                        cellAttr = attrLines.cells[UIview.cellsAttrIndex.deployFlag];
                        mappingEltAttr = UIview.retrieveMappingAttrEntryFromAttrLine(attrLines, listOfAttributes);
                        if (mappingEltAttr != undefined) {
                            //set the line as not editable
                            UIview.setLineAsNoEditable(attrLines, typeMapping, mappingEltAttr);
                            //set status to deployed
                            mappingEltAttr.status = "Deployed";
                            UIview.modifyDeployCellSatus(cellAttr, "Deployed", MappingManagementNLS.Deployed, 'fonticon-check', 'green');

                            //Attribute line must be put in table above "+" button
                            attrLinesToSwitch.push(attrLines);
                        }
                        //if the new is not a complete mapping (VPM attribute or Part attribute has not been defined),just remove the line
                        else
                            attrLineInNewTable.push(attrLines);
                    }

                    attrLineInNewTable.forEach(function (attrMapping) {
                        attrMapping.remove();
                    });

                    //Switch new line in deployed table (above "+" button)
                    if (attrTable !== undefined)
                        attrLinesToSwitch.forEach(function (attrMapping) {
                            attrMapping.inject(attrTable);
                        });
                }
            },

            setLineAsNoEditable: function (attrLine, mappingElt, mappingEltAttr) {
                var cellVPMAttr = attrLine.cells[UIview.cellsAttrIndex.VPMAttr];
                cellVPMAttr.empty();
                UWA.createElement('p', {
                    text: mappingEltAttr.VPMAttribute.name,
                    value: mappingEltAttr.VPMAttribute.id,
                }).inject(cellVPMAttr);
                cellVPMAttr.value = mappingEltAttr.VPMAttribute.id;

                var cellMatrixAttr = attrLine.cells[UIview.cellsAttrIndex.MatrixAttr];
                cellMatrixAttr.empty();
                UWA.createElement('p', {
                    text: mappingEltAttr.MatrixAttribute.name,
                    value: mappingEltAttr.MatrixAttribute.id,
                }).inject(cellMatrixAttr);
                cellMatrixAttr.value = mappingEltAttr.MatrixAttribute.id;

                //show modify action button
                var cellaction = attrLine.cells[UIview.cellsAttrIndex.action];
                var buttons = cellaction.getElements('button');
                buttons[0].show();
                buttons[1].hide();
                buttons[2].show();

                var cellInfo = attrLine.cells[UIview.cellsAttrIndex.info];
                var buttonsInfo = cellInfo.getElements('button');
                if (buttonsInfo !== undefined && buttonsInfo !== null && buttonsInfo.length > 0)
                    buttonsInfo[0].hide();
            },


            //Refresh UI after doing reset
            resetForAttributes: function (TypeMappingCollection, typeRelMapping, listOfAttributes, attrTable, attrTableNew) {
                var item, attrTable, nbofLines, cptAttr, attrLines, cellAttr, mappingEltAttr, listOfAttributes, attrLinesToRemove = new Array(), vpmAttr, partAttr, VPMTypeRelInfo, MatrixTypeRelInfo, that = this;

                if (typeRelMapping != undefined) {
                    // listOfAttributes = mappingElt.AttributeMapping;
                    VPMTypeRelInfo = this.listOfCustoVPMType.get(typeRelMapping.vpmObject.id);
                    MatrixTypeRelInfo = this.listOfCustoPartType.get(typeRelMapping.mxObject.id);

                    if (attrTable !== undefined) {
                        nbofLines = attrTable.children.length;
                        //deployed table (table above "+" button)
                        for (cptAttr = 1; cptAttr < nbofLines; cptAttr++) {
                            attrLines = attrTable.children[cptAttr];
                            cellAttr = attrLines.cells[UIview.cellsAttrIndex.deployFlag];
                            mappingEltAttr = UIview.retrieveMappingAttrEntryFromAttrLine(attrLines, listOfAttributes);

                            if (mappingEltAttr === undefined)
                                attrLinesToRemove.push(attrLines);

                            //if mapping is New or Stored, remove it
                            else if (mappingEltAttr.status === "New" || mappingEltAttr.status === "InvalidNew" || mappingEltAttr.status.indexOf("Stored") !== -1) {
                                attrLinesToRemove.push(attrLines);
                                if (mappingEltAttr != undefined) {

                                    if (mappingEltAttr.status.indexOf("New") != -1)
                                        UIview.removeMappingAttrInModel(TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, typeRelMapping, mappingEltAttr, listOfAttributes, this.attributeMappingMap, this.listNewSelect);
                                    else if (mappingEltAttr.status.indexOf("Stored") !== -1)
                                        UIview.resetStoredMapping(TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, typeRelMapping, mappingEltAttr, listOfAttributes, this.attributeMappingMap, this.listNewSelect);

                                }
                            }
                            //if mapping is revive, restore it
                            else if (mappingEltAttr.status.indexOf("Removed") !== -1) {
                                if (mappingEltAttr != undefined) {
                                    var VPMTypeRelInfo = this.listOfCustoVPMType.get(typeRelMapping.vpmObject.id);
                                    var MatrixTypeRelInfo = this.listOfCustoPartType.get(typeRelMapping.mxObject.id);
                                    var listOfMappedMXattr = (this.attributeMappingMap.VPM).get(mappingEltAttr.VPMAttribute.id);
                                    var listOfMappedVPMattr = (this.attributeMappingMap.MX).get(mappingEltAttr.MatrixAttribute.id);
                                    var resultInvalidStored = UIview.isInvalidMapping(VPMTypeRelInfo, MatrixTypeRelInfo, typeRelMapping.SynchDirection, mappingEltAttr, listOfMappedMXattr, listOfMappedVPMattr);
                                    UIview.unsetRemoveAttrLine.call(this, attrLines, resultInvalidStored);
                                    UIview.addMappingAttrInModel(TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, typeRelMapping, mappingEltAttr, listOfAttributes, this.attributeMappingMap, this.listNewSelect, resultInvalidStored.isInvalid)
                                }
                            }
                            else if (mappingEltAttr.status.indexOf("Modified") !== -1)
                                UIview.resetModifyMapping.call(that, TypeMappingCollection, attrLines, mappingEltAttr, VPMTypeRelInfo, MatrixTypeRelInfo, typeRelMapping, listOfAttributes);
                        }
                    }
                }
                //remove all mappings in New table
                if (attrTableNew !== undefined) {
                    for (cptAttr = 0; cptAttr < attrTableNew.children.length; cptAttr++) {
                        attrLines = attrTableNew.children[cptAttr];
                        cellAttr = attrLines.cells[UIview.cellsAttrIndex.deployFlag];
                        mappingEltAttr = UIview.retrieveMappingAttrEntryFromAttrLine(attrLines, listOfAttributes);

                        attrLinesToRemove.push(attrLines);
                        if (mappingEltAttr != undefined) {
                            var VPMTypeRelInfo = this.listOfCustoVPMType.get(mappingElt.VPMObject);
                            var MatrixTypeRelInfo = this.listOfCustoPartType.get(mappingElt.MatrixObject);
                            UIview.removeMappingAttrInModel(TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, typeRelMapping, mappingEltAttr, listOfAttributes, this.attributeMappingMap, this.listNewSelect);
                        }
                    }
                }
                attrLinesToRemove.forEach(function (attrline) { attrline.remove(); });

                //Check if deployed valid mapping becommes invalid after reset (if a mutiple target error have been re-introducing by reset)


                //For each mapping, check attribute mapping validity
                /*if (attrTable !== undefined) {
                    nbofLines = attrTable.children.length;
                    //deployed table (table above "+" button)
                    for (cptAttr = 1; cptAttr < nbofLines; cptAttr++) {
                        attrLines = attrTable.children[cptAttr];
                        cellAttr = attrLines.cells[UIview.cellsAttrIndex.deployFlag];
                        if (cellAttr.value === "Deployed") {
                            mappingEltAttr = UIview.retrieveMappingAttrEntryFromAttrLine(attrLines, listOfAttributes);
                            if (!mappingEltAttr.isBaseMapping.toString()) { 
                            var listOfMappedMXattr = (that.attributeMappingMap.VPM).get(mappingEltAttr.VPMAttribute.id);
                            var listOfMappedVPMattr = (that.attributeMappingMap.MX).get(mappingEltAttr.MatrixAttribute.id);
                            var resultInvalidMapping = UIview.isInvalidMapping(VPMTypeRelInfo, MatrixTypeRelInfo, typeRelMapping.SynchDirection, mappingEltAttr, listOfMappedMXattr, listOfMappedVPMattr);
                            if (resultInvalidMapping.isInvalid) {

                                mappingEltAttr.status = "InvalidDeployed";
                                UIview.modifyDeployCellSatus(cellAttr, "InvalidDeployed", MappingManagementNLS.InvalidDeployed, 'fonticon-check', "red");

                                if (resultInvalidMapping.isInvalid) {
                                    var infoInvalidMappingSpan = UWA.createElement('span', {
                                        'class': 'InfoInvalidMapping fonticon fonticon-info'
                                    }).inject(cellAttr);

                                    var popoverInfoInvalidMapping = new Popover({
                                        target: infoInvalidMappingSpan,
                                        trigger: "hover",
                                        animate: "true",
                                        position: 'left',
                                        body: resultInvalidMapping.errorMessage,
                                    });

                                    infoInvalidMappingSpan.setStyle("margin-left", '7px');
                                }
                                }
                            }
                        }
                    }
                }*/
            },



            /* if (attrTable !== undefined) {
                 nbofLines = attrTable.children.length;
                 //deployed table (table above "+" button)
                 for (cptAttr = 1; cptAttr < nbofLines; cptAttr++) {
                     attrLines = attrTable.children[cptAttr];
                     cellAttr = attrLines.cells[UIview.cellsAttrIndex.deployFlag];
                     mappingEltAttr = UIview.retrieveMappingAttrEntryFromAttrLine(attrLines, listOfAttributes);
                     var listOfMappedMXattr = (that.attributeMappingMap.VPM).get(mappingEltAttr.VPMAttribute.id);
                     var listOfMappedVPMattr = (that.attributeMappingMap.MX).get(mappingEltAttr.MatrixAttribute.id);
                     var resultInvalidMapping = UIview.isInvalidMapping(VPMTypeRelInfo, MatrixTypeRelInfo, typeRelMapping.SynchDirection, mappingEltAttr, listOfMappedMXattr, listOfMappedVPMattr);
                     if (resultInvalidMapping.isInvalid) {
                         if (mappingEltAttr.status === "Stored")
                             mappingEltAttr.status = "InvalidStored";
                         else mappingEltAttr.status = "InvalidDeployed";

                     }
                 }
             }*/









            resetModifyMapping: function (TypeMappingCollection, attrLine, mappingEltAttr, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, listOfAttributes) {
                var that = this;
                if (mappingEltAttr.status.indexOf("Modified") !== -1) {
                    if (mappingEltAttr != undefined) {
                        var cellside = attrLine.cells[UIview.cellsAttrIndex.side];
                        //Restore database direction
                        UIview.setDirectionCell(cellside, mappingEltAttr.SynchDirectionBase, VPMTypeRelInfo.name, MatrixTypeRelInfo.name);
                    }
                }
            },

            setDeletedCellStyle: function (iCell) {
                var previousVal = iCell.value,
                    previousTxt = iCell.getText();
                if (previousTxt === undefined) previousTxt = previousVal;
                iCell.empty();
                UWA.createElement('del', {
                    text: previousTxt,
                    value: previousVal,
                }).inject(iCell);
            },

            setNormalCellStyle: function (iCell) {
                var previousVal = iCell.value,
                    previousTxt = iCell.getText();
                if (previousTxt === undefined) previousTxt = previousVal;
                iCell.empty();
                UWA.createElement('p', {
                    text: previousTxt,
                    value: previousVal,
                }).inject(iCell);
            },

            addTypeMapping: function (skeleton) {

                var collection = skeleton.collection;
                collection.add({
                    id: "SubType1" + "/" + "SubType2",
                    title: "SubType1" + "<span class=\"fonticon  fonticon-left-dir\"></span>" + "<span class=\"fonticon  fonticon-right-dir\"></span>" + "SubType2",
                    subtitle: "status:" + "<span class=\"fonticon fonticon-2x fonticon-check\" style=\"color:green\"></span>",
                    domainid: 'TypeMapping',
                    image: URLHandler.getURL() + "/webapps/ParameterizationSkeleton/assets/img/" + "paramAttributeMapping.png",
                })
            },

            onCompleteRequestUpdateIndexInfo: function (payload) { },
            onFailureRequestUpdateIndexInfo: function (resp) { },

            BuildAddMappingPanel: function (skeleton, title, VPMSelectPlaceHolder, MatrixSelectPlaceHolder, labelVPMtxt, labelMatrixtxt, labelProductToPart, labelPartToProduct) {

                this.getSubTypeInfo(
                    this.onCompleteRequestUpdateIndexInfo.bind(this), this.onFailureRequestUpdateIndexInfo.bind(this));




                var addMappingTitle, labelVPM, labelMatrix, iconInfoMessageBOTH, iconInfoMessageVPMENG, iconInfoMessageENGVPM, divMessageBOTH,
                    divMessageVPMENG, divMessageENGVPM, popoverInfoMappingBOTH, popoverInfoMappingVPMENG, popoverInfoMappingENGVPM,
                    OKBtn, CancelBtn, modalbodydiv, modalbodyTable, modaltbody, lineModal, iCell, iCell1, toggleBoth, toggleVPM, toggleENG, selectVPM, selectMatrix, addMappingModal;


                addMappingTitle = UWA.createElement('h4', {
                    text: title,
                });

                modalbodydiv = UWA.createElement('div', {
                    'class': 'PartProductAddMappingDiv',
                })

                modalbodyTable = UWA.createElement('table', {
                    'id': 'PartProductAddMappingTable',
                    'class': 'table table-condensed table-hover'
                }).inject(modalbodydiv);


                modaltbody = UWA.createElement('tbody', {
                    'class': 'addMappingBody'
                }).inject(modalbodyTable);

                lineModal = UWA.createElement('tr').inject(modaltbody);

                iCell = UWA.createElement('td', {
                    'Align': 'left',
                });

                iCell1 = UWA.createElement('td', {
                    'Align': 'left',
                    'width': '92%'
                }).inject(iCell);

                labelVPM = UWA.createElement('p', {
                    text: labelVPMtxt,
                    'class': 'font-3dslight'// font-3dsbold
                }).inject(iCell1);

                iCell.inject(lineModal);


                iCell = UWA.createElement('td', {
                    'Align': 'left',
                }).inject(lineModal);

                selectVPM = new Select({
                    nativeSelect: true,
                    placeholder: VPMSelectPlaceHolder,
                    multiple: false,
                });
                selectVPM.inject(iCell);

                //TEST
                selectVPM.add("VPMSubType1");
                selectVPM.add("VPMSubType2");
                selectVPM.add("VPMSubType3");

                lineModal = UWA.createElement('tr').inject(modaltbody);

                iCell = UWA.createElement('td', {
                    'Align': 'left',
                });

                iCell1 = UWA.createElement('td', {
                    'Align': 'left',
                    'width': '92%'
                }).inject(iCell);

                labelMatrix = UWA.createElement('p', {
                    text: labelMatrixtxt,
                    'class': 'font-3dslight'// font-3dsbold
                }).inject(iCell1);

                iCell.inject(lineModal);


                iCell = UWA.createElement('td', {
                    'Align': 'left',
                }).inject(lineModal);

                selectMatrix = new Select({
                    nativeSelect: true,
                    placeholder: MatrixSelectPlaceHolder,
                    multiple: false,
                });
                selectMatrix.inject(iCell);

                //TEST
                selectMatrix.add("MatrixSubType1");
                selectMatrix.add("MatrixSubType2");
                selectMatrix.add("MatrixSubType3");

                lineModal = UWA.createElement('tr').inject(modaltbody);

                iCell = UWA.createElement('td', {
                    'Align': 'left',
                });

                iCell1 = UWA.createElement('td', {
                    'Align': 'left',
                    'width': '92%'
                }).inject(iCell);

                UWA.createElement('p', {
                    text: MappingManagementNLS.side,
                    'class': 'font-3dslight'// font-3dsbold
                }).inject(iCell1);

                iCell.inject(lineModal);

                iCell = UWA.createElement('td', {
                    'Align': 'left',
                }).inject(lineModal);

                toggleBoth = new Toggle({ name: "optionsRadiosSide", value: MappingManagementNLS.both, className: "primary" }).inject(iCell);
                //toggleBoth.setDisabled(true);
                toggleVPM = new Toggle({ name: "optionsRadiosSide", value: labelProductToPart, className: "primary" }).inject(iCell);
                //toggleVPM.setDisabled(true);
                toggleENG = new Toggle({ name: "optionsRadiosSide", value: labelPartToProduct, className: "primary" }).inject(iCell);
                //toggleENG.setDisabled(true);

                var iCell2 = UWA.createElement('td', {
                    'Align': 'left',
                }).inject(lineModal);
                divMessageBOTH = UWA.createElement('div', { 'class': 'divAddMappingMessage' }).inject(iCell2);
                divMessageVPMENG = UWA.createElement('div', { 'class': 'divAddMappingMessage' }).inject(iCell2);
                divMessageENGVPM = UWA.createElement('div', { 'class': 'divAddMappingMessage' }).inject(iCell2);


                iconInfoMessageBOTH = UWA.createElement('span', {
                    'class': 'InfoAddMapping fonticon fonticon-info'
                }).inject(divMessageBOTH);
                iconInfoMessageBOTH.hide();
                popoverInfoMappingBOTH = new Popover({
                    target: iconInfoMessageBOTH,
                    trigger: "hover",
                    animate: "true",
                    position: 'left',
                    body: "",
                    title: 'BOTH'
                });

                iconInfoMessageVPMENG = UWA.createElement('span', {
                    'class': 'InfoAddMapping fonticon fonticon-info'
                }).inject(divMessageVPMENG);
                iconInfoMessageVPMENG.hide();
                popoverInfoMappingVPMENG = new Popover({
                    target: iconInfoMessageVPMENG,
                    trigger: "hover",
                    animate: "true",
                    position: 'left',
                    body: "",
                    title: 'Product to Part'
                });

                iconInfoMessageENGVPM = UWA.createElement('span', {
                    'class': 'InfoAddMapping fonticon fonticon-info'
                }).inject(divMessageENGVPM);
                iconInfoMessageENGVPM.hide();
                popoverInfoMappingENGVPM = new Popover({
                    target: iconInfoMessageENGVPM,
                    trigger: "hover",
                    animate: "true",
                    position: 'left',
                    body: "",
                    title: 'Part to Product'
                });

                UWA.createElement('ul', { 'class': 'ListAddMappingMessage' }).inject(divMessageBOTH);
                UWA.createElement('ul', { 'class': 'ListAddMappingMessage' }).inject(divMessageVPMENG);
                UWA.createElement('ul', { 'class': 'ListAddMappingMessage' }).inject(divMessageENGVPM);


                OKBtn = new Button({
                    value: MappingManagementNLS.Apply,
                    id: "modalOKButton",
                    className: 'btn primary'
                });
                //OKBtn.disable();

                CancelBtn = new Button({
                    value: MappingManagementNLS.Cancel,
                    id: 'modalCancelButton',
                    className: 'btn default'
                });


                addMappingModal = new Modal({
                    className: 'add-mapping-modal',
                    closable: true,
                    header: addMappingTitle,
                    body: modalbodydiv,
                    footer: [OKBtn, CancelBtn]
                });

                OKBtn.addEvent("onClick", function (e) {

                    var selectedVPMAttr, selectedMatrixAttr, txtSide, lineAttribute, position, typeAttrVPM, typeAttrMatrix, nameAttrVPM, nameAttrMatrix, mappingElt, AttrList, mappingEltAttr, displayNameAttrMatrix, displayNameAttrVPM;

                    selectedVPMAttr = selectVPM.getSelection();
                    selectedMatrixAttr = selectMatrix.getSelection();

                    var iconSpan = "";

                    if (toggleBoth.isChecked()) { txtSide = "BOTH"; iconSpan = "<span class=\"fonticon  fonticon-left-dir\"></span>" + "<span class=\"fonticon  fonticon-right-dir\"></span>" }
                    else if (toggleVPM.isChecked()) { txtSide = "VPM_To_MX"; iconSpan = "<span class=\"fonticon  fonticon-left-dir\"></span>" }
                    else if (toggleENG.isChecked()) { txtSide = "MX_To_VPM"; iconSpan = "<span class=\"fonticon  fonticon-right-dir\"></span>" }
                    else { txtSide = "BOTH"; iconSpan = "<span class=\"fonticon  fonticon-left-dir\"></span>" + "<span class=\"fonticon  fonticon-right-dir\"></span>" };

                    //nameAttrVPM = selectedVPMAttr[0].value/*.slice(0,position)*/;

                    var collection = skeleton.collection;
                    collection.add({
                        id: selectedVPMAttr[0].value + "/" + selectedMatrixAttr[0].value,
                        title: selectedVPMAttr[0].value + iconSpan + selectedMatrixAttr[0].value,
                        subtitle: "status:" + "<span class=\"fonticon fonticon-2x fonticon-check\" style=\"color:green\"></span>",
                        domainid: 'TypeMapping',
                        image: URLHandler.getURL() + "/webapps/ParameterizationSkeleton/assets/img/" + "paramAttributeMapping.png",
                    })

                    addMappingModal.hide();
                });

                return [addMappingModal, { selectVPM: selectVPM, selectMatrix: selectMatrix }, { toggle: toggleVPM, div: divMessageVPMENG, popover: popoverInfoMappingVPMENG }, { toggle: toggleENG, div: divMessageENGVPM, popover: popoverInfoMappingENGVPM }, { toggle: toggleBoth, div: divMessageBOTH, popover: popoverInfoMappingBOTH }, { OKButton: OKBtn, CancelButton: CancelBtn }];
            },


            getSubTypeInfo: function (onSuccess, onError) {
                var params = [];
                params.push("lang=" + widget.lang);
                var headers = {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json',
                    'Accept-Language': widget.lang
                    //'SecurityContext': URLHandler.getSecurityContext()
                };

                var options = this.options;
                var fullPath = URLHandler.getURL() + "/resources/MappingWS/mapping/subtypeinformation?tenant=" + URLHandler.getTenant();
                WAFData.authenticatedRequest(fullPath, {
                    method: 'GET',
                    headers: headers,
                    timeout: 1000 * 60 * 30, // ms, 30mn
                    type: 'json',
                    onComplete: function (payload, Obj, request) {
                        console.log("getDicoJson:onComplete");
                        onSuccess(payload);
                    },
                    onFailure: function (object, data, responseStatus) {
                        /*console.log("fail");
                        console.log(this);
                        var message = object;
                        if (data && typeof data === 'object') { // null = 'object'
                            if (data.error && data.error.message) {
                                message = data.error.message;
                            } else if (data.message) {
                                message = data.message;
                            }
                        } else if (typeof object === 'string') {
                            if (object.startsWith('NetworkError:')) {
                                if (object.endsWith('return ResponseCode with value "0".')) {
                                    message = // "There is no Internet connection."
                                } else if (object.endsWith('return ResponseCode with value "401".') ||
                                    object.endsWith('return ResponseCode with value "403".')) {
                                    message = "You are unauthorized to access the resource, please refresh the webpage to login and try again."
                                } else {
                                    message =  "An error is returned from web service."
                                }
                            } else if (object === 'null') {
                                message = "An error is returned from web service."
                            }
                        }
                        onError(message);*/
                    },
                    onTimeout: function () {
                        onError("timeout");
                    },
                });
            },


            createApplyResetDeleteToolbar: function (insertdivID, applyParams, resetParams, deleteParams, activateDeleteBtn) {
                var applyDiv, tableButtons, lineButtons, buttonApplyCell, applyBttn,
                    buttonResetCell, resetBbttn, buttonDeleteCell, deleteBbttn, width, widtDiv;


                if (activateDeleteBtn) { width = '33%'; widtDiv = '420px' }
                else { width = '50%'; widtDiv = '290px' }

                applyDiv = UWA.createElement('div', {
                    'id': 'TypeMappingApplyResetDeleteDiv',
                }).inject(insertdivID);


                applyDiv.setStyle("width", widtDiv);
                //                            
                tableButtons = UWA.createElement('table', {
                    'class': '',
                    'id': '',
                    'width': '100%'
                }).inject(applyDiv);

                lineButtons = UWA.createElement('tr').inject(tableButtons);


                buttonApplyCell = UWA.createElement('td', {
                    'width': width,
                    'Align': 'left'
                }).inject(lineButtons);

                applyBttn = new Button({
                    className: 'primary',
                    id: 'buttonExport',
                    icon: 'export',
                    attributes: {
                        disabled: false,
                        title: ParamSkeletonNLS.Applytooltip,
                        text: ParamSkeletonNLS.Apply
                    },
                    events: {
                        onClick: function () {
                            applyParams();
                        }
                    }
                }).inject(buttonApplyCell);
                applyBttn.getContent().setStyle("width", 130);


                buttonResetCell = UWA.createElement('td', {
                    'width': width,
                    'Align': 'right'//center
                }).inject(lineButtons);

                resetBbttn = new Button({
                    className: 'warning',
                    icon: 'loop',
                    attributes: {
                        disabled: false,
                        title: ParamSkeletonNLS.ResetOnServertooltip,
                        text: ParamSkeletonNLS.Reset
                    },
                    events: {
                        onClick: function () {
                            resetParams();
                        }
                    }
                }).inject(buttonResetCell);

                resetBbttn.getContent().setStyle("width", 130);
                if (activateDeleteBtn === true) {
                    buttonDeleteCell = UWA.createElement('td', {
                        'width': '34%',
                        'Align': 'right'//center
                    }).inject(lineButtons);

                    deleteBbttn = new Button({
                        className: 'error',
                        icon: 'trash',
                        attributes: {
                            disabled: false,
                            title: MappingManagementNLS.RemoveTypeMapping,
                            text: MappingManagementNLS.Delete
                        },
                        events: {
                            onClick: function () {
                                deleteParams();
                            }
                        }
                    }).inject(buttonDeleteCell);

                    deleteBbttn.getContent().setStyle("width", 130);
                }


                return applyDiv;

            },


            checkMultipleTargetMapping: function (typeMapping, VPMTypeRelInfo, MatrixTypeRelInfo, listofAttributesMapping, attributeMapping) {
                var typeRelDirection = UIview.getSelectedTypeRelMappingDirection(this.pSkeleton, typeMapping, this.isCloudEnv);
                var i = 0;
                var attrTable = this.contentDiv.getElement(".attrstbodyMapping");
                for (i = 0; i < listofAttributesMapping.length; i++) {
                    var attributeMappingLoop = listofAttributesMapping[i];
                    var isRemoved = attributeMappingLoop.status.indexOf("Removed") !== -1;
                    var isModified = attributeMappingLoop.status.indexOf("Modified") !== -1;
                    if (!isRemoved && !isModified && ((attributeMappingLoop.VPMAttribute.id === attributeMapping.VPMAttribute.id && (attributeMappingLoop.SynchDirection === "BOTH" || attributeMappingLoop.SynchDirection === "MX_To_VPM"))
                        ||
                        (attributeMappingLoop.MatrixAttribute.id === attributeMapping.MatrixAttribute.id && (attributeMappingLoop.SynchDirection === "BOTH" || attributeMappingLoop.SynchDirection === "VPM_To_MX")))) {

                        UIview.CheckInvalidStatusAndUpdateStatus.call(this, VPMTypeRelInfo, MatrixTypeRelInfo, attributeMappingLoop.SynchDirection, attributeMappingLoop, attrTable);

                    }
                }
            },


            CheckInvalidStatusAndUpdateStatus: function (VPMTypeRelInfo, MatrixTypeRelInfo, typeRelDirection, attributeMapping, attrTable) {

                //We ignore removed mapping and we consider new and modify mapping cannot be invalid thanks to mapping rules check integrated to command
                var isRemoved = attributeMapping.status.indexOf("Removed") !== -1;
                var isModified = attributeMapping.status.indexOf("Modified") !== -1;
                var isNew = attributeMapping.status.indexOf("New") !== -1;
                var isBaseMapping = attributeMapping.isBaseMapping;

                if (!isRemoved && !isModified && !isNew && !isBaseMapping) {

                    var listOfMappedMXattr = (this.attributeMappingMap.VPM).get(attributeMapping.VPMAttribute.id);
                    var listOfMappedVPMattr = (this.attributeMappingMap.MX).get(attributeMapping.MatrixAttribute.id);
                    var resultInvalidMapping = UIview.isInvalidMapping(VPMTypeRelInfo, MatrixTypeRelInfo, typeRelDirection, attributeMapping, listOfMappedMXattr, listOfMappedVPMattr);
                    var attrLine = UIview.retrieveAttrLineFromMappingAttrEntry(attributeMapping, attrTable);
                    if (attrLine != undefined) {
                        var deployAttrcell = attrLine.cells[UIview.cellsAttrIndex.deployFlag];

                        if (!resultInvalidMapping.isInvalid) {

                            var cellTitle, cellIcon, cellValue, color;
                            if (deployAttrcell.value.indexOf("Stored") !== -1) {
                                cellTitle = MappingManagementNLS.Stored;
                                cellValue = "Stored";
                                color = 'orange';
                                cellIcon = 'fonticon-cog';
                            }
                            else {
                                cellTitle = MappingManagementNLS.Deployed;
                                color = 'green';
                                cellValue = "Deployed";
                                cellIcon = 'fonticon-check';
                            }
                        }
                        else {
                            if (deployAttrcell.value.indexOf("Stored") !== -1) {
                                cellTitle = MappingManagementNLS.InvalidStored;
                                cellValue = "InvalidStored";
                                color = 'red';
                                cellIcon = 'fonticon-cog';
                            }
                            else {
                                cellTitle = MappingManagementNLS.InvalidDeployed;
                                color = 'red';
                                cellValue = "InvalidDeployed";
                                cellIcon = 'fonticon-check';
                            }
                        }

                        attributeMapping.status = cellValue;
                        UIview.modifyDeployCellSatus(deployAttrcell, cellValue, cellTitle, cellIcon, color);

                        if (resultInvalidMapping.isInvalid) {
                            var infoInvalidMappingSpan = UWA.createElement('span', {
                                'class': 'InfoInvalidMapping fonticon fonticon-info'
                            }).inject(deployAttrcell);

                            var popoverInfoInvalidMapping = new Popover({
                                target: infoInvalidMappingSpan,
                                trigger: "hover",
                                animate: "true",
                                position: 'left',
                                body: resultInvalidMapping.errorMessage,
                            });

                            infoInvalidMappingSpan.setStyle("margin-left", '7px');

                        }
                    }
                }
            },

            UpdateStatusAndDirectionAfterModify: function (TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, direction, attributeMapping, listofAttributesMapping, iCellStatus, iCellAction, dirICell, actionButton, selectVPM, selectMatrix) {
                var that = this;
                var direction = dirICell.value;
                var mappingDirection = attributeMapping.SynchDirection;
                UIview.modifyMappingDirection.call(that, TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, direction, attributeMapping, listofAttributesMapping, selectVPM, selectMatrix);
                if (iCellStatus.value === "Deployed" || iCellStatus.value === "Stored" || iCellStatus.value.indexOf("Modified") !== -1 || iCellStatus.value.indexOf("Invalid") !== -1) {
                    if (attributeMapping.SynchDirectionBase === undefined && direction !== mappingDirection) {

                        var color = "green";
                        var status = "ModifiedDeployed";
                        if (iCellStatus.value.indexOf("Stored") !== -1) { color = "orange"; status = "ModifiedStored"; }
                        attributeMapping.status = status;
                        UIview.modifyDeployCellSatus(iCellStatus, status, MappingManagementNLS.ModifiedNotApplied, "fonticon-pencil", color);
                        //if (attributeMapping.SynchDirectionBase === undefined) {
                        attributeMapping.SynchDirectionBase = mappingDirection;

                        //get undo popover
                        var undoPop = actionButton[3];


                        //Set popup for undoDirection

                        var divUndoDirectionModifification = UWA.createElement('div', {
                            'class': 'divUndoDirectionModifification'
                        });
                        var pUndoDirectionModifification = UWA.createElement('p', {
                            'class': 'pUndoDirectionModifification',
                            'text': MappingManagementNLS.UndoDirection
                        }).inject(divUndoDirectionModifification);

                        var divDataBaseDirection = UWA.createElement('div', {
                            'class': 'divDataBaseDirection'
                        }).inject(divUndoDirectionModifification);


                        var imgSpanDataBase = UWA.createElement('span', {
                            'class': 'fonticon  fonticon-database'
                        }).inject(divDataBaseDirection);

                        var pDatBaseDirection = UWA.createElement('p', {
                            'class': 'pDatBaseDirection',
                            'text': '  :  ',
                        }).inject(divDataBaseDirection);

                        UIview.setDirectionIcon(attributeMapping.SynchDirectionBase, divDataBaseDirection);

                        if (undoPop !== undefined)
                            undoPop.setBody(divUndoDirectionModifification);

                        actionButton[0].show();
                        actionButton[1].show();

                    }
                    else if (attributeMapping.SynchDirectionBase === direction) {
                        UIview.ResetModifyStatus.call(that, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, attributeMapping, iCellAction, iCellStatus);
                        attributeMapping.SynchDirectionBase = undefined;

                    }

                    //Modify the direction can solve invalid mapping having same target as modified mapping (used twice as target error)
                    //Check if mapping have same target and set the status if thet are no more invalid
                    UIview.checkMultipleTargetMapping.call(that, typeMapping, VPMTypeRelInfo, MatrixTypeRelInfo, listofAttributesMapping, attributeMapping);
                }
            },

            setDirectionIcon: function (direction, container) {
                var imgSpanRight = UWA.createElement('span', {
                    'class': 'fonticon fonticon-expand-right'
                })

                var imgSpanLeft = UWA.createElement('span', {
                    'class': 'fonticon fonticon-expand-left'
                })

                var imgSpanBoth = UWA.createElement('span', {
                    'class': 'fonticon fonticon-arrow-combo-horizontal'
                })
                if (direction == "BOTH") {
                    imgSpanBoth.inject(container);
                    imgSpanBoth.setStyle("display", "block");
                    imgSpanBoth.setStyle("text-align", "left")
                }
                else if (direction == "VPM_To_MX") {
                    imgSpanRight.inject(container);
                    imgSpanRight.setStyle("display", "block");
                    imgSpanRight.setStyle("text-align", "left")
                }
                else if (direction == "MX_To_VPM") {
                    imgSpanLeft.inject(container);
                    imgSpanLeft.setStyle("display", "block");
                    imgSpanLeft.setStyle("text-align", "left")
                }
            },

            addTooltipToDecorator: function () { 
                var spanLeft = document.getElementsByClassName("wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-expand-left wux-ui-3ds wux-ui-3ds-lg");
                if (spanLeft.length == 1)
                    spanLeft[0].setAttribute('title', MappingManagementNLS.BOMToVPMSide);
                var spanRigth = document.getElementsByClassName("wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-expand-right wux-ui-3ds wux-ui-3ds-lg");
                if (spanRigth.length == 1)
                    spanRigth[0].setAttribute('title', MappingManagementNLS.VPMToBOMSide);
                var spanBoth = document.getElementsByClassName("wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-arrow-combo-horizontal wux-ui-3ds wux-ui-3ds-2x");
                if (spanBoth.length == 1)
                    spanBoth[0].setAttribute('title', MappingManagementNLS.both);
            },

            onResetSuccessForAttributes: function () {
                var cpt = 0, cptAttr = 0, item, title, imgSpan, line, cell, mappingElt, mappingEltAttr, itemToRemove = new Array(), that = this;

                var attrTable = this.contentDiv.getElement(".attrstbodyMapping");
                var attrTableNew = this.contentDiv.getElement(".attrstbodyNewMapping");
                mappingElt = this.listofTypeRelMapping[0];
                UIview.resetForAttributes.call(that, this.TypeMappingCollection, this.typeRelMapping, this.listofTypeRelMapping[0].AttributeMapping, attrTable, attrTableNew);

                //Update Direction and Status
                var direction = this.pSkeleton.getActiveIdCard().model.get('SynchDirection');


                //remove reset button
                if (!this.typeRelMapping.isBaseMapping) {
                    var typeRelDirection = UIview.getSelectedTypeRelMappingDirection(this.pSkeleton, this.typeRelMapping, this.isCloudEnv);
                    if (typeRelDirection !== direction) { 
                    TypeMappingViewUtilities.setTypeMappingDirection(direction, this.pSkeleton, this.isCloudEnv);
                    var TypeMappingResetDirection = document.getElementById("resetMappingDirectionSection");
                    TypeMappingViewUtilities.removeResetDirectionButton(TypeMappingResetDirection);

                    var resultInvalidMapping = TypeMappingViewUtilities.isInvalidMapping(this.TypeMappingCollection, this.typeRelMapping);

                    //update type mapping status
                    var typeMappingStatusDiv = document.getElementById("TypeMappingStatusIcon");
                    var status = this.pSkeleton.getActiveIdCard().model.get('Status');
                    var iconStatus = 'fonticon-check';
                    var colorIconStatus = 'green';
                    if (status === "Stored") {
                        colorIconStatus = 'orange';
                        iconStatus = 'fonticon-cog';
                    }
                    if (resultInvalidMapping.isInvalid) colorIconStatus = 'red';

                    TypeMappingViewUtilities.modifySatusDirection(typeMappingStatusDiv, iconStatus, colorIconStatus);

                    if (resultInvalidMapping.isInvalid) {
                        var infoInvalidMappingSpan = UWA.createElement('span', {
                            'class': 'InfoInvalidMapping fonticon fonticon-info'
                        }).inject(typeMappingStatusDiv);

                        var popoverInfoInvalidMapping = new Popover({
                            target: infoInvalidMappingSpan,
                            trigger: "hover",
                            animate: "true",
                            position: 'left',
                            body: resultInvalidMapping.errorMessage,
                        });

                        infoInvalidMappingSpan.setStyle("margin-left", '7px');
                    }

                    //Check if attribute mapping direction is always compatible with type mapping direction
                    var VPMTypeRelInfo = this.listOfCustoVPMType.get(mappingElt.VPMObject);
                    var MatrixTypeRelInfo = this.listOfCustoPartType.get(mappingElt.MatrixObject);
                    for (cptAttr = 1; cptAttr < attrTable.children.length; cptAttr++) {
                        var attrLines = attrTable.children[cptAttr];
                        var cellAttr = attrLines.cells[UIview.cellsAttrIndex.deployFlag];
                        if (cellAttr.value === "Deployed") {
                            mappingEltAttr = UIview.retrieveMappingAttrEntryFromAttrLine(attrLines, this.listofTypeRelMapping[0].AttributeMapping);
                            if (!mappingEltAttr.isBaseMapping) {
                                var listOfMappedMXattr = (this.attributeMappingMap.VPM).get(mappingEltAttr.VPMAttribute.id);
                                var listOfMappedVPMattr = (this.attributeMappingMap.MX).get(mappingEltAttr.MatrixAttribute.id);
                                var resultInvalidMapping = UIview.isInvalidMapping(VPMTypeRelInfo, MatrixTypeRelInfo, this.listofTypeRelMapping[0].SynchDirection, mappingEltAttr, listOfMappedMXattr, listOfMappedVPMattr);
                                if (resultInvalidMapping.isInvalid) {

                                    mappingEltAttr.status = "InvalidDeployed";
                                    UIview.modifyDeployCellSatus(cellAttr, "InvalidDeployed", MappingManagementNLS.InvalidDeployed, 'fonticon-check', "red");

                                    if (resultInvalidMapping.isInvalid) {
                                        var infoInvalidMappingSpan = UWA.createElement('span', {
                                            'class': 'InfoInvalidMapping fonticon fonticon-info'
                                        }).inject(cellAttr);

                                        var popoverInfoInvalidMapping = new Popover({
                                            target: infoInvalidMappingSpan,
                                            trigger: "hover",
                                            animate: "true",
                                            position: 'left',
                                            body: resultInvalidMapping.errorMessage,
                                        });

                                        infoInvalidMappingSpan.setStyle("margin-left", '7px');
                                    }
                                }
                            }
                        }
                        }
                    }
                }

                while (this.listNewSelect.length > 0) {
                    this.listNewSelect.pop();
                }
            }

        }
        
        return UIview;
    });

// JavaScript source code
define('DS/ParameterizationSkeleton/Views/ParamCollaboration/TypeMapping/typeMappingRenderer',
    ['UWA/Class/Model',
        'UWA/Class/Collection',
        'UWA/Class/View',
        'DS/W3DXComponents/Skeleton',
        'DS/W3DXComponents/Collections/ActionsCollection',
        'DS/W3DXComponents/Views/Layout/ListView',
        'DS/W3DXComponents/Views/Layout/GridScrollView',
        'DS/W3DXComponents/Views/Item/TileView',
        'DS/W3DXComponents/Views/Layout/TableScrollView',
        'DS/UIKIT/Input/ButtonGroup',
        'DS/UIKIT/Input/Button',
        'WebappsUtils/WebappsUtils',
        'DS/ParameterizationSkeleton/Views/ParamCollaboration/TypeMapping/TypeMappingViewUtilities',
        'DS/ParameterizationSkeleton/Views/ParamCollaboration/AttributeMapping/MappingViewUtilities',
        'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
        "DS/Controls/CustomizableDecorator",
        "DS/Controls/DecoratorManager",
        "DS/Controls/CustomizableDecoratorItems",
        'i18n!DS/ParameterizationSkeleton/assets/nls/MappingManagementNLS',
        'DS/UIKIT/Alert',
        'DS/UIKIT/Popover',
    ],
    function (Model, Collection, View, Skeleton, ActionsCollection, ListView, GridScrollView, TileView, TableScrollView, ButtonGroup, Button, WebappsUtils, TypeMappingViewUtilities, MappingViewUtilities, URLHandler, CustomizableDecorator, DecoratorManager, CustomizableDecoratorItems, MappingManagementNLS, Alert, Popover) {
        "use strict";
        var typeMappingRenderer = {

            initVariable: function () {
                this.listInvalidMapping = new Array();
                this.pSkeleton = null;
                this.isCloudEnv = false;
                this.isAlreadyCleanForCloud = { value: true };
                this.undoPopover = null;
               // this.listOfNotFilteredMappingForCloud;
                this.userMessaging= new Alert({
                    className: 'param-alert',
                    closable: true,
                    visible: true,
                    renderTo: document.body,
                    autoHide: true,
                    hideDelay: 2000,
                    messageClassName: 'warning'
                })

                var tenant = URLHandler.getTenant();
                if (tenant !== undefined && tenant !== 'OnPremise') this.isCloudEnv = true;
                if(this.isCloudEnv) this.isAlreadyCleanForCloud.value = false;

                var customizedItemsToRegister = {
                    "BOTH": {
                        "icon": {
                            "iconName": "arrow-combo-horizontal wux-ui-3ds",
                            "fontIconSize": '2x',
                        },
     
                    },
                    "VPM_To_MX": {
                        "icon": {
                            "iconName": "expand-right wux-ui-3ds",
                            "fontIconSize": '1x'
                        },
                    },
                    "MX_To_VPM": {
                        "icon": {
                            "iconName": "expand-left wux-ui-3ds",
                            "fontIconSize": '1x'
                        },
                    },

                };

                CustomizableDecoratorItems.addDecoratorItems(customizedItemsToRegister);

                this.myCustomDecorator = new CustomizableDecorator({
                    items: {
                        viewA: ["MX_To_VPM", "VPM_To_MX"],
                        viewB: ['BOTH', 'MX_To_VPM'],
                        viewC: ['BOTH', 'VPM_To_MX'],
                        viewD: ['VPM_To_MX'],
                        viewE: ['MX_To_VPM'],
                        viewF: ['BOTH']
                    },
                    onClick: function (itemID, input) {

                        var parentDiv = DecoratorManager.getWidget().elements.container.parentNode.parentNode.parentNode;

                        //type mapping direction modififcation

                        if (parentDiv.id === "TypeMappingDirectionButton") {
                            var deployedStatus = typeMappingRenderer.pSkeleton.getActiveIdCard().model.get('deployedStatus');
                            TypeMappingViewUtilities.setTypeMappingDirection(itemID.itemID, typeMappingRenderer.pSkeleton, typeMappingRenderer.isCloudEnv);


                            //Retrieve base direction
                            var model = typeMappingRenderer.pSkeleton.getActiveIdCard().model;
                            var baseDirection = model.get('SynchDirection');
                            var statutDiv = parentDiv.parentNode.parentNode.childNodes[2].childNodes[1];
                            var buttonReset = parentDiv.childNodes[1].childNodes[0].childNodes[1];
                            var buttonModify = parentDiv.childNodes[1].childNodes[0].childNodes[0];
                            //if base direction is different from selected direction
                            //show restore base direction button
                            if (itemID.itemID !== baseDirection) {
                                //Show Reset button and display database direction in tooltip
                                buttonReset.show();
                                var divUndoDirectionModifification = UWA.createElement('div', {
                                    'class': 'divUndoDirectionModifification'
                                });
                                var pUndoDirectionModifification = UWA.createElement('p', {
                                    'class': 'pUndoDirectionModifification',
                                    'text': MappingManagementNLS.UndoDirection
                                }).inject(divUndoDirectionModifification);

                                var divDataBaseDirection = UWA.createElement('div', {
                                    'class': 'divDataBaseDirection'
                                }).inject(divUndoDirectionModifification);


                                var imgSpanDataBase = UWA.createElement('span', {
                                    'class': 'fonticon  fonticon-database'
                                }).inject(divDataBaseDirection);

                                var pDatBaseDirection = UWA.createElement('p', {
                                    'class': 'pDatBaseDirection',
                                    'text': '  :  ',
                                }).inject(divDataBaseDirection);

                                MappingViewUtilities.setDirectionIcon(baseDirection, divDataBaseDirection);
                                typeMappingRenderer.undoPopover.setBody(divUndoDirectionModifification);


                                buttonModify.setStyle('border-top-right-radius', 0);
                                buttonModify.setStyle('border-bottom-right-radius', 0);
                                //Set status as 'modified'
                                
                                var iconStatus = 'fonticon-pencil';
                                var colorIconStatus = 'green';
                                if (deployedStatus === "Stored")
                                    colorIconStatus = 'orange';
                                var iconTitle = MappingManagementNLS.ModifiedNotApplied;


                                TypeMappingViewUtilities.modifySatusDirection(statutDiv, iconStatus, colorIconStatus, iconTitle);

                                //Correct "side not compatible" attribute mapping error
                                var nestedView = typeMappingRenderer.pSkeleton.getViewAt(3);
                                var attributeMappingList = nestedView.listofTypeRelMapping[0].AttributeMapping;
                                var attrTable = nestedView.contentDiv.getElement(".attrstbodyMapping");
                                var cpt = 0;
                                for (cpt = 0; cpt < attributeMappingList.length; cpt++) {
                                    var attributeMapping = attributeMappingList[cpt];
                                    MappingViewUtilities.CheckInvalidStatusAndUpdateStatus.call(nestedView,model.get('vpmObject').id, model.get('mxObject').id,itemID.itemID,attributeMapping, attrTable);
                                }


                            }
                            else {
                                buttonReset.hide();
                                buttonModify.setStyle('border-top-right-radius', '3px');
                                buttonModify.setStyle('border-bottom-right-radius', '3px');
                                var iconStatus = 'fonticon-check';
                                var colorIconStatus = 'green';
                                var iconTitle = MappingManagementNLS.Deployed;
                                if (deployedStatus === "Stored") {
                                    colorIconStatus = 'orange';
                                    iconTitle = MappingManagementNLS.Stored;
                                }
                                TypeMappingViewUtilities.modifySatusDirection(statutDiv, iconStatus, colorIconStatus, iconTitle);
                            }
                        }
                        //attribute mapping direction modififcation
                        else {
                            var directionCell = DecoratorManager.getWidget().elements.container.parentNode.parentNode.parentNode.childNodes[1];
                            var statusCell = DecoratorManager.getWidget().elements.container.parentNode.parentNode.parentNode.childNodes[5];

                            DecoratorManager.hideDecorator(false, true);

                            if (statusCell.value === "Deployed" || statusCell.value === "Stored" || statusCell.value.indexOf("Modified") !== -1 || statusCell.value.indexOf("Invalid") !== -1 || statusCell.value === "New") {
                                MappingViewUtilities.setDirectionCell(directionCell, itemID.itemID, "Physical", "BOM");

                            }
                        }

                        return {
                            preventDefault: true
                        };
                    }
                });
                DecoratorManager.registerDecorator("mappingDirectionDecorator", this.myCustomDecorator);

                if (document.addEventListener) {
                    document.addEventListener('click', function () { DecoratorManager.hideDecorator(); console.trace("hide"); }, false);
                } else {
                    document.attachEvent('onclick', function () { DecoratorManager.hideDecorator(); console.trace("hide"); });
                }
             

            },

            plugin: function (skeletonView) {
                var that = this;
                typeMappingRenderer.initVariable();
                var rootMenu = {
                    typeMapping: {
                        pSkeleton: skeletonView,
                        collection: 'DS/ParameterizationSkeleton/Collection/ParamCollaboration/ParameterizationTypeMappingCollection',
                        view: 'DS/ParameterizationSkeleton/Views/ParamCollaboration/TypeMapping/TypeMappingLayoutView',
                        viewOptions: {

                            contents: {

                                isCloudEnv: typeMappingRenderer.isCloudEnv,
                                isAlreadyCleanForCloud: typeMappingRenderer.isAlreadyCleanForCloud.value,

                                itemViewOptions: {
                                   
                                    mapping: {

                                      
                                        domainid: function () { return this.model.get('domainid') },
                                        title: function () {
                                            var direction = this.model.get('SynchDirection');
                                            var directionIcon = null;
                                            if (direction === "BOTH")
                                                if (!typeMappingRenderer.isCloudEnv)
                                                    directionIcon =  "<span class=\"fonticon  fonticon-left-dir\"></span>" + "<span class=\"fonticon  fonticon-right-dir\"></span>";
                                                else
                                                    directionIcon =  "<span class=\"fonticon  fonticon-right-dir\"></span>";
                                            else if (direction === "VPM_To_MX")
                                                directionIcon =  "<span class=\"fonticon  fonticon-right-dir\"></span>";
                                            else if (direction === "MX_To_VPM")
                                                directionIcon =  "<span class=\"fonticon  fonticon-left-dir\"></span>";
                                    
                                            var title = this.model.get('vpmObject').name + directionIcon + "<br />" + this.model.get('mxObject').name; 
                                            return title;
                                        },
                                        subtitle: function () {
                                            var statusIcon = null;
                                            var imgTitle = MappingManagementNLS.NotModifiable;
                                            var isBaseMapping = this.model.get('isBaseMapping');
                                            if (isBaseMapping) {
                                                statusIcon = MappingManagementNLS.TypeMappingStatus +":" + "<span title='" + imgTitle + "' class=\"fonticon  fonticon-lock\" style=\"color:grey\"></span>";
                                            }
                                            else {

                                                var resultInvalidMapping = TypeMappingViewUtilities.isInvalidMapping(this.model.collection._models, this.model._attributes);
                                                this.model.set('invalidStatus', { isInvalid: resultInvalidMapping.isInvalid, errorMessage: resultInvalidMapping.errorMessage, errorsList: resultInvalidMapping.errorsList });
                                    
                                                var deployedStatus = this.model.get('deployedStatus');
                                                var iconColor = 'green';
                                                imgTitle = MappingManagementNLS.Deployed;
                                                //Mapping has been removed by import
                                                if (deployedStatus.indexOf("Removed") !== -1) {
                                   
                                                    if (deployedStatus.indexOf("Stored") !== -1) {
                                                        imgTitle = MappingManagementNLS.DeletedStoredNotApplied;
                                                        iconColor = "orange";
                                                        if (resultInvalidMapping.isInvalid) {
                                                            iconColor = 'red';
                                                            imgTitle = MappingManagementNLS.InvalidStored;
                                                        }
                                                    }
                                                    else {
                                                        imgTitle = MappingManagementNLS.DeletedNotApplied;
                                                        iconColor = "red";
                                                    }
                                                    statusIcon = MappingManagementNLS.TypeMappingStatus+":" + "<span title='" + imgTitle + "' class=\"fonticon  fonticon-trash\" style=\"color:" + iconColor + "\"></span>";
                                                }
                                                else if (deployedStatus === "Deployed") {
                                                    if (resultInvalidMapping.isInvalid) {
                                                        iconColor = 'red';
                                                        imgTitle = MappingManagementNLS.InvalidDeployed;
                                                    }

                                                   

                                                    statusIcon = MappingManagementNLS.TypeMappingStatus + ":" + "<span title='" + imgTitle + "' class=\"fonticon  fonticon-check\" style=\"color:" + iconColor + "\"></span>" ;

                                                    if (resultInvalidMapping.isInvalid) {
                                                        var infoInvalidMappingSpan = UWA.createElement('span', {
                                                            'class': 'InfoInvalidMapping fonticon fonticon-info',
                                                            title: resultInvalidMapping.errorMessage,
                                                        });
                                                        statusIcon = statusIcon +" "+ infoInvalidMappingSpan.outerHTML;
                                                    }
                                             
                                                }
                                                else if (deployedStatus === "Stored") {
                                                    iconColor = "orange";
                                                    if (resultInvalidMapping.isInvalid) {
                                                        iconColor = 'red';
                                                        imgTitle = resultInvalidMapping.errorMessage;
                                                    }
                                                    else {
                                                        iconColor = "orange";
                                                        imgTitle = MappingManagementNLS.Stored;
                                                    }
                                                    statusIcon = MappingManagementNLS.TypeMappingStatus+":" + "<span title='" + imgTitle + "' class=\"fonticon  fonticon-cog\" style=\"color:" + iconColor + "\"></span>";
                                                }
                                            }
                                            return statusIcon;
                                        },

                                    }
                                },
                            },

                            actions: {

                                collection: new ActionsCollection([
                                    /*{
                                        id: 'searchItems',
                                        title: 'Search',
                                        icon: 'search',
                                        overflow: false
                                    },*/
                                    {
                                        id: 'addTypeMapping',
                                        title: MappingManagementNLS.AddTypeMapping,
                                        icon: 'plus-circled',
                                        overflow: false
                                    },

                                    {
                                        id: 'deployAll',
                                        title: MappingManagementNLS.DeployAll,
                                        icon: 'export',
                                        overflow: false
                                    },
                              
                                    {
                                        id: 'resetAll',
                                        title: MappingManagementNLS.ResetAll,
                                        icon: 'loop',
                                        overflow: false
                                    },

                                ])
                            },
                            events: {
                                onActionClick: function (actionsView, actionView, event) {
                                    if (event.model.id === "deployAll") {
                                        var that = this;
                                        that.pSkeleton = rootMenu.typeMapping.pSkeleton;
                                        var collection = that.collection;

                                        var isDeployIsOK = true;

                                        for (i = 0; i < that.collection._models.length; i++) {
                                            var typeMapping = collection._models[i];
                                            if (typeMapping.get('deployedStatus').indexOf("Removed") == -1) {
                                               // var resultInvalidMapping = TypeMappingViewUtilities.isInvalidMapping(that.collection._models, typeMapping._attributes);
                                               // if (resultInvalidMapping.isInvalid) isDeployIsOK = false;
                                                var resultInvalidMapping = typeMapping.get('invalidStatus').isInvalid;
                                                if (resultInvalidMapping) isDeployIsOK = false;
                                            }
                                        }
                                        if (isDeployIsOK)
                                            TypeMappingViewUtilities.DeployAllImportedMapping(that.container, that.pSkeleton, collection, typeMappingRenderer.isAlreadyCleanForCloud, typeMappingRenderer.userMessaging);
                                        else
                                            typeMappingRenderer.userMessaging.add({ className: "error", message: MappingManagementNLS.DeployAllNotpossible });
                                    }
                                    else if (event.model.id === "resetAll") {
                                        var that = this;
                                        that.pSkeleton = rootMenu.typeMapping.pSkeleton;
                                        var collection = that.collection;

                                        //Filter Collection to simulate mapping without imported and check restore to be deleted by import mapping is ok
                                        var filteredCollection = new Array();
                                        var ToBeDeletedTypeMappings = new Array();
                                        var i = 0;
                                        for (i = 0; i < collection._models.length; i++) {
                                            var typeMapping = collection._models[i];
                                            if (typeMapping.get('deployedStatus').indexOf("Stored") == -1) {
                                                filteredCollection.push(typeMapping);
                                                if (typeMapping.get('deployedStatus').indexOf("Removed") != -1)
                                                    ToBeDeletedTypeMappings.push(typeMapping);
                                            }
                                        }

                                        var isRestoreToBeDeletedIsOK = true;

                                        for (i = 0; i < ToBeDeletedTypeMappings.length; i++) {
                                            var resultInvalidMapping = TypeMappingViewUtilities.isInvalidMapping(filteredCollection, ToBeDeletedTypeMappings[i]._attributes,undefined, true);
                                            if (resultInvalidMapping.isInvalid) isRestoreToBeDeletedIsOK = false;
                                        }

                                        if (isRestoreToBeDeletedIsOK)
                                            TypeMappingViewUtilities.ResetAllImportedMapping(that.container, that.pSkeleton, collection, typeMappingRenderer.isAlreadyCleanForCloud, typeMappingRenderer.userMessaging);
                                        else
                                            typeMappingRenderer.userMessaging.add({ className: "error", message: MappingManagementNLS.ResetAllNotpossible });
                                    }
                                    else if (event.model.id === "addTypeMapping") {
                                        var that = this;
                                        that.pSkeleton = rootMenu.typeMapping.pSkeleton;
           
                                        var collection = that.collection._models;
                                        var containsInvalidMapping = false;

                                        var typeMappingStatusDiv = document.getElementById("TypeMappingStatusIcon");
                                        if (typeMappingStatusDiv !==null && typeMappingStatusDiv.children[0].className.contains("fonticon-pencil"))
                                            typeMappingRenderer.userMessaging.add({ className: "error", message: MappingManagementNLS.TypeMappingInEdition });
                                        else {

                                            var i = 0;
                                            while (i < collection.length && !containsInvalidMapping) {
                                                var deployedStatus = collection[i].get('deployedStatus');
                                                if (deployedStatus.indexOf("Removed") === -1) {
                                                    var resultInvalidMapping = collection[i].get('invalidStatus');
                                                    containsInvalidMapping = resultInvalidMapping.isInvalid;
                                                }
                                                i++;
                                            }

                                            if (containsInvalidMapping) {
                                                typeMappingRenderer.userMessaging.add({ className: "error", message: MappingManagementNLS.InvalidMappingAdd });
                                            }
                                            else {
                                               // var typeModel = that.model;
                                                //var collection = typeModel.collection;
                                                var PanelResult = TypeMappingViewUtilities.BuildAddMappingPanel(that, collection, MappingManagementNLS.AddTypeMappingPanelTitle, MappingManagementNLS.AddTypeMappingPanelSelectPhy, MappingManagementNLS.AddTypeMappingPanelSelectPart, MappingManagementNLS.AddTypeMappingPanelPhySubType, MappingManagementNLS.AddTypeMappingPanelPartSubType, MappingManagementNLS.VPMToBOMSide, MappingManagementNLS.BOMToVPMSide,/*, typeMappingRenderer.listOfNotFilteredMappingForCloud*/typeMappingRenderer.isAlreadyCleanForCloud);
                                                PanelResult[0].inject(that.pSkeleton.getActiveIdCard().container);
                                            }
                                        }
                                 
                                    }
                                }
                            }
                        },
                        idCardOptions: {
                            attributesMapping: {
                               // title: 'title',
                                title : function() {
                                    var direction = this._attributes.SynchDirection;
                                    var directionIcon = null;
                                    if (direction === "BOTH")
                                        if (!typeMappingRenderer.isCloudEnv)
                                            directionIcon = "<span class=\"fonticon  fonticon-left-dir\"></span>" + "<span class=\"fonticon  fonticon-right-dir\"></span>";
                                        else
                                            directionIcon = "<span class=\"fonticon  fonticon-right-dir\"></span>";
                                    else if (direction === "VPM_To_MX")
                                        directionIcon = "<span class=\"fonticon  fonticon-right-dir\"></span>";
                                    else if (direction === "MX_To_VPM")
                                        directionIcon = "<span class=\"fonticon  fonticon-left-dir\"></span>";

                                    var title = this._attributes.vpmObject.name + directionIcon + this._attributes.mxObject.name;
                                    return title;
                                },
                                description: function () {
                                },


                            },


                            thumbnail: function () {
                                return {
                                    squareFormat: true,
                                    url: this.get('image')
                                };
                            },


                            actions: function () {
                                var typeCmds = [];
                                return typeCmds;
                            },


                            events: {

                                onFacetSelect: function (facetName) {
                                    var myModel = this.model;
                                    rootMenu.typeMapping.pSkeleton.facetName = facetName;
                                    UWA.log("MyModel onFacetSelect :" + myModel);
                                },
                                onFacetUnselect: function (facetName) {
                                    var myModel = this.model;
                                    UWA.log("MyModel onFacetSelect :" + myModel);
                                },
                                onRouteChange: function (ee) {
                                    UWA.log("MyModel onRouteChange :" + ee);
                                },

         
                                onRender: function () {

                                    typeMappingRenderer.pSkeleton = rootMenu.typeMapping.pSkeleton;
                                    //var listViews = rootMenu.typeMapping.pSkeleton.getViewAt(2).contentsViews.tile.nestedView.children;
                                    //var listView = rootMenu.typeMapping.pSkeleton.getViewAt(3);

                                    Object.keys(rootMenu.typeMapping.pSkeleton.getViewAt(2).contentsViews.tile.nestedView.children).forEach(function (cur) {
                                        var curTypeId = rootMenu.typeMapping.pSkeleton.getViewAt(2).contentsViews.tile.nestedView.children[cur].model.id;
                                        rootMenu.typeMapping.pSkeleton.getViewAt(2).contentsViews.tile.nestedView.children[cur].pSkeleton = rootMenu.typeMapping.pSkeleton;
                                    });

                                    var that = this;
                                    let thumbnail = this.container.getElement(".thumbnail");
                                    thumbnail.setStyle("background-size", "auto");
                                    thumbnail.setStyle("background-position", "center");
                                    thumbnail.setStyle("background-color", "#f4f5f6");


                                    var status = rootMenu.typeMapping.pSkeleton.getActiveIdCard().model.get('deployedStatus');
                                    var container = this.container.getElement(".info-section");
                                    var baseDirection = rootMenu.typeMapping.pSkeleton.getActiveIdCard().model.get('SynchDirection');


                                    var TypeMappingStatus = this.container.getElement(".mappingStatus");

                                    if (TypeMappingStatus === null || TypeMappingStatus == undefined) {



                                        TypeMappingStatus = UWA.createElement('div', {
                                            'class': 'mappingStatus'
                                        });
                                        TypeMappingStatus.inject(container);

                                        UWA.createElement('p', {
                                            text: "Status:",
                                            'class': 'TypeMappingStatus',//'font-3dsbold'
                                            'id': 'typeMappingStatusLabel'
                                        }).inject(TypeMappingStatus);


                                        var divTypeMappingIconStatus = UWA.createElement('div', {
                                            'class': 'MappingStatusIcon',
                                            'id': 'TypeMappingStatusIcon'
                                        }).inject(TypeMappingStatus);


                                        //var resultInvalidMapping = TypeMappingViewUtilities.isInvalidMapping(rootMenu.typeMapping.pSkeleton.getActiveIdCard().model.collection._models, this.model._attributes);
                                        var resultInvalidMapping = this.model.get('invalidStatus');
                                        var isBaseMapping = this.model.get('isBaseMapping');
                                        var iconStatus = "fonticon-lock";
                                        var colorIconStatus = "grey";
                                        var imgTitle = MappingManagementNLS.NotModifiable;

                                        if (!isBaseMapping) {

                                            if (status.indexOf("Removed") !== -1) {

                                                iconStatus = 'fonticon-trash';
                                                if (status.indexOf("Stored") !== -1) {
                                                    imgTitle = MappingManagementNLS.DeletedStoredNotApplied;
                                                    colorIconStatus = "orange";
                                                }
                                                else {
                                                    imgTitle = MappingManagementNLS.DeletedNotApplied;
                                                    colorIconStatus = "red";
                                                }
                                            }

                                            else {
                                                if (status === "Stored") {
                                                    colorIconStatus = 'orange';
                                                    iconStatus = 'fonticon-cog';
                                                    imgTitle = MappingManagementNLS.Stored;
                                                    if (resultInvalidMapping.isInvalid) {
                                                        colorIconStatus = 'red';
                                                        imgTitle = MappingManagementNLS.InvalidDeployed;
                                                    }
                                                }

                                                else {
                                                    colorIconStatus = 'green';
                                                    iconStatus = 'fonticon-check';
                                                    imgTitle = MappingManagementNLS.Deployed;
                                                    if (resultInvalidMapping.isInvalid) {
                                                        colorIconStatus = 'red';
                                                        imgTitle = MappingManagementNLS.InvalidStored;
                                                    }
                                                }
                                                

                                            }

                                           
                                            
                                        };

                                        

                                        TypeMappingViewUtilities.modifySatusDirection(divTypeMappingIconStatus, iconStatus, colorIconStatus, imgTitle);
                                        if (resultInvalidMapping.isInvalid) {
                                            var infoInvalidMappingSpan = UWA.createElement('span', {
                                                'class': 'InfoInvalidMapping fonticon fonticon-info'
                                            }).inject(divTypeMappingIconStatus);

                                            var popoverInfoInvalidMapping = new Popover({
                                                target: infoInvalidMappingSpan,
                                                trigger: "hover",
                                                animate: "true",
                                                position: 'left',
                                                body: resultInvalidMapping.errorMessage,
                                            });

                                            infoInvalidMappingSpan.setStyle("margin-left", '7px');
                                        }

                                    }


                                    var TypeMappingDirection = this.container.getElement(".mappingDirection");

                                    if (TypeMappingDirection === null || TypeMappingDirection == undefined) {

                                        TypeMappingDirection = UWA.createElement('div', {
                                            'class': 'mappingDirection',
                                            'id': 'mappingDirectionSection'
                                        });

                                        TypeMappingDirection.inject(container);

                                        UWA.createElement('p', {
                                            text: "Direction:",
                                            'class': 'TypeMappingDirection',//'font-3dsbold'
                                            'id': 'typeMappingDirectionLabel'
                                        }).inject(TypeMappingDirection);


                                        var divTypeMappingButtonDirection = UWA.createElement('div', {
                                            'class': 'MappingDirectionButton',
                                            'id': 'TypeMappingDirectionButton'
                                        }).inject(TypeMappingDirection);



                                        var directionSpan = UWA.createElement('span').inject(divTypeMappingButtonDirection);

                                        TypeMappingViewUtilities.setTypeMappingDirection(baseDirection, typeMappingRenderer.pSkeleton, typeMappingRenderer.isCloudEnv)


                                        if (!isBaseMapping && !typeMappingRenderer.isCloudEnv) {

                                           TypeMappingViewUtilities.setTypeMappingDirection(baseDirection, typeMappingRenderer.pSkeleton, typeMappingRenderer.isCloudEnv);

                                            var ResetTypeMappingDirection = UWA.createElement('div', {
                                                'class': 'resetMappingDirection',
                                                'id': 'resetMappingDirectionSection',
                                            }).inject(divTypeMappingButtonDirection);

                                            var undoSpan = UWA.createElement('span');
                                            var undoButton = new Button({
                                                id: 'TypeMappingResetButton',
                                                className: 'primary',
                                                icon: 'fonticon fonticon-undo',
                                                attributes: {
                                                    disabled: false,
                                                    'aria-hidden': 'true',
                                                    //title: MappingManagementNLS.UndoDirection
                                                }
                                            });


                          
                                            var spanUndoButton = undoButton.elements.input.childNodes[0];
                                            typeMappingRenderer.undoPopover = new Popover({
                                                target: spanUndoButton,
                                                trigger: "hover",
                                                animate: "true",
                                                position: "top",
                                                body: MappingManagementNLS.undoOperation,
                                                title: ''
                                            });


                                           var modifySpan = UWA.createElement('span');
                                           var modifyButton = new Button({
                                               id: 'TypeMappingModifyButton',
                                               className: 'primary',
                                               icon: 'fonticon fonticon-pencil',
                                               attributes: {
                                                   disabled: false,
                                                   'aria-hidden': 'true',
                                                   title: MappingManagementNLS.ModifyDirectionTitle.format(rootMenu.typeMapping.pSkeleton.getActiveIdCard().model.get('vpmObject').name, rootMenu.typeMapping.pSkeleton.getActiveIdCard().model.get('mxObject').name),
                                               }
                                           })

                                          

                                           var btnArr = [modifyButton, undoButton];

                                           var buttonGroup = new ButtonGroup({
                                               type: "none",
                                               name: "toggle-proposed",
                                               id: "toggle-proposed",
                                               buttons: btnArr,
                                               events: {
                                                   onClick: function (e, button) {
                                                       this.dispatchEvent('onButtonClick', button);
                                                   }
                                               }
                                           }).inject(ResetTypeMappingDirection);

                                           ResetTypeMappingDirection.addEventListener('click', function (e) { e.stopPropagation(); }, false);

                                           

                                            undoButton.hide();
                                            undoButton.addEvent("onClick", function (e) {
                                                UWA.log(e);
                                                undoButton.blur();

                                               
                                                //if (resultInvalidMapping.isInvalid)
                                                   // typeMappingRenderer.userMessaging.add({ className: "error", message: MappingManagementNLS.errorReviveMappingInvalid });
                                                   // else {
                                                var baseDirection = rootMenu.typeMapping.pSkeleton.getActiveIdCard().model.get('SynchDirection');


                                                //Check if an new or modified attribute mapping will have incompatibility direction after restore type direction, in this case block the reset

                                                var nestedView = rootMenu.typeMapping.pSkeleton.getViewAt(3);
                                                var authorizedDirectionAttr = TypeMappingViewUtilities.checkCompatibleDirectionwithAttributeMapping(nestedView.listofTypeRelMapping[0].AttributeMapping, true);
                                                if ((baseDirection === "BOTH" && !authorizedDirectionAttr.BOTH)
                                                    || (baseDirection === "VPM_To_MX" && !authorizedDirectionAttr.VPM_To_MX)
                                                    || (baseDirection === "MX_To_VPM" && !authorizedDirectionAttr.MX_To_VPM))
                                                    typeMappingRenderer.userMessaging.add({ className: "error", message: MappingManagementNLS.InvalidMappingRestoreDatabaseDirection });
                                                else {

                                                    // TypeMappingViewUtilities.setButtonDirection(baseDirection, typeMappingRenderer.directionButton);
                                                    TypeMappingViewUtilities.setTypeMappingDirection(baseDirection, rootMenu.typeMapping.pSkeleton, typeMappingRenderer.isCloudEnv);

                                                    var iconright = ResetTypeMappingDirection.getElement(".fonticon-expand-right");
                                                    var iconleft = ResetTypeMappingDirection.getElement(".fonticon-expand-left");
                                                    var iconboth = ResetTypeMappingDirection.getElement(".fonticon-arrow-combo-horizontal");
                                                    if (iconright !== null && iconright !== undefined) iconright.remove();
                                                    if (iconleft !== null && iconleft !== undefined) iconleft.remove();
                                                    if (iconboth !== null && iconboth !== undefined) iconboth.remove();


                                                    TypeMappingViewUtilities.UpdateTypeMappingStatus(that.model.collection._models, rootMenu.typeMapping.pSkeleton.getActiveIdCard().model._attributes);


                                                    undoButton.hide();
                                                    modifyButton.elements.input.setStyle('border-top-right-radius', '3px');
                                                    modifyButton.elements.input.setStyle('border-bottom-right-radius', '3px');

                                                    //After reset, check if some attribute mapping are now KO due to incopatibility type direction

                                                    var attrTable = nestedView.contentDiv.getElement(".attrstbodyMapping");
                                                    var attributeMappingList = nestedView.listofTypeRelMapping[0].AttributeMapping;
                                                    var cpt = 0;
                                                    for (cpt = 0; cpt < attributeMappingList.length; cpt++) {
           
                                                        MappingViewUtilities.CheckInvalidStatusAndUpdateStatus.call(nestedView,rootMenu.typeMapping.pSkeleton.getActiveIdCard().model.get('vpmObject').id, rootMenu.typeMapping.pSkeleton.getActiveIdCard().model.get('mxObject').id,baseDirection,attributeMappingList[cpt], attrTable)
                                                        
                                                    }

                                                }
                                               // }
                                            });

                                           modifySpan.addEventListener('click', function (e) { e.stopPropagation(); }, false);

                                           modifyButton.addEvent("onClick", function (e) {
                                               UWA.log(e);
                                               modifyButton.blur();
                                               var deployedStatus = rootMenu.typeMapping.pSkeleton.getActiveIdCard().model.get('deployedStatus');
                                               var selectedDirection = MappingViewUtilities.getSelectedTypeRelMappingDirection(rootMenu.typeMapping.pSkeleton, rootMenu.typeMapping.pSkeleton.getActiveIdCard().model._attributes, typeMappingRenderer.isCloudEnv);

                                               //block direction modification if the type mapping is invalide except if the error is already used as source only
                                               if (resultInvalidMapping.isInvalid && !(resultInvalidMapping.errorsList.length == 1 && (resultInvalidMapping.errorsList[0] == 2 || resultInvalidMapping.errorsList[0] == 3))) {
                                                   typeMappingRenderer.userMessaging.add({ className: "error", message: MappingManagementNLS.InvalidMappingModifyDirection });
                                               }
                                               else if (deployedStatus.indexOf("Removed")!== -1)
                                                   typeMappingRenderer.userMessaging.add({ className: "error", message: MappingManagementNLS.ToBeRemovedMappingModifyDirection });
                                               else { 


                                                   //Check if an new or modified attribute mapping will have incompatibility direction after restore type direction, in this case block the reset
                                                   /*var nestedView = typeMappingRenderer.pSkeleton.getViewAt(3);
                                                   var attributeMappingList = nestedView.listofTypeRelMapping[0].AttributeMapping;
                                                   var attrTable = nestedView.contentDiv.getElement(".attrstbodyMapping");
                                                   var IsIncompatibleAfterReset = false;
                                                   var cpt = 0;
                                                   for (cpt = 0; cpt < attributeMappingList.length; cpt++) {
                                                       var attributeMapping = attributeMappingList[cpt];
                                                       if(attributeMapping )
                                                   }*/


                                                   var authorizedDirection = TypeMappingViewUtilities.CheckRulesToAddTypeMapping(that.model.collection._models, that.model.get('vpmObject').id, that.model.get('mxObject').id, that.model.get('KindOfMapping'), that.model._attributes);
                                                   var nestedView = rootMenu.typeMapping.pSkeleton.getViewAt(3);
                                                   var authorizedDirectionAttr = TypeMappingViewUtilities.checkCompatibleDirectionwithAttributeMapping(nestedView.listofTypeRelMapping[0].AttributeMapping);

                                                   authorizedDirection.VPM_To_MX = authorizedDirection.VPM_To_MX && authorizedDirectionAttr.VPM_To_MX;
                                                   authorizedDirection.MX_To_VPM = authorizedDirection.MX_To_VPM && authorizedDirectionAttr.MX_To_VPM ;
                                                   authorizedDirection.BOTH = authorizedDirection.BOTH && authorizedDirectionAttr.BOTH ;
                                                   Array.prototype.push.apply(authorizedDirection.message.VPM_To_MX, authorizedDirectionAttr.message.VPM_To_MX);
                                                   Array.prototype.push.apply(authorizedDirection.message.MX_To_VPM, authorizedDirectionAttr.message.MX_To_VPM);
                                                   Array.prototype.push.apply(authorizedDirection.message.BOTH, authorizedDirectionAttr.message.BOTH);

                                                   //The selected direction is the only one available => don't display side chooser'
                                                   /*if ((!authorizedDirection.BOTH && !authorizedDirection.MX_To_VPM && authorizedDirection.VPM_To_MX && selectedDirection === "VPM_To_MX") 
                                                       || (!authorizedDirection.BOTH && !authorizedDirection.MX_To_VPM && authorizedDirection.VPM_To_MX && selectedDirection === "VPM_To_MX")
                                                       || (authorizedDirection.BOTH && !authorizedDirection.MX_To_VPM && !authorizedDirection.VPM_To_MX && selectedDirection === "BOTH")
                                                           ) {
                                                      
                                                       TypeMappingViewUtilities.displayMappableTypeReaseon(MappingManagementNLS.TypeMappingotherSideNotAvailable, authorizedDirection.message.BOTH, typeMappingRenderer.userMessaging, "error");
                                                   }
                                                   else {*/
                                                       //No direction is available or The selected direction is the only one available => don't display side chooser'
                                                       if ((!authorizedDirection.VPM_To_MX && !authorizedDirection.MX_To_VPM && !authorizedDirection.BOTH)
                                                           ||(!authorizedDirection.BOTH && !authorizedDirection.MX_To_VPM && authorizedDirection.VPM_To_MX && selectedDirection === "VPM_To_MX")
                                                           || (!authorizedDirection.BOTH && !authorizedDirection.VPM_To_MX && authorizedDirection.MX_To_VPM && selectedDirection === "MX_To_VPM")
                                                           || (authorizedDirection.BOTH && !authorizedDirection.MX_To_VPM && !authorizedDirection.VPM_To_MX && selectedDirection === "BOTH")
                                                       ) {
                                                           var cpt = 0;

                                                           //merge the message without doublon
                                                           var messageSet = new Set();
                                                           authorizedDirection.message.MX_To_VPM.forEach(messageSet.add, messageSet);
                                                           authorizedDirection.message.VPM_To_MX.forEach(messageSet.add, messageSet);
                                                           authorizedDirection.message.BOTH.forEach(messageSet.add, messageSet);
                                                           var message = Array.from(messageSet);
                                                          /* var messageList = "";
                                                           for (cpt = 0; cpt < message.length; cpt++) {
                                                               messageList = messageList + "\n" + TypeMappingViewUtilities.mappableTypeReaseon[message[cpt]];
                                                           }
                                                           typeMappingRenderer.userMessaging.add({ className: "warning", message: "modify side is not possible:\n" + messageList });*/
                                                           TypeMappingViewUtilities.displayMappableTypeReaseon(MappingManagementNLS.TypeMappingotherSideNotAvailable,message, typeMappingRenderer.userMessaging,"error");
                                                       }
                                                       else {

                                                           if (DecoratorManager.isDecoratorDisplayed()) {
                                                               DecoratorManager.hideDecorator(false, true);
                                                           } else {
                                                               DecoratorManager.showDecorator(modifyButton, modifyButton, "mappingDirectionDecorator");
                                                               var decorator = DecoratorManager.getDecorator();
                                                               if (directionSpan.value === "VPM_To_MX") {
                                                                   if (authorizedDirection.BOTH && authorizedDirection.MX_To_VPM)
                                                                       decorator.activeView = "viewB";
                                                                   else if (!authorizedDirection.BOTH) {
                                                                       TypeMappingViewUtilities.displayMappableTypeReaseon(MappingManagementNLS.BothDirectionNotAvailable, authorizedDirection.message.BOTH, typeMappingRenderer.userMessaging,"warning");
                                                                       decorator.activeView = "viewE";
                                                                   }
                                                                   else if (!authorizedDirection.MX_To_VPM) {
                                                                       TypeMappingViewUtilities.displayMappableTypeReaseon(MappingManagementNLS.MXtoVPMDirectionNotAvailabe, authorizedDirection.message.MX_To_VPM, typeMappingRenderer.userMessaging,"warning");
                                                                       decorator.activeView = "viewF";
                                                                   }
                                                               }
                                                               else if (directionSpan.value === "MX_To_VPM") {
                                                                   if (authorizedDirection.BOTH && authorizedDirection.VPM_To_MX)
                                                                       decorator.activeView = "viewC";
                                                                   else if (!authorizedDirection.BOTH) {
                                                                       TypeMappingViewUtilities.displayMappableTypeReaseon(MappingManagementNLS.BothDirectionNotAvailable,authorizedDirection.message.BOTH, typeMappingRenderer.userMessaging, "warning");
                                                                       decorator.activeView = "viewD";
                                                                   }
                                                                   else if (!authorizedDirection.VPM_To_MX) {
                                                                       TypeMappingViewUtilities.displayMappableTypeReaseon(MappingManagementNLS.VPMtoMXDirectionNotAvailabe,authorizedDirection.message.VPM_To_MX, typeMappingRenderer.userMessaging,"warning");
                                                                       decorator.activeView = "viewF";
                                                                   }
                                                               }
                                                               else if (directionSpan.value === "BOTH") {
                                                                   if (authorizedDirection.VPM_To_MX && authorizedDirection.MX_To_VPM)
                                                                       decorator.activeView = "viewA";
                                                                   else if (!authorizedDirection.VPM_To_MX) {
                                                                       TypeMappingViewUtilities.displayMappableTypeReaseon(MappingManagementNLS.VPMtoMXDirectionNotAvailabe,authorizedDirection.message.VPM_To_MX, typeMappingRenderer.userMessaging,"warning");
                                                                       decorator.activeView = "viewE";
                                                                   }
                                                                   else if (!authorizedDirection.MX_To_VPM) {
                                                                       TypeMappingViewUtilities.displayMappableTypeReaseon(MappingManagementNLS.MXtoVPMDirectionNotAvailabe, authorizedDirection.message.MX_To_VPM, typeMappingRenderer.userMessaging,"warning");
                                                                       decorator.activeView = "viewD";
                                                                   }
                                                               }
                                                               DecoratorManager.showDecorator(modifyButton, modifyButton, "mappingDirectionDecorator");
                                                               MappingViewUtilities.addTooltipToDecorator();
                                                           }
                                                       }

                                                  // }

                                             

                  


                
                                               }
                                           });
                                        }

                                    }
                                    //Called in case of Apply
                                    else {
                                        var isBaseMapping = rootMenu.typeMapping.pSkeleton.getActiveIdCard().model.get('isBaseMapping');
                                        if (!isBaseMapping) {
                                            if (!typeMappingRenderer.isCloudEnv) {
                                                var selectedDirection = MappingViewUtilities.getSelectedTypeRelMappingDirection(rootMenu.typeMapping.pSkeleton, rootMenu.typeMapping.pSkeleton.getActiveIdCard().model, typeMappingRenderer.isCloudEnv);
                                                if (baseDirection === selectedDirection) {

                                                    TypeMappingViewUtilities.removeResetDirectionButton(TypeMappingDirection);
                                                }
                                            }
                                        }
                                    }

                                }

                            },
                            facets: function () {

                                // Collaboration Management
                                return [{
                                    text: "VPM / ENG",
                                    icon: 'tools',
                                    handler: Skeleton.getRendererHandler('mappingVPMPartrenderer')
                                }];
                            }

                        },
                    }
                };
               // return rootMenu;
                skeletonView.rendererMap = Object.assign(rootMenu, skeletonView.rendererMap);
            }
        }
        return typeMappingRenderer;

    });

/*@fullReview  ZUR 15/11/23 2017x Param Widgetization NG*/
/*global define, widget, document, setTimeout, console*/
/*jslint nomen: true */
define('DS/ParameterizationSkeleton/Collection/ParamCollaboration/ParameterizationTypeMappingCollection', [
                                                                                                       // UWA
                                                                                                       'UWA/Core',
                                                                                                       'UWA/Class/Model',
                                                                                                       'UWA/Class/Collection',
	                                                                                                   'DS/ParameterizationSkeleton/Model/ParamCollaboration/TypeListMappingModel',
	                                                                                                   'DS/ParameterizationSkeleton/Views/ParamCollaboration/TypeMapping/typeMappingRenderer',
                                                                                                       'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
                                                                                                       'DS/WAFData/WAFData',
                                                                                                       'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
], function (UWA, Model, Collection, MappingModel, typeMappingRenderer, ParameterizationDataUtils, WAFData, URLHandler) {
	'use strict';
	//

	var handledDomain = null;

	//var  ParameterizationParentCol = 
	return Collection.extend({
		model : function (modelid) {
			return MappingModel;
		},

		//model:ParameterizationDomainModel,
		setup: function (models, options) {
			UWA.log('ParameterizationCommonCollection::setup');
			//this.childCollection = null;

			UWA.log(models);
			UWA.log(options);
			/*var options2 = this.options;
            UWA.log(options2);*/

			console.log("ParameterizationCommonCollection::setup, la suite");
			var iURL, iObjID,
			_modelKey = options._modelKey,
			domainID = _modelKey._attributes.domainid,
			familyID = _modelKey._attributes.familyid;

			if (UWA.is(this.model, "function")) {
				this.model = this.model(domainID);
				handledDomain = domainID;
			}

			iObjID = _modelKey._attributes.id;
			this.url = URLHandler.getURL() +
			"/resources/MappingWS/mapping/typemappinginformation?tenant=" + URLHandler.getTenant();

		},

		sync : function(method, model, options) {
			UWA.log('ParameterizationCommonCollection::sync');
			options.contentType = 'application/json';//application/ds-json
			//options.proxy = 'passport';
			options.lang = widget.lang;

			options.headers = {
					Accept: 'application/json',
					'Content-Type': 'application/json',
					'Accept-Language' : widget.lang
			};

			UWA.log(options);

			options = Object.assign({
				ajax: WAFData.authenticatedRequest
			}, options);  
			//console.log(model);
			//this.childCollection.sync(method, model, options);
			this._parent.apply(this, [method, model, options]);
		},

		parse: function (data) {
			UWA.log("ParameterizationParentCollection::parse");
			//return this.childCollection.parse(data);
			UWA.log(data);

			return this.parseMappingData(data);

		},

		create: function(attributes, options) {
			options.proxy = 'passport';
			this._parent.apply(this, [attributes, options]);
		},
		
		getStatusIcon: function(status) {
			var statusIconSpan = UWA.createElement('span', {
				'class' : "fonticon fonticon-2x fonticon-check"
			});

			statusIconSpan.setStyle("color", "green");
			return statusIconSpan;
		},



		parseMappingData: function (data) {
			

			UWA.log("LifecycleCollection::parse");
			UWA.log(data);

			//MappingNodeModel = ParameterizationDataUtils.paramStructBuilder("id,TypeRelMapping");
			
			var paramEntries = []
			//rMapping = new MappingNodeModel("", "");

			//typeMappingRenderer.listOfNotFilteredMappingForCloud = new Array();

		

			/*var tenant = URLHandler.getTenant();
			var isCloud = true;
			if (tenant !== undefined && tenant !== 'OnPremise') this.isCloudEnv = true;*/

			var isCloudEnv  = typeMappingRenderer.isCloudEnv;

			if (Array.isArray(data.typeRelMapping)) {
				data.typeRelMapping.forEach(function (rTypeRelMapping) {

					 {
						var ancestorArray = [];
						if (Array.isArray(rTypeRelMapping.ancestor)) {
							rTypeRelMapping.ancestor.forEach(function (rAncestor) {

								var syncDirectionAncestor = rAncestor.synchDirection;
								if (isCloudEnv && rAncestor.synchDirection == "BOTH" && !rAncestor.isBaseMapping)
									syncDirectionAncestor = "VPM_To_MX";

								if (!isCloudEnv || syncDirectionAncestor != "MX_To_VPM") {
									ancestorArray.push({
										id: rAncestor.vpmObject.id + "|" + rAncestor.mxObject.id,
										title: rAncestor.vpmObject.name + "\/" + rAncestor.mxObject.name,
										vpmObject: rAncestor.vpmObject,
										mxObject: rAncestor.mxObject,
										KindOfMapping: rAncestor.kindOfMapping,
										SynchDirection: syncDirectionAncestor,
										isBaseMapping: rAncestor.isBaseMapping,
										deployedStatus: rAncestor.deployedStatus,
									});
								}
							});
						}

						var isRemoved = "";
						if (rTypeRelMapping.deployedStatus.indexOf("Removed") !== -1)
							isRemoved = "_Removed";
						var KindOfMapping = rTypeRelMapping.kindOfMapping;

						var syncDirection = rTypeRelMapping.synchDirection;
						if (isCloudEnv && rTypeRelMapping.synchDirection == "BOTH" && !rTypeRelMapping.isBaseMapping)
							syncDirection = "VPM_To_MX";

						var typeMappingToAdd = {
							id: rTypeRelMapping.vpmObject.id + "|" + rTypeRelMapping.mxObject.id + isRemoved,
							title: rTypeRelMapping.vpmObject.name + "\/" + rTypeRelMapping.mxObject.name,
							//content : "status:"+  "<span class=\"fonticon  fonticon-check\" style=\"color:green\"></span>",
							//subtitle : "direction:" + "<span class=\"fonticon  fonticon-left-dir\"></span>"+"<span class=\"fonticon  fonticon-right-dir\"></span>",
							domainid: 'TypeMapping',
							image: (KindOfMapping === "TYPE") ? URLHandler.getURL() + "/webapps/ParameterizationSkeleton/assets/img/" + "paramMappingManagementType.png" : URLHandler.getURL() + "/webapps/ParameterizationSkeleton/assets/img/" + "paramMappingManagementRel.png",
							vpmObject: rTypeRelMapping.vpmObject,
							mxObject: rTypeRelMapping.mxObject,
							KindOfMapping: rTypeRelMapping.kindOfMapping,
							SynchDirection: syncDirection,
							isBaseMapping: rTypeRelMapping.isBaseMapping,
							deployedStatus: rTypeRelMapping.deployedStatus,
							ancestor: ancestorArray,
							invalidStatus: { isInvalid: false, errorMessage: '', errorsList: '' },
							isInEdition: false,
						}

						if (!isCloudEnv || rTypeRelMapping.synchDirection != "MX_To_VPM")
							paramEntries.push(typeMappingToAdd);
						//else typeMappingRenderer.listOfNotFilteredMappingForCloud.push(typeMappingToAdd);
					}
					});
			
			}


			//listofRules, typeCategory, typeID, typeNLS

			//rMapping.id = data.id;
			//rMapping.TypeRelMapping = TypeRelMapping;
			return paramEntries;
		}






	});

	//return ParameterizationParentCol;

	//return ParameterizationParentCol;
});

/*global define, widget, document, setTimeout, console, clearTimeout, FileReader*/
/*jslint plusplus: true*/
/*jslint nomen: true*/
/*! Copyright 2017, Dassault Systemes. All rights reserved. */
/*@fullReview  CN1     18/05/15 2019xBeta2 Mapping Widget*/
define('DS/ParameterizationSkeleton/Views/ParamCollaboration/AttributeMapping/MappingLayoutView',
		[
		 'UWA/Core',
		 'UWA/Class/View',
		 'DS/UIKIT/Modal',
		 'DS/UIKIT/Popover',
		 'DS/UIKIT/Mask',
		 'DS/UIKIT/Scroller',
		 'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
		 'DS/ParameterizationSkeleton/Views/ParamCollaboration/AttributeMapping/MappingViewUtilities',
		 'DS/ParameterizationSkeleton/Views/ParamCollaboration/TypeMapping/TypeMappingViewUtilities',
         'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
         'DS/ParameterizationSkeleton/Views/ParamCollaboration/TypeMapping/typeMappingRenderer',
		 'DS/UIKIT/Input/Button',
		 'DS/UIKIT/Input/ButtonGroup',
		 'DS/UIKIT/Input/Select',
		 'DS/UIKIT/Input/Toggle',
         'DS/UIKIT/Alert',
         'DS/UIKIT/Accordion',
		 'DS/Controls/DecoratorManager',
		 'i18n!DS/ParameterizationSkeleton/assets/nls/MappingManagementNLS',
		 'DS/WAFData/WAFData',
		 ],
		 function (UWA, View,
				 Modal,
				 Popover, Mask, Scroller,
			 ParametersLayoutViewUtilities, MappingViewUtilities, TypeMappingViewUtilities,
			 URLHandler, typeMappingRenderer, Button, ButtonGroup, Select, Toggle, Alert, Accordion, DecoratorManager,
				 MappingManagementNLS,WAFData) {

	'use strict';

	var extendedView;

	extendedView = View.extend({
		tagName: 'div',
		className: 'generic-detail',

		init: function (options) {
			var initDate =  new Date();

			options = UWA.clone(options || {}, false);
			this._parent(options);
			this.contentDiv = null;
			this.paramScroller = null;
			this.userMessaging = null;
			this.lastAlertDate = initDate.getTime();
			this.controlDiv = null;
			this.typeMappingPage = null;
            this.wdthArrayAttr = [32, 11, 32, 5, 10, 10];
            this.wdthArrayInheritedAttr = [27, 11, 27, 10, 25];
			this.divMapping = null;
			this.baseAccordion=null;
			this.listOfCustoVPMType=new Map();
			this.listOfCustoPartType=new Map();
			this.divBaseMapping;
			this.listofTypeRel;
			this.listofTypeRelMapping;
			this.isBaseTypeMapping;
			this.userMessaging=null;
			this.listNewSelect = new Array();
			this.listInvalidMultipeTargetMapping= new Array();
            this.attributeMappingMap = { VPM: new Map(), MX: new Map() };
            this.pSkeleton = typeMappingRenderer.pSkeleton;
			this.typeRelDirection = this.pSkeleton.getActiveIdCard().model.get('SynchDirection');
			this.TypeMappingCollection = this.pSkeleton.getActiveIdCard().model.collection._models;
			this.typeRelMapping = this.pSkeleton.getActiveIdCard().model._attributes;
			this.isCloudEnv = options.contents.isCloudEnv;
		},

		setup: function(options) {
			UWA.log('AttributesLayoutView::setup!');
            UWA.log(options);
		},

		render: function () {
			UWA.log("AttributesLayoutView::render");
			var introDiv,
			mappingDiv,
				that = this;

			MappingViewUtilities.init(this.isCloudEnv);

			this.contentDiv = UWA.createElement('div', { 'id': 'typeMainDiv' });

			this.typeMappingPage = document.querySelector('.skeleton.expanded .right .skeleton-panel');
			//Mask.mask(this.contentDiv);
			Mask.mask(this.typeMappingPage);
			
			this.userMessaging = new Alert({
                className : 'param-alert',
                closable: true,
                visible: true,
                renderTo : document.body,
                autoHide : true,
                hideDelay : 2000,
                messageClassName : 'warning'
            });

			introDiv = UWA.createElement('div', {'class': 'information'}).inject(this.contentDiv);

			UWA.createElement('p', {
				text   : MappingManagementNLS.intro,
				'class': 'font-3dslight'//'font-3dsbold'
			}).inject(introDiv);

			
	
			this.container.setContent(this.contentDiv);
			this.listenTo(this.collection, {
				onSync: that.onCompleteRequestMapping
			});

			return this;
		},


		onCompleteRequestMapping : function() {

			UWA.log("MappingLayoutView::onCompleteRequestMapping");
			var resultDiv;
			var that=this;
			var MatrixType, VPMType, side, line, i, j, kindOfMapping, listofAttributesMapping, listofInheritedAttributesMapping,listofChildAttributesMapping,listOfAllAttributesMapping, TypeName, DerivedFrom , listOfAttributeInfos, isBaseMapping, isDeployed;
			var AddMappingAttributeButton,divMapping,MatrixTypeRelInfo,VPMTypeRelInfo,attrtbodyNew;

					
			this.listenTo(this.pSkeleton.getActiveIdCard().model.collection, {
				onAdd: that.UpdateAvailableDirectionWithAddedTypeMapping
			});
			
			this.divMapping = UWA.createElement('div', {
				'class': 'DivMappingScroll',
			}).inject(this.contentDiv);
			
			//Recupération des types et leur attributs
			this.listofTypeRel = this.collection._models[0]._attributes.TypeRelInfo;
			this.listofTypeRelMapping = this.collection._models[0]._attributes.TypeRelMapping;
			this.isBaseTypeMapping = this.typeRelMapping.isBaseMapping;

			for (i = 0; i < this.listofTypeRel.length; i++)
			{
				TypeName = this.listofTypeRel[i].id;
				DerivedFrom=this.listofTypeRel[i].derivedFrom;
				listOfAttributeInfos = this.listofTypeRel[i].AttributeInfo;

				if (DerivedFrom === "VPMReference" || TypeName === "VPMReference" || DerivedFrom === "VPMInstance" || TypeName === "VPMInstance")
					this.listOfCustoVPMType.set(TypeName, this.listofTypeRel[i]);
				else if (DerivedFrom === "Part" || TypeName === "Part" || DerivedFrom === "EBOM" || TypeName === "EBOM")
					this.listOfCustoPartType.set(TypeName, this.listofTypeRel[i]);
				/*else if (DerivedFrom === "VPMInstance"|| TypeName==="VPMInstance")
					this.listOfCustoVPMRel.set(TypeName,this.listofTypeRel[i]);
				else if (DerivedFrom === "EBOM"|| TypeName==="EBOM")
					this.listOfCustoEBOMRel.set(TypeName,this.listofTypeRel[i]);*/
			}

			resultDiv = UWA.createElement('div', {'class': 'result'}).inject(this.contentDiv);


			//First manage mapping only between Product/part=> typeRelMapping must be equald to 1
			//for (i = 0; i < this.listofTypeRelMapping.length; i++) 
			if(this.listofTypeRelMapping.length === 1)
			{

				
				MatrixType = this.listofTypeRelMapping[0].MatrixObject;
				VPMType = this.listofTypeRelMapping[0].VPMObject;
				side  = this.listofTypeRelMapping[0].SynchDirection;
				kindOfMapping = this.listofTypeRelMapping[0].KindOfMapping;
                listofAttributesMapping = this.listofTypeRelMapping[0].AttributeMapping;
                listofInheritedAttributesMapping = this.listofTypeRelMapping[0].InheritedAttributeMapping;
				listofChildAttributesMapping = this.listofTypeRelMapping[0].ChildAttributeMapping;

				isBaseMapping = this.listofTypeRelMapping[0].isBaseMapping;
				status = this.listofTypeRelMapping[0].status;

				VPMTypeRelInfo = this.listOfCustoVPMType.get(VPMType);
				MatrixTypeRelInfo = this.listOfCustoPartType.get(MatrixType);


				var mappingTable = MappingViewUtilities.buildMappingLine.call(that,/*this.listofTypeRelMapping[0]*/this.typeRelMapping);

               var accordion = new Accordion({
                    className: 'styled divided filled',
                    exclusive: false,
                    items: []
                }).inject(this.divMapping);
              
				//attribute table
				var attributeMappingDiv = UWA.createElement('div', {
					'class': 'attributeMapping'
                })/*.inject(this.divMapping )*/;//table-bordered

               accordion.addItem({
				   title: MappingManagementNLS.attributeMappingSection,
                    content: attributeMappingDiv,
                    selected: true,
                    name: "directAttributeMappping",
			   });

				var inheritedMappingDiv = UWA.createElement('div', {
					'class': 'attributeMapping'
				});

				//Add child attribute mapping info to check mapping rules²
				MappingViewUtilities.addChildAttributeMappingInfo.call(that, VPMTypeRelInfo, MatrixTypeRelInfo, listofChildAttributesMapping);

				var inheritedAttributesTable;
				if (!this.isBaseTypeMapping) {
					inheritedAttributesTable = MappingViewUtilities.buildAttributeTable.call(that, this.TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, this.typeRelMapping, kindOfMapping, listofInheritedAttributesMapping, that.wdthArrayInheritedAttr, [], true, that.pSkeleton);
					


					accordion.addItem({
						title: MappingManagementNLS.inheritedAttributeMappingSection,
						content: inheritedMappingDiv,
						selected: false,
						name: "inheritedAttributeMappping",
					});
				}


				var attributesTable = MappingViewUtilities.buildAttributeTable.call(that, this.TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, this.typeRelMapping,kindOfMapping,listofAttributesMapping,that.wdthArrayAttr,that.listofTypeRelMapping,false,that.pSkeleton);
				attributesTable.inject(attributeMappingDiv);
				
				var attributesTableNew = UWA.createElement('table', {
					'class': 'attrTableMappingNew table table-condensed'
				});

				attrtbodyNew =  UWA.createElement('tbody', {
					'class': 'attrstbodyNewMapping'
				}).inject(attributesTableNew);
				
				var attrtbody = attributesTable.getElement(".attrstbodyMapping")
				
				var AddMappingButton = new Button({
					className: 'AddMappingButton primary',
					icon: 'plus-circled',
					attributes: {
						disabled: false,
						'aria-hidden' : 'true',
						title : MappingManagementNLS.AddAttributeMappingTooltip,
					},
					events: {
						//onClick: that.ShowAddMappingAttributePanel.bind(that,this.listofTypeRelMapping[i],side,kindOfMapping,attributesTable.getElement(".attrstbodyMapping"))
						
						onClick: that.AddNewAttributeMappingLine.bind(that, this.TypeMappingCollection, this.typeRelMapping, kindOfMapping/*,attrtbodyNew*/, attrtbody, listofAttributesMapping)
					
					}
				}).inject(attributeMappingDiv);
				
				
				attributesTableNew.inject(attributeMappingDiv);
				if (!this.isBaseTypeMapping)
					inheritedAttributesTable.inject(inheritedMappingDiv);

			}


			this.paramScroller = new Scroller({
                element: this.divMapping,
            }).inject(this.contentDiv);

			
			
			var divAddMapping = UWA.createElement('div', {
				'class': 'AddMapping'//'font-3dsbold'
			}).inject(this.contentDiv);
			

			//Mask.unmask(this.contentDiv);

			this.controlDiv = MappingViewUtilities.createApplyResetDeleteToolbar.call(this, this.contentDiv,
				this.applyParams.bind(this), this.resetParams.bind(this), this.deleteParams.bind(this), !this.isBaseTypeMapping);

			Mask.unmask(this.typeMappingPage);
		},


		UpdateAvailableDirectionWithAddedTypeMapping: function (model, collection, options) {
			this.TypeMappingCollection = this.pSkeleton.getActiveIdCard().model.collection._models;

		},
		
		resetParams : function () {
			UWA.log("applyReset");
			var that = this;

			var deployedStatus = this.typeRelMapping.deployedStatus
			if (deployedStatus === "Stored" || deployedStatus == "RemovedStored") {
				this.userMessaging.add({ className: "warning", message: MappingManagementNLS.BlockReset });
			}

			else {

				if (deployedStatus === "RemovedDeployed") {
					var resultInvalidMapping = TypeMappingViewUtilities.isInvalidMapping(that.model.collection._models, that.model._attributes);
					if (resultInvalidMapping.isInvalid) {
						typeMappingRenderer.userMessaging.add({ className: "error", message: MappingManagementNLS.errorReviveMappingInvalid });
						return;
					}
					else {
						TypeMappingViewUtilities.RestoreTypeMapping(that.pSkeleton, that.model.collection, that.model._attributes, typeMappingRenderer.isAlreadyCleanForCloud);
					}
				}

				Mask.mask(this.typeMappingPage);
				var mappingToSend = new Array();
				mappingToSend.push(this.typeRelMapping);

				datatoSend = {
					typeMapping: mappingToSend,
				};

				var url = URLHandler.getURL() + "/resources/MappingWS/mapping/resetmapping?tenant=" + URLHandler.getTenant() + "&isAlreadyCleanForCloud=" + typeMappingRenderer.isAlreadyCleanForCloud.value, datatoSend;

				WAFData.authenticatedRequest(url, {
					timeout: 100000,
					method: 'POST',
					data: JSON.stringify(datatoSend),
					type: 'json',
					//proxy: 'passport',

					headers: {
						'Content-Type': 'application/json',
						'Accept': 'application/json'
					},

					onFailure: function (json) {
						that.onResetFailure.call(that, json);
					},

					onComplete: function (json) {
						that.onResetSuccess.call(that, json);
						if (that.isCloudEnv)
							typeMappingRenderer.isAlreadyCleanForCloud.value = true;
					}

				});
			}

			//this.UpdateCommonParamsOnServer();
		},

		
		onResetFailure : function (json) {
			UWA.log(json);
			Mask.unmask(this.typeMappingPage);
			// Mask.unmask(this.contentDiv);//Rb0afx
			// this.userMessaging.add({ className: "error", message: ParamDataModelingNLS.deployFailureMsg });
			this.userMessaging.add({ className: "warning", message: MappingManagementNLS.ErrorReset });
			//ParamLayoutUtilities.updateIcon(false, theImageCell);
		},

		deleteParams: function () {
			UWA.log("deleteParams");
			var that = this;
			var typeModel = this.model;
			TypeMappingViewUtilities.showContextualDeleteTypeMappingModal(this.pSkeleton.getActiveIdCard().container, "RemoveTypeMappingPanel", MappingManagementNLS.PanelRemoveMessage, MappingManagementNLS.PanelRemoveOk, MappingManagementNLS.PanelRemoveCancel, MappingManagementNLS.PanelRemoveTitle, that.pSkeleton, that.model.collection, that.model, typeMappingRenderer.isAlreadyCleanForCloud);

		},


		applyParams : function () {
			UWA.log("applyParams");
			var datatoSend, that=this;
			var mappingToSend = new Array();
			var attrMappingPartProduct = this.collection._models[0]._attributes.TypeRelMapping[0].AttributeMapping;
			var VPMTypeRel = this.collection._models[0]._attributes.TypeRelMapping[0].VPMObject;
			var MatrixTypeRel = this.collection._models[0]._attributes.TypeRelMapping[0].MatrixObject;
            var kindOfMapping = this.collection._models[0]._attributes.TypeRelMapping[0].KindOfMapping;
			var synchDirection = this.collection._models[0]._attributes.TypeRelMapping[0].SynchDirection;
			//var deployedStatus = this.collection._models[0]._attributes.TypeRelMapping[0].status;
			var deployedStatus = this.pSkeleton.getActiveIdCard().model.get('deployedStatus')
			var DirectionToModify = synchDirection;

			if (deployedStatus === "RemovedDeployed" || deployedStatus === "RemovedStored") {
				TypeMappingViewUtilities.RemoveTypeMapping(this.pSkeleton, this.model.collection, this.model, typeMappingRenderer.isAlreadyCleanForCloud);
			}

			else{

				if (!this.typeRelMapping.isBaseMapping)
					DirectionToModify = MappingViewUtilities.getSelectedTypeRelMappingDirection(this.pSkeleton, this.typeRelMapping, this.isCloudEnv );

				var i = 0;
				Mask.mask(this.typeMappingPage);
				//var typeVPMInfo = this.listOfCustoVPMType.get("VPMReference");
				//var typePartInfo = this.listOfCustoPartType.get("Part");

				var resultInvalidTypeMapping = TypeMappingViewUtilities.isInvalidMapping(this.TypeMappingCollection, this.typeRelMapping, DirectionToModify);

				var resultMappingToSend = MappingViewUtilities.BuildMappingToSend(this.typeRelMapping, attrMappingPartProduct);

				if (resultMappingToSend.isInvalidMapping || resultInvalidTypeMapping.isInvalid) {
					Mask.unmask(this.typeMappingPage);
					this.userMessaging.add({ className: "error", message: MappingManagementNLS.InvalidTypeMapping });
				}
				else {
					var isExistNonDeployedInheritedMapping = false;
					if (!this.isBaseTypeMapping) {
						var listInheritedMapping = this.listofTypeRelMapping[0].InheritedAttributeMapping;
						while (i < listInheritedMapping.length && !isExistNonDeployedInheritedMapping) {
							var inheritedMapping = listInheritedMapping[i];
							if (inheritedMapping.status !== 'Deployed') isExistNonDeployedInheritedMapping = true;
							i++;
						}
					}

					if (isExistNonDeployedInheritedMapping) {
						Mask.unmask(this.typeMappingPage);
						this.userMessaging.add({ className: "error", message: MappingManagementNLS.NonDeployedInheritedAttributeMapping });
					}

					else {
						datatoSend = {
							AttributeMapping: resultMappingToSend.mappingToSend,//this.collection._models[0]._attributes.TypeRelMapping,
							VPMTypeRel: VPMTypeRel,
							MatrixTypeRel: MatrixTypeRel,
							kindOfMapping: kindOfMapping,
							synchDirection: synchDirection,
							DirectionToModify: DirectionToModify,
							deployedStatus: deployedStatus
						};


						var url = URLHandler.getURL() + "/resources/MappingWS/mapping/postmapping?tenant=" + URLHandler.getTenant() + "&isAlreadyCleanForCloud=" + typeMappingRenderer.isAlreadyCleanForCloud.value, datatoSend;

						WAFData.authenticatedRequest(url, {
							timeout: 250000,
							method: 'POST',
							data: JSON.stringify(datatoSend),
							type: 'json',
							//proxy: 'passport',

							headers: {
								'Content-Type': 'application/json',
								'Accept': 'application/json'
							},

							onFailure: function (json) {
								that.onApplyFailure.call(that, json);
							},

							onComplete: function (json) {
								that.onApplySuccess.call(that, json);
								if (that.isCloudEnv)
									typeMappingRenderer.isAlreadyCleanForCloud.value = true;
							}

						});
					}
				}
			}

			//this.UpdateCommonParamsOnServer();
		},

		onApplyFailure : function (json) {
			UWA.log(json);
			// Mask.unmask(this.contentDiv);//Rb0afx
			// this.userMessaging.add({ className: "error", message: ParamDataModelingNLS.deployFailureMsg });
			Mask.unmask(this.typeMappingPage);
			if (json.message != undefined && json.message.includes("timedout")) {
				UWA.log("import Time out :" + json.message);
				this.userMessaging.add({ className: "warning", message: ParamSkeletonNLS.ImportTimeOut });
			} else {
				this.userMessaging.add({ className: "error", message: MappingManagementNLS.applyErrorMessage });
			}
		},

		onApplySuccess : function (json) { //Rb0afx                      
		
			var cpt=0,cptAttr=0,item,title,line,cell,nbofLines,mappingElt,imgSpan, itemToRemove = new Array(), that=this, currDate, currTime, diffDate;
			Mask.unmask(this.typeMappingPage);

			if (json.deployStatus === "S_SUCCESS") {
				currDate = new Date();
				currTime = currDate.getTime();
				diffDate = currTime - this.lastAlertDate;
				this.lastAlertDate = currTime;

				this.lastAlertDate = currTime;
				if (diffDate >= 2000) {
					this.userMessaging.add({ className: "success", message: MappingManagementNLS.applySuccessMessage });
				}

				if (!this.typeRelMapping.isBaseMapping) {
					var DirectionToModify = "BOTH";
					DirectionToModify = MappingViewUtilities.getSelectedTypeRelMappingDirection(this.pSkeleton, this.typeRelMapping, this.isCloudEnv);
					// var direction = this.pSkeleton.getActiveIdCard().model.get('SynchDirection');
					var model = this.pSkeleton.getActiveIdCard().model;
					var previousDirection = model.get('SynchDirection', DirectionToModify);
					model.set('SynchDirection', DirectionToModify);
					model.set('deployedStatus', 'Deployed');
					this.collection._models[0]._attributes.TypeRelMapping[0].SynchDirection = DirectionToModify;

					//update type mapping status
					var typeMappingStatusDiv = document.getElementById("TypeMappingStatusIcon");
					var iconStatus = 'fonticon-check';
					var colorIconStatus = 'green';

					TypeMappingViewUtilities.modifySatusDirection(typeMappingStatusDiv, iconStatus, colorIconStatus);

					var TypeMappingResetDirection = document.getElementById("resetMappingDirectionSection");
					TypeMappingViewUtilities.removeResetDirectionButton(TypeMappingResetDirection);
				}


				var attrTable = this.contentDiv.getElement(".attrstbodyMapping");
				var attrTableNew = this.contentDiv.getElement(".attrstbodyNewMapping");

				MappingViewUtilities.onApplySuccessForAttributes(this.typeRelMapping, this.listofTypeRelMapping[0].AttributeMapping, attrTable/*item.elements.content.children[0]*/, attrTableNew);

				//var InvalidMappingToRemove = new Array();
				var i = 0;
				for (i = 0; i < this.TypeMappingCollection.length; i++) {

					var TypeMappingLoop = this.TypeMappingCollection[i]._attributes;

					if (((TypeMappingLoop.vpmObject.id === this.typeRelMapping.vpmObject.id && (previousDirection === "BOTH" || previousDirection === "VPM_To_MX"))
						||
						(TypeMappingLoop.mxObject.id === this.typeRelMapping.mxObject.id && (previousDirection === "BOTH" || previousDirection === "MX_To_VPM")))) {

						this.TypeMappingCollection[i].dispatchEvent("onChange", [this.TypeMappingCollection[i]]);

					}
				}

				while (this.listNewSelect.length > 0) {
					this.listNewSelect.pop();
				}
			}
			else {
				this.onApplyFailure(json);
            }
		},


		onResetSuccess: function () {

			var that = this;
			Mask.unmask(this.typeMappingPage);
			this.userMessaging.add({ className: "success", message: MappingManagementNLS.resetSuccessMessage });
			MappingViewUtilities.onResetSuccessForAttributes.call(that);
			
		},
		
		
		AddNewAttributeMappingLine: function (TypeMappingCollection, typeMapping, kindOfMapping,/*attrtbodyNew,*/attrtbody, listofAttributesMapping)
		{
			if (typeMapping.invalidStatus.isInvalid || typeMapping.deployedStatus.indexOf("Removed")!=-1) {
				this.userMessaging.add({ className: "warning", message: MappingManagementNLS.BlockAddAttributeMapping });
			}
			else {
				var VPMTypeRelInfo = this.listOfCustoVPMType.get(typeMapping.vpmObject.id);

				var MatrixTypeRelInfo = this.listOfCustoPartType.get(typeMapping.mxObject.id);

				var lineAttr = MappingViewUtilities.addNewAttributeLine.call(this, TypeMappingCollection, VPMTypeRelInfo, MatrixTypeRelInfo, typeMapping, kindOfMapping /*,attrtbodyNew*/, attrtbody, listofAttributesMapping, this.wdthArrayAttr, this.listofTypeRelMapping);
				lineAttr.newline.inject(/*attrtbodyNew*/attrtbody);
			}
		},


		getListOfAttributeMapping: function () {
			return this.listofTypeRelMapping[0].AttributeMapping;

        },
	
		//show: function () {},
		destroy : function() {
			this.stopListening();
			this._parent.apply(this, arguments);
			DecoratorManager.hideDecorator(false, true);
		},


	});

	return extendedView;
});

/*@fullReview  ZUR 15/11/23 2017x Param Widgetization NG*/
/*global define, widget, document, setTimeout, console*/
/*jslint nomen: true */
define('DS/ParameterizationSkeleton/Collection/ParamCollaboration/ParameterizationMappingCollection', [
    // UWA
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Model/ParamCollaboration/MappingModel',
    'DS/ParameterizationSkeleton/Views/ParamCollaboration/TypeMapping/typeMappingRenderer',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
], function (UWA, Model, Collection, MappingModel, typeMappingRenderer,
    ParameterizationDataUtils, WAFData, URLHandler) {
    'use strict';
    //

    var handledDomain = null;
    var modelKey = null;
    var mapObject = null;

    //var  ParameterizationParentCol = 
    return Collection.extend({
        model: function (modelid) {
            return MappingModel;
        },

        //model:ParameterizationDomainModel,
        setup: function (models, options) {
            UWA.log('ParameterizationCommonCollection::setup');
            //this.childCollection = null;

            UWA.log(models);
            UWA.log(options);
			/*var options2 = this.options;
            UWA.log(options2);*/

            console.log("ParameterizationCommonCollection::setup, la suite");
            var iURL, iObjID,
                _modelKey = options._modelKey,
                domainID = _modelKey._attributes.domainid,
                familyID = _modelKey._attributes.familyid;

            if (UWA.is(this.model, "function")) {
                this.model = this.model(domainID);
                handledDomain = domainID;
            }

            modelKey = _modelKey;
            mapObject = new Map(Object.entries(modelKey._attributes));

            var isTypeMapping = (_modelKey._attributes.KindOfMapping==="TYPE") ? true : false;

            iObjID = _modelKey._attributes.id;
            this.url = URLHandler.getURL() +
                "/resources/MappingWS/mapping/mappinginformation?tenant=" + URLHandler.getTenant() + "&VPMTypeRelId=" + _modelKey._attributes.vpmObject.id + "&MatrixTypeRelId=" + _modelKey._attributes.mxObject.id + "&direction=" + _modelKey._attributes.SynchDirection + "&isTypeMapping=" + isTypeMapping ;

        },

        sync: function (method, model, options) {
            UWA.log('ParameterizationCommonCollection::sync');
            options.contentType = 'application/json';//application/ds-json
            //options.proxy = 'passport';
            options.lang = widget.lang;

            options.headers = {
                Accept: 'application/json',
                'Content-Type': 'application/json',
                'Accept-Language': widget.lang
            };

            UWA.log(options);

            options = Object.assign({
                ajax: WAFData.authenticatedRequest
            }, options);
            //console.log(model);
            //this.childCollection.sync(method, model, options);
            this._parent.apply(this, [method, model, options]);
        },

        parse: function (data) {
            UWA.log("ParameterizationParentCollection::parse");
            //return this.childCollection.parse(data);
            UWA.log(data);

            return this.parseMappingData(data);

        },

        create: function (attributes, options) {
            options.proxy = 'passport';
            this._parent.apply(this, [attributes, options]);
        },



        parseMappingData: function (data) {
            var rMapping, MappingNodeModel,
                AttributeInfoVPM = [],
                AttributeInfoMatrix = [],
                TypeRelInfo = [],
                InterfaceInfo = [],
                InterfaceMapping = [],
                TypeRelMapping = [],
                AttributeMapping = [],
                InheritedAttributeMapping = [],
                ChildAttributeMapping = [];

            var isCloudEnv = typeMappingRenderer.isCloudEnv;

            UWA.log("LifecycleCollection::parse");
            UWA.log(data);

            MappingNodeModel = ParameterizationDataUtils.paramStructBuilder("id,TypeRelInfo,InterfaceInfo,InterfaceMapping,TypeRelMapping");
            rMapping = new MappingNodeModel("", "", "", "", "", "");


            if (Array.isArray(data.mappableAttributesMatrix)) {
                data.mappableAttributesMatrix.forEach(function (rAttrInfo) {

                    AttributeInfoMatrix.push({
                        id: rAttrInfo.id,
                        name: rAttrInfo.name,
                        type: rAttrInfo.type,
                        range: rAttrInfo.range,
                        itf: rAttrInfo.interface,
                        basic: rAttrInfo.isbasic,
                        deployed: rAttrInfo.isDeployed,
                        isenum: rAttrInfo.isEnum,
                        isreadonly: rAttrInfo.isReadOnly,
                        isauthorized: rAttrInfo.isAuthorized,
                        isUnknown: rAttrInfo.isUnknown,
                        isInherited: rAttrInfo.isInherited

                    });
                });
            }


            if (Array.isArray(data.mappableAttributesVPM)) {
                data.mappableAttributesVPM.forEach(function (rAttrInfo) {

                    AttributeInfoVPM.push({
                        id: rAttrInfo.id,
                        name: rAttrInfo.name,
                        type: rAttrInfo.type,
                        range: rAttrInfo.range,
                        itf: rAttrInfo.interface,
                        basic: rAttrInfo.isbasic,
                        deployed: rAttrInfo.isDeployed,
                        isenum: rAttrInfo.isEnum,
                        isreadonly: rAttrInfo.isReadOnly,
                        isauthorized: rAttrInfo.isAuthorized,
                        isUnknown: rAttrInfo.isUnknown,
                        isInherited: rAttrInfo.isInherited

                    });
                });
            }


            TypeRelInfo.push({
                id: modelKey._attributes.vpmObject.id,
                attributeInfo: AttributeInfoVPM,
                isType: modelKey._attributes.vpmObject.isType,
                isCusto: modelKey._attributes.vpmObject.isCusto,
                derivedFrom: modelKey._attributes.vpmObject.derivedFrom,
                derivationPath: modelKey._attributes.vpmObject.derivationPath,
                name: modelKey._attributes.vpmObject.name
            });


            TypeRelInfo.push({
                id: modelKey._attributes.mxObject.id,
                attributeInfo: AttributeInfoMatrix,
                isType: modelKey._attributes.mxObject.isType,
                isCusto: modelKey._attributes.mxObject.isCusto,
                derivedFrom: modelKey._attributes.mxObject.derivedFrom,
                derivationPath: modelKey._attributes.mxObject.derivationPath,
                name: modelKey._attributes.mxObject.name
            });


            /*TypeRelInfo.push({
                id        : rTypeRel.id,
                attributeInfo : AttributeInfo,
                isType   : rTypeRel.isType,
                isCusto  : rTypeRel.isCusto,
                derivedFrom  : rTypeRel.derivedFrom,
                derivationPath : rTypeRel.derivationPath,
                name : rTypeRel.name
            });
        );*/



            if (Array.isArray(data.attributeMapping)) {
                data.attributeMapping.forEach(function (rAttrMapping) {


                    /*var VPMAttribute,MatrixAttribute,VPMTypeAttribute,MatrixTypeAttribute,VPMItfAttribute,MatrixItfAttribute;

                        VPMAttribute = rAttrMapping.vpmAttribute.id;
                        VPMTypeAttribute = rAttrMapping.vpmAttribute.type;
                        MatrixAttribute = rAttrMapping.mxAttribute.id;
                        MatrixTypeAttribute = rAttrMapping.mxAttribute.type;*/

                    /*var status = "Deployed";
                    if(!rAttrMapping.isDeployed)
                        status = "Stored";*/

                    var syncDirection = rAttrMapping.synchDirection;

                    if (isCloudEnv && rAttrMapping.synchDirection == "BOTH" && !rAttrMapping.isBaseMapping)
                        syncDirection = "VPM_To_MX";

                    if (!isCloudEnv || syncDirection != "MX_To_VPM") {

                        AttributeMapping.push({
                            VPMAttribute: { id: rAttrMapping.vpmAttribute.id, name: rAttrMapping.vpmAttribute.name, type: rAttrMapping.vpmAttribute.type, itf: rAttrMapping.vpmAttribute.interface, basic: rAttrMapping.vpmAttribute.isbasic, deployed: rAttrMapping.vpmAttribute.isDeployed, isenum: rAttrMapping.vpmAttribute.isEnum, range: rAttrMapping.vpmAttribute.range, isreadonly: rAttrMapping.vpmAttribute.isReadOnly, isauthorized: rAttrMapping.vpmAttribute.isAuthorized, isUnknown: rAttrMapping.vpmAttribute.isUnknown, isInherited: rAttrMapping.vpmAttribute.isInherited },
                            MatrixAttribute: { id: rAttrMapping.mxAttribute.id, name: rAttrMapping.mxAttribute.name, type: rAttrMapping.mxAttribute.type, itf: rAttrMapping.mxAttribute.interface, basic: rAttrMapping.mxAttribute.isbasic, deployed: rAttrMapping.mxAttribute.isDeployed, isenum: rAttrMapping.mxAttribute.isEnum, range: rAttrMapping.mxAttribute.range, isreadonly: rAttrMapping.mxAttribute.isReadOnly, isauthorized: rAttrMapping.mxAttribute.isAuthorized, isUnknown: rAttrMapping.mxAttribute.isUnknown, isInherited: rAttrMapping.mxAttribute.isInherited },
                            SynchDirection: syncDirection,
                            status: rAttrMapping.deployedStatus,
                            OriginalSynchDirection: rAttrMapping.synchDirection,
                            isBaseMapping: rAttrMapping.isBaseMapping,
                            associatedTypeMappingsIds: rAttrMapping.associatedTypeMappingsIds,
                            associatedTypeMappingsName: rAttrMapping.associatedTypeMappingsName
                        });
                    }
                });
            }


            if (Array.isArray(data.inheritedAttributeMapping)) {
                data.inheritedAttributeMapping.forEach(function (rInheritedAttrMapping) {


                    var syncDirection = rInheritedAttrMapping.synchDirection;

                    if (isCloudEnv && rInheritedAttrMapping.synchDirection == "BOTH" && !rInheritedAttrMapping.isBaseMapping)
                        syncDirection = "VPM_To_MX";

                    if (!isCloudEnv || syncDirection != "MX_To_VPM") {

                        var vpmObject;
                        if (rInheritedAttrMapping.vpmObject !== undefined)
                            vpmObject = {
                                id: rInheritedAttrMapping.vpmObject.id,
                                isType: rInheritedAttrMapping.vpmObject.isType,
                                isCusto: rInheritedAttrMapping.vpmObject.isCusto,
                                name: rInheritedAttrMapping.vpmObject.name
                            }
                        else vpmObject = null;

                        InheritedAttributeMapping.push({
                            VPMAttribute: { id: rInheritedAttrMapping.vpmAttribute.id, name: rInheritedAttrMapping.vpmAttribute.name, type: rInheritedAttrMapping.vpmAttribute.type, itf: rInheritedAttrMapping.vpmAttribute.interface, basic: rInheritedAttrMapping.vpmAttribute.isbasic, deployed: rInheritedAttrMapping.vpmAttribute.isDeployed, isenum: rInheritedAttrMapping.vpmAttribute.isEnum, range: rInheritedAttrMapping.vpmAttribute.range, isreadonly: rInheritedAttrMapping.vpmAttribute.isReadOnly, isauthorized: rInheritedAttrMapping.vpmAttribute.isAuthorized, isUnknown: rInheritedAttrMapping.vpmAttribute.isUnknown, isInherited: rInheritedAttrMapping.vpmAttribute.isInherited },
                            MatrixAttribute: { id: rInheritedAttrMapping.mxAttribute.id, name: rInheritedAttrMapping.mxAttribute.name, type: rInheritedAttrMapping.mxAttribute.type, itf: rInheritedAttrMapping.mxAttribute.interface, basic: rInheritedAttrMapping.mxAttribute.isbasic, deployed: rInheritedAttrMapping.mxAttribute.isDeployed, isenum: rInheritedAttrMapping.mxAttribute.isEnum, range: rInheritedAttrMapping.mxAttribute.range, isreadonly: rInheritedAttrMapping.mxAttribute.isReadOnly, isauthorized: rInheritedAttrMapping.mxAttribute.isAuthorized, isUnknown: rInheritedAttrMapping.mxAttribute.isUnknown, isInherited: rInheritedAttrMapping.mxAttribute.isInherited },
                            SynchDirection: syncDirection,
                            status: rInheritedAttrMapping.deployedStatus,
                            OriginalSynchDirection: rInheritedAttrMapping.synchDirection,
                            isBaseMapping: rInheritedAttrMapping.isBaseMapping,
                            associatedTypeMappingsIds: rInheritedAttrMapping.associatedTypeMappingsIds,
                            associatedTypeMappingsName: rInheritedAttrMapping.associatedTypeMappingsName,
                            VPMObject: vpmObject,
                            MatrixObject: {
                                id: rInheritedAttrMapping.mxObject.id,
                                isType: rInheritedAttrMapping.mxObject.isType,
                                isCusto: rInheritedAttrMapping.mxObject.isCusto,
                                name: rInheritedAttrMapping.mxObject.name
                            }
                        });
                    }
                });
            }

            if (Array.isArray(data.childAttributeMapping)) {
                data.childAttributeMapping.forEach(function (rChildAttrMapping) {

                    var syncDirection = rChildAttrMapping.synchDirection;

                    if (isCloudEnv && rChildAttrMapping.synchDirection == "BOTH" && !rChildAttrMapping.isBaseMapping)
                        syncDirection = "VPM_To_MX";

                    if (!isCloudEnv || syncDirection != "MX_To_VPM") {


                        var vpmObject;
                        if (rChildAttrMapping.vpmObject !== undefined)
                            vpmObject = {
                                id: rChildAttrMapping.vpmObject.id,
                                isType: rChildAttrMapping.vpmObject.isType,
                                isCusto: rChildAttrMapping.vpmObject.isCusto,
                                name: rChildAttrMapping.vpmObject.name
                            }
                        else vpmObject = null;

                        ChildAttributeMapping.push({
                            VPMAttribute: { id: rChildAttrMapping.vpmAttribute.id, name: rChildAttrMapping.vpmAttribute.name, type: rChildAttrMapping.vpmAttribute.type, itf: rChildAttrMapping.vpmAttribute.interface, basic: rChildAttrMapping.vpmAttribute.isbasic, deployed: rChildAttrMapping.vpmAttribute.isDeployed, isenum: rChildAttrMapping.vpmAttribute.isEnum, range: rChildAttrMapping.vpmAttribute.range, isreadonly: rChildAttrMapping.vpmAttribute.isReadOnly, isauthorized: rChildAttrMapping.vpmAttribute.isAuthorized, isUnknown: rChildAttrMapping.vpmAttribute.isUnknown, isInherited: rChildAttrMapping.vpmAttribute.isInherited },
                            MatrixAttribute: { id: rChildAttrMapping.mxAttribute.id, name: rChildAttrMapping.mxAttribute.name, type: rChildAttrMapping.mxAttribute.type, itf: rChildAttrMapping.mxAttribute.interface, basic: rChildAttrMapping.mxAttribute.isbasic, deployed: rChildAttrMapping.mxAttribute.isDeployed, isenum: rChildAttrMapping.mxAttribute.isEnum, range: rChildAttrMapping.mxAttribute.range, isreadonly: rChildAttrMapping.mxAttribute.isReadOnly, isauthorized: rChildAttrMapping.mxAttribute.isAuthorized, isUnknown: rChildAttrMapping.mxAttribute.isUnknown, isInherited: rChildAttrMapping.mxAttribute.isInherited },
                            SynchDirection: syncDirection,
                            status: rChildAttrMapping.deployedStatus,
                            OriginalSynchDirection: rChildAttrMapping.synchDirection,
                            isBaseMapping: rChildAttrMapping.isBaseMapping,
                            associatedTypeMappingsIds: rChildAttrMapping.associatedTypeMappingsIds,
                            associatedTypeMappingsName: rChildAttrMapping.associatedTypeMappingsName,
                            VPMObject: vpmObject,
                            MatrixObject: {
                                id: rChildAttrMapping.mxObject.id,
                                isType: rChildAttrMapping.mxObject.isType,
                                isCusto: rChildAttrMapping.mxObject.isCusto,
                                name: rChildAttrMapping.mxObject.name
                            }
                        });
                    }
                });
            }

            TypeRelMapping.push({

                AttributeMapping: AttributeMapping,
                InheritedAttributeMapping: InheritedAttributeMapping,
                ChildAttributeMapping: ChildAttributeMapping,
                KindOfMapping: mapObject.get('KindOfMapping'),
                VPMObjectName: modelKey._attributes.vpmObject.name,
                VPMObject: modelKey._attributes.vpmObject.id,
                MatrixObject: modelKey._attributes.mxObject.id,
                MatrixObjectName: modelKey._attributes.mxObject.name,
                SynchDirection: mapObject.get('SynchDirection'),
                isBaseMapping: modelKey._attributes.isBaseMapping,
                DerivationPath: modelKey._attributes.derivationPath,
                status: modelKey._attributes.deployedStatus,
            });




            //listofRules, typeCategory, typeID, typeNLS

            rMapping.id = data.id;
            rMapping.TypeRelInfo = TypeRelInfo;
            rMapping.TypeRelMapping = TypeRelMapping;
            return rMapping;
        }

    });

    //return ParameterizationParentCol;

    //return ParameterizationParentCol;
});

define('DS/ParameterizationSkeleton/Views/PPRSynchronizationLifeCycle/PPRSynchroAddLineDialog',
	[
		'DS/UIKIT/Modal',
		'UWA/Core',
		'DS/UIKIT/Input/Toggle',
		'DS/UIKIT/Input/Select',
		'DS/UIKIT/Input/Text',
		'DS/UIKIT/Input/Number',
		'DS/UIKIT/Alert',
		'DS/UIKIT/Tooltip',
		'DS/UIKIT/Popover',
		'DS/WAFData/WAFData',
		'UWA/Controls/Accordion',
		'DS/UIKIT/Accordion',
		'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
		'DS/ParameterizationSkeleton/Views/PPRSynchronizationLifeCycle/PPRSynchroViewConstants',
		'i18n!DS/ParameterizationSkeleton/assets/nls/PPRSynchroLifeCycleNLS'
	],
	function (Modal,
		UWACore,
		Toggle,
		Select,
		Text,
		Number,
		Alert,
		Tooltip,
		Popover,
		WAFData,
		UWAccordion,
		Accordion,
		URLHandler,
		PPRSynchroViewConstants,
		PPRSynchroLifeCycleNLS) {

		'use strict';

		function _createModal(options) {
			var modal = new Modal({
				className: options.className || '',
				closable: true,
				header: '<h4>' + options.title + '</h4>',
				body: '',
				footer: ''
			});
			return modal;
		}

		function PPRSynchroAddLineModal(options) {
			this.options = {
				title: 'Dialog',
				className: '',
				withFooter: true
			};
			this.options = UWACore.extend(this.options, options);

			this.modal = _createModal(this.options);
			this.modal.inject(document.querySelector('#typeMainDiv'));
			if (this.options.withFooter) {
				this._bindFooterEvent();
			}

		}


		PPRSynchroAddLineModal.prototype.getDefaultFields = function (_formatContent, selectComboTypeOptions) {

		var that = this;


		var divTagForType = document.createElement('div');
		divTagForType.className = "formats";

		//label Type for ComboType
		var typelabelDiv = document.createElement('div');
		typelabelDiv.className = "formats-label";
		typelabelDiv.innerText = PPRSynchroLifeCycleNLS.Type;
	

		var typeComboBoxDiv = document.createElement('div');
		typeComboBoxDiv.className = "formats-tbox";

		//ComboBox type given as input argument
		this.typeCombobox = selectComboTypeOptions;
		this.typeCombobox.setId(PPRSynchroLifeCycleNLS.Type + "_comboBox");
		this.typeCombobox.inject(typeComboBoxDiv);
	
		divTagForType.appendChild(typelabelDiv);
		divTagForType.appendChild(typeComboBoxDiv);
		_formatContent.appendChild(divTagForType);

		//divTagSection1 will contain the 1st section on accordion (Life Cycle Rules)
		var divTagSection1 = document.createElement('div');

		//ComputedResultingProduct
		var divTagComputedResultingProduct = document.createElement('div');
		divTagComputedResultingProduct.className = "formats";

		var labelComputedResultingProduct = document.createElement('div');
		labelComputedResultingProduct.className = "formats-label";
		labelComputedResultingProduct.innerText = PPRSynchroLifeCycleNLS.ComputedResultingProduct;

		divTagComputedResultingProduct.appendChild(labelComputedResultingProduct);

		var imgInfoSpan = UWA.createElement('span', {
			'class': 'fonticon fonticon-info'
		}).inject(divTagComputedResultingProduct);

		imgInfoSpan.setStyle("color", "black");

		var PopoverComputedResultingProductDiv = new Popover({
			target: imgInfoSpan,
			trigger: "hover",
			animate: "true",
			position: 'top',
			body: PPRSynchroLifeCycleNLS.ComputedResultingProductTooltip,/*tooltip*/
			title: ''
		});

		//check resulting Product
		this.ComputedResultingProductSwitchToogle = new Toggle({
			type: 'switch',//value: 'option1',
			label: ''
		}).check().inject(divTagComputedResultingProduct);

		this._ComputedResultingProduct = false;

		this.ComputedResultingProductSwitchToogle.addEvent('onChange', function () {
			if (this.isChecked()) {
				this._ComputedResultingProduct = true;
			} else {
				this._ComputedResultingProduct = false;
			}
		});
		divTagSection1.appendChild(divTagComputedResultingProduct);

		//SPEC_DOC commented asked by Paul IR926203

		//SpecDoc
		//var divTagSpecDoc = document.createElement('div');
		//divTagSpecDoc.className = "formats";

			//SPEC_DOC commented asked by Paul IR926203
		//var labelSpecDoc = document.createElement('div');
		//labelSpecDoc.className = "formats-label";
		//labelSpecDoc.innerText = PPRSynchroLifeCycleNLS.SpecDoc;

		//divTagSpecDoc.appendChild(labelSpecDoc);

		//var imgInfoSpan = UWA.createElement('span', {
		//	'class': 'fonticon fonticon-info'
		//}).inject(divTagSpecDoc);

		//imgInfoSpan.setStyle("color", "black");



		//var PopoverSpecDocDiv = new Popover({
		//	target: imgInfoSpan,
		//	trigger: "hover",
		//	animate: "true",
		//	position: 'top',
		//	body: PPRSynchroLifeCycleNLS.SpecDocTooltip,/*tooltip*/
		//	title: ''
		//});
		
		//this.SpecDocSwitchToogle = new Toggle({
		//	type: 'switch',//value: 'option1',
		//	label: ''
		//}).uncheck().inject(divTagSpecDoc);

		//divTagSection1.appendChild(divTagSpecDoc);


		//ChildTransformationTypes

		var divTagChildTransformationTypes = document.createElement('div');
		divTagChildTransformationTypes.className = "formats";

		var labelChildTransformationTypes = document.createElement('div');
		labelChildTransformationTypes.className = "formats-label";
		labelChildTransformationTypes.innerText = PPRSynchroLifeCycleNLS.ChildTransformationTypes;

		divTagChildTransformationTypes.appendChild(labelChildTransformationTypes);

		var imgInfoSpan = UWA.createElement('span', {
			'class': 'fonticon fonticon-info'
		}).inject(divTagChildTransformationTypes);

		imgInfoSpan.setStyle("color", "black");

		var PopoverChildTransformationTypesDiv = new Popover({
			target: imgInfoSpan,
			trigger: "hover",
			animate: "true",
			position: 'top',
			body: PPRSynchroLifeCycleNLS.ChildTransformationTypesTooltip,/*tooltip*/
			title: ''
		});

		//check combo ChildTransformationTypes by default
		this.ChildTransformationTypesSwitchToogle = new Toggle({
			type: 'switch',//value: 'option1',
			label: ''
		}).check().inject(divTagChildTransformationTypes);


		//addAttributeMappingIcon.addEvent('click', that.ShowAddMappingAttributePanel.bind(that, VPMType, PartType, txtSide, typeMapping, attributesTable.getElement(".attrstbodyMapping")));
		divTagSection1.appendChild(divTagChildTransformationTypes);


		//divTagSection2 will contain the 2nd section on accordion (Commands Rules)
		var divTagSection2 = document.createElement('div');

		//NewRevision
		var divTagNewRevision = document.createElement('div');
		divTagNewRevision.className = "formats";

		var labelNewRevision = document.createElement('div');
		labelNewRevision.className = "formats-label";
		labelNewRevision.innerText = PPRSynchroLifeCycleNLS.NewRevision;

		divTagNewRevision.appendChild(labelNewRevision);

		var imgInfoSpan = UWA.createElement('span', {
			'class': 'fonticon fonticon-info'
		}).inject(divTagNewRevision);

		imgInfoSpan.setStyle("color", "black");

		var PopoverNewRevisionDiv = new Popover({
			target: imgInfoSpan,
			trigger: "hover",
			animate: "true",
			position: 'top',
			body: PPRSynchroLifeCycleNLS.NewRevisionTooltip,/*tooltip*/
			title: ''
		});

		this.NewRevisionSwitchToogle = new Toggle({
			type: 'switch',//value: 'option1',
			label: ''
		}).check().inject(divTagNewRevision);


		divTagSection2.appendChild(divTagNewRevision);

		//addAttributeMappingIcon.addEvent('click', that.ShowAddMappingAttributePanel.bind(that, VPMType, PartType, txtSide, typeMapping, attributesTable.getElement(".attrstbodyMapping")));
		divTagSection2.appendChild(divTagNewRevision);

		//New Branch
		var divTagNewBranch = document.createElement('div');
		divTagNewBranch.className = "formats";

		var labelNewBranch = document.createElement('div');
		labelNewBranch.className = "formats-label";
		labelNewBranch.innerText = PPRSynchroLifeCycleNLS.NewBranch;

		divTagNewBranch.appendChild(labelNewBranch);

		var imgInfoBranchSpan = UWA.createElement('span', {
			'class': 'fonticon fonticon-info'
		}).inject(divTagNewBranch);

		imgInfoBranchSpan.setStyle("color", "black");

		var PopoverNewBranchDiv = new Popover({
			target: imgInfoBranchSpan,
			trigger: "hover",
			animate: "true",
			position: 'top',
			body: PPRSynchroLifeCycleNLS.NewBranchTooltip,/*tooltip*/
			title: ''
		});

		this.NewBranchSwitchToogle = new Toggle({
			type: 'switch',//value: 'option1', 
			label: ''
		}).check().inject(divTagNewBranch);

		divTagSection2.appendChild(divTagNewBranch);


		//Duplicate
		var divTagDuplicate = document.createElement('div');
		divTagDuplicate.className = "formats";

		var labelDuplicate = document.createElement('div');
		labelDuplicate.className = "formats-label";
		labelDuplicate.innerText = PPRSynchroLifeCycleNLS.Duplicate;

		divTagDuplicate.appendChild(labelDuplicate);

		var imgInfoDuplicateSpan = UWA.createElement('span', {
			'class': 'fonticon fonticon-info'
		}).inject(divTagDuplicate);

		imgInfoDuplicateSpan.setStyle("color", "black");

		var PopoverDuplicateDiv = new Popover({
			target: imgInfoDuplicateSpan,
			trigger: "hover",
			animate: "true",
			position: 'top',
			body: PPRSynchroLifeCycleNLS.DuplicateTooltip,/*tooltip*/
			title: ''
		});

		this.DuplicateSwitchToogle = new Toggle({
			type: 'switch',//value: 'option1',
			label: ''
		}).uncheck().inject(divTagDuplicate);
		divTagSection2.appendChild(divTagDuplicate);

		//Delete
		var divTagDelete = document.createElement('div');
		divTagDelete.className = "formats";

		var labelDelete = document.createElement('div');
		labelDelete.className = "formats-label";
		labelDelete.innerText = PPRSynchroLifeCycleNLS.Delete;

		divTagDelete.appendChild(labelDelete);

		 var imgInfoDeleteSpan = UWA.createElement('span', {
			'class': 'fonticon fonticon-info'
		}).inject(divTagDelete);

		imgInfoDeleteSpan.setStyle("color", "black");

		var PopoverDeleteDiv = new Popover({
			target: imgInfoDeleteSpan,
			trigger: "hover",
			animate: "true",
			position: 'top',
			body: PPRSynchroLifeCycleNLS.DeleteTooltip,/*tooltip*/
			title: ''
		});

		this.DeleteSwitchToogle = new Toggle({
			type: 'switch',//value: 'option1',
			label: ''
		}).uncheck().inject(divTagDelete);
		divTagSection2.appendChild(divTagDelete);

		//TransferOwnership
		var divTagTransferOwnership = document.createElement('div');
		divTagTransferOwnership.className = "formats";

		var labelTransferOwnership = document.createElement('div');
		labelTransferOwnership.className = "formats-label";
		labelTransferOwnership.innerText = PPRSynchroLifeCycleNLS.TransferOwnership;

		divTagTransferOwnership.appendChild(labelTransferOwnership);

		var imgInfoTransferOwnershipSpan = UWA.createElement('span', {
			'class': 'fonticon fonticon-info'
		}).inject(divTagTransferOwnership);

		imgInfoTransferOwnershipSpan.setStyle("color", "black");

		var PopoverTransferOwnershipDiv = new Popover({
			target: imgInfoTransferOwnershipSpan,
			trigger: "hover",
			animate: "true",
			position: 'top',
			body: PPRSynchroLifeCycleNLS.TransferOwnershipTooltip,/*tooltip*/
			title: ''
		});

		this.TransferOwnershipSwitchToogle = new Toggle({
			type: 'switch',//value: 'option1',
			label: ''
		}).uncheck().inject(divTagTransferOwnership);

		divTagSection2.appendChild(divTagTransferOwnership);

		//ChangeMaturity
		var divTagChangeMaturity = document.createElement('div');
		divTagChangeMaturity.className = "formats";

		var labelChangeMaturity = document.createElement('div');
		labelChangeMaturity.className = "formats-label";
		labelChangeMaturity.innerText = PPRSynchroLifeCycleNLS.ChangeMaturity;

		divTagChangeMaturity.appendChild(labelChangeMaturity);

		var imgInfoChangeMaturitySpan = UWA.createElement('span', {
				'class': 'fonticon fonticon-info'
			}).inject(divTagChangeMaturity);

		imgInfoChangeMaturitySpan.setStyle("color", "black");

		var PopoverChangeMaturityDiv = new Popover({
			target: imgInfoChangeMaturitySpan,
			trigger: "hover",
			animate: "true",
			position: 'top',
			body: PPRSynchroLifeCycleNLS.ChangeMaturityTooltip,/*tooltip*/
			title: ''
		});

		this.ChangeMaturitySwitchToogle = new Toggle({
			type: 'switch',//value: 'option1',
			label: ''
		}).uncheck().inject(divTagChangeMaturity);

		divTagSection2.appendChild(divTagChangeMaturity);


		//Lock
		var divTagLock = document.createElement('div');
		divTagLock.className = "formats";

		var labelLock = document.createElement('div');
		labelLock.className = "formats-label";
		labelLock.innerText = PPRSynchroLifeCycleNLS.Lock;

		divTagLock.appendChild(labelLock);

		var imgInfoLockSpan = UWA.createElement('span', {
				'class': 'fonticon fonticon-info'
			}).inject(divTagLock);

		imgInfoLockSpan.setStyle("color", "black");

		var PopoverLockDiv = new Popover({
				target: imgInfoLockSpan,
				trigger: "hover",
				animate: "true",
				position: 'top',
				body: PPRSynchroLifeCycleNLS.LockTooltip,/*tooltip*/
				title: ''
		});

		this.LockSwitchToogle = new Toggle({
				type: 'switch',//value: 'option1',
				label: ''
		}).uncheck().inject(divTagLock);

		divTagSection2.appendChild(divTagLock);

		//ChangeControl
		var divTagChangeControl = document.createElement('div');
		divTagChangeControl.className = "formats";

		var labelChangeControl = document.createElement('div');
		labelChangeControl.className = "formats-label";
		labelChangeControl.innerText = PPRSynchroLifeCycleNLS.ChangeControl;

		divTagChangeControl.appendChild(labelChangeControl);

		var imgInfoChangeControlSpan = UWA.createElement('span', {
			'class': 'fonticon fonticon-info'
		}).inject(divTagChangeControl);

		imgInfoChangeControlSpan.setStyle("color", "black");

		var PopoverChangeControlDiv = new Popover({
			target: imgInfoChangeControlSpan,
			trigger: "hover",
			animate: "true",
			position: 'top',
			body: PPRSynchroLifeCycleNLS.ChangeControlTooltip,/*tooltip*/
			title: ''
		});

		this.ChangeControlSwitchToogle = new Toggle({
			type: 'switch',//value: 'option1',
			label: ''
		}).uncheck().inject(divTagChangeControl);

		divTagSection2.appendChild(divTagChangeControl);

		//Transfer
		var divTagTransfer = document.createElement('div');
		divTagTransfer.className = "formats";

		var labelTransfer = document.createElement('div');
		labelTransfer.className = "formats-label";
		labelTransfer.innerText = PPRSynchroLifeCycleNLS.Transfer;

		divTagTransfer.appendChild(labelTransfer);

		var imgInfoTransferSpan = UWA.createElement('span', {
				'class': 'fonticon fonticon-info'
		}).inject(divTagTransfer);

		imgInfoTransferSpan.setStyle("color", "black");

		var PopoverTransferDiv = new Popover({
			target: imgInfoTransferSpan,
			trigger: "hover",
			animate: "true",
			position: 'top',
			body: PPRSynchroLifeCycleNLS.TransferTooltip,/*tooltip*/
			title: ''
		});

		this.TransferSwitchToogle = new Toggle({
			type: 'switch',//value: 'option1',
			label: ''
		}).uncheck().inject(divTagTransfer);

		divTagSection2.appendChild(divTagTransfer);


		//Share
		var divTagShare = document.createElement('div');
		divTagShare.className = "formats";
		var labelShare = document.createElement('div');
		labelShare.className = "formats-label";
		labelShare.innerText = PPRSynchroLifeCycleNLS.Share;

		divTagShare.appendChild(labelShare);

		var imgInfoShareSpan = UWA.createElement('span', {
			'class': 'fonticon fonticon-info'
		}).inject(divTagShare);

		imgInfoShareSpan.setStyle("color", "black");

		var PopoverShareDiv = new Popover({
			target: imgInfoShareSpan,
			trigger: "hover",
			animate: "true",
			position: 'top',
			body: PPRSynchroLifeCycleNLS.ShareTooltip,/*tooltip*/
			title: ''
		});

		this.ShareSwitchToogle = new Toggle({
			type: 'switch',//value: 'option1',
			label: ''
		}).uncheck().inject(divTagShare);

		divTagSection2.appendChild(divTagShare);

		var accordionDiv = UWA.createElement('div', {
			'class': 'accordion1bodydiv',
		})

		/////create accordion Section 1 : LifeCycleRules + Section 2 Commands Rules
		var accordionSections = new Accordion({
			className: 'styled divided filled',
			exclusive: false,
			items: [{
				title: PPRSynchroLifeCycleNLS.LifeCycleRulesTitle,
				content: divTagSection1,
				selected: true,
			},
			{
				title: PPRSynchroLifeCycleNLS.CommandsRulesTitle,
				content: divTagSection2,
				selected: true,
			}]
		}).inject(accordionDiv);

		//Add accordion to dialog
		_formatContent.appendChild(accordionDiv);

	};


	PPRSynchroAddLineModal.prototype.getModalBody = function (selectComboTypeOptions) {

		var partNumberContent = this.modal.elements.body;

		var _errorsMessageDiv = UWACore.createElement('div');
		_errorsMessageDiv.className = "ppr-lifecycling-rules-error-content";

		var _formatContent = UWACore.createElement('div');
		_formatContent.className = "ppr-lifecycling-rules-content";

		var _staticFormatContent = UWACore.createElement('div');
		_staticFormatContent.className = "ppr-lifecycling-rules-static-content";
		var _dynamicFormatContent = UWACore.createElement('div');
		_dynamicFormatContent.className = "ppr-lifecycling-rules-dynamic-content";

		_formatContent.appendChild(_staticFormatContent);
		_formatContent.appendChild(_dynamicFormatContent);
		this.getDefaultFields(_staticFormatContent, selectComboTypeOptions);

		partNumberContent.appendChild(_errorsMessageDiv);
		partNumberContent.appendChild(_formatContent);
		partNumberContent.appendChild(_dynamicFormatContent);
		return partNumberContent;
	};


	//To check that at least one type has been selected
		PPRSynchroAddLineModal.prototype.typeSelectionNotValid = function () {
		var isNull = false;
		var userEnteredFormat = this.typeCombobox.getValue()[0];
		if (userEnteredFormat == '' || userEnteredFormat == "")
				isNull = true;
		return isNull;
	};

	//To check that at least one dependant has been selected
		PPRSynchroAddLineModal.prototype.lifeCycleRulesSelectionNotValid = function () {
			var isNull = false;
			var computedResultingProductToggleValue = this.ComputedResultingProductSwitchToogle ? this.ComputedResultingProductSwitchToogle.isChecked() : false;
			//SPEC_DOC commented asked by Paul IR926203
			//var specDocToggleValue = this.SpecDocSwitchToogle ? this.SpecDocSwitchToogle.isChecked() : false;
			var childTransformationsTypeToggleValue = this.ChildTransformationTypesSwitchToogle ? this.ChildTransformationTypesSwitchToogle.isChecked() : false;
			if (!computedResultingProductToggleValue /*&& !specDocToggleValue*/ && !childTransformationsTypeToggleValue)
				isNull = true;
			return isNull;
		};

		//To check that at least one command has been selected
		PPRSynchroAddLineModal.prototype.commandSelectionNotValid = function () {
			var isNull = false;
			var newRevisionToggleValue = this.NewRevisionSwitchToogle ? this.NewRevisionSwitchToogle.isChecked() : false;
			var newBranchToggleValue = this.NewBranchSwitchToogle ? this.NewBranchSwitchToogle.isChecked() : false;
			var duplicateToggleValue = this.DuplicateSwitchToogle ? this.DuplicateSwitchToogle.isChecked() : false;
			var deletionToggleValue = this.DeleteSwitchToogle ? this.DeleteSwitchToogle.isChecked() : false;
			var transferOnwershipToggleValue = this.TransferOwnershipSwitchToogle ? this.TransferOwnershipSwitchToogle.isChecked() : false;
			var changeMaturityToggleValue = this.ChangeMaturitySwitchToogle ? this.ChangeMaturitySwitchToogle.isChecked() : false;
			var lockToggleValue = this.LockSwitchToogle ? this.LockSwitchToogle.isChecked() : false;
			var changeControlToggleValue = this.ChangeControlSwitchToogle ? this.ChangeControlSwitchToogle.isChecked() : false;
			var transferToggleValue = this.TransferSwitchToogle ? this.TransferSwitchToogle.isChecked() : false;
			var shareToggleValue = this.ShareSwitchToogle ? this.ShareSwitchToogle.isChecked() : false;

			if (!newRevisionToggleValue && !newBranchToggleValue && !duplicateToggleValue
				&& !deletionToggleValue && !transferOnwershipToggleValue && !changeMaturityToggleValue
				&& !lockToggleValue && !changeControlToggleValue && !transferToggleValue && !shareToggleValue)
				isNull = true;
			return isNull;
		};

	PPRSynchroAddLineModal.prototype.displayAlertMessage = function (messageToDisplay, toDisplayOver) {
		var alertOptions = {
			visible: true,
			className: 'param-alert',
			messageClassName: 'error',
			closable: true,
			renderTo: toDisplayOver,
			autoHide: true,
			hideDelay: 2000
		};
		var alert = this.getAlertComponent(alertOptions);

		alert.add({
			message: messageToDisplay
		});

	};

	PPRSynchroAddLineModal.prototype.getUserEnteredValues = function () {

		var userEnteredFormatValues = {};

		var typelist = this.typeCombobox.getValue();


		userEnteredFormatValues[PPRSynchroViewConstants.TYPE] = typelist;

		var computedResultingProductToggleValue = this.ComputedResultingProductSwitchToogle ? this.ComputedResultingProductSwitchToogle.isChecked() : false;
		//SPEC_DOC commented asked by Paul IR926203
		//var specDocToggleValue = this.SpecDocSwitchToogle ? this.SpecDocSwitchToogle.isChecked() : false;
		var childTransfomrationsTypeToggleValue = this.ChildTransformationTypesSwitchToogle ? this.ChildTransformationTypesSwitchToogle.isChecked() : false;

		var newRevisionToggleValue = this.NewRevisionSwitchToogle ? this.NewRevisionSwitchToogle.isChecked() : false;
		var newBranchToggleValue = this.NewBranchSwitchToogle ? this.NewBranchSwitchToogle.isChecked() : false;
		var duplicateToggleValue = this.DuplicateSwitchToogle ? this.DuplicateSwitchToogle.isChecked() : false;
		var deletionToggleValue = this.DeleteSwitchToogle ? this.DeleteSwitchToogle.isChecked() : false;
		var transferOnwershipToggleValue = this.TransferOwnershipSwitchToogle ? this.TransferOwnershipSwitchToogle.isChecked() : false;
		var changeMaturityToggleValue = this.ChangeMaturitySwitchToogle ? this.ChangeMaturitySwitchToogle.isChecked() : false;
		var lockToggleValue = this.LockSwitchToogle ? this.LockSwitchToogle.isChecked() : false;
		var ChangeControlToggleValue = this.ChangeControlSwitchToogle ? this.ChangeControlSwitchToogle.isChecked() : false;
		var transferToggleValue = this.TransferSwitchToogle ? this.TransferSwitchToogle.isChecked() : false;
		var shareToggleValue = this.ShareSwitchToogle ? this.ShareSwitchToogle.isChecked() : false;


		userEnteredFormatValues[PPRSynchroViewConstants.COMPUTED_RESULTING_PRODUCT] = computedResultingProductToggleValue;
		//SPEC_DOC commented asked by Paul IR926203
		//userEnteredFormatValues[PPRSynchroViewConstants.SPEC_DOC] = specDocToggleValue;
		userEnteredFormatValues[PPRSynchroViewConstants.CHILD_TRANSFORMATION_TYPES] = childTransfomrationsTypeToggleValue;

		userEnteredFormatValues[PPRSynchroViewConstants.NEW_REVISION] = newRevisionToggleValue;
		userEnteredFormatValues[PPRSynchroViewConstants.NEW_BRANCH] = newBranchToggleValue;
		userEnteredFormatValues[PPRSynchroViewConstants.DUPLICATE] = duplicateToggleValue;
		userEnteredFormatValues[PPRSynchroViewConstants.DELETE] = deletionToggleValue;
		userEnteredFormatValues[PPRSynchroViewConstants.TRANSFER_OWNERSHIP] = transferOnwershipToggleValue;
		userEnteredFormatValues[PPRSynchroViewConstants.CHANGE_MATURIY] = changeMaturityToggleValue;

		userEnteredFormatValues[PPRSynchroViewConstants.LOCK] = lockToggleValue;
		userEnteredFormatValues[PPRSynchroViewConstants.CHANGE_CONTROL] = ChangeControlToggleValue;
		userEnteredFormatValues[PPRSynchroViewConstants.TRANSFER] = transferToggleValue;
		userEnteredFormatValues[PPRSynchroViewConstants.SHARE] = shareToggleValue;

		return userEnteredFormatValues;
	};

	PPRSynchroAddLineModal.prototype.getTotalFormatRows = function () {
		return document.querySelectorAll(".PPRLifeCycleRulesMapping").length;
	};

	PPRSynchroAddLineModal.prototype.storeAttributes = function (data) {
		this.attributes = data;
	};

	PPRSynchroAddLineModal.prototype.getAlertComponent = function (alertOptions) {

		this.alert = new Alert(alertOptions);
		return this.alert;
	};

	PPRSynchroAddLineModal.prototype.getTooltip = function (tooltipOtions) {
		this.tooltip = new Tooltip(tooltipOtions);
		return this.tooltip;
	};

	PPRSynchroAddLineModal.prototype.show = function () {
		this.modal.show();
	};


	PPRSynchroAddLineModal.prototype._bindFooterEvent = function () {
		var that = this;

		this.modal.getFooter().getElements('.btn').forEach(function (element) {
			if (element.name === 'cancelButton') {
				element.addEvent('click', function () {
					that.modal.hide();
				});
			}
		});

	};

	PPRSynchroAddLineModal.prototype.getContent = function () {
		return this.modal.getContent();
	};

	PPRSynchroAddLineModal.prototype.destroy = function () {
		this.modal.destroy();
		var keys = Object.keys(this);
		for (var i = 0; i < keys.length; i++) {
			this[keys[i]] = undefined;
		}
	};

	PPRSynchroAddLineModal.prototype.setEditValueFields = function (fetchedData) {
		//Type
		this.typeCombobox.select(fetchedData.Type, true);
		//in edition mode Type cannot be modified
		this.typeCombobox.disable();

		this.ComputedResultingProductSwitchToogle.setCheck(fetchedData[PPRSynchroViewConstants.COMPUTED_RESULTING_PRODUCT]);
		//SPEC_DOC commented asked by Paul IR926203
		//this.SpecDocSwitchToogle.setCheck(fetchedData[PPRSynchroViewConstants.SPEC_DOC]);
		this.ChildTransformationTypesSwitchToogle.setCheck(fetchedData[PPRSynchroViewConstants.CHILD_TRANSFORMATION_TYPES]);

		this.NewRevisionSwitchToogle.setCheck(fetchedData[PPRSynchroViewConstants.NEW_REVISION]);
		this.NewBranchSwitchToogle.setCheck(fetchedData[PPRSynchroViewConstants.NEW_BRANCH]);
		this.DuplicateSwitchToogle.setCheck(fetchedData[PPRSynchroViewConstants.DELETE]);
		this.DeleteSwitchToogle.setCheck(fetchedData[PPRSynchroViewConstants.DUPLICATE]);
		this.TransferOwnershipSwitchToogle.setCheck(fetchedData[PPRSynchroViewConstants.TRANSFER_OWNERSHIP]);
		this.ChangeMaturitySwitchToogle.setCheck(fetchedData[PPRSynchroViewConstants.CHANGE_MATURIY]);

		this.LockSwitchToogle.setCheck(fetchedData[PPRSynchroViewConstants.LOCK]);
		this.ChangeControlSwitchToogle.setCheck(fetchedData[PPRSynchroViewConstants.CHANGE_CONTROL]);
		this.TransferSwitchToogle.setCheck(fetchedData[PPRSynchroViewConstants.TRANSFER]);
		this.ShareSwitchToogle.setCheck(fetchedData[PPRSynchroViewConstants.SHARE]);

	};

	return PPRSynchroAddLineModal;
});

define('DS/ParameterizationSkeleton/Views/VersionNamingExt/VersionNamingExtUtility', [
        'UWA/Core',
        'DS/WAFData/WAFData',
        'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
		'i18n!DS/ParameterizationSkeleton/assets/nls/VersionNamingNLS',
    ],
    function (UWA, WAFData, URLHandler, VersionNamingNLS) {

    const ShortNameToName = {
        "DashedRev": "---,--A,--B,--C,--D,--E,--F,--G,--H,--I,--J,--K,--L,--M,--N,--O,--P,--Q,--R,--S,--T,--U,--V,--W,--X,--Y,--Z,-AA,-BB,-CC,-DD,-EE,-FF,-GG,-HH,-II,-JJ,-KK,-LL,-MM,-NN,-OO,-PP,-QQ,-RR,-SS,-TT,-UU,-VV,-WW,-XX,-YY,-ZZ,AAA,BBB,CCC,DDD,EEE,FFF,GGG,HHH,III,JJJ,KKK,LLL,MMM,NNN,OOO,PPP,QQQ,RRR,SSS,TTT,UUU,VVV,WWW,XXX,YYY,ZZZ",
        "AlphabeticalRev": "A,B,C,...",
        "NumericalRev": "1,2,3,...",
        "RomanRev": "I,II,III,IV,V,VI,VII,VIII,IX,X,XI,XII,XIII,XIV,XV,XVI,XVII,XVIII,XIX,XX,XXI,XXII,XXIII,XXIV,XXV,XXVI,XXVII,XXVIII,XXIX,XXX,XXXI,XXXII,XXXIII,XXXIV,XXXV,XXXVI,XXXVII,XXXVIII,XXXIX,XL",
        "NthRev": "1st Rev,2nd Rev,3rd Rev,4th Rev,5th Rev,6th Rev,7th Rev,8th Rev,9th Rev,10th Rev,11th Rev,12th Rev,13th Rev,14th Rev,15th Rev,16th Rev,17th Rev,18th Rev,19th Rev,20th Rev,21st Rev,22nd Rev,23rd Rev,24th Rev,25th Rev,26th Rev,27th Rev,28th Rev,29th Rev,30th Rev,31st Rev,32nd Rev,33rd Rev,34th Rev,35th Rev,36th Rev,37th Rev,38th Rev,39th Rev,40th Rev",
        "ASMEY1435Rev (1)": "-,[A,B,C,D,E,F,G,H,J,K,L,M,N,P,R,T,U,V,W,Y]",
        "ASMEY1435Rev": "-,A,B,C,D,E,F,G,H,J,K,L,M,N,P,R,T,U,V,W,Y,AA,AB,AC,AD,AE,AF,AG,AH,AJ,AK,AL,AM,AN,AP,AR,AT,AU,AV,AW,AY,BA,BB,BC,BD,BE,BF,BG,BH,BJ,BK,BL,BM,BN,BP,BR,BT,BU,BV,BW,BY,CA,CB,CC,CD,CE,CF,CG,CH,CJ,CK,CL,CM,CN,CP,CR,CT,CU,CV,CW,CY,DY,DA,DB,DC,DD,DE,DF,DG,DH,DJ,DK,DL,DM,DN,DP,DR,DT,DU,DV,DW,DY,EA,EB,EC,ED,EE,EF,EG,EH,EJ,EK,EL,EM,EN,EP,ER,ET,EU,EV,EW,EY,FA,FB,FC,FD,FE,FF,FG,FH,FJ,FK,FL,FM,FN,FP,FR,FT,FU,FV,FW,FY,FA,GB,GC,GD,GE,GF,GG,GH,GJ,GK,GL,GM,GN,GP,GR,GT,GU,GV,GW,GY,HA,HB,HC,HD,HE,HF,HG,HH,HJ,HK,HL,HM,HN,HP,HR,HT,HU,HV,HW,HY,JA,JB,JC,JD,JE,JF,JG,JH,JJ,JK,JL,JM,JN,JP,JR,JT,JU,JV,JW,JY,KA,KB,KC,KD,KE,KF,KG,KH,KJ,KK,KL,KM,KN,KP,KR,KT,KU,KV,KW,KY,LA,LB,LC,LD,LE,LF,LG,LH,LJ,LK,LL,LM,LN,LP,LR,LT,LU,LV,LW,LY,MA,MB,MC,MD,ME,MF,MG,MH,MJ,MK,ML,MM,MN,MP,MR,MT,MU,MV,MW,MY,NA,NB,NC,ND,NE,NF,NG,NH,NJ,NK,NL,NM,NN,NP,NR,NT,NU,NV,NW,NY,PA,PB,PC,PD,PE,PF,PG,PH,PJ,PK,PL,PM,PN,PP,PR,PT,PU,PV,PW,PY,RA,RB,RC,RD,RE,RF,RG,RH,RJ,RK,RL,RM,RN,RP,RR,RT,RU,RV,RW,RY,TA,TB,TC,TD,TE,TF,TG,TH,TJ,TK,TL,TM,TN,TP,TR,TT,TU,TV,TW,TY,UA,UB,UC,UD,UE,UF,UG,UH,UJ,UK,UL,UM,UN,UP,UR,UT,UU,UV,UW,UY,VA,VB,VC,VD,VE,VF,VG,VH,VJ,VK,VL,VM,VN,VP,VR,VT,VU,VV,VW,VY,WA,WB,WC,WD,WE,WF,WG,WH,WJ,WK,WL,WM,WN,WP,WR,WT,WU,WV,WW,WY,YA,YB,YC,YD,YE,YF,YG,YH,YJ,YK,YL,YM,YN,YP,YR,YT,YU,YV,YW,YY,...",
        "NumericalZeroRev (1)": "0,1,2,...",
        "NumericalZeroRev": "0,1,2,3,..."
    };

    const NameToShortName = {
        "---,--A,--B,--C,--D,--E,--F,--G,--H,--I,--J,--K,--L,--M,--N,--O,--P,--Q,--R,--S,--T,--U,--V,--W,--X,--Y,--Z,-AA,-BB,-CC,-DD,-EE,-FF,-GG,-HH,-II,-JJ,-KK,-LL,-MM,-NN,-OO,-PP,-QQ,-RR,-SS,-TT,-UU,-VV,-WW,-XX,-YY,-ZZ,AAA,BBB,CCC,DDD,EEE,FFF,GGG,HHH,III,JJJ,KKK,LLL,MMM,NNN,OOO,PPP,QQQ,RRR,SSS,TTT,UUU,VVV,WWW,XXX,YYY,ZZZ": "DashedRev",
        "A,B,C,...": "AlphabeticalRev",
        "1,2,3,...": "NumericalRev",
        "I,II,III,IV,V,VI,VII,VIII,IX,X,XI,XII,XIII,XIV,XV,XVI,XVII,XVIII,XIX,XX,XXI,XXII,XXIII,XXIV,XXV,XXVI,XXVII,XXVIII,XXIX,XXX,XXXI,XXXII,XXXIII,XXXIV,XXXV,XXXVI,XXXVII,XXXVIII,XXXIX,XL": "RomanRev",
        "1st Rev,2nd Rev,3rd Rev,4th Rev,5th Rev,6th Rev,7th Rev,8th Rev,9th Rev,10th Rev,11th Rev,12th Rev,13th Rev,14th Rev,15th Rev,16th Rev,17th Rev,18th Rev,19th Rev,20th Rev,21st Rev,22nd Rev,23rd Rev,24th Rev,25th Rev,26th Rev,27th Rev,28th Rev,29th Rev,30th Rev,31st Rev,32nd Rev,33rd Rev,34th Rev,35th Rev,36th Rev,37th Rev,38th Rev,39th Rev,40th Rev": "NthRev",
        "-,[A,B,C,D,E,F,G,H,J,K,L,M,N,P,R,T,U,V,W,Y]": "ASMEY1435Rev",
        "-,A,B,C,D,E,F,G,H,J,K,L,M,N,P,R,T,U,V,W,Y,AA,AB,AC,AD,AE,AF,AG,AH,AJ,AK,AL,AM,AN,AP,AR,AT,AU,AV,AW,AY,BA,BB,BC,BD,BE,BF,BG,BH,BJ,BK,BL,BM,BN,BP,BR,BT,BU,BV,BW,BY,CA,CB,CC,CD,CE,CF,CG,CH,CJ,CK,CL,CM,CN,CP,CR,CT,CU,CV,CW,CY,DY,DA,DB,DC,DD,DE,DF,DG,DH,DJ,DK,DL,DM,DN,DP,DR,DT,DU,DV,DW,DY,EA,EB,EC,ED,EE,EF,EG,EH,EJ,EK,EL,EM,EN,EP,ER,ET,EU,EV,EW,EY,FA,FB,FC,FD,FE,FF,FG,FH,FJ,FK,FL,FM,FN,FP,FR,FT,FU,FV,FW,FY,FA,GB,GC,GD,GE,GF,GG,GH,GJ,GK,GL,GM,GN,GP,GR,GT,GU,GV,GW,GY,HA,HB,HC,HD,HE,HF,HG,HH,HJ,HK,HL,HM,HN,HP,HR,HT,HU,HV,HW,HY,JA,JB,JC,JD,JE,JF,JG,JH,JJ,JK,JL,JM,JN,JP,JR,JT,JU,JV,JW,JY,KA,KB,KC,KD,KE,KF,KG,KH,KJ,KK,KL,KM,KN,KP,KR,KT,KU,KV,KW,KY,LA,LB,LC,LD,LE,LF,LG,LH,LJ,LK,LL,LM,LN,LP,LR,LT,LU,LV,LW,LY,MA,MB,MC,MD,ME,MF,MG,MH,MJ,MK,ML,MM,MN,MP,MR,MT,MU,MV,MW,MY,NA,NB,NC,ND,NE,NF,NG,NH,NJ,NK,NL,NM,NN,NP,NR,NT,NU,NV,NW,NY,PA,PB,PC,PD,PE,PF,PG,PH,PJ,PK,PL,PM,PN,PP,PR,PT,PU,PV,PW,PY,RA,RB,RC,RD,RE,RF,RG,RH,RJ,RK,RL,RM,RN,RP,RR,RT,RU,RV,RW,RY,TA,TB,TC,TD,TE,TF,TG,TH,TJ,TK,TL,TM,TN,TP,TR,TT,TU,TV,TW,TY,UA,UB,UC,UD,UE,UF,UG,UH,UJ,UK,UL,UM,UN,UP,UR,UT,UU,UV,UW,UY,VA,VB,VC,VD,VE,VF,VG,VH,VJ,VK,VL,VM,VN,VP,VR,VT,VU,VV,VW,VY,WA,WB,WC,WD,WE,WF,WG,WH,WJ,WK,WL,WM,WN,WP,WR,WT,WU,WV,WW,WY,YA,YB,YC,YD,YE,YF,YG,YH,YJ,YK,YL,YM,YN,YP,YR,YT,YU,YV,YW,YY,...": "ASMEY1435Rev",
        "0,1,2,...": "NumericalZeroRev",
        "0,1,2,3,...": "NumericalZeroRev"
    };

    const requestHelper = function (url, methodType, data, onSuccess, onFailure, language) {

        var ODT_MODE = undefined;

        if (window.__karma__ != undefined) {
            ODT_MODE = window.__karma__.config.args[0];
        }

        const urlSecurityContext = URLHandler.getURL() + "/resources/pno/person/getsecuritycontext?tenant=" + URLHandler.getTenant();
        console.log("Get security context:");
        WAFData.authenticatedRequest(urlSecurityContext, {
            timeout: 250000,
            method: 'GET',
            data: "",
            type: 'json',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            onFailure: function (json) {

                if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {
                    this.onComplete("VPLMAdmin.MyCompany.Default");
                } else {
                    console.log('VersionNamingExtUtility::requestHelper - Failure');
                    console.log(json);
                }
            },
            onComplete: function (securityContext) {
                const urlFinal = URLHandler.getURL() + url + "?tenant=" + URLHandler.getTenant();
                WAFData.authenticatedRequest(urlFinal, {
                    timeout: 250000,
                    method: methodType,
                    data: data,
                    type: 'json',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'SecurityContext': securityContext.SecurityContext,
						'Accept-Language': language
                    },
                    onFailure: function (result) {

                        if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {

                            var result = {
                                "sequences": [{
                                        "operator": "ADD",
                                        "name": "AlphabetPadding",
                                        "sequence": {
                                            "name": "AlphabetPadding",
                                            "title": "Alphabet with padding",
                                            "mode": "alphabet",
                                            "alphabet": ["A", "B", "C", "D", "E", "F", "G", "H", "J", "K", "L", "M", "N", "P", "R", "T", "U", "V", "W", "Y"],
                                            "padding": {
                                                "direction": "left",
                                                "char": "-",
                                                "tosize": 3
                                            }
                                        },
                                        "status": "SUCCEEDED"
                                    }
                                ]
                            };

                            this.onComplete(result);
                        } else {
                            console.log('VersionNamingExtUtility::requestHelper - Failure');
                            console.log(result);
                            onFailure(result);
                        }
                    },
                    onComplete: function (result) {
                        console.log('VersionNamingExtUtility::requestHelper - Success');
                        onSuccess(result);
                    }
                });
            }
        });
    };

    const requestHelperPromise = function (url, methodType, data, language) {
        return new Promise((resolve, reject) => {
            requestHelper(url, methodType, data, (result) => resolve(result), (error) => reject(error), language);
        });
    };

    const isExtendedSeq = function (seqname) {
        if (!!NameToShortName[seqname])
            return false;
        console.log("isExtendedSeq returning true for: ");
        console.log(seqname);
        return true;
    };

    return {

        getAllRevisionSequencesPromise: function () {
            return new Promise(function (resolve, reject) {
                var url = "/resources/v1/dslc/getrevisionsequences";
                var jsonData = {
                    "sequences": [{
                            "search": "*"
                        }
                    ]
                };

                requestHelper(url, "POST", JSON.stringify(jsonData),
                    (json) => {
                    if (json && Array.isArray(json.sequences)) {
                        var result = [];
                        json.sequences.forEach((seq) => {
                            if (seq.sequence) {
                                let altname = NameToShortName[seq.sequence.name];
                                seq.sequence.altname = altname || seq.sequence.name;
                                seq.sequence.extended = isExtendedSeq(seq.sequence.name);
                                if (seq.sequence.altname === "ASMEY1435Rev (1)")
                                    seq.sequence.altname = "ASMEY1435Rev";
                                if (seq.sequence.altname === "NumericalZeroRev (1)")
                                    seq.sequence.altname = "NumericalZeroRev";
                                result.push(seq.sequence);
                            }
                        });
                        resolve(result);
                        return;
                    } else if (json && Array.isArray(json)) {
                        var result = [];
                        json.forEach((seq) => {
                            if (seq) {
                                let altname = NameToShortName[seq.name];
                                seq.altname = altname || seq.name;
                                seq.extended = isExtendedSeq(seq.name);
                                if (seq.altname === "ASMEY1435Rev (1)")
                                    seq.altname = "ASMEY1435Rev";
                                if (seq.altname === "NumericalZeroRev (1)")
                                    seq.altname = "NumericalZeroRev";
                                result.push(seq);
                            }
                        });
                        resolve(result);
                        return;
                    }
                    reject(json);
                },
                    (json) => {
                    reject(json);
                });
            });
        },

        downloadRevisionSequencesPromise: function () {
            return new Promise(function (resolve, reject) {
                var url = "/resources/v1/dslc/getrevisionsequences";
                var jsonData = {
                    "sequences": [{
                            "search": "*"
                        }
                    ]
                };

                requestHelper(url, "POST", JSON.stringify(jsonData),
                    (json) => {
                    if (json && Array.isArray(json.sequences)) {
                        var result = [];
                        json.sequences.forEach((seq) => {
                            if (seq.sequence && isExtendedSeq(seq.sequence.name)) {
                                result.push(seq.sequence);
                            }
                        });
                        resolve(result);
                        return;
                    } else if (json && Array.isArray(json)) {
                        var result = [];
                        json.forEach((seq) => {
                            if (seq && isExtendedSeq(seq.name)) {
                                result.push(seq);
                            }
                        });
                        resolve(result);
                        return;
                    }
                    reject(json);
                },
                    (json) => {
                    reject(json);
                });
            });
        },

        getAssociatedSequencesPromise: function (policies, types) {
            return new Promise(function (resolve, reject) {
                var url = "/resources/v1/dslc/associaterevisionsequences";
                var sequences = [];

                policies = policies || new Map();
                for (const v of policies.values()) {
                    v.forEach((policy) => {
                        sequences.push({
                            operator: "GET",
                            policy: policy
                        });
                    });
                }

                types = types || new Map();
                for (const v of types.values()) {
                    v.forEach((type) => {
                        sequences.push({
                            operator: "GET",
                            type: type
                        });
                    });
                }

                var jsonData = {
                    sequences: sequences
                };

                requestHelper(url, "POST", JSON.stringify(jsonData),
                    (json) => {
                    if (json && Array.isArray(json.sequences)) {
                        var result = [];
                        json.sequences.forEach((seq) => {
                            seq.altname = NameToShortName[seq.name] || seq.name;
                            if (seq.altname === "ASMEY1435Rev (1)")
                                seq.altname = "ASMEY1435Rev";
                            if (seq.altname === "NumericalZeroRev (1)")
                                seq.altname = "NumericalZeroRev";
                            result.push(seq);

                        });
                        resolve(result);
                        return;
                    }
                    reject(json);
                },
                    (json) => {
                    reject(json);
                });
            });
        },

        uploadRevisionSequencesPromise: function (jsonData, language) {
            var url = "/resources/v1/dslc/editrevisionsequences";
            return requestHelperPromise(url, "POST", JSON.stringify(jsonData), language);
        },

        /*associateRevisionSequencesPromise: function(sequences) {

        sequences.forEach( (seq) => {
        let name = seq.name;
        if (name==="ASMEY1435Rev (1)")
        name = "ASMEY1435Rev";
        if (name==="NumericalZeroRev (1)")
        name = "NumericalZeroRev";
        let realname = ShortNameToName[name];
        seq.altname = name;
        seq.name = realname || name;
        });

        var url =  "/resources/v1/dslc/associaterevisionsequences";
        var jsonData = { sequences : sequences };
        //attention au cas ASMEY1435Rev
        return requestHelperPromise(url, "POST", JSON.stringify(jsonData));
        },*/
    }
});

define('DS/ParameterizationSkeleton/Collection/VersionNamingCollection', [
    'UWA/Core',
    'UWA/Class/Model',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
    'DS/ParameterizationSkeleton/Utils/ParameterizationWebServices',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
    'DS/ParameterizationSkeleton/Views/VersionNamingExt/VersionNamingExtUtility'
], function (UWA, Model, Collection, ParameterizationDataUtils, ParameterizationWebServices, WAFData, URLHandler, VNEUtility) {
    'use strict';

    return Collection.extend({
        model: function (modelid) {
            return Model.extend();
        },

        setup: function (models, options) {
            console.log("VersionNamingCollection::setup");

            var _modelKey = options._modelKey;

            var domainID = _modelKey._attributes.domainid;
            var familyID = _modelKey._attributes.familyid;

            if (UWA.is(this.model, "function")) {
                console.log("bizarrerie");
                this.model = this.model(domainID);
            }

            var iURL = URLHandler.getURL() + "/resources/ParamWS/access/DomainElements?tenant=" + URLHandler.getTenant() + "&domainid=" + domainID;

            if (familyID !== null && familyID !== "")
                iURL = iURL + "&familyid=" + familyID;

            this.url = iURL;
        },

        /*fetch: function (options) {
            UWA.log("VersionNamingCollection::fetch");
            var that = this;

            var promiseTab = [];
            var promiseEnvVar = new Promise(function (resolve, reject) {
                setTimeout(() => {
                    resolve();
                }, 1000);
            });

            promiseTab.push(promiseEnvVar);

            UWA.Promise.all(promiseTab).then(function (data) {
                Collection.prototype.fetch.call(that);
            });
        },*/

        sync: function (method, model, options) {
            var that = this;

            console.log("VersionNamingCollection::sync");
            options.contentType = "application/json";
            if(typeof widget != 'undefined')
                options.lang = widget.lang;

            options.headers = {
                Accept: "application/json",
                "Content-Type": "application/json"
            };
            if(typeof widget != 'undefined')
                options.headers["Accept-Language"] = widget.lang;

            options.ajax = WAFData.authenticatedRequest;

            //IR-1234703-3DEXPERIENCER2024x - VDU 2024/02/13 : setting timeout to 3 minutes... the default timeout was used, and the default is 25 seconds
            options.timeout = 180000;
            console.log("wafdata timout for VersionNamingCollection is set to " + options.timeout);

            var parent_onComplete = options.onComplete;
            var parent_onFailure = options.onFailure;
            var parent_onTimeout = options.onTimeout;

            options.onComplete = function(arg) {
                console.log("WAFData onComplete callback called in VersionNamingCollection");
                try {
                    var parameters = arg.family[0].parameter;

                    var policies = new Map();
                    var types = new Map();

                    var getPolicyNamesHelper = function(par) {
                        return that.getPolicyNamesHelper(par);
                    };
                    
                    parameters.forEach( (par) => {
                        policies.set(par.id,getPolicyNamesHelper(par));
                    });

                    Promise.all([VNEUtility.getAssociatedSequencesPromise(policies,types),VNEUtility.getAllRevisionSequencesPromise()])
                    .then( ([json1, json2]) => {

                        var checkParamValueConsistentWithAssociatedSeq = function(par) {
                            // 1
                            let with_extended_revision_sequence = false;
                            for(let c of par.constant) {
                                if (c.id==="with_extended_revision_sequence")
                                    with_extended_revision_sequence = true;
                            }
 
                            if (par.id==="VNaming_VPLM_SMB_Definition") with_extended_revision_sequence = true;
                            if (par.id==="VNaming_VPLM_SMB_Resource")   with_extended_revision_sequence = true;
                            if (par.id==="VNaming_VPLM_SMB_Evaluation") with_extended_revision_sequence = true;
                            if (par.id==="VNaming_DocumentRelease")     with_extended_revision_sequence = true;
 
                            if (!with_extended_revision_sequence)
                                return true;
 
                            //2
                            let argValue = par.argument[0].argValue;
                            let policies = getPolicyNamesHelper(par);

                            let check = false;
                            for (let policy of policies) {
                                json1.forEach( (js1) => {
                                    if (js1.policy === policy && (js1.name === argValue || js1.altname === argValue)) 
                                        check = true;
                                });
                            }
                            if (!check) {
                                console.log("not found " + argValue + " / ");
                                for (let policy of policies) {
                                    json1.forEach( (js1) => {
                                        if (js1.policy === policy) 
                                            console.log("     "  + js1.name + " " + js1.altname);
                                    });
                                }
                            }
                            return check;
                        };

                        var checkSeqIsNotAlreadyOnParameter = function(par,extseq) {
                            for (let v in par.argument[0].value) {
                                if (v.id === extseq.altname)
                                    return false;
                            }
                            return true;
                        };

                        var checkSeqIsAllowedOnParameter = function(par,extseq) {
                            // 1
                            let with_extended_revision_sequence = false;
                            for(let c of par.constant) {
                                if (c.id==="with_extended_revision_sequence")
                                    with_extended_revision_sequence = true;
                            }

                            if (par.id==="VNaming_VPLM_SMB_Definition") with_extended_revision_sequence = true;
                            if (par.id==="VNaming_VPLM_SMB_Resource")   with_extended_revision_sequence = true;
                            if (par.id==="VNaming_VPLM_SMB_Evaluation") with_extended_revision_sequence = true;
                            if (par.id==="VNaming_DocumentRelease")     with_extended_revision_sequence = true;

                            if (!with_extended_revision_sequence)
                                return false;

                            console.log("VersionNamingCollection " + par.id + " allows extended revision");

                            // 2
                            let tags = extseq.tags || [];
                            let policies = getPolicyNamesHelper(par);
                            for (let policy of policies) {
                                if (tags.includes(policy))
                                    return false;
                            }

                            return true;
                        };

                        parameters.forEach( (par) => {
                            if (!Array.isArray(par.argument) || par.argument.length!=1) {
                                console.log("VersionNamingCollection::sync error 1, invalid case " + par);
                                console.log(par);
                                return;
                            }
                            if (!Array.isArray(par.argument[0].value) || par.argument[0].value.length==0) {
                                console.log("VersionNamingCollection::sync error 2, invalid case " + par);
                                console.log(par);
                                return;
                            }

                            var argValue = par.argument[0].argValue;

                            for (let extseq of json2) {
                                if(extseq.extended && checkSeqIsNotAlreadyOnParameter(par,extseq) && checkSeqIsAllowedOnParameter(par,extseq)) {
                                    let addingseq = {id: extseq.name, nlsKey: extseq.title, tooltipNlsKey: extseq.description};
                                    par.argument[0].value.push( addingseq );
                                    console.log(par.id + " completed with : " + extseq.name);
                                }
                            }

                            var isAppliedValueInSeqList = false;
                            for (var seq of par.argument[0].value) {
                                if (seq.id===argValue)
                                    isAppliedValueInSeqList = true;
                            }
                            if (par.isDeployed && !isAppliedValueInSeqList) {
                                console.log("error : " + par.id + " is associated to an invalid seq name (" + argValue + ")")
                                par.isDeployed = "false";
                            }
                            
                            if (par.isDeployed && !checkParamValueConsistentWithAssociatedSeq(par)) {
                                console.log("error : " + par.id + " is not associated to seq name (" + argValue + ")")
                                par.isDeployed = "false";
                            }
                        });

                        parent_onComplete(arg);
                    })
                    .catch( (e) => {
                        throw e;
                    });
                }
                catch(e) {
                    console.log(e);
                    parent_onComplete(arg);
                }
            };

            options.onFailure = function(arg) {
                console.log("WAFData onFailure callback called in VersionNamingCollection...");
                parent_onFailure(arg);
            };

            options.onTimeout = function(arg) {
                console.log("WAFData timeout reached in VersionNamingCollection...");
                if (parent_onTimeout) parent_onTimeout(arg);
            };

            this._parent.apply(this, [method, model, options]);
        },

        getPolicyNamesHelper: function(par) {
            if (par.id.endsWith("SMB_Definition"))
                return ["VPLM_SMB_Definition", "VPLM_SMB_Definition_MajorRev", "VPLM_SMB_Definition_Document", "VPLM_SMB_Definition_Document_MajorRev"];
            else if (par.id.endsWith("SMB_Evaluation"))
                return ["VPLM_SMB_Evaluation", "VPLM_SMB_Evaluation_MajorRev"];
            else if (par.id.endsWith("SMB_Resource"))
                return ["VPLM_SMB_Resource", "VPLM_SMB_Resource_MajorRev"];
            else if (par.id.endsWith("DEC_Definition"))
                return ["Design TEAM Definition"];
            else {
                for(let c of par.constant) {
                    if (c.id==="policy")
                        return [c.value];
                    if (c.id==="policies") {
                        try {
                            return c.value.split(",");
                        }
                        catch (e) {
                            console.log(e); 
                        }
                    }
                }
            }
            console.log("no policy rule found for " + par.id);
            return [];
        },

        parse: function (data) {
            //UWA.log("VersionNamingCollection::parse");
            //UWA.log(data);
            return data;
        },

        create: function (attributes, options) {
            options.proxy = "passport";
            this._parent.apply(this, [attributes, options]);
        },

        /*genPostParamsArrOnServer: function (connectProps, webserviceName, jsonArr, theImageCell, onFailurefct, onSuccessfct, modelAttrs) {
            var that = this;

            ParameterizationWebServices.genPostParamsArrOnServer(connectProps, webserviceName, jsonArr, theImageCell, onFailurefct, onSuccessfct);
            return;
        },*/

    });
});

/*@fullReview  ZUR 15/11/23 2017x Param Skeleton*/
/*global define, widget*/

//const fs = require('fs');

define('DS/ParameterizationSkeleton/Views/VersionNamingExt/VersionNamingExtLayoutView',
    [
        'UWA/Core',
        'UWA/Class/View',
        'DS/UIKIT/Mask',
        'DS/UIKIT/Scroller',
        'DS/UIKIT/Input/Button',
        'DS/UIKIT/Input/File',
        'DS/UIKIT/Popover',
        'DS/Controls/Label',
        'DS/Controls/Editor',
        'DS/ParameterizationSkeleton/Views/VersionNamingExt/VersionNamingExtUtility',
        'DS/ParameterizationSkeleton/Views/VersionNamingExt/VersionNamingExtAlertUtility',
        'i18n!DS/ParameterizationSkeleton/assets/nls/VersionNamingNLS',
        'UWA/Drivers/Alone',
        'DS/Core/Core',
        'DS/TreeModel/DataModelSet',
        'DS/TreeModel/TreeDocument',
        'DS/TreeModel/TreeNodeModel',
        'DS/DataGridView/DataGridView',
        'DS/CollectionView/CollectionViewStatusBar',
        'DS/Windows/ImmersiveFrame',
        'DS/Windows/Panel',
        'DS/Controls/Button',
        'DS/Utilities/Utils',

        'DS/WAFData/WAFData',
        'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
        'DS/WUXAutoComplete/AutoComplete',
        'UWA/Promise',
        'DS/Controls/ProgressBar',
        'DS/Windows/Dialog',
        'DS/Controls/ModalContainer',
        'DS/Controls/Loader',
        'DS/WebappsUtils/WebappsUtils',
        'DS/Utilities/Dom'

    ], function (UWA, View, Mask, Scroller, Button, UXFile, Popover, Label, Editor, VNEUtility, AlertUtility, VersionNamingNLS, Alone, WUX, DataModelSet, TreeDocument, TreeNodeModel, WUXDataGridView, CollectionViewStatusBar, WUXImmersiveFrame, WUXPanel, WUXButton, Utils, WAFData, URLHandler, WUXAutoComplete, Promise, ProgressBar, WUXDialog, WUXModalContainer, WUXLoader, WebappsUtils, Dom) {
    'use strict';

    var odtMode = 0;

    var extendedView = View.extend({

        defaultOptions: {
            type: 'default'
        },

        // The ‘options’ object is passed via the ‘viewOptions’ specified in the Renderer at the Skeleton instantiation
        init: function (options) {
            console.log("VersionNamingExtLayoutView::init");
            this.options = UWA.clone(options || {}, false); //environment options
            this._parent(options);
            this.childView = null;
        },

        render: function () {
            var that = this;
            //
            that.contentDiv = UWA.createElement('div', {
                'id': "VersionNamingExtParamContainer"
            });

            //that.contentDiv.style.width = "100%"; NO!! (à cause du margin dans le css)
            that.contentDiv.style.height = "100%";
            that.contentDiv.style.margin = "14px";
            that.container.setContent(that.contentDiv);

            //
            that.createHeader(that.contentDiv);

            //
            var versionNamingTable = UWA.createElement('table', {
                'id': "VersionNamingExtParamTable"
            });
            versionNamingTable.style.width = "100%";
            versionNamingTable.style.marginBottom = "10px";
            //versionNamingTable.style.height = "100%";
            versionNamingTable.inject(that.contentDiv);

            var versionNamingDiv = UWA.createElement('tr', {
                'id': "Elmt1"
            }).inject(versionNamingTable);

            this.createComponents(versionNamingDiv, that.contentDiv);

            return that;
        },

        createComponents: function (versionNamingDiv, contentDiv) {
            var that = this;
            var file = null;
            var myDGV = null;
            var model = new TreeDocument();

            var arrayERS_set = new Array();
            var arrayERS_reset = new Array();
            var arrayERS_Title_set = new Array();
            var arrayERS_Title_reset = new Array();

            var arrayDisplay_set = new Array();
            var arrayDisplay_reset = new Array();

            var fromTypes = new Array();
            var toTypes = new Array();

            var initial = contentDiv.innerHTML;

            var ODT_MODE = undefined;

            if (window.__karma__ != undefined) {
                ODT_MODE = window.__karma__.config.args[0];
            }

            var browseDiv = UWA.createElement('div', {
                'id': "browseDiv",
                'display': "inline"
            }).inject(versionNamingDiv);

            /*var browseDiv2 = UWA.createElement('div', {
            'id': "browseDiv2",
            'display': "inline"
            }).inject(versionNamingDiv);*/

            var fileSelector = new UXFile({
                multiple: false,
                buttonBefore: false,
                name: 'file-input',
                buttonClassName: 'default',
                placeholder: VersionNamingNLS.SelectAFile,
                buttonText: VersionNamingNLS.BrowseButtonText
            }).inject(browseDiv);

            var fakeInput = undefined;

            fileSelector.onChange = function (data) {

                if (ODT_MODE != undefined) {

                    var name = "name";
                    var AlphabetPadding = "AlphabetPadding";
                    var title = "title";
                    var Alphabetwithpadding = "Alphabet with padding";
                    var mode = "mode";
                    var alphabet = "alphabet";
                    var alphabetVal = "[A-H,J-N,P,R,T-W,Y]";
                    var padding = "padding";
                    var myChar = "char";
                    var tiret = "-";
                    var direction = "direction";
                    var left = "left";
                    var tosize = "tosize";

                    fakeInput = "[{\"" + name + "\": \"" + AlphabetPadding + "\", \"" + title + "\": \"" + Alphabetwithpadding + "\",\"" + mode + "\": \"" + alphabet + "\",\"" + alphabet + "\": \"" + alphabetVal + "\",\"" + padding + "\": {\"" + myChar + "\": \"" + tiret + "\",\"" + direction + "\": \"" + left + "\",\"" + tosize + "\": 3}}]";
                    const blob = new Blob([fakeInput], {
                        type: 'text/plain'
                    });
                    file = new File([blob], 'DefinedRevisionSequence.json');
                } else {
                    file = fileSelector.elements.input.files[0];
                }
                fileSelector.elements.container.getChildren()[0].placeholder = file.name;
            }
			
			var getLanguage = function () {

                var locale;
                //if (window && window.dsLang) {
                if (window && window.widget && window.widget.lang) {
                    //locale = window.dsLang;
                    locale = window.widget.lang;
                    if ('devsymbol' === locale) {
                        locale = 'en';
                    }
                } else {
                    var lang;
                    if (window && window.clntlang) {
                        // this variable is set by BPS
                        // by reading 'Accept-Language' header to emxNavigator.jsp,
                        // which is the only way to access user preference language  for IE(no way to access it in JS)
                        lang = window.clntlang;
                    } else if (navigator && navigator.languages && UWA.is(navigator.languages, 'array') && navigator.languages.length > 0) {
                        lang = navigator.languages[0];
                    } else {
                        lang = (navigator ? (navigator.language || navigator.systemLanguage) : DEFAULT_LANG);
                    }
                    locale = lang.toLowerCase().split('-')[0];
                }
                return locale;
            }

            var language = getLanguage();

            // Upload button to upload selected file
            var uploadButton = new Button({
                id: "uploadButton_",
                className: "primary",
                value: VersionNamingNLS.UploadButtonText,
                icon: 'upload'
            })
                .inject(browseDiv);
            uploadButton.elements.container.style.marginTop = "5px";
            uploadButton.addEvent('onClick', function () {

                if (!file) {
                    AlertUtility.message('error', VersionNamingNLS.NoFileToUpload);
                    fileSelector.elements.container.getChildren()[0].placeholder = VersionNamingNLS.SelectAFile;
                    fileSelector.clear();
                    return;
                }

                //Parse & checks
                var reader = new FileReader();
                reader.onload = function (event) {
                    var fileContent = reader.result;
                    that.parseFileContent(fileContent,
                        (json1) => {
                        var parsedRevisionSequences = json1;
                        console.log("revision sequences' file " + file.name + " parsed OK");
                        if (!parsedRevisionSequences) {
                            AlertUtility.message('error', VersionNamingNLS.NoContentToUpload);
                            file = null;
                            fileSelector.elements.container.getChildren()[0].placeholder = VersionNamingNLS.SelectAFile;
                            fileSelector.clear();
                            return;
                        }
                        var jsonData = parsedRevisionSequences;
                        VNEUtility.uploadRevisionSequencesPromise(jsonData, String(language))
                        .then((jsonres) => {
                            if (!jsonres || jsonres.severity === "FATAL_ERROR" || jsonres.severity === "ERROR") {
                                if (jsonres && !!jsonres.errorMessage)
                                    AlertUtility.message('error', jsonres.errorMessage);
                                else
                                    AlertUtility.message('error', VersionNamingNLS.UploadFailedAlert);
                            } else {
                                AlertUtility.message('success', VersionNamingNLS.UploadSuccessAlert);

                                arrayERS_set.splice(0, arrayERS_set.length);
                                arrayERS_reset.splice(0, arrayERS_reset.length);
                                arrayERS_Title_set.splice(0, arrayERS_Title_set.length);
                                arrayERS_Title_reset.splice(0, arrayERS_Title_reset.length);

                                arrayERS_set.push(VersionNamingNLS.SetSequence);
                                arrayERS_reset.push(VersionNamingNLS.ResetSequence);
                                arrayERS_Title_set.push(VersionNamingNLS.SetSequence);
                                arrayERS_Title_reset.push(VersionNamingNLS.ResetSequence);

                                arrayDisplay_set.splice(0, arrayDisplay_set.length);
                                arrayDisplay_reset.splice(0, arrayDisplay_reset.length);

                                var myContainer = document.getElementById("VersionNamingExtParamContainer");
                                var loader = new WUXLoader();
                                var parentContainer = myContainer.getParent();

                                loader.on("Update Extended Revision Sequences...");

                                if (ODT_MODE == undefined || ODT_MODE != "ODT_MODE") {
                                    WUXModalContainer.createModal(parentContainer, loader.elements.container);
                                }

                                const urlSecurityContext = URLHandler.getURL() + "/resources/pno/person/getsecuritycontext?tenant=" + URLHandler.getTenant();
                                console.log("Get security context:");
                                WAFData.authenticatedRequest(urlSecurityContext, {
                                    timeout: 250000,
                                    method: 'GET',
                                    data: "",
                                    type: 'json',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    onFailure: function (e) {
                                        if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {
                                            var securityContext = "VPLMAdmin.MyCompany.Default";
                                            this.onComplete(securityContext);
                                        } else {
                                            console.log('getsecuritycontext: onFailure:' + e);
                                        }
                                    },
                                    onComplete: function (securityContext) {

                                        var secCont = securityContext;

                                        const urlFinal = URLHandler.getURL() + "/resources/v1/dslc/getrevisionsequences" + "?tenant=" + URLHandler.getTenant();
                                        var postInput2 = {
                                            "sequences": [{
                                                    "search": "*"
                                                }
                                            ]
                                        };
                                        WAFData.authenticatedRequest(urlFinal, {
                                            timeout: 250000,
                                            method: 'POST',
                                            data: UWA.Json.encode(postInput2),
                                            type: 'json',
                                            headers: {
                                                'Content-Type': 'application/json',
                                                'Accept': 'application/json',
                                                'SecurityContext': secCont.SecurityContext,
                                            },
                                            onFailure: function (e) {

                                                if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {
                                                    var payload = [{
                                                            "name": "ERS_TEST_01",
                                                            "title": "Primary 1 chars minus IOXY",
                                                            "description": "Revision names only 3 characters with I, O, X, Y & Z forbidden",
                                                            "mode": "alphabet",
                                                            "init": ["---"],
                                                            "alphabet": ["A", "B", "C", "D", "E", "F", "G", "H", "J", "…"],
                                                            "sequence": "---,A,C,D,E,F,G,H,J,K,L,M,N,P,Q,R,S,T,U,V,W,Y,..."
                                                        }
                                                    ];
                                                    this.onComplete(payload);
                                                } else {
                                                    console.log('getrevisionsequences: onFailure:' + e);
                                                }
                                            },
                                            onComplete: function (payload) {

                                                console.log('getrevisionsequences: onComplete:' + payload);
                                                for (var i = 0; i < payload.length; i++) {

                                                    if (payload[i].title != undefined) {

                                                        arrayERS_set.push(payload[i].name);
                                                        arrayERS_reset.push(payload[i].name);

                                                        var counter = 0;
                                                        for (var currTitle of arrayERS_Title_set) {
                                                            if (currTitle == payload[i].title) {
                                                                counter++;
                                                            }
                                                        };

                                                        if (counter > 0) {

                                                            arrayERS_Title_set.push(payload[i].title + " (" + counter.toString() + ")");
                                                            arrayERS_Title_reset.push(payload[i].title + " (" + counter.toString() + ")");

                                                        } else {
                                                            arrayERS_Title_set.push(payload[i].title);
                                                            arrayERS_Title_reset.push(payload[i].title);
                                                        }
                                                    }

                                                }

                                                arrayDisplay_set = arrayERS_Title_set.slice();
                                                arrayDisplay_reset = arrayERS_Title_reset.slice();

                                                model.loadModel(model);

                                                loader.off();
                                                WUXModalContainer.removeModal(parentContainer);
                                                parentContainer.style.position = "";

                                            }

                                        })

                                    }
                                });

                            }

                            file = null;
                            fileSelector.elements.container.getChildren()[0].placeholder = VersionNamingNLS.SelectAFile;
                            fileSelector.clear();
                        })
                        .catch((e) => {
                            file = null;
                            fileSelector.elements.container.getChildren()[0].placeholder = VersionNamingNLS.SelectAFile;
                            fileSelector.clear();
                            if (!e)
                                e = VersionNamingNLS.UploadFailedAlert;
                            AlertUtility.message('error', e);
                        });
                    },
                        (errorMsg, e) => {
                        console.log("revision sequences' file " + file.name + " parsing failed");
                        file = null;
                        fileSelector.elements.container.getChildren()[0].placeholder = VersionNamingNLS.SelectAFile;
                        fileSelector.clear();

                        console.log(errorMsg);
                        console.log(e);
                        var msg = errorMsg;
                        if (!!e)
                            msg += "<br/>" + e;
                        //AlertUtility.message('error', msg);
						AlertUtility.message('error', VersionNamingNLS.FailedToParse);
                    });
                };
                reader.readAsText(file);
            });

            var downloadButton = new Button({
                id: "downloadButton_",
                className: "default",
                value: VersionNamingNLS.DownloadButtonText,
                icon: 'download'
            })
                .inject(browseDiv);
            downloadButton.elements.container.style.marginTop = "5px";
            downloadButton.elements.container.style.marginLeft = "5px";
            downloadButton.elements.container.style.float = "right";
            downloadButton.addEvent('onClick', function () { //Push content on server
                VNEUtility.downloadRevisionSequencesPromise()
                .then((content) => {
                    var concatedcontent = that.concatSequences(content);
                    return concatedcontent;
                })
                .then((concatedcontent) => {
                    var hrefcontent = encodeURIComponent(concatedcontent); //(VDU) IR-1367352-3DEXPERIENCER2025x, it is necessary to encode the content
                    var element = document.createElement('a');
                    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + hrefcontent);
                    element.setAttribute('download', "revisions.json");

                    element.style.display = 'none';
                    document.body.appendChild(element);

                    element.click();

                    document.body.removeChild(element);

                    /* alternative solution for downloading concatedcontent:
                    var blob = new Blob([concatedcontent], { type: 'application/json' });
                    var url = URL.createObjectURL(blob);
                    var a = document.createElement('a');
                    a.href = url;
                    a.download = 'revisions.json';
                    a.click();
                    URL.revokeObjectURL(url);
                    */
                })
                .catch((e) => {
                    if (!e)
                        e = VersionNamingNLS.DownloadFailedAlert;
                    AlertUtility.message('error', e);
                });
            });

            // -----------------------------------------------------------------------------

            // loadJSON method to open the JSON file.

            var ENOLifecycle_ERS_Activated = "false";
            var ENOLifecycle_debug_Activated = "false";

            var pathRes = WebappsUtils.getWebappsAssetUrl('ParameterizationSkeleton', 'LifecycleTypesResources.json');

            function loadJSONVar(path, success, error) {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4) {
                        if (xhr.status === 200) {
                            success(JSON.parse(xhr.responseText));

                        } else {
                            error(xhr);
                        }
                    }
                };
                xhr.open('GET', path, true);
                xhr.send();
            }

            loadJSONVar(pathRes, getERSVar, 'jsonp');

            function getERSVar(rootTypes) {

                for (var l = 0; l < rootTypes.length; l++) {

                    if (rootTypes[l].ENOLifecycle_ERS_Activated != undefined && rootTypes[l].ENOLifecycle_ERS_Activated == "true") {
                        ENOLifecycle_ERS_Activated = "true";

                    } else if (rootTypes[l].ENOLifecycle_debug_Activated != undefined && rootTypes[l].ENOLifecycle_debug_Activated == "true") {

                        ENOLifecycle_debug_Activated = "true";
                    } else if (rootTypes[l].propagations != undefined) {

                        for (var m = 0; m < rootTypes[l].propagations.length; m++)

                            if (rootTypes[l].propagations[m].from != undefined && rootTypes[l].propagations[m].to) {

                                fromTypes.push(rootTypes[l].propagations[m].from);
                                toTypes.push(rootTypes[l].propagations[m].to);

                            }
                    }

                }

                if (ENOLifecycle_ERS_Activated == "true") {

                    model.prepareUpdate();

                    var createNode = function (label, icon) {

                        //if (icon)
                        //listIconNames.push(icon);

                        var that = this;

                        var data = null;

                        data = [{
                                "tree": label,
                                "ERS": VersionNamingNLS.SetSequence
                            }
                        ]

                        var nodeData = data[0];

                        //var myPath = '/snresources/images/icons/small/' + String(icon) + '.png';

                        //var allPath = WebappsUtils.getWebappsAssetUrl('ParameterizationSkeleton', myPath);

                        /*if (fs.existsSync('foo.txt')) {
                        var test = null;
                        }

                        if (fs.existsSync(myPath)) {
                        var test = null;
                        }*/

                        //This

                        var myURL1 = URLHandler.getURL() + "/snresources/images/icons/small/" + String(icon) + ".png" + "?tenant=" + URLHandler.getTenant();
                        //var myURL1 = LifecycleServicesSettings.get3DSpaceWSUrl(URLHandler.getTenant(), '/snresources/images/icons/small/' + String(icon) + '.png', null);


                        //var myURL2 = LifecycleServicesSettings.get3DSpaceWSUrl(URLHandler.getTenant(), '/snresources/images/icons/small/' + String(icon) + '.bmp', null);


                        /*var isValidUrl = function (url) {
                        try {
                        var validUrl = new URL(url);
                        return true;
                        } catch (error) {
                        return false;
                        }
                        }*/

                        //var test = isValidUrl(myURL);

                        //var test = fileManagement.fileExists(myURL);


                        /*var UrlExists = function (url) {
                        var http = new XMLHttpRequest();
                        http.open('HEAD', url, false);
                        http.send();
                        if (http.status != 404)
                        return false;
                        else
                        return true;
                        }*/

                        // ------------------------

                        //LifecycleServicesSettings.app_initialization(function () {

                        //const urlSecurityContext = URLHandler.getURL() + "/snresources/images/icons/small/" + String(icon) + ".png?tenant=" + URLHandler.getTenant();
                        /* console.log("Get security context:");
                        WAFData.authenticatedRequest("https://vdevpril949dsy.dsone.3ds.com/3DSpace/snresources/images/icons/small/I_VPMNavProduct.png?tenant=OnPremise", {
                        timeout: 250000,
                        method: 'GET',
                        data: "",
                        type: 'json',
                        headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                        },
                        onFailure: function (e) {
                        console.log('getsecuritycontext: onFailure:' + e);
                        myURL = LifecycleServicesSettings.get3DSpaceWSUrl(URLHandler.getTenant(), '/snresources/images/icons/small/' + String(icon) + '.bmp', null);
                        },
                        onComplete: function (payload) {
                        console.log('getrevisionsequences: onComplete:' + payload);
                        }
                        });		*/
                        //});

                        //----------------------------

                        if (icon) {
                            return new TreeNodeModel({
                                label: label,
                                grid: nodeData,
                                icons: [{
                                        //iconName: "3dpart"
                                        //iconPath: WebappsUtils.getWebappsAssetUrl('ParameterizationSkeleton', myPath)
                                        iconPath: myURL1
                                        //iconPath: myURL
                                    }
                                    /*,{
                                    iconPath: myURL2
                                    }*/
                                ]// There is also "product"
                            });

                        } else {
                            return new TreeNodeModel({
                                label: label,
                                grid: nodeData
                            });
                        }

                    };

                    var getIcon = function (payload, type) {

                        for (var l = 0; l < payload.tree_of_childs.length; l++) {

                            if (type == payload.tree_of_childs[l].type) {

                                return payload.tree_of_childs[l].icon;
                                break;
                            }
                        }
                    }
                    // to be deleted
                    var getTypeNls = function (payload, type) {

                        for (var l = 0; l < payload.tree_of_childs.length; l++) {

                            if (type == payload.tree_of_childs[l].type) {

                                return payload.tree_of_childs[l].typeNls;
                                break;
                            }
                        }
                    }

                    // YXX --- Recursive method to retrieve tree

                    var _attachChildren = function (payload, k, fatherNode) {

                        var currentNode = undefined;
                        var icon = undefined;

                        // to be deleted
                        var typeNls = undefined;

                        for (var j = 0; j < payload.tree_of_childs[k].children.length; j++) {

                            icon = getIcon(payload, payload.tree_of_childs[k].children[j]);

                            // to be deleted
                            typeNls = getTypeNls(payload, payload.tree_of_childs[k].children[j]);

                            /*if (!icon) {
                            var test = undefined;
                            }*/

                            /*if (icon) {
                            const png = ".png";
                            //copyfile.js
                            const fs = require('fs');

                            // destination will be created or overwritten by default.
                            fs.copyFile("\\dsone\rnd\R426rel\BSFDOCEN\Graphics\Icons22.doc\src\I_VPMNavProduct.png","E:\users\yxx\ADELE\R426\yxxBSF24x_WebSer\VPLMTeamParameterizationUI\ParameterizationSkeleton.mweb\src\assets\icons\types\I_VPMNavProduct.png",
                            (err) => { if (err) throw err; console.log('File was copied to destination');})
                            }*/

                            /*if (icon){

                            fs.copyFile("\\dsone\rnd\R426rel\BSFDOCEN\Graphics\Icons22.doc\src\I_VPMNavProduct.png", "C:\types\I_VPMNavProduct.png", (err)=> {if (err) throw err; console.log('toto');});
                            }*/

                            // to be replaced
                            //currentNode = createNode(payload.tree_of_childs[k].childrenNls[j], icon);
                            currentNode = createNode(typeNls, icon);

                            fatherNode.addChild(currentNode);

                            for (var l = 0; l < payload.tree_of_childs.length; l++) {

                                if (payload.tree_of_childs[k].children[j] == payload.tree_of_childs[l].type) {

                                    _attachChildren(payload, l, currentNode);

                                    break;

                                }

                            }

                        }
                    }

                    //  -----------------------------------


                    model.expandAll();
                    model.pushUpdate();

                    //

                    // --- YXX : build tree

                    //var arrayERS_set = new Array();
                    arrayERS_set.push(VersionNamingNLS.SetSequence);
                    //var arrayERS_reset = new Array();
                    arrayERS_reset.push(VersionNamingNLS.ResetSequence);

                    //var arrayERS_Title_set = new Array();
                    arrayERS_Title_set.push(VersionNamingNLS.SetSequence);
                    //var arrayERS_Title_reset = new Array();
                    arrayERS_Title_reset.push(VersionNamingNLS.ResetSequence);

                    var secCont;
                    //var arrayDisplay_set = new Array();
                    //var arrayDisplay_reset = new Array();
                    var listOfTypes = new Array();
                    var listOfTypesNls = new Array();
                    var listOfSequences = new Array();
                    var listOfSequencesTitle = new Array();
                    var listOfShowTypes = new Array();
                    var nbrChilds;
                    var postInputTypes = "";

                    var payloadTree;

                    var progressStatusNode;
                    var curData = 0;
                    var cellInfosODT;

                    //LifecycleServicesSettings.app_initialization(function () {

                    // fetch file to retrieve roots types

                    var listOfRoots = new Array();
                    //var containPLMCore = 0;

                    var pathResource = WebappsUtils.getWebappsAssetUrl('ParameterizationSkeleton', 'LifecycleTypesResources.json');

                    // loadJSON method to open the JSON file.
                    function loadJSON(path, success, error) {
                        var xhr = new XMLHttpRequest();
                        xhr.onreadystatechange = function () {
                            if (xhr.readyState === 4) {
                                if (xhr.status === 200) {
                                    success(JSON.parse(xhr.responseText));
                                    /*if (containPLMCore == 0)
                                    listOfRoots.push("PLMCoreReference");*/

                                } else {
                                    error(xhr);
                                }
                            }
                        };
                        xhr.open('GET', path, true);
                        xhr.send();
                    }

                    loadJSON(pathResource, getRootTypes, 'jsonp');

                    function getRootTypes(rootTypes) {

                        for (var l = 0; l < rootTypes.length; l++) {

                            if (rootTypes[l].fileName != undefined) {

                                listOfRoots.push(rootTypes[l].fileName);

                            }
                            /*if (rootTypes[l].fileName == "PLMCoreReference"){
                            containPLMCore = 1;
                            }*/
                        }

                    }

                    /*const urlSecurityContext = URLHandler.getURL() + "/resources/pno/person/getsecuritycontext?tenant=" + URLHandler.getTenant();
                    console.log("Get security context:");
                    WAFData.authenticatedRequest(urlSecurityContext, {
                    timeout: 250000,
                    method: 'GET',
                    data: "",
                    type: 'json',
                    headers: {
                    'Content-Type': 'application/json',
                    //'Accept': 'application/json'
                    },
                    onFailure: function (e) {
                    console.log('getsecuritycontext: onFailure:' + e);
                    },
                    onComplete: function (securityContext) {

                    secCont = securityContext;

                    const urlFinal = URLHandler.getURL() + "/resources/v1/dslc/getrevisionsequences" + "?tenant=" + URLHandler.getTenant();
                    var postInput2 = {
                    "sequences": [{
                    "search": "*"
                    }
                    ]
                    };
                    WAFData.authenticatedRequest(urlFinal, {
                    timeout: 250000,
                    method: 'POST',
                    data: UWA.Json.encode(postInput2),
                    type: 'json',
                    headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                    'SecurityContext': secCont.SecurityContext,
                    },
                    onFailure: function (e) {
                    console.log('getrevisionsequences: onFailure:' + e);
                    },
                    onComplete: function (payload) {
                    console.log('getrevisionsequences: onComplete:' + payload);
                    for (var i = 0; i < payload.length; i++) {

                    if (payload[i].title != undefined) {

                    arrayERS_set.push(payload[i].name);
                    arrayERS_reset.push(payload[i].name);

                    //arrayERS_Title_set.push(payload[i].title);
                    //arrayERS_Title_reset.push(payload[i].title);

                    var counter = 0;
                    for (var currTitle of arrayERS_Title_set) {
                    if (currTitle == payload[i].title) {
                    counter++;
                    }
                    };

                    if (counter > 0) {

                    arrayERS_Title_set.push(payload[i].title + " (" + counter.toString() + ")");
                    arrayERS_Title_reset.push(payload[i].title + " (" + counter.toString() + ")");

                    } else {
                    arrayERS_Title_set.push(payload[i].title);
                    arrayERS_Title_reset.push(payload[i].title);
                    }
                    }

                    }
                    //arrayDisplay_set = arrayERS_set.slice();
                    //arrayDisplay_reset = arrayERS_reset.slice();

                    arrayDisplay_set = arrayERS_Title_set.slice();
                    arrayDisplay_reset = arrayERS_Title_reset.slice();
                    }
                    });

                    var that = this;
                    //var path = LifecycleServicesSettings.get3DSpaceWSUrl(URLHandler.getTenant(), '/resources/lifecycle/hierarchictypestree/gethierarchictypestree', null);

                    //This

                    var path = "";
                    var path = URLHandler.getURL() + "/resources/lifecycle/hierarchictypestree/gethierarchictypestree" + "?tenant=" + URLHandler.getTenant() + "&lang=" + String(language) + "&debug=" + String(ENOLifecycle_debug_Activated);

                    //var path = LifecycleServicesSettings.get3DSpaceWSUrl(URLHandler.getTenant(), '/resources/lifecycle/hierarchictypestree/gethierarchictypestree', //'lang=' + String(language) + '&debug=' + String(ENOLifecycle_debug_Activated));

                    //var type_1 = "VPMReference";
                    var type_2 = "Document";
                    var type_3 = "VPMRepReference";
                    //var type_4 = "RFLVPMLogicalReference";
                    var type_5 = "PLMCoreReference";
                    var postInput = {
                    //types: [type_1, type_2, type_3, type_4, type_5]// Do not exceed 20 types
                    types: listOfRoots
                    };
                    //var payloadTree;

                    WAFData.authenticatedRequest(path, {
                    method: 'POST',
                    type: 'json',
                    timeout: 1000 * 60, // ms, 1min
                    data: UWA.Json.encode(postInput),
                    //headers: LifecycleServicesSettings.getHeaders(),
                    headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                    },
                    onComplete: function (payload) {

                    payloadTree = payload;

                    console.log('gettypeshierarchy: onComplete:' + payload);
                    //Parse result to find if input type is in the hierarchy

                    if (payload.hasOwnProperty("tree_of_childs") && payload.tree_of_childs.length > 0) {

                    nbrChilds = payload.tree_of_childs.length;
                    var currentNode = undefined;

                    // YXX --- Get default sequences for all types in one request

                    const urlFinal = URLHandler.getURL() + "/resources/v1/dslc/associaterevisionsequences" + "?tenant=" + URLHandler.getTenant();

                    var sequences = "sequences";
                    var operator = "operator";
                    var type = "type";
                    var get = "GET";

                    var postInput = "{\"" + sequences + "\" : [ ";

                    for (var f = 0; f < nbrChilds; f++) {

                    listOfTypes.push(payload.tree_of_childs[f].type)
                    listOfTypesNls.push(payload.tree_of_childs[f].typeNls)
                    listOfShowTypes.push(payload.tree_of_childs[f].showType)

                    if (f == (nbrChilds - 1)) {
                    postInput = postInput.concat("{\"", operator, "\" : \"", get, "\", \"", type, "\" : \"", listOfTypes[f], "\"}");
                    } else {

                    postInput = postInput.concat("{\"", operator, "\" : \"", get, "\", \"", type, "\" : \"", listOfTypes[f], "\"},");
                    }
                    }

                    postInput = postInput.concat(" ]}");

                    postInputTypes = postInput;

                    WAFData.authenticatedRequest(urlFinal, {
                    timeout: 250000,
                    method: 'POST',
                    data: postInput,
                    type: 'json',
                    headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                    'SecurityContext': secCont.SecurityContext,
                    },
                    onFailure: function (e) {
                    console.log('associaterevisionsequences: onFailure:' + e);
                    },
                    onComplete: function (payload) {
                    console.log('associaterevisionsequences: onComplete:');

                    for (var g = 0; g < nbrChilds; g++) {

                    var currentNode = undefined;

                    if (payload.sequences[g].name != undefined) {
                    listOfSequences.push(payload.sequences[g].name);
                    listOfSequencesTitle.push(payload.sequences[g].sequence.title);
                    } else {
                    listOfSequences.push("set sequence");
                    listOfSequencesTitle.push("set sequence");
                    }

                    var currentRoot = payloadTree.tree_of_childs[g].root_type;

                    // YXX --- I am on a root
                    if (currentRoot == payloadTree.tree_of_childs[g].type) {
                    // to be replaced
                    //currentNode = createNode(payloadTree.tree_of_childs[g].root_typeNls, payloadTree.tree_of_childs[g].icon);
                    currentNode = createNode(payloadTree.tree_of_childs[g].typeNls, payloadTree.tree_of_childs[g].icon);
                    model.addChild(currentNode);

                    _attachChildren(payloadTree, g, currentNode);

                    }
                    }

                    }
                    });

                    // ------------------------------------------
                    }
                    },

                    onFailure: function (e) {
                    console.log('gettypeshierarchy: onFailure:' + e);
                    },

                    onTimeout: function () {
                    console.log('gettypeshierarchy: onTimeout: A connection timeout occured.');
                    }
                    });

                    }
                    });*/

                    //------------


                    var progressInterval;

                    progressInterval = setInterval(function () {

                        curData += 13 / (listOfRoots.length);

                        if (curData < 100) {
                            progressStatusNode.updateOptions({
                                grid: {
                                    data: curData
                                }
                            });
                        }

                    }, 500);

                    const urlSecurityContext = URLHandler.getURL() + "/resources/pno/person/getsecuritycontext?tenant=" + URLHandler.getTenant();
                    console.log("Get security context:");
                    WAFData.authenticatedRequest(urlSecurityContext, {
                        timeout: 250000,
                        method: 'GET',
                        data: "",
                        type: 'json',
                        headers: {
                            'Content-Type': 'application/json',
                            //'Accept': 'application/json'
                        },
                        onFailure: function (e) {

                            if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {
                                var securityContext = "VPLMAdmin.MyCompany.Default";
                                this.onComplete(securityContext);
                            } else {
                                //sinon
                                console.log('getsecuritycontext: onFailure:' + e);
                            }
                        },
                        onComplete: function (securityContext) {

                            secCont = securityContext;

                            const urlFinal = URLHandler.getURL() + "/resources/v1/dslc/getrevisionsequences" + "?tenant=" + URLHandler.getTenant();
                            var postInput2 = {
                                "sequences": [{
                                        "search": "*"
                                    }
                                ]
                            };
                            WAFData.authenticatedRequest(urlFinal, {
                                timeout: 250000,
                                method: 'POST',
                                data: UWA.Json.encode(postInput2),
                                type: 'json',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Accept': 'application/json',
                                    'SecurityContext': secCont.SecurityContext,
                                },
                                onFailure: function (e) {
                                    if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {
                                        var payload = [{
                                                "name": "ERS_TEST_01",
                                                "title": "Primary 1 chars minus IOXY",
                                                "description": "Revision names only 3 characters with I, O, X, Y & Z forbidden",
                                                "mode": "alphabet",
                                                "init": ["---"],
                                                "alphabet": ["A", "B", "C", "D", "E", "F", "G", "H", "J", "…"],
                                                "sequence": "---,A,C,D,E,F,G,H,J,K,L,M,N,P,Q,R,S,T,U,V,W,Y,..."
                                            }
                                        ];
                                        this.onComplete(payload);
                                    } else {
                                        //sinon
                                        console.log('getrevisionsequences: onFailure:' + e);
                                    }
                                },
                                onComplete: function (payload) {

                                    console.log('getrevisionsequences: onComplete:' + payload);
                                    for (var i = 0; i < payload.length; i++) {

                                        if (payload[i].title != undefined) {

                                            arrayERS_set.push(payload[i].name);
                                            arrayERS_reset.push(payload[i].name);

                                            //arrayERS_Title_set.push(payload[i].title);
                                            //arrayERS_Title_reset.push(payload[i].title);

                                            var counter = 0;
                                            for (var currTitle of arrayERS_Title_set) {
                                                if (currTitle == payload[i].title) {
                                                    counter++;
                                                }
                                            };

                                            if (counter > 0) {

                                                arrayERS_Title_set.push(payload[i].title + " (" + counter.toString() + ")");
                                                arrayERS_Title_reset.push(payload[i].title + " (" + counter.toString() + ")");

                                            } else {
                                                arrayERS_Title_set.push(payload[i].title);
                                                arrayERS_Title_reset.push(payload[i].title);
                                            }
                                        }

                                    }
                                    //arrayDisplay_set = arrayERS_set.slice();
                                    //arrayDisplay_reset = arrayERS_reset.slice();

                                    arrayDisplay_set = arrayERS_Title_set.slice();
                                    arrayDisplay_reset = arrayERS_Title_reset.slice();
                                }
                            });

                            //}});

                            var that = this;
                            //var path = LifecycleServicesSettings.get3DSpaceWSUrl(URLHandler.getTenant(), '/resources/lifecycle/hierarchictypestree/gethierarchictypestree', null);

                            //This

                            var path = "";
                            var path = URLHandler.getURL() + "/resources/lifecycle/hierarchictypestree/gethierarchictypestree" + "?tenant=" + URLHandler.getTenant() + "&lang=" + String(language) + "&debug=" + String(ENOLifecycle_debug_Activated);

                            //var path = LifecycleServicesSettings.get3DSpaceWSUrl(URLHandler.getTenant(), '/resources/lifecycle/hierarchictypestree/gethierarchictypestree', //'lang=' + String(language) + '&debug=' + String(ENOLifecycle_debug_Activated));

                            //var type_1 = "VPMReference";
                            var type_2 = "Document";
                            var type_3 = "VPMRepReference";
                            //var type_4 = "RFLVPMLogicalReference";
                            var type_5 = "PLMCoreReference";
                            var postInput = {
                                //types: [type_1, type_2, type_3, type_4, type_5]// Do not exceed 20 types
                                types: listOfRoots
                            };
                            //var payloadTree;

                            WAFData.authenticatedRequest(path, {
                                method: 'POST',
                                type: 'json',
                                timeout: 1000 * 60, // ms, 1min
                                data: UWA.Json.encode(postInput),
                                //headers: LifecycleServicesSettings.getHeaders(),
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Accept': 'application/json'
                                },
                                onFailure: function (e) {
                                    if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {
                                        //  if mode odt
                                        /*var payload = {
                                        "tree_of_childs": [{
                                        "root_type": "Compound Document",
                                        "root_typeNls": "Compound Document",
                                        "type": "Compound Document",
                                        "typeNls": "Compound Document",
                                        "icon": "",
                                        "showType": "yes",
                                        "children": ["Office Document"],
                                        "childrenNls": ["Office Document"]
                                        }
                                        ]
                                        };*/

                                        var payload = {
                                            "tree_of_childs": [{
                                                    "root_type": "Compound Document",
                                                    "root_typeNls": "Compound Document",
                                                    "type": "MS Word Document",
                                                    "typeNls": "MS Word Document",
                                                    "icon": "",
                                                    "showType": "yes",
                                                    "children": [
                                                    ],
                                                    "childrenNls": [
                                                    ]
                                                }, {
                                                    "root_type": "Compound Document",
                                                    "root_typeNls": "Compound Document",
                                                    "type": "MS Excel Document",
                                                    "typeNls": "MS Excel Document",
                                                    "icon": "",
                                                    "showType": "yes",
                                                    "children": [
                                                    ],
                                                    "childrenNls": [
                                                    ]
                                                }, {
                                                    "root_type": "Compound Document",
                                                    "root_typeNls": "Compound Document",
                                                    "type": "MS Powerpoint Document",
                                                    "typeNls": "MS PowerPoint Document",
                                                    "icon": "",
                                                    "showType": "yes",
                                                    "children": [
                                                    ],
                                                    "childrenNls": [
                                                    ]
                                                }, {
                                                    "root_type": "Compound Document",
                                                    "root_typeNls": "Compound Document",
                                                    "type": "MS Outlook Document",
                                                    "typeNls": "MS Outlook Document",
                                                    "icon": "",
                                                    "showType": "yes",
                                                    "children": [
                                                    ],
                                                    "childrenNls": [
                                                    ]
                                                }, {
                                                    "root_type": "Compound Document",
                                                    "root_typeNls": "Compound Document",
                                                    "type": "MS Outlook Attachment",
                                                    "typeNls": "MS Outlook Attachment",
                                                    "icon": "",
                                                    "showType": "yes",
                                                    "children": [
                                                    ],
                                                    "childrenNls": [
                                                    ]
                                                }, {
                                                    "root_type": "Compound Document",
                                                    "root_typeNls": "Compound Document",
                                                    "type": "MS Word Template",
                                                    "typeNls": "MS Word Template",
                                                    "icon": "",
                                                    "showType": "yes",
                                                    "children": [
                                                    ],
                                                    "childrenNls": [
                                                    ]
                                                }, {
                                                    "root_type": "Compound Document",
                                                    "root_typeNls": "Compound Document",
                                                    "type": "MS Excel Template",
                                                    "typeNls": "MS Excel Template",
                                                    "icon": "",
                                                    "showType": "yes",
                                                    "children": [
                                                    ],
                                                    "childrenNls": [
                                                    ]
                                                }, {
                                                    "root_type": "Compound Document",
                                                    "root_typeNls": "Compound Document",
                                                    "type": "MS Powerpoint Template",
                                                    "typeNls": "MS Powerpoint Template",
                                                    "icon": "",
                                                    "showType": "yes",
                                                    "children": [
                                                    ],
                                                    "childrenNls": [
                                                    ]
                                                }, {
                                                    "root_type": "Compound Document",
                                                    "root_typeNls": "Compound Document",
                                                    "type": "MS Outlook Template",
                                                    "typeNls": "MS Outlook Template",
                                                    "icon": "",
                                                    "showType": "yes",
                                                    "children": [
                                                    ],
                                                    "childrenNls": [
                                                    ]
                                                }, {
                                                    "root_type": "Compound Document",
                                                    "root_typeNls": "Compound Document",
                                                    "type": "Office Document",
                                                    "typeNls": "Office Document",
                                                    "icon": "",
                                                    "showType": "yes",
                                                    "children": [
                                                        "MS Word Document",
                                                        "MS Excel Document",
                                                        "MS Powerpoint Document",
                                                        "MS Outlook Document",
                                                        "MS Outlook Attachment",
                                                        "MS Word Template",
                                                        "MS Excel Template",
                                                        "MS Powerpoint Template",
                                                        "MS Outlook Template"
                                                    ],
                                                    "childrenNls": [
                                                        "MS Word Document",
                                                        "MS Excel Document",
                                                        "MS PowerPoint Document",
                                                        "MS Outlook Document",
                                                        "MS Outlook Attachment",
                                                        "MS Word Template",
                                                        "MS Excel Template",
                                                        "MS Powerpoint Template",
                                                        "MS Outlook Template"
                                                    ]
                                                }, {
                                                    "root_type": "Compound Document",
                                                    "root_typeNls": "Compound Document",
                                                    "type": "Compound Document",
                                                    "typeNls": "Compound Document",
                                                    "icon": "",
                                                    "showType": "yes",
                                                    "children": [
                                                        "Office Document"
                                                    ],
                                                    "childrenNls": [
                                                        "Office Document"
                                                    ]
                                                }
                                            ]
                                        };

                                        this.onComplete(payload);
                                    } else {
                                        //sinon
                                        console.log('gethierarchictypestree: onFailure:' + e);
                                    }
                                },
                                onComplete: function (payload) {

                                    //progressInterval = setInterval(function () {

                                    /*clearInterval(progressInterval);
                                    progressStatusNode.updateOptions({
                                    tooltip: "Loading complete !",
                                    grid: {
                                    data: curData
                                    }
                                    });*/

                                    //}, 500);

                                    payloadTree = payload;

                                    console.log('gettypeshierarchy: onComplete:' + payload);
                                    //Parse result to find if input type is in the hierarchy

                                    if (payload.hasOwnProperty("tree_of_childs") && payload.tree_of_childs.length > 0) {

                                        nbrChilds = payload.tree_of_childs.length;
                                        var currentNode = undefined;

                                        // YXX --- Get default sequences for all types in one request

                                        const urlFinal = URLHandler.getURL() + "/resources/v1/dslc/associaterevisionsequences" + "?tenant=" + URLHandler.getTenant();

                                        var sequences = "sequences";
                                        var operator = "operator";
                                        var type = "type";
                                        var get = "GET";

                                        var postInput = "{\"" + sequences + "\" : [ ";

                                        for (var f = 0; f < nbrChilds; f++) {

                                            listOfTypes.push(payload.tree_of_childs[f].type)
                                            listOfTypesNls.push(payload.tree_of_childs[f].typeNls)
                                            listOfShowTypes.push(payload.tree_of_childs[f].showType)

                                            if (f == (nbrChilds - 1)) {
                                                postInput = postInput.concat("{\"", operator, "\" : \"", get, "\", \"", type, "\" : \"", listOfTypes[f], "\"}");
                                            } else {

                                                postInput = postInput.concat("{\"", operator, "\" : \"", get, "\", \"", type, "\" : \"", listOfTypes[f], "\"},");
                                            }
                                        }

                                        postInput = postInput.concat(" ]}");

                                        postInputTypes = postInput;

                                        WAFData.authenticatedRequest(urlFinal, {
                                            timeout: 250000,
                                            method: 'POST',
                                            data: postInput,
                                            type: 'json',
                                            headers: {
                                                'Content-Type': 'application/json',
                                                'Accept': 'application/json',
                                                'SecurityContext': secCont.SecurityContext,
                                            },
                                            onFailure: function (e) {
                                                if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {
                                                    // mode ODT

                                                    /*var payload = {
                                                    "sequences": [{
                                                    "type": "Compound Document",
                                                    "operator": "GET",
                                                    "status": "SUCCEEDED"
                                                    }
                                                    ]
                                                    };*/

                                                    var payload = {
                                                        "sequences": [{
                                                                "type": "MS Word Document",
                                                                "operator": "GET",
                                                                "status": "SUCCEEDED"
                                                            }, {
                                                                "type": "MS Excel Document",
                                                                "operator": "GET",
                                                                "status": "SUCCEEDED"
                                                            }, {
                                                                "type": "MS Powerpoint Document",
                                                                "operator": "GET",
                                                                "status": "SUCCEEDED"
                                                            }, {
                                                                "type": "MS Outlook Document",
                                                                "operator": "GET",
                                                                "status": "SUCCEEDED"
                                                            }, {
                                                                "type": "MS Outlook Attachment",
                                                                "operator": "GET",
                                                                "status": "SUCCEEDED"
                                                            }, {
                                                                "type": "MS Word Template",
                                                                "operator": "GET",
                                                                "status": "SUCCEEDED"
                                                            }, {
                                                                "type": "MS Excel Template",
                                                                "operator": "GET",
                                                                "status": "SUCCEEDED"
                                                            }, {
                                                                "type": "MS Powerpoint Template",
                                                                "operator": "GET",
                                                                "status": "SUCCEEDED"
                                                            }, {
                                                                "type": "Office Document",
                                                                "operator": "GET",
                                                                "status": "SUCCEEDED"
                                                            }, {
                                                                "type": "Compound Document",
                                                                "operator": "GET",
                                                                "status": "SUCCEEDED"
                                                            }, {
                                                                "type": "MS Outlook Template",
                                                                "operator": "GET",
                                                                "status": "SUCCEEDED"
                                                            }
                                                        ]
                                                    };

                                                    this.onComplete(payload);
                                                } else {
                                                    // sinon
                                                    console.log('associaterevisionsequences: onFailure:' + e);
                                                }
                                            },
                                            onComplete: function (payload) {
                                                console.log('associaterevisionsequences: onComplete:');

                                                for (var g = 0; g < nbrChilds; g++) {

                                                    var currentNode = undefined;

                                                    if (payload.sequences[g].name != undefined) {
                                                        listOfSequences.push(payload.sequences[g].name);
                                                        listOfSequencesTitle.push(payload.sequences[g].sequence.title);
                                                    } else {
                                                        listOfSequences.push(VersionNamingNLS.SetSequence);
                                                        listOfSequencesTitle.push(VersionNamingNLS.SetSequence);
                                                    }

                                                    var currentRoot = payloadTree.tree_of_childs[g].root_type;

                                                    // YXX --- I am on a root
                                                    if (currentRoot == payloadTree.tree_of_childs[g].type) {
                                                        // to be replaced
                                                        //currentNode = createNode(payloadTree.tree_of_childs[g].root_typeNls, payloadTree.tree_of_childs[g].icon);
                                                        currentNode = createNode(payloadTree.tree_of_childs[g].typeNls, payloadTree.tree_of_childs[g].icon);
                                                        model.addChild(currentNode);

                                                        _attachChildren(payloadTree, g, currentNode);

                                                    }
                                                }

                                                if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {

                                                    // Simulate call to file selector
                                                    fileSelector.events.input.change();

                                                    //Simulate upload button
                                                    uploadButton.events.container.click();

                                                    // Simulate call to set sequence
                                                    var cellInfos = cellInfosODT
                                                        myDGV.columns[1].setCellValue(cellInfos, "Primary 1 chars minus IOXY");
                                                }

                                                clearInterval(progressInterval);
                                                progressStatusNode.updateOptions({
                                                    tooltip: "Loading complete !",
                                                    grid: {
                                                        data: 100
                                                    }
                                                });

                                            }
                                        });

                                        // ------------------------------------------
                                    }
                                },
                                onTimeout: function () {
                                    console.log('gettypeshierarchy: onTimeout: A connection timeout occured.');
                                }
                            });

                        }
                    });

                    //});

                    //  ---------------

                    var childrenTypes = new Array();
					var childrenTypesProp = new Array();

                    // YXX --- Recurse to get all children
                    var getChildren = function (myType, payload, index, list) {

                        for (var i = 0; i < payload.tree_of_childs[index].children.length; i++) {

                            list.push(payload.tree_of_childs[index].children[i]);

                            for (var g = 0; g < nbrChilds; g++) {

                                if (payload.tree_of_childs[index].children[i] == payload.tree_of_childs[g].type) {

                                    getChildren(payload.tree_of_childs[g].type, payload, g, list);

                                    break;
                                }
                            }
                        }
                        return;
                    }

                    // YXX --- Recurse to get all parents
                    /*var getParents = function (myType, payload, list) {

                    var found = 0;

                    for (var g = 0; g < nbrChilds; g++) {

                    for (var i = 0; i < payload.tree_of_childs[g].children.length; i++) {

                    if (payload.tree_of_childs[g].children[i] == myType) {

                    list.push(payload.tree_of_childs[g].type);

                    getParents(payload.tree_of_childs[g].type, payload, list);

                    found = 1;

                    break;
                    }
                    }
                    if (found == 1)
                    break;
                    }
                    return;
                    }*/

                    var getTypeChildren = function (myType, payload) {

                        var list = new Array();

                        for (var g = 0; g < nbrChilds; g++) {

                            var currentType = payload.tree_of_childs[g].type;

                            if (currentType == myType) {

                                list.push(currentType);
                                getChildren(currentType, payload, g, list);
                                //getParents(currentType, payload, list);

                                return list;

                                break;
                            }
                        }

                    }

                    //var myDGV = null;

                    // Set a filter on model
                    model.setFilterModel({
                        label: {
                            filterId: "string",
                            filterModel: {
                                condition1: {
                                    type: "startsWith",
                                    filter: ""
                                }
                            }
                        }
                    });

                    var columns = [{
                            text: VersionNamingNLS.Type,
                            dataIndex: "tree",
                            typeRepresentation: "string",
                            onCellRequest: (cellInfos) => {

                                if (cellInfos.nodeModel) {

                                    var typeValue = cellInfos.nodeModel.getAttributeValue("tree");

                                    //component.style.color="red";

                                    let found = listOfTypesNls.findIndex(function (element) {
                                        return element == typeValue.toString();
                                    });

                                    var component;
                                    component = myDGV.reuseCellContent("myReusableId");

                                    if (listOfShowTypes[found] == "no") {

                                        // transparent text color (defined in registerReusableCellContent)
                                        component.setHTML(typeValue.toString());

                                    } else {
                                        // black text color
                                        component.setHTML(typeValue.toString().fontcolor("black"));
                                    }

                                    cellInfos.cellView.setReusableContent(component);

                                }
                            }

                        }, {
                            // YXX --- Using string with possibleValues generates the autocomplete component
                            text: VersionNamingNLS.ExtRevSeq,
                            dataIndex: "ERS",
                            typeRepresentation: "string",
                            sortableFlag: false,
                            editionPolicy: "EditionOnClick",
                            allowFreeInputFlag: false,
                            getCellSemantics: function (cellInfos) {

                                if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {
                                    cellInfosODT = cellInfos;
                                }

                                if (cellInfos.cellModel != VersionNamingNLS.SetSequence)

                                    return {
                                        possibleValues: arrayDisplay_reset,
                                    };
                                else
                                    return {
                                        possibleValues: arrayDisplay_set,
                                    };

                            },
                            getCellValue: function (cellInfos) {

                                if (!cellInfos || !cellInfos.nodeModel)
                                    return;

                                let found = listOfTypesNls.findIndex(function (element) {
                                    return element == cellInfos.nodeModel._options.label;
                                });

                                //return listOfSequences[found];
                                return listOfSequencesTitle[found];

                            },
                            setCellValue: function (cellInfos, value) {

                                let found = listOfTypesNls.findIndex(function (element) {
                                    return element == cellInfos.nodeModel._options.label;
                                });

                                if (listOfSequencesTitle[found] != value) {

                                    var myContainer = document.getElementById("VersionNamingExtParamContainer");

                                    var loader = new WUXLoader();

                                    var parentContainer = myContainer.getParent();

                                    let index = -1;

                                    if (cellInfos.nodeModel != undefined) {
                                        index = listOfTypesNls.findIndex(function (element) {
                                            return element == cellInfos.nodeModel._options.label;
                                        });

                                    }

                                    const urlFinal = URLHandler.getURL() + "/resources/v1/dslc/associaterevisionsequences" + "?tenant=" + URLHandler.getTenant();

                                    var postInput = "";

                                    let selectedIndex = arrayDisplay_set.findIndex(function (element) {
                                        return element == value;
                                    });

                                    var succMsg = VersionNamingNLS.ERSAssociationSuccessAlert;

                                    var loaderSetReset;
                                    if (value == VersionNamingNLS.ResetSequence) {
                                        loaderSetReset = VersionNamingNLS.ResettingSeq;
                                    } else {
                                        loaderSetReset = VersionNamingNLS.SettingSeq;

                                    }

                                    // Here I build a post input with type to set/reset but with also types we propagate to (as defined in resource file)

                                    var sequences = "sequences";
                                    var operator = "operator";
                                    var type = "type";
                                    var name = "name";
                                    var Set = "SET";
                                    var Reset = "RESET";
									
									var nbOcc = 0;
                                    var currToTypes = new Array();
                                    for (var c = 0; c < fromTypes.length; c++) {
                                        if (listOfTypes[index] == fromTypes[c]) {
                                            nbOcc = nbOcc + 1;
                                            currToTypes.push(toTypes[c]);
                                        }
                                    }

                                    var postInput = "{\"" + sequences + "\" : [ ";

                                    if (nbOcc > 0) {
                                        if (value != VersionNamingNLS.ResetSequence) {
                                            postInput = postInput.concat("{\"", name, "\" : \"", arrayERS_set[selectedIndex], "\", \"", operator, "\" : \"", Set, "\", \"", type, "\" : \"", listOfTypes[index], "\"}, ");
                                            loader.on(VersionNamingNLS.SettingSeq);

                                        } else {
                                            postInput = postInput.concat("{\"", operator, "\" : \"", Reset, "\", \"", type, "\" : \"", listOfTypes[index], "\"}, ");
                                            loader.on(VersionNamingNLS.ResettingSeq);
                                        }
                                    } else {
                                        if (value != VersionNamingNLS.ResetSequence) {
                                            postInput = postInput.concat("{\"", name, "\" : \"", arrayERS_set[selectedIndex], "\", \"", operator, "\" : \"", Set, "\", \"", type, "\" : \"", listOfTypes[index], "\"}");
                                            loader.on(VersionNamingNLS.SettingSeq);
                                        } else {
                                            postInput = postInput.concat("{\"", operator, "\" : \"", Reset, "\", \"", type, "\" : \"", listOfTypes[index], "\"}");
                                            loader.on(VersionNamingNLS.ResettingSeq);
                                        }

                                    }

                                    

                                    var currOcc = 0;
                                    for (var f = 0; f < fromTypes.length; f++) {

                                        if (listOfTypes[index] == fromTypes[f]) {

                                            if (currOcc == (nbOcc - 1)) {
                                                if (value != VersionNamingNLS.ResetSequence) {
                                                    postInput = postInput.concat("{\"", name, "\" : \"", arrayERS_set[selectedIndex], "\", \"", operator, "\" : \"", Set, "\", \"", type, "\" : \"", toTypes[f], "\"}");
                                                } else {
                                                    postInput = postInput.concat("{\"", operator, "\" : \"", Reset, "\", \"", type, "\" : \"", toTypes[f], "\"}");
                                                }

                                            } else {
                                                if (value != VersionNamingNLS.ResetSequence) {
                                                    postInput = postInput.concat("{\"", name, "\" : \"", arrayERS_set[selectedIndex], "\", \"", operator, "\" : \"", Set, "\", \"", type, "\" : \"", toTypes[f], "\"}, ");
                                                } else {
                                                    postInput = postInput.concat("{\"", operator, "\" : \"", Reset, "\", \"", type, "\" : \"", toTypes[f], "\"}, ");
                                                }
                                            }
                                            currOcc = currOcc + 1;
                                        }

                                    }

                                    postInput = postInput.concat(" ]}");

                                    /*if (value != VersionNamingNLS.ResetSequence) {

                                    if (listOfTypes[index] != "VPMReference") {
                                    postInput = {
                                    "sequences": [{
                                    "name": arrayERS_set[selectedIndex],
                                    "operator": "SET",
                                    "type": listOfTypes[index]
                                    }
                                    ]
                                    };
                                    } else {

                                    postInput = {
                                    "sequences": [{
                                    "name": arrayERS_set[selectedIndex],
                                    "operator": "SET",
                                    "type": listOfTypes[index]
                                    }, {
                                    "name": arrayERS_set[selectedIndex],
                                    "operator": "SET",
                                    "type": "XCADModelRepReference"
                                    }
                                    ]
                                    };

                                    }

                                    loader.on(VersionNamingNLS.SettingSeq);

                                    } else {

                                    if (listOfTypes[index] != "VPMReference") {
                                    postInput = {
                                    "sequences": [{
                                    "operator": "RESET",
                                    "type": listOfTypes[index]
                                    }
                                    ]
                                    };
                                    } else {

                                    postInput = {
                                    "sequences": [{
                                    "operator": "RESET",
                                    "type": listOfTypes[index]
                                    }, {
                                    "operator": "RESET",
                                    "type": "XCADModelRepReference"
                                    }
                                    ]
                                    };

                                    }
                                    succMsg = VersionNamingNLS.ERSAssociationSuccessAlertR;

                                    loader.on(VersionNamingNLS.ResettingSeq);
                                    }*/

                                    loader.on(loaderSetReset);

                                    if (ODT_MODE == undefined || ODT_MODE != "ODT_MODE") {
                                        WUXModalContainer.createModal(parentContainer, loader.elements.container);
                                    }

                                    WAFData.authenticatedRequest(urlFinal, {
                                        timeout: 250000,
                                        method: 'POST',
                                        //data: UWA.Json.encode(postInput),
                                        data: postInput,
                                        type: 'json',
                                        headers: {
                                            'Content-Type': 'application/json',
                                            'Accept': 'application/json',
                                            'SecurityContext': secCont.SecurityContext,
                                        },
                                        onFailure: function (e) {
                                            if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {
                                                this.onComplete();
                                            } else {
                                                console.log('associaterevisionsequences: onFailure:' + e);
                                            }
                                        },
                                        onComplete: function () {
                                            console.log('associaterevisionsequences: onComplete:');

                                            const urlFinal = URLHandler.getURL() + "/resources/v1/dslc/associaterevisionsequences" + "?tenant=" + URLHandler.getTenant();

                                            // Get only children whose type could be impacted (children and parents)
                                            childrenTypes = getTypeChildren(listOfTypes[index], payloadTree);

                                            // Get list of index of those types

                                            var indexOfSequence = new Array();

                                            // Size of indexOfSequence must be the same size of childrenTypes
                                            for (var n = 0; n < childrenTypes.length; n++) {
                                                for (var m = 0; m < nbrChilds; m++) {

                                                    if (listOfTypes[m] == childrenTypes[n])
                                                        indexOfSequence.push(m);
                                                }
                                            }

                                            // ---------------------------------------------------------------------
                                            // Get also children of types to which propagation has been done (from resource Json file)


                                            for (var p = 0; p < nbOcc; p++) {
                                                // Get only children whose type could be impacted (children and parents)
                                                childrenTypesProp = getTypeChildren(currToTypes[p], payloadTree);

                                                // Size of indexOfSequence must be the same size of childrenTypesProp
                                                if (childrenTypesProp != undefined) { // if undefined it means the "to" type is not displayed in my tree, so I do not need to refresh
                                                    for (var n = 0; n < childrenTypesProp.length; n++) {
                                                        for (var m = 0; m < nbrChilds; m++) {

                                                            if (listOfTypes[m] == childrenTypesProp[n])
                                                                indexOfSequence.push(m);
                                                        }
                                                    }
                                                }

                                            }

                                            // ----------------------------------------------------------------------
											
											childrenTypes = childrenTypes.concat(childrenTypesProp);


                                            var sequences = "sequences";
                                            var operator = "operator";
                                            var type = "type";
                                            var get = "GET";

                                            var postInput = "{\"" + sequences + "\" : [ ";

                                            for (var f = 0; f < childrenTypes.length; f++) {

                                                if (f == (childrenTypes.length - 1)) {
                                                    postInput = postInput.concat("{\"", operator, "\" : \"", get, "\", \"", type, "\" : \"", childrenTypes[f], "\"}");
                                                } else {

                                                    postInput = postInput.concat("{\"", operator, "\" : \"", get, "\", \"", type, "\" : \"", childrenTypes[f], "\"},");
                                                }
                                            }

                                            postInput = postInput.concat(" ]}");

                                            postInputTypes = postInput;

                                            // ---------------------------------------------------------------------


                                            WAFData.authenticatedRequest(urlFinal, {
                                                timeout: 250000,
                                                method: 'POST',
                                                data: postInputTypes,
                                                type: 'json',
                                                headers: {
                                                    'Content-Type': 'application/json',
                                                    'Accept': 'application/json',
                                                    'SecurityContext': secCont.SecurityContext,
                                                },
                                                onFailure: function (e) {
                                                    if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {
                                                        var payload = {
                                                            "sequences": [{
                                                                    "type": "MS Word Document",
                                                                    "operator": "GET",
                                                                    "status": "SUCCEEDED"
                                                                }, {
                                                                    "type": "MS Excel Document",
                                                                    "operator": "GET",
                                                                    "status": "SUCCEEDED"
                                                                }, {
                                                                    "type": "MS Powerpoint Document",
                                                                    "operator": "GET",
                                                                    "status": "SUCCEEDED"
                                                                }, {
                                                                    "type": "MS Outlook Document",
                                                                    "operator": "GET",
                                                                    "status": "SUCCEEDED"
                                                                }, {
                                                                    "type": "MS Outlook Attachment",
                                                                    "operator": "GET",
                                                                    "status": "SUCCEEDED"
                                                                }, {
                                                                    "type": "MS Word Template",
                                                                    "operator": "GET",
                                                                    "status": "SUCCEEDED"
                                                                }, {
                                                                    "type": "MS Excel Template",
                                                                    "operator": "GET",
                                                                    "status": "SUCCEEDED"
                                                                }, {
                                                                    "type": "MS Powerpoint Template",
                                                                    "operator": "GET",
                                                                    "status": "SUCCEEDED"
                                                                }, {
                                                                    "type": "Office Document",
                                                                    "operator": "GET",
                                                                    "status": "SUCCEEDED"
                                                                }, {
                                                                    "type": "Compound Document",
                                                                    "operator": "GET",
                                                                    "status": "SUCCEEDED"
                                                                }, {
                                                                    "type": "MS Outlook Template",
                                                                    "operator": "GET",
                                                                    "status": "SUCCEEDED"
                                                                }
                                                            ]
                                                        };

                                                        this.onComplete(payload);

                                                    } else {

                                                        console.log('associaterevisionsequences: onFailure:' + e);
                                                    }
                                                },
                                                onComplete: function (payload) {
                                                    console.log('associaterevisionsequences: onComplete:');

                                                    for (var g = 0; g < childrenTypes.length; g++) {

                                                        if (payload.sequences[g].name != undefined) {
                                                            listOfSequences[indexOfSequence[g]] = payload.sequences[g].name;

                                                            let indTitle = arrayERS_set.findIndex(function (element) {
                                                                return element == payload.sequences[g].name;
                                                            });

                                                            listOfSequencesTitle[indexOfSequence[g]] = arrayERS_Title_set[indTitle];
                                                        } else {
                                                            listOfSequences[indexOfSequence[g]] = VersionNamingNLS.SetSequence
                                                                listOfSequencesTitle[indexOfSequence[g]] = VersionNamingNLS.SetSequence
                                                        }
                                                    }

                                                    model.loadModel(model, cellInfos.nodeModel);

                                                    loader.off();
                                                    WUXModalContainer.removeModal(parentContainer);
                                                    parentContainer.style.position = "";

                                                    AlertUtility.message('success', succMsg);

                                                    if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {
                                                        console.log('ODT for sequence terminated successfuly');
                                                    }

                                                }
                                            });

                                        }
                                    });

                                }
                            }
                        }
                    ];

                    myDGV = new WUXDataGridView({
                        identifier: "DataGridViewTest",
                        placeholder: VersionNamingNLS.PlaceHolder,
                        treeDocument: model,
                        height: 500,
                        columns: columns,
                        defaultColumnDef: {
                            minWidth: 50,
                            editableFlag: true
                        }
                    });

                    myDGV.registerReusableCellContent({
                        id: 'myReusableId',
                        buildContent: function () {
                            return new UWA.Element('div', {
                                styles: {
                                    color: 'rgba(255, 255, 255, 0)', // transparent text color
                                    width: 1000,
                                    height: 20
                                }
                            });
                        }
                    });

                    // Build the status bar with two status.
                    //var curData = 0;
                    myDGV.buildStatusBar([{
                                type: CollectionViewStatusBar.STATUS.NB_ITEMS
                            }, {
                                type: CollectionViewStatusBar.STATUS.CUSTOM,
                                position: "center",
                                id: "progressId",
                                dataElements: {
                                    typeRepresentation: "progress",
                                    value: 0,
                                    tooltip: "loading in progress"
                                }

                            }, {
                                type: CollectionViewStatusBar.STATUS.NB_SELECTED_CELLS,
                                position: "far"
                            }
                        ]);

                    //var progressStatusNode = myDGV.elements.statusBar.getNodeModelByID("progressId");
                    progressStatusNode = myDGV.elements.statusBar.getNodeModelByID("progressId");

                    // ----------------


                    /*var progressInterval = setInterval(function () {

                    if (listOfTypes.length == 0) {
                    curData = 50;
                    }
                    else {
                    curData += 50000/(listOfTypes.length);
                    }

                    if (curData < 100) {
                    progressStatusNode.updateOptions({
                    grid: {
                    data: curData
                    }
                    });
                    } else {
                    clearInterval(progressInterval);
                    progressStatusNode.updateOptions({
                    tooltip: "Loading complete !",
                    grid: {
                    data: curData
                    }
                    });
                    }
                    }, 500);*/

                    var d = UWA.createElement('div', {
                        html: VersionNamingNLS.VersionNamingExtTypeHeader
                    }).inject(contentDiv);
                    d.style.marginBottom = "10px";

                    var imgInfoSpan = UWA.createElement('span', {
                        'class': 'fonticon fonticon-info'
                    }).inject(d);
                    imgInfoSpan.setStyle("color", "black");
                    imgInfoSpan.setStyle("padding-left", "5px");

                    var popover = new Popover({
                        target: imgInfoSpan,
                        trigger: "hover",
                        animate: "true",
                        position: 'left',
                        body: VersionNamingNLS.VersionNamingExtTypeTooltip,
                        title: ''
                    });

                    //------------------
                    myDGV.inject(contentDiv);

                }

            }

        },

        // ---------------------------------------------------------------------------------------

        parseFileContent(content, onOk, onFailure) {
            var json = {};
            try {
                json = JSON.parse(content);
            } catch (e) {
                onFailure(VersionNamingNLS.FailedToParse, e);
                return;
            }

            if (!json) {
                onFailure(VersionNamingNLS.FailedToRead);
                return;
            }

            var error = "";
            if (!!error)
                onFailure(error);
            else {
                onOk(json);
            }
        },

        concatSequences(seqs) {
            var strres = "[";
            var firstone = true;
            seqs.forEach((seq) => {
                if (!firstone)
                    strres += ",";
                firstone = false;
                strres += JSON.stringify(seq);
            });
            strres += "]";
            return strres;
        },

        createHeader: function (parentElement) {
            var d = UWA.createElement('div', {
                html: VersionNamingNLS.VersionNamingExtHeader
            }).inject(parentElement);
            d.style.marginBottom = "10px";

            //UWA.createElement("b").setContent(VersionNamingNLS.VersionNamingExt).inject(d);

            var imgInfoSpan = UWA.createElement('span', {
                'class': 'fonticon fonticon-info'
            }).inject(d);
            imgInfoSpan.setStyle("color", "black");
            imgInfoSpan.setStyle("padding-left", "5px");

            var popover = new Popover({
                target: imgInfoSpan,
                trigger: "hover",
                animate: "true",
                position: 'left',
                body: VersionNamingNLS.VersionNamingExtTooltip,
                title: ''
            });
        },

        onCompleteRequestMapping: function () {
            Mask.unmask(this.contentDiv);
        },

        destroy: function () {
            this.stopListening();
            this._parent.apply(this, arguments);
        },

    });
    return extendedView;
});

define('DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/FLWebModalSlideIn',
		[
			'DS/UIKIT/Modal',
			'UWA/Core',
			'DS/UIKIT/Input/Select',
			'DS/UIKIT/Input/Text',
			'DS/UIKIT/Input/Number',
			'DS/UIKIT/Alert',
			'DS/UIKIT/Tooltip',
			'DS/WAFData/WAFData',
			'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
			'DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/ParameterizationFLWebConstants',
			'i18n!DS/ParameterizationSkeleton/assets/nls/FLWebNLS'
			],
			function (Modal,
					UWACore,
					Select,
					Text,
					Number,
					Alert,
					Tooltip,
					WAFData,
					URLHandler,
					ParameterizationFLWebConstants,
					FLWebNLS) {

	'use strict';

	function _createModal(options) {
		const editFieldContainer = UWA.createElement('div',{
			id:'add-edit-field-container',
			styles: {
				position: 'absolute',
				top: 0, left: 0, right: 0, bottom: 0
			}
		});
		const header =  UWA.createElement('div',{
			id:'add-edit-field-header',
			html: options.isadd? FLWebNLS.addField : FLWebNLS.updateField,
			styles: {
				padding: '1.3rem',
				'text-overflow': 'ellipsis',
				'white-space': 'nowrap',
				'color': 'hsl(216deg 2% 48%)',
				'font-size': '1.4em',
				'font-weight': 'bold',
				'display': 'absolute',
				top: 0, left:0, right: 0
			}
		});
		const body =  UWA.createElement('div',{
			id:'add-edit-field-body',
			styles: {
				overflow: 'auto',
				width: '100%'
			}
		});
		const footer =  UWA.createElement('div',{
			id:'add-edit-field-footer',
			styles: {
				padding: '1rem',
				'text-align': 'right',
				position: 'absolute',
				bottom: '5px',
				width: '100%'
			}
		});
		header.inject(editFieldContainer);
		body.inject(editFieldContainer);
		footer.inject(editFieldContainer);
		editFieldContainer.elements = {
			body: body,
			header: header,
			footer: footer
		}
		editFieldContainer.getContent =  function(){
			return this;
		}
		editFieldContainer.getFooter = function(){
			return this.elements.footer;
		}
		editFieldContainer.setFooter = function(btnHTML){
			this.elements.footer.innerHTML = btnHTML;
		}
		return editFieldContainer;
	}

	function FLWebModal(options) {
		this.options = {
				title: 'Dialog',
				className: '',
				withFooter: true
		};
		this.options = UWACore.extend(this.options, options);

		this.modal = _createModal(this.options);
		this.modal.inject(document.querySelector('.side-panel-editANField'));
		if (this.options.withFooter) {
			this._bindFooterEvent();
		}
	}

	FLWebModal.prototype.setFooter = function(btnElem){
		this.modal.setFooter(btnElem);
	},
	FLWebModal.prototype.getPartNumberFormat = function () {

		var _formatContent = this.modal.getContent().getElement('.enox-arch-number-content');
		var that = this;

		if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationFLWebConstants.FORMAT_FREE) {
			var _dynamicFormatContent = this.modal.getContent().getElement('.enox-arch-number-dynamic-content');
			_dynamicFormatContent.empty();
			that.destroyValueFieldComponents();
		} else if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationFLWebConstants.FORMAT_STRING) {
			that.destroyValueFieldComponents();
			that.getValueField(_formatContent);
		} else if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationFLWebConstants.FORMAT_ATTRIBUTE) {
			that.destroyValueFieldComponents();
			that.getDynamicFields(_formatContent, this.partNumberTypeCombobox.getValue()[0]);
		} else if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationFLWebConstants.FORMAT_COUNTER) {
			that.destroyValueFieldComponents();
			that.getDynamicFields(_formatContent, this.partNumberTypeCombobox.getValue()[0]);
		}
	};

	FLWebModal.prototype.getDefaultFields = function (_formatContent) {

		var that = this;

		var divTag = document.createElement('div');
		divTag.className = "formats-arch";

		var labelDiv = document.createElement('div');
		labelDiv.className = "formats-arch-label";
		labelDiv.innerText = FLWebNLS.name; //formats-arch[i];

		var textBoxDiv = document.createElement('div');
		textBoxDiv.className = "formats-arch-tbox";
		var textOptions = {
				events: {
					//  onChange: that.validateEnteredNameValue.bind(that)
				}
		};

		this.nameTextBox = this.getTextBox(textOptions);
		this.nameTextBox.domId = FLWebNLS.name + "_textBox";
		this.nameTextBox.inject(textBoxDiv);

		divTag.appendChild(labelDiv);
		divTag.appendChild(textBoxDiv);

		_formatContent.appendChild(divTag);

		var divTagForNbrBox = document.createElement('div');
		divTagForNbrBox.className = "formats-arch";

		var labelDivForNbrBox = document.createElement('div');
		labelDivForNbrBox.className = "formats-arch-label";
		labelDivForNbrBox.innerText = FLWebNLS.order; //formats-arch[i];

		var textBoxDivForNbrBox = document.createElement('div');
		textBoxDivForNbrBox.className = "formats-arch-tbox";

		var numberOptions = {
				min: 1,
				max: ParameterizationFLWebConstants.MAX_ROWS,

				value: this.getHighestOrder() + 1,
				events: {}
		};

		this.numberOrderBox = this.getNumberBox(numberOptions);
		this.numberOrderBox.domId = FLWebNLS.order + "_textBox";
		this.numberOrderBox.inject(textBoxDivForNbrBox);




		divTagForNbrBox.appendChild(labelDivForNbrBox);
		divTagForNbrBox.appendChild(textBoxDivForNbrBox);

		_formatContent.appendChild(divTagForNbrBox);

		var divTagForType = document.createElement('div');
		divTagForType.className = "formats-arch";

		var typelabelDiv = document.createElement('div');
		typelabelDiv.className = "formats-arch-label";
		typelabelDiv.innerText = FLWebNLS.type;

		var typeComboBoxDiv = document.createElement('div');
		typeComboBoxDiv.className = "formats-arch-tbox";

		var selectOptions = {
				custom: false,
				placeholder: FLWebNLS.selectType,
				options: [{
					label: FLWebNLS.String,
					value: ParameterizationFLWebConstants.FORMAT_STRING
				}, {
					label: FLWebNLS.Free,
					value: ParameterizationFLWebConstants.FORMAT_FREE
				}, {
					label: FLWebNLS.Attribute,
					value: ParameterizationFLWebConstants.FORMAT_ATTRIBUTE
				}, {
					label: FLWebNLS.counterLabel,
					value: ParameterizationFLWebConstants.FORMAT_COUNTER
				}

				],
				events: {
					onChange: that.getPartNumberFormat.bind(that)
				}
		};

		this.partNumberTypeCombobox = this.getSelectComponent(selectOptions);
		this.partNumberTypeCombobox.setId(FLWebNLS.type + "_comboBox");
		this.partNumberTypeCombobox.inject(typeComboBoxDiv);

		divTagForType.appendChild(typelabelDiv);
		divTagForType.appendChild(typeComboBoxDiv);
		_formatContent.appendChild(divTagForType);

	};

	FLWebModal.prototype.getDynamicFields = function (_formatContent, format) {
		var that = this;

		var _dynamicFormatContent = this.modal.getContent().getElement('.enox-arch-number-dynamic-content');
		_dynamicFormatContent.empty();

		if (format == ParameterizationFLWebConstants.FORMAT_ATTRIBUTE) {
			that.getAttributeFormat(_formatContent, _dynamicFormatContent);

		} else if (format == ParameterizationFLWebConstants.FORMAT_COUNTER) {
			this.getCounterFormat(_formatContent, _dynamicFormatContent);
		}

	};

	FLWebModal.prototype.getAttributeFormat = function (_formatContent, _dynamicFormatContent) {

		var formatField = FLWebNLS.attribute;

		var divTag = document.createElement('div');
		divTag.className = "formats-arch";

		var labelDiv = document.createElement('div');
		labelDiv.className = "formats-arch-label";
		labelDiv.innerText = formatField;

		var comboBoxDiv = document.createElement('div');
		comboBoxDiv.className = "formats-arch-tbox";
		var allAttributes = [];

		if (typeof this.attributes.message === "undefined") {
			for (var key in this.attributes) {
				var attributes1 = {};

				attributes1["label"] = this.attributes[key]
				attributes1["value"] = key

				allAttributes.push(attributes1);
			}
		}

		var selectOptions = {
				custom: false,
				placeholder: FLWebNLS.selectAttribute,
				options: allAttributes
		};

		this.partNumberAttributeCombobox = this.getSelectComponent(selectOptions);

		this.partNumberAttributeCombobox.setId(formatField + "_comboBox");
		this.partNumberAttributeCombobox.inject(comboBoxDiv);

		divTag.appendChild(labelDiv);
		divTag.appendChild(comboBoxDiv);

		var formatFieldValue = FLWebNLS.defaultValue;
		var divTagForValue = document.createElement('div');
		divTagForValue.className = "formats-arch";

		var labelDivForValue = document.createElement('div');
		labelDivForValue.className = "formats-arch-label";
		labelDivForValue.innerText = formatFieldValue;

		var textBoxDivForValue = document.createElement('div');
		textBoxDivForValue.className = "formats-arch-tbox";
		this.valueDynTextBox = this.getTextBox();
		this.valueDynTextBox.domId = formatFieldValue + "_textBox";
		this.valueDynTextBox.inject(textBoxDivForValue);

		divTagForValue.appendChild(labelDivForValue);
		divTagForValue.appendChild(textBoxDivForValue);

		_dynamicFormatContent.appendChild(divTag);
		_dynamicFormatContent.appendChild(divTagForValue);
		_formatContent.appendChild(_dynamicFormatContent);

	};

	FLWebModal.prototype.getCounterFormat = function (_formatContent, _dynamicFormatContent) {
		var that = this;
		var divTagForNbrBox = document.createElement('div');
		divTagForNbrBox.className = "formats-arch";

		var labelDivForNbrBox = document.createElement('div');
		labelDivForNbrBox.className = "formats-arch-label";

		var divForLabel = document.createElement('div');
		divForLabel.className = 'label-counter-arch';

		var labelText = document.createElement('div');
		labelText.className = 'label-text-arch';
		labelText.innerText = FLWebNLS.digits;

		var informationDiv = document.createElement('div');
		informationDiv.className = "fonticon fonticon-attention";
		informationDiv.id = "information";
		informationDiv.style.color = "black";

		divForLabel.appendChild(labelText);
		divForLabel.appendChild(informationDiv);

		labelDivForNbrBox.appendChild(divForLabel);

		var textBoxDivForNbrBox = document.createElement('div');
		textBoxDivForNbrBox.className = "formats-arch-tbox";

		var numberOptions = {
				min: 1,
				max: ParameterizationFLWebConstants.MAX_ROWS /*Number.MAX_SAFE_INTEGER*/,
				step: 1,
				value: 6,
				events: {
					onChange: that.updateSampleText.bind(that)
				}
		};

		this.counterNumberBox = this.getNumberBox(numberOptions);
		this.counterNumberBox.domId = FLWebNLS.digits + "_textBox";
		this.counterNumberBox.inject(textBoxDivForNbrBox);

		divTagForNbrBox.appendChild(labelDivForNbrBox);
		divTagForNbrBox.appendChild(textBoxDivForNbrBox);

		_dynamicFormatContent.appendChild(divTagForNbrBox);

		var formatField = FLWebNLS.sample;

		var divTag = document.createElement('div');
		divTag.className = "formats-arch-sample";

		var labelDiv = document.createElement('div');
		labelDiv.className = "formats-arch-sample-label";
		//labelDiv.innerText = formatField;


		var sampleTextLabelSpan = document.createElement('span');
		sampleTextLabelSpan.id = "sampleTextLabel";
		sampleTextLabelSpan.innerText = formatField  +" : "  ;

		var sampleTextValueSpan = document.createElement('span');
		sampleTextValueSpan.id = "sampleValue-arch";

		var textBoxDiv = document.createElement('div');
		textBoxDiv.className = "formats-arch-sample-value";

		textBoxDiv.appendChild(sampleTextLabelSpan);
		textBoxDiv.appendChild(sampleTextValueSpan);
		//textBoxDiv.id = "sampleValue-arch";

		divTag.appendChild(labelDiv);
		divTag.appendChild(textBoxDiv);

		_dynamicFormatContent.appendChild(divTag);
		_formatContent.appendChild(_dynamicFormatContent);

		this.updateSampleText(); // sets the number of digits value

		this.modal.getContent().getElement('#information').addEvent('mouseover', function () {
			that.getInformation(that.modal.getContent().getElement("#information"), FLWebNLS.counterTooltip);
		});

		// this.modal.getContent().getElement('#sampleValue-arch').addEvent('mouseover', function () {
		//   that.getInformation(that.modal.getContent().getElement("#sampleValue-arch"), event.currentTarget.getText());
		//
		// })


		// this.modal.getContent().getElement('#sampleValue-arch').addEventListener('mouseout', function () {
		// 	//that.getInformation(that.modal.getContent().getElement("#sampleValue-arch"), event.currentTarget.getText());
		// 	console.log(that);
		// 	that.tooltip.elements.body.empty()
		//
		// })


	};

	FLWebModal.prototype.getInformation = function (targetElement, toDisplayOver) {

		var tooltipOtions = {
				target: targetElement,
				body: toDisplayOver
		};
		this.getTooltip(tooltipOtions);

	};

	FLWebModal.prototype.getValueField = function (_formatContent) {

		var _dynamicFormatContent = this.modal.getContent().getElement('.enox-arch-number-dynamic-content');

		_dynamicFormatContent.empty();

		var formatField = FLWebNLS.value;

		var divTag = document.createElement('div');
		divTag.className = "formats-arch";

		var labelDiv = document.createElement('div');
		labelDiv.className = "formats-arch-label";
		labelDiv.innerText = formatField;

		var textBoxDiv = document.createElement('div');
		textBoxDiv.className = "formats-arch-tbox";
		this.valueTextBox = this.getTextBox();
		this.valueTextBox.domId = formatField + "_textBox";
		this.valueTextBox.inject(textBoxDiv);

		divTag.appendChild(labelDiv);
		divTag.appendChild(textBoxDiv);

		_dynamicFormatContent.appendChild(divTag);
		_formatContent.appendChild(_dynamicFormatContent);

	};

	FLWebModal.prototype.getModalBody = function () {

		var partNumberContent = this.modal.elements.body;

		var _errorsMessageDiv = UWACore.createElement('div');
		_errorsMessageDiv.className = "enox-part-number-error-content";

		var _formatContent = UWACore.createElement('div');
		_formatContent.className = "enox-arch-number-content";

		var _dynamicFormatContent = UWACore.createElement('div');
		_dynamicFormatContent.className = "enox-arch-number-dynamic-content";

		this.getDefaultFields(_formatContent);

		partNumberContent.appendChild(_errorsMessageDiv);
		partNumberContent.appendChild(_formatContent);
		partNumberContent.appendChild(_dynamicFormatContent);
		return partNumberContent;
	};

	FLWebModal.prototype.createCollabUnicitySecAddFieldModalBody = function () {

		var modalBody = this.modal.elements.body;

		var _errorsMessageDiv = UWACore.createElement('div');
		_errorsMessageDiv.className = "enox-part-number-error-content";

		var _formatContent = UWACore.createElement('div');
		_formatContent.className = "enox-arch-number-content";

		// var _dynamicFormatContent = UWACore.createElement('div');
		// _dynamicFormatContent.className = "enox-arch-number-dynamic-content";

		//this.getDefaultFields(_formatContent);
		this.addDefaultFieldsToCollabUnicitySecModalBody(_formatContent);
		modalBody.appendChild(_errorsMessageDiv);
		modalBody.appendChild(_formatContent);
		//	modalBody.appendChild(_dynamicFormatContent);
		//return partNumberContent;
	};

	FLWebModal.prototype.addDefaultFieldsToCollabUnicitySecModalBody = function (_formatContent) {

		var that = this;
		var groupNameField = document.createElement('div');
		groupNameField.className = "formats-arch";

		var labelDiv = document.createElement('div');
		labelDiv.className = "formats-arch-label";
		labelDiv.innerText = FLWebNLS.label_groupName;

		var textBoxDiv = document.createElement('div');
		textBoxDiv.className = "formats-arch-tbox";
		var textOptions = {
				events: {
					//  onChange: that.validateEnteredNameValue.bind(that)
				}
		};
		this.nameTextBoxForCollabUnicity = this.getTextBox(textOptions);
		this.nameTextBoxForCollabUnicity.domId = FLWebNLS.name + "_textBox";
		this.nameTextBoxForCollabUnicity.inject(textBoxDiv);

		groupNameField.appendChild(labelDiv);
		groupNameField.appendChild(textBoxDiv);
		_formatContent.appendChild(groupNameField);

		var collabSpaceField = document.createElement('div');
		collabSpaceField.className = 'formats-arch';

		var collabSpacelabel = document.createElement('div');
		collabSpacelabel.className = 'formats-arch-label';
		collabSpacelabel.innerText = FLWebNLS.label_CSfield;

		var collabSpaceTextBoxContainer = document.createElement('div');
		collabSpaceTextBoxContainer.className = 'formats-arch-tbox';
		var csList =  JSON.parse(localStorage.getItem('csList'));
		var collabSpaceSelectOptions = {
				//placeholder: 'Select your option',
				multiple: true,
				options: csList,
				events: {
					//  onChange: that.validateEnteredNameValue.bind(that)
				}
		};
		this.collabListTextBox = this.getSelectComponent(collabSpaceSelectOptions);
		this.collabListTextBox.domId = FLWebNLS.name + "_textBox";
		this.collabListTextBox.inject(collabSpaceTextBoxContainer);

		collabSpaceField.appendChild(collabSpacelabel);
		collabSpaceField.appendChild(collabSpaceTextBoxContainer);

		_formatContent.appendChild(collabSpaceField);

	};

	FLWebModal.prototype.validateEnteredNameValue = function (operation, editingField) {
		var duplicateData = {};
		duplicateData.isValid = true;
		var userEnteredFormat = this.nameTextBox.getValue();
		var isSuccess = this.validateEnteredValues(userEnteredFormat, FLWebNLS.name, operation, editingField);
		if (!isSuccess) {
			duplicateData.isValid = false;
		}
		duplicateData.data = userEnteredFormat;
		return duplicateData;
	};

	FLWebModal.prototype.validateEnteredGroupNameValue = function (operation, editingField) {
		var duplicateData = {};
		duplicateData.isValid = true;
		var userEnteredName = this.nameTextBoxForCollabUnicity.getValue();
		var isSuccess = this.validateEnteredValuesForArchNumCollab(userEnteredName, FLWebNLS.name, operation, editingField);
		if (!isSuccess) {
			duplicateData.isValid = false;
		}
		duplicateData.data = userEnteredName;
		return duplicateData;
	};

	FLWebModal.prototype.validateEnteredOrderValue = function (operation, editingField) {

		var duplicateData = {};
		duplicateData.isValid = true;

		var userEnteredFormat = this.numberOrderBox.getValue();
		var isSuccess = this.validateEnteredValues(userEnteredFormat, FLWebNLS.order, operation, editingField);

		if (!isSuccess) {

			duplicateData.isValid = false;
		}

		duplicateData.data = userEnteredFormat;
		return duplicateData;
	};

	FLWebModal.prototype.validateEnteredValues = function (userEnteredFormat, field, operation, editingField) {
		var rowsOfMappedFields = document.querySelectorAll(".partNumberFieldMapping");
		var successFields = document.querySelector('.success');


		var isSuccess = true;

		if (operation == "edit") {
			for (var k = 0; k < rowsOfMappedFields.length; k++) {
				if (rowsOfMappedFields[k] != editingField) {
					for (var j = 0; j < 2; j++) {
						if (successFields.getChildren()[j].getText() == field && userEnteredFormat == rowsOfMappedFields[k].getChildren()[j].getText()) {
							isSuccess = false;
							break;
						}
					}
				}
			}
		} else {
			for (var k1 = 0; k1 < rowsOfMappedFields.length; k1++) {

				for (var j1 = 0; j1 < 2; j1++) {
					if (successFields.getChildren()[j1].getText() == field && userEnteredFormat == rowsOfMappedFields[k1].getChildren()[j1].getText()) {
						isSuccess = false;
						break;
					}
				}
			}
		}
		return isSuccess;
	};

	FLWebModal.prototype.validateEnteredValuesForArchNumCollab = function (userEnteredFormat, field, operation, editingField) {
		var rowsOfMappedFields = document.querySelectorAll("#archNumCollabTableRow");
		var successFields = document.querySelector('#headerRowArchNumCollab');
		var isSuccess = true;
		if (operation == "edit") {
			for (var k = 0; k < rowsOfMappedFields.length; k++) {
				if (rowsOfMappedFields[k] != editingField) {
					for (var j = 0; j < 2; j++) {
						if (successFields.getChildren()[j].getText() == field && userEnteredFormat == rowsOfMappedFields[k].getChildren()[j].getText()) {
							isSuccess = false;
							break;
						}
					}
				}
			}
		} else {
			for (var k1 = 0; k1 < rowsOfMappedFields.length; k1++) {
				for (var j1 = 0; j1 < 2; j1++) {
					if (successFields.getChildren()[j1].getText() == field && userEnteredFormat == rowsOfMappedFields[k1].getChildren()[j1].getText()) {
						isSuccess = false;
						break;
					}
				}
			}
		}
		return isSuccess;
	};

	FLWebModal.prototype.validateEnteredGroupNameValueNotNull = function () {
		var userEnteredFormat = this.nameTextBoxForCollabUnicity.getValue();
		var isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
		return isNull;
	};

	FLWebModal.prototype.validateEnteredCollabListValueNotNull = function () {
		var userEnteredFormat = this.collabListTextBox.getValue()[0];
		var isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
		return isNull;
	};

	FLWebModal.prototype.validateEnteredNameValueNotNull = function () {
		var userEnteredFormat = this.nameTextBox.getValue();
		var isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
		return isNull;
	};

	FLWebModal.prototype.validateEnteredNameValueAllowed = function () {
		var userEnteredFormat = this.nameTextBox.getValue();
		var notAllowed = this.validateEnteredValuesIfAllowed(userEnteredFormat);
		return notAllowed;
	};

	FLWebModal.prototype.validateEnteredOrderValueNotNull = function () {
		var userEnteredFormat = this.numberOrderBox.getValue();
		var isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
		return isNull;
	};

	FLWebModal.prototype.validateEnteredValueFieldValueNotNull = function () {
		var isNull = false;
		if (this.getUserEnteredValues().Type != ParameterizationFLWebConstants.FORMAT_ATTRIBUTE) {
			isNull = this.valueTextBox ? this.validateEnteredValuesNotNull(this.valueTextBox.getValue()) : this.valueDynTextBox ? this.validateEnteredValuesNotNull(this.valueDynTextBox.getValue()) : false;
		}
		return isNull;
	};

	FLWebModal.prototype.validateEnteredValueFieldValueContainsSpecialChar = function () {
		var isValid = false;
		if (this.getUserEnteredValues().Type != ParameterizationFLWebConstants.FORMAT_ATTRIBUTE) {
			isValid = this.valueTextBox ? this.validateEnteredValuesIfValid(this.valueTextBox.getValue()) : false;
		}
		return isValid;
	};

	FLWebModal.prototype.validateEnteredDefaultValueFieldValueContainsSpecialChar = function () {
		var isValid = false;
		if (this.getUserEnteredValues().Type == ParameterizationFLWebConstants.FORMAT_ATTRIBUTE) {
			isValid = this.textBox ? this.validateEnteredValuesIfValid(this.textBox.getValue()) : false;
		}
		return isValid;
	};

	FLWebModal.prototype.validatSelectedTypeFieldValueNotNull = function () {
		var userEnteredFormat = this.partNumberTypeCombobox.getValue()[0];
		var isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
		return isNull;
	};

	FLWebModal.prototype.validateSelectedAttributeFieldValueNotNull = function () {
		var userEnteredFormat = this.partNumberAttributeCombobox ? this.partNumberAttributeCombobox.getValue()[0] : '';
		var isNull = false;
		if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationFLWebConstants.FORMAT_ATTRIBUTE) {
			isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
		}

		return isNull;
	};

	FLWebModal.prototype.validateEnteredCounterFieldValueNotNull = function () {
		var userEnteredFormat = this.counterNumberBox ? this.counterNumberBox.getValue() : '';
		var isNull = false;
		if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationFLWebConstants.FORMAT_COUNTER) {
			isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
		}

		return isNull;
	};

	FLWebModal.prototype.validateEnteredValuesNotNull = function (userEnteredFormat) {

		var isNull = false;
		if (userEnteredFormat == '' || userEnteredFormat == "") {
			isNull = true;
		}
		return isNull;
	};

	FLWebModal.prototype.validateEnteredValuesIfAllowed = function (userEnteredFormat) {

		var notAllowed = false;
		if (userEnteredFormat === "title" || userEnteredFormat === "revision" || userEnteredFormat === "existing") {
			notAllowed = true;
		}
		return notAllowed;
	};

	FLWebModal.prototype.validateEnteredValuesIfValid = function (userEnteredFormat) {

		const specialCharsPattern = /[<>&'\\]/;
		var containsSpecialChars = specialCharsPattern.test(userEnteredFormat);
		return containsSpecialChars;
	};

	FLWebModal.prototype.displayAlertMessage = function (messageToDisplay, toDisplayOver) {
		var alertOptions = {
				visible: true,
				className: 'param-alert',
				messageClassName: 'error',
				closable: true,
				renderTo: toDisplayOver,
				autoHide: true,
				hideDelay: 2000
		};
		var alert = this.getAlertComponent(alertOptions);

		alert.add({
			message: messageToDisplay
		});

	};

	FLWebModal.prototype.getUserEnteredValues = function () {

		var userEnteredFormatValues = {};

		var valueField = this.valueTextBox ? this.valueTextBox.getValue() : this.valueDynTextBox ? this.valueDynTextBox.getValue() : this.modal.getContent().getElement('#sampleValue-arch') ? this.modal.getContent().getElement('#sampleValue-arch').innerText : '';
		var attributeFieldLabel = this.partNumberAttributeCombobox ? this.partNumberAttributeCombobox.getOption(this.partNumberAttributeCombobox.getValue()[0]).getText() : '';
		var attributeFieldValue = this.partNumberAttributeCombobox ? this.partNumberAttributeCombobox.getValue()[0] : '';
		var numberOfDigits = this.counterNumberBox ? this.counterNumberBox.getValue() : '';

		userEnteredFormatValues[ParameterizationFLWebConstants.NAME] = this.nameTextBox.getValue();
		userEnteredFormatValues[ParameterizationFLWebConstants.ORDER] = this.numberOrderBox.getValue();
		userEnteredFormatValues[ParameterizationFLWebConstants.TYPE] = this.partNumberTypeCombobox.getValue()[0];
		userEnteredFormatValues[ParameterizationFLWebConstants.ATTRIBUTE] = attributeFieldValue;
		userEnteredFormatValues[ParameterizationFLWebConstants.ATTRIBUTE_NLS_NAME] = attributeFieldLabel;
		userEnteredFormatValues[ParameterizationFLWebConstants.COUNTER] = numberOfDigits;
		userEnteredFormatValues[ParameterizationFLWebConstants.VALUE] = valueField;

		return userEnteredFormatValues;
	};

	FLWebModal.prototype.getUserEnteredValuesForArchNumCollabUnicity = function () {
		var userEnteredFormatValues = {};
		var fieldValue = '';
		var csSelectList = this.collabListTextBox.getValue();
		if(Array.isArray(csSelectList)) {
			for(var i = 0; i < csSelectList.length-1; i++) {
				fieldValue += csSelectList[i] + ',';
			};
			fieldValue += csSelectList[i];
		} else {
			fieldValue = csSelectList;
		}
		userEnteredFormatValues[ParameterizationFLWebConstants.NAME] = this.nameTextBoxForCollabUnicity.getValue();
		userEnteredFormatValues[ParameterizationFLWebConstants.VALUE] = fieldValue;
		return userEnteredFormatValues;
	};

	FLWebModal.prototype.updateSampleText = function () {

		var sampleTextDiv = this.modal.getContent().getElement('#sampleValue-arch');
		var updatedCount = this.counterNumberBox ? this.counterNumberBox.getValue() : '';
		var noOFDigits = "";
		for (var i = 0; i < parseInt(updatedCount); i++) {
			noOFDigits = '0' + noOFDigits;
		}
		if (sampleTextDiv != null) {
			sampleTextDiv.innerText = noOFDigits;
		}

	};

	FLWebModal.prototype.getTotalFormatRows = function () {
		return document.querySelectorAll(".partNumberFieldMapping").length;
	};

	FLWebModal.prototype.getHighestOrder = function () {
		var rowsOfMappedFields = document.querySelectorAll(".partNumberFieldMapping");
		var toCheckTheExistingRows = rowsOfMappedFields.length;
		var highestOrder = 0;
		if (toCheckTheExistingRows > 0) {
			for (var k = 0; k < rowsOfMappedFields.length; k++) {
				if (parseInt(rowsOfMappedFields[k].getChildren()[1].getText()) > highestOrder) {
					highestOrder = parseInt(rowsOfMappedFields[k].getChildren()[1].getText());
				}
			}
		}

		return highestOrder;

	};

	FLWebModal.prototype.isCounterExists = function (field) {
		var rowsOfMappedFields = document.querySelectorAll(".partNumberFieldMapping");
		var toCheckTheExistingRows = rowsOfMappedFields.length;
		var isSuccess = false;
		if (toCheckTheExistingRows > 0) {
			for (var k = 0; k < rowsOfMappedFields.length; k++) {
				if (rowsOfMappedFields[k].getChildren()[2].value == ParameterizationFLWebConstants.FORMAT_COUNTER) {
					isSuccess = true;
					break;
				}
			}
		}

		return isSuccess;
	};

	FLWebModal.prototype.destroyValueFieldComponents = function () {

		this.valueTextBox = undefined;
		this.valueDynTextBox = undefined;
		this.counterNumberBox = undefined;

	};

	FLWebModal.prototype.getAttributes = function (data) {
		var that = this;
		that.storeAttributes(data);
	};

	FLWebModal.prototype.storeAttributes = function (data) {

		this.attributes = data;

	};

	FLWebModal.prototype.getTextBox = function (textBoxOptions) {

		this.textBox = new Text(textBoxOptions);
		return this.textBox;
	};

	FLWebModal.prototype.getNumberBox = function (numberOptions) {

		this.numberBox = new Number(numberOptions);
		return this.numberBox;
	};

	FLWebModal.prototype.getSelectComponent = function (selectOptions) {
		this.select = new Select(selectOptions);
		return this.select;
	};

	FLWebModal.prototype.getAlertComponent = function (alertOptions) {

		this.alert = new Alert(alertOptions);
		return this.alert;
	};

	FLWebModal.prototype.getTooltip = function (tooltipOtions) {
		this.tooltip = new Tooltip(tooltipOtions);
		return this.tooltip;
	};

	FLWebModal.prototype.show = function () {
		this.modal.show();
	};

	FLWebModal.prototype._bindFooterEvent = function () {
		var that = this;

		this.modal.getFooter().getElements('.btn').forEach(function (element) {
			if (element.name === 'cancelButton') {
				element.addEvent('click', function () {
				  that.modal.destroy();
					that.options.skeletonView.setCollapseFlagFromUIInteraction("right", true);
					//************BackUP below*****************
				//	that.options.skeletonView.setCollapseFlagFromUIInteraction("right", !that.options.skeletonView.rightContainerCollapsedFlag);
				});
			}
		});

	};

	FLWebModal.prototype.getContent = function () {
		return this.modal.getContent();
	};

	FLWebModal.prototype.destroy = function () {
		this.modal.destroy();
		var keys = Object.keys(this);
		for (var i = 0; i < keys.length; i++) {
			this[keys[i]] = undefined;
		}
	};

	return FLWebModal;
});

define('DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/CompanyIDViewUtilities',
		[
			'UWA/Core',
			'DS/UIKIT/Input/Select',
			'DS/UIKIT/Modal',
			'DS/UIKIT/Input/Text',
			'DS/UIKIT/Input/Number',
			'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
			'DS/WAFData/WAFData',
			'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
			'DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/ParameterizationFLWebConstants',
			'DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/FLWebModal',
			'DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/FLWebModalSlideIn',
			'i18n!DS/ParameterizationSkeleton/assets/nls/FLWebNLS',
			],
			function(UWA,
					Select,
					Modal,
					Text,
					Number,
					ParametersLayoutViewUtilities,
					WAFData,
					URLHandler,
					ParameterizationFLWebConstants,
					FLWebModal,
					FLWebModalSlideIn,
					FLWebNLS) {

	'use strict';

	var LEFT_ALIGNMENT = 'left';
	var RIGHT_ALIGNMENT = 'right';
	var HTML_BOLD_FORMAT = 'h5';
	var HTML_PARAG_FORMAT = null;
	var partNumberTable = UWA.createElement('table', {
		'class': 'partNumberTableMapping table table-condensed'
	});
	var archNumCollabSecTable = UWA.createElement('table', {
		'class': 'partNumberTableMapping table table-condensed',
		'id': 'archNumCollabUnicityTableContainer'
	});
	var widthTable = ParameterizationFLWebConstants.WIDTH_ARRAY;

	var physicalProductAttributesValues = {};

	var strategySelectorCombobox = [{
		label: FLWebNLS.UserDefined,
		value: "UserDefined"
	}/*,{
                        label: FLWebNLS.External,
                        value: "External"
             }*/];

	var strategyCombobox;

	var partNumberView = {

			initVariable: function() {
				this.cellsIndex = {
						"name": 0,
						"order": 1,
						"type": 2,
						"value": 3,
						"action": 4,
						"deployFlag": 5,
						"size": 6
				};
				this.cellsIndexForArchNumCollab = {
						"name": 0,
						"value": 1,
						"action": 2,
						"deployFlag": 3
				};
			},

			argsForUpdatingFormulaHeader: null,
			physicalProductAttributes: function(attributeMapping) {
				physicalProductAttributesValues = attributeMapping;
			},

			buildImgSpan: function(iconChoice, iconSize, iconColor, title) {
				var imgClass = 'fonticon fonticon-' + iconSize + 'x fonticon-' + iconChoice,
				imgSpan = UWA.createElement('span', {
					'class': imgClass,
					'title': title
				});

				imgSpan.setStyle("color", iconColor);
				return imgSpan;
			},

			buildTextTableCell: function(alignment, cellWidth, row, cellFormat, cellTest, colspan) {
				var colspanValue = (colspan) ? colspan : '1';
				var iCell = UWA.createElement('td', {
					'Align': alignment,
					'width': cellWidth,
					'colspan': colspanValue,
					'class': 'architectureNumberingField'// font-3dsbold
				}).inject(row);

				if (cellFormat) {
					UWA.createElement(cellFormat, {
						text: cellTest
					}).inject(iCell);
				} else {
					iCell.appendText(cellTest);
				}
				return iCell;
			},

			buildAttributeTable: function(data) {

				var pNFieldbody = UWA.createElement('tbody', {
					'class': 'partNumberFieldbody'
				}).inject(partNumberTable);


				var fieldInfo;
				/*fieldInfo = partNumberView.buildPNStrategyRow(data);
                fieldInfo.inject(pNFieldbody);*/

				fieldInfo = partNumberView.buildPNFormulaRow(data);
				fieldInfo.inject(pNFieldbody);

				fieldInfo = partNumberView.buildPNTableHeading();
				fieldInfo.inject(pNFieldbody);

				return partNumberTable;
			},

			buildArchNumCollabUnicitySecTable: function() {

				var tableBody = UWA.createElement('tbody', {
					'class': 'partNumberFieldbody',
					'id': 'archNumCollabUnicityTableBody'
				}).inject(archNumCollabSecTable);

				var fieldInfo;
				/*fieldInfo = partNumberView.buildPNStrategyRow(data);
                fieldInfo.inject(pNFieldbody);*/

				// fieldInfo = partNumberView.buildPNFormulaRow(data);
				// fieldInfo.inject(pNFieldbody);

				fieldInfo = partNumberView.buildArchNumCollabTableHeader();
				fieldInfo.inject(tableBody);

				return archNumCollabSecTable;
			},



			buildPNFormulaRow: function(data) {
				var fieldInfo, iCell;

				fieldInfo = UWA.createElement('tr', {
					'class': 'partNumberFormulaMapping',
					'id': 'partNumberFormulaMapping'
				});

				fieldInfo.value = [];


				partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.name], fieldInfo, HTML_PARAG_FORMAT, FLWebNLS.Formula);

				var imgClass = 'fonticon fonticon-' + '2.5' + 'x  fonticon-info';

				if (data[ParameterizationFLWebConstants.BUSINESS_LOGIC]) {

					iCell = UWA.createElement('td', {
						'Align': LEFT_ALIGNMENT,
						'width': widthTable[this.cellsIndex.order],
						'class': 'architectureNumberingField font-3dslight'// font-3dsbold
					}).inject(fieldInfo);

					UWA.createElement(HTML_PARAG_FORMAT, {
						'class': imgClass,
						'title': FLWebNLS.FormulaTooltip
					}).inject(iCell);

				} else {
					partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.name], fieldInfo, HTML_PARAG_FORMAT, "");
				}

				iCell = partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.type], fieldInfo, HTML_BOLD_FORMAT, "[" + FLWebNLS.freeValue + "]", "3");

				iCell = UWA.createElement('td', {
					'width': widthTable[this.cellsIndex.deployFlag],
					'align': RIGHT_ALIGNMENT,
					'title': FLWebNLS.deployStatus,
					'class': 'architectureNumberingField font-3dslight'// font-3dsbold
				});

				var imgSpan = partNumberView.buildImgSpan('check', '2.5', 'green', FLWebNLS.Deployed);
				imgSpan.inject(iCell);
				iCell.value = "success";
				iCell.inject(fieldInfo);

				return fieldInfo;
			},

			buildPNTableHeading: function() {
				var fieldInfo;

				fieldInfo = UWA.createElement('tr', {
					'class': 'success'
				});

				// partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.name], fieldInfo, HTML_BOLD_FORMAT, FLWebNLS.name);
				partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.name], fieldInfo, HTML_BOLD_FORMAT, FLWebNLS.name);
				partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.order], fieldInfo, HTML_BOLD_FORMAT, FLWebNLS.order);
				partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.type], fieldInfo, HTML_BOLD_FORMAT, FLWebNLS.type);
				partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.value], fieldInfo, HTML_BOLD_FORMAT, FLWebNLS.value);
				partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.action], fieldInfo, HTML_BOLD_FORMAT, FLWebNLS.actions);
				partNumberView.buildTextTableCell(RIGHT_ALIGNMENT, widthTable[this.cellsIndex.deployFlag], fieldInfo, HTML_BOLD_FORMAT, FLWebNLS.deployStatus);

				return fieldInfo;
			},

			buildArchNumCollabTableHeader: function() {
				var fieldInfo;
				fieldInfo = UWA.createElement('tr', {
					'class': 'success',
					id:'headerRowArchNumCollab'
				});

				// partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.name], fieldInfo, HTML_BOLD_FORMAT, FLWebNLS.name);
				partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.type], fieldInfo, HTML_BOLD_FORMAT, FLWebNLS.name);
				partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.type], fieldInfo, HTML_BOLD_FORMAT, FLWebNLS.value);
				partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.action], fieldInfo, HTML_BOLD_FORMAT, FLWebNLS.actions);
				partNumberView.buildTextTableCell(RIGHT_ALIGNMENT, widthTable[this.cellsIndex.deployFlag], fieldInfo, HTML_BOLD_FORMAT, FLWebNLS.deployStatus);

				return fieldInfo;
			},

			addEditButtonToCellRow: function(iCell, fieldInfo, forArchNumCollabTable) {
				var editElts = ParametersLayoutViewUtilities.createActionElements(forArchNumCollabTable?FLWebNLS.label_edit:FLWebNLS.editField, false);
				var editSpan = editElts[0], that = this;
				editSpan.setStyle("float", LEFT_ALIGNMENT);
				editSpan.setStyle("padding", "0px 8px");
				editSpan.inject(iCell);
				var editAttributeButton = editElts[1];
				var editPop = editElts[2];

				editAttributeButton.addEvent("onClick", function(event) {
					var fieldToEdit = event.currentTarget.getParent().getParent().getParent();
					if(forArchNumCollabTable){
						partNumberView.editFieldDialogForArchNumCollab(fieldToEdit);
					} else {
						partNumberView.editFieldDialog(fieldToEdit, physicalProductAttributesValues);
						if(that.skeletonView.rightContainerCollapsedFlag)
							that.skeletonView.setCollapseFlagFromUIInteraction("right", !that.skeletonView.rightContainerCollapsedFlag);
					}
				});

				return editAttributeButton;
			},

			addRemoveButtonToCellRow: function(iCell, fieldInfo, forArchNumCollabTable) {
				var removelts = ParametersLayoutViewUtilities.createActionElements(FLWebNLS.removeField, true);
				var deleteSpan = removelts[0];
				deleteSpan.setStyle("float", LEFT_ALIGNMENT);
				deleteSpan.setStyle("padding", "0px 8px");
				deleteSpan.inject(iCell);
				var removeAttributeButton = removelts[1];
				var removePop = removelts[2];

				removeAttributeButton.addEvent("onClick", function(e) {
					if(forArchNumCollabTable){
						partNumberView.removefieldArchNumGrouping(fieldInfo);
					} else {
						partNumberView.removefieldLineCallBack(fieldInfo);
					}
				});

				return removeAttributeButton;
			},


			buildValueCellInPNTable: function(valueCell, name, order, type, value, attributeName, isDeployed, size, firstBuild) {

				var cellText = value;
				if (ParameterizationFLWebConstants.FORMAT_ATTRIBUTE == type) {
					if (physicalProductAttributesValues && physicalProductAttributesValues[attributeName]) {
						cellText = physicalProductAttributesValues[attributeName];
					} else {
						cellText = attributeName;
					}

				}

				valueCell.setText((cellText)?cellText:"");
				valueCell.value = value;
				if(order){
					partNumberView.updateFormulaTextFields(order, type, cellText, isDeployed, size, firstBuild);
				}
			},

			buildPartNumberField: function(fieldInfo, name, order, type, value, attributeName, isDeployed, size) {
				//buildPartNumberField: function(fieldInfo, /*name,*/ order, type, value, attributeName, isDeployed) {
				var that = this;
				var iCell;
				fieldInfo.value = isDeployed;
				var firstBuild = true;
				// partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.name], fieldInfo, HTML_PARAG_FORMAT, name);
				partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.name], fieldInfo, HTML_PARAG_FORMAT, name);
				order? partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.order], fieldInfo, HTML_PARAG_FORMAT, order) : null;
				type? partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.type], fieldInfo, HTML_PARAG_FORMAT, FLWebNLS[type]).value = type : null;
				partNumberView.buildValueCellInPNTable(partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.value], fieldInfo, HTML_PARAG_FORMAT, value), name, order, type, value, attributeName, isDeployed, size, firstBuild);

				iCell = UWA.createElement('td', {
					'Align': LEFT_ALIGNMENT,
					'width': widthTable[4],
					'class': 'architectureNumberingField font-3dslight'// font-3dsbold
				}).inject(fieldInfo);

				var forArchNumCollabTable = order ? false : true;
				var editAttributeButton = partNumberView.addEditButtonToCellRow(iCell, fieldInfo, forArchNumCollabTable);
				var removeAttributeButton = partNumberView.addRemoveButtonToCellRow(iCell, fieldInfo, forArchNumCollabTable);


				iCell = UWA.createElement('td', {
					'Align': RIGHT_ALIGNMENT,
					'width': widthTable[5],
					'class': 'architectureNumberingField font-3dslight'// font-3dsbold
				}).inject(fieldInfo);

				if (isDeployed == ParameterizationFLWebConstants.DEPOLOYED) {
					var imgSpan = partNumberView.buildImgSpan('check', '2.5', 'green', FLWebNLS.Deployed);
					imgSpan.inject(iCell);
				} else if (isDeployed === ParameterizationFLWebConstants.NEW_NOT_DEPLOYED) {
					var imgSpan = partNumberView.buildImgSpan('cog', '2.5', 'orange', FLWebNLS.Modified);
					imgSpan.inject(iCell);
				}


				iCell.inject(fieldInfo);

				return fieldInfo;
			},


			buildsFieldJsonObject: function(fieldInfo) {
				var type = fieldInfo.cells[this.cellsIndex.type].getText();
				var value = fieldInfo.cells[this.cellsIndex.value].getText();

				var obj = {};

				obj[ParameterizationFLWebConstants.TYPE] = fieldInfo.cells[this.cellsIndex.type].value;
				obj[ParameterizationFLWebConstants.NAME] = fieldInfo.cells[this.cellsIndex.name].getText();

				obj['Label'] = fieldInfo.cells['label']? fieldInfo.cells['label']: '';

				obj[ParameterizationFLWebConstants.ORDER] = fieldInfo.cells[this.cellsIndex.order].getText();
				if(value) {
					obj[ParameterizationFLWebConstants.VALUE] = value;
				}

				if (FLWebNLS.SA == type) {
					var defaultAttr = fieldInfo.cells[this.cellsIndex.value].value? fieldInfo.cells[this.cellsIndex.value].value:'';
					if(defaultAttr !== null) {
						obj[ParameterizationFLWebConstants.VALUE] = defaultAttr;
						obj['Default'] = defaultAttr;
					}
				}

				if(fieldInfo.cells[this.cellsIndex.value][ParameterizationFLWebConstants.ATTRIBUTE]) {
					obj[ParameterizationFLWebConstants.ATTRIBUTE] = fieldInfo.cells[this.cellsIndex.value][ParameterizationFLWebConstants.ATTRIBUTE];
				}

				if(fieldInfo.cells[this.cellsIndex.value][ParameterizationFLWebConstants.COUNTER]) {
					obj[ParameterizationFLWebConstants.COUNTER] = fieldInfo.cells[this.cellsIndex.value][ParameterizationFLWebConstants.COUNTER];
				}
				obj[ParameterizationFLWebConstants.OPERATION] = fieldInfo.cells[this.cellsIndex.deployFlag].value;
				return obj;

			},

			buildsFieldJsonObjectForArchNUmCollab: function(fieldInfo) {
				//var type = fieldInfo.cells[this.cellsIndexForArchNumCollab.type].getText();
				var value = fieldInfo.cells[this.cellsIndexForArchNumCollab.value].getText();
				var obj = {};
				//obj[ParameterizationFLWebConstants.TYPE] = fieldInfo.cells[this.cellsIndex.type].value;
				obj.Name = fieldInfo.cells[this.cellsIndexForArchNumCollab.name].getText();
				//obj['Label'] = fieldInfo.cells['label']? fieldInfo.cells['label']: '';
				//obj[ParameterizationFLWebConstants.ORDER] = fieldInfo.cells[this.cellsIndex.order].getText();
				if(value) {
					obj.Value = value;
				}

				// if (FLWebNLS.SA == type) {
				//   var defaultAttr = fieldInfo.cells[this.cellsIndex.value].value? fieldInfo.cells[this.cellsIndex.value].value:'';
				//   if(defaultAttr !== null) {
				//     obj[ParameterizationFLWebConstants.VALUE] = defaultAttr;
				//     obj['Default'] = defaultAttr;
				//     }
				// }
				// if(fieldInfo.cells[this.cellsIndex.value][ParameterizationFLWebConstants.ATTRIBUTE]) {
				//   obj[ParameterizationFLWebConstants.ATTRIBUTE] = fieldInfo.cells[this.cellsIndex.value][ParameterizationFLWebConstants.ATTRIBUTE];
				// }
				// if(fieldInfo.cells[this.cellsIndex.value][ParameterizationFLWebConstants.COUNTER]) {
				//   obj[ParameterizationFLWebConstants.COUNTER] = fieldInfo.cells[this.cellsIndex.value][ParameterizationFLWebConstants.COUNTER];
				// }
				obj[ParameterizationFLWebConstants.OPERATION] = fieldInfo.cells[this.cellsIndexForArchNumCollab.deployFlag].value;
				return obj;
			},

			buildJsonObjForPNField: function(operation, name, order, type, value, attributeName, counterSize, label, defaultAttr) {
				var obj = {};

				obj[ParameterizationFLWebConstants.OPERATION] = operation;
				obj[ParameterizationFLWebConstants.NAME] = name;
				obj[ParameterizationFLWebConstants.TYPE] = type;
				obj[ParameterizationFLWebConstants.VALUE] = value ? value : defaultAttr;
				obj[ParameterizationFLWebConstants.ORDER] = order;
				obj[ParameterizationFLWebConstants.ATTRIBUTE] = attributeName;
				obj[ParameterizationFLWebConstants.COUNTER] = counterSize;
				obj['label'] = label;
				return obj;


			},

			buildNewPartNumberField: function(objParam, isDeployedStatus, skeletonView) {
				var fieldInfo;
				this.skeletonView = skeletonView;
				fieldInfo = UWA.createElement('tr', {
					'class': 'partNumberFieldMapping'
				});

				//partNumberView.buildPartNumberField(fieldInfo, /*objParam.Name,*/ objParam.Order, objParam.Type, objParam.Value, objParam[ParameterizationFLWebConstants.ATTRIBUTE], isDeployedStatus);
				partNumberView.buildPartNumberField(fieldInfo, objParam.Name, objParam.Order, objParam.Type, objParam.Value, objParam[ParameterizationFLWebConstants.ATTRIBUTE], isDeployedStatus, objParam.Size);
				fieldInfo.cells[this.cellsIndex.value][ParameterizationFLWebConstants.ATTRIBUTE] = objParam[ParameterizationFLWebConstants.ATTRIBUTE];
				fieldInfo.cells[this.cellsIndex.value][ParameterizationFLWebConstants.COUNTER] = objParam[ParameterizationFLWebConstants.COUNTER];
				fieldInfo.cells[this.cellsIndex.deployFlag].value = ParameterizationFLWebConstants.ADD;
				fieldInfo.cells['label'] = objParam.label;
				return fieldInfo;
			},

			buildNewArchNumCollabField: function(objParam, isDeployedStatus) {
				var fieldInfo;
				fieldInfo = UWA.createElement('tr', {
					'class': 'ArchNumUnicityGroupingTableRow',
					'id': 'archNumCollabTableRow'
				});
				// var fieldValue = '';
				// if(Array.isArray(objParam.Value)) {
				//   for(var i = 0; i < objParam.Value.length-1; i++) {
				//     fieldValue += objParam.Value[i] + ',';
				//   };
				//   fieldValue += objParam.Value[i];
				// } else {
				//   fieldValue = objParam.Value;
				// }
				partNumberView.buildPartNumberField(fieldInfo, objParam.Name, null, null, objParam.Value, null, isDeployedStatus, null);
				fieldInfo.cells[this.cellsIndexForArchNumCollab.deployFlag].value = ParameterizationFLWebConstants.ADD;
				fieldInfo.cells['label'] = objParam.label;
				return fieldInfo;
			},

			modifyPartNumberField: function(fieldInfo, objParam, isDeployedStatus) {
				fieldInfo.value = isDeployedStatus;
				var existOrder = fieldInfo.cells[this.cellsIndex.order].getText();
				if (objParam.Order != existOrder) {
					partNumberView.updateFormulaTextFields(existOrder, objParam.Type, null, ParameterizationFLWebConstants.NEW_NOT_DEPLOYED);
				}
				fieldInfo.cells[this.cellsIndex.name].setText(objParam.Name);
				fieldInfo.cells[this.cellsIndex.order].setText(objParam.Order);
				fieldInfo.cells[this.cellsIndex.type].setText(FLWebNLS[objParam.Type]);
				fieldInfo.cells[this.cellsIndex.type].value = objParam.Type;
				if(fieldInfo.cells[this.cellsIndex.size]) {
					fieldInfo.cells[this.cellsIndex.size].value = objParam.Size;
				}
				partNumberView.buildValueCellInPNTable(fieldInfo.cells[this.cellsIndex.value], objParam.Name, objParam.Order, objParam.Type, (objParam.Value) ? objParam.Value : "", objParam[ParameterizationFLWebConstants.ATTRIBUTE], isDeployedStatus);
				fieldInfo.cells[this.cellsIndex.value][ParameterizationFLWebConstants.ATTRIBUTE] = objParam[ParameterizationFLWebConstants.ATTRIBUTE];
				fieldInfo.cells[this.cellsIndex.value][ParameterizationFLWebConstants.COUNTER] = objParam[ParameterizationFLWebConstants.COUNTER];
				var deploycell = fieldInfo.cells[this.cellsIndex.deployFlag];
				deploycell.empty();
				var imgSpan = partNumberView.buildImgSpan('cog', '2.5', 'orange', FLWebNLS.Modified);
				imgSpan.inject(deploycell);
				deploycell.value = ParameterizationFLWebConstants.MODIFY;
				return fieldInfo;
			},

			modifyArchNumCollabField: function(fieldInfo, objParam, isDeployedStatus) {
				fieldInfo.value = isDeployedStatus;
				fieldInfo.cells[this.cellsIndexForArchNumCollab.name].setText(objParam.Name);
				partNumberView.buildValueCellInPNTable(fieldInfo.cells[this.cellsIndexForArchNumCollab.value], objParam.Name, objParam.Order, objParam.Type, (objParam.Value) ? objParam.Value : "", objParam[ParameterizationFLWebConstants.ATTRIBUTE], isDeployedStatus);
				var deploycell = fieldInfo.cells[this.cellsIndexForArchNumCollab.deployFlag];
				deploycell.empty();
				var imgSpan = partNumberView.buildImgSpan('cog', '2.5', 'orange', FLWebNLS.Modified);
				imgSpan.inject(deploycell);
				deploycell.value = ParameterizationFLWebConstants.MODIFY;
				return fieldInfo;
			},

			updateFormulaTextFields: function(index, type, value, isDeployed, size, firstBuild) {
				var field = document.querySelector(".partNumberFormulaMapping");
				if(field){
					var newVal = "";
					if (type) {
						if (type == ParameterizationFLWebConstants.FORMAT_ATTRIBUTE && value) {
							newVal = "{" + value + "}";
						} else if (type == ParameterizationFLWebConstants.FORMAT_COUNTER && (value||size)) {
							newVal = "&lt;" + FLWebNLS.counterValue + "&gt;";
						} else if (type == ParameterizationFLWebConstants.FORMAT_FREE && ((value != null) || firstBuild)) {
							newVal = "[" + FLWebNLS.freeValue + "]";
						} else if (value) {
							newVal = value;
						}
					}
					field.value[index] = newVal;
					field.cells[this.cellsIndex.type].empty();
					field.cells[this.cellsIndex.type].setStyle("font-size", "21px");
					var newFormula = field.value.join("");
					var counterInfoCell = field.cells[this.cellsIndex.type];
					if(newFormula != ""){
						if (newFormula.indexOf(FLWebNLS.counterValue) == -1) {
							counterInfoCell.empty();
							var imgClass = 'fonticon fonticon-' + '1' + 'x  fonticon-attention';
							UWA.createElement(HTML_PARAG_FORMAT, {
								'class': imgClass,
								'title': FLWebNLS.counterTooltipAttention
							}).inject(counterInfoCell);
						} else {
							counterInfoCell.empty();
						}
					}
					if(!newFormula){
						field.cells[this.cellsIndex.type].addContent("[" + FLWebNLS.freeValue + "]");
					}
					field.cells[this.cellsIndex.type].addContent(field.value.join(""));
					var iCell = field.cells[this.cellsIndex.value];
					if (isDeployed == ParameterizationFLWebConstants.DEPOLOYED) {
						iCell.empty();
						var imgSpan = partNumberView.buildImgSpan('check', '2.5', 'green', FLWebNLS.Deployed);
						imgSpan.inject(iCell);
					} else if (isDeployed === ParameterizationFLWebConstants.NEW_NOT_DEPLOYED) {
						iCell.empty();
						var imgSpan = partNumberView.buildImgSpan('cog', '2.5', 'orange', FLWebNLS.Modified);;
						imgSpan.inject(iCell);
					}
				} else {
					if(Array.isArray(this.argsForUpdatingFormulaHeader)){
						this.argsForUpdatingFormulaHeader.push(arguments);
					}
				}
			},

			removefieldLineCallBack: function(fieldInfo) {
				if (fieldInfo != "undefined") {
					partNumberView.updateFormulaTextFields(fieldInfo.cells[this.cellsIndex.order].getText(), fieldInfo.cells[this.cellsIndex.type].value, null, ParameterizationFLWebConstants.NEW_NOT_DEPLOYED);
					if (fieldInfo.value === ParameterizationFLWebConstants.NEW_NOT_DEPLOYED) {
						fieldInfo.remove();
					} else {
						partNumberView.setForRemoveFieldLine(fieldInfo);
					}
				}
			},

			removefieldArchNumGrouping: function(fieldInfo) {
				if (fieldInfo != "undefined") {
					if (fieldInfo.value === ParameterizationFLWebConstants.NEW_NOT_DEPLOYED) {
						fieldInfo.remove();
					} else {
						partNumberView.setForRemoveFieldArchNumGrouping(fieldInfo);
					}
				}
			},

			resetForAdd: function(fieldInfo) {
				partNumberView.updateFormulaTextFields(fieldInfo.cells[this.cellsIndex.order].getText(), fieldInfo.cells[this.cellsIndex.type].value, null, ParameterizationFLWebConstants.DEPOLOYED);
			},

			resetForRemove: function(fieldInfo) {
				var cellValue = fieldInfo.cells[partNumberView.cellsIndex.deployFlag].value;
				var imgSpan = partNumberView.buildImgSpan('check', '2.5', 'green', FLWebNLS.Deployed);
				var actionCell = fieldInfo.cells[partNumberView.cellsIndex.action];
				var deploycell = fieldInfo.cells[partNumberView.cellsIndex.deployFlag];
				partNumberView.addEditButtonToCellRow(actionCell, fieldInfo);
				partNumberView.addRemoveButtonToCellRow(actionCell, fieldInfo);
				deploycell.empty();
				imgSpan.inject(deploycell);
				partNumberView.updateFormulaTextFields(fieldInfo.cells[this.cellsIndex.order].getText(), fieldInfo.cells[this.cellsIndex.type].value, fieldInfo.cells[this.cellsIndex.value].getText(), ParameterizationFLWebConstants.DEPOLOYED);
			},

			resetForRemoveArchNumGrouping: function(fieldInfo) {
				var cellValue = fieldInfo.cells[partNumberView.cellsIndexForArchNumCollab.deployFlag].value;
				var imgSpan = partNumberView.buildImgSpan('check', '2.5', 'green', FLWebNLS.Deployed);
				var actionCell = fieldInfo.cells[partNumberView.cellsIndexForArchNumCollab.action];
				var deploycell = fieldInfo.cells[partNumberView.cellsIndexForArchNumCollab.deployFlag];
				partNumberView.addEditButtonToCellRow(actionCell, fieldInfo);
				partNumberView.addRemoveButtonToCellRow(actionCell, fieldInfo, true);
				deploycell.empty();
				imgSpan.inject(deploycell);
			},

			resetForModify: function(fieldInfo, savedInfo) {
				var imgSpan = partNumberView.buildImgSpan('check', '2.5', 'green', FLWebNLS.Deployed);
				var actionCell = fieldInfo.cells[partNumberView.cellsIndex.action];
				var deploycell = fieldInfo.cells[partNumberView.cellsIndex.deployFlag];
				if (savedInfo) {
					var existOrder = fieldInfo.cells[this.cellsIndex.order].getText();
					if (savedInfo[ParameterizationFLWebConstants.ORDER] != existOrder) {
						partNumberView.updateFormulaTextFields(existOrder, savedInfo[ParameterizationFLWebConstants.TYPE], null, ParameterizationFLWebConstants.NEW_NOT_DEPLOYED);
					}
					fieldInfo.cells[this.cellsIndex.name].setText(savedInfo[ParameterizationFLWebConstants.NAME]);
					fieldInfo.cells[this.cellsIndex.type].setText(FLWebNLS[savedInfo[ParameterizationFLWebConstants.TYPE]]);
					fieldInfo.cells[this.cellsIndex.type].value = savedInfo[ParameterizationFLWebConstants.TYPE];
					fieldInfo.cells[this.cellsIndex.order].setText(savedInfo[ParameterizationFLWebConstants.ORDER]);
					partNumberView.buildValueCellInPNTable(fieldInfo.cells[this.cellsIndex.value], savedInfo[ParameterizationFLWebConstants.NAME], savedInfo[ParameterizationFLWebConstants.ORDER], savedInfo[ParameterizationFLWebConstants.TYPE], savedInfo[ParameterizationFLWebConstants.VALUE], savedInfo[ParameterizationFLWebConstants.ATTRIBUTE], ParameterizationFLWebConstants.DEPOLOYED);
				}
				deploycell.empty();
				imgSpan.inject(deploycell);
			},

			resetForModifyArchNumGrouping: function(fieldInfo, savedInfo) {
				var imgSpan = partNumberView.buildImgSpan('check', '2.5', 'green', FLWebNLS.Deployed);
				var actionCell = fieldInfo.cells[partNumberView.cellsIndexForArchNumCollab.action];
				var deploycell = fieldInfo.cells[partNumberView.cellsIndexForArchNumCollab.deployFlag];
				if (savedInfo) {
					var existOrder = fieldInfo.cells[this.cellsIndex.order].getText();
					if (savedInfo[ParameterizationFLWebConstants.ORDER] != existOrder) {
						partNumberView.updateFormulaTextFields(existOrder, savedInfo[ParameterizationFLWebConstants.TYPE], null, ParameterizationFLWebConstants.NEW_NOT_DEPLOYED);
					}
					fieldInfo.cells[this.cellsIndex.name].setText(savedInfo[ParameterizationFLWebConstants.NAME]);
					fieldInfo.cells[this.cellsIndex.type].setText(FLWebNLS[savedInfo[ParameterizationFLWebConstants.TYPE]]);
					fieldInfo.cells[this.cellsIndex.type].value = savedInfo[ParameterizationFLWebConstants.TYPE];
					fieldInfo.cells[this.cellsIndex.order].setText(savedInfo[ParameterizationFLWebConstants.ORDER]);
					partNumberView.buildValueCellInPNTable(fieldInfo.cells[this.cellsIndex.value], savedInfo[ParameterizationFLWebConstants.NAME], savedInfo[ParameterizationFLWebConstants.ORDER], savedInfo[ParameterizationFLWebConstants.TYPE], savedInfo[ParameterizationFLWebConstants.VALUE], savedInfo[ParameterizationFLWebConstants.ATTRIBUTE], ParameterizationFLWebConstants.DEPOLOYED);
				}
				deploycell.empty();
				imgSpan.inject(deploycell);
			},

			resetForFieldLineChanges: function(fieldInfo, savedInfo) {
				if (fieldInfo.value == ParameterizationFLWebConstants.NEW_NOT_DEPLOYED) {
					var cellValue = fieldInfo.cells[partNumberView.cellsIndex.deployFlag].value;
					if (cellValue == ParameterizationFLWebConstants.ADD) {
						partNumberView.resetForAdd(fieldInfo);
						return fieldInfo;
					} else if (cellValue == ParameterizationFLWebConstants.REMOVE) {
						partNumberView.resetForRemove(fieldInfo);
					} else if (cellValue == ParameterizationFLWebConstants.MODIFY) {
						partNumberView.resetForModify(fieldInfo, savedInfo);
					}
					fieldInfo.value = ParameterizationFLWebConstants.DEPOLOYED;
					fieldInfo.cells[partNumberView.cellsIndex.deployFlag].value = ParameterizationFLWebConstants.ADD;
				}
			},

			resetForFieldLineChangesArchNumGrouping: function(fieldInfo, savedInfo) {
				if (fieldInfo.value == ParameterizationFLWebConstants.NEW_NOT_DEPLOYED) {
					var cellValue = fieldInfo.cells[partNumberView.cellsIndexForArchNumCollab.deployFlag].value;
					if (cellValue == ParameterizationFLWebConstants.ADD) {
						//partNumberView.resetForAdd(fieldInfo);
						return fieldInfo;
					} else if (cellValue == ParameterizationFLWebConstants.REMOVE) {
						partNumberView.resetForRemoveArchNumGrouping(fieldInfo);
					} else if (cellValue == ParameterizationFLWebConstants.MODIFY) {
						partNumberView.resetForModifyArchNumGrouping(fieldInfo, savedInfo);
					}
					fieldInfo.value = ParameterizationFLWebConstants.DEPOLOYED;
					fieldInfo.cells[partNumberView.cellsIndexForArchNumCollab.deployFlag].value = ParameterizationFLWebConstants.ADD;
				}
			},

			setForRemoveFieldLine: function(fieldInfo) {
				fieldInfo.value = ParameterizationFLWebConstants.NEW_NOT_DEPLOYED;
				var arrayAction = fieldInfo.cells[partNumberView.cellsIndex.action].getElements('span');
				arrayAction.forEach(function(action) {
					action.hide();
				});
				var deploycell = fieldInfo.cells[partNumberView.cellsIndex.deployFlag];
				var imgSpan = partNumberView.buildImgSpan('trash', '1.5', 'red', FLWebNLS.removedField);
				deploycell.empty();
				deploycell.value = ParameterizationFLWebConstants.REMOVE;
				imgSpan.inject(deploycell);
			},

			setForRemoveFieldArchNumGrouping: function(fieldInfo) {
				fieldInfo.value = ParameterizationFLWebConstants.NEW_NOT_DEPLOYED;
				var arrayAction = fieldInfo.cells[partNumberView.cellsIndexForArchNumCollab.action].getElements('span');
				arrayAction.forEach(function(action) {
					action.hide();
				});
				var deploycell = fieldInfo.cells[partNumberView.cellsIndexForArchNumCollab.deployFlag];
				var imgSpan = partNumberView.buildImgSpan('trash', '1.5', 'red', FLWebNLS.removedField);
				deploycell.empty();
				deploycell.value = ParameterizationFLWebConstants.REMOVE;
				imgSpan.inject(deploycell);
			},

			editFieldDialog: function(editField, result) {
				var that = this;
				var options = {
						className: "part-number-edit-modal",
						title: "Edit Field",
						skeletonView: that.skeletonView
				};
				this.modal = new FLWebModalSlideIn(options);
				this.modal.attributes = result;
				function _getFooter() {
					return "<button type='button'  name='addButton' id='add-button' class='btn btn-primary'>" + FLWebNLS.done + "</button> " + "</button>" + "<button type='button' name='cancelButton' id='cancel-button' class='btn btn-default'>" + FLWebNLS.cancel + "</button>"
				}
				this.modal.modal.setFooter(_getFooter());
				this.modal.getModalBody();
				this.modal._bindFooterEvent();
				var editingField = editField;
				var rowsOfMappedFields = document.querySelectorAll(".partNumberFieldMapping");
				var successFields = document.querySelector('.success');
				var toCheckTheExistingRows = rowsOfMappedFields.length;
				var fetchedData = this.buildsFieldJsonObject(editField);
				this.modal.nameTextBox.setValue(fetchedData.Name);
				this.modal.numberOrderBox.setValue(fetchedData.Order);
				this.modal.partNumberTypeCombobox.select(fetchedData.Type, true);
				this.modal.nameTextBox.disable();
				if (fetchedData.Type == ParameterizationFLWebConstants.FORMAT_STRING) {
					this.modal.valueTextBox.setValue(fetchedData.Value);
				} else if (fetchedData.Type == ParameterizationFLWebConstants.FORMAT_ATTRIBUTE) {
					this.modal.partNumberAttributeCombobox.select(editingField.cells[this.cellsIndex.value][ParameterizationFLWebConstants.ATTRIBUTE], true);
					this.modal.valueDynTextBox.setValue(fetchedData.Value);
				} else if (fetchedData.Type == ParameterizationFLWebConstants.FORMAT_COUNTER) {
					var numberOfDigits = fetchedData.Value && fetchedData.Value.length? fetchedData.Value.length: fetchedData.Size;
					this.modal.counterNumberBox.setValue(numberOfDigits);
				}
				this.tableWdthArray = ParameterizationFLWebConstants.WIDTH_ARRAY
				this.modal.partNumberTypeCombobox.disable();
				this.modal.getContent().getElements('.btn').forEach(function(element) {
					if (element.name === 'addButton') {
						element.addEvent('click', function() {
							var userEditedFormat = that.modal.getUserEnteredValues();
							var duplicateData = {};
							var checkStatus = {};
							checkStatus.isSuccess = true;
							var toDisplayOver = that.modal.getContent().getElement('.enox-arch-number-content');
							if (that.modal.validateEnteredNameValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.nameNullMessage, toDisplayOver);
							} else if (that.modal.validateEnteredNameValueAllowed()) {
								that.modal.displayAlertMessage(FLWebNLS.replace(FLWebNLS.nameInvalid, {key1: 'title', key2: 'revision', key3: 'existing'}), toDisplayOver);
							} else if (that.modal.validateEnteredOrderValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.orderNullMessage, toDisplayOver);
							} else if (that.modal.validatSelectedTypeFieldValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.selectTypeMessage, toDisplayOver);
							} else if (that.modal.validateSelectedAttributeFieldValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.selectAttributeMessage, toDisplayOver);
							} else if (that.modal.validateEnteredCounterFieldValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.counterIsEmptyMessage, toDisplayOver);
							} else if (that.modal.validateEnteredValueFieldValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.valueEmptyMessage, toDisplayOver);
							} else if (that.modal.validateEnteredValueFieldValueContainsSpecialChar()) {
								that.modal.displayAlertMessage(FLWebNLS.valueContainsSpecialCharMessage, toDisplayOver);
							} else if (that.modal.validateEnteredDefaultValueFieldValueContainsSpecialChar()) {
								that.modal.displayAlertMessage(FLWebNLS.valueContainsSpecialCharMessage, toDisplayOver);
							} else {
								if (!that.modal.validateEnteredNameValue("edit", editingField).isValid) {
									that.modal.displayAlertMessage(FLWebNLS.nameMessage + ' ' + FLWebNLS.alreadyExists, toDisplayOver);
								} else if (!that.modal.validateEnteredOrderValue("edit", editingField).isValid) {
									that.modal.displayAlertMessage(FLWebNLS.orderMessage + ' ' + FLWebNLS.alreadyExists, toDisplayOver);
								}  else {
									var userSelectedFormat = that.modal.getUserEnteredValues();
									userEditedFormat[ParameterizationFLWebConstants.OPERATION] = ParameterizationFLWebConstants.MODIFY;
									var fieldInfo = partNumberView.modifyPartNumberField(editingField, userEditedFormat, ParameterizationFLWebConstants.NEW_NOT_DEPLOYED);
									that.skeletonView.setCollapseFlagFromUIInteraction("right", true);
									that.modal.destroy();
								}
							}
						});
					}
				});
			//	this.modal.show();
			},

			editFieldDialogForArchNumCollab: function(editField) {
				var options = {
						className: "part-number-edit-modal",
						title: "Edit Field",
						id: "ArchNumCollabEditDialog"
				};
				var that = this;
				this.modal = new FLWebModal(options);
				function _getFooter() {
					return "<button type='button'  name='addButton' id='add-button' class='btn btn-primary'>" + FLWebNLS.add + "</button> " + "</button>" + "<button type='button' name='cancelButton' id='cancel-button' class='btn btn-default'>" + FLWebNLS.cancel + "</button>"
				}
				this.modal.modal.setFooter(_getFooter());
				this.modal.createCollabUnicitySecAddFieldModalBody();
				this.modal._bindFooterEvent();
				var editingField = editField;
				var rowsOfMappedFields = document.querySelectorAll("#archNumCollabTableRow");
				var toCheckTheExistingRows = rowsOfMappedFields.length;
				var fetchedData = this.buildsFieldJsonObjectForArchNUmCollab(editField);
				this.modal.nameTextBoxForCollabUnicity.setValue(fetchedData.Name);
				this.modal.collabListTextBox.setValue(fetchedData.Value.split(',')); //To be changed
				this.modal.nameTextBoxForCollabUnicity.disable();
				this.tableWdthArray = ParameterizationFLWebConstants.WIDTH_ARRAY
				this.modal.getContent().getElements('.btn').forEach(function(element) {
					if (element.name === 'addButton') {
						element.addEvent('click', function() {
							var userEditedFormat = that.modal.getUserEnteredValuesForArchNumCollabUnicity();
							var duplicateData = {};
							var checkStatus = {};
							checkStatus.isSuccess = true;
							var toDisplayOver = that.modal.getContent().getElement('.enox-arch-number-content');
							if (that.modal.validateEnteredGroupNameValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.nameNullMessage, toDisplayOver);
							} else if (that.modal.validateEnteredCollabListValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.msg_CSFieldBlankAlert, toDisplayOver);
							} else {
								if (!that.modal.validateEnteredGroupNameValue("edit", editingField).isValid) {
									that.modal.displayAlertMessage(FLWebNLS.nameMessage + ' ' + FLWebNLS.alreadyExists, toDisplayOver);
								} else {
									var userSelectedFormat = that.modal.getUserEnteredValuesForArchNumCollabUnicity();
									userEditedFormat[ParameterizationFLWebConstants.OPERATION] = ParameterizationFLWebConstants.MODIFY;
									var fieldInfo = partNumberView.modifyArchNumCollabField(editingField, userEditedFormat, ParameterizationFLWebConstants.NEW_NOT_DEPLOYED);
									that.modal.destroy();
								}
							}
						});
					}
				});
				this.modal.show();
			}
	};
	partNumberView.initVariable();
	return partNumberView;
});

/**
* @quickreview  KB9 21:11:08
*/

define('DS/ParameterizationSkeleton/Utils/DELConfigurationParameterization/DELConfigurationParameterizationResourceServices',
[
  'UWA/Core',
  'UWA/Class',
  'UWA/Json',
  'DS/Logger/Logger',
  'DS/CoreEvents/Events',
  'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
],
function (
  UWA,
  Class,
  Json,
  Logger,
  WUXEvents,
  URLHandler
) {

  'use strict';

  var DELConfigurationParameterizationResourceServices = Class.singleton({

	  name:            'DELConfigurationParameterizationResourceServices',
    _logger:         null,
    _attributesModal : null,
    _configurationProperties : null,

    /**
    * Init Resources
    *
    * @param {string} options.assetsModule - Assets module name
    */
    init: function init(options) {
      var that = this;

      that._parent(options);

      if (UWA.is(Logger)) {
    	  that._logger = Logger.getLogger(DELConfigurationParameterizationResourceServices);
      }

 	   return that;
    },

    /**
    * initAttributeModal.
    */
    initAttributeModal : function initAttributeModal(domainId, callback){
    var that = this;

 	   if (that._attributesModal == null || that._attributesModal.get(domainId) == null){
       if (that._attributesModal == null)
        that._attributesModal = new Map();

       that.initDELConfigurationProperties({
         onSuccess: function (configurationProperties) {

           var configFileTab = [];
           var configurationPropertiesLength = configurationProperties.length;
           for (var i=0;i<configurationPropertiesLength;i++)
           {
             var domainIdTMP = configurationProperties[i].domainid;
              if (domainIdTMP === domainId)
              {
                var argTab = configurationProperties[i].argid;
                var argTabLength = argTab.length;
                for (var j=0;j<argTabLength;j++)
                {
                  if (that._attributesModal.get(argTab[j]) === undefined)
                    configFileTab.push(argTab[j]);
                }
              }
           }

           if (configFileTab.length > 0)
           {
             var attrModal = new Map();
             var promiseTab = [];

             var configFileTabLength = configFileTab.length;
             for (var i=0;i<configFileTabLength;i++)
             {
               var configFile = configFileTab[i];

               var url = URLHandler.getURL();
               if (url === undefined)
                  url = '/ParameterizationSkeleton/assets/xml/' + configFile + '.xml';
               else
                  url = url + '/webapps/ParameterizationSkeleton/assets/xml/' + configFile + '.xml';

               var lPath = url;// + '/webapps/ParameterizationSkeleton/assets/xml/' + configFile + '.xml';
               var promise = new Promise(function (resolve, reject){
                 that.loadXML(lPath, configFile, {
                   onSuccess: function (configFileTMP, attributesModal) {
                     that._attributesModal.set(configFileTMP, attributesModal);
                     attrModal.set(configFileTMP, attributesModal);
                     resolve();
                   }
                 });
               });
               promiseTab.push(promise);
              }

              UWA.Promise.all(promiseTab).then(function() {
                if (callback != undefined)
                  callback.onSuccess(attrModal);//that._attributesModal);
              });
           }
           else {

             var configFileTab = [];
             var configurationProperties = that._configurationProperties;
             var configurationPropertiesLength = configurationProperties.length;
             for (var i=0;i<configurationPropertiesLength;i++)
             {
                var domainIdTMP = configurationProperties[i].domainid;
                 if (domainIdTMP === domainId)
                   configFileTab = configurationProperties[i].argid;
             }

             var attrModal = new Map();

             var configFileTabLength = configFileTab.length;
             for (var i=0;i<configFileTabLength;i++)
               attrModal.set(configFileTab[i], that._attributesModal.get(configFileTab[i]));

           if (callback != undefined)
               callback.onSuccess(attrModal);

             //if (callback != undefined)
            //     callback.onSuccess(that._attributesModal);
           }
         }
       });
 		 }
     else
     {
          var configFileTab = [];
          var configurationProperties = that._configurationProperties;
          var configurationPropertiesLength = configurationProperties.length;
          for (var i=0;i<configurationPropertiesLength;i++)
          {
             var domainIdTMP = configurationProperties[i].domainid;
              if (domainIdTMP === domainId)
                configFileTab = configurationProperties[i].argid;
          }

          var attrModal = new Map();

          var configFileTabLength = configFileTab.length;
          for (var i=0;i<configFileTabLength;i++)
            attrModal.set(configFileTab[i], that._attributesModal.get(configFileTab[i]));

        if (callback != undefined)
            callback.onSuccess(attrModal);
      }
   },

   /**
   * initDELConfigurationProperties.
   */
   initDELConfigurationProperties : function initDELConfigurationProperties(callback){
     var that = this;

     if (that._configurationProperties == null){
      var url = URLHandler.getURL();
      if (url === undefined)
        url = '/ParameterizationSkeleton/assets/xml/DELConfigurationProperties.json';
      else
        url = url + '/webapps/ParameterizationSkeleton/assets/xml/DELConfigurationProperties.json';

      var lPath = url;// + '/webapps/ParameterizationSkeleton/assets/xml/DELConfigurationProperties.json';
        that.loadJSON(lPath, {
          onSuccess: function (configurationProperties) {
            that._configurationProperties = configurationProperties;
             if (callback != undefined)
               callback.onSuccess(that._configurationProperties);
          }
        });
     }
    else
    {
       if (callback != undefined)
           callback.onSuccess(that._configurationProperties);
     }
  },

   /**
   * loadJSON.
   */
   loadJSON : function loadJSON(filePath, callback)
   {
      //code for IE7+, Firefox, Chrome, Opera, Safari
      //else code for IE6, IE5
      var  	that = this , attributesArray;
      attributesArray = [];
       var lXMLhttp = window.XMLHttpRequest ?   new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP");

      lXMLhttp["callback"] = callback;
      lXMLhttp.onload = function()     {
      if (this.callback != null && this.callback.onSuccess)
        this.callback.onSuccess (JSON.parse(lXMLhttp.responseText));
      }

      lXMLhttp.open("GET", filePath, true);
      lXMLhttp.setRequestHeader("Content-Type", "application/json");
      lXMLhttp.send();
   },

    /**
    * loadXML.
    */
    loadXML : function loadXML(filePath, configFile, callback)
    {
	      //code for IE7+, Firefox, Chrome, Opera, Safari
	      //else code for IE6, IE5
	      var  	that = this , attributesArray;
	      attributesArray = [];
        var lXMLhttp = window.XMLHttpRequest ?   new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP");

	      lXMLhttp["callback"] = callback;
	      lXMLhttp.onload = function()     {

    	  var xmlDoc = new DOMParser().parseFromString(lXMLhttp.responseText,'text/xml');
    	  if (this.callback != null && this.callback.onSuccess)
    		  this.callback.onSuccess (configFile, xmlDoc);
	      }

	      lXMLhttp.open("GET", filePath, true);
	      lXMLhttp.setRequestHeader("Content-Type", "text/xml");
	      lXMLhttp.send();
    },

    /**
    * _getAttributes.
    */
    _getAttributes : function _getAttributes(xmlDoc, parenttagName, childNode)
    {
      	var  output = [];
        var parentNode;
        var childNodes;
        if (childNode === undefined)
        {
          parentNode = xmlDoc.getElementsByTagName (parenttagName);
          childNodes = parentNode[0].childNodes;
        }
        else
         {
           parentNode = childNode;
           childNodes = parentNode.childNodes;
         }


  		if (parentNode === null || parentNode.length === 0)
  			return output;


  		for (var i=0; i < childNodes.length; i++)
      {
  			if (childNodes[i].nodeType != 1)
  				continue;

          if (childNodes[i].children.length === 0)
          {
            if (childNode)
              output.push ({'attribute': parenttagName + "_" + childNodes[i].tagName,	'value': childNodes[i].textContent});
            else
  			     output.push ({'attribute': childNodes[i].tagName,	'value': childNodes[i].textContent});
          }
          else
              output = output.concat(this._getAttributes(xmlDoc, childNodes[i].tagName, childNodes[i]));
  	  }
  		return output;
    }

  });

  return DELConfigurationParameterizationResourceServices;
});

/**
* @quickreview  KB9 21:10:25 creation
* @quickreview  ROW 22:10:13 FUN129061 - removed OnPremise specific checks
*/


define('DS/ParameterizationSkeleton/Collection/ParameterizationDELCollectionList', [
    'UWA/Core',
    'UWA/Class/Collection',
    'DS/ParameterizationSkeleton/Model/ParameterizationDomainsListModel',
    'WebappsUtils/WebappsUtils',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
    'DS/ParameterizationSkeleton/Utils/DELConfigurationParameterization/DELConfigurationParameterizationWebServices',
    'DS/ParameterizationSkeleton/Utils/DELConfigurationParameterization/DELConfigurationParameterizationResourceServices',
    //'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DELConfigurationProperties'
], function (
  UWA,
  Collection,
  ParameterizationDomainsModel,
  WebappsUtils,
  URLHandler,
  DELConfigurationParameterizationWebServices,
  DELConfigurationParameterizationResourceServices,
  Nls
  )
  {
    'use strict';

    return Collection.extend({
        model : ParameterizationDomainsModel,


        fetch : function (options) {
          UWA.log("ParameterizationDELCollectionList::setup");
          var that = this;

          // if (widget.getValue('x3dPlatformId') === 'OnPremise')
          // {
          var promiseTab = [];
          var promiseEnvVar = new Promise(function (resolve, reject){
          DELConfigurationParameterizationWebServices.getEnvVar({
            onSuccess : function(mapvarEnv)
            {
              that._mapvarEnv = mapvarEnv;
                resolve();
            },
            onFailure : function(error)
            {
                reject("DELConfigurationParameterizationWebServices.getEnvVar");
              console.error("DELConfigurationParameterizationWebServices.getEnvVar");
            }
          });
          });

          promiseTab.push(promiseEnvVar);

          /*var promiseConfiguration = new Promise(function (resolve, reject){
            DELConfigurationParameterizationResourceServices.initDELConfigurationProperties({
              onSuccess : function(configData)
              {
                resolve(configData);
        },
              onFailure : function(error)
              {
                reject("DELConfigurationParameterizationResourceServices.initDELConfigurationProperties");
                console.error("DELConfigurationParameterizationResourceServices.initDELConfigurationProperties");
              }
            });
          });

          promiseTab.push(promiseConfiguration);*/

          UWA.Promise.all(promiseTab).then(function(data) {
            Collection.prototype.fetch.call(that);
          });
        // }
        // else {
        //   Collection.prototype.fetch.call(that);
        // }
        },

        setup: function () {
          UWA.log("ParameterizationDELCollectionList::setup");
          var that = this;
          this.url = WebappsUtils.getWebappsAssetUrl('ParameterizationSkeleton', 'xml/DELConfigurationProperties.json');
        },

        /*sync : function(method, model, options) {
            UWA.log("ParameterizationDELCollectionList::sync");
            var that = this;

            //options.contentType = 'application/json';
            options.proxy = 'passport';
            options.headers = {
                'Accept-Language' : widget.lang
            };

            //'Accept-Language' : widget.lang
            //options.acceptLanguage = widget.lang;
            this._parent.apply(this, [method, model, options]);
        },*/

        parse: function (data) {
            UWA.log("ParameterizationDELCollectionList::parse");
            var that = this;
            var paramEntries = [];

            // if (widget.getValue('x3dPlatformId') === 'OnPremise')
            // {
              if (Array.isArray(data)) {
             var appData = data;
              appData.forEach(function (iElement) {

                  if (iElement.envVar === undefined || iElement.envVar === null ||
                  (that._mapvarEnv != undefined && that._mapvarEnv["DELMIAParameterizationEnvVariable"] === iElement.envVar))
                      {
                    var titleText = Nls[iElement.domainid + "Text"];
                    var titleTooltip = Nls[iElement.domainid + "Tooltip"];

                        paramEntries.push({
                            title          : titleText,
                            subtitle       : titleTooltip,
                            introduction   : titleTooltip,
                            image          : URLHandler.getURL() + "/webapps/ParameterizationSkeleton/assets/img/" + iElement.image,
                            domainid       : iElement.domainid,
                        //familyid       : iElement.familyid,
                        id             : iElement.domainid
                        });
                      }
                  });
              }
            // }
            // else {
            //   if (Array.isArray(data)) {
            //      var appData = data;
            //       appData.forEach(function (iElement) {
            //
            //         if (iElement.domainid != "DigitalManufacturing" && (iElement.envVar === undefined || iElement.envVar === null))
            //         {
            //             var titleText = Nls[iElement.domainid + "Text"];
            //             var titleTooltip = Nls[iElement.domainid + "Tooltip"];
            //
            //                 paramEntries.push({
            //                     title          : titleText,
            //                     subtitle       : titleTooltip,
            //                     introduction   : titleTooltip,
            //                     image          : URLHandler.getURL() + "/webapps/ParameterizationSkeleton/assets/img/" + iElement.image,
            //                     domainid       : iElement.domainid,
            //                     //familyid       : iElement.familyid,
            //                     id             : iElement.domainid
            //                 });
            //               }
            //           });
            //       }
            // }

            return paramEntries;
        }
      });
});

//@fullReview  ZUR 16/04/05 2017x, enhancing code organization for Jasmine/KarmaReplay Tests
/*global define, document, clearTimeout, setTimeout*/
/*jslint plusplus: true*/

define('DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/LifecycleEgraphUtilities',
    [
        'UWA/Core',
        'egraph/core',
        'egraph/views',
        'DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/ParamStepGeometry',
        'DS/UIKIT/Input/Button',
        'DS/UIKIT/Input/Text',
        'DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/LifecycleViewUtilities',
		'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS'
    ],
    function(UWA, core, views,
            StepGx,
            Button, Text,
            LifecycleViewUtilities, ParamSkeletonNLS) {

        'use strict';
        //'UWA/Controls/Abstract',
        var lcview = {

            addeGraphDivs: function() {
                var content, canvas, placeholder,
                    divArrays = new Array(2);
                //
                content = UWA.createElement("div", {
                    'id': 'main_Content_Div'
                });
                canvas = UWA.createElement("div", {
                    'id': 'graph_canvas'
                });
                canvas.addClassName("canvas");
                canvas.setStyle("height", "100%");
                canvas.setStyle("width", "100%");
                //
                placeholder = UWA.createElement("div");
                placeholder.addClassName("graphPlaceholder");
                //
                content.addContent(placeholder);
                content.addContent(canvas);
                divArrays[0] = content;
                divArrays[1] = canvas;

                return divArrays;
            },
             /**
             * Procedure addEdgeArrowDesign
             * This method creates the design of the arrow and injects it (hidden) into the body
             * @author TEE1
             */
            addEdgeArrowDesign : function (widget) {
                //The elements are all created with an NLS so they can't
                //be created with a UWA function but they need to inherit
                var svg = UWA.extendElement(document.createElementNS('http://www.w3.org/2000/svg', 'svg')),
                    defs = UWA.extendElement(document.createElementNS('http://www.w3.org/2000/svg', 'defs')),
                    marker = UWA.extendElement(document.createElementNS('http://www.w3.org/2000/svg', 'marker')),
                    path = UWA.extendElement(document.createElementNS('http://www.w3.org/2000/svg', 'path'));
                svg.set({
                    "width" : 0,
                    "height" : 0
                });
                svg.set("style", "position", "absolute");
                marker.set({
                    "id": "arrow-edge-end-marker",
                    "markerWidth": "10",
                    "markerHeight": "8",
                    "refX": "8",
                    "refY" : "4",
                    "orient": "auto"
                });
                path.set({
                    "d": "M 0 0 L 10 4 L 0 8",
                    "fill": "#777",
                    "stroke": "none"
                });
                path.inject(marker);
                marker.inject(defs);
                defs.inject(svg);
                svg.inject(widget.body);
            },
            /**
             * Connector factory
             * @param {number} side the attachement side
             * @param {number} row the row index of the connector
             * @return {module:egraph/core.Connector} new connector instance
             */
            createConnector: function (side, row) {
                var connector, offset;

                offset = row;//20 + 30 * row;
                connector = new core.Connector();
                // instantiate default connector view
                connector.views.main = new views.SVGConnView();
                // use multiset to force the dispatch of properties change
                // notifications to group all modifications of connectors
                // properties (again, not really useful in that specific case)
                connector.multiset(['cstr', 'attach'], side,
                                   ['cstr', 'offset'], offset);

                //console.log(connector);
                return connector;
            },

            /**
            * Add an edge between two connectors.
            * @param {module:egraph/core.Connector} c1
            * @param {module:egraph/core.Connector} c2
            * @returns {module:egraph/core.Edge} the new edge
            */
            builTransitiondEdge : function (stub) {
                var edge = new core.Edge(),
                    currstepGeometry = new StepGx.ParamStepGeometry(stub);
                //increment minTangentLength in order to avoir overlapping
                //autoBezierGeometry.minTangentLength = autoBezierGeometry.minTangentLength+20;             
                //stepGeometry.stubScenario = stub;    
                UWA.log("Setting stepGeometry.stubScenario = " + currstepGeometry.stubScenario);
                edge.set('geometry', currstepGeometry); //edge.set('geometry', autoBezierGeometry);            
                edge.views.main = new views.SVGEdgeView('arrow-edge'); //edge.views.main = new views.SVGEdgeView();
                return edge;
            },

            buildpropsNode: function (elt, fctChange) {

                var selectedObjpropsDiv, insertDiv, timerconn, closeButton,
                    iXCoordinate, iYCoordinate, pathArray, nbofPoints,
                    newRow, newCell, newCell2, titleTable, currentCheck,
                    elementName, iV,
                    worldCoord = [];
                    //headerTable, tbody, testX, removeStateButton

                lcview.removePropsNode();

                if (elt) {
                    if (elt.type === core.Type.EDGE) {
                        //elementType = "Transition";
                        elementName = elt.signatureNLS;
                    }
                }

                pathArray = elt.path;
                nbofPoints = pathArray.length / 3;
                iYCoordinate = pathArray[5] - LifecycleViewUtilities.sign(pathArray[5]) * 40;//50
                iXCoordinate = (pathArray[1] + pathArray[(nbofPoints - 1) * 3 + 1]) / 2;

                if (nbofPoints === 2) {
                    iYCoordinate = pathArray[5] - LifecycleViewUtilities.sign(pathArray[5]) * 15;//20
                }

                worldCoord.push(iXCoordinate);
                worldCoord.push(iYCoordinate);
                iV = LifecycleViewUtilities.transformCoordinates(worldCoord, elt.gr.views.main.vpt);

                //testX = (elt.cl1.c.aleft + elt.cl2.c.aleft) / 2;

                selectedObjpropsDiv =  UWA.createElement('div', {'id': 'propsTransitionDiv'});
                selectedObjpropsDiv.setStyle("visibility", "visible");//hidden
                selectedObjpropsDiv.setStyle("left", iV[0]);// iXCoordinate "40em" elt.cl1.c.aleft
                selectedObjpropsDiv.setStyle("top", iV[1]);//iYCoordinate 2em     elt.cl1.c.atop

                titleTable =  UWA.createElement('table', {
                    'width': '100%'
                }).inject(selectedObjpropsDiv);

                newRow = UWA.createElement('tr', {title: ''}).inject(titleTable);
                newCell2 = UWA.createElement('td',
                        {'width': '90%', 'title': ''}).inject(newRow);

                /*UWA.createElement('h4', {
                    text: 'properties',// font-3dsbold ParamWdgNLS
                    'class': 'font-3dslight'
                }).inject(newCell);*/

                newCell = UWA.createElement('td',
                        {'width': '10%', 'title': ''}).inject(newRow);

                //fonticon-2x

                closeButton = new Button({
                    className: 'close',
                    id : 'togglepropsBox',//  html: '&times;',
                    icon : ' cancel',//value: 'Button',

                    attributes: {
                        disabled: false,
                        'aria-hidden' : 'true',
                        title : ParamSkeletonNLS.Close //NZV:IR-629593-3DEXPERIENCER2019x
                    //  text : ParamWdgNLS.Apply
                    }
                }).inject(newCell);

                /*headerTable =  UWA.createElement('table', {
                    'id': 'propBoxheader',
                    'class': 'table table-condensed table-hover',
                    'width': '100%'
                }).inject(selectedObjpropsDiv);

                tbody = UWA.createElement('tbody').inject(headerTable);
                newRow = UWA.createElement('tr', {title: ''}).inject(tbody);
                newCell = UWA.createElement('td', {'width': '40%', 'title': ''}).inject(newRow);
                UWA.createElement('strong', {text: 'Name'}).inject(newCell);

                newCell = UWA.createElement('td',
                        {'width': '60%', 'title': ''}).inject(newRow);*/

                currentCheck = new Text({
                    placeholder: "...",
                    attributes: {
                        value: elementName,
                        multiline: true,
                        disabled: false
                    },
                    events: {
                        onChange: function () {//IR-695253-3DEXPERIENCER2019x FD06, 20x FD01: remove currentCheck.getValue()
                            fctChange(elt, currentCheck, true);
                            UWA.log("onchange");
                        },
                        onKeyDown: function () {

                            if (timerconn) { clearTimeout(timerconn); }
                            timerconn = setTimeout(function() {
                                 fctChange(elt, currentCheck, false);
                            }, 20);
                        }
                    }
                }).inject(newCell2);

                closeButton.addEvent("onClick", function () {
                    lcview.removePropsNode();
                    fctChange(elt, currentCheck, true);
                });

                /*onKeyDown: function () {
                    console.log("onKeyDown");
                //UIUtilities.beingModified(imgCell, ParamWdgNLS.Being_Modified);
                 }*/

                insertDiv = document.getElementsByClassName("egraph_views_domroot")[0];
                insertDiv.appendChild(selectedObjpropsDiv);
            },

            removePropsNode : function () {
                var child = document.getElementById("propsTransitionDiv");
                if (child) {
                    if (child.parentNode) {
                        child.parentNode.removeChild(child);
                    }
                }
            }


        };

        return lcview;

    });

define('DS/ParameterizationSkeleton/Views/ParameterizationMSF/MSFGCOMappingViewUtilities',
		[
			'UWA/Core',
			'DS/UIKIT/Alert',
			'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
			'i18n!DS/ParameterizationSkeleton/assets/nls/MSFContentMgmtNLS'
			],
			function (UWA, Alert, ParametersLayoutViewUtilities, MSFContentMgmtNLS) {

	'use strict';

	var gcoMappingViewUtilites = {

			initVariable: function() {
				this.cellsIndex = {
						"internalType": 0,
						"experienceType": 1,
						"policy": 2,
						"format": 3,
						"relationship": 4,
						"action": 5,
						"deploy": 6
				};
			},
			buildJsonObjectFromTableRow: function (rowInfo) {

				var obj = {};

				obj["InternalType"] = rowInfo.cells[this.cellsIndex.internalType].innerHTML;
				obj["OfficeType"] = rowInfo.cells[this.cellsIndex.experienceType].innerHTML;
				obj["Policy"] = rowInfo.cells[this.cellsIndex.policy].innerHTML;
				obj["Format"] = rowInfo.cells[this.cellsIndex.format].innerHTML;
				obj["Relationship"] = rowInfo.cells[this.cellsIndex.relationship].innerHTML;
				obj["UserOperation"] = rowInfo.cells[this.cellsIndex.deploy].UserOperation;

				return obj;
			},

			resetForFieldLineChanges: function (fieldInfo) {

				var that = this;
				if (fieldInfo.IsDeployed == "NewNotDeployed") {
					var cellValue = fieldInfo.cells[this.cellsIndex.deploy].UserOperation;
					if (cellValue == "Add") {
						return fieldInfo;
					} else if ("Remove") {
						that.resetForRemove(fieldInfo);
					}
					fieldInfo.IsDeployed = "Deployed";
					fieldInfo.cells[this.cellsIndex.deploy].UserOperation = null;
				}
			},
			
			resetForRemove: function (fieldInfo) {

				var that = this;
				var imgSpan = that.buildImgSpan('check', '2.5', 'green', MSFContentMgmtNLS.Deployed);
				var actionCell = fieldInfo.cells[this.cellsIndex.action];
				var deploycell = fieldInfo.cells[this.cellsIndex.deploy];

				that.addRemoveButtonToCellRow(actionCell, fieldInfo);
				deploycell.empty();
				imgSpan.inject(deploycell);
			},

			buildImgSpan: function (iconChoice, iconSize, iconColor, title) {
				var imgClass = 'fonticon fonticon-' + iconSize + 'x fonticon-' + iconChoice,
				imgSpan = UWA.createElement('span', {
					'class': imgClass,
					'title': title
				});

				imgSpan.setStyle("color", iconColor);
				return imgSpan;
			},

			addRemoveButtonToCellRow: function (cell, fieldInfo) {
				var removelts = ParametersLayoutViewUtilities.createActionElements(MSFContentMgmtNLS.removeMapping, true);
				var deleteSpan = removelts[0];
				deleteSpan.setStyle("float", "left");
				deleteSpan.setStyle("padding", "0px 25px");
				deleteSpan.inject(cell);
				var removeAttributeButton = removelts[1];
				var removePop = removelts[2];

				var that = this;
				removeAttributeButton.addEvent("onClick", function (e) {
					that.removeRowCallBack(fieldInfo);
				});

				return removeAttributeButton;
			},

			removeRowCallBack: function (fieldInfo) {

				if (fieldInfo.IsDeployed === "NewNotDeployed") {
					fieldInfo.remove();
				} else {
					this.removeDeployedRow(fieldInfo);
				}
			},

			removeDeployedRow: function (fieldInfo) {
				fieldInfo.IsDeployed = "NewNotDeployed";
				var arrayAction = fieldInfo.cells[this.cellsIndex.action].getElements('span');
				arrayAction.forEach(function (action) {
					action.hide();
				});

				var deploycell = fieldInfo.cells[this.cellsIndex.deploy];
				var imgSpan = this.buildImgSpan('trash', '1.5', 'red', MSFContentMgmtNLS.removedField);

				deploycell.empty();
				deploycell.UserOperation = "Remove";

				imgSpan.inject(deploycell);
			},

			getAlertMessage: function (message, className, toDisplayOn) {

				this.alertOptions = {
						visible: true,
						className: 'param-alert',
						messageClassName: className,
						closable: true,
						renderTo: toDisplayOn,
						autoHide: true,
						hideDelay: 2000
				};

				var alert = new Alert(this.alertOptions);
				alert.add({
					message: message,
				});
			}
	};
	gcoMappingViewUtilites.initVariable();
	return gcoMappingViewUtilites;

});

define('DS/ParameterizationSkeleton/Views/VersionNamingLog/VersionNamingLogUtility', [
        'UWA/Core',
        'DS/WAFData/WAFData',
        'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
		'i18n!DS/ParameterizationSkeleton/assets/nls/VersionNamingNLS',
    ],
    function (UWA, WAFData, URLHandler, VersionNamingNLS) {

    const ShortNameToName = {
        "DashedRev": "---,--A,--B,--C,--D,--E,--F,--G,--H,--I,--J,--K,--L,--M,--N,--O,--P,--Q,--R,--S,--T,--U,--V,--W,--X,--Y,--Z,-AA,-BB,-CC,-DD,-EE,-FF,-GG,-HH,-II,-JJ,-KK,-LL,-MM,-NN,-OO,-PP,-QQ,-RR,-SS,-TT,-UU,-VV,-WW,-XX,-YY,-ZZ,AAA,BBB,CCC,DDD,EEE,FFF,GGG,HHH,III,JJJ,KKK,LLL,MMM,NNN,OOO,PPP,QQQ,RRR,SSS,TTT,UUU,VVV,WWW,XXX,YYY,ZZZ",
        "AlphabeticalRev": "A,B,C,...",
        "NumericalRev": "1,2,3,...",
        "RomanRev": "I,II,III,IV,V,VI,VII,VIII,IX,X,XI,XII,XIII,XIV,XV,XVI,XVII,XVIII,XIX,XX,XXI,XXII,XXIII,XXIV,XXV,XXVI,XXVII,XXVIII,XXIX,XXX,XXXI,XXXII,XXXIII,XXXIV,XXXV,XXXVI,XXXVII,XXXVIII,XXXIX,XL",
        "NthRev": "1st Rev,2nd Rev,3rd Rev,4th Rev,5th Rev,6th Rev,7th Rev,8th Rev,9th Rev,10th Rev,11th Rev,12th Rev,13th Rev,14th Rev,15th Rev,16th Rev,17th Rev,18th Rev,19th Rev,20th Rev,21st Rev,22nd Rev,23rd Rev,24th Rev,25th Rev,26th Rev,27th Rev,28th Rev,29th Rev,30th Rev,31st Rev,32nd Rev,33rd Rev,34th Rev,35th Rev,36th Rev,37th Rev,38th Rev,39th Rev,40th Rev",
        "ASMEY1435Rev (1)": "-,[A,B,C,D,E,F,G,H,J,K,L,M,N,P,R,T,U,V,W,Y]",
        "ASMEY1435Rev": "-,A,B,C,D,E,F,G,H,J,K,L,M,N,P,R,T,U,V,W,Y,AA,AB,AC,AD,AE,AF,AG,AH,AJ,AK,AL,AM,AN,AP,AR,AT,AU,AV,AW,AY,BA,BB,BC,BD,BE,BF,BG,BH,BJ,BK,BL,BM,BN,BP,BR,BT,BU,BV,BW,BY,CA,CB,CC,CD,CE,CF,CG,CH,CJ,CK,CL,CM,CN,CP,CR,CT,CU,CV,CW,CY,DY,DA,DB,DC,DD,DE,DF,DG,DH,DJ,DK,DL,DM,DN,DP,DR,DT,DU,DV,DW,DY,EA,EB,EC,ED,EE,EF,EG,EH,EJ,EK,EL,EM,EN,EP,ER,ET,EU,EV,EW,EY,FA,FB,FC,FD,FE,FF,FG,FH,FJ,FK,FL,FM,FN,FP,FR,FT,FU,FV,FW,FY,FA,GB,GC,GD,GE,GF,GG,GH,GJ,GK,GL,GM,GN,GP,GR,GT,GU,GV,GW,GY,HA,HB,HC,HD,HE,HF,HG,HH,HJ,HK,HL,HM,HN,HP,HR,HT,HU,HV,HW,HY,JA,JB,JC,JD,JE,JF,JG,JH,JJ,JK,JL,JM,JN,JP,JR,JT,JU,JV,JW,JY,KA,KB,KC,KD,KE,KF,KG,KH,KJ,KK,KL,KM,KN,KP,KR,KT,KU,KV,KW,KY,LA,LB,LC,LD,LE,LF,LG,LH,LJ,LK,LL,LM,LN,LP,LR,LT,LU,LV,LW,LY,MA,MB,MC,MD,ME,MF,MG,MH,MJ,MK,ML,MM,MN,MP,MR,MT,MU,MV,MW,MY,NA,NB,NC,ND,NE,NF,NG,NH,NJ,NK,NL,NM,NN,NP,NR,NT,NU,NV,NW,NY,PA,PB,PC,PD,PE,PF,PG,PH,PJ,PK,PL,PM,PN,PP,PR,PT,PU,PV,PW,PY,RA,RB,RC,RD,RE,RF,RG,RH,RJ,RK,RL,RM,RN,RP,RR,RT,RU,RV,RW,RY,TA,TB,TC,TD,TE,TF,TG,TH,TJ,TK,TL,TM,TN,TP,TR,TT,TU,TV,TW,TY,UA,UB,UC,UD,UE,UF,UG,UH,UJ,UK,UL,UM,UN,UP,UR,UT,UU,UV,UW,UY,VA,VB,VC,VD,VE,VF,VG,VH,VJ,VK,VL,VM,VN,VP,VR,VT,VU,VV,VW,VY,WA,WB,WC,WD,WE,WF,WG,WH,WJ,WK,WL,WM,WN,WP,WR,WT,WU,WV,WW,WY,YA,YB,YC,YD,YE,YF,YG,YH,YJ,YK,YL,YM,YN,YP,YR,YT,YU,YV,YW,YY,...",
        "NumericalZeroRev (1)": "0,1,2,...",
        "NumericalZeroRev": "0,1,2,3,..."
    };

    const NameToShortName = {
        "---,--A,--B,--C,--D,--E,--F,--G,--H,--I,--J,--K,--L,--M,--N,--O,--P,--Q,--R,--S,--T,--U,--V,--W,--X,--Y,--Z,-AA,-BB,-CC,-DD,-EE,-FF,-GG,-HH,-II,-JJ,-KK,-LL,-MM,-NN,-OO,-PP,-QQ,-RR,-SS,-TT,-UU,-VV,-WW,-XX,-YY,-ZZ,AAA,BBB,CCC,DDD,EEE,FFF,GGG,HHH,III,JJJ,KKK,LLL,MMM,NNN,OOO,PPP,QQQ,RRR,SSS,TTT,UUU,VVV,WWW,XXX,YYY,ZZZ": "DashedRev",
        "A,B,C,...": "AlphabeticalRev",
        "1,2,3,...": "NumericalRev",
        "I,II,III,IV,V,VI,VII,VIII,IX,X,XI,XII,XIII,XIV,XV,XVI,XVII,XVIII,XIX,XX,XXI,XXII,XXIII,XXIV,XXV,XXVI,XXVII,XXVIII,XXIX,XXX,XXXI,XXXII,XXXIII,XXXIV,XXXV,XXXVI,XXXVII,XXXVIII,XXXIX,XL": "RomanRev",
        "1st Rev,2nd Rev,3rd Rev,4th Rev,5th Rev,6th Rev,7th Rev,8th Rev,9th Rev,10th Rev,11th Rev,12th Rev,13th Rev,14th Rev,15th Rev,16th Rev,17th Rev,18th Rev,19th Rev,20th Rev,21st Rev,22nd Rev,23rd Rev,24th Rev,25th Rev,26th Rev,27th Rev,28th Rev,29th Rev,30th Rev,31st Rev,32nd Rev,33rd Rev,34th Rev,35th Rev,36th Rev,37th Rev,38th Rev,39th Rev,40th Rev": "NthRev",
        "-,[A,B,C,D,E,F,G,H,J,K,L,M,N,P,R,T,U,V,W,Y]": "ASMEY1435Rev",
        "-,A,B,C,D,E,F,G,H,J,K,L,M,N,P,R,T,U,V,W,Y,AA,AB,AC,AD,AE,AF,AG,AH,AJ,AK,AL,AM,AN,AP,AR,AT,AU,AV,AW,AY,BA,BB,BC,BD,BE,BF,BG,BH,BJ,BK,BL,BM,BN,BP,BR,BT,BU,BV,BW,BY,CA,CB,CC,CD,CE,CF,CG,CH,CJ,CK,CL,CM,CN,CP,CR,CT,CU,CV,CW,CY,DY,DA,DB,DC,DD,DE,DF,DG,DH,DJ,DK,DL,DM,DN,DP,DR,DT,DU,DV,DW,DY,EA,EB,EC,ED,EE,EF,EG,EH,EJ,EK,EL,EM,EN,EP,ER,ET,EU,EV,EW,EY,FA,FB,FC,FD,FE,FF,FG,FH,FJ,FK,FL,FM,FN,FP,FR,FT,FU,FV,FW,FY,FA,GB,GC,GD,GE,GF,GG,GH,GJ,GK,GL,GM,GN,GP,GR,GT,GU,GV,GW,GY,HA,HB,HC,HD,HE,HF,HG,HH,HJ,HK,HL,HM,HN,HP,HR,HT,HU,HV,HW,HY,JA,JB,JC,JD,JE,JF,JG,JH,JJ,JK,JL,JM,JN,JP,JR,JT,JU,JV,JW,JY,KA,KB,KC,KD,KE,KF,KG,KH,KJ,KK,KL,KM,KN,KP,KR,KT,KU,KV,KW,KY,LA,LB,LC,LD,LE,LF,LG,LH,LJ,LK,LL,LM,LN,LP,LR,LT,LU,LV,LW,LY,MA,MB,MC,MD,ME,MF,MG,MH,MJ,MK,ML,MM,MN,MP,MR,MT,MU,MV,MW,MY,NA,NB,NC,ND,NE,NF,NG,NH,NJ,NK,NL,NM,NN,NP,NR,NT,NU,NV,NW,NY,PA,PB,PC,PD,PE,PF,PG,PH,PJ,PK,PL,PM,PN,PP,PR,PT,PU,PV,PW,PY,RA,RB,RC,RD,RE,RF,RG,RH,RJ,RK,RL,RM,RN,RP,RR,RT,RU,RV,RW,RY,TA,TB,TC,TD,TE,TF,TG,TH,TJ,TK,TL,TM,TN,TP,TR,TT,TU,TV,TW,TY,UA,UB,UC,UD,UE,UF,UG,UH,UJ,UK,UL,UM,UN,UP,UR,UT,UU,UV,UW,UY,VA,VB,VC,VD,VE,VF,VG,VH,VJ,VK,VL,VM,VN,VP,VR,VT,VU,VV,VW,VY,WA,WB,WC,WD,WE,WF,WG,WH,WJ,WK,WL,WM,WN,WP,WR,WT,WU,WV,WW,WY,YA,YB,YC,YD,YE,YF,YG,YH,YJ,YK,YL,YM,YN,YP,YR,YT,YU,YV,YW,YY,...": "ASMEY1435Rev",
        "0,1,2,...": "NumericalZeroRev",
        "0,1,2,3,...": "NumericalZeroRev"
    };

    const requestHelper = function (url, methodType, data, onSuccess, onFailure, language) {

        var ODT_MODE = undefined;

        if (window.__karma__ != undefined) {
            ODT_MODE = window.__karma__.config.args[0];
        }

        const urlSecurityContext = URLHandler.getURL() + "/resources/pno/person/getsecuritycontext?tenant=" + URLHandler.getTenant();
        console.log("Get security context:");
        WAFData.authenticatedRequest(urlSecurityContext, {
            timeout: 250000,
            method: 'GET',
            data: "",
            type: 'json',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            onFailure: function (json) {

                if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {
                    this.onComplete("VPLMAdmin.MyCompany.Default");
                } else {
                    console.log('VersionNamingExtUtility::requestHelper - Failure');
                    console.log(json);
                }
            },
            onComplete: function (securityContext) {
                const urlFinal = URLHandler.getURL() + url + "?tenant=" + URLHandler.getTenant();
                WAFData.authenticatedRequest(urlFinal, {
                    timeout: 250000,
                    method: methodType,
                    data: data,
                    type: 'json',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'SecurityContext': securityContext.SecurityContext,
						'Accept-Language': language
                    },
                    onFailure: function (result) {

                        if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {

                            var result = {
                                "logics": [{
                                        "operator": "ADD",
                                        "name": "Logic01",
                                        "status": "SUCCEEDED"
                                    }
                                ]
                            };

                            this.onComplete(result);
                        } else {
                            console.log('VersionNamingExtUtility::requestHelper - Failure');
                            console.log(result);
                            onFailure(result);
                        }
                    },
                    onComplete: function (result) {
                        console.log('VersionNamingExtUtility::requestHelper - Success');
                        onSuccess(result);
                    }
                });
            }
        });
    };

    const requestHelperPromise = function (url, methodType, data, language) {
        return new Promise((resolve, reject) => {
            requestHelper(url, methodType, data, (result) => resolve(result), (error) => reject(error), language);
        });
    };

    const isExtendedSeq = function (seqname) {
        if (!!NameToShortName[seqname])
            return false;
        console.log("isExtendedSeq returning true for: ");
        console.log(seqname);
        return true;
    };

    return {

        getAllRevisionLogicsPromise: function () {
            return new Promise(function (resolve, reject) {
                var url = "/resources/v1/dslc/getrevisionlogics";
                var jsonData = {
                    "sequences": [{
                            "search": "*"
                        }
                    ]
                };

                requestHelper(url, "POST", JSON.stringify(jsonData),
                    (json) => {
                    if (json && Array.isArray(json.sequences)) {
                        var result = [];
                        json.sequences.forEach((seq) => {
                            if (seq.sequence) {
                                let altname = NameToShortName[seq.sequence.name];
                                seq.sequence.altname = altname || seq.sequence.name;
                                seq.sequence.extended = isExtendedSeq(seq.sequence.name);
                                if (seq.sequence.altname === "ASMEY1435Rev (1)")
                                    seq.sequence.altname = "ASMEY1435Rev";
                                if (seq.sequence.altname === "NumericalZeroRev (1)")
                                    seq.sequence.altname = "NumericalZeroRev";
                                result.push(seq.sequence);
                            }
                        });
                        resolve(result);
                        return;
                    } else if (json && Array.isArray(json)) {
                        var result = [];
                        json.forEach((seq) => {
                            if (seq) {
                                let altname = NameToShortName[seq.name];
                                seq.altname = altname || seq.name;
                                seq.extended = isExtendedSeq(seq.name);
                                if (seq.altname === "ASMEY1435Rev (1)")
                                    seq.altname = "ASMEY1435Rev";
                                if (seq.altname === "NumericalZeroRev (1)")
                                    seq.altname = "NumericalZeroRev";
                                result.push(seq);
                            }
                        });
                        resolve(result);
                        return;
                    }
                    reject(json);
                },
                    (json) => {
                    reject(json);
                });
            });
        },

        downloadRevisionLogicsPromise: function () {
            return new Promise(function (resolve, reject) {
                var url = "/resources/v1/dslc/getrevisionlogics";

                var jsonData = {
                    "logics": [{
                            "search": "*"
                        }
                    ]
                };

                requestHelper(url, "POST", JSON.stringify(jsonData),
                    (json) => {
                    if (json && Array.isArray(json.sequences)) {
                        var result = [];
                        json.logics.forEach((seq) => {
                            if (seq.sequence && isExtendedSeq(seq.sequence.name)) {
                                result.push(seq.sequence);
                            }
                        });
                        resolve(result);
                        return;
                    } else if (json && Array.isArray(json)) {
                        var result = [];
                        json.forEach((seq) => {
                            if (seq && isExtendedSeq(seq.name)) {
                                result.push(seq);
                            }
                        });
                        resolve(result);
                        return;
                    }
                    reject(json);
                },
                    (json) => {
                    reject(json);
                });
            });
        },

        getAssociatedLogicsPromise: function (policies, types) {
            return new Promise(function (resolve, reject) {
                var url = "/resources/v1/dslc/associaterevisionlogics";
                var sequences = [];

                policies = policies || new Map();
                for (const v of policies.values()) {
                    v.forEach((policy) => {
                        sequences.push({
                            operator: "GET",
                            policy: policy
                        });
                    });
                }

                types = types || new Map();
                for (const v of types.values()) {
                    v.forEach((type) => {
                        sequences.push({
                            operator: "GET",
                            type: type
                        });
                    });
                }

                var jsonData = {
                    sequences: sequences
                };

                requestHelper(url, "POST", JSON.stringify(jsonData),
                    (json) => {
                    if (json && Array.isArray(json.sequences)) {
                        var result = [];
                        json.sequences.forEach((seq) => {
                            seq.altname = NameToShortName[seq.name] || seq.name;
                            if (seq.altname === "ASMEY1435Rev (1)")
                                seq.altname = "ASMEY1435Rev";
                            if (seq.altname === "NumericalZeroRev (1)")
                                seq.altname = "NumericalZeroRev";
                            result.push(seq);

                        });
                        resolve(result);
                        return;
                    }
                    reject(json);
                },
                    (json) => {
                    reject(json);
                });
            });
        },

        uploadRevisionLogicsPromise: function (jsonData, language) {
            var url = "/resources/v1/dslc/editrevisionlogics";
            return requestHelperPromise(url, "POST", JSON.stringify(jsonData), language);
        },

    }
});

/*@fullReview  ZUR 15/11/23 2017x Param Skeleton*/
/*global define, widget*/

//const fs = require('fs');

define('DS/ParameterizationSkeleton/Views/VersionNamingLog/VersionNamingLogLayoutView',
    [
        'UWA/Core',
        'UWA/Class/View',
        'DS/UIKIT/Mask',
        'DS/UIKIT/Scroller',
        'DS/UIKIT/Input/Button',
        'DS/UIKIT/Input/File',
        'DS/UIKIT/Popover',
        'DS/Controls/Label',
        'DS/Controls/Editor',
        'DS/ParameterizationSkeleton/Views/VersionNamingLog/VersionNamingLogUtility',
        'DS/ParameterizationSkeleton/Views/VersionNamingLog/VersionNamingLogAlertUtility',
        'i18n!DS/ParameterizationSkeleton/assets/nls/VersionNamingNLS',
        'UWA/Drivers/Alone',
        'DS/Core/Core',
        'DS/TreeModel/DataModelSet',
        'DS/TreeModel/TreeDocument',
        'DS/TreeModel/TreeNodeModel',
        'DS/DataGridView/DataGridView',
        'DS/CollectionView/CollectionViewStatusBar',
        'DS/Windows/ImmersiveFrame',
        'DS/Windows/Panel',
        'DS/Controls/Button',
        'DS/Utilities/Utils',

        'DS/WAFData/WAFData',
        'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
        'DS/WUXAutoComplete/AutoComplete',
        'UWA/Promise',
        'DS/Controls/ProgressBar',
        'DS/Windows/Dialog',
        'DS/Controls/ModalContainer',
        'DS/Controls/Loader',
        'DS/WebappsUtils/WebappsUtils',
        'DS/Utilities/Dom'

    ], function (UWA, View, Mask, Scroller, Button, UXFile, Popover, Label, Editor, VNEUtility, AlertUtility, VersionNamingNLS, Alone, WUX, DataModelSet, TreeDocument, TreeNodeModel, WUXDataGridView, CollectionViewStatusBar, WUXImmersiveFrame, WUXPanel, WUXButton, Utils, WAFData, URLHandler, WUXAutoComplete, Promise, ProgressBar, WUXDialog, WUXModalContainer, WUXLoader, WebappsUtils, Dom) {
    'use strict';

    var odtMode = 0;

    var extendedView = View.extend({

        defaultOptions: {
            type: 'default'
        },

        // The ‘options’ object is passed via the ‘viewOptions’ specified in the Renderer at the Skeleton instantiation
        init: function (options) {
            console.log("VersionNamingLogLayoutView::init");
            this.options = UWA.clone(options || {}, false); //environment options
            this._parent(options);
            this.childView = null;
        },

        render: function () {
            var that = this;

            that.contentDiv = UWA.createElement('div', {
                'id': "VersionNamingLogParamContainer"
            });

            //that.contentDiv.style.width = "100%"; NO!! (à cause du margin dans le css)
            that.contentDiv.style.height = "100%";
            that.contentDiv.style.margin = "14px";
            that.container.setContent(that.contentDiv);

            //
            that.createHeader(that.contentDiv);

            //
            var versionNamingTable = UWA.createElement('table', {
                'id': "VersionNamingLogParamTable"
            });
            versionNamingTable.style.width = "100%";
            versionNamingTable.style.marginBottom = "10px";
            //versionNamingTable.style.height = "100%";
            versionNamingTable.inject(that.contentDiv);

            var versionNamingDiv = UWA.createElement('tr', {
                'id': "Elmt1"
            }).inject(versionNamingTable);

            this.createComponents(versionNamingDiv, that.contentDiv);

            return that;
        },

        createComponents: function (versionNamingDiv, contentDiv) {
            var that = this;
            var file = null;
            var myDGV = null;
            var model = new TreeDocument();

            var arrayERS_set = new Array();
            var arrayERS_reset = new Array();
            var arrayERS_Title_set = new Array();
            var arrayERS_Title_reset = new Array();

            var arrayDisplay_set = new Array();
            var arrayDisplay_reset = new Array();

            var fromTypes = new Array();
            var toTypes = new Array();

            var initial = contentDiv.innerHTML;

            var ODT_MODE = undefined;

            if (window.__karma__ != undefined) {
                ODT_MODE = window.__karma__.config.args[0];
            }

            var browseDiv = UWA.createElement('div', {
                'id': "browseDiv",
                'display': "inline"
            }).inject(versionNamingDiv);

            var fileSelector = new UXFile({
                multiple: false,
                buttonBefore: false,
                name: 'file-input',
                buttonClassName: 'default',
                placeholder: VersionNamingNLS.SelectAFile,
                buttonText: VersionNamingNLS.BrowseButtonText
            }).inject(browseDiv);

            var fakeInput = undefined;

            fileSelector.onChange = function (data) {

                if (ODT_MODE != undefined) {

                    var name = "name";
                    var Logic01 = "Logic01";
                    var title = "title";
                    var Logic01title = "Logic01_title";
                    var primary = "primary";
                    var changeSequence = "changeSequence";
                    var SEQName01 = "SEQ_Name_01";

                    fakeInput = "[{\"" + name + "\": \"" + Logic01 + "\", \"" + title + "\": \"" + Logic01title + "\",\"" + primary + "\": {\"" + changeSequence + "\": \"" + SEQName01 + "\"}}]";

                    const blob = new Blob([fakeInput], {
                        type: 'text/plain'
                    });
                    file = new File([blob], 'DefinedRevisionLogic.json');
                } else {
                    file = fileSelector.elements.input.files[0];
                }
                fileSelector.elements.container.getChildren()[0].placeholder = file.name;
            }

            // Upload button to upload selected file
            var uploadButton = new Button({
                id: "uploadButton_",
                className: "primary",
                value: VersionNamingNLS.UploadButtonText,
                icon: 'upload'
            })
                .inject(browseDiv);
            uploadButton.elements.container.style.marginTop = "5px";
            uploadButton.addEvent('onClick', function () {

                if (!file) {
                    AlertUtility.message('error', VersionNamingNLS.NoFileToUpload);
                    fileSelector.elements.container.getChildren()[0].placeholder = VersionNamingNLS.SelectAFile;
                    fileSelector.clear();
                    return;
                }

                //Parse & checks
                var reader = new FileReader();
                reader.onload = function (event) {
                    var fileContent = reader.result;
                    that.parseFileContent(fileContent,
                        (json1) => {
                        var parsedRevisionLogics = json1;
                        console.log("revision sequences' file " + file.name + " parsed OK");
                        if (!parsedRevisionLogics) {
                            AlertUtility.message('error', VersionNamingNLS.NoContentToUpload);
                            file = null;
                            fileSelector.elements.container.getChildren()[0].placeholder = VersionNamingNLS.SelectAFile;
                            fileSelector.clear();
                            return;
                        }
                        var jsonData = parsedRevisionLogics;
						var language = getLanguage();
                        VNEUtility.uploadRevisionLogicsPromise(jsonData, language)
                        .then((jsonres) => {
                            if (!jsonres || jsonres.severity === "FATAL_ERROR" || jsonres.severity === "ERROR") {
                                if (jsonres && !!jsonres.errorMessage)
                                    AlertUtility.message('error', jsonres.errorMessage);
                                else
                                    AlertUtility.message('error', VersionNamingNLS.UploadFailedAlert);
                            } else {
                                AlertUtility.message('success', VersionNamingNLS.UploadSuccessAlert);

                                arrayERS_set.splice(0, arrayERS_set.length);
                                arrayERS_reset.splice(0, arrayERS_reset.length);
                                arrayERS_Title_set.splice(0, arrayERS_Title_set.length);
                                arrayERS_Title_reset.splice(0, arrayERS_Title_reset.length);

                                arrayERS_set.push(VersionNamingNLS.SetLogic);
                                arrayERS_reset.push(VersionNamingNLS.ResetLogic);
                                arrayERS_Title_set.push(VersionNamingNLS.SetLogic);
                                arrayERS_Title_reset.push(VersionNamingNLS.ResetLogic);

                                arrayDisplay_set.splice(0, arrayDisplay_set.length);
                                arrayDisplay_reset.splice(0, arrayDisplay_reset.length);

                                var myContainer = document.getElementById("VersionNamingLogParamContainer");
                                var loader = new WUXLoader();
                                var parentContainer = myContainer.getParent();

                                loader.on("Update Revision Sequences Logic...");

                                if (ODT_MODE == undefined || ODT_MODE != "ODT_MODE") {
                                    WUXModalContainer.createModal(parentContainer, loader.elements.container);
                                }

                                const urlSecurityContext = URLHandler.getURL() + "/resources/pno/person/getsecuritycontext?tenant=" + URLHandler.getTenant();
                                console.log("Get security context:");
                                WAFData.authenticatedRequest(urlSecurityContext, {
                                    timeout: 250000,
                                    method: 'GET',
                                    data: "",
                                    type: 'json',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    onFailure: function (e) {
                                        if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {
                                            var securityContext = "VPLMAdmin.MyCompany.Default";
                                            this.onComplete(securityContext);
                                        } else {
                                            console.log('getsecuritycontext: onFailure:' + e);
                                        }
                                    },
                                    onComplete: function (securityContext) {

                                        var secCont = securityContext;

                                        const urlFinal = URLHandler.getURL() + "/resources/v1/dslc/getrevisionlogics" + "?tenant=" + URLHandler.getTenant();

                                        var postInput2 = {
                                            "logics": [{
                                                    "search": "*"
                                                }
                                            ]
                                        };
                                        WAFData.authenticatedRequest(urlFinal, {
                                            timeout: 250000,
                                            method: 'POST',
                                            data: UWA.Json.encode(postInput2),
                                            type: 'json',
                                            headers: {
                                                'Content-Type': 'application/json',
                                                'Accept': 'application/json',
                                                'SecurityContext': secCont.SecurityContext,
                                            },
                                            onFailure: function (e) {

                                                if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {

                                                    var payload = [{
                                                            "customize": "Logic01_description",
                                                            "name": "Logic01",
                                                            "title": "Logic01_title",
                                                            "primary": {
                                                                "changeSequence": "SEQ_Name_01"
                                                            }
                                                        }
                                                    ];

                                                    this.onComplete(payload);
                                                } else {
                                                    console.log('getrevisionsequences: onFailure:' + e);
                                                }
                                            },
                                            onComplete: function (payload) {

                                                console.log('getrevisionsequences: onComplete:' + payload);
                                                for (var i = 0; i < payload.length; i++) {

                                                    // yxxTitle
                                                    if (payload[i].title != undefined) {

                                                        arrayERS_set.push(payload[i].name);
                                                        arrayERS_reset.push(payload[i].name);

                                                        var counter = 0;
                                                        for (var currTitle of arrayERS_Title_set) {
                                                            //yxxTitle
                                                            if (currTitle == payload[i].title) {
                                                                counter++;
                                                            }
                                                        };

                                                        if (counter > 0) {
                                                            // yxxTitle
                                                            arrayERS_Title_set.push(payload[i].title + " (" + counter.toString() + ")");
                                                            arrayERS_Title_reset.push(payload[i].title + " (" + counter.toString() + ")");

                                                        } else {
                                                            // yxxTitle
                                                            arrayERS_Title_set.push(payload[i].title);
                                                            arrayERS_Title_reset.push(payload[i].title);
                                                        }
                                                    }

                                                }

                                                arrayDisplay_set = arrayERS_Title_set.slice();
                                                arrayDisplay_reset = arrayERS_Title_reset.slice();

                                                model.loadModel(model);

                                                loader.off();
                                                WUXModalContainer.removeModal(parentContainer);
                                                parentContainer.style.position = "";

                                            }

                                        })

                                    }
                                });

                            }

                            file = null;
                            fileSelector.elements.container.getChildren()[0].placeholder = VersionNamingNLS.SelectAFile;
                            fileSelector.clear();
                        })
                        .catch((e) => {
                            file = null;
                            fileSelector.elements.container.getChildren()[0].placeholder = VersionNamingNLS.SelectAFile;
                            fileSelector.clear();
                            if (!e)
                                e = VersionNamingNLS.UploadFailedAlert;
                            AlertUtility.message('error', e);
                        });
                    },
                        (errorMsg, e) => {
                        console.log("revision sequences' file " + file.name + " parsing failed");
                        file = null;
                        fileSelector.elements.container.getChildren()[0].placeholder = VersionNamingNLS.SelectAFile;
                        fileSelector.clear();

                        console.log(errorMsg);
                        console.log(e);
                        var msg = errorMsg;
                        if (!!e)
                            msg += "<br/>" + e;
                        //AlertUtility.message('error', msg);
						AlertUtility.message('error', VersionNamingNLS.FailedToParse);
                    });
                };
                reader.readAsText(file);
            });

            var downloadButton = new Button({
                id: "downloadButton_",
                className: "default",
                value: VersionNamingNLS.DownloadButtonText,
                icon: 'download'
            })
                .inject(browseDiv);
            downloadButton.elements.container.style.marginTop = "5px";
            downloadButton.elements.container.style.marginLeft = "5px";
            downloadButton.elements.container.style.float = "right";
            downloadButton.addEvent('onClick', function () { //Push content on server
                VNEUtility.downloadRevisionLogicsPromise()
                .then((content) => {
                    var concatedcontent = that.concatSequences(content);
                    return concatedcontent;
                })
                .then((concatedcontent) => {
                    var hrefcontent = encodeURIComponent(concatedcontent); //(VDU) IR-1367352-3DEXPERIENCER2025x, it is necessary to encode the content
                    var element = document.createElement('a');
                    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + hrefcontent);
                    element.setAttribute('download', "revisions.json");

                    element.style.display = 'none';
                    document.body.appendChild(element);

                    element.click();

                    document.body.removeChild(element);
                })
                .catch((e) => {
                    if (!e)
                        e = VersionNamingNLS.DownloadFailedAlert;
                    AlertUtility.message('error', e);
                });
            });

            // -----------------------------------------------------------------------------

            var ENOLifecycle_ERS_Activated = "false";
            var ENOLifecycle_debug_Activated = "false";

            var pathRes = WebappsUtils.getWebappsAssetUrl('ParameterizationSkeleton', 'LifecycleTypesResources.json');

            function loadJSONVar(path, success, error) {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4) {
                        if (xhr.status === 200) {
                            success(JSON.parse(xhr.responseText));

                        } else {
                            error(xhr);
                        }
                    }
                };
                xhr.open('GET', path, true);
                xhr.send();
            }

            loadJSONVar(pathRes, getERSVar, 'jsonp');

            function getERSVar(rootTypes) {

                for (var l = 0; l < rootTypes.length; l++) {

                    if (rootTypes[l].propagations != undefined) {

                        for (var m = 0; m < rootTypes[l].propagations.length; m++)

                            if (rootTypes[l].propagations[m].from != undefined && rootTypes[l].propagations[m].to) {

                                fromTypes.push(rootTypes[l].propagations[m].from);
                                toTypes.push(rootTypes[l].propagations[m].to);

                            }
                    }

                }

            }

            model.prepareUpdate();

            var createNode = function (label, icon) {

                //if (icon)
                //listIconNames.push(icon);

                var that = this;

                var data = null;

                data = [{
                        "tree": label,
                        "ERS": VersionNamingNLS.SetLogic
                    }
                ]

                var nodeData = data[0];

                var myURL1 = URLHandler.getURL() + "/snresources/images/icons/small/" + String(icon) + ".png" + "?tenant=" + URLHandler.getTenant();

                if (icon) {
                    return new TreeNodeModel({
                        label: label,
                        grid: nodeData,
                        icons: [{
                                iconPath: myURL1
                            }

                        ]
                    });

                } else {
                    return new TreeNodeModel({
                        label: label,
                        grid: nodeData
                    });
                }

            };

            var getIcon = function (payload, type) {

                for (var l = 0; l < payload.tree_of_childs.length; l++) {

                    if (type == payload.tree_of_childs[l].type) {

                        return payload.tree_of_childs[l].icon;
                        break;
                    }
                }
            }
            // to be deleted
            var getTypeNls = function (payload, type) {

                for (var l = 0; l < payload.tree_of_childs.length; l++) {

                    if (type == payload.tree_of_childs[l].type) {

                        return payload.tree_of_childs[l].typeNls;
                        break;
                    }
                }
            }

            // YXX --- Recursive method to retrieve tree

            var _attachChildren = function (payload, k, fatherNode) {

                var currentNode = undefined;
                var icon = undefined;

                // to be deleted
                var typeNls = undefined;

                for (var j = 0; j < payload.tree_of_childs[k].children.length; j++) {

                    icon = getIcon(payload, payload.tree_of_childs[k].children[j]);

                    // to be deleted
                    typeNls = getTypeNls(payload, payload.tree_of_childs[k].children[j]);

                    currentNode = createNode(typeNls, icon);

                    fatherNode.addChild(currentNode);

                    for (var l = 0; l < payload.tree_of_childs.length; l++) {

                        if (payload.tree_of_childs[k].children[j] == payload.tree_of_childs[l].type) {

                            _attachChildren(payload, l, currentNode);

                            break;

                        }

                    }

                }
            }

            //  -----------------------------------


            model.expandAll();
            model.pushUpdate();

            //

            /**
             * Get language.
             * @returns {string}
             */
            var getLanguage = function () {

                var locale;
                //if (window && window.dsLang) {
                if (window && window.widget && window.widget.lang) {
                    //locale = window.dsLang;
                    locale = window.widget.lang;
                    if ('devsymbol' === locale) {
                        locale = 'en';
                    }
                } else {
                    var lang;
                    if (window && window.clntlang) {
                        // this variable is set by BPS
                        // by reading 'Accept-Language' header to emxNavigator.jsp,
                        // which is the only way to access user preference language  for IE(no way to access it in JS)
                        lang = window.clntlang;
                    } else if (navigator && navigator.languages && UWA.is(navigator.languages, 'array') && navigator.languages.length > 0) {
                        lang = navigator.languages[0];
                    } else {
                        lang = (navigator ? (navigator.language || navigator.systemLanguage) : DEFAULT_LANG);
                    }
                    locale = lang.toLowerCase().split('-')[0];
                }
                return locale;
            }

            var language = getLanguage();

            // --- YXX : build tree

            arrayERS_set.push(VersionNamingNLS.SetLogic);
            arrayERS_reset.push(VersionNamingNLS.ResetLogic);
            arrayERS_Title_set.push(VersionNamingNLS.SetLogic);
            arrayERS_Title_reset.push(VersionNamingNLS.ResetLogic);

            var secCont;
            var listOfTypes = new Array();
            var listOfTypesNls = new Array();
            var listOfSequences = new Array();
            var listOfSequencesTitle = new Array();
            var listOfShowTypes = new Array();
            var nbrChilds;
            var postInputTypes = "";

            var payloadTree;

            var progressStatusNode;
            var curData = 0;
            var cellInfosODT;

            // fetch file to retrieve roots types

            var listOfRoots = new Array();
            var pathResource = WebappsUtils.getWebappsAssetUrl('ParameterizationSkeleton', 'LifecycleTypesResources.json');

            // loadJSON method to open the JSON file.
            function loadJSON(path, success, error) {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4) {
                        if (xhr.status === 200) {
                            success(JSON.parse(xhr.responseText));

                        } else {
                            error(xhr);
                        }
                    }
                };
                xhr.open('GET', path, true);
                xhr.send();
            }

            loadJSON(pathResource, getRootTypes, 'jsonp');

            function getRootTypes(rootTypes) {

                for (var l = 0; l < rootTypes.length; l++) {

                    if (rootTypes[l].fileName != undefined) {

                        listOfRoots.push(rootTypes[l].fileName);

                    }

                }

            }

            //------------


            var progressInterval;

            progressInterval = setInterval(function () {

                curData += 13 / (listOfRoots.length);

                if (curData < 100) {
                    progressStatusNode.updateOptions({
                        grid: {
                            data: curData
                        }
                    });
                }

            }, 500);

            const urlSecurityContext = URLHandler.getURL() + "/resources/pno/person/getsecuritycontext?tenant=" + URLHandler.getTenant();
            console.log("Get security context:");
            WAFData.authenticatedRequest(urlSecurityContext, {
                timeout: 250000,
                method: 'GET',
                data: "",
                type: 'json',
                headers: {
                    'Content-Type': 'application/json',
                    //'Accept': 'application/json'
                },
                onFailure: function (e) {

                    if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {
                        var securityContext = "VPLMAdmin.MyCompany.Default";
                        this.onComplete(securityContext);
                    } else {
                        //sinon
                        console.log('getsecuritycontext: onFailure:' + e);
                    }
                },
                onComplete: function (securityContext) {

                    secCont = securityContext;

                    const urlFinal = URLHandler.getURL() + "/resources/v1/dslc/getrevisionlogics" + "?tenant=" + URLHandler.getTenant();

                    var postInput2 = {
                        "logics": [{
                                "search": "*"
                            }
                        ]
                    };
                    WAFData.authenticatedRequest(urlFinal, {
                        timeout: 250000,
                        method: 'POST',
                        data: UWA.Json.encode(postInput2),
                        type: 'json',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json',
                            'SecurityContext': secCont.SecurityContext,
                        },
                        onFailure: function (e) {
                            if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {
                                var payload = [{
                                        "customize": "Logic01_description",
                                        "name": "Logic01",
                                        "title": "Logic01_title",
                                        "primary": {
                                            "changeSequence": "SEQ_Name_01"
                                        }
                                    }
                                ];
                                this.onComplete(payload);
                            } else {
                                //sinon
                                console.log('getrevisionsequences: onFailure:' + e);
                            }
                        },
                        onComplete: function (payload) {

                            console.log('getrevisionsequences: onComplete:' + payload);
                            for (var i = 0; i < payload.length; i++) {

                                // yxxTitle
                                if (payload[i].title != undefined) {

                                    arrayERS_set.push(payload[i].name);
                                    arrayERS_reset.push(payload[i].name);

                                    var counter = 0;
                                    for (var currTitle of arrayERS_Title_set) {

                                        // yxxTitle
                                        if (currTitle == payload[i].title) {
                                            counter++;
                                        }
                                    };

                                    if (counter > 0) {

                                        // yxxTitle
                                        arrayERS_Title_set.push(payload[i].title + " (" + counter.toString() + ")");
                                        arrayERS_Title_reset.push(payload[i].logic.title + " (" + counter.toString() + ")");

                                    } else {

                                        // yxxTitle
                                        arrayERS_Title_set.push(payload[i].title);
                                        arrayERS_Title_reset.push(payload[i].title);

                                    }
                                }

                            }

                            arrayDisplay_set = arrayERS_Title_set.slice();
                            arrayDisplay_reset = arrayERS_Title_reset.slice();
                        }
                    });

                    //}});

                    var that = this;

                    var path = "";
                    var path = URLHandler.getURL() + "/resources/lifecycle/hierarchictypestree/gethierarchictypestree" + "?tenant=" + URLHandler.getTenant() + "&lang=" + String(language) + "&debug=" + String(ENOLifecycle_debug_Activated);

                    var type_2 = "Document";
                    var type_3 = "VPMRepReference";
                    var type_5 = "PLMCoreReference";
                    var postInput = {
                        types: listOfRoots
                    };

                    WAFData.authenticatedRequest(path, {
                        method: 'POST',
                        type: 'json',
                        timeout: 1000 * 60, // ms, 1min
                        data: UWA.Json.encode(postInput),
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        onFailure: function (e) {
                            if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {

                                var payload = {
                                    "tree_of_childs": [{
                                            "root_type": "Compound Document",
                                            "root_typeNls": "Compound Document",
                                            "type": "MS Word Document",
                                            "typeNls": "MS Word Document",
                                            "icon": "",
                                            "showType": "yes",
                                            "children": [
                                            ],
                                            "childrenNls": [
                                            ]
                                        }, {
                                            "root_type": "Compound Document",
                                            "root_typeNls": "Compound Document",
                                            "type": "MS Excel Document",
                                            "typeNls": "MS Excel Document",
                                            "icon": "",
                                            "showType": "yes",
                                            "children": [
                                            ],
                                            "childrenNls": [
                                            ]
                                        }, {
                                            "root_type": "Compound Document",
                                            "root_typeNls": "Compound Document",
                                            "type": "MS Powerpoint Document",
                                            "typeNls": "MS PowerPoint Document",
                                            "icon": "",
                                            "showType": "yes",
                                            "children": [
                                            ],
                                            "childrenNls": [
                                            ]
                                        }, {
                                            "root_type": "Compound Document",
                                            "root_typeNls": "Compound Document",
                                            "type": "MS Outlook Document",
                                            "typeNls": "MS Outlook Document",
                                            "icon": "",
                                            "showType": "yes",
                                            "children": [
                                            ],
                                            "childrenNls": [
                                            ]
                                        }, {
                                            "root_type": "Compound Document",
                                            "root_typeNls": "Compound Document",
                                            "type": "MS Outlook Attachment",
                                            "typeNls": "MS Outlook Attachment",
                                            "icon": "",
                                            "showType": "yes",
                                            "children": [
                                            ],
                                            "childrenNls": [
                                            ]
                                        }, {
                                            "root_type": "Compound Document",
                                            "root_typeNls": "Compound Document",
                                            "type": "MS Word Template",
                                            "typeNls": "MS Word Template",
                                            "icon": "",
                                            "showType": "yes",
                                            "children": [
                                            ],
                                            "childrenNls": [
                                            ]
                                        }, {
                                            "root_type": "Compound Document",
                                            "root_typeNls": "Compound Document",
                                            "type": "MS Excel Template",
                                            "typeNls": "MS Excel Template",
                                            "icon": "",
                                            "showType": "yes",
                                            "children": [
                                            ],
                                            "childrenNls": [
                                            ]
                                        }, {
                                            "root_type": "Compound Document",
                                            "root_typeNls": "Compound Document",
                                            "type": "MS Powerpoint Template",
                                            "typeNls": "MS Powerpoint Template",
                                            "icon": "",
                                            "showType": "yes",
                                            "children": [
                                            ],
                                            "childrenNls": [
                                            ]
                                        }, {
                                            "root_type": "Compound Document",
                                            "root_typeNls": "Compound Document",
                                            "type": "MS Outlook Template",
                                            "typeNls": "MS Outlook Template",
                                            "icon": "",
                                            "showType": "yes",
                                            "children": [
                                            ],
                                            "childrenNls": [
                                            ]
                                        }, {
                                            "root_type": "Compound Document",
                                            "root_typeNls": "Compound Document",
                                            "type": "Office Document",
                                            "typeNls": "Office Document",
                                            "icon": "",
                                            "showType": "yes",
                                            "children": [
                                                "MS Word Document",
                                                "MS Excel Document",
                                                "MS Powerpoint Document",
                                                "MS Outlook Document",
                                                "MS Outlook Attachment",
                                                "MS Word Template",
                                                "MS Excel Template",
                                                "MS Powerpoint Template",
                                                "MS Outlook Template"
                                            ],
                                            "childrenNls": [
                                                "MS Word Document",
                                                "MS Excel Document",
                                                "MS PowerPoint Document",
                                                "MS Outlook Document",
                                                "MS Outlook Attachment",
                                                "MS Word Template",
                                                "MS Excel Template",
                                                "MS Powerpoint Template",
                                                "MS Outlook Template"
                                            ]
                                        }, {
                                            "root_type": "Compound Document",
                                            "root_typeNls": "Compound Document",
                                            "type": "Compound Document",
                                            "typeNls": "Compound Document",
                                            "icon": "",
                                            "showType": "yes",
                                            "children": [
                                                "Office Document"
                                            ],
                                            "childrenNls": [
                                                "Office Document"
                                            ]
                                        }
                                    ]
                                };

                                this.onComplete(payload);
                            } else {
                                //sinon
                                console.log('gethierarchictypestree: onFailure:' + e);
                            }
                        },
                        onComplete: function (payload) {

                            payloadTree = payload;

                            console.log('gettypeshierarchy: onComplete:' + payload);
                            //Parse result to find if input type is in the hierarchy

                            if (payload.hasOwnProperty("tree_of_childs") && payload.tree_of_childs.length > 0) {

                                nbrChilds = payload.tree_of_childs.length;
                                var currentNode = undefined;

                                // YXX --- Get default sequences for all types in one request

                                const urlFinal = URLHandler.getURL() + "/resources/v1/dslc/associaterevisionlogics" + "?tenant=" + URLHandler.getTenant();

                                var logics = "logics";
                                var operator = "operator";
                                var type = "type";
                                var get = "GET";

                                var postInput = "{\"" + logics + "\" : [ ";

                                for (var f = 0; f < nbrChilds; f++) {

                                    listOfTypes.push(payload.tree_of_childs[f].type)
                                    listOfTypesNls.push(payload.tree_of_childs[f].typeNls)
                                    listOfShowTypes.push(payload.tree_of_childs[f].showType)

                                    if (f == (nbrChilds - 1)) {
                                        postInput = postInput.concat("{\"", operator, "\" : \"", get, "\", \"", type, "\" : \"", listOfTypes[f], "\"}");
                                    } else {

                                        postInput = postInput.concat("{\"", operator, "\" : \"", get, "\", \"", type, "\" : \"", listOfTypes[f], "\"},");
                                    }
                                }

                                postInput = postInput.concat(" ]}");

                                postInputTypes = postInput;

                                WAFData.authenticatedRequest(urlFinal, {
                                    timeout: 250000,
                                    method: 'POST',
                                    data: postInput,
                                    type: 'json',
                                    headers: {
                                        'Content-Type': 'application/json',
                                        'Accept': 'application/json',
                                        'SecurityContext': secCont.SecurityContext,
                                    },
                                    onFailure: function (e) {
                                        if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {
                                            // mode ODT

                                            var payload = {
                                                "logics": [{
                                                        "type": "MS Word Document",
                                                        "operator": "GET",
                                                        "status": "SUCCEEDED"
                                                    }, {
                                                        "type": "MS Excel Document",
                                                        "operator": "GET",
                                                        "status": "SUCCEEDED"
                                                    }, {
                                                        "type": "MS Powerpoint Document",
                                                        "operator": "GET",
                                                        "status": "SUCCEEDED"
                                                    }, {
                                                        "type": "MS Outlook Document",
                                                        "operator": "GET",
                                                        "status": "SUCCEEDED"
                                                    }, {
                                                        "type": "MS Outlook Attachment",
                                                        "operator": "GET",
                                                        "status": "SUCCEEDED"
                                                    }, {
                                                        "type": "MS Word Template",
                                                        "operator": "GET",
                                                        "status": "SUCCEEDED"
                                                    }, {
                                                        "type": "MS Excel Template",
                                                        "operator": "GET",
                                                        "status": "SUCCEEDED"
                                                    }, {
                                                        "type": "MS Powerpoint Template",
                                                        "operator": "GET",
                                                        "status": "SUCCEEDED"
                                                    }, {
                                                        "type": "Office Document",
                                                        "operator": "GET",
                                                        "status": "SUCCEEDED"
                                                    }, {
                                                        "type": "Compound Document",
                                                        "operator": "GET",
                                                        "status": "SUCCEEDED"
                                                    }, {
                                                        "type": "MS Outlook Template",
                                                        "operator": "GET",
                                                        "status": "SUCCEEDED"
                                                    }
                                                ]
                                            };

                                            this.onComplete(payload);
                                        } else {
                                            // sinon
                                            console.log('associaterevisionsequences: onFailure:' + e);
                                        }
                                    },
                                    onComplete: function (payload) {
                                        console.log('associaterevisionsequences: onComplete:');

                                        for (var g = 0; g < nbrChilds; g++) {

                                            var currentNode = undefined;

                                            if (payload.logics[g].name != undefined) {
                                                listOfSequences.push(payload.logics[g].name);
                                                // yxxTitle
                                                listOfSequencesTitle.push(payload.logics[g].logic.title);
                                            } else {
                                                listOfSequences.push(VersionNamingNLS.SetLogic);
                                                listOfSequencesTitle.push(VersionNamingNLS.SetLogic);
                                            }

                                            var currentRoot = payloadTree.tree_of_childs[g].root_type;

                                            // YXX --- I am on a root
                                            if (currentRoot == payloadTree.tree_of_childs[g].type) {
                                                // to be replaced
                                                //currentNode = createNode(payloadTree.tree_of_childs[g].root_typeNls, payloadTree.tree_of_childs[g].icon);
                                                currentNode = createNode(payloadTree.tree_of_childs[g].typeNls, payloadTree.tree_of_childs[g].icon);
                                                model.addChild(currentNode);

                                                _attachChildren(payloadTree, g, currentNode);

                                            }
                                        }

                                        if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {

                                            // Simulate call to file selector
                                            fileSelector.events.input.change();

                                            //Simulate upload button
                                            uploadButton.events.container.click();

                                            // Simulate call to set sequence
                                            var cellInfos = cellInfosODT
                                                myDGV.columns[1].setCellValue(cellInfos, "Logic01_title");
                                        }

                                        clearInterval(progressInterval);
                                        progressStatusNode.updateOptions({
                                            tooltip: "Loading complete !",
                                            grid: {
                                                data: 100
                                            }
                                        });

                                    }
                                });

                                // ------------------------------------------
                            }
                        },
                        onTimeout: function () {
                            console.log('gettypeshierarchy: onTimeout: A connection timeout occured.');
                        }
                    });

                }
            });

            //});

            //  ---------------

            var childrenTypes = new Array();
            var childrenTypesProp = new Array();

            // YXX --- Recurse to get all children
            var getChildren = function (myType, payload, index, list) {

                for (var i = 0; i < payload.tree_of_childs[index].children.length; i++) {

                    list.push(payload.tree_of_childs[index].children[i]);

                    for (var g = 0; g < nbrChilds; g++) {

                        if (payload.tree_of_childs[index].children[i] == payload.tree_of_childs[g].type) {

                            getChildren(payload.tree_of_childs[g].type, payload, g, list);

                            break;
                        }
                    }
                }
                return;
            }

            // YXX --- Recurse to get all parents
            /*var getParents = function (myType, payload, list) {

            var found = 0;

            for (var g = 0; g < nbrChilds; g++) {

            for (var i = 0; i < payload.tree_of_childs[g].children.length; i++) {

            if (payload.tree_of_childs[g].children[i] == myType) {

            list.push(payload.tree_of_childs[g].type);

            getParents(payload.tree_of_childs[g].type, payload, list);

            found = 1;

            break;
            }
            }
            if (found == 1)
            break;
            }
            return;
            }*/

            var getTypeChildren = function (myType, payload) {

                var list = new Array();

                for (var g = 0; g < nbrChilds; g++) {

                    var currentType = payload.tree_of_childs[g].type;

                    if (currentType == myType) {

                        list.push(currentType);
                        getChildren(currentType, payload, g, list);
                        //getParents(currentType, payload, list);

                        return list;

                        break;
                    }
                }

            }

            // Set a filter on model
            model.setFilterModel({
                label: {
                    filterId: "string",
                    filterModel: {
                        condition1: {
                            type: "startsWith",
                            filter: ""
                        }
                    }
                }
            });

            var columns = [{
                    text: VersionNamingNLS.Type,
                    dataIndex: "tree",
                    typeRepresentation: "string",
                    onCellRequest: (cellInfos) => {

                        if (cellInfos.nodeModel) {

                            var typeValue = cellInfos.nodeModel.getAttributeValue("tree");

                            //component.style.color="red";

                            let found = listOfTypesNls.findIndex(function (element) {
                                return element == typeValue.toString();
                            });

                            var component;
                            component = myDGV.reuseCellContent("myReusableId");

                            if (listOfShowTypes[found] == "no") {

                                // transparent text color (defined in registerReusableCellContent)
                                component.setHTML(typeValue.toString());

                            } else {
                                // black text color
                                component.setHTML(typeValue.toString().fontcolor("black"));
                            }

                            cellInfos.cellView.setReusableContent(component);

                        }
                    }

                }, {
                    // YXX --- Using string with possibleValues generates the autocomplete component
                    text: VersionNamingNLS.ExtRevLog,
                    dataIndex: "ERS",
                    typeRepresentation: "string",
                    sortableFlag: false,
                    editionPolicy: "EditionOnClick",
                    allowFreeInputFlag: false,
                    getCellSemantics: function (cellInfos) {

                        if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {
                            cellInfosODT = cellInfos;
                        }

                        if (cellInfos.cellModel != VersionNamingNLS.SetLogic)

                            return {
                                possibleValues: arrayDisplay_reset,
                            };
                        else
                            return {
                                possibleValues: arrayDisplay_set,
                            };

                    },
                    getCellValue: function (cellInfos) {

                        if (!cellInfos || !cellInfos.nodeModel)
                            return;

                        let found = listOfTypesNls.findIndex(function (element) {
                            return element == cellInfos.nodeModel._options.label;
                        });

                        //return listOfSequences[found];
                        return listOfSequencesTitle[found];

                    },
                    setCellValue: function (cellInfos, value) {

                        let found = listOfTypesNls.findIndex(function (element) {
                            return element == cellInfos.nodeModel._options.label;
                        });

                        if (listOfSequencesTitle[found] != value) {

                            var myContainer = document.getElementById("VersionNamingLogParamContainer");

                            var loader = new WUXLoader();

                            var parentContainer = myContainer.getParent();

                            let index = -1;

                            if (cellInfos.nodeModel != undefined) {
                                index = listOfTypesNls.findIndex(function (element) {
                                    return element == cellInfos.nodeModel._options.label;
                                });

                            }

                            const urlFinal = URLHandler.getURL() + "/resources/v1/dslc/associaterevisionlogics" + "?tenant=" + URLHandler.getTenant();

                            var postInput = "";

                            let selectedIndex = arrayDisplay_set.findIndex(function (element) {
                                return element == value;
                            });

                            let selectedIndexLog = arrayDisplay_reset.findIndex(function (element) {
                                return element == value;
                            });

                            var succMsg = VersionNamingNLS.RNLAssociationSuccessAlert;

                            var loaderSetReset;
                            if (value == VersionNamingNLS.ResetSequence) {
                                loaderSetReset = VersionNamingNLS.ResettingSeq;
                            } else {
                                loaderSetReset = VersionNamingNLS.SettingSeq;

                            }

                            // Here I build a post input with type to set/reset but with also types we propagate to (as defined in resource file)

                            var logics = "logics";
                            var operator = "operator";
                            var type = "type";
                            var name = "name";
                            var Set = "SET";
                            var Reset = "RESET";

                            var nbOcc = 0;
                            var currToTypes = new Array();
                            for (var c = 0; c < fromTypes.length; c++) {
                                if (listOfTypes[index] == fromTypes[c]) {
                                    nbOcc = nbOcc + 1;
                                    currToTypes.push(toTypes[c]);
                                }
                            }

                            var postInput = "{\"" + logics + "\" : [ ";

                            if (nbOcc > 0) {
                                if (value != VersionNamingNLS.ResetLogic) {
                                    postInput = postInput.concat("{\"", name, "\" : \"", arrayERS_set[selectedIndex], "\", \"", operator, "\" : \"", Set, "\", \"", type, "\" : \"", listOfTypes[index], "\"}, ");
                                    loader.on(VersionNamingNLS.SettingSeq);

                                } else {
                                    postInput = postInput.concat("{\"", operator, "\" : \"", Reset, "\", \"", type, "\" : \"", listOfTypes[index], "\"}, ");
                                    loader.on(VersionNamingNLS.ResettingSeq);
                                }
                            } else {
                                if (value != VersionNamingNLS.ResetLogic) {
                                    postInput = postInput.concat("{\"", name, "\" : \"", arrayERS_set[selectedIndex], "\", \"", operator, "\" : \"", Set, "\", \"", type, "\" : \"", listOfTypes[index], "\"}");
                                    loader.on(VersionNamingNLS.SettingSeq);
                                } else {
                                    postInput = postInput.concat("{\"", operator, "\" : \"", Reset, "\", \"", type, "\" : \"", listOfTypes[index], "\"}");
                                    loader.on(VersionNamingNLS.ResettingSeq);
                                }

                            }

                            var currOcc = 0;
                            for (var f = 0; f < fromTypes.length; f++) {

                                if (listOfTypes[index] == fromTypes[f]) {

                                    if (currOcc == (nbOcc - 1)) {
                                        if (value != VersionNamingNLS.ResetLogic) {
                                            postInput = postInput.concat("{\"", name, "\" : \"", arrayERS_set[selectedIndex], "\", \"", operator, "\" : \"", Set, "\", \"", type, "\" : \"", toTypes[f], "\"}");
                                        } else {
                                            postInput = postInput.concat("{\"", operator, "\" : \"", Reset, "\", \"", type, "\" : \"", toTypes[f], "\"}");
                                        }

                                    } else {
                                        if (value != VersionNamingNLS.ResetLogic) {
                                            postInput = postInput.concat("{\"", name, "\" : \"", arrayERS_set[selectedIndex], "\", \"", operator, "\" : \"", Set, "\", \"", type, "\" : \"", toTypes[f], "\"}, ");
                                        } else {
                                            postInput = postInput.concat("{\"", operator, "\" : \"", Reset, "\", \"", type, "\" : \"", toTypes[f], "\"}, ");
                                        }
                                    }
                                    currOcc = currOcc + 1;
                                }

                            }

                            postInput = postInput.concat(" ]}");

                            /* if (value != VersionNamingNLS.ResetLogic) {
                            postInput = {
                            "logics": [{
                            "name": arrayERS_set[selectedIndex],
                            "operator": "SET",
                            "type": listOfTypes[index]
                            }
                            ]
                            };

                            loader.on(VersionNamingNLS.SettingLog);

                            } else {
                            postInput = {
                            "logics": [{
                            "name": arrayERS_reset[selectedIndexLog],
                            "operator": "RESET",
                            "type": listOfTypes[index]
                            }
                            ]
                            };

                            succMsg = VersionNamingNLS.RNLAssociationSuccessAlertR;

                            loader.on(VersionNamingNLS.ResettingLog);
                            }*/

                            loader.on(loaderSetReset);

                            if (ODT_MODE == undefined || ODT_MODE != "ODT_MODE") {
                                WUXModalContainer.createModal(parentContainer, loader.elements.container);
                            }

                            WAFData.authenticatedRequest(urlFinal, {
                                timeout: 250000,
                                method: 'POST',
                                //data: UWA.Json.encode(postInput),
                                data: postInput,
                                type: 'json',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Accept': 'application/json',
                                    'SecurityContext': secCont.SecurityContext,
                                },
                                onFailure: function (e) {
                                    if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {
                                        this.onComplete();
                                    } else {
                                        console.log('associaterevisionsequences: onFailure:' + e);
                                    }
                                },
                                onComplete: function () {
                                    console.log('associaterevisionsequences: onComplete:');

                                    const urlFinal = URLHandler.getURL() + "/resources/v1/dslc/associaterevisionlogics" + "?tenant=" + URLHandler.getTenant();

                                    // Get only children whose type could be impacted (children and parents)
                                    childrenTypes = getTypeChildren(listOfTypes[index], payloadTree);

                                    // Get list of index of those types

                                    var indexOfSequence = new Array();

                                    // Size of indexOfSequence must be the same size of childrenTypes
                                    for (var n = 0; n < childrenTypes.length; n++) {
                                        for (var m = 0; m < nbrChilds; m++) {

                                            if (listOfTypes[m] == childrenTypes[n])
                                                indexOfSequence.push(m);
                                        }
                                    }

                                    // ---------------------------------------------------------------------
                                    // Get also children of types to which propagation has been done (from resource Json file)


                                    for (var p = 0; p < nbOcc; p++) {
                                        // Get only children whose type could be impacted (children and parents)
                                        childrenTypesProp = getTypeChildren(currToTypes[p], payloadTree);

                                        // Size of indexOfSequence must be the same size of childrenTypesProp
                                        if (childrenTypesProp != undefined) { // if undefined it means the "to" type is not displayed in my tree, so I do not need to refresh
                                            for (var n = 0; n < childrenTypesProp.length; n++) {
                                                for (var m = 0; m < nbrChilds; m++) {

                                                    if (listOfTypes[m] == childrenTypesProp[n])
                                                        indexOfSequence.push(m);
                                                }
                                            }
                                        }

                                    }

                                    // ----------------------------------------------------------------------

                                    childrenTypes = childrenTypes.concat(childrenTypesProp);

                                    // ---------------------------------------------------------------------


                                    var sequences = "logics";
                                    var operator = "operator";
                                    var type = "type";
                                    var get = "GET";

                                    var postInput = "{\"" + sequences + "\" : [ ";

                                    for (var f = 0; f < childrenTypes.length; f++) {

                                        if (f == (childrenTypes.length - 1)) {
                                            postInput = postInput.concat("{\"", operator, "\" : \"", get, "\", \"", type, "\" : \"", childrenTypes[f], "\"}");
                                        } else {

                                            postInput = postInput.concat("{\"", operator, "\" : \"", get, "\", \"", type, "\" : \"", childrenTypes[f], "\"},");
                                        }
                                    }

                                    postInput = postInput.concat(" ]}");

                                    postInputTypes = postInput;

                                    // ---------------------------------------------------------------------


                                    WAFData.authenticatedRequest(urlFinal, {
                                        timeout: 250000,
                                        method: 'POST',
                                        data: postInputTypes,
                                        type: 'json',
                                        headers: {
                                            'Content-Type': 'application/json',
                                            'Accept': 'application/json',
                                            'SecurityContext': secCont.SecurityContext,
                                        },
                                        onFailure: function (e) {
                                            if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {
                                                var payload = {
                                                    "logics": [{
                                                            "type": "MS Word Document",
                                                            "operator": "GET",
                                                            "status": "SUCCEEDED"
                                                        }, {
                                                            "type": "MS Excel Document",
                                                            "operator": "GET",
                                                            "status": "SUCCEEDED"
                                                        }, {
                                                            "type": "MS Powerpoint Document",
                                                            "operator": "GET",
                                                            "status": "SUCCEEDED"
                                                        }, {
                                                            "type": "MS Outlook Document",
                                                            "operator": "GET",
                                                            "status": "SUCCEEDED"
                                                        }, {
                                                            "type": "MS Outlook Attachment",
                                                            "operator": "GET",
                                                            "status": "SUCCEEDED"
                                                        }, {
                                                            "type": "MS Word Template",
                                                            "operator": "GET",
                                                            "status": "SUCCEEDED"
                                                        }, {
                                                            "type": "MS Excel Template",
                                                            "operator": "GET",
                                                            "status": "SUCCEEDED"
                                                        }, {
                                                            "type": "MS Powerpoint Template",
                                                            "operator": "GET",
                                                            "status": "SUCCEEDED"
                                                        }, {
                                                            "type": "Office Document",
                                                            "operator": "GET",
                                                            "status": "SUCCEEDED"
                                                        }, {
                                                            "type": "Compound Document",
                                                            "operator": "GET",
                                                            "status": "SUCCEEDED"
                                                        }, {
                                                            "type": "MS Outlook Template",
                                                            "operator": "GET",
                                                            "status": "SUCCEEDED"
                                                        }
                                                    ]
                                                };

                                                this.onComplete(payload);

                                            } else {

                                                console.log('associaterevisionsequences: onFailure:' + e);
                                            }
                                        },
                                        onComplete: function (payload) {
                                            console.log('associaterevisionsequences: onComplete:');

                                            for (var g = 0; g < childrenTypes.length; g++) {

                                                if (payload.logics[g].name != undefined) {
                                                    listOfSequences[indexOfSequence[g]] = payload.logics[g].name;

                                                    let indTitle = arrayERS_set.findIndex(function (element) {
                                                        return element == payload.logics[g].name;
                                                    });

                                                    listOfSequencesTitle[indexOfSequence[g]] = arrayERS_Title_set[indTitle];
                                                } else {
                                                    listOfSequences[indexOfSequence[g]] = VersionNamingNLS.SetLogic
                                                        listOfSequencesTitle[indexOfSequence[g]] = VersionNamingNLS.SetLogic
                                                }
                                            }

                                            model.loadModel(model, cellInfos.nodeModel);

                                            loader.off();
                                            WUXModalContainer.removeModal(parentContainer);
                                            parentContainer.style.position = "";

                                            AlertUtility.message('success', succMsg);

                                            if (ODT_MODE != undefined && ODT_MODE == "ODT_MODE") {
                                                console.log('ODT for logic terminated successfuly');
                                            }

                                        }
                                    });

                                }
                            });

                        }
                    }
                }
            ];

            myDGV = new WUXDataGridView({
                identifier: "DataGridViewTest",
                placeholder: VersionNamingNLS.PlaceHolder,
                treeDocument: model,
                height: 500,
                columns: columns,
                defaultColumnDef: {
                    minWidth: 50,
                    editableFlag: true
                }
            });

            myDGV.registerReusableCellContent({
                id: 'myReusableId',
                buildContent: function () {
                    return new UWA.Element('div', {
                        styles: {
                            color: 'rgba(255, 255, 255, 0)', // transparent text color
                            width: 1000,
                            height: 20
                        }
                    });
                }
            });

            // Build the status bar with two status.

            myDGV.buildStatusBar([{
                        type: CollectionViewStatusBar.STATUS.NB_ITEMS
                    }, {
                        type: CollectionViewStatusBar.STATUS.CUSTOM,
                        position: "center",
                        id: "progressId",
                        dataElements: {
                            typeRepresentation: "progress",
                            value: 0,
                            tooltip: "loading in progress"
                        }

                    }, {
                        type: CollectionViewStatusBar.STATUS.NB_SELECTED_CELLS,
                        position: "far"
                    }
                ]);

            progressStatusNode = myDGV.elements.statusBar.getNodeModelByID("progressId");

            // ----------------


            var d = UWA.createElement('div', {
                html: VersionNamingNLS.VersionNamingLogTypeHeader
            }).inject(contentDiv);
            d.style.marginBottom = "10px";

            var imgInfoSpan = UWA.createElement('span', {
                'class': 'fonticon fonticon-info'
            }).inject(d);
            imgInfoSpan.setStyle("color", "black");
            imgInfoSpan.setStyle("padding-left", "5px");

            var popover = new Popover({
                target: imgInfoSpan,
                trigger: "hover",
                animate: "true",
                position: 'left',
                body: VersionNamingNLS.VersionNamingLogTypeTooltip,
                title: ''
            });

            //------------------
            myDGV.inject(contentDiv);

        },

        // ---------------------------------------------------------------------------------------

        parseFileContent(content, onOk, onFailure) {
            var json = {};
            try {
                json = JSON.parse(content);
            } catch (e) {
                onFailure(VersionNamingNLS.FailedToParse, e);
                return;
            }

            if (!json) {
                onFailure(VersionNamingNLS.FailedToRead);
                return;
            }

            var error = "";
            if (!!error)
                onFailure(error);
            else {
                onOk(json);
            }
        },

        concatSequences(seqs) {
            var strres = "[";
            var firstone = true;
            seqs.forEach((seq) => {
                if (!firstone)
                    strres += ",";
                firstone = false;
                strres += JSON.stringify(seq);
            });
            strres += "]";
            return strres;
        },

        createHeader: function (parentElement) {
            var d = UWA.createElement('div', {
                html: VersionNamingNLS.VersionNamingLogHeader
            }).inject(parentElement);
            d.style.marginBottom = "10px";

            var imgInfoSpan = UWA.createElement('span', {
                'class': 'fonticon fonticon-info'
            }).inject(d);
            imgInfoSpan.setStyle("color", "black");
            imgInfoSpan.setStyle("padding-left", "5px");

            var popover = new Popover({
                target: imgInfoSpan,
                trigger: "hover",
                animate: "true",
                position: 'left',
                body: VersionNamingNLS.VersionNamingLogTypeTooltip,
                title: ''
            });
        },

        onCompleteRequestMapping: function () {
            Mask.unmask(this.contentDiv);
        },

        destroy: function () {
            this.stopListening();
            this._parent.apply(this, arguments);
        },

    });
    return extendedView;
});


define('DS/ParameterizationSkeleton/Views/ParameterizationXCAD/XCADViewUtilities',
[
 'UWA/Core',
 'UWA/Controls/Accordion',
 'DS/UIKIT/Accordion',
 'DS/UIKIT/Input/Button',
 'DS/UIKIT/Input/Select',
 'DS/UIKIT/Input/Toggle',
 'DS/UIKIT/Input/Text',
 'DS/UIKIT/Modal',
 'DS/UIKIT/Alert',
 'DS/UIKIT/Popover',
 'DS/UIKIT/Tooltip',
 'DS/UIKIT/Spinner',
 'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
 'i18n!DS/ParameterizationSkeleton/assets/nls/XCADMappingNLS',
 'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS',
 'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
 'DS/ParameterizationSkeleton/Utils/ParameterizationXCAD/xNotification',
 'DS/WAFData/WAFData',
 'DS/UIKIT/Mask'
 ],
 function (UWA,
           UWAccordion, Accordion,
           Button, Select, Toggle, Text,
           Modal,
           Alert, Popover,Tooltip, Spinner, ParametersLayoutViewUtilities,
           XCADMappingNLS,
           ParamSkeletonNLS,
          URLHandler, xNotification, WAFData,Mask) {

'use strict';

var UIview = {

  init : function () {
    this.cellsAttrIndex = [];
    this.cellsIndex = [];


  },

  initVariable : function () {
    this.cellsIndex = {
        "Connector" : 0,
        "VPMObject" : 1,
        "CADType" : 2,
        "action" : 3,
        "deployFlag" : 4,
        "Indexed" : 5,
    };
    this.cellsAttrIndex = {
        "VPMAttr" : 0,
        "side" : 1,
        "CADAttr" : 2,
        "action" : 3,
        "deployFlag" : 4,
    };

    this.direction =  {
        "BOTH" : "<=>",
        "VPM_To_CAD" : "=>",
        "CAD_To_VPM" : "<=",
    };

  },

  createApplyResetToolbar : function (insertdivID, activateApplyBtn, applyParams, confirmationModalShow) {
    var applyDiv, tableButtons, lineButtons, buttonApplyCell, applyBttn,
    buttonResetCell, resetBbttn;
    //that = this;
    //resetwidth = '100%';
    
    applyDiv =  UWA.createElement('div', {
      'id': 'ApplyResetXCADDiv'
    }).inject(insertdivID);
    //                            
    tableButtons = UWA.createElement('table', {
      'class' : '',
      'id' : '',
      'width' : '100%'
    }).inject(applyDiv);
    
    lineButtons = UWA.createElement('tr').inject(tableButtons);//tbody
    
    if (activateApplyBtn === true) {
      buttonApplyCell = UWA.createElement('td', {
        'width' : '50%',
        'Align' : 'center'
      }).inject(lineButtons);
      
                    applyBttn =  new Button({
                      className: 'primary',
                      id : 'buttonExport',
                      icon : 'export',//'download'//value: 'Button',          
                      attributes: {
                        disabled: false,
                        title: XCADMappingNLS.ApplyMappingtooltip,
                        text : ParamSkeletonNLS.Apply
                      },
                      events: {
                        onClick: function () {
                          applyParams();
                        }
                      }
                    }).inject(buttonApplyCell);
      applyBttn.getContent().setStyle("width", 110);
    }
    
    buttonResetCell = UWA.createElement('td', {
      'width' : '50%',
      'Align' : 'center'//center
    }).inject(lineButtons);
    
    resetBbttn = new Button({
      className: 'warning',
      icon: 'loop',
      attributes: {
        disabled: false,
        title: ParamSkeletonNLS.ResetOnServertooltip,
        text : ParamSkeletonNLS.Reset
      },
      events: {
        onClick: function () {
          //that.resetParamsinSession();//testPreviewBlock();                               
          confirmationModalShow();
        }
      }
    }).inject(buttonResetCell);
    
    resetBbttn.getContent().setStyle("width", 110);
    return applyDiv;
  },
  

  buildAttributeLine : function (attributeList, attributeMapping,widthTable) {
    var iCell, removeAttributeButton, deleteSpan, removePop,position;
    var that = this;

    var actionButton = [];
    var lineAttr = UWA.createElement('tr', {'class': 'AttrLineXCADMapping'});

    // VPM info
    var itfVPM= attributeMapping.Extension;
    var attrVPM=attributeMapping.Name;
    var attrVPMName = attributeMapping.Name;

    if (!attributeMapping.nlsName) {
      if (attrVPM == "V_Name") attrVPMName = "Title"
      else if (attrVPM == "V_description") attrVPMName = "Description";
    } else {
      attrVPMName = attributeMapping.nlsName;
    }


    var side=attributeMapping.Sync;

    // CAD Info
    var attrCAD=attributeMapping.cadName;
    var attrCADName=attributeMapping.cadName;
    var status=attributeMapping.status;
    var isDefault = attributeMapping["default"];

    UIview.initVariable();

    iCell = UWA.createElement('td', {
      'Align'  : 'left',
      'width'  : widthTable[0],
      'value'  : attrVPM,
      'class': 'attributeXCADMappingField font-3dslight'// font-3dsbold
    }).inject(lineAttr);

    UWA.createElement('p', {
      text   : attrVPMName,
      value  : attrVPM,
    }).inject(iCell);

    var txtSide = XCADMappingNLS.both;
    var valueSide = "<=>";
    if(side==0) {
      valueSide = "<=>";
      txtSide = XCADMappingNLS.both;
    } else if (side<0) {
      valueSide = "=>";
      txtSide =XCADMappingNLS.unilateralDirection.format("Physical Product","CAD");
    } else if (side>0) {
      valueSide = "<=";
      txtSide =XCADMappingNLS.unilateralDirection.format("CAD","Physical Product");
    }
 
    iCell = UWA.createElement('td', {
      'Align' : 'left',
      'width' :widthTable[1],
      'title' : txtSide,
      'value' : valueSide,
      'class': 'attributeXCADMappingField font-3dslight'// font-3dsbold
    }).inject(lineAttr);

   var imgSpanRight = UWA.createElement('span', {
      'class' : 'fonticon fonticon-expand-right'
    })
    
    var imgSpanLeft = UWA.createElement('span', {
      'class' : 'fonticon fonticon-expand-left'
    })
    
    if(side==0) {
      imgSpanLeft.inject(iCell);
      imgSpanRight.inject(iCell);		
    } else if (side<0) {
      imgSpanRight.inject(iCell);
    } else if (side>0) {
      imgSpanLeft.inject(iCell);
    }

    iCell.setStyle("vertical-align", "text-bottom");
 
 
    iCell = UWA.createElement('td', {
      'Align'  : 'left',
      'width'  : widthTable[2],
      'value'  : attrCAD,
      'class': 'attributeXCADMappingField font-3dslight'// font-3dsbold
    }).inject(lineAttr);

    UWA.createElement('p', {
      text   : attrCADName,
      value  : attrCAD,
    }).inject(iCell);


    iCell = UWA.createElement('td', {
      'Align' : 'left',
      'width' : widthTable[3],
      'class': 'attributeXCADMappingField font-3dslight'// font-3dsbold
    }).inject(lineAttr);

    if(!isDefault)
    {
      actionButton = UIview.createDeleteModifyActionsIcon(iCell);


      actionButton.addEvent("onClick", function (e) {
        UIview.removeAttrLineCallBack(lineAttr,attributeMapping, attributeList);

      });
    }

    var isDeployed ;
    if(status==="New") isDeployed ="NewNotDeployed";
    else
    isDeployed = (status==="Deployed")? 'true':'false';


    var invalidStoredMapping = false;
    var messageInvalidStoredMapping = "";

    if (isDeployed === "false")
    {
      if(attributeMapping.VPMAttributeNotDeployed)
      {
        invalidStoredMapping = true;
        messageInvalidStoredMapping = XCADMappingNLS.NonDeployedAttribute;
      }

    }

    var imgSpan,
    imgTitle = XCADMappingNLS.deployedParamtxt,
    imgClass = 'fonticon fonticon-' + '1.5' + 'x fonticon-check',
    iconColor = 'green',
    iconSize = '1.5';

    if (isDeployed === "false") {
      imgClass = 'fonticon fonticon-' + iconSize + 'x fonticon-cog';
      if(!invalidStoredMapping)
      {
        imgTitle =  XCADMappingNLS.notdeployedParamtxt;
        iconColor = 'orange';
      }
      else
      {
        imgTitle = messageInvalidStoredMapping;
        iconColor = 'red';
        attributeMapping.status = "InvalidStored";
      }
    } else if (isDeployed === "NewNotDeployed") {
      imgClass = 'fonticon fonticon-' + iconSize + 'x fonticon-cog';
      imgTitle =  XCADMappingNLS.newNotdeployedParam;
      iconColor = 'black';
    }

    iCell = UWA.createElement('td', {
      'width' : widthTable[4],
      'align' : 'center',
      'title' : imgTitle
    });

    imgSpan = UWA.createElement('span', {
      'class' : imgClass
    }).inject(iCell);

    imgSpan.setStyle("color", iconColor);
    iCell.setStyle("vertical-align", "text-bottom");

    iCell.value = status;
    iCell.inject(lineAttr);

    if(status==="RemovedbyImport")
      UIview.setToRemoveAttrLine(lineAttr);

    if(status==="Removed")
      UIview.setToRemoveAttrLine(lineAttr);

    return lineAttr;
  },


  buildAttributeTableHeading : function (widthTable) {
    var lineTitle,iCell;

    lineTitle = UWA.createElement('tr', {
      'class' : 'success'
    });

    iCell = UWA.createElement('td', {
      'Align' : 'left',
      'width' : widthTable[0],
    }).inject(lineTitle);

    UWA.createElement('h5', {
      text   : XCADMappingNLS.ProductAttr
        //'class': 'font-3dslight'// font-3dsbold
    }).inject(iCell);


    iCell = UWA.createElement('td', {
      'Align' : 'left',
      'width' : widthTable[1],
    }).inject(lineTitle);

    UWA.createElement('h5', {
      text   : XCADMappingNLS.side
    }).inject(iCell);

    iCell = UWA.createElement('td', {
      'Align' : 'left',
      'width' : widthTable[2],
    }).inject(lineTitle);

    UWA.createElement('h5', {
      text   : XCADMappingNLS.CADAttr
    }).inject(iCell);

    iCell = UWA.createElement('td', {
      'Align' : 'left',
      'width' : widthTable[3],
    }).inject(lineTitle);

    UWA.createElement('h5', {
      text   : XCADMappingNLS.actions
        //'class': 'font-3dslight'// font-3dsbold
    }).inject(iCell);

    iCell = UWA.createElement('td', {
      'Align' : 'left',
      'width' : widthTable[4],
    }).inject(lineTitle);

    UWA.createElement('h5', {
      text   : XCADMappingNLS.deployStatus
        //'class': 'font-3dslight'// font-3dsbold
    }).inject(iCell);

    return lineTitle;
  },


  buildMappingLine : function (eltmapping)
  {
    var that=this;

    var CADType,VPMType, CADTypeName, VPMTypeName, ParentVPMType, DisplayCADType;
    var side,status ,mappingTable,lineMapping,txtSide,iCell,deleteIcon,deleteAction,deleteSpan;
    var removeLineMappingButton,removePropMappingButton,attributeMappingDiv;
    var attributesTable,mappingTable,actionCol,modifySpan,modifyAttributeButton,modifyPop,modifySpan;
    UIview.initVariable();

    CADType = eltmapping.cadType;
    VPMType = eltmapping.Type;
	DisplayCADType = eltmapping.cadTypeName;
    if(eltmapping.hasOwnProperty('ParentType'))
    	ParentVPMType = eltmapping.ParentType;
    CADTypeName = XCADMappingNLS[eltmapping.cadType] ?  XCADMappingNLS[eltmapping.cadType]: eltmapping.cadType;
    VPMTypeName = eltmapping.VPMObjectName;

    // Filtre sur les VPMReference .. 
    if ((VPMType != 'VPMReference') && (VPMType != 'XCADModelRepReference') && (VPMType != 'Drawing') && (VPMType != 'XCADNonPSBaseRepReference') && (ParentVPMType != 'VPMReference'  && VPMType.startsWith('Aec')) )return undefined;

    // Filtre solid works .. pas de virtual
    if (CADType == 'virtualComponentInstance')  return undefined;
    if (CADType == 'virtualAssemblyInstance')  return undefined;

    side  = "BOTH";
    txtSide="<=>";
    
    status = eltmapping.status;
    mappingTable = UWA.createElement('table', {
      'class': 'tableXCADMapping'
    });//table-bordered

    lineMapping = UWA.createElement('tr', {
      'class' : 'lineXCADMapping'
    }).inject(mappingTable);

    UWA.createElement('td', {'class': 'colXCADMappingType', 'text': "", 'value':""}).inject(lineMapping);

    UWA.createElement('td', {'class': 'colXCADMappingVPMObject', 'text':VPMTypeName, 'value':VPMType}).inject(lineMapping);

    side = UWA.createElement('td', {'class': 'colXCADMappingSide', 'text':txtSide, 'value':side}).inject(lineMapping);

    UWA.createElement('td', {'class': 'colXCADMappingCADType', 'text':DisplayCADType, 'value':CADType}).inject(lineMapping);


    // Edition du mapping de type .. plus tard !
    // livr� desactiv�
    if (false)
    {
      actionCol = UWA.createElement('td', {'class': 'colXCADMappingDeleteAction'}).inject(lineMapping);

      deleteAction = ParametersLayoutViewUtilities.createDeleteActionElements("delete line mapping");
      deleteSpan = deleteAction[0];
      removeLineMappingButton = deleteAction[1];
      removePropMappingButton = deleteAction[2];
      deleteSpan.inject(actionCol);


      modifySpan = UWA.createElement('span');

      modifyAttributeButton = new Button({
        className: 'close',
        icon: 'fonticon fonticon-pencil fonticon-1.5x',//value: 'Button', //fonticon-cancel  fonticon-minus-circled
        attributes: {
          disabled: false,
          'aria-hidden' : 'true'
        }
      }).inject(modifySpan);

      modifyPop = new Popover({
        //class: 'parampopover',
        target: modifySpan,//iCell,
        trigger : "hover",
        animate: "true",
        position: "top",
        body: "modify direction",
        title: ''//iParamObj.nlsKey
      });

      modifySpan.inject(actionCol);

      removeLineMappingButton.addEvent("onClick", function (e) {
        UIview.removeTypeMappingLineCallBack.call(this,lineMapping,eltmapping);
      }.bind(that));

    }

    var isDeployed = 'true'; // (status==="deployed")? 'true':'false';

    iCell = UWA.createElement('td', {'class': 'colXCADMappingType', 'text': "", 'value':"deployed"}).inject(lineMapping);

    return mappingTable;

  },



  buildAttributeTable : function (listofAttributesMapping,widthTable) {
    var attributesTable, attrtbody, iCell,lineTitle, lineAttribute,j;


    attributesTable = UWA.createElement('table', {
      'class': 'attrTableXCADMapping table table-condensed'
    });//table-bordered

    attrtbody =  UWA.createElement('tbody', {
      'class': 'attrstbodyXCADMapping'
    }).inject(attributesTable);


    lineTitle = UIview.buildAttributeTableHeading(widthTable);
    lineTitle.inject(attrtbody);

    for (j = 0; j < listofAttributesMapping.length; j++) {
      lineAttribute = UIview.buildAttributeLine.call(this, listofAttributesMapping, listofAttributesMapping[j],widthTable);
      lineAttribute.inject(attrtbody);
    }

    return attributesTable;
  },

  retrieveMappingEntry : function (vpmtype, cadtype,collectionMapping) {
    var EltMapping, foundElt=false, cpt=0;

    while (!foundElt && cpt <collectionMapping.length)
    {
      EltMapping = collectionMapping[cpt];
      if(EltMapping!=undefined)
      {
        if(vpmtype ===EltMapping.Type &&  cadtype === EltMapping.cadType)
          foundElt=true;
        else cpt++
      }

    }
    if (!foundElt) return undefined;
    else return EltMapping;
  },

  retrieveMappingAttrEntry : function (itfVPM, VPMAttr,cadAttr,attributeMappingList) {
    var EltAttrMapping, foundElt=false, cpt=0, VPMAttrName=VPMAttr, cadAttrName=cadAttr;

    while (!foundElt && cpt <attributeMappingList.length)
    {
      EltAttrMapping = attributeMappingList[cpt];
      if(EltAttrMapping!=undefined)
      {
        if( itfVPM === EltAttrMapping.Extension && VPMAttrName ===EltAttrMapping.Name &&  cadAttrName === EltAttrMapping.cadName)
          foundElt=true; 
        else if( itfVPM === undefined && VPMAttrName ===EltAttrMapping.Name &&  cadAttrName === EltAttrMapping.cadName)
          foundElt=true; 
        else cpt++
      }

    }
    if (!foundElt) return undefined;
    else return EltAttrMapping;
  },

  //Change mapping in Deployed  state to remove State
  setToRemoveAttrLine : function (attrLine) {
    var deployAttrcell,imgAttrSpan,i,arrayAction;

    deployAttrcell=attrLine.cells[UIview.cellsAttrIndex.deployFlag];
    
    UIview.setDeletedCellStyle(attrLine.cells[UIview.cellsAttrIndex.VPMAttr]);
    UIview.setDeletedCellStyle(attrLine.cells[UIview.cellsAttrIndex.CADAttr]);
    
    var iconsSide = attrLine.cells[UIview.cellsAttrIndex.side].getElements('span');
    iconsSide.forEach(function(icon){
      icon.setStyle("color", "grey");
    });

    arrayAction = attrLine.cells[UIview.cellsAttrIndex.action].getElements('span');
    arrayAction.forEach(function(action){
      action.hide();
    });

    if(deployAttrcell.value === "Stored" || deployAttrcell.value === "InvalidStored")
    {
      imgAttrSpan = ParametersLayoutViewUtilities.buildImgSpan('trash', '1.5', 'orange');
      deployAttrcell.title = XCADMappingNLS.DeletedStoredNotApplied;
    }
    else
    {
      imgAttrSpan = ParametersLayoutViewUtilities.buildImgSpan('trash', '1.5', 'red');
      deployAttrcell.title = XCADMappingNLS.DeletedNotApplied;
    }

    deployAttrcell.empty();
    deployAttrcell.value = "Removed";

    imgAttrSpan.inject(deployAttrcell);

    //}
  },


  removeAttrLineCallBack : function (attrLine,attributeMapping,listofAttributesMapping) {
    var /*lineAttrMapping = UWA.Event.findElement(e, '.AttrLineMapping'),*/deployAttrcell;
    if(attrLine!="undefined")
    {
      deployAttrcell=attrLine.cells[UIview.cellsAttrIndex.deployFlag];
      //If mapping in New state, delete the line
      if(deployAttrcell.value==="New")
        attrLine.remove();
      else
        //If mapping in deployed state, change the state and the UI to removed
        UIview.setToRemoveAttrLine(attrLine);
    }
    //Update mapping model
    UIview.removeMappingAttr(attributeMapping,listofAttributesMapping);
    //removePop.destroy();
  },


  createDeleteModifyActionsIcon: function(actionCell)
  {
    var deleteSpan, deleteButton, deletePop, modifySpan, modifyButton, modifyPop  ;

    deleteSpan = UWA.createElement('span');
    deleteButton = new Button({
      className: 'close',
      icon: 'fonticon fonticon-trash fonticon-1.5x',//value: 'Button', //fonticon-cancel  fonticon-minus-circled
      attributes: {
        disabled: false,
        'aria-hidden' : 'true'
      }
    }).inject(deleteSpan);
    deletePop = new Popover({
      //class: 'parampopover',
      target: deleteSpan,//iCell,
      trigger : "hover",
      animate: "true",
      position: "top",
      body: XCADMappingNLS.deleteAttrMapping,
      title: ''//iParamObj.nlsKey
    });
    deleteSpan.inject(actionCell);

    return deleteButton;
  },

  removeMappingAttr : function (eltAttrMapping, listOfAttributeMapping) {
    var index;
    if(eltAttrMapping.status==="New" )
    {
      //listOfAttributeMapping.remove(eltAttrMapping);
      index = listOfAttributeMapping.indexOf(eltAttrMapping);
      if(index!=-1)
        listOfAttributeMapping.splice(index,1);
    }
    else if(eltAttrMapping.status==="Stored" || eltAttrMapping.status==="InvalidStored")
      eltAttrMapping.status="RemovedStored";
    else
      eltAttrMapping.status="RemovedDeployed";
  },

  CheckRulesToAddAttrMapping: function(VPMTypeRelInfo,VPMAttrInfo,MxTypeRelInfo,MxAttrInfo, parentSide,VPMObjMappedAttr, MXObjMappedAttr,messageSuffix)
  {

    var VPMArrayVPMToMx=new Array(),VPMArrayMxToVPM=new Array(),VPMArrayBoth=new Array(),MXArrayVPMToMx=new Array(),MXArrayMxToVPM=new Array(),MXArrayBoth=new Array(),result,resultRule1,resultRule2,resultRule3,resultRule4,resultRule5,resultRule6,VPMAttrInfo, MxAttrInfo,VPMAttrRange="",MxAttrRange="";
    result={VPM_To_CAD:true,CAD_To_VPM:true,BOTH:true,message:{VPM_To_CAD:new Array(), CAD_To_VPM:new Array(),BOTH:new Array()}};

    if(VPMObjMappedAttr!=undefined)
    {
      VPMArrayVPMToMx=VPMObjMappedAttr.get("VPM_To_CAD");
      VPMArrayMxToVPM = VPMObjMappedAttr.get("CAD_To_VPM");
      VPMArrayBoth = VPMObjMappedAttr.get("BOTH");
    }
    if(MXObjMappedAttr!=undefined)
    {
      MXArrayVPMToMx=MXObjMappedAttr.get("VPM_To_CAD");
      MXArrayMxToVPM = MXObjMappedAttr.get("CAD_To_VPM");
      MXArrayBoth = MXObjMappedAttr.get("BOTH");
    }

    resultRule1 = UIview.CheckIsNotAlreadyMapped(MXArrayVPMToMx,MXArrayMxToVPM,MXArrayBoth);

    //VPMAttrInfo = UIview.retrieveAttributeInfo(VPMTypeRelInfo,VPMAttr);
    if(VPMAttrInfo!=undefined) VPMAttrRange = VPMAttrInfo.range;
    //MxAttrInfo = UIview.retrieveAttributeInfo(MxTypeRelInfo,MxAttr);
    if(MxAttrInfo!=undefined) MxAttrRange = MxAttrInfo.range;

    resultRule5 =  UIview.CheckIsSameAttrRange(VPMAttrRange,MxAttrRange);

    resultRule6 = UIview.CheckIsAuthorizedAsTarget(MxAttrInfo.itf,MxAttrInfo.id,VPMAttrInfo.itf,VPMAttrInfo.id);

    result.VPM_To_CAD = resultRule1.VPM_To_CAD/* && resultRule2.VPM_To_CAD && resultRule3.VPM_To_CAD && resultRule4.VPM_To_CAD */&& resultRule5.VPM_To_CAD && resultRule6.VPM_To_CAD;
    result.CAD_To_VPM = resultRule1.CAD_To_VPM /*&& resultRule2.CAD_To_VPM && resultRule3.CAD_To_VPM && resultRule4.CAD_To_VPM */&& resultRule5.CAD_To_VPM && resultRule6.CAD_To_VPM;
    result.BOTH = resultRule1.BOTH /*&& resultRule2.BOTH && resultRule3.BOTH && resultRule4.BOTH*/ && resultRule5.BOTH && resultRule6.BOTH;

    Array.prototype.push.apply(result.message.BOTH, resultRule1.message.BOTH);/*Array.prototype.push.apply(result.message.BOTH, resultRule2.message.BOTH);Array.prototype.push.apply(result.message.BOTH, resultRule3.message.BOTH);Array.prototype.push.apply(result.message.BOTH, resultRule4.message.BOTH);*/Array.prototype.push.apply(result.message.BOTH, resultRule5.message.BOTH);Array.prototype.push.apply(result.message.BOTH, resultRule6.message.BOTH);
    Array.prototype.push.apply(result.message.VPM_To_CAD, resultRule1.message.VPM_To_CAD); /*Array.prototype.push.apply(result.message.VPM_To_CAD, resultRule2.message.VPM_To_CAD);Array.prototype.push.apply(result.message.VPM_To_CAD, resultRule3.message.VPM_To_CAD);Array.prototype.push.apply(result.message.VPM_To_CAD, resultRule4.message.VPM_To_CAD);*/Array.prototype.push.apply(result.message.VPM_To_CAD, resultRule5.message.VPM_To_CAD);Array.prototype.push.apply(result.message.VPM_To_CAD, resultRule6.message.VPM_To_CAD);
    Array.prototype.push.apply(result.message.CAD_To_VPM, resultRule1.message.CAD_To_VPM);/*Array.prototype.push.apply(result.message.CAD_To_VPM, resultRule2.message.CAD_To_VPM);Array.prototype.push.apply(result.message.CAD_To_VPM, resultRule3.message.CAD_To_VPM);Array.prototype.push.apply(result.message.CAD_To_VPM, resultRule4.message.CAD_To_VPM);*/Array.prototype.push.apply(result.message.CAD_To_VPM, resultRule5.message.CAD_To_VPM);Array.prototype.push.apply(result.message.CAD_To_VPM, resultRule6.message.CAD_To_VPM);

    return result;
  },

  CheckIsNotAlreadyMapped : function (MXArrayVPMToMx,MXArrayMxToVPM,MXArrayBoth) {

    var result={VPM_To_CAD:true,CAD_To_VPM:true,BOTH:true,message:{VPM_To_CAD:new Array(), CAD_To_VPM:new Array(),BOTH:new Array()}},message="";

    if(MXArrayVPMToMx.length!==0 || MXArrayMxToVPM.length!==0 || MXArrayBoth.length!==0)
    {
      message=XCADMappingNLS.ErrorMatrixAlreadyMapped;
      result.BOTH=false;result.VPM_To_CAD=false;result.CAD_To_VPM=false;
      result.message.BOTH.push(message);result.message.VPM_To_CAD.push(message);result.message.CAD_To_VPM.push(message);
    }
    return result;
  },

  CheckCoherenceWithParentSide : function (parentSide) {

    var result={VPM_To_CAD:true,CAD_To_VPM:true,BOTH:true,message:{VPM_To_CAD:new Array(), CAD_To_VPM:new Array(),BOTH:new Array()}},message="";

    if(parentSide=="VPM_To_CAD")
    {
      message=XCADMappingNLS.ErrorParentSideVPMCAD;
      result.BOTH=false;result.CAD_To_VPM=false;
      result.message.BOTH.push(message);result.message.CAD_To_VPM.push(message);
    }
    else if(parentSide=="CAD_To_VPM")
    {
      message=XCADMappingNLS.ErrorParentSideCADVPM;
      result.BOTH=false;result.VPM_To_CAD=false;
      result.message.BOTH.push(message);result.message.VPM_To_CAD.push(message);
    }
    return result;
  },

  CheckCoherence : function ( VPMArrayVPMToMx,VPMArrayMxToVPM,VPMArrayBoth,MXArrayVPMToMx,MXArrayMxToVPM,MXArrayBoth) {

    var result={VPM_To_CAD:true,CAD_To_VPM:true,BOTH:true,message:{VPM_To_CAD:new Array(), CAD_To_VPM:new Array(),BOTH:new Array()}}, message="";

    if(VPMArrayMxToVPM.length!==0 || MXArrayMxToVPM.length!==0) {
      result.VPM_To_CAD=false;
      message="";
      if(VPMArrayMxToVPM.length!==0)
      {
        message = message +  XCADMappingNLS.ErrorVPMAlreadyUsedAsTargetWithAnotherObject;
        message += UIview.buildAddMappingWarningMessage(VPMArrayMxToVPM,"<=");
      }

      if (MXArrayMxToVPM.length!==0)
      {
        message = message +  XCADMappingNLS.ErrorMatrixAlreadyUsedAsSourceWithAnotherObject;
        message += UIview.buildAddMappingWarningMessage(MXArrayMxToVPM,"<=");
      }

      //message += ". VPM to CAD direction is not possible.";
      //result.message.push(message);
      result.message.VPM_To_CAD.push(message);
    }
    if(VPMArrayVPMToMx.length!==0 || MXArrayVPMToMx.length!==0)
    {
      result.CAD_To_VPM=false;
      message="";
      if(VPMArrayVPMToMx.length!==0)
      {
        message = message + XCADMappingNLS.ErrorVPMAlreadyUsedAsSourceWithAnotherObject;
        message += UIview.buildAddMappingWarningMessage(VPMArrayVPMToMx,"=>");
      }
      if (MXArrayVPMToMx.length!==0)
      {
        message = message +  XCADMappingNLS.ErrorMatrixAlreadyUsedAsTargetWithAnotherObject;
        message += UIview.buildAddMappingWarningMessage(MXArrayVPMToMx,"=>");
      }
      //message += ". CAD to VPM direction is not possible.";
      //result.message.push(message);
      result.message.CAD_To_VPM.push(message);
    }

    return result;
  },


  buildAddMappingWarningMessage : function (mappingArray, direction ) {
    var messageArray = new Array(), mappingMessage = "",  mapping;

    mappingArray.forEach(function(param)
        {
      mapping = param.mapping.element;
      mappingMessage =  mapping.VPMObject + direction + mapping.MatrixObject;
      if(messageArray.indexOf(mappingMessage) === -1)
      {
        messageArray.push(mappingMessage);
      }

        });

    return messageArray.join();
  },

  displayAddMappingWarningMessage : function (messageDiv,popoverInfoMapping ,messages ) {
    var messageList,iconInfo,cpt=0;
    if(messageDiv!=undefined)
    {
      iconInfo = messageDiv.getElement(".InfoAddXCADMapping");
      if(messages.length !==0)
      {
        iconInfo.show();
        messageList =UWA.createElement('ul', {'class' : 'ListAddXCADMappingMessage'});

        for(cpt=0;cpt<messages.length;cpt++)
        {
          UWA.createElement('li', {
            'text':messages[cpt],
          }).inject(messageList);
        }


        popoverInfoMapping.setBody(messageList);
      }
      else
        iconInfo.hide();
    }
  },

  hideAddMappingWarningMessage : function (messageDiv) {
    var iconInfo;
    iconInfo = messageDiv.getElement(".InfoAddXCADMapping");
    if(iconInfo != undefined)
      iconInfo.hide();
  },


  groupAttributeItf : function (listOfAttributeInfo) {
    var mapAttributeInfo = new Map(),i, attributeInfo, mapvalue,mapKey="Default";

    for (i=0; i<listOfAttributeInfo.length;i++)
    {
      attributeInfo = listOfAttributeInfo[i];
      if(attributeInfo.itf!==undefined && attributeInfo.itf!=="") mapKey = "Custo";
      else mapKey="Default";

      mapvalue = mapAttributeInfo.get(mapKey);
      if(mapvalue === undefined)
      {
        mapvalue = new Array();
        mapAttributeInfo.set(mapKey,mapvalue );
      }
      mapvalue.push(attributeInfo);
    }
    return mapAttributeInfo;
  },


  ShowModifyDirectionPanel: function (lineAttr,VPMType,MatrixType,attributeMapping,kindOfMapping) {

    var  iconInfoMessageBOTH,iconInfoMessageVPMCAD,iconInfoMessageCADVPM,divMessageBOTH,
    divMessageVPMCAD, divMessageCADVPM,popoverInfoMappingBOTH,popoverInfoMappingVPMCAD,popoverInfoMappingCADVPM,
    OKBtn, CancelBtn,modalbodydiv, modalbodyTable,modaltbody,lineModal,iCell,iCell1, toggleBoth, toggleVPM, toggleCAD, changeDirectionModal, modifyDirectionTitle ;


    modifyDirectionTitle = UWA.createElement('h4', {
      text   : XCADMappingNLS.ModifyDirectionTitle.format(attributeMapping.VPMAttribute,attributeMapping.MatrixAttribute) ,
    });

    modalbodydiv = UWA.createElement('div', {
      'class': 'CADProductAddXCADMappingDiv',
    })


    modalbodyTable =  UWA.createElement('table', {
      'id': 'CADProductAddXCADMappingTable',
      'class': 'table table-condensed table-hover'
    }).inject(modalbodydiv);


    modaltbody = UWA.createElement('tbody', {
      'class': 'addXCADMappingBody'
    }).inject(modalbodyTable);

    lineModal = UWA.createElement('tr').inject(modaltbody);

    iCell = UWA.createElement('td', {
      'Align' : 'left',
    });

    iCell1 = UWA.createElement('td', {
      'Align' : 'left',
      'width' : '92%'
    }).inject(iCell);

    UWA.createElement('p', {
      text   : XCADMappingNLS.side,
      'class': 'font-3dslight'// font-3dsbold
    }).inject(iCell1);

    iCell.inject(lineModal);

    iCell = UWA.createElement('td', {
      'Align' : 'left',
    }).inject(lineModal);


    toggleBoth =  new Toggle({ name: "optionsRadiosSide", value: "both", className: "primary"}).inject(iCell);
    toggleVPM =  new Toggle({ name: "optionsRadiosSide", value: "VPM to CAD", className: "primary"}).inject(iCell);
    toggleCAD =  new Toggle({ name: "optionsRadiosSide", value: "CAD to VPM", className: "primary"}).inject(iCell);


    var iCell2 = UWA.createElement('td', {
      'Align' : 'left',
    }).inject(lineModal);
    divMessageBOTH = UWA.createElement('div', {'class':'divAddXCADMappingMessage'}).inject(iCell2);
    divMessageVPMCAD = UWA.createElement('div', {'class':'divAddXCADMappingMessage'}).inject(iCell2);
    divMessageCADVPM = UWA.createElement('div', {'class':'divAddXCADMappingMessage'}).inject(iCell2);


    if(attributeMapping.SynchDirection === "BOTH" ) {toggleBoth.hide();divMessageBOTH.hide();}
    if(attributeMapping.SynchDirection === "VPM_To_CAD" ) {toggleVPM.hide();divMessageVPMCAD.hide();}
    if(attributeMapping.SynchDirection === "CAD_To_VPM" ) {toggleCAD.hide();divMessageCADVPM.hide();}



    iconInfoMessageBOTH = UWA.createElement('span', {
      'class' : 'InfoAddMapping fonticon fonticon-info'
    }).inject(divMessageBOTH);
    iconInfoMessageBOTH.hide();
    popoverInfoMappingBOTH = new Popover({
      target   : iconInfoMessageBOTH,
      trigger  : "hover",
      animate  : "true",
      position : 'left',
      body     : "",
      title    : 'BOTH'
    });

    iconInfoMessageVPMCAD = UWA.createElement('span', {
      'class' : 'InfoAddMapping fonticon fonticon-info'
    }).inject(divMessageVPMCAD);
    iconInfoMessageVPMCAD.hide();
    popoverInfoMappingVPMCAD = new Popover({
      target   : iconInfoMessageVPMCAD,
      trigger  : "hover",
      animate  : "true",
      position : 'left',
      body     : "",
      title    : 'VPM to CAD'
    });

    iconInfoMessageCADVPM = UWA.createElement('span', {
      'class' : 'InfoAddMapping fonticon fonticon-info'
    }).inject(divMessageCADVPM);
    iconInfoMessageCADVPM.hide();
    popoverInfoMappingCADVPM = new Popover({
      target   : iconInfoMessageCADVPM,
      trigger  : "hover",
      animate  : "true",
      position : 'left',
      body     : "",
      title    : 'CAD to VPM'
    });

    UWA.createElement('ul', {'class' : 'ListAddXCADMappingMessage'}).inject(divMessageBOTH);
    UWA.createElement('ul', {'class' : 'ListAddXCADMappingMessage'}).inject(divMessageVPMCAD);
    UWA.createElement('ul', {'class' : 'ListAddXCADMappingMessage'}).inject(divMessageCADVPM);


    var listOfVPMTypeRel,listOfMxTypeRel,listOfLinkedMapping,attrMappingMap,listOfMappedMXattr,listOfMappedVPMattr, VPMTypeRelInfo, MatrixTypeRelInfo, directionAvailable,authorizedDirection,
    messagesBOTH,messagesVPMCAD,messagesCADVPM;

    if(kindOfMapping.toUpperCase()==="TYPE")
    {
      listOfVPMTypeRel = this.listOfCustoVPMType;
      listOfMxTypeRel = this.listOfCustoPartType;
    }
    else
    {
      listOfVPMTypeRel = this.listOfCustoVPMRel;
      listOfMxTypeRel= this.listOfCustoEBOMRel;
    }


    VPMTypeRelInfo = listOfVPMTypeRel.get(VPMType);
    MatrixTypeRelInfo = listOfMxTypeRel.get (MatrixType);

    OKBtn = new Button({
      value : "Apply",
      id    : "modalOKButton",
      className : 'btn primary'
    });
    //OKBtn.disable();

    CancelBtn = new Button({
      value : "Cancel",
      id    : 'modalCancelButton',
      className : 'btn default'
    });


    if(VPMTypeRelInfo !== undefined  && MatrixTypeRelInfo !== undefined)
    {
      listOfLinkedMapping = UIview.getListOfLinkedMapping(VPMTypeRelInfo,MatrixTypeRelInfo,kindOfMapping,listOfVPMTypeRel,listOfMxTypeRel,this.listofTypeRelMapping);
      attrMappingMap = UIview.buildAttributesMappedWith(listOfLinkedMapping,attributeMapping);
      listOfMappedMXattr = (attrMappingMap.VPM).get(attributeMapping.VPMAttribute);
      listOfMappedVPMattr = (attrMappingMap.MX).get(attributeMapping.MatrixAttribute);

      directionAvailable = UIview.CheckRulesToAddAttrMapping(VPMTypeRelInfo, attributeMapping.VPMAttribute ,MatrixTypeRelInfo,attributeMapping.MatrixAttribute,kindOfMapping, listOfMappedMXattr, listOfMappedVPMattr);

      if(directionAvailable!==undefined)
      {
        if(!directionAvailable.BOTH) toggleBoth.setDisabled(true);
        if(!directionAvailable.VPM_To_CAD) toggleVPM.setDisabled(true);
        if(!directionAvailable.CAD_To_VPM) toggleCAD.setDisabled(true);

        messagesBOTH = directionAvailable.message.BOTH;
        messagesVPMCAD = directionAvailable.message.VPM_To_CAD;
        messagesCADVPM = directionAvailable.message.CAD_To_VPM;
      }


      if( !toggleBoth.isDisabled() && attributeMapping.SynchDirection !== "BOTH") toggleBoth.check();
      else if(!toggleVPM.isDisabled()&& attributeMapping.SynchDirection !== "VPM_To_CAD") toggleVPM.check();
      else if(!toggleCAD.isDisabled()&& attributeMapping.SynchDirection !== "CAD_To_VPM") toggleCAD.check();

      if(!toggleCAD.isChecked() && !toggleVPM.isChecked() && !toggleBoth.isChecked())
        OKBtn.setDisabled(true);


      UIview.displayAddMappingWarningMessage (divMessageBOTH,popoverInfoMappingBOTH ,messagesBOTH );
      UIview.displayAddMappingWarningMessage (divMessageVPMCAD,popoverInfoMappingVPMCAD ,messagesVPMCAD );
      UIview.displayAddMappingWarningMessage (divMessageCADVPM,popoverInfoMappingCADVPM ,messagesCADVPM );
    }


    changeDirectionModal = new Modal({
      className: 'add-mapping-modal',
      closable: true,
      header  :modifyDirectionTitle,
      body    : modalbodydiv,
      footer  : [ OKBtn, CancelBtn ]
    });

    CancelBtn.addEvent("onClick", function (e) {
      UWA.log(e);//that.onCancelCalled();
      changeDirectionModal.hide();
    });

    OKBtn.addEvent("onClick", function (e) {
      var txtSide,deployAttrcell,imgAttrSpan,directionAttributeCell, direction;

      txtSide;
      if(toggleBoth.isChecked())
      {
        txtSide="BOTH";
        direction = UIview.direction.BOTH;
      }
      else if (toggleVPM.isChecked())
      {
        txtSide="VPM_To_CAD";
        direction = UIview.direction.VPM_To_CAD;
      }
      else if (toggleCAD.isChecked())
      {
        txtSide="CAD_To_VPM";
        direction = UIview.direction.CAD_To_VPM;
      }
      else
      {
        txtSide="BOTH";
        direction = UIview.direction.BOTH;
      }

      attributeMapping.SynchDirection = txtSide;

      directionAttributeCell = lineAttr.cells[UIview.cellsAttrIndex.side];
      directionAttributeCell.value=direction;
      directionAttributeCell.empty();
      UWA.createElement('p', {
        text   : direction,
      }).inject(directionAttributeCell);


      if(attributeMapping.status === "Deployed" || attributeMapping.status === "Stored")
      {

        if(attributeMapping.status === "Stored")
        attributeMapping.status = "ModifiedStored";
        else
          attributeMapping.status = "ModifiedDeployed";

        //lineAttr.cells[UIview.cellsAttrIndex.action].hide();
        var arrayAction = lineAttr.cells[UIview.cellsAttrIndex.action].getElements('span');
        arrayAction.forEach(function(action){
          action.hide();
        });

        deployAttrcell=lineAttr.cells[UIview.cellsAttrIndex.deployFlag];
        deployAttrcell.empty();
        deployAttrcell.value = "Modified";
        deployAttrcell.title = XCADMappingNLS.ModifiedNotApplied;
        imgAttrSpan = ParametersLayoutViewUtilities.buildImgSpan('pencil', '1.5', 'red');
        imgAttrSpan.inject(deployAttrcell);
      }
      changeDirectionModal.hide();


    });


    changeDirectionModal.inject(this.contentDiv);
    changeDirectionModal.show();




},



  BuildAddMappingPanel : function ( title, VPMSelectPlaceHolder, MatrixSelectPlaceHolder, labelVPMtxt, labelMatrixtxt, labelProductToPart, labelPartToProduct, prefixToAdd,cadTypeName,typeofMX,VPMObjectName,VPMSelectExtPlaceHolder,iscusto,isCloudOrPOD,integrationName,parentType, cadType, attrMapping, VPMAttributes) {


    var addMappingTitle, labelVPM, labelMatrix,  iconInfoMessageBOTH,iconInfoMessageVPMCAD,iconInfoMessageCADVPM,divMessageBOTH,
    divMessageVPMCAD, divMessageCADVPM,popoverInfoMappingBOTH,popoverInfoMappingVPMCAD,popoverInfoMappingCADVPM,
    OKBtn, CancelBtn,modalbodydiv, modalbodyTable,modaltbody,lineModal,iCell,iCell1, toggleBoth, toggleVPM, toggleCAD,selectVPM, cadAttr, addMappingModal, selectWinExt, selectWinAttr ;

    const detectionDelay = 250; 
    let typingTimer;

    const VPM_To_CAD = -1;
    const BOTH       = 0;
    const CAD_To_VPM = 1;  

	var that=this;
    addMappingTitle = UWA.createElement('h4', {
      text   : title,
    });

    modalbodydiv = UWA.createElement('div', {
      'class': 'CADProductAddXCADMappingDiv',
    })

    modalbodyTable =  UWA.createElement('table', {
      'id': 'CADProductAddXCADMappingTable',
      'class': 'table table-condensed table-hover'
    }).inject(modalbodydiv);


    modaltbody = UWA.createElement('tbody', {
      'class': 'addXCADMappingBody'
    }).inject(modalbodyTable);

    lineModal = UWA.createElement('tr').inject(modaltbody);

    iCell = UWA.createElement('td', {
      'Align' : 'left',
    });

    iCell1 = UWA.createElement('td', {
      'Align' : 'left',
      'width' : '92%'
    }).inject(iCell);

 	if(typeofMX!=null && cadTypeName === typeofMX || iscusto==true){
		
	labelVPM = UWA.createElement('p', {
			text   : VPMObjectName+" "+XCADMappingNLS.extension ,
			'class': 'font-3dslight'// font-3dsbold
		}).inject(iCell1);

    iCell.inject(lineModal);

    iCell = UWA.createElement('td', {
      'Align' : 'left',
    }).inject(lineModal);

	 selectWinExt= new Select({
		nativeSelect: true,
		placeholder: VPMSelectExtPlaceHolder,
		multiple: false,
	});
    selectWinExt.inject(iCell);
	lineModal = UWA.createElement('tr').inject(modaltbody);

    iCell = UWA.createElement('td', {
      'Align' : 'left',
    });

    iCell1 = UWA.createElement('td', {
      'Align' : 'left',
      'width' : '92%'
    }).inject(iCell);
	
	labelVPM = UWA.createElement('p', {
			text   : labelVPMtxt ,
			'class': 'font-3dslight'// font-3dsbold
		}).inject(iCell1);

    iCell.inject(lineModal);

    iCell = UWA.createElement('td', {
      'Align' : 'left',
    }).inject(lineModal);

	 selectWinAttr= new Select({
		nativeSelect: true,
		placeholder: VPMSelectPlaceHolder,
		multiple: false,
	});
    selectWinAttr.inject(iCell);
	lineModal = UWA.createElement('tr').inject(modaltbody);

    iCell = UWA.createElement('td', {
      'Align' : 'left',
    });

    iCell1 = UWA.createElement('td', {
      'Align' : 'left',
      'width' : '92%'
    }).inject(iCell);

	}else{
    labelVPM = UWA.createElement('p', {
      text   : labelVPMtxt ,
      'class': 'font-3dslight'// font-3dsbold
    }).inject(iCell1);

    iCell.inject(lineModal);


    iCell = UWA.createElement('td', {
      'Align' : 'left',
    }).inject(lineModal);

    selectVPM =  new Select({
      nativeSelect: true,
      placeholder: VPMSelectPlaceHolder,
      multiple: false,
    });
    selectVPM.inject(iCell);

    lineModal = UWA.createElement('tr').inject(modaltbody);

    iCell = UWA.createElement('td', {
      'Align' : 'left',
    });

    iCell1 = UWA.createElement('td', {
      'Align' : 'left',
      'width' : '92%'
    }).inject(iCell);
}
    labelMatrix = UWA.createElement('p', {
      text   : labelMatrixtxt ,
      'class': 'font-3dslight'// font-3dsbold
    }).inject(iCell1);

    iCell.inject(lineModal);


    iCell = UWA.createElement('td', {
      'Align' : 'left',
    }).inject(lineModal);

    cadAttr = new Text({
      placeholder: "...",
      id : 'cadAttrName',
      attributes: {
        value: '',
        multiline: false,
        disabled: false
      }
    });
    cadAttr.inject(iCell);

    lineModal = UWA.createElement('tr').inject(modaltbody);

    iCell = UWA.createElement('td', {
      'Align' : 'left',
    });

    iCell1 = UWA.createElement('td', {
      'Align' : 'left',
      'width' : '92%'
    }).inject(iCell);

    UWA.createElement('p', {
      text   : XCADMappingNLS.side,
      'class': 'font-3dslight'// font-3dsbold
    }).inject(iCell1);

    iCell.inject(lineModal);

    iCell = UWA.createElement('td', {
      'Align' : 'left',
    }).inject(lineModal);

    toggleBoth =  new Toggle({ name: "optionsRadiosSide", value: XCADMappingNLS.both, className: "primary"}).inject(iCell);
    toggleBoth.setCheck(true);
    toggleVPM =  new Toggle({ name: "optionsRadiosSide", value: labelProductToPart, className: "primary"}).inject(iCell);
    toggleCAD =  new Toggle({ name: "optionsRadiosSide", value: labelPartToProduct, className: "primary"}).inject(iCell);

    var iCell2 = UWA.createElement('td', {
      'Align' : 'left',
    }).inject(lineModal);
    divMessageBOTH = UWA.createElement('div', {'class':'divAddXCADMappingMessage'}).inject(iCell2);
    divMessageVPMCAD = UWA.createElement('div', {'class':'divAddXCADMappingMessage'}).inject(iCell2);
    divMessageCADVPM = UWA.createElement('div', {'class':'divAddXCADMappingMessage'}).inject(iCell2);


    iconInfoMessageBOTH = UWA.createElement('span', {
      'class' : 'InfoAddXCADMapping fonticon fonticon-info'
    }).inject(divMessageBOTH);
    iconInfoMessageBOTH.hide();
    popoverInfoMappingBOTH = new Popover({
      target   : iconInfoMessageBOTH,
      trigger  : "hover",
      animate  : "true",
      position : 'left',
      body     : "",
      title    : 'BOTH'
    });

    iconInfoMessageVPMCAD = UWA.createElement('span', {
      'class' : 'InfoAddXCADMapping fonticon fonticon-info'
    }).inject(divMessageVPMCAD);
    iconInfoMessageVPMCAD.hide();
    popoverInfoMappingVPMCAD = new Popover({
      target   : iconInfoMessageVPMCAD,
      trigger  : "hover",
      animate  : "true",
      position : 'left',
      body     : "",
      title    : 'Product to CAD'
    });

    iconInfoMessageCADVPM = UWA.createElement('span', {
      'class' : 'InfoAddXCADMapping fonticon fonticon-info'
    }).inject(divMessageCADVPM);
    iconInfoMessageCADVPM.hide();
    popoverInfoMappingCADVPM = new Popover({
      target   : iconInfoMessageCADVPM,
      trigger  : "hover",
      animate  : "true",
      position : 'left',
      body     : "",
      title    : 'CAD to Product'
    });

    UWA.createElement('ul', {'class' : 'ListAddXCADMappingMessage'}).inject(divMessageBOTH);
    UWA.createElement('ul', {'class' : 'ListAddXCADMappingMessage'}).inject(divMessageVPMCAD);
    UWA.createElement('ul', {'class' : 'ListAddXCADMappingMessage'}).inject(divMessageCADVPM);


    OKBtn = new Button({
      value : XCADMappingNLS.Apply,
      id    : "modalOKButton",
      className : 'btn primary'
    });
    OKBtn.disable();

    CancelBtn = new Button({
      value : XCADMappingNLS.Cancel,
      id    : 'modalCancelButton',
      className : 'btn default'
    });


    addMappingModal = new Modal({
      className: 'add-mapping-modal',
      closable: true,
      header  :addMappingTitle,
      body    : modalbodydiv,
      footer  : [ OKBtn, CancelBtn ]
    });


   if(cadTypeName!=null && cadTypeName != typeofMX && iscusto==false){
    selectVPM.addEvent("onChange",  function (e) {
      if( (selectVPM.getSelection(false)).length!=0) {
	cadAttr.enable();
        var myValue = selectVPM.getSelection(false)[0].value;
		var honorDirection = selectVPM.getSelection(false)[0].getAttribute("honorDirection");
        if (myValue.contains('.') && honorDirection !== "true") {
          myValue = myValue.split('.')[1];
          toggleBoth.enable();
          toggleBoth.setCheck(true);
          toggleVPM.enable();
          toggleCAD.enable();
      
        } else {
			var direction = selectVPM.getSelection(false)[0].getAttribute("direction");
			var canDirectionModifiable = selectVPM.getSelection(false)[0].getAttribute("canDirectionModifiable");

			if(direction==-1){
				if(canDirectionModifiable){
				  toggleBoth.disable();
		          toggleVPM.setCheck(true);
		          toggleVPM.disable();
		          toggleCAD.disable();
				}else{
				//mx to cad attribute mapping
				  toggleBoth.disable();
		          toggleVPM.setCheck(true);
		          toggleVPM.disable();
		          toggleCAD.disable();
				  }
				}else if(direction==1)	{
				//cad to mx attribute mapping
				  toggleBoth.disable();
		          toggleCAD.setCheck(true);
		          toggleVPM.disable();
		          toggleCAD.disable();
				}else{
				  toggleBoth.enable();
		          toggleBoth.setCheck(true);
		          toggleVPM.enable();
		          toggleCAD.enable();
				}
        }

        // adding default prefix
        myValue = prefixToAdd+myValue;
 
        cadAttr.setValue(myValue);
        cadAttr.dispatchEvent('onKeyDown');
        OKBtn.enable();
      } else {
	cadAttr.disable();
	cadAttr.setValue('');
        OKBtn.disable();
      }
    });
}else{
	selectWinExt.addEvent("onChange",  function (e) {
      if( (selectWinExt.getSelection(false)).length!=0) {
        var myValue = selectWinExt.getSelection(false)[0].value;
	   var datatoSend;
       var url = URLHandler.getURL() + "/resources/xcadparam/gco/attributesofextension?integration="+integrationName+"&extension="+myValue+"&tenant=" + URLHandler.getTenant(),datatoSend;
      
      WAFData.authenticatedRequest(url, {
        timeout: 250000,
        method: 'GET',
        data: JSON.stringify(datatoSend),
        type: 'json',
        
        headers: {
          'Content-Type' : 'application/json',
          'Accept' : 'application/json',
          'Accept-Language' : widget.lang
        },

        onFailure : function (json) {
	        console.log(json);
        },
        
        onComplete: function(json) {
		if(iscusto==true){
	 		toggleCAD.enable();
            toggleBoth.setCheck(true);
            toggleBoth.enable();
            toggleVPM.enable();
		}else{
           toggleCAD.disable();
           toggleCAD.setCheck(true);
           toggleBoth.disable();
           toggleVPM.disable();
		}
		  addEltToSelectAttr(json.attribute,selectWinAttr);
        }
      }); 

    }else{
	//IR-930786-3DEXPERIENCER2022x
	Mask.mask(modalbodydiv);
	 var url;
	var datatoSend;
	url = URLHandler.getURL() + "/resources/xcadparam/gco/listofattributesfortype?type="+cadTypeName+"&tenant=" + URLHandler.getTenant()+"&integration="+integrationName+"&isTypeCustom="+iscusto,datatoSend;

	WAFData.authenticatedRequest(url, {
    timeout: 250000,
    method: 'GET',
    data: JSON.stringify(datatoSend),
    type: 'json',

    headers: {
      'Content-Type' : 'application/json',
      'Accept' : 'application/json'
    },

    onFailure : function (json) {
		Mask.unmask(modalbodydiv);

		   console.log(json);
    },

    onComplete: function(json) {
		Mask.unmask(modalbodydiv);

      var url2 = URLHandler.getURL() + "/resources/xcadparam/gco/listextraatt?type="+parentType+"&cadtype="+cadType+"&tenant=" + URLHandler.getTenant()+"&integration="+integrationName,datatoSend;

      WAFData.authenticatedRequest(url2, {
        timeout: 250000,
        method: 'GET',
        data: JSON.stringify(datatoSend),
        type: 'json',

        headers: {
          'Content-Type' : 'application/json',
          'Accept' : 'application/json'
        },

        onFailure : function (json2) {
			Mask.unmask(modalbodydiv);

		   console.log(json);
        },

        onComplete: function(json2) {
		Mask.unmask(modalbodydiv);

          if (json2.attributeDescription) {
            json.attributeDescription = json.attributeDescription.concat(json2.attributeDescription);
          }
			that.addEltToSelectNoExtAttr(json.attributeDescription,selectWinAttr);
        }
      });
    }
  	});
	}
	});
	
	 

	function addEltToSelectAttr(value, select,filterForVPM) {
    var i, attributeInfo,option,listOfEnableOption = new Array();
	if(value!=undefined){
    for (i=0; i<value.length;i++)
    {
      attributeInfo = value[i];
		if(attributeInfo.nlsName.length!=0)
    	  	option = {label:attributeInfo.nlsName + " ("+attributeInfo.type+")", value:attributeInfo.fullAttributeName};
     	        else
    	  	option = {label:attributeInfo.attributeName +" ("+attributeInfo.type+")", value:attributeInfo.fullAttributeName}; 

      listOfEnableOption.push(option);
   }
}

	select.remove();

    listOfEnableOption.forEach(function(optionSelect){
      select.add(optionSelect );
      select.enable(optionSelect);
    });

  }
	
	
	 selectWinAttr.addEvent("onChange",  function (e) {
      if( (selectWinAttr.getSelection(false)).length!=0) {
	cadAttr.enable();
        var myValue = selectWinAttr.getSelection(false)[0].value;
		var honorDirection = selectWinAttr.getSelection(false)[0].getAttribute("honorDirection");
        if (myValue.contains('.') && honorDirection !== "true") {
          myValue = myValue.split('.')[1];
		  toggleCAD.enable();
	      toggleBoth.setCheck(true);
	      toggleBoth.enable();
	      toggleVPM.enable();
        }else {
	 	 	var direction=selectWinAttr.getSelection(false)[0].getAttribute("direction");
		 	 	var canDirectionModifiable=selectWinAttr.getSelection(false)[0].getAttribute("canDirectionModifiable");

				//both mapping
				if(direction==-1){
					if(canDirectionModifiable){
						 toggleBoth.disable();
		          toggleVPM.setCheck(true);
		          toggleVPM.disable();
		          toggleCAD.disable();
					}else{
				//mx to cad attribute mapping
		          toggleBoth.disable();
		          toggleVPM.setCheck(true);
		          toggleVPM.disable();
		          toggleCAD.disable();
				}
				}else if(direction==1)	{
				//cad to mx attribute mapping
				  toggleBoth.disable();
		          toggleCAD.setCheck(true);
		          toggleVPM.disable();
		          toggleCAD.disable();
				}else{
				  toggleBoth.enable();
		          toggleBoth.setCheck(true);
		          toggleVPM.enable();
		          toggleCAD.enable();
				}	
	       }

		if(iscusto==true && isCloudOrPOD==true)
		{
			if (myValue.contains('__')) {
		   		myValue=myValue.substring(0,myValue.lastIndexOf("__")).trim();
			}
		}
        // adding default prefix
        myValue = prefixToAdd+myValue;
 
        cadAttr.setValue(myValue);
        cadAttr.dispatchEvent('onKeyDown');        
        OKBtn.enable();
      } else {
	cadAttr.disable();
	cadAttr.setValue('');
        OKBtn.disable();
      }
    });
}

    function canAllowMapping(
      existingMappings,
      selectVPMVal,
      cadAttrVal,
      proposedDirection
    ) {
      const currentVPM = selectVPMVal;
      const currentCAD = cadAttrVal;

      const isBlocked = (dirToCheck) => {
        return existingMappings.some((m) => {
          const existingVPM = m.selectVPMVal;
          const existingCAD = m.cadAttrVal;

          // Rule 1 Check: Different VPM -> Same CAD is Blocked
          const blocksVPMtoCAD =
            (dirToCheck === VPM_To_CAD || dirToCheck === BOTH) && // Checking for VPM->CAD or Both proposal
            (m.direction === VPM_To_CAD || m.direction === BOTH) && // Existing map affects VPM->CAD
            existingCAD === currentCAD && // Same CAD attribute involved
            existingVPM !== currentVPM; // But a different VPM attribute exists

          // Rule 2 Check: Different CAD -> Same VPM is Blocked
          const blocksCADtoVPM =
            (dirToCheck === CAD_To_VPM || dirToCheck === BOTH) && // Checking for CAD->VPM or Both proposal
            (m.direction === CAD_To_VPM || m.direction === BOTH) && // Existing map affects CAD->VPM
            existingVPM === currentVPM && // Same VPM attribute involved
            existingCAD !== currentCAD; // But a different CAD attribute exists

          return blocksVPMtoCAD || blocksCADtoVPM;
        });
      };

      switch (proposedDirection) {
        case VPM_To_CAD:
          return !isBlocked(VPM_To_CAD);
        case CAD_To_VPM:
          return !isBlocked(CAD_To_VPM);
        case BOTH:
          // Both is allowed only if neither underlying direction is blocked individually
          return !isBlocked(VPM_To_CAD) && !isBlocked(CAD_To_VPM);
        default:
          return false;
      }
    }

    function updateDirectionButtons(selectVPMVal, cadAttrVal) {
      // Check if there are any existing mappings
      if (attrMapping.length === 0) {
        return;
      }

      if (selectWinAttr && selectVPMVal.includes('.') && selectWinAttr.getSelection(false)[0]?.getAttribute("honorDirection") === "true") {
        return;
      }

      if (selectVPM && selectVPMVal.includes('.') && selectVPM.getSelection(false)[0]?.getAttribute("honorDirection") === "true") {
        return;
      }

      let currentVPM;
      let honorDirection ;

      if (selectVPMVal?.includes(".")) {
        currentVPM = selectVPMVal.trim().split(".")[1];
      } else {
        currentVPM = selectVPMVal?.trim();
      }

      const currentCAD = cadAttrVal;

      // Map existing mappings and normalize them consistently
      const mappedExistingMappings = attrMapping
        .map((obj) => {
          const vpm = obj["Name"]?.trim();
          const cad = obj["cadName"]?.trim();
          const syncDir = obj["Sync"];
          const status = obj["status"];

          if (
            vpm &&
            cad &&
            status !== "RemovedDeployed" &&
            [VPM_To_CAD, BOTH, CAD_To_VPM].includes(syncDir)
          ) {
            // Return standardized object
            return { selectVPMVal: vpm, cadAttrVal: cad, direction: syncDir };
          }
          return null; // Exclude invalid entries
        })
        .filter((mapping) => mapping !== null);

      for (let i = 0; i < VPMAttributes.length; i++) {
        let attributeInfo = VPMAttributes[i];

        let m1Name = attributeInfo.m1Name.trim();
        let internalName = attributeInfo.internalName.trim();

        // Return if JSON Sync = 1 and  -1
        if (
          (attributeInfo.sync == 1 || attributeInfo.sync == -1) &&
          (currentVPM == m1Name || currentVPM == internalName)
        ) {

          honorDirection = attributeInfo.sync;
          break;

        }
      }
   
      const shouldEnable = (element, condition) => {
        if (condition) {
          element.enable();
      } else {
          element.disable();
          element.setCheck(false);
        }
      };
  
      const canVPMtoCAD = canAllowMapping(
          mappedExistingMappings,
          currentVPM,
          currentCAD,
          VPM_To_CAD
      );
      const canCADtoVPM = canAllowMapping(
          mappedExistingMappings,
          currentVPM,
          currentCAD,
          CAD_To_VPM
      );
      const canBoth = canAllowMapping(
          mappedExistingMappings,
          currentVPM,
          currentCAD,
          BOTH
      );
  
      // Update UI based on results
      shouldEnable(toggleVPM, canVPMtoCAD);
      shouldEnable(toggleCAD, canCADtoVPM);
      shouldEnable(toggleBoth, canBoth);
  
      const anyDirectionAllowed = canVPMtoCAD || canCADtoVPM || canBoth;
      OKBtn.disabled = !anyDirectionAllowed;
  
      // Handle default check state
      toggleVPM.setCheck(false);
      toggleCAD.setCheck(false);
      toggleBoth.setCheck(false);
  
      if (anyDirectionAllowed) {
        // Prioritize checking: VPM -> CAD -> Both
        if (canVPMtoCAD) toggleVPM.setCheck(true);
        else if (canCADtoVPM) toggleCAD.setCheck(true);
        else if (canBoth) toggleBoth.setCheck(true);
      }

      if (honorDirection == -1) {

        if (canVPMtoCAD) {
          OKBtn.enable();
        } else {
          OKBtn.disable();
        }
        // Handle default check state
        toggleVPM.setCheck(true);
        toggleCAD.setCheck(false);
        toggleBoth.setCheck(false);

        toggleVPM.disable();
        toggleCAD.disable();
        toggleBoth.disable();      
          
      } else if (honorDirection == 1) {

        if (canCADtoVPM) {
          OKBtn.enable();
        } else {
          OKBtn.disable();
        }
        // Handle default check state
        toggleVPM.setCheck(false);
        toggleCAD.setCheck(true);
        toggleBoth.setCheck(false);

        toggleVPM.disable();
        toggleCAD.disable();
        toggleBoth.disable();      

      }        
      
    }

    cadAttr.addEvent("onKeyDown", function () {
      clearTimeout(typingTimer); // clearing the previous timer if the user types again

      typingTimer = setTimeout(() => {
        if (cadAttr.getValue().length == 0) {
          toggleVPM.disable();
          toggleBoth.disable();
          toggleCAD.disable();
          OKBtn.disable();
        } else {
          let selectVPMVal;
          let cadAttrVal = cadAttr.getValue();

          const xPattern = /^(?=.*[a-zA-Z])[a-zA-Z0-9](.*[a-zA-Z0-9])?$/;

          if(!xPattern.test(cadAttrVal)){

            toggleVPM.disable();
            toggleBoth.disable();
            toggleCAD.disable();
            OKBtn.disable()

            xNotification.errorMsg(
              XCADMappingNLS.invalidInput + " " + XCADMappingNLS.CADAttr,
              XCADMappingNLS.cadAttrWarning,
              "body"
            );
  
            setTimeout(() => {
              xNotification.clearNotifications();
            }, 3500);

            return;

          }     


          OKBtn.enable();

          if (selectVPM && selectVPM.getSelection(false).length != 0) {
            selectVPMVal = selectVPM.getValue()[0];
            updateDirectionButtons(selectVPMVal, cadAttrVal);

          } else if (selectWinAttr && selectWinAttr.getSelection(false).length != 0) {
            selectVPMVal = selectWinAttr.getValue()[0];
            updateDirectionButtons(selectVPMVal, cadAttrVal);

          } else {
              toggleVPM.disable();
              toggleBoth.disable();
              toggleCAD.disable();
            OKBtn.disable();
          }
      }
      }, detectionDelay);
    });

    return [addMappingModal, {selectVPM:selectVPM,cadAttr:cadAttr}, {toggle:toggleVPM, div:divMessageVPMCAD, popover:popoverInfoMappingVPMCAD},{toggle:toggleCAD, div:divMessageCADVPM, popover:popoverInfoMappingCADVPM},{toggle:toggleBoth, div:divMessageBOTH, popover:popoverInfoMappingBOTH},{OKButton:OKBtn, CancelButton:CancelBtn },{selectWinExt:selectWinExt,selectWinAttr:selectWinAttr}];
  },

 	addEltToSelectNoExtAttr : function (value, select) {
    var i, attributeInfo,attributeName,attributeItf,position,option,listOfEnableOption = new Array(), listOfDisableOption=new Array();
	if(value!=undefined){
    for (i=0; i<value.length;i++)
    {
      attributeInfo = value[i];

      attributeName = attributeInfo.id;
      if(attributeInfo.nlsName.length!=0)
    	  option = {label:attributeInfo.nlsName + " ("+attributeInfo.type+")",attributes:{direction:attributeInfo.sync, canDirectionModifiable:attributeInfo.canDirectionModifiable, honorDirection:attributeInfo.honorDirection}, value:attributeInfo.m1Name};
      else
    	  option = {label:attributeInfo.internalName + " ("+attributeInfo.type+")", attributes:{direction:attributeInfo.sync,canDirectionModifiable:attributeInfo.canDirectionModifiable, honorDirection:attributeInfo.honorDirection},value:attributeInfo.m1Name};
      listOfEnableOption.push(option);
    }
}
	select.remove();
    listOfEnableOption.forEach(function(optionSelect){
      select.add(optionSelect );
      select.enable(optionSelect);
    });

    listOfDisableOption.forEach(function(optionSelect){
      select.add( optionSelect);
      select.disable(optionSelect);

    });

  },

        setDeletedCellStyle : function (iCell) {
            var previousVal = iCell.value,
            previousTxt = iCell.getText();
            if(previousTxt === undefined) previousTxt = previousVal;
            iCell.empty();
            UWA.createElement('del', {
                text   : previousTxt,
                value  : previousVal,
            }).inject(iCell);
        },

        setNormalCellStyle : function (iCell) {
            var previousVal = iCell.value,
            previousTxt = iCell.getText();
            if(previousTxt === undefined) previousTxt = previousVal;
            iCell.empty();
            UWA.createElement('p', {
                text   : previousTxt,
                value  : previousVal,
            }).inject(iCell);
        },


}



return UIview;
});

/**
* @quickreview  KB9 21:10:25 creation
*/

define('DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationToastMessage',
[
  'UWA/Class',
  'DS/Controls/Button',
  'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
],
function (
  Class,
  WUXButton,
  URLHandler
)
{
    'use strict';


var DELConfigurationToastMessage = Class.extend({
        contentToastView : null,
        contentView : null,

        /*
        * init
        */
        init : function init(div)
        {
          var that = this;
          that.contentToastView = UWA.createElement('div',
          {
            'id': 'toastMessage'
          }).inject(div);

          /*that.contentToastView.setStyles({
            'border': '1px solid black',
            'position': 'absolute'
          });*/
        },

        /*
        * onClose
        */
        onClose : function onClose()
        {
          var that = this;
          if (that.contentToastView)
            that.contentToastView.className = that.contentToastView.className.replace("show", "");
        },

        /*
        * buildToastMessage
        */
        buildToastMessage : function buildToastMessage(messageType, message)
        {
          var that = this;
          if (that.contentToastView.getChildren().length)
            that.contentToastView.removeChild(that.contentToastView.getChildren()[0]);

          that.contentView = UWA.createElement('div');

          var imgelem = document.createElement("img");
          var iconName = '';
          var backgroundcolor = '';
          if (messageType === 0)//Info
          {
            iconName = 'I_Info';
            backgroundcolor = '#f1f3f4';
          }
          else if (messageType === 1)//Warning
          {
            iconName = 'I_Warning';
            backgroundcolor = '#ffe893';
          }
          else if (messageType === 2)//Error
          {
            iconName = 'I_Error';
            backgroundcolor = '#fff0ee';
          }
          else if (messageType === 3)//Success
          {
            iconName = 'I_Success';
            backgroundcolor = '#edf6eb';
          }

          imgelem.setAttribute("src", URLHandler.getURL() +  '/webapps/ParameterizationSkeleton/assets/icons/'+ iconName +'.png');

          that.contentView.setStyles({
            'background-color': backgroundcolor
          });
          that.contentView.setHTML(message);
          that.contentView.prepend(imgelem);

          var closeToastMessageButton = new WUXButton(
          {
            displayStyle: 'icon',
            icon:
            {
              iconName: 'close',
              fontIconFamily: WUXManagedFontIcons.Font3DS
            },
            iconSize : '0.5',
            onClick: function()
            {
              that.onClose.call(that);
            }
          });
          closeToastMessageButton.elements.container.setStyles({
            'border-style': 'none'
          });
          that.contentView.appendChild(closeToastMessageButton.elements.container);

          that.contentView.inject(that.contentToastView);
          return that.contentToastView;
        },

        /*
        * showToastMessage
        */
        showToastMessage : function showToastMessage(messsageType, message)
        {
          var that = this;
          that.buildToastMessage(messsageType, message);
          if (that.contentToastView.className === "")
          {
            that.contentToastView.className = "show";
            setTimeout(function()
            {
              that.contentToastView.className = that.contentToastView.className.replace("show", "");
            }, 4000);
          }
        }
    });
    return DELConfigurationToastMessage;
});

/**
 * @author AMN14
 */
define('DS/ParameterizationSkeleton/Views/ParamCollaboration/CollabManagementView',
    [
        'UWA/Core',
        'UWA/Class/View',
        'DS/W3DXComponents/Views/Layout/ListView',
        'DS/ParameterizationSkeleton/Views/ParamCollaboration/CollabItemsListView'
    ],
    function (
      UWA,
      View,
      ListView,
      CollabItemsListView
    ) {

        'use strict';

        return View.extend({

          defaultOptions : {
            type : 'default'
          },

          init : function(options) {
            UWA.log("CollabManagementView::init");
            UWA.log(options);

            this.options = options;
            this.childView = null;
          },

          render : function() {
            UWA.log("CollabManagementView::render");

                //myView = this.getViewFromDomainID(options);

            // if (myView !== null) {
            //      //myView.init();
            //     this.childView = myView;
            //     return myView.render();
            // }

            this.childView = new CollabItemsListView(this.options);

            var self = this;

    				// this.listenTo(this.collection, {
    				// 		onSync : self.onCompletedCollabEntriesRequest
    				// });

            return this.childView.render();
          },

          // getViewFromDomainID : function(options) {
          //   UWA.log("CollabManagementView::getViewFromDomainID");
          //
          //     var i,
          //         AppIntItemsDomainViewList = ["AttributeDef", "LifecycleTopology"];
          //
          //     for (i = 0; i < AppIntItemsDomainViewList.length; i++) {
          //         if (options.domainid === AppIntItemsDomainViewList[i]) {
          //             return new ParamItemsListView(options);
          //         }
          //     }
          //     return new ParametersLayoutView(options);
          // },

          onCompletedCollabEntriesRequest : function(){
            UWA.log("CollabManagementView::onCompletedCollabEntriesRequest");

            console.log(this.collection);
          },

          destroy : function() {
              this.childView.destroy();
              this.stopListening();
              this._parent.apply(this, arguments);
          }

        }
      );
    }
  );

/**
 * @author AMN14
 */
define('DS/ParameterizationSkeleton/Views/ParamCollaboration/TypeMapping/TypeMappingLayoutView',
    [
        'UWA/Core',
        'UWA/Class/View',
        'DS/W3DXComponents/Views/Layout/ListView',
        'DS/ParameterizationSkeleton/Views/ParamCollaboration/CollabManagementView',
        'DS/ParameterizationSkeleton/Views/ParamCollaboration/TypeMapping/TypeMappingViewUtilities',
        'DS/UIKIT/Mask',
    ],
    function (
      UWA,
      View,
      ListView,
        CollabManagementView,
        TypeMappingViewUtilities,
        Mask

    ) {

        'use strict';

        return View.extend({

          defaultOptions : {
            type : 'default'
          },

          init : function(options) {
              UWA.log("TypeMappingLayoutView::init");
            UWA.log(options);

            this.options = options;
              this.childView = null;
              this.listView = null;
              this.isCloudEnv = options.contents.isCloudEnv;
              //this.isAlreadyCleanForCloud = options.contents.isAlreadyCleanForCloud;
              
          },

          render : function() {
              UWA.log("TypeMappingLayoutView::render");

              TypeMappingViewUtilities.init(this.isCloudEnv/*, this.isAlreadyCleanForCloud*/);
              this.childView = new CollabManagementView(this.options);

            var self = this;

    				// this.listenTo(this.collection, {
    				// 		onSync : self.onCompletedCollabEntriesRequest
    				// });

             
              

 
              this.listenTo(this.options.collection, {
    				 		onSync : self.onCompletedCollabEntriesRequest
    				 });
              var viewRender = this.childView.render();
              this.listView = viewRender.container.children[1];
              Mask.mask(this.listView);
              return viewRender;
          },


          onCompletedCollabEntriesRequest : function(){
              UWA.log("CollabManagementView::onCompletedCollabEntriesRequest");
              Mask.unmask(this.listView);
            console.log(this.collection);
          },

          destroy : function() {
              this.childView.destroy();
              this.stopListening();
              this._parent.apply(this, arguments);
          }

        }
      );
    }
  );

define("DS/ParameterizationSkeleton/Views/ParameterizationPartSupply/DomainView", ["require", "exports", "UWA/Core", "UWA/Class/View", "DS/UIKIT/Input/Select", "DS/ParameterizationSkeleton/Utils/ParameterizationPartSupply/Utils", "DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/ParameterizationModel"], function (require, exports, UWA, View, Select, Utils, ParameterizationModelModule) {
    "use strict";
    /**
     * The aim of this module is to provide a React based version of the standard layout used to render a domain of parameters
     */
    var DomainViewModule;
    (function (DomainViewModule) {
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        ;
        /** Util class to handle kept states for components */
        var StateHandler = /** @class */ (function () {
            function StateHandler() {
            }
            /**
             * Use this method to maintain a state over UI refreshs
             * /!\  Since each component should render an up to date UI regarding to
             *      the top Domain state, only use this method to persist states
             *      based on other parameters than this state (clicks on accordion for example)
             * @param key Unique key to retrieve state from (example )
             * @param state State to init from (won't be used if a previous state exists)
             * @returns
             */
            StateHandler.reuseState = function (key, state) {
                var _this = this;
                if (!this.states.has(key)) {
                    this.states.set(key, state);
                }
                return {
                    saveState: function (newState) {
                        _this.states.set(key, newState);
                    },
                    getState: function () {
                        return _this.states.get(key);
                    }
                };
            };
            StateHandler.states = new Map();
            return StateHandler;
        }());
        var DEFAULT_CELL_STYLE = { padding: '8px', lineHeight: '1.42857', borderTop: '1px solid #e2e4e3', alignItems: 'center' };
        /**
         * React Equivalent for standard parameters layout view
         */
        DomainViewModule.DomainView = View.extend({
            setup: function (options) {
                this._parent(options);
                this.bodyListeners = [];
            },
            /** Builds and injects the domain view into the provided element */
            inject: function (element, position, props) {
                if (this.domain) {
                    this.domain.remove();
                }
                this.parentElement = element;
                this.domain = this.Domain(props);
                this.domain.inject(this.parentElement, position);
            },
            destroy: function () {
                this.removeAllBodyListeners();
                this._parent();
            },
            addBodyListener: function (listener) {
                document.body.addEventListener('click', listener);
                this.bodyListeners.push(listener);
            },
            removeAllBodyListeners: function () {
                this.bodyListeners.forEach(function (listener) {
                    document.body.removeEventListener('click', listener);
                });
                this.bodyListeners = [];
            },
            addError: function (error) {
                if (this.hasError.indexOf(error) === -1) {
                    this.hasError.push(error);
                }
            },
            removeError: function (error) {
                var index = this.hasError.indexOf(error);
                if (index > -1) {
                    this.hasError.splice(index, 1); // 2nd parameter means remove one item only
                }
            },
            /** Root Element */
            Domain: function (props) {
                var _this = this;
                var domain = props.domain;
                var headerDiv, parametersDiv, buttonsDiv, mainParamsDiv;
                this.hasError = [];
                this.forceApply = false;
                var updateUI = function () {
                    [headerDiv, parametersDiv, buttonsDiv].forEach(function (div) {
                        if (div) {
                            div.remove();
                        }
                    });
                    if (mainParamsDiv) {
                        headerDiv = _this.DomainHeader({ header: domain.nlsKey });
                        headerDiv.inject(mainParamsDiv);
                        parametersDiv = _this.ParametersDiv({ domain: domain, setDomain: setDomainWithAppliedStatuses });
                        parametersDiv.inject(mainParamsDiv);
                        buttonsDiv = _this.DomainButtons({ isApplyDisabled: isApplyDisabled, onApplyClick: onApplyClick, onResetClick: props.onResetClick });
                        buttonsDiv.inject(mainParamsDiv);
                    }
                };
                var setDomain = function (d) {
                    domain = d;
                    updateUI();
                };
                /** Checks if the domain has changed */
                var isApplyDisabled = function () {
                    return (JSON.stringify(domain) === JSON.stringify(props.domain) && !_this.forceApply) || _this.hasError.length > 0;
                };
                /** Posts all modified parameters to the server */
                var onApplyClick = function () {
                    var jsonArray = [];
                    domain.family.forEach(function (family) {
                        family.parameter.forEach(function (parameter) {
                            var correspondingFamily = props.domain.family.find(function (f) { return f.id === family.id; });
                            var correspondingParameter = correspondingFamily.parameter.find(function (p) { return p.id === parameter.id; });
                            if (JSON.stringify(parameter.argument[0].argValue) !== (JSON.stringify(correspondingParameter.argument[0].argValue))) {
                                jsonArray.push({
                                    id: parameter.id,
                                    domain: props.domain.id,
                                    argument: [{ id: 'Argument', value: parameter.argument[0].argValue }]
                                });
                            }
                        });
                    });
                    /** Updates the base collection and triggers onPostSuccess */
                    var onPostSuccess = function () {
                        var args = [];
                        for (var _i = 0; _i < arguments.length; _i++) {
                            args[_i] = arguments[_i];
                        }
                        props.applyDomainStateToBaseCollection(applyDeployedStatuses(domain, 'true'));
                        props.onPostSuccess.apply(props, args);
                    };
                    props.postOnServerFunc(null, jsonArray, null, props.onPostFailure, onPostSuccess);
                };
                /** Updates the parameters "isDeployed" property. If not forced by passing a value, the new value will be "false" if the parameter has changed, else if it hasn't */
                var applyDeployedStatuses = function (domain, forcedDeployedStatus) {
                    var _domain = Utils.Utils.clone(domain);
                    _domain.family = _domain.family.map(function (family) {
                        var _family = Utils.Utils.clone(family);
                        _family.parameter = family.parameter.map(function (parameter) {
                            var correspondingFamily = props.domain.family.find(function (f) { return f.id === family.id; });
                            var correspondingParameter = correspondingFamily.parameter.find(function (p) { return p.id === parameter.id; });
                            /** Apply a forced status OR true / false depending on if the param has been modified */
                            var isDeployed = (forcedDeployedStatus !== null && forcedDeployedStatus !== void 0 ? forcedDeployedStatus : JSON.stringify(parameter.argument[0].argValue) === JSON.stringify(correspondingParameter.argument[0].argValue)) ? 'true' : 'false';
                            var _parameter = Utils.Utils.clone(parameter);
                            _parameter.isDeployed = isDeployed;
                            return _parameter;
                        });
                        return _family;
                    });
                    return _domain;
                };
                /** Updates "isDeployed" property of each parameter depending on if it has changed */
                var setDomainWithAppliedStatuses = function (getNewDomain) {
                    setDomain(applyDeployedStatuses(getNewDomain(domain)));
                };
                headerDiv = this.DomainHeader({ header: domain.nlsKey });
                parametersDiv = this.ParametersDiv({ domain: domain, setDomain: setDomainWithAppliedStatuses });
                buttonsDiv = this.DomainButtons({ isApplyDisabled: isApplyDisabled, onApplyClick: onApplyClick, onResetClick: props.onResetClick });
                mainParamsDiv = UWA.createElement('div', {
                    styles: { padding: '15', display: 'flex', flexDirection: 'column', alignItems: 'stretch', height: '100%', 'justify-content': 'space-between' },
                    'class': 'main-param-div',
                    html: [headerDiv, parametersDiv, buttonsDiv]
                });
                return mainParamsDiv;
            },
            /** Displays a description above the parameters */
            DomainHeader: function (_a) {
                var header = _a.header;
                return UWA.createElement('div', {
                    'class': 'domain-description',
                    html: [{
                            tag: 'p',
                            'class': '',
                            text: header
                        }]
                });
            },
            /** Main parameters container */
            ParametersDiv: function (_a) {
                var domain = _a.domain, setDomain = _a.setDomain;
                var onFamilyChange = function (newFamilyValue) {
                    setDomain(function (d) {
                        var _d = Utils.Utils.clone(d);
                        _d.family = d.family.map(function (f) { return f.id === newFamilyValue.id ? newFamilyValue : f; });
                        return _d;
                    });
                };
                return UWA.createElement('div', {
                    id: 'domain-parameters',
                    class: 'scroller scroller-root',
                    styles: { overflow: 'hidden', flex: '1', overflowY: 'auto' },
                    html: [
                        this.Accordion({ families: domain.family, onFamilyChange: onFamilyChange })
                    ]
                });
            },
            Accordion: function (_a) {
                var _this = this;
                var families = _a.families, onFamilyChange = _a.onFamilyChange;
                if (families.length === 1) {
                    return this.FamilyTable({ family: families[0], onFamilyChange: onFamilyChange });
                }
                else {
                    return UWA.createElement('div', {
                        class: 'divided filled accordion accordion-root',
                        html: families.map(function (family, index) {
                            return _this.AccordionItem({ family: family, onFamilyChange: onFamilyChange });
                        })
                    });
                }
            },
            AccordionItem: function (_a) {
                var family = _a.family, onFamilyChange = _a.onFamilyChange, key = _a.key;
                var isActive = StateHandler.reuseState("accordion-item-".concat(family.id, "-isActive"), true);
                var accordionItem = UWA.createElement('div', {
                    class: 'accordion-item'
                });
                var contentWrapper = UWA.createElement('div', {
                    class: 'content-wrapper',
                    styles: { overflow: 'visible' },
                    html: [this.FamilyTable({ family: family, onFamilyChange: onFamilyChange })]
                });
                var updateUI = function () {
                    accordionItem.toggleClassName('active', isActive.getState());
                    contentWrapper.style.display = isActive.getState() ? 'block' : 'none';
                };
                var accordionTitle = UWA.createElement('div', {
                    class: 'accordion-title',
                    events: {
                        'click': function () {
                            isActive.saveState(!isActive.getState());
                            updateUI();
                        }
                    },
                    html: [{
                            tag: 'i',
                            class: 'caret-left'
                        }, family.nlsKey]
                });
                accordionItem.setContent([accordionTitle, contentWrapper]);
                updateUI();
                return accordionItem;
            },
            /** Table representing a bench of parameters */
            FamilyTable: function (_a) {
                var _this = this;
                var family = _a.family, onFamilyChange = _a.onFamilyChange;
                var onParameterChange = function (newParameterValue) {
                    var _family = Utils.Utils.clone(family);
                    _family.parameter = family.parameter.map(function (p) { return p.id === newParameterValue.id ? newParameterValue : p; });
                    onFamilyChange(_family);
                };
                return UWA.createElement('div', {
                    id: family.id + 'familytable',
                    class: 'table table-hover',
                    html: [{
                            tag: 'div',
                            class: 'fparamtbody',
                            styles: { display: 'flex', width: '100%', flexDirection: 'column' },
                            id: family.id + 'familytbody',
                            html: family.parameter.map(function (parameter) {
                                return _this.ParameterLine({ parameter: parameter, onParameterChange: onParameterChange });
                            })
                        }]
                });
            },
            /** Row representing a parameter */
            ParameterLine: function (_a) {
                var parameter = _a.parameter, onParameterChange = _a.onParameterChange;
                var onArgumentChange = function (newArgumentValue) {
                    var _parameter = Utils.Utils.clone(parameter);
                    _parameter.argument = [newArgumentValue];
                    onParameterChange(_parameter);
                };
                var isDeployed = parameter.isDeployed === 'true';
                var line = UWA.createElement('div', {
                    styles: { display: 'flex', width: '100%' },
                    html: [
                        this.ParameterLabel(parameter.nlsKey),
                        this.ParameterTooltip(parameter.tooltipNlsKey),
                        this.ParameterValue(this.DefaultParameterValue({ parameter: parameter, onArgumentChange: onArgumentChange })),
                        this.ParameterDeployed(isDeployed)
                    ]
                });
                this.AddMouseOver(line);
                return line;
            },
            ParameterLabel: function (text) {
                return UWA.createElement('div', {
                    styles: Utils.Utils.extend({ display: 'flex', width: '60%' }, DEFAULT_CELL_STYLE),
                    html: [{
                            tag: 'p',
                            styles: { margin: '0' },
                            text: text
                        }]
                });
            },
            ParameterTooltip: function (text) {
                return UWA.createElement('div', {
                    styles: Utils.Utils.extend({ display: 'flex', width: '5%', minWidth: '46' }, DEFAULT_CELL_STYLE),
                    html: [{
                            tag: 'span',
                            class: 'fonticon fonticon-info',
                            styles: { color: 'black' },
                            title: text
                        }]
                });
            },
            ParameterValue: function (value) {
                return UWA.createElement('div', {
                    tag: 'div',
                    styles: Utils.Utils.extend({ display: 'flex', flexDirection: 'row-reverse', width: '25%' }, DEFAULT_CELL_STYLE),
                    html: [value]
                });
            },
            ParameterDeployed: function (deployed) {
                return UWA.createElement('div', {
                    title: deployed ? 'Applied' : 'Modified',
                    styles: Utils.Utils.extend({ display: 'flex', width: '10%', minWidth: '46', flexDirection: 'row-reverse' }, DEFAULT_CELL_STYLE),
                    html: [{
                            tag: 'span',
                            class: 'fonticon fonticon-2x ' + (deployed ? 'fonticon-check' : 'fonticon-update'),
                            styles: { color: deployed ? 'green' : 'orange' }
                        }]
                });
            },
            /** default UI implem for a parameter */
            DefaultParameterValue: function (_a) {
                var parameter = _a.parameter, onArgumentChange = _a.onArgumentChange;
                if (parameter.argument[0].input === ParameterizationModelModule.InputTypes.CHECKBOX) {
                    return this.CheckboxParameterValue({ parameter: parameter, onArgumentChange: onArgumentChange });
                }
                else if (parameter.argument[0].input === ParameterizationModelModule.InputTypes.MULTISELECT_COMBOBOX) {
                    return this.MultiselectComboboxParameterValue({ parameter: parameter, onArgumentChange: onArgumentChange });
                }
                else if (parameter.argument[0].input === ParameterizationModelModule.InputTypes.TEXTFIELD) {
                    return this.TextfieldParameterValue({ parameter: parameter, onArgumentChange: onArgumentChange });
                }
                return null;
            },
            /** default Checkbox */
            CheckboxParameterValue: function (_a) {
                var parameter = _a.parameter, onArgumentChange = _a.onArgumentChange;
                var argument = parameter.argument[0];
                var onChange = function () {
                    var _argument = Utils.Utils.clone(argument);
                    _argument.argValue = argument.argValue === ParameterizationModelModule.BooleanArgValue.TRUE ? ParameterizationModelModule.BooleanArgValue.FALSE : ParameterizationModelModule.BooleanArgValue.TRUE;
                    onArgumentChange(_argument);
                };
                return this.Checkbox({ id: parameter.id, value: argument.argValue === ParameterizationModelModule.BooleanArgValue.TRUE, onChange: onChange });
            },
            /** default Textfield */
            TextfieldParameterValue: function (_a) {
                var parameter = _a.parameter, onArgumentChange = _a.onArgumentChange;
                var argument = parameter.argument[0];
                var onChange = function (e) {
                    var _argument = Utils.Utils.clone(argument);
                    _argument.argValue = e.target.value;
                    onArgumentChange(_argument);
                };
                return this.Textfield({ id: parameter.id, value: argument.argValue, enabled: true, onChange: onChange });
            },
            /** Default Multiselect combobox */
            MultiselectComboboxParameterValue: function (_a) {
                var parameter = _a.parameter, onArgumentChange = _a.onArgumentChange;
                var argument = parameter.argument[0];
                var _isDropdownOpen = false;
                var div;
                var setIsDropdownOpen = function (__isDropdownOpen) {
                    _isDropdownOpen = __isDropdownOpen;
                    div.empty();
                    div.setContent(getSelectContent(_isDropdownOpen));
                };
                var closeDropdown = function (e) {
                    if (e.target.closest('#' + parameter.id + '-select-container')) {
                        return;
                    }
                    setIsDropdownOpen(false);
                };
                this.addBodyListener(closeDropdown);
                var onSelectClicked = function () {
                    setIsDropdownOpen(!_isDropdownOpen);
                };
                var onOptionClicked = function (option) {
                    var _argument = Utils.Utils.clone(argument);
                    _argument.argValue = argument.value.filter(function (v) {
                        if (option.id === v.id) {
                            return !argument.argValue.split(',').some(function (_v) { return _v === option.id; });
                        }
                        return argument.argValue.split(',').some(function (_v) { return _v === v.id; });
                    }).map(function (option) {
                        return option.id;
                    }).join(',');
                    onArgumentChange(_argument);
                };
                var onRemoveButtonClicked = function (e, value) {
                    e.preventDefault();
                    e.stopPropagation();
                    onOptionClicked(argument.value.find(function (_v) { return _v.id === value; }));
                };
                var onDropdownOptionClicked = function (e, value) {
                    e.preventDefault();
                    e.stopPropagation();
                    onOptionClicked(value);
                };
                var getSelectContent = function (isDropdownOpen) {
                    return UWA.createElement('div', {
                        class: 'select select-multiple' + (isDropdownOpen ? ' select-focus dropdown-visible' : ''),
                        styles: { width: '100%' },
                        events: { 'click': onSelectClicked },
                        id: parameter.id + '-select-container',
                        html: [{
                                tag: 'div',
                                class: 'select-handle'
                            }, {
                                tag: 'select',
                                class: 'form-control select-hidden',
                                id: parameter.id,
                                name: parameter.id,
                                multiple: 'true',
                                html: argument.value.map(function (option, index) {
                                    return {
                                        tag: 'option',
                                        value: option.id,
                                        text: option.nlsKey
                                    };
                                })
                            }, {
                                tag: 'ul',
                                class: 'select-choices form-control',
                                html: argument.argValue.split(',').filter(function (s) { return !!s; }).map(function (value, index) {
                                    var option = argument.value.find(function (option) { return option.id === value; });
                                    return {
                                        tag: 'li',
                                        class: 'select-choice',
                                        html: [
                                            option.nlsKey,
                                            {
                                                tag: 'span',
                                                class: 'close',
                                                events: { 'click': function (e) { onRemoveButtonClicked(e, value); } },
                                                text: '×'
                                            }
                                        ]
                                    };
                                })
                            }, {
                                tag: 'div',
                                class: 'select-dropdown',
                                styles: isDropdownOpen ? { height: '190' } : undefined,
                                html: [{
                                        tag: 'div',
                                        class: 'select-dropdown-scroll  scroller scroller-root',
                                        styles: { overflow: 'hidden' },
                                        html: [{
                                                tag: 'div',
                                                class: 'no-native-scrollbars  scroller-content',
                                                html: [{
                                                        tag: 'ul',
                                                        class: 'select-results',
                                                        html: argument.value.map(function (option, index) {
                                                            return {
                                                                tag: 'li',
                                                                class: 'result-option' + (argument.argValue.split(',').some(function (v) { return option.id === v; }) ? ' result-option-selected' : ''),
                                                                events: { 'click': function (e) { return onDropdownOptionClicked(e, option); } },
                                                                text: option.nlsKey
                                                            };
                                                        })
                                                    }]
                                            }]
                                    }]
                            }]
                    });
                };
                div = UWA.createElement('div', {
                    styles: { width: '100%' },
                    html: [getSelectContent(_isDropdownOpen)]
                });
                return div;
            },
            /** Set of buttons to perform actions on the domain of parameters */
            DomainButtons: function (_a) {
                var isApplyDisabled = _a.isApplyDisabled, onApplyClick = _a.onApplyClick, onResetClick = _a.onResetClick;
                return UWA.createElement('div', {
                    id: 'apply-reset-div',
                    styles: { padding: '5', height: '45' },
                    html: [{
                            tag: 'table',
                            width: '100%',
                            class: '',
                            id: '',
                            html: [{
                                    tag: 'tr',
                                    html: [{
                                            tag: 'td',
                                            width: '50%',
                                            align: 'right',
                                            html: [
                                                this.ApplyButton({ isApplyDisabled: isApplyDisabled, onClick: onApplyClick }),
                                                this.ResetButton({ onClick: onResetClick })
                                            ]
                                        }]
                                }]
                        }]
                });
            },
            /** Apply Button */
            ApplyButton: function (_a) {
                var isApplyDisabled = _a.isApplyDisabled, onClick = _a.onClick;
                return UWA.createElement('button', {
                    type: 'button',
                    title: 'Apply Changes',
                    id: 'buttonExport',
                    class: 'btn-primary btn btn-root btn-with-icon btn-without-label',
                    styles: { width: '130', marginRight: '20px' },
                    events: { 'click': onClick },
                    disabled: isApplyDisabled(),
                    html: [{
                            tag: 'span',
                            class: 'fonticon fonticon-export'
                        }, 'Apply']
                });
            },
            /** Reset button */
            ResetButton: function (_a) {
                var onClick = _a.onClick;
                return UWA.createElement('button', {
                    type: 'button',
                    title: 'Reset Settings On Server to their OOTB status',
                    id: 'buttonExport',
                    class: 'btn-warning btn btn-root btn-with-icon btn-without-label',
                    styles: { width: '130' },
                    events: { 'click': onClick },
                    html: [{
                            tag: 'span',
                            class: 'fonticon fonticon-loop'
                        }, 'Reset']
                });
            },
            // add background effect
            AddMouseOver: function (element) {
                var onMouseOver = function () { element.style.backgroundColor = '#f4f5f6'; };
                var onMouseOut = function () { element.style.backgroundColor = 'transparent'; };
                element.onmouseover = onMouseOver;
                element.onmouseout = onMouseOut;
            },
            // add hover effects for icons
            AddIconMouseOver: function (element) {
                var onMouseOver = function () {
                    element.style.color = '#3d3d3d';
                    element.style.textDecoration = 'none';
                    element.style.cursor = 'pointer';
                };
                var onMouseOut = function () {
                    element.style.color = '#77797c';
                    element.style.textDecoration = 'unset';
                    element.style.cursor = 'unset';
                };
                element.onmouseover = onMouseOver;
                element.onmouseout = onMouseOut;
            },
            Checkbox: function (_a) {
                var id = _a.id, value = _a.value, onChange = _a.onChange;
                return UWA.createElement('div', {
                    html: [{
                            tag: 'div',
                            class: 'toggle-primary toggle-root',
                            styles: { marginTop: '0', marginBottom: '20px' },
                            html: [{
                                    tag: 'input',
                                    type: 'checkbox',
                                    id: id,
                                    checked: value,
                                    name: id
                                }, {
                                    tag: 'label',
                                    class: 'control-label',
                                    for: id,
                                    events: { 'click': onChange }
                                }]
                        }]
                });
            },
            Textfield: function (_a) {
                var id = _a.id, value = _a.value, enabled = _a.enabled, onChange = _a.onChange;
                return UWA.createElement('div', {
                    styles: { width: '100%' },
                    html: [{
                            tag: 'input',
                            type: 'text',
                            class: 'form-control form-control-root',
                            id: id,
                            value: value,
                            name: id,
                            events: { 'change': onChange },
                            styles: { width: '100%' },
                            disabled: !enabled
                        }]
                });
            },
            Select: function (_a) {
                var id = _a.id, multiple = _a.multiple, value = _a.value, options = _a.options, placeholder = _a.placeholder, enabled = _a.enabled, onChange = _a.onChange;
                var select = new Select({
                    id: id,
                    multiple: multiple,
                    name: id,
                    value: value,
                    disabled: !enabled,
                    placeholder: value ? '' : placeholder,
                    options: options.map(function (option, index) {
                        var opts = {
                            value: option.value,
                            label: option.label,
                            disabled: !!option.disabled,
                            attributes: option.attributes
                        };
                        return opts;
                    })
                });
                select.addEvent('onChange', onChange);
                return select.getContent();
            },
            LabelForInput: function (_a) {
                var inputId = _a.inputId, text = _a.text, mandatory = _a.mandatory, enabled = _a.enabled;
                return UWA.createElement('label', {
                    styles: { paddingBottom: '4px', lineHeight: '1.42857' },
                    text: text
                });
            }
        });
    })(DomainViewModule || (DomainViewModule = {}));
    return DomainViewModule;
});

/*global define, widget, document, setTimeout, console, clearTimeout, FileReader, WUXManagedFontIcons*/
/*jslint plusplus: true*/
/*jslint nomen: true*/
/*! Copyright 2017, Dassault Systemes. All rights reserved. */
/*@fullReview  CN1     18/05/15 2019xBeta2 Mapping Widget*/
define('DS/ParameterizationSkeleton/Views/ParameterizationXCAD/ParamXCADLayoutView',
[
 'UWA/Core',
 'UWA/Class/View',
 'DS/UIKIT/Modal',
 'DS/UIKIT/Popover',
 'DS/UIKIT/Mask',
 'DS/UIKIT/Scroller',
 'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
 'DS/ParameterizationSkeleton/Views/ParameterizationXCAD/XCADViewUtilities',
 'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
 'DS/UIKIT/Input/Button',
 'DS/UIKIT/Input/Select',
 'DS/UIKIT/Input/Toggle',
 'DS/UIKIT/Alert',
 'i18n!DS/ParameterizationSkeleton/assets/nls/XCADMappingNLS',
 'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS',
 'DS/WAFData/WAFData',
 'DS/Controls/Tab',
 'DS/ENOXCADAdminSettingUI/views/XCADAdminSettingView',
 'DS/ENOXCADTypeMappingUI/views/XCADTypeMappingView',
 'WebappsUtils/WebappsUtils'
 ],
 function (UWA, View,
     Modal,
     Popover, Mask, Scroller,
     ParametersLayoutViewUtilities, XCADViewUtilities,
     URLHandler,  Button, Select, Toggle, Alert,
     XCADMappingNLS,ParamSkeletonNLS, WAFData, WUXTab,
     XCADAdminSettingView, XCADTypeMappingView, WebappsUtils) {

'use strict';

var extendedView;

extendedView = View.extend({
tagName: 'div',
className: 'generic-detail',

init: function (options) {
  var initDate =  new Date();

  options = UWA.clone(options || {}, false);
  this._parent(options);
  this.contentDiv = null;
  this.paramScroller = null;
  this.userMessaging = null;
  this.lastAlertDate = initDate.getTime();
  this.controlDiv = null;
  this.wdthArrayAttr = [35,10,35,10,10];
  this.divMapping = null;
  this.divCustoMapping =null;
  this.baseAccordion=null;
  this.selectMapping=null;
  this.listOfBasicVPMType =[];
  this.listOfBasicType =[];
  this.listOfCustoVPMType=new Map();
  this.listOfCustoPartType=new Map();
  this.divBaseMapping;
  this.listofTypeRel;
  this.listofTypeRelMapping;
  this.mappingScroller=null;
  this.lastAlertDate = initDate.getTime();
  this.userMessaging=null;
},

setup: function(options) {
  UWA.log('AttributesLayoutView::setup!');
  UWA.log(options);
},

render: function () {
  UWA.log("AttributesLayoutView::render");
  var introDiv,
  mappingDiv,
  that = this;

  this.contentDiv =  UWA.createElement('div', {'id': 'xcadCollabAttribMapping'});
  Mask.mask(this.contentDiv);

  let urlInfo = {
      baseUrl: URLHandler.getURL(),
      tenant: URLHandler.getTenant()
  };

  let paramsJSON = {
      integGCOName: this.model.id
  };

  const paramsJSONString = encodeURI(JSON.stringify(paramsJSON));

  const url = URLHandler.getURL() +
      '/resources/xcadtypemapping/services/getGCOInfo?paramsJSONString=' + paramsJSONString +
      '&tenant=' + URLHandler.getTenant();

  that.getIntegrationName(url, 'GET').then((response) => {
      var typeMappingIntegName = response.integrationName;

      var xcadAdminSettingView = new XCADAdminSettingView({
          id: 'xcadAdminSettingView',
          className: 'generic-detail',
          integGCOName: this.model.id,
          urlInfo: urlInfo
      });

      var integJsonFile = WebappsUtils.getWebappsAssetUrl('ENOXCADTypeMappingUI', typeMappingIntegName + '.json');

      var isFileExist = that.doesFileExist(integJsonFile);

      var xcadTypeMappingView;

      if (isFileExist) {
          xcadTypeMappingView = new XCADTypeMappingView({
              id: 'xcadTypeMappingView',
              className: 'generic-detail',
              integGCOName: this.model.id,
              urlInfo: urlInfo
          });
      }

      var xcadTab = new WUXTab({
          displayStyle: "strip"
      });

      xcadTab.add({
          label: XCADMappingNLS.attrMapping,
          content: this.contentDiv,
          icon: {
              iconName: "attributes-add",
              fontIconFamily: WUXManagedFontIcons.Font3DS
          },
          isSelected: true
      });

      if (isFileExist) {
          xcadTab.add({
              label: XCADMappingNLS.typeMapping,
              content: xcadTypeMappingView.render().container,
              icon: {
                  iconName: "parameter-mapping",
                  fontIconFamily: WUXManagedFontIcons.Font3DS
              }
          });
      }

      xcadTab.add({
          label: XCADMappingNLS.settings,
          content: xcadAdminSettingView.render().container,
          icon: {
              iconName: "attributes-cog",
              fontIconFamily: WUXManagedFontIcons.Font3DS
          }
      });

      xcadTab.inject(this.container);
  });

  this.userMessaging = new Alert({
            className : 'param-alert',
            closable: true,
            visible: true,
            renderTo : document.body,
            autoHide : true,
            hideDelay : 2000,
            messageClassName : 'warning'
        });

  introDiv = UWA.createElement('div', {'class': 'information'}).inject(this.contentDiv);

  UWA.createElement ("br", {
  }).inject(introDiv);

  UWA.createElement('p', {
    text   : XCADMappingNLS.intro,
    'class': 'font-3dslight'      //'font-3dsbold'
  }).inject(introDiv);


  //this.controlDiv = XCADViewUtilities.createApplyResetToolbar.call(this, this.contentDiv, true,
   //   this.applyParams.bind(this), this.confirmationResetModalShow.bind(this));

    // to set height of container on resize of widget
   widget.addEvent('onResize', function () {
     let hght = widget.getViewportDimensions().height;
     let divXCADScroll = document.getElementById('divXCADScroll');
     if(divXCADScroll)
        divXCADScroll.setStyle('height', (hght - 280) + 'px');
   });

  //this.container.setContent(this.contentDiv);

  this.listenTo(this.collection, {
    onSync: that.onCompleteRequestMapping
  });

  return this;
},

doesFileExist : function (urlToFile) {
    var xhr = new XMLHttpRequest();
    xhr.open('HEAD', urlToFile, false);
    xhr.send();
    return xhr.status === 200;
},

getIntegrationName: function (url, method, deployParams) {
  return new Promise((resolve, reject) => {

    WAFData.authenticatedRequest(url, {
      timeout: 250000,
      method: method,
      type: 'json',
      // proxy: 'passport',
      data: deployParams ? deployParams : undefined,

      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json',
        'Accept-Language': widget.lang
      },

      onFailure: function (error) {
        return reject(error);
      },

      onComplete: function (response) {
        return resolve(response);
      }
    });

  });
},

onCompleteRequestMapping : function() {

  UWA.log("MappingLayoutView::onCompleteRequestMapping");
  var resultDiv;
  var that=this;
  var CADType, VPMType, side, line,i,j, listofAttributesMapping, TypeName, CADTypeName, isDeployed, DisplayCADType;
  var AddMappingAttributeButton,divMapping;


  this.divMapping = UWA.createElement('div', {
   'id': 'divXCADScroll',
   'class': 'DivXCADScroll'
  }).inject(this.contentDiv);

  let hght = widget.getViewportDimensions().height;
  this.divMapping.setStyle('height', (hght - 280) + 'px');

  //Recuperation des Mapping
  this.Mapping = this.collection._models[0]._attributes.Mapping;

  resultDiv = UWA.createElement('div', {'class': 'result'}).inject(this.contentDiv);

  this.baseAccordion=  ParametersLayoutViewUtilities.createFamilyUIKITAccordion(this.divMapping);

  for (i = 0; i < this.Mapping.length; i++) {

    CADType = this.Mapping[i].cadType;
    VPMType = this.Mapping[i].Type;
	DisplayCADType = this.Mapping[i].displayCADType;
    if (!this.Mapping[i].VPMObjectName) {

      if (this.Mapping[i].Type == "VPMReference") this.Mapping[i].VPMObjectName = "Physical Product";
      else
        this.Mapping[i].VPMObjectName = this.Mapping[i].Type;
    }

    if (!this.Mapping[i].cadTypeName) {
      this.Mapping[i].cadTypeName = XCADMappingNLS[this.Mapping[i].displayCADType] ? XCADMappingNLS[this.Mapping[i].displayCADType] : DisplayCADType;
    }
    CADTypeName = this.Mapping[i].cadTypeName;


    listofAttributesMapping = this.Mapping[i].AttributeMapping;

    var mappingTable = XCADViewUtilities.buildMappingLine.call(that,this.Mapping[i]);

    if (!mappingTable) continue;

    var attributeMappingDiv = UWA.createElement('div', {
      'class': 'attributeMapping'
    });//table-bordered

    var attributesTable = XCADViewUtilities.buildAttributeTable.call(that,listofAttributesMapping ,that.wdthArrayAttr);
    attributesTable.inject(attributeMappingDiv);

    var AddMappingButton = new Button({
      className: 'AddMappingBtn',
      icon: 'plus-circled',
      attributes: {
        disabled: false,
        'aria-hidden' : 'true',
        title : XCADMappingNLS.AddAttributeMappingTooltip,
      },
      events: {
        onClick: that.ShowAddMappingAttributePanel.bind(that,this.Mapping[i], attributesTable.getElement(".attrstbodyXCADMapping"))
      }
    }).inject(attributeMappingDiv);

      this.baseAccordion.addItem({
        title:  mappingTable,
        content: attributeMappingDiv,
        selected : true,
        name:CADType + "_" + VPMType,
      });
  }

  this.paramScroller = new Scroller({
      element: this.divMapping,
  }).inject(this.contentDiv);


	this.controlDiv = XCADViewUtilities.createApplyResetToolbar.call(this, this.contentDiv, true,
      this.applyParams.bind(this), this.confirmationResetModalShow.bind(this));

  var divAddMapping = UWA.createElement('div', {
    'class': 'AddXCADMapping'//'font-3dsbold'
  }).inject(this.contentDiv);

  Mask.unmask(this.contentDiv);
},




resetParams : function () {
  UWA.log("applyReset");
  var that=this;

  Mask.mask(this.contentDiv);
  var integration = encodeURI(this.model.id);
  var url = URLHandler.getURL() + "/resources/xcadparam/gco/reset?integration="+integration+"&tenant=" + URLHandler.getTenant();

  WAFData.authenticatedRequest(url, {
    timeout: 100000,
    method: 'POST',
    type: 'json',

    headers: {
      'Content-Type' : 'application/json',
      'Accept' : 'application/json'
    },

    onFailure : function (json) {
      that.onResetFailure.call(that,json);
    },

    onComplete: function(json) {
      that.onResetSuccess.call(that,json);
    }

  });


  //this.UpdateCommonParamsOnServer();
},

onResetFailure : function (json) {
  UWA.log(json);
  Mask.unmask(this.contentDiv);
  // Mask.unmask(this.contentDiv);//Rb0afx
  // this.userMessaging.add({ className: "error", message: ParamDataModelingNLS.deployFailureMsg });
  this.userMessaging.add({ className: "warning", message: XCADMappingNLS.ErrorReset });
  //ParamLayoutUtilities.updateIcon(false, theImageCell);
},


applyParams : function () {
  UWA.log("applyParams");
  var that = this;
  var mappingToSend = that.Mapping;

  Mask.mask(this.contentDiv);

  var isInvalidMapping = false;

  if( isInvalidMapping)
  {
    Mask.unmask(this.contentDiv);
    this.userMessaging.add({ className: "error", message: XCADMappingNLS.InvalidMapping });
  }
  else
  {
    datatoSend = { "Connector": that.model.id,
                   Mapping : mappingToSend
                 };

    var integration = encodeURI(this.model.id);
    var url = URLHandler.getURL() + "/resources/xcadparam/gco/set?integration="+integration+"&tenant=" + URLHandler.getTenant(),datatoSend;

    WAFData.authenticatedRequest(url, {
      timeout: 250000,
      method: 'POST',
      data: JSON.stringify(datatoSend),
      type: 'json',
      //proxy: 'passport',

      headers: {
        'Content-Type' : 'application/json',
        'Accept' : 'application/json'
      },

      onFailure : function (json) {
        that.onApplyFailure.call(that,json);
      },

      onComplete: function(json) {
        that.onApplySuccess.call(that,json);
      }

    });
  }

  //this.UpdateCommonParamsOnServer();
},

onApplyFailure : function (json) {
  UWA.log(json);
  Mask.unmask(this.contentDiv);
  this.userMessaging.add({ className: "error", message: XCADMappingNLS.applyErrorMessage });
},

onApplySuccess : function (json) { //Rb0afx

  var cpt=0,cptAttr=0,item,title,line,cell,nbofLines,mappingElt,imgSpan, itemToRemove = new Array(), that=this, currDate, currTime, diffDate;
   Mask.unmask(this.contentDiv);
  currDate = new Date();
  currTime = currDate.getTime();
  diffDate = currTime - this.lastAlertDate;
  this.lastAlertDate = currTime;

  this.lastAlertDate = currTime;
  if (true) { //  (diffDate >= 2000) {
            this.userMessaging.add({ className: "success", message: XCADMappingNLS.applySuccessMessage });
        }

  for(cpt=0;cpt<this.baseAccordion.items.length;cpt++)
  {
    item = this.baseAccordion.getItem(cpt);
    title = item.title.children[1];
    line = title.getElementsByTagName("tr");
    cell = line[0].cells[5];
    mappingElt=XCADViewUtilities.retrieveMappingEntry(line[0].cells[1].value, line[0].cells[3].value,this.Mapping);
    this.onApplySuccessForAttributes(mappingElt,item);

  }
},



onApplySuccessForAttributes : function (mappingElt,item) {
  var attrDiv,attrTable,nbofLines,cptAttr,attrLines,cellAttr,mappingEltAttr,imgSpan,listOfAttributes,attrLineToRemove=new Array();

  listOfAttributes = mappingElt.AttributeMapping;
  attrDiv = item.elements.content.children[0];
  if(attrDiv !== undefined)
  {
    attrTable = attrDiv.getElement(".attrstbodyXCADMapping");
    nbofLines = attrTable.children.length;
    for(cptAttr=1;cptAttr<nbofLines;cptAttr++)
    {
      attrLines = attrTable.children[cptAttr];
      cellAttr=attrLines.cells[XCADViewUtilities.cellsAttrIndex.deployFlag];
      mappingEltAttr=XCADViewUtilities.retrieveMappingAttrEntry(undefined,attrLines.cells[XCADViewUtilities.cellsAttrIndex.VPMAttr].value,attrLines.cells[XCADViewUtilities.cellsAttrIndex.CADAttr].value,listOfAttributes);
      if(cellAttr.value==="New" ||cellAttr.value === "Stored")
      {
        if(mappingEltAttr!=undefined)
        {
          mappingEltAttr.status="Deployed";
          cellAttr.empty();
          cellAttr.value="Deployed";
          cellAttr.title=XCADMappingNLS.deployedParamtxt;
          imgSpan = ParametersLayoutViewUtilities.buildImgSpan('check', '1.5', 'green');
          imgSpan.inject(cellAttr);
        }
      }
      else if(cellAttr.value==="Removed")
      {
        //attrLines.remove();
        attrLineToRemove.push(attrLines);
        XCADViewUtilities.removeMappingAttr(mappingEltAttr,listOfAttributes);
      }
    }

    attrLineToRemove.forEach(function(attrMapping){
      attrMapping.remove();
    });
  }
},



onResetSuccess : function (json) {
  var that = this;

  Mask.unmask(this.contentDiv);

  that.resetUI(json);


},


ShowAddMappingAttributePanel: function (typeMapping, attrtbody)
{
  var that = this;
  var vpmtype = encodeURI(typeMapping.Type);
  var cadtype = encodeURI(typeMapping.cadType);

  Mask.mask(that.contentDiv);
 
  var mxType;
  var extensions=new Array();

//IR-927259-3DEXPERIENCER2022x - custom type attrinute
  var custTypeAttr=new Array();

  if(that.collection._models[0]._attributes.ExtensionList!==null){
	 that.ExtensionList = that.collection._models[0]._attributes.ExtensionList;
	 for (mxType in that.ExtensionList) {
	    if(mxType === typeMapping.Type){
			var typeofMX=mxType;
	 		extensions=that.ExtensionList[mxType].split(',');	
		}
	}
  }

	if(typeMapping.iscusto==true){	
		extensions=typeMapping.extensions;
		custTypeAttr=typeMapping.attributes;
	}
	
    var url;
	var datatoSend;
		//IR-930786-3DEXPERIENCER2022x
	url = URLHandler.getURL() + "/resources/xcadparam/gco/listofattributesfortype?type="+vpmtype+"&tenant=" + URLHandler.getTenant()+"&integration="+that.model._attributes.id+"&isTypeCustom="+typeMapping.iscusto,datatoSend;
	
	
  WAFData.authenticatedRequest(url, {
    timeout: 250000,
    method: 'GET',
    data: JSON.stringify(datatoSend),
    type: 'json',

    headers: {
      'Content-Type' : 'application/json',
      'Accept' : 'application/json'
    },

    onFailure : function (json) {
      Mask.unmask(that.contentDiv);
      // TODO raise error
      //that.onApplyFailure.call(that,json);
    },

    onComplete: function(json) {
      Mask.unmask(that.contentDiv);
			if(typeMapping.iscusto==true){	

			vpmtype = encodeURI(typeMapping.ParentType);
			}
       var url2 = URLHandler.getURL() + "/resources/xcadparam/gco/listextraatt?type="+vpmtype+"&cadtype="+cadtype+"&tenant=" + URLHandler.getTenant()+"&integration="+that.model._attributes.id,datatoSend;

      WAFData.authenticatedRequest(url2, {
        timeout: 250000,
        method: 'GET',
        data: JSON.stringify(datatoSend),
        type: 'json',

        headers: {
          'Content-Type' : 'application/json',
          'Accept' : 'application/json'
        },

        onFailure : function (json2) {
          Mask.unmask(that.contentDiv);
          that.ShowAddMappingAttributePanelWithAtt.call(that, typeMapping, attrtbody, json, typeofMX, extensions,custTypeAttr);
        },

        onComplete: function(json2) {

          if (json2.attributeDescription) {
            json.attributeDescription = json.attributeDescription.concat(json2.attributeDescription);
          }

          Mask.unmask(that.contentDiv);
          that.ShowAddMappingAttributePanelWithAtt.call(that, typeMapping, attrtbody, json, typeofMX, extensions,custTypeAttr);
        }
      }
                                  );
    }
  });
},


ShowAddMappingAttributePanelWithAtt : function (typeMapping, attrtbody, json, typeofMX, extensions,custTypeAttr) {

  var that = this;
  var labelVPM = typeMapping.VPMObjectName+" "+XCADMappingNLS.attribute;
  var labelCAD = "CAD "+XCADMappingNLS.attribute;

  function compare(attrInfo1, attrInfo2) {
      if (attrInfo1.nlsName.toUpperCase() <  attrInfo2.nlsName.toUpperCase())
         return -1;
      if (attrInfo1.nlsName.toUpperCase() >  attrInfo2.nlsName.toUpperCase())
         return 1;
      return 0;
    }

  var VPMAttributes;
  if(json!==undefined && json.attributeDescription.length!==0)
    {
      VPMAttributes = json.attributeDescription;
      VPMAttributes.sort(compare);
    }else{
	 VPMAttributes=custTypeAttr;
	}

  var defaultPrefix = "";
  if (that.model.id==="CATIAV5UPS") defaultPrefix="cus:";

   var result = XCADViewUtilities.BuildAddMappingPanel( XCADMappingNLS.addMappingAttributeTitle.format(typeMapping.VPMObjectName,typeMapping.cadTypeName), XCADMappingNLS.selectAttr.format(typeMapping.VPMObjectName), XCADMappingNLS.selectAttr.format(typeMapping.cadTypeName), labelVPM, labelCAD, XCADMappingNLS.unilateralDirection.format(typeMapping.VPMObjectName,typeMapping.cadTypeName), XCADMappingNLS.unilateralDirection.format(typeMapping.cadTypeName,typeMapping.VPMObjectName), defaultPrefix, typeMapping.Type,typeofMX,typeMapping.VPMObjectName, XCADMappingNLS.selectExt.format(typeMapping.VPMObjectName),typeMapping.iscusto,typeMapping.isCloudOrPOD,that.model._attributes.id,typeMapping.ParentType,typeMapping.cadType, typeMapping.AttributeMapping, VPMAttributes);

  var addMappingModal = result[0];
  var selectVPM = result[1].selectVPM;
  var selectCAD = result[1].cadAttr;
  var toggleVPM = result[2].toggle;
  var divVPMMessage = result[2].div;
  var VPMPopover=  result[2].popover;
  var toggleCAD= result[3].toggle;
  var divCADMessage = result[3].div;
  var CADPopover= result[3].popover;
  var toggleBoth= result[4].toggle;
  var divBothMessage = result[4].div;
  var BothPopover = result[4].popover;
  var OkButton = result[5].OKButton;
  var CancelButton = result[5].CancelButton;
  var selectWinExt = result[6].selectWinExt;
  var selectWinAttr = result[6].selectWinAttr;

  //Build VPM attributes list

  function addEltToSelect(value, select,filterForVPM) {
    var i, attributeInfo,attributeName,attributeItf,position,option,listOfEnableOption = new Array(), listOfDisableOption=new Array();
	if(value!=undefined){

    for (i=0; i<value.length;i++)
    {
      attributeInfo = value[i];

      attributeName = attributeInfo.id;
      if(attributeInfo.nlsName.length!=0)
    	 option = {label:attributeInfo.nlsName + " ("+attributeInfo.type+")", attributes:{direction:attributeInfo.sync,canDirectionModifiable:attributeInfo.canDirectionModifiable, honorDirection:attributeInfo.honorDirection} ,value:attributeInfo.m1Name};
		else
    	  option = {label:attributeInfo.internalName + " ("+attributeInfo.type+")",attributes:{direction:attributeInfo.sync,canDirectionModifiable:attributeInfo.canDirectionModifiable, honorDirection:attributeInfo.honorDirection}  ,value:attributeInfo.m1Name};
		listOfEnableOption.push(option);
	}
	}
    listOfEnableOption.forEach(function(optionSelect){

      select.add(optionSelect );

      select.enable(optionSelect);
    });

    listOfDisableOption.forEach(function(optionSelect){
      select.add( optionSelect);
      select.disable(optionSelect);

    });

  }

 function addEltToSelectExtension(value, select,iscusto) {
    var i, attributeInfo,option,listOfEnableOption = new Array();
	if(value!=undefined){
	    for (i=0; i<value.length;i++)
	    {
	      attributeInfo = value[i];
			if(iscusto==true){
   	 			option = {label:attributeInfo.nlsName, value:attributeInfo.Name};
	  	    }else{
		   		 option = {label:attributeInfo, value:attributeInfo};
			}
	      listOfEnableOption.push(option);
	    }
	}

    listOfEnableOption.forEach(function(optionSelect){
      select.add(optionSelect );
      select.enable(optionSelect);
    });

  }

	if(typeofMX!=null && typeofMX===typeMapping.Type || typeMapping.iscusto==true )
	{
	  addEltToSelectExtension(extensions, selectWinExt,typeMapping.iscusto);
	  XCADViewUtilities.addEltToSelectNoExtAttr(VPMAttributes, selectWinAttr);
	 }else{
  addEltToSelect(VPMAttributes, selectVPM,true);
	 }

  CancelButton.addEvent("onClick", function (e) {
    UWA.log(e);//that.onCancelCalled();
    addMappingModal.hide();
  });

  OkButton.addEvent("onClick", function (e) {
  var selectedVPMAttr;
  if(typeofMX!=null && typeofMX===typeMapping.Type || typeMapping.iscusto==true){
	selectedVPMAttr = selectWinAttr.getSelection();
  }else{
	selectedVPMAttr = selectVPM.getSelection();
  }

    var nameAttrCAD = selectCAD.getValue();
    var side=0;
    if(toggleBoth.isChecked())
      side=0;
    else if (toggleVPM.isChecked())
      side=-1;
    else if (toggleCAD.isChecked())
      side=1;

    var nameAttrVPM = selectedVPMAttr[0].value;

    var position = selectedVPMAttr[0].label.indexOf("(");
    var displayNameAttrVPM = nameAttrVPM;
    var typeAttrVPM = "String";

    if(position != -1)
    {
      displayNameAttrVPM = selectedVPMAttr[0].label.slice(0,position);;
      typeAttrVPM = selectedVPMAttr[0].label.slice(position+1,selectedVPMAttr[0].label.length-1);
    }

    var itfVPMOpt="";
    if (nameAttrVPM.contains('.')) {
      itfVPMOpt = nameAttrVPM.split('.')[0];
      nameAttrVPM = nameAttrVPM.split('.')[1];
    }

	if (nameAttrVPM.contains('@@')) {
      nameAttrVPM = nameAttrVPM.split('@@')[0];
    }

    var mappingElt=XCADViewUtilities.retrieveMappingEntry(typeMapping.Type,typeMapping.cadType,that.Mapping);

    var mappingEltAttr = null;
    if(mappingElt!=undefined)
    {
      mappingEltAttr = { cadName: nameAttrCAD, Extension: itfVPMOpt, Name:  nameAttrVPM, Sync: side, nlsName:displayNameAttrVPM, status:"New","default":false };
      mappingElt.AttributeMapping.push(mappingEltAttr);

      var lineAttribute = XCADViewUtilities.buildAttributeLine.call(that, mappingElt.AttributeMapping, mappingEltAttr,that.wdthArrayAttr);
      var attrbody= result[0].getBody().getElementsByTagName("tbody");;
      lineAttribute.inject(attrtbody);

    }


    addMappingModal.hide();
  });

  addMappingModal.inject(this.contentDiv);
  addMappingModal.show();
},

  resetUI : function(json) {
    var that = this;

    this.divMapping.empty();
    this.divMapping.parentNode.removeChild(this.divMapping);
    this.collection._models[0]._attributes = json;
	this.controlDiv.destroy();
    this.onCompleteRequestMapping();

  },
  confirmationResetModalShow : function () {
    var headertitle, OKBtn, CancelBtn,
    bodyDiv,
    that = this;

    if (this.resetModal) {
      this.resetModal.show();//Modal already exists
    } else {
      headertitle = UWA.createElement('h4', {
        text   : ParamSkeletonNLS.confirmResetTitle,
        'class': 'font-3dslight' // font-3dsbold
      });

      OKBtn = new Button({
        value : ParamSkeletonNLS.OKButton,
        className : 'btn primary',
        events : {
          'onClick' : function() {
            UWA.log("DoSomething");
            that.resetParams();
          }
        }
      });
      CancelBtn = new Button({
        value : ParamSkeletonNLS.CancelButton,
        className : 'btn default',
        events : {
          'onClick' : function(e) {
            UWA.log("Cancel");
          }
        }
      });
      bodyDiv = UWA.createElement('div', {
        'id': 'resetContentDiv',
        'width' : '100%',
        'height': '100%'
      });
      UWA.createElement('p', {
        text   :  XCADMappingNLS.resetMsg,
        'class': 'font-3dslight'// font-3dsbold
      }).inject(bodyDiv);
      UWA.createElement('p', {
        text   :  ParamSkeletonNLS.confirmResetMsg,
        'class': 'font-3dslight'// font-3dsbold
      }).inject(bodyDiv);

      this.resetModal = new Modal({
        className: "reset-confirm-modal",
        closable: true,
        header: headertitle,
        body:   bodyDiv,
        footer: [ OKBtn, CancelBtn ]
      }).inject(this.contentDiv);
      this.resetModal.getContent().setStyle("padding-top", 1);
      this.resetModal.show();

      this.resetModal.getContent().getElements(".btn").forEach(function (element) {
        element.addEvent("click", function () {
          that.resetModal.hide();
        });
      });
    }
  },

  destroy : function() {
    this.stopListening();
    this._parent.apply(this, arguments);
  }
});

return extendedView;
});

/*@fullReview  ZUR 15/07/24 2016xFD01*/
/*@quickReview ZUR 15/11/23 2017x Param Skeleton*/
/*global define*/
define(
    'DS/ParameterizationSkeleton/Utils/PropagationWebServices',
    [
        'UWA/Core',
        'DS/WAFData/WAFData',
        'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
    ],
    function(UWA, WAFData, URLHandler) {

        'use strict';

        var wsUtils = {

            findTypes : function (onSearchFailure, onSearchSuccess, onSearchTimeOut) {
                var sIndexAPIUrl = "";
                if(this.indexAPIUrl)
                    sIndexAPIUrl="?indexURL="+this.indexAPIUrl;
                var url = URLHandler.getURL() + "/resources/dictionary/typesExtensions" + sIndexAPIUrl;
                var that = this;
                UWA.log("PropagationWebServices::findTypes call");
                WAFData.authenticatedRequest(url, {
                    timeout: 180000,
                    method: 'GET',
                    type: 'json',
                    //proxy: 'passport',

                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },

                    onFailure : function (resError,Response,resHeaders) {
                        /*var message = Response.message;
                        if (data && typeof data === 'object') { // null = 'object'
                            if (data.error && data.error.message) {
                                message = data.error.message;
                            }
                            else if (data.message) {
                                message = data.message;
                            }
                        }
                        else if (typeof object === 'string') {
                            if (object.startsWith('NetworkError:')) {
                                if (object.endsWith('return ResponseCode with value "0".')) {
                                    message = "There is no Internet connection.";
                                }
                                else if (object.endsWith('return ResponseCode with value "401".') ||
                                        object.endsWith('return ResponseCode with value "403".')) {
                                    message = "You are unauthorized to access the resource, please refresh the webpage to login and try again.";
                                }
                                else {
                                    message = "An error is returned from web service.";
                                }
                            }
                            else if (object === 'null') {
                                message = "An error is returned from web service.";
                            }
                        }*/
                        onSearchFailure(that,resError);
                    },

                    onComplete: function(Response) {
                        onSearchSuccess(that, Response);
                    },
                    onTimeout: function() {
                        onSearchTimeOut(that);
                    }
                });
            },

            PropagAtt : function (payload, onPropagFailure, onPropagSuccess, onPropagTimeOut) {
                var url = URLHandler.getURL() + "/resources/dictionary/propagateProperties?admin=true";
                var that=this;
                UWA.log("PropagationWebServices::bindTypes call");
                WAFData.authenticatedRequest(url, {
                    timeout: 180000,
                    method: 'POST',
                    data: JSON.stringify(payload),
                    type: 'json',
                    //proxy: 'passport',

                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },

                    onFailure : function (resError,Response,resHeaders) {
                        /*var message = object;
                        if (data && typeof data === 'object') { // null = 'object'
                            if (data.error && data.error.message) {
                                message = data.error.message;
                            }
                            else if (data.message) {
                                message = data.message;
                            }
                        }
                        else if (typeof object === 'string') {
                            if (object.startsWith('NetworkError:')) {
                                if (object.endsWith('return ResponseCode with value "0".')) {
                                    message = "There is no Internet connection.";
                                }
                                else if (object.endsWith('return ResponseCode with value "401".') ||
                                        object.endsWith('return ResponseCode with value "403".')) {
                                    message = "You are unauthorized to access the resource, please refresh the webpage to login and try again.";
                                }
                                else {
                                    message = "An error is returned from web service.";
                                }
                            }
                            else if (object === 'null') {
                                message = "An error is returned from web service.";
                            }
                        }*/
                        onPropagFailure(that, resError);
                    },

                    onComplete: function(Response) {
                        onPropagSuccess(that, Response);
                    },
                    onTimeout: function() {
                        onPropagTimeOut(that);
                    }
                });
            }
        };

        return wsUtils;

    }
);

define('DS/ParameterizationSkeleton/Views/ParameterizationSystemsSafety/SystemsSafetyViewPartnerUtilities', [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
    'DS/ParameterizationSkeleton/Views/ParameterizationSystemsSafety/ParameterizationSystemsSafetyConstants',
    'DS/ParameterizationSkeleton/Views/ParameterizationSystemsSafety/SystemsSafetyModalPartner',
    'DS/ParameterizationSkeleton/Views/ParameterizationSystemsSafety/SystemsSafetyViewUtilities',

    'i18n!DS/ParameterizationSkeleton/assets/nls/SystemsSafetyNLS'
], function(
    UWA,
    ParametersLayoutViewUtilities,
    ParameterizationSystemsSafetyConstants,
    SystemsSafetyModal,
    SystemsSafetyViewCommonUtilities,

    SystemsSafetyNLS
) {

    'use strict';

    var LEFT_ALIGNMENT = SystemsSafetyViewCommonUtilities.LEFT_ALIGNMENT;
    var RIGHT_ALIGNMENT = SystemsSafetyViewCommonUtilities.RIGHT_ALIGNMENT;
    var HTML_BOLD_FORMAT = SystemsSafetyViewCommonUtilities.HTML_BOLD_FORMAT;
    var HTML_PARAG_FORMAT = SystemsSafetyViewCommonUtilities.HTML_PARAG_FORMAT;
    var COLUMNS_WIDTH = ['30%', '50%', '10%', '10%'];
    var CELLS_INDEX = {
        name: 0,
        url: 1,
        action: 2,
        deployFlag: 3
    };


    var SystemsSafetyViewUtilities = {
        buildTable: function() {
            var partNumberTable = UWA.createElement('table', {
                'class': 'partNumberTableMapping table table-condensed'
            });
            var pNFieldbody = UWA.createElement('tbody', {
                'class': 'partnerFieldbody'
            }).inject(partNumberTable);

            var fieldInfo;
            fieldInfo = SystemsSafetyViewUtilities.buildStatusRow();
            fieldInfo.inject(pNFieldbody);

            fieldInfo = UWA.createElement('tr', {
                'class': 'success'
            });
            SystemsSafetyViewCommonUtilities.buildTextTableCell(LEFT_ALIGNMENT, COLUMNS_WIDTH[CELLS_INDEX.name], fieldInfo, HTML_BOLD_FORMAT, SystemsSafetyNLS.partnerName);
            SystemsSafetyViewCommonUtilities.buildTextTableCell(LEFT_ALIGNMENT, COLUMNS_WIDTH[CELLS_INDEX.url], fieldInfo, HTML_BOLD_FORMAT, SystemsSafetyNLS.url);
            SystemsSafetyViewCommonUtilities.buildTextTableCell(LEFT_ALIGNMENT, COLUMNS_WIDTH[CELLS_INDEX.action], fieldInfo, HTML_BOLD_FORMAT, SystemsSafetyNLS.actions);
            SystemsSafetyViewCommonUtilities.buildTextTableCell(RIGHT_ALIGNMENT, COLUMNS_WIDTH[CELLS_INDEX.deployFlag], fieldInfo, HTML_BOLD_FORMAT, SystemsSafetyNLS.deployStatus);
            fieldInfo.inject(pNFieldbody);

            return partNumberTable;
        },

        buildStatusRow: function() {
            var fieldInfo = UWA.createElement('tr', {
                'id': 'partnersStatusRow'
            });
            SystemsSafetyViewCommonUtilities.buildTextTableCell(LEFT_ALIGNMENT, COLUMNS_WIDTH[CELLS_INDEX.name], fieldInfo, HTML_PARAG_FORMAT, SystemsSafetyNLS.partnersUrl);
            var iCell = UWA.createElement('td', {
                'colspan': '3',
                'align': RIGHT_ALIGNMENT,
                'title': SystemsSafetyNLS.deployStatus,
                'class': 'architectureNumberingField font-3dslight'
            });

            var imgSpan = SystemsSafetyViewCommonUtilities.buildImgSpan('check', '2.5', 'green', SystemsSafetyNLS.deployed);
            imgSpan.inject(iCell);
            iCell.value = "success";
            iCell.inject(fieldInfo);
            return fieldInfo;
        },

        addEditButtonToCellRow: function(iCell) {
            var editElts = ParametersLayoutViewUtilities.createActionElements(SystemsSafetyNLS.editPattern, false);
            var editSpan = editElts[0];
            editSpan.setStyle("float", LEFT_ALIGNMENT);
            editSpan.setStyle("padding", "0px 8px");
            editSpan.inject(iCell);
            var editAttributeButton = editElts[1];

            editAttributeButton.addEvent("onClick", function(event) {
                var fieldToEdit = event.currentTarget.getParent().getParent().getParent();
                SystemsSafetyViewUtilities.editDialog(fieldToEdit);
            });

            return editAttributeButton;
        },

        addRemoveButtonToCellRow: function(iCell, fieldInfo) {
            var removelts = ParametersLayoutViewUtilities.createActionElements(SystemsSafetyNLS.removePattern, true);
            var deleteSpan = removelts[0];
            deleteSpan.setStyle("float", LEFT_ALIGNMENT);
            deleteSpan.setStyle("padding", "0px 8px");
            deleteSpan.inject(iCell);
            var removeAttributeButton = removelts[1];

            removeAttributeButton.addEvent("onClick", function() {
                SystemsSafetyViewUtilities.removefieldLineCallBack(fieldInfo);
            });

            return removeAttributeButton;
        },

        buildField: function(fieldInfo, name, url, isDeployed) {
            fieldInfo.value = isDeployed;
            SystemsSafetyViewCommonUtilities.buildTextTableCell(LEFT_ALIGNMENT, COLUMNS_WIDTH[CELLS_INDEX.name], fieldInfo, HTML_PARAG_FORMAT, name);
            SystemsSafetyViewCommonUtilities.buildTextTableCell(LEFT_ALIGNMENT, COLUMNS_WIDTH[CELLS_INDEX.url], fieldInfo, HTML_PARAG_FORMAT, url);

            var iCell = UWA.createElement('td', {
                'Align': LEFT_ALIGNMENT,
                'width': COLUMNS_WIDTH[CELLS_INDEX.action],
                'class': 'architectureNumberingField font-3dslight'
            }).inject(fieldInfo);

            SystemsSafetyViewUtilities.addEditButtonToCellRow(iCell, fieldInfo);
            SystemsSafetyViewUtilities.addRemoveButtonToCellRow(iCell, fieldInfo);

            iCell = UWA.createElement('td', {
                'Align': RIGHT_ALIGNMENT,
                'width': COLUMNS_WIDTH[CELLS_INDEX.deployFlag],
                'class': 'architectureNumberingField font-3dslight'
            }).inject(fieldInfo);

            if (isDeployed === ParameterizationSystemsSafetyConstants.DEPLOYED) {
                SystemsSafetyViewCommonUtilities.buildImgSpan('check', '2.5', 'green', SystemsSafetyNLS.deployed).inject(iCell);
            } else if (isDeployed === ParameterizationSystemsSafetyConstants.NEW_NOT_DEPLOYED) {
                SystemsSafetyViewCommonUtilities.buildImgSpan('cog', '2.5', 'orange', SystemsSafetyNLS.modified).inject(iCell);
            }
            iCell.inject(fieldInfo);
            return fieldInfo;
        },

        buildsFieldJsonObject: function(fieldInfo) {
            return {
                name: fieldInfo.cells[CELLS_INDEX.name].getText(),
                url: fieldInfo.cells[CELLS_INDEX.url].getText(),
                action: fieldInfo.cells[CELLS_INDEX.deployFlag].value
            };
        },

        buildNewField: function(objParam, isDeployedStatus) {
            var fieldInfo;
            fieldInfo = UWA.createElement('tr', {
                'class': 'partnerFieldMapping'
            });
            SystemsSafetyViewUtilities.buildField(fieldInfo, objParam.name, objParam.url, isDeployedStatus);
            fieldInfo.cells[CELLS_INDEX.deployFlag].value = ParameterizationSystemsSafetyConstants.ADD;
            return fieldInfo;
        },

        modifyField: function(fieldInfo, objParam, isDeployedStatus) {
            fieldInfo.value = isDeployedStatus;
            // name must not be modified
            fieldInfo.cells[CELLS_INDEX.url].setText(objParam.url);
            var deploycell = fieldInfo.cells[CELLS_INDEX.deployFlag];
            deploycell.empty();

            SystemsSafetyViewCommonUtilities.buildImgSpan('cog', '2.5', 'orange', SystemsSafetyNLS.modified).inject(deploycell);
            deploycell.value = ParameterizationSystemsSafetyConstants.MODIFY;
            return fieldInfo;
        },

        removefieldLineCallBack: function(fieldInfo) {
            if (typeof fieldInfo !== undefined) {
                if (fieldInfo.value === ParameterizationSystemsSafetyConstants.NEW_NOT_DEPLOYED) {
                    fieldInfo.remove();
                } else {
                    SystemsSafetyViewUtilities.setForRemoveFieldLine(fieldInfo);
                }
            }
        },

        resetForRemove: function(fieldInfo) {
            var imgSpan = SystemsSafetyViewCommonUtilities.buildImgSpan('check', '2.5', 'green', SystemsSafetyNLS.deployed);
            var actionCell = fieldInfo.cells[CELLS_INDEX.action];
            var deploycell = fieldInfo.cells[CELLS_INDEX.deployFlag];

            SystemsSafetyViewUtilities.addEditButtonToCellRow(actionCell, fieldInfo);
            SystemsSafetyViewUtilities.addRemoveButtonToCellRow(actionCell, fieldInfo);
            deploycell.empty();
            imgSpan.inject(deploycell);
        },

        resetForModify: function(fieldInfo, savedInfo) {
            var imgSpan = SystemsSafetyViewCommonUtilities.buildImgSpan('check', '2.5', 'green', SystemsSafetyNLS.deployed);
            var deploycell = fieldInfo.cells[CELLS_INDEX.deployFlag];

            if (savedInfo) {
                fieldInfo.cells[CELLS_INDEX.name].setText(savedInfo.name);
                fieldInfo.cells[CELLS_INDEX.url].setText(savedInfo.url);
            }
            deploycell.empty();
            imgSpan.inject(deploycell);
        },

        resetForFieldLineChanges: function(fieldInfo, savedInfo) {
            if (fieldInfo.value === ParameterizationSystemsSafetyConstants.NEW_NOT_DEPLOYED) {
                var cellValue = fieldInfo.cells[CELLS_INDEX.deployFlag].value;
                if (cellValue === ParameterizationSystemsSafetyConstants.ADD) {
                    return fieldInfo;
                } else if (cellValue === ParameterizationSystemsSafetyConstants.REMOVE) {
                    SystemsSafetyViewUtilities.resetForRemove(fieldInfo);

                } else if (cellValue === ParameterizationSystemsSafetyConstants.MODIFY) {
                    SystemsSafetyViewUtilities.resetForModify(fieldInfo, savedInfo);
                }

                fieldInfo.value = ParameterizationSystemsSafetyConstants.DEPLOYED;
                fieldInfo.cells[CELLS_INDEX.deployFlag].value = null;
            }
        },

        setForRemoveFieldLine: function(fieldInfo) {
            fieldInfo.value = ParameterizationSystemsSafetyConstants.NEW_NOT_DEPLOYED;
            var arrayAction = fieldInfo.cells[CELLS_INDEX.action].getElements('span');
            arrayAction.forEach(function(action) {
                action.hide();
            });

            var deploycell = fieldInfo.cells[CELLS_INDEX.deployFlag];
            var imgSpan = SystemsSafetyViewCommonUtilities.buildImgSpan('trash', '1.5', 'red', SystemsSafetyNLS.removed);

            deploycell.empty();
            deploycell.value = ParameterizationSystemsSafetyConstants.REMOVE;
            imgSpan.inject(deploycell);
        },

        editDialog: function(fieldToEdit) {
            var options = {
                className: "part-number-edit-modal",
                title: SystemsSafetyNLS.editPartner
            };

            var that = this;
            this.modal = new SystemsSafetyModal(options);

            this.modal.modal.setFooter("<button type='button'  name='addButton' id='add-button' class='btn btn-primary'>" + SystemsSafetyNLS.apply + "</button> " + "</button>" + "<button type='button' name='cancelButton' id='cancel-button' class='btn btn-default'>" + SystemsSafetyNLS.cancel + "</button>");
            this.modal.getModalBody();
            this.modal._bindFooterEvent();

            var fetchedData = this.buildsFieldJsonObject(fieldToEdit);

            this.modal.nameTextBox.setValue(fetchedData.name);
            this.modal.nameTextBox.setDisabled(true);
            this.modal.urlTextBox.setValue(fetchedData.url);

            this.modal.getContent().getElements('.btn').forEach(function(element) {
                if (element.name === 'addButton') {
                    element.addEvent('click', function() {
                        var userEditedFormat = that.modal.getUserEnteredValues();
                        var checkStatus = {};
                        checkStatus.isSuccess = true;

                        var toDisplayOver = that.modal.getContent().getElement('.enox-arch-number-content');

                        if (userEditedFormat.type === '') {
                            that.modal.displayAlertMessage(SystemsSafetyNLS.typeNullMessage, toDisplayOver);
                        } else if (userEditedFormat.pattern === '') {
                            that.modal.displayAlertMessage(SystemsSafetyNLS.patternNullMessage, toDisplayOver);
                        } else {
                            userEditedFormat.action = ParameterizationSystemsSafetyConstants.MODIFY;
                            SystemsSafetyViewUtilities.modifyField(fieldToEdit, userEditedFormat, ParameterizationSystemsSafetyConstants.NEW_NOT_DEPLOYED);
                            that.modal.destroy();
                        }
                    });
                }
            });

            this.modal.show();
        }
    };

    return SystemsSafetyViewUtilities;
});

define('DS/ParameterizationSkeleton/Views/ParamLabelManagement/LabelManagementUtility', [
        'UWA/Core',
        'DS/WAFData/WAFData',
        'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
    ],
    function(UWA, WAFData, URLHandler) {

        const requestHelper = function(url, methodType, data, onSuccessCallback, onFailureCallback) {
            const urlSecurityContext = URLHandler.getURL() + "/resources/pno/person/getsecuritycontext?tenant=" + URLHandler.getTenant();
            console.log("Get security context:");
            WAFData.authenticatedRequest(urlSecurityContext, {
                timeout: 250000,
                method: 'GET',
                data: "",
                type: 'json',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                onFailure: function(json) {
                    UWA.log(json);
                    console.log(json);
                },
                onComplete: function(securityContext) {
                    const urlFinal = URLHandler.getURL() + url + "?tenant=" + URLHandler.getTenant();
                    
                    onSuccessCallback(urlFinal);
                }
            });
        }

        return {
            getDefaultWorkFlow: function() {
            	var fileName = "LabelManagementWorkflow.zip";
                var postdataEmpty = "";
                var url = "/awl/wrkflxlc/" + fileName;
                function onSuccessGetWF(urlFinal) {
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = urlFinal;
                    a.download = fileName;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                }
                requestHelper(url, "GET", postdataEmpty, onSuccessGetWF, console.log);
            },
        }
});

define('DS/ParameterizationSkeleton/Views/ParamLabelManagement/LabelManagementView',
    [
        'UWA/Core',
        'UWA/Class/View',
        'DS/UIKIT/Mask',
        'DS/UIKIT/Accordion',
        'DS/UIKIT/Input/Text',
        'DS/UIKIT/Input/Button',
        'DS/UIKIT/Popover',
        'DS/ParameterizationSkeleton/Views/ParamLabelManagement/LabelManagementUtility',
        'i18n!DS/ParameterizationSkeleton/assets/nls/LabelManagementNLS'
    ],
    function(UWA, View, Mask, Accordion, Text, Button, Popover, LabelManagementUtility, LabelManagementNLS) {

        'use strict';
        var extendedView;

        extendedView = View.extend({

            defaultOptions: {
                type: 'default'
            },

            // The ‘options’ object is passed via the ‘viewOptions’ specified in the Renderer at the Skeleton instantiation
            init: function(options) {
                UWA.log("LabelManagementView::init");
                UWA.log(options);
                this.options = UWA.clone(options || {}, false); //environment options
                this._parent(options);
                this.childView = null;
            },

            render: function() {
                var that = this;

                //This is the main div.
                that.contentDiv = UWA.createElement('div', {
                    'id': "labelManagementContainer"
                });
                that.container.setContent(that.contentDiv);
                that.contentDiv.parentElement.classList.add("label-management-main");
                that.createHeader(that.contentDiv);

                var labelManagementWFTable = UWA.createElement('table', {
                    'id': "labelManagementWF"
                });
                labelManagementWFTable.style.width = "100%";
                var labelManagementWFDiv = UWA.createElement('tr', {
                    'id': "Elmt1"
                }).inject(labelManagementWFTable);

                //var browseDiv = UWA.createElement('div', { 'id': "browseDiv", 'display': "inline"}).inject(labelManagementWFDiv);
                var downloadWFText = UWA.createElement('td', {
                    text: LabelManagementNLS.DownloadSWF,
                    'class': ''
                }).inject(labelManagementWFDiv);

                const informationIcon = UWA.createElement('td', {
                    'class': "fonticon fonticon-info"
                }).inject(labelManagementWFDiv);
                new Popover({
                    target: informationIcon,
                    trigger: "hover",
                    animate: "true",
                    position: "top",
                    body: LabelManagementNLS.DownloadSWFInfo,
                    title: ''
                });

                //downloadWFText.elements.style.margin = "5px";
                var downloadButton = new Button({
                    id: "downloadButton",
                    value: "Download",
                    icon: 'download'
                }).inject(labelManagementWFDiv);
                downloadButton.elements.container.style.margin = "0px 5px 0px 0px";
                downloadButton.elements.container.style.float = "right";
                downloadButton.addEvent('onClick', function() {
                    LabelManagementUtility.getDefaultWorkFlow();
                });

                new Accordion({
                    className: 'filled',
                    exclusive: false,
                    items: [

                        {
                            title: "Business Process Management",
                            content: labelManagementWFTable,
                            selected: true
                        }
                    ]
                }).inject(that.contentDiv);

                return that;
            },

            createConfigurationParamView: function(id, array) {
                var configurationParamTable = UWA.createElement('table', {
                    'id': id,
                    'class': 'labelManagementParamTable'
                });
                Object.entries(array).forEach(entry => {
                    const [key, value] = entry;
                    UXComponent.ceateComponent(value, this.createTableCase(key, configurationParamTable));
                });
                return configurationParamTable;
            },

            createTableCase: function(id, parentElement) {
                var tableCase = UWA.createElement('tr', {
                    'id': id,
                    'class': 'labelManagementTableCase',
                }).inject(parentElement);

                tableCase.addEventListener('mouseover', function() {
                    tableCase.classList.add('colored')
                });

                tableCase.addEventListener('mouseout', function() {
                    tableCase.classList.remove('colored');
                });

                return tableCase;

            },

            createHeader: function(parentElement) {
                UWA.createElement('div', {
                    'id': "labelManagementParamTitle",
                    html: ""
                }).inject(parentElement);
            },

            onCompleteRequestMapping: function() {
                Mask.unmask(this.contentDiv);

            },

            destroy: function() {
                this.stopListening();
                this._parent.apply(this, arguments);
            }

        });
        return extendedView;
});

/**
 * ParameterizationSustainabilityWebServices.js
 * 5/10/2023 - kkr15 - created
 */
define('DS/ParameterizationSkeleton/Utils/ParameterizationSustainabilityWebServices',
    [
        'UWA/Promise',
        'DS/WAFData/WAFData',
        'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
    ],
    function (Promise, WAFData, URLHandler) {
	

        'use strict';

 const ParameterizationSustainabilityWebServices = {
            checkIfCostMetricsExistsBeyondInWork: function () {

                return new Promise(function (resolve, reject) {
                    const url = URLHandler.getURL() + "/resources/kpiparam/checkMetricsBeyondInWork?tenant=" + URLHandler.getTenant();

                    WAFData.authenticatedRequest(url, {
                        timeout: 10000,
                        method: 'GET',
                        type: 'text',
                        headers: {
                            'Content-Type': 'text',
                            'Accept': 'text'
                        },

                        onFailure: reject,
                        onComplete: resolve
                    });
                });
            },
setSustainabilityEvolution: function (jsonArr){
	const url = URLHandler.getURL() + "/resources/kpiparam/setSustainabilityEvolutionProcess?tenant=" + URLHandler.getTenant();
                const datatoSend = {
                    parameter: jsonArr
                };
 return new Promise(function (resolve, reject) {
                    WAFData.authenticatedRequest(url, {
                        timeout: 10000,
                        method: 'POST',
                        data: JSON.stringify(datatoSend),
                        type: 'json',
                        //proxy: 'passport',

                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },

                        onFailure: reject,
                        onComplete: resolve
                    });
                });
}
};
return ParameterizationSustainabilityWebServices;
}
);

/*@fullReview  S63 17/03/03 2018xFD01 Param Widgetization NG*/
/*global define, widget, document, setTimeout, console*/
/*jslint plusplus: true*/
/*jslint nomen: true*/
define('DS/ParameterizationSkeleton/Views/PropagationLayoutViewUtilities',
    [
        'UWA/Core',
        'DS/UIKIT/Input/Button',
        'DS/UIKIT/Alert',
        'DS/UIKIT/Input/Toggle',
        'DS/UIKIT/Popover',
        'DS/UIKIT/Spinner',
        'DS/UIKIT/Mask',
        'DS/UIKIT/Modal',
        'DS/UIKIT/SuperModal',
        'DS/ParameterizationSkeleton/Utils/PropagationWebServices',
        'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
        'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS'
    ],
    function (UWA,
              Button,
              Alert, Toggle, Popover, Spinner, Mask,
              Modal,SuperModal,
              PropagationWebServices, ParamLayoutUtilities,
              ParamSkeletonNLS) {

        'use strict';

        var UIview = {

            buildPropagAttLine : function (wdthArray,content) {
                var buttonBindCell, cellBindText, cellInfo, bindBttn,
                    bindLine = UWA.createElement('tr'),
                    that = this,
                    admBtn, currUsrBtn, headertitle, bodyDiv,
                    admin=false;

                UWA.log("PropagationLayoutViewUtilities::buildBindAutoExtLine start");

                cellBindText = UWA.createElement('td', {
                    //'colspan': '2',
                    'width': wdthArray[0].toString() + '%',
                    'align': 'left'
                }).inject(bindLine);

                UWA.createElement('p', {
                    text: ParamSkeletonNLS.PropagationFirstLine,
                    'class': ''
                }).inject(cellBindText);

                cellInfo = UWA.createElement('td', {
                    'width': wdthArray[1].toString() + '%',
                    'align': 'left'
                }).inject(bindLine);

                ParamLayoutUtilities.buildPopoverSpan(cellInfo, ParamSkeletonNLS.PropagationInfo);

                UWA.createElement('td', {
                    'width': wdthArray[2].toString() + '%',
                    'align': 'left'
                }).inject(bindLine);

                buttonBindCell = UWA.createElement('td', {
                    'width'  : wdthArray[3].toString() + '%'
                }).inject(bindLine);

                bindBttn =  new Button({
                    className: 'primary',
                    id : 'bindButton',
                    icon: 'archive',
                    attributes: {
                        disabled: false,
                        //title: ParamSkeletonNLS.IndexationTooltip,
                        text : ParamSkeletonNLS.Search,
                        title: ParamSkeletonNLS.SearchInfo                    },
                    events: {
                        onClick: function () {
                            Mask.mask(content.contentDiv);
                            //that.contentDiv.destroy();
                            //var tbodyreflist = this.contentDiv.getElements('.fparamtbody'),
                            //tbodyref = tbodyreflist[2],
                            //iLines = tbodyref.children;

                           //iLines[2].hide();
                            //tbodyref.empty();
                            PropagationWebServices.findTypes.call(content, that.onSearchFailure.bind(that), that.onSearchSuccess.bind(that), that.onSearchTimeOut.bind(that));
                        }
                    }
                }).inject(buttonBindCell);
                bindBttn.getContent().setStyle("width", 150);

                if(content.adminModal == null) {
                    var tbodyreflist = content.contentDiv.getElements('.fparamtbody'),
                        tbodyref = tbodyreflist[2];
                    content.adminModal = new SuperModal({ renderTo: content.contentDiv });
                }

                UWA.log("PropagationLayoutViewUtilities::buildBindAutoExtLine end");

                return bindLine;
            },
            
            updateUIPropagAtt : function(json, content) {
                UWA.log("PropagationLayoutViewUtilities::updateUIPropagAtt start");
                var tbodyreflist = content.contentDiv.getElements('.fparamtbody'),
                iController, imgCell,
                tbodyref = tbodyreflist[2],
                listTypes=json.Result,
                resultJSON = content.payload,
               //noAccessObj=json.NoAccessObj,
                that=this,
                needAdminPropag=false;
                content.inputControls = [];
                content.propagTypesArray = [];
                tbodyref.empty();
                content.indexAPIUrl = json.url;

                //UWA.log("PropagationLayoutViewUtilities::updateUIPropagAtt start");


                //FirstLine ==============================================>
                var firstLine = UWA.createElement('tr').inject(tbodyref);

                var infoCell = UWA.createElement('td', {
                    'colspan': '15',
                    'width': '75%',
                    'align': 'left'
                }).inject(firstLine);
                UWA.createElement('p', {
                    text : ParamSkeletonNLS.PropagationReloadText,
                    'class': ''
                }).inject(infoCell);
                var buttonCell = UWA.createElement('td', {
                    'colspan': '5',
                    'width': '25%',
                    }).inject(firstLine);
                var reloadBttn =  new Button({
                    className: 'primary',
                    id : 'reloadButtonX',
                    icon: 'archive',
                    attributes: {
                        disabled: false,
                        //title: ParamSkeletonNLS.IndexationTooltip,
                        text : ParamSkeletonNLS.PropagationReloadButton,
                        'title' : ParamSkeletonNLS.PropagationReloadTitle
                    },
                    events: {
                        onClick: function () {
                            Mask.mask(content.contentDiv);
                            that.callFindTypes(content);
                            //PropagationWebServices.findTypes.call(content, that.onSearchFailure.bind(that), that.onSearchSuccess.bind(that));
                        }
                    }
                }).inject(buttonCell);
                reloadBttn.getContent().setStyle("width", 150);

                //Header ============================================>
                var header = UWA.createElement('tr', {
                    'class': 'active'
                }).inject(tbodyref);
                var cellAllCheck = UWA.createElement('td', {
                    'width'  : '5%',
                    'align': 'left'
                }).inject(header);
                iController = new Toggle({
                    type: "checkbox",
                    className: "primary",
                    value: "",
                    'name' : "AllExtensions",
                    id : "Extensions",
                    disabled: false,
                    events: {
                        onChange: function() {
                            //content.userMessaging.add({ className: "message", message: "CheckBox Checked" });
                            that.onToggleClick.call(that,content,this);
                        }
                    }
                }).inject(cellAllCheck);
                //UWA.createElement('td', {
                //    'width' : '5%',
                //    'align':'left'
                //}).inject(header);
                var cellHeaderObj = UWA.createElement('td', {
                    'colspan': '7',
                    'width'  : '35%',
                    'align': 'left'
                }).inject(header);
                UWA.createElement('p', {
                    text: ParamSkeletonNLS.TypesNames,
                    'class': ''
                }).inject(cellHeaderObj);

                var cellHeaderOwner = UWA.createElement('td', {
                    'colspan': '7',
                    'width': '35%',
                    'align': 'left'
                }).inject(header);
                UWA.createElement('p', {
                    text: ParamSkeletonNLS.AttributesInfo,
                    'class': ''
                }).inject(cellHeaderOwner);

                var cellHeaderNumber = UWA.createElement('td', {
                    'colspan': '4',
                    'width': '20%',
                    'align': 'left'
                }).inject(header);
                UWA.createElement('p', {
                    text: ParamSkeletonNLS.PropagationNumber,
                    'class': ''
                }).inject(cellHeaderNumber);
                UWA.createElement('td', {
                    'width' : '5%',
                    'align':'left'
                }).inject(header);

                //Extensions Lines ==============================================================>
                listTypes.sort(function(a, b) {
                    var x = a.NLS,
                        y = b.NLS;
                    return ((x < y) ? -1 : ((x > y) ? 1 : 0));
                });
                for (var i=0; i<listTypes.length; i++) {           
                    var result = listTypes[i];
                    content.propagTypesArray.push(result)
                    var extensions,check,
                    name = result.Name,
                    //owner = result.extOwners,
                    nls = result.NLS,
                    total = result.Total,
                    lAtts = result.Attributes,
                    toTreat = result.Objects,
                    lExtensions = result.Extensions,
                    objets = total - toTreat,
                    myLine = UWA.createElement('tr').inject(tbodyref),
                    treated, atts;

                    if(toTreat == 0) {
                        treated = true;
                    }
                    else {
                        treated = false;
                        //S63:IR-656210-3DEXPERIENCER2019x If there is remaining objects after the attributes propagation we need to executen it as super admin
                        if(resultJSON) {
                            resultJSON.Results.forEach(function(myObj) {
                                if(myObj.typeName===name) {
                                    needAdminPropag=true;
                                }
                            });
                        }
                    }

                    imgCell = ParamLayoutUtilities.buildDeployStsCell(check, '5%', '2', 'right');//5%
                    if(!treated) {
                        imgCell.firstChild.setStyle("color", 'orange');
                    }

                    for(var j=0; j<lAtts.length; j++) {
                        if(j==0) {
                            atts = lAtts[j];
                            //ownersNls = owner[j].nls;
                        }
                        else {
                            atts = atts + ', ' + lAtts[j];
                            //ownersNls = ownersNls + ', ' + owner[j].nls;
                        }
                    }

                    for(var j=0; j<lExtensions.length; j++) {
                        if(j==0) {
                            extensions = lExtensions[j];
                            //ownersNls = owner[j].nls;
                        }
                        else {
                            extensions = extensions + ', ' + lExtensions[j];
                            //ownersNls = ownersNls + ', ' + owner[j].nls;
                        }
                    }

                    var cellObj = UWA.createElement('td', {
                        'width'  : '5%',
                        'align': 'left'
                    }).inject(myLine);
                    iController = new Toggle({
                        type: "checkbox",
                        className: "primary",
                        value: "",
                        'name': name,
                        //text: "test2",
                        //label: "...",
                        id : "Type" + i,
                        disabled: treated
                    }).inject(cellObj);
                    content.inputControls.push(iController);


                    var cellType = UWA.createElement('td', {
                    'colspan': '7',
                    'width': '35%',
                    'style':"vertical-align:middle",
                    'align': 'left'
                    }).inject(myLine);
                    UWA.createElement('label', {
                        text: nls,
                        'for':"Type" + i,
                        //'title': atts
                    }).inject(cellType);
                    this.linkPopoverSpan(cellType, name);

                    var cellAtt = UWA.createElement('td', {
                        'colspan': '7',
                        'width': '35%',
                        'align': 'left'
                    }).inject(myLine);
                    ParamLayoutUtilities.buildPopoverSpan(cellAtt, atts);
                    //UWA.createElement('p', {
                    //    text: ownersNls,
                    //    'class': '',
                    //    //'title': owners
                    //}).inject(cellOwner);
                    //this.linkPopoverSpan(cellOwner, owners);

                    var cellNbObj = UWA.createElement('td', {
                        'colspan': '4',
                        'width': '20%',
                        'align': 'left'
                    }).inject(myLine);
                    UWA.createElement('p', {
                        text: objets + ' / ' + total,
                        'class': '',
                        //'title': toTreat + ' ' +ParamSkeletonNLS.Missing
                    }).inject(cellNbObj);
                    this.linkPopoverSpan(cellNbObj, toTreat + ' ' +ParamSkeletonNLS.Missing);

                    imgCell.inject(myLine);
                }

                //Last Line ============================================================>
                var lastLine = UWA.createElement('tr').inject(tbodyref);

                var infoCell2 = UWA.createElement('td', {
                    'colspan': '15',
                    'width': '75%',
                    'align': 'left'
                    }).inject(lastLine);
                UWA.createElement('p', {
                    text : ParamSkeletonNLS.PropagationlastLine,
                    'class': ''
                    }).inject(infoCell2);

                var buttonCell2 = UWA.createElement('td', {
                    'colspan': '5',
                    'width': '25%',
                    }).inject(lastLine);
                var bindBttn =  new Button({
                    className: 'primary',
                    id : 'propagButtonX',
                    icon: 'archive',
                    attributes: {
                        disabled: false,
                        //title: ParamSkeletonNLS.IndexationTooltip,
                        text : ParamSkeletonNLS.PropagationAttachButton
                    },
                    events: {
                        // change event regarding IR-1022700-3DEXPERIENCER2024x
                        onClick: function () {
                            //that.propagateAtt(content, true);
                            //content.adminModal.show();
                            //FUN102019 21x FD03 : NZV : added new warning message
                            var data = {"theThat" : that,"content": content};
                            ParamLayoutUtilities.showContextualDeleteModal(widget.body, "delAttrModal", ParamSkeletonNLS.NewPropagateWrg+"\n"+ParamSkeletonNLS.NewPropagateWrgSec, 
                            ParamSkeletonNLS.YesText,  ParamSkeletonNLS.NoText, ParamSkeletonNLS.Warning+"!",that.propagateAtt, data);
                        }
                    }
                }).inject(buttonCell2);
                bindBttn.getContent().setStyle("width", 150);

                UWA.log("PropagationLayoutViewUtilities::updateUIPropagAtt end");

            },

            propagateAtt : function(data) {
                UWA.log("PropagationLayoutViewUtilities::propagateAtt start");
                var name, content=data.content,
                payload = [],
                that = data.theThat;
                content.inputControls.forEach(function (iInput) {
                    if (iInput.isChecked()==true){
                        name=iInput.elements.input.name;
                        content.propagTypesArray.forEach(function(myObj) {
                            if(myObj.Name===name) {
                                payload.push(myObj);
                            }

                        });
                    }
                });
                UWA.log(payload);
                Mask.mask(content.contentDiv);
                //ParameterizationWebServices.bindExt.call(this,payload,  //Appel du web service retournant les informations.
                //                this.onBindFailure.bind(this), this.onBindSuccess.bind(this));

                that.callPropagAtt(payload,content);
                UWA.log("PropagationLayoutViewUtilities::propagateAtt end");

            },

            callPropagAtt : function (iData, content) {
                PropagationWebServices.PropagAtt.call(content, iData, this.onPropagFailure.bind(this), this.onPropagSuccess.bind(this), this.onPropagTimeOut.bind(this));
            },

            callFindTypes : function (content,json) {

                if(content.payload == null) {
                    content.payload = json;
                }

                PropagationWebServices.findTypes.call(content, this.onSearchFailure.bind(this), this.onSearchSuccess.bind(this), this.onSearchTimeOut.bind(this));
            },

            onSearchFailure : function (content,json) {
                UWA.log(">>Search Extension Fail");
                UWA.log(json);
                content.userMessaging.add({ className: "error", message: ParamSkeletonNLS.ExtensionsSearchFailure });
                Mask.unmask(content.contentDiv);
            },

            onSearchTimeOut: function (content) {
                UWA.log(">>Search Extension Fail");
                //UWA.log(json);
                content.userMessaging.add({ className: "error", message: ParamSkeletonNLS.ExtensionsSearchTimeOut });
                Mask.unmask(content.contentDiv);
            },

            onSearchSuccess : function (content, json) {
                UWA.log(">>Search Extension Success");
                UWA.log(json);
                this.updateUIPropagAtt(json, content);
                Mask.unmask(content.contentDiv);
                //this.userMessaging.add({ className: "success", message: "Succes"});
            },

            onPropagFailure : function (content, json) {
                UWA.log(">>Bind att Fail");
                UWA.log(json);

                this.callFindTypes(content);
                content.userMessaging.add({ className: "error", message: ParamSkeletonNLS.AttributesPropagationFailure });
                content.adminModal.alert(ParamSkeletonNLS.PropagationWarningMessage, function () {
                    UWA.log('A sample alert message callback');
                });
                //Mask.unmask(this.contentDiv);
            },

            onPropagSuccess : function (content, json) {
                UWA.log(">>Bind att Success");
                UWA.log(json);

                this.callFindTypes(content,json);
                content.userMessaging.add({ className: "warning", message: ParamSkeletonNLS.AttributesPropagationSuccess });
                /*content.adminModal.alert(ParamSkeletonNLS.AttributesPropagationSuccess, function () {
                    UWA.log('A sample alert message callback');
                });*/
            },

            onPropagTimeOut : function (content) {
                UWA.log(">>Bind att Success");
                //UWA.log(message);

                this.callFindTypes(content);
                content.userMessaging.add({ className: "error", message: ParamSkeletonNLS.AttributesPropagationTimeOut });
                /*content.adminModal.alert(ParamSkeletonNLS.AttributesPropagationSuccess, function () {
                    UWA.log('A sample alert message callback');
                });*/
            },

            linkPopoverSpan : function (iContainerSpan, tooltipNlsTxt) {
                var popoverTooltip = new Popover({
                    target   : iContainerSpan,
                    trigger  : "hover",
                    animate  : "true",
                    position : "top",
                    body     : tooltipNlsTxt,
                    title    : ''
                });
            },

            onToggleClick : function (content,toggle) {
                if(toggle.isChecked()){
                    this.checkAll(content);
                }
                else{
                    this.unCheckAll(content);
                }
            },

            checkAll : function (content) {
                content.inputControls.forEach(
                    function (iInput) {
                        if(iInput.isDisabled()==false){
                            if (iInput.isChecked()==false){
                                iInput.check();
                            }
                            //iInput.dispatchEvent('onChange', content);//onClick
                        }
                    }
                );
            },

            unCheckAll : function (content) {
                content.inputControls.forEach(
                    function (iInput) {
                        if(iInput.isDisabled()==false){
                            if (iInput.isChecked()==true){
                                iInput.uncheck();
                            }
                            //iInput.dispatchEvent('onChange', content);//onClick
                        }
                    }
                );
            }
        };

        return UIview;
    });

/*@QuickReview NZV 18/06/20  Fixed alignment issues IR-574318-3DEXPERIENCER2019x IR-574334-3DEXPERIENCER2019x */
/*@fullReview  NZV 18/05/28  IR-600551-3DEXPERIENCER2019x */
/*@fullReview  NZV 17/03/02  FUN066122 Added comboboxmultiselect */
/*@fullReview  ZUR 15/07/29 2016xFD01 Param Widgetization NG*/
/*global define, widget, document, setTimeout, console, clearTimeout, FileReader*/
/*jslint plusplus: true*/
/*jslint nomen: true*/
define('DS/ParameterizationSkeleton/Views/ParametersLayoutView',
    [
        'UWA/Core',
        'UWA/Class/View',
        'DS/UIKIT/Input/Button',
        'DS/UIKIT/Input/Select',
        'DS/UIKIT/Input/Text',
        'DS/UIKIT/Input/Toggle',
        'DS/UIKIT/Modal',
        'DS/UIKIT/Alert',
        'DS/UIKIT/Popover',
        'DS/UIKIT/Mask',
        'DS/UIKIT/Scroller',
        'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
        'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
        'DS/ParameterizationSkeleton/Utils/ParameterizationWebServices',
        'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
        'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS',
        'DS/ParameterizationSkeleton/Views/PropagationLayoutViewUtilities'
    ],
    function (UWA, View,
              Button, Select, Text, Toggle,
              Modal,
              Alert, Popover, Mask, Scroller,
              URLHandler, ParameterizationDataUtils, ParameterizationWebServices,
              ParamLayoutUtilities,
              ParamSkeletonNLS, PropagLayoutUtilities) {

        'use strict';

        var extendedView;

        extendedView = View.extend({
            tagName: 'div',
            className: 'generic-detail',

            init: function (options) {
                UWA.log('ParametersLayoutView::init');
                UWA.log(options);
                var initDate =  new Date(),
                    ConnectStruct = ParameterizationDataUtils.paramStructBuilder("domainName,tenantID,env_url");

                options = UWA.clone(options || {}, false);

                this._parent(options);
                this.wdgAccordion = null;
                this.contentDiv = null;
                this.inputControls = [];
                this.paramScroller = null;
                this.userMessaging = null;
                this.userDeployMessaging = null;
                this.lastAlertDate = initDate.getTime();
                this.resetModal = null;
                this.controlDiv = null;
                //NZV - IR-574318-3DEXPERIENCER2019x
                this.columnWidthArray = [60, 5, 25, 10];//[65, 20, 5, 10];
                this.columnLine = null;
                this.ArrayView = false;

                this.connectProps = new ConnectStruct();

                this.custoNamingsArray = [];//Naming
                this.forbiddenNamings = [];//Naming
                this.warnArrays = [];//Naming
                this.commonNamingElts = [];//Naming
                this.nbofShownParameters = 0;
                this.RevMsgTime = 0;
                this.handledFamily = "";
                this.custoAutoExtArray = [];
                this.propagTypesArray = [];
                this.adminModal = null;
                this.ErrorMsgPopup = null;
                this.resetIsCalled = false;////IR-728233-3DEXPERIENCER2020x\21x
                //FUN095483
                this.lstRevNamIconModified = [/*{id : idOfPolicy, inputElement : control, imageCell : imageCellVal}*/];

                //URLHandler.setURL("https://vdevpril807dsy.ux.dsone.3ds.com:443/3DSpace/");
                //URLHandler.setURL("https://dsdev034-euw1-18dna10916-space.3dexperience.3ds.com/enovia/");
            },

            setup: function(options) {
                UWA.log('ParametersLayoutView::setup!');
                UWA.log(options);
            },

            render: function () {
                UWA.log("ParametersLayoutView::render");
                var introDiv,
                    that = this,
                    activateApply = false;

                this.contentDiv =  UWA.createElement('div', {
                    'id': 'mainParamDiv'
                });

                Mask.mask(this.contentDiv);

                this.userMessaging = new Alert({
                    className : 'param-alert',
                    closable: true,
                    visible: true,
                    renderTo : document.body,
                    autoHide : true,
                    hideDelay : 2500,
                    messageClassName : 'warning'
                });

                this.userDeployMessaging = new Alert({
                    className : 'param-alert',
                    closable: true,
                    visible: true,
                    renderTo : document.body,
                    autoHide : true,
                    hideDelay : 5000,
                    messageClassName : 'warning'
                });

                introDiv = ParamLayoutUtilities.createInfoDiv(that.model.get("introduction"));
                introDiv.inject(this.contentDiv);
                //FUN095483
                if ("ObjectIdentifier" === this.model.get("familyid") || "VersionNaming" === this.model.get("familyid")) {
                    activateApply = true;
                }

                this.connectProps.domainName = this.model.get("domainid");
                this.connectProps.tenantID   = URLHandler.getTenant();
                this.connectProps.env_url    = URLHandler.getURL();

                //this.createApplyResetToolbar(this.contentDiv, activateApply);
                if ((this.model.get("domainid") !== "Deployment")) {
                    this.controlDiv = ParamLayoutUtilities.createApplyResetToolbar.call(this, this.contentDiv, activateApply,
                                                                  this.applyParams.bind(this), this.confirmationModalShow.bind(this));
                }

                this.container.setContent(this.contentDiv);

                this.listenTo(this.collection, {
                    onSync: that.onCompleteRequestParameters
                });

                /*if ((this.model.get("domainid") !== "Deployment")) {
                    UWA.log("Where do you think we are ?!");
                    this.listenTo(this.collection, {
                        onSync: that.onCompleteRequestParameters
                    });
                } else {
                    that.launchtest();
                }*/

                return this;
            },

            onCompleteRequestParameters : function() {
                UWA.log("onCompleteRequestParameters::");
                var i, iFamilies, nbofFamilies, iContent, paramsDIV, iParamAccordion,
                    familyposition = "mid";

                paramsDIV = ParamLayoutUtilities.createParamsContainerDiv();
                paramsDIV.inject(this.contentDiv);
                //
                UWA.log(this.collection._models[0]._attributes);

                if (this.model.get("domainid")  !== "Deployment") {

                    iFamilies = this.collection._models[0]._attributes.family;
                    nbofFamilies = iFamilies.length;

                    if (nbofFamilies === 1) {
                        iContent = this.buildFamilyItemContent(iFamilies[0], familyposition);
                        iContent.inject(paramsDIV);
                    } else {
                        iParamAccordion = ParamLayoutUtilities.createFamilyUIKITAccordion(paramsDIV);

                        for (i = 0; i < nbofFamilies; i++) {
                            familyposition = "mid";
                            if (i === 0) {
                                familyposition = "first";
                            } else if (i === nbofFamilies - 1) {
                                familyposition = "last";
                            }
                            iContent = this.buildFamilyItemContent(iFamilies[i], familyposition);
                            iParamAccordion.addItem({
                                title: iFamilies[i].nlsKey,
                                content: iContent,
                                selected : true,
                                name : iFamilies[i].id
                            });
							//IR-670134-3DEXPERIENCER2019x
							iParamAccordion.getItem(i).elements.content.setStyle('overflow-y','visible');
                        }
                    }

                    if (this.nbofShownParameters === 0) {
                        ParamLayoutUtilities.createParamMask(this.contentDiv, ParamSkeletonNLS.NoParamAvailabletxt);
                    }
                } else {
                    this.buildDeploymentTab();
                }

                this.paramScroller = new Scroller({
                    element: paramsDIV
                }).inject(this.contentDiv);

                UWA.log('unmask');
                Mask.unmask(this.contentDiv);
            },

            buildFamilyItemContent : function(iFamily, familyPosition) {
                var familyTable, ftbody;

                familyTable = UWA.createElement('table', {
                    'class': 'table table-hover',
                    'table-layout': 'fixed', //NZV-IR-574318-3DEXPERIENCER2019x
                    'id': iFamily.id + 'familytable'
                });

                ftbody =  UWA.createElement('tbody', {
                    'class': 'fparamtbody',
                    'id': iFamily.id + 'familytbody'
                }).inject(familyTable);

                if (iFamily.id == "ObjectIdentifier") {// NZV IR-548508-3DEXPERIENCER2018x\17x
                    iFamily.parameter.sort(ParamLayoutUtilities.compareContentNamingObject);
                    this.processIDFamily(iFamily, ftbody);
                } else {
                    this.buildParametersLayout(iFamily, ftbody, familyPosition);
                }

                return familyTable;
            },

            buildParametersLayout : function (iElements, familytbody, familyPosition) {

                var i, popoverPosition,
                    familyID = iElements.id,
                    listfofParams = iElements.parameter,
                    nbofRows = listfofParams.length;

                this.handledFamily = familyID;

                /*//ZUR Proto : Array view
                if ((iElements.column !== undefined)
                        && (iElements.column !== null)
                           && (iElements.column.length > 0)) {
                    //listofColumns = iElements.column;
                    this.columnWidthArray = ParamLayoutUtilities.computeColumnsWidths(iElements.column, this.columnWidthArray);
                    this.columnLine = ParamLayoutUtilities.buildColumnsTitleLine(iElements.column, this.columnWidthArray);//BuiltTitle
                    this.columnLine.inject(familytbody);
                    this.ArrayView = true;

                    for (i = 0; i < nbofRows; i++) {
                        popoverPosition = ParamLayoutUtilities.computePopoverPos(i, familyPosition, nbofRows);
                        this.buildParameterLineV2(listfofParams[i], familytbody, popoverPosition);
                        this.nbofShownParameters++;
                    } // of for
                }*/

                if (this.ArrayView === false) {
                    for (i = 0; i < nbofRows; i++) {
                        popoverPosition = ParamLayoutUtilities.computePopoverPos(i, familyPosition, nbofRows);
                        this.buildParameterLine(listfofParams[i], familyID, familytbody, popoverPosition);
                        this.nbofShownParameters++;
                    } // of for
                }

            },//of function

            onKeyDownTextField : function (event) {
               // ParamLayoutUtilities.beingModified(imgCell, ParamSkeletonNLS.ParamBeingModified, '2');
                UWA.log(event);
            },

            /* //ZUR : Proto : Arraw View
            buildParameterLineV2 : function (iParamObj, familytbody, popoverPosition) {

                var i, j, k, iArgument, newParamline, iArgumentList,
                    imgCell, ParamTextCell, imgInfoSpan, ParamInfoCell,
                    popoverTooltip, unit2Display, unitCell,
                    nbofValuesForArg, listofValues, isSelected, controlObjectCell,
                    isArgumentFound = false,
                    that = this,
                    //onChangeToggle, onChangetextfield,onKeyDownTextField, onChangeSelect,
                    iController;

                function onChangeToggle(iController, controlObjectCell, imgCell) {
                    var valuetoSend = iController.isChecked() ? "Enabled" : "Disabled";
                    ParamLayoutUtilities.beingDeployed(imgCell, ParamSkeletonNLS.ParamBeingModified);
                    that.updateParameterOnChange(valuetoSend, controlObjectCell, imgCell);
                }

                function onChangetextfield(iController, controlObjectCell, imgCell) {
                    ParamLayoutUtilities.beingModified(imgCell, ParamSkeletonNLS.ParamBeingModified, '2');
                    that.checkParameterValueOnChange(iController, controlObjectCell, imgCell);
                }

                function onChangeSelect(iController, controlObjectCell, imgCell) {
                    ParamLayoutUtilities.beingModified(imgCell, ParamSkeletonNLS.ParamBeingModified, '2');
                    that.updateRevisioningParameterOnChange(iController, controlObjectCell, imgCell);
                }

                newParamline = UWA.createElement('tr', {title: ''});//iParamObj.tooltipNlsKey

                imgCell = ParamLayoutUtilities.buildDeployStsCell(iParamObj.isDeployed, that.columnWidthArray[3].toString() + '%', '2', 'right');//5%

                ParamTextCell = UWA.createElement('td', {
                    'width' : that.columnWidthArray[0].toString() + '%',
                    'title' : ''
                });
                ParamTextCell.setStyle("vertical-align", "text-bottom");
                UWA.createElement('p', {text: iParamObj.nlsKey, 'class': ''}).inject(ParamTextCell);

                ParamInfoCell = UWA.createElement('td', {
                    'width' : that.columnWidthArray[1].toString() + '%',
                    'align' : 'left'
                });
                ParamInfoCell.setStyle("vertical-align", "text-bottom");

                imgInfoSpan = UWA.createElement('span', {
                    'class' : 'fonticon fonticon-info'
                }).inject(ParamInfoCell);

                imgInfoSpan.setStyle("color", "black");

                popoverTooltip = new Popover({
                    target   : imgInfoSpan,
                    trigger  : "hover",
                    animate  : "true",
                    position : popoverPosition,
                    body     : iParamObj.tooltipNlsKey,
                    title    : ''
                });

                iArgumentList = iParamObj.argument;
                isArgumentFound = false;

                ParamTextCell.inject(newParamline);
                ParamInfoCell.inject(newParamline);

                for (i = 2; i < this.columnLine.childNodes.length - 1; i++) {
                    isArgumentFound = false;
                    for (k = 0; k < iArgumentList.length; k++) {
                        iArgument = iParamObj.argument[k];
                        if (iArgument.id === this.columnLine.childNodes[i].id) {
                        //Add the td
                            UWA.log('id found!!');
                            isArgumentFound = true;
                            //iArgument = iParamObj.argument[0];

                            controlObjectCell = ParamLayoutUtilities.buildControlCell(iParamObj.id, iArgument, that.columnWidthArray[2].toString() + '%');
                            //controlObjectCell.push(tempCell);
                            //var currListLength = controlObjectCell.length;

                            if (iArgument.input === "checkbox") {
                                //NZV-IR-574334-3DEXPERIENCER2019x
                                controlObjectCell.setStyle("vertical-align", "middle");
                                controlObjectCell.setStyle("padding-top", "3px");
                                iController = new Toggle({
                                    type: "checkbox",
                                    className: "primary",
                                    value: "",
                                    //label: "...",
                                    id : iParamObj.id + iArgument.id,
                                    disabled: false,
                                    checked: iArgument.argValue == "Enabled" ? true : false
                                        //onChange: function() {} onClick
                                }).inject(controlObjectCell);
                                //iController.addEvent("onChange", onChangeToggle(iController, controlObjectCell, imgCell));
                                //iController[iController.length - 1].inject(controlObjectCell[currListLength - 1]);
                                /*var myEventListener = {
                                        myProperty : 'event listener',
                                        handleEvent : function (event) {
                                            //UWA.log('"this" is scoped to this ' + this.myProperty);
                                            onChangeToggle(iController, controlObjectCell, imgCell);
                                        }
                                };

                                iController.addEvent("onChange", myEventListener); +/

/*
                                iController.addEvent("onChange", function() {
                                    onChangeToggle(iController, controlObjectCell, imgCell);
                                });+/

                             //   iController.addEvent("onChange", onChangeToggle(iController, controlObjectCell, imgCell));

                            } else if (iArgument.input === "textfield") {
                                //controlObjectCell[currListLength - 1].setStyle("width", "20%");
                                //controlObjectCell.setStyle("width", "20%");
                                iController = new Text({
                                    className: "form-control",
                                    placeholder: "...",
                                    id : iParamObj.id + iArgument.id,
                                    attributes: {
                                        value: iArgument.argValue,
                                        multiline: false,
                                        disabled: false
                                    }
                                    /*events: {
                                        onChange: function () {
                                            ParamLayoutUtilities.beingModified(imgCell, ParamSkeletonNLS.ParamBeingModified, '2');
                                            that.checkParameterValueOnChange(this, controlObjectCell[currListLength - 1], imgCell);
                                        },
                                        onKeyDown: function () {
                                            ParamLayoutUtilities.beingModified(imgCell, ParamSkeletonNLS.ParamBeingModified, '2');
                                        }
                                    }+/
                                }).inject(controlObjectCell);

                               //iController.addEvent("onChange",  onChangetextfield(iController, controlObjectCell, imgCell));
                               // iController.addEvent("onKeyDown", that.onKeyDownTextField());

                                /* iController.addEvent("onKeyDown", function() {
                                    that.onKeyDownTextField(event, imgCell);
                                    });+/
                                //iController[iController.length - 1].inject(controlObjectCell[currListLength - 1]);

                                unit2Display = iParamObj.nlsKey;
                                unitCell = UWA.createElement('td', {
                                    'width': '25%',
                                    'align': 'left',
                                    'html' : unit2Display,
                                    'title': unit2Display
                                });
                                unitCell.setStyle("vertical-align", "text-bottom");
                            } else if (iArgument.input === "combobox") {
                                iController = new Select({
                                    placeholder: false,
                                    nativeSelect: true,
                                    attributes: {
                                        id : iParamObj.id + iArgument.id,
                                        name : iParamObj.id + iArgument.id,
                                        disabled: false
                                    }
                                }).inject(controlObjectCell);//of selectControler

                                iController.getContent().setStyle("width", "100%");
                                //controlObjectCell.set({'title' : iArgument.tooltipNlsKey});//  change it
                                listofValues = iArgument.value;
                                nbofValuesForArg = listofValues.length;
                                for (j = 0; j < nbofValuesForArg; j++) {
                                    isSelected = false;

                                    if (iArgument.argValue == listofValues[j].id) {
                                        isSelected = true;
                                    }

                                    iController.add([{
                                        label: listofValues[j].nlsKey,
                                        value: listofValues[j].id,
                                        selected: isSelected
                                    }], false);
                                }

                                /*iController.addEvent("onChange", function () {
                                    ParamLayoutUtilities.beingModified(imgCell, ParamSkeletonNLS.ParamBeingModified, '2');
                                    that.updateRevisioningParameterOnChange(this, controlObjectCell,imgCell);
                                });+/
                               // iController.addEvent("onChange", onChangeSelect(iController, controlObjectCell, imgCell));
                            } // of  else if (iArgument.input == "combobox")

                            this.inputControls.push(iController);
                            controlObjectCell.inject(newParamline);
                        }//of if arg.id == column.id
                    }

                    if (isArgumentFound === false) {
                        UWA.createElement('td', {
                            'width' : that.columnWidthArray[2].toString() + '%',
                            'align' : 'left'
                        }).inject(newParamline);
                    }
                }

                /*if (iArgument.input === "textfield") {
                    unitCell.inject(newParamline);
                }+/

                imgCell.inject(newParamline);
                newParamline.inject(familytbody);//familyparamtable
            },*/


            buildParameterLine : function (iParamObj, familyID, familytbody, popoverPosition) {

                var j, iArgument, newParamline,
                    imgCell, ParamTextCell, imgInfoSpan, ParamInfoCell, paramTxtToShow,
                    popoverTooltip, controlObjectCell, unit2Display = "", unitCell,
                    iController, nbofValuesForArg, listofValues, isSelected, valuetoSend,
                    bMultiple, bCustom, listOfArg, textfieldTbl, firstTDWidth, firstCol,
                    that = this;

                newParamline = UWA.createElement('tr', {title: ''});//iParamObj.tooltipNlsKey

                iArgument = iParamObj.argument[0];

                imgCell = ParamLayoutUtilities.buildDeployStsCell(iParamObj.isDeployed, that.columnWidthArray[3].toString() + '%', '2', 'right');//5%

                ParamTextCell = UWA.createElement('td', {
                    'width' : that.columnWidthArray[0].toString() + '%',
                    'title' : ''
                });
                ParamTextCell.setStyle("vertical-align", "text-bottom");//iParamObj iArgument

                paramTxtToShow = iArgument.nlsKey;

                if (iArgument.input === "combobox" || iArgument.input === "comboboxmultiselect") {
                    paramTxtToShow = iParamObj.nlsKey;
                }
                UWA.createElement('p', {text: paramTxtToShow,  'class': ''}).inject(ParamTextCell);

                ParamInfoCell = UWA.createElement('td', {
                    'width' : that.columnWidthArray[1].toString() + '%',
                    'align' : 'left'
                });
                ParamInfoCell.setStyle("vertical-align", "text-bottom");

                imgInfoSpan = UWA.createElement('span', {
                    'class' : 'fonticon fonticon-info'
                }).inject(ParamInfoCell);

                imgInfoSpan.setStyle("color", "black");

                popoverTooltip = new Popover({
                    target   : imgInfoSpan,
                    trigger  : "hover",
                    animate  : "true",
                    position : popoverPosition,
                    body     : iArgument.tooltipNlsKey,
                    title    : ''
                });

				//IR-865947-3DEXPERIENCER2022x : increase tooltip width.
				popoverTooltip.elements.container.setStyle("max-width", "400px");
                controlObjectCell = ParamLayoutUtilities.buildControlCell(iParamObj.id, iArgument, that.columnWidthArray[2].toString() + '%');

                if (iArgument.input === "checkbox") {
                     //NZV-IR-574334-3DEXPERIENCER2019x
                    controlObjectCell.setStyle("vertical-align", "middle");
                    controlObjectCell.setStyle("padding-top", "3px");
                    iController = new Toggle({
                        type: "checkbox",
                        className: "primary",
                        value: "",
                        //label: "...",
                        id : iParamObj.id,
                        disabled: false,
                        checked: iArgument.argValue == "Enabled" ? true : false,

                        events: {
                            onChange: function () {
                                ParamLayoutUtilities.beingDeployed(imgCell, ParamSkeletonNLS.ParamBeingModified);
                                valuetoSend = this.isChecked() ? "Enabled" : "Disabled";
                                that.updateParameterOnChange(valuetoSend, controlObjectCell, imgCell);
                            }
                            //onChange: function() {} onClick
                        }
                    }).inject(controlObjectCell);
                } else if (iArgument.input === "textfield") {
                    //NZV-IR-574318-3DEXPERIENCER2019
                    unit2Display = iParamObj.nlsKey;
                    textfieldTbl = UWA.createElement('table', {'title': ""
                            }).inject(controlObjectCell);
                    firstTDWidth = '100%';
                    if (unit2Display !== "") {
                        firstTDWidth = '90%';
                    }
                    firstCol = UWA.createElement('td', {
                        'width': firstTDWidth,
                        'align': 'right'
                    }).inject(textfieldTbl);
                    iController = new Text({
                        className: "form-control",
                        placeholder: "...",
                        id : iParamObj.id,
                        attributes: {
                            value: iArgument.argValue,
                            multiline: false,
                            disabled: false
                        },
                        events: {
                            onChange: function () {
                                ParamLayoutUtilities.beingModified(imgCell, ParamSkeletonNLS.ParamBeingModified, '2');
                                that.checkParameterValueOnChange(this, controlObjectCell, imgCell);
                            },
                            onKeyDown: function () {
                                ParamLayoutUtilities.beingModified(imgCell, ParamSkeletonNLS.ParamBeingModified, '2');
                            }
                        }
                    }).inject(firstCol);

                    unit2Display = iParamObj.nlsKey;
                    if (unit2Display !== "") {
                        unitCell = UWA.createElement('td', {
                            'width': '10%',
                            'align': 'left',
                            'html' : unit2Display,
                            'title': unit2Display
                        });
                        unitCell.setStyle("vertical-align", "text-bottom");
                        unitCell.setStyle("padding-left", "5px");
                    }
                } else if (iArgument.input === "combobox") {
                    iController = new Select({
                        placeholder: false,
                        nativeSelect: true,
                        attributes: {
                            id : iParamObj.id,
                            name : iParamObj.id,
                            disabled: false
                        }
                    });//of selectControler
                    iController.getContent().setStyle("width", "100%");//NZV-IR-574318-3DEXPERIENCER2019x
                    //controlObjectCell.set({'title' : iArgument.tooltipNlsKey});//  change it
                    listofValues = iArgument.value;
                    nbofValuesForArg = listofValues.length;
                    for (j = 0; j < nbofValuesForArg; j++) {
                        isSelected = false;

                        if (iArgument.argValue == listofValues[j].id) {
                            isSelected = true;
                        }

                        iController.add([{
                            label: listofValues[j].nlsKey,
                            value: listofValues[j].id,
                            selected: isSelected
                        }], false);
                    }

                    iController.addEvent("onChange", function () {
                        ParamLayoutUtilities.beingModified(imgCell, ParamSkeletonNLS.ParamBeingModified, '2');
                        //FUN095483
                        if (familyID === "VersionNaming") {
                            //[{id : this.elements.input.id, imageCell : imageCellVal, control : controlObjectCell}]
                            var elemAlreadyExist = false;
                            that.lstRevNamIconModified.forEach(function (elem) {
                                if (elem.id === controlObjectCell.getData('argumentNode').paramid) {
                                    elemAlreadyExist = true;
                                }
                            });
                            if(elemAlreadyExist === false) {
                                var objBeingModified = {
                                    "id" : controlObjectCell.getData('argumentNode').paramid, "imageCell" : imgCell, "inputElement" : this
                                };
                                that.lstRevNamIconModified.push(objBeingModified);
                            }
                            that.updateRevisioningParameterOnChange(this, controlObjectCell, imgCell);
                        } else {
                            that.updateComboParamOnChange(this, controlObjectCell, imgCell);
                        }
                    });

                    iController.inject(controlObjectCell);
                    // of  else if (iArgument.input == "combobox")
                } else if (iArgument.input === "comboboxmultiselect") {
                    bMultiple = true;
                    bCustom = true;
                    iController = new Select({
                        placeholder: false,
                        nativeSelect: true,
                        multiple: bMultiple,
                        custom: bCustom,
                        attributes: {
                            id : iParamObj.id,
                            name : iParamObj.id,
                            disabled: false
                        }
                    });//of selectControler
                    //NZV-IR-574318-3DEXPERIENCER2019x
                    iController.getContent().setStyle("width", "100%");
                    listofValues = iArgument.value;
                    listOfArg = null;
                    if (iArgument.argValue.indexOf(",") > 0) {
                        listOfArg = iArgument.argValue.split(",");
                    } else {
                        listOfArg = [iArgument.argValue];
                    }
                    nbofValuesForArg = listofValues.length;
                    for (j = 0; j < nbofValuesForArg; j++) {
                        isSelected = false;
                        if (listOfArg != null) {
                            listOfArg.forEach(function (item) {
                                if (item == listofValues[j].id) {
                                    isSelected = true;
                                }
                            });
                        }

                        iController.add([{
                            label: listofValues[j].nlsKey,
                            value: listofValues[j].id,
                            selected: isSelected
                        }], false);
                    }

                    iController.addEvent("onChange", function () {
                        ParamLayoutUtilities.beingModified(imgCell, ParamSkeletonNLS.ParamBeingModified, '2');
                        that.updateComboParamOnChange(this, controlObjectCell, imgCell);
                    });

                    iController.inject(controlObjectCell);
                }
             // of  else if (iArgument.input == "comboboxmultiselect")
                this.inputControls.push(iController);

                ParamTextCell.inject(newParamline);
                ParamInfoCell.inject(newParamline);
                controlObjectCell.inject(newParamline);

                if (iArgument.input === "textfield" && unit2Display !== "") {
                    unitCell.inject(textfieldTbl);
                }

                imgCell.inject(newParamline);
                newParamline.inject(familytbody);//familyparamtable
            },

            processIDFamily : function (iFamilyObject, ftbody) {
                var i, j, k, l,
                    iParam, iArg, iType, nbofctes, nbofArgs, nbofValuesForArg, currAppType, labelAffixcell,
                    affixvaluetoshow, iPrefixVal, iSuffixVal, iPrefixDefVal, iSuffixDefVal, internalType,
                    iFamilyToolTip = iFamilyObject.tooltipNlsKey,
                    nbofParamofNamings = iFamilyObject.parameter.length,
                    wdgDeployIndicator = true,
                    cellLabel, controlObjectCellPreview, controlObjectCell, labelSepcell, iVal, trsfVal,
                    lineParam, imgSpan, imgCell, initialPreview,
                    prefixField, suffixField, affixField, sepControler, finalformatinput, initPreftoShow, initSufftoShow,
                    selectControler, isSelected, iTypeNLS,
                    imgTitle = ParamSkeletonNLS.deployedParamtxt,
                    imgClass = 'fonticon fonticon-2x fonticon-check',
                    iconColor = "#57B847",//'green',//IR-772358-3DEXPERIENCER2021x
                    optionsSepArray = [],//new Array(); iFamilyNLS = iFamilyObject.nlsKey,
                    constantArray = [],
                    separatorValue = "-",
                    isCommonParamsDeployed = "true",
                    isNamingParamDeployed = "true",
                    sepElt = ParameterizationDataUtils.paramStructBuilder("id,nlsKey,value"),
                    CteElt = ParameterizationDataUtils.paramStructBuilder("id,value"),
                    NamingElement       = ParameterizationDataUtils.paramStructBuilder("namingID,initialValue,defaultValue,currentValue"),
                    CustoNamingElement  = ParameterizationDataUtils.paramStructBuilder("objTypeID,prefix,suffix,defprefix,defsuffix,appType,deploySts"),
                    WarningLabel = ParameterizationDataUtils.paramStructBuilder("warnID", "warnRaised"),
                    separatorContainer, affixContainer, timerconn,
                    jmin = -1, isTypeSelected = false,
                    popOver = null, imgInfoSpan = null, tooltipCell = null, preFixTooltipCell = null,
                    prefixPopOver = null, prefixImgInfoSpan = null,
                    that = this;

                //1st line : preview line
                lineParam = UWA.createElement('tr', {title: ''}).inject(ftbody);

                cellLabel = UWA.createElement('td', {'width': '30%', 'title': ''}).inject(lineParam);
                UWA.createElement('p', {text: ParamSkeletonNLS.PreviewTxt, 'class': ''}).inject(cellLabel);

                controlObjectCellPreview = UWA.createElement('td', {
                    'width' : '30%',
                    'title' : '',
                    'align' : 'left'
                }).inject(lineParam);

                imgCell = UWA.createElement('td', {
                    'width' : '40%',
                    'title' : '',
                    'id' : 'nameDeployIndicator',
                    align : 'left'
                }).inject(lineParam);

                //1st line bis : Formula Line
                lineParam = ParamLayoutUtilities.buildFormulaLine();
                lineParam.inject(ftbody);

                this.nbofShownParameters = nbofParamofNamings;

                for (j = 0; j < nbofParamofNamings; j++) {
                    iParam = iFamilyObject.parameter[j];

                    if (iParam.id === "IdentifierAffix") {
                        isCommonParamsDeployed = iParam.isDeployed;
                        //getconstants
                        nbofctes = iParam.constant.length;
                        for (l = 0; l < nbofctes; l++) {
                            constantArray[l] = new CteElt(iParam.constant[l].id, iParam.constant[l].value);
                        }

                        nbofArgs = iParam.argument.length;
                        for (k = 0; k < nbofArgs; k++) {
                            if ("AffixArg" === iParam.argument[k].id) {
                                iArg = iParam.argument[k];

                                affixContainer = new NamingElement("IdentifierAffix",
                                        iArg.argValue, iArg.defaultValue,
                                        iArg.argValue);
                                this.commonNamingElts.push(affixContainer);
                            } else if ("SeparatorArg" === iParam.argument[k].id) {
                                iArg = iParam.argument[k];
                                separatorValue = iArg.argValue;
                                nbofValuesForArg = iArg.value.length;

                                for (i = 0; i < nbofValuesForArg; i++) {
                                    iVal = iParam.argument[k].value[i];
                                    trsfVal = iVal.id;

                                    for (l = 0; l < nbofctes; l++) {
                                        if (constantArray[l].id == iVal.id) {
                                            trsfVal =   constantArray[l].value;
                                            break;
                                        }
                                    }

                                    optionsSepArray[i] = new sepElt(trsfVal, iVal.nlsKey, iVal.tooltipNlsKey);
                                    separatorContainer = new NamingElement("SeparatorArg",
                                            separatorValue,
                                            iArg.defaultValue,
                                            separatorValue);
                                    this.commonNamingElts.push(separatorContainer);
                                }//of for loop on the args
                            }//on the if else : iParam.argument[k].id
                        }//of the for loop on the number of args
                        break;
                    }//if (iParam.id == "IdentifierAffix")
                }//of the first loop on the naming params

                if (isCommonParamsDeployed == "false") { wdgDeployIndicator = false; }

                affixvaluetoshow = affixContainer.initialValue;
                if (affixvaluetoshow === "TBD") { affixvaluetoshow = ""; }

                //2nd line Select Object Type Line
                lineParam = UWA.createElement('tr', {title: ''}).inject(ftbody);
                cellLabel = UWA.createElement('td', {'width' : '30%', 'title' : ''}).inject(lineParam);
                UWA.createElement('p', {text: ParamSkeletonNLS.ObjectTypeTxt, 'class' : ''}).inject(cellLabel);
                controlObjectCell = UWA.createElement('td', {'width': '70%', 'colspan': '2', 'title': ''}).inject(lineParam);

                selectControler = new Select({
                    placeholder: false,
                    nativeSelect: true,
                    attributes: {
                        id       : 'iTypeSelect',
                        disabled : false
                    }
                });

                selectControler.getContent().setStyle("width", 300);
                this.inputControls.push(selectControler);

                for (j = 0; j < nbofParamofNamings; j++) {
                    iParam = iFamilyObject.parameter[j];
                    iType = iParam.id;
                    isTypeSelected = false;

                    if (iParam.id != "IdentifierAffix") {
                        isNamingParamDeployed = iParam.isDeployed;
                        iTypeNLS = iParam.nlsKey;

                        if (jmin === -1) {//ZUR
                            jmin = j;
                            isTypeSelected = true;//IR-559116-3DEXPERIENCER2018x
                        }

                        selectControler.add([{
                            label: iTypeNLS,
                            value: iType,
                            selected : isTypeSelected
                        }], false);

                        nbofArgs = iParam.argument.length;
                        if (nbofArgs === 2) {
                            for (l = 0; l < nbofArgs; l++) {
                                iArg = iParam.argument[l];
                                if ("PrefixArg" === iArg.id) {
                                    iPrefixVal = iArg.argValue;
                                    iPrefixDefVal = iArg.defaultValue;
                                } else if ("SuffixArg" === iArg.id) {
                                    iSuffixVal = iArg.argValue;
                                    iSuffixDefVal = iArg.defaultValue;
                                }
                            }//of for loop
                        //of if nbarg == 2
                        } else { UWA.log("Houston, we have a problem!"); }

                        nbofctes = iParam.constant.length;
                        currAppType = "VPM";

                        for (l = 0; l < nbofctes; l++) {
                            if (iParam.constant[l].id === "appType") {
                                currAppType = iParam.constant[l].value;
                            } else if (iParam.constant[l].id === "type") {
                                internalType = iParam.constant[l].value;
                            }
                        }
                        //iArgument.nlsKey,iParamObj.id,iArgument.tooltipNlsKey
                        this.custoNamingsArray.push(new CustoNamingElement(iType,
                                                                        iPrefixVal, iSuffixVal,
                                                                        iPrefixDefVal, iSuffixDefVal,
                                                                        currAppType,
                                                                        isNamingParamDeployed));

                        if (currAppType === "VPM") { this.forbiddenNamings.push(internalType); }

                        if (isTypeSelected === true) {//ZUR - IR-559116-3DEXPERIENCER2018x
                            initPreftoShow = iPrefixVal;
                            initSufftoShow = iSuffixVal;
                        }

                        if (isNamingParamDeployed == "false") { wdgDeployIndicator = false; }

                    }//of if (iParam.id != "IdentifierAffix")
                } //of the 2nd loop on the naming params
                selectControler.inject(controlObjectCell);

                selectControler.addEvent("onChange", function () {
                    that.selectedTypeChanged(this);
                });

                //3rd line : Prefix Line
                lineParam = UWA.createElement('tr', {title: ''}).inject(ftbody);
                cellLabel = UWA.createElement('td', {'width': '30%', 'title': ''}).inject(lineParam);
                UWA.createElement('p', {text: ParamSkeletonNLS.Prefix, 'class': ''}).inject(cellLabel);
                controlObjectCell = UWA.createElement('td', {'width': '30%', 'title': ''}).inject(lineParam);

                prefixField = new Text({
                    placeholder: ParamSkeletonNLS.EmptyValueNotAllowed,
                    attributes: {
                        id : 'prefixInput',
                        value: initPreftoShow,
                        multiline: false,
                        disabled: false
                    },
                    events: {
                        onKeyDown: function () {
                            if (timerconn) { clearTimeout(timerconn); }
                            timerconn = setTimeout(function() {
                                var typeSelector, currSelectedOpt, selectedTypeLabel, cNamingElt;
                                if ((prefixField.getValue()).trim() === "") {
                                    typeSelector = ParamLayoutUtilities.getNamingControlInput(that.inputControls, "iTypeSelect");
                                    currSelectedOpt = typeSelector.getSelection();
                                    selectedTypeLabel = currSelectedOpt[0].label;
                                    cNamingElt = ParamLayoutUtilities.getCustoNamingElement(that.custoNamingsArray, currSelectedOpt[0].value);
                                    prefixPopOver.setBody(ParamSkeletonNLS.EmptyPrefixForbidden + " (" + ParamSkeletonNLS.DefaultPrefixValueOfType + " " + cNamingElt.defprefix + ")");
                                    // if (prefixPopOver.isVisible) {
                                    //     setTimeout(function () {prefixPopOver.hide(); }, 3000);
                                    // }
                                } else {
                                    prefixPopOver.setBody(ParamSkeletonNLS.EmptyPrefixForbidden);
                                    prefixPopOver.hide();
                                }
                                that.testOnlineIdInput('prefixInput');
                            }, 20);
                        }
                    }
                }).inject(controlObjectCell);
                preFixTooltipCell = UWA.createElement('td', {
                    'width' : '40%',
                    'title' : '',
                    'id' : 'nameDeployxxxIndicator',
                    align : 'left'
                }).inject(lineParam);
                prefixImgInfoSpan = UWA.createElement('span', {
                    'class' : 'fonticon fonticon-info tooltipStyle' //IR-772352-3DEXPERIENCER2021x
                }).inject(preFixTooltipCell);

                prefixPopOver = new Popover({
                    target   : prefixImgInfoSpan,
                    trigger  : "hover",
                    animate  : "true",
                    position : 'top',
                    body     : ParamSkeletonNLS.EmptyPrefixForbidden,//ZUR IR-620497-3DEXPERIENCER2019x
                    title    : ''
                });
                prefixField.getContent().setStyle("width", 300);
                prefixField.getContent().set("maxLength", 170);
                this.inputControls.push(prefixField);

                //4th line
                lineParam = UWA.createElement('tr', {title: ''}).inject(ftbody);
                cellLabel = UWA.createElement('td', {'width': '30%', 'title': ''}).inject(lineParam);
                UWA.createElement('p', {text: ParamSkeletonNLS.Suffix, 'class': ''}).inject(cellLabel);

                controlObjectCell = UWA.createElement('td', {'width': '70%', 'colspan': '2', 'title': ''}).inject(lineParam);

                suffixField = new Text({
                    placeholder: "...",
                    attributes: {
                        id : 'suffixInput',
                        value: initSufftoShow,
                        multiline: false,
                        disabled: false
                    },
                    events: {
                        onKeyDown: function () {
                            if (timerconn) { clearTimeout(timerconn); }

                            timerconn = setTimeout(function() {
                                that.testOnlineIdInput('suffixInput');
                            }, 20);
                        }
                    }
                }).inject(controlObjectCell);
                suffixField.getContent().setStyle("width", 300);
                suffixField.getContent().set("maxLength", 170);
                this.inputControls.push(suffixField);

                //5th line : Affix Line
                //NZV - IR-529946-3DEXPERIENCER2017x/18x added tooltip to Affix Line
                lineParam = UWA.createElement('tr', {title: iFamilyToolTip}).inject(ftbody); //tableParameters
                labelAffixcell = UWA.createElement('td', {'width': '30%', 'title': ''}).inject(lineParam);//'class':'',
                UWA.createElement('p', {text: ParamSkeletonNLS.Interfix + ' (' + ParamSkeletonNLS.CommonParam + ') ', 'class': ''}).inject(labelAffixcell);

                controlObjectCell = UWA.createElement('td', {'width': '30%', 'title': ''}).inject(lineParam);

                affixField = new Text({
                    placeholder: "...",
                    attributes: {
                        id : 'sitenameinput',
                        value: affixvaluetoshow,
                        multiline: false,
                        disabled: false
                    },
                    events: {
                        onKeyDown: function () {
                            if (timerconn) { clearTimeout(timerconn); }
                            timerconn = setTimeout(function() {
                                that.testOnlineIdInput('sitenameinput');
                            }, 20);
                        }
                    }
                }).inject(controlObjectCell);
                tooltipCell = UWA.createElement('td', {
                    'width' : '40%',
                    'title' : '',
                    'id' : 'nameDeployxxxIndicator',
                    align : 'left'
                }).inject(lineParam);
                imgInfoSpan = UWA.createElement('span', {
                    'class' : 'fonticon fonticon-info tooltipStyle' //IR-772352-3DEXPERIENCER2021x
                }).inject(tooltipCell);


                popOver = new Popover({
                    target   : imgInfoSpan,
                    trigger  : "hover",
                    animate  : "true",
                    position : 'top',
                    body     : ParamSkeletonNLS.InterfixTooltip,
                    title    : ''
                });
                affixField.getContent().setStyle("width", 300);
                affixField.getContent().set("maxLength", 200);
                this.inputControls.push(affixField);

                //5th line bis : character selector
                lineParam = UWA.createElement('tr', {title: ''}).inject(ftbody);//tableParameters

                labelSepcell = UWA.createElement('td', {'width': '30%', 'title': ''}).inject(lineParam);//'class':'',
                UWA.createElement('p', {text: ParamSkeletonNLS.Separator + ' (' + ParamSkeletonNLS.CommonParam + ') ', 'class': ''}).inject(labelSepcell);
                controlObjectCell = UWA.createElement('td', {'width': '70%', 'colspan': '2', 'title': ''}).inject(lineParam);

                sepControler = new Select({
                    placeholder: false,
                    nativeSelect: true,
                    attributes: {
                        id : 'selectSeparator',
                        disabled: false
                    }
                });
                sepControler.getContent().setStyle("width", 300);

                for (i = 0; i < nbofValuesForArg; i++) {
                    isSelected = false;

                    if (optionsSepArray[i].id == separatorValue) {
                        isSelected = true;
                    }
                    sepControler.add([{
                        label: optionsSepArray[i].nlsKey,//iArgument.value[i].nlsKey,
                        value: optionsSepArray[i].id,//iArgument.value[i].id,
                        selected: isSelected
                    }], false);
                }
                sepControler.inject(controlObjectCell);

                sepControler.addEvent("onChange", function () {
                    that.testOnlineIdInput("sitenameinput");
                });

                this.inputControls.push(sepControler);

                /*//Intermediary Line
                UWA.createElement('tr',{html:  [{ tag: 'th', colspan: 3, html:"<br/><br/>" }] }).inject(ftbody);*/

                //Injecting the preview Input
                if (initSufftoShow === "") {
                    initialPreview = initPreftoShow + separatorValue + affixvaluetoshow + separatorValue + '<' + ParamSkeletonNLS.Counter + '>';
                } else {
                    initialPreview = initPreftoShow + separatorValue + affixvaluetoshow + separatorValue + '<' + ParamSkeletonNLS.Counter + '>' + separatorValue + initSufftoShow;
                }//NZV - IR-559116-3DEXPERIENCER2018x

                finalformatinput = new Text({
                    placeholder: "...",
                    attributes: {
                        id : 'finalformat',
                        value: initialPreview,
                        multiline: false,
                        disabled: false,
                        readonly: true,
                        title : initialPreview
                    }
                }).inject(controlObjectCellPreview);
                finalformatinput.getContent().setStyle("width", 360);
                this.inputControls.push(finalformatinput);

                if (wdgDeployIndicator == false) {
                    iconColor = "orange";
                    imgTitle = ParamSkeletonNLS.notdeployedParamtxt;
                    imgClass = 'fonticon fonticon-2x fonticon-cog';
                    //CommonUtilities.dispatchNeedDeployEvt(paramWidget);
                }
                imgSpan = UWA.createElement('span', {
                    'class' :  imgClass
                }).inject(imgCell);
                imgSpan.setStyle("color", iconColor);
                imgCell.set("Title", imgTitle);

                this.warnArrays[0] = new WarningLabel("sitenameinput", false);
                this.warnArrays[1] = new WarningLabel("prefixInput", false);
                this.warnArrays[2] = new WarningLabel("suffixInput", false);
            },

            selectedTypeChanged : function (iInput) {
                var cNamingElt, nInput, affixInput, separatorSelector,
                    typeSelector = ParamLayoutUtilities.getNamingControlInput(this.inputControls, "iTypeSelect"),
                    currSelectedOpt = typeSelector.getSelection(),
                    selectedTypeLabel = currSelectedOpt[0].label;

                cNamingElt = ParamLayoutUtilities.getCustoNamingElement(this.custoNamingsArray, currSelectedOpt[0].value);
                nInput = ParamLayoutUtilities.getNamingControlInput(this.inputControls, "prefixInput");
                nInput.setValue(cNamingElt.prefix);
                nInput = ParamLayoutUtilities.getNamingControlInput(this.inputControls, "suffixInput");
                nInput.setValue(cNamingElt.suffix);

                affixInput = ParamLayoutUtilities.getNamingControlInput(this.inputControls, "sitenameinput");
                separatorSelector = ParamLayoutUtilities.getNamingControlInput(this.inputControls, "selectSeparator");
                currSelectedOpt = separatorSelector.getSelection();

                ParamLayoutUtilities.UpdateFinalFormatOverView(cNamingElt.prefix, affixInput.getValue(), cNamingElt.suffix, currSelectedOpt[0].value,
                                                               cNamingElt.appType,
                                                                ParamLayoutUtilities.getNamingControlInput(this.inputControls, "finalformat"));
                typeSelector.elements.input.title = selectedTypeLabel;
            },

            testOnlineIdInput : function(inputID) {
                var i, iID, iAffixID, iWrn, imgCell, currSelectedOpt, currSelectedSepOpt, controlupdate, cSeparator, cNamingElt, selectedTypeLabel,
                    typeSelector = ParamLayoutUtilities.getNamingControlInput(this.inputControls, "iTypeSelect"),
                    separatorSelector = ParamLayoutUtilities.getNamingControlInput(this.inputControls, "selectSeparator"),
                    inputToTest =  ParamLayoutUtilities.getNamingControlInput(this.inputControls, inputID),//"sitenameinput"
                    inputValue = inputToTest.getValue(),
                    containsInternalTypeName = false,
                    containSpecialchars = false,
                    errInputMsg = ParamSkeletonNLS.SpecialCharMsg,
                    applyBttnPtr = this.controlDiv.getElements('.btn-primary')[0],
                    tbodyreflist = this.contentDiv.getElements('.fparamtbody'),
                    prefixElm = ParamLayoutUtilities.getNamingControlInput(this.inputControls, "prefixInput"),
                    suffixElm = ParamLayoutUtilities.getNamingControlInput(this.inputControls, "suffixInput"),
                    affixElm = ParamLayoutUtilities.getNamingControlInput(this.inputControls, "sitenameinput");

                imgCell = ParamLayoutUtilities.getNamingDeployCellSts(tbodyreflist);//"nameDeployIndicator"
                ParamLayoutUtilities.beingModified(imgCell, ParamSkeletonNLS.ParamBeingModified, '2');

                for (i = 0; i < this.warnArrays.length; i++) {
                    if (this.warnArrays[i].warnID === inputID) {
                        iWrn = i;
                        break;
                    }
                }
                containSpecialchars = ParamLayoutUtilities.testSpecialCharacters(inputValue);
                if ((inputID === "prefixInput") || (inputID === "suffixInput")) {
                    containsInternalTypeName = this.testInputForTypeIds(inputValue);
                }
                //NZV-IR-600551-3DEXPERIENCER2019x
                if ((containSpecialchars === true) || (containsInternalTypeName === true) ||
                        (inputValue === "" && (inputID === "prefixInput" || inputID === "sitenameinput"))) {
                    if ((ParamLayoutUtilities.testSpecialCharacters(inputValue) === true) || (containsInternalTypeName === true) ||
                            (inputValue === "" && inputID === "prefixInput")) {
                        applyBttnPtr.disabled = true;
                        typeSelector.elements.input.disabled = true;
                        separatorSelector.elements.input.disabled = true;
                        //block all except it
                        if (inputID === "prefixInput") {
                            suffixElm.elements.input.disabled = true;
                            affixElm.elements.input.disabled = true;
                        }
                        if (inputID === "suffixInput" && containSpecialchars === true) {
                            prefixElm.elements.input.disabled = true;
                            affixElm.elements.input.disabled = true;
                        }
                        if (inputID === "sitenameinput") {
                            prefixElm.elements.input.disabled = true;
                            suffixElm.elements.input.disabled = true;
                        }
                        if (inputValue === "" && inputID === "prefixInput") {
                            currSelectedOpt = typeSelector.getSelection();
                            cNamingElt = ParamLayoutUtilities.getCustoNamingElement(this.custoNamingsArray, currSelectedOpt[0].value);
                            errInputMsg = ParamSkeletonNLS.EmptyPrefixForbidden + " (" + ParamSkeletonNLS.DefaultPrefixValueOfType + " " + cNamingElt.defprefix + ")";
                        }
                        if (containsInternalTypeName === true) {
                            inputToTest.elements.input.style.color = 'red';
                            errInputMsg = ParamSkeletonNLS.typesForbiddenMessage;
                        }
                        if (containSpecialchars === true) {
                            inputToTest.elements.input.style.color = 'red';
                            errInputMsg = ParamSkeletonNLS.SpecialCharMsg;
                        }
                        this.ErrorMsgPopup = ParamLayoutUtilities.inputErrorCell(imgCell, errInputMsg, 'red', this.ErrorMsgPopup);
                        this.warnArrays[iWrn].warnRaised = true;
                    }
                    if (inputValue === "" && inputID === "sitenameinput") {
                        errInputMsg = ParamSkeletonNLS.InterfixTooltip;
                        this.ErrorMsgPopup = ParamLayoutUtilities.inputErrorCell(imgCell, errInputMsg, 'orange', this.ErrorMsgPopup);
                        typeSelector.elements.input.disabled = false;
                        separatorSelector.elements.input.disabled = false;
                        applyBttnPtr.disabled = false;
                        prefixElm.elements.input.disabled = false;
                        suffixElm.elements.input.disabled = false;
                    }
                    //IR-685759-3DEXPERIENCER2020x : updating Preview even in case error or warning
                    currSelectedOpt = typeSelector.getSelection();
                    cNamingElt = ParamLayoutUtilities.getCustoNamingElement(this.custoNamingsArray, currSelectedOpt[0].value);
                    ParamLayoutUtilities.UpdateFinalFormatOverView(cNamingElt.prefix, affixElm.getValue(), cNamingElt.suffix,
                                                                  (separatorSelector.getSelection())[0].value, cNamingElt.appType,
                                                                   ParamLayoutUtilities.getNamingControlInput(this.inputControls, "finalformat"));
                    inputToTest.focus();
                } else {
                    this.warnArrays[iWrn].warnRaised = false;
                    controlupdate = ParamLayoutUtilities.getNamingControlInput(this.inputControls, this.warnArrays[iWrn].warnID);
                    controlupdate.elements.input.style.color = "#555555";//070E14 color: #555;

                    iAffixID = ParamLayoutUtilities.getCommonNamingElementItr(this.commonNamingElts, "IdentifierAffix");

                    if ("sitenameinput" ===  inputID) {
                        this.commonNamingElts[iAffixID].currentValue = inputValue;
                    } else {
                        currSelectedOpt = typeSelector.getSelection();
                        iID = ParamLayoutUtilities.getIndexInNamingArray(this.custoNamingsArray, currSelectedOpt[0].value);

                        if (inputID === "prefixInput") {
                            this.custoNamingsArray[iID].prefix = inputValue;
                        } else if (inputID === "suffixInput") {
                            this.custoNamingsArray[iID].suffix = inputValue;
                        }
                    }

                    currSelectedSepOpt = separatorSelector.getSelection();
                    cSeparator = currSelectedSepOpt[0].value;

                    currSelectedOpt = typeSelector.getSelection();
                    selectedTypeLabel = currSelectedOpt[0].label;
                    cNamingElt = ParamLayoutUtilities.getCustoNamingElement(this.custoNamingsArray, currSelectedOpt[0].value);

                    ParamLayoutUtilities.UpdateFinalFormatOverView(cNamingElt.prefix, affixElm.getValue(), suffixElm.getValue(),
                                                                   cSeparator, cNamingElt.appType,
                                                                   ParamLayoutUtilities.getNamingControlInput(this.inputControls, "finalformat"));

                    if (ParamLayoutUtilities.CheckforRaisedWarnings(this.warnArrays) === "OK") {
                        if (this.ErrorMsgPopup  != null) {
                            if (this.ErrorMsgPopup.isVisible) {this.ErrorMsgPopup.hide(); }
                        }
                        ParamLayoutUtilities.beingModified(imgCell, ParamSkeletonNLS.ParamBeingModified, '2');

                        for (i = 0; i < this.warnArrays.length; i++) {
                            controlupdate = ParamLayoutUtilities.getNamingControlInput(this.inputControls, this.warnArrays[i].warnID);
                            controlupdate.elements.input.style.color = "#555555";//070E14 color: #555;
                        }

                        typeSelector.elements.input.disabled = false;
                        separatorSelector.elements.input.disabled = false;
                        applyBttnPtr.disabled = false;
                        prefixElm.elements.input.disabled = false;
                        suffixElm.elements.input.disabled = false;
                        affixElm.elements.input.disabled = false;

                        /*if (tSiteName == "")//IR-207199V6R2014 {
                            //document.getElementById("labelwarning").innerHTML="<affixDefineTooltip>";} else */
                    }
                }

            },//of function testonlineinputname

            testInputForTypeIds : function (iInputString) {
                var i,
                    typeSelector = ParamLayoutUtilities.getNamingControlInput(this.inputControls, "iTypeSelect"),
                    currSelectedOpt = typeSelector.getSelection(),
                    currNamingElt = ParamLayoutUtilities.getCustoNamingElement(this.custoNamingsArray, currSelectedOpt[0].value),
                    currAppType = currNamingElt.appType;

                if (currAppType === "VPM") {
                    for (i = 0; i < this.forbiddenNamings.length; i++) {
                        if (iInputString.indexOf(this.forbiddenNamings[i]) !== -1) {
                            return true;
                        }
                    }
                }
                return false;
            },

            UpdateCommonParamsOnServer : function () {
                var iParam, imgCell,
                    jsonArr = [],
                    ArgArr = [],
                    affixInput = ParamLayoutUtilities.getNamingControlInput(this.inputControls, "sitenameinput"),
                    separatorSelector = ParamLayoutUtilities.getNamingControlInput(this.inputControls, "selectSeparator"),
                    currSelectedOpt = separatorSelector.getSelection(),
                    separatorVal = currSelectedOpt[0].value,
                    AffixValue = affixInput.getValue(),
                    tbodyreflist = this.contentDiv.getElements('.fparamtbody');

                if (AffixValue === "") { AffixValue = "TBD"; }

                Mask.mask(this.contentDiv);

                ArgArr.push({id: "AffixArg", value: AffixValue});
                ArgArr.push({id: "SeparatorArg", value: separatorVal});

                iParam = {
                    domain: this.model.get("domainid"),
                    id: "IdentifierAffix",
                    argument : ArgArr
                };

                imgCell = ParamLayoutUtilities.getNamingDeployCellSts(tbodyreflist);

                jsonArr.push(iParam);
                /*var func2 = func1.bind(this); func2(params);*/
                ParameterizationWebServices.postParamsArrOnServer.call(this, this.connectProps, jsonArr, imgCell,
                    this.onApplyFailure.bind(this), this.postNamingParams.bind(this));
            },//of function UpdateCommonParamsOnServer

            postNamingParams : function(json, theImageCell) {
                UWA.log("postNamingParams");

                var i, ArgArr, iParam,
                    jsonArr = [];

                for (i = 0; i < this.custoNamingsArray.length; i++) {
                    ArgArr = [];
                    ArgArr.push({id: "PrefixArg", value: this.custoNamingsArray[i].prefix});
                    ArgArr.push({id: "SuffixArg", value: this.custoNamingsArray[i].suffix});

                    iParam = {
                        domain : this.model.get("domainid"),
                        id : this.custoNamingsArray[i].objTypeID,
                        argument : ArgArr
                    };
                    jsonArr.push(iParam);
                }

                ParameterizationWebServices.postParamsArrOnServer.call(this, this.connectProps, jsonArr, theImageCell,
                    this.onApplyFailure.bind(this), this.onApplySuccess.bind(this));
            },

            ResetNamingParams : function() {
                var i, iID, imgCell, tbodyreflist, affixInput, sepControler, optionValue, prefixElm,
                    suffixElm, affixElm, typeSelector, separatorSelector, applyBttnPtr;

                iID = ParamLayoutUtilities.getCommonNamingElementItr(this.commonNamingElts, "IdentifierAffix");
                this.commonNamingElts[iID].currentValue = URLHandler.getTenant();//this.commonNamingElts[iID].defaultValue;
                iID = ParamLayoutUtilities.getCommonNamingElementItr(this.commonNamingElts, "SeparatorArg");
                this.commonNamingElts[iID].currentValue = this.commonNamingElts[iID].defaultValue;

                affixInput = ParamLayoutUtilities.getNamingControlInput(this.inputControls, "sitenameinput");
                affixInput.setValue(URLHandler.getTenant());//this.connectProps.tenantID affixContainer.defaultValue;

                sepControler = ParamLayoutUtilities.getNamingControlInput(this.inputControls, "selectSeparator");

                for (i = 0; i < sepControler.elements.input.length; i++) {
                    optionValue = sepControler.elements.input[i].value;

                    if (optionValue == this.commonNamingElts[iID].defaultValue) {
                        sepControler.select(i, true, false);
                        break;
                    }
                }//of for elements
                //clear warning array
                //NZV-IR-600551-3DEXPERIENCER2019x
                for (i = 0; i < this.warnArrays.length; i++) {
                    this.warnArrays[i].warnRaised = false;
                }
                 //enable all inputs
                prefixElm = ParamLayoutUtilities.getNamingControlInput(this.inputControls, "prefixInput");
                suffixElm = ParamLayoutUtilities.getNamingControlInput(this.inputControls, "suffixInput");
                affixElm = ParamLayoutUtilities.getNamingControlInput(this.inputControls, "sitenameinput");
                typeSelector = ParamLayoutUtilities.getNamingControlInput(this.inputControls, "iTypeSelect");
                separatorSelector = ParamLayoutUtilities.getNamingControlInput(this.inputControls, "selectSeparator");
                applyBttnPtr = this.controlDiv.getElements('.btn-primary')[0];
                typeSelector.elements.input.disabled = false;
                separatorSelector.elements.input.disabled = false;
                applyBttnPtr.disabled = false;
                prefixElm.elements.input.disabled = false;
                suffixElm.elements.input.disabled = false;
                affixElm.elements.input.disabled = false;
                //Prefixes and Suffixes
                for (i = 0; i < this.custoNamingsArray.length; i++) {
                    this.custoNamingsArray[i].prefix = this.custoNamingsArray[i].defprefix;
                    this.custoNamingsArray[i].suffix = this.custoNamingsArray[i].defsuffix;
                }

                this.selectedTypeChanged();//Updating View

                tbodyreflist = this.contentDiv.getElements('.fparamtbody');
                imgCell = ParamLayoutUtilities.getNamingDeployCellSts(tbodyreflist);//Deploy Indicator
                ParamLayoutUtilities.beingModified(imgCell, ParamSkeletonNLS.ParamBeingModified, '2');

                this.applyParams();
            },

            buildDeploymentTab : function () {
                var tableImport, deploytbody, iDeployAccordion, tableUtilities, globalDeplDiv,
                    lineExport, cellExportText, buttonExportCell, exportBttn, cellInfo,
                    lineImport, cellImportContainer, cellImportText, fileController,
                    importBttnCell, importBttnGrp,
                    lineDeployButton, ApplyBttnCell, ApplyBttn, cellDeployText, FamilyDeploySts, ParameterDeploySts,
                    indexLine, reloadCacheLine, exportCATNLSLine,
                    tablePropagAtt, propagAttLine,
                    dplWdthArr = [40, 10, 25, 25, 190], //NZV :here last value(190) of array is width of all buttons
                    that = this; //NZV:IR-628784-3DEXPERIENCER2019x

                globalDeplDiv = ParamLayoutUtilities.createParamsContainerDiv();
                globalDeplDiv.inject(this.contentDiv);

                iDeployAccordion = ParamLayoutUtilities.createFamilyUIKITAccordion(globalDeplDiv);

                tableImport = UWA.createElement('table', {
                    'class': 'table table-hover',//'tableImportExport',
                    'id': ''
                });

                deploytbody =  UWA.createElement('tbody', {
                    'class': 'fparamtbody',
                    'id': ''
                }).inject(tableImport);

                //intermediaryLine = ParamLayoutUtilities.buildSeparationLine('Import and Export Utilities');

                lineExport = UWA.createElement('tr').inject(deploytbody);

                cellExportText = UWA.createElement('td', {
                    //'colspan': '2',
                    'width': dplWdthArr[0].toString() + '%',
                    'align': 'left'
                }).inject(lineExport);

                UWA.createElement('p', {
                    text: ParamSkeletonNLS.ExportConfiguration,
                    'class': ''
                }).inject(cellExportText);

                cellInfo = UWA.createElement('td', {
                    'width': dplWdthArr[1].toString() + '%',
                    'align': 'left'
                }).inject(lineExport);

                ParamLayoutUtilities.buildPopoverSpan(cellInfo, ParamSkeletonNLS.ExportTooltip);

                UWA.createElement('td', {
                    'width': dplWdthArr[2].toString() + '%',
                    'align': 'left'
                }).inject(lineExport);

                buttonExportCell = UWA.createElement('td', {
                    'width'  :  dplWdthArr[3].toString() + '%'
                }).inject(lineExport);

                exportBttn =  new Button({
                    className: 'primary',
                    id : 'buttonExport',
                    icon: 'export',//'download'//value: 'Button',
                    attributes: {
                        disabled: false,
                        //title: ParamSkeletonNLS.ExportTxt,
                        text : ParamSkeletonNLS.ExportTxt
                    },
                    events: {
                        onClick: function () {
                            that.launchFilesExport("Parameterization_Export");
                        }
                    }
                }).inject(buttonExportCell);
                exportBttn.getContent().setStyle("width", dplWdthArr[4]);

                lineImport = UWA.createElement('tr').inject(deploytbody);//tbody

                cellImportText = UWA.createElement('td', {
                    'width': dplWdthArr[0].toString() + '%',
                    'align': 'left'
                }).inject(lineImport);

                UWA.createElement('p', {
                    text: ParamSkeletonNLS.SelectImportFile,
                    'class': ''
                }).inject(cellImportText);

                cellInfo = UWA.createElement('td', {
                    'width': dplWdthArr[1].toString() + '%',
                    'align': 'left'
                }).inject(lineImport);

                ParamLayoutUtilities.buildPopoverSpan(cellInfo, ParamSkeletonNLS.ImportFileTooltip);

                cellImportContainer = UWA.createElement('td', {
                    'width': dplWdthArr[2].toString() + '%',
                    'align': 'left',
                    'title': ''
                });

                fileController = new UWA.Controls.Input.File({
                    attributes: {
                        'id': 'ImportFileInput'
                    },
                    className: 'xml-file-input'
                }).inject(cellImportContainer);

                fileController.getContent().setStyle("width", 250);

                importBttnCell = UWA.createElement('td', {
                    'width': dplWdthArr[3].toString() + '%',
                    'align': 'left'
                });

                importBttnGrp = new Button({
                    value: ParamSkeletonNLS.ImportBttnTxt,
                    className: 'primary',
                    icon: 'fonticon-upload',
                    attributes: {
                        title: ParamSkeletonNLS.ImportFile
                    },
                    dropdown: {
                        items: [
                            { text: ParamSkeletonNLS.ImportBttnTxt, name : 'Import', title : ParamSkeletonNLS.ImportNoApplytooltip },
                            { text: ParamSkeletonNLS.ImportAndApply, name : 'importNdeploy', title : ParamSkeletonNLS.ImportApplytooltip }
                        ]
                    }
                }).inject(importBttnCell);

                importBttnGrp.addEvent('onDropdownClick', function (e, item) {
                    that.onXMLFileSelected(item.name);
                });

                importBttnGrp.getContent().setStyle("width", dplWdthArr[4]);

                /*cellSpinnerContainer = UWA.createElement('td', {
                    'width': dplWdthArr[3].toString() + '%',
                    'align': 'center',
                    'title': ''
                });*/

                //cellImportText.inject(lineImport);
                cellImportContainer.inject(lineImport);
                importBttnCell.inject(lineImport);
                lineImport.inject(deploytbody);

                FamilyDeploySts = this.collection._models[0]._attributes.family;
                ParameterDeploySts = FamilyDeploySts[0].parameter;

                lineDeployButton = UWA.createElement('tr');

                if (ParameterDeploySts[0].isDeployed == "true") {
                    lineDeployButton.hide();
                }

                cellDeployText = UWA.createElement('td', {
                    'width': dplWdthArr[0].toString() + '%',
                    'align': 'left'
                    //'title': ParamSkeletonNLS.ApplyNonDeployed
                }).inject(lineDeployButton);

                UWA.createElement('p', {
                    text: ParamSkeletonNLS.ApplyNonDeployed,
                    'class': ''
                }).inject(cellDeployText);

                cellInfo = UWA.createElement('td', {
                    'width': dplWdthArr[1].toString() + '%',
                    'align': 'left'
                }).inject(lineDeployButton);

                ParamLayoutUtilities.buildPopoverSpan(cellInfo, ParamSkeletonNLS.ApplyNonDeployed);

                UWA.createElement('td', {
                    'width': dplWdthArr[2].toString() + '%',
                    'align': 'left'
                }).inject(lineDeployButton);

                ApplyBttnCell = UWA.createElement('td', {
                    //'colspan': '2',
                    'width': dplWdthArr[3].toString() + '%',
                    'align': 'left',
                    'title': ''
                }).inject(lineDeployButton);

                ApplyBttn = new Button({
                    id : 'buttonImport',
                    className: 'primary',
                    icon: 'fonticon-forward',
                    value: ParamSkeletonNLS.Apply,
                    attributes: {
                        //title: ParamSkeletonNLS.Apply,
                        text : ParamSkeletonNLS.Apply
                    },
                    events: {
                        onClick: function () {
                            Mask.mask(that.contentDiv);
                            ParameterizationWebServices.deployParamsOnServer.call(that,
                                that.onDeployFailure.bind(that), that.onDeploySuccess.bind(that));
                        }
                    }
                }).inject(ApplyBttnCell);

                ApplyBttn.getContent().setStyle("width", dplWdthArr[4]);
                lineDeployButton.inject(deploytbody);

                iDeployAccordion.addItem({
                    title: ParamSkeletonNLS.ImportExportConfigTxt,
                    content: tableImport,
                    selected : true,
                    name : 'ImpExpid'
                });

                tableUtilities = UWA.createElement('table', {
                    'class': 'table table-hover',//'tableImportExport',
                    'id': ''
                });

                deploytbody =  UWA.createElement('tbody', {
                    'class': 'fparamtbody',
                    'id': ''
                }).inject(tableUtilities);

                /*intermediaryLine = ParamLayoutUtilities.buildSeparationLine(ParamSkeletonNLS.DeploymentUtilitiesTxt);*/

                indexLine = this.buildIndexationLine(dplWdthArr);
                indexLine.inject(deploytbody);

                reloadCacheLine = this.buildReloadCacheLine(dplWdthArr);
                reloadCacheLine.inject(deploytbody);

                exportCATNLSLine = this.buildExportLine(dplWdthArr, 'ParameterizationCATNls',
                    ParamSkeletonNLS.DownloadTxt, ParamSkeletonNLS.DownloadTooltip,
                    ParamSkeletonNLS.DownloadCATNLSTxt);

                exportCATNLSLine.inject(deploytbody);

                iDeployAccordion.addItem({
                    title: ParamSkeletonNLS.DeploymentUtilitiesTxt,
                    content: tableUtilities,
                    selected : true,
                    name : 'Utilitiesid'
                });

                tablePropagAtt = UWA.createElement('table', {
                    'class': 'table table-hover',//table deployment auto ext
                    'id': 'PropagAtt'
                });

                deploytbody =  UWA.createElement('tbody', {
                    'class': 'fparamtbody',
                    'id': ''
                }).inject(tablePropagAtt);

                propagAttLine = PropagLayoutUtilities.buildPropagAttLine(dplWdthArr, this);
                propagAttLine.inject(deploytbody);

                iDeployAccordion.addItem({
                    title: ParamSkeletonNLS.PropagationTitle,
                    content: tablePropagAtt,
                    selected : false,
                    name : 'PropagAttid'
                });

                this.paramScroller = new Scroller({
                    element: globalDeplDiv
                }).inject(this.contentDiv);

            },

            onXMLFileSelected : function (currAction) {
                //console.log(' File {0} has been selected', this._ FilePath); //fileobject as entry
                var fileInput = document.getElementById('ImportFileInput');
                var that = this;
                if (fileInput.files.length === 1) { //FUN102019 21x FD03
                    var dataInfo = { "about": "checkConfigAvailiability"}
                    var data = {"theThat":that, "File" :fileInput.files[0], "iAction" : currAction };
                    ParameterizationWebServices.getRquestOnParamService("integrity/getParamInfo", dataInfo, function (result,dataelem) {
                    if (result.infoValue == "true") {
                            console.log("XParameter(s) are found");
                            ParamLayoutUtilities.showContextualDeleteModal(widget.body, "delAttrModal", ParamSkeletonNLS.ImportWarning+"\n"+ParamSkeletonNLS.ImportWarningSec+"\n"+ParamSkeletonNLS.ImportWarningThird,
                            ParamSkeletonNLS.YesText,  ParamSkeletonNLS.NoText, ParamSkeletonNLS.Warning+"!",that.launchImportProcess, data);
                        } else {
                            console.log("No XParameter found");
                            that.launchImportProcess(data);
                        }
                   }, function (result, dataelem) {console.log("Failed : "+"getParamInfo request");console.log ("Failed : "+ result);})
                   // currAction.theThat.launchImportProcess(fileInput.files[0], currAction.name);
                } else {
                    that.userMessaging.add({ className: "warning", message: ParamSkeletonNLS.NotSelectedMsg });
                }
            },

            buildIndexationLine : function (wdthArray) {
                var buttonIndexCell, cellExportText, cellInfo, indexBttn,
                    indexLine = UWA.createElement('tr'),
                    that = this;

                cellExportText = UWA.createElement('td', {
                    //'colspan': '2',
                    'width': wdthArray[0].toString() + '%',
                    'align': 'left'
                }).inject(indexLine);

                UWA.createElement('p', {
                    text: ParamSkeletonNLS.IndexationTxt,
                    'class': ''
                }).inject(cellExportText);

                cellInfo = UWA.createElement('td', {
                    'width': wdthArray[1].toString() + '%',
                    'align': 'left'
                }).inject(indexLine);

                ParamLayoutUtilities.buildPopoverSpan(cellInfo, ParamSkeletonNLS.IndexationTooltip);

                UWA.createElement('td', {
                    'width': wdthArray[2].toString() + '%',
                    'align': 'left'
                }).inject(indexLine);

                buttonIndexCell = UWA.createElement('td', {
                    'width'  : wdthArray[3].toString() + '%'
                }).inject(indexLine);

                indexBttn =  new Button({
                    className: 'primary',
                    id : 'buttonIndex',
                    icon: 'archive',
                    attributes: {
                        disabled: false,
                       // title: ParamSkeletonNLS.IndexationBtnTxt,
                        text : ParamSkeletonNLS.IndexationBtnTxt
                    },
                    events: {
                        onClick: function () {
                            ParameterizationWebServices.launchServiceOnServer.call(that, 'datamodel/launchIndex',
                                that.onIndexLaunchSuccess.bind(that), that.onIndexLaunchFailure.bind(that));
                            //that.userDeployMessaging.add({ className: "info", message: ParamSkeletonNLS.IndexationInfo});
                        }
                    }
                }).inject(buttonIndexCell);
                indexBttn.getContent().setStyle("width", wdthArray[4]);

                return indexLine;
            },

            buildReloadCacheLine : function (wdthArray) {
                var buttonCacheCell, cellInfo, cellCacheText, relCacheBttn,
                    reloadCacheLine = UWA.createElement('tr'),
                    that = this;

                cellCacheText = UWA.createElement('td', {
                    'width': wdthArray[0].toString() + '%',
                    'align': 'left',
                    'title': ''
                }).inject(reloadCacheLine);

                UWA.createElement('p', {
                    text: ParamSkeletonNLS.ReloadCacheTxt,
                    'class': ''
                }).inject(cellCacheText);

                cellInfo = UWA.createElement('td', {
                    'width': wdthArray[1].toString() + '%',
                    'align': 'left'
                }).inject(reloadCacheLine);

                ParamLayoutUtilities.buildPopoverSpan(cellInfo, ParamSkeletonNLS.ReloadCacheTooltip);

                UWA.createElement('td', {
                    'width': wdthArray[2].toString() + '%',
                    'align': 'left'
                }).inject(reloadCacheLine);

                buttonCacheCell = UWA.createElement('td', {
                    'width'  : wdthArray[3].toString() + '%'
                }).inject(reloadCacheLine);

                relCacheBttn =  new Button({
                    className: 'primary',
                    id : 'buttonReloadCache',
                    icon: 'picture',
                    attributes: {
                        disabled: false,
                        //title: ParamSkeletonNLS.ReloadCacheBttn,
                        text : ParamSkeletonNLS.ReloadCacheBttn
                    },
                    events: {
                        onClick: function () {
                            ParameterizationWebServices.launchServiceOnServer.call(that, 'access/reloadcache',
                                that.onReloadCacheSuccess.bind(that), that.onReloadCacheFailure.bind(that));
                            Mask.mask(that.contentDiv);
                            //that.userDeployMessaging.add({ className: "info", message: ''});
                        }
                    }
                }).inject(buttonCacheCell);
                relCacheBttn.getContent().setStyle("width", wdthArray[4]);

                return reloadCacheLine;
            },

            buildExportLine : function (dplWdthArr, iFileID, exportBtntext, exportBtnTooltip, exportCellText) {

                var cellExportText, exportBttn, buttonExportCell, cellInfo,
                    lineExport = UWA.createElement('tr'),
                    that = this;

                cellExportText = UWA.createElement('td', {
                    //'colspan': '2',
                    'width': dplWdthArr[0].toString() + '%',
                    'align': 'left',
                    'title': exportCellText
                }).inject(lineExport);

                UWA.createElement('p', {
                    text: exportCellText,
                    'class': ''
                }).inject(cellExportText);

                cellInfo = UWA.createElement('td', {
                    'width': dplWdthArr[1].toString() + '%',
                    'align': 'left'
                }).inject(lineExport);

                ParamLayoutUtilities.buildPopoverSpan(cellInfo, exportBtnTooltip);

                UWA.createElement('td', {
                    'width': dplWdthArr[2].toString() + '%',
                    'align': 'left'
                }).inject(lineExport);

                buttonExportCell = UWA.createElement('td', {
                    'width'  : dplWdthArr[3].toString() + '%'
                }).inject(lineExport);

                exportBttn =  new Button({
                    className: 'primary',
                    id : 'buttonExport' + iFileID,
                    icon: 'export',//'download'//value: 'Button',
                    attributes: {
                        disabled: false,
                       // title: exportBtntext,
                        text : exportBtntext
                    },
                    events: {
                        onClick: function () {
                            that.launchFilesExport(iFileID);
                        }
                    }
                }).inject(buttonExportCell);
                exportBttn.getContent().setStyle("width", dplWdthArr[4]);

                return lineExport;
            },

            onIndexLaunchFailure : function (iRes) {
                UWA.log("Failure");
                UWA.log(iRes);
                this.userDeployMessaging.add({ className: "info", message: ParamSkeletonNLS.IndexationInfo});
            },

            onIndexLaunchSuccess : function (iRes) {
                UWA.log("Success");
                UWA.log(iRes);
                if(iRes.deployStatus === "E_FAIL"){
                    if(iRes.complementary === "OnGoing") {
                        this.userDeployMessaging.add({ className: "warning", message: ParamSkeletonNLS.IndexationOngoing });
                    } else {
                        this.userDeployMessaging.add({ className: "warning", message: iRes.complementary });
                    }
                } else {
                    this.userDeployMessaging.add({ className: "info", message: ParamSkeletonNLS.IndexationInfo});
                }
            },

            onReloadCacheFailure : function (iRes) {
                UWA.log("timeout");
                Mask.unmask(this.contentDiv);
                this.userDeployMessaging.add({ className: "info", message: ParamSkeletonNLS.ReloadCacheTimeout});
                UWA.log(iRes);
            },

            onReloadCacheSuccess : function (iRes) {
                UWA.log("onReloadCacheSuccess::");
                Mask.unmask(this.contentDiv);
                this.userMessaging.add({ className: "success", message: ParamSkeletonNLS.ReloadCacheSuccessMsg});
                UWA.log(iRes);
            },

            //FUN102019 21x FD03 : change input argument
            launchImportProcess : function (data) {
                var reader, importerrmsg, unabletoreadfile,
                    textType = /text.*/,
                    that = data.theThat, File = data.File, iAction = data.iAction;
                UWA.log("File.type = " + File.type);

                if (File.type.match(textType)) {
                    Mask.mask(data.theThat.contentDiv);
                    reader = new FileReader();
                    reader.onload = function(e) {
                        ParameterizationWebServices.ImportParamToServer.call(that, reader.result, iAction,
                            that.importFailure.bind(that), that.importSuccess.bind(that));
                    };
                    reader.readAsText(File);//DEACTIVATE ??

                    reader.onerror = function() {
                        unabletoreadfile = ParamSkeletonNLS.UnabletoReadMsg + ' ' + File.fileName;
                        that.userMessaging.add({ className: "error", message: unabletoreadfile });
                        Mask.unmask(data.theThat.contentDiv);
                    };
                    reader.onloadend = function() {
                        UWA.log("onloadend !!");//need to do something ?
                    };
                } else {
                    importerrmsg = ParamSkeletonNLS.NotAnXMLMsg;
                    that.userMessaging.add({ className: "error", message: importerrmsg }); //File not supported!
                    Mask.unmask(data.theThat.contentDiv);
                }
            },

            importFailure : function (json) {
                UWA.log(json);
                Mask.unmask(this.contentDiv);
                //R-929388-3DEXPERIENCER2022x/23x
                if (json.message != undefined && json.message.includes("timedout")) {
                  UWA.log("import Time out :"+ json.message);
                  this.userMessaging.add({ className: "warning", message: ParamSkeletonNLS.ImportTimeOut });
                } else {
                  UWA.log("import Failure !!!");
                  this.userMessaging.add({ className: "error", message: ParamSkeletonNLS.ImportFailureMsg });
                }
            },

            importSuccess : function (json, iAction) {
                UWA.log(json);
                Mask.unmask(this.contentDiv);
                var jsParsed = JSON.parse(json);
                /* globalParamWidget.socket.dispatchEvent('onPlatformChange', {selectedTenant:globalParamWidget.tenantID,
                url3DSpace: globalParamWidget.env_url});*/

                if (jsParsed.deployStatus === "S_OK") {
                    this.userMessaging.add({ className: "success", message: ParamSkeletonNLS.ImportSuccessMsg});
                    if ("importNdeploy" === iAction) {
                        this.hideApplylines();
                    } else {
                        this.showApplylines();
                    }
                } else {//IR-1291715-3DEXPERIENCER2025x
					//if(jsParsed)
                    this.importFailure(jsParsed);
                }
            },

            onDeployFailure : function (json) {
                UWA.log(json);
                this.userMessaging.add({ className: "error", message: ParamSkeletonNLS.ParametersDeplFail });
                Mask.unmask(this.contentDiv);
            },

            onDeploySuccess : function (jsonObj) {
                UWA.log(jsonObj);
                Mask.unmask(this.contentDiv);
                /* globalParamWidget.socket.dispatchEvent('onPlatformChange', {selectedTenant:globalParamWidget.tenantID,
                        url3DSpace:globalParamWidget.env_url});*/
                if (jsonObj.deployStatus === "S_OK") {
                    this.hideApplylines();
                    this.userMessaging.add({ className: "success", message: ParamSkeletonNLS.ParametersDeplSucc});
                } else {
                    this.onDeployFailure(jsonObj);
                }
            },

            hideApplylines : function () {
                var tbodyreflist = this.contentDiv.getElements('.fparamtbody'),
                    tbodyref = tbodyreflist[0],
                    iLines = tbodyref.children;

                iLines[2].hide();
            },

            showApplylines : function () {
                var tbodyreflist = this.contentDiv.getElements('.fparamtbody'),
                    tbodyref = tbodyreflist[0],
                    iLines = tbodyref.children;

                iLines[2].show();
            },

            launchFilesExport : function (iFile) {
                Mask.mask(this.contentDiv);//"ParameterizationCATNls" "Parameterization_Export"
                ParameterizationWebServices.GetTicketForDownload.call(this, iFile,
                    this.onCompleteRequestFCSTicket.bind(this), this.onFailureRequestFCSTicket.bind(this));
            },

            onCompleteRequestFCSTicket : function (responseObjectJson, iFileID) {
                UWA.log("We have our ticket ... Let's fly... Up, up here we go, go");
                this.postCallFCS(responseObjectJson);
				//NZV : IR-632818-3DEXPERIENCER2019x
                if (iFileID === "Parameterization_Export") {//IR-684310-3DEXPERIENCER2019x
                    this.userMessaging.add({ className: "info", message: ParamSkeletonNLS.ExportXMLWarning});
                }
			},

            onFailureRequestFCSTicket : function (resp, iFileID) {
                UWA.log("Failure to Get a F***** Ticket"+ resp);// Why?
                Mask.unmask(this.contentDiv);
                //IR-684310-3DEXPERIENCER2019x
                if (iFileID === "Parameterization_Export") {
                    this.userMessaging.add({ className: "error", message: ParamSkeletonNLS.ExportParamFail});
                } else {
                    this.userMessaging.add({ className: "error", message: ParamSkeletonNLS.DownloadParamFail});
                }
            },

            postCallFCS : function (responseObjectJson) {
                //Content-Disposition: attachment
                var form = UWA.createElement('form', {
                        'class': 'form-wrapper hidden',
                        action: responseObjectJson.fcsxmlurl,
                        method: 'POST',
                        enctype: 'application/x-www-form-urlencoded',
                        //target: Utils.detectOs() === 'ios' ||  Utils.detectOs() === 'macos' ? '_blank' : 'uploadFrame' + that.id,
                        //target blank for ios download*
                        target: document.body,//'_blank'
                        //WARNING CHANGE target regarding to file
                        //target: '_blank',//new
                        html: [{
                            tag: 'input',
                            type: 'hidden',
                            name: '__fcs__jobTicket',
                            id: '__fcs__jobTicket',
                            value: responseObjectJson.fcsxmljobTicket
                        }]
                    });
                form.inject(this.contentDiv);//that.getBody()
                form.submit();
                Mask.unmask(this.contentDiv);

                setTimeout(function () {
                    form.remove();//Clean up
                }, 5000);
            },

            confirmationModalShow : function () {
                var headertitle, OKBtn, CancelBtn,
                    bodyDiv,
                    that = this;

                if (this.resetModal !== null) {
                    this.resetModal.show();//Modal already exists
                } else {
                    headertitle = UWA.createElement('h4', {
                        text   : ParamSkeletonNLS.confirmResetTitle,
                        'class': 'font-3dslight' // font-3dsbold
                    });

                    OKBtn = new Button({
                        value : ParamSkeletonNLS.OKButton,
                        className : 'btn primary',
                        events : {
                            'onClick' : function() {
                                UWA.log("DoSomething");
                                that.resetAndDeloyParams();
                            }
                        }
                    });
                    CancelBtn = new Button({
                        value : ParamSkeletonNLS.CancelButton,
                        className : 'btn default',
                        events : {
                            'onClick' : function(e) {
                                UWA.log("Cancel");
                            }
                        }
                    });
                    bodyDiv = UWA.createElement('div', {
                        'id': 'resetContentDiv',
                        'width' : '100%',
                        'height': '100%'
                    });
                    UWA.createElement('p', {
                        text   :  ParamSkeletonNLS.confirmResetMsg,
                        'class': 'font-3dslight'// font-3dsbold
                    }).inject(bodyDiv);

                    this.resetModal = new Modal({
                        className: "reset-confirm-modal",
                        closable: true,
                        header: headertitle,
                        body:   bodyDiv,
                        footer: [ OKBtn, CancelBtn ]
                    }).inject(this.contentDiv);
                    this.resetModal.getContent().setStyle("padding-top", 1);
                    this.resetModal.show();

                    this.resetModal.getContent().getElements(".btn").forEach(function (element) {
                        element.addEvent("click", function () {
                            that.resetModal.hide();
                        });
                    });
                }
            },

            //Rb0afx
            resetAndDeloyParams : function () {
                Mask.mask(this.contentDiv);
                var i, j, datacell, dataStruct, tbodyref, iLines,
                    tbodyreflist = this.contentDiv.getElements('.fparamtbody'),
                    nboffamilies = tbodyreflist.length,
                    wasAParamModified = false,
                    wasmodified = true;

                if ("ObjectIdentifier" === this.model.get("familyid")) {
                    this.ResetNamingParams();
                } else {
                    for (i = 0; i < nboffamilies; i++) {
                        tbodyref = tbodyreflist[i];
                        iLines = tbodyref.children;
                        for (j = 0; j < iLines.length; j++) {
                            datacell = iLines[j].cells[2];
                            dataStruct = datacell.getData('argumentNode');
                            wasmodified = this.resetInput(dataStruct);

                            if (wasmodified) { wasAParamModified = true; }
                        }
                    }
                    //FUN095483
                    if ("VersionNaming" === this.model.get("familyid")) {
                        if (!wasAParamModified) {
                            this.userMessaging.add({ className: "warning", message: ParamSkeletonNLS.NoChangeFound});
                        }
                        Mask.unmask(this.contentDiv);
                    } else {
                        if (!wasAParamModified) {//noparamReset, the current vals are basically the OOTB ones
                            Mask.unmask(this.contentDiv);
                            this.userMessaging.add({ className: "success", message: ParamSkeletonNLS.deploySuccessMsg});
                        }
                    }
                }//of else
            },

            //Rb0afx
            resetInput : function (idataStruct) {
                var j, optionValue, currSelectedOpt, currSelectedValue,
                    defaultvallist,
                    defaultval = idataStruct.defaultval,
                    paramID = idataStruct.paramid,
                    inputType = idataStruct.inputtype,
                    currSelectedList = [],
                    paramModified = true, that = this;
                    this.resetIsCalled = true;//IR-728233-3DEXPERIENCER2020x\21x
                this.inputControls.forEach(function (iInput) {
                    if (iInput.elements.input.id === paramID) {
                        if (inputType === "checkbox") {
                            if (defaultval == "Enabled") {
                                iInput.check();
                            } else {
                                iInput.uncheck();
                            }
                            iInput.dispatchEvent('onChange', this);//onClick
                        } else if (inputType === "combobox") {
                            //IR-728233-3DEXPERIENCER2020x\21x: Now it is not required.
                            //if (paramID !== "VNaming_DevelopmentPart") {
                            currSelectedOpt = iInput.getSelection();
                            currSelectedValue = currSelectedOpt[0].value;
                            if (defaultval == currSelectedValue) {
                                paramModified = false;
                                that.resetIsCalled = false;
                            }
                            for (j = 0; j < iInput.elements.input.length; j++) {
                                optionValue = iInput.elements.input[j].value;

                                if (optionValue === defaultval) {
                                    iInput.select(j, true, false);
                                }
                            }//of for elements
                            // }
                            // else { //VNaming_DevelopmentPart
                            //     paramModified = false;
                            // }
                        } else if (inputType === "comboboxmultiselect") {

                            currSelectedOpt = iInput.getSelection();
                            defaultvallist = null;
                            if (defaultval.indexOf(",")) {
                                defaultvallist = defaultval.split(",");
                            } else {
                                defaultvallist = [defaultval];
                            }

                            currSelectedOpt.forEach(function(item) {
                                currSelectedList.push(item.value);
                            });
                            //check if detaul value & selected value are same
                            if (ParamLayoutUtilities.compareArray(defaultvallist, currSelectedList)) {
                                paramModified = false;
                            }
                            if (paramModified) {
                                //clear user selection
                                iInput.clear(true);
                                for (j = 0; j < iInput.elements.input.length; j++) {
                                    optionValue = iInput.elements.input[j].value;

                                    defaultvallist.forEach(function (item) {
                                        if (optionValue === item) {
                                            iInput.select(j, true, true);
                                        }
                                    });
                                }//for loop
                                iInput.dispatchEvent('onChange');
                            }
                         // comboboxmultiselect
                        } else {
                            //textfield
                            iInput.setValue(defaultval);
                            paramModified = true;
                            iInput.dispatchEvent('onChange');
                        }
                    }
                });
                return paramModified;
            },

            checkParameterValueOnChange : function (inputElement, ctrlObjectCell, imageCell) {
                var errorMsg, dataStruct, datatype,
                    inputVal = inputElement.getValue();

                dataStruct = ctrlObjectCell.getData('argumentNode');
                datatype = dataStruct.argtype;

                if (ParamLayoutUtilities.testDataType(inputVal, datatype)) {
                    //All is good Send the POST Request
                    this.updateParameterOnChange(inputVal, ctrlObjectCell, imageCell);
                } else {
                    errorMsg = ParamLayoutUtilities.getTypeErrorMsgNLS(datatype);
                    this.ErrorMsgPopup = ParamLayoutUtilities.inputErrorCell(imageCell, errorMsg, 'red', this.ErrorMsgPopup);
                    this.userMessaging.add({ className: "error", message: errorMsg });
                }
            },

            //FUN095483
            updateRevisioningForPartRule : function(inputElement, ctrlObjectCell, imageCell) {
                var i, j, currSelOpt, currSelectedValue, optionValue,
                    ParamID = ctrlObjectCell.getData('argumentNode').paramid,
                    SetValueArray = inputElement.getValue(),
                    currSetValue =  SetValueArray[0],
                    toChangeValue = "NumericalRev",
                    ParamToTest = "VNaming_DevelopmentPart";

                if (currSetValue === "NumericalRev") { toChangeValue = "AlphabeticalRev"; }
                if (ParamID === "VNaming_DevelopmentPart") { ParamToTest = "VNaming_ProductionPart"; }

                if (("VNaming_DevelopmentPart" === ParamID) ||
                        ("VNaming_ProductionPart" === ParamID)) {
                    for (i = 0; i < this.inputControls.length; i++) {
                        if (this.inputControls[i].elements.input.id == ParamToTest) {
                            //Find the Selected option/value for other policy to Change (currSelectedValue)
                            currSelOpt = this.inputControls[i].getSelection();
                            currSelectedValue = currSelOpt[0].value;
                            //if this option matches the new value set () for
                            if (currSelectedValue == currSetValue) {
                                for (j = 0; j < this.inputControls[i].elements.input.length; j++) {
                                    optionValue = this.inputControls[i].elements.input[j].value;
                                    if (optionValue == toChangeValue) {
                                        this.inputControls[i].select(j, true, false);
                                        this.userMessaging.add({ className: "info", message: ParamSkeletonNLS.partSameSequence});
                                        break;
                                    }
                                }
                                break;
                            }//of  (currSelectedValue == currSetValue)
                        }
                    }//of for  this.inputControls
                }//of VNaming_DevelopmentPart == VNaming_ProductionPart

              //  this.updateParameterOnChange(currSetValue, ctrlObjectCell, imageCell);
            },

            updateRevisioningParameterOnChange : function(inputElement, ctrlObjectCell, imageCell) {
                var i, j, currSelOpt, currSelectedValue, optionValue,//currDate, currTime, diffDate,
                    currentPlatform = this.connectProps.tenantID,
                    ParamID = ctrlObjectCell.getData('argumentNode').paramid,
                    SetValueArray = inputElement.getValue(),
                    currSetValue =  SetValueArray[0];
                    //FUN095483 : apply Part rule
                    this.updateRevisioningForPartRule(inputElement, ctrlObjectCell, imageCell);
                    //hasAnInputChanged = false;
                this.resetIsCalled = false;
                //FUN095483 : Stop immediate deployment
                //this.updateParameterOnChange(currSetValue, ctrlObjectCell, imageCell);
            },

            updateComboMultiSelectParamOnChange : function(inputElement, ctrlObjectCell, imageCell) {
                //NZV : No need to separate funciton can be combined with function updateComboParamOnChange
                var SetValueArray = inputElement.getValue(),
                    currSetValue = null;

                if ((Array.isArray(SetValueArray) == true)) {
                    currSetValue = SetValueArray.join(",");
                }
                this.updateParameterOnChange(currSetValue, ctrlObjectCell, imageCell);
            },

            updateComboParamOnChange : function(inputElement, ctrlObjectCell, imageCell) {
                var SetValueArray = inputElement.getValue(),
                    currSetValue = SetValueArray.join(",");
                this.updateParameterOnChange(currSetValue, ctrlObjectCell, imageCell);
            },

            updateParameterOnChange : function(iValue, ctrlObjectCell, imageCell) {
                var iParam,
                    imageTXT = ParamSkeletonNLS.Under_Deploy,
                    ParamID = ctrlObjectCell.getData('argumentNode').paramid,
                    argID = ctrlObjectCell.getData('argumentNode').argumentid,
                    jsonArr = [],
                    ArgArr = [];
                    this.resetIsCalled = false;//IR-728233-3DEXPERIENCER2020x\21x : resetting flag
                ParamLayoutUtilities.beingDeployed(imageCell, imageTXT);

                ArgArr.push({id: argID, value: iValue});
                iParam = {
                    domain   : this.connectProps.domainName,
                    id       : ParamID,
                    argument : ArgArr
                };
                jsonArr.push(iParam);
                ParameterizationWebServices.postParamsArrOnServer.call(this, this.connectProps, jsonArr, imageCell,
                    this.onApplyFailure.bind(this), this.onApplySuccess.bind(this));
            },
            //FUN095483
            updateRevisionNaming : function (that) {
                var imgCell,
                    listOfNamingRules = [];

                const existingList  = that.collection._models[0]._attributes.family[0].parameter;
                for (let i = 0; i < that.inputControls.length; i++) {
                    var deployedValue = "";
                    for (let j=0; j < existingList.length; j++) {
                        if (that.inputControls[i].options.attributes.id === existingList[j].id) {
                            deployedValue = existingList[j].argument[0].argValue;
                            const currSelOpt = that.inputControls[i].getSelection();
                            const currSelectedValue = currSelOpt[0].value;
                            if(deployedValue !== currSelectedValue) {
                                var paramItem = {"domain": "ObjectIdentification", "id": "","argument":[]};

                                paramItem.id = that.inputControls[i].options.attributes.name;
                                var valObj = {"id":"Argument","value": currSelectedValue};
                                paramItem.argument.push(valObj);
                                listOfNamingRules.push(paramItem);
                            }
                            break;
                        }
                    }
                }
                console.log(listOfNamingRules);

                if (listOfNamingRules.length > 0) {
                    Mask.mask(that.contentDiv);
                    //if (that.collection.genPostParamsArrOnServer)
                    //    that.collection.genPostParamsArrOnServer(that.connectProps, "postparamsreturnrespforeach", listOfNamingRules, imgCell, that.onApplyFailure.bind(that), that.onApplySuccess.bind(that), that.collection._models[0]._attributes);
                    //else
                    ParameterizationWebServices.genPostParamsArrOnServer.call(that, that.connectProps, "postparamsreturnrespforeach", listOfNamingRules, imgCell, that.onApplyFailure.bind(that), that.onApplySuccess.bind(that));
                 } else {
                    if (that.lstRevNamIconModified.length  > 0) {
                        that.lstRevNamIconModified.forEach(function (elem) { ParamLayoutUtilities.updateIcon(true, elem.imageCell);});
                        that.lstRevNamIconModified.length = 0;
                    }
                    that.userMessaging.add({ className: "warning", message: ParamSkeletonNLS.NoChangeFound });
                 }
            },

            onApplyFailure : function (json, theImageCell) {
                var existingList, statusList, deployedValue, currSelOpt, currSelectedValue, i, j, k, arrSizeChange = false;
                UWA.log(json);
                //FUN095483
                if ((this.handledFamily === "VersionNaming")) {
                    statusList = JSON.parse(json.complementary);
                    if (statusList.length > 0) {
                        existingList  = this.collection._models[0]._attributes.family[0].parameter;
                        for (i = 0; i < this.lstRevNamIconModified.length; ) {
                            arrSizeChange = false
                            for (j = 0 ; j < statusList.length; j++ ) {
                                if (this.lstRevNamIconModified[i].id === statusList[j].id) {
                                    if (statusList[j].deployStatus  === "S_OK") {
                                        ParamLayoutUtilities.updateIcon(true, this.lstRevNamIconModified[i].imageCell);
                                        for (k=0; k < existingList.length; k++) {
                                            if (this.lstRevNamIconModified[i].id === existingList[k].id) {
                                                    deployedValue = existingList[k].argument[0].argValue;
                                                    currSelOpt = this.lstRevNamIconModified[i].inputElement.getSelection();
                                                    currSelectedValue = currSelOpt[0].value;
                                                    if (deployedValue !== currSelectedValue) {
                                                        existingList[k].argument[0].argValue = currSelectedValue;
                                                    }
                                                break;
                                            }
                                        }
                                        this.lstRevNamIconModified.splice(i,1);
                                        arrSizeChange = true;
                                    } else {
                                        ParamLayoutUtilities.updateIcon(false, this.lstRevNamIconModified[i].imageCell);
                                    }
                                    break;
                                }
                            }
                            if(arrSizeChange === false) { i++; }
                        }
                    }
                    Mask.unmask(this.contentDiv);//Rb0afx
                    this.userMessaging.add({ className: "error", message: ParamSkeletonNLS.deployPartiallyFailureMsg });

                 } else {
                    Mask.unmask(this.contentDiv);//Rb0afx
                    this.userMessaging.add({ className: "error", message: ParamSkeletonNLS.deployFailureMsg });
                    ParamLayoutUtilities.updateIcon(false, theImageCell);
                }
            },

            onApplySuccess : function (json, theImageCell) { //Rb0afx
                var currDate, currTime, diffDate,
                    successmsg = ParamSkeletonNLS.deploySuccessMsg, i, j, currSelOpt, currSelectedValue;// + ' - ' + new Date();
                Mask.unmask(this.contentDiv);
                UWA.log(json);

                currDate = new Date();
                currTime = currDate.getTime();
                diffDate = currTime - this.lastAlertDate;
                this.lastAlertDate = currTime;
                //IR-496432-3DEXPERIENCER2017x
                if (json.deployStatus === "S_OK") {
                    //FUN095483
                    if ((this.handledFamily === "VersionNaming")) {

                        for (i = 0; i < this.inputControls.length; i++) {
                            var existingList  = this.collection._models[0]._attributes.family[0].parameter;
                            var deployedValue = "";
                            for (j=0; j < existingList.length; j++) {
                                if (this.inputControls[i].options.attributes.id === existingList[j].id) {
                                        deployedValue = existingList[j].argument[0].argValue;
                                        currSelOpt = this.inputControls[i].getSelection();
                                        currSelectedValue = currSelOpt[0].value;
                                        if(deployedValue !== currSelectedValue) {
                                            existingList[j].argument[0].argValue = currSelectedValue;
                                        }
                                        break;
                                    }

                            }
                        }
                    }
                    if (diffDate >= 2000) {
                        this.userMessaging.add({ className: "success", message: successmsg });
                    }
                    //FUN095483
                    if (this.handledFamily === "VersionNaming") {
                        this.lstRevNamIconModified.forEach(function (elem) { ParamLayoutUtilities.updateIcon(true, elem.imageCell);});
                        this.lstRevNamIconModified.length = 0;
                    } else {
                        ParamLayoutUtilities.updateIcon(true, theImageCell);
                    }
                } else {
                    this.onApplyFailure(json, theImageCell);
                }

            },

            applyParams : function () {
                UWA.log("applyParams");
                //FUN095483
                if ("VersionNaming" !== this.model.get("familyid")) {
                    this.UpdateCommonParamsOnServer();
                } else {

                    //AttrUtilsView.showContextualDeleteModal(widget.body, lineAttr, removePop);
                    //IR-689657-3DEXPERIENCER2019x/20x : function signature changed
                    //FUN095483
                    ParamLayoutUtilities.showContextualDeleteModal(widget.body, "delAttrModal", ParamSkeletonNLS.RevNamingRuleWarning,
                        ParamSkeletonNLS.YesText,  ParamSkeletonNLS.NoText, ParamSkeletonNLS.Warning+"!", this.updateRevisionNaming, this);
                }
            },

            //show: function () {},
            destroy : function() {
                this.stopListening();
                this._parent.apply(this, arguments);
            }

        });

        return extendedView;
    });

define('DS/ParameterizationSkeleton/Views/ParameterizationSustainability/ParameterizationSustainabilityLayoutView', [
	'UWA/Core',
	'UWA/Class/View',
	'DS/UIKIT/Mask',
	'DS/UIKIT/Scroller',
	'DS/UIKIT/Popover',
	'DS/UIKIT/Input/Select',
	'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
	'DS/ParameterizationSkeleton/Views/ParametersLayoutView',
	'DS/ParameterizationSkeleton/Utils/ParameterizationSustainabilityWebServices',
	'i18n!DS/ParameterizationSkeleton/assets/nls/SustainabilityParameterizationNLS',
	'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS'
],
function (UWA,
		View,
		Mask,
		Scroller,
		Popover,
		Select,
		ParametersLayoutViewUtilities,
		ParametersLayoutView,
		ParameterizationSustainabilityWebServices,
		BINLS,
		ParamSkeletonNLS) {

		'use strict';

		const extendedView = View.extend({
			tagName: 'div',
			className: 'generic-detail',

			init: function (options) {
				options = UWA.clone(options || {}, false);
				this._parent(options);
				this.columnWidthArray = [60, 5, 25, 10];//[65, 20, 5, 10];
				this.options = options;
				this.contentDiv = null;
				this.paramScroller = null;
				this.controlDiv = null;
				this.inputControls = [];
				this.imgCells = [];
				this.userMessaging = ParametersLayoutViewUtilities.createWdgAlert();;
				this.lastAlertDate = new Date().getTime();
			},


			setup: function (options) {
				UWA.log('BILayoutView ::setup!');
				UWA.log(options);
				//this.initAutoComplete();
			},
			render: function () {
				UWA.log("BILayoutView::render");

				this.contentDiv = UWA.createElement('div', {
					'id': 'mainParamDiv'
				});
				Mask.mask(this.contentDiv);

				let introDiv = ParametersLayoutViewUtilities.createInfoDiv(this.model.get("introduction"));
				introDiv.inject(this.contentDiv);

				this.parentView = new ParametersLayoutView(this.options);

				var activateApply = true;
				
				this.container.setContent(this.contentDiv);

				this.listenTo(this.collection, {
					onSync: this.onCompleteRequestMapping,
					onError:this.onFailureToFetchBI
				});

				return this;
			},
			onFailureToFetchBI: function(){
			 Mask.unmask(this.contentDiv);
                ParametersLayoutViewUtilities.createParamMask(this.contentDiv, ParamSkeletonNLS.NoParamAvailabletxt);
			},
			onCompleteRequestMapping: function () {
				UWA.log('BILayoutView :: onCompleteRequestMapping!');

				let evolution = this.collection._models[0]._attributes;
				this.domainCost = evolution.KPIDomain.Cost;
				if(this.domainCost === BINLS.CostingDefaultEvolution){
					evolution["CostingEvolutionProcesses"] = [this.domainCost];
				}
				let family = {
					id: "businessinsightparam",
					parameter: [
						{
							isDeployed: false,
							argument: [
								{
									id: "Cost",
									defaultValue: "",
									type: "string",
									input: "combobox",
									value: this.domainCost 
								}
							],
							nlsKey: BINLS.CostingDomainTitle,
							tooltipNlsKey: BINLS.CostingDomainTooltip,
							id: "Cost",
							comboboxValues: evolution
						}
					]
				};

				this.paramsDIV = ParametersLayoutViewUtilities.createParamsContainerDiv();
				this.paramsDIV.inject(this.contentDiv);

				//Accordion 
				this.baseAccordion =  ParametersLayoutViewUtilities.createFamilyUIKITAccordion(this.paramsDIV);

				let tableContent = this.buildTableContent(family);
				tableContent.inject(this.paramsDIV);

				this.paramScroller = new Scroller({
					element: this.paramsDIV
				}).inject(this.contentDiv);
				this.baseAccordion.addItem({
				title: BINLS.MetricEvolutionAccordionTitle,
				content: tableContent,
				selected: true,
				name: "Header",
				});
			
				UWA.log('unmask');
				Mask.unmask(this.contentDiv);
			},
			buildTableContent: function (iFamily) {

				let familyTable = UWA.createElement('table', {
					'class': 'table table-hover',
					'table-layout': 'fixed',
					'id': iFamily.id + 'familytable'
				});
				familyTable.setStyle("margin-bottom", "80px");
				let ftbody = UWA.createElement('tbody', {
					'class': 'fparamtbody',
					'id': iFamily.id + 'familytbody'
				}).inject(familyTable);

				this.buildParametersLayout(iFamily, ftbody);

				return familyTable;
			},
			buildParametersLayout: function (iElements, familytbody) {
				this.buildComboParam(iElements.parameter[0], familytbody);
			},

			buildComboParam: function (param, familytbody) {
				var that = this;
				let popoverPosition = ParametersLayoutViewUtilities.computePopoverPos(0, "mid", 1);

				let newParamline = UWA.createElement('tr', { title: '' });
				let iArgument = param.argument[0];
				let imgCell = ParametersLayoutViewUtilities.buildDeployStsCell(param.isDeployed, this.columnWidthArray[3].toString() + '%', '2', 'right');//5%
				let paramTextCell = UWA.createElement('td', {
					'width': this.columnWidthArray[0].toString() + '%',
					'title': ''
				});
				paramTextCell.setStyle("vertical-align", "text-bottom");
				UWA.createElement('p', { text: param.nlsKey, 'class': '' }).inject(paramTextCell);
				let paramInfoCell = UWA.createElement('td', {
					'width': this.columnWidthArray[1].toString() + '%',
					'align': 'left'
				});
				paramInfoCell.setStyle("vertical-align", "text-bottom");
				let imgInfoSpan = UWA.createElement('span', {
					'class': 'fonticon fonticon-info'
				}).inject(paramInfoCell);
				imgInfoSpan.setStyle("color", "black");

				let popoverTooltip = new Popover({
					target: imgInfoSpan,
					trigger: "hover",
					animate: "true",
					position: popoverPosition,
					body: param.tooltipNlsKey,
					title: ''
				});

				popoverTooltip.elements.container.setStyle("max-width", "400px");
				
				let controlObjectCell = ParametersLayoutViewUtilities.buildControlCell(param.id, iArgument, this.columnWidthArray[2].toString() + '%');
				let iController = new Select({
					placeholder: false,
					multiple: false,
					attributes: {
						id: param.id,
						name: param.id,
						disabled: false
					}
				});
				iController.getContent().setStyle("width", "100%");
				iController.getContent().setStyle("text-align", "left");
				iController = this.fillComboBox (iController, param.id, iArgument.value, param.comboboxValues);
					iController.addEvent("onChange", function () {
						ParametersLayoutViewUtilities.beingModified(imgCell, ParamSkeletonNLS.ParamBeingModified, '2');
						let valueArray = this.getValue();	
						let value = valueArray === undefined || !Array.isArray(valueArray)	? '' : valueArray[0];
						if(value== BINLS.CostingEvolutionConcurrent)
							that.processChangeCheck(value,controlObjectCell, imgCell);
						else
							that.updateParameterOnChange(value, controlObjectCell, imgCell);
					});
				
				iController.inject(controlObjectCell);
				this.inputControls.push(iController);
				this.imgCells.push(imgCell);
				paramTextCell.inject(newParamline);
				paramInfoCell.inject(newParamline);
				controlObjectCell.inject(newParamline);
				
				imgCell.inject(newParamline);
				newParamline.inject(familytbody);//familyparamtable
			},
			processChangeCheck: function(iValue, icontrolObjectCell, imageCell){
			
			return ParameterizationSustainabilityWebServices.checkIfCostMetricsExistsBeyondInWork().then(function (result) {
					if(result=="false")
						return this.updateParameterOnChange(iValue, icontrolObjectCell, imageCell);
					else
						return this.onApplyFailure(true);
				}.bind(this))
					.catch(function (err) {
						return this.onApplyFailure(err, imageCell);
					}.bind(this));
			},
			updateParameterOnChange: function (iValue, ctrlObjectCell, imageCell) {
				let imageTXT = ParamSkeletonNLS.Under_Deploy;
				let ParamID = ctrlObjectCell.getData('argumentNode').paramid;
				let argID = ctrlObjectCell.getData('argumentNode').argumentid;
				let jsonArr = [];
				let ArgArr = [];
				this.resetIsCalled = false;
				ParametersLayoutViewUtilities.beingDeployed(imageCell, imageTXT);

				ArgArr.push({ id: argID, value: iValue });
				let iParam = {
					domain: this.model.get("domainid"),
					id: ParamID,
					argument: ArgArr
				};
				jsonArr.push(iParam);
				return ParameterizationSustainabilityWebServices.setSustainabilityEvolution(jsonArr).then(function (result) {
					return this.onApplySuccess(result, imageCell);
				}.bind(this))
					.catch(function (err) {
						return this.onApplyFailure(err, imageCell);
					}.bind(this));

			},
			fillComboBox: function (controller, key, selectedValue, comboboxValues) {
				let optionsList = comboboxValues['CostingEvolutionProcesses'].map(function (item) {
							return {
								label: item,
								value: item,
								selected: (selectedValue === item)
							};
						});
						controller.add(optionsList);
						return controller;
			},
			onApplyFailure: function (CustomMsg) {
				Mask.unmask(this.contentDiv);
				let ErrorMsg = ParamSkeletonNLS.deployFailureMsg;
				if(CustomMsg==true)
					ErrorMsg =  BINLS.deployFailureMsg;
				
				this.userMessaging.add({ className: "error", message: ErrorMsg });
				this.userMessaging.inject(this.paramsDIV);
				ParametersLayoutViewUtilities.updateIcon(false, this.imgCells[0]);
			},
			onApplySuccess: function (json) {
				const successmsg = ParamSkeletonNLS.deploySuccessMsg;
				Mask.unmask(this.contentDiv);
				UWA.log(json);

				let currDate = new Date();
				let currTime = currDate.getTime();
				let diffDate = currTime - this.lastAlertDate;
				this.lastAlertDate = currTime;

				if (json.status === "success") {
					if (diffDate >= 2000) {
						this.userMessaging.add({ className: "success", message: successmsg });
						this.userMessaging.inject(this.paramsDIV);
					}
					ParametersLayoutViewUtilities.updateIcon(true, this.imgCells[0]);
				} else {
					this.onApplyFailure(json);
				}

			},
			destroy: function () {
				this.stopListening();
				this._parent.apply(this, arguments);
			}
		});

		return extendedView;
		
	});
	


define('DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/CompanyIdentificationLayoutView', [
	'UWA/Core',
	'UWA/Class/View',
	'DS/UIKIT/Mask',
	'DS/UIKIT/Scroller',
	'DS/WAFData/WAFData',
	'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
	'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
	'DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/CompanyIDViewUtilities',
	'DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/ParameterizationFLWebConstants',
	'DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/FLWebModal',
	'DS/UIKIT/Input/Button',
	'DS/UIKIT/Alert',
	'DS/ParameterizationSkeleton/Views/ParametersLayoutView',
	'i18n!DS/ParameterizationSkeleton/assets/nls/FLWebNLS',
	],
	function(UWA,
			View,
			Mask,
			Scroller,
			WAFData,
			ParametersLayoutViewUtilities,
			URLHandler,
			CompanyIDViewUtilities,
			ParameterizationFLWebConstants,
			FLWebModal,
			Button,
			Alert,
			ParametersLayoutView,
			FLWebNLS) {

	'use strict';

	var extendedView;

	extendedView = View.extend({
		tagName: 'div',
		className: 'generic-detail',

		init: function(options) {
			var initDate = new Date();
			options = UWA.clone(options || {}, false);
			this._parent(options);
			this.options = options;
			this.contentDiv = null;
			this.paramScroller = null;
			this.paramAltSubScroller = null; //paramUnicitySubScroller
			this.userMessaging = null;
			this.lastAlertDate = initDate.getTime();
			this.controlDiv = null;
      this.cellsIndexForArchNumCollab = {
          "name": 0,
          "value": 1,
          "action": 2,
          "deployFlag": 3
      };
		},

		setup: function(options) {
			UWA.log('Architect Layout::setup!');
			UWA.log(options);
		},

		render: function() {
			UWA.log("Architect LayoutView::render");
			var introDiv,
			mappingDiv,
			that = this;

			this.contentDiv = UWA.createElement('div', {
				'id': 'typeMainDiv'
			});
			Mask.mask(this.contentDiv);

			introDiv = UWA.createElement('div', {
				'class': 'information-arch'
			}).inject(this.contentDiv);

			UWA.createElement('p', {
				text: FLWebNLS.intro,
				'class': 'font-3dslight'
			}).inject(introDiv);

			this.parentView = new ParametersLayoutView(this.options);

			this.controlDiv = ParametersLayoutViewUtilities.createApplyResetToolbar.call(this, this.contentDiv, true, this.applyParams.bind(this), this.resetParams.bind(this));

			this.container.setContent(this.contentDiv);
			this.listenTo(this.collection, {
				onSync: that.onCompleteRequestMapping
			});

			return this;
		},

		onCompleteRequestMapping: function() {
			var that = this;
			UWA.log('Architecture Layout::Complete rendering!');
			var collection = this.collection._models[0]._attributes;
			CompanyIDViewUtilities.physicalProductAttributes(collection.PhysicalProductAttributes);
			var fields = collection.ExpressionList;
			var nosOfFields = (fields) ? fields.length : 0;
			this.divPartNumbering = UWA.createElement('div', {
				'class': 'architectureNumberingDivScroll',
			}).inject(this.contentDiv);
			this.baseAccordion = ParametersLayoutViewUtilities.createFamilyUIKITAccordion(this.divPartNumbering);
			var partNumberingParentDiv = UWA.createElement('div', {'class': 'architectureNumberingContent'});
			var partNumberingDiv = UWA.createElement('div', {'class': 'architectureNumbering'});
			var partNumberTable = CompanyIDViewUtilities.buildAttributeTable(collection);
			partNumberTable.inject(partNumberingDiv);
			var AddMappingButton = new Button({
				className: 'AddPartNumberFieldButton',
				icon: 'plus-circled',
				attributes: {
					disabled: false,
					'aria-hidden': 'true',
					title: FLWebNLS.AddFieldMappingTooltip,
				},
				events: {
					onClick: function(e) {
						that.ShowAddNewFieldPanel(that, partNumberTable.getElement(".partNumberFieldbody"));
					}
				}
			}).inject(partNumberingDiv);
			partNumberingParentDiv.appendChild(partNumberingDiv);
			this.baseAccordion.addItem({
				title: FLWebNLS.label_ANFormatConfigAccrdTitle,
				content: partNumberingParentDiv,
				selected: true,
				name: FLWebNLS.BaseName,
			});
			partNumberingDiv.appendChild(this.controlDiv);
			for (var i = 0; i < nosOfFields; i++) {
				var field = fields[i];
				var deployedStatus = (field.Deployed && field.Deployed=="True")? ParameterizationFLWebConstants.DEPOLOYED : ParameterizationFLWebConstants.NEW_NOT_DEPLOYED;
				var fieldInfo = CompanyIDViewUtilities.buildNewPartNumberField(
						CompanyIDViewUtilities.buildJsonObjForPNField(ParameterizationFLWebConstants.ADD, field.Name, field.Order, field.Type, field.Value, field[ParameterizationFLWebConstants.ATTRIBUTE]?field[ParameterizationFLWebConstants.ATTRIBUTE]:'', field[ParameterizationFLWebConstants.COUNTER]?field[ParameterizationFLWebConstants.COUNTER]:'', field.Label, field.Default),
						deployedStatus);
				fieldInfo.inject(partNumberTable.getElement(".partNumberFieldbody"));
			}

			this.paramScroller = new Scroller({
				element: partNumberingDiv
			}).inject(partNumberingParentDiv);

			var url = URLHandler.getURL() + "/resources/v1/SystemsArchitectureDefinitionParam/getCollaborativeSpaceGrouping?tenant=" + URLHandler.getTenant() /*+ "&domainid=SystemsArchitectureDefinition"*/;
			WAFData.authenticatedRequest(url, {
				timeout: 250000,
				method: 'GET',
				type: 'json',
				headers: {
					'Content-Type': 'application/json',
					'Accept': 'application/json',
				},

				onFailure: function (result) {
					Mask.unmask(that.contentDiv);
					that.getAlertMessage(/*FLWebNLS.*/'Unable to fetch Architecture Number CollabSpace Grouping details', 'error', this.contentDiv);
				},
				onComplete: function (result) {
					that.buildArchNumColabUnicitySection(result);
					that.sysArcDefOtbParameterAccordean()
				}
			});
			Mask.unmask(this.contentDiv);
		},

		buildArchNumColabUnicitySection: function(collection){
			var that = this;
			localStorage.setItem('csList', JSON.stringify(collection.csList));
			var archNumCollabUnicityContainer = UWA.createElement('div', {'class': 'archNumCollabUnicityContainer'});
			var archNumCollabTableContainer = UWA.createElement('div', {'class': 'arhNumCollabTableMainContainer'}); //css: architectureNumberingContent
			var archNumCollabTableSubContainer = UWA.createElement('div', {'class': 'arhNumCollabTableSubContainer'}); //css: architectureNumbering
			var archNumCollabTable = CompanyIDViewUtilities.buildArchNumCollabUnicitySecTable();
			archNumCollabTable.inject(archNumCollabTableSubContainer);
			archNumCollabTableContainer.appendChild(archNumCollabTableSubContainer);

			var AddMappingButton = new Button({
				className: 'AddPartNumberFieldButton',
				icon: 'plus-circled',
				attributes: {
					disabled: false,
					'aria-hidden': 'true',
					title: FLWebNLS.label_CSgroupingButtonTooltip,
				},
				events: {
					onClick: function(e) {
						that.createCollabUnicitySecAddFieldModal(archNumCollabTable.getElement("#archNumCollabUnicityTableBody"));
					}
				}
			}).inject(archNumCollabTableContainer);

			archNumCollabTableContainer.inject(archNumCollabUnicityContainer);
			var footer = ParametersLayoutViewUtilities.createApplyResetToolbar.call(this, archNumCollabUnicityContainer, true,
					this.applyArchNumCollabUnicity.bind(this),
					this.resetArchNumCollabUnicity.bind(this));
			var collabArchNumUnicityCheckDiv = UWA.createElement('div', {'class': 'architectureNumberingContent'});
			this.collabArchNumUnicityCheckAccrdn = ParametersLayoutViewUtilities.createFamilyUIKITAccordion(this.divPartNumbering);
			this.collabArchNumUnicityCheckAccrdn.addItem({
				title: FLWebNLS.label_CSgroupingAccrdTitle,
				content: archNumCollabUnicityContainer,
				selected: false,
				name: 'Architecture_Number_Collabspace_Unicity'
			});
			var groups = collection && collection.csGroups ? collection.csGroups : '';
			for (var groupName in groups) {
				var csListString = '';
				for(var i = 0; i < groups[groupName].length-1; i++){
					csListString += groups[groupName][i] + ',';
				}
				csListString += groups[groupName][i]
				//csListString = csListString.substring(0, csListString.length-2);
				var fieldInfo = CompanyIDViewUtilities.buildNewArchNumCollabField({Name:groupName, Value:csListString}, ParameterizationFLWebConstants.DEPOLOYED);
				//CompanyIDViewUtilities.buildJsonObjForPNField(ParameterizationFLWebConstants.ADD, field.Order, field.Type, field.Value),deployedStatus);
				fieldInfo.inject(archNumCollabTable.getElement("#archNumCollabUnicityTableBody"));
			}
			// this.paramScroller = new Scroller({
			//     element: archNumCollabTableSubContainer
			// }).inject(archNumCollabTableContainer);
		},

		sysArcDefOtbParameterAccordean : function(){
			var that = this;
			var that =this;
			var url = URLHandler.getURL() + "/resources/ParamWS/access/DomainElements?tenant=" + URLHandler.getTenant() + "&domainid=SystemsArchitectureDefinitionOtbParameter";
			WAFData.authenticatedRequest(url, {
				timeout: 250000,
				method: 'GET',
				type: 'json',
				headers: {
					'Content-Type': 'application/json',
					'Accept': 'application/json',
				},

				onFailure: function (result) {
					Mask.unmask(that.contentDiv);
					that.getAlertMessage(FLWebNLS.unicityCheckSubParamError, 'error', this.contentDiv);
				},

				onComplete: function (result) {
					for(let i=0; i < result.family.length; i++){
						var paramFamily = result.family[i];
						that.getSysArcDefOtbParameterProperties(paramFamily, that.paramAltSubScroller);
					}
				}
			});
		},

		getSysArcDefOtbParameterProperties : function(otbParamFamily){
			var that = this;
			try{
				that.paramAccordean = ParametersLayoutViewUtilities.createFamilyUIKITAccordion(that.divPartNumbering);
				var nbParam = otbParamFamily.parameter && otbParamFamily.parameter.length? otbParamFamily.parameter.length : 0;
				var accordeanContentDiv = UWA.createElement('div', {    'class': 'unicitySubContent'    });
				var paramTableDiv = UWA.createElement('div', {  'class': 'unicitySubstitute', 'styles':{'height': 60*nbParam+'px'}});
				that.model.set("introduction", "");
				that.parentView = that._updateParentViewWithNewDomain(that.parentView,"SystemsArchitectureDefinitionOtbParameter");
				that.parentView.render();
				var tableContent = this.parentView.buildFamilyItemContent(otbParamFamily, null);
				that.paramAccordean.addItem({
					title: otbParamFamily.nlsKey,
					content: accordeanContentDiv,
					selected: false,
					name: otbParamFamily.id
				});

				paramTableDiv.appendChild(tableContent);
				new Scroller({
					element: paramTableDiv
				}).inject(accordeanContentDiv);
			}catch(error) {
			}	finally {
				that.parentView = that._updateParentViewWithNewDomain(that.parentView,"SystemsArchitectureDefinitionOtbParameter");
			}
		},

		resetParams: function(){
			var fieldsToBeRemoved = new Array();
			var rowsOfMappedFields = this.contentDiv.getElementsByClassName("partNumberFieldMapping");
			for (var i = 0; i < rowsOfMappedFields.length; i++) {
				if (rowsOfMappedFields[i].value == ParameterizationFLWebConstants.NEW_NOT_DEPLOYED) {
					fieldsToBeRemoved.push(CompanyIDViewUtilities.resetForFieldLineChanges(rowsOfMappedFields[i]));
				}
			}
			fieldsToBeRemoved.forEach(function(attrMapping) {
				if (attrMapping) {
					attrMapping.remove();
				}
			});
			CompanyIDViewUtilities.updateFormulaTextFields(ParameterizationFLWebConstants.MAX_ROWS + 1, null, null, ParameterizationFLWebConstants.DEPOLOYED);
		},

		resetArchNumCollabUnicity: function(){
			var fieldsToBeRemoved = new Array();
			var rowsOfMappedFields = this.contentDiv.querySelectorAll('#archNumCollabTableRow');
			for (var i = 0; i < rowsOfMappedFields.length; i++) {
				if (rowsOfMappedFields[i].value == ParameterizationFLWebConstants.NEW_NOT_DEPLOYED) {
					fieldsToBeRemoved.push(CompanyIDViewUtilities.resetForFieldLineChangesArchNumGrouping(rowsOfMappedFields[i]));
				}
			}
			fieldsToBeRemoved.forEach(function(attrMapping) {
				if (attrMapping) {
					attrMapping.remove();
				}
			});
		},

		applyParams: function() {
			var that = this;
			var rowsOfMappedFields = this.contentDiv.getElementsByClassName("partNumberFieldMapping");
			var payloadToSend = {};
			Mask.mask(this.contentDiv);
			payloadToSend.ParameterExpressionList = [];
			for (var i = 0; i < rowsOfMappedFields.length; i++) {
				//if (rowsOfMappedFields[i].value == ParameterizationFLWebConstants.NEW_NOT_DEPLOYED) {
				var value = CompanyIDViewUtilities.buildsFieldJsonObject(rowsOfMappedFields[i]);
				value.Label = value.Name;
				payloadToSend.ParameterExpressionList.push(value);
				//}
		}
			// payloadToSend['UnicityCheck'] = localStorage.getItem('arch_number_unicity');
			var url = URLHandler.getURL() + "/resources/v1/SystemsArchitectureDefinitionParam/setParamArchitectureNumberExpressions?tenant=" + URLHandler.getTenant(),payloadToSend;
			WAFData.authenticatedRequest(url, {
				timeout: 250000,
				method: 'POST',
				data: JSON.stringify(payloadToSend),
				type: 'json',
				headers: {
					'Content-Type': 'application/json',
					'Accept': 'application/json'
				},
				onFailure: function(json) {
					Mask.unmask(that.contentDiv);
					that.onApplyFailure(FLWebNLS.ApplyError);
				},
				onComplete: function(json) {
					if (json.ParameterExpressionList/*.length > 0*/) {
						that.onApplySuccess();
						Mask.unmask(that.contentDiv);
						that.getAlertMessage(FLWebNLS.ApplySuccess, 'success', that.contentDiv);

					} else {
						Mask.unmask(that.contentDiv);
						that.onApplyFailure(json.message);
					}
				}

			});
		},

		applyArchNumCollabUnicity: function() {
			var that = this;
			var rowsOfMappedFields = this.contentDiv.querySelectorAll('#archNumCollabTableRow');
			var payloadToSend = {};
			payloadToSend['CollaborativeSpacesGroupList'] = [];
			var tableFieldObj;
			Mask.mask(this.contentDiv);
			for (var i = 0; i < rowsOfMappedFields.length; i++) {
				if (rowsOfMappedFields[i].cells[this.cellsIndexForArchNumCollab.deployFlag].value != ParameterizationFLWebConstants.REMOVE){//ParameterizationFLWebConstants.NEW_NOT_DEPLOYED) {
  				tableFieldObj = CompanyIDViewUtilities.buildsFieldJsonObjectForArchNUmCollab(rowsOfMappedFields[i]);
  				payloadToSend.CollaborativeSpacesGroupList.push({
  					name: tableFieldObj.Name,
  					csList: tableFieldObj.Value.trim().split(',')
  				})
				}
			}

			var url = URLHandler.getURL() + "/resources/v1/SystemsArchitectureDefinitionParam/setCollaborativeSpaceGrouping?tenant=" + URLHandler.getTenant();
			WAFData.authenticatedRequest(url, {
				timeout: 250000,
				method: 'POST',
				data: JSON.stringify(payloadToSend),
				type: 'json',

				headers: {
					'Content-Type': 'application/json',
					'Accept': 'application/json'
				},

				onFailure: function(json) {
					Mask.unmask(that.contentDiv);
					that.onApplyFailure(FLWebNLS.ApplyError);
				},

				onComplete: function(json) {
					//  if (json.ParameterExpressionList/*.length > 0*/) {
					that.archNumCollabGroupingApplySuccess();
					Mask.unmask(that.contentDiv);
					that.getAlertMessage(FLWebNLS.msg_CSgroupingFieldsUpdated, 'success', that.contentDiv);

					//  }
					// else {
					//     Mask.unmask(that.contentDiv);
					//     that.onApplyFailure(json.message);
					// }
				}

			});
		},

		onApplyFailure: function(message) {
			this.getAlertMessage(message, 'error', this.contentDiv);
		},

		onApplySuccess: function() {
			var fieldsToBeRemoved = new Array();
			var rowsOfMappedFields = this.contentDiv.getElementsByClassName("partNumberFieldMapping");
			for (var i = 0; i < rowsOfMappedFields.length; i++) {
				if (rowsOfMappedFields[i].value == ParameterizationFLWebConstants.NEW_NOT_DEPLOYED) {
					var statusCell = rowsOfMappedFields[i].cells[5];
					if (statusCell.value == ParameterizationFLWebConstants.ADD || statusCell.value == ParameterizationFLWebConstants.MODIFY) {
						rowsOfMappedFields[i].cells[5].empty();
						rowsOfMappedFields[i].value = ParameterizationFLWebConstants.DEPOLOYED;
						var imgSpan = CompanyIDViewUtilities.buildImgSpan('check', '1.5', 'green', FLWebNLS.Deployed);
						imgSpan.inject(rowsOfMappedFields[i].cells[5]);
					}
					if (rowsOfMappedFields[i].cells[5].value == ParameterizationFLWebConstants.REMOVE) {
						fieldsToBeRemoved.push(rowsOfMappedFields[i]);
					}
				}
			}
			fieldsToBeRemoved.forEach(function(attrMapping) {
				attrMapping.remove();
			});
			var formulaField = document.querySelector(".partNumberFormulaMapping");
			formulaField.cells[3].empty();
			var imgSpan = ParametersLayoutViewUtilities.buildImgSpan('check', '1.5', 'green', FLWebNLS.Deployed);
			imgSpan.inject(formulaField.cells[3]);
		},

		archNumCollabGroupingApplySuccess: function() {
			//CompanyIDViewUtilities.updateStrategy(strategyValue, ParameterizationFLWebConstants.DEPOLOYED);
			var fieldsToBeRemoved = new Array();
			var rowsOfMappedFields = this.contentDiv.querySelectorAll('#archNumCollabTableRow')
			for (var i = 0; i < rowsOfMappedFields.length; i++) {
				if (rowsOfMappedFields[i].value == ParameterizationFLWebConstants.NEW_NOT_DEPLOYED) {
					var statusCell = rowsOfMappedFields[i].cells[3];
					if (statusCell.value == ParameterizationFLWebConstants.ADD || statusCell.value == ParameterizationFLWebConstants.MODIFY) {
						rowsOfMappedFields[i].cells[3].empty();
						rowsOfMappedFields[i].value = ParameterizationFLWebConstants.DEPOLOYED;
						var imgSpan = CompanyIDViewUtilities.buildImgSpan('check', '1.5', 'green', FLWebNLS.Deployed);
						imgSpan.inject(rowsOfMappedFields[i].cells[3]);
					}
					if (rowsOfMappedFields[i].cells[3].value == ParameterizationFLWebConstants.REMOVE) {
						fieldsToBeRemoved.push(rowsOfMappedFields[i]);
					}
				}
			}
			fieldsToBeRemoved.forEach(function(attrMapping) {
				attrMapping.remove();
			});
		},

		ShowAddNewFieldPanel: function(attrtbody) {
			this.createPartNumberingDialogBox(attrtbody);
			var isDeployed = ParameterizationFLWebConstants.NEW_NOT_DEPLOYED;
		},

		createPartNumberingDialogBox: function(attrtbody) {
			var that = this;
			var attributes = (this.collection._models[0]._attributes && this.collection._models[0]._attributes.PhysicalProductAttributes);
			var options = {
					className: "part-number-modal",
					title: "Add Field"
			}
			this.modal = new FLWebModal(options);
			this.modal.getAttributes(attributes);
			if (this.modal.getTotalFormatRows() == ParameterizationFLWebConstants.MAX_ROWS) {
				var alert = that.modal.displayAlertMessage(FLWebNLS.maxLimitOfRows, document.querySelector('#typeMainDiv').getChildren()[0]);
			} else {
				function _getFooter() {
					return "<button type='button'  name='addButton' id='add-button' class='btn btn-primary'>" + FLWebNLS.add + "</button> " + "</button>" + "<button type='button' name='cancelButton' id='cancel-button' class='btn btn-default'>" + FLWebNLS.cancel + "</button>"
				}
				this.modal.modal.setFooter(_getFooter());
				this.modal.getModalBody();
				this.modal._bindFooterEvent();
				this.modal.getContent().getElements('.btn').forEach(function(element) {
					if (that.modal.isCounterExists(ParameterizationFLWebConstants.TYPE)) {
						that.modal.partNumberTypeCombobox.disable(ParameterizationFLWebConstants.FORMAT_COUNTER);
					}

					if (element.name === 'cancelButton') {
						element.addEvent('click', function() {
							that.modal.destroy();

						});
					} else if (element.name === 'addButton') {

						element.addEvent('click', function() {

							var toDisplayOver = that.modal.getContent().getElement('.enox-arch-number-content');

							if (that.modal.validateEnteredNameValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.nameNullMessage, toDisplayOver);
							} else if (that.modal.validateEnteredOrderValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.orderNullMessage, toDisplayOver);
							} else if (that.modal.validatSelectedTypeFieldValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.selectTypeMessage, toDisplayOver);
							} else if (that.modal.validateSelectedAttributeFieldValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.selectAttributeMessage, toDisplayOver);
							}else if (that.modal.validateEnteredCounterFieldValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.counterIsEmptyMessage, toDisplayOver);
							}else if (that.modal.validateEnteredValueFieldValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.valueEmptyMessage, toDisplayOver);
							} else {
								if (!that.modal.validateEnteredNameValue().isValid) {
									that.modal.displayAlertMessage(FLWebNLS.nameMessage +  ' ' + FLWebNLS.alreadyExists, toDisplayOver);
								} else if (!that.modal.validateEnteredOrderValue().isValid) {
									that.modal.displayAlertMessage(FLWebNLS.orderMessage +  ' ' + FLWebNLS.alreadyExists, toDisplayOver);
								} else {
									var userSelectedFormat = that.modal.getUserEnteredValues();

									userSelectedFormat[ParameterizationFLWebConstants.OPERATION] = ParameterizationFLWebConstants.ADD;
									var fieldInfo = CompanyIDViewUtilities.buildNewPartNumberField(userSelectedFormat, ParameterizationFLWebConstants.NEW_NOT_DEPLOYED);
									fieldInfo.inject(attrtbody.getElement(".partNumberFieldbody"));
									that.modal.destroy();
								}
							}
						});
					};
				});

				that.modal.show();
			}
		},

		createCollabUnicitySecAddFieldModal: function(tableBody) {
			var that = this;
			var options = {
					className: "part-number-modal",
					title: FLWebNLS.label_CSgroupingModalTitle
			}
			this.modal = new FLWebModal(options);
			if (this.modal.getTotalFormatRows() == ParameterizationFLWebConstants.MAX_ROWS) {
				var alert = that.modal.displayAlertMessage(FLWebNLS.maxLimitOfRows, document.querySelector('#typeMainDiv').getChildren()[0]);
			} else {
				function _getFooter() {
					return "<button type='button'  name='addButton' id='add-button' class='btn btn-primary'>" + FLWebNLS.add + "</button> " + "</button>" + "<button type='button' name='cancelButton' id='cancel-button' class='btn btn-default'>" + FLWebNLS.cancel + "</button>"
				}
				this.modal.modal.setFooter(_getFooter());
				this.modal.createCollabUnicitySecAddFieldModalBody();
				this.modal._bindFooterEvent();
				this.modal.getContent().getElements('.btn').forEach(function(element) {
					if (element.name === 'cancelButton') {
						element.addEvent('click', function() {
							that.modal.destroy();
						});
					} else if (element.name === 'addButton') {
						element.addEvent('click', function() {
							var toDisplayOver = that.modal.getContent().getElement('.enox-arch-number-content');
							if (that.modal.validateEnteredGroupNameValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.nameNullMessage, toDisplayOver);
							} else if (that.modal.validateEnteredCollabListValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.msg_CSFieldBlankAlert, toDisplayOver);
							}
							else {
								if (!that.modal.validateEnteredGroupNameValue().isValid) {
									that.modal.displayAlertMessage(FLWebNLS.nameMessage +  ' ' + FLWebNLS.alreadyExists, toDisplayOver);
								} else {
									var userSelectedFormat = that.modal.getUserEnteredValuesForArchNumCollabUnicity();
									userSelectedFormat[ParameterizationFLWebConstants.OPERATION] = ParameterizationFLWebConstants.ADD;
									var fieldInfo = CompanyIDViewUtilities.buildNewArchNumCollabField(userSelectedFormat, ParameterizationFLWebConstants.NEW_NOT_DEPLOYED);
									fieldInfo.inject(tableBody);
									that.modal.destroy();
								}
							}
						});
					};
				});

				that.modal.show();
			}
		},

		getAlertMessage: function (message, className, toDisplayOn) {

			this.alertOptions = {
					visible: true,
					className: 'param-alert',
					messageClassName: className,
					closable: true,
					renderTo: toDisplayOn,
					autoHide: true,
					hideDelay: 2000
			};

			var alert = new Alert(this.alertOptions);
			alert.add({
				message: message,
			});

		},

		destroy: function() {
			this.stopListening();
			this._parent.apply(this, arguments);
		},
		_updateParentViewWithNewDomain : function(view, domainId){
			view.options.domainid = domainId;
			view.model.id = domainId;
			view.model._attributes.domainid = domainId;
			view.model._attributes.id = domainId;
			return view;
		},
	});

	return extendedView;
});

define('DS/ParameterizationSkeleton/Views/VersionNaming1/VersionNamingLayoutView', [
	'UWA/Core',
	'UWA/Class/View',
	'DS/UIKIT/Mask',
	'DS/UIKIT/Scroller',
	'DS/WAFData/WAFData',
	'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
	'DS/ParameterizationSkeleton/Views/ParametersLayoutView',
    'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS',
	],
	function (UWA,
			View,
			Mask,
			Scroller,
			WAFData,
			ParametersLayoutViewUtilities,
			ParametersLayoutView,
            ParamSkeletonNLS) {

	'use strict';

	var extendedView;

	extendedView = View.extend({
		tagName: 'div',
		className: 'generic-detail',

		init: function (options) {
			options = UWA.clone(options || {}, false);
			this._parent(options);

			this.options = options;
            this.contentMainDiv = null;
		},

		setup: function (options) {
			console.log('VersionNamingView Layout::setup');
		},

		render: function () {
			console.log("VersionNamingView LayoutView::render");
			var that = this;

			this.contentMainDiv = UWA.createElement('div', {
                styles: {
                    height: '100%'
                }
			});
			
            if (this.parentView) this.parentView.remove();
            this.parentView = new ParametersLayoutView(this.options);
            this.parentView.render();

            this.parentView.contentDiv.inject(this.contentMainDiv);

			this.container.setContent(this.contentMainDiv);
            
            this.listenTo(this.collection, {
				onSync: that.onCompleteRequestParameters,
                onRequest: that.onRequestCB,
			});

			return this;
		},

        onRequestCB: function() {
            Mask.mask(this.parentView.contentDiv);
        },

		onCompleteRequestParameters: function () {

            var pdivs = this.parentView.contentDiv.getElements("#parametersDiv");
            if (pdivs && pdivs.length > 1)
                pdivs[0].remove();

            Mask.unmask(this.parentView.contentDiv);
		},

	});

	return extendedView;
});

define('DS/ParameterizationSkeleton/Views/ParameterizationXEngineering/ParamXENAlternateAdminView', [
    'UWA/Core',
    'UWA/Class/View',
    'DS/UIKIT/Mask',
    'DS/ParameterizationSkeleton/Views/ParametersLayoutView',
], (
    UWA,
    View,
    Mask,
    ParametersLayoutView,
) => {
    let extendedView;

    extendedView = View.extend({
        tagName: 'div',
        className: 'generic-detail',

        init(options) {
            const initDate = new Date();
            options = UWA.clone(options || {}, false);
            this._parent(options);
            this.options = options;
            this.contentDiv = null;
            this.lastAlertDate = initDate.getTime();
        },

        setup(options) {
            UWA.log('ParamXENAlternateAdminView Layout::setup!');
            UWA.log(options);
        },

        render() {
            UWA.log('ParamXENAlternateAdminView LayoutView::render');

            this.contentDiv = UWA.createElement('div', {
                id: 'typeMainDiv',
            });
            Mask.mask(this.contentDiv);

            this.parentView = new ParametersLayoutView(this.options);
            this.container.setContent(this.contentDiv);
            this.listenTo(this.collection, {
                onSync: this.onCompleteRequestMapping,
            });
            return this;
        },

        onCompleteRequestMapping() {
            const otbView = this.parentView.buildFamilyItemContent(this.collection._models[0]._attributes.family[0], null);
            this.contentDiv.appendChild(otbView);
            Mask.unmask(this.contentDiv);
            //  this.parentView = this._updateParentViewWithNewDomain(this.parentView,"SystemsArchitectureDefinitionOtbParameter");
            this.parentView.render();
        },
    });

    return extendedView;
});

define('DS/ParameterizationSkeleton/Views/ParameterizationXEngineering/ParamXENPartNumberAdminView', [
    'UWA/Core',
    'UWA/Class/View',
    'DS/UIKIT/Mask',
    'DS/ParameterizationSkeleton/Views/ParametersLayoutView',
], (
    UWA,
    View,
    Mask,
    ParametersLayoutView,
) => {
    let extendedView;

    extendedView = View.extend({
        tagName: 'div',
        className: 'generic-detail',

        init(options) {
            const initDate = new Date();
            options = UWA.clone(options || {}, false);
            this._parent(options);
            this.options = options;
            this.contentDiv = null;
            this.lastAlertDate = initDate.getTime();
        },

        setup(options) {
            UWA.log('ParamXENPartNumberAdminView Layout::setup!');
            UWA.log(options);
        },

        render() {
            UWA.log('ParamXENPartNumberAdminView LayoutView::render');
            const that = this;

            this.contentDiv = UWA.createElement('div', {
                id: 'typeMainXENDiv',
            });
            Mask.mask(this.contentDiv);
            this.parentView = new ParametersLayoutView(this.options);
            this.container.setContent(this.contentDiv);
            this.listenTo(this.collection, {
                onSync: that.onCompleteRequestMapping,
            });
            return this;
        },

        onCompleteRequestMapping() {
            const otbView = this.parentView.buildFamilyItemContent(this.collection._models[0]._attributes.family[0], null);
            this.contentDiv.appendChild(otbView);
            Mask.unmask(this.contentDiv);
            //  this.parentView = this._updateParentViewWithNewDomain(this.parentView,"SystemsArchitectureDefinitionOtbParameter");
            this.parentView.render();
        },
    });

    return extendedView;
});

define('DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/ParamSAXUncityView', [
	'UWA/Core',
	'UWA/Class/View',
	'DS/UIKIT/Mask',
	'DS/UIKIT/Scroller',
	'DS/WAFData/WAFData',
	'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
	'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
	'DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/CompanyIDViewUtilities',
	'DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/ParameterizationFLWebConstants',
	'DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/FLWebModal',
	'DS/UIKIT/Input/Button',
	'DS/UIKIT/Alert',
	'DS/ParameterizationSkeleton/Views/ParametersLayoutView',
	'i18n!DS/ParameterizationSkeleton/assets/nls/FLWebNLS',
	],
	function(UWA,
			View,
			Mask,
			Scroller,
			WAFData,
			ParametersLayoutViewUtilities,
			URLHandler,
			CompanyIDViewUtilities,
			ParameterizationFLWebConstants,
			FLWebModal,
			Button,
			Alert,
			ParametersLayoutView,
			FLWebNLS) {

	'use strict';

	var extendedView;

	extendedView = View.extend({
		tagName: 'div',
		className: 'generic-detail',

		init: function(options) {
			var initDate = new Date();
			options = UWA.clone(options || {}, false);
			this._parent(options);
			this.options = options;
			this.contentDiv = null;
			this.paramScroller = null;
			this.paramAltSubScroller = null; //paramUnicitySubScroller
			this.userMessaging = null;
			this.lastAlertDate = initDate.getTime();
			this.controlDiv = null;
      this.cellsIndexForArchNumCollab = {
          "name": 0,
          "value": 1,
          "action": 2,
          "deployFlag": 3
      };
		},

		setup: function(options) {
			UWA.log('Architect Layout::setup!');
			UWA.log(options);
		},

		render: function() {
			UWA.log("Architect LayoutView::render");
			var introDiv,
			mappingDiv,
			that = this;

			this.contentDiv = UWA.createElement('div', {
				'id': 'typeMainDiv'
			});
			Mask.mask(this.contentDiv);

			// introDiv = UWA.createElement('div', {
			// 	'class': 'information-arch'
			// }).inject(this.contentDiv);
			//
			// UWA.createElement('p', {
			// 	text: FLWebNLS.intro,
			// 	'class': 'font-3dslight'
			// }).inject(introDiv);

			this.parentView = new ParametersLayoutView(this.options);

		//	this.controlDiv = ParametersLayoutViewUtilities.createApplyResetToolbar.call(this, this.contentDiv, true, this.applyParams.bind(this), this.resetParams.bind(this));

			this.container.setContent(this.contentDiv);
			this.listenTo(this.collection, {
				onSync: that.onCompleteRequestMapping
			});

			return this;
		},

		onCompleteRequestMapping: function(){
			this.divPartNumbering = UWA.createElement('div', {
					'class': 'architectureNumberingDivScroll',
			});
			this.buildArchNumColabUnicitySection(this.collection._models[0]._attributes);
			Mask.unmask(this.contentDiv);
		},

		buildArchNumColabUnicitySection: function(collection){
			var that = this;
			localStorage.setItem('csList', JSON.stringify(collection.csList));
			var archNumCollabUnicityContainer = UWA.createElement('div', {'class': 'archNumCollabUnicityContainer'});
			var archNumCollabTableContainer = UWA.createElement('div', {'class': 'arhNumCollabTableMainContainer'}); //css: architectureNumberingContent
			var archNumCollabTableSubContainer = UWA.createElement('div', {'class': 'arhNumCollabTableSubContainer'}); //css: architectureNumbering
			var archNumCollabTable = CompanyIDViewUtilities.buildArchNumCollabUnicitySecTable();
			archNumCollabTable.inject(archNumCollabTableSubContainer);
			archNumCollabTableContainer.appendChild(archNumCollabTableSubContainer);

			var AddMappingButton = new Button({
				className: 'AddPartNumberFieldButton',
				icon: 'plus-circled',
				attributes: {
					disabled: false,
					'aria-hidden': 'true',
					title: FLWebNLS.label_CSgroupingButtonTooltip,
				},
				events: {
					onClick: function(e) {
						that.createCollabUnicitySecAddFieldModal(archNumCollabTable.getElement("#archNumCollabUnicityTableBody"));
					}
				}
			}).inject(archNumCollabTableContainer);

			archNumCollabTableContainer.inject(archNumCollabUnicityContainer);
			// var footer = ParametersLayoutViewUtilities.createApplyResetToolbar.call(this, archNumCollabUnicityContainer, true,
			// 		this.applyArchNumCollabUnicity.bind(this),
			// 		this.resetArchNumCollabUnicity.bind(this));
			//var collabArchNumUnicityCheckDiv = UWA.createElement('div', {'class': 'architectureNumberingContent'});
			// this.collabArchNumUnicityCheckAccrdn = ParametersLayoutViewUtilities.createFamilyUIKITAccordion(this.divPartNumbering);
			// this.collabArchNumUnicityCheckAccrdn.addItem({
			// 	title: FLWebNLS.label_CSgroupingAccrdTitle,
			// 	content: archNumCollabUnicityContainer,
			// 	selected: false,
			// 	name: 'Architecture_Number_Collabspace_Unicity'
			// });
			archNumCollabUnicityContainer.inject(this.divPartNumbering);
			ParametersLayoutViewUtilities.createApplyResetToolbar.call(this, this.divPartNumbering, true,
					this.applyArchNumCollabUnicity.bind(this),
					this.resetArchNumCollabUnicity.bind(this));
			this.divPartNumbering.inject(this.contentDiv)
			var groups = collection && collection.csGroups ? collection.csGroups : '';
			for (var groupName in groups) {
				var csListString = '';
				for(var i = 0; i < groups[groupName].length-1; i++){
					csListString += groups[groupName][i] + ',';
				}
				csListString += groups[groupName][i]
				//csListString = csListString.substring(0, csListString.length-2);
				var fieldInfo = CompanyIDViewUtilities.buildNewArchNumCollabField({Name:groupName, Value:csListString}, ParameterizationFLWebConstants.DEPOLOYED);
				//CompanyIDViewUtilities.buildJsonObjForPNField(ParameterizationFLWebConstants.ADD, field.Order, field.Type, field.Value),deployedStatus);
				fieldInfo.inject(archNumCollabTable.getElement("#archNumCollabUnicityTableBody"));
			}
			// this.paramScroller = new Scroller({
			//     element: archNumCollabTableSubContainer
			// }).inject(archNumCollabTableContainer);
		},


		resetParams: function(){
			var fieldsToBeRemoved = new Array();
			var rowsOfMappedFields = this.contentDiv.getElementsByClassName("partNumberFieldMapping");
			for (var i = 0; i < rowsOfMappedFields.length; i++) {
				if (rowsOfMappedFields[i].value == ParameterizationFLWebConstants.NEW_NOT_DEPLOYED) {
					fieldsToBeRemoved.push(CompanyIDViewUtilities.resetForFieldLineChanges(rowsOfMappedFields[i]));
				}
			}
			fieldsToBeRemoved.forEach(function(attrMapping) {
				if (attrMapping) {
					attrMapping.remove();
				}
			});
			CompanyIDViewUtilities.updateFormulaTextFields(ParameterizationFLWebConstants.MAX_ROWS + 1, null, null, ParameterizationFLWebConstants.DEPOLOYED);
		},

		resetArchNumCollabUnicity: function(){
			var fieldsToBeRemoved = new Array();
			var rowsOfMappedFields = this.contentDiv.querySelectorAll('#archNumCollabTableRow');
			for (var i = 0; i < rowsOfMappedFields.length; i++) {
				if (rowsOfMappedFields[i].value == ParameterizationFLWebConstants.NEW_NOT_DEPLOYED) {
					fieldsToBeRemoved.push(CompanyIDViewUtilities.resetForFieldLineChangesArchNumGrouping(rowsOfMappedFields[i]));
				}
			}
			fieldsToBeRemoved.forEach(function(attrMapping) {
				if (attrMapping) {
					attrMapping.remove();
				}
			});
		},

		applyParams: function() {
			var that = this;
			var rowsOfMappedFields = this.contentDiv.getElementsByClassName("partNumberFieldMapping");
			var payloadToSend = {};
			Mask.mask(this.contentDiv);
			payloadToSend.ParameterExpressionList = [];
			for (var i = 0; i < rowsOfMappedFields.length; i++) {
				//if (rowsOfMappedFields[i].value == ParameterizationFLWebConstants.NEW_NOT_DEPLOYED) {
				var value = CompanyIDViewUtilities.buildsFieldJsonObject(rowsOfMappedFields[i]);
				value.Label = value.Name;
				payloadToSend.ParameterExpressionList.push(value);
				//}
		}
			// payloadToSend['UnicityCheck'] = localStorage.getItem('arch_number_unicity');
			var url = URLHandler.getURL() + "/resources/v1/SystemsArchitectureDefinitionParam/setParamArchitectureNumberExpressions?tenant=" + URLHandler.getTenant(),payloadToSend;
			WAFData.authenticatedRequest(url, {
				timeout: 250000,
				method: 'POST',
				data: JSON.stringify(payloadToSend),
				type: 'json',
				headers: {
					'Content-Type': 'application/json',
					'Accept': 'application/json'
				},
				onFailure: function(json) {
					Mask.unmask(that.contentDiv);
					that.onApplyFailure(FLWebNLS.ApplyError);
				},
				onComplete: function(json) {
					if (json.ParameterExpressionList/*.length > 0*/) {
						that.onApplySuccess();
						Mask.unmask(that.contentDiv);
						that.getAlertMessage(FLWebNLS.ApplySuccess, 'success', that.contentDiv);

					} else {
						Mask.unmask(that.contentDiv);
						that.onApplyFailure(json.message);
					}
				}

			});
		},

		applyArchNumCollabUnicity: function() {
			var that = this;
			var rowsOfMappedFields = this.contentDiv.querySelectorAll('#archNumCollabTableRow');
			var payloadToSend = {};
			payloadToSend['CollaborativeSpacesGroupList'] = [];
			var tableFieldObj;
			Mask.mask(this.contentDiv);
			for (var i = 0; i < rowsOfMappedFields.length; i++) {
				if (rowsOfMappedFields[i].cells[this.cellsIndexForArchNumCollab.deployFlag].value != ParameterizationFLWebConstants.REMOVE){//ParameterizationFLWebConstants.NEW_NOT_DEPLOYED) {
  				tableFieldObj = CompanyIDViewUtilities.buildsFieldJsonObjectForArchNUmCollab(rowsOfMappedFields[i]);
  				payloadToSend.CollaborativeSpacesGroupList.push({
  					name: tableFieldObj.Name,
  					csList: tableFieldObj.Value.trim().split(',')
  				})
				}
			}

			var url = URLHandler.getURL() + "/resources/v1/SystemsArchitectureDefinitionParam/setCollaborativeSpaceGrouping?tenant=" + URLHandler.getTenant();
			WAFData.authenticatedRequest(url, {
				timeout: 250000,
				method: 'POST',
				data: JSON.stringify(payloadToSend),
				type: 'json',

				headers: {
					'Content-Type': 'application/json',
					'Accept': 'application/json'
				},

				onFailure: function(json) {
					Mask.unmask(that.contentDiv);
					that.onApplyFailure(FLWebNLS.ApplyError);
				},

				onComplete: function(json) {
					//  if (json.ParameterExpressionList/*.length > 0*/) {
					that.archNumCollabGroupingApplySuccess();
					Mask.unmask(that.contentDiv);
					that.getAlertMessage(FLWebNLS.msg_CSgroupingFieldsUpdated, 'success', that.contentDiv);

					//  }
					// else {
					//     Mask.unmask(that.contentDiv);
					//     that.onApplyFailure(json.message);
					// }
				}

			});
		},

		onApplyFailure: function(message) {
			this.getAlertMessage(message, 'error', this.contentDiv);
		},

		onApplySuccess: function() {
			var fieldsToBeRemoved = new Array();
			var rowsOfMappedFields = this.contentDiv.getElementsByClassName("partNumberFieldMapping");
			for (var i = 0; i < rowsOfMappedFields.length; i++) {
				if (rowsOfMappedFields[i].value == ParameterizationFLWebConstants.NEW_NOT_DEPLOYED) {
					var statusCell = rowsOfMappedFields[i].cells[5];
					if (statusCell.value == ParameterizationFLWebConstants.ADD || statusCell.value == ParameterizationFLWebConstants.MODIFY) {
						rowsOfMappedFields[i].cells[5].empty();
						rowsOfMappedFields[i].value = ParameterizationFLWebConstants.DEPOLOYED;
						var imgSpan = CompanyIDViewUtilities.buildImgSpan('check', '1.5', 'green', FLWebNLS.Deployed);
						imgSpan.inject(rowsOfMappedFields[i].cells[5]);
					}
					if (rowsOfMappedFields[i].cells[5].value == ParameterizationFLWebConstants.REMOVE) {
						fieldsToBeRemoved.push(rowsOfMappedFields[i]);
					}
				}
			}
			fieldsToBeRemoved.forEach(function(attrMapping) {
				attrMapping.remove();
			});
			var formulaField = document.querySelector(".partNumberFormulaMapping");
			formulaField.cells[3].empty();
			var imgSpan = ParametersLayoutViewUtilities.buildImgSpan('check', '1.5', 'green', FLWebNLS.Deployed);
			imgSpan.inject(formulaField.cells[3]);
		},

		archNumCollabGroupingApplySuccess: function() {
			//CompanyIDViewUtilities.updateStrategy(strategyValue, ParameterizationFLWebConstants.DEPOLOYED);
			var fieldsToBeRemoved = new Array();
			var rowsOfMappedFields = this.contentDiv.querySelectorAll('#archNumCollabTableRow')
			for (var i = 0; i < rowsOfMappedFields.length; i++) {
				if (rowsOfMappedFields[i].value == ParameterizationFLWebConstants.NEW_NOT_DEPLOYED) {
					var statusCell = rowsOfMappedFields[i].cells[3];
					if (statusCell.value == ParameterizationFLWebConstants.ADD || statusCell.value == ParameterizationFLWebConstants.MODIFY) {
						rowsOfMappedFields[i].cells[3].empty();
						rowsOfMappedFields[i].value = ParameterizationFLWebConstants.DEPOLOYED;
						var imgSpan = CompanyIDViewUtilities.buildImgSpan('check', '1.5', 'green', FLWebNLS.Deployed);
						imgSpan.inject(rowsOfMappedFields[i].cells[3]);
					}
					if (rowsOfMappedFields[i].cells[3].value == ParameterizationFLWebConstants.REMOVE) {
						fieldsToBeRemoved.push(rowsOfMappedFields[i]);
					}
				}
			}
			fieldsToBeRemoved.forEach(function(attrMapping) {
				attrMapping.remove();
			});
		},

		ShowAddNewFieldPanel: function(attrtbody) {
			this.createPartNumberingDialogBox(attrtbody);
			var isDeployed = ParameterizationFLWebConstants.NEW_NOT_DEPLOYED;
		},

		createPartNumberingDialogBox: function(attrtbody) {
			var that = this;
			var attributes = (this.collection._models[0]._attributes && this.collection._models[0]._attributes.PhysicalProductAttributes);
			var options = {
					className: "part-number-modal",
					title: "Add Field"
			}
			this.modal = new FLWebModal(options);
			this.modal.getAttributes(attributes);
			if (this.modal.getTotalFormatRows() == ParameterizationFLWebConstants.MAX_ROWS) {
				var alert = that.modal.displayAlertMessage(FLWebNLS.maxLimitOfRows, document.querySelector('#typeMainDiv').getChildren()[0]);
			} else {
				function _getFooter() {
					return "<button type='button'  name='addButton' id='add-button' class='btn btn-primary'>" + FLWebNLS.add + "</button> " + "</button>" + "<button type='button' name='cancelButton' id='cancel-button' class='btn btn-default'>" + FLWebNLS.cancel + "</button>"
				}
				this.modal.modal.setFooter(_getFooter());
				this.modal.getModalBody();
				this.modal._bindFooterEvent();
				this.modal.getContent().getElements('.btn').forEach(function(element) {
					if (that.modal.isCounterExists(ParameterizationFLWebConstants.TYPE)) {
						that.modal.partNumberTypeCombobox.disable(ParameterizationFLWebConstants.FORMAT_COUNTER);
					}

					if (element.name === 'cancelButton') {
						element.addEvent('click', function() {
							that.modal.destroy();

						});
					} else if (element.name === 'addButton') {

						element.addEvent('click', function() {

							var toDisplayOver = that.modal.getContent().getElement('.enox-arch-number-content');

							if (that.modal.validateEnteredNameValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.nameNullMessage, toDisplayOver);
							} else if (that.modal.validateEnteredOrderValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.orderNullMessage, toDisplayOver);
							} else if (that.modal.validatSelectedTypeFieldValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.selectTypeMessage, toDisplayOver);
							} else if (that.modal.validateSelectedAttributeFieldValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.selectAttributeMessage, toDisplayOver);
							}else if (that.modal.validateEnteredCounterFieldValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.counterIsEmptyMessage, toDisplayOver);
							}else if (that.modal.validateEnteredValueFieldValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.valueEmptyMessage, toDisplayOver);
							} else {
								if (!that.modal.validateEnteredNameValue().isValid) {
									that.modal.displayAlertMessage(FLWebNLS.nameMessage +  ' ' + FLWebNLS.alreadyExists, toDisplayOver);
								} else if (!that.modal.validateEnteredOrderValue().isValid) {
									that.modal.displayAlertMessage(FLWebNLS.orderMessage +  ' ' + FLWebNLS.alreadyExists, toDisplayOver);
								} else {
									var userSelectedFormat = that.modal.getUserEnteredValues();

									userSelectedFormat[ParameterizationFLWebConstants.OPERATION] = ParameterizationFLWebConstants.ADD;
									var fieldInfo = CompanyIDViewUtilities.buildNewPartNumberField(userSelectedFormat, ParameterizationFLWebConstants.NEW_NOT_DEPLOYED);
									fieldInfo.inject(attrtbody.getElement(".partNumberFieldbody"));
									that.modal.destroy();
								}
							}
						});
					};
				});

				that.modal.show();
			}
		},

		createCollabUnicitySecAddFieldModal: function(tableBody) {
			var that = this;
			var options = {
					className: "part-number-modal",
					title: FLWebNLS.label_CSgroupingModalTitle
			}
			this.modal = new FLWebModal(options);
			if (this.modal.getTotalFormatRows() == ParameterizationFLWebConstants.MAX_ROWS) {
				var alert = that.modal.displayAlertMessage(FLWebNLS.maxLimitOfRows, document.querySelector('#typeMainDiv').getChildren()[0]);
			} else {
				function _getFooter() {
					return "<button type='button'  name='addButton' id='add-button' class='btn btn-primary'>" + FLWebNLS.add + "</button> " + "</button>" + "<button type='button' name='cancelButton' id='cancel-button' class='btn btn-default'>" + FLWebNLS.cancel + "</button>"
				}
				this.modal.modal.setFooter(_getFooter());
				this.modal.createCollabUnicitySecAddFieldModalBody();
				this.modal._bindFooterEvent();
				this.modal.getContent().getElements('.btn').forEach(function(element) {
					if (element.name === 'cancelButton') {
						element.addEvent('click', function() {
							that.modal.destroy();
						});
					} else if (element.name === 'addButton') {
						element.addEvent('click', function() {
							var toDisplayOver = that.modal.getContent().getElement('.enox-arch-number-content');
							if (that.modal.validateEnteredGroupNameValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.nameNullMessage, toDisplayOver);
							} else if (that.modal.validateEnteredCollabListValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.msg_CSFieldBlankAlert, toDisplayOver);
							}
							else {
								if (!that.modal.validateEnteredGroupNameValue().isValid) {
									that.modal.displayAlertMessage(FLWebNLS.nameMessage +  ' ' + FLWebNLS.alreadyExists, toDisplayOver);
								} else {
									var userSelectedFormat = that.modal.getUserEnteredValuesForArchNumCollabUnicity();
									userSelectedFormat[ParameterizationFLWebConstants.OPERATION] = ParameterizationFLWebConstants.ADD;
									var fieldInfo = CompanyIDViewUtilities.buildNewArchNumCollabField(userSelectedFormat, ParameterizationFLWebConstants.NEW_NOT_DEPLOYED);
									fieldInfo.inject(tableBody);
									that.modal.destroy();
								}
							}
						});
					};
				});

				that.modal.show();
			}
		},

		getAlertMessage: function (message, className, toDisplayOn) {

			this.alertOptions = {
					visible: true,
					className: 'param-alert',
					messageClassName: className,
					closable: true,
					renderTo: toDisplayOn,
					autoHide: true,
					hideDelay: 2000
			};

			var alert = new Alert(this.alertOptions);
			alert.add({
				message: message,
			});

		},

		destroy: function() {
			this.stopListening();
			this._parent.apply(this, arguments);
		},
		_updateParentViewWithNewDomain : function(view, domainId){
			view.options.domainid = domainId;
			view.model.id = domainId;
			view.model._attributes.domainid = domainId;
			view.model._attributes.id = domainId;
			return view;
		},
	});

	return extendedView;
});

define('DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/ParamSAXOtbView', [
	'UWA/Core',
	'UWA/Class/View',
	'DS/UIKIT/Mask',
	'DS/UIKIT/Scroller',
	'DS/WAFData/WAFData',
	'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
	'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
	'DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/CompanyIDViewUtilities',
	'DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/ParameterizationFLWebConstants',
	'DS/UIKIT/Input/Button',
	'DS/UIKIT/Alert',
	'DS/ParameterizationSkeleton/Views/ParametersLayoutView',
	'i18n!DS/ParameterizationSkeleton/assets/nls/FLWebNLS',
	],
	function(UWA,
			View,
			Mask,
			Scroller,
			WAFData,
			ParametersLayoutViewUtilities,
			URLHandler,
			CompanyIDViewUtilities,
			ParameterizationFLWebConstants,
			Button,
			Alert,
			ParametersLayoutView,
			FLWebNLS) {

	'use strict';

	var extendedView;

	extendedView = View.extend({
		tagName: 'div',
		className: 'generic-detail scroller-content',

		init: function(options) {
			var initDate = new Date();
			options = UWA.clone(options || {}, false);
			this._parent(options);
			this.options = options;
			this.contentDiv = null;
			this.lastAlertDate = initDate.getTime();
		},

		setup: function(options) {
			UWA.log('Architect Layout::setup!');
			UWA.log(options);
		},

		render: function() {
			UWA.log("Architect LayoutView::render");
			var introDiv,
			mappingDiv,
			that = this;

			this.contentDiv = UWA.createElement('div', {
				'id': 'typeMainDiv'
			});
			Mask.mask(this.contentDiv);
			this.parentView = new ParametersLayoutView(this.options);
			this.container.setContent(this.contentDiv);
			this.listenTo(this.collection, {
				onSync: that.onCompleteRequestMapping
			});
			return this;
		},

		onCompleteRequestMapping: function() {
      const otbView = this.parentView.buildFamilyItemContent(this.collection._models[0]._attributes.family[0], null);
      this.contentDiv.appendChild(otbView);
      Mask.unmask(this.contentDiv);
    //  this.parentView = this._updateParentViewWithNewDomain(this.parentView,"SystemsArchitectureDefinitionOtbParameter");
      this.parentView.render();
		}
	});

	return extendedView;
});

/*@fullReview  ZUR 15/11/23 2017x Param Skeleton*/
/*global define, widget*/
define('DS/ParameterizationSkeleton/Views/ParametersParentView',
    [
        'UWA/Core',
        'UWA/Class/View',
        'DS/ParameterizationSkeleton/Views/ParametersLayoutView',
        'DS/W3DXComponents/Views/Layout/ListView',
        'DS/ParameterizationSkeleton/Views/ParamItemsListView'
    ], function (UWA, View, ParametersLayoutView, ListView, ParamItemsListView) {

        'use strict';

        return View.extend({

            defaultOptions: {
                type: 'default'
            },

            /* setup : function () {
            //muter via un extend ?
            //appeler le setup  / options / propertymodel
            //tester le type d'instance de ce model with instanceof
            },*/

            init : function (options) {
                UWA.log("ParametersParentView::init");
                UWA.log(options);
                this.options = options;
                this.childView = null;
            },

        // The ‘options’ object is passed via the ‘viewOptions’ specified in the Renderer at the Skeleton instantiation
            render: function () {
                //options = options || {options = {}};
                //options = UWA.clone(options || {}, false);
                var options = this.options,
                    myView = this.getViewFromDomainID(options);

                if (myView !== null) {
                     //myView.init();
                    this.childView = myView;
                    return myView.render();
                }

                return null;//defaultView.render();

            },

            getViewFromDomainID : function (options) {
                var i,
                    AppIntItemsDomainViewList = ["AttributeDef", "LifecycleTopology", "XCADParameterization"];

                for (i = 0; i < AppIntItemsDomainViewList.length; i++) {
                    if (options.domainid === AppIntItemsDomainViewList[i]) {
                        return new ParamItemsListView(options);
                    }
                }
                return new ParametersLayoutView(options);
            },

            /*getViewFromDomainID : function (options) {
                var i,
                    AppIntExchangeDomainList = ["Iteration", "DataAccessRight", "ObjectIdentification", "EngineeringCentral", "Deployment", "ParamDev", "EngineeringWorkspace"];

                for (i = 0; i < AppIntExchangeDomainList.length; i++) {
                    if (options.domainid === AppIntExchangeDomainList[i]) {
                        return new ParametersLayoutView(options);
                    }
                }
                return new ParamItemsListView(options);
            },*/

            destroy : function() {
                this.childView.destroy();
                this.stopListening();
                this._parent.apply(this, arguments);
            }

        });
    });

define('DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/ParamSAXFormulaTable', [
	'UWA/Core',
	'UWA/Class/View',
	'DS/UIKIT/Mask',
	'DS/UIKIT/Scroller',
	'DS/WAFData/WAFData',
	'DS/WebappsUtils/WebappsUtils',
	'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
	'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
	'DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/CompanyIDViewUtilities',
	'DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/ParameterizationFLWebConstants',
	'DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/FLWebModalSlideIn',
	'DS/UIKIT/Input/Button',
	'DS/UIKIT/Alert',
	'DS/ParameterizationSkeleton/Views/ParametersLayoutView',
	"DS/Skeleton/SkeletonLayout",
	'DS/CoreEvents/ModelEvents',
	'i18n!DS/ParameterizationSkeleton/assets/nls/FLWebNLS',
	],
	function(UWA,
			View,
			Mask,
			Scroller,
			WAFData,
			WebappsUtils,
			ParametersLayoutViewUtilities,
			URLHandler,
			CompanyIDViewUtilities,
			ParameterizationFLWebConstants,
			FLWebModal,
			Button,
			Alert,
			ParametersLayoutView,
			SkeletonLayout,
			ModelEvents,
			FLWebNLS) {

	'use strict';

	var saxFormulaTableView;

	saxFormulaTableView = {
		setANFormulaView: function(collection, contentDiv, modelEvent, createNewModelObj){
			this.collection = collection;
			const that = this, collectionCurate = this.collection._models[0]._attributes;;
			this.contentDiv = contentDiv;
			CompanyIDViewUtilities.physicalProductAttributes(collectionCurate.PhysicalProductAttributes);
			var fields = collectionCurate.ExpressionList;
			// this.divPartNumbering = UWA.createElement('div', {
			// 	'class': 'architectureNumberingDivScroll',
			// });

			var nosOfFields = (fields) ? fields.length : 0;
		//	this.baseAccordion = ParametersLayoutViewUtilities.createFamilyUIKITAccordion(this.divPartNumbering);
			var partNumberingParentDiv = UWA.createElement('div', {'class': 'architectureNumberingContent'});
			var partNumberingDiv = UWA.createElement('div', {'class': 'architectureNumbering'});
			const rightSidePanel = UWA.createElement('div', {'class': 'side-panel-editANField'});
			var partNumberTable = CompanyIDViewUtilities.buildAttributeTable(collectionCurate);
			partNumberTable.inject(partNumberingDiv);
			var AddMappingButton = new Button({
				className: 'AddPartNumberFieldButton',
				icon: 'plus-circled',
				attributes: {
					disabled: false,
					'aria-hidden': 'true',
					title: FLWebNLS.AddFieldMappingTooltip,
				},
				events: {
					onClick: function(e) {
						that.ShowAddNewFieldPanel(partNumberTable.getElement(".partNumberFieldbody"));
						//that.mySkeletonlayout.setCollapseFlagFromUIInteraction("right", !that.mySkeletonlayout.rightContainerCollapsedFlag);
					}
				}
			}).inject(partNumberingDiv);

		partNumberingParentDiv.appendChild(partNumberingDiv);
		ParametersLayoutViewUtilities.createApplyResetToolbar.call(this, partNumberingParentDiv, true, this.applyParams.bind(this,modelEvent, createNewModelObj), this.resetParams.bind(this));
		this.mySkeletonlayout = new SkeletonLayout(
			{
				centerContainerContent: partNumberingParentDiv,
				rightContainerContent: rightSidePanel,
				navigationContainerHeight: 0,
				statusContainerHeight: 0,
				idCardContainerHeight: 0,
			}
		);
		this.mySkeletonlayout.inject(this.contentDiv);

			for (var i = 0; i < nosOfFields; i++) {
				var field = fields[i];
				var deployedStatus = (field.Deployed && field.Deployed=="True")? ParameterizationFLWebConstants.DEPOLOYED : ParameterizationFLWebConstants.NEW_NOT_DEPLOYED;
				var fieldInfo = CompanyIDViewUtilities.buildNewPartNumberField(
						CompanyIDViewUtilities.buildJsonObjForPNField(ParameterizationFLWebConstants.ADD, field.Name, field.Order, field.Type, field.Value, field[ParameterizationFLWebConstants.ATTRIBUTE]?field[ParameterizationFLWebConstants.ATTRIBUTE]:'', field[ParameterizationFLWebConstants.COUNTER]?field[ParameterizationFLWebConstants.COUNTER]:'', field.Label, field.Default),
						deployedStatus, this.mySkeletonlayout);
				fieldInfo.inject(partNumberTable.getElement(".partNumberFieldbody"));
			}
			Mask.unmask(this.contentDiv);
		},

		resetParams: function(){
			var fieldsToBeRemoved = new Array();
			var rowsOfMappedFields = this.contentDiv.getElementsByClassName("partNumberFieldMapping");
			for (var i = 0; i < rowsOfMappedFields.length; i++) {
				if (rowsOfMappedFields[i].value == ParameterizationFLWebConstants.NEW_NOT_DEPLOYED) {
					fieldsToBeRemoved.push(CompanyIDViewUtilities.resetForFieldLineChanges(rowsOfMappedFields[i]));
				}
			}
			fieldsToBeRemoved.forEach(function(attrMapping) {
				if (attrMapping) {
					attrMapping.remove();
				}
			});
			CompanyIDViewUtilities.updateFormulaTextFields(ParameterizationFLWebConstants.MAX_ROWS + 1, null, null, ParameterizationFLWebConstants.DEPOLOYED);
		},

		applyParams: function(modelEvent, createNewModelObj) {
			var that = this;
			var rowsOfMappedFields = this.contentDiv.getElementsByClassName("partNumberFieldMapping");
			var payloadToSend = {};
			Mask.mask(this.contentDiv);
			payloadToSend.ParameterExpressionList = [];
			for (var i = 0; i < rowsOfMappedFields.length; i++) {
				//if (rowsOfMappedFields[i].value == ParameterizationFLWebConstants.NEW_NOT_DEPLOYED) {
				var value = CompanyIDViewUtilities.buildsFieldJsonObject(rowsOfMappedFields[i]);
				value.Label = value.Name;
				payloadToSend.ParameterExpressionList.push(value);
				//}
			}
			// payloadToSend['UnicityCheck'] = localStorage.getItem('arch_number_unicity');
			let url = URLHandler.getURL() + "/resources/v1/SystemsArchitectureDefinitionParam/setParamArchitectureNumberExpressions?tenant=" + URLHandler.getTenant();
			if(modelEvent &&
				(modelEvent.name == 'Edit_ExistingSubType_Formula' /*|| modelEvent.name == 'New_SubType_Formula'*/)){
				payloadToSend.flpType= modelEvent.data.typeName;
			}
			WAFData.authenticatedRequest(url, {
				timeout: 250000,
				method: 'POST',
				data: JSON.stringify(payloadToSend),
				type: 'json',
				headers: {
					'Content-Type': 'application/json',
					'Accept': 'application/json'
				},
				onFailure: function(json) {
					Mask.unmask(that.contentDiv);
					that.onApplyFailure(FLWebNLS.ApplyError);
				},
				onComplete: function(json) {
					if (json.ParameterExpressionList/*.length > 0*/) {
						that.onApplySuccess();
						Mask.unmask(that.contentDiv);
						that.getAlertMessage(FLWebNLS.ApplySuccess, 'success', widget.body/*that.contentDiv*/);
						if(createNewModelObj){
							modelEvent.eventObj.publish(createNewModelObj)
						}
						if(modelEvent){
							modelEvent.data.formulaValue = json.anFormat;
							modelEvent.eventObj.publish({event:modelEvent.name, data:modelEvent.data})
						}
					} else {
						Mask.unmask(that.contentDiv);
						that.onApplyFailure(json.message);
					}
					if(document.getElementById('sax-formula-modal-immersiveFrame'))
						document.getElementById('sax-formula-modal-immersiveFrame').destroy();
				}

			});
		},

		onApplyFailure: function(message) {
			this.getAlertMessage(message, 'error', this.contentDiv);
		},

		onApplySuccess: function() {
			var fieldsToBeRemoved = new Array();
			var rowsOfMappedFields = this.contentDiv.getElementsByClassName("partNumberFieldMapping");
			for (var i = 0; i < rowsOfMappedFields.length; i++) {
				if (rowsOfMappedFields[i].value == ParameterizationFLWebConstants.NEW_NOT_DEPLOYED) {
					var statusCell = rowsOfMappedFields[i].cells[5];
					if (statusCell.value == ParameterizationFLWebConstants.ADD || statusCell.value == ParameterizationFLWebConstants.MODIFY) {
						rowsOfMappedFields[i].cells[5].empty();
						rowsOfMappedFields[i].value = ParameterizationFLWebConstants.DEPOLOYED;
						var imgSpan = CompanyIDViewUtilities.buildImgSpan('check', '1.5', 'green', FLWebNLS.Deployed);
						imgSpan.inject(rowsOfMappedFields[i].cells[5]);
					}
					if (rowsOfMappedFields[i].cells[5].value == ParameterizationFLWebConstants.REMOVE) {
						fieldsToBeRemoved.push(rowsOfMappedFields[i]);
					}
				}
			}
			fieldsToBeRemoved.forEach(function(attrMapping) {
				attrMapping.remove();
			});
			var formulaField = document.querySelector(".partNumberFormulaMapping");
			formulaField.cells[3].empty();
			var imgSpan = ParametersLayoutViewUtilities.buildImgSpan('check', '1.5', 'green', FLWebNLS.Deployed);
			imgSpan.inject(formulaField.cells[3]);
		},

		ShowAddNewFieldPanel: function(attrtbody) {
			this.createPartNumberingDialogBox(attrtbody);
			var isDeployed = ParameterizationFLWebConstants.NEW_NOT_DEPLOYED;
		},

		createPartNumberingDialogBox: function(attrtbody) {
			var that = this;
			var attributes = (this.collection._models[0]._attributes && this.collection._models[0]._attributes.PhysicalProductAttributes);
			var options = {
					className: "part-number-modal",
					title: "Add Field",
					skeletonView: this.mySkeletonlayout,
					isadd: true
			}
			this.modal = new FLWebModal(options);
			this.modal.getAttributes(attributes);
			if (this.modal.getTotalFormatRows() == ParameterizationFLWebConstants.MAX_ROWS) {
				var alert = that.modal.displayAlertMessage(FLWebNLS.maxLimitOfRows, document.querySelector('#typeMainDiv').getChildren()[0]);
			} else {
				function _getFooter() {
					return "<button type='button'  name='addButton' id='add-button' class='btn btn-primary'>" + FLWebNLS.add + "</button> " + "</button>" + "<button type='button' name='cancelButton' id='cancel-button' class='btn btn-default'>" + FLWebNLS.cancel + "</button>"
				}
				this.modal.setFooter(_getFooter());
				this.modal.getModalBody();
				this.modal._bindFooterEvent();
				if(this.mySkeletonlayout.rightContainerCollapsedFlag)
					this.mySkeletonlayout.setCollapseFlagFromUIInteraction("right", !this.mySkeletonlayout.rightContainerCollapsedFlag);
				this.modal.getContent().getElements('.btn').forEach(function(element) {
					if (that.modal.isCounterExists(ParameterizationFLWebConstants.TYPE)) {
						that.modal.partNumberTypeCombobox.disable(ParameterizationFLWebConstants.FORMAT_COUNTER);
					}

					// if (element.name === 'cancelButton') {
					// 	element.addEvent('click', function() {
					// 		that.skeletonView.setCollapseFlagFromUIInteraction("right", !that.skeletonView.rightContainerCollapsedFlag);
					// 		that.modal.destroy();
					// 	});
					// } else
					if (element.name === 'addButton') {

						element.addEvent('click', function() {

							var toDisplayOver = that.modal.getContent().getElement('.enox-arch-number-content');

							if (that.modal.validateEnteredNameValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.nameNullMessage, toDisplayOver);
							} else if (that.modal.validateEnteredNameValueAllowed()) {
								that.modal.displayAlertMessage(FLWebNLS.replace(FLWebNLS.nameInvalid, {key1: 'title', key2: 'revision', key3: 'existing'}), toDisplayOver);
							} else if (that.modal.validateEnteredOrderValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.orderNullMessage, toDisplayOver);
							} else if (that.modal.validatSelectedTypeFieldValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.selectTypeMessage, toDisplayOver);
							} else if (that.modal.validateSelectedAttributeFieldValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.selectAttributeMessage, toDisplayOver);
							} else if (that.modal.validateEnteredCounterFieldValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.counterIsEmptyMessage, toDisplayOver);
							} else if (that.modal.validateEnteredValueFieldValueNotNull()) {
								that.modal.displayAlertMessage(FLWebNLS.valueEmptyMessage, toDisplayOver);
							} else if (that.modal.validateEnteredValueFieldValueContainsSpecialChar()) {
								that.modal.displayAlertMessage(FLWebNLS.valueContainsSpecialCharMessage, toDisplayOver);
							} else if (that.modal.validateEnteredDefaultValueFieldValueContainsSpecialChar()) {
								that.modal.displayAlertMessage(FLWebNLS.valueContainsSpecialCharMessage, toDisplayOver);
							} else {
								if (!that.modal.validateEnteredNameValue().isValid) {
									that.modal.displayAlertMessage(FLWebNLS.nameMessage +  ' ' + FLWebNLS.alreadyExists, toDisplayOver);
								} else if (!that.modal.validateEnteredOrderValue().isValid) {
									that.modal.displayAlertMessage(FLWebNLS.orderMessage +  ' ' + FLWebNLS.alreadyExists, toDisplayOver);
								} else {
									var userSelectedFormat = that.modal.getUserEnteredValues();

									userSelectedFormat[ParameterizationFLWebConstants.OPERATION] = ParameterizationFLWebConstants.ADD;
									var fieldInfo = CompanyIDViewUtilities.buildNewPartNumberField(userSelectedFormat, ParameterizationFLWebConstants.NEW_NOT_DEPLOYED, that.mySkeletonlayout);
									fieldInfo.inject(attrtbody);
									that.modal.destroy();
									that.mySkeletonlayout.setCollapseFlagFromUIInteraction("right", !that.mySkeletonlayout.rightContainerCollapsedFlag);
								}
							}
						});
					};
				});

				//that.modal.show();
			}
		},

		getAlertMessage: function (message, className, toDisplayOn) {

			this.alertOptions = {
					visible: true,
					className: 'param-alert',
					messageClassName: className,
					closable: true,
					renderTo: toDisplayOn,
					autoHide: true,
					hideDelay: 2000
			};

			var alert = new Alert(this.alertOptions);
			alert.add({
				message: message,
			});

		},

		destroy: function() {
			this.stopListening();
			this._parent.apply(this, arguments);
		},

		//Saving code back up in case of any potential issues
		// _updateParentViewWithNewDomain : function(view, domainId){
		// 	view.options.domainid = domainId;
		// 	view.model.id = domainId;
		// 	view.model._attributes.domainid = domainId;
		// 	view.model._attributes.id = domainId;
		// 	return view;
		// },
	}

	return saxFormulaTableView;
});

define('DS/ParameterizationSkeleton/Views/ParamConfigurationManagement/CfgParamCustomizationUtility', [
	'UWA/Core',
	'DS/WAFData/WAFData',
	'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
],
	function (UWA, WAFData, URLHandler) {

		/**
		 * @description Helper to call a web service.
		 * This helper is adding security context first and if it success it calls the api.
		 * @param {String} url The web service route
		 * @param {String} methodType HTTP Protocole : GET / POST / PUT ...
		 * @param {String} data the data to send to the web service
		 * @param {Function} onSuccess onSuccess callback function
		 * @param {Function} onFailure onFailure callback function
		 */
		const requestHelper = function (url, methodType, data, onSuccess, onFailure) {
			//IR-953493 Adding tenant in security context
			const urlSecurityContext = URLHandler.getURL() + "/resources/pno/person/getsecuritycontext?tenant=" + URLHandler.getTenant();
			console.log("Get security context:");
			WAFData.authenticatedRequest(urlSecurityContext, {
				timeout: 250000,
				method: 'GET',
				data: "",
				type: 'json',
				headers: {
					'Content-Type': 'application/json',
					'Accept': 'application/json'
				},
				onFailure: function (json) {
					UWA.log('CfgParamCustomizationUtility::requestHelper - Failure');
					UWA.log(json);
					console.log(json);
				},
				onComplete: function (securityContext) {
					const urlFinal = URLHandler.getURL() + url + "?tenant=" + URLHandler.getTenant();
					WAFData.authenticatedRequest(urlFinal, {
						timeout: 250000,
						method: methodType,
						data: data,
						type: 'json',
						headers: {
							'Content-Type': 'application/json',
							'Accept': 'application/json',
							'SecurityContext': securityContext.SecurityContext,
						},
						onFailure: function (result) {
							UWA.log('CfgParamCustomizationUtility::requestHelper - Failure');
							UWA.log(result);
							onFailure(result);
						},
						onComplete: function (result) {
							UWA.log('CfgParamCustomizationUtility::requestHelper - Success');
							UWA.log(result);
							onSuccess(result);
						}
					});
				}
			});
		}
		/**
		 * Permits to push date or unit value easily
		 * @param {Boolean} setValue 
		 * @param {String} type Must be date or Unit
		 * @param {*} onSuccessCallback 
		 * @param {*} onFailureCallback 
		 */
		const postParamsArrOnServer = function (setValue, type, onSuccessCallback, onFailureCallback) {

			var data = [JSON.parse("{\"domain\":\"ConfigurationUXParameterization\",\"id\":\"" + type + "\",\"argument\":[{\"id\":\"Argument\",\"value\":\"" + setValue + "\"}]}")];

			var url = URLHandler.getURL() + "/resources/ParamWS/access/postparams?tenant=" + URLHandler.getTenant(),
				datatoSend = {
					domain: "ConfigurationUXParameterization",
					parameter: data
				};

			WAFData.authenticatedRequest(url, {
				timeout: 100000,
				method: 'POST',
				data: JSON.stringify(datatoSend),
				type: 'json',
				//proxy: 'passport',

				headers: {
					'Content-Type': 'application/json',
					'Accept': 'application/json'
				},

				onFailure: function (json) {
					onFailureCallback(json);
				},

				onComplete: function (json) {
					if (!(json.deployStatus === "S_OK")) {
						onFailureCallback(json);
						return;
					}
					onSuccessCallback(json);
				}
			});
		}


		return {
			/*setFilteringInformation: function (filteringType, value, onSuccessCallback, onFailureCallback) {
				const url = "/resources/modeler/configuration/settingsServices/setConfigurationSettings";
	
				const data = {
					"version": "1.0",
					"settings": [
						{
							"settingName": filteringType,
							"settingValue" : value
						}
					]
				};
				requestHelper(url, "POST", JSON.stringify(data), onSuccessCallback, onFailureCallback);
			},*/
			/*getParametrizationInformation: function (type, onSuccesCallback, onFailureCallback) {
				var url =  "/resources/modeler/configuration/settingsServices/getConfigurationSettings";
				var jsonData = {
					"version": "1.0",
					"settings": [type]
				};
				requestHelper(url, "POST",JSON.stringify(jsonData), onSuccesCallback, onFailureCallback);
			},*/
			/**
			 * Get actual date and unit value from server
			 * @param {String} type date or unit 
			 * @param {*} onSuccessCallback 
			 * @param {*} onFailureCallback 
			 */
			getParamsFromServer: function (type, onSuccessCallback, onFailureCallback) {

				var url = URLHandler.getURL() + "/resources/ParamWS/access/DomainElements?tenant=" + URLHandler.getTenant() + "&domainid=ConfigurationUXParameterization",
					datatoSend = "";

				WAFData.authenticatedRequest(url, {
					timeout: 100000,
					method: 'GET',
					data: JSON.stringify(datatoSend),
					type: 'json',
					//proxy: 'passport',

					headers: {
						'Content-Type': 'application/json',
						'Accept': 'application/json'
					},

					onFailure: function (json) {
						onFailureCallback(json);
					},

					onComplete: function (json) {
						if (type === "date")
							onSuccessCallback(json.family[0].parameter[0].argument[0].argValue);
						else if (type === "unit")
							onSuccessCallback(json.family[0].parameter[1].argument[0].argValue);
						else if (type === 'StaticMappingActivation') onSuccessCallback(json.family[0].parameter[2].argument[0].argValue);
						else if (type === 'CompositionMatrixActivation') onSuccessCallback(json.family[0].parameter[3].argument[0].argValue);
						else if (type === 'disabledEditVariant') onSuccessCallback(json.family[0].parameter[4].argument[0].argValue);
						else if (type === 'xRevision' && json.family[0].parameter[5] && json.family[0].parameter[5].argument) onSuccessCallback(json.family[0].parameter[5].argument[0].argValue);
						else if (type === 'contextualvariant' && json.family[0].parameter[6] && json.family[0].parameter[6].argument) onSuccessCallback(json.family[0].parameter[6].argument[0].argValue); //FUN148752

					}
				});
			},

			/**
			 * Call postparams webService to set UnitParam
			 * @param {Boolean} status 
			 */
			setUnitParam: function (status, onSuccessCallback, onFailureCallback) {
				postParamsArrOnServer(status, "CFGParameterUnit", onSuccessCallback, onFailureCallback);
			},
			/**
			 * Call postparams webService to set DateParam
			 * @param {Boolean} status 
			 */
			setDateParam: function (status, onSuccessCallback, onFailureCallback) {
				postParamsArrOnServer(status, "CFGParameterCtxtDate", onSuccessCallback, onFailureCallback);
			},

			setStaticMappingParam: function (status, onSuccessCallback, onFailureCallback) {
				postParamsArrOnServer(status, 'CFGParameterStaticMapping', onSuccessCallback, onFailureCallback);
			},
			setCompositionMatrixParam: function (status, onSuccessCallback, onFailureCallback) {
				postParamsArrOnServer(status, 'CFGParameterCompositionMatrix', onSuccessCallback, onFailureCallback);
			},

			//set expression for disabled edit variant
			setDisabledEditVariantParam: function (status, onSuccessCallback, onFailureCallback) {
				postParamsArrOnServer(status, "CFGParameterDisableEditVariant", onSuccessCallback, onFailureCallback);
			},
			
			//set expression for xRevision
			setxRevisionParam: function (status, onSuccessCallback, onFailureCallback) {
				postParamsArrOnServer(status, 'CFGParameterxRevision', onSuccessCallback, onFailureCallback);
			},

			//set expression to enable contextual variant filtering
			setContextualVariantParam: function (status, onSuccessCallback, onFailureCallback) {
            //FUN148752
            postParamsArrOnServer(status, 'CFGParameterContextualVariant', onSuccessCallback, onFailureCallback);
        },

			/**
			 * Call setConfiguredExpressionXSLT API
			 * @param {String} XSLContent:XSL content as text
			 * @param {Function} onSuccessCallback
			 * @param {Function} onFailureCallback 
			 */
			uploadXSLCusto: function (XSLContent, onSuccessCallback, onFailureCallback) {
				var objJSON = new Object();
				objJSON.version = "1.0";
				objJSON.content = XSLContent;
				var postdata = JSON.stringify(objJSON);
				var url = "/resources/modeler/configuration/settingsServices/setConfiguredExpressionXSLT";
				console.log("makewscall now :")
				requestHelper(url, "POST", postdata, onSuccessCallback, onFailureCallback);
			},

			/**
			 * Call getConfiguredExpressionXSLTDefault API
			 * @param {Function} onSuccessCallback 
			 * @param {Function} onFailureCallback 
			 */
			getDefaultXSL: function (onSuccessCallback, onFailureCallback) {
				var postdataEmpty = "";
				var url = "/resources/modeler/configuration/settingsServices/getConfiguredExpressionXSLTDefault";
				console.log("makewscall now :");
				requestHelper(url, "GET", postdataEmpty, onSuccessCallback, onFailureCallback);
			},


			/**
			 * Call getConfiguredExpressionXSLT API
			 * @param {Function} onSuccessCallback 
			 * @param {Function} onFailureCallback 
			 */
			getCustoXSL: function (onSuccessCallback, onFailureCallback) {
				var postdataEmpty = "";
				var url = "/resources/modeler/configuration/navigationServices/getConfiguredExpressionXSLT";
				console.log("makewscall now :");
				requestHelper(url, "GET", postdataEmpty, onSuccessCallback, onFailureCallback);
			},


			/**
			 * Open a browse dialog which choose a file
			 * @param {Function} WhatToDoWithFile:Function taking a file in parameter 
			 */
			browseFiles: function (WhatToDoWithFile) {
				function openFileDialog(accept, multy = false, callback) { //Import file function : https://stackoverflow.com/questions/6463439/how-to-open-a-file-browse-dialog-using-javascript
					var inputElement = document.createElement("input");
					inputElement.type = "file";
					inputElement.accept = accept; // Note Edge does not support this attribute
					if (multy) {
						inputElement.multiple = multy;
					}
					if (typeof callback === "function") {
						inputElement.addEventListener("change", callback);
					}
					inputElement.dispatchEvent(new MouseEvent("click"));
				};
				function fileDialogChanged(event) {
					[...this.files].forEach(file => {
						WhatToDoWithFile(file);
					});
				}
				openFileDialog(".xsl,text/plain", false, fileDialogChanged); // Type / MultiFile / Callback
			},


			/**
			 * Transform an XML with an XSL to a readable text
			 * @param {String} xmlText 
			 * @param {String} xslText 
			 * @param {Function} resultHandle 
			 */
			xmlXslTransformation: function (xmlText, xslText, resultHandle) {
				var xsltProcessor = new XSLTProcessor();
				var docXSL = new DOMParser().parseFromString(xslText, "text/xml");
				xsltProcessor.importStylesheet(docXSL);
				var docXML = new DOMParser().parseFromString(xmlText, "text/xml");
				var fragment = xsltProcessor.transformToFragment(docXML, document);
				if (!fragment) {
					resultHandle("");
				}
				if (!fragment.firstChild) {
					resultHandle("");
				}
				resultHandle(fragment.firstChild.nodeValue);

			},

			/***
			*Download a file 
			*Argument 1: Name of file to download
			*Argument 2: Text content
			**/
			/**
			 * Download a file
			 * @param {String} filename:Name to give to new file 
			 * @param {String} text:content of the file to save 
			 */
			download: function (filename, text) {
				var element = document.createElement('a');
				element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
				element.setAttribute('download', filename);

				element.style.display = 'none';
				document.body.appendChild(element);

				element.click();

				document.body.removeChild(element);
			}
		}
	});

/**
* @quickreview  ROW 24:09:02
*/

define('DS/ParameterizationSkeleton/Utils/ParameterizationUnitsAndParameters/UnitsAndParametersParameterizationResourceServices',
  [
    'UWA/Core',
    'UWA/Class',
    'UWA/Json',
    'DS/Logger/Logger',
    'DS/CoreEvents/Events',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
  ],
  function (
    UWA,
    Class,
    Json,
    Logger,
    WUXEvents,
    URLHandler
  ) {

    'use strict';

    var UnitsAndParametersParameterizationResourceServices = Class.singleton({

      name: 'UnitsAndParametersParameterizationResourceServices',
      _logger: null,
      _attributesModal: null,


      /**
      * Init Resources
      *
      * @param {string} options.assetsModule - Assets module name
      */
      init: function init(options) {
        var that = this;

        that._parent(options);

        if (UWA.is(Logger)) {
          that._logger = Logger.getLogger(UnitsAndParametersParameterizationResourceServices);
        }

        return that;
      },

      /**
      * initAttributeModal.
      */
      initAttributeModal: function initAttributeModal(domainId, callback) {
        var that = this;

        if (that._attributesModal == null || that._attributesModal.get(domainId) == null) {
          if (that._attributesModal == null)
            that._attributesModal = new Map();

          var configFileTab = ["UnitsAndParamsArbitraryUnitsListArg", "UnitsAndParamsParametersListArg", "UnitsAndParamsParametersCustomAttrListArg"];

          if (configFileTab.length > 0) {
            var attrModal = new Map();
            var promiseTab = [];

            var configFileTabLength = configFileTab.length;
            for (var i = 0; i < configFileTabLength; i++) {
              var configFile = configFileTab[i];

              var url = URLHandler.getURL();
              if (url === undefined)
                url = '/ParameterizationSkeleton/assets/xml/' + configFile + '.xml';
              else
                url = url + '/webapps/ParameterizationSkeleton/assets/xml/' + configFile + '.xml';

              var lPath = url;// + '/webapps/ParameterizationSkeleton/assets/xml/' + configFile + '.xml';
              var promise = new Promise(function (resolve, reject) {
                that.loadXML(lPath, configFile, {
                  onSuccess: function (configFileTMP, attributesModal) {
                    that._attributesModal.set(configFileTMP, attributesModal);
                    attrModal.set(configFileTMP, attributesModal);
                    resolve();
                  }
                });
              });
              promiseTab.push(promise);
            }

            UWA.Promise.all(promiseTab).then(function () {
              if (callback != undefined)
                callback.onSuccess(attrModal);//that._attributesModal);
            });
          }

        }
        else {
          var configFileTab = ["ArbitraryUnitsListArg", "ArbitraryParametersListArg", "ArbitraryParametersCustomAttrListArg"];
          var attrModal = new Map();

          var configFileTabLength = configFileTab.length;
          for (var i = 0; i < configFileTabLength; i++)
            attrModal.set(configFileTab[i], that._attributesModal.get(configFileTab[i]));

          if (callback != undefined)
            callback.onSuccess(attrModal);
        }
      },

      /**
      * loadXML.
      */
      loadXML: function loadXML(filePath, configFile, callback) {
        //code for IE7+, Firefox, Chrome, Opera, Safari
        //else code for IE6, IE5
        var that = this, attributesArray;
        attributesArray = [];
        var lXMLhttp = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP");

        lXMLhttp["callback"] = callback;
        lXMLhttp.onload = function () {

          var xmlDoc = new DOMParser().parseFromString(lXMLhttp.responseText, 'text/xml');
          if (this.callback != null && this.callback.onSuccess)
            this.callback.onSuccess(configFile, xmlDoc);
        }

        lXMLhttp.open("GET", filePath, true);
        lXMLhttp.setRequestHeader("Content-Type", "text/xml");
        lXMLhttp.send();
      },

    });

    return UnitsAndParametersParameterizationResourceServices;
  });

define('DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/ParamSAXFormulaModal',
		[
			'DS/UIKIT/Modal',
			'UWA/Core',
			'DS/UIKIT/Input/Select',
			'DS/UIKIT/Input/Text',
			'DS/UIKIT/Input/Number',
			'DS/UIKIT/Alert',
			'DS/UIKIT/Tooltip',
			'DS/WAFData/WAFData',
			'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
			'DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/ParamSAXFormulaTable',
			'DS/Windows/ImmersiveFrame',
			'DS/Windows/Dialog',
			'DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/ParameterizationFLWebConstants',
			'i18n!DS/ParameterizationSkeleton/assets/nls/FLWebNLS'
			],
			function (Modal,
					UWACore,
					Select,
					Text,
					Number,
					Alert,
					Tooltip,
					WAFData,
					URLHandler,
					ParamSAXFormulaTable,
					WUXImmersiveFrame,
					WUXDialog,
					ParameterizationFLWebConstants,
					FLWebNLS) {

	'use strict';

	const formulaListModal = {
		createModal: function(options){
			const immersiveFrame = new WUXImmersiveFrame({
          domId: 'sax-formula-modal-immersiveFrame'
        });
				immersiveFrame.inject(options.parent);
				this.modal =  new WUXDialog({
					title: FLWebNLS.setANFormatHeader,
					content: this.topDiv,
					domId: 'sax-formula-modal',
					immersiveFrame: immersiveFrame,
					width: 900,
					height : 400,
					resizableFlag : true,
					modalFlag : true,
					buttons: null
				});
				this.modal.close = () => {
					//this.modal.destroy();
					document.getElementById('sax-formula-modal-immersiveFrame').destroy();
				}
// 			this.modal = new Modal({
// 				className: options.className || '',
// 				closable: true,
// 				header: '<h4>' + options.title || 'Logical Reference Architecture Number' + '</h4>',
// 				body: this.topDiv,
// 				footer: null
// 			});
// //this.modal.elements.body.appendChild(this.topDiv);
// 			this.modal.inject(options.parent);

		},
		insertTableView: function(options){
			//this.modal.show();
			this.topDiv = UWA.createElement('div',{
				styles:{
					'height': '100%',
					'width': '100%'
				}
			});
			ParamSAXFormulaTable.setANFormulaView(options.collection, this.topDiv, options.modelEvent, options.newSubTypeEvntObj);
		},
		showFormulaTable: function(options){
			//this.createModal(options);
			this.insertTableView(options);
			this.createModal(options);
			//this.modal.show()
			document.getElementById('buttonExport').innerText = FLWebNLS.done;
		}
	}
	return  formulaListModal;
	// function _createModal(options) {
	// 	var modal = new Modal({
	// 		className: options.className || '',
	// 		closable: true,
	// 		header: '<h4>' + options.title + '</h4>',
	// 		body: '',
	// 		footer: ''
	// 	});
	// 	return modal;
	// }
	//
	// function FLWebModal(options) {
	// 	this.options = {
	// 			title: 'Dialog',
	// 			className: '',
	// 			withFooter: true
	// 	};
	// 	this.options = UWACore.extend(this.options, options);
	//
	// 	this.modal = _createModal(this.options);
	// 	this.modal.inject(document.querySelector('#typeMainDiv'));
	// 	if (this.options.withFooter) {
	// 		this._bindFooterEvent();
	// 	}
	//
	// }
	//
	// FLWebModal.prototype.getPartNumberFormat = function () {
	//
	// 	var _formatContent = this.modal.getContent().getElement('.enox-arch-number-content');
	// 	var that = this;
	//
	// 	if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationFLWebConstants.FORMAT_FREE) {
	// 		var _dynamicFormatContent = this.modal.getContent().getElement('.enox-arch-number-dynamic-content');
	// 		_dynamicFormatContent.empty();
	// 		that.destroyValueFieldComponents();
	// 	} else if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationFLWebConstants.FORMAT_STRING) {
	// 		that.destroyValueFieldComponents();
	// 		that.getValueField(_formatContent);
	// 	} else if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationFLWebConstants.FORMAT_ATTRIBUTE) {
	// 		that.destroyValueFieldComponents();
	// 		that.getDynamicFields(_formatContent, this.partNumberTypeCombobox.getValue()[0]);
	// 	} else if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationFLWebConstants.FORMAT_COUNTER) {
	// 		that.destroyValueFieldComponents();
	// 		that.getDynamicFields(_formatContent, this.partNumberTypeCombobox.getValue()[0]);
	// 	}
	// };
	//
	// FLWebModal.prototype.getDefaultFields = function (_formatContent) {
	//
	// 	var that = this;
	//
	// 	var divTag = document.createElement('div');
	// 	divTag.className = "formats-arch";
	//
	// 	var labelDiv = document.createElement('div');
	// 	labelDiv.className = "formats-arch-label";
	// 	labelDiv.innerText = FLWebNLS.name; //formats-arch[i];
	//
	// 	var textBoxDiv = document.createElement('div');
	// 	textBoxDiv.className = "formats-arch-tbox";
	// 	var textOptions = {
	// 			events: {
	// 				//  onChange: that.validateEnteredNameValue.bind(that)
	// 			}
	// 	};
	//
	// 	this.nameTextBox = this.getTextBox(textOptions);
	// 	this.nameTextBox.domId = FLWebNLS.name + "_textBox";
	// 	this.nameTextBox.inject(textBoxDiv);
	//
	// 	divTag.appendChild(labelDiv);
	// 	divTag.appendChild(textBoxDiv);
	//
	// 	_formatContent.appendChild(divTag);
	//
	// 	var divTagForNbrBox = document.createElement('div');
	// 	divTagForNbrBox.className = "formats-arch";
	//
	// 	var labelDivForNbrBox = document.createElement('div');
	// 	labelDivForNbrBox.className = "formats-arch-label";
	// 	labelDivForNbrBox.innerText = FLWebNLS.order; //formats-arch[i];
	//
	// 	var textBoxDivForNbrBox = document.createElement('div');
	// 	textBoxDivForNbrBox.className = "formats-arch-tbox";
	//
	// 	var numberOptions = {
	// 			min: 1,
	// 			max: ParameterizationFLWebConstants.MAX_ROWS,
	//
	// 			value: this.getHighestOrder() + 1,
	// 			events: {}
	// 	};
	//
	// 	this.numberOrderBox = this.getNumberBox(numberOptions);
	// 	this.numberOrderBox.domId = FLWebNLS.order + "_textBox";
	// 	this.numberOrderBox.inject(textBoxDivForNbrBox);
	//
	//
	//
	//
	// 	divTagForNbrBox.appendChild(labelDivForNbrBox);
	// 	divTagForNbrBox.appendChild(textBoxDivForNbrBox);
	//
	// 	_formatContent.appendChild(divTagForNbrBox);
	//
	// 	var divTagForType = document.createElement('div');
	// 	divTagForType.className = "formats-arch";
	//
	// 	var typelabelDiv = document.createElement('div');
	// 	typelabelDiv.className = "formats-arch-label";
	// 	typelabelDiv.innerText = FLWebNLS.type;
	//
	// 	var typeComboBoxDiv = document.createElement('div');
	// 	typeComboBoxDiv.className = "formats-arch-tbox";
	//
	// 	var selectOptions = {
	// 			custom: false,
	// 			placeholder: FLWebNLS.selectType,
	// 			options: [{
	// 				label: FLWebNLS.String,
	// 				value: ParameterizationFLWebConstants.FORMAT_STRING
	// 			}, {
	// 				label: FLWebNLS.Free,
	// 				value: ParameterizationFLWebConstants.FORMAT_FREE
	// 			}, {
	// 				label: FLWebNLS.Attribute,
	// 				value: ParameterizationFLWebConstants.FORMAT_ATTRIBUTE
	// 			}, {
	// 				label: FLWebNLS.counterLabel,
	// 				value: ParameterizationFLWebConstants.FORMAT_COUNTER
	// 			}
	//
	// 			],
	// 			events: {
	// 				onChange: that.getPartNumberFormat.bind(that)
	// 			}
	// 	};
	//
	// 	this.partNumberTypeCombobox = this.getSelectComponent(selectOptions);
	// 	this.partNumberTypeCombobox.setId(FLWebNLS.type + "_comboBox");
	// 	this.partNumberTypeCombobox.inject(typeComboBoxDiv);
	//
	// 	divTagForType.appendChild(typelabelDiv);
	// 	divTagForType.appendChild(typeComboBoxDiv);
	// 	_formatContent.appendChild(divTagForType);
	//
	// };
	//
	// FLWebModal.prototype.getDynamicFields = function (_formatContent, format) {
	// 	var that = this;
	//
	// 	var _dynamicFormatContent = this.modal.getContent().getElement('.enox-arch-number-dynamic-content');
	// 	_dynamicFormatContent.empty();
	//
	// 	if (format == ParameterizationFLWebConstants.FORMAT_ATTRIBUTE) {
	// 		that.getAttributeFormat(_formatContent, _dynamicFormatContent);
	//
	// 	} else if (format == ParameterizationFLWebConstants.FORMAT_COUNTER) {
	// 		this.getCounterFormat(_formatContent, _dynamicFormatContent);
	// 	}
	//
	// };
	// FLWebModal.prototype.getAttributeFormat = function (_formatContent, _dynamicFormatContent) {
	//
	// 	var formatField = FLWebNLS.attribute;
	//
	// 	var divTag = document.createElement('div');
	// 	divTag.className = "formats-arch";
	//
	// 	var labelDiv = document.createElement('div');
	// 	labelDiv.className = "formats-arch-label";
	// 	labelDiv.innerText = formatField;
	//
	// 	var comboBoxDiv = document.createElement('div');
	// 	comboBoxDiv.className = "formats-arch-tbox";
	// 	var allAttributes = [];
	//
	// 	if (typeof this.attributes.message === "undefined") {
	// 		for (var key in this.attributes) {
	// 			var attributes1 = {};
	//
	// 			attributes1["label"] = this.attributes[key]
	// 			attributes1["value"] = key
	//
	// 			allAttributes.push(attributes1);
	// 		}
	// 	}
	//
	// 	var selectOptions = {
	// 			custom: false,
	// 			placeholder: FLWebNLS.selectAttribute,
	// 			options: allAttributes
	// 	};
	//
	// 	this.partNumberAttributeCombobox = this.getSelectComponent(selectOptions);
	//
	// 	this.partNumberAttributeCombobox.setId(formatField + "_comboBox");
	// 	this.partNumberAttributeCombobox.inject(comboBoxDiv);
	//
	// 	divTag.appendChild(labelDiv);
	// 	divTag.appendChild(comboBoxDiv);
	//
	// 	var formatFieldValue = FLWebNLS.defaultValue;
	// 	var divTagForValue = document.createElement('div');
	// 	divTagForValue.className = "formats-arch";
	//
	// 	var labelDivForValue = document.createElement('div');
	// 	labelDivForValue.className = "formats-arch-label";
	// 	labelDivForValue.innerText = formatFieldValue;
	//
	// 	var textBoxDivForValue = document.createElement('div');
	// 	textBoxDivForValue.className = "formats-arch-tbox";
	// 	this.valueDynTextBox = this.getTextBox();
	// 	this.valueDynTextBox.domId = formatFieldValue + "_textBox";
	// 	this.valueDynTextBox.inject(textBoxDivForValue);
	//
	// 	divTagForValue.appendChild(labelDivForValue);
	// 	divTagForValue.appendChild(textBoxDivForValue);
	//
	// 	_dynamicFormatContent.appendChild(divTag);
	// 	_dynamicFormatContent.appendChild(divTagForValue);
	// 	_formatContent.appendChild(_dynamicFormatContent);
	//
	// };
	//
	// FLWebModal.prototype.getCounterFormat = function (_formatContent, _dynamicFormatContent) {
	// 	var that = this;
	// 	var divTagForNbrBox = document.createElement('div');
	// 	divTagForNbrBox.className = "formats-arch";
	//
	// 	var labelDivForNbrBox = document.createElement('div');
	// 	labelDivForNbrBox.className = "formats-arch-label";
	//
	// 	var divForLabel = document.createElement('div');
	// 	divForLabel.className = 'label-counter-arch';
	//
	// 	var labelText = document.createElement('div');
	// 	labelText.className = 'label-text-arch';
	// 	labelText.innerText = FLWebNLS.digits;
	//
	// 	var informationDiv = document.createElement('div');
	// 	informationDiv.className = "fonticon fonticon-attention";
	// 	informationDiv.id = "information";
	// 	informationDiv.style.color = "black";
	//
	// 	divForLabel.appendChild(labelText);
	// 	divForLabel.appendChild(informationDiv);
	//
	// 	labelDivForNbrBox.appendChild(divForLabel);
	//
	// 	var textBoxDivForNbrBox = document.createElement('div');
	// 	textBoxDivForNbrBox.className = "formats-arch-tbox";
	//
	// 	var numberOptions = {
	// 			min: 1,
	// 			max: ParameterizationFLWebConstants.MAX_ROWS /*Number.MAX_SAFE_INTEGER*/,
	// 			step: 1,
	// 			value: 6,
	// 			events: {
	// 				onChange: that.updateSampleText.bind(that)
	// 			}
	// 	};
	//
	// 	this.counterNumberBox = this.getNumberBox(numberOptions);
	// 	this.counterNumberBox.domId = FLWebNLS.digits + "_textBox";
	// 	this.counterNumberBox.inject(textBoxDivForNbrBox);
	//
	// 	divTagForNbrBox.appendChild(labelDivForNbrBox);
	// 	divTagForNbrBox.appendChild(textBoxDivForNbrBox);
	//
	// 	_dynamicFormatContent.appendChild(divTagForNbrBox);
	//
	// 	var formatField = FLWebNLS.sample;
	//
	// 	var divTag = document.createElement('div');
	// 	divTag.className = "formats-arch-sample";
	//
	// 	var labelDiv = document.createElement('div');
	// 	labelDiv.className = "formats-arch-sample-label";
	// 	//labelDiv.innerText = formatField;
	//
	//
	// 	var sampleTextLabelSpan = document.createElement('span');
	// 	sampleTextLabelSpan.id = "sampleTextLabel";
	// 	sampleTextLabelSpan.innerText = formatField  +" : "  ;
	//
	// 	var sampleTextValueSpan = document.createElement('span');
	// 	sampleTextValueSpan.id = "sampleValue-arch";
	//
	// 	var textBoxDiv = document.createElement('div');
	// 	textBoxDiv.className = "formats-arch-sample-value";
	//
	// 	textBoxDiv.appendChild(sampleTextLabelSpan);
	// 	textBoxDiv.appendChild(sampleTextValueSpan);
	// 	//textBoxDiv.id = "sampleValue-arch";
	//
	// 	divTag.appendChild(labelDiv);
	// 	divTag.appendChild(textBoxDiv);
	//
	// 	_dynamicFormatContent.appendChild(divTag);
	// 	_formatContent.appendChild(_dynamicFormatContent);
	//
	// 	this.updateSampleText(); // sets the number of digits value
	//
	// 	this.modal.getContent().getElement('#information').addEvent('mouseover', function () {
	// 		that.getInformation(that.modal.getContent().getElement("#information"), FLWebNLS.counterTooltip);
	// 	});
	//
	// 	// this.modal.getContent().getElement('#sampleValue-arch').addEvent('mouseover', function () {
	// 	//   that.getInformation(that.modal.getContent().getElement("#sampleValue-arch"), event.currentTarget.getText());
	// 	//
	// 	// })
	//
	//
	// 	// this.modal.getContent().getElement('#sampleValue-arch').addEventListener('mouseout', function () {
	// 	// 	//that.getInformation(that.modal.getContent().getElement("#sampleValue-arch"), event.currentTarget.getText());
	// 	// 	console.log(that);
	// 	// 	that.tooltip.elements.body.empty()
	// 	//
	// 	// })
	//
	//
	// };
	//
	// FLWebModal.prototype.getInformation = function (targetElement, toDisplayOver) {
	//
	// 	var tooltipOtions = {
	// 			target: targetElement,
	// 			body: toDisplayOver
	// 	};
	// 	this.getTooltip(tooltipOtions);
	//
	// };
	//
	// FLWebModal.prototype.getValueField = function (_formatContent) {
	//
	// 	var _dynamicFormatContent = this.modal.getContent().getElement('.enox-arch-number-dynamic-content');
	//
	// 	_dynamicFormatContent.empty();
	//
	// 	var formatField = FLWebNLS.value;
	//
	// 	var divTag = document.createElement('div');
	// 	divTag.className = "formats-arch";
	//
	// 	var labelDiv = document.createElement('div');
	// 	labelDiv.className = "formats-arch-label";
	// 	labelDiv.innerText = formatField;
	//
	// 	var textBoxDiv = document.createElement('div');
	// 	textBoxDiv.className = "formats-arch-tbox";
	// 	this.valueTextBox = this.getTextBox();
	// 	this.valueTextBox.domId = formatField + "_textBox";
	// 	this.valueTextBox.inject(textBoxDiv);
	//
	// 	divTag.appendChild(labelDiv);
	// 	divTag.appendChild(textBoxDiv);
	//
	// 	_dynamicFormatContent.appendChild(divTag);
	// 	_formatContent.appendChild(_dynamicFormatContent);
	//
	// };
	//
	// FLWebModal.prototype.getModalBody = function () {
	//
	// 	var partNumberContent = this.modal.elements.body;
	//
	// 	var _errorsMessageDiv = UWACore.createElement('div');
	// 	_errorsMessageDiv.className = "enox-part-number-error-content";
	//
	// 	var _formatContent = UWACore.createElement('div');
	// 	_formatContent.className = "enox-arch-number-content";
	//
	// 	var _dynamicFormatContent = UWACore.createElement('div');
	// 	_dynamicFormatContent.className = "enox-arch-number-dynamic-content";
	//
	// 	this.getDefaultFields(_formatContent);
	//
	// 	partNumberContent.appendChild(_errorsMessageDiv);
	// 	partNumberContent.appendChild(_formatContent);
	// 	partNumberContent.appendChild(_dynamicFormatContent);
	// 	return partNumberContent;
	// };
	//
	// FLWebModal.prototype.createCollabUnicitySecAddFieldModalBody = function () {
	//
	// 	var modalBody = this.modal.elements.body;
	//
	// 	var _errorsMessageDiv = UWACore.createElement('div');
	// 	_errorsMessageDiv.className = "enox-part-number-error-content";
	//
	// 	var _formatContent = UWACore.createElement('div');
	// 	_formatContent.className = "enox-arch-number-content";
	//
	// 	// var _dynamicFormatContent = UWACore.createElement('div');
	// 	// _dynamicFormatContent.className = "enox-arch-number-dynamic-content";
	//
	// 	//this.getDefaultFields(_formatContent);
	// 	this.addDefaultFieldsToCollabUnicitySecModalBody(_formatContent);
	// 	modalBody.appendChild(_errorsMessageDiv);
	// 	modalBody.appendChild(_formatContent);
	// 	//	modalBody.appendChild(_dynamicFormatContent);
	// 	//return partNumberContent;
	// };
	//
	// FLWebModal.prototype.addDefaultFieldsToCollabUnicitySecModalBody = function (_formatContent) {
	//
	// 	var that = this;
	// 	var groupNameField = document.createElement('div');
	// 	groupNameField.className = "formats-arch";
	//
	// 	var labelDiv = document.createElement('div');
	// 	labelDiv.className = "formats-arch-label";
	// 	labelDiv.innerText = FLWebNLS.label_groupName;
	//
	// 	var textBoxDiv = document.createElement('div');
	// 	textBoxDiv.className = "formats-arch-tbox";
	// 	var textOptions = {
	// 			events: {
	// 				//  onChange: that.validateEnteredNameValue.bind(that)
	// 			}
	// 	};
	// 	this.nameTextBoxForCollabUnicity = this.getTextBox(textOptions);
	// 	this.nameTextBoxForCollabUnicity.domId = FLWebNLS.name + "_textBox";
	// 	this.nameTextBoxForCollabUnicity.inject(textBoxDiv);
	//
	// 	groupNameField.appendChild(labelDiv);
	// 	groupNameField.appendChild(textBoxDiv);
	// 	_formatContent.appendChild(groupNameField);
	//
	// 	var collabSpaceField = document.createElement('div');
	// 	collabSpaceField.className = 'formats-arch';
	//
	// 	var collabSpacelabel = document.createElement('div');
	// 	collabSpacelabel.className = 'formats-arch-label';
	// 	collabSpacelabel.innerText = FLWebNLS.label_CSfield;
	//
	// 	var collabSpaceTextBoxContainer = document.createElement('div');
	// 	collabSpaceTextBoxContainer.className = 'formats-arch-tbox';
	// 	var csList =  JSON.parse(localStorage.getItem('csList'));
	// 	var collabSpaceSelectOptions = {
	// 			//placeholder: 'Select your option',
	// 			multiple: true,
	// 			options: csList,
	// 			events: {
	// 				//  onChange: that.validateEnteredNameValue.bind(that)
	// 			}
	// 	};
	// 	this.collabListTextBox = this.getSelectComponent(collabSpaceSelectOptions);
	// 	this.collabListTextBox.domId = FLWebNLS.name + "_textBox";
	// 	this.collabListTextBox.inject(collabSpaceTextBoxContainer);
	//
	// 	collabSpaceField.appendChild(collabSpacelabel);
	// 	collabSpaceField.appendChild(collabSpaceTextBoxContainer);
	//
	// 	_formatContent.appendChild(collabSpaceField);
	//
	// };
	//
	// FLWebModal.prototype.validateEnteredNameValue = function (operation, editingField) {
	// 	var duplicateData = {};
	// 	duplicateData.isValid = true;
	// 	var userEnteredFormat = this.nameTextBox.getValue();
	// 	var isSuccess = this.validateEnteredValues(userEnteredFormat, FLWebNLS.name, operation, editingField);
	// 	if (!isSuccess) {
	// 		duplicateData.isValid = false;
	// 	}
	// 	duplicateData.data = userEnteredFormat;
	// 	return duplicateData;
	// };
	//
	// FLWebModal.prototype.validateEnteredGroupNameValue = function (operation, editingField) {
	// 	var duplicateData = {};
	// 	duplicateData.isValid = true;
	// 	var userEnteredName = this.nameTextBoxForCollabUnicity.getValue();
	// 	var isSuccess = this.validateEnteredValuesForArchNumCollab(userEnteredName, FLWebNLS.name, operation, editingField);
	// 	if (!isSuccess) {
	// 		duplicateData.isValid = false;
	// 	}
	// 	duplicateData.data = userEnteredName;
	// 	return duplicateData;
	// };
	//
	// FLWebModal.prototype.validateEnteredOrderValue = function (operation, editingField) {
	//
	// 	var duplicateData = {};
	// 	duplicateData.isValid = true;
	//
	// 	var userEnteredFormat = this.numberOrderBox.getValue();
	// 	var isSuccess = this.validateEnteredValues(userEnteredFormat, FLWebNLS.order, operation, editingField);
	//
	// 	if (!isSuccess) {
	//
	// 		duplicateData.isValid = false;
	// 	}
	//
	// 	duplicateData.data = userEnteredFormat;
	// 	return duplicateData;
	// };
	//
	// FLWebModal.prototype.validateEnteredValues = function (userEnteredFormat, field, operation, editingField) {
	// 	var rowsOfMappedFields = document.querySelectorAll(".partNumberFieldMapping");
	// 	var successFields = document.querySelector('.success');
	//
	//
	// 	var isSuccess = true;
	//
	// 	if (operation == "edit") {
	// 		for (var k = 0; k < rowsOfMappedFields.length; k++) {
	// 			if (rowsOfMappedFields[k] != editingField) {
	// 				for (var j = 0; j < 2; j++) {
	// 					if (successFields.getChildren()[j].getText() == field && userEnteredFormat == rowsOfMappedFields[k].getChildren()[j].getText()) {
	// 						isSuccess = false;
	// 						break;
	// 					}
	// 				}
	// 			}
	// 		}
	// 	} else {
	// 		for (var k1 = 0; k1 < rowsOfMappedFields.length; k1++) {
	//
	// 			for (var j1 = 0; j1 < 2; j1++) {
	// 				if (successFields.getChildren()[j1].getText() == field && userEnteredFormat == rowsOfMappedFields[k1].getChildren()[j1].getText()) {
	// 					isSuccess = false;
	// 					break;
	// 				}
	// 			}
	// 		}
	// 	}
	// 	return isSuccess;
	// };
	//
	// FLWebModal.prototype.validateEnteredValuesForArchNumCollab = function (userEnteredFormat, field, operation, editingField) {
	// 	var rowsOfMappedFields = document.querySelectorAll("#archNumCollabTableRow");
	// 	var successFields = document.querySelector('#headerRowArchNumCollab');
	// 	var isSuccess = true;
	// 	if (operation == "edit") {
	// 		for (var k = 0; k < rowsOfMappedFields.length; k++) {
	// 			if (rowsOfMappedFields[k] != editingField) {
	// 				for (var j = 0; j < 2; j++) {
	// 					if (successFields.getChildren()[j].getText() == field && userEnteredFormat == rowsOfMappedFields[k].getChildren()[j].getText()) {
	// 						isSuccess = false;
	// 						break;
	// 					}
	// 				}
	// 			}
	// 		}
	// 	} else {
	// 		for (var k1 = 0; k1 < rowsOfMappedFields.length; k1++) {
	// 			for (var j1 = 0; j1 < 2; j1++) {
	// 				if (successFields.getChildren()[j1].getText() == field && userEnteredFormat == rowsOfMappedFields[k1].getChildren()[j1].getText()) {
	// 					isSuccess = false;
	// 					break;
	// 				}
	// 			}
	// 		}
	// 	}
	// 	return isSuccess;
	// };
	//
	// FLWebModal.prototype.validateEnteredGroupNameValueNotNull = function () {
	// 	var userEnteredFormat = this.nameTextBoxForCollabUnicity.getValue();
	// 	var isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
	// 	return isNull;
	// };
	//
	// FLWebModal.prototype.validateEnteredCollabListValueNotNull = function () {
	// 	var userEnteredFormat = this.collabListTextBox.getValue()[0];
	// 	var isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
	// 	return isNull;
	// };
	//
	// FLWebModal.prototype.validateEnteredNameValueNotNull = function () {
	// 	var userEnteredFormat = this.nameTextBox.getValue();
	// 	var isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
	// 	return isNull;
	// };
	//
	// FLWebModal.prototype.validateEnteredOrderValueNotNull = function () {
	// 	var userEnteredFormat = this.numberOrderBox.getValue();
	// 	var isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
	// 	return isNull;
	// };
	//
	// FLWebModal.prototype.validateEnteredValueFieldValueNotNull = function () {
	// 	var isNull = false;
	// 	if (this.getUserEnteredValues().Type != ParameterizationFLWebConstants.FORMAT_ATTRIBUTE) {
	// 		isNull = this.valueTextBox ? this.validateEnteredValuesNotNull(this.valueTextBox.getValue()) : this.valueDynTextBox ? this.validateEnteredValuesNotNull(this.valueDynTextBox.getValue()) : false;
	// 	}
	// 	return isNull;
	// };
	//
	// FLWebModal.prototype.validatSelectedTypeFieldValueNotNull = function () {
	// 	var userEnteredFormat = this.partNumberTypeCombobox.getValue()[0];
	// 	var isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
	// 	return isNull;
	// };
	//
	// FLWebModal.prototype.validateSelectedAttributeFieldValueNotNull = function () {
	// 	var userEnteredFormat = this.partNumberAttributeCombobox ? this.partNumberAttributeCombobox.getValue()[0] : '';
	// 	var isNull = false;
	// 	if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationFLWebConstants.FORMAT_ATTRIBUTE) {
	// 		isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
	// 	}
	//
	// 	return isNull;
	// };
	//
	// FLWebModal.prototype.validateEnteredCounterFieldValueNotNull = function () {
	// 	var userEnteredFormat = this.counterNumberBox ? this.counterNumberBox.getValue() : '';
	// 	var isNull = false;
	// 	if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationFLWebConstants.FORMAT_COUNTER) {
	// 		isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
	// 	}
	//
	// 	return isNull;
	// };
	//
	//
	// FLWebModal.prototype.validateEnteredValuesNotNull = function (userEnteredFormat) {
	//
	// 	var isNull = false;
	// 	if (userEnteredFormat == '' || userEnteredFormat == "") {
	// 		isNull = true;
	// 	}
	// 	return isNull;
	// };
	//
	// FLWebModal.prototype.displayAlertMessage = function (messageToDisplay, toDisplayOver) {
	// 	var alertOptions = {
	// 			visible: true,
	// 			className: 'param-alert',
	// 			messageClassName: 'error',
	// 			closable: true,
	// 			renderTo: toDisplayOver,
	// 			autoHide: true,
	// 			hideDelay: 2000
	// 	};
	// 	var alert = this.getAlertComponent(alertOptions);
	//
	// 	alert.add({
	// 		message: messageToDisplay
	// 	});
	//
	// };
	//
	// FLWebModal.prototype.getUserEnteredValues = function () {
	//
	// 	var userEnteredFormatValues = {};
	//
	// 	var valueField = this.valueTextBox ? this.valueTextBox.getValue() : this.valueDynTextBox ? this.valueDynTextBox.getValue() : this.modal.getContent().getElement('#sampleValue-arch') ? this.modal.getContent().getElement('#sampleValue-arch').innerText : '';
	// 	var attributeFieldLabel = this.partNumberAttributeCombobox ? this.partNumberAttributeCombobox.getOption(this.partNumberAttributeCombobox.getValue()[0]).getText() : '';
	// 	var attributeFieldValue = this.partNumberAttributeCombobox ? this.partNumberAttributeCombobox.getValue()[0] : '';
	// 	var numberOfDigits = this.counterNumberBox ? this.counterNumberBox.getValue() : '';
	//
	// 	userEnteredFormatValues[ParameterizationFLWebConstants.NAME] = this.nameTextBox.getValue();
	// 	userEnteredFormatValues[ParameterizationFLWebConstants.ORDER] = this.numberOrderBox.getValue();
	// 	userEnteredFormatValues[ParameterizationFLWebConstants.TYPE] = this.partNumberTypeCombobox.getValue()[0];
	// 	userEnteredFormatValues[ParameterizationFLWebConstants.ATTRIBUTE] = attributeFieldValue;
	// 	userEnteredFormatValues[ParameterizationFLWebConstants.ATTRIBUTE_NLS_NAME] = attributeFieldLabel;
	// 	userEnteredFormatValues[ParameterizationFLWebConstants.COUNTER] = numberOfDigits;
	// 	userEnteredFormatValues[ParameterizationFLWebConstants.VALUE] = valueField;
	//
	// 	return userEnteredFormatValues;
	// };
	//
	// FLWebModal.prototype.getUserEnteredValuesForArchNumCollabUnicity = function () {
	// 	var userEnteredFormatValues = {};
	// 	var fieldValue = '';
	// 	var csSelectList = this.collabListTextBox.getValue();
	// 	if(Array.isArray(csSelectList)) {
	// 		for(var i = 0; i < csSelectList.length-1; i++) {
	// 			fieldValue += csSelectList[i] + ',';
	// 		};
	// 		fieldValue += csSelectList[i];
	// 	} else {
	// 		fieldValue = csSelectList;
	// 	}
	// 	userEnteredFormatValues[ParameterizationFLWebConstants.NAME] = this.nameTextBoxForCollabUnicity.getValue();
	// 	userEnteredFormatValues[ParameterizationFLWebConstants.VALUE] = fieldValue;
	// 	return userEnteredFormatValues;
	// };
	//
	// FLWebModal.prototype.updateSampleText = function () {
	//
	// 	var sampleTextDiv = this.modal.getContent().getElement('#sampleValue-arch');
	// 	var updatedCount = this.counterNumberBox ? this.counterNumberBox.getValue() : '';
	// 	var noOFDigits = "";
	// 	for (var i = 0; i < parseInt(updatedCount); i++) {
	// 		noOFDigits = '0' + noOFDigits;
	// 	}
	// 	if (sampleTextDiv != null) {
	// 		sampleTextDiv.innerText = noOFDigits;
	// 	}
	//
	// };
	//
	// FLWebModal.prototype.getTotalFormatRows = function () {
	// 	return document.querySelectorAll(".partNumberFieldMapping").length;
	// };
	//
	// FLWebModal.prototype.getHighestOrder = function () {
	// 	var rowsOfMappedFields = document.querySelectorAll(".partNumberFieldMapping");
	// 	var toCheckTheExistingRows = rowsOfMappedFields.length;
	// 	var highestOrder = 0;
	// 	if (toCheckTheExistingRows > 0) {
	// 		for (var k = 0; k < rowsOfMappedFields.length; k++) {
	// 			if (parseInt(rowsOfMappedFields[k].getChildren()[1].getText()) > highestOrder) {
	// 				highestOrder = parseInt(rowsOfMappedFields[k].getChildren()[1].getText());
	// 			}
	// 		}
	// 	}
	//
	// 	return highestOrder;
	//
	// };
	// FLWebModal.prototype.isCounterExists = function (field) {
	// 	var rowsOfMappedFields = document.querySelectorAll(".partNumberFieldMapping");
	// 	var toCheckTheExistingRows = rowsOfMappedFields.length;
	// 	var isSuccess = false;
	// 	if (toCheckTheExistingRows > 0) {
	// 		for (var k = 0; k < rowsOfMappedFields.length; k++) {
	// 			if (rowsOfMappedFields[k].getChildren()[2].value == ParameterizationFLWebConstants.FORMAT_COUNTER) {
	// 				isSuccess = true;
	// 				break;
	// 			}
	// 		}
	// 	}
	//
	// 	return isSuccess;
	// };
	//
	// FLWebModal.prototype.destroyValueFieldComponents = function () {
	//
	// 	this.valueTextBox = undefined;
	// 	this.valueDynTextBox = undefined;
	// 	this.counterNumberBox = undefined;
	//
	// };
	//
	// FLWebModal.prototype.getAttributes = function (data) {
	// 	var that = this;
	// 	that.storeAttributes(data);
	// };
	//
	// FLWebModal.prototype.storeAttributes = function (data) {
	//
	// 	this.attributes = data;
	//
	// };
	//
	//
	// FLWebModal.prototype.getTextBox = function (textBoxOptions) {
	//
	// 	this.textBox = new Text(textBoxOptions);
	// 	return this.textBox;
	// };
	// FLWebModal.prototype.getNumberBox = function (numberOptions) {
	//
	// 	this.numberBox = new Number(numberOptions);
	// 	return this.numberBox;
	// };
	//
	// FLWebModal.prototype.getSelectComponent = function (selectOptions) {
	// 	this.select = new Select(selectOptions);
	// 	return this.select;
	// };
	//
	// FLWebModal.prototype.getAlertComponent = function (alertOptions) {
	//
	// 	this.alert = new Alert(alertOptions);
	// 	return this.alert;
	// };
	//
	// FLWebModal.prototype.getTooltip = function (tooltipOtions) {
	// 	this.tooltip = new Tooltip(tooltipOtions);
	// 	return this.tooltip;
	// };
	//
	// FLWebModal.prototype.show = function () {
	// 	this.modal.show();
	// };
	//
	//
	// FLWebModal.prototype._bindFooterEvent = function () {
	// 	var that = this;
	//
	// 	this.modal.getFooter().getElements('.btn').forEach(function (element) {
	// 		if (element.name === 'cancelButton') {
	// 			element.addEvent('click', function () {
	// 				that.modal.hide();
	// 			});
	// 		}
	// 	});
	//
	// };
	//
	// FLWebModal.prototype.getContent = function () {
	// 	return this.modal.getContent();
	// };
	//
	// FLWebModal.prototype.destroy = function () {
	// 	this.modal.destroy();
	// 	var keys = Object.keys(this);
	// 	for (var i = 0; i < keys.length; i++) {
	// 		this[keys[i]] = undefined;
	// 	}
	// };
	//
	// return FLWebModal;
});

define('DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/ParamSAXFormulaView', [
	'UWA/Core',
	'UWA/Class/View',
	'DS/UIKIT/Mask',
	'DS/UIKIT/Scroller',
	'DS/WAFData/WAFData',
	'DS/WebappsUtils/WebappsUtils',
	'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
	'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
	'DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/CompanyIDViewUtilities',
	'DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/ParameterizationFLWebConstants',
	'DS/UIKIT/Input/Button',
	'DS/UIKIT/Alert',
	'DS/ParameterizationSkeleton/Views/ParametersLayoutView',
	"DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/ParamSAXFormulaModal",
	"DS/Skeleton/SkeletonLayout",
	"DS/ParameterizationSkeleton/Views/ParameterizationFLWeb/ParamSAXFormulaTable",
	'DS/UIKIT/Modal',
	'DS/Controls/ComboBox',
	'DS/CoreEvents/ModelEvents',
	'DS/TreeModel/TreeDocument',
  'DS/TreeModel/TreeNodeModel',
	'i18n!DS/ParameterizationSkeleton/assets/nls/FLWebNLS'
	],
	function(UWA,
			View,
			Mask,
			Scroller,
			WAFData,
			WebappsUtils,
			ParametersLayoutViewUtilities,
			URLHandler,
			CompanyIDViewUtilities,
			ParameterizationFLWebConstants,
			Button,
			Alert,
			ParametersLayoutView,
			ParamSAXFormulaModal,
			SkeletonLayout,
			ParamSAXFormulaTable,
			Modal,
			WUXComboBox,
			ModelEvents,
			TreeDocument,
			TreeNodeModel,
			FLWebNLS) {

	'use strict';

	var extendedView;
	const modelEvent = new ModelEvents();
	let model = null;
	extendedView = View.extend({
		tagName: 'div',
		className: 'generic-detail',

		init: function(options) {
			var initDate = new Date();
			options = UWA.clone(options || {}, false);
			this._parent(options);
			this.options = options;
			this.contentDiv = null;
			this.lastAlertDate = initDate.getTime();

			this.paramScroller = null;
			this.paramAltSubScroller = null; //paramUnicitySubScroller
			this.userMessaging = null;
			this.controlDiv = null;
      this.cellsIndexForArchNumCollab = {
          "name": 0,
          "value": 1,
          "action": 2,
          "deployFlag": 3
      };
		},

		setup: function(options) {
			UWA.log('Architect Layout::setup!');
			UWA.log(options);
		},

		render: function() {
			UWA.log("Architect LayoutView::render");
			var introDiv,
			mappingDiv,
			that = this;

			this.contentDiv = UWA.createElement('div', {
				'id': 'typeMainDiv'
			});
			Mask.mask(this.contentDiv);
			// introDiv = UWA.createElement('div', {
			// 	'class': 'information-arch'
			// }).inject(this.contentDiv);
			//
			// UWA.createElement('p', {
			// 	text: FLWebNLS.intro,
			// 	'class': 'font-3dslight'
			// }).inject(introDiv);

			this.parentView = new ParametersLayoutView(this.options);
			//this.controlDiv = ParametersLayoutViewUtilities.createApplyResetToolbar.call(this, this.contentDiv, true, this.applyParams.bind(this), this.resetParams.bind(this));
			this.container.setContent(this.contentDiv);
			this.listenTo(this.collection, {
				onSync: that.onCompleteRequestMapping
			});
			return this;
		},

		onCompleteRequestMapping: function() {
			var that = this;
			const url = URLHandler.getURL() +'/resources/v1/SystemsArchitectureDefinitionParam/isOtbParameterFormatByTypeEnabled';
			//ParamSAXFormulaView
		 	WAFData.authenticatedRequest(url, {
				 timeout: 250000,
				 method: 'GET',
				 type: 'json',
				 headers: {
					 'Content-Type': 'application/json',
					 // 'Accept': 'application/json',
				 },
				 onFailure: (result) => {
					 this.showAlertMsg(FLWebNLS.FailedToGetData, 'error', widget.body)
				 },
				 onComplete: (result) => {
				   if(result.message == 'true'){
							const collectionTypeBasedAnTable = this.collection._models[0]._attributes;
							const parsedCollection = this.parserForTypeBasedANFormatRes(collectionTypeBasedAnTable.ExpressionList)
							this.columns = parsedCollection.columns;
							const tableData = {
								 columns:[{
									 type: true,
									 nls: FLWebNLS.itemType
								 },{
									 formula: true,
									 nls: FLWebNLS.formula_header
								 }],
								 rows:[]
							}
				      let th = null,tr = null, td = null, actnTd = null;

				      this.table = UWA.createElement('table',{
				        class: 'formula-list-table',
				        styles: {
				          'table-layout': 'fixed',
				          width: '100%'
				        }
				      });
							this.table.addEvent('click', (e)=>{
								//e.target.getParent('tr').destroy();
								if(e.target.hasClassName('fonticon-trash'))
									this.createConfirmationDialog(e);
							});

				      const thead = UWA.createElement('tr',{
				        class: 'formula-list-table-thead',
				        styles: {
				          color: 'hsl(106deg 36% 34%)'
				        }
				      }).inject(this.table);

				      this.columns.forEach(
								entry => this.createTableHeadCell(entry, thead, true)
						  );
						  this.createTableHeadCell({nls:FLWebNLS.actions}, thead, false)

				      parsedCollection.rows.forEach(
								row => this.createTableRow(row)
							);
							this.contentDiv.appendChild(this.table);
				      this.createPlusActionBtn().inject(this.contentDiv);
							Mask.unmask(this.contentDiv);
							this.parentView.render();

							modelEvent.subscribe({event:'New_SubType_Formula'}, (data) => {
		 						 const tableData = {
									 columns:[{
  									 type: true,
  									 nls: FLWebNLS.itemType
  								 },{
  									 formula: true,
  									 nls: FLWebNLS.formula_header
  								 }],
		 			 				rows:[{
		 			 					type: data.nls,
		 			 					formula: data.formula,
		 			 					value:data.value
		 			 				}]
		 			 			}
		 			 			this.createTableRow(tableData.rows[0])
	 					 });

	 					 modelEvent.subscribe({event:'Edit_ExistingSubType_Formula'}, (data) => {
		 						 const editedRow = this.table.querySelector(`[type-name=${data.typeName}]`);
		 						 const formulaCell = editedRow && editedRow.querySelector(`[cell-col-value=formula]`);
		 						 if(formulaCell){
									 formulaCell.innerText = data.formulaValue;
								 }
								 let argsArray = CompanyIDViewUtilities.argsForUpdatingFormulaHeader;
			 					 if(argsArray && Array.isArray(argsArray) && argsArray.length>0){
			 							for(let eachArgList of argsArray){
			 								CompanyIDViewUtilities.updateFormulaTextFields.apply(CompanyIDViewUtilities,eachArgList);
			 							}
			 					 }
								 // document.getElementById('partNumberFormulaMapping').getChildren()[2].innerText = res.anFormat;
								 // document.getElementById('partNumberFormulaMapping').getChildren()[2].style.fontSize = '21px';
	 					 });
						} else {
							UWA.log('Rendering for Single AN Format!!!');
							var collection = this.collection._models[0]._attributes;
							ParamSAXFormulaTable.setANFormulaView(this.collection, that.contentDiv);
						}
				 }
			 });
		},

		parserForTypeBasedANFormatRes: function(result){
			const parsedResultHolder = {
				columns:[{
					type: true,
					nls: FLWebNLS.itemType
				},{
					formula: true,
					nls: FLWebNLS.formula_header
				}],
				rows:[]
			}
			for(let entry of result){
				parsedResultHolder.rows.push({
					type: entry.typeNLS,
					value: entry.type,
					formula: entry.anFormat
				})
			}
			return parsedResultHolder;
		},
		createNewSubTypeANFormat: function(selectedSubType){
			const url = `${URLHandler.getURL()}/resources/v1/SystemsArchitectureDefinitionParam/getAttributesToCreateNewSubTypeANFormat?
			flpType=${selectedSubType.value}&tenant=${URLHandler.getTenant()}`;
			Mask.mask(this.contentDiv);
			WAFData.authenticatedRequest(url, {
				timeout: 250000,
				method: 'GET',
				// data: JSON.stringify({
				// 	ParameterExpressionList:[],
				// 	flpType:selectedSubType.value
				// }),
				type: 'json',
				headers: {
					'Content-Type': 'application/json',
					'Accept': 'application/json'
				},
				onFailure: (result) => {
				this.showAlertMsg(FLWebNLS.FailedToGetData, 'error', widget.body)
				Mask.unmask(this.contentDiv);
				//	Mask.unmask(that.contentDiv);
				//	that.onApplyFailure(FLWebNLS.ApplyError);
				},
				onComplete: (result) => {
					Mask.unmask(this.contentDiv);
					if (result && result.status != 400) {
						const newSubTypeEvntObj = {
								event:'New_SubType_Formula',
								 data:{
									nls:selectedSubType.nls,
									value:selectedSubType.value,
									formula:`[${FLWebNLS.freeValue}]`,
								}
						}
						this.showEmptySAXFormTable({
							result,
							data:{
								typeName:selectedSubType.value,
							},
							newSubTypeEvntObj
						});
					} else {
						this.showAlertMsg(result.message, 'error', widget.body)
					}
				}

			});
		},
		showEmptySAXFormTable: function(options){
      ParamSAXFormulaModal.showFormulaTable({
        parent: this.contentDiv,
        collection: {_models:[{
					'_attributes':{
		          ExpressionList:{},
		          PhysicalProductAttributes: options.result
		        }
				}]},
				modelEvent: {
					eventObj:modelEvent,
					name: 'Edit_ExistingSubType_Formula',
					data: options.data
				},
				newSubTypeEvntObj: options.newSubTypeEvntObj
      });
			this.typeSelectionModal.destroy();
    },
    createTypeSelectionModal: function(optionList){
        const that = this;
        that._callBack = this.createNewSubTypeANFormat;
        const header = FLWebNLS.selectTypeForArchNoFormat;
				//that.submit = 'Done';
        const footer = () => {
          const arrFooter = [];
          const cancelBtn = new Button({
                    id : 'confirmation-fail',
                    value : FLWebNLS.cancel,
                    events : {
                        onClick : () => {
                          this.typeSelectionModal.destroy();
                        }
                    }
          });
          const confirmBtn = new Button({
                    id : 'confirmation-success',
                    value : FLWebNLS.done,
										className: 'primary',
                    events : {
                        onClick : () => {
                          if(this.myComboBox && (!this.myComboBox.value || this.myComboBox.value == '')) {
                              //CommonUtil.alertMessage('error', null, null, 'Please select a type.');
															this.showAlertMsg('Please select a type.', 'error', widget.body)
                              return;
                          }
                          this._callBack({
														value:this.myComboBox.value,
														nls:this.myComboBox.label
													});
                        }
                    }
          });
          arrFooter.push(confirmBtn);
          arrFooter.push(cancelBtn);
          return arrFooter;
        }
        const content = () => {
          const selectionBox = UWA.createElement('div',{
            styles: {
              width: '100%',
              display: 'flex',
              padding: '10px'
            //  height: '100%'
            }
          });
          const messageDiv = UWA.createElement('div',{
            html: 'Type',
            styles:{
              flex: 0.3,
              'padding-right': '10px',
              'font-weight': 'bold'
            }
          });
          this.myComboBox = new WUXComboBox({
            // elementsList: optionList
						elementsTree: optionList
          });
          messageDiv.inject(selectionBox)
          this.myComboBox.inject(selectionBox);
          this.myComboBox.getContent().setStyle('flex', '0.6');
          return selectionBox;
        }

        this.typeSelectionModal = new Modal({
										closable : true,
										header : header,
										body : content(),
										footer : footer(),
										events : {
												onHide : function() {
												this.destroy();
											}
										}
          });
					this.typeSelectionModal.getContent().setStyle('padding-top', '35px')
          this.typeSelectionModal.inject(this.contentDiv);
          this.typeSelectionModal.show();
    },
		createConfirmationDialog: function(deleteEl){
			const footer = (e) => {
				const arrFooter = [];
				const cancelBtn = new Button({
									id : 'confirmation-fail',
									value : FLWebNLS.cancel,
									events : {
											onClick : () => {
												this.confirmDialog.destroy();
											}
									}
				});
				const confirmBtn = new Button({
									id : 'confirmation-success',
									value : FLWebNLS.done,
									className: 'primary',
									events : {
											onClick : (e) => {
												const url = URLHandler.getURL() + "/resources/v1/SystemsArchitectureDefinitionParam/setParamArchitectureNumberExpressions?tenant=" + URLHandler.getTenant();
												const payloadToSend = {
													flpType:deleteEl.target.closest('tr').getAttribute('type-name'),
													ParameterExpressionList:[]
												}
											 	WAFData.authenticatedRequest(url, {
													 timeout: 250000,
													 method: 'POST',
													 data: JSON.stringify(payloadToSend),
													 type: 'json',
													 headers: {
														 'Content-Type': 'application/json',
														 'Accept': 'application/json'
													 },
													 onFailure: (result) => {
														 this.showAlertMsg(FLWebNLS.FailedToGetData, 'error', widget.body)
													 },
													 onComplete: (result) => {
														 this.showAlertMsg(FLWebNLS.deleteSuccess, 'success', widget.body)
														 deleteEl.target.closest('tr').remove()
													 }
											 	});
												this.confirmDialog.destroy();
											}
									}
				});
				arrFooter.push(confirmBtn);
				arrFooter.push(cancelBtn);
				return arrFooter;
			}
			this.confirmDialog = new Modal({
									closable : true,
									header : FLWebNLS.deleteHeader,
									body : `<p>${FLWebNLS.deleteConfirm}<p>`,
									footer : footer(),
									events : {
											onHide : function() {
											this.destroy();
										}
									}
				});
				this.confirmDialog.getContent().setStyle('padding-top', '35px')
				this.confirmDialog.inject(this.contentDiv);
				this.confirmDialog.show();
		},
    createPlusActionBtn: function(){
      const addBtn = new Button({
				className: 'AddPartNumberFieldButton',
				icon: 'plus-circled',
        styles: {
          'margin-top': '15px'
        },
				attributes: {
					disabled: false,
					'aria-hidden': 'true',
					title: FLWebNLS.addFormula,
				},
				events: {
					onClick: (e) => {
						if(model){
							this.createTypeSelectionModal(model);
						} else {
							Mask.mask(this.contentDiv);
							const url = `${URLHandler.getURL()}
							/resources/v1/modeler/dsfl/metaTypes?tenant=${URLHandler.getTenant()}`
							WAFData.authenticatedRequest(url, {
								 timeout: 250000,
								 method: 'POST',
								 data: JSON.stringify( ["RFLVPMLogicalReference", "VPMReference"]),
								 type: 'json',
								 headers: {
									 'Content-Type': 'application/json',
									 'Accept': 'application/json',
									 'Accept-Language' : widget.lang
								 },
								 onFailure: (result) => {
									 Mask.unmask(this.contentDiv);
									 this.showAlertMsg(FLWebNLS.FailedToGetData, 'error', widget.body)
								 },
								 onComplete: (result) => {
									 const subTypeList = result.Types, /*iconPath = result.iconsPath,*/ curateSubTypeList=[];
									 if(Array.isArray(subTypeList) && subTypeList.length > 0){
										 subTypeList.sort(function(a,b){
					              if (a.NLS.toLowerCase() < b.NLS.toLowerCase()) return 1;
					              if (a.NLS.toLowerCase() > b.NLS.toLowerCase()) return -1;
					              return 0;
					            });
					           subTypeList.sort(function(a,b){
					              if (a.PackageName.toLowerCase() < b.PackageName.toLowerCase()) return 1;
					              if (a.PackageName.toLowerCase() > b.PackageName.toLowerCase()) return -1;
					              return 0;
					            });
					           subTypeList.reverse();

										  var that = this;
						          var subTypeListByPackage = {};
						          var defaultType = null;
						          var prevPackage = null;
						          var currentPackage = null;
						          var root = null;
						          model = new TreeDocument({
						            shouldBeSelected: function(nodeModel){
						              return !nodeModel.options.isPackage;
						            }
						          });
						          var iconPath = null;
						          model.prepareUpdate();
						          var subType = null;
										 for(var i=0; i<subTypeList.length; i++){
						            subType = subTypeList[i];
						           // if (subType.Abstract !== 'True') {
						              currentPackage = subType.PackageName;
						              if(currentPackage && (prevPackage === null || prevPackage !== currentPackage)){
						                  //that.createNode()
						                  if(root !== null){
						                      model.addRoot(root);
						                      root.expandAll();
						                  }
						                  root = new TreeNodeModel({
						                      label: currentPackage,
						                      value : subType.Package,
						                      isPackage : true
						                  });
						                  prevPackage = currentPackage;
						              }
						              //iconPath =  ConfigUtil.getTypeIconUrl(subType.IconName);
						              iconPath =  URLHandler.getURL()+'/snresources/images/icons/small/' + subType.IconName;
						              root.addChild(new TreeNodeModel({
						                  label: subType.NLS,
						                  icons:[iconPath],
						                  isPackage: false,
						                  grid: {
						                    valueItem: subType.Name,
						                  }
						              }));
						         //   }
						          }
											model.pushUpdate();
											this.createTypeSelectionModal(model);
											Mask.unmask(this.contentDiv);
									 }
								 }
							});
						}
					}
				}
			})
      return addBtn;
    },
    createEditBtn: function(){
      const editBtnElem = ParametersLayoutViewUtilities.createActionElements(FLWebNLS.label_edit, false);
      const spanOfEditBtn = editBtnElem[0];
      const editBtn = editBtnElem[1];
      spanOfEditBtn.setStyle("padding", "0px 8px");
      editBtn.addEvent("onClick", (e) => {
				Mask.mask(this.contentDiv);
				const typeName = e.target.closest('tr').getAttribute('type-name');
				var url = `${URLHandler.getURL()}
				/resources/v1/SystemsArchitectureDefinitionParam/getParamArchitectureNumberExpressions?
				tenant=${URLHandler.getTenant()}&flpType=${typeName}`;
				WAFData.authenticatedRequest(url, {
					timeout: 250000,
					method: 'GET',
					// data: JSON.stringify(payloadToSend),
					// type: 'json',
					headers: {
						'Content-Type': 'application/json',
					},
					onFailure: (result) => {
						this.showAlertMsg(FLWebNLS.FailedToGetData, 'error', widget.body)
					},
					onComplete:(result) => {
						const res = JSON.parse(result);
						if(res.ParameterExpressionList && res.ParameterExpressionList.length > 0){
							for(let entry of res.ParameterExpressionList){
								entry.Deployed = 'True';
							}
						} else {
							this.showAlertMsg(FLWebNLS.FailedToGetData, 'error', widget.body)
							return;
						}
						this.collection._models[0]._attributes.ExpressionList = res.ParameterExpressionList;
						this.collection._models[0]._attributes.PhysicalProductAttributes = res.Attribues;
						CompanyIDViewUtilities.argsForUpdatingFormulaHeader = [];
						ParamSAXFormulaModal.showFormulaTable({
		          parent: this.contentDiv,
		          collection: this.collection,
							modelEvent: {
								eventObj:modelEvent,
								name: 'Edit_ExistingSubType_Formula',
								data:{typeName}
							}
		        });
						let argsArray = CompanyIDViewUtilities.argsForUpdatingFormulaHeader;
						if(argsArray && Array.isArray(argsArray) && argsArray.length>0){
							for(let eachArgList of argsArray){
								CompanyIDViewUtilities.updateFormulaTextFields.apply(CompanyIDViewUtilities,eachArgList);
							}
						}
						// document.getElementById('partNumberFormulaMapping').getChildren()[2].innerText = res.anFormat;
						// document.getElementById('partNumberFormulaMapping').getChildren()[2].style.fontSize = '21px';
						Mask.unmask(this.contentDiv);
					}
				});
      })
      return spanOfEditBtn;
    },
		createRemoveBtn: function(){
			const removelts = ParametersLayoutViewUtilities.createActionElements(FLWebNLS.removeField, true);
			const spanOfEditBtn = removelts[0];
      const editBtn = removelts[1];
      spanOfEditBtn.setStyle("padding", "0px 8px");
      return spanOfEditBtn;
		},
		// ShowAddNewFieldPanel: function(attrtbody) {
		// 	this.createPartNumberingDialogBox(attrtbody);
		// 	var isDeployed = ParameterizationFLWebConstants.NEW_NOT_DEPLOYED;
		// },
		createTableHeadCell: function(item,thead,addClass){
      let th = UWA.createElement('th',{
        class: 'formula-list-th',
        styles: {
          'background-color': 'hsl(109deg 38% 94%)',
          padding: '5px'
        },
        html: `<h5>${item.nls}<h5>`
      });
			if(addClass){
				th.addClassName('success');
	      th.addClassName('architectureNumberingField')
			}
      th.inject(thead)
    },
		createTableRow: function(row) {
      let tr = null, td = null, actnTd = null, spanOfEditBtn = null, spanOfRemBtn = null, cols = this.columns;
      tr = UWA.createElement('tr',{
        class: 'formula-list-table-row',
        styles:{
          'border-top': '1px solid hsl(150deg 4% 89%)',
        },
				attributes:{
					'type-name': row.value
				}
      })
      tr.inject(this.table);
      cols.forEach((col) => {
				let colName = Object.keys(col)[0]
        td = UWA.createElement('td',{
          class: 'formula-list-td',
          styles:{
            padding: '5px',
						overflow:'hidden'
          },
					attributes:{
						'cell-col-value': colName
					}
        //  html: row[Object.keys(col)[0]]
        });
				td.innerText = row[colName];
        td.inject(tr)
      });

      actnTd = UWA.createElement('td',{
        class: 'formula-list-td'
      });
      spanOfEditBtn = this.createEditBtn();
      spanOfEditBtn.inject(actnTd);
			spanOfRemBtn = this.createRemoveBtn();
      spanOfRemBtn.inject(actnTd);
      actnTd.inject(tr)
    },
		showAlertMsg: function(msg,status,conatiner){
			const alertOptions = {
					visible: true,
					className: 'param-alert',
					messageClassName: status,
					closable: true,
					renderTo: conatiner,
					autoHide: true,
					hideDelay: 2000
			};
		//	var alert = this.getAlertComponent(alertOptions);
			let alert =  new Alert(alertOptions);
			alert.add({
				message: msg
			});
		}
	});

	return extendedView;
});

define('DS/ParameterizationSkeleton/Views/ParameterizationMSF/MSFGCOMappingView',
		[
			'UWA/Core',
			'DS/UIKIT/Input/Text',
			'DS/UIKIT/Modal',
			'DS/UIKIT/Input/Select',
			'DS/UIKIT/Input/Button',
			'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
			'DS/ParameterizationSkeleton/Views/ParameterizationMSF/MSFGCOMappingViewUtilities',
			'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
			'DS/WAFData/WAFData',
			'i18n!DS/ParameterizationSkeleton/assets/nls/MSFContentMgmtNLS'
			],
			function (UWA,
					Text,
					Modal,
					Select,
					Button,
					ParametersLayoutViewUtilities,
					MSFGCOMappingViewUtilities,
					URLHandler,
					WAFData,
					MSFContentMgmtNLS) {

	'use strict';
	var policyCell, formatCell, policySelectComboBox, formatSelectComboBox;

	var gcoMappingView = {

			initVariable: function() {
				this.cellsIndex = {
						"internalType": 0,
						"experienceType": 1,
						"policy": 2,
						"format": 3,
						"relationship": 4,
						"action": 5,
						"deploy": 6
				};
			},

			ShowMappingModelDialog : function(buttonID, contentDiv) {

				var that = this;

				if(buttonID == "btnCustomTypeMapping")
				{
					var editAttributesModal, modalbodyTable, modaltbody, lineModal,
					modalCellLabel, modalCellValue;

					modalbodyTable =  UWA.createElement('table', {
						'id': 'newEntryTable',
						'class': 'table table-condensed table-hover'
					});
					modaltbody = UWA.createElement('tbody', {
						'class': ''
					}).inject(modalbodyTable);

					//1st row - Internal Type
					lineModal = UWA.createElement('tr').inject(modaltbody);

					modalCellLabel = UWA.createElement('td', {
						'Align' : 'left',
					});
					UWA.createElement('p', {text: MSFContentMgmtNLS.InternalType, 'class': ''}).inject(modalCellLabel);

					modalCellLabel.inject(lineModal);

					modalCellValue = UWA.createElement('td', {
						'Align' : 'left'
					}).inject(lineModal);

					var typesSelectComboBox = this.buildTypeSelect();
					typesSelectComboBox.inject(modalCellValue);

					//2nd row - 3DEXPEREINCE Type
					lineModal = UWA.createElement('tr').inject(modaltbody);

					modalCellLabel = UWA.createElement('td', {
						'Align' : 'left',
					});
					UWA.createElement('p', {text: MSFContentMgmtNLS.ExperienceType, 'class': ''}).inject(modalCellLabel);
					modalCellLabel.inject(lineModal);

					modalCellValue = UWA.createElement('td', {
						'Align' : 'left'
					}).inject(lineModal);

					var enoviaTypeText = new Text({
						placeholder: "",
						attributes: {
							id : "enoviaTypeID",
							value: "",
							multiline: true,
							disabled: true
						},
						events: {
							onChange: function (e) {
								var url = URLHandler.getURL() + "/resources/v1/msfParameterization/getPolicyAssociatedWithType?tenant=" + URLHandler.getTenant() + " &TypeName=" + enoviaTypeText.getValue();
								WAFData.authenticatedRequest(url, {
									timeout: 250000,
									method: 'GET',
									type: 'text',
									headers: {
										'Content-Type': 'text/html'
									},

									onFailure: function (json) {
										console.log("policy retreival failed " + json.message);
									},

									onComplete: function (json) {
										that.buildPolicyNFormatSelectBoxAgain(json, that);
									}
								});
							}
						}
					});
					enoviaTypeText.inject(modalCellValue);

					//3rd row Policy
					lineModal = UWA.createElement('tr').inject(modaltbody);

					modalCellLabel = UWA.createElement('td', {
						'Align' : 'left',
					});
					UWA.createElement('p', {text: MSFContentMgmtNLS.Policy, 'class': ''}).inject(modalCellLabel);

					modalCellLabel.inject(lineModal);

					policyCell = modalCellValue = UWA.createElement('td', {
						'Align' : 'left'
					}).inject(lineModal);

					policySelectComboBox = this.buildPolicySelect([]);
					policySelectComboBox.inject(modalCellValue);

					//4th row Format
					lineModal = UWA.createElement('tr').inject(modaltbody);

					modalCellLabel = UWA.createElement('td', {
						'Align' : 'left',
					});
					UWA.createElement('p', {text: MSFContentMgmtNLS.Format, 'class': ''}).inject(modalCellLabel);

					modalCellLabel.inject(lineModal);

					formatCell = modalCellValue = UWA.createElement('td', {
						'Align' : 'left'
					}).inject(lineModal);

					formatSelectComboBox = this.buildFormatSelect([]);
					formatSelectComboBox.inject(modalCellValue);

					//5th row Relationship
					lineModal = UWA.createElement('tr').inject(modaltbody);

					modalCellLabel = UWA.createElement('td', {
						'Align' : 'left',
					});
					UWA.createElement('p', {text: MSFContentMgmtNLS.RelationshipOptional, 'class': ''}).inject(modalCellLabel);

					modalCellLabel.inject(lineModal);

					modalCellValue = UWA.createElement('td', {
						'Align' : 'left'
					}).inject(lineModal);

					var relationshipText = new Text({
						placeholder: "",
						attributes: {
							id : "relationshipID",
							value: "",
							multiline: false,
							disabled: false
						}
					});
					relationshipText.inject(modalCellValue);


					var OKBtn = new Button({
						value : MSFContentMgmtNLS.Add,
						id    : "modalOKButton",
						className : 'btn primary'
					});

					var CancelBtn = new Button({
						value : MSFContentMgmtNLS.Cancel,
						id    : 'modalCancelButton',
						className : 'btn default'
					});

					OKBtn.addEvent("onClick", function () {
						var internalTypeFieldValue = typesSelectComboBox.getValue()[0];
						var enoviaTypeValue = enoviaTypeText.getValue();
						var policyFieldValue = policySelectComboBox.getValue()[0];
						var formatFieldValue = formatSelectComboBox.getValue()[0];
						var relationshipValue = relationshipText.getValue();

						if(that.checkforduplicate(internalTypeFieldValue, enoviaTypeValue, policyFieldValue, formatFieldValue, relationshipValue))
						{
							MSFGCOMappingViewUtilities.getAlertMessage(MSFContentMgmtNLS.alreadyExists, 'error', contentDiv);
						}
						else if(that.check3DExpTypeEmpty(enoviaTypeValue))
						{
							MSFGCOMappingViewUtilities.getAlertMessage(MSFContentMgmtNLS.EnoviaTypeEmptyMessage, 'error', contentDiv);
						}
						else if(that.checkPolicyEmpty(policyFieldValue))
						{
							MSFGCOMappingViewUtilities.getAlertMessage(MSFContentMgmtNLS.PolicyEmptyMessage, 'error', contentDiv);
						}
						else if(that.checkFormatEmpty(formatFieldValue))
						{
							MSFGCOMappingViewUtilities.getAlertMessage(MSFContentMgmtNLS.FormatEmptyMessage, 'error', contentDiv);
						}
						else {

							var row = that.buildMappingRow(internalTypeFieldValue, enoviaTypeValue, policyFieldValue, formatFieldValue, relationshipValue, "NewNotDeployed");
							row.inject(contentDiv.getElement(".msfgcofamilytable"));
							row["IsDeployed"] = "NewNotDeployed";
							editAttributesModal.hide();
						}
					});
					CancelBtn.addEvent("onClick", function (e) {
						UWA.log(e);
						editAttributesModal.destroy();
					});

					editAttributesModal = new Modal({
						className: 'add-attr-modal',
						closable: true,
						header  : MSFContentMgmtNLS.CustomTypePanelHeader,
						body    : modalbodyTable,
						footer  : [ OKBtn, CancelBtn ]
					}).inject(contentDiv);

					editAttributesModal.show();
				}
			},

			check3DExpTypeEmpty : function (internalTypeFieldValue) {
				return this.validateEnteredValuesNotNull(internalTypeFieldValue);
			},

			checkPolicyEmpty: function (policyFieldValue) {
				return this.validateEnteredValuesNotNull(policyFieldValue);
			},

			checkFormatEmpty: function (formatFieldValue) {
				return this.validateEnteredValuesNotNull(formatFieldValue);
			},

			validateEnteredValuesNotNull : function (userEnteredValue) {

				var isEmpty = false;
				if (userEnteredValue == undefined || userEnteredValue.length === 0 || userEnteredValue === "") {
					isEmpty = true;
				}
				return isEmpty;
			},

			checkforduplicate: function(internalTypeFieldValue, enoviaTypeValue, policyFieldValue, formatFieldValue, relationshipValue) {

				var rowsOfMappedFields = document.querySelectorAll(".customTypeMappingRow");

				var isDuplicate = false;

				for (var k1 = 0; k1 < rowsOfMappedFields.length; k1++) {

					if(internalTypeFieldValue == rowsOfMappedFields[k1].getChildren()[0].getText() &&
							enoviaTypeValue == rowsOfMappedFields[k1].getChildren()[1].getText() &&
							(policyFieldValue == rowsOfMappedFields[k1].getChildren()[2].getText() ||
							formatFieldValue == rowsOfMappedFields[k1].getChildren()[3].getText() ||
							relationshipValue == rowsOfMappedFields[k1].getChildren()[4].getText())) {

						isDuplicate = true;
						break;
					}					
				}
				return isDuplicate;
			},

			buildMappingRow: function (internalTypeFieldValue, enoviaTypeValue, policyFieldValue, formatFieldValue, relationshipValue, isDeployed) {

				var rowInfo = UWA.createElement('tr', {
					'class': 'customTypeMappingRow'
				});

				this.buildTextTableCell('Left', 15, rowInfo, '', internalTypeFieldValue);
				this.buildTextTableCell('Left', 15, rowInfo, '', enoviaTypeValue);
				this.buildTextTableCell('Left', 15, rowInfo, '', policyFieldValue);
				this.buildTextTableCell('Left', 15, rowInfo, '', formatFieldValue);
				this.buildTextTableCell('Left', 15, rowInfo, '', relationshipValue);

				var cell = UWA.createElement('td', {
					'Align': 'center'
				}).inject(rowInfo);

				var removeAttributeButton = MSFGCOMappingViewUtilities.addRemoveButtonToCellRow(cell, rowInfo);

				cell = UWA.createElement('td', {
					"Align": "center"
				}).inject(rowInfo);
				cell.UserOperation = "Add";

				if (isDeployed == "Deployed") {
					var imgSpan = MSFGCOMappingViewUtilities.buildImgSpan('check', '2.5', 'green', MSFContentMgmtNLS.Deployed);
					imgSpan.inject(cell);
				} else if (isDeployed == "NewNotDeployed") {
					var imgSpan = MSFGCOMappingViewUtilities.buildImgSpan('cog', '2.5', 'orange', MSFContentMgmtNLS.Modified);
					imgSpan.inject(cell);
				}

				return rowInfo;
			},			

			buildTableHeadingRow : function() {
				var rowInfo = UWA.createElement('tr', {
					'class': 'success'
				});

				this.buildTextTableCell('Left', 15, rowInfo, 'h5', MSFContentMgmtNLS.InternalType);
				this.buildTextTableCell('Left', 15, rowInfo, 'h5', MSFContentMgmtNLS.ExperienceType);
				this.buildTextTableCell('Left', 15, rowInfo, 'h5', MSFContentMgmtNLS.Policy);
				this.buildTextTableCell('Left', 15, rowInfo, 'h5', MSFContentMgmtNLS.Format);
				this.buildTextTableCell('Left', 15, rowInfo, 'h5', MSFContentMgmtNLS.Relationship);
				this.buildTextTableCell('Left', 15, rowInfo, 'h5', MSFContentMgmtNLS.actions);
				this.buildTextTableCell('Left', 15, rowInfo, 'h5', MSFContentMgmtNLS.deployStatus);

				return rowInfo;
			},

			buildTextTableCell: function (alignment, cellWidth, row, cellFormat, cellText) {

				var cell = UWA.createElement('td', {
					'Align': alignment,
					'width': cellWidth,
					'class': 'customTypeMappingTable'
				}).inject(row);

				if (cellFormat) {
					UWA.createElement(cellFormat, {
						text: cellText
					}).inject(cell);
				} else {
					cell.appendText(cellText);
				}
				return cell;
			},

			buildTypeSelect : function () {
				var typesArray = [];
				typesArray.push({ type: 'msword', length: '' });
				typesArray.push({ type: 'msexcel', length: '' });
				typesArray.push({ type: 'mspowerpoint', length: '' });
				typesArray.push({ type: 'msoutlook', length: '' });
				typesArray.push({ type: 'mswin', length: '' });

				var i, typeID, isOptionSelected,
				listofTypes = typesArray,
				typesSelectComboBox =  new Select({
					nativeSelect: true,
					placeholder: false,
					multiple: false,
					id : "3dexperienceType"
				});

				for (i = 0; i < listofTypes.length; i++) {
					typeID = listofTypes[i].type + listofTypes[i].length;
					isOptionSelected = false;
					if (typeID  === 'msword') {
						isOptionSelected = true;
					}

					typesSelectComboBox.add([{
						label: typeID,
						value: typeID,
						selected: isOptionSelected
					}], false);
				}
				return typesSelectComboBox;
			},

			buildPolicySelect : function (policyArray, that) {

				var i, policyID, isOptionSelected;

				policySelectComboBox =  new Select({
					placeholder: false,
					multiple: false,
					id : "policycombobox",
					events: {
						onChange: function(e) {
							var url = URLHandler.getURL() + "/resources/enoviamsfmodeler/msf/GetFormatsAssociatedWithPolicy?PolicyName=" + this.getValue();
							WAFData.authenticatedRequest(url, {
								timeout: 250000,
								method: 'GET',
								type: 'text',
								headers: {
									'Content-Type': 'text/html'
								},

								onFailure: function (json) {
									console.log("format retreival failed " + json.message);
								},

								onComplete: function (formatjson) {
									var formatArray = [];
									var format = formatjson.split("|");
									for(var i = 0; i < format.length; i++) {
										formatArray.push({ type: format[i] });
									}
									formatSelectComboBox = that.buildFormatSelect(formatArray);
									formatCell.innerHTML = "";
									formatSelectComboBox.inject(formatCell);
								}
							});
						}
					}
				});

				for (i = 0; i < policyArray.length; i++) {
					policyID = policyArray[i].type;
					isOptionSelected = false;

					policySelectComboBox.add([{
						label: policyID,
						value: policyID,
						selected: false
					}], false);
				}
				return policySelectComboBox;
			},

			buildPolicyNFormatSelectBoxAgain: function (json, that) {
				var policyArray = [];
				var policy = json.split("|");

				for(var i = 0; i < policy.length ; i++) {
					policyArray.push({ type: policy[i] });
				}
				policySelectComboBox = that.buildPolicySelect(policyArray, that);
				policyCell.innerHTML = "";
				policySelectComboBox.inject(policyCell);
			},

			buildFormatSelect : function (formatArray) {

				var i, formatID,
				formatSelectComboBox =  new Select({
					placeholder: false,
					multiple: false,
					id : "formatcombobox"
				});

				for (i = 0; i < formatArray.length; i++) {
					formatID = formatArray[i].type;

					formatSelectComboBox.add([{
						label: formatID,
						value: formatID,
						selected: false
					}], false);
				}
				return formatSelectComboBox;
			}
	};
	gcoMappingView.initVariable();
	return gcoMappingView;

});

define('DS/ParameterizationSkeleton/Views/ParameterizationMSF/MSFGCOConfigurationLayoutView', [
	'UWA/Core',
	'UWA/Class/View',
	'DS/UIKIT/Mask',
	'DS/UIKIT/Scroller',
	'DS/UIKIT/Input/Text',
	'DS/UIKIT/Popover',
	'DS/UIKIT/Modal',
	'DS/UIKIT/Input/Select',
	'DS/WAFData/WAFData',
	'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
	'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
	'DS/UIKIT/Input/Button',
	'DS/ParameterizationSkeleton/Views/ParametersLayoutView',
	'DS/ParameterizationSkeleton/Views/ParameterizationMSF/MSFGCOMappingView',
	'DS/ParameterizationSkeleton/Views/ParameterizationMSF/MSFGCOMappingViewUtilities',
	'i18n!DS/ParameterizationSkeleton/assets/nls/MSFContentMgmtNLS'
	],
	function (UWA,
			View,
			Mask,
			Scroller,
			Text,
			Popover,
			Modal,
			Select,
			WAFData,
			URLHandler,
			ParametersLayoutViewUtilities,
			Button,
			ParametersLayoutView,
			MSFGCOMappingView,
			MSFGCOMappingViewUtilities,
			MSFContentMgmtNLS) {

	'use strict';

	var extendedView;

	extendedView = View.extend({
		tagName: 'div',
		className: 'generic-detail',

		init: function (options) {
			options = UWA.clone(options || {}, false);
			this._parent(options);

			this.options = options;
			this.contentDiv = null;
			this.paramScroller = null;
			this.paramBasicScroller = null;
			this.controlDiv = null;
		},

		setup: function (options) {
			UWA.log('MSFGCOConfiguration Layout::setup!');
			UWA.log(options);
		},

		render: function () {
			UWA.log("MSFGCOConfiguration LayoutView::render");
			var introDiv,
			that = this;

			this.contentDiv = UWA.createElement('div', {
				'id': 'typeMainDiv'
			});

			introDiv = UWA.createElement('div', {
				'class': 'information'
			}).inject(this.contentDiv);

			UWA.createElement('p', {
				text: MSFContentMgmtNLS.intro
			}).inject(introDiv);

			this.parentView = new ParametersLayoutView(this.options);

			this.controlDiv = ParametersLayoutViewUtilities.createApplyResetToolbar.call(this, this.contentDiv, true,
					this.applyParams.bind(this), this.resetParams.bind(this));

			this.container.setContent(this.contentDiv);
			this.listenTo(this.collection, {
				onSync: that.onCompleteRequestMapping
			});

			return this;
		},

		onCompleteRequestMapping: function () {

			var that = this;
			UWA.log('MSFGCOConfigurationLayoutView :: onCompleteRequestMapping!');

			var collection = this.collection._models[0]._attributes;
			var fields = collection.ExpressionList;
			var nosOfFields = (fields) ? fields.length : 0;

			this.paramsDIV = UWA.createElement('div', {
				'class': 'customTypeDivScroll',
			}).inject(this.contentDiv);

			this.baseAccordion = ParametersLayoutViewUtilities.createFamilyUIKITAccordion(this.paramsDIV);

			var gcoParentDiv = UWA.createElement('div', {
				'class': 'customTypeParentDiv'
			});

			var gcoContentDiv = UWA.createElement('div', {
				'class': 'customTypeContentDiv'
			});

			var customTypeTableContent = this.buildTableContent();
			customTypeTableContent.inject(gcoContentDiv);

			var addMappingButton = new Button({
				className: 'AddFieldButton',
				icon: 'plus-circled',
				attributes: {
					id : 'btnCustomTypeMapping',
					disabled: false,
					'aria-hidden': 'true',
					title: MSFContentMgmtNLS.AddMappingTooltip,
				},
				events: {
					onClick: function (e) {
						MSFGCOMappingView.ShowMappingModelDialog('btnCustomTypeMapping', that.contentDiv);
					}
				}
			}).inject(gcoContentDiv); 

			gcoParentDiv.appendChild(gcoContentDiv);

			this.baseAccordion.addItem({
				title: MSFContentMgmtNLS.CustomTypeTitle,
				content: gcoParentDiv,
				selected: true,
				name: "gcoconfig",
			});

			gcoContentDiv.appendChild(this.controlDiv);

			//If tab is changed then show the deployed rows
			for (var i = 0; i < nosOfFields; i++) {
				var field = fields[i];
				var deployedStatus = (field.Deployed && field.Deployed == "True") ? "Deployed" : "NewNotDeployed";
				var rowInfo = MSFGCOMappingView.buildMappingRow(field.InternalType, field.OfficeType, field.Policy,
						field.Format, field.Relationship, deployedStatus);
				rowInfo.IsDeployed = deployedStatus;
				rowInfo.inject(that.contentDiv.getElement(".msfgcofamilytable"));
			}

			this.paramScroller = new Scroller({
				element: gcoContentDiv
			}).inject(gcoParentDiv);

			this.getOtherDomainDetails();
			Mask.unmask(this.contentDiv);
		},

		buildTableContent : function() {

			var that = this;
			var familyTable, ftbody;

			familyTable = UWA.createElement('table', {
				'class': 'table table-hover',
				'table-layout': 'fixed', 
				class: 'msfgcofamilytable table table-condensed'
			});

			ftbody =  UWA.createElement('tbody', {
				'class': 'fparamtbody',
				'id': 'msfgcofamilytablebody'
			}).inject(familyTable);

			var fieldRow = MSFGCOMappingView.buildTableHeadingRow();
			fieldRow.inject(ftbody);
			return familyTable;
		},

		getOtherDomainDetails: function () {
			var that = this;
			var url = URLHandler.getURL() + "/resources/ParamWS/access/DomainElements?tenant=" + URLHandler.getTenant() + "&domainid=MSFConfigurationParameterization";
			WAFData.authenticatedRequest(url, {
				timeout: 250000,
				method: 'GET',
				type: 'json',

				headers: {
					'Content-Type': 'application/json',
					'Accept': 'application/json',
					'Accept-Language' : widget.lang
				},

				onFailure: function (result) {
					Mask.unmask(that.contentDiv);
					MSFGCOMappingViewUtilities.getAlertMessage(MSFContentMgmtNLS.BasicParamError, 'error', this.contentDiv);
				},

				onComplete: function (result) {
					var familyArray = [];

					result.family.forEach(function(family) {
						familyArray.push(family);
					});

					that.loadOtherDomainDetails(familyArray);
				}
			}); 
		},

		loadOtherDomainDetails: function (result) {
			var that = this;
			try{
				that.divBasicConfig = UWA.createElement('div', {
					'class': 'basicDivScroll'
				}).inject(that.contentDiv);
				that.altSubAccordean = ParametersLayoutViewUtilities.createFamilyUIKITAccordion(that.paramsDIV);

				var basicConfigParentDiv = UWA.createElement('div', {
					'class': 'basicParentDiv'
				});
				var basicConfigDiv = UWA.createElement('div', {
					'class': 'basicConfigDiv'
				});
				basicConfigParentDiv.appendChild(basicConfigDiv);
				that.model.set("introduction", "");

				that.parentView = that._updateParentViewWithNewDomain(that.parentView,"MSFConfigurationParameterization");

				that.parentView.render();
				that.collection._models[0]._attributes.family = result;
				that.parentView.onCompleteRequestParameters();

				that.altSubAccordean.addItem({
					title: MSFContentMgmtNLS.BasicDomainTitle,
					content: basicConfigParentDiv,
					selected: true,
					name: result.nlsKey
				});

				basicConfigDiv.appendChild(that.parentView.contentDiv);

				paramBasicScroller = new Scroller({
					element: basicConfigDiv
				}).inject(basicConfigParentDiv);
			}	catch(error) {
			}
		},

		_updateParentViewWithNewDomain : function(view, domainId){
			view.options.domainid = domainId;
			view.model.id = domainId;
			view.model._attributes.domainid = domainId;
			view.model._attributes.id = domainId;
			return view;
		},

		applyParams: function () {
			var that = this;
			var rowsOfMappedFields = this.contentDiv.getElementsByClassName("customTypeMappingRow");
			var payloadToSend = {};
			Mask.mask(this.contentDiv);
			payloadToSend.ExpressionList = [];
			for (var i = 0; i < rowsOfMappedFields.length; i++) {
				if (rowsOfMappedFields[i].IsDeployed == "NewNotDeployed") {
					var value = MSFGCOMappingViewUtilities.buildJsonObjectFromTableRow(rowsOfMappedFields[i]);
					payloadToSend.ExpressionList.push(value);
				}
			}

			var url = URLHandler.getURL() + "/resources/v1/msfParameterization/setCustomTypeMappings?tenant=" + URLHandler.getTenant();
			WAFData.authenticatedRequest(url, {
				timeout: 250000,
				method: 'POST',
				data: JSON.stringify(payloadToSend),
				type: 'json',
				headers: {
					'Content-Type': 'application/json',
					'Accept': 'application/json'
				},

				onFailure: function (json) {
					Mask.unmask(that.contentDiv);
					MSFGCOMappingViewUtilities.getAlertMessage(MSFContentMgmtNLS.ApplyError, 'error', that.contentDiv);
				},

				onComplete: function (json) {
					Mask.unmask(that.contentDiv);
					if (json.Action == "Success") {
						that.onApplySuccess();
						MSFGCOMappingViewUtilities.getAlertMessage(MSFContentMgmtNLS.ApplySuccess, 'success', that.contentDiv);
					} else {
						MSFGCOMappingViewUtilities.getAlertMessage(json.message, 'error', that.contentDiv);
					}
				}
			});
		},

		resetParams: function () {
			this.onResetSuccess();
			Mask.unmask(this.contentDiv);
			MSFGCOMappingViewUtilities.getAlertMessage(MSFContentMgmtNLS.ResetSuccess, 'success', this.contentDiv);
		},

		onApplySuccess: function () {

			var fieldsToBeRemoved = new Array();

			var rowsOfMappedFields = this.contentDiv.getElementsByClassName("customTypeMappingRow");
			for (var i = 0; i < rowsOfMappedFields.length; i++) {
				if (rowsOfMappedFields[i].IsDeployed == "NewNotDeployed") {
					var statusCell = rowsOfMappedFields[i].cells[6];
					if (statusCell.UserOperation == "Add") {
						rowsOfMappedFields[i].cells[6].empty();
						rowsOfMappedFields[i].IsDeployed = "Deployed";
						var imgSpan = MSFGCOMappingViewUtilities.buildImgSpan('check', '1.5', 'green', MSFContentMgmtNLS.Deployed);
						imgSpan.inject(rowsOfMappedFields[i].cells[6]);
					}
					if (rowsOfMappedFields[i].cells[6].UserOperation == "Remove") {
						fieldsToBeRemoved.push(rowsOfMappedFields[i]);
					}
				}
			}

			fieldsToBeRemoved.forEach(function (attrMapping) {
				attrMapping.remove();
			});
		},

		onResetSuccess: function (json) {

			var that = this;
			var fieldsToBeRemoved = new Array();
			var rowsOfMappedFields = this.contentDiv.getElementsByClassName("customTypeMappingRow");
			for (var i = 0; i < rowsOfMappedFields.length; i++) {
				if (rowsOfMappedFields[i].IsDeployed == "NewNotDeployed") {
					fieldsToBeRemoved.push(MSFGCOMappingViewUtilities.resetForFieldLineChanges(rowsOfMappedFields[i]));
				}
			}
			fieldsToBeRemoved.forEach(function (attrMapping) {
				if (attrMapping) {
					attrMapping.remove();
				}
			});
		},

		destroy: function () {
			this.stopListening();
			this._parent.apply(this, arguments);
		}
	});

	return extendedView;
});

/**
* @quickreview  KB9 21:11:09
*/

define('DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationTreeListView',
[
  'UWA/Class',
  'DS/Controls/Button',
  'DS/Controls/Label',
  'DS/Controls/ComboBox',
  'DS/TreeModel/TreeDocument',
  'DS/TreeModel/TreeNodeModel',
  'DS/DataGridView/DataGridView',
  'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationTreeListViewConstants',
  'i18n!DS/ParameterizationSkeleton/assets/nls/DELConfigurationTreeListView',
  'css!DS/ParameterizationSkeleton/assets/css/DELConfigurationTreeListView.css'
],
function
(
  Class,
  WUXButton,
  WUXLabel,
  WUXComboBox,
  TreeDocument,
  TreeNodeModel,
  DataGridView,
  DELConfigurationTreeListViewConstants,
  DELConfigurationTreeListViewNls
)
{
  'use strict';

  var DELConfigurationTreeListView = Class.extend({

    _nls : null,

    /*
    * init
    */
    init : function init(options)
    {
       var that = this;
       that._nls = options.nls;
       that._paramID = options.paramid;

       var colLabelsNls = options.nls;

       that._columnsIDs = [];
       that._columnsVisibilityStatus = [];
       that._columnsCellSemantics = [];

       var columns = options.columns;
       var colLength = columns.length;
       for (var i=0;i<colLength;i++)
       {
        that._columnsIDs.push(columns[i].id);
        that._columnsCellSemantics.push(columns[i].onCellSemantics);
        that._columnsVisibilityStatus.push(columns[i].hidden);
      }

       that._treeListViewConstants = new DELConfigurationTreeListViewConstants();
       that._treeListViewConstants.setColumnsIndex(that._columnsIDs);
       that._treeListViewConstants.setColumnsNameNls(colLabelsNls);
       that._treeListViewConstants.setColumnsVisibilityStatus(that._columnsVisibilityStatus);
    },

    /*
    * buildColumns
    */
    buildColumns : function buildColumns(ldata)
    {
      var that = this;
      var index = that._treeListViewConstants.getColumnsIndex().indexOf(ldata.dataIndex);
      if (that._treeListViewConstants.getColumnsVisibilityStatus()[index] != undefined || that._treeListViewConstants.getColumnsVisibilityStatus()[index] != null)
        ldata.visibleFlag  = !(that._treeListViewConstants.getColumnsVisibilityStatus()[index]);

      if (ldata.dataIndex === "isDeployed" || ldata.dataIndex === "edit" || ldata.dataIndex === "delete")
      {
          ldata.alwaysVisibleFlag = true;

          ldata.alignment = 'center';
          ldata.width = '50';
          if (ldata.dataIndex === "delete")
          {
            ldata.typeRepresentation = "delete";
            //ldata.onCellRequest = that.onDeleteCellRequestValue.bind(that);
            ldata.getCellTooltip = that.getCellTooltip.bind(that);
          }

          if (ldata.dataIndex === "edit")
          {
            ldata.typeRepresentation = "edit";
            //ldata.onCellRequest = that.onEditCellRequestValue.bind(that);
            ldata.getCellTooltip = that.getCellTooltip.bind(that);
          }

          if (ldata.dataIndex === "isDeployed")
          {
            ldata.width = '150';
            ldata.alignment = 'center';
            ldata.getCellTypeRepresentation = function (iCellInfos) {
             if (iCellInfos.nodeModel) {
               if (iCellInfos.nodeModel.options.grid.isDeployed === true)
                 return 'isDeployed';
               else
                 return 'notDeployed';
             }
           };
           //ldata.onCellRequest = that.onIsDeployedCellRequestValue.bind(that);
           //ldata.getCellTooltip = that.getCellTooltip.bind(that);
           ldata.getCellTooltip = function(iCellInfos)
           {
              if (iCellInfos.nodeModel != undefined && iCellInfos.nodeModel.options.grid.isDeployed === true)
              {
                return {
                  shortHelp : DELConfigurationTreeListViewNls.Applied
                };
              }
           }
         }
       }
       else
       {

         if (that._columnsCellSemantics[index] != undefined || that._columnsCellSemantics[index] != null)
         {
           ldata.editableFlag = true;
           ldata.typeRepresentation = 'string';
           ldata.editionPolicy ='EditionOnOver';
           //ldata.onCellRequest = that.onIsDeployedCellRequestValue.bind(that);
           ldata.getCellSemantics = that._columnsCellSemantics[index];
         }
         else {
           if(ldata.type === "checkbox"){
             ldata.width = '150';
             ldata.alignment = 'center';
             ldata.typeRepresentation = 'checkboxoff';
             ldata.getCellTypeRepresentation = function (iCellInfos) {
               if(iCellInfos.cellModel === true)
               return 'checkboxon';
               else
               return 'checkboxoff';
             };
           }
         }
       }
    },


    /*
    * buildView
    */
     buildView : function buildView(options)
     {
        var that = this;

        var columns = options.columns;
        var colLabelsNls = options.nls;
        var data = options.data;

        var cols = [];
        var columnsLength = that._treeListViewConstants.getColumnsIndex().length;
        for (var i=0;i<columnsLength;i++)
        {
          var ldata = {};

          ldata.editableFlag = false;
          ldata.sortableFlag = true;
          ldata.resizableFlag = true;

          if (columns[i] != null && columns[i].mandatory != null && columns[i].mandatory === true)
            ldata.alwaysVisibleFlag = true;
          if (columns[i] != null && columns[i].sortable != null && columns[i].sortable === false)
            ldata.sortableFlag = false;

          ldata.dataIndex = that._treeListViewConstants.getColumnsIndex()[i];
          ldata.text = that._treeListViewConstants.getColumnsName()[i];
          if(columns[i] != null)
            ldata.type = columns[i].type;


          //var shortHelp = that._nls[ldata.dataIndex];
          that.buildColumns(ldata);
          cols.push(ldata);
        }


       // Create the model for the DataGridView
       this.model = new TreeDocument();

       this.dataGridView = new DataGridView({
         identifier : "DELDatagridviewparam_" + that._paramID,
         treeDocument: this.model,
         columns: cols,
         filterViewOptions: { maxAppliedFilterCount: 1 }, // Filter for datagrid implemented to address IR-1333786 - FUN143441_UX_Issue: Filter is not supported in the Units of measures and parameters domain data grid table view.
       });

       let columnsHeader = [];

       for(var k=0;k<this.dataGridView.columns.length;k++){
        columnsHeader.push(this.dataGridView.columns[k].dataIndex);
          if(options.columns[k] && this.dataGridView.columns[k].dataIndex !== "delete" && this.dataGridView.columns[k].dataIndex !== "edit")
            this.model.getFilterManager().setPropertyFilterModel(this.dataGridView.columns[k].dataIndex, { 
            filterId: 'string',
          })
       }

       //this.setReusablecontent();
       this.setTypeRepresentation();

       this.dataGridView.getContent().style.top = null;
       this.dataGridView.getContent().style.bottom = null;
       this.dataGridView.getContent().style.height = "300px";
       this.dataGridView.getContent().style.position = "relative";
       //this.dataGridView.getContent().style.width = "92%"

       /*this.dataGridView.addEventListener('change', function(e, cellInfos) {
         console.log(" RowID: " + cellInfos.rowID );
       });*/
       return this.dataGridView;
    },


    /*
    * getCellTooltip
    */
    getCellTooltip : function getCellTooltip(iCellInfos)
    {
      var that = this;
      if (iCellInfos.nodeModel) {
          return {
            shortHelp : that._treeListViewConstants.getColumnsName()[iCellInfos.columnID]
          };
      }
    },

    /*onIsDeployedCellRequestValue : function onIsDeployedCellRequestValue(iCellInfos)
    {
      if (iCellInfos.nodeModel.options.grid.isDeployed === true)
      {
        var reusableContent = iCellInfos.cellView.reuseCellContent('reusableIsDeployed');
        reusableContent = iCellInfos.cellView.collectionView.reuseCellContent('reusableIsDeployed');
        iCellInfos.cellView.getContent().setContent(reusableContent);
      }
    },*/

     /*onEditCellRequestValue : function onEditCellRequestValue(iCellInfos)
     {
       var reusableContent = iCellInfos.cellView.reuseCellContent('reusableEdit');
       reusableContent = iCellInfos.cellView.collectionView.reuseCellContent('reusableEdit');
       iCellInfos.cellView.getContent().setContent(reusableContent);
     },

     onDeleteCellRequestValue : function onDeleteCellRequestValue(iCellInfos)
     {
       var reusableContent = iCellInfos.cellView.reuseCellContent('reusableDelete');
       reusableContent = iCellInfos.cellView.collectionView.reuseCellContent('reusableDelete');
       iCellInfos.cellView.getContent().setContent(reusableContent);
     },*/

     /*
     * setTypeRepresentation
     */
     setTypeRepresentation : function setTypeRepresentation(customTypeRep)
     {
       var that = this;

       /*var customTypeRep = {
         checkboxon: {
            stdTemplate: 'functionIcon',
            semantics: {
              icon: {
                iconName: 'checkbox-on',
                fontIconFamily: WUXManagedFontIcons.Font3DS
              }
            }
          },
          checkboxoff: {
             stdTemplate: 'functionIcon',
             semantics: {
               icon: {
                 iconName: 'checkbox-off',
                 fontIconFamily: WUXManagedFontIcons.Font3DS
               }
             }
           }
        };*/

       var typeReps = {
          delete: {
            stdTemplate: 'functionIcon',
            semantics: {
              icon: {
                iconName: 'trash',
                fontIconFamily: WUXManagedFontIcons.Font3DS
              }
            }
          },
          edit: {
            stdTemplate: 'functionIcon',
            semantics: {
              icon: {
                iconName: 'pencil',
                fontIconFamily: WUXManagedFontIcons.Font3DS
              }
            }
          },
          isDeployed: {
            stdTemplate: 'functionIcon',
            semantics: {
              icon: {
                iconName: 'check',
                fontIconFamily: WUXManagedFontIcons.Font3DS
              }
            }
          },
          notDeployed: {
            stdTemplate: 'functionIcon',
            semantics: {
              icon: {
                iconName: 'cog',// 'close',
                fontIconFamily: WUXManagedFontIcons.Font3DS
              }
            }
          },
          checkboxon: {
            stdTemplate: 'functionIcon',
            semantics: {
              icon: {
                iconName: 'check',
                fontIconFamily: WUXManagedFontIcons.Font3DS
              }
            }
          },
          checkboxoff: {
            stdTemplate: 'functionIcon',
            semantics: {
              icon: {
                iconName: 'wrong',
                fontIconFamily: WUXManagedFontIcons.Font3DS
              },
              color: '#e2e4e3'
            }
          }
				};

        typeReps = Object.assign(typeReps, customTypeRep);
        this.dataGridView.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(typeReps));
     },

     /*setReusablecontent: function setReusablecontent()
     {
         var that = this;

         //-- registering custom cell contents --
          that.dataGridView.registerReusableCellContent({
             id: 'reusableIsDeployed',
             buildContent: function () {
               var myDeleteButton = new WUXComboBox({
                elementsList: ["Julien", "David", "Alexandre", "Cyrielle", "Blandine"]
             	});
               myDeleteButton.getContent().addEventListener('onChange', function(data){
                    console.log("clickclick myDeleteButton" + data);
               });
               return myDeleteButton;
             }
         });
      },*/

      /*setReusablecontent: function setReusablecontent()
      {
          var that = this;

          //-- registering custom cell contents --
           that.dataGridView.registerReusableCellContent({
              id: 'reusableEdit',
              buildContent: function () {
                var myEditButton = new WUXButton({ icon: { iconName: "pencil", fontIconFamily: WUXManagedFontIcons.Font3DS } })
                myEditButton.getContent().addEventListener('buttonclick', function(data){
                     console.log("clickclick myEditButton" + data);
                });
                return myEditButton;
              }
          });

          that.dataGridView.registerReusableCellContent({
              id: 'reusableDelete',
              buildContent: function () {
                var myDeleteButton = new WUXButton({ icon: { iconName: "trash", fontIconFamily: WUXManagedFontIcons.Font3DS } })
                myDeleteButton.getContent().addEventListener('buttonclick', function(data){
                     console.log("clickclick myDeleteButton" + data);
                });
                return myDeleteButton;
              }
          });
      },*/

      /*
      * addChild
      */
     addChild : function addChild(nodeData)
     {
       var that = this;
       this.model.prepareUpdate();

       var nodeDataLength = nodeData.length;
       for (var i=0;i<nodeDataLength;i++)
       {
         var nodeKeysTMP = Object.keys(nodeData[i]);
         if (nodeKeysTMP.length)
         {
           for (var k=0;k<nodeKeysTMP.length;k++)
           {
             var keys = nodeKeysTMP[k];
             if (keys)
             {
               for (var m=0;m<that.dataGridView.columns.length;m++)
               {
                 if (that.dataGridView.columns[m].dataIndex === keys)
                  that.dataGridView.columns[m].visibleFlag = true;
              }
             }
           }
         }

         this.model.addChild(nodeData[i]);
      }

       this.model.expandAll();
       this.model.pushUpdate();
     }
  });


  return DELConfigurationTreeListView;
});

define('DS/ParameterizationSkeleton/Views/ParameterizationXEngineering/ParamXENGResetModel',
	[
		'DS/UIKIT/Input/Toggle',
		"DS/Controls/Button",
		"DS/Windows/ImmersiveFrame",
		"DS/Windows/Dialog",
		'DS/WAFData/WAFData',
		'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
		'DS/UIKIT/Alert',
		'DS/ParameterizationSkeleton/Views/ParameterizationXEngineering/ParameterizationXEngineerConstants',
		'i18n!DS/ParameterizationSkeleton/assets/nls/XEngineeringNLS'
	],
	function (
		Toggle,
		WUXButton,
		ImmersiveFrame,
		Dialog,
		WAFData,
		URLHandler,
		Alert,
		ParameterizationXEngineerConstants,
		XEngineeringNLS) {

	'use strict';

	function ParamXENGResetModel() {}

    ParamXENGResetModel.prototype.CELLS_INDEX = ParameterizationXEngineerConstants.CELLS_INDEX;

	//Reset Counters Dialog -Start
	ParamXENGResetModel.prototype.buildResetCounterCheckBox = function (_dynamicFormatContent,expressionList) {
		var that = this;
        this.expressionList = expressionList;
		
		//Fix for 	IR-1323136-3DEXPERIENCER2025x
		if(expressionList[ParameterizationXEngineerConstants.FORMAT_COUNTER][0].value != ParameterizationXEngineerConstants.DEPOLOYED){
			return;
		}
	
		var divTag = document.createElement('div');
		divTag.className = "formats-reset-Counter";

		var labelMainDiv = document.createElement('div');
		labelMainDiv.className = "formats-reset-label";

		var labelText = document.createElement('span');
		labelText.className = 'label-text'; 

		labelMainDiv.appendChild(labelText);
				
		var resetCounterDiv = document.createElement('div');
		resetCounterDiv.className = "formats-reset-Counter-value";

		var resetCounterButton = new WUXButton({
			label: XEngineeringNLS.resetCounter,
			displayStyle: "lite"
		});


		resetCounterButton.domId = "reset-Counter-button";
		this.partNumberResetCounterStartingValue = resetCounterButton;
		this.partNumberResetCounterStartingValue.id = resetCounterButton.id + "_link";
		this.partNumberResetCounterStartingValue.inject(resetCounterDiv);

		this.partNumberResetCounterStartingValue.addEventListener('click', function () {
			that.buildResetCounterDialog();
		})

		
		divTag.appendChild(labelMainDiv);
		divTag.appendChild(resetCounterDiv);

		_dynamicFormatContent.appendChild(divTag);
		return _dynamicFormatContent;
	};

	ParamXENGResetModel.prototype.buildResetCounterDialog = function () {
		var that = this;
		
		let validContainer = (document.getElementsByClassName("part-number-edit-modal modal modal-root").length > 0) ? document.getElementsByClassName("part-number-edit-modal modal modal-root") : document.getElementsByClassName("part-number-modal modal modal-root");
		let container;
		for (let content in validContainer) {
			if (!validContainer[content].isHidden()) {
				container = validContainer[content];
				break;
			}
		}

		var immersiveFrame = new ImmersiveFrame();
		immersiveFrame.inject(container);

		that.resetCounterDialog = new Dialog({
			title: XEngineeringNLS.get("ResetCounterStartingValueHeader"),
			content: that.buildResetCounterDialogContent(),
			immersiveFrame: immersiveFrame,
			resizableFlag: true,
			width: 450,
			height: 170,
			modalFlag: true,
			closeButtonFlag: false,
			domId: "ResetPopup",
			touchMode: true,
			buttons: {
				Ok: new WUXButton({
					label: XEngineeringNLS.get("apply"),
					domId: "OK_Button",
					onClick: function (e) {
						that.resetCountersDBChanges();
					},
					disabled: true
				}),
				Cancel: new WUXButton({
					label: XEngineeringNLS.get("cancel"),
					domId: "Cancel_Button",
					onClick: function (e) {
						that.resetCounterDialog.immersiveFrame.getModel().destroy();
					}
				})
			}
		});

	};

	ParamXENGResetModel.prototype.convertCounterFieldToJsonObject =  function (fieldInfo) {
		var type = fieldInfo.cells[this.CELLS_INDEX.type].value;
		var value = fieldInfo.cells[this.CELLS_INDEX.value].getText();
		if (ParameterizationXEngineerConstants.FORMAT_ATTRIBUTE == type) {
			value = fieldInfo.cells[this.CELLS_INDEX.value].value;
		}
		var obj = {};

		obj[ParameterizationXEngineerConstants.OPERATION] = ParameterizationXEngineerConstants.MODIFY;
		obj[ParameterizationXEngineerConstants.NAME] = fieldInfo.cells[this.CELLS_INDEX.name].getText();
		obj[ParameterizationXEngineerConstants.TYPE] = fieldInfo.cells[this.CELLS_INDEX.type].value;
		obj[ParameterizationXEngineerConstants.VALUE] = value;
		obj[ParameterizationXEngineerConstants.ORDER] = fieldInfo.cells[this.CELLS_INDEX.order].getText();
		obj[ParameterizationXEngineerConstants.ATTRIBUTE] = fieldInfo.cells[this.CELLS_INDEX.value][ParameterizationXEngineerConstants.ATTRIBUTE];
		obj[ParameterizationXEngineerConstants.REGEX] = fieldInfo.cells[this.CELLS_INDEX.value][ParameterizationXEngineerConstants.REGEX];
		obj[ParameterizationXEngineerConstants.COUNTER] = fieldInfo.cells[this.CELLS_INDEX.value][ParameterizationXEngineerConstants.COUNTER];
		obj[ParameterizationXEngineerConstants.COUNTER_UNICITY] = fieldInfo.cells[this.CELLS_INDEX.counterUnicityIndex].value;
		obj[ParameterizationXEngineerConstants.UPDATE_HIGHEST_COUNTER] = (fieldInfo.cells[this.CELLS_INDEX.counterUnicityIndex].updateHighestCounterValue) ? fieldInfo.cells[this.CELLS_INDEX.counterUnicityIndex].updateHighestCounterValue : false;
		obj[ParameterizationXEngineerConstants.RESET_COUNTER] = (fieldInfo.cells[this.CELLS_INDEX.counterUnicityIndex][ParameterizationXEngineerConstants.RESET_COUNTER]) ? fieldInfo.cells[this.CELLS_INDEX.counterUnicityIndex][ParameterizationXEngineerConstants.RESET_COUNTER] : false;
		obj[ParameterizationXEngineerConstants.COUNTER_STARTING_VALUES] = (fieldInfo.cells[this.CELLS_INDEX.counterUnicityIndex][ParameterizationXEngineerConstants.COUNTER_STARTING_VALUES]) ? fieldInfo.cells[this.CELLS_INDEX.counterUnicityIndex][ParameterizationXEngineerConstants.COUNTER_STARTING_VALUES] : "";
		return obj;

	};

	ParamXENGResetModel.prototype.resetCountersDBChanges = function(){

		let that = this;

        let validContainer = document.getElementsByClassName('enox-part-number-content');

		let existingCounterToJson = that.convertCounterFieldToJsonObject(that.expressionList[ParameterizationXEngineerConstants.FORMAT_COUNTER][0]);

		existingCounterToJson.ResetAllCountersToStartingCounterValue = true;

		let payloadToSend = {
			"ExpressionList": [existingCounterToJson]
		}

		let url = URLHandler.getURL() + "/resources/v1/xENGParameterization/setAdminPartNumberProperties?tenant=" + URLHandler.getTenant();
				WAFData.authenticatedRequest(url, {
					timeout: 250000,
					method: 'POST',
					data: JSON.stringify(payloadToSend),
					type: 'json',

					headers: {
						'Content-Type': 'application/json',
						'Accept': 'application/json'
					},

					onFailure: function (json) {
						that.displayAlertMessage(json.message,validContainer,'error')
						that.resetCounterDialog.immersiveFrame.getModel().destroy();
					},

					onComplete: function (json) {
						if (json.Action == "Success") {
							that.displayAlertMessage(XEngineeringNLS.get("resetCounter.sucess.message"),validContainer,'success')
							that.resetCounterDialog.immersiveFrame.getModel().destroy();
						} else {
							that.displayAlertMessage(json.message,validContainer,'error')
							that.resetCounterDialog.immersiveFrame.getModel().destroy();
						}
					}

				});
	};

    ParamXENGResetModel.prototype.displayAlertMessage = function (messageToDisplay, toDisplayOver,className) {
		var alertOptions = {
			visible: true,
			className: 'param-alert',
			messageClassName: className,
			closable: true,
			renderTo: toDisplayOver[0],
			autoHide: true,
			hideDelay: 2000
		};
		var alert = this.getAlertComponent(alertOptions);

		alert.add({
			message: messageToDisplay
		});

	};

    ParamXENGResetModel.prototype.getAlertComponent = function (alertOptions) {

		this.alert = new Alert(alertOptions);
		return this.alert;
	};

	ParamXENGResetModel.prototype.buildResetCounterDialogContent = function () {
		var that = this;
		let _counterPopupContainer = UWA.createElement('div', {
				'class': "enox-part-number-attribute-reset-Counter"
			}); 

			let divTag = document.createElement('div');
			divTag.className = "part-Number-reset-Counter";

			var labelDiv = document.createElement('div');
			labelDiv.className = "part-Number-reset-Counter-text";

			that.resetConfirmCheckbox = new Toggle({ type: "checkbox", label: XEngineeringNLS.get("resetcounterMessage")});
			that.resetConfirmCheckbox.inject(labelDiv);

			that.resetConfirmCheckbox.onChange = function(e){
				if(that.resetConfirmCheckbox.isChecked()){
					that.resetCounterDialog.buttons['Ok'].disabled = false;
				}else{
					that.resetCounterDialog.buttons['Ok'].disabled = true;
				}
			};

			divTag.appendChild(labelDiv);

		_counterPopupContainer.appendChild(divTag);

		return _counterPopupContainer;
	};
	//Reset Counters Dialog -END
	return ParamXENGResetModel;
});

define('DS/ParameterizationSkeleton/Views/ParameterizationXEngineering/XENGModal',
	[
		'DS/UIKIT/Modal',
		'UWA/Core',
		'DS/UIKIT/Input/Toggle',
		'DS/Utilities/TouchUtils',
		"DS/Controls/ComboBox",
		"DS/Controls/Popup",
		"DS/Controls/Button",
		"DS/Windows/ImmersiveFrame",
		"DS/Windows/Dialog",
		'DS/UIKIT/Input/Select',
		'DS/UIKIT/Input/Text',
		'DS/UIKIT/Input/Number',
		'DS/UIKIT/Alert',
		'DS/UIKIT/Tooltip',
		'DS/WAFData/WAFData',
		'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
		'DS/ParameterizationSkeleton/Views/ParameterizationXEngineering/ParameterizationXEngineerConstants',
		'DS/ParameterizationSkeleton/Views/ParameterizationXEngineering/ParamXENGResetModel',
		'i18n!DS/ParameterizationSkeleton/assets/nls/XEngineeringNLS'
	],
	function (Modal,
		UWACore,
		Toggle,
		TouchUtils,
		WUXComboBox,
		WUXPopup,
		WUXButton,
		ImmersiveFrame,
		Dialog,
		Select,
		Text,
		Number,
		Alert,
		Tooltip,
		WAFData,
		URLHandler,
		ParameterizationXEngineerConstants,
		ParamXENGResetModel,
		XEngineeringNLS) {

	'use strict';

	function _createModal(options) {
		var modal = new Modal({
				className: options.className || '',
				closable: true,
				header: '<h4>' + options.title + '</h4>',
				body: '',
				footer: ''
			});
		return modal;
	}

	function XEngineerModal(options) {
		this.options = {
			title: 'Dialog',
			className: '',
			withFooter: true
		};
		this.options = UWACore.extend(this.options, options);

		this.modal = _createModal(this.options);
		this.modal.inject(document.querySelector('#typeMainXENDiv'));
		if (this.options.withFooter) {
			this._bindFooterEvent();
		}

	}

	XEngineerModal.prototype.CELLS_INDEX = ParameterizationXEngineerConstants.CELLS_INDEX;

	XEngineerModal.prototype.getPartNumberFormat = function () {

		var _formatContent = this.modal.getContent().getElement('.enox-part-number-content');
		var that = this;

		if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationXEngineerConstants.FORMAT_FREE) {
			var _dynamicFormatContent = this.modal.getContent().getElement('.enox-part-number-dynamic-content');
			_dynamicFormatContent.empty();
			that.destroyValueFieldComponents();
			that.getRegexField(_formatContent);
		} else if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationXEngineerConstants.FORMAT_STRING) {
			that.destroyValueFieldComponents();
			that.getValueField(_formatContent);
		} else if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationXEngineerConstants.FORMAT_ATTRIBUTE) {
			that.destroyValueFieldComponents();
			that.getDynamicFields(_formatContent, this.partNumberTypeCombobox.getValue()[0]);
			that.disableExistingAttributesInFormula();
		} else if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationXEngineerConstants.FORMAT_COUNTER) {
			that.destroyValueFieldComponents();
			that.getDynamicFields(_formatContent, this.partNumberTypeCombobox.getValue()[0]);
		}
	};

	XEngineerModal.prototype.getDefaultFields = function (_formatContent) {

		var that = this;

		var divTag = document.createElement('div');
		divTag.className = "formats";

		var labelDiv = document.createElement('div');
		labelDiv.className = "formats-label";
		labelDiv.innerText = XEngineeringNLS.name; //formats[i];

		var textBoxDiv = document.createElement('div');
		textBoxDiv.className = "formats-tbox";
		var textOptions = {
			events: {
				//  onChange: that.validateEnteredNameValue.bind(that)
			}
		};

		this.nameTextBox = this.getTextBox(textOptions);
		this.nameTextBox.domId = XEngineeringNLS.name + "_textBox";
		this.nameTextBox.inject(textBoxDiv);

		divTag.appendChild(labelDiv);
		divTag.appendChild(textBoxDiv);

		_formatContent.appendChild(divTag);

		var divTagForNbrBox = document.createElement('div');
		divTagForNbrBox.className = "formats";

		var labelDivForNbrBox = document.createElement('div');
		labelDivForNbrBox.className = "formats-label";
		labelDivForNbrBox.innerText = XEngineeringNLS.order; //formats[i];

		var textBoxDivForNbrBox = document.createElement('div');
		textBoxDivForNbrBox.className = "formats-tbox";

		var numberOptions = {
			min: 1,
			max: ParameterizationXEngineerConstants.MAX_ROWS,

			value: this.getHighestOrder() + 1,
			events: {}
		};

		this.numberOrderBox = this.getNumberBox(numberOptions);
		this.numberOrderBox.domId = XEngineeringNLS.order + "_textBox";
		this.numberOrderBox.inject(textBoxDivForNbrBox);

		divTagForNbrBox.appendChild(labelDivForNbrBox);
		divTagForNbrBox.appendChild(textBoxDivForNbrBox);

		_formatContent.appendChild(divTagForNbrBox);

		var divTagForType = document.createElement('div');
		divTagForType.className = "formats";

		var typelabelDiv = document.createElement('div');
		typelabelDiv.className = "formats-label";
		typelabelDiv.innerText = XEngineeringNLS.type;

		var typeComboBoxDiv = document.createElement('div');
		typeComboBoxDiv.className = "formats-tbox";

		var selectOptions = {
			custom: false,
			placeholder: XEngineeringNLS.selectType,
			options: [{
					label: XEngineeringNLS.String,
					value: ParameterizationXEngineerConstants.FORMAT_STRING
				}, {
					label: XEngineeringNLS.Free,
					value: ParameterizationXEngineerConstants.FORMAT_FREE
				}, {
					label: XEngineeringNLS.Attribute,
					value: ParameterizationXEngineerConstants.FORMAT_ATTRIBUTE
				}, {
					label: XEngineeringNLS.Counter,
					value: ParameterizationXEngineerConstants.FORMAT_COUNTER
				}

			],
			events: {
				onChange: that.getPartNumberFormat.bind(that)
			}
		};

		this.partNumberTypeCombobox = this.getSelectComponent(selectOptions);
		this.partNumberTypeCombobox.setId(XEngineeringNLS.type + "_comboBox");
		this.partNumberTypeCombobox.inject(typeComboBoxDiv);

		divTagForType.appendChild(typelabelDiv);
		divTagForType.appendChild(typeComboBoxDiv);
		_formatContent.appendChild(divTagForType);

	};

	XEngineerModal.prototype.getDynamicFields = function (_formatContent, format) {
		var that = this;

		var _dynamicFormatContent = this.modal.getContent().getElement('.enox-part-number-dynamic-content');
		_dynamicFormatContent.empty();

		if (format == ParameterizationXEngineerConstants.FORMAT_ATTRIBUTE) {
			that.getAttributeFormat(_formatContent, _dynamicFormatContent);

		} else if (format == ParameterizationXEngineerConstants.FORMAT_COUNTER) {
			this.getCounterFormat(_formatContent, _dynamicFormatContent);
		}

	};
	XEngineerModal.prototype.getAttributeFormat = function (_formatContent, _dynamicFormatContent) {
		var that = this;
		var formatField = XEngineeringNLS.attribute;

		var divTag = document.createElement('div');
		divTag.className = "formats";

		var labelDiv = document.createElement('div');
		labelDiv.className = "formats-label";
		labelDiv.innerText = formatField;

		var comboBoxDiv = document.createElement('div');
		comboBoxDiv.className = "formats-tbox";
		var allAttributes = [];

		if (typeof this.attributes.message === "undefined") {
			for (var key in this.attributes) {
				var attributes1 = {};

				attributes1["label"] = this.attributes[key]
					attributes1["value"] = key

					allAttributes.push(attributes1);
			}
		}

		var selectOptions = {
			custom: false,
			placeholder: XEngineeringNLS.selectAttribute,
			options: allAttributes
		};

		this.partNumberAttributeCombobox = this.getSelectComponent(selectOptions);

		this.partNumberAttributeCombobox.setId(formatField + "_comboBox");
		this.partNumberAttributeCombobox.inject(comboBoxDiv);

		divTag.appendChild(labelDiv);
		divTag.appendChild(comboBoxDiv);

		var formatFieldValue = XEngineeringNLS.defaultValue;
		var divTagForValue = document.createElement('div');
		divTagForValue.className = "formats";

		var labelDivForValue = document.createElement('div');
		labelDivForValue.className = "formats-label";
		labelDivForValue.innerText = formatFieldValue;

		var textBoxDivForValue = document.createElement('div');
		textBoxDivForValue.className = "formats-tbox";
		this.valueDynTextBox = this.getTextBox();
		this.valueDynTextBox.domId = formatFieldValue + "_textBox";
		this.valueDynTextBox.inject(textBoxDivForValue);

		this.counterCheckbox = new Toggle({ type: "checkbox", label: XEngineeringNLS.newCounter});
		var newCounterDiv = document.createElement('div');
		newCounterDiv.className = "new-counter";
		this.counterCheckbox.inject(newCounterDiv);
		this.updateHighestCounterCheckbox = new Toggle({ type: "checkbox", label: XEngineeringNLS.updateHighestCounter});
		this.updateHighestCounterCheckbox.setCheck(true);
		var updateCounterDiv = document.createElement('div');
		updateCounterDiv.className = "update-highest-counter";
		this.updateHighestCounterCheckbox.inject(updateCounterDiv);
		var updateCounterCheckboxDiv = document.createElement('span');
		updateCounterCheckboxDiv.className = "update-highest-counter-checkbox";
		this.updateHighestCounterCheckbox.inject(updateCounterCheckboxDiv);
		var updateCounterInfoDiv = document.createElement('span');
		updateCounterInfoDiv.className = "update-highest-counter-info fonticon fonticon-info";
		this.getInformation(updateCounterInfoDiv, XEngineeringNLS.updateHighestCounterTooltip);
		updateCounterDiv.hidden = true
		this.counterCheckbox.onChange = function(e){
			if(that.options[ParameterizationXEngineerConstants.AVOID_DUP_COUNTER] == ParameterizationXEngineerConstants.AVOID_DUP_COUNTER_VALUE){
				updateCounterDiv.hidden = false;
			}
		}
		updateCounterDiv.appendChild(updateCounterCheckboxDiv);
		updateCounterDiv.appendChild(updateCounterInfoDiv); 
		divTagForValue.appendChild(labelDivForValue);
		divTagForValue.appendChild(textBoxDivForValue);

		_dynamicFormatContent.appendChild(divTag);
		_dynamicFormatContent.appendChild(divTagForValue);
		_dynamicFormatContent.appendChild(newCounterDiv);
		_dynamicFormatContent.appendChild(updateCounterDiv);
		_formatContent.appendChild(_dynamicFormatContent);

	};

	XEngineerModal.prototype.getCounterFormat = function (_formatContent, _dynamicFormatContent) {
		var that = this;
		var divTagForNbrBox = document.createElement('div');
		divTagForNbrBox.className = "formats";

		var labelDivForNbrBox = document.createElement('div');
		labelDivForNbrBox.className = "formats-label";

		var divForLabel = document.createElement('div');
		divForLabel.className = 'label-counter';

		var labelText = document.createElement('div');
		labelText.className = 'label-text';
		labelText.innerText = XEngineeringNLS.digits;

		var informationDiv = document.createElement('div');
		informationDiv.className = "fonticon fonticon-attention";
		informationDiv.id = "information";
		informationDiv.style.color = "black";

		divForLabel.appendChild(labelText);
		divForLabel.appendChild(informationDiv);

		labelDivForNbrBox.appendChild(divForLabel);

		var textBoxDivForNbrBox = document.createElement('div');
		textBoxDivForNbrBox.className = "formats-tbox";

		var numberOptions = {
			min: 1,
			max: ParameterizationXEngineerConstants.MAX_ROWS /*Number.MAX_SAFE_INTEGER*/,
			step: 1,
			value: 6,
			events: {
				onChange: that.updateSampleText.bind(that)
			}
		};

		this.counterNumberBox = this.getNumberBox(numberOptions);
		this.counterNumberBox.domId = XEngineeringNLS.digits + "_textBox";
		this.counterNumberBox.inject(textBoxDivForNbrBox);

		divTagForNbrBox.appendChild(labelDivForNbrBox);
		divTagForNbrBox.appendChild(textBoxDivForNbrBox);

		_dynamicFormatContent.appendChild(divTagForNbrBox);

		var formatField = XEngineeringNLS.sample;

		var divTag = document.createElement('div');
		divTag.className = "formats-sample";

		var labelDiv = document.createElement('div');
		labelDiv.className = "formats-sample-label";
		//labelDiv.innerText = formatField;


		var sampleTextLabelSpan = document.createElement('span');
		sampleTextLabelSpan.id = "sampleTextLabel";
		sampleTextLabelSpan.innerText = formatField + " : ";

		var sampleTextValueSpan = document.createElement('span');
		sampleTextValueSpan.id = "sampleValue";

		var textBoxDiv = document.createElement('div');
		textBoxDiv.className = "formats-sample-value";

		textBoxDiv.appendChild(sampleTextLabelSpan);
		textBoxDiv.appendChild(sampleTextValueSpan);
		//textBoxDiv.id = "sampleValue";

		divTag.appendChild(labelDiv);
		divTag.appendChild(textBoxDiv);

		_dynamicFormatContent.appendChild(divTag);
		_formatContent.appendChild(_dynamicFormatContent);

		this.updateSampleText(); // sets the number of digits value

		this.modal.getContent().getElement('#information').addEvent('mouseover', function () {
			that.getInformation(that.modal.getContent().getElement("#information"), XEngineeringNLS.counterTooltip);
		});


		that.buildGlobalStartingValueNumber(_dynamicFormatContent);

		that.buildAttributeFieldinCounter(_dynamicFormatContent);

		if(that.options && that.options.className && that.options.className === "part-number-edit-modal"){
			ParamXENGResetModel.prototype.buildResetCounterCheckBox(_dynamicFormatContent,this.expressionList);
		}

		_formatContent.appendChild(_dynamicFormatContent);

	};

	XEngineerModal.prototype.buildAttributeFieldinCounter = function (_dynamicFormatContent) {
		var that = this;
		
		var allAttributes = [];

		let selectedValues = [];
		let labels = [];
		var attributeList = this.expressionList && this.expressionList.Attribute;

		var attrMaindivTag = document.createElement('div');
		attrMaindivTag.className = "formats-link";
		attrMaindivTag.id = "local-starting-div";
		if (attributeList && Array.isArray(attributeList) && attributeList.length > 0) {
			var formatField = XEngineeringNLS.attribute;

			var divTag = document.createElement('div');
			divTag.className = "formats";
			divTag.id = "local-starting-value-attribute";

			var labelDiv = document.createElement('div');
			labelDiv.className = "formats-label";
			labelDiv.innerText = formatField;
			labelDiv.id = "CounterUnicityAttribute";

			var comboBoxDiv = document.createElement('div');
			comboBoxDiv.className = "formats-tbox";

			attributeList.forEach((value) => {
				if (value.cells[this.CELLS_INDEX.deployFlag].value == ParameterizationXEngineerConstants.REMOVE) {
					return;
				}
				var attributes1 = {};

				attributes1["label"] = value.cells[this.CELLS_INDEX.value].getText();
				attributes1["value"] = value.cells[this.CELLS_INDEX.value][ParameterizationXEngineerConstants.ATTRIBUTE];

				allAttributes.push(attributes1);

				if (value.cells[this.CELLS_INDEX.counterUnicityIndex].value == 'true' || value.cells[this.CELLS_INDEX.counterUnicityIndex].value == true) {
					selectedValues.push(value.cells[this.CELLS_INDEX.value][ParameterizationXEngineerConstants.ATTRIBUTE]);
					labels.push(value.cells[this.CELLS_INDEX.value].getText());
				}
			})

			var selectOptions = new WUXComboBox({
				elementsList: allAttributes,
				enableSearchFlag: false,
				placeholder: XEngineeringNLS.selectAttributeForCounter,
				displayStyle: "normal",
				multiSelFlag: true,
				popupSizeAdjustPolicy: WUXPopup.SizeAdjustPolicyEnum.AdjustToVisibleContents,
				value: selectedValues
			});

			this.partNumberAttributeComboboxInCounter = selectOptions;

			this.partNumberAttributeComboboxInCounter.addEventListener('change', function myCB(e) {
				var values = e.dsModel.value;
				that.buildStartingValueNumberBox(values, attrMaindivTag)
			});

			this.partNumberAttributeComboboxInCounter.domId = formatField + "_comboBox";
			this.partNumberAttributeComboboxInCounter.inject(comboBoxDiv);
			
			divTag.appendChild(labelDiv);
			divTag.appendChild(comboBoxDiv);
			attrMaindivTag.appendChild(divTag);
			if(allAttributes.length>0){
				_dynamicFormatContent.appendChild(attrMaindivTag);
			}
		}

		TouchUtils.setTouchMode(true);
		that.buildStartingValueNumberBox(selectedValues, attrMaindivTag)
	};

	XEngineerModal.prototype.buildStartingValueNumberBox = function (selectedValues, _dynamicFormatContent) {

		var that = this;
		if (!(selectedValues && Array.isArray(selectedValues))) {
			return
		}

		let startingLocalValuesDiv = document.getElementById('formats-local-Counter-value');
		if (startingLocalValuesDiv) {
			startingLocalValuesDiv.remove();
			this.partNumberLocalCounterStartingValue = undefined;
		}
		if (selectedValues.length == 1 && this.rangeValuedAttributes && this.rangeValuedAttributes.hasOwnProperty(selectedValues[0])) {
			return that.buildLocalStartingValueNumber(_dynamicFormatContent, selectedValues);
		}

	};

	XEngineerModal.prototype.buildGlobalStartingValueNumber = function (_dynamicFormatContent) {

		var that = this;
		var formatField = XEngineeringNLS.GlobalCounterStartingValue;

		var divTag = document.createElement('div');
		divTag.className = "formats";
		divTag.id = "format-starting-value";

		var labelDiv = document.createElement('div');
		labelDiv.className = "formats-label";
		labelDiv.innerText = formatField;
		labelDiv.id = "format-starting-value-label";

		var textBoxDivForNbrBox = document.createElement('div');
		textBoxDivForNbrBox.className = "formats-tbox";
		var GlobalCounterValue = (that.partNumberGlobalCounterStartingValue && that.partNumberGlobalCounterStartingValue.getValue) ? parseInt(that.partNumberGlobalCounterStartingValue.getValue()) : (this.partNumberGlobalCounterValue ? parseInt(this.partNumberGlobalCounterValue) : 0);

		var numberOptions = {
			min: 0,
			step: 1,
			max: ParameterizationXEngineerConstants.MAX_COUNT_VALUE,
			value: GlobalCounterValue,
			id: "GlobalCounterStartingValue"
		};

		this.partNumberGlobalCounterStartingValue = this.getNumberBox(numberOptions);

		this.partNumberGlobalCounterStartingValue.domId = formatField + "_comboBox";
		this.partNumberGlobalCounterStartingValue.inject(textBoxDivForNbrBox);
		divTag.appendChild(labelDiv);
		divTag.appendChild(textBoxDivForNbrBox);

		_dynamicFormatContent.appendChild(divTag);
		return _dynamicFormatContent;
	};

	XEngineerModal.prototype.buildLocalStartingValueNumber = function (_dynamicFormatContent, selectedValues) {
		var that = this;

		var divTag = document.createElement('div');
		divTag.className = "formats-local-Counter";
		divTag.id = "formats-local-Counter-value";

		var labelDiv = document.createElement('div');
		labelDiv.className = "formats-local-Counter-label";

		var buttonDiv = document.createElement('div');
		buttonDiv.className = "formats-local-Counter-value";

		var setLocalCtrButton = new WUXButton({
				label: XEngineeringNLS.LocalCounterStartingValue,
				displayStyle: "lite"
			});

		setLocalCtrButton.domId = "local-Counter-button";
		this.partNumberLocalCounterStartingValue = setLocalCtrButton;
		this.partNumberLocalCounterStartingValue.id = setLocalCtrButton.id + "_link";
		this.partNumberLocalCounterStartingValue.inject(buttonDiv);
		this.partNumberLocalCounterStartingValue.counterValue = this.partNumberLocalCounterValue;

		this.partNumberLocalCounterStartingValue.addEventListener('click', function () {
			that.buildCounterDialog(selectedValues);
		})

		divTag.appendChild(labelDiv);
		divTag.appendChild(buttonDiv);

		return _dynamicFormatContent.appendChild(divTag);
	};

	XEngineerModal.prototype.buildCounterDialog = function (selectedValues) {
		var that = this;
		let validContainer = (document.getElementsByClassName("part-number-edit-modal modal modal-root").length > 0) ? document.getElementsByClassName("part-number-edit-modal modal modal-root") : document.getElementsByClassName("part-number-modal modal modal-root");
		let container;
		for (let content in validContainer) {
			if (!validContainer[content].isHidden()) {
				container = validContainer[content];
				break;
			}
		}

		var immersiveFrame = new ImmersiveFrame();
		immersiveFrame.inject(container);
		that.localCounterDialog = new Dialog({
				title: XEngineeringNLS.get("CounterStartingValueHeader"),
				content: that.buildCounterDialogContent(selectedValues[0]),
				immersiveFrame: immersiveFrame,
				resizableFlag: true,
				width: 450,
				height: 350,
				modalFlag: true,
				closeButtonFlag: false,
				touchMode: true,
				buttons: {
					Ok: new WUXButton({
						label: XEngineeringNLS.get("add"),
						domId: "OK_Button",
						onClick: function (e) {
							that.updateLocalCounterValues();
							that.localCounterDialog.immersiveFrame.getModel().destroy();
						}
					}),
					Cancel: new WUXButton({
						label: XEngineeringNLS.get("cancel"),
						domId: "Cancel_Button",
						onClick: function (e) {
							that.localCounterDialog.immersiveFrame.getModel().destroy();
						}
					})
				}
			});

	};

	XEngineerModal.prototype.buildTextbox = function (name) {
		var labelDiv = document.createElement('div');
		labelDiv.className = "formats-label";
		labelDiv.innerText = name;
		return labelDiv;
	};

	XEngineerModal.prototype.buildCounterNumberBox = function (startCount, attrRangeName) {
		var textBoxDivForNbrBox = document.createElement('div');
		textBoxDivForNbrBox.className = "formats-value";
		var numberOptions = {
			min: 0,
			max: ParameterizationXEngineerConstants.MAX_COUNT_VALUE,
			step: 1,
			value: startCount,
		};
		this.startingCounterValueNumberBox = this.getNumberBox(numberOptions);
		this.startingCounterValueNumberBox.domId = attrRangeName;
		this.startingCounterValueNumberBox.inject(textBoxDivForNbrBox);
		return textBoxDivForNbrBox;
	};

		XEngineerModal.prototype.buildLocalCounterheaderField = function (selectedValue, _counterPopupContainer) {
		var that =this;
		var divTag = document.createElement('div');
		divTag.className = "formats-Header";

		let selectedAttributeNLSName = that.attributes && that.attributes[selectedValue] ? that.attributes[selectedValue] : ""
		
		let labelDiv = document.createElement('div');
		labelDiv.className = "formats-label-header";
		labelDiv.innerText = XEngineeringNLS.CounterStartingValueHeaderBox + '(' + selectedAttributeNLSName + ')';
		
		divTag.appendChild(labelDiv);
		_counterPopupContainer.appendChild(divTag);
	};

	XEngineerModal.prototype.buildCounterDialogContent = function (selectedValue) {
		var that = this;
		let _counterPopupContainer = UWA.createElement('div', {
				'class': "enox-part-number-attribute-Counter-local-values"
			}); ;

		let localCountersSet = (that.partNumberLocalCounterStartingValue && that.partNumberLocalCounterStartingValue.counterValue) ? that.partNumberLocalCounterStartingValue.counterValue : this.partNumberLocalCounterStartingValue.counterValue = this.partNumberLocalCounterValue;


		let attrRange = that.rangeValuedAttributes[selectedValue];
		let rangeValues = Object.keys(attrRange);
		that.attrRangeCounters = [];

		if (!Array.isArray(rangeValues) && rangeValues.length == 0)
			return _counterPopupContainer;

		that.buildLocalCounterheaderField(selectedValue, _counterPopupContainer);

		let attrRangeCounterValues = that.buildLocalcounters(localCountersSet, selectedValue);

		that.localAttributeSelected = selectedValue;
		
		rangeValues.forEach(function (value) {
			let divTag = document.createElement('div');
			divTag.className = "formats";
			let startCount = (attrRangeCounterValues && attrRangeCounterValues[value]) ? parseInt(attrRangeCounterValues[value]) : 0;
			let labelDiv = that.buildTextbox(attrRange[value]);
			let numberDiv = that.buildCounterNumberBox(startCount,value);

			that.attrRangeCounters.push(that.startingCounterValueNumberBox);
			divTag.appendChild(labelDiv);
			divTag.appendChild(numberDiv);

			_counterPopupContainer.appendChild(divTag);
		})

		return _counterPopupContainer;
	};

	XEngineerModal.prototype.updateLocalCounterValues = function(){
		let that = this;
		let finalCounterStartingValues = {};
		let localCounters = that.attrRangeCounters;
		let localCounterValueSet = {};
		if (!(localCounters && Array.isArray(localCounters) && localCounters > 0)) that.partNumberLocalCounterStartingValue.counterValue = undefined;
		localCounters.forEach(function(rangeCounter){
			localCounterValueSet[rangeCounter.domId] = that.addpaddingToNumber(rangeCounter.getValue(), that.getSampleDigitsInCounter());
		})
		finalCounterStartingValues[that.localAttributeSelected] = localCounterValueSet;

		that.partNumberLocalCounterStartingValue.counterValue = JSON.stringify(finalCounterStartingValues);
	};

	XEngineerModal.prototype.getInformation = function (targetElement, toDisplayOver) {

		var tooltipOtions = {
			target: targetElement,
			body: toDisplayOver
		};
		this.getTooltip(tooltipOtions);

	};

	XEngineerModal.prototype.buildLocalcounters = function (localCounters, selectedAttributeValue){

		let localCounterValuesSet = (localCounters && (typeof localCounters==='string') ) ? JSON.parse(localCounters) : undefined;
		
		return (localCounterValuesSet && localCounterValuesSet[selectedAttributeValue]) ? localCounterValuesSet[selectedAttributeValue] : undefined;


	};

	XEngineerModal.prototype.getValueField = function (_formatContent) {

		var _dynamicFormatContent = this.modal.getContent().getElement('.enox-part-number-dynamic-content');

		_dynamicFormatContent.empty();

		var formatField = XEngineeringNLS.value;

		var divTag = document.createElement('div');
		divTag.className = "formats";

		var labelDiv = document.createElement('div');
		labelDiv.className = "formats-label";
		labelDiv.innerText = formatField;

		var textBoxDiv = document.createElement('div');
		textBoxDiv.className = "formats-tbox";
		this.valueTextBox = this.getTextBox();
		this.valueTextBox.domId = formatField + "_textBox";
		this.valueTextBox.inject(textBoxDiv);

		divTag.appendChild(labelDiv);
		divTag.appendChild(textBoxDiv);

		_dynamicFormatContent.appendChild(divTag);
		_formatContent.appendChild(_dynamicFormatContent);

	};

	XEngineerModal.prototype.getRegexField = function (_formatContent) {

		var _dynamicFormatContent = this.modal.getContent().getElement('.enox-part-number-dynamic-content');

		_dynamicFormatContent.empty();

		var formatField = XEngineeringNLS.regex;

		var divTag = document.createElement('div');
		divTag.className = "formats";

		var labelDiv = document.createElement('div');
		labelDiv.className = "formats-label";
		labelDiv.innerText = formatField;

		var textBoxDiv = document.createElement('div');
		textBoxDiv.className = "formats-tbox";
		this.regexTextBox = this.getTextBox();
		this.regexTextBox.domId = ParameterizationXEngineerConstants.REGEX + "_textBox";
		this.regexTextBox.inject(textBoxDiv);

		divTag.appendChild(labelDiv);
		divTag.appendChild(textBoxDiv);

		_dynamicFormatContent.appendChild(divTag);
		_formatContent.appendChild(_dynamicFormatContent);

	};

	XEngineerModal.prototype.getModalBody = function () {

		var partNumberContent = this.modal.elements.body;

		var _errorsMessageDiv = UWACore.createElement('div');
		_errorsMessageDiv.className = "enox-part-number-error-content";

		var _formatContent = UWACore.createElement('div');
		_formatContent.className = "enox-part-number-content";

		var _staticFormatContent = UWACore.createElement('div');
		_staticFormatContent.className = "enox-part-number-static-content";
		var _dynamicFormatContent = UWACore.createElement('div');
		_dynamicFormatContent.className = "enox-part-number-dynamic-content";

		_formatContent.appendChild(_staticFormatContent);
		_formatContent.appendChild(_dynamicFormatContent);
		this.getDefaultFields(_staticFormatContent);

		partNumberContent.appendChild(_errorsMessageDiv);
		partNumberContent.appendChild(_formatContent);
		partNumberContent.appendChild(_dynamicFormatContent);
		return partNumberContent;
	};

	XEngineerModal.prototype.validateEnteredNameValue = function (operation, editingField) {

		var duplicateData = {};
		duplicateData.isValid = true;
		var userEnteredFormat = this.nameTextBox.getValue();
		var isSuccess = this.validateEnteredValues(userEnteredFormat, XEngineeringNLS.name, operation, editingField);

		if (!isSuccess) {
			duplicateData.isValid = false;
		}
		duplicateData.data = userEnteredFormat;
		return duplicateData;
	};

	XEngineerModal.prototype.validateEnteredOrderValue = function (operation, editingField) {

		var duplicateData = {};
		duplicateData.isValid = true;

		var userEnteredFormat = this.numberOrderBox.getValue();
		var isSuccess = this.validateEnteredValues(userEnteredFormat, XEngineeringNLS.order, operation, editingField);

		if (!isSuccess) {

			duplicateData.isValid = false;
		}

		duplicateData.data = userEnteredFormat;
		return duplicateData;
	};

	XEngineerModal.prototype.validateEnteredValues = function (userEnteredFormat, field, operation, editingField) {
		var rowsOfMappedFields = document.querySelectorAll(".partNumberFieldMapping");
		var successFields = document.querySelector('.success');


		var isSuccess = true;

		if (operation == "edit") {
			for (var k = 0; k < rowsOfMappedFields.length; k++) {
				if (rowsOfMappedFields[k] != editingField) {
					for (var j = 0; j < 2; j++) {
						if (successFields.getChildren()[j].getText() == field && userEnteredFormat == rowsOfMappedFields[k].getChildren()[j].getText()) {
							isSuccess = false;
							break;
						}
					}
				}
			}
		} else {
			for (var k1 = 0; k1 < rowsOfMappedFields.length; k1++) {

				for (var j1 = 0; j1 < 2; j1++) {
					if (successFields.getChildren()[j1].getText() == field && userEnteredFormat == rowsOfMappedFields[k1].getChildren()[j1].getText()) {
						isSuccess = false;
						break;
					}
				}
			}
		}
		return isSuccess;
	};

	XEngineerModal.prototype.validateEnteredNameValueNotNull = function () {
		var userEnteredFormat = this.nameTextBox.getValue();
		var isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
		return isNull;
	};

	XEngineerModal.prototype.validateEnteredOrderValueNotNull = function () {
		var userEnteredFormat = this.numberOrderBox.getValue();
		var isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
		return isNull;
	};

	XEngineerModal.prototype.validateEnteredValueFieldValueNotNull = function () {
		var isNull = false;
		if (this.getUserEnteredValues().Type != ParameterizationXEngineerConstants.FORMAT_ATTRIBUTE) {
			isNull = this.valueTextBox ? this.validateEnteredValuesNotNull(this.valueTextBox.getValue()) : this.valueDynTextBox ? this.validateEnteredValuesNotNull(this.valueDynTextBox.getValue()) : false;
		}
		return isNull;
	};

	XEngineerModal.prototype.validatSelectedTypeFieldValueNotNull = function () {
		var userEnteredFormat = this.partNumberTypeCombobox.getValue()[0];
		var isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
		return isNull;
	};

	XEngineerModal.prototype.validateSelectedAttributeFieldValueNotNull = function () {
		var userEnteredFormat = this.partNumberAttributeCombobox ? this.partNumberAttributeCombobox.getValue()[0] : '';
		var isNull = false;
		if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationXEngineerConstants.FORMAT_ATTRIBUTE) {
			isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
		}

		return isNull;
	};

	XEngineerModal.prototype.validateEnteredCounterFieldValueNotNull = function () {
		var userEnteredFormat = this.counterNumberBox ? this.counterNumberBox.getValue() : '';
		var isNull = false;
		if (this.partNumberTypeCombobox.getValue()[0] == ParameterizationXEngineerConstants.FORMAT_COUNTER) {
			isNull = this.validateEnteredValuesNotNull(userEnteredFormat);
		}

		return isNull;
	};

	XEngineerModal.prototype.validateEnteredValuesNotNull = function (userEnteredFormat) {

		var isNull = false;
		if (userEnteredFormat == '' || userEnteredFormat == "") {
			isNull = true;
		}
		return isNull;
	};

	XEngineerModal.prototype.displayAlertMessage = function (messageToDisplay, toDisplayOver) {
		var alertOptions = {
			visible: true,
			className: 'param-alert',
			messageClassName: 'error',
			closable: true,
			renderTo: toDisplayOver,
			autoHide: true,
			hideDelay: 2000
		};
		var alert = this.getAlertComponent(alertOptions);

		alert.add({
			message: messageToDisplay
		});

	};

	XEngineerModal.prototype.getUserEnteredValues = function () {

		var userEnteredFormatValues = {};

		var valueField = this.valueTextBox ? this.valueTextBox.getValue() : this.valueDynTextBox ? this.valueDynTextBox.getValue() : this.modal.getContent().getElement('#sampleValue') ? this.modal.getContent().getElement('#sampleValue').innerText : '';
		var regexField = this.regexTextBox ? this.regexTextBox.getValue() : '';
		var attributeFieldLabel = this.partNumberAttributeCombobox ? this.partNumberAttributeCombobox.getOption(this.partNumberAttributeCombobox.getValue()[0]).getText() : '';
		var attributeFieldValue = this.partNumberAttributeCombobox ? this.partNumberAttributeCombobox.getValue()[0] : '';
		var numberOfDigits = this.counterNumberBox ? this.counterNumberBox.getValue() : '';
		var counterUnicityCheckBox = this.counterCheckbox ? this.counterCheckbox.isChecked() : false;
		var updateHighestCounterCheckBox = this.updateHighestCounterCheckbox ? this.updateHighestCounterCheckbox.isChecked() : false;
		var GlobalCounterStartingValues = this.partNumberGlobalCounterStartingValue ? this.partNumberGlobalCounterStartingValue.getValue() : undefined;
		var LocalCounterStartingValues = (this.partNumberLocalCounterStartingValue && this.partNumberLocalCounterStartingValue.counterValue) ? this.partNumberLocalCounterStartingValue.counterValue : undefined;

		userEnteredFormatValues[ParameterizationXEngineerConstants.NAME] = this.nameTextBox.getValue();
		userEnteredFormatValues[ParameterizationXEngineerConstants.ORDER] = this.numberOrderBox.getValue();
		userEnteredFormatValues[ParameterizationXEngineerConstants.TYPE] = this.partNumberTypeCombobox.getValue()[0];
		userEnteredFormatValues[ParameterizationXEngineerConstants.ATTRIBUTE] = attributeFieldValue;
		userEnteredFormatValues[ParameterizationXEngineerConstants.ATTRIBUTE_NLS_NAME] = attributeFieldLabel;
		userEnteredFormatValues[ParameterizationXEngineerConstants.COUNTER] = numberOfDigits;
		userEnteredFormatValues[ParameterizationXEngineerConstants.VALUE] = valueField ;
		userEnteredFormatValues[ParameterizationXEngineerConstants.REGEX] = regexField ;
		userEnteredFormatValues[ParameterizationXEngineerConstants.COUNTER_UNICITY] = (counterUnicityCheckBox) ? counterUnicityCheckBox : "";
		userEnteredFormatValues[ParameterizationXEngineerConstants.UPDATE_HIGHEST_COUNTER] = updateHighestCounterCheckBox;
		userEnteredFormatValues[ParameterizationXEngineerConstants.COUNTER_STARTING_VALUES] = LocalCounterStartingValues ? LocalCounterStartingValues : "";

		this.updateUserEnteredValuesForCounter(userEnteredFormatValues);

		return userEnteredFormatValues;
	};

	XEngineerModal.prototype.updateUserEnteredValuesForCounter = function (userEnteredFormatValues) {
		if (userEnteredFormatValues[ParameterizationXEngineerConstants.TYPE] == ParameterizationXEngineerConstants.FORMAT_COUNTER){
			let globalCounterStartingValues = this.partNumberGlobalCounterStartingValue ? this.partNumberGlobalCounterStartingValue.getValue() : "0";
			userEnteredFormatValues[ParameterizationXEngineerConstants.VALUE] = this.addpaddingToNumber(globalCounterStartingValues, userEnteredFormatValues[ParameterizationXEngineerConstants.VALUE].length);
		}
		
	};

	XEngineerModal.prototype.getSampleDigitsInCounter = function () {
		let samplevalueLength = this.modal.getContent().getElement('#sampleValue');
		return (samplevalueLength && samplevalueLength.innerText && samplevalueLength.innerText.length) ? samplevalueLength.innerText.length : 0;
	};
		

	XEngineerModal.prototype.addpaddingToNumber = function (number,paddingSize) {
		return number.padStart(paddingSize, '0');;
	};
	
	XEngineerModal.prototype.updateSampleText = function () {

		var sampleTextDiv = this.modal.getContent().getElement('#sampleValue');
		var updatedCount = this.counterNumberBox ? this.counterNumberBox.getValue() : '';
		var noOFDigits = "";

		for (var i = 0; i < parseInt(updatedCount); i++) {
			noOFDigits = '0' + noOFDigits;
		}

		if (sampleTextDiv != null) {
			sampleTextDiv.innerText = noOFDigits;
		}

	};

	XEngineerModal.prototype.getFormulaRows = function () {
		return document.querySelectorAll(".partNumberFieldMapping");
	};

	XEngineerModal.prototype.getTotalFormatRows = function () {
		return this.getFormulaRows().length;
	};

	XEngineerModal.prototype.getHighestOrder = function () {
		var rowsOfMappedFields = document.querySelectorAll(".partNumberFieldMapping");
		var toCheckTheExistingRows = rowsOfMappedFields.length;
		var highestOrder = 0;
		if (toCheckTheExistingRows > 0) {
			for (var k = 0; k < rowsOfMappedFields.length; k++) {
				if (parseInt(rowsOfMappedFields[k].getChildren()[1].getText()) > highestOrder) {
					highestOrder = parseInt(rowsOfMappedFields[k].getChildren()[1].getText());
				}
			}
		}

		return highestOrder;

	};
	XEngineerModal.prototype.isCounterExists = function (field) {
		var rowsOfMappedFields = document.querySelectorAll(".partNumberFieldMapping");
		var toCheckTheExistingRows = rowsOfMappedFields.length;
		var isSuccess = false;
		if (toCheckTheExistingRows > 0) {
			for (var k = 0; k < rowsOfMappedFields.length; k++) {
				if (rowsOfMappedFields[k].getChildren()[2].value == ParameterizationXEngineerConstants.FORMAT_COUNTER) {
					isSuccess = true;
					break;
				}
			}
		}

		return isSuccess;
	};

	XEngineerModal.prototype.getExistingAttributesInFormula = function () {
		var rowsOfMappedFields = this.getFormulaRows()
		var toCheckTheExistingRows = rowsOfMappedFields.length;
		var existingAttributes = [];
		if (toCheckTheExistingRows > 0) {
			for (var k = 0; k < toCheckTheExistingRows; k++) {
				if (rowsOfMappedFields[k].cells[this.CELLS_INDEX.deployFlag].value !== ParameterizationXEngineerConstants.REMOVE) {
					existingAttributes.push(rowsOfMappedFields[k].cells[this.CELLS_INDEX.value][ParameterizationXEngineerConstants.ATTRIBUTE]);
				}
			}
		}
		return existingAttributes;
	};

	XEngineerModal.prototype.destroyValueFieldComponents = function () {

		this.valueTextBox = undefined;
		this.valueDynTextBox = undefined;
		this.counterNumberBox = undefined;
		this.regexTextBox = undefined;
	};

	XEngineerModal.prototype.getAttributes = function (data) {
		var that = this;
		that.storeAttributes(data);
	};

	XEngineerModal.prototype.getExpressionList = function () {
		var that = this;
		let expressionList = {};
		let userInput = []; 
		let text = []; 
		let attribute = []; 
		let counter = []; 
		var rowsOfMappedFields = that.getFormulaRows();
		if (rowsOfMappedFields.length > 0) {
			for (var k = 0; k < rowsOfMappedFields.length; k++) {
				let type = rowsOfMappedFields[k].getChildren()[2].value;
				switch (type) {
				case ParameterizationXEngineerConstants.FORMAT_FREE:
					userInput.push(rowsOfMappedFields[k]);
					break;
				case ParameterizationXEngineerConstants.FORMAT_STRING:
					text.push(rowsOfMappedFields[k]);
					break;
				case ParameterizationXEngineerConstants.FORMAT_ATTRIBUTE:
					attribute.push(rowsOfMappedFields[k]);
					break;
				case ParameterizationXEngineerConstants.FORMAT_COUNTER:
					counter.push(rowsOfMappedFields[k]);
					break;
				default:
					break;
				}
			}
		}
		expressionList[ParameterizationXEngineerConstants.FORMAT_FREE] = userInput;
		expressionList[ParameterizationXEngineerConstants.FORMAT_STRING] = text;
		expressionList[ParameterizationXEngineerConstants.FORMAT_ATTRIBUTE] = attribute;
		expressionList[ParameterizationXEngineerConstants.FORMAT_COUNTER] = counter;

		that.storeExpressionList(expressionList);
	};

	XEngineerModal.prototype.storeAttributes = function (data) {

		this.attributes = data;

	};

	XEngineerModal.prototype.storeExpressionList = function (expressionList) {

		this.expressionList = expressionList;

	};

	XEngineerModal.prototype.getTextBox = function (textBoxOptions) {

		this.textBox = new Text(textBoxOptions);
		return this.textBox;
	};
	XEngineerModal.prototype.getNumberBox = function (numberOptions) {

		this.numberBox = new Number(numberOptions);
		return this.numberBox;
	};

	XEngineerModal.prototype.getSelectComponent = function (selectOptions) {

		this.select = new Select(selectOptions);
		return this.select;
	};

	XEngineerModal.prototype.getAlertComponent = function (alertOptions) {

		this.alert = new Alert(alertOptions);
		return this.alert;
	};

	XEngineerModal.prototype.getTooltip = function (tooltipOtions) {
		this.tooltip = new Tooltip(tooltipOtions);
		return this.tooltip;
	};

	XEngineerModal.prototype.show = function () {
		this.modal.show();
	};

	XEngineerModal.prototype._bindFooterEvent = function () {
		var that = this;

		this.modal.getFooter().getElements('.btn').forEach(function (element) {
			if (element.name === 'cancelButton') {
				element.addEvent('click', function () {
					that.modal.destroy();
				});
			}
		});

	};

	XEngineerModal.prototype.getContent = function () {
		return this.modal.getContent();
	};

	XEngineerModal.prototype.destroy = function () {
		this.modal.destroy();
		var keys = Object.keys(this);
		for (var i = 0; i < keys.length; i++) {
			this[keys[i]] = undefined;
		}
	};

	XEngineerModal.prototype.disableExistingAttributesInFormula = function () {
		this.getExistingAttributesInFormula().forEach(attribute =>{
			this.partNumberAttributeCombobox.disable(attribute);
		});
	};

	return XEngineerModal;
});

define('DS/ParameterizationSkeleton/Views/ParameterizationXEngineering/PartNumberingViewUtilities',
	[
		'UWA/Core',
		'DS/UIKIT/Input/Select',
		'DS/UIKIT/Modal',
		'DS/UIKIT/Input/Text',
		'DS/UIKIT/Input/Number',
		'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
		'DS/WAFData/WAFData',
		'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
		'DS/ParameterizationSkeleton/Views/ParameterizationXEngineering/ParameterizationXEngineerConstants',
		'DS/ParameterizationSkeleton/Views/ParameterizationXEngineering/XENGModal',
		'i18n!DS/ParameterizationSkeleton/assets/nls/XEngineeringNLS'
	],
	function (UWA,
		Select,
		Modal,
		Text,
		Number,
		ParametersLayoutViewUtilities,
		WAFData,
		URLHandler,
		ParameterizationXEngineerConstants,
		XENGModal,
		XEngineeringNLS) {

	'use strict';

	var LEFT_ALIGNMENT = 'left';
	var RIGHT_ALIGNMENT = 'right';
	var HTML_BOLD_FORMAT = 'h5';
	var HTML_PARAG_FORMAT = null;
	var partNumberTable = UWA.createElement('table', {
			'class': 'partNumberTableMapping table table-condensed'
		});
	var widthTable = ParameterizationXEngineerConstants.WIDTH_ARRAY;

	var physicalProductAttributesValues = {};
	var RangeValueAttributes = {};
	var avoidDupCounterUserSelectionRequired = "";
	var strategySelectorCombobox = [{
			label: XEngineeringNLS.UserDefined,
			value: "UserDefined"
		}
		/*,{
		label: XEngineeringNLS.External,
		value: "External"
		}*/
	];

	var strategyCombobox;

	var partNumberView = {

		initVariable: function () {
			this.cellsIndex = ParameterizationXEngineerConstants.CELLS_INDEX;
		},

		physicalProductAttributes: function (attributeMapping, avoidDupCounterValue, RangeValueAttributes) {
			physicalProductAttributesValues = attributeMapping;
			avoidDupCounterUserSelectionRequired = avoidDupCounterValue;
			this.RangeValueAttributes = RangeValueAttributes;
		},

		buildImgSpan: function (iconChoice, iconSize, iconColor, title) {
			var imgClass = 'fonticon fonticon-' + iconSize + 'x fonticon-' + iconChoice,
			imgSpan = UWA.createElement('span', {
					'class': imgClass,
					'title': title
				});

			imgSpan.setStyle("color", iconColor);
			return imgSpan;
		},

		buildTextTableCell: function (alignment, cellWidth, row, cellFormat, cellTest, colspan) {
			var colspanValue = (colspan) ? colspan : '1';
			var iCell = UWA.createElement('td', {
					'Align': alignment,
					'width': cellWidth,
					'colspan': colspanValue,
					'class': 'partNumberingField' // font-3dsbold
				}).inject(row);

			if (cellFormat) {
				UWA.createElement(cellFormat, {
					text: cellTest
				}).inject(iCell);
			} else {
				iCell.appendText(cellTest);
			}
			return iCell;
		},

		buildAttributeTable: function (data) {

			var pNFieldbody = UWA.createElement('tbody', {
					'class': 'partNumberFieldbody'
				}).inject(partNumberTable);

			var fieldInfo;
			/*fieldInfo = partNumberView.buildPNStrategyRow(data);
			fieldInfo.inject(pNFieldbody);*/

			fieldInfo = partNumberView.buildPNFormulaRow(data);
			fieldInfo.inject(pNFieldbody);

			fieldInfo = partNumberView.buildPNTableHeading();
			fieldInfo.inject(pNFieldbody);

			return partNumberTable;
		},

		/*buildStrategyCombombox: function(iCell, value) {
		var that = this;
		strategyCombobox = new Select({
		nativeSelect: true,
		placeholder: false,
		multiple: false,
		options: strategySelectorCombobox,
		});

		strategyCombobox.inject(iCell);

		strategyCombobox.setValue(value);
		strategyCombobox.addEvent("onChange", function(e) {
		partNumberView.updateStrategy(strategyCombobox.getValue()[0], ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED);
		});
		},*/

		/*buildPNStrategyRow: function(data) {
		var fieldInfo = UWA.createElement('tr', {
		'class': 'partNumberStrategyMapping'
		});

		fieldInfo.value = (data[ParameterizationXEngineerConstants.STRATEGY_CELL] !== "") ? data[ParameterizationXEngineerConstants.STRATEGY_CELL] : "UserDefined";

		var iCell;

		partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.name], fieldInfo, HTML_PARAG_FORMAT, XEngineeringNLS.Strategy);


		iCell = UWA.createElement('td', {
		'width': widthTable[this.cellsIndex.order],
		'align': LEFT_ALIGNMENT,
		'class': 'partNumberingField font-3dslight'// font-3dsbold
		});

		var imgSpan = partNumberView.buildImgSpan('info', "2.5", "black", XEngineeringNLS.StrategyRelatedInfo);
		imgSpan.inject(iCell);

		iCell.inject(fieldInfo);


		partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.type], fieldInfo, HTML_PARAG_FORMAT, "");

		iCell = UWA.createElement('td', {
		'width': widthTable[this.cellsIndex.type].toString(),
		'align': LEFT_ALIGNMENT,
		'colpan': '2',
		'class': 'partNumberingField font-3dslight'// font-3dsbold
		});

		partNumberView.buildStrategyCombombox(iCell, data.Strategy, widthTable[this.cellsIndex.value])
		iCell.inject(fieldInfo);


		partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.action], fieldInfo, HTML_PARAG_FORMAT, "");

		iCell = UWA.createElement('td', {
		'width': widthTable[this.cellsIndex.deployFlag],
		'align': RIGHT_ALIGNMENT,
		'title': XEngineeringNLS.deployStatus,
		'class': 'partNumberingField font-3dslight'// font-3dsbold
		});

		var imgSpan = partNumberView.buildImgSpan('check', '2.5', 'green', XEngineeringNLS.Deployed);
		imgSpan.inject(iCell);
		iCell.value = "success";
		iCell.inject(fieldInfo);

		return fieldInfo;
		},*/

		buildPNFormulaRow: function (data) {
			var fieldInfo,iCell;

			fieldInfo = UWA.createElement('tr', {
					'class': 'partNumberFormulaMapping',
					'id': 'partNumberFormulaMapping'
				});

			fieldInfo.value = [];

			partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.name], fieldInfo, HTML_PARAG_FORMAT, XEngineeringNLS.Formula);

			var imgClass = 'fonticon fonticon-' + '2.5' + 'x  fonticon-info';

			if (data[ParameterizationXEngineerConstants.BUSINESS_LOGIC]) {

				iCell = UWA.createElement('td', {
						'Align': LEFT_ALIGNMENT,
						'width': widthTable[this.cellsIndex.order],
						'class': 'partNumberingField font-3dslight' // font-3dsbold
					}).inject(fieldInfo);

				UWA.createElement(HTML_PARAG_FORMAT, {
					'class': imgClass,
					'title': XEngineeringNLS.FormulaTooltip
				}).inject(iCell);

			} else {
				partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.name], fieldInfo, HTML_PARAG_FORMAT, "");
			}

			iCell = partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.type], fieldInfo, HTML_BOLD_FORMAT, "[" + XEngineeringNLS.freeValue + "]", "4");
			iCell.value = ParameterizationXEngineerConstants.FORMULA_CELL;

			iCell = UWA.createElement('td', {
					'width': widthTable[this.cellsIndex.deployFlag],
					'align': RIGHT_ALIGNMENT,
					'title': XEngineeringNLS.deployStatus,
					'class': 'partNumberingField font-3dslight' // font-3dsbold
				});

			var imgSpan = partNumberView.buildImgSpan('check', '2.5', 'green', XEngineeringNLS.Deployed);
			imgSpan.inject(iCell);
			iCell.value = "success";
			iCell.inject(fieldInfo);

			return fieldInfo;
		},

		buildPNTableHeading: function () {
			var fieldInfo;

			fieldInfo = UWA.createElement('tr', {
					'class': 'success'
				});

			partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.name], fieldInfo, HTML_BOLD_FORMAT, XEngineeringNLS.name);
			partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.order], fieldInfo, HTML_BOLD_FORMAT, XEngineeringNLS.order);
			partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.type], fieldInfo, HTML_BOLD_FORMAT, XEngineeringNLS.type);
			partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.value], fieldInfo, HTML_BOLD_FORMAT, XEngineeringNLS.value);
			partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.action], fieldInfo, HTML_BOLD_FORMAT, XEngineeringNLS.actions);
			partNumberView.buildTextTableCell(RIGHT_ALIGNMENT, widthTable[this.cellsIndex.counterUnicityIndex], fieldInfo, HTML_BOLD_FORMAT, XEngineeringNLS.counterUnicity);
			partNumberView.buildTextTableCell(RIGHT_ALIGNMENT, widthTable[this.cellsIndex.deployFlag], fieldInfo, HTML_BOLD_FORMAT, XEngineeringNLS.deployStatus);

			return fieldInfo;
		},

		addEditButtonToCellRow: function (iCell, fieldInfo) {
			var editElts = ParametersLayoutViewUtilities.createActionElements(XEngineeringNLS.editField, false);
			var editSpan = editElts[0];
			editSpan.setStyle("float", LEFT_ALIGNMENT);
			editSpan.setStyle("padding", "0px 8px");
			editSpan.inject(iCell);
			var editAttributeButton = editElts[1];
			var editPop = editElts[2];

			editAttributeButton.addEvent("onClick", function (event) {
				var fieldToEdit = event.currentTarget.getParent().getParent().getParent();
				partNumberView.editFieldDialog(fieldToEdit, physicalProductAttributesValues, avoidDupCounterUserSelectionRequired);

			});

			return editAttributeButton;
		},

		addRemoveButtonToCellRow: function (iCell, fieldInfo) {
			var removelts = ParametersLayoutViewUtilities.createActionElements(XEngineeringNLS.removeField, true);
			var deleteSpan = removelts[0];
			deleteSpan.setStyle("float", LEFT_ALIGNMENT);
			deleteSpan.setStyle("padding", "0px 8px");
			deleteSpan.inject(iCell);
			var removeAttributeButton = removelts[1];
			var removePop = removelts[2];

			removeAttributeButton.addEvent("onClick", function (e) {
				partNumberView.removefieldLineCallBack(fieldInfo);
			});

			return removeAttributeButton;
		},

		buildValueCellInPNTable: function (valueCell, name, order, type, value, attributeName, isDeployed) {

			var cellText = value;
			if (ParameterizationXEngineerConstants.FORMAT_ATTRIBUTE == type) {
				if (physicalProductAttributesValues && physicalProductAttributesValues[attributeName]) {
					cellText = physicalProductAttributesValues[attributeName];
				} else {
					cellText = attributeName;
				}

			}

			valueCell.setText((cellText) ? cellText : "");
			valueCell.value = value;

			partNumberView.updateFormulaTextFields(order, type, cellText, isDeployed);
		},

		buildPartNumberField: function (fieldInfo, name, order, type, value, attributeName, isCounterUnicitySet, isDeployed, regex) {
			var that = this;
			var iCell;

			fieldInfo.value = isDeployed;

			partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.name], fieldInfo, HTML_PARAG_FORMAT, name);
			partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.order], fieldInfo, HTML_PARAG_FORMAT, order);
			partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.type], fieldInfo, HTML_PARAG_FORMAT, XEngineeringNLS[type]).value = type;
			partNumberView.buildValueCellInPNTable(partNumberView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.value], fieldInfo, HTML_PARAG_FORMAT, value), name, order, type, value, attributeName, isCounterUnicitySet, isDeployed);

			iCell = UWA.createElement('td', {
					'Align': LEFT_ALIGNMENT,
					'width': widthTable[4],
					'class': 'partNumberingField font-3dslight' // font-3dsbold
				}).inject(fieldInfo);

			var editAttributeButton = partNumberView.addEditButtonToCellRow(iCell, fieldInfo);
			var removeAttributeButton = partNumberView.addRemoveButtonToCellRow(iCell, fieldInfo);

			if ((type == ParameterizationXEngineerConstants.FORMAT_ATTRIBUTE) && ((isCounterUnicitySet == true)||(isCounterUnicitySet == "true"))) {
				iCell = UWA.createElement('td', {
						'Align': RIGHT_ALIGNMENT,
						'width': widthTable[5],
						'class': 'partNumberingField font-3dslight'
					}).inject(fieldInfo);
					var imgSpan = partNumberView.buildImgSpan('check', '2.5', 'green',  ParameterizationXEngineerConstants.COUNTER_UNICITY_VALUE);
					imgSpan.inject(iCell);
				iCell.inject(fieldInfo);
			}else{
				partNumberView.buildTextTableCell(RIGHT_ALIGNMENT, widthTable[this.cellsIndex.counterUnicityIndex], fieldInfo, HTML_PARAG_FORMAT, "").value = "";
			}

			iCell = UWA.createElement('td', {
					'Align': RIGHT_ALIGNMENT,
					'width': widthTable[6],
					'class': 'partNumberingField font-3dslight' // font-3dsbold
				}).inject(fieldInfo);

			if (isDeployed == ParameterizationXEngineerConstants.DEPOLOYED) {
				var imgSpan = partNumberView.buildImgSpan('check', '2.5', 'green', XEngineeringNLS.Deployed);
				imgSpan.inject(iCell);
			} else if (isDeployed === ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED) {
				var imgSpan = partNumberView.buildImgSpan('cog', '2.5', 'orange', XEngineeringNLS.Modified);
				imgSpan.inject(iCell);
			}

			iCell.inject(fieldInfo);

			return fieldInfo;
		},

		buildsFieldJsonObject: function (fieldInfo) {
			var type = fieldInfo.cells[this.cellsIndex.type].value;
			var value = fieldInfo.cells[this.cellsIndex.value].getText();
			if (ParameterizationXEngineerConstants.FORMAT_ATTRIBUTE == type) {
				value = fieldInfo.cells[this.cellsIndex.value].value;
			}
			var obj = {};

			obj[ParameterizationXEngineerConstants.OPERATION] = fieldInfo.cells[this.cellsIndex.deployFlag].value;
			obj[ParameterizationXEngineerConstants.NAME] = fieldInfo.cells[this.cellsIndex.name].getText();
			obj[ParameterizationXEngineerConstants.TYPE] = fieldInfo.cells[this.cellsIndex.type].value;
			obj[ParameterizationXEngineerConstants.VALUE] = value;
			obj[ParameterizationXEngineerConstants.ORDER] = fieldInfo.cells[this.cellsIndex.order].getText();
			obj[ParameterizationXEngineerConstants.ATTRIBUTE] = fieldInfo.cells[this.cellsIndex.value][ParameterizationXEngineerConstants.ATTRIBUTE];
			obj[ParameterizationXEngineerConstants.COUNTER] = fieldInfo.cells[this.cellsIndex.value][ParameterizationXEngineerConstants.COUNTER];
			obj[ParameterizationXEngineerConstants.COUNTER_UNICITY] = fieldInfo.cells[this.cellsIndex.counterUnicityIndex].value;
			obj[ParameterizationXEngineerConstants.UPDATE_HIGHEST_COUNTER] = (fieldInfo.cells[this.cellsIndex.counterUnicityIndex].updateHighestCounterValue) ? fieldInfo.cells[this.cellsIndex.counterUnicityIndex].updateHighestCounterValue : false;
			obj[ParameterizationXEngineerConstants.COUNTER_STARTING_VALUES] = (fieldInfo.cells[this.cellsIndex.counterUnicityIndex][ParameterizationXEngineerConstants.COUNTER_STARTING_VALUES]) ? fieldInfo.cells[this.cellsIndex.counterUnicityIndex][ParameterizationXEngineerConstants.COUNTER_STARTING_VALUES] : "";
			obj[ParameterizationXEngineerConstants.REGEX] = fieldInfo.cells[this.cellsIndex.value][ParameterizationXEngineerConstants.REGEX];
			return obj;

		},

		buildJsonObjForPNField: function (operation, name, order, type, value, attributeName, counterSize, counterUnicityValue, counterStartingValue, regex) {
			var obj = {};

			obj[ParameterizationXEngineerConstants.OPERATION] = operation;
			obj[ParameterizationXEngineerConstants.NAME] = name;
			obj[ParameterizationXEngineerConstants.TYPE] = type;
			obj[ParameterizationXEngineerConstants.VALUE] = value;
			obj[ParameterizationXEngineerConstants.ORDER] = order;
			obj[ParameterizationXEngineerConstants.ATTRIBUTE] = attributeName;
			obj[ParameterizationXEngineerConstants.COUNTER] = counterSize;
			obj[ParameterizationXEngineerConstants.REGEX] = regex;

			if (type == ParameterizationXEngineerConstants.FORMAT_ATTRIBUTE) {
				obj[ParameterizationXEngineerConstants.COUNTER_UNICITY] = counterUnicityValue;
			} 
			if (type == ParameterizationXEngineerConstants.FORMAT_COUNTER) {
				obj[ParameterizationXEngineerConstants.COUNTER_STARTING_VALUES] = counterStartingValue;
			}

			return obj;

		},

		buildNewPartNumberField: function (objParam, isDeployedStatus) {
			var fieldInfo;

			fieldInfo = UWA.createElement('tr', {
					'class': 'partNumberFieldMapping'
				});

			partNumberView.buildPartNumberField(fieldInfo, objParam.Name, objParam.Order, objParam.Type, objParam.Value, objParam[ParameterizationXEngineerConstants.ATTRIBUTE], objParam[ParameterizationXEngineerConstants.COUNTER_UNICITY], isDeployedStatus, objParam[ParameterizationXEngineerConstants.REGEX]);
			fieldInfo.cells[this.cellsIndex.value][ParameterizationXEngineerConstants.ATTRIBUTE] = objParam[ParameterizationXEngineerConstants.ATTRIBUTE];
			fieldInfo.cells[this.cellsIndex.value][ParameterizationXEngineerConstants.COUNTER] = objParam[ParameterizationXEngineerConstants.COUNTER];
			fieldInfo.cells[this.cellsIndex.value][ParameterizationXEngineerConstants.REGEX] = objParam[ParameterizationXEngineerConstants.REGEX];
			fieldInfo.cells[this.cellsIndex.deployFlag].value = ParameterizationXEngineerConstants.ADD;
			fieldInfo.cells[this.cellsIndex.counterUnicityIndex].value = objParam[ParameterizationXEngineerConstants.COUNTER_UNICITY];
			fieldInfo.cells[this.cellsIndex.counterUnicityIndex].updateHighestCounterValue = objParam[ParameterizationXEngineerConstants.UPDATE_HIGHEST_COUNTER];
			fieldInfo.cells[this.cellsIndex.counterUnicityIndex][ParameterizationXEngineerConstants.COUNTER_STARTING_VALUES] = (objParam[ParameterizationXEngineerConstants.COUNTER_STARTING_VALUES]) ? objParam[ParameterizationXEngineerConstants.COUNTER_STARTING_VALUES] : "";
			return fieldInfo;
		},

		modifyPartNumberField: function (fieldInfo, objParam, isDeployedStatus) {
			fieldInfo.value = isDeployedStatus;

			var existOrder = fieldInfo.cells[this.cellsIndex.order].getText();
			if (objParam.Order != existOrder) {
				partNumberView.updateFormulaTextFields(existOrder, objParam.Type, null, ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED);
			}

			fieldInfo.cells[this.cellsIndex.name].setText(objParam.Name);
			fieldInfo.cells[this.cellsIndex.order].setText(objParam.Order);
			fieldInfo.cells[this.cellsIndex.type].setText(XEngineeringNLS[objParam.Type]);
			fieldInfo.cells[this.cellsIndex.type].value = objParam.Type;
			fieldInfo.cells[this.cellsIndex.counterUnicityIndex].value = objParam[ParameterizationXEngineerConstants.COUNTER_UNICITY];
			fieldInfo.cells[this.cellsIndex.counterUnicityIndex].updateHighestCounterValue = objParam[ParameterizationXEngineerConstants.UPDATE_HIGHEST_COUNTER];
			fieldInfo.cells[this.cellsIndex.counterUnicityIndex][ParameterizationXEngineerConstants.COUNTER_STARTING_VALUES] = objParam[ParameterizationXEngineerConstants.COUNTER_STARTING_VALUES];

			partNumberView.buildValueCellInPNTable(fieldInfo.cells[this.cellsIndex.value], objParam.Name, objParam.Order, objParam.Type, (objParam.Value) ? objParam.Value : "", objParam[ParameterizationXEngineerConstants.ATTRIBUTE], isDeployedStatus);

			fieldInfo.cells[this.cellsIndex.value][ParameterizationXEngineerConstants.ATTRIBUTE] = objParam[ParameterizationXEngineerConstants.ATTRIBUTE];
			fieldInfo.cells[this.cellsIndex.value][ParameterizationXEngineerConstants.COUNTER] = objParam[ParameterizationXEngineerConstants.COUNTER];
			fieldInfo.cells[this.cellsIndex.value][ParameterizationXEngineerConstants.REGEX] = objParam[ParameterizationXEngineerConstants.REGEX];
			if (objParam[ParameterizationXEngineerConstants.COUNTER_UNICITY] == true || objParam[ParameterizationXEngineerConstants.COUNTER_UNICITY] == 'true'){
				var counterUnicityCell = fieldInfo.cells[this.cellsIndex.counterUnicityIndex];
				counterUnicityCell.empty();
				var imgSpan = partNumberView.buildImgSpan('check', '2.5', 'green', ParameterizationXEngineerConstants.COUNTER_UNICITY_VALUE);
				imgSpan.inject(counterUnicityCell);
			} else {
		        fieldInfo.cells[this.cellsIndex.counterUnicityIndex].setText("");
			}
			fieldInfo.cells[this.cellsIndex.counterUnicityIndex][ParameterizationXEngineerConstants.COUNTER_UNICITY] = objParam[ParameterizationXEngineerConstants.COUNTER_UNICITY];
			/*}else{
				fieldInfo.cells[this.cellsIndex.counterUnicityIndex][ParameterizationXEngineerConstants.COUNTER_UNICITY] = objParam[ParameterizationXEngineerConstants.COUNTER_UNICITY];
			}*/

			var deploycell = fieldInfo.cells[this.cellsIndex.deployFlag];
			deploycell.empty();

			var imgSpan = partNumberView.buildImgSpan('cog', '2.5', 'orange', XEngineeringNLS.Modified);
			imgSpan.inject(deploycell);

			deploycell.value = ParameterizationXEngineerConstants.MODIFY;

			return fieldInfo;
		},

		updateFormulaTextFields: function (index, type, value, isDeployed) {
			var field = document.querySelector(".partNumberFormulaMapping");
			if (field) {
				var newVal = "";
				if (type) {
					if (type == ParameterizationXEngineerConstants.FORMAT_ATTRIBUTE && value) {
						newVal = "{" + value + "}";
					} else if (type == ParameterizationXEngineerConstants.FORMAT_COUNTER && value) {
						newVal = "&lt;" + XEngineeringNLS.counterValue + "&gt;";
					} else if (type == ParameterizationXEngineerConstants.FORMAT_FREE && (value != null)) {
						newVal = "[" + XEngineeringNLS.freeValue + "]";
					} else if (value) {
						newVal = value;
					}
				}

				field.value[index] = newVal;
				field.cells[this.cellsIndex.type].empty();
				field.cells[this.cellsIndex.type].setStyle("font-size", "21px");

				var newFormula = field.value.join("");
				var counterInfoCell = field.cells[this.cellsIndex.type];
				if (newFormula != "") {
					if (newFormula.indexOf(XEngineeringNLS.counterValue) == -1) {
						counterInfoCell.empty();
						var imgClass = 'fonticon fonticon-' + '1' + 'x  fonticon-attention';
						UWA.createElement(HTML_PARAG_FORMAT, {
							'class': imgClass,
							'title': XEngineeringNLS.counterTooltipAttention
						}).inject(counterInfoCell);
					} else {
						counterInfoCell.empty();
					}
				}
				if (!newFormula) {
					field.cells[this.cellsIndex.type].addContent("[" + XEngineeringNLS.freeValue + "]");
				}
				field.cells[this.cellsIndex.type].addContent(field.value.join(""));

				var iCell = field.cells[this.cellsIndex.value];
				if (isDeployed == ParameterizationXEngineerConstants.DEPOLOYED) {
					iCell.empty();
					var imgSpan = partNumberView.buildImgSpan('check', '2.5', 'green', XEngineeringNLS.Deployed);
					imgSpan.inject(iCell);
				} else if (isDeployed === ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED) {
					iCell.empty();
					var imgSpan = partNumberView.buildImgSpan('cog', '2.5', 'orange', XEngineeringNLS.Modified); ;
					imgSpan.inject(iCell);
				}
			}
		},

		removefieldLineCallBack: function (fieldInfo) {

			if (fieldInfo != "undefined") {
				partNumberView.updateFormulaTextFields(fieldInfo.cells[this.cellsIndex.order].getText(), fieldInfo.cells[this.cellsIndex.type].value, null, ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED);
				if (fieldInfo.value === ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED) {
					fieldInfo.remove();
				} else {
					partNumberView.setForRemoveFieldLine(fieldInfo);
				}
			}
		},

		resetForAdd: function (fieldInfo) {
			partNumberView.updateFormulaTextFields(fieldInfo.cells[this.cellsIndex.order].getText(), fieldInfo.cells[this.cellsIndex.type].value, null, ParameterizationXEngineerConstants.DEPOLOYED);
		},

		resetForRemove: function (fieldInfo) {

			var cellValue = fieldInfo.cells[partNumberView.cellsIndex.deployFlag].value;
			var imgSpan = partNumberView.buildImgSpan('check', '2.5', 'green', XEngineeringNLS.Deployed);
			var actionCell = fieldInfo.cells[partNumberView.cellsIndex.action];
			var deploycell = fieldInfo.cells[partNumberView.cellsIndex.deployFlag];

			partNumberView.addEditButtonToCellRow(actionCell, fieldInfo);
			partNumberView.addRemoveButtonToCellRow(actionCell, fieldInfo);
			deploycell.empty();
			imgSpan.inject(deploycell);

			partNumberView.updateFormulaTextFields(fieldInfo.cells[this.cellsIndex.order].getText(), fieldInfo.cells[this.cellsIndex.type].value, fieldInfo.cells[this.cellsIndex.value].getText(), ParameterizationXEngineerConstants.DEPOLOYED);
		},

		resetForModify: function (fieldInfo, savedInfo) {

			var imgSpan = partNumberView.buildImgSpan('check', '2.5', 'green', XEngineeringNLS.Deployed);
			var actionCell = fieldInfo.cells[partNumberView.cellsIndex.action];
			var deploycell = fieldInfo.cells[partNumberView.cellsIndex.deployFlag];

			if (savedInfo) {
				var existOrder = fieldInfo.cells[this.cellsIndex.order].getText();
				if (savedInfo[ParameterizationXEngineerConstants.ORDER] != existOrder) {
					partNumberView.updateFormulaTextFields(existOrder, savedInfo[ParameterizationXEngineerConstants.TYPE], null, ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED);
				}

				fieldInfo.cells[this.cellsIndex.name].setText(savedInfo[ParameterizationXEngineerConstants.NAME]);
				fieldInfo.cells[this.cellsIndex.type].setText(XEngineeringNLS[savedInfo[ParameterizationXEngineerConstants.TYPE]]);
				fieldInfo.cells[this.cellsIndex.type].value = savedInfo[ParameterizationXEngineerConstants.TYPE];
				fieldInfo.cells[this.cellsIndex.order].setText(savedInfo[ParameterizationXEngineerConstants.ORDER]);

				fieldInfo.cells[this.cellsIndex.counterUnicityIndex].value = (savedInfo[ParameterizationXEngineerConstants.COUNTER_UNICITY] == "true" || savedInfo[ParameterizationXEngineerConstants.COUNTER_UNICITY] == true);
				fieldInfo.cells[this.cellsIndex.counterUnicityIndex].updateHighestCounterValue =  savedInfo[ParameterizationXEngineerConstants.UPDATE_HIGHEST_COUNTER];
				fieldInfo.cells[this.cellsIndex.counterUnicityIndex][ParameterizationXEngineerConstants.COUNTER_STARTING_VALUES] = savedInfo[ParameterizationXEngineerConstants.COUNTER_STARTING_VALUES];
				fieldInfo.cells[this.cellsIndex.value][ParameterizationXEngineerConstants.ATTRIBUTE] = savedInfo[ParameterizationXEngineerConstants.ATTRIBUTE];
				fieldInfo.cells[this.cellsIndex.value][ParameterizationXEngineerConstants.REGEX] = savedInfo[ParameterizationXEngineerConstants.REGEX];
				if (savedInfo[ParameterizationXEngineerConstants.COUNTER_UNICITY] == true || savedInfo[ParameterizationXEngineerConstants.COUNTER_UNICITY] == 'true') {
					var counterUnicityCell = fieldInfo.cells[this.cellsIndex.counterUnicityIndex];
					counterUnicityCell.empty();
					var imgSpancounterUnicityCell = partNumberView.buildImgSpan('check', '2.5', 'green', ParameterizationXEngineerConstants.COUNTER_UNICITY_VALUE);
					imgSpancounterUnicityCell.inject(counterUnicityCell);
				} else {
					fieldInfo.cells[this.cellsIndex.counterUnicityIndex].setText("");
				}
				partNumberView.buildValueCellInPNTable(fieldInfo.cells[this.cellsIndex.value], savedInfo[ParameterizationXEngineerConstants.NAME], savedInfo[ParameterizationXEngineerConstants.ORDER], savedInfo[ParameterizationXEngineerConstants.TYPE], savedInfo[ParameterizationXEngineerConstants.VALUE], savedInfo[ParameterizationXEngineerConstants.ATTRIBUTE], ParameterizationXEngineerConstants.DEPOLOYED);
			}
			deploycell.empty();
			imgSpan.inject(deploycell);
		},

		resetForFieldLineChanges: function (fieldInfo, savedInfo) {

			if (fieldInfo.value == ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED) {
				var cellValue = fieldInfo.cells[partNumberView.cellsIndex.deployFlag].value;
				if (cellValue == ParameterizationXEngineerConstants.ADD) {
					partNumberView.resetForAdd(fieldInfo);
					return fieldInfo;
				} else if (cellValue == ParameterizationXEngineerConstants.REMOVE) {
					partNumberView.resetForRemove(fieldInfo);

				} else if (cellValue == ParameterizationXEngineerConstants.MODIFY) {
					partNumberView.resetForModify(fieldInfo, savedInfo);
				}

				fieldInfo.value = ParameterizationXEngineerConstants.DEPOLOYED;
				fieldInfo.cells[partNumberView.cellsIndex.deployFlag].value = null;
			}

		},

		setForRemoveFieldLine: function (fieldInfo) {
			fieldInfo.value = ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED;
			var arrayAction = fieldInfo.cells[partNumberView.cellsIndex.action].getElements('span');
			arrayAction.forEach(function (action) {
				action.hide();
			});

			var deploycell = fieldInfo.cells[partNumberView.cellsIndex.deployFlag];
			var imgSpan = partNumberView.buildImgSpan('trash', '1.5', 'red', XEngineeringNLS.removedField);

			deploycell.empty();

			deploycell.value = ParameterizationXEngineerConstants.REMOVE;

			imgSpan.inject(deploycell);
		},

		/*updateStrategy: function(selectedValue, isDeployed) {
		var strategyField = document.querySelector(".partNumberStrategyMapping");
		strategyField.value = selectedValue;

		strategyCombobox.setValue(selectedValue)

		var deployCell = strategyField.cells[this.cellsIndex.deployFlag];
		deployCell.empty();

		if (isDeployed == ParameterizationXEngineerConstants.DEPOLOYED) {
		var imgSpan = partNumberView.buildImgSpan('check', '2.5', 'green', XEngineeringNLS.Deployed);
		imgSpan.inject(deployCell);
		} else if (isDeployed === ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED) {
		var imgSpan = partNumberView.buildImgSpan('cog', '2.5', 'orange', XEngineeringNLS.Modified);
		imgSpan.inject(deployCell);
		}

		},*/

		updateAttributeCounterUnicityValues(modal) {
			if (!modal.partNumberAttributeComboboxInCounter) return;

			let attributesInFormula = modal.expressionList.Attribute;
			let attributesSelectedForCounterUnicity = modal.partNumberAttributeComboboxInCounter.value
			if (Array.isArray(attributesInFormula) && attributesInFormula.length > 0) {
				attributesInFormula.forEach((attribute) => {
					let attributeName = attribute.cells[modal.CELLS_INDEX.value][ParameterizationXEngineerConstants.ATTRIBUTE];
					let existingCounterUnicity = attribute.cells[modal.CELLS_INDEX[ParameterizationXEngineerConstants.COUNTER_UNICITY_INDEX]].value;
					existingCounterUnicity = (existingCounterUnicity == true || existingCounterUnicity == 'true') ? 'true' : false;
					let userEditedFormat = this.buildsFieldJsonObject(attribute);
					userEditedFormat[ParameterizationXEngineerConstants.OPERATION] = ParameterizationXEngineerConstants.MODIFY;
					if (attributesSelectedForCounterUnicity.includes(attributeName) && existingCounterUnicity != 'true') {
						userEditedFormat[ParameterizationXEngineerConstants.COUNTER_UNICITY] = "true";
						this.modifyPartNumberField(attribute, userEditedFormat, ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED);
					} else if (!attributesSelectedForCounterUnicity.includes(attributeName) && existingCounterUnicity == 'true') {
						userEditedFormat[ParameterizationXEngineerConstants.COUNTER_UNICITY] = false;
						this.modifyPartNumberField(attribute, userEditedFormat, ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED);
					}
				})
			}

		},

		editFieldDialog: function (editField, result, avoidDupCounterUserValue) {

			var options = {
				className: "part-number-edit-modal",
				title: XEngineeringNLS.editField,
				AvoidDupCounterUserSelectionRequired : avoidDupCounterUserValue
			};

			var that = this;
			this.modal = new XENGModal(options);
			this.modal.attributes = result;
			this.modal.rangeValuedAttributes = this.RangeValueAttributes;
			this.modal.getExpressionList();

			function _getFooter() {
				return "<button type='button'  name='addButton' id='add-button' class='btn btn-primary'>" + XEngineeringNLS.add + "</button> " + "</button>" + "<button type='button' name='cancelButton' id='cancel-button' class='btn btn-default'>" + XEngineeringNLS.cancel + "</button>"
			}
			this.modal.modal.setFooter(_getFooter());
			this.modal.getModalBody();
			this.modal._bindFooterEvent();

			var editingField = editField;

			var rowsOfMappedFields = document.querySelectorAll(".partNumberFieldMapping");
			var successFields = document.querySelector('.success');
			var toCheckTheExistingRows = rowsOfMappedFields.length;

			var fetchedData = this.buildsFieldJsonObject(editField);

			this.modal.nameTextBox.setValue(fetchedData.Name);
			this.modal.numberOrderBox.setValue(fetchedData.Order);
			this.modal.partNumberTypeCombobox.select(fetchedData.Type, true);
			this.modal.nameTextBox.disable();

			var counterUnicityCheckboxValue = (fetchedData[ParameterizationXEngineerConstants.COUNTER_UNICITY] == "true" || fetchedData[ParameterizationXEngineerConstants.COUNTER_UNICITY] == true) ? true : false;

			if (fetchedData.Type == ParameterizationXEngineerConstants.FORMAT_STRING) {
				this.modal.valueTextBox.setValue(fetchedData.Value);
			} else if (fetchedData.Type == ParameterizationXEngineerConstants.FORMAT_ATTRIBUTE) {
				this.modal.partNumberAttributeCombobox.select(editingField.cells[this.cellsIndex.value][ParameterizationXEngineerConstants.ATTRIBUTE], true);
				this.modal.valueDynTextBox.setValue(fetchedData.Value);
				this.modal.counterCheckbox.setCheck(counterUnicityCheckboxValue);
			} else if (fetchedData.Type == ParameterizationXEngineerConstants.FORMAT_COUNTER) {
				var numberOfDigits = fetchedData.CounterSize;
				this.modal.counterNumberBox.setValue(numberOfDigits);
			} else if (fetchedData.Type == ParameterizationXEngineerConstants.FORMAT_FREE) {
				this.modal.regexTextBox.setValue(fetchedData.RegExpr);
			}

			if (this.modal.partNumberGlobalCounterStartingValue && fetchedData.Value){
				this.modal.partNumberGlobalCounterStartingValue.setValue(fetchedData.Value);
				this.modal.partNumberGlobalCounterValue = fetchedData.Value;
			}

			if ( fetchedData.CounterStartingValues) {
				if(this.modal.partNumberLocalCounterStartingValue){
					this.modal.partNumberLocalCounterStartingValue.counterValue = fetchedData.CounterStartingValues 
				}
				this.modal.partNumberLocalCounterValue = fetchedData.CounterStartingValues;
			}
			this.tableWdthArray = ParameterizationXEngineerConstants.WIDTH_ARRAY

				this.modal.partNumberTypeCombobox.disable();

			this.modal.getContent().getElements('.btn').forEach(function (element) {

				if (element.name === 'cancelButton') {
					element.addEventListener('click', function () {
						that.modal.destroy();
					});
				}
				if (element.name === 'addButton') {

					element.addEvent('click', function () {
						var userEditedFormat = that.modal.getUserEnteredValues();
						var duplicateData = {};
						var checkStatus = {};
						checkStatus.isSuccess = true;

						var toDisplayOver = that.modal.getContent().getElement('.enox-part-number-content');

						if (that.modal.validateEnteredNameValueNotNull()) {
							that.modal.displayAlertMessage(XEngineeringNLS.nameNullMessage, toDisplayOver);
						} else if (that.modal.validateEnteredOrderValueNotNull()) {
							that.modal.displayAlertMessage(XEngineeringNLS.orderNullMessage, toDisplayOver);
						} else if (that.modal.validatSelectedTypeFieldValueNotNull()) {
							that.modal.displayAlertMessage(XEngineeringNLS.selectTypeMessage, toDisplayOver);
						} else if (that.modal.validateSelectedAttributeFieldValueNotNull()) {
							that.modal.displayAlertMessage(XEngineeringNLS.selectAttributeMessage, toDisplayOver);
						} else if (that.modal.validateEnteredCounterFieldValueNotNull()) {
							that.modal.displayAlertMessage(XEngineeringNLS.counterIsEmptyMessage, toDisplayOver);
						} else if (that.modal.validateEnteredValueFieldValueNotNull()) {
							that.modal.displayAlertMessage(XEngineeringNLS.valueEmptyMessage, toDisplayOver);
						} else {
							if (!that.modal.validateEnteredNameValue("edit", editingField).isValid) {
								that.modal.displayAlertMessage(XEngineeringNLS.nameMessage + ' ' + XEngineeringNLS.alreadyExists, toDisplayOver);
							} else if (!that.modal.validateEnteredOrderValue("edit", editingField).isValid) {
								that.modal.displayAlertMessage(XEngineeringNLS.orderMessage + ' ' + XEngineeringNLS.alreadyExists, toDisplayOver);
							} else {
								var userSelectedFormat = that.modal.getUserEnteredValues();
								partNumberView.updateAttributeCounterUnicityValues(that.modal);
								userEditedFormat[ParameterizationXEngineerConstants.OPERATION] = ParameterizationXEngineerConstants.MODIFY;
								var fieldInfo = partNumberView.modifyPartNumberField(editingField, userEditedFormat, ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED);
								that.modal.destroy();
							}
						}
					});
				}
			});

			this.modal.show();

		}

	};
	partNumberView.initVariable();
	return partNumberView;
});

define('DS/ParameterizationSkeleton/Views/ParameterizationXEngineering/ParamXENPartNumberFormulaView', [
    'UWA/Core',
    'UWA/Class/View',
    'DS/UIKIT/Mask',
    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
    'DS/ParameterizationSkeleton/Views/ParameterizationXEngineering/PartNumberingViewUtilities',
    'DS/ParameterizationSkeleton/Views/ParameterizationXEngineering/ParameterizationXEngineerConstants',
    'DS/ParameterizationSkeleton/Views/ParameterizationXEngineering/XENGModal',
    'DS/UIKIT/Input/Button',
    'DS/UIKIT/Alert',
    'DS/ParameterizationSkeleton/Views/ParametersLayoutView',
    'i18n!DS/ParameterizationSkeleton/assets/nls/XEngineeringNLS',
], (
    UWA,
    View,
    Mask,
    WAFData,
    ParametersLayoutViewUtilities,
    URLHandler,
    PartNumberingViewUtilities,
    ParameterizationXEngineerConstants,
    XENGModal,
    Button,
    Alert,
    ParametersLayoutView,
    XEngineeringNLS,
) => {
    const extendedView = View.extend({
        tagName: 'div',
        className: 'generic-detail',

        init(options) {
            const initDate = new Date();
            options = UWA.clone(options || {}, false);
            this._parent(options);

            this.options = options;
            this.contentDiv = null;
            this.paramScroller = null;
            this.paramAltSubScroller = null;
            this.userMessaging = null;
            this.lastAlertDate = initDate.getTime();
            this.controlDiv = null;
        },

        setup(options) {
            UWA.log('XEngineering Layout::setup!');
            UWA.log(options);
        },

        render() {
            UWA.log('XEngineering LayoutView::render');
            let introDiv;
            let mappingDiv;
            const that = this;

            this.contentDiv = UWA.createElement('div', {
                id: 'typeMainXENDiv',
            });

            introDiv = UWA.createElement('div', {
                class: 'information',
            }).inject(this.contentDiv);

            UWA.createElement('p', {
                text: XEngineeringNLS.intro,
                class: 'font-3dslight',
            }).inject(introDiv);
            this.parentView = new ParametersLayoutView(this.options);

            this.controlDiv = ParametersLayoutViewUtilities.createApplyResetToolbar.call(this, this.contentDiv, true,
                this.applyParams.bind(this), this.resetParams.bind(this));

            this.container.setContent(this.contentDiv);
            this.listenTo(this.collection, {
                onSync: that.onCompleteRequestMapping,
            });

            return this;
        },

        onCompleteRequestMapping() {
            const that = this;
            UWA.log('XEngineering Layout::Complete rendering!');

            const collection = this.collection._models[0]._attributes;

            PartNumberingViewUtilities.physicalProductAttributes(collection.PhysicalProductAttributes, collection[ParameterizationXEngineerConstants.AVOID_DUP_COUNTER], collection.RangeValueAttributes);

            const fields = collection.ExpressionList;
            const nosOfFields = (fields) ? fields.length : 0;

            this.partNumberingParentDiv = ParametersLayoutViewUtilities.createParamsContainerDiv();;

            const partNumberTable = PartNumberingViewUtilities.buildAttributeTable(collection);
            partNumberTable.inject(this.partNumberingParentDiv);
	    
            this.partNumberingParentDiv.inject(this.contentDiv);

            const AddMappingButton = new Button({
                className: 'AddPartNumberFieldButton',
                icon: 'plus-circled',
                attributes: {
                    disabled: false,
                    'aria-hidden': 'true',
                    title: XEngineeringNLS.AddFieldMappingTooltip,
                },
                events: {
                    onClick(e) {
                        that.ShowAddNewFieldPanel(that, partNumberTable.getElement('.partNumberFieldbody'));
                    },
                },
            }).inject(this.contentDiv);


            for (let i = 0; i < nosOfFields; i++) {
                const field = fields[i];
                const deployedStatus = (field.Deployed && field.Deployed == 'True') ? ParameterizationXEngineerConstants.DEPOLOYED : ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED;
                const counterUnicityValue = field[ParameterizationXEngineerConstants.COUNTER_UNICITY] ? field[ParameterizationXEngineerConstants.COUNTER_UNICITY] : false;
                const fieldInfo = PartNumberingViewUtilities.buildNewPartNumberField(
                    PartNumberingViewUtilities.buildJsonObjForPNField(ParameterizationXEngineerConstants.ADD, field.Name, field.Order, field.Type, field.Value, field[ParameterizationXEngineerConstants.ATTRIBUTE], field[ParameterizationXEngineerConstants.COUNTER], counterUnicityValue, field[ParameterizationXEngineerConstants.COUNTER_STARTING_VALUES], field[ParameterizationXEngineerConstants.REGEX]),
                    deployedStatus,
                );
                fieldInfo.inject(partNumberTable.getElement('.partNumberFieldbody'));
            }

            Mask.unmask(this.contentDiv);
        },

        resetParams() {
            const that = this;
            Mask.mask(this.contentDiv);
            const url = `${URLHandler.getURL()}/resources/v1/xENGParameterization/resetAdminPartNumberProperties?tenant=${URLHandler.getTenant()}`;
            WAFData.authenticatedRequest(url, {
                timeout: 250000,
                method: 'GET',
                type: 'json',

                headers: {
                    'Content-Type': 'application/json',
                    Accept: 'application/json',
                },

                onFailure(json) {
                    Mask.unmask(that.contentDiv);
                    that.onResetFailure(XEngineeringNLS.ResetError);
                },

                onComplete(json) {
                    if (json && json.ExpressionList) {
                        json.ExpressionList.sort((a, b) => {
                            if (a.Order && b.Order) {
                                return a.Order - b.Order;
                            }
                        });
                    }
                    that.onResetSuccess(json);
                    Mask.unmask(that.contentDiv);
                    that.getAlertMessage(XEngineeringNLS.ResetSuccess, 'success', that.contentDiv);
                },

            });
        },

        onResetSuccess(json) {
            const savedInfo = json.ExpressionList;
            const that = this;
            const fieldsToBeRemoved = new Array();
            const rowsOfMappedFields = this.contentDiv.getElementsByClassName('partNumberFieldMapping');
            for (let i = 0; i < rowsOfMappedFields.length; i++) {
                if (rowsOfMappedFields[i].value == ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED) {
                    if ((savedInfo && savedInfo[i])) {
                        const fieldInfo = (that.collection._models[0]._attributes.ExpressionList && that.collection._models[0]._attributes.ExpressionList[i]) ? that.collection._models[0]._attributes.ExpressionList[i] : savedInfo[i];
                        fieldsToBeRemoved.push(PartNumberingViewUtilities.resetForFieldLineChanges(rowsOfMappedFields[i], fieldInfo));
                    } else {
                        fieldsToBeRemoved.push(PartNumberingViewUtilities.resetForFieldLineChanges(rowsOfMappedFields[i]));
                    }
                }
            }
            fieldsToBeRemoved.forEach((attrMapping) => {
                if (attrMapping) {
                    attrMapping.remove();
                }
            });
            // PartNumberingViewUtilities.updateStrategy(json.Strategy, ParameterizationXEngineerConstants.DEPOLOYED);
            PartNumberingViewUtilities.updateFormulaTextFields(ParameterizationXEngineerConstants.MAX_ROWS + 1, null, null, ParameterizationXEngineerConstants.DEPOLOYED);
        },

        onResetFailure(message) {
            this.getAlertMessage(message, 'error', this.contentDiv);
        },

        applyParams() {
            const that = this;
            const rowsOfMappedFields = this.contentDiv.getElementsByClassName('partNumberFieldMapping');
            const payloadToSend = {};
            //                payloadToSend.Strategy = document.querySelector(".partNumberStrategyMapping").value;
            Mask.mask(this.contentDiv);
            payloadToSend.ExpressionList = [];
            for (let i = 0; i < rowsOfMappedFields.length; i++) {
                if (rowsOfMappedFields[i].value == ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED) {
                    const value = PartNumberingViewUtilities.buildsFieldJsonObject(rowsOfMappedFields[i]);
                    payloadToSend.ExpressionList.push(value);
                }
            }

            const url = `${URLHandler.getURL()}/resources/v1/xENGParameterization/setAdminPartNumberProperties?tenant=${URLHandler.getTenant()}`;

            WAFData.authenticatedRequest(url, {
                timeout: 250000,
                method: 'POST',
                data: JSON.stringify(payloadToSend),
                type: 'json',

                headers: {
                    'Content-Type': 'application/json',
                    Accept: 'application/json',
                },

                onFailure(json) {
                    Mask.unmask(that.contentDiv);
                    that.onApplyFailure(XEngineeringNLS.ApplyError);
                },

                onComplete(json) {
                    if (json.Action == 'Success') {
                        that.onApplySuccess(payloadToSend.Strategy);
                        Mask.unmask(that.contentDiv);
                        that.getAlertMessage(XEngineeringNLS.ApplySuccess, 'success', that.contentDiv);
                    } else {
                        Mask.unmask(that.contentDiv);
                        that.onApplyFailure(json.message);
                    }
                },

            });
        },

        onApplyFailure(message) {
            this.getAlertMessage(message, 'error', this.contentDiv);
        },

        onApplySuccess(strategyValue) {
            // PartNumberingViewUtilities.updateStrategy(strategyValue, ParameterizationXEngineerConstants.DEPOLOYED);
            const fieldsToBeRemoved = new Array();

            const rowsOfMappedFields = this.contentDiv.getElementsByClassName('partNumberFieldMapping');
            for (let i = 0; i < rowsOfMappedFields.length; i++) {
                if (rowsOfMappedFields[i].value == ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED) {
                    const statusCell = rowsOfMappedFields[i].cells[6];
                    if (statusCell.value == ParameterizationXEngineerConstants.ADD || statusCell.value == ParameterizationXEngineerConstants.MODIFY) {
                        rowsOfMappedFields[i].cells[6].empty();
                        rowsOfMappedFields[i].value = ParameterizationXEngineerConstants.DEPOLOYED;
                        var imgSpan = PartNumberingViewUtilities.buildImgSpan('check', '1.5', 'green', XEngineeringNLS.Deployed);
                        imgSpan.inject(rowsOfMappedFields[i].cells[6]);
                    }
                    if (rowsOfMappedFields[i].cells[6].value == ParameterizationXEngineerConstants.REMOVE) {
                        fieldsToBeRemoved.push(rowsOfMappedFields[i]);
                    }
                }
            }

            fieldsToBeRemoved.forEach((attrMapping) => {
                attrMapping.remove();
            });

            const formulaField = document.querySelector('.partNumberFormulaMapping');
            formulaField.cells[3].empty();
            var imgSpan = ParametersLayoutViewUtilities.buildImgSpan('check', '1.5', 'green', XEngineeringNLS.Deployed);
            imgSpan.inject(formulaField.cells[3]);
        },

        ShowAddNewFieldPanel(attrtbody) {
            this.createPartNumberingDialogBox(attrtbody);
            const isDeployed = ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED;
        },

        createPartNumberingDialogBox(attrtbody) {
            var that = this;
            const attributes = (this.collection._models[0]._attributes && this.collection._models[0]._attributes.PhysicalProductAttributes);
            const options = {
                className: 'part-number-modal',
                title: XEngineeringNLS.AddFieldMappingTooltip,
                [ParameterizationXEngineerConstants.AVOID_DUP_COUNTER]: this.collection._models[0]._attributes[ParameterizationXEngineerConstants.AVOID_DUP_COUNTER],
            };

            this.modal = new XENGModal(options);

            this.modal.getAttributes(attributes);
            this.modal.rangeValuedAttributes = this.collection._models[0]._attributes['RangeValueAttributes'];
            this.modal.getExpressionList();

            if (this.modal.getTotalFormatRows() == ParameterizationXEngineerConstants.MAX_ROWS) {
                const alert = that.modal.displayAlertMessage(XEngineeringNLS.maxLimitOfRows, document.querySelector('#typeMainXENDiv').getChildren()[0]);
            } else {
                function _getFooter() {
                    return `<button type='button'  name='addButton' id='add-button' class='btn btn-primary'>${XEngineeringNLS.add}</button> ` + '</button>' + `<button type='button' name='cancelButton' id='cancel-button' class='btn btn-default'>${XEngineeringNLS.cancel}</button>`;
                }

                this.modal.modal.setFooter(_getFooter());
                this.modal.getModalBody();
                this.modal._bindFooterEvent();
                this.modal.getContent().getElements('.btn').forEach((element) => {
                    if (that.modal.isCounterExists(ParameterizationXEngineerConstants.TYPE)) {
                        that.modal.partNumberTypeCombobox.disable(ParameterizationXEngineerConstants.FORMAT_COUNTER);
                    }

                    if (element.name === 'cancelButton') {
                        element.addEventListener('click', () => {
                            that.modal.destroy();
                        });
                    } else if (element.name === 'addButton') {
                        element.addEvent('click', () => {
                            const toDisplayOver = that.modal.getContent().getElement('.enox-part-number-content');

                            if (that.modal.validateEnteredNameValueNotNull()) {
                                that.modal.displayAlertMessage(XEngineeringNLS.nameNullMessage, toDisplayOver);
                            } else if (that.modal.validateEnteredOrderValueNotNull()) {
                                that.modal.displayAlertMessage(XEngineeringNLS.orderNullMessage, toDisplayOver);
                            } else if (that.modal.validatSelectedTypeFieldValueNotNull()) {
                                that.modal.displayAlertMessage(XEngineeringNLS.selectTypeMessage, toDisplayOver);
                            } else if (that.modal.validateSelectedAttributeFieldValueNotNull()) {
                                that.modal.displayAlertMessage(XEngineeringNLS.selectAttributeMessage, toDisplayOver);
                            } else if (that.modal.validateEnteredCounterFieldValueNotNull()) {
                                that.modal.displayAlertMessage(XEngineeringNLS.counterIsEmptyMessage, toDisplayOver);
                            } else if (that.modal.validateEnteredValueFieldValueNotNull()) {
                                that.modal.displayAlertMessage(XEngineeringNLS.valueEmptyMessage, toDisplayOver);
                            } else if (!that.modal.validateEnteredNameValue().isValid) {
                                that.modal.displayAlertMessage(`${XEngineeringNLS.nameMessage} ${XEngineeringNLS.alreadyExists}`, toDisplayOver);
                            } else if (!that.modal.validateEnteredOrderValue().isValid) {
                                that.modal.displayAlertMessage(`${XEngineeringNLS.orderMessage} ${XEngineeringNLS.alreadyExists}`, toDisplayOver);
                            } else {
                                const userSelectedFormat = that.modal.getUserEnteredValues();
                                PartNumberingViewUtilities.updateAttributeCounterUnicityValues(that.modal);
                                userSelectedFormat[ParameterizationXEngineerConstants.OPERATION] = ParameterizationXEngineerConstants.ADD;
                                const fieldInfo = PartNumberingViewUtilities.buildNewPartNumberField(userSelectedFormat, ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED);
                                fieldInfo.inject(attrtbody.getElement('.partNumberFieldbody'));
                                that.modal.destroy();
                            }
                        });
                    }
                });

                that.modal.show();
            }
        },

        getAlertMessage(message, className, toDisplayOn) {
            this.alertOptions = {
                visible: true,
                className: 'param-alert',
                messageClassName: className,
                closable: true,
                renderTo: toDisplayOn,
                autoHide: true,
                hideDelay: 2000,
            };

            const alert = new Alert(this.alertOptions);
            alert.add({
                message,
            });
        },

        destroy() {
            this.stopListening();
            this._parent.apply(this, arguments);
        },
    });

    return extendedView;
});

define('DS/ParameterizationSkeleton/Views/ParameterizationXEngineering/PartNumberingLayoutView', [
		'UWA/Core',
		'UWA/Class/View',
		'DS/UIKIT/Mask',
		'DS/UIKIT/Scroller',
		'DS/WAFData/WAFData',
		'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
		'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
		'DS/ParameterizationSkeleton/Views/ParameterizationXEngineering/PartNumberingViewUtilities',
		'DS/ParameterizationSkeleton/Views/ParameterizationXEngineering/ParameterizationXEngineerConstants',
		'DS/ParameterizationSkeleton/Views/ParameterizationXEngineering/XENGModal',
		'DS/UIKIT/Input/Button',
		'DS/UIKIT/Alert',
		'DS/ParameterizationSkeleton/Views/ParametersLayoutView',
		'i18n!DS/ParameterizationSkeleton/assets/nls/XEngineeringNLS'
	],
	function (UWA,
		View,
		Mask,
		Scroller,
		WAFData,
		ParametersLayoutViewUtilities,
		URLHandler,
		PartNumberingViewUtilities,
		ParameterizationXEngineerConstants,
		XENGModal,
		Button,
		Alert,
		ParametersLayoutView,
		XEngineeringNLS) {

	'use strict';

	var extendedView;

	extendedView = View.extend({
			tagName: 'div',
			className: 'generic-detail',

			init: function (options) {
				var initDate = new Date();
				options = UWA.clone(options || {}, false);
				this._parent(options);

				this.options = options;
				this.contentDiv = null;
				this.paramScroller = null;
				this.paramAltSubScroller = null;
				this.userMessaging = null;
				this.lastAlertDate = initDate.getTime();
				this.controlDiv = null;
			},

			setup: function (options) {
				UWA.log('XEngineering Layout::setup!');
				UWA.log(options);
			},

			render: function () {
				UWA.log("XEngineering LayoutView::render");
				var introDiv,
				mappingDiv,
				that = this;

				this.contentDiv = UWA.createElement('div', {
						'id': 'typeMainXENDiv'
					});

				introDiv = UWA.createElement('div', {
						'class': 'information'
					}).inject(this.contentDiv);

				UWA.createElement('p', {
					text: XEngineeringNLS.intro,
					'class': 'font-3dslight'
				}).inject(introDiv);
				this.parentView = new ParametersLayoutView(this.options);

				this.controlDiv = ParametersLayoutViewUtilities.createApplyResetToolbar.call(this, this.contentDiv, true,
						this.applyParams.bind(this), this.resetParams.bind(this));

				this.container.setContent(this.contentDiv);
				this.listenTo(this.collection, {
					onSync: that.onCompleteRequestMapping
				});

				return this;
			},

			onCompleteRequestMapping: function () {
				var that = this;
				UWA.log('XEngineering Layout::Complete rendering!');

				var collection = this.collection._models[0]._attributes;

				PartNumberingViewUtilities.physicalProductAttributes(collection.PhysicalProductAttributes, collection[ParameterizationXEngineerConstants.AVOID_DUP_COUNTER]);

				var fields = collection.ExpressionList;
				var nosOfFields = (fields) ? fields.length : 0;

				this.divPartNumbering = UWA.createElement('div', {
						'class': 'partNumberingDivScroll',
					}).inject(this.contentDiv);

				this.baseAccordion = ParametersLayoutViewUtilities.createFamilyUIKITAccordion(this.divPartNumbering);

				var partNumberingParentDiv = UWA.createElement('div', {
						'class': 'partNumberingContent'
					});

				var partNumberingDiv = UWA.createElement('div', {
						'class': 'partNumbering'
					});

				var partNumberTable = PartNumberingViewUtilities.buildAttributeTable(collection);
				partNumberTable.inject(partNumberingDiv);

				var AddMappingButton = new Button({
						className: 'AddPartNumberFieldButton',
						icon: 'plus-circled',
						attributes: {
							disabled: false,
							'aria-hidden': 'true',
							title: XEngineeringNLS.AddFieldMappingTooltip,
						},
						events: {
							onClick: function (e) {
								that.ShowAddNewFieldPanel(that, partNumberTable.getElement(".partNumberFieldbody"));
							}
						}
					}).inject(partNumberingDiv);

				partNumberingParentDiv.appendChild(partNumberingDiv);

				this.baseAccordion.addItem({
					title: XEngineeringNLS.BaseTitle,
					content: partNumberingParentDiv,
					selected: true,
					name: XEngineeringNLS.BaseName,
				});

				partNumberingDiv.appendChild(this.controlDiv);

				for (var i = 0; i < nosOfFields; i++) {
					var field = fields[i];
					var deployedStatus = (field.Deployed && field.Deployed == "True") ? ParameterizationXEngineerConstants.DEPOLOYED : ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED;
					var counterUnicityValue = field[ParameterizationXEngineerConstants.COUNTER_UNICITY] ? field[ParameterizationXEngineerConstants.COUNTER_UNICITY] : false;
					var fieldInfo = PartNumberingViewUtilities.buildNewPartNumberField(
							PartNumberingViewUtilities.buildJsonObjForPNField(ParameterizationXEngineerConstants.ADD, field.Name, field.Order, field.Type, field.Value, field[ParameterizationXEngineerConstants.ATTRIBUTE], field[ParameterizationXEngineerConstants.COUNTER], counterUnicityValue),
							deployedStatus);
					fieldInfo.inject(partNumberTable.getElement(".partNumberFieldbody"));
				}

				this.paramScroller = new Scroller({
						element: partNumberingDiv
					}).inject(partNumberingParentDiv);

				this.fetchXMLConfig();

				Mask.unmask(this.contentDiv);
			},

			fetchXMLConfig: function () {
				var that = this;
				var url = URLHandler.getURL() + "/resources/ParamWS/access/DomainElements?tenant=" + URLHandler.getTenant() + "&domainid=ENGDefinationManagement";
				WAFData.authenticatedRequest(url, {
					timeout: 250000,
					method: 'GET',
					type: 'json',

					headers: {
						'Content-Type': 'application/json',
						'Accept': 'application/json',
					  'Accept-Language' : widget.lang
					},

					onFailure: function (result) {
						Mask.unmask(that.contentDiv);
						that.getAlertMessage(XEngineeringNLS.AltSubParamError, 'error', this.contentDiv);
					},

					onComplete: function (result) {
						var familyArray = [];

						result.family.forEach(function(family) {
							if (family.id != "PartNumberMapping")
								familyArray.push(family);
						});

						that.getNotPartNumberProperties(familyArray, that.paramScroller);
					}

				});
			},

			getNotPartNumberProperties: function (result, paramAltSubScroller) {
				var that = this;
				try{
					that.divAltSub = UWA.createElement('div', {
							'class': 'altSubDivScroll'
						}).inject(that.contentDiv);
					that.altSubAccordean = ParametersLayoutViewUtilities.createFamilyUIKITAccordion(that.divPartNumbering);
	
					var altSubParentDiv = UWA.createElement('div', {
							'class': 'altSubContent'
						});
					var altSubDiv = UWA.createElement('div', {
							'class': 'alternateSubstitute'
						});
					altSubParentDiv.appendChild(altSubDiv);
					that.model.set("introduction", "");
	
					that.parentView = that._updateParentViewWithNewDomain(that.parentView,"ENGDefinationManagement");
					
					that.parentView.render();
					that.collection._models[0]._attributes.family = result;
					that.parentView.onCompleteRequestParameters();
	
					that.altSubAccordean.addItem({
						title: result.nlsKey,
						content: altSubParentDiv,
						selected: true,
						name: result.nlsKey
					});
	
					altSubDiv.appendChild(that.parentView.contentDiv);
	
					paramAltSubScroller = new Scroller({
							element: altSubDiv
						}).inject(altSubParentDiv);
				}	catch(error) {
				}	finally {
					that.parentView = that._updateParentViewWithNewDomain(that.parentView,"XENManagement");
				}

			},

			_updateParentViewWithNewDomain : function(view, domainId){
				view.options.domainid = domainId;
				view.model.id = domainId;
				view.model._attributes.domainid = domainId;
				view.model._attributes.id = domainId;
				return view;
			},
			
			resetParams: function () {
				var that = this;
				Mask.mask(this.contentDiv);
				var url = URLHandler.getURL() + "/resources/v1/xENGParameterization/resetAdminPartNumberProperties?tenant=" + URLHandler.getTenant();
				WAFData.authenticatedRequest(url, {
					timeout: 250000,
					method: 'GET',
					type: 'json',

					headers: {
						'Content-Type': 'application/json',
						'Accept': 'application/json',
					},

					onFailure: function (json) {
						Mask.unmask(that.contentDiv);
						that.onResetFailure(XEngineeringNLS.ResetError);
					},

					onComplete: function (json) {
						if (json && json.ExpressionList) {
							json.ExpressionList.sort(function (a, b) {
								if (a.Order && b.Order) {
									return a.Order - b.Order;
								}
							});
						}
						that.onResetSuccess(json);
						Mask.unmask(that.contentDiv);
						that.getAlertMessage(XEngineeringNLS.ResetSuccess, 'success', that.contentDiv);
					}

				});

			},

			onResetSuccess: function (json) {
				var savedInfo = json.ExpressionList;
				var that = this;
				var fieldsToBeRemoved = new Array();
				var rowsOfMappedFields = this.contentDiv.getElementsByClassName("partNumberFieldMapping");
				for (var i = 0; i < rowsOfMappedFields.length; i++) {
					if (rowsOfMappedFields[i].value == ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED) {
						if ((savedInfo && savedInfo[i])) {
							var fieldInfo = (that.collection._models[0]._attributes.ExpressionList && that.collection._models[0]._attributes.ExpressionList[i]) ? that.collection._models[0]._attributes.ExpressionList[i] : savedInfo[i];
							fieldsToBeRemoved.push(PartNumberingViewUtilities.resetForFieldLineChanges(rowsOfMappedFields[i], fieldInfo));
						} else {
							fieldsToBeRemoved.push(PartNumberingViewUtilities.resetForFieldLineChanges(rowsOfMappedFields[i]));
						}
					}
				}
				fieldsToBeRemoved.forEach(function (attrMapping) {
					if (attrMapping) {
						attrMapping.remove();
					}
				});
				//PartNumberingViewUtilities.updateStrategy(json.Strategy, ParameterizationXEngineerConstants.DEPOLOYED);
				PartNumberingViewUtilities.updateFormulaTextFields(ParameterizationXEngineerConstants.MAX_ROWS + 1, null, null, ParameterizationXEngineerConstants.DEPOLOYED);
			},

			onResetFailure: function (message) {
				this.getAlertMessage(message, 'error', this.contentDiv);

			},

			applyParams: function () {
				var that = this;
				var rowsOfMappedFields = this.contentDiv.getElementsByClassName("partNumberFieldMapping");
				var payloadToSend = {};
				//                payloadToSend.Strategy = document.querySelector(".partNumberStrategyMapping").value;
				Mask.mask(this.contentDiv);
				payloadToSend.ExpressionList = [];
				for (var i = 0; i < rowsOfMappedFields.length; i++) {
					if (rowsOfMappedFields[i].value == ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED) {
						var value = PartNumberingViewUtilities.buildsFieldJsonObject(rowsOfMappedFields[i]);
						payloadToSend.ExpressionList.push(value);
					}
				}

				var url = URLHandler.getURL() + "/resources/v1/xENGParameterization/setAdminPartNumberProperties?tenant=" + URLHandler.getTenant(),payloadToSend;
				WAFData.authenticatedRequest(url, {
					timeout: 250000,
					method: 'POST',
					data: JSON.stringify(payloadToSend),
					type: 'json',

					headers: {
						'Content-Type': 'application/json',
						'Accept': 'application/json'
					},

					onFailure: function (json) {
						Mask.unmask(that.contentDiv);
						that.onApplyFailure(XEngineeringNLS.ApplyError);
					},

					onComplete: function (json) {
						if (json.Action == "Success") {
							that.onApplySuccess(payloadToSend.Strategy);
							Mask.unmask(that.contentDiv);
							that.getAlertMessage(XEngineeringNLS.ApplySuccess, 'success', that.contentDiv);

						} else {
							Mask.unmask(that.contentDiv);
							that.onApplyFailure(json.message);
						}
					}

				});
			},

			onApplyFailure: function (message) {
				this.getAlertMessage(message, 'error', this.contentDiv);
			},

			onApplySuccess: function (strategyValue) {

				//PartNumberingViewUtilities.updateStrategy(strategyValue, ParameterizationXEngineerConstants.DEPOLOYED);
				var fieldsToBeRemoved = new Array();

				var rowsOfMappedFields = this.contentDiv.getElementsByClassName("partNumberFieldMapping");
				for (var i = 0; i < rowsOfMappedFields.length; i++) {
					if (rowsOfMappedFields[i].value == ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED) {
						var statusCell = rowsOfMappedFields[i].cells[6];
						if (statusCell.value == ParameterizationXEngineerConstants.ADD || statusCell.value == ParameterizationXEngineerConstants.MODIFY) {
							rowsOfMappedFields[i].cells[6].empty();
							rowsOfMappedFields[i].value = ParameterizationXEngineerConstants.DEPOLOYED;
							var imgSpan = PartNumberingViewUtilities.buildImgSpan('check', '1.5', 'green', XEngineeringNLS.Deployed);
							imgSpan.inject(rowsOfMappedFields[i].cells[6]);
						}
						if (rowsOfMappedFields[i].cells[6].value == ParameterizationXEngineerConstants.REMOVE) {
							fieldsToBeRemoved.push(rowsOfMappedFields[i]);
						}
					}
				}

				fieldsToBeRemoved.forEach(function (attrMapping) {
					attrMapping.remove();
				});

				var formulaField = document.querySelector(".partNumberFormulaMapping");
				formulaField.cells[3].empty();
				var imgSpan = ParametersLayoutViewUtilities.buildImgSpan('check', '1.5', 'green', XEngineeringNLS.Deployed);
				imgSpan.inject(formulaField.cells[3]);

			},

			ShowAddNewFieldPanel: function (attrtbody) {
				this.createPartNumberingDialogBox(attrtbody);
				var isDeployed = ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED;
			},

			createPartNumberingDialogBox: function (attrtbody) {
				var that = this;
				var attributes = (this.collection._models[0]._attributes && this.collection._models[0]._attributes.PhysicalProductAttributes);
				var options = {
					className: "part-number-modal",
					title: XEngineeringNLS.AddFieldMappingTooltip,
					[ParameterizationXEngineerConstants.AVOID_DUP_COUNTER] : this.collection._models[0]._attributes[ParameterizationXEngineerConstants.AVOID_DUP_COUNTER]
				}

				this.modal = new XENGModal(options);

				this.modal.getAttributes(attributes);

				if (this.modal.getTotalFormatRows() == ParameterizationXEngineerConstants.MAX_ROWS) {
					var alert = that.modal.displayAlertMessage(XEngineeringNLS.maxLimitOfRows, document.querySelector('#typeMainXENDiv').getChildren()[0]);
				} else {
					function _getFooter() {
						return "<button type='button'  name='addButton' id='add-button' class='btn btn-primary'>" + XEngineeringNLS.add + "</button> " + "</button>" + "<button type='button' name='cancelButton' id='cancel-button' class='btn btn-default'>" + XEngineeringNLS.cancel + "</button>"
					}

					this.modal.modal.setFooter(_getFooter());
					this.modal.getModalBody();
					this.modal._bindFooterEvent();
					this.modal.getContent().getElements('.btn').forEach(function (element) {
						if (that.modal.isCounterExists(ParameterizationXEngineerConstants.TYPE)) {
							that.modal.partNumberTypeCombobox.disable(ParameterizationXEngineerConstants.FORMAT_COUNTER);
						}

						if (element.name === 'cancelButton') {
							element.addEventListener('click', function () {
								that.modal.destroy();
							});
						} else if (element.name === 'addButton') {

							element.addEvent('click', function () {

								var toDisplayOver = that.modal.getContent().getElement('.enox-part-number-content');

								if (that.modal.validateEnteredNameValueNotNull()) {
									that.modal.displayAlertMessage(XEngineeringNLS.nameNullMessage, toDisplayOver);
								} else if (that.modal.validateEnteredOrderValueNotNull()) {
									that.modal.displayAlertMessage(XEngineeringNLS.orderNullMessage, toDisplayOver);
								} else if (that.modal.validatSelectedTypeFieldValueNotNull()) {
									that.modal.displayAlertMessage(XEngineeringNLS.selectTypeMessage, toDisplayOver);
								} else if (that.modal.validateSelectedAttributeFieldValueNotNull()) {
									that.modal.displayAlertMessage(XEngineeringNLS.selectAttributeMessage, toDisplayOver);
								} else if (that.modal.validateEnteredCounterFieldValueNotNull()) {
									that.modal.displayAlertMessage(XEngineeringNLS.counterIsEmptyMessage, toDisplayOver);
								} else if (that.modal.validateEnteredValueFieldValueNotNull()) {
									that.modal.displayAlertMessage(XEngineeringNLS.valueEmptyMessage, toDisplayOver);
								} else {
									if (!that.modal.validateEnteredNameValue().isValid) {
										that.modal.displayAlertMessage(XEngineeringNLS.nameMessage + ' ' + XEngineeringNLS.alreadyExists, toDisplayOver);
									} else if (!that.modal.validateEnteredOrderValue().isValid) {
										that.modal.displayAlertMessage(XEngineeringNLS.orderMessage + ' ' + XEngineeringNLS.alreadyExists, toDisplayOver);
									} else {
										var userSelectedFormat = that.modal.getUserEnteredValues();

										userSelectedFormat[ParameterizationXEngineerConstants.OPERATION] = ParameterizationXEngineerConstants.ADD;
										var fieldInfo = PartNumberingViewUtilities.buildNewPartNumberField(userSelectedFormat, ParameterizationXEngineerConstants.NEW_NOT_DEPLOYED);
										fieldInfo.inject(attrtbody.getElement(".partNumberFieldbody"));
										that.modal.destroy();
									}
								}
							});
						};
					});

					that.modal.show();
				}
			},

			getAlertMessage: function (message, className, toDisplayOn) {

				this.alertOptions = {
					visible: true,
					className: 'param-alert',
					messageClassName: className,
					closable: true,
					renderTo: toDisplayOn,
					autoHide: true,
					hideDelay: 2000
				};

				var alert = new Alert(this.alertOptions);
				alert.add({
					message: message,
				});

			},

			destroy: function () {
				this.stopListening();
				this._parent.apply(this, arguments);
			}
		});

	return extendedView;
});



define(
    'DS/ParameterizationSkeleton/Utils/ParameterizationApriso3DExperience/ParameterizationApriso3DExpWebServices',
    [
        'UWA/Core',
        'UWA/Class',
        'DS/WAFData/WAFData',
        'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
    ],
    function(UWA, Class, WAFData, URLHandler) {

        'use strict';

        var ParameterizationApriso3DExpWebServices = Class.singleton({
            getlistofDELMIATypes : function (types, callback) {

                var url = URLHandler.getURL() + "/resources/exchange/param/apriso/configuration/getlistofDELMIATypes";
                var datatoSend = {
                    types : types
                };

                WAFData.authenticatedRequest(url, {
                    timeout: 100000,
                    method: 'POST',
                    data: JSON.stringify(datatoSend),
                    type: 'json',
                    headers: {
                        'Content-Type' : 'application/json',
                        'Accept' : 'application/json'
                    },

                    onFailure : function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function(json) {
                      callback.onSuccess(json);
                    }
                });
            }/*,

            getParameters : function (domainid, familyid, callback) {

                //var url = URLHandler.getURL() + "/resources/exchange/param/apriso/configuration/getParameters?familyID=";
                var url = URLHandler.getURL() + "/resources/delmia/param/configuration/getParameters?familyID=";
                if ((familyid != null || familyid != undefined) && (domainid != null || domainid != undefined))
                  url += familyid + "&domainID=" + domainid;

                WAFData.authenticatedRequest(url, {
                    timeout: 100000,
                    method: 'GET',
                    type: 'json',
                    headers: {
                        'Content-Type' : 'application/json',
                        'Accept' : 'application/json'
                    },

                    onFailure : function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function(json) {
                      callback.onSuccess(json);
                    }
                });
            },

            setParameters : function (domainid, familyid, params, callback) {

                //var url = URLHandler.getURL() + "/resources/exchange/param/apriso/configuration/setParameter";
                var url = URLHandler.getURL() + "/resources/delmia/param/configuration/setParameter";
                /*var datatoSend = {
                    params : params
                };*/

                /*var datatoSend = {
                  domain : domainid,
                  family : familyid,
                  params : params
                }

                WAFData.authenticatedRequest(url, {
                    timeout: 100000,
                    method: 'POST',
                    data: JSON.stringify(datatoSend),
                    type: 'json',
                    headers: {
                        'Content-Type' : 'application/json',
                        'Accept' : 'application/json'
                    },

                    onFailure : function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function(json) {
                      callback.onSuccess(json);
                    }
                });
            },

            isDeployed : function (domainid, familyid, params, callback) {

                //var url = URLHandler.getURL() + "/resources/exchange/param/apriso/configuration/isDeployed";
                var url = URLHandler.getURL() + "/resources/delmia/param/configuration/isDeployed";
                /*var datatoSend = {
                    params : params
                };*/

              /*  var datatoSend = {
                  domain : domainid,
                  family : familyid,
                  params : params
                }

                WAFData.authenticatedRequest(url, {
                    timeout: 100000,
                    method: 'POST',
                    data: JSON.stringify(datatoSend),
                    type: 'json',
                    headers: {
                        'Content-Type' : 'application/json',
                        'Accept' : 'application/json'
                    },

                    onFailure : function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function(json) {
                      callback.onSuccess(json);
                    }
                });
            },

            deleteParameter : function (domainid, familyid, params, callback) {

                //var url = URLHandler.getURL() + "/resources/exchange/param/apriso/configuration/deleteParameter";
                var url = URLHandler.getURL() + "/resources/delmia/param/configuration/deleteParameter";
                /*var datatoSend = {
                    params : params
                };*/

            /*    var datatoSend = {
                  domain : domainid,
                  family : familyid,
                  params : params
                }

                WAFData.authenticatedRequest(url, {
                    timeout: 100000,
                    method: 'POST',
                    data: JSON.stringify(datatoSend),
                    type: 'json',
                    headers: {
                        'Content-Type' : 'application/json',
                        'Accept' : 'application/json'
                    },

                    onFailure : function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function(json) {
                      callback.onSuccess(json);
                    }
                });
            },


            deleteAllParameters : function (callback) {

                var url = URLHandler.getURL() + "/resources/exchange/param/apriso/configuration/deleteAllParameters";

                WAFData.authenticatedRequest(url, {
                    timeout: 100000,
                    method: 'DELETE',
                    type: 'json',
                    headers: {
                        'Content-Type' : 'application/json',
                        'Accept' : 'application/json'
                    },

                    onFailure : function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function(json) {
                      callback.onSuccess(json);
                    }
                });
            }*/

        });
        return ParameterizationApriso3DExpWebServices;
    }
);

define("DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/dictionary/DictionaryCollectionItem", ["require", "exports", "UWA/Class/Model", "UWA/Class/Collection", "DS/ParameterizationSkeleton/Utils/ParameterizationPartSupply/Utils", "DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/Attribute"], function (require, exports, Model, Collection, Utils, AttributeModule) {
    "use strict";
    var DictionaryCollectionItemModule;
    (function (DictionaryCollectionItemModule) {
        DictionaryCollectionItemModule.DictionaryCollectionItem = Model.extend({
            getId: function () {
                return this.get('Name');
            },
            getLabel: function () {
                var label = this.getId();
                if (this.get('NameNLS')) {
                    if (this.get('NameNLS')[Utils.Utils.getLang()]) {
                        label = this.get('NameNLS')[Utils.Utils.getLang()];
                    }
                    else if (this.get('NameNLS')['en']) {
                        label = this.get('NameNLS')['en'];
                    }
                }
                // if label == id => no translation => remove the id at the end in order to be readable
                if (label === this.getId()) {
                    label = label.substring(0, label.indexOf('__'));
                }
                return label;
            },
            getParentId: function () {
                return this.get('Parent');
            },
            getAttributes: function () {
                return this.get('Attributes');
            },
            parse: function (data, options) {
                data.Attributes = new Collection(Object.keys(data.Attributes).map(function (key) {
                    return data.Attributes[key];
                }), {
                    model: AttributeModule.Attribute,
                    parse: true,
                    custom: options.collection.isCustom()
                });
                // add "Custom" attribute to set if it is a Custom DictionaryCollectionItem or an OOTB DictionaryCollectionItem
                data.Custom = options.collection.isCustom();
                return this._parent(data, options);
            },
            setParents: function (parents) {
                this.parents = new Collection(parents);
            },
            getParents: function () {
                if (!this.parents) {
                    throw new Error('parents must be computed');
                }
                return this.parents;
            },
            findParentByDictionaryCollectionItem: function (typeName) {
                return this.getParents().findWhere({ 'Name': typeName });
            },
            isCustom: function () {
                return this.get('Custom');
            },
            computeAllAttributes: function () {
                var allAttributes = [];
                allAttributes = allAttributes.concat(this.getAttributes().toArray());
                this.getParents().forEach(function (parent) {
                    allAttributes = allAttributes.concat(parent.getAttributes().toArray());
                });
                this.attributes = new Collection(allAttributes);
            },
            getAllAttributes: function () {
                if (!this.attributes) {
                    throw new Error('attributes must be computed');
                }
                return this.attributes;
            },
            getAttributeByName: function (name) {
                return this.getAllAttributes().findWhere({ Name: name });
            },
            getAllSupportedAttributes: function (onlyCustom) {
                return new Collection(this.getAllAttributes().filter(function (attribute) { return attribute.isSupported(onlyCustom); }));
            }
        });
    })(DictionaryCollectionItemModule || (DictionaryCollectionItemModule = {}));
    ;
    return DictionaryCollectionItemModule;
});



define(
    'DS/ParameterizationSkeleton/Utils/ParameterizationODM/ParameterizationODMWebServices',
    [
        'UWA/Core',
        'UWA/Class',
        'DS/WAFData/WAFData',
        'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
    ],
    function(UWA, Class, WAFData, URLHandler) {

        'use strict';

        var ParameterizationODMWebServices = Class.singleton({
            getODMURL : function () {
              var url = URLHandler.getURL();
              if (window.widget.getValue("x3dPlatformId") != "OnPremise")
              {
                url = url.replace("enovia", "");
                url = url.replace("space", "odm");
              }
			  return url;
            },

            autoNamingRule : function (options, imgCell, callback) {

                var url = this.getODMURL() + "resources/v1/modeler/dswo/autonamingrule";
                var datatoSend = [
                  {
                    contentType: options.contentType,
                    prefix: options.prefix,
                    interfix: options.interfix,
                    suffix: options.suffix,
                    separator: options.separator,
                    counterLength : options.counterLength
                  }
                ];

                WAFData.authenticatedRequest(url, {
                    timeout: 100000,
                    method: 'POST',
                    data: JSON.stringify(datatoSend),
                    type: 'json',
                    headers: {
                        'Content-Type' : 'application/json',
                        'Accept' : 'application/json',
						'x-requested-with' : 'XMLHttpRequest'
                    },

                    onFailure : function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function(json) {
					  json.deployStatus = "S_OK";
                      callback.onSuccess(json, imgCell);
                    }
                });
            }
        });
        return ParameterizationODMWebServices;
    }
);

define("DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/dictionary/DictionaryCollection", ["require", "exports", "UWA/Class/Collection", "DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/dictionary/DictionaryCollectionItem"], function (require, exports, Collection, DictionaryCollectionItemModule) {
    "use strict";
    var DictionaryCollectionModule;
    (function (DictionaryCollectionModule) {
        ;
        DictionaryCollectionModule.DictionaryCollection = Collection.extend({
            setup: function (models, options) {
                this._isCustom = options.isCustom === true;
                delete options.isCustom;
                this.dictionaryNLS = options.dictionaryNLS;
                delete options.isCustom;
                this._parent(models, options);
            },
            model: DictionaryCollectionItemModule.DictionaryCollectionItem,
            isCustom: function () {
                return this._isCustom;
            },
            // build the complete list of parents for each type
            computeAllParents: function (OOTBDictionaryCollection) {
                var _this = this;
                this.forEach(function (item) { return _this.computeParents(item, OOTBDictionaryCollection); });
            },
            computeParents: function (item, OOTBDictionaryCollection) {
                var parents = [];
                var parentId = item.getParentId();
                while (parentId) {
                    var parent_1 = this.isCustom()
                        /** for a custo item, parent can be either a custo or an OOTB item */
                        ? this.findWhere({ 'Name': parentId }) || OOTBDictionaryCollection.findWhere({ 'Name': parentId })
                        /** for an OOTB item, parent can only be an OOTB item (in same collection) */
                        : this.findWhere({ 'Name': parentId });
                    parents.push(parent_1);
                    parentId = parent_1.getParentId();
                }
                item.setParents(parents);
            },
            getSubTypesOf: function (typeName) {
                var subtypes = [];
                this.forEach(function (type) {
                    if (type.findParentByDictionaryCollectionItem(typeName)) {
                        subtypes.push(type);
                    }
                });
                return new Collection(subtypes);
            }
        });
    })(DictionaryCollectionModule || (DictionaryCollectionModule = {}));
    return DictionaryCollectionModule;
});

var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
};
define("DS/ParameterizationSkeleton/Views/ParameterizationPartSupply/PartSupplyIndexingManagementDomainView", ["require", "exports", "UWA/Core", "UWA/Class/Collection", "DS/UIKIT/Modal", "DS/UIKIT/Input/Button", "DS/UIKIT/Input/Select", "DS/UIKIT/Form", "DS/UIKIT/Alert", "DS/ParameterizationSkeleton/Utils/ParameterizationPartSupply/Utils", "DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/ParameterizationModel", "DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/Attribute", "DS/ParameterizationSkeleton/Views/ParameterizationPartSupply/DomainView"], function (require, exports, UWA, Collection, Modal, Button, Select, Form, Alert, Utils, ParameterizationModelModule, AttributeModule, DomainViewModule) {
    "use strict";
    /**
     * The aim of this module is to provide a React based version of the standard layout used to render a domain of parameters
     */
    var PartSupplyIndexingManagementDomain;
    (function (PartSupplyIndexingManagementDomain) {
        ;
        /**
         * React Equivalent for standard parameters layout view
         */
        PartSupplyIndexingManagementDomain.PartSupplyIndexingManagementDomainView = DomainViewModule.DomainView.extend({
            destroy: function () {
                if (this.excludeRulesConfigurationModal) {
                    this.excludeRulesConfigurationModal.destroy();
                    this.excludeRulesConfigurationModal = null;
                }
                if (this.excludeRulesDeletionModal) {
                    this.excludeRulesDeletionModal.destroy();
                    this.excludeRulesDeletionModal = null;
                }
                this._parent();
            },
            /** Root Element */
            Domain: function (props) {
                var _this = this;
                this.DictionaryOOTB = props.DictionaryOOTB;
                this.DictionaryCUSTO = props.DictionaryCUSTO;
                this.CollabSpaces = props.CollabSpaces;
                this.getExcludeRuleAvailability = function (rule) {
                    var specificInterfaceCollection = _this.getSpecificInterfaceCollection(rule);
                    var interfaceItem = specificInterfaceCollection.find(function (dictionaryCollectionItem) { return dictionaryCollectionItem.getId() === rule.interfaceName || dictionaryCollectionItem.getLabel() === rule.interfaceName; });
                    if (!interfaceItem)
                        return false;
                    if (!!rule.interfaceAttributeName) {
                        specificInterfaceCollection.computeParents(interfaceItem, _this.getSpecificInterfaceCorrespondingOOTBCollection(rule));
                        interfaceItem.computeAllAttributes();
                        var interfaceAttributeItem = interfaceItem.getAllAttributes().find(function (dictionaryCollectionItem) { return dictionaryCollectionItem.getId() === rule.interfaceAttributeName || dictionaryCollectionItem.getLabel() === rule.interfaceAttributeName; });
                        if (!interfaceAttributeItem)
                            return false;
                    }
                    return true;
                };
                this.getExcludeRuleLabelFromRule = function (rule) {
                    var specificInterfaceCollection = _this.getSpecificInterfaceCollection(rule);
                    var interfaceItem = specificInterfaceCollection.find(function (dictionaryCollectionItem) { return dictionaryCollectionItem.getId() === rule.interfaceName || dictionaryCollectionItem.getLabel() === rule.interfaceName; });
                    var label = interfaceItem ? interfaceItem.getLabel() : rule.interfaceName;
                    if (!!rule.interfaceAttributeName) {
                        specificInterfaceCollection.computeParents(interfaceItem, _this.getSpecificInterfaceCorrespondingOOTBCollection(rule));
                        interfaceItem.computeAllAttributes();
                        var interfaceAttributeItem = interfaceItem.getAllAttributes().find(function (dictionaryCollectionItem) { return dictionaryCollectionItem.getId() === rule.interfaceAttributeName || dictionaryCollectionItem.getLabel() === rule.interfaceAttributeName; });
                        var attribute = interfaceAttributeItem ? interfaceAttributeItem.getLabel() : rule.interfaceAttributeName;
                        label += '(' + attribute + rule.interfaceAttributeOperator + rule.interfaceAttributeValue + ')';
                    }
                    return label;
                };
                this.getSpecificInterfaceCollection = function (rule) {
                    if (rule.isOOTB && rule.interfaceType === 'Type') {
                        return _this.DictionaryOOTB.getTypes();
                    }
                    else if (!rule.isOOTB && rule.interfaceType === 'Type') {
                        return _this.DictionaryCUSTO.getTypes();
                    }
                    else if (rule.isOOTB && rule.interfaceType === 'Interface') {
                        return _this.DictionaryOOTB.getInterfaces();
                    }
                    else if (!rule.isOOTB && rule.interfaceType === 'Interface') {
                        return _this.DictionaryCUSTO.getInterfaces();
                    }
                    else {
                        throw new Error("Unable to retrieve interface list for selected interface type: {isOOTB: ".concat(rule.isOOTB, ", type: ").concat(rule.interfaceType, "}"));
                    }
                };
                this.getSpecificInterfaceCorrespondingOOTBCollection = function (rule) {
                    if (rule.interfaceType === 'Type') {
                        return _this.DictionaryOOTB.getTypes();
                    }
                    else {
                        return _this.DictionaryOOTB.getInterfaces();
                    }
                };
                this.getInterfaceTypeLabel = function (rule) {
                    if (rule.isOOTB && rule.interfaceType === 'Type') {
                        return 'Standard Type';
                    }
                    else if (!rule.isOOTB && rule.interfaceType === 'Type') {
                        return 'Custom Type';
                    }
                    else if (rule.isOOTB && rule.interfaceType === 'Interface') {
                        return 'Standard Extension';
                    }
                    else if (!rule.isOOTB && rule.interfaceType === 'Interface') {
                        return 'Custom Extension';
                    }
                    else {
                        throw new Error("Unable to retrieve interface type lable for selected interface type: {isOOTB: ".concat(rule.isOOTB, ", type: ").concat(rule.interfaceType, "}"));
                    }
                };
                this.getAttribute = function (rule) {
                    var attribute;
                    if ('interfaceAttributeName' in rule && rule.interfaceAttributeName) {
                        var specificInterfaceCollection = _this.getSpecificInterfaceCollection(rule);
                        var selectedSpecificInterfaceItem = specificInterfaceCollection.findWhere({ Name: rule.interfaceName });
                        if (selectedSpecificInterfaceItem) {
                            attribute = selectedSpecificInterfaceItem.getAttributeByName(rule.interfaceAttributeName);
                        }
                    }
                    return attribute;
                };
                this.getAttributeOperators = function (rule) {
                    var _a;
                    var attributeType = (_a = _this.getAttribute(rule)) === null || _a === void 0 ? void 0 : _a.getType();
                    if (attributeType) {
                        if ([AttributeModule.TYPE.INTEGER, AttributeModule.TYPE.DOUBLE].indexOf(attributeType) > -1) {
                            return ['>', '≥', '=', '≠', '≤', '<'];
                        }
                        else {
                            return ['=', '≠'];
                        }
                    }
                    return [];
                };
                return this._parent(props);
            },
            /**
             * Table representing a bench of parameters
             * Override parent method to include handling of custo families
             */
            FamilyTable: function (_a) {
                var _this = this;
                var family = _a.family, onFamilyChange = _a.onFamilyChange;
                var onParameterChange = function (newParameterValue, newLinkedParameterValues) {
                    var _family = Utils.Utils.clone(family);
                    _family.parameter = family.parameter.map(function (p) {
                        if (p.id === newParameterValue.id) {
                            return newParameterValue;
                        }
                        if (newLinkedParameterValues && newLinkedParameterValues.length > 0) {
                            var found = newLinkedParameterValues.find(function (parameter) { return parameter.id === p.id; });
                            if (found) {
                                return found;
                            }
                        }
                        return p;
                    });
                    onFamilyChange(_family);
                };
                var linkedParameters = {
                    'CollabSpacesWhiteList': ['FromStandardCollabSpacesOnly']
                };
                var isLinkedParameter = function (id) {
                    var masterParameters = Object.keys(linkedParameters);
                    return masterParameters.some(function (masterId) {
                        return linkedParameters[masterId].indexOf(id) !== -1;
                    });
                };
                var getLinkedParameters = function (id) {
                    var masterParameters = Object.keys(linkedParameters);
                    if (masterParameters.indexOf(id) === -1 || linkedParameters[id].length === 0) {
                        return [];
                    }
                    return linkedParameters[id].map(function (linkedId) {
                        return family.parameter.find(function (parameter) { return parameter.id === linkedId; });
                    });
                };
                return UWA.createElement('div', {
                    id: family.id + 'familytable',
                    class: 'table table-hover',
                    html: [{
                            tag: 'div',
                            class: 'fparamtbody',
                            styles: { display: 'flex', width: '100%', flexDirection: 'column' },
                            id: family.id + 'familytbody',
                            html: family.parameter.map(function (parameter) {
                                if (!isLinkedParameter(parameter.id)) {
                                    switch (parameter.id) {
                                        case 'Preferred3DShapeAggregationRule':
                                            return _this.Preferred3DShapeAggregationRule({ parameter: parameter, onParameterChange: onParameterChange });
                                        case 'ConcatenatedExclusionRules':
                                            return _this.ExcludeRules({ parameter: parameter, onParameterChange: onParameterChange });
                                        case 'CollabSpacesWhiteList':
                                            return _this.IndexedCollaborativeSpaces({ parameter: parameter, linkedParameters: getLinkedParameters(parameter.id), onParameterChange: onParameterChange });
                                        default:
                                            return _this.ParameterLine({ parameter: parameter, onParameterChange: onParameterChange });
                                    }
                                }
                            })
                        }]
                });
            },
            /** Row representing the Preferred3DShapeAggregationRule parameter */
            Preferred3DShapeAggregationRule: function (_a) {
                var parameter = _a.parameter, onParameterChange = _a.onParameterChange;
                this.forceApply = false;
                this.removeError(parameter.id);
                var argument = parameter.argument[0];
                var onArgumentChange = function (newArgumentValue) {
                    var _parameter = Utils.Utils.clone(parameter);
                    _parameter.argument = [newArgumentValue];
                    onParameterChange(_parameter);
                };
                // default values of inputs
                var valueOfUsePreferred3DShapeAggregationRule = false;
                var valueOfType = null;
                var valueOfAttribute = null;
                var valueOfValue = null;
                var jsonValue = null;
                if (argument.argValue !== '') {
                    valueOfUsePreferred3DShapeAggregationRule = true;
                    // if argument value is not an empty string, it should be a json
                    try {
                        jsonValue = JSON.parse(argument.argValue);
                    }
                    catch (e) {
                        // manage exception if json is not valid
                        jsonValue = {
                            type: null,
                            attribute: null,
                            value: null
                        };
                        valueOfUsePreferred3DShapeAggregationRule = false;
                        parameter.isDeployed = 'false';
                        this.forceApply = true;
                    }
                    valueOfType = jsonValue.type ? jsonValue.type : null;
                    valueOfAttribute = jsonValue.attribute ? jsonValue.attribute : null;
                    valueOfValue = jsonValue.value ? jsonValue.value : null;
                    if (valueOfType === null) {
                        this.addError(parameter.id);
                    }
                }
                // prepare options for selects
                var possibleTypes = this.DictionaryCUSTO.get('Types').getSubTypesOf('3DShape');
                var typeSelectOptions = [];
                possibleTypes.forEach(function (type) {
                    typeSelectOptions.push({
                        value: type.getId(),
                        label: type.getLabel()
                    });
                });
                var typeSelectEnabled = valueOfUsePreferred3DShapeAggregationRule;
                // retrieve selected type
                var selectedType = possibleTypes.findWhere({ Name: valueOfType });
                if (valueOfType !== null && !selectedType) {
                    // we didn't find the selected type in the possible list of types ! Maybe deleted ? So we reset all
                    valueOfType = null;
                    valueOfAttribute = null;
                    valueOfValue = null;
                    parameter.isDeployed = 'false';
                    this.forceApply = true;
                }
                var possibleAttributes = selectedType ? selectedType.getAllSupportedAttributes(true) : new Collection();
                // retrieve selected type
                var selectedAttribute = possibleAttributes.findWhere({ Name: valueOfAttribute });
                if (valueOfAttribute !== null && !selectedAttribute) {
                    // we didn't find the selected attribute in the possible list of attributes ! Maybe deleted ? So we reset all
                    valueOfAttribute = null;
                    valueOfValue = null;
                    parameter.isDeployed = 'false';
                    this.forceApply = true;
                }
                var attributeSelectOptions = [];
                possibleAttributes.forEach(function (attribute) {
                    attributeSelectOptions.push({
                        value: attribute.getId(),
                        label: attribute.getLabel()
                    });
                });
                var attributeSelectEnabled = valueOfUsePreferred3DShapeAggregationRule && valueOfType !== null;
                var inputForValueEnabled = valueOfUsePreferred3DShapeAggregationRule && valueOfAttribute !== null;
                var onUsePreferred3DShapeAggregationRuleChange = function () {
                    var _argument = Utils.Utils.clone(argument);
                    if (valueOfUsePreferred3DShapeAggregationRule) {
                        // checkbox was checked, so we reset the value to an empty string
                        _argument.argValue = '';
                    }
                    else {
                        _argument.argValue = JSON.stringify({
                            type: null,
                            attribute: null,
                            value: null
                        });
                    }
                    onArgumentChange(_argument);
                };
                var onTypeChange = function (e) {
                    var _argument = Utils.Utils.clone(argument);
                    jsonValue.type = e.target.value === '' ? null : e.target.value;
                    // type has changed => reset attribute and value
                    jsonValue.attribute = null;
                    jsonValue.value = null;
                    _argument.argValue = JSON.stringify(jsonValue);
                    onArgumentChange(_argument);
                };
                var onAttributeChange = function (e) {
                    var _argument = Utils.Utils.clone(argument);
                    jsonValue.attribute = e.target.value === '' ? null : e.target.value;
                    // attribute has changed => reset value
                    jsonValue.value = '';
                    _argument.argValue = JSON.stringify(jsonValue);
                    onArgumentChange(_argument);
                };
                var onValueChange = function (e) {
                    var _argument = Utils.Utils.clone(argument);
                    jsonValue.value = e.target.value;
                    if (jsonValue.value !== '') {
                        if (selectedAttribute && selectedAttribute.getType() === AttributeModule.TYPE.INTEGER) {
                            try {
                                jsonValue.value = '' + parseInt(jsonValue.value);
                                if (jsonValue.value === 'NaN') {
                                    jsonValue.value = '';
                                }
                            }
                            catch (error) {
                                jsonValue.value = '';
                            }
                        }
                        if (selectedAttribute && selectedAttribute.getType() === AttributeModule.TYPE.DOUBLE) {
                            try {
                                jsonValue.value = '' + parseFloat(jsonValue.value);
                                if (jsonValue.value === 'NaN') {
                                    jsonValue.value = '';
                                }
                            }
                            catch (error) {
                                jsonValue.value = '';
                            }
                        }
                    }
                    _argument.argValue = JSON.stringify(jsonValue);
                    onArgumentChange(_argument);
                };
                var onValueSelectionChange = function (e) {
                    var _argument = Utils.Utils.clone(argument);
                    jsonValue.value = e.target.value;
                    _argument.argValue = JSON.stringify(jsonValue);
                    onArgumentChange(_argument);
                };
                var isDeployed = parameter.isDeployed === 'true';
                var checkbox = this.Checkbox({ id: parameter.id + '-checkbox', value: valueOfUsePreferred3DShapeAggregationRule, onChange: onUsePreferred3DShapeAggregationRuleChange });
                var typeSelect = this.Select({ id: parameter.id + '-type-select', value: valueOfType, options: typeSelectOptions, placeholder: 'Choose type', enabled: typeSelectEnabled, onChange: onTypeChange });
                var labelForTypeSelect = this.LabelForInput({ inputId: parameter.id + '-type-select', text: 'Type', mandatory: true, enabled: typeSelectEnabled });
                var attributeSelect = this.Select({ id: parameter.id + '-attribute-select', value: valueOfAttribute, options: attributeSelectOptions, placeholder: 'Choose attribute', enabled: attributeSelectEnabled, onChange: onAttributeChange });
                var labelForAttributeSelect = this.LabelForInput({ inputId: parameter.id + '-attribute-select', text: 'Attribute', mandatory: false, enabled: attributeSelectEnabled });
                var inputForValue;
                if (selectedAttribute && selectedAttribute.hasAuthorizedValues()) {
                    var valueSelectOptions_1 = [];
                    selectedAttribute.getAuthorizedValues().forEach(function (authorizedValue) {
                        valueSelectOptions_1.push({
                            value: authorizedValue,
                            label: selectedAttribute.getAuthorizedValueLabel(authorizedValue)
                        });
                    });
                    inputForValue = this.Select({ id: parameter.id + '-value-input', value: valueOfValue, options: valueSelectOptions_1, placeholder: 'Choose value', enabled: inputForValueEnabled, onChange: onValueSelectionChange });
                }
                else if (selectedAttribute && selectedAttribute.getType() === AttributeModule.TYPE.BOOLEAN) {
                    var valueSelectOptions = [{ value: 'true', label: 'True' }, { value: 'false', label: 'False' }];
                    inputForValue = this.Select({ id: parameter.id + '-value-input', value: valueOfValue, options: valueSelectOptions, placeholder: 'Choose value', enabled: inputForValueEnabled, onChange: onValueSelectionChange });
                }
                else {
                    inputForValue = this.Textfield({ id: parameter.id + '-value-input', value: valueOfValue ? valueOfValue : '', enabled: inputForValueEnabled, onChange: onValueChange });
                }
                var labelForInputForValue = this.LabelForInput({ inputId: parameter.id + '-value-input', text: 'Value', mandatory: true, enabled: inputForValueEnabled });
                var custom = UWA.createElement('div', {
                    styles: { display: 'flex', width: '100%', flexFlow: 'column' },
                    html: [{
                            tag: 'div',
                            styles: { display: 'flex', width: '100%' },
                            html: [
                                this.ParameterLabel(parameter.nlsKey),
                                this.ParameterTooltip(parameter.tooltipNlsKey),
                                this.ParameterValue(checkbox),
                                this.ParameterDeployed(isDeployed)
                            ]
                        }, {
                            tag: 'div',
                            styles: { display: 'flex', width: '40%', flexDirection: 'column', padding: '8px 16px' },
                            html: [
                                labelForTypeSelect,
                                typeSelect
                            ]
                        }, {
                            tag: 'div',
                            styles: { display: 'flex', width: '80%' },
                            html: [{
                                    tag: 'div',
                                    styles: { display: 'flex', width: '50%', flexDirection: 'column', padding: '8px 16px' },
                                    html: [
                                        labelForAttributeSelect,
                                        attributeSelect
                                    ]
                                }, {
                                    tag: 'div',
                                    styles: { display: 'flex', width: '50%', flexDirection: 'column', padding: '8px 16px' },
                                    html: [
                                        labelForInputForValue,
                                        inputForValue
                                    ]
                                }
                            ]
                        }]
                });
                this.AddMouseOver(custom);
                return custom;
            },
            ExcludeRuleModalContent: function (props) {
                var _this = this;
                var _a, _b;
                var newRule = props.exclusionRule ? Utils.Utils.clone(props.exclusionRule) : {
                    isOOTB: true,
                    interfaceType: 'Type'
                };
                var exclusionRuleNames = (_a = props.exclusionRules.map(function (rule) { return rule.ruleName; })) !== null && _a !== void 0 ? _a : [];
                var okBtn = new Button({
                    className: 'exclude-rule-configuration-modal-ok primary',
                    value: 'Ok',
                    events: {
                        onClick: function () {
                            if (isRuleNameCorrect()) {
                                props.onOK(newRule, !props.isDuplicate ? props.initialExclusionRule : undefined);
                                _this.excludeRulesConfigurationModal.hide();
                            }
                            else {
                                setError('rule-name', true);
                                alert.add({
                                    className: 'error',
                                    message: 'The name should be unique and limited to 50 characters'
                                });
                            }
                        }
                    }
                });
                this.excludeRulesConfigurationModal.setFooter([
                    okBtn,
                    new Button({
                        className: 'exclude-rule-configuration-modal-cancel default',
                        value: 'Cancel',
                        events: {
                            onClick: function () {
                                _this.excludeRulesConfigurationModal.hide();
                            }
                        }
                    })
                ]);
                var attributeInputType = function () {
                    var _a, _b;
                    var inputType;
                    var attributeType = (_a = _this.getAttribute(newRule)) === null || _a === void 0 ? void 0 : _a.getType();
                    if (attributeType) {
                        if ([AttributeModule.TYPE.INTEGER, AttributeModule.TYPE.DOUBLE].indexOf(attributeType) > -1) { // keep Real, but not sure it exists
                            inputType = 'text';
                        }
                        else {
                            if (attributeType === 'String' && !((_b = _this.getAttribute(newRule)) === null || _b === void 0 ? void 0 : _b.hasAuthorizedValues())) {
                                inputType = 'text';
                            }
                            else {
                                inputType = 'select';
                            }
                        }
                    }
                    return inputType;
                };
                var getAttributeType = function () {
                    var _a;
                    return (_a = _this.getAttribute(newRule)) === null || _a === void 0 ? void 0 : _a.getType();
                };
                var searchEngine = function (dataset, text) {
                    return dataset.items.filter(function (_a) {
                        var label = _a.label, value = _a.value;
                        return label.toLowerCase().includes(text.toLowerCase()) || value.toLowerCase().includes(text.toLowerCase());
                    });
                };
                var specificInterfaceDataset = {
                    items: [],
                    name: 'specificInterface',
                    configuration: { searchEngine: searchEngine }
                };
                var specificInterfaceAttributeDataset = {
                    items: [],
                    name: 'specificAttributeDataset',
                    configuration: { searchEngine: searchEngine }
                };
                var alert = new Alert({
                    visible: true,
                    closable: false,
                    autoHide: true,
                    fullWidth: true,
                    hideDelay: 5000,
                    renderTo: this.excludeRulesConfigurationModal.getHeader()
                });
                var form = new Form({
                    className: 'exclude-rule-configuration-modal-form',
                    fields: [{
                            type: 'text',
                            label: 'Rule name',
                            placeholder: 'e.g., Exclude Obsolete Parts',
                            name: 'rule-name',
                            value: 'ruleName' in newRule ? newRule.ruleName.trim() : null,
                            helperText: 'Enter a unique, descriptive name for this rule',
                            maxLength: '50',
                            required: 'true'
                        }, {
                            type: 'text',
                            label: 'Interface Type',
                            className: 'hidden',
                            name: 'fake-input-to-display-label-over-radios',
                            required: 'true'
                        }, {
                            type: 'text',
                            className: 'hidden',
                            name: 'fake-input-to-display-helper-over-radios',
                            helperText: 'Select the category of interface for this exclusion rule',
                        }, {
                            type: 'radio',
                            value: 'Standard Type',
                            label: 'Standard Type',
                            name: 'standard-type',
                            checked: newRule.isOOTB && newRule.interfaceType === 'Type'
                        }, {
                            type: 'radio',
                            value: 'Custom Type',
                            label: 'Custom Type',
                            name: 'custom-type',
                            checked: !newRule.isOOTB && newRule.interfaceType === 'Type'
                        }, {
                            type: 'radio',
                            value: 'Standard Extension',
                            label: 'Standard Extension',
                            name: 'standard-extension',
                            checked: newRule.isOOTB && newRule.interfaceType === 'Interface'
                        }, {
                            type: 'radio',
                            value: 'Custom Extension',
                            label: 'Custom Extension',
                            name: 'custom-extension',
                            checked: !newRule.isOOTB && newRule.interfaceType === 'Interface'
                        }, {
                            type: 'autocomplete',
                            name: 'specific-interface',
                            label: 'Specific interface',
                            placeholder: 'Physical Product (or VPMreference), 3DShape...',
                            datasets: [specificInterfaceDataset],
                            showSuggestsOnFocus: true,
                            helperText: "Select the ".concat(this.getInterfaceTypeLabel(newRule).toLowerCase(), " to exclude"),
                            required: 'true'
                        }, {
                            type: 'autocomplete',
                            name: 'attribute-name',
                            label: 'Attribute',
                            placeholder: '-',
                            datasets: [specificInterfaceAttributeDataset],
                            showSuggestsOnFocus: true,
                            helperText: 'Further refine your rule by selecting an attribute (optional)'
                        }, {
                            type: 'select',
                            label: 'Operator',
                            name: 'attribute-operator',
                            placeholder: '-',
                            options: this.getAttributeOperators(newRule).map(function (operator) { return ({ label: operator, value: operator }); }),
                            value: 'interfaceAttributeOperator' in newRule ? newRule.interfaceAttributeOperator : null
                        }, {
                            type: (_b = attributeInputType()) !== null && _b !== void 0 ? _b : 'text',
                            label: 'Value',
                            placeholder: 'Enter value',
                            name: 'attribute-value',
                            value: 'interfaceAttributeValue' in newRule ? newRule.interfaceAttributeValue : null
                        }],
                    events: {
                        onChange: function () {
                            var property = arguments[0];
                            var value = arguments[1];
                            setError(property, false);
                            switch (property) {
                                case 'rule-name':
                                    newRule.ruleName = value.trim();
                                    if (newRule.ruleName !== value) {
                                        form.setValue(property, newRule.ruleName);
                                    }
                                    break;
                                case 'standard-type':
                                    newRule.isOOTB = true;
                                    newRule.interfaceType = 'Type';
                                    resetSpecificInterface();
                                    props.onFormUpdate(newRule);
                                    break;
                                case 'custom-type':
                                    newRule.isOOTB = false;
                                    newRule.interfaceType = 'Type';
                                    resetSpecificInterface();
                                    props.onFormUpdate(newRule);
                                    break;
                                case 'standard-extension':
                                    newRule.isOOTB = true;
                                    newRule.interfaceType = 'Interface';
                                    resetSpecificInterface();
                                    props.onFormUpdate(newRule);
                                    break;
                                case 'custom-extension':
                                    newRule.isOOTB = false;
                                    newRule.interfaceType = 'Interface';
                                    resetSpecificInterface();
                                    props.onFormUpdate(newRule);
                                    break;
                                case 'attribute-operator':
                                    newRule.interfaceAttributeOperator = value;
                                    resetAttributeValue();
                                    updateInterfaceTypeAttributeValue();
                                    break;
                                case 'attribute-value':
                                    newRule.interfaceAttributeValue = value.trim();
                                    var attributeType = getAttributeType();
                                    if (attributeType) {
                                        switch (attributeType) {
                                            case AttributeModule.TYPE.INTEGER:
                                                try {
                                                    newRule.interfaceAttributeValue = '' + parseInt(newRule.interfaceAttributeValue);
                                                    if (newRule.interfaceAttributeValue === 'NaN') {
                                                        newRule.interfaceAttributeValue = '';
                                                    }
                                                }
                                                catch (e) {
                                                    newRule.interfaceAttributeValue = '';
                                                }
                                                break;
                                            case AttributeModule.TYPE.DOUBLE:
                                                try {
                                                    newRule.interfaceAttributeValue = '' + parseFloat(newRule.interfaceAttributeValue);
                                                    if (newRule.interfaceAttributeValue === 'NaN') {
                                                        newRule.interfaceAttributeValue = '';
                                                    }
                                                }
                                                catch (e) {
                                                    newRule.interfaceAttributeValue = '';
                                                }
                                                break;
                                        }
                                    }
                                    if (newRule.interfaceAttributeValue !== value) {
                                        form.setValue(property, newRule.interfaceAttributeValue);
                                    }
                                    break;
                                default: ;
                            }
                            updateUI();
                        }
                    }
                });
                var resetSpecificInterface = function () {
                    delete newRule.interfaceName;
                    resetAttributeName();
                };
                var resetAttributeName = function () {
                    delete newRule.interfaceAttributeName;
                    delete newRule.interfaceAttributeType;
                    delete newRule.interfaceAttributeOwner;
                    resetAttributeOperator();
                };
                var resetAttributeOperator = function () {
                    delete newRule.interfaceAttributeOperator;
                    resetAttributeValue();
                };
                var resetAttributeValue = function () {
                    delete newRule.interfaceAttributeValue;
                };
                var updateInterfaceTypeOptions = function () {
                    /** remove all options */
                    var specificInterfaceCollection = _this.getSpecificInterfaceCollection(newRule);
                    var optionsToAdd = specificInterfaceCollection.map(function (dictionaryCollectionItem) {
                        var option = {
                            label: dictionaryCollectionItem.getLabel(),
                            value: dictionaryCollectionItem.getId(),
                            handler: function () {
                                if (newRule.interfaceName !== dictionaryCollectionItem.getId()) {
                                    newRule.interfaceName = dictionaryCollectionItem.getId();
                                    resetAttributeName();
                                    updateInterfaceTypeAttributeOptions();
                                    updateInterfaceTypeAttributeOperator();
                                    updateInterfaceTypeAttributeValue();
                                    updateUI();
                                }
                            }
                        };
                        if (dictionaryCollectionItem.getId() === newRule.interfaceName) {
                            var opt = option;
                            opt.selected = true;
                        }
                        return option;
                    });
                    var autocomplete = form.getAutocompleteInput('specific-interface');
                    autocomplete.cleanDataset(0);
                    var dataset = autocomplete.getDataset(0);
                    autocomplete.addItems(optionsToAdd, dataset);
                    autocomplete.setDisabled(optionsToAdd.length === 0);
                    if (!autocomplete.customUnselect) {
                        autocomplete.customUnselect = true;
                        var onUnselect_1 = autocomplete.onUnselect.bind(autocomplete);
                        autocomplete.onUnselect = function (option) {
                            onUnselect_1(option);
                            resetSpecificInterface();
                            updateInterfaceTypeAttributeOptions();
                            updateInterfaceTypeAttributeOperator();
                            updateInterfaceTypeAttributeValue();
                            updateUI();
                        };
                    }
                };
                var updateInterfaceTypeAttributeOptions = function () {
                    /** remove all options */
                    var specificInterfaceCollection = _this.getSpecificInterfaceCollection(newRule);
                    var selectedSpecificInterfaceItem = specificInterfaceCollection.findWhere({ Name: newRule.interfaceName });
                    var optionsToAdd = [];
                    if (selectedSpecificInterfaceItem) {
                        specificInterfaceCollection.computeParents(selectedSpecificInterfaceItem, _this.getSpecificInterfaceCorrespondingOOTBCollection(newRule));
                        selectedSpecificInterfaceItem.computeAllAttributes();
                        optionsToAdd = selectedSpecificInterfaceItem.getAllSupportedAttributes(false).map(function (attribute) {
                            var option = {
                                label: attribute.getLabel(),
                                value: attribute.getId(),
                                handler: function () {
                                    if (newRule.interfaceAttributeName !== attribute.getId()) {
                                        newRule.interfaceAttributeName = attribute.getId();
                                        newRule.interfaceAttributeType = attribute.getType();
                                        newRule.interfaceAttributeOwner = attribute.getOwner();
                                        resetAttributeOperator();
                                        updateInterfaceTypeAttributeOperator();
                                        updateInterfaceTypeAttributeValue();
                                        updateUI();
                                    }
                                }
                            };
                            if (attribute.getId() === newRule.interfaceAttributeName) {
                                var opt = option;
                                opt.selected = true;
                            }
                            return option;
                        });
                    }
                    var autocomplete = form.getAutocompleteInput('attribute-name');
                    autocomplete.cleanDataset(0);
                    var dataset = autocomplete.getDataset(0);
                    autocomplete.addItems(optionsToAdd, dataset);
                    autocomplete.setDisabled(optionsToAdd.length === 0);
                    if (!autocomplete.customUnselect) {
                        autocomplete.customUnselect = true;
                        var onUnselect_2 = autocomplete.onUnselect.bind(autocomplete);
                        autocomplete.onUnselect = function (option) {
                            onUnselect_2(option);
                            resetAttributeName();
                            updateInterfaceTypeAttributeOperator();
                            updateInterfaceTypeAttributeValue();
                            updateUI();
                        };
                    }
                };
                var updateInterfaceTypeAttributeOperator = function () {
                    var _a;
                    var attributeType = (_a = _this.getAttribute(newRule)) === null || _a === void 0 ? void 0 : _a.getType();
                    var operator = 'interfaceAttributeOperator' in newRule && newRule.interfaceAttributeOperator ? newRule.interfaceAttributeOperator : null;
                    var value = 'interfaceAttributeValue' in newRule && newRule.interfaceAttributeValue ? newRule.interfaceAttributeValue : null;
                    //Set default operator
                    if (!operator && attributeType) {
                        operator = '=';
                    }
                    var options = _this.getAttributeOperators(newRule);
                    var input = form.getInput('attribute-operator');
                    input.clear();
                    input.add(options.map(function (option) { return ({ value: option, selected: option === operator }); }));
                    input.setDisabled(options.length <= 1);
                    setInterfaceTypeAttributeValue(value);
                };
                var updateInterfaceTypeAttributeValue = function () {
                    var _a;
                    var field = form.getField('attribute-value');
                    var requestedInputType = attributeInputType();
                    if (requestedInputType !== undefined) {
                        var inputType = void 0;
                        switch (field.tagName.toLowerCase()) {
                            case 'select':
                                inputType = field.tagName.toLowerCase();
                                break;
                            default: inputType = 'text';
                        }
                        if (inputType !== requestedInputType) {
                            return props.onFormUpdate(newRule);
                        }
                    }
                    field.disabled = !('interfaceAttributeOperator' in newRule && newRule.interfaceAttributeOperator);
                    //Set default value
                    var attributeType = (_a = _this.getAttribute(newRule)) === null || _a === void 0 ? void 0 : _a.getType();
                    var value = 'interfaceAttributeValue' in newRule && newRule.interfaceAttributeValue ? newRule.interfaceAttributeValue : null;
                    if (!value && attributeType === AttributeModule.TYPE.BOOLEAN) {
                        setInterfaceTypeAttributeValue('true');
                    }
                };
                var setInterfaceTypeAttributeValue = function (value) {
                    newRule.interfaceAttributeValue = value;
                    var attribute = _this.getAttribute(newRule);
                    var attributeType = attribute === null || attribute === void 0 ? void 0 : attribute.getType();
                    if (attributeType === AttributeModule.TYPE.BOOLEAN) {
                        var input = form.getInput('attribute-value');
                        if (input && typeof input.add === 'function') {
                            input.add(['true', 'false'].map(function (option) { return ({ value: option, label: option.charAt(0).toUpperCase() + option.slice(1), selected: option === value }); }));
                        }
                    }
                    else if (attributeType === AttributeModule.TYPE.STRING && attribute.hasAuthorizedValues()) {
                        var input = form.getInput('attribute-value');
                        if (input && typeof input.add === 'function') {
                            input.add(attribute.getAuthorizedValues().map(function (option) { return ({ value: option, label: attribute.getAuthorizedValueLabel(option), selected: option === value }); }));
                        }
                    }
                    else {
                        form.setValue('attribute-value', value);
                    }
                };
                var updateUI = function () {
                    var isValid = true;
                    if (!newRule.ruleName || !newRule.interfaceType || !newRule.interfaceName) {
                        isValid = false;
                    }
                    /**
                     * By static validation, we know that
                     *  - Rule name is filled
                     *  - Interface type if selected
                     *  - Specific interface is selected
                     */
                    if ('interfaceAttributeName' in newRule && newRule.interfaceAttributeName) {
                        if (!newRule.interfaceAttributeOperator || !newRule.interfaceAttributeValue) {
                            isValid = false;
                        }
                    }
                    okBtn.setDisabled(!isValid);
                };
                var isRuleNameCorrect = function () {
                    return 'ruleName' in newRule && newRule.ruleName ?
                        newRule.ruleName.length <= 50 && !exclusionRuleNames.some(function (ruleName) { return ruleName === newRule.ruleName; })
                        : true;
                };
                var setError = function (name, hasError) {
                    var formGroup = form.getContent().getElement('*[name="' + name + '"]').closest('.form-group');
                    if (formGroup) {
                        //@ts-ignore
                        formGroup.toggleClassName('has-error', hasError);
                    }
                };
                /** init UI */
                updateUI();
                updateInterfaceTypeOptions();
                updateInterfaceTypeAttributeOptions();
                updateInterfaceTypeAttributeOperator();
                updateInterfaceTypeAttributeValue();
                form.getContent().getElement('*[name="fake-input-to-display-label-over-radios"]').closest('.form-group').setAttribute('style', 'margin: 0;');
                return form;
            },
            ExcludeRuleDeletionModalContent: function (props) {
                var _this = this;
                this.excludeRulesDeletionModal.setFooter([
                    new Button({
                        className: 'exclude-rule-configuration-modal-ok primary',
                        value: 'Delete Exclusion Rule',
                        events: {
                            onClick: function () {
                                props.onOK(props.exclusionRule);
                                _this.excludeRulesDeletionModal.hide();
                            }
                        }
                    }),
                    new Button({
                        className: 'exclude-rule-configuration-modal-cancel default',
                        value: 'Cancel',
                        events: {
                            onClick: function () {
                                if (props.onCancel) {
                                    props.onCancel(props.exclusionRule);
                                }
                                _this.excludeRulesDeletionModal.hide();
                            }
                        }
                    })
                ]);
                return UWA.createElement('div', {
                    styles: { display: 'flex', width: '100%', flexFlow: 'column' },
                    html: [{
                            tag: 'span',
                            styles: { display: 'flex', width: '100%' },
                            text: "Are you sure you want to delete the exclusion rule '".concat(props.exclusionRule.ruleName, "' ?")
                        }, {
                            tag: 'span',
                            styles: { display: 'flex', width: '100%' },
                            text: this.getExcludeRuleAvailability(props.exclusionRule) ? this.getExcludeRuleLabelFromRule(props.exclusionRule) : ''
                        }]
                });
            },
            ExcludeRules: function (_a) {
                var _this = this;
                var parameter = _a.parameter, onParameterChange = _a.onParameterChange;
                var argument = parameter.argument[0];
                var onArgumentChange = function (newArgumentValue) {
                    var _parameter = Utils.Utils.clone(parameter);
                    _parameter.argument = [newArgumentValue];
                    onParameterChange(_parameter);
                };
                if (!this.excludeRulesConfigurationModal) {
                    this.excludeRulesConfigurationModal = new Modal({
                        header: 'Exclusion Rule Configuration',
                        className: 'exclusion-rule-configuration-modal',
                        closable: true,
                        renderTo: this.parentElement
                    });
                }
                if (!this.excludeRulesDeletionModal) {
                    this.excludeRulesDeletionModal = new Modal({
                        header: 'Delete Exclusion Rule',
                        className: 'exclusion-rule-deletion-modal',
                        closable: true,
                        renderTo: this.parentElement
                    });
                }
                var getExclusionRulesFromArgValue = function (argValue) {
                    try {
                        var parsedValue = JSON.parse(argValue);
                        return Array.isArray(parsedValue) ? parsedValue : [];
                    }
                    catch (error) {
                        return [];
                    }
                };
                var getConcatenatedExclusionRulesFrom = function (exclusionRules) {
                    return JSON.stringify(exclusionRules);
                };
                var onExcludeRuleModalOk = function (newRule, previousRule) {
                    var newArgument = Utils.Utils.clone(argument);
                    var argValue = getExclusionRulesFromArgValue(newArgument.argValue);
                    Object.keys(newRule).forEach(function (key) { return newRule[key] = newRule[key] === '' ? null : newRule[key]; });
                    newRule = __assign({ interfaceAttributeOwner: null, interfaceAttributeType: null, interfaceAttributeName: null, interfaceAttributeOperator: null, interfaceAttributeValue: null, interfaceName: null, interfaceType: null, isOOTB: null, ruleName: null }, newRule);
                    if (previousRule) {
                        var previousRuleIndex = argValue.findIndex(function (rule) { return JSON.stringify(rule) === JSON.stringify(previousRule); });
                        argValue.splice(previousRuleIndex, 1, newRule);
                    }
                    else {
                        argValue.push(newRule);
                    }
                    newArgument.argValue = getConcatenatedExclusionRulesFrom(argValue);
                    onArgumentChange(newArgument);
                };
                var onAddClick = function (exclusionRule, initialExclusionRule, isDuplicate) {
                    _this.excludeRulesConfigurationModal.setBody(_this.ExcludeRuleModalContent(getExcludeRuleModalProps(exclusionRule, initialExclusionRule, isDuplicate)));
                    _this.excludeRulesConfigurationModal.show();
                };
                var onEditClick = function (exclusionRule) {
                    onAddClick(exclusionRule, exclusionRule);
                };
                var getExcludeRuleModalProps = function (exclusionRule, initialExclusionRule, isDuplicate) {
                    var exclusionRuleIndex = excludeRules.map(function (rule) { return rule.ruleName; }).indexOf(exclusionRule ? exclusionRule.ruleName : '');
                    var exclusionRules = __spreadArray([], excludeRules, true);
                    if (exclusionRuleIndex >= 0 && !isDuplicate) {
                        exclusionRules.splice(exclusionRuleIndex, 1);
                    }
                    return {
                        onOK: onExcludeRuleModalOk,
                        onFormUpdate: function (rule) { onAddClick(rule, initialExclusionRule, isDuplicate); },
                        initialExclusionRule: initialExclusionRule,
                        exclusionRule: exclusionRule,
                        exclusionRules: exclusionRules,
                        isDuplicate: isDuplicate
                    };
                };
                var onDeleteClick = function (exclusionRule) {
                    _this.excludeRulesDeletionModal.setBody(_this.ExcludeRuleDeletionModalContent({
                        exclusionRule: exclusionRule,
                        onOK: function () {
                            var newArgument = Utils.Utils.clone(argument);
                            var argValue = getExclusionRulesFromArgValue(newArgument.argValue);
                            var indexToRemove = argValue.findIndex(function (rule) {
                                return exclusionRule.ruleName === rule.ruleName;
                            });
                            var removed = argValue.splice(indexToRemove, 1);
                            newArgument.argValue = getConcatenatedExclusionRulesFrom(argValue);
                            onArgumentChange(newArgument);
                        }
                    }));
                    _this.excludeRulesDeletionModal.show();
                };
                var labelPanel = UWA.createElement('div', {
                    'class': 'exclude-rules-label-container',
                    styles: { display: 'flex', flexDirection: 'horizontal', alignItems: 'center', justifyContent: 'flex-start' },
                    html: [
                        this.ParameterLabel(argument.nlsKey),
                        this.ParameterTooltip(argument.tooltipNlsKey)
                    ]
                });
                var addIcon = UWA.createElement('span', {
                    'class': 'fonticon fonticon-plus exclude-rules-add',
                    title: 'Create a new exclusion rule',
                    styles: { color: '#77797c' },
                    events: {
                        'click': function () {
                            onAddClick();
                        }
                    }
                });
                this.AddIconMouseOver(addIcon);
                var actionsPanel = UWA.createElement('div', {
                    'class': 'exclude-rules-actions-container',
                    styles: { display: 'flex', flexDirection: 'horizontal', alignItems: 'center', justifyContent: 'flex-start' },
                    html: [addIcon]
                });
                // const parameterHeaderDiv = UWA.createElement('div', {
                //   'class': 'exclude-rules-header',
                //   styles: { display: 'flex', flexDirection: 'horizontal', alignItems: 'center', justifyContent: 'space-between', width: '100%' },
                //   html: [
                //     labelPanel,
                //     actionsPanel
                //   ]
                // });
                //const excludeRules = rules;
                var excludeRules = getExclusionRulesFromArgValue(argument.argValue);
                var excludeRulesList = UWA.createElement('div', {
                    'class': 'exclude-rules-list',
                    styles: { display: 'flex', flexDirection: 'column', alignItems: 'stretch', justifyContent: 'flex-start', width: '100%' },
                    html: excludeRules.length > 0
                        ? excludeRules.map(function (excludeRule) {
                            var deleteIcon = UWA.createElement('span', {
                                tag: 'span',
                                'class': 'fonticon fonticon-trash exclude-rules-delete',
                                title: 'Delete this rule',
                                styles: { color: '#77797c' },
                                events: {
                                    'click': function () {
                                        onDeleteClick(excludeRule);
                                    }
                                }
                            });
                            _this.AddIconMouseOver(deleteIcon);
                            var editIcon = UWA.createElement('span', {
                                tag: 'span',
                                'class': 'fonticon fonticon-pencil exclude-rules-edit',
                                title: 'Edit this rule to change filtering parameters',
                                styles: { color: '#77797c' },
                                events: {
                                    'click': function () {
                                        onEditClick(excludeRule);
                                    }
                                }
                            });
                            _this.AddIconMouseOver(editIcon);
                            var duplicateRule = __assign(__assign({}, excludeRule), { ruleName: excludeRule.ruleName + '-copy' });
                            var duplicateIcon = UWA.createElement('span', {
                                tag: 'span',
                                'class': 'fonticon fonticon-duplicate exclude-rules-duplicate',
                                title: 'Duplicate this rule to create a copy and modify it easily',
                                styles: { color: '#77797c' },
                                events: {
                                    'click': function () {
                                        onAddClick(duplicateRule, duplicateRule, true);
                                    }
                                }
                            });
                            _this.AddIconMouseOver(duplicateIcon);
                            return UWA.createElement('div', {
                                title: !_this.getExcludeRuleAvailability(excludeRule) ? 'Rule inactive: Required interface or attribute no longer exists' : '',
                                styles: {
                                    backgroundColor: _this.getExcludeRuleAvailability(excludeRule) ? '#f9f9f9' : '#F4F5F6',
                                    border: 'solid 1px #e2e4e3',
                                    borderRadius: '4px',
                                    padding: '2px 10px',
                                    margin: '4px 8px 4px 0',
                                    display: 'flex',
                                    flexDirection: 'row',
                                    alignItems: 'center',
                                    justifyContent: 'space-between'
                                },
                                html: [{
                                        tag: 'div',
                                        styles: { flex: '1' },
                                        html: [{
                                                tag: 'div',
                                                styles: { fontSize: '13px', fontWeight: 'bold', color: _this.getExcludeRuleAvailability(excludeRule) ? '#3d3d3d' : '#D1D4D4' },
                                                text: excludeRule.ruleName
                                            }, {
                                                tag: 'div',
                                                styles: { fontSize: '13px', color: _this.getExcludeRuleAvailability(excludeRule) ? '#77797c' : '#D1D4D4' },
                                                text: _this.getExcludeRuleAvailability(excludeRule) ? _this.getExcludeRuleLabelFromRule(excludeRule) : 'Rule inactive: Required interface or attribute no longer exists'
                                            }]
                                    }, {
                                        tag: 'div',
                                        styles: { display: 'flex', flexDirection: 'row', alignItems: 'center', gap: '15px' },
                                        html: _this.getExcludeRuleAvailability(excludeRule) ? [duplicateIcon, editIcon, deleteIcon] : [deleteIcon]
                                    }]
                            });
                        }) : [{
                            tag: 'div',
                            'class': 'no-rules-view',
                            styles: { display: 'flex', flexDirection: 'column', alignItems: 'center', width: '100%' },
                            html: [{
                                    tag: 'div',
                                    text: 'No rules',
                                    styles: { color: '#b4b6ba', fontStyle: 'italic', marginTop: '20px' }
                                }]
                        }]
                });
                // const parameterDiv = UWA.createElement('div', {
                //   'class': 'exclude-rules-container',
                //   styles: { display: 'flex', flexDirection: 'column', alignItems: 'stretch', justifyContent: 'flex-start', width: '100%' },
                //   html: [
                //     parameterHeaderDiv,
                //     excludeRulesList
                //   ]
                // });
                var custom = UWA.createElement('div', {
                    styles: { display: 'flex', width: '100%', flexFlow: 'column' },
                    html: [{
                            tag: 'div',
                            styles: { display: 'flex', width: '100%' },
                            html: [
                                this.ParameterLabel(parameter.nlsKey),
                                this.ParameterTooltip(parameter.tooltipNlsKey),
                                this.ParameterValue(actionsPanel),
                                this.ParameterDeployed(parameter.isDeployed === 'true')
                            ]
                        }, excludeRulesList
                    ]
                });
                return custom;
            },
            /** Row representing the IndexedCollaborativeSpaces and FromStandardCollabSpacesOnly parameters */
            IndexedCollaborativeSpaces: function (_a) {
                var parameter = _a.parameter, linkedParameters = _a.linkedParameters, onParameterChange = _a.onParameterChange;
                this.removeError(parameter.id);
                var standardOnlyParameter = linkedParameters[0];
                var CSArgument = parameter.argument[0];
                var standardOnlyArgument = standardOnlyParameter.argument[0];
                var onArgumentsChange = function (newArgumentValue, newLinkedArgumentValue) {
                    var _parameter = Utils.Utils.clone(parameter);
                    _parameter.argument = [newArgumentValue];
                    var _linkedParameter = Utils.Utils.clone(linkedParameters[0]);
                    _linkedParameter.argument = [newLinkedArgumentValue];
                    onParameterChange(_parameter, [_linkedParameter]);
                };
                var isDeployed = parameter.isDeployed === 'true' && standardOnlyParameter.isDeployed === 'true';
                var indexationType, newIndexationType;
                var CSJsonValue = null, newCSJsonValue = null;
                if (CSArgument.argValue !== '') {
                    // if argument value is not an empty string, it should be null or a json
                    try {
                        CSJsonValue = JSON.parse(CSArgument.argValue);
                    }
                    catch (e) {
                        // manage exception if json is not valid
                        CSJsonValue = null;
                        parameter.isDeployed = 'false';
                    }
                }
                if (CSJsonValue && Array.isArray(CSJsonValue)) {
                    indexationType = 'selected';
                }
                else {
                    indexationType = standardOnlyArgument.argValue === ParameterizationModelModule.BooleanArgValue.TRUE ? 'standard' : 'all';
                }
                newIndexationType = indexationType;
                newCSJsonValue = CSJsonValue;
                if (indexationType === 'selected' && CSJsonValue.length === 0) {
                    this.addError(parameter.id);
                }
                var updateIfNecessary = function () {
                    if (newIndexationType !== indexationType || JSON.stringify(newCSJsonValue) !== JSON.stringify(CSJsonValue)) {
                        var newStandardOnlyValue = newIndexationType === 'standard' ? ParameterizationModelModule.BooleanArgValue.TRUE : ParameterizationModelModule.BooleanArgValue.FALSE;
                        var newCollabSpacesValue = JSON.stringify(newCSJsonValue);
                        var _standardOnlyArgument = Utils.Utils.clone(standardOnlyArgument);
                        _standardOnlyArgument.argValue = newStandardOnlyValue;
                        var _CSArgument = Utils.Utils.clone(CSArgument);
                        _CSArgument.argValue = newCollabSpacesValue;
                        onArgumentsChange(_CSArgument, _standardOnlyArgument);
                    }
                };
                var CSSelectOptions = [];
                CSSelectOptions = this.CollabSpaces.map(function (cs) {
                    return { value: cs.getId(), label: cs.getLabel() };
                });
                // add deleted collabspaces to options
                if (CSJsonValue && Array.isArray(CSJsonValue)) {
                    CSJsonValue.forEach(function (selected) {
                        var found = CSSelectOptions.find(function (cs) {
                            return selected.name === cs.value;
                        });
                        if (!found) {
                            // collabspace is deleted !
                            CSSelectOptions.unshift({
                                value: selected.name,
                                label: selected.title,
                                attributes: { style: 'color:red;' }
                            });
                        }
                    });
                }
                var valueOfCSSelect = null;
                if (CSJsonValue && Array.isArray(CSJsonValue)) {
                    valueOfCSSelect = CSJsonValue.map(function (cs) {
                        return cs.name;
                    });
                }
                var CSSelectEnabled = indexationType === 'selected';
                var onCSSelectChange = function (e) {
                    if (CSSelect) {
                        var collabSpaces = CSSelect.getValue();
                        // remove placeholder !!!
                        if (collabSpaces.length === 1 && collabSpaces[0] === '') {
                            collabSpaces = [];
                        }
                        newCSJsonValue = collabSpaces.map(function (id) {
                            var found = CSSelectOptions.find(function (cs) {
                                return cs.value === id;
                            });
                            return { name: found.value, title: found.label };
                        });
                        updateIfNecessary();
                    }
                };
                var radioForm = new Form({
                    className: 'indexed-collabspaces-form',
                    fields: [{
                            type: 'radio',
                            value: 'all',
                            label: 'All',
                            name: 'all',
                            checked: indexationType === 'all'
                        }, {
                            type: 'radio',
                            value: 'standard',
                            label: 'Standard only',
                            name: 'standard',
                            checked: indexationType === 'standard'
                        }, {
                            type: 'radio',
                            value: 'selected',
                            label: 'Selected only:',
                            name: 'selected',
                            checked: indexationType === 'selected'
                        }],
                    events: {
                        onChange: function () {
                            var property = arguments[0];
                            switch (property) {
                                case 'all':
                                    newIndexationType = 'all';
                                    newCSJsonValue = null;
                                    break;
                                case 'standard':
                                    newIndexationType = 'standard';
                                    newCSJsonValue = null;
                                    break;
                                case 'selected':
                                    newIndexationType = 'selected';
                                    newCSJsonValue = [];
                                    break;
                                default: ;
                            }
                            updateIfNecessary();
                        }
                    }
                });
                var CSSelect = new Select({ id: parameter.id + '-cs-select', multiple: true, value: valueOfCSSelect, options: CSSelectOptions, placeholder: 'Select Collaborative Spaces', disabled: !CSSelectEnabled });
                CSSelect.addEvent('onChange', onCSSelectChange);
                var custom = UWA.createElement('div', {
                    styles: { display: 'flex', width: '100%', flexFlow: 'column' },
                    html: [{
                            tag: 'div',
                            styles: { display: 'flex', width: '100%' },
                            html: [
                                this.ParameterLabel(parameter.nlsKey),
                                this.ParameterTooltip(parameter.tooltipNlsKey),
                                this.ParameterValue(UWA.createElement('div', {})),
                                this.ParameterDeployed(isDeployed)
                            ]
                        }, {
                            tag: 'div',
                            styles: { display: 'flex', width: '40%', flexDirection: 'column', padding: '8px 8px 0 16px' },
                            html: [
                                radioForm.getContent()
                            ]
                        }, {
                            tag: 'div',
                            styles: { display: 'flex', width: '80%' },
                            html: [{
                                    tag: 'div',
                                    styles: { display: 'flex', width: '50%', flexDirection: 'column', padding: '0px 16px 8px 45px' },
                                    html: [
                                        CSSelect.getContent()
                                    ]
                                }]
                        }]
                });
                this.AddMouseOver(custom);
                return custom;
            }
        });
    })(PartSupplyIndexingManagementDomain || (PartSupplyIndexingManagementDomain = {}));
    return PartSupplyIndexingManagementDomain;
});
/*let rules: Array<ExclusionRule> = [{
  ruleName: 'Rule Number One',
  isOOTB: true,
  interfaceType: 'Type',
  interfaceName: 'VPMReference',
  interfaceAttributeName: 'PLMEntity.V_nature',
  interfaceAttributeOperator: '≠',
  interfaceAttributeValue: '2'
}, {
  ruleName: 'Rule Number Two',
  isOOTB: true,
  interfaceType: 'Type',
  interfaceName: '3DShape',
  interfaceAttributeName: undefined,
  interfaceAttributeOperator: undefined,
  interfaceAttributeValue: undefined
}];*/ 

define('DS/ParameterizationSkeleton/Views/PPRSynchronizationLifeCycle/PPRSynchroViewUtilities',
	[
		'UWA/Core',
		'DS/UIKIT/Input/Select',
		'DS/UIKIT/Modal',
		'DS/UIKIT/Input/Text',
		'DS/UIKIT/Input/Number',
		'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
		'DS/WAFData/WAFData',
		'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
		'DS/ParameterizationSkeleton/Views/PPRSynchronizationLifeCycle/PPRSynchroViewConstants',
		'DS/ParameterizationSkeleton/Views/PPRSynchronizationLifeCycle/PPRSynchroAddLineDialog',
		'i18n!DS/ParameterizationSkeleton/assets/nls/PPRSynchroLifeCycleNLS'
	],
	function (UWA,
		Select,
		Modal,
		Text,
		Number,
		ParametersLayoutViewUtilities,
		WAFData,
		URLHandler,
		PPRSynchroViewConstants,
		PPRSynchroAddLineDialog,
		PPRSynchroLifeCycleNLS) {

	'use strict';

	var LEFT_ALIGNMENT = 'left';
	var RIGHT_ALIGNMENT = 'right';

	

	var HTML_BOLD_FORMAT1 = 'h1';
		var HTML_BOLD_FORMAT3 = 'h3';
		var HTML_BOLD_FORMAT4 = 'h4';
		var HTML_BOLD_FORMAT5 = 'h5';
		var HTML_BOLD_FORMAT6 = 'h6';
	var HTML_PARAG_FORMAT = null;
	var RULES_BCKGROUND = "#ffffff";

	var rulesCouplingTable = UWA.createElement('table', {
		'class': 'lifecycTableMapping table table-striped'
		});
	var widthTable = PPRSynchroViewConstants.WIDTH_ARRAY;

	var lifeCycleRulesAttributesValues = {};
	var avoidDupCounterUserSelectionRequired = "";
	var strategySelectorCombobox = [{
			label: PPRSynchroLifeCycleNLS.UserDefined,
			value: "UserDefined"
		}
		/*,{
		label: PPRSynchroLifeCycleNLS.External,
		value: "External"
		}*/
	];

	var strategyCombobox;

	var ruleView = {
		initVariable: function () {
			this.cellsIndex = {
				"type": 0,
				"computedResultingProduct": 1,
				//SPEC_DOC commented asked by Paul IR926203
				//"specDoc": 2,=> incrementer les indices ci-dessous lorsque retabli
				"childTransformationTypes": 2,
				"newRevision": 3,
				"newBranch": 4,
				"duplicate": 5,
				"deletion": 6,
				"transferOwnership": 7,
				"changeMaturity": 8,
				"lock": 9,
				"changeControl": 10,
				"transfer": 11,
				"share":12,
				"action":13, //boutons add-Remove
				"deployFlag": 14 //green for deployed on server or orange for not deployed
			};
		},

		lifeCycleRulesAttributes: function (attributeMapping, avoidDupCounterValue) {
			lifeCycleRulesAttributesValues = attributeMapping;
			avoidDupCounterUserSelectionRequired = avoidDupCounterValue;
		},

		buildImgSpan: function (iconChoice, iconSize, iconColor, title) {
			var imgClass = 'fonticon fonticon-' + iconSize + 'x fonticon-' + iconChoice,
			imgSpan = UWA.createElement('span', {
					'class': imgClass,
					'title': title
				});

			imgSpan.setStyle("color", iconColor);
			return imgSpan;
		},

		convertFormatWebServiceToTable: function(iCollection/*format get by webservice*/)
		{
			var ind, jrules, kcmd, lineRow;
			var type, listCommandsForOneType, listRulesForOneType, oneCmd, oneLC_Rule;

			var tableOfRules = [];

			for (ind = 0; ind < iCollection.length; ind++) {
				var obj = [];
				lineRow = iCollection[ind];
				type = lineRow.type;

				obj[PPRSynchroViewConstants.TYPE] = type;
				//init
				obj[PPRSynchroViewConstants.COMPUTED_RESULTING_PRODUCT] = false;
				//SPEC_DOC commented asked by Paul IR926203
				//obj[PPRSynchroViewConstants.SPEC_DOC] = false;
				obj[PPRSynchroViewConstants.CHILD_TRANSFORMATION_TYPES] = false;

				obj[PPRSynchroViewConstants.NEW_REVISION] = false;
				obj[PPRSynchroViewConstants.NEW_BRANCH] = false;

				obj[PPRSynchroViewConstants.DUPLICATE] = false;
				obj[PPRSynchroViewConstants.DELETE] = false;
				obj[PPRSynchroViewConstants.TRANSFER_OWNERSHIP] = false;
				obj[PPRSynchroViewConstants.CHANGE_MATURIY] = false;

				obj[PPRSynchroViewConstants.LOCK] = false;
				obj[PPRSynchroViewConstants.CHANGE_CONTROL] = false;
				obj[PPRSynchroViewConstants.TRANSFER] = false;
				obj[PPRSynchroViewConstants.SHARE] = false;

				listRulesForOneType = lineRow.LC_Rules;
				for (jrules = 0; jrules < listRulesForOneType.length; jrules++) {
					oneLC_Rule = listRulesForOneType[jrules];
					if (oneLC_Rule == PPRSynchroViewConstants.COMPUTED_RESULTING_PRODUCT)
						obj[PPRSynchroViewConstants.COMPUTED_RESULTING_PRODUCT] = true;
					//SPEC_DOC commented asked by Paul IR926203
					//else if (oneLC_Rule == PPRSynchroViewConstants.SPEC_DOC)
					//	obj[PPRSynchroViewConstants.SPEC_DOC] = true;
					else if (oneLC_Rule == PPRSynchroViewConstants.CHILD_TRANSFORMATION_TYPES)
						obj[PPRSynchroViewConstants.CHILD_TRANSFORMATION_TYPES] = true;
				}

				listCommandsForOneType = lineRow.commands;

				for (kcmd = 0; kcmd < listCommandsForOneType.length; kcmd++) {
					oneCmd = listCommandsForOneType[kcmd];
					if (oneCmd == PPRSynchroViewConstants.NEW_REVISION)
						obj[PPRSynchroViewConstants.NEW_REVISION] = true;
					else if (oneCmd == PPRSynchroViewConstants.NEW_BRANCH)
						obj[PPRSynchroViewConstants.NEW_BRANCH] = true;
					else if (oneCmd == PPRSynchroViewConstants.DUPLICATE)
						obj[PPRSynchroViewConstants.DUPLICATE] = true;
					else if (oneCmd == PPRSynchroViewConstants.DELETE)
						obj[PPRSynchroViewConstants.DELETE] = true;
					else if (oneCmd == PPRSynchroViewConstants.TRANSFER_OWNERSHIP)
						obj[PPRSynchroViewConstants.TRANSFER_OWNERSHIP] = true;
					else if (oneCmd == PPRSynchroViewConstants.CHANGE_MATURIY)
						obj[PPRSynchroViewConstants.CHANGE_MATURIY] = true;
					else if (oneCmd == PPRSynchroViewConstants.LOCK)
						obj[PPRSynchroViewConstants.LOCK] = true;
					else if (oneCmd == PPRSynchroViewConstants.CHANGE_CONTROL)
						obj[PPRSynchroViewConstants.CHANGE_CONTROL] = true;
					else if (oneCmd == PPRSynchroViewConstants.TRANSFER)
						obj[PPRSynchroViewConstants.TRANSFER] = true;
					else if (oneCmd == PPRSynchroViewConstants.SHARE)
						obj[PPRSynchroViewConstants.SHARE] = true;
				}
				tableOfRules.push(obj);
			}
			return tableOfRules;
		},

		convertTableToFormatWebservice: function (iTableOfRules/*format table*/) {
			var ind;

			var collection = [];

			for (ind = 0; ind < iTableOfRules.length; ind++) {
				var obj = iTableOfRules[ind];
				var lineRow = {};
				lineRow.type = obj[PPRSynchroViewConstants.TYPE];
				lineRow.LC_Rules = [];
				lineRow.commands = [];

				//LC_Rules
				if (obj[PPRSynchroViewConstants.COMPUTED_RESULTING_PRODUCT])
					lineRow.LC_Rules.push(PPRSynchroViewConstants.COMPUTED_RESULTING_PRODUCT);
				//SPEC_DOC commented asked by Paul IR926203
				//if (obj[PPRSynchroViewConstants.SPEC_DOC])
				//	lineRow.LC_Rules.push(PPRSynchroViewConstants.SPEC_DOC);
				if (obj[PPRSynchroViewConstants.CHILD_TRANSFORMATION_TYPES])
					lineRow.LC_Rules.push(PPRSynchroViewConstants.CHILD_TRANSFORMATION_TYPES);

				//commands
				if (obj[PPRSynchroViewConstants.NEW_REVISION]) {
					lineRow.commands.push(PPRSynchroViewConstants.NEW_REVISION);
					//new Revision From merged with New Revision
					lineRow.commands.push(PPRSynchroViewConstants.NEW_REVISION_FROM);

				}
				if (obj[PPRSynchroViewConstants.NEW_BRANCH])
					lineRow.commands.push(PPRSynchroViewConstants.NEW_BRANCH);
				if (obj[PPRSynchroViewConstants.DUPLICATE]) {
					lineRow.commands.push(PPRSynchroViewConstants.DUPLICATE);
					//Advance Duplicate Merged with Duplicate
					lineRow.commands.push(PPRSynchroViewConstants.ADVANCE_DUPLICATE);
				}
				if (obj[PPRSynchroViewConstants.DELETE])
					lineRow.commands.push(PPRSynchroViewConstants.DELETE);
				if (obj[PPRSynchroViewConstants.TRANSFER_OWNERSHIP])
					lineRow.commands.push(PPRSynchroViewConstants.TRANSFER_OWNERSHIP);
				if (obj[PPRSynchroViewConstants.CHANGE_MATURIY])
					lineRow.commands.push(PPRSynchroViewConstants.CHANGE_MATURIY);
				if (obj[PPRSynchroViewConstants.LOCK])
					lineRow.commands.push(PPRSynchroViewConstants.LOCK);
				if (obj[PPRSynchroViewConstants.CHANGE_CONTROL])
					lineRow.commands.push(PPRSynchroViewConstants.CHANGE_CONTROL);
				if (obj[PPRSynchroViewConstants.TRANSFER])
					lineRow.commands.push(PPRSynchroViewConstants.TRANSFER);
				if (obj[PPRSynchroViewConstants.SHARE])
					lineRow.commands.push(PPRSynchroViewConstants.SHARE);

				collection.push(lineRow);
				}
			return collection;
		},

		buildTextTableCell: function (alignment, cellWidth, row, cellFormat, cellTest, colspan ) {
			var colspanValue = (colspan) ? colspan : '1';
			var iCell = UWA.createElement('td', {
				'Align': alignment,
				'width': cellWidth,
				'colspan': colspanValue,
				'class': 'font-3dslight'
			}).inject(row);

			if (cellFormat) {
				UWA.createElement(cellFormat, {
					text: cellTest
				}).inject(iCell);
			} else {
				iCell.appendText(cellTest);
			}
			return iCell;
		},

		buildAttributeTable: function (tableRules) {

			var pNFieldbody = UWA.createElement('tbody', {
					'class': 'PPRSynchroFieldbody'
			}).inject(rulesCouplingTable);

			var fieldInfo;

			fieldInfo = ruleView.buildPNFormulaRow(tableRules);
			fieldInfo.inject(pNFieldbody);

			fieldInfo = ruleView.buildPNTableHeading();
			fieldInfo.inject(pNFieldbody);

			return rulesCouplingTable;
		},


		buildPNFormulaRow: function (data) {
			var fieldInfo,iCell;

			fieldInfo = UWA.createElement('tr', {
					'class': 'PPRRulesFormula',
					'id': 'PPRRulesFormula'
				});

			fieldInfo.value = [];

			var imgClass = 'fonticon fonticon-' + '2.5' + 'x  fonticon-info';


			ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.name], fieldInfo, HTML_PARAG_FORMAT, "");


			iCell = ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.newRevision], fieldInfo, HTML_BOLD_FORMAT5, "[" + PPRSynchroLifeCycleNLS.freeValue + "]", "4");
			iCell.value = PPRSynchroViewConstants.FORMULA_CELL;

			iCell = UWA.createElement('td', {
					'width': widthTable[this.cellsIndex.deployFlag],
					'align': RIGHT_ALIGNMENT,
					'title': PPRSynchroLifeCycleNLS.deployStatus,
					'class': 'font-3dslight' // font-3dsbold
				});

			var imgSpan = ruleView.buildImgSpan('check', '2.5', 'green', PPRSynchroLifeCycleNLS.Deployed);
			imgSpan.inject(iCell);
			iCell.value = "success";
			iCell.inject(fieldInfo);

			return fieldInfo;
		},

		buildPNTableHeading: function () {
			var fieldInfo;

			fieldInfo = UWA.createElement('tr', {
					'class': 'success'
				});

			//Build Table Heading
			ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.type], fieldInfo, HTML_BOLD_FORMAT4, PPRSynchroLifeCycleNLS.Type);

			var cell = ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.computedResultingProduct], fieldInfo, HTML_BOLD_FORMAT4, PPRSynchroLifeCycleNLS.ComputedResultingProduct);
			//cell.addClassName("PPRSynchroColor1");
			//cell.setStyle("color", "#cc0000");
			//cell.setStyle("background-color", "#16537e");
			cell.setStyle("background-color", RULES_BCKGROUND);

			//SPEC_DOC commented asked by Paul IR926203
			//cell = ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.specDoc], fieldInfo, HTML_BOLD_FORMAT4, PPRSynchroLifeCycleNLS.SpecDoc);
			//cell.setStyle("background-color", RULES_BCKGROUND);
			cell = ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.childTransformationTypes], fieldInfo, HTML_BOLD_FORMAT4, PPRSynchroLifeCycleNLS.ChildTransformationTypes);
			cell.setStyle("background-color", RULES_BCKGROUND);

			ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.newRevision], fieldInfo, HTML_BOLD_FORMAT4, PPRSynchroLifeCycleNLS.NewRevision);
			ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.newBranch], fieldInfo, HTML_BOLD_FORMAT4, PPRSynchroLifeCycleNLS.NewBranch);
			ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.duplicate], fieldInfo, HTML_BOLD_FORMAT4, PPRSynchroLifeCycleNLS.Duplicate);
			ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.deletion], fieldInfo, HTML_BOLD_FORMAT4, PPRSynchroLifeCycleNLS.Delete);
			ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.transferOwnership], fieldInfo, HTML_BOLD_FORMAT4, PPRSynchroLifeCycleNLS.TransferOwnership);
			ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.changeMaturity], fieldInfo, HTML_BOLD_FORMAT4, PPRSynchroLifeCycleNLS.ChangeMaturity);

			ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.lock], fieldInfo, HTML_BOLD_FORMAT4, PPRSynchroLifeCycleNLS.Lock);
			ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.changeControl], fieldInfo, HTML_BOLD_FORMAT4, PPRSynchroLifeCycleNLS.ChangeControl);
			ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.transfer], fieldInfo, HTML_BOLD_FORMAT4, PPRSynchroLifeCycleNLS.Transfer);
			ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.share], fieldInfo, HTML_BOLD_FORMAT4, PPRSynchroLifeCycleNLS.Share);

			//Action (edit Remove)
			ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.action], fieldInfo, HTML_BOLD_FORMAT5, PPRSynchroLifeCycleNLS.Action);
			//Deploy Status
			ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.deployFlag], fieldInfo, HTML_BOLD_FORMAT5, PPRSynchroLifeCycleNLS.deployStatus);

			return fieldInfo;
		},

		addEditButtonToCellRow: function (iCell) {
			var editElts = ParametersLayoutViewUtilities.createActionElements(PPRSynchroLifeCycleNLS.editField, false);
			var editSpan = editElts[0];
			editSpan.setStyle("float", LEFT_ALIGNMENT);
			editSpan.setStyle("padding", "0px 8px");
			editSpan.inject(iCell);
			var editAttributeButton = editElts[1];
			var editPop = editElts[2];

			editAttributeButton.addEvent("onClick", function (event) {
				var fieldToEdit = event.currentTarget.getParent().getParent().getParent();
				ruleView.editFieldDialog(fieldToEdit, lifeCycleRulesAttributesValues, avoidDupCounterUserSelectionRequired);

			});

			return editAttributeButton;
		},

		addRemoveButtonToCellRow: function (iCell, fieldInfo) {
			var removelts = ParametersLayoutViewUtilities.createActionElements(PPRSynchroLifeCycleNLS.removeField, true);
			var deleteSpan = removelts[0];
			deleteSpan.setStyle("float", LEFT_ALIGNMENT);
			deleteSpan.setStyle("padding", "0px 8px");
			deleteSpan.inject(iCell);
			var removeAttributeButton = removelts[1];
			var removePop = removelts[2];

			removeAttributeButton.addEvent("onClick", function (e) {
				ruleView.removefieldLineCallBack(fieldInfo);
			});

			return removeAttributeButton;
		},

		fullfillBooleanCell(iCell, booleanValue, labelcategory)
		{
			iCell.empty();
			var textTooltip = labelcategory + " = " + booleanValue;

			if (booleanValue) {
			
				var imgSpan = ruleView.buildImgSpan('check', '2.5', 'green', textTooltip);
				imgSpan.inject(iCell);
			}
			else
			{
				var imgSpan = ruleView.buildImgSpan('wrong', '2.5', "#e2e4e3"/*grey-3*/, textTooltip);
				imgSpan.inject(iCell);
            }
        },

		buildLineField: function (fieldInfo, objParam, isDeployed) {
			var that = this;
			var iCell;

			//Build a new line from the objparam (a table containing the info to display in line)
			fieldInfo.value = isDeployed;
			var labelType = this.getLabelTypeFromTypeValue(objParam[PPRSynchroViewConstants.TYPE]);

			ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.type], fieldInfo, HTML_PARAG_FORMAT, labelType);

			iCell = ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.computedResultingProduct], fieldInfo, HTML_PARAG_FORMAT, "");
			this.fullfillBooleanCell(iCell, objParam[PPRSynchroViewConstants.COMPUTED_RESULTING_PRODUCT], PPRSynchroLifeCycleNLS.ComputedResultingProduct);

			//SPEC_DOC commented asked by Paul IR926203
			//iCell = ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.specDoc], fieldInfo, HTML_PARAG_FORMAT, "");
			//this.fullfillBooleanCell(iCell, objParam[PPRSynchroViewConstants.SPEC_DOC], PPRSynchroLifeCycleNLS.SpecDoc);
		
			
			iCell = ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.childTransformationTypes], fieldInfo, HTML_PARAG_FORMAT, "");
			this.fullfillBooleanCell(iCell, objParam[PPRSynchroViewConstants.CHILD_TRANSFORMATION_TYPES], PPRSynchroLifeCycleNLS.ChildTransformationTypes);
		

			iCell = ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.newRevision], fieldInfo, HTML_PARAG_FORMAT, "");
			this.fullfillBooleanCell(iCell, objParam[PPRSynchroViewConstants.NEW_REVISION], PPRSynchroLifeCycleNLS.NewRevision);
		

			iCell = ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.newBranch], fieldInfo, HTML_PARAG_FORMAT, "");
			this.fullfillBooleanCell(iCell, objParam[PPRSynchroViewConstants.NEW_BRANCH], PPRSynchroLifeCycleNLS.NewBranch);
			

			iCell = ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.duplicate], fieldInfo, HTML_PARAG_FORMAT, "");
			this.fullfillBooleanCell(iCell, objParam[PPRSynchroViewConstants.DUPLICATE], PPRSynchroLifeCycleNLS.Duplicate);
		

			iCell = ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.deletion], fieldInfo, HTML_PARAG_FORMAT, "");
			this.fullfillBooleanCell(iCell, objParam[PPRSynchroViewConstants.DELETE], PPRSynchroLifeCycleNLS.Delete);
		

			iCell = ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.transferOwnership], fieldInfo, HTML_PARAG_FORMAT, "");
			this.fullfillBooleanCell(iCell, objParam[PPRSynchroViewConstants.TRANSFER_OWNERSHIP], PPRSynchroLifeCycleNLS.TransferOwnership);

			iCell = ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.changeMaturity], fieldInfo, HTML_PARAG_FORMAT, "");
			this.fullfillBooleanCell(iCell, objParam[PPRSynchroViewConstants.CHANGE_MATURIY], PPRSynchroLifeCycleNLS.ChangeMaturity);


			iCell = ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.lock], fieldInfo, HTML_PARAG_FORMAT, "");
			this.fullfillBooleanCell(iCell, objParam[PPRSynchroViewConstants.LOCK], PPRSynchroLifeCycleNLS.Lock);

			iCell = ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.changeControl], fieldInfo, HTML_PARAG_FORMAT, "");
			this.fullfillBooleanCell(iCell, objParam[PPRSynchroViewConstants.CHANGE_CONTROL], PPRSynchroLifeCycleNLS.ChangeControl);

			iCell = ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.transfer], fieldInfo, HTML_PARAG_FORMAT, "");
			this.fullfillBooleanCell(iCell, objParam[PPRSynchroViewConstants.TRANSFER], PPRSynchroLifeCycleNLS.Transfer);

			iCell = ruleView.buildTextTableCell(LEFT_ALIGNMENT, widthTable[this.cellsIndex.share], fieldInfo, HTML_PARAG_FORMAT, "");
			this.fullfillBooleanCell(iCell, objParam[PPRSynchroViewConstants.SHARE], PPRSynchroLifeCycleNLS.Share);

			//Action Cell (Edit & Remove)
			iCell = UWA.createElement('td', {
					'Align': LEFT_ALIGNMENT,
					'width': widthTable[6],
					'class': 'font-3dslight' // font-3dsbold
				}).inject(fieldInfo);

			var editAttributeButton = ruleView.addEditButtonToCellRow(iCell);
			var removeAttributeButton = ruleView.addRemoveButtonToCellRow(iCell, fieldInfo);

			//DeployStatus Cell (the icon checjk green or cog orange)
			iCell = UWA.createElement('td', {
					'Align': RIGHT_ALIGNMENT,
					'width': widthTable[5],
					'class': 'font-3dslight' // font-3dsbold
				}).inject(fieldInfo);

			if (isDeployed == PPRSynchroViewConstants.DEPLOYED) {
				var imgSpan = ruleView.buildImgSpan('check', '2.5', 'green', PPRSynchroLifeCycleNLS.Deployed);
				imgSpan.inject(iCell);
			} else if (isDeployed === PPRSynchroViewConstants.NEW_NOT_DEPLOYED) {
				var imgSpan = ruleView.buildImgSpan('cog', '2.5', 'orange', PPRSynchroLifeCycleNLS.Modified);
				imgSpan.inject(iCell);
			}

			iCell.inject(fieldInfo);

			return fieldInfo;
		},

		buildObjectFromRow: function (fieldInfo) {
			var obj = {};

			obj[PPRSynchroViewConstants.TYPE] = fieldInfo.cells[this.cellsIndex.type].value;
			
			obj[PPRSynchroViewConstants.COMPUTED_RESULTING_PRODUCT] = fieldInfo.cells[this.cellsIndex.computedResultingProduct].value;
			//SPEC_DOC commented asked by Paul IR926203
			//obj[PPRSynchroViewConstants.SPEC_DOC] = fieldInfo.cells[this.cellsIndex.specDoc].value;
			obj[PPRSynchroViewConstants.CHILD_TRANSFORMATION_TYPES] = fieldInfo.cells[this.cellsIndex.childTransformationTypes].value;
			
			obj[PPRSynchroViewConstants.NEW_REVISION] = fieldInfo.cells[this.cellsIndex.newRevision].value;
			obj[PPRSynchroViewConstants.NEW_BRANCH] = fieldInfo.cells[this.cellsIndex.newBranch].value;

			obj[PPRSynchroViewConstants.DUPLICATE] = fieldInfo.cells[this.cellsIndex.duplicate].value;
			obj[PPRSynchroViewConstants.DELETE] = fieldInfo.cells[this.cellsIndex.deletion].value;
			obj[PPRSynchroViewConstants.TRANSFER_OWNERSHIP] = fieldInfo.cells[this.cellsIndex.transferOwnership].value;
			obj[PPRSynchroViewConstants.CHANGE_MATURIY] = fieldInfo.cells[this.cellsIndex.changeMaturity].value;

			obj[PPRSynchroViewConstants.LOCK] = fieldInfo.cells[this.cellsIndex.lock].value;
			obj[PPRSynchroViewConstants.CHANGE_CONTROL] = fieldInfo.cells[this.cellsIndex.changeControl].value;
			obj[PPRSynchroViewConstants.TRANSFER] = fieldInfo.cells[this.cellsIndex.transfer].value;
			obj[PPRSynchroViewConstants.SHARE] = fieldInfo.cells[this.cellsIndex.share].value;

			return obj;
		},

		buildNewRuleField: function (objParam, deployedStatus) {
			var fieldInfo;

			fieldInfo = UWA.createElement('tr', {
					'class': 'PPRLifeCycleRulesMapping'
				});

			ruleView.buildLineField(fieldInfo, objParam, deployedStatus);

			fieldInfo.cells[this.cellsIndex.type].value = objParam[PPRSynchroViewConstants.TYPE];
			fieldInfo.cells[this.cellsIndex.computedResultingProduct].value = objParam[PPRSynchroViewConstants.COMPUTED_RESULTING_PRODUCT];
			//fieldInfo.cells[this.cellsIndex.specDoc].value = objParam[PPRSynchroViewConstants.SPEC_DOC];
			//SPEC_DOC commented asked by Paul IR926203
			fieldInfo.cells[this.cellsIndex.childTransformationTypes].value = objParam[PPRSynchroViewConstants.CHILD_TRANSFORMATION_TYPES];
			fieldInfo.cells[this.cellsIndex.newRevision].value = objParam[PPRSynchroViewConstants.NEW_REVISION];
			fieldInfo.cells[this.cellsIndex.newBranch].value = objParam[PPRSynchroViewConstants.NEW_BRANCH];
			fieldInfo.cells[this.cellsIndex.duplicate].value = objParam[PPRSynchroViewConstants.DUPLICATE];
			fieldInfo.cells[this.cellsIndex.deletion].value = objParam[PPRSynchroViewConstants.DELETE];
			fieldInfo.cells[this.cellsIndex.transferOwnership].value = objParam[PPRSynchroViewConstants.TRANSFER_OWNERSHIP];
			fieldInfo.cells[this.cellsIndex.changeMaturity].value = objParam[PPRSynchroViewConstants.CHANGE_MATURIY];



			fieldInfo.cells[this.cellsIndex.lock].value = objParam[PPRSynchroViewConstants.LOCK];
			fieldInfo.cells[this.cellsIndex.changeControl].value = objParam[PPRSynchroViewConstants.CHANGE_CONTROL];
			fieldInfo.cells[this.cellsIndex.transfer].value = objParam[PPRSynchroViewConstants.TRANSFER];
			fieldInfo.cells[this.cellsIndex.share].value = objParam[PPRSynchroViewConstants.SHARE];

			fieldInfo.cells[this.cellsIndex.deployFlag].value = deployedStatus;

			return fieldInfo;
		},

		modifyField: function (fieldInfo, objParam, deployedStatus) {
			var iCell;
			var value;
			var type = objParam[PPRSynchroViewConstants.TYPE];
			var label = this.getLabelTypeFromTypeValue(type);

			fieldInfo.cells[this.cellsIndex.type].value = type;
			fieldInfo.cells[this.cellsIndex.type].setText(label);
			
			value = objParam[PPRSynchroViewConstants.COMPUTED_RESULTING_PRODUCT];
			fieldInfo.cells[this.cellsIndex.computedResultingProduct].value = value;
			iCell = fieldInfo.cells[this.cellsIndex.computedResultingProduct];
			this.fullfillBooleanCell(iCell, value, PPRSynchroLifeCycleNLS.ComputedResultingProduct);

			//SPEC_DOC commented asked by Paul IR926203
			//value = objParam[PPRSynchroViewConstants.SPEC_DOC];
			//fieldInfo.cells[this.cellsIndex.specDoc].value = value;
			//iCell = fieldInfo.cells[this.cellsIndex.specDoc];
			//this.fullfillBooleanCell(iCell, value, PPRSynchroLifeCycleNLS.SpecDoc);

			value = objParam[PPRSynchroViewConstants.CHILD_TRANSFORMATION_TYPES];
			fieldInfo.cells[this.cellsIndex.childTransformationTypes].value = value;
			iCell = fieldInfo.cells[this.cellsIndex.childTransformationTypes];
			this.fullfillBooleanCell(iCell, value, PPRSynchroLifeCycleNLS.ChildTransformationTypes);

			value = objParam[PPRSynchroViewConstants.NEW_REVISION];
			fieldInfo.cells[this.cellsIndex.newRevision].value = value;
			iCell = fieldInfo.cells[this.cellsIndex.newRevision];
			this.fullfillBooleanCell(iCell, value, PPRSynchroLifeCycleNLS.NewRevision);

			value = objParam[PPRSynchroViewConstants.NEW_BRANCH];
			fieldInfo.cells[this.cellsIndex.newBranch].value = value;
			iCell = fieldInfo.cells[this.cellsIndex.newBranch];
			this.fullfillBooleanCell(iCell, value, PPRSynchroLifeCycleNLS.NewBranch);

			value = objParam[PPRSynchroViewConstants.DUPLICATE];
			fieldInfo.cells[this.cellsIndex.duplicate].value = value;
			iCell = fieldInfo.cells[this.cellsIndex.duplicate];
			this.fullfillBooleanCell(iCell, value, PPRSynchroLifeCycleNLS.Duplicate);

			value = objParam[PPRSynchroViewConstants.DELETE];
			fieldInfo.cells[this.cellsIndex.deletion].value = value;
			iCell = fieldInfo.cells[this.cellsIndex.deletion];
			this.fullfillBooleanCell(iCell, value, PPRSynchroLifeCycleNLS.Delete);


			value = objParam[PPRSynchroViewConstants.TRANSFER_OWNERSHIP];
			fieldInfo.cells[this.cellsIndex.transferOwnership].value = value;
			iCell = fieldInfo.cells[this.cellsIndex.transferOwnership];
			this.fullfillBooleanCell(iCell, value, PPRSynchroLifeCycleNLS.TransferOwnership);

			value = objParam[PPRSynchroViewConstants.CHANGE_MATURIY];
			fieldInfo.cells[this.cellsIndex.changeMaturity].value = value;
			iCell = fieldInfo.cells[this.cellsIndex.changeMaturity];
			this.fullfillBooleanCell(iCell, value, PPRSynchroLifeCycleNLS.CHANGE_MATURIY);


			value = objParam[PPRSynchroViewConstants.LOCK];
			fieldInfo.cells[this.cellsIndex.lock].value = value;
			iCell = fieldInfo.cells[this.cellsIndex.lock];
			this.fullfillBooleanCell(iCell, value, PPRSynchroLifeCycleNLS.Lock);

			value = objParam[PPRSynchroViewConstants.CHANGE_CONTROL];
			fieldInfo.cells[this.cellsIndex.changeMaturity].value = value;
			iCell = fieldInfo.cells[this.cellsIndex.changeControl];
			this.fullfillBooleanCell(iCell, value, PPRSynchroLifeCycleNLS.ChangeControl);

			value = objParam[PPRSynchroViewConstants.TRANSFER];
			fieldInfo.cells[this.cellsIndex.transfer].value = value;
			iCell = fieldInfo.cells[this.cellsIndex.transfer];
			this.fullfillBooleanCell(iCell, value, PPRSynchroLifeCycleNLS.Transfer);

			value = objParam[PPRSynchroViewConstants.SHARE];
			fieldInfo.cells[this.cellsIndex.share].value = value;
			iCell = fieldInfo.cells[this.cellsIndex.share];
			this.fullfillBooleanCell(iCell, value, PPRSynchroLifeCycleNLS.Share);


			//orange on the line
			this.setDeployedStatusFieldLine(fieldInfo,deployedStatus);

			fieldInfo.cells[this.cellsIndex.deployFlag].value = PPRSynchroViewConstants.MODIFY;

			//modify green orange on the Top
			ruleView.updateFormulaTextFields(deployedStatus);
		},

		updateFormulaTextFields: function (isDeployed) {
			//text displayed on Top
			var formulaField = document.querySelector(".PPRRulesFormula");
			var nCellFormula = formulaField.cells.length;
			if (nCellFormula > 1) {
				var cellIconStatusGlobal = formulaField.cells[nCellFormula - 1];
				cellIconStatusGlobal.empty();
				var imgSpan;
				if (isDeployed == PPRSynchroViewConstants.DEPLOYED )
					imgSpan = ruleView.buildImgSpan('check', '2.5', 'green', PPRSynchroLifeCycleNLS.Deployed);
				else
					imgSpan = ruleView.buildImgSpan('cog', '2.5', 'orange', PPRSynchroLifeCycleNLS.Modified);
				imgSpan.inject(cellIconStatusGlobal);
			}
		},

		removefieldLineCallBack: function (fieldInfo) {

			if (fieldInfo != "undefined")
			{
				ruleView.updateFormulaTextFields(PPRSynchroViewConstants.NEW_NOT_DEPLOYED);
				var value = fieldInfo.cells[ruleView.cellsIndex.deployFlag].value;
				if ( value == PPRSynchroViewConstants.NEW_NOT_DEPLOYED) {
					fieldInfo.remove();
				} else {
					ruleView.setForRemoveFieldLine(fieldInfo);
				}
			}
		},	
		setDeletedCellStyle: function (iCell) {
			//allow to Strikethrough the cell
			var previousVal = iCell.value, showValue = previousVal, iATpos;
			iCell.empty();
			iATpos = previousVal.indexOf("@");
			if (iATpos > 0) {
				showValue = previousVal.substring(0, iATpos);
			}
			UWA.createElement('del', {
				text: showValue,
				value: previousVal,
				'class': 'font-3dslight'
			}).inject(iCell);
		},
		setForRemoveFieldLine: function (fieldInfo) {
			fieldInfo.value = PPRSynchroViewConstants.NEW_NOT_DEPLOYED;
			var arrayAction = fieldInfo.cells[ruleView.cellsIndex.action].getElements('span');
			arrayAction.forEach(function (action) {
				action.hide();
			});

			var deploycell = fieldInfo.cells[ruleView.cellsIndex.deployFlag];
			var imgSpan = ruleView.buildImgSpan('trash', '1.5', 'red', PPRSynchroLifeCycleNLS.removedField);

			deploycell.empty();

			deploycell.value = PPRSynchroViewConstants.REMOVE;

			imgSpan.inject(deploycell);

			var typeCell = fieldInfo.cells[ruleView.cellsIndex.type];
			ruleView.setDeletedCellStyle(typeCell);
		},

		setDeployedStatusFieldLine: function (fieldInfo, deployedStatus) {
			var deploycell = fieldInfo.cells[ruleView.cellsIndex.deployFlag];
			deploycell.value = deployedStatus;

			var imgSpan;
			//check green
			if (deployedStatus == PPRSynchroViewConstants.DEPLOYED) 
				imgSpan = this.buildImgSpan('check', '2.5', 'green', PPRSynchroLifeCycleNLS.Deployed);
			else //orange
				imgSpan = this.buildImgSpan('cog', '2.5', 'orange', PPRSynchroLifeCycleNLS.Modified);
			deploycell.empty();
			imgSpan.inject(deploycell);
		},

		getTypeArrayAlradySetInview: function (tableLifeCyclePPRRules) {
			var nRows = tableLifeCyclePPRRules.length;

			var tableTypeAlreadySet = new Array();
			var i, type;
			for (i = 0; i < nRows; i++) {
				type = tableLifeCyclePPRRules[i].cells[this.cellsIndex.type].value;
				tableTypeAlreadySet.push(type);
			}
			return tableTypeAlreadySet;
		},

		getLabelTypeFromTypeValue: function (iValue)
		{
		var label;
         if ( iValue ==  PPRSynchroViewConstants.Provide ) {
					label = PPRSynchroLifeCycleNLS.Provide;
			}
			else if ( iValue ==  PPRSynchroViewConstants.CreateAssembly ) {
					label = PPRSynchroLifeCycleNLS.CreateAssembly;
			}

			else if ( iValue ==  PPRSynchroViewConstants.ElementaryEndItem ) {
					label = PPRSynchroLifeCycleNLS.ElementaryEndItem;
			}

			else if ( iValue ==  PPRSynchroViewConstants.Fasten ) {
					label = PPRSynchroLifeCycleNLS.Fasten;
			}
			else if ( iValue ==  PPRSynchroViewConstants.RemoveMaterial ) {
					label = PPRSynchroLifeCycleNLS.RemoveMaterial;
			}
			else if ( iValue ==  PPRSynchroViewConstants.Predrill ) {
					label = PPRSynchroLifeCycleNLS.Predrill;
			}
			else if ( iValue ==  PPRSynchroViewConstants.Drill ) {
					label = PPRSynchroLifeCycleNLS.Drill;
			}
			else if ( iValue ==  PPRSynchroViewConstants.NoDrill ) {
					label = PPRSynchroLifeCycleNLS.NoDrill;
			}
			else if ( iValue ==  PPRSynchroViewConstants.ContinuousProcessProvide ) {
					label = PPRSynchroLifeCycleNLS.ContinuousProcessProvide;
			}
			else if ( iValue ==  PPRSynchroViewConstants.ContinuousProcessCreateMaterial ) {
					label = PPRSynchroLifeCycleNLS.ContinuousProcessCreateMaterial;
			}
			else if ( iValue ==  PPRSynchroViewConstants.Transform ) {
					label = PPRSynchroLifeCycleNLS.Transform;
			}
			else if ( iValue ==  PPRSynchroViewConstants.CreateKit ) {
					label = PPRSynchroLifeCycleNLS.CreateKit;
			}
			else if ( iValue ==  PPRSynchroViewConstants.Installation ) {
					label = PPRSynchroLifeCycleNLS.Installation;
			}
			else if ( iValue ==  PPRSynchroViewConstants.ServicePart ) {
					label = PPRSynchroLifeCycleNLS.ServicePart;
			}
			else if ( iValue ==  PPRSynchroViewConstants.ServiceKit ) {
					label = PPRSynchroLifeCycleNLS.ServiceKit;
			}
			else if ( iValue ==  PPRSynchroViewConstants.ServiceAssembly ) {
					label = PPRSynchroLifeCycleNLS.ServiceAssembly;
			}
			else if ( iValue ==  PPRSynchroViewConstants.Machining ) {
					label = PPRSynchroLifeCycleNLS.Machining;
			}
			else if ( iValue ==  PPRSynchroViewConstants.Marking ) {
					label = PPRSynchroLifeCycleNLS.Marking;
			}
			else if ( iValue ==  PPRSynchroViewConstants.Split ) {
					label = PPRSynchroLifeCycleNLS.Split;
			}
			else if ( iValue ==  PPRSynchroViewConstants.Beveling ) {
					label = PPRSynchroLifeCycleNLS.Beveling;
			}
			else if ( iValue ==  PPRSynchroViewConstants.Cutting ) {
					label = PPRSynchroLifeCycleNLS.Cutting;
			}
		
			else if ( iValue ==  PPRSynchroViewConstants.Grinding ) {
					label = PPRSynchroLifeCycleNLS.Grinding;
			}
		 else if (iValue == PPRSynchroViewConstants.DetailedFasten) {
			 label = PPRSynchroLifeCycleNLS.DetailedFasten;
			 }
			return label;
		},

		editFieldDialog: function (editField, result, avoidDupCounterUserValue) {

			var options = {
				className: "ppr-lifecyclrules-edit-modal",
				title: PPRSynchroLifeCycleNLS.editField,
				AvoidDupCounterUserSelectionRequired : avoidDupCounterUserValue
			};

			var that = this;
			this.modal = new PPRSynchroAddLineDialog(options);
			this.modal.attributes = result;

			

			function _getFooter() {
				return "<button type='button'  name='addButton' id='add-button' class='btn btn-primary'>" + PPRSynchroLifeCycleNLS.add + "</button> " + "</button>" + "<button type='button' name='cancelButton' id='cancel-button' class='btn btn-default'>" + PPRSynchroLifeCycleNLS.cancel + "</button>"
			}
			this.modal.modal.setFooter(_getFooter());

			var fetchedData = this.buildObjectFromRow(editField);
			var comboValue = fetchedData.Type;
			var comboLabel = this.getLabelTypeFromTypeValue(comboValue);

			var selectTypeCombo = new Select({
				multiple: false,
				custom: false,
				options: [
					{label : comboLabel, value : comboValue}
				]});

			this.modal.getModalBody(selectTypeCombo);
			this.modal._bindFooterEvent();

			var editingField = editField;

			var rowsOfMappedFields = document.querySelectorAll(".PPRLifeCycleRulesMapping");
			var successFields = document.querySelector('.success');
			var toCheckTheExistingRows = rowsOfMappedFields.length;

			

			//set the value in modal (dialog -Edition)
			this.modal.setEditValueFields(fetchedData);
	

			this.tableWdthArray = PPRSynchroViewConstants.WIDTH_ARRAY

			this.modal.getContent().getElements('.btn').forEach(function (element) {

				if (element.name === 'addButton') {

					element.addEvent('click', function () {
						var duplicateData = {};
						var checkStatus = {};
						checkStatus.isSuccess = true;

						var toDisplayOver = that.modal.getContent().getElement('.ppr-lifecycling-rules-content');

						//at least one type should be selected
						//normaly in edition, this case should not happened
						if (that.modal.typeSelectionNotValid()) {
							that.modal.displayAlertMessage(PPRSynchroLifeCycleNLS.selectTypeMessage, toDisplayOver);
						}
						//at least one rule should be selected
						else if (that.modal.lifeCycleRulesSelectionNotValid()) {
							that.modal.displayAlertMessage(PPRSynchroLifeCycleNLS.selectrulesMessage, toDisplayOver);
						}
						//at least one command should be selected
						else if (that.modal.commandSelectionNotValid()) {
							that.modal.displayAlertMessage(PPRSynchroLifeCycleNLS.selectcommandsMessage, toDisplayOver);
						}
						else {
							
							var userSelectedMultiTypes = that.modal.getUserEnteredValues();

							var listTypesSelected = userSelectedMultiTypes[PPRSynchroViewConstants.TYPE];
							//loop on every type in list
							//when editing there is only one
							for (var ii = 0; ii < listTypesSelected.length; ii++) {
								var userEditedFormat = {};
								userEditedFormat[PPRSynchroViewConstants.TYPE] = listTypesSelected[ii];
								userEditedFormat[PPRSynchroViewConstants.COMPUTED_RESULTING_PRODUCT] = userSelectedMultiTypes[PPRSynchroViewConstants.COMPUTED_RESULTING_PRODUCT];
								//SPEC_DOC commented asked by Paul IR926203
								//userEditedFormat[PPRSynchroViewConstants.SPEC_DOC] = userSelectedMultiTypes[PPRSynchroViewConstants.SPEC_DOC];
								userEditedFormat[PPRSynchroViewConstants.CHILD_TRANSFORMATION_TYPES] = userSelectedMultiTypes[PPRSynchroViewConstants.CHILD_TRANSFORMATION_TYPES];

								userEditedFormat[PPRSynchroViewConstants.NEW_REVISION] = userSelectedMultiTypes[PPRSynchroViewConstants.NEW_REVISION];
								userEditedFormat[PPRSynchroViewConstants.NEW_BRANCH] = userSelectedMultiTypes[PPRSynchroViewConstants.NEW_BRANCH];
								userEditedFormat[PPRSynchroViewConstants.DUPLICATE] = userSelectedMultiTypes[PPRSynchroViewConstants.DUPLICATE];
								userEditedFormat[PPRSynchroViewConstants.DELETE] = userSelectedMultiTypes[PPRSynchroViewConstants.DELETE];
								userEditedFormat[PPRSynchroViewConstants.TRANSFER_OWNERSHIP] = userSelectedMultiTypes[PPRSynchroViewConstants.TRANSFER_OWNERSHIP];
								userEditedFormat[PPRSynchroViewConstants.CHANGE_MATURIY] = userSelectedMultiTypes[PPRSynchroViewConstants.CHANGE_MATURIY];
								userEditedFormat[PPRSynchroViewConstants.LOCK] = userSelectedMultiTypes[PPRSynchroViewConstants.LOCK];
								userEditedFormat[PPRSynchroViewConstants.CHANGE_CONTROL] = userSelectedMultiTypes[PPRSynchroViewConstants.CHANGE_CONTROL];
								userEditedFormat[PPRSynchroViewConstants.TRANSFER] = userSelectedMultiTypes[PPRSynchroViewConstants.TRANSFER];
								userEditedFormat[PPRSynchroViewConstants.SHARE] = userSelectedMultiTypes[PPRSynchroViewConstants.SHARE];


								userEditedFormat[PPRSynchroViewConstants.OPERATION] = PPRSynchroViewConstants.MODIFY;
								var fieldInfo = ruleView.modifyField(editingField, userEditedFormat, PPRSynchroViewConstants.NEW_NOT_DEPLOYED);
							}

							that.modal.destroy();
						}
					});
				}
			});
			this.modal.show();
		}
	};
	ruleView.initVariable();
	return ruleView;
});

define('DS/ParameterizationSkeleton/Views/PPRSynchronizationLifeCycle/PPRSynchroMBOMLayoutView', [
		'UWA/Core',
		'UWA/Class/View',
		'DS/UIKIT/Mask',
		'DS/UIKIT/Scroller',
		'DS/UIKIT/Input/Select',
		'DS/WAFData/WAFData',
		'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
		'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
		'DS/ParameterizationSkeleton/Views/PPRSynchronizationLifeCycle/PPRSynchroViewUtilities',
		'DS/ParameterizationSkeleton/Views/PPRSynchronizationLifeCycle/PPRSynchroViewConstants',
		'DS/ParameterizationSkeleton/Views/PPRSynchronizationLifeCycle/PPRSynchroAddLineDialog',
		'DS/UIKIT/Input/Button',
		'DS/UIKIT/Alert',
		'DS/ParameterizationSkeleton/Views/ParametersLayoutView',
		'i18n!DS/ParameterizationSkeleton/assets/nls/PPRSynchroLifeCycleNLS'
	],
	function (UWA,
		View,
		Mask,
		Scroller,
		Select,
		WAFData,
		ParametersLayoutViewUtilities,
		URLHandler,
		PPRSynchroViewUtilities,
		PPRSynchroViewConstants,
		PPRSynchroAddLineDialog,
		Button,
		Alert,
		ParametersLayoutView,
		PPRSynchroLifeCycleNLS) {

	'use strict';

	var extendedView;

	extendedView = View.extend({
			tagName: 'div',
			className: 'generic-detail',

			init: function (options) {
				var initDate = new Date();
				options = UWA.clone(options || {}, false);
				this._parent(options);

				this.options = options;
				this.contentDiv = null;
				this.paramScroller = null;
				this.paramAltSubScroller = null;
				this.userMessaging = null;
				this.lastAlertDate = initDate.getTime();
				this.controlDiv = null;
				this._pprRulesTable = null;
				this.paramsDiv = null;
			},

			setup: function (options) {
				UWA.log('PPR Synchro Layout::setup!');
				UWA.log(options);
			},

			render: function () {
				UWA.log("PPR Synchro LayoutView::render");
				var introDiv,
				mappingDiv,
					that = this;

				//contentDiv is the main container
				this.contentDiv = UWA.createElement('div', {
						'id': 'typeMainDiv'
					});

				introDiv = UWA.createElement('div', {
						'class': 'information'
					}).inject(this.contentDiv);

				UWA.createElement('p', {
					text: PPRSynchroLifeCycleNLS.intro,
					'class': 'font-3dslight'
				}).inject(introDiv);


				//Reset & Apply Toolbar are linked with main container (content.div)
				this.controlDiv = ParametersLayoutViewUtilities.createApplyResetToolbar.call(this, this.contentDiv, true,
						this.applyParams.bind(this), this.resetParams.bind(this));

				this.container.setContent(this.contentDiv);

				this.parentView = new ParametersLayoutView(this.options);

				this.listenTo(this.collection, {
					onSync: that.onCompleteRequestPPRSynchroMBOM,
					onError: that.onCompleteRequestPPRSynchroMBOM
				});

				return this;
		},


			onCompleteRequestPPRSynchroMBOM: function (collection, response, options) {
				var that = this;
				UWA.log('PPR Synchro Layout::Complete rendering!');
				//Fix IR-945140 - Handling error returned by webservice. When there is no Page exist in database, call set on collection to initialize empty table in UI
				if( response.success != undefined && response.success == false && response.message != undefined && response.message.includes('Page does not exist')){
									this.collection.set(response, options);
								}
				//get value returned by Webservice
				var collection = this.collection._models[0]._attributes;

				//paramsDIV = container of the Table containing the rules
				this.paramsDIV = ParametersLayoutViewUtilities.createParamsContainerDiv();

				//The container of rules table
				this.divPPRSynchroRules = UWA.createElement('div', {
						'class': 'PPRSynchroRulesDivScroll',
				}).inject(this.paramsDIV);

				//Convert collection (returned by webservice)
				//to the fields structure displayed in Cell
				var fields = PPRSynchroViewUtilities.convertFormatWebServiceToTable(collection.ExpressionsList);
				var nosOfFields = (fields) ? fields.length : 0;

				//buildAttributeTable creates the Title (Formula + heading Colum + Table of rules)
				this._pprRulesTable = PPRSynchroViewUtilities.buildAttributeTable(fields);
				this._pprRulesTable.inject(this.divPPRSynchroRules);

				// + Button is linked with main container
				//at bottom of Table, it will disappear
				var AddMappingButton = new Button({
						className: 'AddPartNumberFieldButton',
						icon: 'plus-circled',
						attributes: {
							disabled: false,
							'aria-hidden': 'true',
							title: PPRSynchroLifeCycleNLS.TitleModal,
						},
						events: {
							onClick: function (e) {
								that.ShowAddNewFieldPanel(that, that._pprRulesTable.getElement(".PPRSynchroFieldbody"));
							}
						}
				}).inject(this.contentDiv);

				//inject the table as child of paramsDIV
				this.divPPRSynchroRules.inject(this.paramsDIV);
				//this.divPPRSynchroRules.appendChild(this.paramsDIV);


				for (var i = 0; i < nosOfFields; i++) {
					var field = fields[i];
					var deployedStatus = PPRSynchroViewConstants.DEPLOYED;
					field[PPRSynchroViewConstants.OPERATION] = PPRSynchroViewConstants.ADD;
					//Build every line stored in the Table
					var fieldInfo = PPRSynchroViewUtilities.buildNewRuleField(field, deployedStatus);
					fieldInfo.inject(this._pprRulesTable.getElement(".PPRSynchroFieldbody"));
				}
				//contentDiv == Main container
				this.paramsDIV.inject(this.contentDiv);

				this.paramScroller = new Scroller({
					element: this.paramsDIV
				}).inject(this.contentDiv);

				Mask.unmask(this.contentDiv);
			},


			_updateParentViewWithNewDomain : function(view, domainId){
				view.options.domainid = domainId;
				view.model.id = domainId;
				view.model._attributes.domainid = domainId;
				view.model._attributes.id = domainId;
				return view;
			},

			resetParams: function () {
				var that = this;
				Mask.mask(this.contentDiv);
				var url = URLHandler.getURL() + "/resources/DELLifecycleParametrization/lifecycle/options?modelerKey=DELLifecycleCouplingParam_MBOM";

				//var url = URLHandler.getURL() + "/resources/delmia/lifecycleOptions"; // + URLHandler.getTenant();
				WAFData.authenticatedRequest(url, {
					timeout: 250000,
					method: 'GET',
					type: 'json',

					headers: {
						'Content-Type': 'application/json',
						'Accept': 'application/json',
					},

					onFailure: function (json) {
						Mask.unmask(that.contentDiv);
						that.onResetFailure(PPRSynchroLifeCycleNLS.ResetError);
					},

					onComplete: function (json) {
						that.onResetSuccess(json);
						Mask.unmask(that.contentDiv);
						that.getAlertMessage(PPRSynchroLifeCycleNLS.ResetSuccess, 'success', that.contentDiv);
					}

				});
			},

		onResetSuccess: function (json) {

			//returned by the Reset Service
			var savedInfo = json.result.parameters;
			var i = 0;
			//Get the lines of the current Table
			var listofcurrentLines = this.paramsDIV.getElementsByClassName("PPRLifeCycleRulesMapping");

			//Reset => Remove all the lines
			i = listofcurrentLines.length -1;
			while (i >= 0) {
				listofcurrentLines[i].remove();
				i--;
			}

			//Add the lines retreived on the server
			var fields = PPRSynchroViewUtilities.convertFormatWebServiceToTable(savedInfo);
			var nosOfFields = (fields) ? fields.length : 0;

			for (i = 0; i < nosOfFields; i++) {
				var field = fields[i];
				field[PPRSynchroViewConstants.OPERATION] = PPRSynchroViewConstants.ADD;
					var deployedStatus = PPRSynchroViewConstants.DEPLOYED;

					//Build every line returned on the server
					var fieldInfo = PPRSynchroViewUtilities.buildNewRuleField(field,deployedStatus);
					fieldInfo.inject(this._pprRulesTable.getElement(".PPRSynchroFieldbody"));
			}
			//green at Top
			PPRSynchroViewUtilities.updateFormulaTextFields(PPRSynchroViewConstants.DEPLOYED);
		},

		onResetFailure: function (message) {
				this.getAlertMessage(message, 'error', this.contentDiv);
			},

		applyParams: function () {
				var that = this;
				var rowsOfMappedFields = this.contentDiv.getElementsByClassName("PPRLifeCycleRulesMapping");
				var TableRules = [];

				Mask.mask(this.contentDiv);

				//Conversion rows displayed to Table
				var row;
				for (var i = 0; i < rowsOfMappedFields.length; i++) {
					//This flag is set for lines already deployed on server
					//In this case, the rule should removed
					//So it is not copied on the Table
					row = rowsOfMappedFields[i];
					if (row.cells[PPRSynchroViewUtilities.cellsIndex.deployFlag].value != PPRSynchroViewConstants.REMOVE) {
						var value = PPRSynchroViewUtilities.buildObjectFromRow(row);
						TableRules.push(value);
					}
				}
				//conversion Table to a rule on the right format for Webservice called
				var collection = PPRSynchroViewUtilities.convertTableToFormatWebservice(TableRules);

				var url = URLHandler.getURL() + "/resources/DELLifecycleParametrization/lifecycle/options?modelerKey=DELLifecycleCouplingParam_MBOM";
				WAFData.authenticatedRequest(url, {
					timeout: 250000,
					method: 'PUT',
					data: JSON.stringify(collection),
					type: 'json',

					headers: {
						'Content-Type': 'application/json',
						'Accept': 'application/json'
					},

					onFailure: function (json) {
						Mask.unmask(that.contentDiv);
						that.onApplyFailure(PPRSynchroLifeCycleNLS.ApplyError);
					},

					onComplete: function (json) {
							that.onApplySuccess( );
							Mask.unmask(that.contentDiv);
							that.getAlertMessage(PPRSynchroLifeCycleNLS.ApplySuccess, 'success', that.contentDiv);
					}

				});
			},

			onApplyFailure: function (message) {
				this.getAlertMessage(message, 'error', this.contentDiv);
			},

			onApplySuccess: function () {
				var fieldsToBeRemoved = new Array();
				var rowsOfMappedFields = this.contentDiv.getElementsByClassName("PPRLifeCycleRulesMapping");
				var i, length = rowsOfMappedFields.length;

				for (i = length - 1; i >= 0; i--) {
				var line = rowsOfMappedFields[i];

				var deploycell = line.cells[PPRSynchroViewUtilities.cellsIndex.deployFlag];
					var value = deploycell.value;
				//remove the deployed rules on server set as deleted
				if (value == PPRSynchroViewConstants.REMOVE)
					line.remove();
				else {
					//To set a green icon (check) at the end of line
					//because every line is deployed
					PPRSynchroViewUtilities.setDeployedStatusFieldLine(line, PPRSynchroViewConstants.DEPLOYED);
				}
			}
			//At Top
			//we modify the Icon status
			PPRSynchroViewUtilities.updateFormulaTextFields(PPRSynchroViewConstants.DEPLOYED);
		},
		ShowAddNewFieldPanel: function (attrtbody) {
				this.createNewRuleDialogBox(attrtbody);
				var isDeployed = PPRSynchroViewConstants.NEW_NOT_DEPLOYED;
			},
		buildSelectOptionsComboBoxType: function () {
			var i,
				formatTypeComboBox = new Select({
					placeholder: PPRSynchroLifeCycleNLS.selectType,
					multiple: true,
					custom: false
				});
			var tableRules = this.contentDiv.getElementsByClassName("PPRLifeCycleRulesMapping");
			var nRows = tableRules.length;


			var tableTypeAlreadySet = PPRSynchroViewUtilities.getTypeArrayAlradySetInview(tableRules);
			var valueoftype;
			var labeloftype;

			valueoftype = PPRSynchroViewConstants.Provide;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}

			valueoftype = PPRSynchroViewConstants.CreateAssembly;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}

			valueoftype = PPRSynchroViewConstants.ElementaryEndItem;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}

			valueoftype = PPRSynchroViewConstants.Fasten;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}


			valueoftype = PPRSynchroViewConstants.RemoveMaterial;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}


			valueoftype = PPRSynchroViewConstants.Predrill;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}

			valueoftype = PPRSynchroViewConstants.Drill;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}

			valueoftype = PPRSynchroViewConstants.NoDrill;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}

			valueoftype = PPRSynchroViewConstants.ContinuousProcessProvide;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}


			valueoftype = PPRSynchroViewConstants.ContinuousProcessCreateMaterial;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}

			valueoftype = PPRSynchroViewConstants.Transform;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}

			valueoftype = PPRSynchroViewConstants.CreateKit;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}

			valueoftype = PPRSynchroViewConstants.Installation;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}

			valueoftype = PPRSynchroViewConstants.ServicePart;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}


			valueoftype = PPRSynchroViewConstants.ServiceKit;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}


			valueoftype = PPRSynchroViewConstants.ServiceAssembly;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}


			valueoftype = PPRSynchroViewConstants.Machining;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}

			valueoftype = PPRSynchroViewConstants.Marking;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}

			valueoftype = PPRSynchroViewConstants.Split;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}

			valueoftype = PPRSynchroViewConstants.Beveling;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}

			valueoftype = PPRSynchroViewConstants.Cutting;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}

			valueoftype = PPRSynchroViewConstants.Grinding;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}


			valueoftype = PPRSynchroViewConstants.DetailedFasten;
			labeloftype = PPRSynchroViewUtilities.getLabelTypeFromTypeValue(valueoftype);
			if (tableTypeAlreadySet.indexOf(valueoftype) == -1) {
				formatTypeComboBox.add([{
					label: labeloftype,
					value: valueoftype
				}], false);
			}

			return formatTypeComboBox;
		},
		createNewRuleDialogBox: function (attrtbody) {
				var that = this;
				var attributes = (this.collection._models[0]._attributes && this.collection._models[0]._attributes.lifeCycleRulesAttributes);
				var options = {
					className: "lifecycle-rules-modal",
					title: PPRSynchroLifeCycleNLS.TitleModal,
					[PPRSynchroViewConstants.AVOID_DUP_COUNTER] : this.collection._models[0]._attributes[PPRSynchroViewConstants.AVOID_DUP_COUNTER]
				}

				this.modal = new PPRSynchroAddLineDialog(options);

				this.modal.storeAttributes(attributes);

			//This case should not happened
				if (this.modal.getTotalFormatRows() == PPRSynchroViewConstants.MAX_ROWS) {
					var alert = that.modal.displayAlertMessage(PPRSynchroLifeCycleNLS.maxLimitOfRows, document.querySelector('#typeMainDiv').getChildren()[0]);
				} else {
					function _getFooter() {
						return "<button type='button'  name='addButton' id='add-button' class='btn btn-primary'>" + PPRSynchroLifeCycleNLS.add + "</button> " + "</button>" + "<button type='button' name='cancelButton' id='cancel-button' class='btn btn-default'>" + PPRSynchroLifeCycleNLS.cancel + "</button>"
					}

					this.modal.modal.setFooter(_getFooter());

					var selectComboOptions = this.buildSelectOptionsComboBoxType();

					this.modal.getModalBody(selectComboOptions);

					this.modal._bindFooterEvent();

					//pattern to disable ComboBOX
					this.modal.getContent().getElements('.btn').forEach(function (element) {

						if (element.name === 'cancelButton') {
							element.addEvent('click', function () {
								that.modal.destroy();

							});
						} else if (element.name === 'addButton') {

							element.addEvent('click', function () {

								var toDisplayOver = that.modal.getContent().getElement('.ppr-lifecycling-rules-content');
								//at least one type should be selected
								if (that.modal.typeSelectionNotValid()) {
									 that.modal.displayAlertMessage(PPRSynchroLifeCycleNLS.selectTypeMessage, toDisplayOver);
								}
								//at least one rule should be selected
								else if (that.modal.lifeCycleRulesSelectionNotValid()) {
									that.modal.displayAlertMessage(PPRSynchroLifeCycleNLS.selectrulesMessage, toDisplayOver);
								}
							    //at least one command should be selected
								else if (that.modal.commandSelectionNotValid()) {
									that.modal.displayAlertMessage(PPRSynchroLifeCycleNLS.selectcommandsMessage, toDisplayOver);
								}
								else {
										//At top mentions there is a modification
										PPRSynchroViewUtilities.updateFormulaTextFields(PPRSynchroViewConstants.NEW_NOT_DEPLOYED);

										var userSelectedMultiTypes = that.modal.getUserEnteredValues();
										var listTypesSelected = userSelectedMultiTypes[PPRSynchroViewConstants.TYPE];
										//loop on every type in list
										for (var ii = 0; ii < listTypesSelected.length; ii++) {
											var userSelectedFormat = {};

											userSelectedFormat[PPRSynchroViewConstants.TYPE] = listTypesSelected[ii];
											userSelectedFormat[PPRSynchroViewConstants.COMPUTED_RESULTING_PRODUCT] = userSelectedMultiTypes[PPRSynchroViewConstants.COMPUTED_RESULTING_PRODUCT];
											//SPEC_DOC commented asked by Paul IR926203
											//userSelectedFormat[PPRSynchroViewConstants.SPEC_DOC] = userSelectedMultiTypes[PPRSynchroViewConstants.SPEC_DOC];
											userSelectedFormat[PPRSynchroViewConstants.CHILD_TRANSFORMATION_TYPES] = userSelectedMultiTypes[PPRSynchroViewConstants.CHILD_TRANSFORMATION_TYPES];

											userSelectedFormat[PPRSynchroViewConstants.NEW_REVISION] = userSelectedMultiTypes[PPRSynchroViewConstants.NEW_REVISION];
											userSelectedFormat[PPRSynchroViewConstants.NEW_BRANCH] = userSelectedMultiTypes[PPRSynchroViewConstants.NEW_BRANCH];
											userSelectedFormat[PPRSynchroViewConstants.DUPLICATE] = userSelectedMultiTypes[PPRSynchroViewConstants.DUPLICATE];
											userSelectedFormat[PPRSynchroViewConstants.DELETE] = userSelectedMultiTypes[PPRSynchroViewConstants.DELETE];
											userSelectedFormat[PPRSynchroViewConstants.TRANSFER_OWNERSHIP] = userSelectedMultiTypes[PPRSynchroViewConstants.TRANSFER_OWNERSHIP];
											userSelectedFormat[PPRSynchroViewConstants.CHANGE_MATURIY] = userSelectedMultiTypes[PPRSynchroViewConstants.CHANGE_MATURIY];

											userSelectedFormat[PPRSynchroViewConstants.LOCK] = userSelectedMultiTypes[PPRSynchroViewConstants.LOCK];
											userSelectedFormat[PPRSynchroViewConstants.CHANGE_CONTROL] = userSelectedMultiTypes[PPRSynchroViewConstants.CHANGE_CONTROL];
											userSelectedFormat[PPRSynchroViewConstants.TRANSFER] = userSelectedMultiTypes[PPRSynchroViewConstants.TRANSFER];
											userSelectedFormat[PPRSynchroViewConstants.SHARE] = userSelectedMultiTypes[PPRSynchroViewConstants.SHARE];


											var fieldInfo = PPRSynchroViewUtilities.buildNewRuleField(userSelectedFormat, PPRSynchroViewConstants.NEW_NOT_DEPLOYED);
											fieldInfo.inject(attrtbody.getElement(".PPRSynchroFieldbody"));
										}
										that.modal.destroy();
								}
							});
						};
					});

					that.modal.show();
				}
			},

			getAlertMessage: function (message, className, toDisplayOn) {

				this.alertOptions = {
					visible: true,
					className: 'param-alert',
					messageClassName: className,
					closable: true,
					renderTo: toDisplayOn,
					autoHide: true,
					hideDelay: 2000
				};

				var alert = new Alert(this.alertOptions);
				alert.add({
					message: message,
				});

			},

			destroy: function () {
				this.stopListening();
				this._parent.apply(this, arguments);
			}
		});

	return extendedView;
});

/**
* @quickreview  KB9 21:11:05 creation
*/
// XSS_CHECKED
define('DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationModalView',
[
  'UWA/Class',
  'DS/UIKIT/Modal',
  'DS/Controls/Button',
  'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationToastMessage',
  'i18n!DS/ParameterizationSkeleton/assets/nls/DELConfigurationModalView',
  'css!UIKIT/UIKIT.css',
  'css!DS/ParameterizationSkeleton/assets/css/DELConfigurationModalView.css',
  'css!DS/ParameterizationSkeleton/assets/css/DELConfigurationToastMessage.css'
],
function (
  Class,
  Modal,
  WUXButton,
  DELConfigurationToastMessage,
  Nls
) {
  'use strict';

  const modalViewOptions = Object.freeze(
      {
        "OK": 1,
        "OKCANCEL":2,
        "OKCLOSE":3,
        "CLOSE":4
      }
  );

  var DELConfigurationModalView = Class.extend({

    /**
    * init
    */
    init : function init(options)
    {
      var that = this;
      that.options = options;
    },

    /*
    * destroyModal
    */
    destroyModal : function destroyModal()
    {
      var that = this;
      that.modal.destroy();
    },

    /*
    * showToastMessage
    */
    showToastMessage : function showToastMessage(messageType, message)
    {
      var that = this;
      that.ToastMessage.showToastMessage(messageType, message);
    },

    /*
    * buildModal
    */
    buildModal : function buildModal()
    {
      var that = this;

      var contentModalView = UWA.createElement('div');
      contentModalView.class = "contentModalView";
      that.options.content.inject(contentModalView);

      that.ToastMessage = new DELConfigurationToastMessage(contentModalView);
      that.ToastMessage.contentToastView.setStyles({
        'border': '1px solid black',
        'position': 'absolute',
        'z-index': '1',
        'bottom' : '50px',
        'width': '80%',
        'margin-left': '10%'
      });

      var footerDiv = UWA.createElement('div');
      footerDiv.class = "footView";
      footerDiv.setStyles({
        display: 'flex',
        'align-items': 'baseline',
        'flex-flow': 'row',
        'width': '100%',
        'margin-left': '35%'
      });

        that.buildButtonsFooter(footerDiv);

        this.modal = new Modal({
          className: 'NotifModal',
          closable: true,
          visible: true,
          header: that.options.title,
          body: contentModalView,
          footer: footerDiv,
          events: {
            onHide: function() {
              that.options.CancelButtonClick();
              that.destroyModal();
            }
          }
        }).inject(document.body);

        var HelpDiv = new UWA.Element('div');
        HelpDiv.inject(footerDiv);

        var HelpButton = new WUXButton(
        {
          displayStyle: 'icon',
          icon:
          {
            iconName: 'help',
            fontIconFamily: WUXManagedFontIcons.Font3DS
          },
          iconSize : '0.5',
          onClick: function (){
              that.ToastMessage.showToastMessage(0, that.options.info);
          }
        }).inject(HelpDiv);

        HelpButton.elements.container.setAttribute("title", Nls.Help);
        return this;
      },

      buildButtonsFooter : function buildButtonsFooter(divButtonsFooter)
      {
        var that = this;
        if (that.options.modalView === modalViewOptions.OK ||
           that.options.modalView === modalViewOptions.OKCLOSE ||
           that.options.modalView === modalViewOptions.OKCANCEL)
        {
          var okButton = new WUXButton({
            type : 'standard',
            label : Nls.OK,
            displayStyle : 'normal',
            onClick: function (e) {
                var destroy = that.options.OKButtonClick();
                if (destroy === undefined)
                  that.modal.destroy();
              }
            });

            okButton.elements.container.setAttribute("title",Nls.OK);
            okButton.elements.container.setStyles({
              //display: 'inline-block',
              //flex: '30%',
              //'padding-right': '50px',
              'text-align': 'center'
            });

            okButton.elements.container.style["background-color"] = "#368EC4";
            okButton.elements.text.style["color"] = "white";

            okButton.inject(divButtonsFooter);
        }

        if (that.options.modalView === modalViewOptions.OKCLOSE)
        {
          var closeButton = new WUXButton({
            type : 'standard',
            label : Nls.Close,
            displayStyle : 'normal',
            onClick: function (e) {
              that.options.CancelButtonClick();
              that.modal.destroy();
            }
          });

          closeButton.elements.container.setAttribute("title",Nls.Close);
          closeButton.elements.container.setStyles({
            display: 'inline-block',
            'margin-left': '5px' ,
            //'padding-left': '50px',
            'text-align': 'center'
          })

          closeButton.inject(divButtonsFooter);
        }

        if (that.options.modalView === modalViewOptions.OKCANCEL)
        {
          var cancelButton = new WUXButton({
            type : 'standard',
            label : Nls.Cancel,
            displayStyle : 'normal',
            onClick: function (e) {
              that.options.CancelButtonClick();
              that.modal.destroy();
            }
          });

          cancelButton.elements.container.setAttribute("title",Nls.Cancel);
          cancelButton.elements.container.setStyles({
            display: 'inline-block',
            'margin-left': '5px' ,
            //'padding-left': '50px',
            'text-align': 'center'
          })

          cancelButton.inject(divButtonsFooter);
        }
      }

    });

    return DELConfigurationModalView;
  });

/**
* @quickreview  KB9 21:10:25 creation
*/

define('DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
    [
    'UWA/Core',
    'UWA/Class',
    'DS/Tweakers/GeneratedToolbar',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationTreeListView',
    'DS/ParameterizationSkeleton/Utils/DELConfigurationParameterization/DELConfigurationParameterizationWebServices',
    'DS/Controls/Label',
    'DS/Controls/ComboBox',
    'DS/Controls/LineEditor',
    'DS/Controls/Toggle',
    'DS/Controls/TooltipModel',
    'DS/Windows/Dialog',
    'DS/Controls/Button',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationModalView',
    'DS/ParameterizationSkeleton/Model/DELConfigurationParameterizationModel/DELConfigurationParamTranslationModel',
    'DS/Notifications/NotificationsManagerUXMessages',
    'DS/Notifications/NotificationsManagerViewOnScreen',
    'DS/UIKIT/Mask',
    'i18n!DS/ParameterizationSkeleton/assets/nls/Languages',
    'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DELConfigurationLayoutView',
    'css!DS/ParameterizationSkeleton/ParameterizationSkeleton',
    'css!DS/ParameterizationSkeleton/assets/css/DELConfigurationLayoutView'
    ],
    function (
      UWA,
      Class,
      WUXGeneratedToolbar,
      DELConfigurationTreeListView,
      DELConfigurationParameterizationWebServices,
      WUXLabel,
      WUXComboBox,
      WUXEditor,
      WUXToggle,
      WUXTooltipModel,
      WUXDialog,
      WUXButton,
      DELConfigurationModalView,
      DELConfigurationParamTranslationModel,
      NotificationsManagerUXMessages,
      NotificationsManagerViewOnScreen,
      Mask,
      LanguagesNLS,      
      ParamSkeletonNLS,
      Nls
    )
  {

  'use strict';

  var DELConfigurationFamilyView = Class.extend({

    _uiElementsIDs : [],
    _treeListViewNls : null,
    _modalViewNls : null,
    _nodeTreeViewNls : null,
    _xmlDoc : null,
    _domainID : null,
    _familyID : null,
    _paramID : null,
    _argID : null,
    _needTitleForTreeListView : false,
    _languageValues : null,
    /*
    * init
    */
    init : function init(options)
    {
      //this._parent(options);

      this._domainID = options.domainid;
      this._familyID = options.familyid;
      this._paramID = options.parameterid;
      this._argID = options.argid;

      this._xmlDoc = options.xmlDoc;

      if (options.treeListViewNls != undefined || options.treeListViewNls != null)
        this._treeListViewNls = options.treeListViewNls;

      if (options.modalViewNls != undefined || options.modalViewNls != null)
        this._modalViewNls = options.modalViewNls;

      if (options.nodeTreeViewNls != undefined || options.nodeTreeViewNls != null)
        this._nodeTreeViewNls = options.nodeTreeViewNls;

      // -- Initialize notificationsManager to display events on screen
      NotificationsManagerViewOnScreen.setNotificationManager(NotificationsManagerUXMessages);

      // -- Configure the manager
      NotificationsManagerViewOnScreen.setRemoveStackOnFirstTimeoutFlag(true);
      NotificationsManagerViewOnScreen.setStackingPolicy(31); //21

      this._languageValues = {
        "en": "English",
        "fr": "Français",
        "de": "Deutsch",
        "es": "Español",
        "cs": "čeština",
        "it": "Italiano",
        "ja": "日本語",
        "ko": "한국어",
        "pl": "Polskie",
        "pt-BR": "Português Brasileiro",
        "ru": "Pусский",
        "zh": "简体中文",
        "zh-TW": "繁體中文",
        "tr": "Türkçe"
      }; 
    },

    /*
    * presetModal
    */
    presetModal : function presetModal(node)
    {
      console.log("presetModal");
      var that = this;
      that._node = node;

      var nodeGrid = node.getGrid();
      var uiElementsIDLength = that._uiElementsIDs.length;
      for (var i=0;i<uiElementsIDLength;i++)
      {
        var eltUI = that._uiElementsIDs[i];
        if (eltUI)
        {
          var eltUIid = eltUI.id;
          var docElt = document.getElementById(eltUIid);
          if (docElt)
          {
            if (eltUI.type === "textarea")
              docElt.dsModel.value = nodeGrid[eltUIid];

            if (eltUI.type === "checkbox")
                docElt.dsModel.checkFlag = nodeGrid[eltUIid];

            if (eltUI.type === "combobox" || eltUI.type === "multiselcombobox")
            {
              var selectedIndex = -1;
              var elementList = docElt.dsModel.elementsList;
              var elementListLength = elementList.length;
              for (var k=0;k<elementListLength && selectedIndex === -1;k++)
              {
                if (elementList[k].label === nodeGrid[eltUIid])
                 selectedIndex = k;
              }

              docElt.dsModel.selectedIndex = selectedIndex;
            }
          }
        }
      }
    },


    /*
    * createtreeNode
    */
    createtreeNode : function createtreeNode(data, grid)
    {
      var that = this;

      var translationModel = new DELConfigurationParamTranslationModel({
        data : data,
        grid : grid,
        nls : that._nodeTreeViewNls
      });
      if(grid == undefined){
        var columnIDs = that.treeList._columnsIDs;
        for(var IdxColumnID = 0; IdxColumnID < columnIDs.length; IdxColumnID++){
          var columnID = columnIDs[IdxColumnID];
          var gridTemp = translationModel.getGrid();
          if(!gridTemp.hasOwnProperty(columnID) && that._uiElementsIDs[IdxColumnID].type === "checkbox"){
            translationModel.addGridAttributes({[columnID] : false});
          }
        }
      }

      return translationModel;
    },

    /*
    * validateModal
    */
    validateModal : function validateModal()
    {
      var that = this;
      console.log("validateModal");

      var data = new Map();
      var grid = new Map();

      var uiElementsIDLength = that._uiElementsIDs.length;
      var uiElementsID = that._uiElementsIDs;

      for (var i=0;i<uiElementsIDLength;i++)
      {
        var uiEl = document.getElementById(that._uiElementsIDs[i].id);
        if (uiEl)
        {
          if (uiEl.dsModel.checkFlag != undefined || uiEl.dsModel.checkFlag != null)
          {
            data.set(that._uiElementsIDs[i].id, uiEl.dsModel.checkFlag);
            grid.set(that._uiElementsIDs[i].id, uiEl.dsModel.checkFlag);
          }
          else
          {
            var bIncludesSpecialCharacter = false;
            if (that._uiElementsIDs[i].mandatory === true)
            {
              var bMandatoryField = false;
              if (that._uiElementsIDs[i].type != "combobox")
              {
                if (uiEl.dsModel.value != undefined && uiEl.dsModel.value != null && uiEl.dsModel.value != "")
                {
                  var value = uiEl.dsModel.value.trim();
                  if(value != ""){
                    bMandatoryField = true;
                    if(value.includes('|') || value.includes('=') || value.includes('}'))
                      bIncludesSpecialCharacter = true;
                    var updatedValueToEscapeSpecialChars =  value.replace(',','\,').replace('"','\"').replace(/[\\]/g,'\\');
                    data.set(that._uiElementsIDs[i].id, updatedValueToEscapeSpecialChars);
                    grid.set(that._uiElementsIDs[i].id, value);
                  }
                }
              }
              else {
                if (uiEl.dsModel.label != undefined && uiEl.dsModel.label != null && uiEl.dsModel.label != "")
                {
                  bMandatoryField = true;
                  data.set(that._uiElementsIDs[i].id, uiEl.dsModel.value);//uiEl.dsModel.label);
                  grid.set(that._uiElementsIDs[i].id, uiEl.dsModel.label);
                }
              }

              if (!bMandatoryField) {
                var mandatoryCol = that._treeListViewNls[that._uiElementsIDs[i].id];
                var nlsErrorMsg = Nls.columnMandatory;
                nlsErrorMsg = nlsErrorMsg.replace("%1", mandatoryCol);
                that._modalView.showToastMessage(2, nlsErrorMsg);
                return;
              }
            }
            else
            {
              if (that._uiElementsIDs[i].type != "combobox")
              {
                var value = uiEl.dsModel.value;
                var updatedValueToEscapeSpecialChars = value;
                if (value != undefined && value != null) {
                  if(value.includes('|') || value.includes('=') || value.includes('}'))
                    bIncludesSpecialCharacter = true;
                  updatedValueToEscapeSpecialChars = value.replace(',', '\,').replace('"', '\"').replace(/[\\]/g, '\\');
                }
                data.set(that._uiElementsIDs[i].id, updatedValueToEscapeSpecialChars);
                grid.set(that._uiElementsIDs[i].id, uiEl.dsModel.value);
              }
              else
              {
                data.set(that._uiElementsIDs[i].id, uiEl.dsModel.value);//uiEl.dsModel.label);
                grid.set(that._uiElementsIDs[i].id, uiEl.dsModel.label);
              }
            }
            if(bIncludesSpecialCharacter){
              var columnID = that._treeListViewNls[that._uiElementsIDs[i].id];
              var specialChar = "|,=,}";
                var nlsErrorMsg = Nls.containUnsupportedChars;
                nlsErrorMsg = nlsErrorMsg.replace("%1", columnID);
                nlsErrorMsg = nlsErrorMsg.replace("%2", specialChar);
                that._modalView.showToastMessage(2, nlsErrorMsg);
                return;
            }
          }
        }
      }

      var objData = {};
      var objGrid = {};
      data.forEach(function(value, key){;
        if (value != "" && value != undefined)
          objData[key] = value;
      });

      grid.forEach(function(value, key){
        objGrid[key] = value;
      });


      var treeNodeModel = that.createtreeNode(objData, objGrid);
      return treeNodeModel;
    },

    _updateParameters : function _updateParameters(bUpdateForDelete){
      var that = this;
      Mask.mask(that.treeListView.elements.body,Nls.orderParametersMaskMessage);
      DELConfigurationParameterizationWebServices.deleteParameter(that._domainID, that._familyID, that._paramID, that._argID, null, {
        onSuccess: function (data) {
          var treeDoc = that.treeListView.treeDocument;
          var newRowModelLength =   that.treeListView.getRowModelLength();
          var promisesSetParams = [];
          var dataObjects = [];

          if (newRowModelLength) {
            for (var rowIndex = 0; rowIndex < newRowModelLength; rowIndex++) {
              var dataObject = that.getRowDataFromTreeView(rowIndex);
              dataObjects.push(dataObject);
            }

            for (var rowIndex = 0; rowIndex < newRowModelLength; rowIndex++) {
              var promiseSetParams = new Promise(function (resolve, reject) {
                var dataObject = dataObjects[rowIndex];
                DELConfigurationParameterizationWebServices.setParameters(that._domainID, that._familyID, that._paramID, that._argID, dataObject, {
                  onSuccess: function (data) {
                    resolve(dataObject);
                  },
                  onFailure: function (error) {
                    reject("DELConfigurationParameterizationWebServices.setParameters");
                    console.error("DELConfigurationParameterizationWebServices.setParameters");
                  }
                });
              });
              promisesSetParams.push(promiseSetParams);
            }

            UWA.Promise.all(promisesSetParams).then(function (attrsSetParams) {

              // Check Deployment and update Tree
              var promisesIsDeployed = [];
              for (var idxNode = 0; idxNode < newRowModelLength; idxNode++) {
                var promiseIsDeployed = new Promise(function (resolve, reject) {
                  var dataObject = dataObjects[idxNode];
                  if (dataObject) {
                    DELConfigurationParameterizationWebServices.isDeployed(that._domainID, that._familyID, that._paramID, that._argID, dataObject, {
                      onSuccess: function (data) {
                        resolve({ treeNodeData: dataObject, isDeployed: data });
                      },
                      onFailure: function (error) {
                        reject("DELConfigurationParameterizationWebServices.isDeployed");
                        console.error("DELConfigurationParameterizationWebServices.isDeployed");
                      }
                    });
                  }
                });
                promisesIsDeployed.push(promiseIsDeployed);
              }
              UWA.Promise.all(promisesIsDeployed).then(function (resultIsDeployed) {
                var listOfnodeTree = [];
                var lengthIsDeployed = resultIsDeployed.length;
                if (newRowModelLength === lengthIsDeployed) {
                  for (var idxDeployed = 0; idxDeployed < lengthIsDeployed; idxDeployed++) {
                    var treeNode = that.createtreeNode(resultIsDeployed[idxDeployed].treeNodeData);
                    if (treeNode) {
                      treeNode.addGridAttributes({ isDeployed: resultIsDeployed[idxDeployed].isDeployed });
                      listOfnodeTree.push(treeNode);
                    }
                  }
                  treeDoc.removeRoots();
                  that.addChild(listOfnodeTree);
                }

                that.displayNotifications({
                  level: 'info',
                  message: Nls.orderParameters,
                  title: Nls.orderParametersTitle
                });
                Mask.unmask(that.treeListView.elements.body);
              }).catch(function (rejectMessages) {
                that.displayNotifications({
                  level: 'error',
                  message: Nls.orderParametersError,
                  title: Nls.orderParametersTitle
                });
                console.error(rejectMessages);
                Mask.unmask(that.treeListView.elements.body);
              });
            }).catch(function (rejectMessages) {
              that.displayNotifications({
                level: 'error',
                message: Nls.orderParametersError,
                title: Nls.orderParametersTitle
              });
              console.error(rejectMessages);
              Mask.unmask(that.treeListView.elements.body);
            });
          }
          if (bUpdateForDelete) {
            that.displayNotifications({
              level: 'info',
                message: Nls.deleteParameter,
                title: Nls.deleteParameterTitle
            });
          }
        },
        onFailure: function (err) {
          that.displayNotifications({
            level: 'error',
            message: Nls.deleteParameterError,
            title: Nls.deleteParameterTitle
          });
        }
      }); 
    },

    /*
    * mapFunctions
    */
    mapFunctions : function mapFunctions(name)
    {

    },

    /*
    * render
    */
    render : function render()
    {
      var that = this;
      this._parent();

      return this;
    },

    /*
    * buildtreeListView
    */
    buildtreeListView : function buildtreeListView()
    {
      var that = this;

      that.updateNlsValuesForColumnIDsWithLanguage();

      var options = {};
      options.data = [];
      options.columns = that._uiElementsIDs;
      options.nls = that._treeListViewNls;
      options.paramid = this._paramID;

      that.treeList = new DELConfigurationTreeListView(options);
      that.treeListView  = that.treeList.buildView(options);

      // Fixed IR-1333483 -  FUN143441_UX_Issue: Horizontal Scroll is not available in the Units of measures and parameters domain
      // Set up ResizeObserver to observe the parent element
      that.treeListView.resizeObserver = new ResizeObserver(that._onResize.bind(that));
      let ParentElement = document.querySelector('#parametersDiv');
      if (null != ParentElement)
      {
        that.treeListView.resizeObserver.observe(ParentElement);
      }
      
    },

    /*
    * _onResize
    */
    _onResize: function _onResize(event) {
      var that = this;
      let ParentElement = document.querySelector('#parametersDiv');
      if (null != ParentElement)
      {
        let DataGridWidth = ParentElement.offsetWidth - 10;
        that.treeListView.getContent().setStyle('width', DataGridWidth);
      }
    },

    /*
    * API to provide NLS values for coulmn IDs defined for lanaguage support.
    * If a column ID needs NLS support, then NLS columns can be defined as columnID_<language code>
    * For example, if label is the column ID, then corresponding NLS column IDs should be label_en, label_fr...
    * If the NLS column IDs are defined as mentioned above, then their NLS in UI is taken care by below code.   
    */
    updateNlsValuesForColumnIDsWithLanguage : function updateNlsValuesForColumnIDsWithLanguage(){
      var that = this;

      var nbUIElements = that._uiElementsIDs.length;
      for (var idxElement = 0; idxElement < nbUIElements; idxElement++) {
        var elementID = that._uiElementsIDs[idxElement].id;
        if (elementID.split("_")[1] != null && elementID.split("_")[1] != undefined) {
          var elementNameWithoutLanguage = elementID.split("_")[0];
          var language = elementID.split("_")[1];
          if (that._languageValues.hasOwnProperty(language)) {
            var elementNls = that._treeListViewNls[elementNameWithoutLanguage]+" "+LanguagesNLS[language+".Label"];
            if(!that._treeListViewNls.hasOwnProperty(that._uiElementsIDs[idxElement].id)){
              var elementNewNls = elementNls + " (" + that._languageValues[language] + ")";
              that._treeListViewNls[that._uiElementsIDs[idxElement].id] = elementNewNls;
              var elementTooltipNlsID =that._uiElementsIDs[idxElement].id + "Tooltip";
              that._treeListViewNls[elementTooltipNlsID] = that._treeListViewNls[elementNameWithoutLanguage+"Tooltip"];
            }
          }
        }
      }
    },

    /*
    * buildFamilyContent
    */
    buildFamilyContent : function buildFamilyContent() {
      var that = this;

      this._uiElementsIDs = [];

      var contentTreeView = UWA.createElement('div');
      //that._xmlDoc = xmlDoc;
      //that._xmlDoc = that._xmlMap.get(iFamily.id);

      var ui = that._xmlDoc.getElementsByTagName("ui");
      if (ui != null && ui.length)
      {
        var attrList = ui[0].getElementsByTagName("object");
        var attrListLength = attrList.length;
        for (var i=0;i<attrListLength;i++)
        {
          //var uiobjectLabelValue = attrList[i].attributes.labelvalue.value;
          var uiobjectType = attrList[i].attributes.type.value;
          //var uiobjectValue = attrList[i].attributes.value.value;

          var uiobjectID = null;
          if (attrList[i].attributes.id)
            uiobjectID = attrList[i].attributes.id.value;

          var uiobjectHidden = null;
          if (attrList[i].attributes.hidden)
            uiobjectHidden = (attrList[i].attributes.hidden.value === "true");

          var uiobjectMandatory = null;
          if (attrList[i].attributes.mandatory)
            uiobjectMandatory = (attrList[i].attributes.mandatory.value === "true");

          var uiobjectSortable = null;
          if (attrList[i].attributes.sortable && attrList[i].attributes.sortable.value != undefined && attrList[i].attributes.sortable.value != null)
            uiobjectSortable = ((attrList[i].attributes.sortable.value).toLowerCase?.() === 'true');

          var uiobjectOnCellSemantics = null;
          if (attrList[i].attributes.onCellSemantics)
            uiobjectOnCellSemantics = that.mapFunctions(attrList[i].attributes.onCellSemantics.value);

          //that._uiElementsIDs.push(uiobjectID);
          that._uiElementsIDs.push({id : uiobjectID, type : uiobjectType, hidden : uiobjectHidden, mandatory : uiobjectMandatory, sortable : uiobjectSortable, onCellSemantics : uiobjectOnCellSemantics});
        }

          //Generate the toolbar with the model JSONToolbar
          //var toolbar = dataGridView.setToolbar(JSON.stringify(JSONToolbar));

          //this.contentDiv.appendChild(treeListView);

          var divToolbar = document.createElement("div");
          divToolbar.className = "divToolbar";
          //that.contentDiv.appendChild(divToolbar);
          contentTreeView.appendChild(divToolbar);
          // divToolbar.style.marginRight = '10px';

        if (that._needTitleForTreeListView) {
          divToolbar.style.display = 'flex';
          divToolbar.style['align-items'] = 'flex-start';
          var treeViewTitleLabel = new WUXLabel({ value: that._nodeTreeViewNls.treeViewTitle, emphasize: '' }).inject(divToolbar);
          treeViewTitleLabel.elements.container.style.textAlign = "left";
          treeViewTitleLabel.elements.container.style['font-size'] = "large";
          treeViewTitleLabel.elements.container.style.backgroundColor = "transparent";
        }

          var JSONToolbar = {
          "entries": [
                {
                  "id": "buildModal",
                  "dataElements": {
                    "typeRepresentation": "functionIcon",
                    "tooltip": Nls.Add,
                    value: that.buildModal.bind(that, false),
                    "icon": {
                      "iconName": "plus",
                      "fontIconFamily": 1
                    },
                    "position": "far",
                    "category": "1"
                  }
                }
              ]};


          var toolbarModel = WUXGeneratedToolbar.prototype.createTreeDocument(JSONToolbar);
          var toolbar = new WUXGeneratedToolbar({
                overflowManagement: "scroll",
                direction: "horizontal",
                items: toolbarModel
            });

         toolbar.inject(divToolbar);


         //var options = {};
         //options.data = [];
         //options.columns = that._uiElementsIDs;
         //options.nls = that._treeListViewNls;

         //that.treeList = new DELConfigurationTreeListView(options);
         //that.treeListView  = that.treeList.buildView(options);
         that.buildtreeListView();
         that.treeListView.inject(contentTreeView);

         //that.treeListView.addEventListener('change', that.onCellViewChange.bind(that));

         //parent Div container
        //that.container.setContent(that.contentDiv);

        DELConfigurationParameterizationWebServices.getParameters(that._domainID, that._familyID, that._paramID, that._argID, {
          onSuccess : function(aprisoParams)
          {
              var listOfnodeTree = [];
              var aprisoParamsLength = aprisoParams.length;
              for (var i=0;i<aprisoParamsLength;i++)
                listOfnodeTree.push(that.createtreeNode(aprisoParams[i]))
              that.addChild(listOfnodeTree);//aprisoParams);
          }
        });

        return contentTreeView;
      }
      //else
      //  return this._parent(iFamily, familyPosition);
    },

    /*
    * onCellViewChange
    */
    /*onCellViewChange : function onCellViewChange(iCellEvent, iCellInfos)
    {
      var that = this;

      var node = iCellInfos.nodeModel.options.grid;
      delete node["isDeployed"];
      delete node["delete"];
      delete node["edit"];

      DELConfigurationParameterizationWebServices.deleteParameter(that._domainID, that._familyID, that._paramID, that._argID, that._node, {
        onSuccess : function(data)
        {
          DELConfigurationParameterizationWebServices.setParameters(that._domainID, that._familyID, that._paramID, that._argID, node, {
              onSuccess : function(data)
              {
                that._node = null;

                that.displayNotifications({
                  level: 'info',
                  message: Nls.modifyParameter,
                  title: Nls.modifyParameterTitle
                });
              },
              onFailure : function (err)
              {
                that.displayNotifications({
                  level: 'error',
                  message: Nls.modifyParameterError,
                  title: Nls.modifyParameterTitle
                });
              }
            });
        },
        onFailure : function (err)
        {
          that.displayNotifications({
            level: 'error',
            message: Nls.deleteParameterError,
            title: Nls.deleteParameter
          });
        }
      });
    },*/

    /*
    * addChild
    */
    addChild : function addChild(nodesTab)
    {
        var that = this;

        var nodesTabLength = nodesTab.length;
        for (var i=0;i<nodesTabLength;i++)
        {
            var grid = nodesTab[i].getGrid();
            grid.delete = {
            module: 'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
            func: 'removeSelectedNode',
            argument : {
              configurationLayoutView : that
            }
          };

            grid.edit = {
              module: 'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
              func: 'editSelectedNode',
              argument : {
                configurationLayoutView : that
              }
          };

       }

        that.treeList.addChild(nodesTab);//nodesTab);
    },

    /*
    * buildModal
    */
    buildModal : function buildModal(bEditMod)
    {
      var that = this;

      var contentModalView = UWA.createElement('div');
      //contentModalView.class = "contentModalView";

      if (that._xmlDoc != null)
      {
        var attrList = that._xmlDoc.getElementsByTagName("ui")[0].getElementsByTagName("object");
        var attrListLength = attrList.length;
        for (var i=0;i<attrListLength;i++)
        {
          if (that.treeListView.columns[i].visibleFlag === false)
            continue;

          //var uiobjectLabelValue = attrList[i].attributes.labelvalue.value;
          var uiobject = attrList[i].attributes.type.value;
          var uiobjectID = attrList[i].attributes.id.value;
          var uiobjectValue = attrList[i].attributes.value.value;

          var uiobjectDisabled = false;
          if (attrList[i].attributes.disabled)
            uiobjectDisabled = (attrList[i].attributes.disabled.value === "true");

          var uiobjectMandatory = null;
          if (attrList[i].attributes.mandatory)
            uiobjectMandatory = (attrList[i].attributes.mandatory.value === "true");

          var uiobjectOnChange = null;
          if (attrList[i].attributes.onChange)
            uiobjectOnChange = attrList[i].attributes.onChange.value;

          var subcontentDiv = new UWA.Element('div');
          subcontentDiv.className = "subcontentModalView";
          subcontentDiv.inject(contentModalView);

          var labelTitleNls = uiobjectID;
          var labelTooltipNls = uiobjectID;
          if (that._treeListViewNls != null || that._treeListViewNls != undefined)
          {
            if (that._treeListViewNls[uiobjectID] != undefined)
              labelTitleNls = that._treeListViewNls[uiobjectID];//that._treeListViewNls[uiobjectLabelValue];

            if (that._treeListViewNls[uiobjectID+"Tooltip"] != undefined)
              labelTooltipNls = that._treeListViewNls[uiobjectID+"Tooltip"];
          }

          var myLabel = new WUXLabel({value : labelTitleNls}).inject(subcontentDiv);
          //myLabel.elements.container.className += " dellabelmodal";
          myLabel.elements["container"].setStyles({
            'width': '60%',
            'height':'3em',
            'background-color' : 'white',
            'text-align':'left',
              display: 'inline-grid'
              });
          var myIcon = new WUXLabel({icon: "info"}).inject(subcontentDiv);
          myIcon.tooltipInfos = new WUXTooltipModel({
                       shortHelp: labelTooltipNls,
                       mouseRelativePosition: false,
                       position: "bottom"
                   });
          //myIcon.elements.container.className += " deliconmodal";
          myIcon.elements["container"].setStyles({
            'width': '15%',
            'height':'3em',
            'background-color' : 'white',
            'text-align':'left',
              display: 'inline-grid'
              });

          var uiElt = null;
          if (uiobject === "textarea")
          {
            var lOptions = {};
            //lOptions.nbRows = 1;
            lOptions.value = uiobjectValue;
            lOptions.disabled = uiobjectDisabled;
            lOptions.requiredFlag = uiobjectMandatory;
            uiElt = new WUXEditor(lOptions);
            uiElt.elements["container"].setStyles({
              'width': '100%',
                display: 'inline-grid'
                });
            uiElt.elements.container.className += " deltextEditormodal";
          }
          else if (uiobject === "checkbox")
          {
            var lOptions = {};
            lOptions.type = "switch";
            lOptions.value = 0;
            lOptions.disabled = (uiobjectDisabled === "true");
            uiElt = new WUXToggle(lOptions);
            if(uiobjectValue === "true")
              uiElt.toggle();
            uiElt.elements["container"].setStyles({
                'width': '100%',
                  display: 'inline-grid'
                  });
            //uiElt.elements.container.className = "toggleUI";

            if (uiobjectOnChange)
              uiElt.addEventListener('change', that.mapFunctions(uiobjectOnChange));
          }
          else if (uiobject === "combobox" || uiobject === "multiselcombobox")
          {
            //if (that._modalViewNls[uiobjectValue] != null)
            //  uiobjectValue = that._modalViewNls[uiobjectValue];

            var elementsList =  uiobjectValue.split(",");
            var elementsListNls = elementsList;
            var elementsListLength = elementsList.length;
            for (var m=0;m<elementsListLength;m++)
            {
              if (that._nodeTreeViewNls != null && that._nodeTreeViewNls[elementsList[m]] != null && that._nodeTreeViewNls[elementsList[m]] != undefined)
                elementsListNls[m] = {label: that._nodeTreeViewNls[elementsList[m]], value: elementsList[m]};
              else
                elementsListNls[m] = {label: elementsList[m], value: elementsList[m]};
            }

            var lOptions = {};
            lOptions.elementsList = elementsListNls;
            lOptions.selectedIndexes = [];
            lOptions.displayStyle = "normal";
            lOptions.enableSearchFlag = true;
            lOptions.placeholder = "Select";
            if (that._modalViewNls != null || that._modalViewNls != undefined)
              lOptions.placeholder = that._modalViewNls.Select;
            //lOptions.reachablePlaceholderFlag = true;
            lOptions.multiSelFlag = false;
            if (uiobject === "multiselcombobox")
              lOptions.multiSelFlag = true;

            lOptions.width = "100%";
            lOptions.height = "30px";
            lOptions.disabled = (uiobjectDisabled === "true");
            lOptions.generateRegexpString = function(text) {
               return text;
             };

            uiElt = new WUXComboBox(lOptions);
            uiElt.elements.container.className += " delcomboboxmodal";
            
            // Modification made to address IR-1339417-3DEXPERIENCER2025x - When more units of measurements are selected, the field is displayed in a improper way
            uiElt.elements.container.style.overflow = "hidden";

            uiElt.tooltipInfos = new WUXTooltipModel({
              shortHelp: ""
            })

            uiElt.addEventListener('change', that.updateToolTip.bind(that));

            //uiElt.elements.container.className = "comboboxUI";
            //uiElt.elements.container.setAttribute('id',uiobjectID);

            if (uiobjectOnChange)
              uiElt.addEventListener('change', that.mapFunctions(uiobjectOnChange));
          }
          uiElt.elements.container.setAttribute('id',uiobjectID);
          uiElt.inject(subcontentDiv);
        }
      }

      var options = {};
      options.content = contentModalView;
      options.modalView = 2;
      options.title = "title";
      if (that._modalViewNls != null || that._modalViewNls != undefined)
        options.title = that._modalViewNls.modalTitle;

      if (bEditMod)
        options.OKButtonClick = that.onOKEditButtonClick.bind(that);
      else
        options.OKButtonClick = that.onOKButtonClick.bind(that);
      options.CancelButtonClick = that.onCancelButtonClick.bind(that);

      options.info = "info";
      if (that._modalViewNls != null || that._modalViewNls != undefined)
        options.info = that._modalViewNls.Info;

      that._modalView = new DELConfigurationModalView(options);
      that._modalView.buildModal();
    },

    updateToolTip: function updateToolTip(toolTipElmnt) {
      var selectionList = toolTipElmnt.dsModel.label;
      toolTipElmnt.dsModel.tooltipInfos.shortHelp = selectionList
    },

    /*
    * destroyModal
    */
    destroyModal : function destroyModal()
    {
      that._modalView.destroyModal();
    },

    /*
    * onOKEditButtonClick
    */
    onOKEditButtonClick : function onOKEditButtonClick()
    {
      var that = this;

      var treeListNode = that.validateModal();
      var data = treeListNode.getData();
      if(data != undefined)
      {
        var oldnodeData = that._node.getData();
        delete oldnodeData["isDeployed"];
        delete oldnodeData["delete"];
        delete oldnodeData["edit"];

        var oldnodeGrid = that._node.getGrid();

        DELConfigurationParameterizationWebServices.deleteParameter(that._domainID, that._familyID, that._paramID, that._argID, oldnodeData, {
          onSuccess : function(data)
          {
            DELConfigurationParameterizationWebServices.setParameters(that._domainID, that._familyID, that._paramID, that._argID, treeListNode.getData()/*objNodeIsDeployed*/, {
                onSuccess : function(data)
                {
                  DELConfigurationParameterizationWebServices.isDeployed(that._domainID, that._familyID, that._paramID, that._argID, treeListNode.getData()/*objNodeIsDeployed*/, {
                      onSuccess : function(dataIsDeployed)
                      {
                        var treeDoc = that.treeList.dataGridView.treeDocument;
                        if (treeDoc)
                        {
                          var children = treeDoc.getChildren();
                          var childrenLength = children.length;
                          for (var i=0;i<childrenLength;i++)
                          {
                            var childrenTMP = children[i];
                            if (childrenTMP)
                            {
                              var grid = childrenTMP.options.grid;
                              if (grid)
                              {
                                var bFound = true;
                                var uiElementsIDLength = that._uiElementsIDs.length;
                                var uiElementsID = that._uiElementsIDs;
                                for (var m=0;m<uiElementsIDLength && bFound;m++)
                                {
                                  if (grid[that._uiElementsIDs[m].id] === "")
                                    continue;

                                  if (grid[that._uiElementsIDs[m].id] != oldnodeGrid/*that._node*/[that._uiElementsIDs[m].id])
                                    bFound = false;
                                }

                                if (bFound)
                                {
                                    var objNode = treeListNode.getData();

                                    var objNodeGrid = treeListNode.getGrid();
                                    objNodeGrid.isDeployed = dataIsDeployed;
                                    objNodeGrid.edit = grid.edit;
                                    objNodeGrid.delete = grid.delete;

                                    childrenTMP.updateOptions({data : null});
                                    childrenTMP.updateOptions({grid : objNodeGrid, data : objNode});
                                    break;
                                }
                              }
                            }
                          }
                        }

                        that._node = null;

                        that.displayNotifications({
                          level: 'info',
                          message: Nls.modifyParameter,
                          title: Nls.modifyParameterTitle
                        });
                      }
                    });
                },
                onFailure : function (err)
                {
                  that.displayNotifications({
                    level: 'error',
                    message: Nls.modifyParameterError,
                    title: Nls.modifyParameterTitle
                  });
                }
              });
          },
          onFailure : function (err)
          {
            that.displayNotifications({
              level: 'error',
              message: Nls.deleteParameterError,
              title: Nls.deleteParameter
            });
          }
        });
      }
    },

    /*
    * onOKButtonClick
    */
    onOKButtonClick : function onOKButtonClick()
    {
      var that = this;
      var treeListNode = that.validateModal();

      DELConfigurationParameterizationWebServices.setParameters(that._domainID, that._familyID, that._paramID, that._argID, treeListNode.getData()/*objNodeIsDeployed*/, {
        onSuccess : function(dataParams)
        {
          DELConfigurationParameterizationWebServices.isDeployed(that._domainID, that._familyID, that._paramID, that._argID, treeListNode.getData()/*objNodeIsDeployed*/, {
              onSuccess : function(dataIsDeployed)
              {
                //objNode.isDeployed = dataIsDeployed;
                treeListNode.addGridAttributes({isDeployed : dataIsDeployed});

                that.addChild([treeListNode/*objNode*/]);

                that.displayNotifications({
                  level: 'info',
                  message: Nls.setParameters,
                  title: Nls.setParametersTitle
                });
              }
            });
        },
        onFailure : function (err)
        {

          that.displayNotifications({
            level: 'error',
            message: Nls.setParametersError,
            title: Nls.setParametersTitle
          });
        }
      });
    },

    /*
    * onCancelButtonClick
    */
    onCancelButtonClick : function onCancelButtonClick()
    {

    },

    /*
    * destroy
    */
    destroy : function destroy() {
      this._uiElementsIDs = [];
      //this._uiElementsLabelValues = [];

        if (this._modalView)
          this._modalView.destroyModal();
        this._parent.apply(this, arguments);
    },

    /*
    * removeSelectedNode
    */
    removeSelectedNode : function removeSelectedNode(params)
    {
      console.log("params " + params);
      var that = this;

      var node = params.context.nodeModel;
      var nodeData = node.getData();
      delete nodeData["isDeployed"];
      delete nodeData["delete"];
      delete nodeData["edit"];

        DELConfigurationParameterizationWebServices.deleteParameter(that._domainID, that._familyID, that._paramID, that._argID, nodeData/*objNodeIsDeployed*/, {
          onSuccess : function(data)
          {
            var treeDoc = params.configurationLayoutView.treeList.dataGridView.treeDocument;
            if (treeDoc)
              treeDoc.removeRoot(node);//params.context.nodeModel);

            that.displayNotifications({
              level: 'info',
              message: Nls.deleteParameter,
              title: Nls.deleteParameterTitle
            });
          },
          onFailure : function (err)
          {
            that.displayNotifications({
              level: 'error',
              message: Nls.deleteParameterError,
              title: Nls.deleteParameterTitle
            });
          }
        });
    },

    /*
    * editSelectedNode
    */
    editSelectedNode : function editSelectedNode(params)
    {
      console.log("params " + params);

        var node = params.context.nodeModel;//Object.assign({}, params.context.nodeModel);
        var bEditMod = true;
        params.configurationLayoutView.buildModal(bEditMod);
        params.configurationLayoutView.presetModal(node);
    },

    /*
    * displayNotifications
    */
    displayNotifications : function displayNotifications(options)
    {
      console.log("options " + options);

      NotificationsManagerUXMessages.addNotif(options);
    },

    /*
    * getRowDataFromTreeView for a given row ID
    */
    getRowDataFromTreeView: function getRowDataFromTreeView(rowID) {
      var that = this;
      var dataObject = {};

      var uiElementsIDLength = that._uiElementsIDs.length;
      
      for (var i = 0; i < uiElementsIDLength; i++) {
        if (that._getCellValue(rowID, that._uiElementsIDs[i].id) != undefined) {
          var cellValue = that._getCellValue(rowID, that._uiElementsIDs[i].id);
          dataObject[that._uiElementsIDs[i].id] = cellValue;
        }
      }
      return dataObject;
    },

    /*
    * _getCellValue for a given row ID and column name
    */
    _getCellValue : function _getCellValue(rowIndex, ColumnName){
      var that = this;
      var cellvalue = null;
      if (that.treeListView.layout != undefined) {
        var attrColumnId = that.treeListView.layout.getColumnIndex(ColumnName);
        if (attrColumnId != undefined) {
          var attrCellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: rowIndex, columnID: attrColumnId });
          if (attrCellId != undefined && that.treeListView.getCellInfosAt(attrCellId) != undefined) {
            var cellInfos = that.treeListView.getCellInfosAt(attrCellId);
            if (cellInfos != undefined && cellInfos.nodeModel != undefined && cellInfos.nodeModel.options != undefined &&
              cellInfos.nodeModel.options.data != undefined && cellInfos.nodeModel.options.data[ColumnName] != undefined)
              cellvalue = cellInfos.nodeModel.options.data[ColumnName];
          }
        }
      }
      return cellvalue;
    },

    toJSON() {
      return {
        editSelectedNode: this.editSelectedNode,
        removeSelectedNode:  this.removeSelectedNode,
      };
    }

  });

  DELConfigurationFamilyView.removeSelectedNode = function(params)
  {
    console.log("params " + params);

    // Delete confirmation Dialog created to address IR-1334306-3DEXPERIENCER2025x - No Delete confirmation dialog is available.
    let confirmDialog = new WUXDialog({
      title: Nls.confirmDeleteTitle,
      content: Nls.confirmDeleteContent,
      width: 500,
      icon: {
        iconName: "trash",
        fontIconFamily: WUXManagedFontIcons.FontAwesome
      },
      buttons: {
        No: new WUXButton ({
          onClick: function(e){
            confirmDialog.close();
          }
        }),
        Yes: new WUXButton({
          onClick: function(e){
            params.configurationLayoutView.removeSelectedNode(params);
            confirmDialog.close();
          }
        })
      }
    })
    confirmDialog.show();
  }

  DELConfigurationFamilyView.editSelectedNode = function(params)
  {
    console.log("params " + params);
    params.configurationLayoutView.editSelectedNode(params);
  }

  return DELConfigurationFamilyView;
});

/**
* @quickreview  KB9 21:10:25 creation
*/

define('DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationLayoutView',
    [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/ParametersLayoutView',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
    'DS/ParameterizationSkeleton/Utils/DELConfigurationParameterization/DELConfigurationParameterizationResourceServices',
    'DS/ParameterizationSkeleton/Utils/DELConfigurationParameterization/DELConfigurationParameterizationWebServices',
    'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DELConfigurationLayoutView',
    'css!DS/ParameterizationSkeleton/ParameterizationSkeleton',
    'css!DS/ParameterizationSkeleton/assets/css/DELConfigurationLayoutView'
    ],
    function (
      UWA,
      ParametersLayoutView,
      DELConfigurationFamilyView,
      DELConfigurationParameterizationResourceServices,
      DELConfigurationParameterizationWebServices,
      ParamSkeletonNLS,
      Nls
    )
  {

  'use strict';

  var DELConfigurationLayoutView = ParametersLayoutView.extend({

    /*
    * init
    */
    init : function init(options)
    {
      this._parent(options);

      this._domainID = options.domainid;
      this._xmlNls = null;
      this._listOfFamilyViews = [];
      this._mapFamily = new Map();
    },

    /*
    * destroy
    */
    destroy : function destroy()
    {
      var that = this;
      that._parent();

      that._listOfFamilyViews.forEach(element => {
        if(element)
          element.destroy();
      });
      // if (that._familyView)
      //   that._familyView.destroy();
      return that;
    },

    /*
    * render
    */
    render : function render()
    {
      var that = this;
      this._parent();

      return this;
    },

    /*
    * buildParameterLine
    */
    buildParameterLine : function (iParamObj, familyID, familytbody, popoverPosition) {

      var that = this;
      if (that._mapFamily)
        that._mapFamily.set(iParamObj.id, familyID);

      var args = iParamObj.argument;
      for (var i=0;i<args.length;i++)
      {
        var arg = args[i];
        if (arg && arg.defaultValue === "DELConfigurationTreeListView")
        {
          //that.nbofShownParameters++;
          var newParamline = UWA.createElement('tr', {title: ''});//iParamObj.tooltipNlsKey
          var paramTreeListViewCell = UWA.createElement('td', {
              'width' : '100%',
              'title' : '',
              'colspan' : '4'
          });
          paramTreeListViewCell.setStyle("vertical-align", "text-bottom");

          var contentTreeView = UWA.createElement('div');
          contentTreeView.className = "treeListView";

          var options = {};
          options.xmlDoc = that._xmlMap.get(arg.id);
          options.domainid = that._domainID;
          options.familyid = familyID;
          options.parameterid = iParamObj.id;
          options.argid = arg.id;

          if (that._xmlNls.get(arg.id)[0])
            options.treeListViewNls = that._xmlNls.get(arg.id)[0];
          if (that._xmlNls.get(arg.id)[1])
            options.modalViewNls = that._xmlNls.get(arg.id)[1];
          if (that._xmlNls.get(arg.id)[2])
            options.nodeTreeViewNls = that._xmlNls.get(arg.id)[2];

          //var familyView = new DELConfigurationFamilyView(options);
          that._familyView = new DELConfigurationFamilyView(options);
          that._listOfFamilyViews.push(that._familyView);
          var familyViewContent = that._familyView.buildFamilyContent();

          familyViewContent.inject(contentTreeView);
          contentTreeView.inject(paramTreeListViewCell);
          paramTreeListViewCell.inject(newParamline);
          newParamline.inject(familytbody);

          //return contentTreeView;
        }
        else
          this._parent(iParamObj, familyID, familytbody, popoverPosition);
      }
    },

    /*
    * updateParameterOnChange
    */
    updateParameterOnChange : function(iValue, ctrlObjectCell, imageCell) {

      var that = this;
      var objNode = {
        value: iValue
      };

      var paramID = ctrlObjectCell.getData('argumentNode').paramid;
      var argID = ctrlObjectCell.getData('argumentNode').argumentid;
      var familyID = that._mapFamily.get(paramID);


      DELConfigurationParameterizationWebServices.deleteParameter(that._domainID, familyID, paramID, argID, null, {
        onSuccess : function(deleteParam)
        {
          DELConfigurationParameterizationWebServices.setParameters(that._domainID, familyID, paramID, argID, objNode, {
              onSuccess : function(dataParams)
              {
                DELConfigurationParameterizationWebServices.isDeployed(that._domainID, familyID, paramID, argID, objNode, {
                    onSuccess : function(dataIsDeployed)
                    {
                      var json = {};
                      json.deployStatus = "S_OK";
                      that.onApplySuccess(json, imageCell);
                      that.onUpdateParameterSuccess(familyID,paramID,iValue);
                    },
                    onFailure : function (deleteError)
                    {
                      var json = {};
                      json.deployStatus = "E_FAIL";
                      that.onApplyFailure(json, imageCell);
                    }
                  });
              },
              onFailure : function (deleteError)
              {
                var json = {};
                json.deployStatus = "E_FAIL";
                that.onApplyFailure(json, imageCell);
              }
            });
          },
          onFailure : function (deleteError)
          {
            var json = {};
            json.deployStatus = "E_FAIL";
            that.onApplyFailure(json, imageCell);
          }
      });
    },
    
    /*
    * onUpdateParameterSuccess
    */
    onUpdateParameterSuccess: function onUpdateParameterSuccess(i_familyID,i_paramID,i_paramValue) {
      var that = this;
    },
    /*
    * buildFamilyItemContent
    */
    /*buildFamilyItemContent : function buildFamilyItemContent(iFamily, familyPosition) {
      var that = this;

      if (that._xmlMap.get(iFamily.id))
      {
        that.nbofShownParameters++;
        var contentTreeView = UWA.createElement('div');

        var options = {};
        options.xmlDoc = that._xmlMap.get(iFamily.id);
        options.domainid = that._domainID;
        options.treeListViewNls = that._xmlNls.get(iFamily.id)[0];
        options.modalViewNls = that._xmlNls.get(iFamily.id)[1];


        var contentParentView = ParametersLayoutView.prototype.buildFamilyItemContent.call(that, iFamily, familyPosition);// this._parent(iFamily, familyPosition);
        contentParentView.inject(contentTreeView);

        var familyView = new DELConfigurationFamilyView(options);
        familyView = familyView.buildFamilyContent(iFamily, familyPosition);
        familyView.inject(contentTreeView);

        return contentTreeView;
      }
      else
        return this._parent(iFamily, familyPosition);
    },*/

    /*
    * mapNls
    */
    mapNls : function mapNls(key, treelistnls, modalnls, nodetreenls, resolveMapNls, rejectMapNls)
    {
      var that = this;
      try
      {
        require(['i18n!DS/ParameterizationSkeleton/assets/nls/' + treelistnls,
                'i18n!DS/ParameterizationSkeleton/assets/nls/' + modalnls,
                'i18n!DS/ParameterizationSkeleton/assets/nls/' + nodetreenls],
        function(treelistnls, modalnls, nodetreenls)
        {
          that._xmlNls.set(key,[treelistnls,modalnls,nodetreenls]);
          resolveMapNls();
        });
      }
      catch(error)
      {
        rejectMapNls();
      }
    },

    /*
    * onCompleteRequestParameters
    */
    onCompleteRequestParameters : function onCompleteRequestParameters() {
        var that = this;

        //that._parent();

        var promise = new Promise(function (resolve, reject){
          DELConfigurationParameterizationResourceServices.initAttributeModal(that._domainID, {
            onSuccess : function(xmlMap)
            {
              that._xmlMap = xmlMap;

              var promiseMapTab = [];
              var keys = Array.from(that._xmlMap.keys());
              var keysLength = keys.length;
              for (var i=0;i<keysLength;i++)
              {
                var key = keys[i];
                var xmlDoc = that._xmlMap.get(key);//iFamily.id);
                xmlDoc = xmlDoc.getElementsByTagName('ui');
                if (xmlDoc != null && xmlDoc.length)
                {
                  if (that._xmlNls === null)
                    that._xmlNls = new Map();

                  xmlDoc = xmlDoc[0];
                  var treelistnls = "";
                  if (xmlDoc.attributes.treelistnls)
                    treelistnls = xmlDoc.attributes.treelistnls.value;

                  var modalnls = "";
                  if (xmlDoc.attributes.modalnls)
                    modalnls = xmlDoc.attributes.modalnls.value;

                  var nodetreenls = "";
                  if (xmlDoc.attributes.nodetreenls)
                    nodetreenls = xmlDoc.attributes.nodetreenls.value;

                  var promiseMap = new Promise(function (resolveMapNls, rejectMapNls){
                    that.mapNls(key, treelistnls, modalnls, nodetreenls, resolveMapNls, rejectMapNls);
                  });
                  promiseMapTab.push(promiseMap);
                }
              }

              UWA.Promise.all(promiseMapTab).then(function() {
                resolve();
              });
            }
          });
        });

        UWA.Promise.all([promise]).then(function() {
          //removeApply Reset div
          var eltUI = document.getElementById("ApplyResetDiv");
          if (eltUI)
          {
              var parentNode = eltUI.getParent();
              parentNode.removeChild(eltUI);
          }

          ParametersLayoutView.prototype.onCompleteRequestParameters.call(that);
          that.PostBuildFamilyContent();
        });
    },
    /*
      * PostBuildFamilyContent
    */
    PostBuildFamilyContent: function PostBuildFamilyContent() {
      var that = this;
    }

  });

  return DELConfigurationLayoutView;
});

/**
* @quickreview  ROW 24:02:02 creation
*/
/*
* This class is created to handle common functionalities for Colors Table and Attributes Table.
* Common functionalities like, Attributes combo , re-order etc..
*/
define('DS/ParameterizationSkeleton/Views/ParameterizationDELUserExperience/DELProcessFlowDiagramBaseFamilyView',
    [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
    'DS/ParameterizationSkeleton/Utils/DELConfigurationParameterization/DELConfigurationParameterizationWebServices',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDELUserExperience/ParameterizationDELUserExperienceWebServices',
    'DS/UIKIT/Mask',
    'DS/ParameterizationSkeleton/Model/DELConfigurationParameterizationModel/DELConfigurationParamTranslationModel',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DELUserExperienceConfiguration',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DELConfigurationLayoutView'
    ],
    function (
      UWA,
      DELConfigurationFamilyView,
      DELConfigurationParameterizationWebServices,
      ParameterizationDELUserExperienceWebServices,
      Mask,
      DELConfigurationParamTranslationModel,
      Nls,
      layoutViewNls
    )
  {

  'use strict';

  var DELProcessFlowDiagramBaseFamilyView = DELConfigurationFamilyView.extend({

    _attributesResult : null,
    _node : null,
    _bEditMode : false,

    _CONSTANTS : {

      // Column Ids 
      COLOR_COLUMNIDS: {
        TYPE: 'type',
        GRAPHICALELEMENT: 'graphicalElement',
        COLOR: 'color',
        ATTRIBUTENAME: 'attributeName',
        ATTRIBUTECONDITION: 'attributeCondition',
        ATTRIBUTEVALUE: 'attributeValue',
        RULENUMBER: 'ruleNumber' // ruleNumber is used internally to manage the order. This is not visile in the UI.
      },
  
      TYPES: {
        PROCESS: 1,
        ITEM: 2,
        RESOURCE: 3
      },

      ATTRIBUTES_RESULTID : {
        ATTRIBUTES: 'attributes',
        TYPES: 'types',
        TYPENAME: 'typeName',
        TYPENLSNAME: 'typeNlsName'
      }
    },

    _ListOfTypes : {
      process : ['DELLmiPPROperationReference', 'DELLmiPPRSystemReference', 'DELLmiOperationPPRInstance', 'DELLmiPPRSystemInstance'],
      item: ['DELFmiFunctionReference', 'DELFmiFunctionInstance'],
      resource: ['Worker', 'IndustrialMachine', 'NCMachine', 'ToolDevice', 'Inspect', 'Transport', 'Conveyor', 'UserDefined', 'Sensor', 
        'Pool', 'ResourceManufacturingSetup', 'DELRmiPathway', 'LogicController', 'ControlDevice', 'ErgoHuman', 'Robot', 'ResourceArea', 
        'Organizational', 'WorkCenter', 'ResourceNCCellTemplate', 'ResourceDepartment', 'ResourceFactory', 'ResourceLine'],  
    },

    /*
    * init
    */
    init : function init(options)
    {
      var that = this;
      this._parent(options);

      that._treeListViewNls = Nls;
      that._modalViewNls = Nls;
      that._nodeTreeViewNls = Nls;
      that._needTitleForTreeListView = true;

    },

    /*
    * render
    */
    render : function render()
    {
      var that = this;
      this._parent();

      return this;
    },

    /*
     * getPromisetoGetInfofromDB
    */
    getPromisetoGetInfofromDB: function getPromisetoGetInfofromDB() {
      var that = this;
      var promise = new UWA.Promise(function (resolve, reject) {

        var tobecalledGetInfofromDB = false;
        var typekeys = Object.keys(that._ListOfTypes);
        for (let iType of typekeys) {
          if (that._attributesResult == null || that._attributesResult == undefined || that._attributesResult[iType] == undefined || that._attributesResult[iType] == null
            || that._attributesResult[iType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES] === undefined || that._attributesResult[iType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES] === null) {
            tobecalledGetInfofromDB = true;
            break;
          }
        }

        if (true === tobecalledGetInfofromDB) {
          if (that._attributesResult == null || that._attributesResult == undefined)
            that._attributesResult = [];

          var listOfTypes = Object.values(that._ListOfTypes).flat();
          ParameterizationDELUserExperienceWebServices.getlistofAllAttributes(listOfTypes, {
            onSuccess: function (data) {
              that._readResponseAndPopulateData(data);
              resolve();
            }
          });
        }
        else
          resolve()
      });
      return promise;
    },

    /*
    * Function to read response from getAttributes web service and create local lists for attributes and types 
    */
    _readResponseAndPopulateData: function _readResponseAndPopulateData(data) {
      var that = this;
      if (that._attributesResult === null)
        that._attributesResult = [];

      var typekeys = Object.keys(data);
      typekeys.forEach(iType => {

        var dataType = null;
        for (const key in that._ListOfTypes) {
            if (that._ListOfTypes[key].includes(iType)) {
              dataType = key;
              break;
            }
        }
        
        if (that._attributesResult[dataType] === undefined)
          that._attributesResult[dataType] = {};

        var dicotypekeys = Object.keys(data[iType]);
        dicotypekeys.forEach(dicoType => {
          var attrKeys = Object.keys(data[iType][dicoType]);
          attrKeys.forEach(attrKey => {

            if (that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES] === undefined)
              that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES] = {};

            var attrObj = data[iType][dicoType][attrKey];

            // 	NSY5 - Fixed IR-1351086 - Parameters Console - Process Flow Diagram - Colors - Some item types are missing
            if (attrKey !== "DicoType") {
              if (attrObj.Owner != dicoType) {
                if (that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][attrObj.Owner] === undefined)
                  that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][attrObj.Owner] = {};
  
                that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][attrObj.Owner][attrKey] = attrObj;
              }
              else {
                if (that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType] === undefined)
                  that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType] = {};
  
                that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType][attrKey] = attrObj;
              }
            }
            else {
              if (attrObj != undefined && attrObj.DictionaryName != undefined && attrObj.DictionaryNLSName != undefined) {
                if (that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES] === undefined)
                  that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES] = {};
  
                if (that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES][dicoType] === undefined)
                  that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES][dicoType] = {};
  
                that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES][dicoType][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPENAME] = attrObj.DictionaryName;
                that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES][dicoType][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPENLSNAME] = attrObj.DictionaryNLSName;
              }
            }
          });
        });
      });
    },

    /*
    * buildFamilyContent
    */
    buildFamilyContent: function buildFamilyContent() {

      var that = this;
      
       var content  =this._parent();
       return content;
    },
    /*
    * buildModal
    */
    buildModal : function buildModal(bEditMod)
    {
      var that = this;
      this._parent(bEditMod);
      //that._updateAttributesCombo();
    },

   /*
    * _updateAttributesCombo
    */
    _updateAttributesCombo : function _updateAttributesCombo(datatype)
    {
      var that = this;

      var comboAttributeKeys = document.getElementById("attributeName");
      comboAttributeKeys.dsModel.disabled = true;
      comboAttributeKeys.dsModel.elementsList = [];
      comboAttributeKeys.dsModel.selectedIndex = -1;
      if (that._attributesResult !=  null || that._attributesResult[datatype][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES] != undefined)
            {
        var data = that._attributesResult[datatype][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES];
      
              var listForCombo = that._getListOfElementsForAttributesCombo(data)
              var comboElementsListLength = listForCombo.length;
              if (comboElementsListLength > 0)
              {
                comboAttributeKeys.dsModel.disabled = false;
                comboAttributeKeys.dsModel.elementsList = listForCombo;
                comboAttributeKeys.dsModel.selectedIndex = -1;
                comboAttributeKeys.dsModel.autocompleteFlag = false;
              }
      }
    },

    _getListOfElementsForAttributesCombo : function _getListOfElementsForAttributesCombo(data)
    {
      var listForCombo = [];
      var attributesList = [];
      var typekeys = Object.keys(data);
      var typekeysLength = typekeys.length;
      for (var i=0;i<typekeysLength;i++)
      {
        var typekey = typekeys[i];
        if (typekey && data[typekey])
        {
         var typeObj = data[typekey];
         var attributekeys = Object.keys(typeObj);

          var attributekeysLength = attributekeys.length;
          for(var idxAttr=0;idxAttr<attributekeysLength;idxAttr++)
           {
             var attributekey = attributekeys[idxAttr];
             var attrObj = typeObj[attributekey];
             var attr = typekey + '.' + attributekey;
             if(!attributesList.includes(attr) )
             {
               attributesList.push(attr);
               var comboLabel = attrObj.NLSName + ' (' + attrObj.Owner + '.' + attributekey  + ')';
               var comboValue = attrObj.Owner + '.' + attributekey;  
               listForCombo.push({label: comboLabel, value: comboValue});
             }
           }
          if (listForCombo.length) {
            listForCombo.sort(function (comboValue1, comboValue2) {
              if (comboValue1.label.toLowerCase() === comboValue2.label.toLowerCase())
                return 0;
              return comboValue1.label.toLowerCase() > comboValue2.label.toLowerCase() ? 1 : -1;
            });
          }
        }
      }
      return listForCombo;
    },
    /*
    * presetModal
    */
    presetModal : function presetModal(node)
    {
      console.log("presetModal");
      var that = this;
      this._parent(node);
    },

    /*
    * mapFunctions
    */
    mapFunctions: function mapFunctions(name)
    {
        var that = this;
        return null;
    },

    /*
    * onOKEditButtonClick
    */
    onOKEditButtonClick : function onOKEditButtonClick()
    {
      var that = this;
      that._bEditMode = true;
      var nodeData = that._node.getData();
      var attributeName = nodeData["attributeName"];
      if (attributeName != undefined && attributeName.includes(' (')) {
        var storedAttributeName = (attributeName.split(' (')[1]).split(")")[0];
        nodeData["attributeName"] = storedAttributeName;
      }
      that._parent();
      that._bEditMode = false;
    },

    /*
    * onOKButtonClick
    */
    onOKButtonClick : function onOKButtonClick()
    {
      var that = this;
      that._parent();
    },

    /*
    * onCancelButtonClick
    */
    onCancelButtonClick : function onCancelButtonClick()
    {
      var that = this;
      that._parent();
      that._bEditMode = false;
    },

    /*
    * removeSelectedNode
    */
    removeSelectedNode : function removeSelectedNode(params)
    {
      console.log("params " + params);
      var that = this;

      var node = params.context.nodeModel;
      var nodeData = node.getData();
      var attributeName = nodeData["attributeName"];

      if (attributeName != undefined && attributeName.includes(' (')) {
        var storedAttributeName = (attributeName.split(' (')[1]).split(")")[0];
        nodeData["attributeName"] = storedAttributeName;
      }

      var rowModelLength = params.configurationLayoutView.treeList.dataGridView.getRowModelLength();

      if ((nodeData["rowIndex"] != undefined && nodeData["rowIndex"] != rowModelLength) || (nodeData["ruleNumber"] != undefined && nodeData["ruleNumber"] != rowModelLength)) {
        var treeDoc = params.configurationLayoutView.treeList.dataGridView.treeDocument;
        if (treeDoc)
          treeDoc.removeRoot(node);
        var bUpdateRequiredAfterDelete = true;
        that._updateParameters(bUpdateRequiredAfterDelete);
      }
      else
        that._parent(params);
    },

    /*
    * editSelectedNode
    */
    editSelectedNode : function editSelectedNode(params)
    {
      console.log("params " + params);
      var that = this;
      that._bEditMode = true;
      that._parent(params);
    },

    /*
    * buildtreeListView
    */
    buildtreeListView: function buildtreeListView() {
      var that = this;
      that._parent();
      that.treeListView.rowDragEnabledFlag = true;
      that.treeListView.cellDragEnabledFlag = true;
      that.treeListView.rowReorderEnabledFlag = true;
      that.treeListView.cellSelection = 'single';
      that.treeListView.rowSelection = 'single';
      that.treeListView.showSelectionCheckBoxesFlag = false;

      that.treeListView.onDropRowHeader = that._onDrop.bind(that);
      that.treeListView.onDropCell = that._onDrop.bind(that);
    },

    _onDrop:function  _onDrop(event, cellInfos) {
      var that = this;
      console.log("onDropRow/Cell");
      that.treeListView.onDropCellDefault.call(that.treeListView, event, cellInfos);
      
      if(that.IsTableModified()){
        that._updateParameters();
      }
    },

    getRowDataFromTreeView: function getRowDataFromTreeView(rowID) {
      var that = this;

      var dataObject = that._parent(rowID);
      
      if (dataObject != undefined && dataObject["attributeName"] != undefined && dataObject["attributeName"].includes(' (')) {
        var AttributeNameToBeStored = (dataObject["attributeName"].split(' (')[1]).split(")")[0];
        dataObject["attributeName"] = AttributeNameToBeStored;
      }
      return dataObject;
    },

    _updateParameters : function _updateParameters(bUpdateForDelete){
      var that = this;
      Mask.mask(that.treeListView.elements.body,Nls.orderParametersMaskMessage);
      DELConfigurationParameterizationWebServices.deleteParameter(that._domainID, that._familyID, that._paramID, that._argID, null, {
        onSuccess: function (data) {
          var treeDoc = that.treeListView.treeDocument;
          var newRowModelLength =   that.treeListView.getRowModelLength();
          var promisesSetParams = [];
          var dataObjects = [];

          if (newRowModelLength) {
            for (var rowIndex = 0; rowIndex < newRowModelLength; rowIndex++) {
              var dataObject = that.getRowDataFromTreeView(rowIndex);
              dataObjects.push(dataObject);
            }

            for (var rowIndex = 0; rowIndex < newRowModelLength; rowIndex++) {
              var promiseSetParams = new Promise(function (resolve, reject) {
                var dataObject = dataObjects[rowIndex];
                DELConfigurationParameterizationWebServices.setParameters(that._domainID, that._familyID, that._paramID, that._argID, dataObject, {
                  onSuccess: function (data) {
                    resolve(dataObject);
                  },
                  onFailure: function (error) {
                    reject("DELConfigurationParameterizationWebServices.setParameters");
                    console.error("DELConfigurationParameterizationWebServices.setParameters");
                  }
                });
              });
              promisesSetParams.push(promiseSetParams);
            }

            UWA.Promise.all(promisesSetParams).then(function (attrsSetParams) {

              // Check Deployment and update Tree
              var promisesIsDeployed = [];
              for (var idxNode = 0; idxNode < newRowModelLength; idxNode++) {
                var promiseIsDeployed = new Promise(function (resolve, reject) {
                  var dataObject = dataObjects[idxNode];
                  if (dataObject) {
                    DELConfigurationParameterizationWebServices.isDeployed(that._domainID, that._familyID, that._paramID, that._argID, dataObject, {
                      onSuccess: function (data) {
                        resolve({ treeNodeData: dataObject, isDeployed: data });
                      },
                      onFailure: function (error) {
                        reject("DELConfigurationParameterizationWebServices.isDeployed");
                        console.error("DELConfigurationParameterizationWebServices.isDeployed");
                      }
                    });
                  }
                });
                promisesIsDeployed.push(promiseIsDeployed);
              }
              UWA.Promise.all(promisesIsDeployed).then(function (resultIsDeployed) {
                var listOfnodeTree = [];
                var lengthIsDeployed = resultIsDeployed.length;
                if (newRowModelLength === lengthIsDeployed) {
                  for (var idxDeployed = 0; idxDeployed < lengthIsDeployed; idxDeployed++) {
                    var treeNode = that.createtreeNode(resultIsDeployed[idxDeployed].treeNodeData);
                    if (treeNode) {
                      treeNode.addGridAttributes({ isDeployed: resultIsDeployed[idxDeployed].isDeployed });
                      listOfnodeTree.push(treeNode);
                    }
                  }
                  treeDoc.removeRoots();
                  that.addChild(listOfnodeTree);
                }

                that.displayNotifications({
                  level: 'info',
                  message: Nls.orderParameters,
                  title: Nls.orderParametersTitle
                });
                Mask.unmask(that.treeListView.elements.body);
              }).catch(function (rejectMessages) {
                that.displayNotifications({
                  level: 'error',
                  message: Nls.orderParametersError,
                  title: Nls.orderParametersTitle
                });
                console.error(rejectMessages);
                Mask.unmask(that.treeListView.elements.body);
              });
            }).catch(function (rejectMessages) {
              that.displayNotifications({
                level: 'error',
                message: Nls.orderParametersError,
                title: Nls.orderParametersTitle
              });
              console.error(rejectMessages);
              Mask.unmask(that.treeListView.elements.body);
            });
          }
          if (bUpdateForDelete) {
            that.displayNotifications({
              level: 'info',
              message: layoutViewNls.deleteParameter,
              title: layoutViewNls.deleteParameterTitle
            });
          }
        },
        onFailure: function (err) {
          that.displayNotifications({
            level: 'error',
            message: layoutViewNls.deleteParameterError,
            title: layoutViewNls.deleteParameterTitle
          });
        }
      }); 

    },

    toJSON() {
      return {
        editSelectedNode: this.editSelectedNode,
        removeSelectedNode:  this.removeSelectedNode,
      };
    }
  });
  return DELProcessFlowDiagramBaseFamilyView;
});

define("DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/ApiModel", ["require", "exports", "UWA/Class/Model", "DS/ParameterizationSkeleton/Utils/ParameterizationPartSupply/Utils"], function (require, exports, Model, Utils) {
    "use strict";
    var ApiModelModule;
    (function (ApiModelModule) {
        /**
         * Model that handles passport fallbacks
         */
        ApiModelModule.ApiModel = Model.extend({
            sync: function (method, model, options) {
                var _this = this;
                var onPassportError = function (error, resp, headers) {
                    _this.requireAuthentication();
                };
                var _options = Utils.Utils.clone(options);
                _options.onPassportError = onPassportError;
                return this._parent(method, model, options);
            },
            requireAuthentication: function () {
                return window.location.replace('/authenticate?redirectTo=' + encodeURIComponent(window.location.href));
            }
        });
    })(ApiModelModule || (ApiModelModule = {}));
    ;
    return ApiModelModule;
});

/**
* @quickreview  ROW 24:08:30 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationUnitsAndParameters/ParametersExtensionsMappingConfigFamilyView',
  [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
    'DS/ParameterizationSkeleton/Model/DELConfigurationParameterizationModel/DELConfigurationParamTranslationModel',
    'DS/ParameterizationSkeleton/Utils/ParameterizationUnitsAndParameters/UnitsAndParametersParameterizationWebServices',
    'DS/ParameterizationSkeleton/Utils/ParameterizationUnitsAndParameters/UnitsAndParametersParameterizationDataUtils',
    "DS/Tweakers/TweakerString",
    'DS/Controls/LineEditor',
    'DS/Controls/ComboBox',
    'i18n!DS/ParameterizationSkeleton/assets/nls/UnitsAndParameters',
  ],
  function (
    UWA,
    DELConfigurationFamilyView,
    DELConfigurationParamTranslationModel,
    UnitsAndParametersParameterizationWebServices,
    UnitsAndParametersParameterizationDataUtils,
    TweakerString,
    WUXEditor,
    WUXComboBox,
    Nls,
  ) {

    'use strict';

    var ParametersExtensionsMappingConfigFamilyView = DELConfigurationFamilyView.extend({

      _node: null,
      _listExtensionsAndAttributes: null,
      _bEditMode: false,

      /*
      * init
      */
      init: function init(options) {
        var that = this;
        this._parent(options);

        that._treeListViewNls = Nls;
        that._modalViewNls = Nls;
        that._nodeTreeViewNls = Nls;
      },
      /*
      * onOKEditButtonClick
      */
      onOKEditButtonClick: function onOKEditButtonClick() {
        var that = this;
        that._bEditMode = true;
        that._parent();
        that._bEditMode = false;
      },

      /*
      * onCancelButtonClick
      */
      onCancelButtonClick: function onCancelButtonClick() {
        var that = this;
        that._parent();
        that._bEditMode = false;
      },

      /*
      * editSelectedNode
      */
      editSelectedNode: function editSelectedNode(params) {
        console.log("params " + params);
        var that = this;
        that._bEditMode = true;
        that._parent(params);
      },
      /*
      * mapFunctions
      */
      mapFunctions: function mapFunctions(name) {
        var that = this;
        if (name === "onChangeParametersCombo")
          return that.onSelectParameter.bind(that);
        else if (name === "onChangeExternsionsCombo")
          return that.onSelectExtension.bind(that);
        else if (name === "onChangeAttributesCombo")
          return that.onSelectAttriute.bind(that);

        else return null;
      },

      /*
      * createtreeNode
      */
      createtreeNode: function createtreeNode(data, grid) {
        var that = this;

        var translationModel = new DELConfigurationParamTranslationModel({
          data: data,
          grid: grid,
          nls: Nls
        });

        if (grid == undefined) {
          var gridTemp = translationModel.getGrid();
          var storedExtensionName = data["extension"];
          var storedAttributeName = data["attributeName"];
          var storedAttrName = storedAttributeName.split('.')[1];
          var storedOwnerName = storedAttributeName.split('.')[0];


          // We only store actual Attriute Name,  to display we need to construct the NLS name and set it on the grid of DataGrid model.
          if (that._listExtensionsAndAttributes != null && that._listExtensionsAndAttributes != undefined && storedExtensionName != null && storedExtensionName != undefined &&
            that._listExtensionsAndAttributes[storedExtensionName] != null && that._listExtensionsAndAttributes[storedExtensionName] != undefined &&
            that._listExtensionsAndAttributes[storedExtensionName]["attributes"] != null && that._listExtensionsAndAttributes[storedExtensionName]["attributes"] != undefined) {

            if (that._listExtensionsAndAttributes[storedExtensionName].NLSName != null && that._listExtensionsAndAttributes[storedExtensionName].NLSName != undefined)
              gridTemp["extension"] = that._listExtensionsAndAttributes[storedExtensionName].NLSName;

            var attrkeys = Object.keys(that._listExtensionsAndAttributes[storedExtensionName]["attributes"]);
            attrkeys.forEach(attrName => {
              if (attrName === storedAttrName) {
                var AttrObj = that._listExtensionsAndAttributes[storedExtensionName]["attributes"][attrName];
                gridTemp["attributeName"] = AttrObj.NLSName + "(" + AttrObj.DictionaryNLSName + "." + AttrObj.NLSName + ")";
              }
            });
          }

        }
        return translationModel;
      },

      /*
       * buildModal
       */
      buildModal: function buildModal(bEditMod) {
        var that = this;
        that._modalViewNls.modalTitle = that._modalViewNls.Title_ParametersAndExtensions_modal;
        that._modalViewNls.Info = that._modalViewNls.Info_ParametersAndExtensions_modal;

        this._parent(bEditMod);

        var comboParameters = document.getElementById("parameter");
        var comboExtensions = document.getElementById("extension");
        var comboAttrbiutes = document.getElementById("attributeName");
        var comboAttrbiuteValues = document.getElementById("attributeValue");

        comboParameters.dsModel.disabled = true;
        comboParameters.dsModel.elementsList = [];
        comboParameters.dsModel.selectedIndex = -1;

        comboExtensions.dsModel.disabled = true;
        comboExtensions.dsModel.elementsList = [];
        comboExtensions.dsModel.selectedIndex = -1;

        comboAttrbiutes.dsModel.disabled = true;
        comboAttrbiutes.dsModel.elementsList = [];
        comboAttrbiutes.dsModel.selectedIndex = -1;

        comboAttrbiuteValues.dsModel.disabled = true;
        comboAttrbiuteValues.dsModel.elementsList = [];
        comboAttrbiuteValues.dsModel.selectedIndex = -1;

        var listParameters = UnitsAndParametersParameterizationDataUtils.getParametersList();
        if (listParameters.length) {
          var listForCombo = [];
          listParameters.forEach(parameter => {
            listForCombo.push({ label: parameter, value: parameter });
          });
          comboParameters.dsModel.disabled = false;
          comboParameters.dsModel.elementsList = listForCombo;
          comboParameters.dsModel.selectedIndex = -1;
          comboParameters.dsModel.autocompleteFlag = false;
        }

      },

      /*
      * getPromisetoGetInfofromDB
      */
      getPromisetoGetInfofromDB: function getPromisetoGetInfofromDB() {
        var that = this;
        var promise = new UWA.Promise(function (resolve, reject) {
          if (that._listExtensionsAndAttributes == null || that._listExtensionsAndAttributes == undefined) {
            that._listExtensionsAndAttributes = {};

            var listOfTypes = ["PerformanceChar", "PLMSpecifyHowToCollectDataCnx", "DELResourcePrmPlanAbstract", "DELResourcePrmPlanSET", "DELResourcePrmPlanGET", "DELResourcePrmAbstract", "DELResourcePrmINPUT", "DELResourcePrmOUTPUT"];
            UnitsAndParametersParameterizationWebServices.getlistofCustomExtensionsAndAttributes(listOfTypes, true, {
              onSuccess: function (data) {
                that._listExtensionsAndAttributes = data;
                resolve();
              }
            });

          }
          else
            resolve()
        });
        return promise;
      },

      getExtensionsComboList: function getExtensionsComboList() {
        var that = this;
        var listForCombo = [];
        var extensionsList = [];

        var typekeys = Object.keys(that._listExtensionsAndAttributes);
        typekeys.forEach(dicoType => {
          if (!extensionsList.includes(dicoType)) {
            extensionsList.push(dicoType);
            var comboLabel = (that._listExtensionsAndAttributes[dicoType]).NLSName;
            var comboValue = dicoType;
            listForCombo.push({ label: comboLabel, value: comboValue });
          }
        });
        if (listForCombo.length) {
          listForCombo.sort(function (comboValue1, comboValue2) {
            if (comboValue1.label.toLowerCase() === comboValue2.label.toLowerCase())
              return 0;
            return comboValue1.label.toLowerCase() > comboValue2.label.toLowerCase() ? 1 : -1;
          });
        }
        return listForCombo;
      },


      onSelectParameter: function onSelectParameter() {
        var that = this;
        var comboParameters = document.getElementById("parameter");
        var comboExtensions = document.getElementById("extension");

        var listExtensionsCombo = that.getExtensionsComboList();
        if (listExtensionsCombo.length) {

          comboExtensions.dsModel.disabled = false;
          comboExtensions.dsModel.elementsList = listExtensionsCombo;
          comboExtensions.dsModel.selectedIndex = -1;
          comboExtensions.dsModel.autocompleteFlag = false;
        }
      },

      onSelectExtension: function onSelectExtension() {
        var that = this;
        var comboExtensions = document.getElementById("extension");
        var comboAttributes = document.getElementById("attributeName");

        var selectedExtension = comboExtensions.dsModel.elementsList[comboExtensions.dsModel.selectedIndex].value;

        var listAttributesCombo = that.getAttributesComboList(selectedExtension);
        if (listAttributesCombo.length) {

          comboAttributes.dsModel.disabled = false;
          comboAttributes.dsModel.elementsList = listAttributesCombo;
          comboAttributes.dsModel.selectedIndex = -1;
          comboAttributes.dsModel.autocompleteFlag = false;
        }
      },

      onSelectAttriute: function onSelectAttriute() {
        var that = this;

        var uiElementAttrValue = null;

        that._uiElementsIDs.forEach(element => {
          if (element.id === "attributeValue") {
            uiElementAttrValue = element;
          }

        });

        var comboExtensions = document.getElementById("extension");
        var comboAttributes = document.getElementById("attributeName");
        var selectedExtension = comboExtensions.dsModel.elementsList[comboExtensions.dsModel.selectedIndex].value;
        var selectedAttribute = comboAttributes.dsModel.elementsList[comboAttributes.dsModel.selectedIndex].value;
        var attrObj = that.getAttrObjForSelectedAttribute(selectedExtension, selectedAttribute);
        if (attrObj != null && attrObj != undefined) {
          var attrAuthorizedValues = attrObj.AuthorizedValue;
          var attrAuthorizedValuesNLS = attrObj.AuthorizedValueNLS;
          var attrType = attrObj.Type;

          var tempUiElt = null;
          if (Array.isArray(attrAuthorizedValues) || attrType === "Boolean") {
            var listForAttrValCombo = [];
            var attrAuthorizedValuesLength = attrAuthorizedValues.length;
            if (attrAuthorizedValuesLength) {

              for (var idxAttrValue = 0; idxAttrValue < attrAuthorizedValuesLength; idxAttrValue++) {
                var attributeValue = attrAuthorizedValues[idxAttrValue];
                var attributeValueNLS = attrAuthorizedValuesNLS[idxAttrValue];
                if (attributeValue) {
                  listForAttrValCombo.push({ label: attributeValueNLS, value: attributeValue });
                }
              }

            }
            else if (attrType === "Boolean") {
              var strBooleanTrue = "true";
              var strBooleanFalse = "false";
              listForAttrValCombo.push({ label: Nls.attributeValueBooleanTrue, value: strBooleanTrue });
              listForAttrValCombo.push({ label: Nls.attributeValueBooleanFalse, value: strBooleanFalse });
            }

            var lOptions = {};
            lOptions.elementsList = listForAttrValCombo;
            lOptions.selectedIndexes = [];
            lOptions.displayStyle = "normal";
            lOptions.enableSearchFlag = true;
            lOptions.placeholder = "Select";
            if (that._modalViewNls != null || that._modalViewNls != undefined)
              lOptions.placeholder = that._modalViewNls.Select;

            uiElementAttrValue.type = "combobox";
            tempUiElt = new WUXComboBox(lOptions);
            tempUiElt.elements.container.className += " delcomboboxmodal";
            tempUiElt.elements.container.setAttribute('id', "attributeValue");

          }
          else {
            uiElementAttrValue.type = "textarea";
            var lOptions = {};
            tempUiElt = new WUXEditor(lOptions);
            tempUiElt.elements.container.className += " deltextEditormodal";
            tempUiElt.elements.container.setAttribute('id', "attributeValue");
          }

          var comboattributeValues = document.getElementById("attributeValue");
          if (tempUiElt && comboattributeValues) {
            var subModalContentDiv = document.getElementsByClassName("subcontentModalView");
            subModalContentDiv.item(3).replaceChild(tempUiElt.elements.container, comboattributeValues);
          }
          var attrValueElement = document.getElementById("attributeValue");
          attrValueElement.dsModel.disabled = false;
          uiElementAttrValue.mandatory = true;
        }


      },

      getAttributesComboList: function getAttributesComboList(i_ExtensionName) {
        var that = this;
        var listForCombo = [];
        if (that._listExtensionsAndAttributes != null && that._listExtensionsAndAttributes != undefined &&
          that._listExtensionsAndAttributes[i_ExtensionName] != null && that._listExtensionsAndAttributes[i_ExtensionName] != undefined &&
          that._listExtensionsAndAttributes[i_ExtensionName]["attributes"] != null && that._listExtensionsAndAttributes[i_ExtensionName]["attributes"] != undefined) {

          var attributesList = [];

          var attrkeys = Object.keys(that._listExtensionsAndAttributes[i_ExtensionName]["attributes"]);
          attrkeys.forEach(attrName => {
            var comboLineObj = that.buildLabelAndValueForCombo(that._listExtensionsAndAttributes[i_ExtensionName]["attributes"][attrName]);
            if (!attributesList.includes(comboLineObj.value)) {
              attributesList.push(comboLineObj.value);
              listForCombo.push(comboLineObj);
            }
          });
          if (listForCombo.length) {
            listForCombo.sort(function (comboValue1, comboValue2) {
              if (comboValue1.label.toLowerCase() === comboValue2.label.toLowerCase())
                return 0;
              return comboValue1.label.toLowerCase() > comboValue2.label.toLowerCase() ? 1 : -1;
            });
          }
        }
        return listForCombo;
      },

      buildLabelAndValueForCombo(i_AttributeObj) {
        var that = this;

        var comboLabel = i_AttributeObj.NLSName + "(" + i_AttributeObj.DictionaryNLSName + "." + i_AttributeObj.NLSName + ")";
        var comboValue = i_AttributeObj.Owner + "." + i_AttributeObj.Name;

        return { label: comboLabel, value: comboValue };

      },

      /*
      * i_selectedAttribute <Owner.Name>
      */

      getAttrObjForSelectedAttribute(i_ExtensionName, i_selectedAttribute) {
        var that = this;
        var ownerName = i_selectedAttribute.split(".")[0];
        var attributeName = i_selectedAttribute.split(".")[1];
        if (that._listExtensionsAndAttributes != null && that._listExtensionsAndAttributes != undefined &&
          that._listExtensionsAndAttributes[i_ExtensionName] != null && that._listExtensionsAndAttributes[i_ExtensionName] != undefined &&
          that._listExtensionsAndAttributes[i_ExtensionName]["attributes"] != null && that._listExtensionsAndAttributes[i_ExtensionName]["attributes"] != undefined &&
          that._listExtensionsAndAttributes[i_ExtensionName]["attributes"][attributeName] != null && that._listExtensionsAndAttributes[i_ExtensionName]["attributes"][[attributeName]] != undefined) {
          return that._listExtensionsAndAttributes[i_ExtensionName]["attributes"][attributeName];
        }
      }

    });
    return ParametersExtensionsMappingConfigFamilyView;
  });

/**
* @quickreview  ROW 24:02:02 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDELUserExperience/DELProcessFlowDiagramAspectRatiosConfigFamilyView',
    [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DELUserExperienceConfiguration'
    ],
    function (
      UWA,
      DELConfigurationFamilyView,
      Nls
    )
  {

  'use strict';

  var DELProcessFlowDiagramAspectRatiosConfigFamilyView = DELConfigurationFamilyView.extend({

    _attributesResult : null,
    _node : null,
    _bEditMode : false,
   
    /*
    * init
    */
    init : function init(options)
    {
      var that = this;
      this._parent(options);

      that._treeListViewNls = Nls;
      that._modalViewNls = Nls;
      that._nodeTreeViewNls = Nls;
      that._needTitleForTreeListView = true;

    },

    /*
    * buildFamilyContent
    */
    buildFamilyContent: function buildFamilyContent() {

      var that = this;
      that._nodeTreeViewNls.treeViewTitle = that._nodeTreeViewNls.aspectRatiosTableName;
      
       var content  =this._parent();
       return content;
    },

    /*
    * buildModal
    */
    buildModal: function buildModal(bEditMod) {
      var that = this;
      that._modalViewNls.modalTitle = that._modalViewNls.aspectRatiosTableName;
      that._modalViewNls.Info = that._modalViewNls.Info_AspectRatios_modal;
      this._parent(bEditMod);
    },

      /*
      * onOKEditButtonClick
      */
      onOKEditButtonClick: function onOKEditButtonClick() {
        var that = this;
        that._bEditMode = true;
        that._parent();
        that._bEditMode = false;
      },

      /*
      * onCancelButtonClick
      */
      onCancelButtonClick: function onCancelButtonClick() {
        var that = this;
        that._parent();
        that._bEditMode = false;
      },
      
      /*
      * editSelectedNode
      */
      editSelectedNode: function editSelectedNode(params) {
        console.log("params " + params);
        var that = this;
        that._bEditMode = true;
        that._parent(params);
      },

    /*
    * validateModal
    */
    validateModal : function validateModal()
    {
      var that = this;
      console.log("validateModal");

      var treeNodeModel = that._parent();
      if (treeNodeModel != undefined) {
        var data = treeNodeModel.getData();

        var rowModelLength = that.treeListView.getRowModelLength();
        var listARNamesAlreadyDefined = [];

        if (rowModelLength) {
          for (var rowIndex = 0; rowIndex < rowModelLength; rowIndex++) {
            var dataObject = that.getRowDataFromTreeView(rowIndex);
            listARNamesAlreadyDefined.push(dataObject['aspectRatioName']);
          }
        }

        var editNodeName = "";
        if (that._bEditMode) {
          var nodeData = that._node.getData();
          editNodeName = nodeData["aspectRatioName"];
        }
        var bShowError = false;
        var strErrorMessage = "";

        var nameValue = data['aspectRatioName'];
        var widthValue = data['aspectRatioWidth'];
        var heightValue = data['aspectRatioHeight'];
        var nameNls = Nls.aspectRatioName;
        var widthNls = Nls.aspectRatioWidth;
        var heightNls = Nls.aspectRatioHeight;

        if ((!that._bEditMode && listARNamesAlreadyDefined.includes(nameValue)) || (that._bEditMode && editNodeName != nameValue && listARNamesAlreadyDefined.includes(nameValue))) {
          var strErrorMessage = Nls.ErrorMsgNameAlreadyUsed;
          bShowError = true;
          strErrorMessage = strErrorMessage.replace("%1", nameNls);
        }

        if (isNaN(widthValue) ) {
          bShowError = true;
          strErrorMessage = Nls.ErrorMsgNotANumber;
          strErrorMessage = strErrorMessage.replace("%1", widthNls);
        }
        else{
          var n = Math.floor(Number(widthValue));
          if(n<=0){
            bShowError = true;
            strErrorMessage = Nls.ErrorMsgNotInRange;
            strErrorMessage = strErrorMessage.replace("%1", widthNls);
          }
        }
        if(isNaN(heightValue)) {
          bShowError = true;
          strErrorMessage = Nls.ErrorMsgNotANumber;
          strErrorMessage = strErrorMessage.replace("%1", heightNls);
        }
        else{
          var n = Math.floor(Number(heightValue));
          if(n<=0){
            bShowError = true;
            strErrorMessage = Nls.ErrorMsgNotInRange;
            strErrorMessage = strErrorMessage.replace("%1", heightNls);
          }
        }
        if(bShowError){
          that._modalView.showToastMessage(2, strErrorMessage);
            return;
        }
      }
      return treeNodeModel;
    }
  });
  return DELProcessFlowDiagramAspectRatiosConfigFamilyView;
});

/**
* @quickreview  ROW 24:08:30 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDigitalManufacturing/DigitalMfgActionsOnOpItemImplLinkConfigFamilyView',
  [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
    'i18n!DS/ParameterizationSkeleton/assets/nls/ActionsOnOpItemImplLink',
  ],
  function (
    UWA,
    DELConfigurationFamilyView,
    Nls,
  ) {

    'use strict';

    var DigitalMfgActionsOnOpItemImplLinkConfigFamilyView = DELConfigurationFamilyView.extend({

      _node: null,
      _bEditMode: false,

      /*
      * init
      */
      init: function init(options) {
        var that = this;
        this._parent(options);

        that._treeListViewNls = Nls;
        that._modalViewNls = Nls;
        that._nodeTreeViewNls = Nls;
      },
      /*
      * onOKEditButtonClick
      */
      onOKEditButtonClick: function onOKEditButtonClick() {
        var that = this;
        that._bEditMode = true;
        that._parent();
        that._bEditMode = false;
      },

      /*
      * onCancelButtonClick
      */
      onCancelButtonClick: function onCancelButtonClick() {
        var that = this;
        that._parent();
        that._bEditMode = false;
      },
      
      /*
      * editSelectedNode
      */
      editSelectedNode: function editSelectedNode(params) {
        console.log("params " + params);
        var that = this;
        that._bEditMode = true;
        that._parent(params);
      },

      /*
      * validateModal
      */
      validateModal: function validateModal() {
        var that = this;
        console.log("validateModal");

        var treeNodeModel = that._parent();
        if (treeNodeModel != undefined) {
          var data = treeNodeModel.getData();

          var newRowModelLength = that.treeListView.getRowModelLength();
          var listActionsAlreadyDefined = [];

          if (newRowModelLength) {
            for (var rowIndex = 0; rowIndex < newRowModelLength; rowIndex++) {
              var dataObject = that.getRowDataFromTreeView(rowIndex);
              listActionsAlreadyDefined.push(dataObject['action']);
            }
          }

          var bShowError = false;

          var actionNls = Nls.action;
          var actionValue = data['action'];
          var editNodeRoleCustom = "";
          if (that._bEditMode) {
            var nodeData = that._node.getData();
            editNodeRoleCustom = nodeData["action"];
          }
          if ((!that._bEditMode && listActionsAlreadyDefined.includes(actionValue)) || (that._bEditMode && editNodeRoleCustom != actionValue && listActionsAlreadyDefined.includes(actionValue))) {
            var strErrorMessage = Nls.ErrorActionAlreadyDefined;

            bShowError = true;
            strErrorMessage = strErrorMessage.replace("%1", actionNls);
            strErrorMessage = strErrorMessage.replace("%2", actionNls);
          }

          if (bShowError) {
            that._modalView.showToastMessage(2, strErrorMessage);
            return;
          }
        }
        return treeNodeModel;
      }

    });
    return DigitalMfgActionsOnOpItemImplLinkConfigFamilyView;
  });

/**
* @quickreview  KB9 21:10:25 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationOrderDataMgt/DELOrderDataMgtLayoutView',
    [
    'UWA/Core',
    'DS/UIKIT/Mask',
    'DS/UIKIT/Popover',
    'DS/UIKIT/Input/Text',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationLayoutView',
    'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
    'DS/ParameterizationSkeleton/Utils/DELConfigurationParameterization/DELConfigurationParameterizationWebServices',
    'DS/ParameterizationSkeleton/Utils/ParameterizationWebServices',
    'DS/ParameterizationSkeleton/Utils/ParameterizationODM/ParameterizationODMWebServices',
    'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DELOrderDataMgtLayoutView'
    ],
    function (
      UWA,
      Mask,
      Popover,
      Text,
      DELConfigurationLayoutView,
      ParametersLayoutViewUtilities,
      DELConfigurationParameterizationWebServices,
      ParameterizationWebServices,
      ParameterizationODMWebServices,
      ParamSkeletonNLS,
      DELOrderDataMgtLayoutViewNLS
    )
  {

  'use strict';

  var DELOrderDataMgtLayoutView = DELConfigurationLayoutView.extend({

    /*
    * init
    */
    init : function init(options)
    {
      this._domainID = options.domainid;
      this._parent(options);
    },

    UpdateCommonParamsOnServer : function () {
      var that = this;
      var iParam, imgCell,
          jsonArr = [],
          ArgArr = [],
          affixInput = ParametersLayoutViewUtilities.getNamingControlInput(this.inputControls, "sitenameinput"),
          separatorSelector = ParametersLayoutViewUtilities.getNamingControlInput(this.inputControls, "selectSeparator"),
          currSelectedOpt = separatorSelector.getSelection(),
          separatorVal = currSelectedOpt[0].value,
          AffixValue = affixInput.getValue(),
          tbodyreflist = this.contentDiv.getElements('.fparamtbody');

        //if (AffixValue === "") { AffixValue = "TBD"; }


        Mask.mask(this.contentDiv);

        ArgArr.push({id: "AffixArg", value: AffixValue});
        ArgArr.push({id: "SeparatorArg", value: separatorVal});
        var nbDigits = ParametersLayoutViewUtilities.getNamingControlInput(this.inputControls, "nbDigitsInput");
        ArgArr.push({id: "NbDigitsArg", value: nbDigits.getValue()});

        iParam = {
            domain: this.model.get("domainid"),
            id: "IdentifierAffix",
            argument : ArgArr
        };

        imgCell = ParametersLayoutViewUtilities.getNamingDeployCellSts(tbodyreflist);

        jsonArr.push(iParam);
		
		/*var nbDigits = ParametersLayoutViewUtilities.getNamingControlInput(this.inputControls, "nbDigitsInput");
		iParam = {
			domain: this.model.get("domainid"),
			id: "IdentifierAffix",
			argument : [{id: "NbDigitsArg", value: nbDigits.getValue()}]
		};

		jsonArr.push(iParam);*/
				
        /*var func2 = func1.bind(this); func2(params);*/
        //ParameterizationWebServices.postParamsArrOnServer.call(this, this.connectProps, jsonArr, imgCell,
        //    this.onApplyFailure.bind(this), this.postNamingParams.bind(this));

        var contentType = ParametersLayoutViewUtilities.getNamingControlInput(this.inputControls, "iTypeSelect");
        contentType = contentType.getValue()[0];

        var prefix = ParametersLayoutViewUtilities.getNamingControlInput(this.inputControls, "prefixInput");
        var interfix = ParametersLayoutViewUtilities.getNamingControlInput(this.inputControls, "sitenameinput");
        var suffix = ParametersLayoutViewUtilities.getNamingControlInput(this.inputControls, "suffixInput");

        var params = {
          contentType : contentType,
          prefix : prefix.getValue(),
          interfix : interfix.getValue(),
          suffix : suffix.getValue(),
          separator : separatorVal,
          counterLength : nbDigits.getValue()
        };

        var callback = {};
        callback.onSuccess = this.onApplySuccess.bind(this);
        callback.onFailure = this.onApplyFailure.bind(this);

		
		ParameterizationODMWebServices.autoNamingRule(params, imgCell ,{
			onSuccess : function onSuccess() {
				ParameterizationWebServices.postParamsArrOnServer.call(that, that.connectProps, jsonArr, imgCell,
					that.onApplyFailure.bind(that), that.postNamingParams.bind(that));

			},
			onFailure : function onFailure () {
				that.onApplyFailure.bind(that);
			}
		});

    },
	
	testOnlineIdInput : function(inputID) {
		var that = this;
		
		ParametersLayoutViewUtilities.getNamingControlInput(this.inputControls, "nbDigitsInput").elements.input.disabled = false;
		//var bPrefixValueNotEmpty = true;
		if (inputID === "prefixInput") {
			var inputToTest = ParametersLayoutViewUtilities.getNamingControlInput(this.inputControls, inputID);
            var inputValue = inputToTest.getValue();
			//bPrefixValueNotEmpty = ParametersLayoutViewUtilities.testSpecialCharacters(inputValue, ' ');
			var emptyValue = inputValue.replaceAll(' ','');
			
			this._parent(inputID);
			if (emptyValue.length > 0 && inputValue != "") 
				that.checkDigits(ParametersLayoutViewUtilities.getNamingControlInput(that.inputControls, "nbDigitsInput"));
			else {				
			  //ParametersLayoutViewUtilities.getNamingControlInput(this.inputControls, "prefixInput").elements.input.disabled = true;
			  ParametersLayoutViewUtilities.getNamingControlInput(this.inputControls, "suffixInput").elements.input.disabled = true;
			  ParametersLayoutViewUtilities.getNamingControlInput(this.inputControls, "sitenameinput").elements.input.disabled = true;			  
			  ParametersLayoutViewUtilities.getNamingControlInput(this.inputControls, "nbDigitsInput").elements.input.disabled = true;
			  ParametersLayoutViewUtilities.getNamingControlInput(this.inputControls, "iTypeSelect").elements.input.disabled = true;			  
			  ParametersLayoutViewUtilities.getNamingControlInput(this.inputControls, "selectSeparator").elements.input.disabled = true;
					
			  var applyBttnPtr = that.controlDiv.getElements('.btn-primary')[0];
			  applyBttnPtr.disabled = true;
			  var tbodyreflist = that.contentDiv.getElements('.fparamtbody');
			  var imgCell = ParametersLayoutViewUtilities.getNamingDeployCellSts(tbodyreflist);//"nameDeployIndicator"
			  ParametersLayoutViewUtilities.beingModified(imgCell, ParamSkeletonNLS.ParamBeingModified, '2');
			  that.ErrorMsgPopup = ParametersLayoutViewUtilities.inputErrorCell(imgCell, DELOrderDataMgtLayoutViewNLS.PrefixValueEmptyInfo, 'red', that.ErrorMsgPopup);
			}
		}
		else {
			this._parent(inputID);
			that.checkDigits(ParametersLayoutViewUtilities.getNamingControlInput(that.inputControls, "nbDigitsInput"));
		}
	},
	
	
	checkDigits : function (result) {
		var that = this;
		var finalFormat = ParametersLayoutViewUtilities.getNamingControlInput(that.inputControls, "finalformat");
		var finalFormatValue = finalFormat.elements.content.value;
		finalFormatValue = finalFormatValue.replace("<counter>","");
		var finalFormatLength = finalFormatValue.length;

		var value = result.getValue();
		
		var regex = new RegExp('^[0-9]*$');
		if (value.test(regex) && parseInt(value) >= 6 && (finalFormatLength + parseInt(value)) <= 40 ) {
		  var applyBttnPtr = that.controlDiv.getElements('.btn-primary')[0];
		  applyBttnPtr.disabled = false;
		  var tbodyreflist = that.contentDiv.getElements('.fparamtbody');
		  var imgCell = ParametersLayoutViewUtilities.getNamingDeployCellSts(tbodyreflist);//"nameDeployIndicator"
		  ParametersLayoutViewUtilities.beingModified(imgCell, ParamSkeletonNLS.ParamBeingModified, '2');
		} else {
		  var applyBttnPtr = that.controlDiv.getElements('.btn-primary')[0];
		  applyBttnPtr.disabled = true;
		  var tbodyreflist = that.contentDiv.getElements('.fparamtbody');
		  var imgCell = ParametersLayoutViewUtilities.getNamingDeployCellSts(tbodyreflist);//"nameDeployIndicator"
		  ParametersLayoutViewUtilities.beingModified(imgCell, ParamSkeletonNLS.ParamBeingModified, '2');
		  that.ErrorMsgPopup = ParametersLayoutViewUtilities.inputErrorCell(imgCell, DELOrderDataMgtLayoutViewNLS.NbDigitsInfo, 'red', that.ErrorMsgPopup);
		}
	},
	
	selectedTypeChanged : function (iInput) {
		var that = this;
		that._parent(iInput);

		var typeSelector = ParametersLayoutViewUtilities.getNamingControlInput(this.inputControls, "iTypeSelect");
        var currSelectedOpt = typeSelector.getSelection();
		var cNamingElt = ParametersLayoutViewUtilities.getCustoNamingElement(this.custoNamingsArray, currSelectedOpt[0].value);
		
        var nbdigitsInput = ParametersLayoutViewUtilities.getNamingControlInput(this.inputControls, "nbDigitsInput");
        nbdigitsInput.setValue(cNamingElt.defnbDigits);

	//TEMP fix
	var affixInput = ParametersLayoutViewUtilities.getNamingControlInput(this.inputControls, "sitenameinput");
                affixInput.setValue("");

ParametersLayoutViewUtilities.UpdateFinalFormatOverView(cNamingElt.prefix, affixInput.getValue(), cNamingElt.suffix, currSelectedOpt[0].value,
                                                               cNamingElt.appType,
                                                                ParametersLayoutViewUtilities.getNamingControlInput(this.inputControls, "finalformat"));
	},
	
    buildNbDigitsLine : function (iFamily, ftbody) {
      var that = this;
	  
	  var typeSelector = ParametersLayoutViewUtilities.getNamingControlInput(this.inputControls, "iTypeSelect");
      var currSelectedOpt = typeSelector.getSelection();
	  var cNamingElt = ParametersLayoutViewUtilities.getCustoNamingElement(this.custoNamingsArray, currSelectedOpt[0].value);

      var lineParam = UWA.createElement('tr', {title: ''}).inject(ftbody);
      var cellLabel = UWA.createElement('td', {'width': '30%', 'title': ''}).inject(lineParam);
      UWA.createElement('p', {text: DELOrderDataMgtLayoutViewNLS.NbDigits, 'class': ''}).inject(cellLabel);
      var controlObjectCell = UWA.createElement('td', {'width': '30%', 'title': ''}).inject(lineParam);
      var nbDigitsPopOver;
      var nbDigitsArgValue = "";
      iFamily.parameter.forEach(param => {
          var args = param.argument;
          args.forEach(arg => {
            if (arg.id === "NbDigitsArg")
            {
              if (!UWA.is(arg.argValue))
                nbDigitsArgValue = arg.defaultValue;
              else
                nbDigitsArgValue = arg.argValue;
			  cNamingElt['defnbDigits'] = arg.defaultValue;
            }
          });
      });

      var nbDigitsField = new Text({
          placeholder: "...",
          attributes: {
              id : 'nbDigitsInput',
              value: nbDigitsArgValue,
              multiline: false,
              disabled: false
          },
          events: {
              onKeyDown: function (data) {
                setTimeout(function(result) {
					that.checkDigits(result);
                }, 20, this);
              },
              onChange: function (data) {
                  /*var value = this.getValue();
                  if (isNaN(value))
                    that.displayNotifications({
                      level: 'error',
                      message: "Nls.setParameters",
                      title: "Nls.setParametersTitle"
                    });*/
              }
          }
      }).inject(controlObjectCell);

      var nbDIgitsTooltipCell = UWA.createElement('td', {
          'width' : '40%',
          'title' : '',
          'id' : 'nameDeployxxxIndicator',
          align : 'left'
      }).inject(lineParam);
      var nbDigitsImgInfoSpan = UWA.createElement('span', {
          'class' : 'fonticon fonticon-info tooltipStyle'
      }).inject(nbDIgitsTooltipCell);

      nbDigitsPopOver = new Popover({
          target   : nbDigitsImgInfoSpan,
          trigger  : "hover",
          animate  : "true",
          position : 'top',
          body     : DELOrderDataMgtLayoutViewNLS.NbDigitsInfo,
          title    : ''
      });

      nbDigitsField.getContent().setStyle("width", 300);
      nbDigitsField.getContent().set("maxLength", 170);
      this.inputControls.push(nbDigitsField);
    },

    buildFamilyItemContent : function(iFamily, familyPosition) {
        var familyTable, ftbody;

        familyTable = UWA.createElement('table', {
            'class': 'table table-hover',
            'table-layout': 'fixed',
            'id': iFamily.id + 'familytable'
        });

        ftbody =  UWA.createElement('tbody', {
            'class': 'fparamtbody',
            'id': iFamily.id + 'familytbody'
        }).inject(familyTable);

        this._previewInput = new Map();
        iFamily.parameter.forEach(param => {
          var args = param.argument;
          args.forEach(arg => {
            this._previewInput.set(arg.id, arg.argValue);
          });
        });


        this.processIDFamily(iFamily, ftbody);
        this.buildNbDigitsLine(iFamily, ftbody);
        //previewText.inject(ftbody);

        return familyTable;
    },

    /*
    * buildParameterLine
    */
    buildParameterLine : function (iParamObj, familyID, familytbody, popoverPosition) {
      this._familyID = familyID.id;
      this._parent(iParamObj, familyID, familytbody, popoverPosition)
    },

    /*
    * render
    */
    render : function render()
    {
      UWA.log("DELOrderDataMgtLayoutView::render");
      var that = this;

      that._parent();

      this.controlDiv = ParametersLayoutViewUtilities.createApplyResetToolbar.call(this, this.contentDiv, true,
          this.applyParams.bind(this), this.resetParams.bind(this));

      return this;
    },

    resetParams: function () {
	this.confirmationModalShow();
    },

   resetAndDeloyParams : function () {
 	this.ResetNamingParams();
   }


  });

  return DELOrderDataMgtLayoutView;
});

/**
* @quickreview  KB9 23:05:19 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationOrderDataMgt/DELOrderDataMgtParentView',
		[
	 'UWA/Core',
	 'DS/ParameterizationSkeleton/Views/ParametersParentView',
	 'DS/ParameterizationSkeleton/Views/ParameterizationOrderDataMgt/DELOrderDataMgtLayoutView'
	 ],
	 function (
		 UWA,
		 ParametersParentView,
		 DELOrderDataMgtLayoutView
		)
{

	'use strict';


	var DELOrderDataMgtParentView = ParametersParentView.extend({

		init: function (options) {
			options = UWA.clone(options || {}, false);
			this._domainID = options.domainid;
			this._layoutView = null;
			this._parent(options);
		},

		setup: function (options) {
			UWA.log('DELOrderDataMgtParentView Layout::setup!');
			UWA.log(options);

		},

		destroy : function()
		{
			var that = this;
			that._parent();

			if (that._layoutView)
			that._layoutView.destroy();
		},


		render : function()
		{
			var that = this;
			var options = this.options;

		  //var layoutView = new DELConfigurationLayoutView(options);
			//return layoutView.render();
			that._layoutView = new DELOrderDataMgtLayoutView(options);
			return that._layoutView.render();
		}
	});

	return DELOrderDataMgtParentView;
});

/**
* @quickreview  ROW 24:08:30 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDigitalManufacturing/DigitalMfgRolesOnProcessInstanceConfigFamilyView',
  [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
    'i18n!DS/ParameterizationSkeleton/assets/nls/RolesOnProcessInstanceModalView',
    'i18n!DS/ParameterizationSkeleton/assets/nls/RolesOnProcessInstanceNodeTreeView',
    'i18n!DS/ParameterizationSkeleton/assets/nls/RolesOnProcessInstanceTreeListView'
  ],
  function (
    UWA,
    DELConfigurationFamilyView,
    NlsModalView,
    NlsNodeTreeView,
    NlsTreeListView,
  ) {

    'use strict';

    var DigitalMfgRolesOnProcessInstanceConfigFamilyView = DELConfigurationFamilyView.extend({

      _node: null,
      _bEditMode: false,

      _CONSTANTS : {

        // Column Ids 
        COLUMNIDS: {
          ROLEOOTB: 'roleootb',
          ROLECUSTO: 'rolecusto',
          ROWINDEX: 'rowIndex' // rowIndex is used internally to manage the order. This is not visile in the UI.
        }
      },

      /*
      * init
      */
      init: function init(options) {
        var that = this;
        this._parent(options);

        that._treeListViewNls = NlsTreeListView;
        that._modalViewNls = NlsModalView;
        that._nodeTreeViewNls = NlsNodeTreeView;
      },

      /*
      * buildtreeListView
      */
      buildtreeListView: function buildtreeListView() {
        var that = this;
        that._parent();
        that.treeListView.rowDragEnabledFlag = true;
        that.treeListView.cellDragEnabledFlag = true;
        that.treeListView.rowReorderEnabledFlag = true;
        that.treeListView.cellSelection = 'single';
        that.treeListView.rowSelection = 'single';
        that.treeListView.showSelectionCheckBoxesFlag = false;

        that.treeListView.onDropRowHeader = that._onDrop.bind(that);
        that.treeListView.onDropCell = that._onDrop.bind(that);
      },

      _onDrop:function  _onDrop(event, cellInfos) {
        var that = this;
        console.log("onDropRow/Cell");
        that.treeListView.onDropCellDefault.call(that.treeListView, event, cellInfos);
        
        if(that.IsTableModified()){
          that._updateParameters();
        }
      },
      
      /*
      * onOKEditButtonClick
      */
      onOKEditButtonClick: function onOKEditButtonClick() {
        var that = this;
        that._bEditMode = true;
        that._parent();
        that._bEditMode = false;
      },

      /*
      * onCancelButtonClick
      */
      onCancelButtonClick: function onCancelButtonClick() {
        var that = this;
        that._parent();
        that._bEditMode = false;
      },

        /*
        * removeSelectedNode
        */
        removeSelectedNode: function removeSelectedNode(params) {
            console.log("params " + params);
            var that = this;

            var node = params.context.nodeModel;
            var nodeData = node.getData();

            var rowModelLength = params.configurationLayoutView.treeList.dataGridView.getRowModelLength();

            if ((nodeData[that._CONSTANTS.COLUMNIDS.ROWINDEX] != undefined && nodeData[that._CONSTANTS.COLUMNIDS.ROWINDEX] != rowModelLength)) {
                var treeDoc = params.configurationLayoutView.treeList.dataGridView.treeDocument;
                if (treeDoc)
                    treeDoc.removeRoot(node);
                var bUpdateRequiredAfterDelete = true;
                that._updateParameters(bUpdateRequiredAfterDelete);
            }
            else
                that._parent(params);
        },

      /*
      * editSelectedNode
      */
      editSelectedNode: function editSelectedNode(params) {
        console.log("params " + params);
        var that = this;
        that._bEditMode = true;
        that._parent(params);
      },

      /*
      * validateModal
      */
      validateModal: function validateModal() {
        var that = this;
        console.log("validateModal");

        var treeNodeModel = that._parent();
        if (treeNodeModel != undefined) {
          var data = treeNodeModel.getData();

          var newRowModelLength = that.treeListView.getRowModelLength();
          var listCutoRolesAlreadyDefined = [];

          if (newRowModelLength) {
            for (var rowIndex = 0; rowIndex < newRowModelLength; rowIndex++) {
              var dataObject = that.getRowDataFromTreeView(rowIndex);
              listCutoRolesAlreadyDefined.push(dataObject['rolecusto']);
            }
          }

          var bShowError = false;

          var roleCustoNls = NlsTreeListView.rolecusto;
          var custoRoleValue = data['rolecusto'];
          var editNodeRoleCustom = "";
          if (that._bEditMode) {
            var nodeData = that._node.getData();
            editNodeRoleCustom = nodeData["rolecusto"];
          }
          if ((!that._bEditMode && listCutoRolesAlreadyDefined.includes(custoRoleValue)) || (that._bEditMode && editNodeRoleCustom != custoRoleValue && listCutoRolesAlreadyDefined.includes(custoRoleValue))) {
            var strErrorMessage = NlsModalView.ErrorCustoRoleAlreadyDefined;

            bShowError = true;
            strErrorMessage = strErrorMessage.replace("%1", roleCustoNls);
            strErrorMessage = strErrorMessage.replace("%2", roleCustoNls);
          }

          if (bShowError) {
            that._modalView.showToastMessage(2, strErrorMessage);
            return;
          }
        }
        return treeNodeModel;
      },

      /*
      * createtreeNode
      */
      createtreeNode: function createtreeNode(data, grid) {
        var that = this;

        if (data[that._CONSTANTS.COLUMNIDS.ROLEOOTB] && grid != undefined && grid[that._CONSTANTS.COLUMNIDS.ROLEOOTB] && data[that._CONSTANTS.COLUMNIDS.ROWINDEX] == undefined && grid[that._CONSTANTS.COLUMNIDS.ROWINDEX] == undefined) {
          var computedRowIndex = that.treeListView.getRowModelLength() + 1;
          var rowIndex = null;
          if (that._bEditMode && that._node != undefined && that._node.getData() != undefined && that._node.getData()[that._CONSTANTS.COLUMNIDS.ROWINDEX] != undefined)
            rowIndex = that._node.getData()[that._CONSTANTS.COLUMNIDS.ROWINDEX];
          else
            rowIndex = computedRowIndex.toString();
          data[that._CONSTANTS.COLUMNIDS.ROWINDEX] = rowIndex;
          grid[that._CONSTANTS.COLUMNIDS.ROWINDEX] = rowIndex;

        }

        var translationModel = that._parent(data, grid);

        return translationModel;
      },

      IsTableModified: function IsTableModified() {
        var that = this;
        var bTableModified = false;
        var numberOfRows = that.treeListView.getRowModelLength();
        for (var rowID = 0; rowID < numberOfRows; rowID++) {
          var attrColumnId = that.treeListView.layout.getColumnIndex(that._CONSTANTS.COLUMNIDS.ROLEOOTB);
          var attrCellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: rowID, columnID: attrColumnId });
          var cellInfos = that.treeListView.getCellInfosAt(attrCellId);
          var rowIndex = cellInfos.nodeModel.options.data[that._CONSTANTS.COLUMNIDS.ROWINDEX];
          if (parseInt(rowIndex) != rowID + 1) {
            bTableModified = true;
            break;
          }
        }
        return bTableModified;
      },

      getRowDataFromTreeView: function getRowDataFromTreeView(rowID) {
        var that = this;
        var dataObject = that._parent(rowID);
        var rowNumber = rowID + 1;
        dataObject[that._CONSTANTS.COLUMNIDS.ROWINDEX] = rowNumber.toString();
        return dataObject;
      },

      /*
      * addChild
      */
      addChild : function addChild(nodesTab)
      {
          var that = this;
          nodesTab.sort(function(node1, node2){
            var ruleNumber1 = node1.getData().rowIndex;
            var ruleNumber2 = node2.getData().rowIndex;
            if(ruleNumber1 && ruleNumber2) {
              return parseInt(ruleNumber1) - parseInt(ruleNumber2);
            }
            return 0;
          })
          that._parent(nodesTab);
      }

    });
    return DigitalMfgRolesOnProcessInstanceConfigFamilyView;
  });

/**
* @quickreview PCR8 25:02:28 Fixed IR-1333728 - FUN143441_User is allowed to create multiple arbitrary units with the same symbol.
* @quickreview  ROW 24:08:30 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationUnitsAndParameters/ArbitraryUnitsConfigFamilyView',
  [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
    'DS/ParameterizationSkeleton/Utils/ParameterizationUnitsAndParameters/UnitsAndParametersParameterizationDataUtils',
    'DS/ParameterizationSkeleton/Utils/ParameterizationUnitsAndParameters/UnitsAndParametersParameterizationWebServices',
    'i18n!DS/ParameterizationSkeleton/assets/nls/UnitsAndParameters'
  ],
  function (
    UWA,
    DELConfigurationFamilyView,
    UnitsAndParametersParameterizationDataUtils,
    UnitsAndParametersParameterizationWebServices,
    Nls
  ) {

    'use strict';

    var ArbitraryUnitsConfigFamilyView = DELConfigurationFamilyView.extend({

      _node: null,
      _bEditMode: false,

      /*
      * init
      */
      init: function init(options) {
        var that = this;
        this._parent(options);

        that._treeListViewNls = Nls;
        that._modalViewNls = Nls;
        that._nodeTreeViewNls = Nls;
      },


      getColumnIDForNLS :function getColumnIDForNLS(){
        var that = this;
        return "arbitraryUnitSymbol";

      },
      /*
      * onOKEditButtonClick
      */
      onOKEditButtonClick: function onOKEditButtonClick() {
        var that = this;
        that._bEditMode = true;
        that._parent();
        that._bEditMode = false;
      },

      /*
      * onCancelButtonClick
      */
      onCancelButtonClick: function onCancelButtonClick() {
        var that = this;
        that._parent();
        that._bEditMode = false;
      },

      /*
      * editSelectedNode
      */
      editSelectedNode: function editSelectedNode(params) {
        console.log("params " + params);
        var that = this;
        that._bEditMode = true;
        that._parent(params);
      },

      buildtreeListView : function buildtreeListView(){
        var that = this;
        that._parent();
        UnitsAndParametersParameterizationDataUtils.SetArbitraryUnitsTreeListView(that.treeListView);
      },

      /*
       * buildModal
       */
      buildModal: function buildModal(bEditMod) {
        var that = this;
        that._modalViewNls.modalTitle = that._modalViewNls.Title_ArbitraryUnits_modal;
        that._modalViewNls.Info = that._modalViewNls.Info_ArbitraryUnits_modal;

        //var languageSequence = Object.keys(that._languageValues);



        this._parent(bEditMod);

        //var uriEditor = document.getElementById("URI");
        //uriEditor.dsModel.value = that.createUUID();


      },
          /*
    * createtreeNode
    */
    createtreeNode : function createtreeNode(data, grid)
    {
      var that = this;
      // Adding URI as an attribute
      if (data["arbitraryUnitName"] && grid != undefined && grid["arbitraryUnitName"] && data["URI"] == undefined && grid["URI"] == undefined) {
        var uniqueID = null;
        if (that._bEditMode)
          uniqueID = that._node.getData().URI;
        else
          uniqueID = that.createUUID();
        data["URI"] = uniqueID;
        grid["URI"] = uniqueID;
      }
      
      return that._parent(data,grid);
    },

     /*
    * validateModal
    */
     validateModal : function validateModal()
     {
       var that = this;
       console.log("validateModal");
 
       var treeNodeModel = that._parent();
       if (treeNodeModel != undefined) {
         var data = treeNodeModel.getData();
 
         var rowModelLength = that.treeListView.getRowModelLength();
         var listAUNamesAlreadyDefined = [];
        //  Creation of array to store already defined Symbols for units to address IR-1333728
        // i.e, to prevent user to create multiple arbitrary units with the same symbol.
         var listAUUnitsAlreadyDefined = [];
 
         if (rowModelLength) {
           for (var rowIndex = 0; rowIndex < rowModelLength; rowIndex++) {
             var dataObject = that.getRowDataFromTreeView(rowIndex);
             listAUNamesAlreadyDefined.push(dataObject['arbitraryUnitName']);
             listAUUnitsAlreadyDefined.push(dataObject['arbitraryUnitSymbol']);
           }
         }
 
         var editNodeName = "";
         var editNodeSymbol = "";
         if (that._bEditMode) {
           var nodeData = that._node.getData();
           editNodeName = nodeData["arbitraryUnitName"];
           editNodeSymbol = nodeData["arbitraryUnitSymbol"];
         }
         var strErrorMessage = "";
 
         var nameValue = data['arbitraryUnitName'];
         var arbitraryUnit = data['arbitraryUnitSymbol']
         var nameNls = Nls.arbitraryUnitName;
         var unitNls = Nls.arbitraryUnitSymbol

 
         if ((!that._bEditMode && listAUNamesAlreadyDefined.includes(nameValue)) || (that._bEditMode && editNodeName != nameValue && listAUNamesAlreadyDefined.includes(nameValue))) {
           var strErrorMessage = Nls.ErrorMsgAlreadyUsed;
           strErrorMessage = strErrorMessage.replaceAll("%1", nameNls);
           that._modalView.showToastMessage(2, strErrorMessage);
           return;
         }
         if ((!that._bEditMode && listAUUnitsAlreadyDefined.includes(arbitraryUnit)) || (that._bEditMode && editNodeSymbol != arbitraryUnit && listAUUnitsAlreadyDefined.includes(arbitraryUnit))) {
           var strErrorMessage = Nls.ErrorMsgAlreadyUsed;
           strErrorMessage = strErrorMessage.replaceAll("%1", unitNls);
           that._modalView.showToastMessage(2, strErrorMessage);
           return;
         }
       }
       return treeNodeModel;
     },

    /*
    * removeSelectedNode
    */
    removeSelectedNode : function removeSelectedNode(params)
    {
      var that = this;
      var node = params.context.nodeModel;
      var nodeData = node.getData();
      var selectedUnitURI = nodeData["URI"];
      var listParameters = null;
      var promise = new UWA.Promise(function (resolve, reject) {
        UnitsAndParametersParameterizationWebServices.getlistofParameters({
          onSuccess: function (data) {
            listParameters = data.results;
            resolve();
          }
        });
      });
      UWA.Promise.all([promise]).then(function () {
        if(listParameters != null && listParameters != undefined && listParameters.length){
          var nbParameters = listParameters.length;

          for(var idxParam =0; idxParam < nbParameters; idxParam++){
            var param = listParameters[idxParam];
            if(param.dimension === "ArbitraryUnit" && param.unit.includes(selectedUnitURI)){
              that.displayNotifications({
                level: 'error',
                message: Nls.deleteParameterError,
                title: Nls.deleteParameterTitle
              });
              return;
            }
          }
        }
        DELConfigurationFamilyView.prototype.removeSelectedNode.call(that, params);
        //that._parent(params);
      });
      

    },

      createUUID: function createUUID() {
        var dt = new Date().getTime();
        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
            var r = (dt + Math.random() * 16) % 16 | 0;
            dt = Math.floor(dt / 16);
            return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);
        });
        return uuid;
    }
    });
    return ArbitraryUnitsConfigFamilyView;
  });

/**
* @quickreview  ROW 24:02:02 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDigitalManufacturing/DigitalMfgChangeOverOperationMgmtAttributesConfigFamilyView',
  [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
    'DS/ParameterizationSkeleton/Model/DELConfigurationParameterizationModel/DELConfigurationParamTranslationModel',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDELUserExperience/ParameterizationDELUserExperienceWebServices',
    'DS/ParameterizationSkeleton/Utils/DELConfigurationParameterization/DELConfigurationParameterizationWebServices',
    'DS/UIKIT/Mask',
    'i18n!DS/ParameterizationSkeleton/assets/nls/ChangeOverOperationAttributes'
  ],
  function (
    UWA,
    DELConfigurationFamilyView,
    DELConfigurationParamTranslationModel,
    ParameterizationDELUserExperienceWebServices,
    DELConfigurationParameterizationWebServices,
    Mask,
    Nls
  ) {

    'use strict';

    var DigitalMfgChangeOverOperationMgmtAttributesConfigFamilyView = DELConfigurationFamilyView.extend({

      _attributesResult: null,
      _node: null,
      _bEditMode: false,
      _OOTBExtensions : ["DELDistributionTimeExt", 
                          "V6DataExchangeExtension",
                          "DELLmiQtyToBeProducedPerTime_Area",
                          "DELLmiQtyToBeProducedPerTime_Length",
                          "DELLmiAdditionalTime",
                          "DELLmiQtyToBeProducedPerTime_Weight",
                          "DELLmiQtyToBeProducedPerTime_Each",
                          "PLM_HasDegreeOfFreedom",
                          "DELLmiQtyToBeProducedPerTime_Volume",
                          "SharedDatesInformation"],

      _OOTBAttributes : [/* "DELLmiOperationReference.V_IsTimeProportionalToQty", */
                          //"DELLmiQtyToBeProducedPerTime_Area.V_QuantityToBeProducedPerTime",
                          //"DELLmiQtyToBeProducedPerTime_Weight.V_QuantityToBeProducedPerTime",
                          //"DELLmiQtyToBeProducedPerTime_Volume.V_QuantityToBeProducedPerTime",
                          //"DELLmiQtyToBeProducedPerTime_Length.V_QuantityToBeProducedPerTime",
                          //"DELLmiQtyToBeProducedPerTime_Each.V_QuantityToBeProducedPerTime",
                          //"DELLmiAdditionalTime.V_PreparationTime",
                          //"DELLmiAdditionalTime.V_TimeOutMachineAfter",
                          //"DELLmiAdditionalTime.V_TimeOutMachineBefore",
                          "PLMEntity.V_description",
                          //"DELLmiOperationReference.V_EstimatedTime",
                          "PLMEntity.V_Name",
                          //"DELLmiOperationPPRReference.V_Execution_template_name",
                          //"DELLmiOperationReference.V_EstimatedTime_AddedValueRatio",
                          /* "DELLmiHeaderOperationReference.V_ManageVariant", */
                          /* "DELLmiHeaderOperationReference.V_Interruptible" */],
                          
      _CONSTANTS : {

        ATTRIBUTES_RESULTID : {
          ATTRIBUTES: 'attributes'
        }
      },
  
      _ListOfTypes : {
        operation : ['DELLmiHeaderOperationReference']
      },

      /*
      * init
      */
      init: function init(options) {
        var that = this;
        this._parent(options);

        that._treeListViewNls = Nls;
        that._modalViewNls = Nls;
        that._nodeTreeViewNls = Nls;
      },

      /*
      * render
      */
      render: function render() {
        var that = this;
        this._parent();

        return this;
      },

      /*
       * getPromisetoGetInfofromDB
      */
      getPromisetoGetInfofromDB: function getPromisetoGetInfofromDB() {
        var that = this;
        var promise = new UWA.Promise(function (resolve, reject) {

          var tobecalledGetInfofromDB = false;
          var typekeys = Object.keys(that._ListOfTypes);
          for (let iType of typekeys) {
            if (that._attributesResult == null || that._attributesResult == undefined || that._attributesResult[iType] == undefined || that._attributesResult[iType] == null
              || that._attributesResult[iType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES] === undefined || that._attributesResult[iType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES] === null) {
              tobecalledGetInfofromDB = true;
              break;
            }
          }

          if (true === tobecalledGetInfofromDB) {
            if (that._attributesResult == null || that._attributesResult == undefined)
              that._attributesResult = [];

            var listOfTypes = Object.values(that._ListOfTypes).flat();
            ParameterizationDELUserExperienceWebServices.getlistofAllAttributes(listOfTypes, {
              onSuccess: function (data) {
                that._readResponseAndPopulateData(data);
                resolve();
              }
            });
          }
          else
            resolve()
        });
        return promise;
      },
      /*
      * Function to read response from getAttributes web service and create local lists for attributes and types 
      */
      _readResponseAndPopulateData: function _readResponseAndPopulateData(data) {
        var that = this;
        if (that._attributesResult === null)
          that._attributesResult = [];

        var typekeys = Object.keys(data);
        typekeys.forEach(iType => {

          var dataType = null;
          for (const key in that._ListOfTypes) {
              if (that._ListOfTypes[key].includes(iType)) {
                dataType = key;
                break;
              }
          }
          
          if (that._attributesResult[dataType] === undefined)
            that._attributesResult[dataType] = {};
          
          var dicotypekeys = Object.keys(data[iType]);
          dicotypekeys.forEach(dicoType => {
            var attrKeys = Object.keys(data[iType][dicoType]);
            attrKeys.forEach(attrKey => {

              if (that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES] === undefined)
                that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES] = {};

              var attrObj = data[iType][dicoType][attrKey];

              // 	NSY5 - Fixed IR-1351086 - Parameters Console - Process Flow Diagram - Colors - Some item types are missing
              if (attrKey !== "DicoType") {
                if (attrObj.Owner != dicoType) {
                  if (that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][attrObj.Owner] === undefined)
                    that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][attrObj.Owner] = {};
  
                  that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][attrObj.Owner][attrKey] = attrObj;
                }
                else {
                  if (that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType] === undefined)
                    that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType] = {};
  
                  that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType][attrKey] = attrObj;
                }
              }
            });
          });
        });
      },
      /*
      * buildFamilyContent
      */
      buildFamilyContent: function buildFamilyContent() {

        var that = this;
        that._nodeTreeViewNls.treeViewTitle = that._nodeTreeViewNls.attributesTableName;

        var content = this._parent();

        var attributeNameColOpt = that.treeListView.getColumnOrGroup("attributeName");
        attributeNameColOpt.compareFunction = function (value1, value2, treeNodeModel1, treeNodeModel2, dataIndex) {
          return ((value1.toLowerCase()).localeCompare(value2.toLowerCase()));
        }
        return content;
      },
      /*
      * buildModal
      */
      buildModal: function buildModal(bEditMod) {
        var that = this;
        
        this._parent(bEditMod);
        var comboAttributes = document.getElementById("attributeName");
        
        if (bEditMod){
          comboAttributes.type = "combobox";
          comboAttributes.dsModel.multiSelFlag = false;
          comboAttributes.dsModel.enableSearchFlag = true;
        }
        else {
          comboAttributes.type = "multiselcombobox";
          comboAttributes.dsModel.multiSelFlag = true;
          comboAttributes.dsModel.enableSearchFlag = false;
        }
        that._updateAttributesCombo(bEditMod);
      },

      /*
      * presetModal
      */
      presetModal: function presetModal(node) {
        console.log("presetModal");
        var that = this;
        that._node = node;
        that._updateAttributesCombo(true);
        DELConfigurationFamilyView.prototype.presetModal.call(that, node);
      },

      /*
       * _updateAttributesCombo
       */
      _updateAttributesCombo: function _updateAttributesCombo(bEditMod) {
        var that = this;

        var comboAttributeKeys = document.getElementById("attributeName");
        comboAttributeKeys.dsModel.disabled = true;
        comboAttributeKeys.dsModel.elementsList = [];
        comboAttributeKeys.dsModel.selectedIndex = -1;
        var typekeys = Object.keys(that._ListOfTypes);
        typekeys.forEach(iType => {
          if (that._attributesResult != null || that._attributesResult[iType] != undefined || that._attributesResult[iType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES] != undefined) {
            var data = that._attributesResult[iType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES];
  
            var listForCombo = that._getListOfElementsForAttributesCombo(data, bEditMod)
            var comboElementsListLength = listForCombo.length;
            if (comboElementsListLength > 0) {
              comboAttributeKeys.dsModel.disabled = false;
              comboAttributeKeys.dsModel.elementsList = listForCombo;
              comboAttributeKeys.dsModel.selectedIndex = -1;
            }
          }
        });
      },

      _getListOfElementsForAttributesCombo: function _getListOfElementsForAttributesCombo(data, bEditMod) {
        var that = this;
        var listForCombo = [];
        var attributesList = [];
        var listAttributesAlredyDefined = that._getListOfAttributesAlreadyDefined();
        var typekeys = Object.keys(data);
        var typekeysLength = typekeys.length;
        for (var i = 0; i < typekeysLength; i++) {
          var typekey = typekeys[i];
          if (typekey && data[typekey]) {
            var typeObj = data[typekey];
            var attributekeys = Object.keys(typeObj);

            var attributekeysLength = attributekeys.length;
            for (var idxAttr = 0; idxAttr < attributekeysLength; idxAttr++) {
              var attributekey = attributekeys[idxAttr];
              var attrObj = typeObj[attributekey];
              var attr = attrObj.Owner + '.' + attributekey;

              if ((!attributesList.includes(attr) && !listAttributesAlredyDefined.includes(attr)) || (bEditMod && that._node != null && that._node.getData().attributeName == attr)) {
                attributesList.push(attr);
                var comboLabel = attrObj.NLSName + ' (' + attrObj.Owner + '.' + attributekey + ')';
                var comboValue = attrObj.Owner + '.' + attributekey;
                if ((JSON.parse(attrObj.IsExtension) && !that._OOTBExtensions.includes(attrObj.Owner) && (attrObj.Type == "String" || attrObj.Type == "Double" || attrObj.Type == "Integer")) || that._OOTBAttributes.includes(comboValue))
                  listForCombo.push({ label: comboLabel, value: comboValue });
              }
            }
            if (listForCombo.length) {
              listForCombo.sort(function (comboValue1, comboValue2) {
                if (comboValue1.label.toLowerCase() === comboValue2.label.toLowerCase())
                  return 0;
                return comboValue1.label.toLowerCase() > comboValue2.label.toLowerCase() ? 1 : -1;
              });
            }
          }
        }
        return listForCombo;
      },


      _getListOfAttributesAlreadyDefined: function _getListOfAttributesAlreadyDefined() {
        var that = this;
        var listDefinedAttributes = [];
        var treeDoc = that.treeList.dataGridView.treeDocument;
        if (treeDoc) {
          var children = treeDoc.getChildren();
          var childrenLength = children.length;
          for (var idxChild = 0; idxChild < childrenLength; idxChild++) {

            var child = children[idxChild];
            if (child && child.options != undefined &&  child.options != null && child.options.data != undefined &&  
              child.options.data != null && child.options.data.attributeName != undefined && child.options.data.attributeName != "") {
                listDefinedAttributes.push(child.options.data.attributeName);
            }
          }
        }
        return listDefinedAttributes;
      },
      /*
      * validateModal
      */
      validateModal: function validateModal() {
        var that = this;
        console.log("validateModal");
        var treeNodesList = [];

        var uiElementsIDLength = that._uiElementsIDs.length;
        var uiElementsID = that._uiElementsIDs;
        if (uiElementsIDLength >= 1 && that._uiElementsIDs[0].id === "attributeName" && that._uiElementsIDs[0].type === "multiselcombobox") {
          var uiAttributeEl = document.getElementById(that._uiElementsIDs[0].id);
          if (uiAttributeEl && uiAttributeEl.dsModel.label != undefined && uiAttributeEl.dsModel.label != null && uiAttributeEl.dsModel.label != "") {

            var attributeNameElementData = uiAttributeEl.dsModel.value;
            var attributeNameElementLabels = uiAttributeEl.dsModel.label.split(", ");
            if(that._bEditMode){
              attributeNameElementData= [uiAttributeEl.dsModel.value];
            }
            var attributeNameElementDataLength = attributeNameElementData.length;
            
            for (var idxType = 0; idxType < attributeNameElementDataLength; idxType++) {

              var data = new Map();
              var grid = new Map();

              data.set(uiAttributeEl.id, attributeNameElementData[idxType]);
              grid.set(uiAttributeEl.id, attributeNameElementLabels[idxType]);

              var objData = {};
              var objGrid = {};
              data.forEach(function (value, key) {
                ;
                if (value != "" && value != undefined)
                  objData[key] = value;
              });

              grid.forEach(function (value, key) {
                objGrid[key] = value;
              });

              var treeNodeModel = that.createtreeNode(objData, objGrid);
              treeNodesList.push(treeNodeModel);
            }
          } else {
            var mandatoryCol = that._treeListViewNls[that._uiElementsIDs[0].id];
            var nlsErrorMsg = Nls.columnMandatory;
            nlsErrorMsg = nlsErrorMsg.replace("%1", mandatoryCol);
            that._modalView.showToastMessage(2, nlsErrorMsg);
            return;
          }
        }
        if (treeNodesList.length === 1 && that._bEditMode)
          return treeNodesList[0];
        else
          return treeNodesList;
      },

      /*
       * createtreeNode
       */
      createtreeNode: function createtreeNode(data, grid) {
        var that = this;

        var translationModel = new DELConfigurationParamTranslationModel({
          data: data,
          grid: grid,
          nls: Nls
        });

        if (grid == undefined) {

          var gridTemp = translationModel.getGrid();
          if (that._attributesResult != null && that._attributesResult != undefined && gridTemp != undefined && gridTemp.hasOwnProperty("attributeName") &&
            data["attributeName"] != undefined && data["attributeName"].includes('.')) {
            var storedAttribute = data["attributeName"];
            var dicoType = ((storedAttribute).split("."))[0];
            var attribute = ((storedAttribute).split("."))[1];
            var dataType = Object.keys(that._attributesResult)[0];   // Right now, we only have one type, so we consider the first key as the only type.
            if (that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType] != undefined && that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType][attribute] != undefined) {
              var attrObj = that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType][attribute];
              var displayLabel = attrObj.NLSName + ' (' + attrObj.Owner + '.' + attribute + ')';
              gridTemp["attributeName"] = displayLabel;
            }
          }
        }

        return translationModel;
      },

      /*
      * onOKButtonClick
      */
      onOKButtonClick: function onOKButtonClick() {
        var that = this;
        var treeListNodes = that.validateModal(false);
        var nbNodesTobeAdded = treeListNodes.length;
        var promisesSetParams = [];
        Mask.mask(that.treeListView.elements.body);
        for (var idxNode = 0; idxNode < nbNodesTobeAdded; idxNode++) {
          var promiseSetParams = new Promise(function (resolve, reject) {
            var treeListNode = treeListNodes[idxNode];
            if (treeListNode) {
              var dataObject = treeListNode.getData();
              DELConfigurationParameterizationWebServices.setParameters(that._domainID, that._familyID, that._paramID, that._argID, dataObject, {
                onSuccess: function (data) {
                  resolve(dataObject);
                },
                onFailure: function (error) {
                  reject("DELConfigurationParameterizationWebServices.setParameters");
                  console.error("DELConfigurationParameterizationWebServices.setParameters");
                }
              });
            }
          });
          promisesSetParams.push(promiseSetParams);
        }

        UWA.Promise.all(promisesSetParams).then(function (typesSetParams) {
          // Check Deployment and update Tree
          var promisesIsDeployed = [];
          for (var idxNode = 0; idxNode < nbNodesTobeAdded; idxNode++) {

            var promiseIsDeployed = new Promise(function (resolve, reject) {
              var treeListNode = treeListNodes[idxNode];
              if (treeListNode) {
                var dataObject = treeListNode.getData();
                DELConfigurationParameterizationWebServices.isDeployed(that._domainID, that._familyID, that._paramID, that._argID, dataObject, {
                  onSuccess: function (data) {
                    resolve({ treeNode: treeListNode, isDeployed: data });
                  },
                  onFailure: function (error) {
                    reject("DELConfigurationParameterizationWebServices.isDeployed");
                    console.error("DELConfigurationParameterizationWebServices.isDeployed");
                  }
                });
              }
            });
            promisesIsDeployed.push(promiseIsDeployed);
          }
          UWA.Promise.all(promisesIsDeployed).then(function (resultIsDeployed) {

            var listOfnodeTree = [];
            var lengthIsDeployed = resultIsDeployed.length;
            for (var idxDeployed = 0; idxDeployed < lengthIsDeployed; idxDeployed++) {

              var treeListNode = resultIsDeployed[idxDeployed].treeNode;
              if (treeListNode) {
                treeListNode.addGridAttributes({ isDeployed: resultIsDeployed[idxDeployed].isDeployed });
                listOfnodeTree.push(treeListNode);
              }
            }
            that.addChild(listOfnodeTree);

            that.displayNotifications({
              level: 'info',
              message: Nls.setParameters,
              title: Nls.setParametersTitle
            });
            Mask.unmask(that.treeListView.elements.body);
          }).catch(function (rejectMessages) {
            that.displayNotifications({
              level: 'error',
              message: Nls.setParametersError,
              title: Nls.setParametersTitle
            });
            console.error(rejectMessages);
            Mask.unmask(that.treeListView.elements.body);
          });
        }).catch(function (rejectMessages) {

          that.displayNotifications({
            level: 'error',
            message: Nls.setParametersError,
            title: Nls.setParametersTitle
          });
          console.error(rejectMessages);
          Mask.unmask(that.treeListView.elements.body);
        });

      },

    /*
    * addChild
    */
    addChild : function addChild(nodesTab)
    {
        var that = this;
        that._parent(nodesTab);
        that.treeListView.sortModel = [{ dataIndex: "attributeName", sort: 'asc' }];
        that.treeListView.reapplySortModel();
    },

      /*
      * onOKEditButtonClick
      */
      onOKEditButtonClick: function onOKEditButtonClick() {
        var that = this;
        that._bEditMode = true;
        that._parent();
        that._bEditMode = false;
      }

    });
    return DigitalMfgChangeOverOperationMgmtAttributesConfigFamilyView;
  });

/**
* @quickreview NSY5 24:10:11 FUN153829 - Parameters Console - Customization for Linked objects in Process Flow Diagram
* @quickreview  ROW 24:02:02 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDELUserExperience/DELProcessFlowDiagramColorConfigFamilyView',
    [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/ParameterizationDELUserExperience/DELProcessFlowDiagramBaseFamilyView',
    'DS/ParameterizationSkeleton/Utils/DELConfigurationParameterization/DELConfigurationParameterizationWebServices',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDELUserExperience/ParameterizationDELUserExperienceWebServices',
    'DS/Controls/ModalContainer',
    'DS/Controls/Loader',
    'DS/UIKIT/Mask',
    'DS/Controls/LineEditor',
    'DS/Controls/ComboBox',
    'DS/Controls/ColorPicker',
    'DS/ParameterizationSkeleton/Model/DELConfigurationParameterizationModel/DELConfigurationParamTranslationModel',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DELUserExperienceConfiguration'
    ],
    function (
      UWA,
      DELProcessFlowDiagramBaseFamilyView,
      DELConfigurationParameterizationWebServices,
      ParameterizationDELUserExperienceWebServices,
      WUXModalContainer,
      WUXLoader,
      Mask,
      WUXEditor,
      WUXComboBox,
      WUXColorPicker,
      DELConfigurationParamTranslationModel,
      Nls
    )
  {

  'use strict';

  var DELProcessFlowDiagramColorConfigFamilyView = DELProcessFlowDiagramBaseFamilyView.extend({

    _attributesResult : null,
    _node : null,
    _bEditMode : false, 

    /*
    * init
    */
    init : function init(options)
    {
      var that = this;
      this._parent(options);

      that._treeListViewNls = Nls;
      that._modalViewNls = Nls;
      that._nodeTreeViewNls = Nls;
      that._needTitleForTreeListView = true;

    },

    /*
    * render
    */
    render : function render()
    {
      var that = this;
      this._parent();

      return this;
    },


    /*
    * buildFamilyContent
    */
    buildFamilyContent: function buildFamilyContent() {

      var that = this;
      that._nodeTreeViewNls.treeViewTitle = that._nodeTreeViewNls.colorTableName;
      
      var content = this._parent();

      var colorColumnOpt = that.treeListView.getColumnOrGroup(that._CONSTANTS.COLOR_COLUMNIDS.COLOR);
      colorColumnOpt.typeRepresentation = "color";
      colorColumnOpt.width = '100';
      colorColumnOpt.alignment = 'center';
      var conditionColumnOpt = that.treeListView.getColumnOrGroup(that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTECONDITION);
      conditionColumnOpt.width = '100';
      conditionColumnOpt.alignment = 'center';

      var typesColOpt = that.treeListView.getColumnOrGroup(that._CONSTANTS.COLOR_COLUMNIDS.TYPE);
        typesColOpt.compareFunction = function (value1, value2, treeNodeModel1, treeNodeModel2, dataIndex) {
          return ((that._CONSTANTS.TYPES[value1.toUpperCase()] - that._CONSTANTS.TYPES[value2.toUpperCase()]) || (parseInt(treeNodeModel1.options.data[that._CONSTANTS.COLOR_COLUMNIDS.RULENUMBER]) - parseInt(treeNodeModel2.options.data[that._CONSTANTS.COLOR_COLUMNIDS.RULENUMBER])));
        }

      return content; 
    },

    /*
       * buildtreeListView
       */
    buildtreeListView: function buildtreeListView() {
      var that = this;
      that._parent();
      that.treeListView.rowDragEnabledFlag = true;
      that.treeListView.cellDragEnabledFlag = true;
      that.treeListView.rowReorderEnabledFlag = true;
      that.treeListView.cellSelection = 'single';
      that.treeListView.rowSelection = 'single';
      that.treeListView.showSelectionCheckBoxesFlag = false;

      that.treeListView.onDragOverCell = that._onDrag.bind(that);
      that.treeListView.onDragEnterCell = that._onDrag.bind(that);
      that.treeListView.onDragLeaveCell = that._onDrag.bind(that);
      that.treeListView.onDragOverRowHeader = that._onDrag.bind(that);
      that.treeListView.onDragEnterRowHeader = that._onDrag.bind(that);
      that.treeListView.onDragLeaveRowHeader = that._onDrag.bind(that);
    },

    /*
       * _onDrag
       */
    _onDrag: function _onDrag(event, cellInfos) {
      var that = this;
      console.log("onDragRow/Cell");
      // Allow DnD only between the rows of same type.
      if (cellInfos != undefined && cellInfos.nodeModel != undefined && cellInfos.nodeModel.getData() != undefined && cellInfos.nodeModel.getData()[that._CONSTANTS.COLOR_COLUMNIDS.TYPE] &&
        cellInfos.draggedNodes[0] != undefined && cellInfos.draggedNodes[0].getData() != undefined && cellInfos.draggedNodes[0].getData()[that._CONSTANTS.COLOR_COLUMNIDS.TYPE] != undefined &&
        cellInfos.nodeModel.getData()[that._CONSTANTS.COLOR_COLUMNIDS.TYPE] == cellInfos.draggedNodes[0].getData()[that._CONSTANTS.COLOR_COLUMNIDS.TYPE]) {

        return true;
      }
    },

    /*
      * _onDrop
      */
    _onDrop: function _onDrop(event, cellInfos) {
      var that = this;
      console.log("onDropRow/Cell");
      if (cellInfos != undefined && cellInfos.nodeModel != undefined && cellInfos.nodeModel.getData() != undefined && cellInfos.nodeModel.getData()[that._CONSTANTS.COLOR_COLUMNIDS.TYPE] &&
        cellInfos.droppedNodes[0] != undefined && cellInfos.droppedNodes[0].getData() != undefined && cellInfos.droppedNodes[0].getData()[that._CONSTANTS.COLOR_COLUMNIDS.TYPE] != undefined &&
        cellInfos.nodeModel.getData()[that._CONSTANTS.COLOR_COLUMNIDS.TYPE] == cellInfos.droppedNodes[0].getData()[that._CONSTANTS.COLOR_COLUMNIDS.TYPE]) {
          
          var type = cellInfos.nodeModel.getData()[that._CONSTANTS.COLOR_COLUMNIDS.TYPE];

          var rowsDataBeforeReorder =  that.getRowsDataForType(type);
          that.treeListView.onDropCellDefault.call(that.treeListView, event, cellInfos);
          var rowsDataAfterReorder =  that.getRowsDataForType(type);

          if(that.IsTableModifiedForType(type)){
            that._UpdateParameters(type,rowsDataBeforeReorder,rowsDataAfterReorder);
          }
      }
    },

    /*
      * _UpdateParameters
      */
    _UpdateParameters: function _UpdateParameters(type, rowsDataBeforeReorder,rowsDataAfterReorder, bUpdateForDelete){
      var that = this;
      // Delete Existing Parameters of this type
      var promisesDeleteParams = that._getDeleteParameterPromises(rowsDataBeforeReorder);
      Mask.mask(that.treeListView.elements.body,Nls.orderParametersMaskMessage);
      UWA.Promise.all(promisesDeleteParams).then(function (dataDeleteParams) {
        // Create Parameters for new order of this type
        var promisesSetParams = that._getSetParamsPromises(rowsDataAfterReorder);
        UWA.Promise.all(promisesSetParams).then(function (dataSetParams) {
          // Check for new parameters deployment and update the tree
          var promisesIsDeployed = that._getIsDeployedPromises(rowsDataAfterReorder);
          UWA.Promise.all(promisesIsDeployed).then(function (resultIsDeployed) {
            var listOfnodeTree = [];
            var lengthIsDeployed = resultIsDeployed.length;
            if (rowsDataAfterReorder.length === lengthIsDeployed) {
              for (var idxDeployed = 0; idxDeployed < lengthIsDeployed; idxDeployed++) {
                var treeNode = that.createtreeNode(resultIsDeployed[idxDeployed].treeNodeData);
                if (treeNode) {
                  treeNode.addGridAttributes({ isDeployed: resultIsDeployed[idxDeployed].isDeployed });
                  listOfnodeTree.push(treeNode);
                }
              }
              that.removeNodesOfType(type);
              that.addChild(listOfnodeTree);
            }

            that.displayNotifications({
              level: 'info',
              message: Nls.orderParameters,
              title: Nls.orderParametersTitle
            });
            Mask.unmask(that.treeListView.elements.body);
          }).catch(function (rejectMessages) {
            that.displayNotifications({
              level: 'error',
              message: Nls.orderParametersError,
              title: Nls.orderParametersTitle
            });
            console.error(rejectMessages);
            Mask.unmask(that.treeListView.elements.body);
          });

        }).catch(function (errorMessage) {

          that.displayNotifications({
            level: 'error',
            message: Nls.orderParametersSetError,
            title: Nls.orderParametersTitle
          });
          console.error(errorMessage);
          Mask.unmask(that.treeListView.elements.body);
        });

        if (bUpdateForDelete) {
          that.displayNotifications({
            level: 'info',
            message: Nls.deleteParameter,
            title: Nls.deleteParameterTitle
          });
        }

      }).catch(function(errorMessage){
        that.displayNotifications({
          level: 'error',
          message: Nls.orderParametersDeleteError,
          title: Nls.orderParametersTitle
        });
        console.error(errorMessage);
        Mask.unmask(that.treeListView.elements.body);
      });

    },
    
    /*
      * _getDeleteParameterPromises
      */
    _getDeleteParameterPromises: function _getDeleteParameterPromises(dataObjectsToDelete) {
      var that = this;
      var promisesDeleteParams = [];
      for (var idxRow = 0; idxRow < dataObjectsToDelete.length; idxRow++) {
        var rowNumber = idxRow + 1;
        dataObjectsToDelete[idxRow][that._CONSTANTS.COLOR_COLUMNIDS.RULENUMBER] = rowNumber.toString();
        var promiseDeleteParams = new Promise(function (resolve, reject) {
          var dataObject = dataObjectsToDelete[idxRow];
          DELConfigurationParameterizationWebServices.deleteParameter(that._domainID, that._familyID, that._paramID, that._argID, dataObject, {
            onSuccess: function (data) {
              resolve(dataObject);
            },
            onFailure: function (error) {
              reject("DELConfigurationParameterizationWebServices.deleteParameter");
              console.error("DELConfigurationParameterizationWebServices.deleteParameter");
            }
          });
        });
        promisesDeleteParams.push(promiseDeleteParams);
      }
      return promisesDeleteParams;
    },

    /*
      * _getSetParamsPromises
      */
    _getSetParamsPromises:function _getSetParamsPromises(dataObjectsToSetParams){
      var that = this
      var promisesSetParams = [];
      for (var idxRow = 0; idxRow < dataObjectsToSetParams.length; idxRow++) {
        var rowNumber = idxRow + 1;
        dataObjectsToSetParams[idxRow][that._CONSTANTS.COLOR_COLUMNIDS.RULENUMBER] = rowNumber.toString();
        var promiseSetParams = new Promise(function (resolve, reject) {
          var dataObject = dataObjectsToSetParams[idxRow];
          DELConfigurationParameterizationWebServices.setParameters(that._domainID, that._familyID, that._paramID, that._argID, dataObject, {
            onSuccess: function (data) {
              resolve(dataObject);
            },
            onFailure: function (error) {
              reject("DELConfigurationParameterizationWebServices.setParameters");
              console.error("DELConfigurationParameterizationWebServices.setParameters");
            }
          });
        });
        promisesSetParams.push(promiseSetParams);
      }
      return promisesSetParams;
    },

    /*
      * _getIsDeployedPromises
      */
    _getIsDeployedPromises:function _getIsDeployedPromises(dataObjectsToCheckIsDeployed){
      var that = this;
      var promisesIsDeployed = [];
      for (var idxRow = 0; idxRow < dataObjectsToCheckIsDeployed.length; idxRow++) {
        var rowNumber = idxRow + 1;
        dataObjectsToCheckIsDeployed[idxRow][that._CONSTANTS.COLOR_COLUMNIDS.RULENUMBER] = rowNumber.toString();
        var promiseIsDeployed = new Promise(function (resolve, reject) {
          var dataObject = dataObjectsToCheckIsDeployed[idxRow];
          if (dataObject) {
            DELConfigurationParameterizationWebServices.isDeployed(that._domainID, that._familyID, that._paramID, that._argID, dataObject, {
              onSuccess: function (data) {
                resolve({ treeNodeData: dataObject, isDeployed: data });
              },
              onFailure: function (error) {
                reject("DELConfigurationParameterizationWebServices.isDeployed");
                console.error("DELConfigurationParameterizationWebServices.isDeployed");
              }
            });
          }
        });
        promisesIsDeployed.push(promiseIsDeployed);
      }
      return promisesIsDeployed;
    },

    /*
      * getRowsDataForType
      */
    getRowsDataForType : function getRowsDataForType(type){
      var that = this;
      var dataObjects = [];
      var colId = that.treeListView.layout.getColumnIndex(that._CONSTANTS.COLOR_COLUMNIDS.TYPE);
      var numberofRows =   that.treeListView.getRowModelLength();
      for (var rowIndex = 0; rowIndex < numberofRows; rowIndex++) {
        var cellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: rowIndex, columnID: colId })
        var cellInfos = that.treeListView.getCellInfosAt(cellId);
        if (cellInfos && cellInfos.nodeModel.options.data[that._CONSTANTS.COLOR_COLUMNIDS.TYPE] === type) {
          var rowData = that.getRowDataFromTreeView(rowIndex);
          dataObjects.push(rowData);
        }
      }
      return dataObjects;
    },

    /*
      * removeNodesOfType
      */
    removeNodesOfType : function removeNodesOfType(type){
      var that = this;
      var nodesToRemove = [];
      var colId = that.treeListView.layout.getColumnIndex(that._CONSTANTS.COLOR_COLUMNIDS.TYPE);
      var numberofRows =   that.treeListView.getRowModelLength();
      for (var rowIndex = 0; rowIndex < numberofRows; rowIndex++) {
        var cellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: rowIndex, columnID: colId })
        var cellInfos = that.treeListView.getCellInfosAt(cellId);
        if (cellInfos && cellInfos.nodeModel.options.data[that._CONSTANTS.COLOR_COLUMNIDS.TYPE] === type) {
          nodesToRemove.push(cellInfos.nodeModel);
        }
      }
      nodesToRemove.forEach(node=>{
        var treeDoc = that.treeListView.treeDocument;
        if(treeDoc != undefined)
        treeDoc.removeRoot(node);
      });
    },

    IsTableModifiedForType:function IsTableModifiedForType(type){
      var that = this;
      var bTableModified = false;
      var nbRowsofThisType = 0;
      var colId = that.treeListView.layout.getColumnIndex(that._CONSTANTS.COLOR_COLUMNIDS.TYPE); 
      var numberofRows =   that.treeListView.getRowModelLength();
      for (var idxRow = 0; idxRow < numberofRows; idxRow++) {
        var cellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: idxRow, columnID: colId })
        var cellInfos = that.treeListView.getCellInfosAt(cellId);
        if (cellInfos && cellInfos.nodeModel.options.data[that._CONSTANTS.COLOR_COLUMNIDS.TYPE] === type) {
          var rowIndex = cellInfos.nodeModel.options.data[that._CONSTANTS.COLOR_COLUMNIDS.RULENUMBER];
          if (parseInt(rowIndex) != nbRowsofThisType + 1) {
            bTableModified = true;
            break;
          }
          nbRowsofThisType = nbRowsofThisType+1;
        }
      }
      return bTableModified;
    },

    /*
    * buildModal
    */
    buildModal : function buildModal(bEditMod)
    {
      var that = this;
      that._modalViewNls.modalTitle = that._modalViewNls.colorTableName;
      that._modalViewNls.Info = that._modalViewNls.Info_Color_modal;
      that._modalViewNls.attributeNameTooltip = that._modalViewNls.attributeNameTooltipForColorModal;
      this._parent(bEditMod);

      var comboGraphicalElement = document.getElementById(that._CONSTANTS.COLOR_COLUMNIDS.GRAPHICALELEMENT);
      comboGraphicalElement.dsModel.disabled = true;

      var comboAttributeKeys = document.getElementById(that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTENAME);
      comboAttributeKeys.dsModel.disabled = true;
      comboAttributeKeys.dsModel.elementsList = [];
      comboAttributeKeys.dsModel.selectedIndex = -1;

      var AttributeValues = document.getElementById(that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE);
      AttributeValues.dsModel.disabled = true;

      var comboattributeCondition = document.getElementById(that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTECONDITION);
      comboattributeCondition.dsModel.disabled = true;

      var colorEditorElement = document.getElementById(that._CONSTANTS.COLOR_COLUMNIDS.COLOR);
      colorEditorElement.setStyles({
        'width': '90%',
        'padding-right': '2px'
      });
      var subModalContentDiv = document.getElementsByClassName("subcontentModalView");
      subModalContentDiv.item(2).setStyles({ display: 'flex', 'align-items': 'flex-start' })
      var colorPicker = new WUXColorPicker({ value: "FFB16E" });
      colorPicker.elements.container.className += " deltextEditormodal";
      colorPicker.elements.container.setAttribute('id',"colorPickerForPERT");
      colorPicker.inject(subModalContentDiv.item(2));
      colorPicker.elements.container.setStyles({
        'width': '10%',
        'padding-left': '2px'
      });
      colorEditorElement.dsModel.disabled = true;
      colorEditorElement.dsModel.value = "#FFB16E";

      colorPicker.addEventListener('liveChange', (e) => {
        var colorValue = "#" + e.dsModel.value;
        colorEditorElement.dsModel.value = colorValue;
      });
      // If we create a rule with Attribute condition, we set mandatory flag true for condition and value.
      // We need to reset them here, so that if user wants to create a rule without attribute condition, it should allow
      that._uiElementsIDs.forEach(element => {
        if (element.id === that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE || element.id === that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTECONDITION) {
          element.mandatory = false;
        }
      });
      // that._updateAttributesCombo();

    },

    /*
    * presetModal
    */
    presetModal : function presetModal(node)
    {
      console.log("presetModal");
      var that = this;
      that._parent(node);
      var colorPickerElement = document.getElementById("colorPickerForPERT");
      var nodeGrid = node.getGrid();
      var storedColor = nodeGrid[that._CONSTANTS.COLOR_COLUMNIDS.COLOR];
      colorPickerElement.dsModel.value = storedColor;

      var nodeData = node.getData();
      var dataType = nodeData[that._CONSTANTS.COLOR_COLUMNIDS.TYPE];

      var storedAttributeValue =  nodeGrid[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE];
      var storedAttribute =  nodeGrid[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTENAME];
      if (storedAttribute != undefined && storedAttribute.includes(" (") && storedAttribute.includes(".")) {
        var dicoType = (((storedAttribute).split(" ("))[1]).split(".")[0];
        var attribute = ((((storedAttribute).split(" ("))[1]).split(".")[1]).split(")")[0];
        var attrObj = that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType][attribute];
        if (!Array.isArray(attrObj.AuthorizedValue) || attrObj.Type != "Boolean") {
          var attributeValuesElement = document.getElementById(that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE);
          attributeValuesElement.dsModel.value = storedAttributeValue;
        }
      }
      
    },

    validateModal : function validateModal()
    {
      var that = this;
      console.log("validateModal");

      var treeNodeModel = that._parent();
      if (treeNodeModel != undefined) {
        var data = treeNodeModel.getData();
        if (data[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE] != undefined && data[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE] != null && ((data[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE]).toLowerCase() === 'true' || (data[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE]).toLowerCase() === 'false')) {
          var isTrueSet = ((data[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE]).toLowerCase() === 'true');
          data[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE] = isTrueSet;
        }
        var attrName = data[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTENAME];
        var attrValue = data[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE];
        if(attrName != null && attrName != undefined && attrName != "DicoType"){
          var dicoType = attrName.split('.')[0];
          var attr = attrName.split('.')[1];
          var dataType = data[that._CONSTANTS.COLOR_COLUMNIDS.TYPE];
          if (dicoType != null && dicoType != undefined && attr != null && attr != undefined) {
            var attrObj = that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType][attr];
            if (attrObj != null && attrObj != undefined) {
              var bShowError = false;
              var strErrorMessage = Nls.ErrorMsgNotANumber;
              var columnID = Nls.attributeValue;
              if (attrObj.Type === "Integer" && !Array.isArray(attrObj.AuthorizedValue) && isNaN(attrValue) ) {
                bShowError = true;
                strErrorMessage = strErrorMessage.replace("%1", columnID);
              }
              if (attrObj.Type === "Double" && isNaN(attrValue)) {
                bShowError = true;
                strErrorMessage = strErrorMessage.replace("%1", columnID);
              }
              if (bShowError) {
                that._modalView.showToastMessage(2, strErrorMessage);
                return;
              }
            }
          }
        }
      }
      return treeNodeModel;
    },

    /*
    * createtreeNode
    */
    createtreeNode : function createtreeNode(data, grid)
    {
      var that = this;
      var rowModelLength = that.treeListView.getRowModelLength();
      // Adding ruleNumber as an attribute
      if (data[that._CONSTANTS.COLOR_COLUMNIDS.GRAPHICALELEMENT] && grid != undefined && grid[that._CONSTANTS.COLOR_COLUMNIDS.GRAPHICALELEMENT] && data[that._CONSTANTS.COLOR_COLUMNIDS.RULENUMBER] == undefined && grid[that._CONSTANTS.COLOR_COLUMNIDS.RULENUMBER] == undefined) {
        var computedRowIndex = that._computeRowIndexForType(data[that._CONSTANTS.COLOR_COLUMNIDS.TYPE]);
        var ruleNumber = null;
        if (that._bEditMode)
          ruleNumber = that._node.getData().ruleNumber;
        else
          ruleNumber = computedRowIndex.toString();
        data[that._CONSTANTS.COLOR_COLUMNIDS.RULENUMBER] = ruleNumber;
        grid[that._CONSTANTS.COLOR_COLUMNIDS.RULENUMBER] = ruleNumber;
      }
      var translationModel = new DELConfigurationParamTranslationModel({
        data: data,
        grid: grid,
        nls: Nls
      });

      if (grid == undefined) {
        var gridTemp = translationModel.getGrid();
        var datatype = data[that._CONSTANTS.COLOR_COLUMNIDS.TYPE];

        // We only store actual attribute name in DB, to display we need to construct the NLS name and set it on the grid of DataGrid model.
        if (that._attributesResult != null && that._attributesResult != undefined && gridTemp != undefined && gridTemp.hasOwnProperty(that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTENAME)) {
          if (data[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTENAME] != undefined && data[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTENAME].includes('.')) {
            var storedAttribute = data[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTENAME];
            var dicoType = ((storedAttribute).split("."))[0];
            var attribute = ((storedAttribute).split("."))[1];//((((storedAttribute).split("."))[1]).split(" ("))[0];

            if (that._attributesResult[datatype][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType] != undefined && that._attributesResult[datatype][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType][attribute] != undefined) {
              var attrObj = that._attributesResult[datatype][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType][attribute];
              var displayLabel = attrObj.NLSName + ' (' + attrObj.Owner + '.' + attribute + ')';
              gridTemp[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTENAME] = displayLabel;
              if (attrObj.Type === "Boolean" && data[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE] === 'true') {
                gridTemp[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE] = Nls.attributeValueBooleanTrue;
              }
              else if (attrObj.Type === "Boolean" && data[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE] === 'false') {
                gridTemp[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE] = Nls.attributeValueBooleanFalse;
              }

              var attrAuthorizedValues = attrObj.AuthorizedValue;
              if (Array.isArray(attrAuthorizedValues)) {
                var attrAuthorizedValuesLength = attrAuthorizedValues.length;
                if (attrAuthorizedValuesLength) {
                  if (dicoType != "DicoType") {
                    var attrAuthorizedValuesNLS = attrObj.AuthorizedValueNLS;
                    for (var idxAttrValue = 0; idxAttrValue < attrAuthorizedValuesLength; idxAttrValue++) {
                      if(attrAuthorizedValues[idxAttrValue] === data[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE])
                        gridTemp[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE] = attrAuthorizedValuesNLS[idxAttrValue];
                    }
                  }
                }
              }

            }
          }
          else if (data[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTENAME] != undefined && data[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTENAME] === "DicoType" && data[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE] != undefined) {
            var storedAttributeValue = data[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE];
            if (that._attributesResult[datatype][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES] != undefined && that._attributesResult[datatype][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES][storedAttributeValue] != undefined && that._attributesResult[datatype][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES][storedAttributeValue][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPENLSNAME] != undefined)
              gridTemp[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE] = that._attributesResult[datatype][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES][storedAttributeValue][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPENLSNAME];
          }
        }
      }
      return translationModel;
    },

    /*
      * _computeRowIndexForType
      */
    _computeRowIndexForType: function _computeRowIndexForType(type) {
      var that = this;

      var computedIndex = 0;
      var numberOfRowsAlreadyPresentForType = 0;
      try {
        var colId = that.treeListView.layout.getColumnIndex(that._CONSTANTS.COLOR_COLUMNIDS.TYPE);
        var rowModelLength = that.treeListView.getRowModelLength();
        if (rowModelLength) {
          for (var rowIndex = 0; rowIndex < rowModelLength; rowIndex++) {
            var cellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: rowIndex, columnID: colId })
            var cellInfos = that.treeListView.getCellInfosAt(cellId);
            if (cellInfos && cellInfos.nodeModel.options.data[that._CONSTANTS.COLOR_COLUMNIDS.TYPE] === type) {
              numberOfRowsAlreadyPresentForType = numberOfRowsAlreadyPresentForType + 1;
            }
          }
        }
      } catch (error) {
      }
      computedIndex = numberOfRowsAlreadyPresentForType + 1;
      return computedIndex;
    },

    /*
    * addChild
    */
    addChild: function addChild(nodesTab) {
      var that = this;
      that._parent(nodesTab);
      that.treeListView.sortModel = [{ dataIndex: that._CONSTANTS.COLOR_COLUMNIDS.TYPE, sort: '' }];
      that.treeListView.reapplySortModel();
    },

    /*
    * mapFunctions
    */
    mapFunctions: function mapFunctions(name)
    {
        var that = this;
        if (name === "onChangetypeCombo")
          return that.onChangeTypeClick.bind(that);
        if (name === "onChangeAttributesCombo")
          return that.onChangeAttributeClick.bind(that);
        else return null;
    },

    /*
    * onOKEditButtonClick
    */
    onOKEditButtonClick : function onOKEditButtonClick()
    {
      var that = this;
      that._bEditMode = true;
      var nodeData = that._node.getData();
      var attributeName = nodeData[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTENAME];
      if (attributeName != undefined && attributeName.includes(' (')) {
        var storedAttributeName = (attributeName.split(' (')[1]).split(")")[0];
        nodeData[that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTENAME] = storedAttributeName;
      }
      that._parent();
      that._bEditMode = false;
    },

    /*
    * onOKButtonClick
    */
    onOKButtonClick : function onOKButtonClick()
    {
      var that = this;
      that._parent();
    },

    /*
    * onCancelButtonClick
    */
    onCancelButtonClick : function onCancelButtonClick()
    {
      var that = this;
      that._parent();
      that._bEditMode = false;
    },

    _getListOfElementsForAttributesCombo: function _getListOfElementsForAttributesCombo(data) {
      var that = this;
      var listForCombo = that._parent(data);
      if (listForCombo != undefined) {
        listForCombo.push({ label: Nls.DicoType, value: "DicoType" });
        if (listForCombo.length) {
          listForCombo.sort(function (comboValue1, comboValue2) {
            if (comboValue1.label.toLowerCase() === comboValue2.label.toLowerCase())
              return 0;
            return comboValue1.label.toLowerCase() > comboValue2.label.toLowerCase() ? 1 : -1;
          });
        }
        listForCombo.unshift({ label: Nls.Select, value: "Select" });
      }
      return listForCombo;
    },

    _geTypesToBeListed : function _geTypesToBeListed(dataType)
    {
      var that = this;
      var typesForCombo = [];
      var types = [];

      var data = that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES];
      var typekeys = Object.keys(data);
      var typekeysLength = typekeys.length;
      for (var i = 0; i< typekeysLength;  i++) {
        var typekey = typekeys[i];
        if (!types.includes(typekey)) {
          types.push(typekey);
            typesForCombo.push({ label: that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES][typekey][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPENLSNAME], value: that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES][typekey][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPENAME] });
        }
      }
      if (typesForCombo.length) {
        typesForCombo.sort(function (comboValue1, comboValue2) {
          if (comboValue1.label.toLowerCase() === comboValue2.label.toLowerCase())
            return 0;
          return comboValue1.label.toLowerCase() > comboValue2.label.toLowerCase() ? 1 : -1;
        });
      }

      return typesForCombo;
    },

    /*
    onChangeTypeClick
    */
    onChangeTypeClick: function onChangeTypeClick(data){
      var that = this;

      if (data.dsModel.elementsList[data.dsModel.selectedIndex] != undefined) {
      
        var attrgraphicalElementCombo = document.getElementById(that._CONSTANTS.COLOR_COLUMNIDS.GRAPHICALELEMENT);
        attrgraphicalElementCombo.dsModel.disabled = false;

        var newElementsList = [];
        if (data.dsModel.elementsList[data.dsModel.selectedIndex].value === 'process') {
          newElementsList.push({ label: Nls.headerBackgroundColor, value: 'headerBackgroundColor' });
          newElementsList.push({ label: Nls.tileBackgroundColor, value: 'tileBackgroundColor' });
          newElementsList.push({ label: Nls.headerTextColor, value: 'headerTextColor' });
          newElementsList.push({ label: Nls.tileTextColor, value: 'tileTextColor' });
        }
        else {
          newElementsList.push({ label: Nls.tileBackgroundColor, value: 'tileBackgroundColor' });
          newElementsList.push({ label: Nls.tileTextColor, value: 'tileTextColor' });
        }
        attrgraphicalElementCombo.dsModel.elementsList = newElementsList;
        that._updateAttributesCombo(data.dsModel.elementsList[data.dsModel.selectedIndex].value);
      }
    },

    /*
    * onChangeAttributeClick
    */
    onChangeAttributeClick: function onChangeAttributeClick(data) {
      var that = this;

      var uiElementAttrValue = null;
      var uiElementAttrCondition = null;
      that._uiElementsIDs.forEach(element => {
        if (element.id === that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE) {
          uiElementAttrValue = element;
        }
        if (element.id === that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTECONDITION) {
          uiElementAttrCondition = element;
        }
      });

      if (data.dsModel.elementsList[data.dsModel.selectedIndex] != undefined) {

        var attributesElt = document.getElementById(that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTENAME);
        if (attributesElt.dsModel.elementsList[attributesElt.dsModel.selectedIndex].value == "Select") {
          attributesElt.dsModel.selectedIndex = -1;
          return;
        }

        var dicoType = ((attributesElt.dsModel.elementsList[attributesElt.dsModel.selectedIndex].value).split("."))[0];
        var attribute = (((attributesElt.dsModel.elementsList[attributesElt.dsModel.selectedIndex].value).split("."))[1])
        var iTypeElt = document.getElementById(that._CONSTANTS.COLOR_COLUMNIDS.TYPE);
        var dataType = iTypeElt.dsModel.value;
        if (that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES] != undefined && data.dsModel.elementsList[data.dsModel.selectedIndex] != undefined && dicoType != undefined && (attribute != undefined || dicoType === "DicoType")) {
          var attrAuthorizedValues = null;
          var attrAuthorizedValuesNLS = null;
          var attrType = null;
          if (dicoType === "DicoType")
            attrAuthorizedValues = that._geTypesToBeListed(dataType);
          else {
            attrAuthorizedValues = that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType][attribute].AuthorizedValue;
            attrAuthorizedValuesNLS = that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType][attribute].AuthorizedValueNLS;
            attrType = that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType][attribute].Type;
          }
          
          var tempUiElt = null;
          if (Array.isArray(attrAuthorizedValues) || attrType === "Boolean") {
            var listForAttrValCombo = [];
            var attrAuthorizedValuesLength = attrAuthorizedValues.length;
            if (attrAuthorizedValuesLength) {
              if (dicoType != "DicoType") {
                for (var idxAttrValue = 0; idxAttrValue < attrAuthorizedValuesLength; idxAttrValue++) {
                  var attributeValue = attrAuthorizedValues[idxAttrValue];
                  var attributeValueNLS = attrAuthorizedValuesNLS[idxAttrValue];
                  if (attributeValue) {
                    listForAttrValCombo.push({ label: attributeValueNLS, value: attributeValue });
                  }
                }
              }
              else
                listForAttrValCombo = attrAuthorizedValues;
            }
            else if (attrType === "Boolean") {
              //var booleanTrue = true;
              //var strbooleanTrue = booleanTrue.toString();
              //var booleanFalse = false;
              //var strbooleanFalse = booleanFalse.toString();
              var strBooleanTrue = "true";
              var strBooleanFalse = "false";
              listForAttrValCombo.push({ label: Nls.attributeValueBooleanTrue, value: strBooleanTrue });
              listForAttrValCombo.push({ label: Nls.attributeValueBooleanFalse, value: strBooleanFalse });
            }

            var lOptions = {};
            lOptions.elementsList = listForAttrValCombo;
            lOptions.selectedIndexes = [];
            lOptions.displayStyle = "normal";
            lOptions.enableSearchFlag = true;
            lOptions.placeholder = "Select";
            if (that._modalViewNls != null || that._modalViewNls != undefined)
              lOptions.placeholder = that._modalViewNls.Select;
              
            uiElementAttrValue.type = "combobox";
            tempUiElt = new WUXComboBox(lOptions);
            tempUiElt.elements.container.className += " delcomboboxmodal";
            tempUiElt.elements.container.setAttribute('id', that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE);

          }
          else {
            uiElementAttrValue.type = "textarea";
            var lOptions = {};
            tempUiElt = new WUXEditor(lOptions);
            tempUiElt.elements.container.className += " deltextEditormodal";
            tempUiElt.elements.container.setAttribute('id', that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE);
          }
          var comboattributeValues = document.getElementById(that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE);
          if (tempUiElt && comboattributeValues) {
            var subModalContentDiv = document.getElementsByClassName("subcontentModalView");
            subModalContentDiv.item(5).replaceChild(tempUiElt.elements.container, comboattributeValues);
          }
          var strAttributeLabel = document.getElementById(that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE);
          strAttributeLabel.dsModel.disabled = false;
          uiElementAttrValue.mandatory = true;
          var attrConditionCombo = document.getElementById(that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTECONDITION);
          attrConditionCombo.dsModel.disabled = false;
          uiElementAttrCondition.mandatory = true; 

          var newElementsList = [];
          if (Array.isArray(attrAuthorizedValues) || attrType === "Boolean" || attrType === "String") {
            newElementsList.push({ label: Nls.Equal, value: 'Equal' });
            newElementsList.push({ label: Nls.NotEqual, value: 'NotEqual' });
          }
          else {
            newElementsList.push({ label: Nls.Equal, value: 'Equal' });
            newElementsList.push({ label: Nls.NotEqual, value: 'NotEqual' });
            newElementsList.push({ label: Nls.LessThanOrEqual, value: 'LessThanOrEqual' });
            newElementsList.push({ label: Nls.GreaterThanOrEqual, value: 'GreaterThanOrEqual' });
          }
          attrConditionCombo.dsModel.elementsList = newElementsList;
        }
        else {
          var comboKeys = document.getElementById(that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTENAME);
          comboKeys.dsModel.disabled = true;
          comboKeys.dsModel.elementsList = [];
        }
      }
      else {
        var attrValueElement = document.getElementById(that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTEVALUE);
        attrValueElement.dsModel.disabled = true;
        uiElementAttrValue.mandatory = false;
        if (uiElementAttrValue.type === 'combobox')
          attrValueElement.dsModel.elementsList = [];
        else if (uiElementAttrValue.type === 'textarea')
          attrValueElement.dsModel.value = "";
        var attrConditionCombo = document.getElementById(that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTECONDITION);
        attrConditionCombo.dsModel.disabled = true;
        attrConditionCombo.dsModel.elementsList = [];
        uiElementAttrCondition.mandatory = false;
      }
    },
    IsTableModified: function IsTableModified() {
      var that = this;
      var bTableModified = false;
      var numberOfRows = that.treeListView.getRowModelLength();
      for (var rowID = 0; rowID < numberOfRows; rowID++) {
        var attrColumnId = that.treeListView.layout.getColumnIndex(that._CONSTANTS.COLOR_COLUMNIDS.ATTRIBUTENAME);
        var attrCellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: rowID, columnID: attrColumnId });
        var cellInfos = that.treeListView.getCellInfosAt(attrCellId);
        var rowIndex = cellInfos.nodeModel.options.data[that._CONSTANTS.COLOR_COLUMNIDS.RULENUMBER];
        if (parseInt(rowIndex) != rowID + 1) {
          bTableModified = true;
          break;
        }
      }
      return bTableModified;
    },

    // getRowDataFromTreeView: function getRowDataFromTreeView(rowID) {
    //   var that = this;
    //   var dataObject = that._parent(rowID);
    //   var rowNumber = rowID + 1;
    //   dataObject[that._CONSTANTS.COLOR_COLUMNIDS.RULENUMBER] = rowNumber.toString();
    //   return dataObject;
    // },

    /*
    * removeSelectedNode
    */
    removeSelectedNode: function removeSelectedNode(params) {
      console.log("params " + params);
      var that = this;
      var node = params.context.nodeModel;
      var nodeData = node.getData();

      var type = nodeData[that._CONSTANTS.COLOR_COLUMNIDS.TYPE];
      var rowDataObjectsBeforeDelete = that.getRowsDataForType(type)
      var nbRowsPresentForThisType  = rowDataObjectsBeforeDelete.length;
      if (nodeData[that._CONSTANTS.COLOR_COLUMNIDS.RULENUMBER] != undefined && nodeData[that._CONSTANTS.COLOR_COLUMNIDS.RULENUMBER] != nbRowsPresentForThisType)  {
        var treeDoc = params.configurationLayoutView.treeList.dataGridView.treeDocument;
        if (treeDoc)
          treeDoc.removeRoot(node);
          var rowDataObjectsAfterDelete = that.getRowsDataForType(type)
        var bUpdateRequiredAfterDelete = true;
        that._UpdateParameters(type,rowDataObjectsBeforeDelete,rowDataObjectsAfterDelete,bUpdateRequiredAfterDelete);
      }
      else
      {
        //that._parent(params);
        console.log("params " + params);
        var that = this;

        var node = params.context.nodeModel;
        var nodeData = node.getData();
        delete nodeData["isDeployed"];
        delete nodeData["delete"];
        delete nodeData["edit"];

          DELConfigurationParameterizationWebServices.deleteParameter(that._domainID, that._familyID, that._paramID, that._argID, nodeData/*objNodeIsDeployed*/, {
            onSuccess : function(data)
            {
              var treeDoc = params.configurationLayoutView.treeList.dataGridView.treeDocument;
              if (treeDoc)
                treeDoc.removeRoot(node);//params.context.nodeModel);

              that.displayNotifications({
                level: 'info',
                message: Nls.deleteParameter,
                title: Nls.deleteParameterTitle
              });
            },
            onFailure : function (err)
            {
              that.displayNotifications({
                level: 'error',
                message: Nls.deleteParameterError,
                title: Nls.deleteParameterTitle
              });
            }
          });
      }
    },

  });

  return DELProcessFlowDiagramColorConfigFamilyView;
});

/**
 * @quickreview  NSY5 25:01:22 creation
 */

define('DS/ParameterizationSkeleton/Views/ParameterizationDELUserExperience/DELProcessTranslationLanguagesFamilyView',
  [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
    'DS/ParameterizationSkeleton/Model/DELConfigurationParameterizationModel/DELConfigurationParamTranslationModel',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDELUserExperience/ParameterizationDELUserExperienceWebServices',
    'i18n!DS/ParameterizationSkeleton/assets/nls/ProcessTranslationLanguages',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DELUserExperienceConfiguration'
  ],
  function (
    UWA,
    DELConfigurationFamilyView,
    DELConfigurationParamTranslationModel,
    ParameterizationDELUserExperienceWebServices,
    ProcessTranslationLanguages,
    Nls
  ) {

    'use strict';

    var DELProcessTranslationLanguagesFamilyView = DELConfigurationFamilyView.extend({

      _attributesResult: null,
      _node: null,
      _bEditMode: false,
      
      _CONSTANTS : {

        // Column Ids
        LANGUAGE_COLUMNIDS: {
          LANGUAGE: "LanguageName"
        }
      },

      /*
       * init
       */
      init: function init(options) {
        var that = this;
        this._parent(options);

        that._treeListViewNls = Nls;
        that._modalViewNls = Nls;
        that._nodeTreeViewNls = Nls;
        that._needTitleForTreeListView = true;

      },

      /*
       * buildFamilyContent
       */
      buildFamilyContent: function buildFamilyContent() {

        var that = this;
        that._nodeTreeViewNls.treeViewTitle = that._nodeTreeViewNls.LanguagesTableName;

        var content = this._parent();
        return content;
      },

      /*
       * buildModal
       */
      buildModal: function buildModal(bEditMod) {
        var that = this;
        that._modalViewNls.modalTitle = that._modalViewNls.LanguagesTableName;
        that._modalViewNls.Info = that._modalViewNls.Info_TranslationLanguages_modal;
        this._parent(bEditMod);
        that._updateLanguagesCombo();
      },

      /*
      * createtreeNode
      */
      createtreeNode : function createtreeNode(data, grid)
      {
        var that = this;
        var ProcessTranslationlanguagesList = that.buildLanguagesList();

        var translationModel = new DELConfigurationParamTranslationModel({
          data : data,
          grid : grid,
          nls: Nls
        });

        if (grid == undefined) {
          var gridTemp = translationModel.getGrid();

          if (gridTemp != undefined && ProcessTranslationlanguagesList != undefined && data[that._CONSTANTS.LANGUAGE_COLUMNIDS.LANGUAGE] != undefined && ProcessTranslationlanguagesList != {}){
            var storedLanguage = data[that._CONSTANTS.LANGUAGE_COLUMNIDS.LANGUAGE];
            
            var displayLabel = ProcessTranslationlanguagesList[storedLanguage + ".Label"];
            gridTemp[that._CONSTANTS.LANGUAGE_COLUMNIDS.LANGUAGE] = displayLabel;
          }
        }

        return translationModel;
      },

      getPromisetoGetInfofromDB : function getPromisetoGetInfofromDB(){
        var that = this;
        var promise = new UWA.Promise(function (resolve, reject) {
          if (that._languagesList == null || that._languagesList == undefined || that._languagesList["member"] === undefined || that._languagesList["member"] === null) {
            if (that._languagesList == null || that._languagesList == undefined)
              that._languagesList = [];

            ParameterizationDELUserExperienceWebServices.getListOfLanguages({
              onSuccess: function (data) {
                that._languagesList = data;
                resolve(that._languagesList);
              },
              onFailure: function (error) {
                reject("ParameterizationDELUserExperienceWebServices.getListOfLanguages");
                console.error("ParameterizationDELUserExperienceWebServices.getListOfLanguages", error);
              }
            });
          }
          else
            resolve(that._languagesList);
        });
        return promise
      },

      buildLanguagesList : function buildLanguagesList(){
        var that = this;
        const apiLanguagesObject = {}; 
        var sortedLanguagesLIst = {};

        if(that._languagesList){
            that._languagesList.member.forEach((item) => {
                const key = `${item.ReferencialCode}.Label`;
                apiLanguagesObject[key] = item.Description;
            });
            // console.log(apiLanguagesObject);

            let entries = Object.entries(apiLanguagesObject);
            entries.sort((a, b) => a[1].localeCompare(b[1]));

            sortedLanguagesLIst = Object.fromEntries(entries);
        }
        else{
          console.log("error fetching languages list");
        }

        return sortedLanguagesLIst;
      },

      /*
      * _updateLanguagesCombo
      */
      _updateLanguagesCombo : function _updateLanguagesCombo()
      {
        var that = this;
        var languagesList = that.buildLanguagesList();

        var comboLanguageKeys = document.getElementById(that._CONSTANTS.LANGUAGE_COLUMNIDS.LANGUAGE);
        comboLanguageKeys.dsModel.disabled = true;
        comboLanguageKeys.dsModel.elementsList = [];
        comboLanguageKeys.dsModel.selectedIndex = -1;
        var listForCombo = [];
        if (languagesList != undefined && languagesList != {})
        {
          var keys = Object.keys(languagesList);
          keys.forEach(key => {
            listForCombo.push({label: languagesList[key], value: key.split('.')[0]});
          });
        }
        var comboElementsListLength = listForCombo.length;
        if (comboElementsListLength > 0)
        {
          comboLanguageKeys.dsModel.disabled = false;
          comboLanguageKeys.dsModel.elementsList = listForCombo;
          comboLanguageKeys.dsModel.selectedIndex = -1;
          comboLanguageKeys.dsModel.autocompleteFlag = false;
        }
      },

      /*
       * onOKEditButtonClick
       */
      onOKEditButtonClick: function onOKEditButtonClick() {
        var that = this;
        that._bEditMode = true;
        that._parent();
        that._bEditMode = false;
      },

      /*
       * onCancelButtonClick
       */
      onCancelButtonClick: function onCancelButtonClick() {
        var that = this;
        that._parent();
        that._bEditMode = false;
      },

      /*
       * editSelectedNode
       */
      editSelectedNode: function editSelectedNode(params) {
        console.log("params " + params);
        var that = this;
        that._bEditMode = true;
        that._parent(params);
      },

      /*
       * validateModal
       */
      validateModal: function validateModal() {
        var that = this;
        console.log("validateModal");

        var treeNodeModel = that._parent();
        if (treeNodeModel != undefined) {
          var data = treeNodeModel.getData();

          var rowModelLength = that.treeListView.getRowModelLength();
          var listLanguagesAlreadyDefined = [];

          if (rowModelLength) {
            for (var rowIndex = 0; rowIndex < rowModelLength; rowIndex++) {
              var dataObject = that.getRowDataFromTreeView(rowIndex);
              listLanguagesAlreadyDefined.push(dataObject[that._CONSTANTS.LANGUAGE_COLUMNIDS.LANGUAGE]);
            }
          }

          var editNodeName = "";
          if (that._bEditMode) {
            var nodeData = that._node.getData();
            editNodeName = nodeData[that._CONSTANTS.LANGUAGE_COLUMNIDS.LANGUAGE];
          }
          var bShowError = false;
          var strErrorMessage = "";

          var languageValue = data[that._CONSTANTS.LANGUAGE_COLUMNIDS.LANGUAGE];
          var languageNls = Nls.LanguageName;

          if ((!that._bEditMode && listLanguagesAlreadyDefined.includes(languageValue)) || (that._bEditMode && editNodeName != languageValue && listLanguagesAlreadyDefined.includes(languageValue))) {
            var strErrorMessage = Nls.ErrorMsgLanguageAlreadyUsed;
            bShowError = true;
            strErrorMessage = strErrorMessage.replace(/%1/g, languageNls);
          }

          if (bShowError) {
            that._modalView.showToastMessage(2, strErrorMessage);
            return;
          }
        }
        return treeNodeModel;
      }
    });
    return DELProcessTranslationLanguagesFamilyView;
    });

/**
* @quickreview  ROW 24:02:02 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDELUserExperience/DELWebAppsCustomizationFamilyView',
    [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Utils/DELConfigurationParameterization/DELConfigurationParameterizationWebServices',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDELUserExperience/ParameterizationDELUserExperienceWebServices',
    'DS/ParameterizationSkeleton/Model/DELConfigurationParameterizationModel/DELConfigurationParamTranslationModel',
    'DS/UIKIT/Mask',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DELUserExperienceConfiguration'
    ],
    function (
      UWA,
      DELConfigurationParameterizationWebServices,
      DELConfigurationFamilyView,
      ParameterizationDELUserExperienceWebServices,
      DELConfigurationParamTranslationModel,
      Mask,
      Nls
    )
  {

  'use strict';

  var DELWebAppsCustomizationFamilyView = DELConfigurationFamilyView.extend({

    _customizationResult : null,
    _node : null,
    _bEditMode : false,

    /*
    * init
    */
    init : function init(options)
    {
      var that = this;
      this._parent(options);

      that._treeListViewNls = Nls;
      that._modalViewNls = Nls;
      that._nodeTreeViewNls = Nls;
      that._needTitleForTreeListView = true;

    },

    /*
    * render
    */
    render : function render()
    {
      var that = this;
      this._parent();

      return this;
    },

   /*
    * getPromisetoGetInfofromDB
    */
    getPromisetoGetInfofromDB : function getPromisetoGetInfofromDB(){
      var that = this;
      var promise = new UWA.Promise(function (resolve, reject) {
        if (that._customizationResult == null || that._customizationResult == undefined || that._customizationResult['widgetsOptionsList'] === undefined || that._customizationResult['widgetsOptionsList'] === null) {
          if (that._customizationResult == null || that._customizationResult == undefined)
            that._customizationResult = [];

            ParameterizationDELUserExperienceWebServices.getWidgetsCustomization({
            onSuccess: function (data) {
              that._customizationResult = data;
              resolve();
            },
            onFailure: function (error) {
              reject("ParameterizationDELUserExperienceWebServices.getWidgetsCustomization");
              console.error("ParameterizationDELUserExperienceWebServices.getWidgetsCustomization");
            }
          });
        }
        else
          resolve()
      });
      return promise;
    },
    /*
    * buildFamilyContent
    */
    buildFamilyContent: function buildFamilyContent() {

      var that = this;
      that._nodeTreeViewNls.treeViewTitle = that._nodeTreeViewNls.weappsParamsSetTableName;

       var content  =this._parent();

       var topbarDiv = (content.getElementsByClassName("divToolbar")).item(0);
       var nbNodesInTopBar = topbarDiv.childNodes.length;
       topbarDiv.removeChild((topbarDiv.childNodes)[nbNodesInTopBar-1]);
       //var deleteColOpt = that.treeListView.getColumnOrGroup('delete');
       that.treeListView.removeColumnOrGroup('delete');
       return content;
    },

    setParameters: function setParameters(treeNodeList) {
      var that = this;
      var nbNodesTobeAdded = treeNodeList.length;
      var promisesSetParams = [];
      Mask.mask(that.treeListView.elements.body);
      for (var idxNode = 0; idxNode < nbNodesTobeAdded; idxNode++) {
        var promiseSetParams = new Promise(function (resolve, reject) {
          var treeListNode = treeNodeList[idxNode];
          if (treeListNode) {
            var dataObject = treeListNode.getData();
            DELConfigurationParameterizationWebServices.setParameters(that._domainID, that._familyID, that._paramID, that._argID, dataObject, {
              onSuccess: function (data) {
                resolve(dataObject);
              },
              onFailure: function (error) {
                reject("DELConfigurationParameterizationWebServices.setParameters");
                console.error("DELConfigurationParameterizationWebServices.setParameters");
              }
            });
          }
        });
        promisesSetParams.push(promiseSetParams);
      }

      UWA.Promise.all(promisesSetParams).then(function (typesSetParams) {

        // Check Deployment and update Tree
        var promisesIsDeployed = [];
        for (var idxNode = 0; idxNode < nbNodesTobeAdded; idxNode++) {

          var promiseIsDeployed = new Promise(function (resolve, reject) {
            var treeListNode = treeNodeList[idxNode];
            if (treeListNode) {
              var dataObject = treeListNode.getData();
              DELConfigurationParameterizationWebServices.isDeployed(that._domainID, that._familyID, that._paramID, that._argID, dataObject, {
                onSuccess: function (data) {
                  resolve({ treeNode: treeListNode, isDeployed: data });
                },
                onFailure: function (error) {
                  reject("DELConfigurationParameterizationWebServices.isDeployed");
                  console.error("DELConfigurationParameterizationWebServices.isDeployed");
                }
              });
            }
          });
          promisesIsDeployed.push(promiseIsDeployed);

        }
        UWA.Promise.all(promisesIsDeployed).then(function (resultIsDeployed) {

          var listOfnodeTree = [];
          var lengthIsDeployed = resultIsDeployed.length;
          for (var idxDeployed = 0; idxDeployed < lengthIsDeployed; idxDeployed++) {

            var treeListNode = resultIsDeployed[idxDeployed].treeNode;
            if (treeListNode) {
              treeListNode.addGridAttributes({ isDeployed: resultIsDeployed[idxDeployed].isDeployed });
              listOfnodeTree.push(treeListNode);
            }
          }
          that.addChild(listOfnodeTree);

          that.displayNotifications({
            level: 'info',
            message: Nls.setParameters,
            title: Nls.setParametersTitle
          });
          Mask.unmask(that.treeListView.elements.body);
        }).catch(function (rejectMessages) {
          that.displayNotifications({
            level: 'error',
            message: Nls.setParametersError,
            title: Nls.setParametersTitle
          });
          console.error(rejectMessages);
          Mask.unmask(that.treeListView.elements.body);
        });


      }).catch(function (rejectMessages) {

        that.displayNotifications({
          level: 'error',
          message: Nls.setParametersError,
          title: Nls.setParametersTitle
        });
        console.error(rejectMessages);
        Mask.unmask(that.treeListView.elements.body);

      });

    },
    /*
    * buildModal
    */
    buildModal : function buildModal(bEditMod)
    {
      var that = this;
      that._modalViewNls.modalTitle = that._modalViewNls.weappsParamsSetTableName;
      that._modalViewNls.Info = that._modalViewNls.Info_WebAppsParamSet_modal;
      this._parent(bEditMod);
      if(bEditMod)
        that._updateCustomizationCombo();
    },

   /*
    * _updateAttributesCombo
    */
   _updateCustomizationCombo : function _updateCustomizationCombo(node)
    {
      var that = this;
      var appNameEditor = document.getElementById("applicationName");
      appNameEditor.dsModel.disabled = true;
      var comboParameterSet = document.getElementById("parameterSet");
      comboParameterSet.dsModel.disabled = true;
      comboParameterSet.dsModel.elementsList = [];
      comboParameterSet.dsModel.selectedIndex = -1;
      if (that._customizationResult !=  null || that._customizationResult['widgetsOptionsList'] != undefined)
      {
        var data = that._customizationResult['widgetsOptionsList'];

        var listForCombo = that._getListOfElementsForParametersSetCombo(data, node)
        var comboElementsListLength = listForCombo.length;
        if (comboElementsListLength > 0)
        {
          comboParameterSet.dsModel.disabled = false;
          comboParameterSet.dsModel.elementsList = listForCombo;
          comboParameterSet.dsModel.selectedIndex = -1;
        }
      }
    },

    _getListOfElementsForParametersSetCombo: function _getListOfElementsForParametersSetCombo(data, node) {
      var listForCombo = [];
      if (data != null && node != null) {
        var nodeGrid = node.getGrid();
        var appToBeEdited = nodeGrid["applicationName"];

        data.forEach(element => {
          if (element.name === appToBeEdited) {
            element.customizationInformation.forEach(custoElement => {
              var comboLabel = custoElement.title;
              var comboValue = custoElement.physicalID;
              if (comboLabel === "OOTB")
                comboValue = "OOTB";
              if (comboLabel === "OOTB" && Nls.OOTB != undefined)
                comboLabel = Nls.OOTB;
              listForCombo.push({ label: comboLabel, value: comboValue });
            });
          }
        });
      }
      return listForCombo;
    },
    /*
    * presetModal
    */
    presetModal : function presetModal(node)
    {
      console.log("presetModal");
      var that = this;
      that._updateCustomizationCombo(node);
      this._parent(node);
    },

    /*
    * validateModal
    */
    validateModal : function validateModal()
    {
      var that = this;
      console.log("validateModal");

      var data = {};
      var grid = {};
      var appNameEditor = document.getElementById("applicationName");
      var appName = appNameEditor.dsModel.value;
      var appID = "";
      if (that._customizationResult['widgetsOptionsList'] != null && that._customizationResult['widgetsOptionsList'] != undefined) {
        (that._customizationResult['widgetsOptionsList']).forEach(element => {
          if (element.name  === appName) {
            data["applicationName"] = element.widgetID;
            grid["applicationName"] = appName;
          }
        });
      }
      var comboParameterSet = document.getElementById("parameterSet");
      data["parameterSet"] = comboParameterSet.dsModel.value;
      grid["parameterSet"] = comboParameterSet.dsModel.label;

      var checkBoxIsLocked = document.getElementById("isLocked");
      data["isLocked"] = checkBoxIsLocked.dsModel.checkFlag;
      grid["isLocked"] = checkBoxIsLocked.dsModel.checkFlag;

      var treeNodeModel = that.createtreeNode(data, grid);
      return treeNodeModel;
    },
    /*
    * createtreeNode
    */
    createtreeNode : function createtreeNode(data, grid)
    {
      var that = this;
      if (that._customizationResult != null && that._customizationResult != undefined && grid == undefined) 
      {
        grid = {}; 
        var storedAppID =  data["applicationName"];
        var storedCustomizationID =  data["parameterSet"];
        var isDeployed = data['isDeployed'];
        if (that._customizationResult['widgetsOptionsList'] != null && that._customizationResult['widgetsOptionsList'] != undefined) {
          (that._customizationResult['widgetsOptionsList']).forEach(element => {
            if (element.widgetID === storedAppID) {
              grid["applicationName"] = element.name;
              if (storedCustomizationID === "OOTB")
                grid["parameterSet"] = "OOTB";
              else {
                element.customizationInformation.forEach(custoElement => {
                  if (custoElement.physicalID === storedCustomizationID)
                    grid["parameterSet"] = custoElement.title;
                });
              }
              grid["isLocked"] = data['isLocked'];
              grid["isDeployed"] = isDeployed;
            }
          });
        }
      }
      var translationModel = new DELConfigurationParamTranslationModel({
        data : data,
        grid : grid,
        nls : Nls});

        return translationModel;
    },

    /*
    * addChild
    */
    addChild : function addChild(nodesTab)
    {
        var that = this;
        nodesTab.sort(function(node1, node2){
          var appName1 = node1.getData().applicationName;
          var appName2 = node2.getData().applicationName;
          if (appName1.toLowerCase() === appName2.toLowerCase())
            return 0;
          return appName1.toLowerCase() > appName2.toLowerCase() ? 1 : -1;
        })
        that._parent(nodesTab);

        var rowModelLength = that.treeListView.getRowModelLength();
        if(!rowModelLength){
         if(that._customizationResult['widgetsOptionsList']){
          var treeNodesList = [];
          var data = new Map();
          var grid = new Map();          
          var nbWidgets = (that._customizationResult['widgetsOptionsList']).length;
          (that._customizationResult['widgetsOptionsList']).forEach(element => {
           data.set("applicationName", element.widgetID);
           grid.set("applicationName", element.name);
           data.set("parameterSet", "OOTB");
           grid.set("parameterSet", "OOTB");
           data.set("isLocked", false);
           grid.set("isLocked", false);
           
           var objData = {};
           var objGrid = {};
           data.forEach(function (value, key) {
             if (value != undefined)
               objData[key] = value;
           });
 
           grid.forEach(function (value, key) {
             objGrid[key] = value;
           });
 
           var treeNodeModel = that.createtreeNode(objData, objGrid);
           treeNodesList.push(treeNodeModel);
          });
 
          if(treeNodesList.length)
           that.setParameters(treeNodesList);
         }
        }

    },

    /*
    * mapFunctions
    */
    mapFunctions: function mapFunctions(name)
    {
        var that = this;
        return null;
    },

    /*
    * onOKEditButtonClick
    */
    onOKEditButtonClick : function onOKEditButtonClick()
    {
      var that = this;
      that._bEditMode = true;

      that._parent();
      that._bEditMode = false;
    },

    /*
    * onOKButtonClick
    */
    onOKButtonClick : function onOKButtonClick()
    {
      var that = this;
      that._parent();
    },

    /*
    * onCancelButtonClick
    */
    onCancelButtonClick : function onCancelButtonClick()
    {
      var that = this;
      that._parent();
      that._bEditMode = false;
    },

    /*
    * removeSelectedNode
    */
    removeSelectedNode : function removeSelectedNode(params)
    {
      console.log("params " + params);
      var that = this;

      that._parent(params);
    },

    /*
    * editSelectedNode
    */
    editSelectedNode : function editSelectedNode(params)
    {
      console.log("params " + params);
      var that = this;
      that._bEditMode = true;
      that._parent(params);
    }

  });
  return DELWebAppsCustomizationFamilyView;
});

/**
* @quickreview  KB9 21:10:25 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationApriso3DExperience/Apriso3DExpConfigurationFamilyView',
    [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
    'DS/ParameterizationSkeleton/Utils/ParameterizationApriso3DExperience/ParameterizationApriso3DExpWebServices',
    'DS/Controls/ModalContainer',
    'DS/Controls/Loader',
    'DS/ParameterizationSkeleton/Model/DELConfigurationParameterizationModel/DELConfigurationParamTranslationModel',
    'i18n!DS/ParameterizationSkeleton/assets/nls/Apriso3DExpConfigurationLayoutView',
    'i18n!DS/ParameterizationSkeleton/assets/nls/Apriso3DExpConfigurationModalView',
    'i18n!DS/ParameterizationSkeleton/assets/nls/Apriso3DExpConfigurationTreeListView',
    'i18n!DS/ParameterizationSkeleton/assets/nls/Apriso3DExpConfigurationNodeTreeView'
    ],
    function (
      UWA,
      DELConfigurationFamilyView,
      ParameterizationApriso3DExpWebServices,
      WUXModalContainer,
      WUXLoader,
      DELConfigurationParamTranslationModel,
      Nls,
      Apriso3DExpConfigurationModalViewNls,
      Apriso3DExpConfigurationTreeListViewNls,
      Apriso3DExpConfigurationNodeTreeViewNls
    )
  {

  'use strict';

  var Apriso3DExpConfigurationFamilyView = DELConfigurationFamilyView.extend({

    _typeResult : null,
    _node : null,

    /*
    * init
    */
    init : function init(options)
    {
      var that = this;
      this._parent(options);

      that._treeListViewNls = Apriso3DExpConfigurationTreeListViewNls;
      that._modalViewNls = Apriso3DExpConfigurationModalViewNls;
      that._nodeTreeViewNls = Apriso3DExpConfigurationNodeTreeViewNls;
    },

    /*
    * render
    */
    render : function render()
    {
      var that = this;
      this._parent();

      return this;
    },

    /*
    * buildModal
    */
    buildModal : function buildModal(bEditMod)
    {
      this._parent(bEditMod);

      var comboAttributeKeys = document.getElementById("keys");
      comboAttributeKeys.dsModel.disabled = true;
      comboAttributeKeys.dsModel.elementsList = [];
      comboAttributeKeys.dsModel.selectedIndex = -1;

      var comboAttributes = document.getElementById("attributes");
      comboAttributes.dsModel.disabled = true;
      comboAttributes.dsModel.elementsList = [];
      comboAttributes.dsModel.selectedIndex = -1;
    },

    /*
    * presetModal
    */
    presetModal : function presetModal(node)
    {
      console.log("presetModal");
      var that = this;

      var nodeType = node.getData();
      var promise = new UWA.Promise(function (resolve, reject) {
        if (that._typeResult == null || that._typeResult == undefined || that._typeResult[nodeType.types/*node.types*/] === undefined || that._typeResult[nodeType.types/*node.types*/] === null)
        {
          if (that._typeResult == null || that._typeResult == undefined)
            that._typeResult = [];

          var listOfTypes = [];
          listOfTypes.push(nodeType.types);//node.types);//value);

          //loader
          var loader = new WUXLoader({height : 22});
          loader.on(Apriso3DExpConfigurationModalViewNls.Loading);

          var comboAttributeTypes = document.getElementById("types");
          var comboAttributeKeys = document.getElementById("keys");
          var comboAttributes = document.getElementById("attributes");

          //loader
          var loader = new WUXLoader({height : 22});
          loader.on(Apriso3DExpConfigurationModalViewNls.Loading);

          var parentNodeTypeContainer = comboAttributeTypes.getParent();
          parentNodeTypeContainer.style.position = "sticky";
          WUXModalContainer.createModal(parentNodeTypeContainer/*, loader.elements.container*/);

          var parentNodeKeysContainer = comboAttributeKeys.getParent();
          parentNodeKeysContainer.style.position = "sticky";
          WUXModalContainer.createModal(parentNodeKeysContainer, loader.elements.container);

          var parentNodeAttrContainer = comboAttributes.getParent();
          parentNodeAttrContainer.style.position = "sticky";
          WUXModalContainer.createModal(parentNodeAttrContainer/*, loader.elements.container*/);

          ParameterizationApriso3DExpWebServices.getlistofDELMIATypes(listOfTypes, {
            onSuccess : function(data)
            {
              that._typeResult[nodeType.types/*node.types/*value*/] = data;

              loader.off();

              WUXModalContainer.removeModal(parentNodeTypeContainer);
              WUXModalContainer.removeModal(parentNodeKeysContainer);
              WUXModalContainer.removeModal(parentNodeAttrContainer);

              parentNodeTypeContainer.style.position = "";
              parentNodeKeysContainer.style.position = "";
              parentNodeAttrContainer.style.position = "";


              resolve();
            }
          });
        }
        else
          resolve();
      });

      UWA.Promise.all([promise]).then(function() {

        var keysList = [];
        var keys = Object.keys(that._typeResult[nodeType.types/*node.types/*value*/]);
        var keysLength = keys.length;
        for (var i=0;i<keysLength;i++)
        {
          var key = keys[i];
          if (key)
            keysList.push({label: key, value: key});
        }

        var keysListLength = keysList.length;
        if (keysListLength > 0)
        {
          var comboAttributeKeys = document.getElementById("keys");
          comboAttributeKeys.dsModel.disabled = false;
          comboAttributeKeys.dsModel.elementsList = keysList;
        }

        var attributesList = [];
        var attributes = that._typeResult[nodeType.types/*node.types/*value*/][nodeType.keys/*node.keys*/].attributes;
        var attributesLength = attributes.length;
        for (var i=0;i<attributesLength;i++)
        {
          var attr = attributes[i];
          if (attr)
            attributesList.push({label: attr, value: attr});
        }

        var attributesListLength = attributesList.length;
        if (attributesListLength > 0)
        {
          var comboAttributes = document.getElementById("attributes");
          comboAttributes.dsModel.disabled = false;
          comboAttributes.dsModel.elementsList = attributesList;
        }

        DELConfigurationFamilyView.prototype.presetModal.call(that, node);
      });
    },


    /*
    * createtreeNode
    */
    createtreeNode : function createtreeNode(data, grid)
    {
      var translationModel = new DELConfigurationParamTranslationModel({
        data : data,
        grid : grid,
        nls : Apriso3DExpConfigurationNodeTreeViewNls});

        return translationModel;
    },

    /*
    * addChild
    */
    addChild : function addChild(nodesTab)
    {
        var that = this;
        that._parent(nodesTab);
    },

    /*
    * mapFunctions
    */
    mapFunctions: function mapFunctions(name)
    {
        var that = this;
        if (name === "onChangeTypeCombo")
          return that.onChangeTypeClick.bind(that);
        if (name === "onChangeKeyCombo")
          return that.onChangeKeyClick.bind(that);
        if (name === "getCellKeysSemantics")
          return that.getCellKeysSemantics.bind(that)
        if (name === "getCellAttributesSemantics")
          return that.getCellAttributesSemantics.bind(that)
        else return null;
    },

    /*
    * onCellViewChange
    */
    /*onCellViewChange : function onCellViewChange(iCellEvent, iCellInfos)
    {
      var that = this;
      that._parent(iCellEvent, iCellInfos);
    },*/

    /*
    * getCellAttributesSemantics
    */
    getCellAttributesSemantics : function getCellAttributesSemantics(iCellInfos)
    {
      var that = this;
      /*return {
          possibleValues: ["Australia", "Brazil", "China", "France", "Germany", "Italy", "Netherlands", "Sri Lanka", "United States"]
        };*/
      var type = iCellInfos.nodeModel.options.grid.types;
      var key = iCellInfos.nodeModel.options.grid.keys;

      var node = Object.assign({}, iCellInfos.nodeModel.options.grid);
      delete node["isDeployed"];
      delete node["delete"];
      delete node["edit"];

      if (node && that._node === null)
         that._node = node


      if (that._typeResult ===  null || that._typeResult[type] === undefined)
      {
          return {
            possibleValues: function(text) {
              return new Promise(function (resolve, reject) {

                  var listOfTypes = [];
                  listOfTypes.push(type);

                  if (that._typeResult ===  null)
                    that._typeResult = [];

                   ParameterizationApriso3DExpWebServices.getlistofDELMIATypes(listOfTypes, {
                     onSuccess : function(data)
                     {
                       that._typeResult[type] = data;
                       var attributes = that._typeResult[type][key].attributes;

                        resolve(attributes);
                     }
                  });
             });
          }
        };
      }
      else
      {
        if (that._typeResult[type] != undefined && that._typeResult[type][key] != undefined)
        {
          var data = that._typeResult[type][key].attributes;
          return {
              possibleValues: data
          };
        }
      }
    },

    /*
    * getCellKeysSemantics
    */
    getCellKeysSemantics : function getCellKeysSemantics(iCellInfos)
    {
      var that = this;
      /*return {
          possibleValues: ["Australia", "Brazil", "China", "France", "Germany", "Italy", "Netherlands", "Sri Lanka", "United States"]
        };*/
      var type = iCellInfos.nodeModel.options.grid.types;
      //var key = iCellInfos.nodeModel.options.grid.keys;
      var node = Object.assign({}, iCellInfos.nodeModel.options.grid);
      delete node["isDeployed"];
      delete node["delete"];
      delete node["edit"];

      if (node && that._node === null)
        that._node = node


      if (that._typeResult ===  null || that._typeResult[type] === undefined)
      {
          return {
            possibleValues: function(text) {
              return new Promise(function (resolve, reject) {

                  var listOfTypes = [];
                  listOfTypes.push(type);

                  if (that._typeResult ===  null)
                    that._typeResult = [];

                   ParameterizationApriso3DExpWebServices.getlistofDELMIATypes(listOfTypes, {
                     onSuccess : function(data)
                     {
                       iCellInfos.nodeModel.options.grid.attributes = "";


                       that._typeResult[type] = data;

                       var keysList = [];
                       var keys = Object.keys(data);
                       var keysLength = keys.length;
                       for (var i=0;i<keysLength;i++)
                       {
                         var key = keys[i];
                         if (key)
                           keysList.push(key);
                       }

                       var keysListLength = keysList.length;
                       if (keysListLength > 0)
                        resolve(keysList);
                     }
                   });
             });
          }
        };
      }
      else
      {
        var data = that._typeResult[type];

        var keysList = [];
        var keys = Object.keys(data);
        var keysLength = keys.length;
        for (var i=0;i<keysLength;i++)
        {
          var key = keys[i];
          if (key)
            keysList.push(key);
        }

        var keysListLength = keysList.length;
        if (keysListLength > 0)
        {
          return {
              possibleValues: keysList
          };
        }
      }
    },

    /*
    * onOKEditButtonClick
    */
    onOKEditButtonClick : function onOKEditButtonClick()
    {
      var that = this;
      that._parent();
    },

    /*
    * onOKButtonClick
    */
    onOKButtonClick : function onOKButtonClick()
    {
      var that = this;
      that._parent();
    },

    /*
    * onCancelButtonClick
    */
    onCancelButtonClick : function onCancelButtonClick()
    {
      var that = this;
      that._parent();
    },

    /*
    * onChangeTypeClick
    */
    onChangeTypeClick : function onChangeTypeClick(type)
    {
      var that = this;

      var types = null;
      if (type.dsModel != null || type.dsModel != undefined)
        types = type.dsModel.elementsList[type.dsModel.selectedIndex].value;

      var comboAttributeKeys = document.getElementById("keys");
      comboAttributeKeys.dsModel.disabled = true;
      comboAttributeKeys.dsModel.elementsList = [];
      comboAttributeKeys.dsModel.selectedIndex = -1;

      var comboAttributes = document.getElementById("attributes");
      comboAttributes.dsModel.disabled = true;
      comboAttributes.dsModel.elementsList = [];
      comboAttributes.dsModel.selectedIndex = -1;

      if (that._typeResult ===  null || that._typeResult[types] === undefined)
      {
        if (that._typeResult ===  null)
          that._typeResult = [];

        var listOfTypes = [];
        listOfTypes.push(types);

        //loader
        var loader = new WUXLoader({height : 22});
        loader.on(Apriso3DExpConfigurationModalViewNls.Loading);

        var parentNodeKeysContainer = comboAttributeKeys.getParent();
        parentNodeKeysContainer.style.position = "sticky";
        WUXModalContainer.createModal(parentNodeKeysContainer, loader.elements.container);

        var parentNodeAttrContainer = comboAttributes.getParent();
        parentNodeAttrContainer.style.position = "sticky";
        WUXModalContainer.createModal(parentNodeAttrContainer/*, loader.elements.container*/);

         ParameterizationApriso3DExpWebServices.getlistofDELMIATypes(listOfTypes, {
           onSuccess : function(data)
           {
             loader.off();
             WUXModalContainer.removeModal(parentNodeKeysContainer);
             WUXModalContainer.removeModal(parentNodeAttrContainer);

             parentNodeKeysContainer.style.position = "";
             parentNodeAttrContainer.style.position = "";

             that._typeResult[types] = data;

             var keysList = [];
             var keys = Object.keys(data);
             var keysLength = keys.length;
             for (var i=0;i<keysLength;i++)
             {
               var key = keys[i];
               if (key)
                 keysList.push({label: key, value: key});
             }

             var keysListLength = keysList.length;
             if (keysListLength > 0)
             {
               //var comboAttributeKeys = document.getElementById("keys");
               comboAttributeKeys.dsModel.disabled = false;
               comboAttributeKeys.dsModel.elementsList = keysList;
               comboAttributeKeys.dsModel.selectedIndex = -1;

               //var comboAttributes = document.getElementById("attributes");
               comboAttributes.dsModel.disabled = true;
               comboAttributes.dsModel.elementsList = [];
               comboAttributes.dsModel.selectedIndex = -1;
             }
           },
           onFailure : function(err)
           {
             loader.off();
             WUXModalContainer.removeModal(parentNodeKeysContainer);
             WUXModalContainer.removeModal(parentNodeAttrContainer);

             parentNodeKeysContainer.style.position = "";
             parentNodeAttrContainer.style.position = "";

             that.displayNotifications({
               level: 'error',
               message: Nls.getlistofDELMIATypesError,
               title: Nls.getlistofDELMIATypesTitle
             });
           }
       });
      }
      else
      {
        var data = that._typeResult[types];

        var keysList = [];
        var keys = Object.keys(data);
        var keysLength = keys.length;
        for (var i=0;i<keysLength;i++)
        {
          var key = keys[i];
          if (key)
            keysList.push({label: key, value: key});
        }

        var keysListLength = keysList.length;
        if (keysListLength > 0)
        {
          //var comboAttributeKeys = document.getElementById("keys");
          comboAttributeKeys.dsModel.disabled = false;
          comboAttributeKeys.dsModel.elementsList = keysList;
          comboAttributeKeys.dsModel.selectedIndex = -1;

          //var comboAttributes = document.getElementById("attributes");
          comboAttributes.dsModel.disabled = true;
          comboAttributes.dsModel.elementsList = [];
          comboAttributes.dsModel.selectedIndex = -1;
        }
      }
    },

    /*
    * onChangeKeyClick
    */
    onChangeKeyClick : function onChangeKeyClick(data)
    {
      var that = this;

      var typesElt = document.getElementById("types");
      var types = typesElt.dsModel.elementsList[typesElt.dsModel.selectedIndex].value;

      if (that._typeResult[types] != undefined && data.dsModel.elementsList[data.dsModel.selectedIndex] != undefined)
      {
        var attributesList = that._typeResult[types][data.dsModel.elementsList[data.dsModel.selectedIndex].value].attributes;

        var valuesList = [];
        var values = Object.values(attributesList);
        var valuesLength = values.length;
        for (var i=0;i<valuesLength;i++)
        {
          var value = values[i];
          if (value)
            valuesList.push({label: value, value: value});
        }

        if (valuesList.length > 0)
       {
         var comboAttributes = document.getElementById("attributes");
         comboAttributes.dsModel.disabled = false;
         comboAttributes.dsModel.elementsList = valuesList;
       }

      }
      else {
        var comboKeys = document.getElementById("keys");
        comboKeys.dsModel.disabled = true;
        comboKeys.dsModel.elementsList = [];
      }
    },

    /*
    * removeSelectedNode
    */
    removeSelectedNode : function removeSelectedNode(params)
    {
      console.log("params " + params);
      var that = this;
      that._parent(params);
    },

    /*
    * editSelectedNode
    */
    editSelectedNode : function editSelectedNode(params)
    {
      console.log("params " + params);
      var that = this;
      that._parent(params);
    }

  });



  return Apriso3DExpConfigurationFamilyView;
});

/**
* @quickreview  ROW 24:02:02 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDELUserExperience/DELProcessFlowDiagramAttributesConfigFamilyView',
    [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/ParameterizationDELUserExperience/DELProcessFlowDiagramBaseFamilyView',
    'DS/ParameterizationSkeleton/Model/DELConfigurationParameterizationModel/DELConfigurationParamTranslationModel',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DELUserExperienceConfiguration'
    ],
    function (
      UWA,
      DELProcessFlowDiagramBaseFamilyView,
      DELConfigurationParamTranslationModel,
      Nls
    )
  {

  'use strict';

  var DELProcessFlowDiagramAttributesConfigFamilyView = DELProcessFlowDiagramBaseFamilyView.extend({

    _attributesResult : null,
    _node : null,
    _bEditMode : false,


    /*
    * init
    */
    init : function init(options)
    {
      var that = this;
      this._parent(options);

      that._treeListViewNls = Nls;
      that._modalViewNls = Nls;
      that._nodeTreeViewNls = Nls;
      that._needTitleForTreeListView = true;

    },

    /*
    * render
    */
    render : function render()
    {
      var that = this;
      this._parent();

      return this;
    },

    /*
    * buildFamilyContent
    */
    buildFamilyContent: function buildFamilyContent() {

      var that = this;
      that._nodeTreeViewNls.treeViewTitle = that._nodeTreeViewNls.attributesTableName;
      
       var content  =this._parent();
       return content;
    },
    /*
    * buildModal
    */
    buildModal : function buildModal(bEditMod)
    {
      var that = this;
      that._modalViewNls.modalTitle = that._modalViewNls.attributesTableName;
      that._modalViewNls.Info = that._modalViewNls.Info_Attributes_modal;
      that._modalViewNls.attributeNameTooltip = that._modalViewNls.attributeNameTooltipForAttributesModal;
      this._parent(bEditMod);
      that._updateAttributesCombo('process');
    },

    /*
    * Overriding to add SequenceNumber as an attribute to be displayed in attributes table  
    */

    _getListOfElementsForAttributesCombo: function _getListOfElementsForAttributesCombo(data) {
      var that = this;
      var listForCombo = that._parent(data);
      if (listForCombo != undefined) {
        listForCombo.push({ label: Nls.SequenceNumber, value: "SequenceNumber" });
        if (listForCombo.length) {
          listForCombo.sort(function (comboValue1, comboValue2) {
            if (comboValue1.label.toLowerCase() === comboValue2.label.toLowerCase())
              return 0;
            return comboValue1.label.toLowerCase() > comboValue2.label.toLowerCase() ? 1 : -1;
          });
        }
      }
      return listForCombo;
    },

    /*
    * validateModal
    */
    validateModal : function validateModal()
    {
      var that = this;
      console.log("validateModal");

      var treeNodeModel = that._parent();
      if (treeNodeModel != undefined) {
        var data = treeNodeModel.getData();

        var bShowError = false;
        var strErrorMessage = Nls.ErrorMsgNotANumber;

        var widthValue = data['maxWidth'];
        if (widthValue != undefined && widthValue != "") {
          var widthNls = Nls.maxWidth;
          if (isNaN(widthValue)) {
            bShowError = true;
            strErrorMessage = strErrorMessage.replace("%1", widthNls);
            that._modalView.showToastMessage(2, strErrorMessage);
            return;
          }
          else if (!isNaN(widthValue)) {
            var n = Number(widthValue);
            if (n <= 0 || n > 100) {
              bShowError = true;
              strErrorMessage = Nls.ErrorMsgNotInRange;
              strErrorMessage = strErrorMessage.replace("%1", widthNls);
              that._modalView.showToastMessage(2, strErrorMessage);
              return;
            }
          }
        }
      }
      return treeNodeModel;
    },   
   /*
    * createtreeNode
    */
    createtreeNode : function createtreeNode(data, grid)
    {
      var that = this;

      var rowModelLength = that.treeListView.getRowModelLength();
      if(data["attributeName"] && grid!= undefined && grid["attributeName"] && data["rowIndex"] == undefined && grid["rowIndex"] == undefined)
      {
        var rowIndex = null;
        if(that._bEditMode)
          rowIndex =that._node.getData().rowIndex;
        else 
          rowIndex = (rowModelLength+1).toString();
        data["rowIndex"] = rowIndex;
        grid["rowIndex"] = rowIndex;
      }
      var translationModel = new DELConfigurationParamTranslationModel({
        data : data,
        grid : grid,
        nls: Nls
      });

      if (grid == undefined) {
        var gridTemp = translationModel.getGrid();
        if (!gridTemp.hasOwnProperty("mergeWithPreviousRow")) {
          translationModel.addGridAttributes({ ["mergeWithPreviousRow"]: false });
        }

        if (that._attributesResult != null && that._attributesResult != undefined && gridTemp != undefined && gridTemp.hasOwnProperty("attributeName") &&
          data["attributeName"] != undefined && data["attributeName"].includes('.')) {
          var storedAttribute = data["attributeName"];
          var dicoType = ((storedAttribute).split("."))[0];
          var attribute = ((storedAttribute).split("."))[1];//((((storedAttribute).split("."))[1]).split(" ("))[0];
          if (that._attributesResult['process'][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType] != undefined && that._attributesResult['process'][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType][attribute] != undefined) {
            var attrObj = that._attributesResult['process'][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType][attribute];
            var displayLabel = attrObj.NLSName + ' (' + attrObj.Owner + '.' + attribute + ')';
            gridTemp["attributeName"] = displayLabel;
          }
        }
      }

        return translationModel;
    },

    IsTableModified: function IsTableModified() {
      var that = this;
      var bTableModified = false;
      var numberOfRows = that.treeListView.getRowModelLength();
      for (var rowID = 0; rowID < numberOfRows; rowID++) {
        var attrColumnId = that.treeListView.layout.getColumnIndex("attributeName");
        var attrCellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: rowID, columnID: attrColumnId });
        var cellInfos = that.treeListView.getCellInfosAt(attrCellId);
        var rowIndex = cellInfos.nodeModel.options.data['rowIndex'];
        if (parseInt(rowIndex) != rowID + 1) {
          bTableModified = true;
          break;
        }
      }
      return bTableModified;
    },

    getRowDataFromTreeView: function getRowDataFromTreeView(rowID) {
      var that = this;
      var dataObject = that._parent(rowID);
      var rowNumber = rowID + 1;
      dataObject["rowIndex"] = rowNumber.toString();
      return dataObject;
    },

    /*
    * addChild
    */
    addChild : function addChild(nodesTab)
    {
        var that = this;
        nodesTab.sort(function(node1, node2){
          var ruleNumber1 = node1.getData().rowIndex;
          var ruleNumber2 = node2.getData().rowIndex;
          if(ruleNumber1 && ruleNumber2) {
            return parseInt(ruleNumber1) - parseInt(ruleNumber2);
          }
          return 0;
        })
        that._parent(nodesTab);
    },
  });
  return DELProcessFlowDiagramAttributesConfigFamilyView;
});

define("DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/Api3DSpaceBaseModel", ["require", "exports", "DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/ApiModel"], function (require, exports, ApiModelModule) {
    "use strict";
    var ParameterizationURLHandlerPath = 'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler';
    var Api3DSpaceBaseModelModule;
    (function (Api3DSpaceBaseModelModule) {
        ;
        Api3DSpaceBaseModelModule.Api3DSpaceBaseModel = ApiModelModule.ApiModel.extend({
            setup: function (attributes, options) {
                this._parent(attributes, options);
                this.configHelper = options.configHelper;
            },
            /** Returns the current tenant */
            getTenant: function () {
                if (this.promiseTenant) {
                    return this.promiseTenant;
                }
                if (this.configHelper) {
                    this.promiseTenant = Promise.resolve(this.configHelper.getTenant());
                }
                else {
                    this.promiseTenant = new Promise(function (resolve, reject) {
                        new Promise(function (resolve_1, reject_1) { require([ParameterizationURLHandlerPath], resolve_1, reject_1); }).then(function (ParameterizationURLHandler) {
                            resolve(ParameterizationURLHandler.getTenant());
                        });
                    });
                }
                return this.promiseTenant;
            },
            /** Returns the space service url */
            get3DSpaceUrl: function () {
                if (this.promise3DSpaceUrl) {
                    return this.promise3DSpaceUrl;
                }
                if (this.configHelper) {
                    this.promise3DSpaceUrl = this.configHelper.get3DSpaceUrl();
                }
                else {
                    this.promise3DSpaceUrl = new Promise(function (resolve, reject) {
                        new Promise(function (resolve_2, reject_2) { require([ParameterizationURLHandlerPath], resolve_2, reject_2); }).then(function (ParameterizationURLHandler) {
                            resolve(ParameterizationURLHandler.getURL());
                        });
                    });
                }
                return this.promise3DSpaceUrl;
            }
        });
    })(Api3DSpaceBaseModelModule || (Api3DSpaceBaseModelModule = {}));
    ;
    return Api3DSpaceBaseModelModule;
});

/**
* @quickreview  KB9 21:10:25 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationApriso3DExperience/Apriso3DExpConfigurationLayoutView',
    [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationLayoutView',
    'DS/ParameterizationSkeleton/Views/ParameterizationApriso3DExperience/Apriso3DExpConfigurationFamilyView'
    ],
    function (
      UWA,
      DELConfigurationLayoutView,
      Apriso3DExpConfigurationFamilyView
    )
  {

  'use strict';

  var Apriso3DExpConfigurationLayoutView = DELConfigurationLayoutView.extend({

    /*
    * init
    */
    init : function init(options)
    {
      var that = this;
      this._parent(options);
    },

    /*
    * onCompleteRequestParameters
    */
    onCompleteRequestParameters : function onCompleteRequestParameters() {
      //removeApply Reset div
      var eltUI = document.getElementById("ApplyResetDiv");
      if (eltUI)
      {
          var parentNode = eltUI.getParent();
          parentNode.removeChild(eltUI);
      }

      this._parent();
    },

    /*
    * buildParameterLine
    */
    buildParameterLine : function (iParamObj, familyID, familytbody, popoverPosition) {

      var that = this;
      var args = iParamObj.argument;
      for (var i=0;i<args.length;i++)
      {
        var arg = args[i];
        if (arg && arg.defaultValue === "DELConfigurationTreeListView")
        {
          //this.nbofShownParameters++;
          var contentTreeView = UWA.createElement('div');

          var options = {};
          options.xmlDoc = that._xmlMap.get(arg.id);
          options.domainid = that._domainID;
          options.familyid = familyID;
          options.parameterid = iParamObj.id;
          options.argid = arg.id;

          options.treeListViewNls = that._xmlNls.get(arg.id)[0];
          options.modalViewNls = that._xmlNls.get(arg.id)[1];
          options.nodeTreeViewNls = that._xmlNls.get(arg.id)[2];

          //var familyView = new Apriso3DExpConfigurationFamilyView(options);
          that._familyView = new Apriso3DExpConfigurationFamilyView(options);
          that._listOfFamilyViews.push(that._familyView);

          var treelistViewContent = that._familyView.buildFamilyContent();
          treelistViewContent.inject(familytbody);
        }
        else
          this._parent(iParamObj, familyID, familytbody, popoverPosition);
      }
    }

    /*
    * buildFamilyItemContent
    */
    /*buildFamilyItemContent : function buildFamilyItemContent(iFamily, familyPosition) {
      var that = this;

      if (that._xmlMap.get(iFamily.id))
      {
        this.nbofShownParameters++;
        var contentTreeView = UWA.createElement('div');

        var options = {};
        options.xmlDoc = that._xmlMap.get(iFamily.id);
        options.domainid = that._domainID;

        var familyView = new Apriso3DExpConfigurationFamilyView(options);
        return familyView.buildFamilyContent(iFamily, familyPosition);
        //family.inject(contentTreeView);
      }
      else
        return this._parent(iFamily, familyPosition);
    }*/

  });



  return Apriso3DExpConfigurationLayoutView;
});

/**
* @quickreview  KB9 21:10:25 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationApriso3DExperience/Apriso3DExpConfigurationParentView',
		[
	 'UWA/Core',
	 'DS/ParameterizationSkeleton/Views/ParametersParentView',
	 'DS/ParameterizationSkeleton/Views/ParameterizationApriso3DExperience/Apriso3DExpConfigurationLayoutView'
	 ],
	 function (
		 UWA,
		 ParametersParentView,
		 Apriso3DExpConfigurationLayoutView
		)
{

	'use strict';


	var Apriso3DExpConfigurationParentView = ParametersParentView.extend({

		init: function (options) {
			options = UWA.clone(options || {}, false);
			this._domainID = options.domainid;
			this._parent(options);
		},

		setup: function (options) {
			UWA.log('Apriso3DExpConfigurationParentView Layout::setup!');
			UWA.log(options);

		},

		render : function()
		{
			var that = this;
			var options = this.options;

		  var layoutView = new Apriso3DExpConfigurationLayoutView(options);
			return layoutView.render();
		}
	});

	return Apriso3DExpConfigurationParentView;
});

/**
* @quickreview  ROW 24:08:30 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDigitalManufacturing/DigitalMfgOOTBRolesConfigFamilyView',
  [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
    'i18n!DS/ParameterizationSkeleton/assets/nls/OOTBRolesModalView',
    'i18n!DS/ParameterizationSkeleton/assets/nls/OOTBRolesNodeTreeView',
    'i18n!DS/ParameterizationSkeleton/assets/nls/OOTBRolesTreeListView'
  ],
  function (
    UWA,
    DELConfigurationFamilyView,
    NlsModalView,
    NlsNodeTreeView,
    NlsTreeListView,
  ) {

    'use strict';

    var DigitalMfgOOTBRolesConfigFamilyView = DELConfigurationFamilyView.extend({

      _node: null,
      _bEditMode: false,

      /*
      * init
      */
      init: function init(options) {
        var that = this;
        this._parent(options);

        that._treeListViewNls = NlsTreeListView;
        that._modalViewNls = NlsModalView;
        that._nodeTreeViewNls = NlsNodeTreeView;
      },
      /*
      * onOKEditButtonClick
      */
      onOKEditButtonClick: function onOKEditButtonClick() {
        var that = this;
        that._bEditMode = true;
        that._parent();
        that._bEditMode = false;
      },

      /*
      * onCancelButtonClick
      */
      onCancelButtonClick: function onCancelButtonClick() {
        var that = this;
        that._parent();
        that._bEditMode = false;
      },
      
      /*
      * editSelectedNode
      */
      editSelectedNode: function editSelectedNode(params) {
        console.log("params " + params);
        var that = this;
        that._bEditMode = true;
        that._parent(params);
      },

      /*
      * validateModal
      */
      validateModal: function validateModal() {
        var that = this;
        console.log("validateModal");

        var treeNodeModel = that._parent();
        if (treeNodeModel != undefined) {
          var data = treeNodeModel.getData();

          var newRowModelLength = that.treeListView.getRowModelLength();
          var listCutoRolesAlreadyDefined = [];

          if (newRowModelLength) {
            for (var rowIndex = 0; rowIndex < newRowModelLength; rowIndex++) {
              var dataObject = that.getRowDataFromTreeView(rowIndex);
              listCutoRolesAlreadyDefined.push(dataObject['rolecusto']);
            }
          }

          var bShowError = false;

          var roleCustoNls = NlsTreeListView.rolecusto;
          var custoRoleValue = data['rolecusto'];
          var editNodeRoleCustom = "";
          if (that._bEditMode) {
            var nodeData = that._node.getData();
            editNodeRoleCustom = nodeData["rolecusto"];
          }
          if ((!that._bEditMode && listCutoRolesAlreadyDefined.includes(custoRoleValue)) || (that._bEditMode && editNodeRoleCustom != custoRoleValue && listCutoRolesAlreadyDefined.includes(custoRoleValue))) {
            var strErrorMessage = NlsModalView.ErrorCustoRoleAlreadyDefined;

            bShowError = true;
            strErrorMessage = strErrorMessage.replace("%1", roleCustoNls);
            strErrorMessage = strErrorMessage.replace("%2", roleCustoNls);
          }

          if (bShowError) {
            that._modalView.showToastMessage(2, strErrorMessage);
            return;
          }
        }
        return treeNodeModel;
      }

    });
    return DigitalMfgOOTBRolesConfigFamilyView;
  });

define('DS/ParameterizationSkeleton/Views/ParamSpecificationManagement/SpecParamCustomizationUtility', [
	'UWA/Core',
	'DS/WAFData/WAFData',
	'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
], 
function (UWA,  WAFData, URLHandler) {
	
	/**
	 * @description Helper to call a web service.
     * This helper is adding security context first and if it success it calls the api.
	 * @param {String} url The web service route
	 * @param {String} methodType HTTP Protocole : GET / POST / PUT ...
	 * @param {String} data the data to send to the web service
	 * @param {Function} onSuccess onSuccess callback function
	 * @param {Function} onFailure onFailure callback function
	 */
	const requestHelper = function(url, methodType, data, onSuccess, onFailure){
		const urlSecurityContext =URLHandler.getURL() +"/resources/pno/person/getsecuritycontext?tenant=" + URLHandler.getTenant();
		console.log("Get security context:");
		WAFData.authenticatedRequest(urlSecurityContext, {
			timeout : 250000,
			method : 'GET',
			data : "",
			type : 'json',
			headers : {
				'Content-Type' : 'application/json',
				'Accept' : 'application/json'
			},
			onFailure : function (json) {
                UWA.log('SpecParamCustomizationUtility::requestHelper - Failure');
				UWA.log(json);
				console.log(json);
			},
			onComplete: function(securityContext) {
				const urlFinal =URLHandler.getURL()+ url + "?tenant=" + URLHandler.getTenant();
				WAFData.authenticatedRequest(urlFinal, {
					timeout : 250000,
					method : methodType,
					data : data,
					type : 'json',
					headers : {
						'Content-Type' : 'application/json',
						'Accept' : 'application/json',
						'SecurityContext' : securityContext.SecurityContext,
						'ENO_CSRF_TOKEN':''
					},
					onFailure : function (result) {
                        UWA.log('SpecParamCustomizationUtility::requestHelper - Failure');
						UWA.log(result);
						onFailure(result);
					},
                    onComplete: function (result) {
                        UWA.log('SpecParamCustomizationUtility::requestHelper - Success');
                        UWA.log(result);
                        onSuccess(result);
					}
				});
			}
		});
	}

	/**
	 * Permits to push date or unit value easily
	 * @param {Boolean} setValue 
	 * @param {String} type
	 * @param {*} onSuccessCallback 
	 * @param {*} onFailureCallback 
	 */
	const postParamsArrOnServer = function (setValue, type,onSuccessCallback,onFailureCallback) {
	
		var data = [JSON.parse("{\"domain\":\"SpecificationManagement\",\"id\":\""+type+"\",\"argument\":[{\"id\":\"Argument\",\"value\":\""+setValue+"\"}]}")];
		
		var url = URLHandler.getURL() + "/resources/ParamWS/access/postparams?tenant=" + URLHandler.getTenant(),
			datatoSend = {
				domain    : "SpecificationManagement",
				parameter : data
            };

		WAFData.authenticatedRequest(url, {
			timeout: 100000,
			method: 'POST',
			data: JSON.stringify(datatoSend),
			type: 'json',

			headers: {
				'Content-Type' : 'application/json',
				'Accept' : 'application/json'
			},

			onFailure : function (json) {
				onFailureCallback(json);
			},

			onComplete: function(json) {
				if(!(json.deployStatus === "S_OK")){
					onFailureCallback(json);	
					return;
				}
				onSuccessCallback(json);
			}
		});
	}


    return {

        getParametrizationInformation: function (type, onSuccesCallback, onFailureCallback) {
            var url =  "/resources/modeler/configuration/settingsServices/getConfigurationSettings";
            var jsonData = {
                "version": "1.0",
                "settings": [type]
            };
            requestHelper(url, "POST",JSON.stringify(jsonData), onSuccesCallback, onFailureCallback);
        },
        
        getTypesFromServer : function (type, onSuccessCallback, onFailureCallback) {
          	let url = URLHandler.getURL();
           	let datatoSend = {};
            datatoSend.data ={};
            datatoSend.data.serviceType = "supportedTypes";
     		let serviceURL = "/resources/v1/specadmin/Config/SupportConfiguration";
  
          	if(type === "productSpecTypes"){ 
          		 datatoSend.feature="ProductSpecification";
          	}else if(type === "rawMaterialTypes"){ 
          		 datatoSend.feature="RawMaterial";
          	}

          	 url = url + serviceURL+"?tenant=" + URLHandler.getTenant();
          		 
          		 WAFData.authenticatedRequest(url, {
                       timeout: 100000,
                       method: 'POST',
                       data: JSON.stringify(datatoSend),
                       type: 'json',
                       headers: {
                           'Content-Type': 'application/json',
                           'Accept-Language' : widget.lang,
                           'Accept': 'application/json'
                       },

                       onFailure: function (json) {
                           onFailureCallback(json);
                       },

                       onComplete: function (json) {
                           onSuccessCallback(json.result.supportedTypes);
                       }
                   });   	
          },
          
          getAdminTypesFromPageObject : function (type, onSuccessCallback, onFailureCallback) {
        	  	 var url = URLHandler.getURL();
        	  	 var that = this;
        	  	 var pageName = "";
        	  	 if(type === "rawMaterialTypes"){
        	  		pageName = "RawMaterial";
        	  	 }else if(type === "productSpecTypes"){ 
        	  			pageName = "ProductSpecification";
        	  	 }else if(type === "formulatedPrdConfig"){ 
        	  			pageName = "FormulatedProduct";
        	  	 }
        	  	 
        	//	 var serviceURL = "/resources/RawMaterial/v1/Raw_Material/getAdminConfigList/"+pageName;
        		 var serviceURL = "/resources/v1/specadmin/Config/AdminConfiguration/"+pageName;

            	 url = url + serviceURL+"?tenant=" + URLHandler.getTenant();
            		 
            		 WAFData.authenticatedRequest(url, {
                         timeout: 100000,
                         method: 'GET',
                         type: 'json',
                         headers: {
                             'Content-Type': 'application/json',
                             'Accept-Language' : widget.lang,
                             'Accept': 'application/json'
                         },

                         onFailure: function (json) {
                             onFailureCallback(json);
                         },

                         onComplete: function (json) {
                             onSuccessCallback(json);
                         }
                     });
            	            	
            },
            
          saveSubTypesConfig:function (pageName, selectedData, onSuccessCallback, onFailureCallback) {

            var url = URLHandler.getURL() + "/resources/v1/specadmin/Config/AdminConfiguration?tenant=" + URLHandler.getTenant();
            
            let datatoSend = {};
            datatoSend.order="1.0";
            datatoSend.data={};
            datatoSend.data.content=JSON.stringify(selectedData);
            datatoSend.feature=pageName;

            WAFData.authenticatedRequest(url, {
                timeout: 100000,
                method: 'POST',
                data: JSON.stringify(datatoSend),
                type: 'json',

                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },

                onFailure: function (json) {
                    onFailureCallback(json);
                },

                onComplete: function (json) {
                     onSuccessCallback(json);
                }
            });
        },
        

        /**
	     * 
	     * @param {*} onSuccessCallback 
	     * @param {*} onFailureCallback 
	     */
         getParamsFromServer : function (type, onSuccessCallback, onFailureCallback) {

            var url = URLHandler.getURL() + "/resources/ParamWS/access/DomainElements?tenant=" + URLHandler.getTenant() + "&domainid=SpecificationManagement",
                 datatoSend = "";

            WAFData.authenticatedRequest(url, {
                timeout: 100000,
                method: 'GET',
                data: JSON.stringify(datatoSend),
                type: 'json',

                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },

                onFailure: function (json) {
                    onFailureCallback(json);
                },

                onComplete: function (json) {
                    if (type === "templateOptional")
                        onSuccessCallback(json.family[0].parameter[0].argument[0].argValue);
                    else if (type === "ModelingandSimulationOptional")
                        onSuccessCallback(json.family[0].parameter[1].argument[0].argValue);//FUN152060- retrive value for ModelingandSimulationOptional in material section 
                    else if (type === "FormulaOptional")
                        onSuccessCallback(json.family[0].parameter[2].argument[0].argValue);//FUN152060-retrive value for FormulaOptional in material section
                    else if (type === "prodSpecOptional")
                        onSuccessCallback(json.family[0].parameter[3].argument[0].argValue);
                    else if (type === "prodSpecOOTBTypeOptional")
                        onSuccessCallback(json.family[0].parameter[4].argument[0].argValue);
                    else if (type === "formulatedPrdConfig")
						onSuccessCallback(json.family[0].parameter[5].argument[0].argValue);
                }
            });
        },
        
		//FUN152060-service introduced to check if formulated products are linked to recipe
        /**
	     * 
	     * @param {*} onSuccessCallback 
	     * @param {*} onFailureCallback 
	     */
         getLinkInfoFromServer : function () {
			//IR-1325526 & IR-1325530- method is modified to return promise
			 return new Promise(function (resolve, reject) {
				 var url = URLHandler.getURL() + "/resources/formulatedproduct/v1/formulatedproduct/recipelink",
					 datatoSend = "";

				 WAFData.authenticatedRequest(url, {
					 timeout: 100000,
					 method: 'GET',
					 data: JSON.stringify(datatoSend),
					 type: 'json',

					 headers: {
						 'Content-Type': 'application/json',
						 'Accept': 'application/json'
					 },
					 onComplete: function (response) {

						 resolve(response.hasLink);
					 },
					 onFailure: function (response) {
						 reject(response);
					 }
				 });
			});
        },
		//
        
	    /**
	     * Call postparams webService to set ProdSpecOptional param
	     * @param {Boolean} status 
	     */
		setProdSpecOptionalParam: function(status, onSuccessCallback, onFailureCallback){
			postParamsArrOnServer(status,"ProductSpecificationCreateOptional",onSuccessCallback ,onFailureCallback );
		},
		/**
	     * Call postparams webService to set TemplateOptional Param
	     * @param {Boolean} status 
	     */
		setOOTBSubTypesOptional: function(status,onSuccessCallback,onFailureCallback){
			postParamsArrOnServer(status,"EnableOOTBProductSpecTypes",onSuccessCallback ,onFailureCallback );
		},
	    /**
	     * Call postparams webService to set TemplateOptional Param
	     * @param {Boolean} status 
	     */
		setTemplateOptionalParam: function(status,onSuccessCallback,onFailureCallback){
			postParamsArrOnServer(status,"SpecificationTemplateOptional",onSuccessCallback ,onFailureCallback );
		},

	    /**
	     * FUN152060-Call postparams webService to set ModelingandSimulationOptional Param
	     * @param {Boolean} status 
	     */
		setModelingandSimulationOptionalParam: function(status,onSuccessCallback,onFailureCallback){
			postParamsArrOnServer(status,"MaterialModelingandSimulationOptional",onSuccessCallback ,onFailureCallback );
		},
		//

	    /**
	     * FUN152060-Call postparams webService to set FormulaOptional Param
	     * @param {Boolean} status 
	     */
		setFormulaOptionalParam: function(status,onSuccessCallback,onFailureCallback){
			postParamsArrOnServer(status,"MaterialFormulaOptional",onSuccessCallback ,onFailureCallback );
		},
		//
		
		/**
	     * Call postparams webService to set FormulaBOMUnits Param
	     */
		setFormulaBOMUnitsParam: function(status,onSuccessCallback,onFailureCallback){
			postParamsArrOnServer(status,"FormulaBOMUnits",onSuccessCallback ,onFailureCallback );
		},


	}
    });

/**
* @quickreview  ROW 24:04:02 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDigitalManufacturing/DigitalMfgConfigLayoutView',
  [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationLayoutView',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
    'DS/ParameterizationSkeleton/Views/ParameterizationDigitalManufacturing/DigitalMfgChangeOverOperationMgmtAttributesConfigFamilyView',
    'DS/ParameterizationSkeleton/Views/ParameterizationDigitalManufacturing/DigitalMfgOOTBRolesConfigFamilyView',
    'DS/ParameterizationSkeleton/Views/ParameterizationDigitalManufacturing/DigitalMfgRolesOnProcessInstanceConfigFamilyView',
    'DS/ParameterizationSkeleton/Views/ParameterizationDigitalManufacturing/DigitalMfgActionsOnOpItemImplLinkConfigFamilyView',
    'DS/ParameterizationSkeleton/Utils/DELConfigurationParameterization/DELConfigurationParameterizationWebServices',
    'DS/UIKIT/Mask',
  ],
  function (
    UWA,
    DELConfigurationLayoutView,
    DELConfigurationFamilyView,
    DigitalMfgChangeOverOperationMgmtAttributesConfigFamilyView,
    DigitalMfgOOTBRolesConfigFamilyView,
    DigitalMfgRolesOnProcessInstanceConfigFamilyView,
    DigitalMfgActionsOnOpItemImplLinkConfigFamilyView,
    DELConfigurationParameterizationWebServices,
    Mask
  ) {

    'use strict';

    var DigitalMfgConfigLayoutView = DELConfigurationLayoutView.extend({

      /*
      * init
      */
      init: function init(options) {
        this._parent(options);

      },
      /*
      * onCompleteRequestParameters
      */
      onCompleteRequestParameters: function onCompleteRequestParameters() {
        //removeApply Reset div
        var eltUI = document.getElementById("ApplyResetDiv");
        if (eltUI) {
          var parentNode = eltUI.getParent();
          parentNode.removeChild(eltUI);
        }

        this._parent();
      },
      /*
      * render
      */
      render: function render() {
        var that = this;


        var promiseTab = [];
        var promiseEnvVar = new Promise(function (resolve, reject){
        DELConfigurationParameterizationWebServices.getEnvVar({
          onSuccess : function(mapvarEnv)
          {
            that._mapvarEnv = mapvarEnv;
              resolve();
          },
          onFailure : function(error)
          {
              reject("DELConfigurationParameterizationWebServices.getEnvVar");
            console.error("DELConfigurationParameterizationWebServices.getEnvVar");
          }
        });
        });

        promiseTab.push(promiseEnvVar);
        UWA.Promise.all(promiseTab).then(function(data) {
          DELConfigurationLayoutView.prototype.render.call(that);
          //Collection.prototype.fetch.call(that);
        });
        //this._parent();

        return this;
      },

      /*
      * buildParameterLine
      */
      buildParameterLine: function (iParamObj, familyID, familytbody, popoverPosition) {

        var that = this;
        if (that._mapFamily)
          that._mapFamily.set(iParamObj.id, familyID);

        var args = iParamObj.argument;
        for (var i = 0; i < args.length; i++) {
          var arg = args[i];
          if (arg && arg.defaultValue === "DELConfigurationTreeListView") {
            //that.nbofShownParameters++;
            familytbody.parentElement.style.marginLeft = '-14px';
            var newParamline = UWA.createElement('tr', { title: '' });//iParamObj.tooltipNlsKey
            var paramTreeListViewCell = UWA.createElement('td', {
              'width': '100%',
              'title': '',
              'colspan': '4'
            });
            paramTreeListViewCell.setStyle("vertical-align", "text-bottom");

            var contentTreeView = UWA.createElement('div');
            contentTreeView.className = "treeListView";

            var options = {};
            options.xmlDoc = that._xmlMap.get(arg.id);
            options.domainid = that._domainID;
            options.familyid = familyID;
            options.parameterid = iParamObj.id;
            options.argid = arg.id;

            if (that._xmlNls.get(arg.id)[0])
              options.treeListViewNls = that._xmlNls.get(arg.id)[0];
            if (that._xmlNls.get(arg.id)[1])
              options.modalViewNls = that._xmlNls.get(arg.id)[1];
            if (that._xmlNls.get(arg.id)[2])
              options.nodeTreeViewNls = that._xmlNls.get(arg.id)[2];

              var familyView = null;
              if(arg.id === "ChangeOverOperationAttributesListArg"){
                familyView = new DigitalMfgChangeOverOperationMgmtAttributesConfigFamilyView(options);
              }
              else if(arg.id === "OOTBRolesLayoutTreeListViewArg"){
                familyView = new DigitalMfgOOTBRolesConfigFamilyView(options);
              }
              else if(arg.id === "RolesOnProcessInstanceTreeListViewArg"){
                familyView = new DigitalMfgRolesOnProcessInstanceConfigFamilyView(options);
              }
              else if(arg.id === "ActionsOnOpItemImplLinkTreeListViewArg"){
                familyView = new DigitalMfgActionsOnOpItemImplLinkConfigFamilyView(options);
              }
              else
                familyView = new DELConfigurationFamilyView(options);
              if( familyView != null && (arg.id === "ChangeOverOperationAttributesListArg" ))
              {
                Mask.mask(familytbody);
                UWA.Promise.all([familyView.getPromisetoGetInfofromDB()]).then(function () {
                  that._listOfFamilyViews.push(familyView);
                  var familyViewContent = familyView.buildFamilyContent();
                  familyViewContent.inject(contentTreeView);
                  contentTreeView.inject(paramTreeListViewCell);
                  paramTreeListViewCell.inject(newParamline);
                  Mask.unmask(familytbody);
                }).catch(e=>{
                  console.log(e);
                });
                newParamline.inject(familytbody);
            
              }
              else{
                that._listOfFamilyViews.push(familyView);
                var familyViewContent = familyView.buildFamilyContent();
                familyViewContent.inject(contentTreeView);
                contentTreeView.inject(paramTreeListViewCell);
                paramTreeListViewCell.inject(newParamline);
                newParamline.inject(familytbody);
              }
          }
          else
            this._parent(iParamObj, familyID, familytbody, popoverPosition);
        
        }
      },
      /*
      * onUpdateParameterSuccess
      */
      onUpdateParameterSuccess: function onUpdateParameterSuccess(i_familyID, i_paramID, i_paramValue) {
        var that = this;
        var str_ctxImplLinksParamID = "ContextualILCheckbox";
        var str_enableEngineeringNotesParamID = "EnableEngineeringNotesCheckbox";
        if (i_familyID === "MfgItemsBehavior" && (i_paramID === str_ctxImplLinksParamID ||i_paramID === str_enableEngineeringNotesParamID)) {
          that.EnableDisableMfgItemsBehaviorFamilyContent();
        }
      },

      /*
      * PostBuildFamilyContent
      */
      PostBuildFamilyContent: function PostBuildFamilyContent(){
        var that = this;
        that.EnableDisableMfgItemsBehaviorFamilyContent();
      },

      /*
      * EnableDisableMfgItemsBehaviorFamilyContent
      * The below function is to manage exclusivity of checkboxes for Contextual Implement links and Engineering notes.
      * This means, at a time, only one of them can be checked.
      * This can be removed when the applications are able to manage these options together.
      */
      EnableDisableMfgItemsBehaviorFamilyContent: function EnableDisableMfgItemsBehaviorFamilyContent(){
        var that = this;
        var str_ctxImplLinksParamID = "ContextualILCheckbox";
        var str_enableEngineeringNotesParamID = "EnableEngineeringNotesCheckbox";
          var divElementctxImplLinksParam = null;
          var divElementenableEngineeringNotesParam = null;

          Array.from(document.getElementById("MfgItemsBehaviorfamilytbody").rows).forEach(element => {
            Array.from(element.cells).forEach(cell => {
              if (cell.innerHTML.includes(str_enableEngineeringNotesParamID)) {
                divElementenableEngineeringNotesParam = element;
              }
              else if (cell.innerHTML.includes(str_ctxImplLinksParamID)) {
                divElementctxImplLinksParam = element;
              }
            });
          });


        if (divElementenableEngineeringNotesParam != null) {
          Array.from(divElementenableEngineeringNotesParam.cells).forEach(cell => {
            if (document.querySelector("#ContextualILCheckbox").checked) {
              if (!cell.innerHTML.includes("info"))
                cell.setStyles({ "pointerEvents": "none", "opacity": "0.3" });
              else
                cell.setStyles({ "pointerEvents": "auto", "opacity": "0.3" });
              document.querySelector("#EnableEngineeringNotesCheckbox").disabled = true;
            }
            else{
              cell.setStyles({ "pointerEvents": "auto", "opacity": "1.0" });
              document.querySelector("#EnableEngineeringNotesCheckbox").disabled = false;
            }
          });
        }

        if (divElementctxImplLinksParam != null) {
          Array.from(divElementctxImplLinksParam.cells).forEach(cell => {
            if (document.querySelector("#EnableEngineeringNotesCheckbox").checked) {
              if (!cell.innerHTML.includes("info"))
                cell.setStyles({ "pointerEvents": "none", "opacity": "0.3" });
              else
                cell.setStyles({ "pointerEvents": "auto", "opacity": "0.3" });
              document.querySelector("#ContextualILCheckbox").disabled = true;
            }
            else{
              cell.setStyles({ "pointerEvents": "auto", "opacity": "1.0" });
              document.querySelector("#ContextualILCheckbox").disabled = false;
            }
          });
        }
      }

    });
    return DigitalMfgConfigLayoutView;
  });

/**
* @quickreview  KB9 21:10:25 creation
*/

define('DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationParentView',
		[
	 'UWA/Core',
	 'DS/ParameterizationSkeleton/Views/ParametersParentView',
	 'DS/ParameterizationSkeleton/Views/ParameterizationDigitalManufacturing/DigitalMfgConfigLayoutView'
	 ],
	 function (
		 UWA,
		 ParametersParentView,
		 DigitalMfgConfigLayoutView
		)
{

	'use strict';


	var DELConfigurationParentView = ParametersParentView.extend({

		init: function (options) {
			options = UWA.clone(options || {}, false);
			this._domainID = options.domainid;
			this._layoutView = null;
			this._parent(options);
		},

		setup: function (options) {
			UWA.log('DELConfigurationParentView Layout::setup!');
			UWA.log(options);

		},

		destroy : function()
		{
			var that = this;
			that._parent();

			if (that._layoutView)
			that._layoutView.destroy();
		},


		render : function()
		{
			var that = this;
			var options = this.options;

		  //var layoutView = new DELConfigurationLayoutView(options);
			//return layoutView.render();
			that._layoutView = new DigitalMfgConfigLayoutView(options);
			return that._layoutView.render();
		}
	});

	return DELConfigurationParentView;
});

define("DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/Type", ["require", "exports", "UWA/Class/Model", "UWA/Class/Collection", "DS/ParameterizationSkeleton/Utils/ParameterizationPartSupply/Utils", "DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/Attribute"], function (require, exports, Model, Collection, Utils, AttributeModule) {
    "use strict";
    var TypeModule;
    (function (TypeModule) {
        TypeModule.Type = Model.extend({
            getId: function () {
                return this.get('Name');
            },
            getLabel: function () {
                var label = this.getId();
                if (this.get('NameNLS')) {
                    if (this.get('NameNLS')[Utils.Utils.getLang()]) {
                        label = this.get('NameNLS')[Utils.Utils.getLang()];
                    }
                    else if (this.get('NameNLS')['en']) {
                        label = this.get('NameNLS')['en'];
                    }
                }
                return label;
            },
            getParentId: function () {
                return this.get('Parent');
            },
            getAttributes: function () {
                return this.get('Attributes');
            },
            parse: function (data, options) {
                data.Attributes = new Collection(Object.keys(data.Attributes).map(function (key) {
                    return data.Attributes[key];
                }), {
                    model: AttributeModule.Attribute,
                    parse: true,
                    custom: options.collection.isCustom()
                });
                // add "Custom" attribute to set if it is a Custom Type or an OOTB Type
                data.Custom = options.collection.isCustom();
                return this._parent(data, options);
            },
            setParents: function (parents) {
                this.parents = new Collection(parents);
            },
            getParents: function () {
                if (!this.parents) {
                    throw new Error('parents must be computed');
                }
                return this.parents;
            },
            findParentByType: function (typeName) {
                return this.getParents().findWhere({ 'Name': typeName });
            },
            isCustom: function () {
                return this.get('Custom');
            },
            computeAllAttributes: function () {
                var allAttributes = [];
                allAttributes = allAttributes.concat(this.getAttributes().toArray());
                this.getParents().forEach(function (parent) {
                    allAttributes = allAttributes.concat(parent.getAttributes().toArray());
                });
                this.attributes = new Collection(allAttributes);
            },
            getAllAttributes: function () {
                if (!this.attributes) {
                    throw new Error('attributes must be computed');
                }
                return this.attributes;
            },
            getAllSupportedAttributes: function (onlyCustom) {
                return new Collection(this.getAllAttributes().filter(function (attribute) {
                    return attribute.isSupported(onlyCustom);
                }));
            }
        });
    })(TypeModule || (TypeModule = {}));
    ;
    return TypeModule;
});

/**
* @quickreview  ROW 25:02:11
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDisplayProperties/DPConfigurationTreeListView',
[
  'UWA/Class',
  'DS/TreeModel/TreeDocument',
  'DS/DataGridView/DataGridView',
  'DS/ParameterizationSkeleton/Views/ParameterizationDisplayProperties/DPConfigurationTreeListViewConstants',
  'i18n!DS/ParameterizationSkeleton/assets/nls/DisplayPropertiesNLS',
  'css!DS/ParameterizationSkeleton/ParameterizationSkeleton'
],
function
(
  Class,
  TreeDocument,
  DataGridView,
  DPConfigurationTreeListViewConstants,
  DisplayPropertiesNLS
)
{
  'use strict';

  var DPConfigurationTreeListView = Class.extend({

    _nls : null,

    /*
    * init
    */
    init : function init(options)
    {
      var that = this;
      that._nls = options.nls;
      that._paramID = options.paramid;

      var colLabelsNls = options.nls;

      that._columnsIDs = [];
      that._columnsVisibilityStatus = [];
      that._columnsCellSemantics = [];

      var columns = options.columns;
      var colLength = columns.length;
      for (var i = 0; i < colLength; i++) {
        that._columnsIDs.push(columns[i].id);
        that._columnsCellSemantics.push(columns[i].onCellSemantics);
        that._columnsVisibilityStatus.push(columns[i].hidden);
      }

      that._treeListViewConstants = new DPConfigurationTreeListViewConstants();
      that._treeListViewConstants.setColumnsIndex(that._columnsIDs);
      that._treeListViewConstants.setColumnsNameNls(colLabelsNls);
      that._treeListViewConstants.setColumnsVisibilityStatus(that._columnsVisibilityStatus);
    },

    /*
    * buildColumns
    */
    buildColumns : function buildColumns(ldata)
    {
      var that = this;
      var index = that._treeListViewConstants.getColumnsIndex().indexOf(ldata.dataIndex);
      if (that._treeListViewConstants.getColumnsVisibilityStatus()[index] != undefined || that._treeListViewConstants.getColumnsVisibilityStatus()[index] != null)
        ldata.visibleFlag = !(that._treeListViewConstants.getColumnsVisibilityStatus()[index]);

      if (ldata.dataIndex === "deploystatus" || ldata.dataIndex === "edit" || ldata.dataIndex === "delete") {
        ldata.alwaysVisibleFlag = true;

        ldata.alignment = 'center';
        ldata.width = '50';
        if (ldata.dataIndex === "delete") {
          ldata.getCellTypeRepresentation = function (iCellInfos) {
            if (iCellInfos.nodeModel) {
              if (iCellInfos.nodeModel.options.grid.deploystatus === "deleted")
                return 'emptyRep';
              else
                return "delete";
            }
          }
          ldata.getCellTooltip = that.getCellTooltip.bind(that);
        }

        if (ldata.dataIndex === "edit") {
          ldata.getCellTypeRepresentation = function (iCellInfos) {
            if (iCellInfos.nodeModel) {
              if (iCellInfos.nodeModel.options.grid.deploystatus === "deleted")
                return 'emptyRep';
              else
                return "edit";
            }
          }
          ldata.getCellTooltip = that.getCellTooltip.bind(that);
        }

        if (ldata.dataIndex === "deploystatus") {
          ldata.width = '150';
          ldata.alignment = 'center';
          ldata.getCellTypeRepresentation = function (iCellInfos) {
            if (iCellInfos.nodeModel) {
              if (iCellInfos.nodeModel.options.grid.deploystatus === "deployed")
                return 'deploystatus_deployed';
              else if (iCellInfos.nodeModel.options.grid.deploystatus === "notDeployed")
                return 'deploystatus_notDeployed';
              else if (iCellInfos.nodeModel.options.grid.deploystatus === "deleted")
                return 'deploystatus_deleted';
            }
          };
          ldata.getCellTooltip = function (iCellInfos) {
            if (iCellInfos.nodeModel != undefined) {
              if (iCellInfos.nodeModel.options.grid.deploystatus === "deployed") {
                return {
                  shortHelp: DisplayPropertiesNLS.Applied
                };
              }
              else if (iCellInfos.nodeModel.options.grid.deploystatus === "notDeployed") {
                return {
                  shortHelp: DisplayPropertiesNLS.NotApplied
                };
              }
              else if (iCellInfos.nodeModel.options.grid.deploystatus === "deleted") {
                return {
                  shortHelp: DisplayPropertiesNLS.deleted
                };
              }
            }
          }
        }
      }
      else {

        if (that._columnsCellSemantics[index] != undefined || that._columnsCellSemantics[index] != null) {
          ldata.editableFlag = true;
          ldata.typeRepresentation = 'string';
          ldata.editionPolicy = 'EditionOnOver';
          ldata.getCellSemantics = that._columnsCellSemantics[index];
        }
        else {
          if (ldata.type === "checkbox") {
            ldata.width = '150';
            ldata.alignment = 'center';
            ldata.typeRepresentation = 'checkboxoff';
            ldata.getCellTypeRepresentation = function (iCellInfos) {
              if (iCellInfos.cellModel === true)
                return 'checkboxon';
              else
                return 'checkboxoff';
            };
          }
        }
      }
    },


    /*
    * buildView
    */
     buildView : function buildView(options)
     {
       var that = this;

       var columns = options.columns;
       var colLabelsNls = options.nls;
       var data = options.data;

       var cols = [];
       var columnsLength = that._treeListViewConstants.getColumnsIndex().length;
       for (var i = 0; i < columnsLength; i++) {
         var ldata = {};

         ldata.editableFlag = false;
         ldata.sortableFlag = true;
         ldata.resizableFlag = true;

         if (columns[i] != null && columns[i].mandatory != null && columns[i].mandatory === true)
           ldata.alwaysVisibleFlag = true;
         if (columns[i] != null && columns[i].sortable != null && columns[i].sortable === false)
           ldata.sortableFlag = false;

         ldata.dataIndex = that._treeListViewConstants.getColumnsIndex()[i];
         ldata.text = that._treeListViewConstants.getColumnsName()[i];
         if (columns[i] != null)
           ldata.type = columns[i].type;

         that.buildColumns(ldata);
         cols.push(ldata);
       }

       // Create the model for the DataGridView
       this.model = new TreeDocument();

       this.dataGridView = new DataGridView({
         identifier: "DPDatagridviewparam_" + that._paramID,
         treeDocument: this.model,
         columns: cols
       });

       this.setTypeRepresentation();

       this.dataGridView.getContent().style.top = null;
       this.dataGridView.getContent().style.bottom = null;
       this.dataGridView.getContent().style.height = "300px";
       this.dataGridView.getContent().style.position = "relative";
       return this.dataGridView;
    },


    /*
    * getCellTooltip
    */
    getCellTooltip: function getCellTooltip(iCellInfos) {
      var that = this;
      if (iCellInfos.nodeModel) {
        return {
          shortHelp: that._treeListViewConstants.getColumnsName()[iCellInfos.columnID]
        };
      }
    },

     /*
     * setTypeRepresentation
     */
     setTypeRepresentation : function setTypeRepresentation(customTypeRep)
     {
       var that = this;

       var typeReps = {
         delete: {
           stdTemplate: 'functionIcon',
           semantics: {
             icon: {
               iconName: 'trash',
               fontIconFamily: WUXManagedFontIcons.Font3DS
             }
           }
         },
         emptyRep: {
           stdTemplate: 'functionIcon',
           semantics: {
             icon: {
               iconName: '',
               fontIconFamily: WUXManagedFontIcons.Font3DS,

             }
           }
         },
         edit: {
           stdTemplate: 'functionIcon',
           semantics: {
             icon: {
               iconName: 'pencil',
               fontIconFamily: WUXManagedFontIcons.Font3DS
             }
           }
         },
         deploystatus_deployed: {
           stdTemplate: 'functionIcon',
           semantics: {
             icon: {
               iconName: 'check',
               fontIconFamily: WUXManagedFontIcons.Font3DS
             }
           }
         },
         deploystatus_notDeployed: {
           stdTemplate: 'functionIcon',
           semantics: {
             icon: {
               iconName: 'cog',// 'close',
               fontIconFamily: WUXManagedFontIcons.Font3DS
             }
           }
         },
         deploystatus_deleted: {
           stdTemplate: 'functionIcon',
           semantics: {
             icon: {
               iconName: 'trash',
               fontIconFamily: WUXManagedFontIcons.Font3DS,
               className: 'delete-red'
             }
           }
         },
         checkboxon: {
           stdTemplate: 'functionIcon',
           semantics: {
             icon: {
               iconName: 'check',
               fontIconFamily: WUXManagedFontIcons.Font3DS
             }
           }
         },
         checkboxoff: {
           stdTemplate: 'functionIcon',
           semantics: {
             icon: {
               iconName: 'wrong',
               fontIconFamily: WUXManagedFontIcons.Font3DS
             },
             color: '#e2e4e3'
           }
         }
       };

       typeReps = Object.assign(typeReps, customTypeRep);
       this.dataGridView.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(typeReps));
     },

 
    /*
    * addChild
    */
    addChild: function addChild(nodeData) {
      var that = this;
      this.model.prepareUpdate();

      var nodeDataLength = nodeData.length;
      for (var i = 0; i < nodeDataLength; i++) {
        var nodeKeysTMP = Object.keys(nodeData[i]);
        if (nodeKeysTMP.length) {
          for (var k = 0; k < nodeKeysTMP.length; k++) {
            var keys = nodeKeysTMP[k];
            if (keys) {
              for (var m = 0; m < that.dataGridView.columns.length; m++) {
                if (that.dataGridView.columns[m].dataIndex === keys)
                  that.dataGridView.columns[m].visibleFlag = true;
              }
            }
          }
        }

        this.model.addChild(nodeData[i]);
      }

      this.model.expandAll();
      this.model.pushUpdate();
    }
  });


  return DPConfigurationTreeListView;
});

define('DS/ParameterizationSkeleton/Views/ParameterizationSystemsSafety/SystemsSafetyViewStructureTreePatternUtilities', [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
    'DS/ParameterizationSkeleton/Views/ParameterizationSystemsSafety/ParameterizationSystemsSafetyConstants',
    'DS/ParameterizationSkeleton/Views/ParameterizationSystemsSafety/SystemsSafetyModalStructureTreePattern',
    'DS/ParameterizationSkeleton/Views/ParameterizationSystemsSafety/SystemsSafetyViewUtilities',

    'i18n!DS/ParameterizationSkeleton/assets/nls/SystemsSafetyNLS'
], function(
    UWA,
    ParametersLayoutViewUtilities,
    ParameterizationSystemsSafetyConstants,
    SystemsSafetyModal,
    SystemsSafetyViewCommonUtilities,

    SystemsSafetyNLS
) {

    'use strict';

    var LEFT_ALIGNMENT = SystemsSafetyViewCommonUtilities.LEFT_ALIGNMENT;
    var RIGHT_ALIGNMENT = SystemsSafetyViewCommonUtilities.RIGHT_ALIGNMENT;
    var HTML_BOLD_FORMAT = SystemsSafetyViewCommonUtilities.HTML_BOLD_FORMAT;
    var HTML_PARAG_FORMAT = SystemsSafetyViewCommonUtilities.HTML_PARAG_FORMAT;
    var COLUMNS_WIDTH = ['30%', '50%', '10%', '10%'];
    var CELLS_INDEX = {
        type: 0,
        pattern: 1,
        action: 2,
        deployFlag: 3
    };


    var SystemsSafetyViewUtilities = {
        buildTable: function() {
            var partNumberTable = UWA.createElement('table', {
                'class': 'partNumberTableMapping table table-condensed'
            });
            var pNFieldbody = UWA.createElement('tbody', {
                'class': 'structureTreePatternFieldbody'
            }).inject(partNumberTable);

            var fieldInfo;
            fieldInfo = SystemsSafetyViewUtilities.buildStatusRow();
            fieldInfo.inject(pNFieldbody);

            fieldInfo = UWA.createElement('tr', {
                'class': 'success'
            });
            SystemsSafetyViewCommonUtilities.buildTextTableCell(LEFT_ALIGNMENT, COLUMNS_WIDTH[CELLS_INDEX.type], fieldInfo, HTML_BOLD_FORMAT, SystemsSafetyNLS.type);
            SystemsSafetyViewCommonUtilities.buildTextTableCell(LEFT_ALIGNMENT, COLUMNS_WIDTH[CELLS_INDEX.pattern], fieldInfo, HTML_BOLD_FORMAT, SystemsSafetyNLS.pattern);
            SystemsSafetyViewCommonUtilities.buildTextTableCell(LEFT_ALIGNMENT, COLUMNS_WIDTH[CELLS_INDEX.action], fieldInfo, HTML_BOLD_FORMAT, SystemsSafetyNLS.actions);
            SystemsSafetyViewCommonUtilities.buildTextTableCell(RIGHT_ALIGNMENT, COLUMNS_WIDTH[CELLS_INDEX.deployFlag], fieldInfo, HTML_BOLD_FORMAT, SystemsSafetyNLS.deployStatus);
            fieldInfo.inject(pNFieldbody);

            return partNumberTable;
        },

        buildStatusRow: function() {
            var fieldInfo = UWA.createElement('tr', {
                'id': 'structureTreePatternsStatusRow'
            });
            SystemsSafetyViewCommonUtilities.buildTextTableCell(LEFT_ALIGNMENT, COLUMNS_WIDTH[CELLS_INDEX.type], fieldInfo, HTML_PARAG_FORMAT, SystemsSafetyNLS.patterns);
            var iCell = UWA.createElement('td', {
                'colspan': '3',
                'align': RIGHT_ALIGNMENT,
                'title': SystemsSafetyNLS.deployStatus,
                'class': 'architectureNumberingField font-3dslight'
            });

            var imgSpan = SystemsSafetyViewCommonUtilities.buildImgSpan('check', '2.5', 'green', SystemsSafetyNLS.deployed);
            imgSpan.inject(iCell);
            iCell.value = "success";
            iCell.inject(fieldInfo);
            return fieldInfo;
        },

        addEditButtonToCellRow: function(iCell) {
            var editElts = ParametersLayoutViewUtilities.createActionElements(SystemsSafetyNLS.editPattern, false);
            var editSpan = editElts[0];
            editSpan.setStyle("float", LEFT_ALIGNMENT);
            editSpan.setStyle("padding", "0px 8px");
            editSpan.inject(iCell);
            var editAttributeButton = editElts[1];

            editAttributeButton.addEvent("onClick", function(event) {
                var fieldToEdit = event.currentTarget.getParent().getParent().getParent();
                SystemsSafetyViewUtilities.editDialog(fieldToEdit);
            });

            return editAttributeButton;
        },

        addRemoveButtonToCellRow: function(iCell, fieldInfo) {
            var removelts = ParametersLayoutViewUtilities.createActionElements(SystemsSafetyNLS.removePattern, true);
            var deleteSpan = removelts[0];
            deleteSpan.setStyle("float", LEFT_ALIGNMENT);
            deleteSpan.setStyle("padding", "0px 8px");
            deleteSpan.inject(iCell);
            var removeAttributeButton = removelts[1];

            removeAttributeButton.addEvent("onClick", function() {
                SystemsSafetyViewUtilities.removefieldLineCallBack(fieldInfo);
            });

            return removeAttributeButton;
        },

        buildField: function(fieldInfo, typeLabel, plmType, pattern, isDeployed) {
            fieldInfo.value = isDeployed;
            var typeCell = SystemsSafetyViewCommonUtilities.buildTextTableCell(LEFT_ALIGNMENT, COLUMNS_WIDTH[CELLS_INDEX.type], fieldInfo, HTML_PARAG_FORMAT, typeLabel);
            typeCell._plmType = plmType;
            SystemsSafetyViewCommonUtilities.buildTextTableCell(LEFT_ALIGNMENT, COLUMNS_WIDTH[CELLS_INDEX.pattern], fieldInfo, HTML_PARAG_FORMAT, pattern);

            var iCell = UWA.createElement('td', {
                'Align': LEFT_ALIGNMENT,
                'width': COLUMNS_WIDTH[CELLS_INDEX.action],
                'class': 'architectureNumberingField font-3dslight'
            }).inject(fieldInfo);

            SystemsSafetyViewUtilities.addEditButtonToCellRow(iCell, fieldInfo);
            SystemsSafetyViewUtilities.addRemoveButtonToCellRow(iCell, fieldInfo);

            iCell = UWA.createElement('td', {
                'Align': RIGHT_ALIGNMENT,
                'width': COLUMNS_WIDTH[CELLS_INDEX.deployFlag],
                'class': 'architectureNumberingField font-3dslight'
            }).inject(fieldInfo);

            if (isDeployed === ParameterizationSystemsSafetyConstants.DEPLOYED) {
                SystemsSafetyViewCommonUtilities.buildImgSpan('check', '2.5', 'green', SystemsSafetyNLS.deployed).inject(iCell);
            } else if (isDeployed === ParameterizationSystemsSafetyConstants.NEW_NOT_DEPLOYED) {
                SystemsSafetyViewCommonUtilities.buildImgSpan('cog', '2.5', 'orange', SystemsSafetyNLS.modified).inject(iCell);
            }
            iCell.inject(fieldInfo);
            return fieldInfo;
        },

        buildsFieldJsonObject: function(fieldInfo) {
            return {
                typeLabel: fieldInfo.cells[CELLS_INDEX.type].getText(),
                type: fieldInfo.cells[CELLS_INDEX.type]._plmType,
                pattern: fieldInfo.cells[CELLS_INDEX.pattern].getText(),
                action: fieldInfo.cells[CELLS_INDEX.deployFlag].value
            };
        },

        buildNewField: function(objParam, isDeployedStatus) {
            var fieldInfo;
            fieldInfo = UWA.createElement('tr', {
                'class': 'structureTreePatternFieldMapping'
            });
            SystemsSafetyViewUtilities.buildField(fieldInfo, objParam.typeLabel, objParam.type, objParam.pattern, isDeployedStatus);
            fieldInfo.cells[CELLS_INDEX.deployFlag].value = ParameterizationSystemsSafetyConstants.ADD;
            return fieldInfo;
        },

        modifyField: function(fieldInfo, objParam, isDeployedStatus) {
            fieldInfo.value = isDeployedStatus;
            // type must not be modified
            fieldInfo.cells[CELLS_INDEX.pattern].setText(objParam.pattern);
            var deploycell = fieldInfo.cells[CELLS_INDEX.deployFlag];
            deploycell.empty();

            SystemsSafetyViewCommonUtilities.buildImgSpan('cog', '2.5', 'orange', SystemsSafetyNLS.modified).inject(deploycell);
            deploycell.value = ParameterizationSystemsSafetyConstants.MODIFY;
            return fieldInfo;
        },

        removefieldLineCallBack: function(fieldInfo) {
            if (typeof fieldInfo !== undefined) {
                if (fieldInfo.value === ParameterizationSystemsSafetyConstants.NEW_NOT_DEPLOYED) {
                    fieldInfo.remove();
                } else {
                    SystemsSafetyViewUtilities.setForRemoveFieldLine(fieldInfo);
                }
            }
        },

        resetForRemove: function(fieldInfo) {
            var imgSpan = SystemsSafetyViewCommonUtilities.buildImgSpan('check', '2.5', 'green', SystemsSafetyNLS.deployed);
            var actionCell = fieldInfo.cells[CELLS_INDEX.action];
            var deploycell = fieldInfo.cells[CELLS_INDEX.deployFlag];

            SystemsSafetyViewUtilities.addEditButtonToCellRow(actionCell, fieldInfo);
            SystemsSafetyViewUtilities.addRemoveButtonToCellRow(actionCell, fieldInfo);
            deploycell.empty();
            imgSpan.inject(deploycell);
        },

        resetForModify: function(fieldInfo, savedInfo) {
            var imgSpan = SystemsSafetyViewCommonUtilities.buildImgSpan('check', '2.5', 'green', SystemsSafetyNLS.deployed);
            var deploycell = fieldInfo.cells[CELLS_INDEX.deployFlag];

            if (savedInfo) {
                fieldInfo.cells[CELLS_INDEX.type].setText(savedInfo.type);
                fieldInfo.cells[CELLS_INDEX.pattern].setText(savedInfo.pattern);
            }
            deploycell.empty();
            imgSpan.inject(deploycell);
        },

        resetForFieldLineChanges: function(fieldInfo, savedInfo) {
            if (fieldInfo.value === ParameterizationSystemsSafetyConstants.NEW_NOT_DEPLOYED) {
                var cellValue = fieldInfo.cells[CELLS_INDEX.deployFlag].value;
                if (cellValue === ParameterizationSystemsSafetyConstants.ADD) {
                    return fieldInfo;
                } else if (cellValue === ParameterizationSystemsSafetyConstants.REMOVE) {
                    SystemsSafetyViewUtilities.resetForRemove(fieldInfo);

                } else if (cellValue === ParameterizationSystemsSafetyConstants.MODIFY) {
                    SystemsSafetyViewUtilities.resetForModify(fieldInfo, savedInfo);
                }

                fieldInfo.value = ParameterizationSystemsSafetyConstants.DEPLOYED;
                fieldInfo.cells[CELLS_INDEX.deployFlag].value = null;
            }
        },

        setForRemoveFieldLine: function(fieldInfo) {
            fieldInfo.value = ParameterizationSystemsSafetyConstants.NEW_NOT_DEPLOYED;
            var arrayAction = fieldInfo.cells[CELLS_INDEX.action].getElements('span');
            arrayAction.forEach(function(action) {
                action.hide();
            });

            var deploycell = fieldInfo.cells[CELLS_INDEX.deployFlag];
            var imgSpan = SystemsSafetyViewCommonUtilities.buildImgSpan('trash', '1.5', 'red', SystemsSafetyNLS.removed);

            deploycell.empty();
            deploycell.value = ParameterizationSystemsSafetyConstants.REMOVE;
            imgSpan.inject(deploycell);
        },

        editDialog: function(fieldToEdit) {
            var options = {
                className: "part-number-edit-modal",
                title: SystemsSafetyNLS.editPattern
            };

            var that = this;
            this.modal = new SystemsSafetyModal(options);

            this.modal.modal.setFooter("<button type='button'  name='addButton' id='add-button' class='btn btn-primary'>" + SystemsSafetyNLS.apply + "</button> " + "</button>" + "<button type='button' name='cancelButton' id='cancel-button' class='btn btn-default'>" + SystemsSafetyNLS.cancel + "</button>");
            this.modal.getModalBody();
            this.modal._bindFooterEvent();

            var fetchedData = this.buildsFieldJsonObject(fieldToEdit);

            this.modal.typeTextBox.setValue(fetchedData.typeLabel);
            this.modal.typeTextBox._plmType = fetchedData.type;
            this.modal.typeTextBox.setDisabled(true);
            this.modal.patternTextBox.setValue(fetchedData.pattern);

            this.modal.getContent().getElements('.btn').forEach(function(element) {
                if (element.name === 'addButton') {
                    element.addEvent('click', function() {
                        var userEditedFormat = that.modal.getUserEnteredValues();
                        var checkStatus = {};
                        checkStatus.isSuccess = true;

                        var toDisplayOver = that.modal.getContent().getElement('.enox-arch-number-content');

                        if (userEditedFormat.type === '') {
                            that.modal.displayAlertMessage(SystemsSafetyNLS.typeNullMessage, toDisplayOver);
                        } else if (userEditedFormat.pattern === '') {
                            that.modal.displayAlertMessage(SystemsSafetyNLS.patternNullMessage, toDisplayOver);
                        } else {
                            userEditedFormat.action = ParameterizationSystemsSafetyConstants.MODIFY;
                            SystemsSafetyViewUtilities.modifyField(fieldToEdit, userEditedFormat, ParameterizationSystemsSafetyConstants.NEW_NOT_DEPLOYED);
                            that.modal.destroy();
                        }
                    });
                }
            });

            this.modal.show();
        }
    };

    return SystemsSafetyViewUtilities;
});

define('DS/ParameterizationSkeleton/Views/ParameterizationSystemsSafety/SystemsSafetyLayoutView', [
    'UWA/Core',
    'UWA/Class/View',
    'DS/UIKIT/Mask',
    'DS/UIKIT/Scroller',

    'DS/WAFData/WAFData',
    'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
    'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
    'DS/ParameterizationSkeleton/Views/ParameterizationSystemsSafety/SystemsSafetyViewUtilities',
    'DS/ParameterizationSkeleton/Views/ParameterizationSystemsSafety/SystemsSafetyViewPartnerUtilities',
    'DS/ParameterizationSkeleton/Views/ParameterizationSystemsSafety/SystemsSafetyViewStructureTreePatternUtilities',
    'DS/ParameterizationSkeleton/Views/ParameterizationSystemsSafety/ParameterizationSystemsSafetyConstants',
    'DS/ParameterizationSkeleton/Views/ParameterizationSystemsSafety/SystemsSafetyModalPartner',
    'DS/ParameterizationSkeleton/Views/ParameterizationSystemsSafety/SystemsSafetyModalStructureTreePattern',
    'DS/UIKIT/Input/Button',
    'DS/UIKIT/Alert',
    'DS/ParameterizationSkeleton/Views/ParametersLayoutView',

    'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS',
    'i18n!DS/ParameterizationSkeleton/assets/nls/SystemsSafetyNLS'
], function(
    UWA,
    View,
    Mask,
    Scroller,

    WAFData,
    ParametersLayoutViewUtilities,
    URLHandler,
    SystemsSafetyViewCommonUtilities,
    SystemsSafetyViewPartnerUtilities,
    SystemsSafetyViewStructureTreePatternUtilities,
    ParameterizationSystemsSafetyConstants,
    SystemsSafetyModalPartner,
    SystemsSafetyModalStructureTreePattern,
    Button,
    Alert,
    ParametersLayoutView,

    ParamSkeletonNLS,
    SystemsSafetyNLS
) {

    'use strict';

    var extendedView;

    var plmTypesCache;

    extendedView = View.extend({
        tagName: 'div',
        className: 'generic-detail',

        init: function(options) {
            var initDate = new Date();

            options = UWA.clone(options || {}, false);
            this._parent(options);

            this.options = options;
            this.contentDiv = null;
            this.paramScroller = null;
            this.userMessaging = null;
            this.lastAlertDate = initDate.getTime();
        },

        setup: function(options) {
            UWA.log('LayoutView::setup');
            UWA.log(options);
            this.fetchPLMTypes([
                // Architecture references
                'RFLPLMFunctionalReference', 'RFLVPMLogicalReference', 'VPMReference', 'RFLPLMFlowReference', 'RFLVPMSystemTypeReference',
                // Architecture instances
                'RFLPLMFunctionalInstance', 'RFLVPMLogicalInstance', 'VPMInstance', 'RFLPLMFlowExpositionInstance', 'RFLVPMSystemTypeExpositionInstance',
                // Safety types
                'FailureModesEffectsAnalysis', 'FallibleReference', 'FailureMode',
                // DELMIA Process references
                'DELLmiOperationReference', 'DELLmiPPRHeaderProcessReferenceAbstract', 'DELLmiProductionSystemReference', 'DELResourceParameterPlanReference', 'DELStandardProcessReference',
                // DELMIA Process instances
                'DELLmiOperationInstance', 'DELLmiProductionSystemInstance', 'DELResourceParameterPlanInstance',
                // DELMIA Item references
                'DELFmiFunctionReference',
                // DELMIA Item instances
                'DELFmiFunctionInstance'
            ]);
        },

        render: function() {
            UWA.log('LayoutView::render');
            var introDiv;

            this.contentDiv = UWA.createElement('div', {
                'id': 'systemsSafetyMainDiv'
            });
            Mask.mask(this.contentDiv);

            introDiv = UWA.createElement('div', {
                'class': 'information-arch'
            }).inject(this.contentDiv);

            UWA.createElement('p', {
                text: SystemsSafetyNLS.intro,
                'class': 'font-3dslight'
            }).inject(introDiv);

            this.parentView = new ParametersLayoutView(this.options);

            this.container.setContent(this.contentDiv);
            var syncPromise = new Promise(function(resolve, reject) {
                this.listenTo(this.collection, {
                    onSync: resolve,
                    onError: reject
                });
            }.bind(this));
            Promise.all([this._fetchPLMTypesPromise, syncPromise]).then(function() {
                this.onCompleteRequestMapping();
            }.bind(this)).catch(function() {
                // SQA role not available
                Mask.unmask(this.contentDiv);
                ParametersLayoutViewUtilities.createParamMask(this.contentDiv, ParamSkeletonNLS.NoParamAvailabletxt);
            }.bind(this));

            return this;
        },

        _createFamilyStructureTreePatterns: function(accordion, structureTreePatterns) {
            var partNumberingParentDiv = UWA.createElement('div', {
                'class': 'architectureNumberingContent'
            });
            partNumberingParentDiv.style.height = '300px';

            var partNumberingDiv = UWA.createElement('div', {
                'class': 'architectureNumbering'
            });

            var partNumberTable = SystemsSafetyViewStructureTreePatternUtilities.buildTable();
            partNumberTable.inject(partNumberingDiv);

            new Button({
                className: 'AddPartNumberFieldButton',
                icon: 'plus-circled',
                attributes: {
                    disabled: false,
                    'aria-hidden': 'true',
                    title: SystemsSafetyNLS.addPatternTooltip
                },
                events: {
                    onClick: function() {
                        this.createStructureTreePatternDialogBox();
                    }.bind(this)
                }
            }).inject(partNumberingDiv);

            partNumberingParentDiv.appendChild(partNumberingDiv);

            accordion.addItem({
                title: SystemsSafetyNLS.patternsAccordionTitle,
                content: partNumberingParentDiv,
                selected: true,
                name: SystemsSafetyNLS.patternsAccordionName
            });

            // eslint-disable-next-line max-len
            var controlDiv = ParametersLayoutViewUtilities.createApplyResetToolbar.call(this, this.contentDiv, true, this.applyStructureTreePatternParams.bind(this), this.resetStructureTreePatternParams.bind(this));
            partNumberingDiv.appendChild(controlDiv);

            for (var i = 0; i < structureTreePatterns.length; i++) {
                var field = structureTreePatterns[i];
                var deployedStatus = field.deployed ? ParameterizationSystemsSafetyConstants.DEPLOYED : ParameterizationSystemsSafetyConstants.NEW_NOT_DEPLOYED;
                var nlsType = field.type;
                for (var iType = 0; iType < this._plmTypes.length; ++iType) {
                    if (this._plmTypes[iType].Name === field.type) {
                        nlsType = this._plmTypes[iType].nLSValue;
                    }
                }
                var fieldInfo = SystemsSafetyViewStructureTreePatternUtilities.buildNewField({
                        action: ParameterizationSystemsSafetyConstants.ADD,
                        typeLabel: field.type !== nlsType ? nlsType + ' (' + field.type + ')' : field.type,
                        type: field.type,
                        pattern: field.pattern
                    },
                    deployedStatus);
                fieldInfo.inject(partNumberTable.getElement(".structureTreePatternFieldbody"));
            }

            this.paramScroller = new Scroller({
                element: partNumberingDiv
            }).inject(partNumberingParentDiv);
        },

        _createFamilyPartners: function(accordion, partners) {
            var partNumberingParentDiv = UWA.createElement('div', {
                'class': 'architectureNumberingContent'
            });
            partNumberingParentDiv.style.height = '300px';

            var partNumberingDiv = UWA.createElement('div', {
                'class': 'architectureNumbering'
            });

            var partNumberTable = SystemsSafetyViewPartnerUtilities.buildTable();
            partNumberTable.inject(partNumberingDiv);

            new Button({
                className: 'AddPartNumberFieldButton',
                icon: 'plus-circled',
                attributes: {
                    disabled: false,
                    'aria-hidden': 'true',
                    title: SystemsSafetyNLS.addPartnerTooltip
                },
                events: {
                    onClick: function() {
                        this.createPartnerDialogBox();
                    }.bind(this)
                }
            }).inject(partNumberingDiv);

            partNumberingParentDiv.appendChild(partNumberingDiv);

            accordion.addItem({
                title: SystemsSafetyNLS.partnersAccordionTitle,
                content: partNumberingParentDiv,
                selected: false,
                name: SystemsSafetyNLS.partnersAccordionName
            });

            // eslint-disable-next-line max-len
            var controlDiv = ParametersLayoutViewUtilities.createApplyResetToolbar.call(this, this.contentDiv, true, this.applyPartnerParams.bind(this), this.resetPartnerParams.bind(this));
            partNumberingDiv.appendChild(controlDiv);

            for (var i = 0; i < partners.length; i++) {
                var field = partners[i];
                var deployedStatus = field.deployed ? ParameterizationSystemsSafetyConstants.DEPLOYED : ParameterizationSystemsSafetyConstants.NEW_NOT_DEPLOYED;
                var fieldInfo = SystemsSafetyViewPartnerUtilities.buildNewField({
                        action: ParameterizationSystemsSafetyConstants.ADD,
                        name: field.name,
                        url: field.url
                    },
                    deployedStatus);
                fieldInfo.inject(partNumberTable.getElement(".partnerFieldbody"));
            }

            this.paramScroller = new Scroller({
                element: partNumberingDiv
            }).inject(partNumberingParentDiv);
        },

        onCompleteRequestMapping: function() {
            UWA.log('LayoutView::Complete rendering!');

            var collection = this.collection._models[0]._attributes;

            var structureTreePatterns = [];
            var partners = [];
            for (var iParameter = 0; iParameter < collection.parameters.length; ++iParameter) {
                var parameter = collection.parameters[iParameter];
                if (parameter.parameterType === 'structureTreePattern') {
                    structureTreePatterns.push(parameter);
                } else if (parameter.parameterType === 'partnerUrl') {
                    partners.push(parameter);
                }
            }

            var pageContainer = UWA.createElement('div', {
                'class': 'architectureNumberingDivScroll'
            }).inject(this.contentDiv);

            var accordion = ParametersLayoutViewUtilities.createFamilyUIKITAccordion(pageContainer);
            this._createFamilyStructureTreePatterns(accordion, structureTreePatterns);
            this._createFamilyPartners(accordion, partners);

            Mask.unmask(this.contentDiv);
        },

        fetchPLMTypes: function(rootTypes) {
            if (plmTypesCache) {
                this._plmTypes = plmTypesCache;
                this._fetchPLMTypesPromise = Promise.resolve(this._plmTypes);
            } else {
                this._plmTypes = [];
                this._fetchPLMTypesPromise = new Promise(function(resolveFetch, rejectFetch) {
                    var dictionaryPromise = new Promise(function(resolve, reject) {
                        var query = [];
                        for (var iType = 0; iType < rootTypes.length; ++iType) {
                            query.push({
                                entityName: rootTypes[iType],
                                withParents: 'none',
                                withChildren: 'all',
                                withAllInterfaces: false,
                                withAllAttributes: false
                            });
                        }
                        WAFData.authenticatedRequest(URLHandler.getURL() + '/resources/sfy/FailureModesEffectsAnalysis/getTypesInformation', {
                            timeout: 250000,
                            method: 'POST',
                            type: 'json',
                            headers: {
                                'Accept': 'application/json',
                                'Content-Type': 'application/json'
                            },
                            data: JSON.stringify(query),
                            onComplete: function(json) {
                                resolve(json);
                            },
                            onFailure: function(e) {
                                UWA.log(e);
                                reject(e);
                            },
                            onTimeout: function(networkError, e) {
                                UWA.log(e || networkError);
                                reject(e || networkError);
                            }
                        });
                    });
                    dictionaryPromise.then(function(dictionary) {
                        for (var typeName in dictionary.Types) {
                            if (dictionary.Types.hasOwnProperty(typeName)) {
                                this._plmTypes.push({
                                    Name: typeName,
                                    nLSValue: dictionary.Types[typeName].nLSValue || typeName
                                });
                            }
                        }
                        for (var relationshipName in dictionary.Relationships) {
                            if (dictionary.Relationships.hasOwnProperty(relationshipName)) {
                                this._plmTypes.push({
                                    Name: relationshipName,
                                    nLSValue: dictionary.Relationships[relationshipName].nLSValue || relationshipName
                                });
                            }
                        }
                        plmTypesCache = this._plmTypes;
                        resolveFetch(this._plmTypes);
                    }.bind(this)).catch(rejectFetch);
                }.bind(this));
            }
        },

        resetStructureTreePatternParams: function() {
            var fieldsToBeRemoved = [];
            var rowsOfMappedFields = this.contentDiv.getElementsByClassName("structureTreePatternFieldMapping");
            for (var i = 0; i < rowsOfMappedFields.length; i++) {
                if (rowsOfMappedFields[i].value === ParameterizationSystemsSafetyConstants.NEW_NOT_DEPLOYED) {
                    fieldsToBeRemoved.push(SystemsSafetyViewStructureTreePatternUtilities.resetForFieldLineChanges(rowsOfMappedFields[i]));
                }
            }
            fieldsToBeRemoved.forEach(function(attrMapping) {
                if (attrMapping) {
                    attrMapping.remove();
                }
            });
        },

        resetPartnerParams: function() {
            var fieldsToBeRemoved = [];
            var rowsOfMappedFields = this.contentDiv.getElementsByClassName("partnerFieldMapping");
            for (var i = 0; i < rowsOfMappedFields.length; i++) {
                if (rowsOfMappedFields[i].value === ParameterizationSystemsSafetyConstants.NEW_NOT_DEPLOYED) {
                    fieldsToBeRemoved.push(SystemsSafetyViewPartnerUtilities.resetForFieldLineChanges(rowsOfMappedFields[i]));
                }
            }
            fieldsToBeRemoved.forEach(function(attrMapping) {
                if (attrMapping) {
                    attrMapping.remove();
                }
            });
        },

        applyStructureTreePatternParams: function() {
            var that = this;
            var rowsOfMappedFields = this.contentDiv.getElementsByClassName('structureTreePatternFieldMapping');
            var payloadToSend = {};
            Mask.mask(this.contentDiv);
            payloadToSend.parameters = [];
            for (var i = 0; i < rowsOfMappedFields.length; i++) {
                var value = SystemsSafetyViewStructureTreePatternUtilities.buildsFieldJsonObject(rowsOfMappedFields[i]);
                payloadToSend.parameters.push(value);
            }

            var url = URLHandler.getURL() + '/resources/sfy/parameters/?tenant=' + URLHandler.getTenant() + '&parameterType=structureTreePattern';
            WAFData.authenticatedRequest(url, {
                timeout: 250000,
                method: 'POST',
                data: JSON.stringify(payloadToSend),
                type: 'json',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                onFailure: function() {
                    Mask.unmask(that.contentDiv);
                    that.onApplyFailure(SystemsSafetyNLS.applyError);
                },
                onComplete: function(json) {
                    if (json.parameters) {
                        that.onApplyStructureTreePatternSuccess();
                        Mask.unmask(that.contentDiv);
                        that.getAlertMessage(SystemsSafetyNLS.applySuccess, 'success', that.contentDiv);
                    } else {
                        Mask.unmask(that.contentDiv);
                        that.onApplyFailure(json.message);
                    }
                }
            });
        },

        applyPartnerParams: function() {
            var that = this;
            var rowsOfMappedFields = this.contentDiv.getElementsByClassName('partnerFieldMapping');
            var payloadToSend = {};
            Mask.mask(this.contentDiv);
            payloadToSend.parameters = [];
            for (var i = 0; i < rowsOfMappedFields.length; i++) {
                var value = SystemsSafetyViewPartnerUtilities.buildsFieldJsonObject(rowsOfMappedFields[i]);
                payloadToSend.parameters.push(value);
            }

            var url = URLHandler.getURL() + '/resources/sfy/parameters/?tenant=' + URLHandler.getTenant() + '&parameterType=partnerUrl';
            WAFData.authenticatedRequest(url, {
                timeout: 250000,
                method: 'POST',
                data: JSON.stringify(payloadToSend),
                type: 'json',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                onFailure: function() {
                    Mask.unmask(that.contentDiv);
                    that.onApplyFailure(SystemsSafetyNLS.applyError);
                },
                onComplete: function(json) {
                    if (json.parameters) {
                        that.onApplyPartnerSuccess();
                        Mask.unmask(that.contentDiv);
                        that.getAlertMessage(SystemsSafetyNLS.applySuccess, 'success', that.contentDiv);
                    } else {
                        Mask.unmask(that.contentDiv);
                        that.onApplyFailure(json.message);
                    }
                }
            });
        },

        onApplyFailure: function(message) {
            this.getAlertMessage(message, 'error', this.contentDiv);
        },

        onApplyStructureTreePatternSuccess: function() {
            var fieldsToBeRemoved = [];

            var rowsOfMappedFields = this.contentDiv.getElementsByClassName('structureTreePatternFieldMapping');
            for (var i = 0; i < rowsOfMappedFields.length; i++) {
                if (rowsOfMappedFields[i].value === ParameterizationSystemsSafetyConstants.NEW_NOT_DEPLOYED) {
                    var statusCell = rowsOfMappedFields[i].cells[rowsOfMappedFields[i].cells.length - 1];
                    if (statusCell.value === ParameterizationSystemsSafetyConstants.ADD || statusCell.value === ParameterizationSystemsSafetyConstants.MODIFY) {
                        statusCell.empty();
                        rowsOfMappedFields[i].value = ParameterizationSystemsSafetyConstants.DEPLOYED;
                        var imgSpan = SystemsSafetyViewCommonUtilities.buildImgSpan('check', '1.5', 'green', SystemsSafetyNLS.deployed);
                        imgSpan.inject(statusCell);
                    }
                    if (statusCell.value === ParameterizationSystemsSafetyConstants.REMOVE) {
                        fieldsToBeRemoved.push(rowsOfMappedFields[i]);
                    }
                }
            }

            fieldsToBeRemoved.forEach(function(attrMapping) {
                attrMapping.remove();
            });

            var formulaField = document.querySelector('#structureTreePatternsStatusRow');
            formulaField.cells[formulaField.cells.length - 1].empty();
            SystemsSafetyViewCommonUtilities.buildImgSpan('check', '1.5', 'green', SystemsSafetyNLS.deployed).inject(formulaField.cells[formulaField.cells.length - 1]);
        },

        onApplyPartnerSuccess: function() {
            var fieldsToBeRemoved = [];

            var rowsOfMappedFields = this.contentDiv.getElementsByClassName('partnerFieldMapping');
            for (var i = 0; i < rowsOfMappedFields.length; i++) {
                if (rowsOfMappedFields[i].value === ParameterizationSystemsSafetyConstants.NEW_NOT_DEPLOYED) {
                    var statusCell = rowsOfMappedFields[i].cells[rowsOfMappedFields[i].cells.length - 1];
                    if (statusCell.value === ParameterizationSystemsSafetyConstants.ADD || statusCell.value === ParameterizationSystemsSafetyConstants.MODIFY) {
                        statusCell.empty();
                        rowsOfMappedFields[i].value = ParameterizationSystemsSafetyConstants.DEPLOYED;
                        var imgSpan = SystemsSafetyViewCommonUtilities.buildImgSpan('check', '1.5', 'green', SystemsSafetyNLS.deployed);
                        imgSpan.inject(statusCell);
                    }
                    if (statusCell.value === ParameterizationSystemsSafetyConstants.REMOVE) {
                        fieldsToBeRemoved.push(rowsOfMappedFields[i]);
                    }
                }
            }

            fieldsToBeRemoved.forEach(function(attrMapping) {
                attrMapping.remove();
            });

            var formulaField = document.querySelector('#partnersStatusRow');
            formulaField.cells[formulaField.cells.length - 1].empty();
            SystemsSafetyViewCommonUtilities.buildImgSpan('check', '1.5', 'green', SystemsSafetyNLS.deployed).inject(formulaField.cells[formulaField.cells.length - 1]);
        },

        createStructureTreePatternDialogBox: function() {
            var that = this;
            var options = {
                className: 'part-number-modal',
                title: SystemsSafetyNLS.addPattern
            };

            var alreadyDefinedTypes = [];
            var rowsOfMappedFields = this.contentDiv.getElementsByClassName('structureTreePatternFieldMapping');
            for (var i = 0; i < rowsOfMappedFields.length; i++) {
                alreadyDefinedTypes.push(SystemsSafetyViewStructureTreePatternUtilities.buildsFieldJsonObject(rowsOfMappedFields[i]).type);
            }

            this.modal = new SystemsSafetyModalStructureTreePattern(options);
            this.modal.modal.setFooter("<button type='button' name='addButton' id='add-button' class='btn btn-primary'>" + SystemsSafetyNLS.add + "</button> " + "</button>" + "<button type='button' name='cancelButton' id='cancel-button' class='btn btn-default'>" + SystemsSafetyNLS.cancel + "</button>");
            this.modal.getModalBody(this._plmTypes, alreadyDefinedTypes);
            this.modal._bindFooterEvent();
            this.modal.getContent().getElements('.btn').forEach(function(element) {
                if (element.name === 'cancelButton') {
                    element.addEvent('click', function() {
                        that.modal.destroy();
                    });
                } else if (element.name === 'addButton') {
                    element.addEvent('click', function() {
                        var toDisplayOver = that.modal.getContent().getElement('.enox-arch-number-content');
                        var userSelectedFormat = that.modal.getUserEnteredValues();

                        if (userSelectedFormat.type === '') {
                            that.modal.displayAlertMessage(SystemsSafetyNLS.typeNullMessage, toDisplayOver);
                        } else if (userSelectedFormat.pattern === '') {
                            that.modal.displayAlertMessage(SystemsSafetyNLS.patternNullMessage, toDisplayOver);
                        } else {
                            userSelectedFormat.action = ParameterizationSystemsSafetyConstants.ADD;
                            var fieldInfo = SystemsSafetyViewStructureTreePatternUtilities.buildNewField(userSelectedFormat, ParameterizationSystemsSafetyConstants.NEW_NOT_DEPLOYED);
                            fieldInfo.inject(that.getElement(".structureTreePatternFieldbody"));
                            that.modal.destroy();
                        }
                    });
                }
            });

            this.modal.show();
        },

        createPartnerDialogBox: function() {
            var that = this;
            var options = {
                className: 'part-number-modal',
                title: SystemsSafetyNLS.addPartner
            };

            this.modal = new SystemsSafetyModalPartner(options);
            this.modal.modal.setFooter("<button type='button' name='addButton' id='add-button' class='btn btn-primary'>" + SystemsSafetyNLS.add + "</button> " + "</button>" + "<button type='button' name='cancelButton' id='cancel-button' class='btn btn-default'>" + SystemsSafetyNLS.cancel + "</button>");
            this.modal.getModalBody();
            this.modal._bindFooterEvent();
            this.modal.getContent().getElements('.btn').forEach(function(element) {
                if (element.name === 'cancelButton') {
                    element.addEvent('click', function() {
                        that.modal.destroy();
                    });
                } else if (element.name === 'addButton') {
                    element.addEvent('click', function() {
                        var toDisplayOver = that.modal.getContent().getElement('.enox-arch-number-content');
                        var userSelectedFormat = that.modal.getUserEnteredValues();

                        if (userSelectedFormat.name === '') {
                            that.modal.displayAlertMessage(SystemsSafetyNLS.nameNullMessage, toDisplayOver);
                        } else if (userSelectedFormat.url === '') {
                            that.modal.displayAlertMessage(SystemsSafetyNLS.urlNullMessage, toDisplayOver);
                        } else {
                            userSelectedFormat.action = ParameterizationSystemsSafetyConstants.ADD;
                            var fieldInfo = SystemsSafetyViewPartnerUtilities.buildNewField(userSelectedFormat, ParameterizationSystemsSafetyConstants.NEW_NOT_DEPLOYED);
                            fieldInfo.inject(that.getElement(".partnerFieldbody"));
                            that.modal.destroy();
                        }
                    });
                }
            });

            this.modal.show();
        },

        getAlertMessage: function(message, className, toDisplayOn) {
            var alert = new Alert({
                visible: true,
                className: 'param-alert',
                messageClassName: className,
                closable: true,
                renderTo: toDisplayOn,
                autoHide: true,
                hideDelay: 2000
            });
            alert.add({
                message: message
            });

        },

        destroy: function() {
            this.stopListening();
            this._parent.apply(this, arguments);
        },

        _updateParentViewWithNewDomain: function(view, domainId) {
            view.options.domainid = domainId;
            view.model.id = domainId;
            view.model._attributes.domainid = domainId;
            view.model._attributes.id = domainId;
            return view;
        }
    });

    return extendedView;
});

/**
* @quickreview  ROW 24:08:30 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationUnitsAndParameters/ParametersConfigFamilyView',
  [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
    'DS/ParameterizationSkeleton/Utils/ParameterizationUnitsAndParameters/UnitsAndParametersParameterizationWebServices',
    'DS/ParameterizationSkeleton/Utils/ParameterizationUnitsAndParameters/UnitsAndParametersParameterizationDataUtils',
    'DS/ParameterizationSkeleton/Model/DELConfigurationParameterizationModel/DELConfigurationParamTranslationModel',
    "DS/Tweakers/TweakerString",
    'DS/Controls/ModalContainer',
    'DS/Controls/Loader',
    'i18n!DS/ParameterizationSkeleton/assets/nls/UnitsAndParameters',
  ],
  function (
    UWA,
    DELConfigurationFamilyView,
    UnitsAndParametersParameterizationWebServices,
    UnitsAndParametersParameterizationDataUtils,
    DELConfigurationParamTranslationModel,
    TweakerString,
    WUXModalContainer,
    WUXLoader,
    Nls
  ) {

    'use strict';

    var ParametersConfigFamilyView = DELConfigurationFamilyView.extend({

      _node: null,
      _3dspaceDimensions: null,
      _bEditMode: false,

      /*
      * init
      */
      init: function init(options) {
        var that = this;
        this._parent(options);

        that._treeListViewNls = Nls;
        that._modalViewNls = Nls;
        that._nodeTreeViewNls = Nls;
      },
      /*
      * onOKEditButtonClick
      */
      onOKEditButtonClick: function onOKEditButtonClick() {
        var that = this;
        that._bEditMode = true;
        that._parent();
        that._bEditMode = false;
      },

      /*
      * onCancelButtonClick
      */
      onCancelButtonClick: function onCancelButtonClick() {
        var that = this;
        that._parent();
        that._bEditMode = false;
      },

      /*
      * editSelectedNode
      */
      editSelectedNode: function editSelectedNode(params) {
        console.log("params " + params);
        var that = this;
        that._bEditMode = true;
        that._parent(params);
      },
      /*
      * mapFunctions
      */
      mapFunctions: function mapFunctions(name) {
        var that = this;
        if (name === "onChangeParamDimensionCombo")
          return that.onChangeDimensionClick.bind(that);
        if (name === "onChangeParamTypeCombo")
          return that.onChangeParamTypeClick.bind(that);
        else return null;
      },

      /*
       * buildModal
       */
      buildModal: function buildModal(bEditMod) {
        var that = this;
        that._modalViewNls.modalTitle = that._modalViewNls.Title_Parameters_modal;
        that._modalViewNls.Info = that._modalViewNls.Info_Parameters_modal;
        this._parent(bEditMod);

        // var uriEditor = document.getElementById("URI");
        // uriEditor.dsModel.value = that.createUUID();

        var comboDimensions = document.getElementById("paramDimension");
        var comboUOM = document.getElementById("paramUOM");
        comboDimensions.dsModel.disabled = true;
        comboDimensions.dsModel.elementsList = [];
        comboDimensions.dsModel.selectedIndex = -1;

        comboUOM.dsModel.disabled = true;
        comboUOM.dsModel.elementsList = [];
        comboUOM.dsModel.selectedIndex = -1;
        comboUOM.dsModel.placeholder = "";
        var listForCombo = that.getDimensionsList();
        var comboElementsListLength = listForCombo.length;
        if (comboElementsListLength > 0) {
          //comboDimensions.dsModel.disabled = false;
          comboDimensions.dsModel.elementsList = listForCombo;
          comboDimensions.dsModel.selectedIndex = -1;
          comboDimensions.dsModel.autocompleteFlag = false;
        }

        if (!that._bEditMode) {
          that.replacePossibleValuesEditorWithTweakerString();
          var editorPossibleValues = document.getElementById("paramPossibleValues");
          editorPossibleValues.dsModel.disabled = true;
        }
     
      },

      replacePossibleValuesEditorWithTweakerString: function replacePossibleValuesEditorWithTweakerString(value) {
        var that = this;
        var tweakerStringValue = [];
        if (value != undefined)
          tweakerStringValue = value;
        var editorPossibleValues = document.getElementById("paramPossibleValues");
        var tempUiElt = new TweakerString({
          value: tweakerStringValue,
          allowMultipleValuesFlag: true,
        })
        if (tempUiElt && editorPossibleValues) {
          tempUiElt.addEventListener('liveChange', that.onPossibleValuesChange.bind(that));
          tempUiElt.elements.internalView.elements.container.setStyles({
            'width': '100%',
            display: 'flex'
          });
          tempUiElt.elements.container.className += " deltextEditormodal";
          tempUiElt.elements.container.setAttribute('id', "paramPossibleValues");
          var subModalContentDiv = document.getElementsByClassName("subcontentModalView");
          subModalContentDiv.item(5).replaceChild(tempUiElt.elements.container, editorPossibleValues);
        }
      },

      /*
      * presetModal
      */
      presetModal: function presetModal(node) {
        console.log("presetModal");
        var that = this;
        that._parent(node);
        var nodeGrid = node.getGrid();
        var nodeData = node.getData();
        var selectedUnits = nodeGrid["paramUOM"];
        if (selectedUnits != null && selectedUnits != undefined) {
          var selectedUnitsArray = selectedUnits.split(", ");
          var comboUOM = document.getElementById("paramUOM");
          if (comboUOM.dsModel.elementsList != null && comboUOM.dsModel.elementsList != undefined) {

            var elementList = comboUOM.dsModel.elementsList;
            var elementListLength = elementList.length;
            var selectedIndexesUOM = [];
            for (var k = 0; k < elementListLength; k++) {
              if (selectedUnitsArray.includes(elementList[k].label))
                selectedIndexesUOM.push(k);

            }
            if (selectedIndexesUOM != null && selectedIndexesUOM.length)
              comboUOM.dsModel.selectedIndex = -1;
              comboUOM.dsModel.selectedIndexes = selectedIndexesUOM;
          }
        }
        var selectedPossibleValues = nodeGrid["paramPossibleValues"];
        if (selectedPossibleValues != null && selectedPossibleValues != undefined) {
          var selectedPossibleValuesArray = selectedPossibleValues.split(",");
          var possibleValuesEditor = document.getElementById("paramPossibleValues");
          possibleValuesEditor.dsModel.value = selectedPossibleValuesArray;
        }
        that.replacePossibleValuesEditorWithTweakerString(selectedPossibleValuesArray);

        if (nodeData['paramDimension'] != "AritraryUnit" && nodeData["paramType"] != "String") {
          var editorPossibleValues = document.getElementById("paramPossibleValues");
          editorPossibleValues.dsModel.disabled = true;
        }
      },

      onPossibleValuesChange : function onPossibleValuesChange(changeEvent){
        // The below logic is to forbid duplicate values
        var enteredValues = changeEvent.dsModel.value;
        var uniquePossiblevalues = [];
        if (Array.isArray(enteredValues)) {
          enteredValues.forEach(possibleValue => {
            if (!uniquePossiblevalues.includes(possibleValue))
              uniquePossiblevalues.push(possibleValue);
          })
          changeEvent.dsModel.value = uniquePossiblevalues;
        }
      },

      validateModal: function validateModal() {

        var that = this;

        var elementPossibleValues = document.getElementById("paramPossibleValues");
        var valuePossibleValues = elementPossibleValues.dsModel.value;
        var uniquePossiblevalues = [];
        if (Array.isArray(valuePossibleValues)) {
            var modifiedPossibleValuesString = '';
            valuePossibleValues.forEach((possibleValue) => {
              var trimmedPossibleValue = possibleValue.trim();
              if (trimmedPossibleValue != '') {
                if (modifiedPossibleValuesString != '') modifiedPossibleValuesString = modifiedPossibleValuesString + ',' + trimmedPossibleValue;
                else modifiedPossibleValuesString = trimmedPossibleValue;
              }
            });
          elementPossibleValues.dsModel.value = modifiedPossibleValuesString;
        }

        var treeNodeModal = that._parent();

        if (treeNodeModal != undefined) {
          var data = treeNodeModal.getData();

          var rowModelLength = that.treeListView.getRowModelLength();
          var listParamLabelsAlreadyDefined = [];

          if (rowModelLength) {
            for (var rowIndex = 0; rowIndex < rowModelLength; rowIndex++) {
              var dataObject = that.getRowDataFromTreeView(rowIndex);
              listParamLabelsAlreadyDefined.push(dataObject['paramLabel']);
            }
          }

          var editNodeName = "";
          if (that._bEditMode) {
            var nodeData = that._node.getData();
            editNodeName = nodeData["paramLabel"];
          }
          var bShowError = false;
          var strErrorMessage = "";

          var nameValue = data['paramLabel'];
          var nameNls = Nls.paramLabel;

          if ((!that._bEditMode && listParamLabelsAlreadyDefined.includes(nameValue)) || (that._bEditMode && editNodeName != nameValue && listParamLabelsAlreadyDefined.includes(nameValue))) {
            strErrorMessage = Nls.ErrorMsgAlreadyUsed;
            bShowError = true;
            strErrorMessage = strErrorMessage.replaceAll("%1", nameNls);
          }
          
          if (bShowError) {
            that._modalView.showToastMessage(2, strErrorMessage);
            return;
          }
          if (treeNodeModal.getData() != null & treeNodeModal.getData() != undefined &&
            treeNodeModal.getData().paramUOM != null && treeNodeModal.getData().paramUOM != undefined &&
            Array.isArray(treeNodeModal.getData().paramUOM)) {
            var modifiedUnitString = "";
            treeNodeModal.getData().paramUOM.forEach(unit => {
              if (modifiedUnitString != "")
                modifiedUnitString = modifiedUnitString + "," + unit;
              else
                modifiedUnitString = unit;
            });
            treeNodeModal.getData().paramUOM = modifiedUnitString;
          }
        }
        else
          elementPossibleValues.dsModel.value = valuePossibleValues;
        var data = treeNodeModal.getData()
        return treeNodeModal;
      },

      createUUID: function createUUID() {
        var dt = new Date().getTime();
        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
          var r = (dt + Math.random() * 16) % 16 | 0;
          dt = Math.floor(dt / 16);
          return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);
        });
        return uuid;
      },
      /*
      * createtreeNode
      */
      createtreeNode: function createtreeNode(data, grid) {
        var that = this;
        UnitsAndParametersParameterizationDataUtils.AddToParameterList(data['paramLabel']);

      // Adding URI as an attribute
      if (data["paramLabel"] && grid != undefined && grid["paramLabel"] && data["URI"] == undefined && grid["URI"] == undefined) {
        var uniqueID = null;
        if (that._bEditMode)
          uniqueID = that._node.getData().URI;
        else
          uniqueID = that.createUUID();
        data["URI"] = uniqueID;
        grid["URI"] = uniqueID;
      }

        var translationModel = new DELConfigurationParamTranslationModel({
          data: data,
          grid: grid,
          nls: Nls
        });

        if (grid == undefined) {
          var gridTemp = translationModel.getGrid();

          // We only store actual Dimension & Unit name in DB, to display we need to construct the NLS name and set it on the grid of DataGrid model.
          if (that._3dspaceDimensions != null && that._3dspaceDimensions != undefined && gridTemp != undefined && gridTemp.hasOwnProperty("paramDimension")) {

            var storedDimensionName = data["paramDimension"];
            var storedUnitName = data["paramUOM"];
            if (storedDimensionName != "ArbitraryUnit") {
              var dimObj = null;
              var nbDimensions = that._3dspaceDimensions.results.length;
              for (var idxDim = 0; idxDim <= nbDimensions; idxDim++) {
                dimObj = that._3dspaceDimensions.results[idxDim];
                if (dimObj && dimObj.Name == storedDimensionName) {
                  if (dimObj.NLS != undefined && dimObj.NLS != "")
                    gridTemp['paramDimension'] = dimObj.NLS;
                  break;
                }
              }
              if (dimObj) {
                var nbUnits = dimObj.Units.length;
                var strUnitsDisplay = "";
                if (storedUnitName != undefined && storedUnitName != null) {
                  for (var idxUnit = 0; idxUnit <= nbUnits; idxUnit++) {
                    var unitObj = dimObj.Units[idxUnit];
                    var unitsArray = storedUnitName.split(",");
                    unitsArray.forEach(unit => {
                      if (unitObj && unitObj.Name == unit) {
                        if (unitObj.NLSName != undefined && unitObj.NLSName != "") {
                          if (strUnitsDisplay != "")
                            strUnitsDisplay = strUnitsDisplay + ", " + unitObj.NLSName;
                          else
                            strUnitsDisplay = unitObj.NLSName;
                        }
                      }
                    })
                    // if (unitObj && unitObj.Name == storedUnitName) {
                    //   if (unitObj.NLSName != undefined && unitObj.NLSName != "")
                    //     gridTemp['paramUOM'] = unitObj.NLSName;
                    //   break;
                    // }
                  }
                }
                gridTemp['paramUOM'] = strUnitsDisplay;
              }
            }
            else {
              var listArbitraryUnits = UnitsAndParametersParameterizationDataUtils.getArbitraryUnitsList();
              if (listArbitraryUnits != null && listArbitraryUnits != undefined && listArbitraryUnits.length) {
                var strUnitsDisplay = "";
                if (storedUnitName != undefined && storedUnitName != null) {
                  var unitsArray = storedUnitName.split(",");
                  unitsArray.forEach(unit => {
                    listArbitraryUnits.forEach(arbUnitObj => {
                      if (arbUnitObj && arbUnitObj.URI === unit) {
                        if (strUnitsDisplay != "")
                          strUnitsDisplay = strUnitsDisplay + ", " + arbUnitObj.arbitraryUnitName;
                        else
                          strUnitsDisplay = arbUnitObj.arbitraryUnitName;
                      }
                    })
                  });
                }
                gridTemp['paramUOM'] = strUnitsDisplay;
              }
            }
          }
        }
        return translationModel;
      },

      /*
      * addChild
      */
      addChild: function addChild(nodesTab) {
        var that = this;

        that._parent(nodesTab);
        // that.treeListView.sortModel = [{ dataIndex: 'paramLabel', sort: 'asc' }];
        // that.treeListView.reapplySortModel();
      },
      /*
      * getPromisetoGetInfofromDB
      */
      getPromisetoGetInfofromDB: function getPromisetoGetInfofromDB() {
        var that = this;
        var promise = new UWA.Promise(function (resolve, reject) {
          if (that._3dspaceDimensions == null || that._3dspaceDimensions == undefined) {
            that._3dspaceDimensions = {};

            UnitsAndParametersParameterizationWebServices.getlistofDimensions({
              onSuccess: function (data) {
                that._3dspaceDimensions = data;
                resolve();
              }
            });
          }
          else
            resolve()
        });
        return promise;
      },

      getDimensionsList: function getDimensionsList() {
        var that = this;
        var listForCombo = [];
        var DimensionsList = [];
        var numberOfDimensions = that._3dspaceDimensions.results.length;
        listForCombo.push({ label: Nls.ArbitraryUnit, value: "ArbitraryUnit" });
        for (var i = 0; i < numberOfDimensions; i++) {
          var dimObj = that._3dspaceDimensions.results[i];
          if (dimObj) {
            var dimName = dimObj.Name;
            if (!DimensionsList.includes(dimName)) {
              DimensionsList.push(dimName);
              var comboLabel = dimObj.NLS;
              var comboValue = dimObj.Name;
              listForCombo.push({ label: comboLabel, value: comboValue });
            }

            if (listForCombo.length) {
              listForCombo.sort(function (comboValue1, comboValue2) {
                if (comboValue1.label.toLowerCase() === comboValue2.label.toLowerCase())
                  return 0;
                return comboValue1.label.toLowerCase() > comboValue2.label.toLowerCase() ? 1 : -1;
              });
            }
          }
        }
        return listForCombo;
      },

      onChangeParamTypeClick: function onChangeParamTypeClick() {
        var that = this;
        var comboParamTypes = document.getElementById("paramType");
        var elementPossibleValues = document.getElementById("paramPossibleValues");
        var comboDimensions = document.getElementById("paramDimension");
        var comboUnits = document.getElementById("paramUOM");
        var selectedParamType = comboParamTypes.dsModel.elementsList[comboParamTypes.dsModel.selectedIndex].value;
        if(selectedParamType == "Real"){
          elementPossibleValues.dsModel.disabled = true;
          //elementPossibleValues.elements.internalView.elements.container.dsModel.disabled = false;
          elementPossibleValues.dsModel.value="";
          //elementPossibleValues.elements.internalView.elements.container.dsModel.value="";
          comboDimensions.dsModel.disabled = false;
          comboUnits.dsModel.disabled = false;
          that._uiElementsIDs.forEach(element => {
            if (element.id === "paramDimension" || element.id === "paramUOM") {
              element.mandatory = true;
            }
          });
        }
        else if(selectedParamType == "String"){
          comboDimensions.dsModel.disabled = true;
          comboDimensions.dsModel.selectedIndex = -1;
          comboUnits.dsModel.disabled = true;
          comboUnits.dsModel.selectedIndex = -1;
          //tempUiElt.elements.internalView.elements.container
          elementPossibleValues.dsModel.disabled = false;
          //elementPossibleValues.elements.internalView.elements.container.dsModel.disabled = false;
          that._uiElementsIDs.forEach(element => {
            if (element.id === "paramDimension" || element.id === "paramUOM") {
              element.mandatory = false;
            }
          });
        }
      },
      
      onChangeDimensionClick: function onChangeDimensionClick() {
        var that = this;
        var comboDimensions = document.getElementById("paramDimension");
        var comboUOM = document.getElementById("paramUOM");
        comboUOM.dsModel.disabled = true;
        comboUOM.dsModel.elementsList = [];
        comboUOM.dsModel.selectedIndex = -1;
        if (comboDimensions.dsModel.selectedIndex != -1 && comboDimensions.dsModel.elementsList[comboDimensions.dsModel.selectedIndex].value != undefined) {
          var selectedDimension = comboDimensions.dsModel.elementsList[comboDimensions.dsModel.selectedIndex].value;
          var bUnitMandatoryFlag = false;

          var listForCombo =[];

          if (selectedDimension == "ArbitraryUnit") {
            // If ArbitraryUnit is selected for dimension, then Unit is mandatory.
            bUnitMandatoryFlag = true;
            listForCombo = that.fillArbitraryUnitsList();
          }
          else {
            listForCombo =  that.fillUnitsForSelected3DSpaceDimension(selectedDimension);
          }

          that._uiElementsIDs.forEach(element => {
            if (element.id === "paramUOM") {
              element.mandatory = bUnitMandatoryFlag;
            }
          });
          if (listForCombo.length) {
            listForCombo.sort(function (comboValue1, comboValue2) {
              if (comboValue1.label.toLowerCase() === comboValue2.label.toLowerCase())
                return 0;
              return comboValue1.label.toLowerCase() > comboValue2.label.toLowerCase() ? 1 : -1;
            });
          }
  
          if (listForCombo.length > 0) {
            var comboUOM = document.getElementById("paramUOM");
            comboUOM.dsModel.disabled = false;
            comboUOM.dsModel.elementsList = listForCombo;
            comboUOM.dsModel.selectedIndex = -1;
            comboUOM.dsModel.autocompleteFlag = false;
  
            comboUOM.type = "multiselcombobox";
            comboUOM.dsModel.multiSelFlag = true;
            comboUOM.dsModel.enableSearchFlag = false;
          }
        }
      },

      fillUnitsForSelected3DSpaceDimension: function fillUnitsForSelected3DSpaceDimension(i_dimensionName) {
        var that = this;
        var listForCombo = [];
        var unitsList = [];
        var numberOfDimensions = that._3dspaceDimensions.results.length;
        for (var i = 0; i < numberOfDimensions; i++) {
          var dimObj = that._3dspaceDimensions.results[i];
          if (dimObj) {
            var dimName = dimObj.Name;
            if (dimName == i_dimensionName) {

              var listUnitsForDimension = dimObj.Units.length;
              for (var idxUnit = 0; idxUnit < listUnitsForDimension; idxUnit++) {
                var unitObj = dimObj.Units[idxUnit];
                var unitName = unitObj.Name;
                if (!unitsList.includes(unitName)) {
                  unitsList.push(unitName);
                  var comboLabel = unitObj.NLSName;
                  var comboValue = unitObj.Name;
                  listForCombo.push({ label: comboLabel, value: comboValue });
                }
              }
              break;
            }
          }
        }
        return listForCombo;
      },


      fillArbitraryUnitsList: function fillArbitraryUnitsList() {
        var that  = this;
        
        var listForCombo = [];
        var listArbitraryUnits = UnitsAndParametersParameterizationDataUtils.getArbitraryUnitsList();

        if (listArbitraryUnits.length) {
          var nUnits = listArbitraryUnits.length;
          //var listForCombo = [];
          for (var idxUnit = 0; idxUnit < nUnits; idxUnit++) {
            listForCombo.push({ label: listArbitraryUnits[idxUnit].arbitraryUnitName, value: listArbitraryUnits[idxUnit].URI });
          }
        }
          /*

        var promise = new UWA.Promise(function (resolve, reject) {
          var comboUOM = document.getElementById("paramUOM");
          //loader
          var loader = new WUXLoader({ height: 22 });
          loader.on(Nls.Loading);

          var parentUOMContainer = comboUOM.getParent();
          parentUOMContainer.style.position = "sticky";
          WUXModalContainer.createModal(parentUOMContainer, loader.elements.container);

          UnitsAndParametersParameterizationWebServices.getlistofArbitraryUnits({
            onSuccess: function (data) {
              loader.off();
              WUXModalContainer.removeModal(parentUOMContainer);
              parentUOMContainer.style.position = "";
              listArbitraryUnits = data.results;

              resolve();
            }
          });
        });
        UWA.Promise.all([promise]).then(function () {
          if (listArbitraryUnits.length) {
            var nUnits = listArbitraryUnits.length;
            //var listForCombo = [];
            for (var idxUnit = 0; idxUnit < nUnits; idxUnit++) {
              listForCombo.push({ label: listArbitraryUnits[idxUnit].label, value: listArbitraryUnits[idxUnit].uri });
            }
            if (listForCombo.length) {
              listForCombo.sort(function (comboValue1, comboValue2) {
                if (comboValue1.label.toLowerCase() === comboValue2.label.toLowerCase())
                  return 0;
                return comboValue1.label.toLowerCase() > comboValue2.label.toLowerCase() ? 1 : -1;
              });
            }
            var comboUOM = document.getElementById("paramUOM");
            comboUOM.dsModel.disabled = false;
            comboUOM.dsModel.elementsList = listForCombo;
            comboUOM.dsModel.selectedIndex = -1;
            comboUOM.dsModel.autocompleteFlag = false;

            comboUOM.type = "multiselcombobox";
            comboUOM.dsModel.multiSelFlag = true;
            comboUOM.dsModel.enableSearchFlag = false;
          }
        });
        */
        return listForCombo;

      }



    });
    return ParametersConfigFamilyView;
  });

/**
 * @author AMN14
 */
define('DS/ParameterizationSkeleton/Views/ParamCollaboration/TypesNotSyncMapping/TypesNotSyncMappingLayoutUtilities',
    [
     'UWA/Core',
     'DS/UIKIT/Input/Button',
     'DS/UIKIT/Input/Select',
     'DS/UIKIT/Modal',
     'DS/UIKIT/Alert',
     'DS/UIKIT/Tooltip',
     'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
     'i18n!DS/ParameterizationSkeleton/assets/nls/TypesNotSyncMappingManagementNLS'
    ],
    function(
        UWA,
        Button,
        Select,
        Modal,
        Alert,
        Tooltip,
        ParametersLayoutViewUtilities,
        TNSMappingNLS
    ){
        'use strict';

        var TNSMappingUICSSClasses = {
          mappingLineClass : "TNSMappingLine",
          mappingLineTypeClass : "TNSTypeName",
          TNSBadgeRootContainerClass : "TNSBadgeRootContainer",
          TNSBadgeContainerClass : "TNSBadgeContainer",
          TNSBadgeContainerMsgClass : "TNSBadgeContainerMsg",
          TNSSpecTypeSelectorContainerClass : "TNSSpecTypeSelectorContainer",
          TNSSpecTypeAddButtonClass : "TNSSpecTypeAddButton",

          TNSBadgeClass : "TNSBadge",
          TNSBadgeLabelClass : "TNSBadgeLabel",
          TNSBadgeActionClass : "TNSBadgeAction",
          TNSBadgeStatusClass : "TNSBadgeStatus",
          TNSBadgeDefaultClass : "TNSBadgeDefault",
          TNSBadgeStoredClass : "TNSBadgeStored",
          TNSBadgeAddedClass : "TNSBadgeAdded",
          TNSBadgeDeployedClass : "TNSBadgeDeployed",
          TNSBadgeDeletedClass : "TNSBadgeDeleted",
          TNSBadgeDeletedErrorClass : "TNSBadgeDeletedError",
          TNSBadgeStoredDeletedClass : "TNSBadgeStoredDeleted",
          TNSBadgeStoredDeletedErrorClass : "TNSBadgeStoredDeletedError",

          mappingLineStatusClass : "TNSStatus",
          mappingLineDeployedStatusClass : "TNSDeployedStatus",
          mappingLineModifiedStatusClass : "TNSModifiedStatus",
        };

        var MappingLineIDSuffix = "_TNSMappingID";

        var UIview = UWA.Class.extend({

            /**
             * Initialize util variables to manage operations on the view easily.
             * @param TNSMappingLayoutView The instance of the TNS mapping widget view.
             */
            init : function () {
                UWA.log('TypesNotSyncMappingLayoutUtilities::init');

                this.mappingLinesViews = {};
                this.SpecializationTypes = null;

                // building messager to display information for the user...
                this.userMessager = new Alert({
                    className : 'param-alert',
                    closable: true,
                    visible: true,
                    renderTo : document.body,
                    autoHide : true,
                    hideDelay : 2000,
                    messageClassName : 'warning'
                });
            },

            /**
             * Initialize the SpecializationTypes field.
             * @param specializationTypes The tree view of specialization types which are mappable.
             */
            initializeSpecializationTypes : function(specializationTypes){
                UWA.log('TypesNotSyncMappingLayoutUtilities::initializeSpecializationTypes');
                this.SpecializationTypes = specializationTypes;
            },

            /**
             * Build the view corresponding to a TNS mapping line.
             * @param typeName The name of the type for which some specialization types won't be collaborated.
             * @param typeDisplayName The display name of the type for which some specialization types won't be collaborated.
             * @param isMutable A flag saying if the current TNS mapping line is mutable. If false, the mapping line won't have a "Add" button to add specialization types.
             * By default, a TNS mapping line is mutable.
             * @return The mapping line view which has been created OR, if typeName has already a mapping line view associated, NULL.
             */
            buildTNSLineView : function(typeName, typeDisplayName, isMutable /*= true*/){
                UWA.log('TypesNotSyncMappingLayoutUtilities::buildTNSLineView');
                if(isMutable === undefined) isMutable=true;
                // if there is already a mapping line view associated to the typeName, do nothing...
                if(typeof this.mappingLinesViews[typeName] !== "undefined") return null;

                var self = this;

                var mappingLineView = UWA.createElement('div', {'id' : typeName + MappingLineIDSuffix, 'class' : TNSMappingUICSSClasses.mappingLineClass});
                this.mappingLinesViews[typeName] = mappingLineView;
                mappingLineView.rootTypeInfo = {
                    typeName : typeName,
                    typeDisplayName : typeDisplayName
                };
                mappingLineView.displayNameContainer = UWA.createElement('div', {'class' : TNSMappingUICSSClasses.mappingLineTypeClass});
                mappingLineView.statusContainer = UWA.createElement('div', {'class' : TNSMappingUICSSClasses.mappingLineStatusClass + ' ' + TNSMappingUICSSClasses.mappingLineDeployedStatusClass});
                mappingLineView.specializationTypesContainer = UWA.createElement('div', {'class' : TNSMappingUICSSClasses.TNSBadgeRootContainerClass});

                // defining type display name
                UWA.createElement('span', {
                    'class' : 'font-3dsregular',
                    html : typeDisplayName
                }).inject(mappingLineView.displayNameContainer);

                // defining status
                UWA.createElement('i', {
                    'class' : 'fonticon fonticon-check',
                    title : TNSMappingNLS.Tooltip.DeployedStatus
                }).inject(mappingLineView.statusContainer);
                mappingLineView.statusContainer.isModififed = false;

                // creating specialization types container
                // displaying message into the badge container in case there is no spe. types...
                mappingLineView.specializationTypesContainer.emptyMessage = UWA.createElement('span', {
                    'class' : 'font-3dsregular ' + TNSMappingUICSSClasses.TNSBadgeContainerMsgClass,
                    html : TNSMappingNLS.EmptySpecializationTypeListBegin + typeDisplayName + TNSMappingNLS.EmptySpecializationTypeListEnd
                });
                mappingLineView.specializationTypesContainer.emptyMessage.inject(mappingLineView.specializationTypesContainer);

                mappingLineView.specializationTypesContainer.badgeContainer = UWA.createElement('div', {'class' : TNSMappingUICSSClasses.TNSBadgeContainerClass});
                mappingLineView.specializationTypesContainer.badgeContainer.inject(mappingLineView.specializationTypesContainer);
                mappingLineView.specializationTypesContainer.specializationTypeSelectorContainer = UWA.createElement('div', {'class' : TNSMappingUICSSClasses.TNSSpecTypeSelectorContainerClass});
                mappingLineView.specializationTypesContainer.specializationTypeSelectorContainer.inject(mappingLineView.specializationTypesContainer);
                mappingLineView.specializationTypesContainer.badges = [];

                if(isMutable){
                    // creating specialization types selector
                    mappingLineView.specializationTypesContainer.specializationTypeSelectorContainer.selector = new Select({
                        custom : false,
                        className : 'font-3dsregular ',
                        placeholder : TNSMappingNLS.SpeTypeSelectorPlaceholder + typeDisplayName
                    });

                    mappingLineView.specializationTypesContainer.specializationTypeSelectorContainer.selector.placeholder = mappingLineView.specializationTypesContainer.specializationTypeSelectorContainer.selector.getSelection()[0];

                    mappingLineView.specializationTypesContainer.specializationTypeSelectorContainer.addButton = new Button({
                        className : 'primary font-3dsregular ' + TNSMappingUICSSClasses.TNSSpecTypeAddButtonClass,
                        value : TNSMappingNLS.SpeTypeAddButton
                    });
                    mappingLineView.specializationTypesContainer.specializationTypeSelectorContainer.selector.inject(mappingLineView.specializationTypesContainer.specializationTypeSelectorContainer);
                    mappingLineView.specializationTypesContainer.specializationTypeSelectorContainer.addButton.inject(mappingLineView.specializationTypesContainer.specializationTypeSelectorContainer);
                } else {
                    // A message should be display to explain why it's not possible to add a new specialization type for this TNS mapping line.
                    mappingLineView.specializationTypesContainer.immutableTNSMappingLineMsg = UWA.createElement('div', {
                        'class' : 'font-3dsregular ' + TNSMappingUICSSClasses.TNSBadgeContainerMsgClass
                    });
                    UWA.createElement('i', {
                        'class' : 'fonticon fonticon-info'
                    }).inject(mappingLineView.specializationTypesContainer.immutableTNSMappingLineMsg);
                    UWA.createElement('span', {
                        html : TNSMappingNLS.ImmutableTNSMappingLine
                    }).inject(mappingLineView.specializationTypesContainer.immutableTNSMappingLineMsg);
                    mappingLineView.specializationTypesContainer.immutableTNSMappingLineMsg.inject(mappingLineView.specializationTypesContainer);
                }

                mappingLineView.displayNameContainer.inject(mappingLineView);
                mappingLineView.specializationTypesContainer.inject(mappingLineView);
                mappingLineView.statusContainer.inject(mappingLineView);

                return mappingLineView;
            },

            /**
             * Retrieve a created TNS mapping line view.
             * @param typeName The name of the type which is associated to the TNS mapping line view.
             * @return The mapping line view previously created OR, if there is no corresponding TNS mapping line view, NULL.
             */
            getTNSLineView : function(typeName){
                UWA.log('TypesNotSyncMappingLayoutUtilities::getTNSLineView');
                return this.mappingLinesViews[typeName];
            },

            /**
             * Display a message using an alert pop-up.
             * @param kind The types of message which is expected to be displayed (info, warning or error).
             * @param message The message to display.
             */
            displayAlertMessage : function(kind, message){
                UWA.log('TypesNotSyncMappingLayoutUtilities::displayAlertMessage');

                this.userMessager.add({
                    className : kind,
                    message : message
                });
            },

            /**
             * Build a TNS badge which is the view associated to a not collaborated specialization type.
             * @param typeNotSync The object containing all necessary information to build the view.
             * @return The TNS badge which has been created.
             */
            buildTNSBadge : function(typeNotSync){
                UWA.log('TypesNotSyncMappingLayoutUtilities::buildTNSBadge');

                var self = this;

                // defining TNS badge style according to data...
                var statusClass, statusIcon = 'fonticon-check', actionIcon = 'fonticon-trash', tooltip = TNSMappingNLS.Tooltip.DeleteAction, status;
                if(typeNotSync.isDeployed && !typeNotSync.isToBeDeleted){   // deployed
                    if(typeNotSync.isDefaultMapping) {  // default
                        statusClass = TNSMappingUICSSClasses.TNSBadgeDefaultClass;
                        actionIcon = 'fonticon-lock';
                        tooltip = TNSMappingNLS.Tooltip.NotAllowed;
                    } else {
                        statusClass = TNSMappingUICSSClasses.TNSBadgeDeployedClass;
                    }
                } else {
                    if(typeNotSync.isToBeDeleted) {
                        statusIcon = 'fonticon-trash';
                        if(typeNotSync.errorCode && typeNotSync.errorCode !== 0){
                          if(typeNotSync.isDeployed) statusClass = TNSMappingUICSSClasses.TNSBadgeDeletedErrorClass;
                          else statusClass = TNSMappingUICSSClasses.TNSBadgeStoredDeletedErrorClass;
                          actionIcon = 'fonticon-attention';
                          tooltip = TNSMappingNLS.Tooltip.TNSMappingError;
                        } else {
                          statusClass = TNSMappingUICSSClasses.TNSBadgeDeletedClass;
                          actionIcon = 'fonticon-undo';
                          tooltip = TNSMappingNLS.Tooltip.UndeleteAction;
                        }
                    } else {
                        statusIcon = 'fonticon-cog';
                        if(typeNotSync.isStored){
                            statusClass = TNSMappingUICSSClasses.TNSBadgeStoredClass;
                        } else {
                            statusClass = TNSMappingUICSSClasses.TNSBadgeAddedClass;
                        }
                    }
                }

                // creating HTML components composing the TNS badge...
                var TNSBadge = UWA.createElement('div', {'class' : TNSMappingUICSSClasses.TNSBadgeClass + ' ' + statusClass});
                TNSBadge.statusIcon = UWA.createElement ('i', {
                    'class' : 'fonticon ' + statusIcon + ' ' + TNSMappingUICSSClasses.TNSBadgeStatusClass
                });
                TNSBadge.typeLabel = UWA.createElement('span', {
                    'class' : 'font-3dsregular ' + TNSMappingUICSSClasses.TNSBadgeLabelClass,
                    content : typeNotSync.specializationTypeDisplayName
                });
                TNSBadge.actionButton = UWA.createElement('i', {
                    'class' : 'fonticon ' + actionIcon + ' ' + TNSMappingUICSSClasses.TNSBadgeActionClass
                });

                TNSBadge.actionButton.tooltip = new Tooltip({
                    target : TNSBadge.actionButton,
                    position : 'top',
                    body : tooltip
                });

                // inserting badge sub-elements...
                TNSBadge.statusIcon.inject(TNSBadge);
                TNSBadge.typeLabel.inject(TNSBadge);
                TNSBadge.actionButton.inject(TNSBadge);
                TNSBadge.associatedTNSMapping = typeNotSync;

                return TNSBadge;
            },

            /**
             * Insert a TNS badge into the dedicated container.
             * @param tnsBadge The object to add to the badge container created using the TypesNotSyncMappingLayoutUtilities.buildTNSBadge() method.
             */
            insertTNSBadge : function(tnsBadge){
                UWA.log('TypesNotSyncMappingLayoutUtilities::insertTNSBadge');
                if(typeof this.mappingLinesViews[tnsBadge.associatedTNSMapping.typeName] !== 'undefined'){
                    var TNSBadgeContainer = this.mappingLinesViews[tnsBadge.associatedTNSMapping.typeName].specializationTypesContainer;
                    if(TNSBadgeContainer.badgeContainer.getChildren().length === 0) TNSBadgeContainer.emptyMessage.hide();
                    TNSBadgeContainer.badges.push(tnsBadge);
                    tnsBadge.inject(TNSBadgeContainer.badgeContainer);

                    this.updateTNSMappingLineStatus(tnsBadge.associatedTNSMapping.typeName);
                    // if((tnsBadge.associatedTNSMapping.isStored && !tnsBadge.associatedTNSMapping.isDeployed) || tnsBadge.associatedTNSMapping.isToBeDeleted || (!tnsBadge.associatedTNSMapping.isStored)){
                    //     var TNSMappingLineStatus = this.mappingLinesViews[tnsBadge.associatedTNSMapping.typeName].statusContainer;
                    //     TNSMappingLineStatus.isModified = true;
                    //     TNSMappingLineStatus.removeClassName(TNSMappingUICSSClasses.mappingLineDeployedStatusClass);
                    //     TNSMappingLineStatus.getChildren()[0].removeClassName('fonticon-check');
                    //     TNSMappingLineStatus.addClassName(TNSMappingUICSSClasses.mappingLineModifiedStatusClass);
                    //     TNSMappingLineStatus.getChildren()[0].addClassName('fonticon-cog');
                    // }
                }
            },

            /**
             * Insert a new option into a specialization type selector.
             * @param typeName The name of the type for which the selector's option will be created.
             * @param specializationTypeInfo The information about the specialization type.
             */
            addSelectorOptions : function(typeTreeNode){
                UWA.log('TypesNotSyncMappingLayoutUtilities::addSelectorOptions');

                if(typeof this.mappingLinesViews[typeTreeNode.typeInfo.id].specializationTypesContainer.specializationTypeSelectorContainer.selector !== 'undefined'){
                    var selector = this.mappingLinesViews[typeTreeNode.typeInfo.id].specializationTypesContainer.specializationTypeSelectorContainer.selector;
                    var options = [];
                    this.auxAddSelectorOptions(options, typeTreeNode, this.mappingLinesViews[typeTreeNode.typeInfo.id].specializationTypesContainer.badges);
                    // Sort the options of the selectors
                    options.sort(function(opt1, opt2){
                        if(!opt1.specializationTypeInfo || !opt2.specializationTypeInfo || !opt1.specializationTypeInfo.typeInfo || !opt2.specializationTypeInfo.typeInfo) return 0;
                        if(opt1.specializationTypeInfo.typeInfo.name > opt2.specializationTypeInfo.typeInfo.name) return 1;
                        return -1;
                    });
                    // Add options to the selector
                    for(var i = 0 ; i < options.length ; i++){
                        selector.add(options[i]);
                        selector.getOption(options[i].specializationTypeInfo.typeInfo.id).specializationTypeInfo = options[i].specializationTypeInfo;
                    }
                }
            },

            /**
             * Recursive method iterating over sub-types tree to inject new options into the type selector.
             * @param options The options of the selector which will be added.
             * @param treeNode The object containing information about su-types and current type.
             * @param badgeList The list of badges currently in the associated TNS mapping line.
             * @param nodeTobeAdded A flag saying if the current node should be added or not. "false" by default.
             * @param path A string corresponding to the inheritance path of the sub-type. Empty by default.
             */
            auxAddSelectorOptions : function(options, treeNode, badgeList, nodeTobeAdded /*= false*/, path /*= ''*/){
                UWA.log('TypesNotSyncMappingLayoutUtilities::auxAddSelectorOptions');
                if(nodeTobeAdded===undefined) nodeTobeAdded=false;
                if(path===undefined) path='';
                var self = this;

                if(nodeTobeAdded && treeNode.typeInfo !== null){
                    options.push({
                        'label' : treeNode.typeInfo.name,
                        'value' : treeNode.typeInfo.id,
                        'group' : path
                    });

                    var option = options[options.length - 1];
                    option.specializationTypeInfo = treeNode;

                    // if there is a badge mentioning the current specialization type, the select option pointing to the type should be deactivated
                    for(var i = 0 ; i < badgeList.length ; i++) {
                        if(badgeList[i].associatedTNSMapping.specializationTypeName === treeNode.typeInfo.id || option.specializationTypeInfo.typeInfo.derivationPath.split('/').indexOf(badgeList[i].associatedTNSMapping.specializationTypeName)!==-1){
                            option.disabled = true;
                            break;
                        }
                    }
                }

                for(var subTypeName in treeNode.specializationTypes){
                    self.auxAddSelectorOptions(
                        options,
                        treeNode.specializationTypes[subTypeName],
                        badgeList, true,
                        (treeNode.typeInfo !== null) ? ( (path !== '') ? path + '/' + treeNode.typeInfo.name : treeNode.typeInfo.name) : path
                    );
                }
            },

            /**
             * Gather all sub-types into a flat list.
             * @param treeNode The starting node below which we are going to search.
             * @param isRoot Flag saying if we are dealing with the contextual root node (if yes, we don't gather information).
             * @return A flat list containing sub-types information.
             */
            getSubTypesList : function(treeNode, isRoot){
                UWA.log('TypesNotSyncMappingLayoutUtilities::getSubTypesList');

                var subTypes = [];
                if(!isRoot && treeNode.typeInfo !== null){
                    subTypes.push(treeNode.typeInfo);
                }

                for(var subTypeName in treeNode.specializationTypes){
                    subTypes = subTypes.concat(this.getSubTypesList(treeNode.specializationTypes[subTypeName], false));
                }

                return subTypes;
            },

            /**
             * Update the status of the specialization types selectors according to current TNS mapping (represented by the list of badges).
             */
            updateSelectorsOptionsStatus : function(){
                UWA.log('TypesNotSyncMappingLayoutUtilities::updateSelectorOptionsStatus');

                var self = this;

                for(var mappingLineName in this.mappingLinesViews){
                    if(this.mappingLinesViews[mappingLineName].specializationTypesContainer.specializationTypeSelectorContainer.selector){
                        this.mappingLinesViews[mappingLineName].specializationTypesContainer.specializationTypeSelectorContainer.selector.getOptions().forEach(function(option){
                            var badgeList = self.mappingLinesViews[mappingLineName].specializationTypesContainer.badges;
                            option.disabled = false;
                            for(var i = 0 ; i < badgeList.length ; i++) {
                                if(
                                    typeof option.specializationTypeInfo !== 'undefined' &&
                                    (badgeList[i].associatedTNSMapping.specializationTypeName === option.specializationTypeInfo.typeInfo.id ||
                                        (option.specializationTypeInfo.typeInfo.derivationPath.split('/').includes(badgeList[i].associatedTNSMapping.specializationTypeName) &&
                                        !badgeList[i].associatedTNSMapping.isToBeDeleted)
                                    )
                                ){
                                    option.disabled = true;
                                    break;
                                }
                            }
                        });
                    }
                }
            },

            /**
             * Remove a TNS badge from the dedicated container.
             * This method should be used after successful apply (for TNS badges associated to parameters which had been deleted) or for TNS badges associated
             * to new parameters which are not stored (no action needed on server side).
             * @param tnsBadge The object to remove from the badge container created using the TypesNotSyncMappingLayoutUtilities.buildTNSBadge() method.
             */
            removeTNSBadge : function(tnsBadge){
                UWA.log('TypesNotSyncMappingLayoutUtilities::removeTNSBadge');

                var TNSBadgeContainer = this.mappingLinesViews[tnsBadge.associatedTNSMapping.typeName].specializationTypesContainer;
                var badgeIndex = TNSBadgeContainer.badges.indexOf(tnsBadge);
                if(badgeIndex >= 0) TNSBadgeContainer.badges.splice(badgeIndex, 1);
                tnsBadge.destroy();
                if(TNSBadgeContainer.badgeContainer.getChildren().length === 0) TNSBadgeContainer.emptyMessage.show();
                this.updateTNSMappingLineStatus(tnsBadge.associatedTNSMapping.typeName);
            },

            /**
             * Change the status of a TNS badge.
             * This method should be used when the TNS badge action button is clicked and the TNS badge isn't a newly added one (so when actions on server side are required).
             * Multiple operations should be performed here :
             *                - update classes according to new status of the TNS badge
             *                - update status icon of the TNS mapping related to the TNS badge
             *                - update action icon and tooltip to fit with the new status of the TNS badge
             * @param tnsBadge The TNS badge which has been clicked and which should have its status changed.
             */
            updateTNSBadgeStatus : function(tnsBadge){
                UWA.log('TypesNotSyncMappingLayoutUtilities::changeTNSBadgeStatus');

                var isDeployed=false;
                tnsBadge.actionButton.tooltip.destroy();
                if(!tnsBadge.hasClassName(TNSMappingUICSSClasses.TNSBadgeDeletedClass) && !tnsBadge.hasClassName(TNSMappingUICSSClasses.TNSBadgeStoredDeletedClass)){
                    // delete action has been performed
                    if(tnsBadge.hasClassName(TNSMappingUICSSClasses.TNSBadgeDeployedClass)) {
                        tnsBadge.statusIcon.removeClassName('fonticon-check');
                        tnsBadge.removeClassName(TNSMappingUICSSClasses.TNSBadgeDeployedClass);
                        isDeployed=true;
                    } else if(tnsBadge.hasClassName(TNSMappingUICSSClasses.TNSBadgeStoredClass)) {
                        tnsBadge.statusIcon.removeClassName('fonticon-cog');
                        tnsBadge.removeClassName(TNSMappingUICSSClasses.TNSBadgeStoredClass);
                    }
                    tnsBadge.actionButton.removeClassName('fonticon-trash');
                    tnsBadge.actionButton.addClassName('fonticon-undo');
                    tnsBadge.statusIcon.addClassName('fonticon-trash');
                    if(isDeployed)
                    	tnsBadge.addClassName(TNSMappingUICSSClasses.TNSBadgeDeletedClass);
                    else
                    	tnsBadge.addClassName(TNSMappingUICSSClasses.TNSBadgeStoredDeletedClass);

                    tnsBadge.actionButton.tooltip = new Tooltip({
                    	target : tnsBadge.actionButton,
                    	position : 'top',
                        body : TNSMappingNLS.Tooltip.UndeleteAction
                    });
                } else {
                    // undelete action has been performed
                    if(tnsBadge.associatedTNSMapping.isDeployed) {
                        tnsBadge.statusIcon.addClassName('fonticon-check');
                        tnsBadge.addClassName(TNSMappingUICSSClasses.TNSBadgeDeployedClass);
                    } else if(tnsBadge.associatedTNSMapping.isStored) {
                        tnsBadge.statusIcon.addClassName('fonticon-cog');
                        tnsBadge.addClassName(TNSMappingUICSSClasses.TNSBadgeStoredClass);
                    }
                    tnsBadge.statusIcon.removeClassName('fonticon-trash');
                    tnsBadge.actionButton.addClassName('fonticon-trash');
                    tnsBadge.actionButton.removeClassName('fonticon-undo');
                    tnsBadge.removeClassName(TNSMappingUICSSClasses.TNSBadgeDeletedClass);
                    tnsBadge.removeClassName(TNSMappingUICSSClasses.TNSBadgeStoredDeletedClass);
                    tnsBadge.actionButton.tooltip = new Tooltip({
                        target : tnsBadge.actionButton,
                        position : 'top',
                        body : TNSMappingNLS.Tooltip.DeleteAction
                    });

                    this.manageRedundancies(tnsBadge);
                }
                tnsBadge.associatedTNSMapping.isToBeDeleted = !tnsBadge.associatedTNSMapping.isToBeDeleted;
            },

            /**
             * Check if there is redundancies due to revival of the TNS badge given as parameter. If yes, reviving TNS badge is kept
             * and redundant TNS badges are removed.
             */
            manageRedundancies : function(revivingTNSBadge){
                UWA.log('TypesNotSyncMappingLayoutUtilities::manageRedundancies');

                var self = this;
                var hasRedundancies = false;
                // check if there is redundancies with revived TNS mapping and ADDED TNS mapping (mapped super type OR mapped sub type)
                var badges = this.mappingLinesViews[revivingTNSBadge.associatedTNSMapping.typeName].specializationTypesContainer.badges;
                var subTypesList = this.getSubTypesList(this.SpecializationTypes[revivingTNSBadge.associatedTNSMapping.typeName]);
                var revivingTNSMappingParents = null;
                for(var i = 0 ; i < subTypesList.length ; i++){
                    if(subTypesList[i].id === revivingTNSBadge.associatedTNSMapping.specializationTypeName){
                        revivingTNSMappingParents = subTypesList[i].derivationPath.split('/');
                        break;
                    }
                }

                var badgesToRemove = [];
                badges.forEach(function(badge){
                    if(badge !== revivingTNSBadge){
                        var currentTNSMappingParents = null;
                        for(var i = 0 ; i < subTypesList.length ; i++){
                            if(subTypesList[i].id === badge.associatedTNSMapping.specializationTypeName){
                            currentTNSMappingParents = subTypesList[i].derivationPath.split('/');
                            break;
                            }
                        }
                        // both derivation path have been retrieved. Checks can be performed
                        if((revivingTNSMappingParents !== null && revivingTNSMappingParents.includes(badge.associatedTNSMapping.specializationTypeName)) ||
                            (currentTNSMappingParents !== null && currentTNSMappingParents.includes(revivingTNSBadge.associatedTNSMapping.specializationTypeName))
                        ){
                            if(badge.associatedTNSMapping.isStored) self.setTNSBadgeStatusAsToBeDeleted(badge);
                            else badgesToRemove.push(badge);
                            if(!hasRedundancies) hasRedundancies = true;
                        }
                    }
                });
                badgesToRemove.forEach(function(badge){
                self.removeTNSBadge(badge);
                });

                // display information message
                if(hasRedundancies) this.displayAlertMessage('primary', TNSMappingNLS.UserMessage.TNSMappingHasBeenRemovedUndelete);
            },

            /**
             * Update the status of the given TNS badge to DEPLOYED. The given TNS badge should be STORED or NEW.
             * @param tnsBadge The TNS badge which should have its status set to DEPLOYED.
             */
            setTNSBadgeStatusToDeployed : function(tnsBadge){
                UWA.log('TypesNotSyncMappingLayoutUtilities::setTNSBadgeStatusToDeployed');

                if(tnsBadge.hasClassName(TNSMappingUICSSClasses.TNSBadgeStoredClass)) tnsBadge.removeClassName(TNSMappingUICSSClasses.TNSBadgeStoredClass);
                else if(tnsBadge.hasClassName(TNSMappingUICSSClasses.TNSBadgeAddedClass)){
                    tnsBadge.removeClassName(TNSMappingUICSSClasses.TNSBadgeAddedClass);
                    tnsBadge.associatedTNSMapping.isStored = true;
                    if(this.mappingLinesViews[tnsBadge.associatedTNSMapping.typeName].specializationTypesContainer.badgeContainer.getChildren().length === 0)
                        this.mappingLinesViews[tnsBadge.associatedTNSMapping.typeName].specializationTypesContainer.emptyMessage.hide();
                }

                tnsBadge.statusIcon.removeClassName('fonticon-cog');
                tnsBadge.statusIcon.addClassName('fonticon-check');
                tnsBadge.addClassName(TNSMappingUICSSClasses.TNSBadgeDeployedClass);
                tnsBadge.associatedTNSMapping.isDeployed = true;
            },

            /**
             * Update the status of the given TNS badge to "TO BE DELETED".
             * @param tnsBadge The TNS badge which should have its status set to DEPLOYED.
             */
            setTNSBadgeStatusAsToBeDeleted : function(tnsBadge){
                UWA.log('TypesNotSyncMappingLayoutUtilities::setTNSBadgeStatusToDeployed');

                var isDeployed=false;
                tnsBadge.actionButton.tooltip.destroy();
                if(tnsBadge.hasClassName(TNSMappingUICSSClasses.TNSBadgeStoredClass)){
                    tnsBadge.removeClassName(TNSMappingUICSSClasses.TNSBadgeStoredClass);
                    tnsBadge.statusIcon.removeClassName('fonticon-cog');
                }
                else if(tnsBadge.hasClassName(TNSMappingUICSSClasses.TNSBadgeDeployedClass)){
                    tnsBadge.removeClassName(TNSMappingUICSSClasses.TNSBadgeDeployedClass);
                    tnsBadge.statusIcon.removeClassName('fonticon-check');
                    isDeployed=true;
                }

                tnsBadge.actionButton.removeClassName('fonticon-trash');
                tnsBadge.actionButton.addClassName('fonticon-undo');
                tnsBadge.statusIcon.addClassName('fonticon-trash');
                if(isDeployed)
                tnsBadge.addClassName(TNSMappingUICSSClasses.TNSBadgeDeletedClass);
                else
                	 tnsBadge.addClassName(TNSMappingUICSSClasses.TNSBadgeStoredDeletedClass);
                tnsBadge.actionButton.tooltip = new Tooltip({
                    target : tnsBadge.actionButton,
                    position : 'top',
                    body : TNSMappingNLS.Tooltip.UndeleteAction
                });
                tnsBadge.associatedTNSMapping.isToBeDeleted = true;
            },

            /**
             * Remove the "TO BE DELETED" status of the given TNS badge to make it appears as it was before (STORED or DEPLOYED). The given TNS badge should be STORED or DEPLOYED.
             * @param tnsBadge The TNS badge which should be revived.
             */
            reviveTNSBadge : function(tnsBadge){
                UWA.log('TypesNotSyncMappingLayoutUtilities::reviveTNSBadge');

                tnsBadge.actionButton.tooltip.destroy();
                if(tnsBadge.associatedTNSMapping.isDeployed) {
                    tnsBadge.statusIcon.addClassName('fonticon-check');
                    tnsBadge.addClassName(TNSMappingUICSSClasses.TNSBadgeDeployedClass);
                } else if(tnsBadge.associatedTNSMapping.isStored) {
                    tnsBadge.statusIcon.addClassName('fonticon-cog');
                    tnsBadge.addClassName(TNSMappingUICSSClasses.TNSBadgeStoredClass);
                }
                tnsBadge.statusIcon.removeClassName('fonticon-trash');
                tnsBadge.actionButton.addClassName('fonticon-trash');
                tnsBadge.actionButton.removeClassName('fonticon-undo');
                tnsBadge.removeClassName(TNSMappingUICSSClasses.TNSBadgeDeletedClass);
                tnsBadge.removeClassName(TNSMappingUICSSClasses.TNSBadgeStoredDeletedClass);
                tnsBadge.actionButton.tooltip = new Tooltip({
                    target : tnsBadge.actionButton,
                    position : 'top',
                    body : TNSMappingNLS.Tooltip.DeleteAction
                });
                tnsBadge.associatedTNSMapping.isToBeDeleted = false;
            },

            /**
             * Update the status of TNS mapping line according to the status of badges.
             * @param tnsMappingTypeName  The name of the type which is associated to the TNS mapping line view.
             */
            updateTNSMappingLineStatus : function(tnsMappingTypeName){
                UWA.log('TypesNotSyncMappingLayoutUtilities::updateTNSmappingLineStatus');

                var TNSMappingLineStatus = this.mappingLinesViews[tnsMappingTypeName].statusContainer;
                var isModified = false;
                var badges = this.mappingLinesViews[tnsMappingTypeName].specializationTypesContainer.badges;
                for(var i = 0 ; i < badges.length ; i++){
                    if((badges[i].associatedTNSMapping.isStored && !badges[i].associatedTNSMapping.isDeployed) ||
                        badges[i].associatedTNSMapping.isToBeDeleted ||
                        (!badges[i].associatedTNSMapping.isStored)
                    ){
                        isModified = true;
                        break;
                    }
                }

                if(TNSMappingLineStatus.isModified !== isModified){
                    if(isModified){
                        TNSMappingLineStatus.isModified = true;
                        TNSMappingLineStatus.removeClassName(TNSMappingUICSSClasses.mappingLineDeployedStatusClass);
                        TNSMappingLineStatus.getChildren()[0].removeClassName('fonticon-check');
                        TNSMappingLineStatus.addClassName(TNSMappingUICSSClasses.mappingLineModifiedStatusClass);
                        TNSMappingLineStatus.getChildren()[0].addClassName('fonticon-cog');
                        TNSMappingLineStatus.getChildren()[0].title = TNSMappingNLS.Tooltip.ModifiedStatus;
                    } else {
                        TNSMappingLineStatus.isModified = false;
                        TNSMappingLineStatus.removeClassName(TNSMappingUICSSClasses.mappingLineModifiedStatusClass);
                        TNSMappingLineStatus.getChildren()[0].removeClassName('fonticon-cog');
                        TNSMappingLineStatus.addClassName(TNSMappingUICSSClasses.mappingLineDeployedStatusClass);
                        TNSMappingLineStatus.getChildren()[0].addClassName('fonticon-check');
                        TNSMappingLineStatus.getChildren()[0].title = TNSMappingNLS.Tooltip.DeployedStatus;
                    }
                }
            },

            /**
             * Update the status of all TNS mapping lines.
             */
            updateAllTNSMappingLinesStatus : function(){
                UWA.log('TypesNotSyncMappingLayoutUtilities::updateAllTNSMappingLinesStatus');

                for(var mappingLineName in this.mappingLinesViews) this.updateTNSMappingLineStatus(mappingLineName);
            },

            /**
             * The listener handling events on TNS badges according to their status.
             * @param tnsMappingContainer As the number of badges can be important, only one listener should be deploy to handle TNS badges
             * events. Thus, a "global" container is given to this method to beneficiate from the propagation phase.
             */
            addTNSBadgeActionListener : function(tnsMappingContainer){
                UWA.log('TypesNotSyncMappingLayoutUtilities::addTNSBadgeActionListener');
                var self = this;
                tnsMappingContainer.addEvent('click', function(event){
                    var origin = event.target;
                    if(origin.hasClassName(TNSMappingUICSSClasses.TNSBadgeActionClass)){
                        var tnsMappingValue = origin.getParent().associatedTNSMapping;
                        if(!tnsMappingValue.isStored) self.removeTNSBadge(origin.getParent());
                        else if(tnsMappingValue.isStored && !tnsMappingValue.isDefaultMapping && !(tnsMappingValue.errorCode && tnsMappingValue.errorCode !== 0)){
                            self.updateTNSBadgeStatus(origin.getParent());
                        }

                        self.updateTNSMappingLineStatus(tnsMappingValue.typeName);
                        self.updateSelectorsOptionsStatus();
                    }
                });
            },

            /**
             * The listener handling "add" events.
             * This method is called when the user click on the "Add" button to add a specialization type. It manages redundancies during the addition.
             * @param tnsMappingContainer As the number of mapping lines can differ, only one listener should be deploy to handle "Add"
             * events. Thus, a "global" container is given to this method to beneficiate from the propagation phase.
             */
            addSpecTypeAddOperationListener : function(tnsMappingContainer){
                UWA.log('TypesNotSyncMappingLayoutUtilities::addSpecTypeAddOperationListener');
                var self = this;
                tnsMappingContainer.addEvent('click', function(event){
                    var origin = event.target;
                    if(origin.hasClassName(TNSMappingUICSSClasses.TNSSpecTypeAddButtonClass)){
                        var mappingLineView = event.target.getParent().getParent().getParent();
                        var selector = mappingLineView.specializationTypesContainer.specializationTypeSelectorContainer.selector;
                        // get the selected option. As multiselection isn't allowed, returned array will always contain one element
                        var option = selector.getSelection()[0];

                        // check if a valid option has been chosen using the type selector
                        if(typeof option.specializationTypeInfo !== 'undefined' && !option.disabled){
                            // check if there is at least one badge containing a sub-type of the selected type and remove / set as "TO BE DELETED" them
                            var uselessTNSBadges = [];
                            var subTypesList = self.getSubTypesList(option.specializationTypeInfo, true);

                            // finding badges to remove / set as "TO BE DELETED"
                            mappingLineView.specializationTypesContainer.badges.forEach(function(badge){
                                for(var i = 0 ; i < subTypesList.length ; i++){
                                    if(!badge.associatedTNSMapping.isDefaultMapping && badge.associatedTNSMapping.specializationTypeName === subTypesList[i].id){
                                        uselessTNSBadges.push(badge);
                                        break;
                                    }
                                }
                            });

                            uselessTNSBadges.forEach(function(badge){
                                if(badge.associatedTNSMapping.isStored) self.setTNSBadgeStatusAsToBeDeleted(badge);
                                else self.removeTNSBadge(badge);
                            });

                            // display information message
                            if(uselessTNSBadges.length > 0) {
                                self.displayAlertMessage('primary', TNSMappingNLS.UserMessage.TNSMappingHasBeenRemovedAdd);
                            }

                            // reseting selector
                            selector.setValue('');

                            var tnsMapping = {
                                typeName : mappingLineView.rootTypeInfo.typeName,
                                typeDisplayName : mappingLineView.rootTypeInfo.typeDisplayName,
                                specializationTypeName : option.specializationTypeInfo.typeInfo.id,
                                specializationTypeDisplayName : option.specializationTypeInfo.typeInfo.name,
                                isDefaultMapping : false,
                                isStored : false,
                                isDeployed : false,
                                isToBeDeleted : false
                            };

                            var tnsBadge = self.buildTNSBadge(tnsMapping);
                            self.insertTNSBadge(tnsBadge);

                            self.updateSelectorsOptionsStatus();
                        }
                    }
                });
            },

            /**
             * Update the view after a successful APPLY. During this method, the following updates will be done :
             *            - NEW and STORED parameters will have their view modified to appear as DEPLOYED
             *            - TO BE DELETED parameters will be removed from the view
             */
            refreshViewAfterApply : function(){
                UWA.log('TypesNotSyncMappingLayoutUtilities::refreshViewAfterApply');

                var self = this;
                for(var mappingLineViewIndex in this.mappingLinesViews){
                    var badges = this.mappingLinesViews[mappingLineViewIndex].specializationTypesContainer.badges;
                    for(var i = badges.length - 1 ; i >= 0 ; i--){
                        if(badges[i].associatedTNSMapping.isToBeDeleted) self.removeTNSBadge(badges[i]);
                        else if(!badges[i].associatedTNSMapping.isDeployed) self.setTNSBadgeStatusToDeployed(badges[i]);
                    }
                }
            },

            /**
             * Update the view after a successful RESET. During this method, the following updates will be done :
             *            - NEW and STORED parameters will be removed from the view
             *            - TO BE DELETED DEPLOYED parameters will be "revived" (removing TO BE DELETED flag)
             */
            refreshViewAfterReset : function(){
                UWA.log('TypesNotSyncMappingLayoutUtilities::refreshViewAfterReset');

                var self = this;
                for(var mappingLineViewIndex in this.mappingLinesViews){
                    var badges = this.mappingLinesViews[mappingLineViewIndex].specializationTypesContainer.badges;
                    for(var i = badges.length - 1 ; i >= 0 ; i--){
                        if(badges[i].associatedTNSMapping.isToBeDeleted && badges[i].associatedTNSMapping.isDeployed) self.reviveTNSBadge(badges[i]);
                        else if(!badges[i].associatedTNSMapping.isDeployed) self.removeTNSBadge(badges[i]);
                    }
                }
            },

            /**
             * Check if the mapping has been modified or not.
             * @return A boolean which, if true, means that some actions are required. If false, no operation on server side is needed.
             */
            requireServerActions : function(){
                UWA.log('TypesNotSyncMappingLayoutUtilities::requireServerActions');

                for(var mappingLineViewIndex in this.mappingLinesViews){
                    var badges = this.mappingLinesViews[mappingLineViewIndex].specializationTypesContainer.badges;
                    for(var i = badges.length - 1 ; i >= 0 ; i--){
                        if(badges[i].associatedTNSMapping.isDeployed && !badges[i].associatedTNSMapping.isToBeDeleted ) continue;
                        return true;
                    }
                }
                return false;
            },

            /**
             * Retrieve the current view of the global TNS mapping by iterating over TNS badges.
             */
            getCurrentTNSMapping : function(){
                var TNSMapping = [];

                for(var typeName in this.mappingLinesViews){
                    this.mappingLinesViews[typeName].specializationTypesContainer.badges.forEach(function(badge){
                        TNSMapping.push(badge.associatedTNSMapping);
                    });
                }

                return TNSMapping;
            }

        });

        return UIview;
    }
);

/**
 * @author AMN14
 */

define('DS/ParameterizationSkeleton/Views/ParamCollaboration/TypesNotSyncMapping/TypesNotSyncMappingLayoutView',
    [
         'UWA/Core',
         'UWA/Class/View',
         'DS/UIKIT/Modal',
         'DS/UIKIT/Popover',
         'DS/UIKIT/Mask',
         'DS/UIKIT/Scroller',
         'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
         'DS/ParameterizationSkeleton/Views/ParamCollaboration/TypesNotSyncMapping/TypesNotSyncMappingLayoutUtilities',
         'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
         'DS/UIKIT/Input/Button',
         'DS/UIKIT/Input/Select',
         'DS/UIKIT/Input/Toggle',
         'DS/UIKIT/Alert',
         'i18n!DS/ParameterizationSkeleton/assets/nls/TypesNotSyncMappingManagementNLS',
         'DS/WAFData/WAFData'
    ],
    function (
         UWA,
         View,
         Modal,
         Popover,
         Mask,
         Scroller,
         ParametersLayoutViewUtilities,
         TNSMappingLayoutUtilities,
         URLHandler,
         Button,
         Select,
         Toggle,
         Alert,
         TNSMappingNLS,
         WAFData
    ) {

        'use strict';

        var _TNS_SupportedTypes = {
            VPMReference : 'VPMReference',
            Part : 'Part',
            Products : 'Products'
        };

        var extendedView = View.extend({
            tagName : 'div',
            className : 'generic-detail',

            init : function(options) {
                UWA.log('TypesNotSyncMappingLayoutView::init');

                var initDate = new Date();
                this.lastAlertDate = initDate.getTime();
                this.lastAlertDate = initDate.getTime();

                options = UWA.clone(options || {}, false);

                this._parent(options);

                this.contentDiv = null;
                this.mappingContainer = null;
                this.controlContainer = null;
                this.descriptionContainer = null;
                this.paramScroller = null;

                this.utils = new TNSMappingLayoutUtilities();
            },

            setup: function(options) {
                UWA.log('TypesNotSyncMappingLayoutView::setup');
                UWA.log(options);
            },

            render: function() {
                UWA.log("TypesNotSyncMappingLayoutView::render");

                var self = this;

                // create document components for UI display
                this.contentDiv = UWA.createElement('div', {'id' : 'typeMainDiv'});
                Mask.mask(this.contentDiv);

                // description of the widget
                this.descriptionContainer = UWA.createElement('div', {'class' : 'information'});
                UWA.createElement('p', {
                        text : TNSMappingNLS.intro,
                        'class': 'font-3dslight'
                    }
                ).inject(this.descriptionContainer);

                this.descriptionContainer.inject(this.contentDiv);

                // mapping data section
                this.mappingContainer = UWA.createElement('div', {'id' : 'TNSDataDiv'});
                this.mappingContainer.inject(this.contentDiv);

                // building mapping lines container header
                var mappingLineHeader = UWA.createElement('div', {'class' : 'TNSMappingLine TNSMappingLineHeader'});
                UWA.createElement('div', {
                    'class' : 'typeHeader font-3dslight',
                    html : TNSMappingNLS.TNSMappingHeader.Type
                }).inject(mappingLineHeader);
                UWA.createElement('div', {
                    'class' : 'specTypeHeader font-3dslight',
                    html : TNSMappingNLS.TNSMappingHeader.SpecTypes
                }).inject(mappingLineHeader);
                UWA.createElement('div', {
                    'class' : 'statusHeader font-3dslight',
                    html : TNSMappingNLS.TNSMappingHeader.Status
                }).inject(mappingLineHeader);

                mappingLineHeader.inject(this.mappingContainer);

                // building VPMReference and Part TNS mapping sections
                var productTNSMappingLine = this.utils.buildTNSLineView(_TNS_SupportedTypes.VPMReference, TNSMappingNLS.ProductDisplayName);
                var partTNSMappingLine = this.utils.buildTNSLineView(_TNS_SupportedTypes.Part, TNSMappingNLS.PartDisplayName);
                var productsTNSMappingLine = this.utils.buildTNSLineView(_TNS_SupportedTypes.Products, TNSMappingNLS.ProductsDisplayName, false);
                productTNSMappingLine.inject(this.mappingContainer);
                partTNSMappingLine.inject(this.mappingContainer);
                productsTNSMappingLine.inject(this.mappingContainer);

                // adding listener for events handling on TNS badges
                this.utils.addTNSBadgeActionListener(this.mappingContainer);
                this.utils.addSpecTypeAddOperationListener(this.mappingContainer);

                this.controlContainer = ParametersLayoutViewUtilities.createApplyResetToolbar.call(this, this.contentDiv, true, this.applyParameters.bind(this), this.resetParameters.bind(this));

                this.paramScroller = new Scroller({
                    element : this.mappingContainer,
                }).inject(this.contentDiv);

                // Insert built view into the document
                this.container.setContent(this.contentDiv);

                this.listenTo(this.collection, {
                        onSync: self.onCompletedTNSMappingRequest
                });

                return this;
            },

            destroy : function() {
                UWA.log('TypesNotSyncMappingLayoutView::destroy');
                this.stopListening();
                this._parent.apply(this, arguments);
            },

            /**
             * To call when the request to retrieve the TNS mapping is ended to fill UI components with retrieved data.
             */
            onCompletedTNSMappingRequest : function(){
                UWA.log('TypesNotSyncMappingLayoutView::onCompletedTNSMappingRequest');

                var self = this;

                // retrieving TNS mapping and building view...
                this.TNSMapping = this.collection._models[0]._attributes.TNSMapping;
                this.TNSMapping.forEach(function(tnsMappingValue){
                    // creating TNS badges
                    var TNSBadge = self.utils.buildTNSBadge(tnsMappingValue);
                    self.utils.insertTNSBadge(TNSBadge);
                });

                // setting variables containing specialization types for Part and VPMReference
                this.SpecializationTypes = this.collection._models[0]._attributes.SpecializationTypes;

                // add options to selectors...
                for(var typeName in this.utils.mappingLinesViews){
                    if(typeof this.SpecializationTypes[typeName] !== 'undefined'){
                        this.utils.addSelectorOptions(this.SpecializationTypes[typeName]);
                    }
                }

                this.utils.initializeSpecializationTypes(this.SpecializationTypes);

                // view has been completly initialized, unmasking content...
                Mask.unmask(this.contentDiv);
            },

            /**
             * To call when clicking on "Apply" button created using ParametersLayoutViewUtilities.createApplyResetToolbar
             */
            applyParameters : function() {
                UWA.log('TypesNotSyncMappingLayoutView::applyParameters');

                // check if mapping has been modified, if not, there is no need to call web-services as no action on server side will be performed
                if(this.utils.requireServerActions()){
                    // UI waiting for a response...
                    Mask.mask(this.mappingContainer);

                    var self = this;

                    // call web service to apply new/modified TNS mapping
                    var url = URLHandler.getURL() + "/resources/MappingWS/mapping/applytnsmapping?tenant=" + URLHandler.getTenant();

                    WAFData.authenticatedRequest(url, {
                        timeout : 250000,
                        method : 'POST',
                        data : JSON.stringify({tnsMapping : this.utils.getCurrentTNSMapping()}),
                        type : 'json',

                        headers : {
                            'Content-Type' : 'application/json',
                            'Accept' : 'application/json'
                        },

                        onFailure : function (json) {
                            UWA.log('TypesNotSyncMappingLayoutView::applyParameters - Failure');
                            UWA.log(json);

                            // request has failed, display error message
                            self.utils.displayAlertMessage('error', TNSMappingNLS.UserMessage.DeployFail);
                            Mask.unmask(self.mappingContainer);
                        },

                        onComplete: function(json) {
                            UWA.log('TypesNotSyncMappingLayoutView::applyParameters - Success');
                            UWA.log(json);

                            // update the view according to HTTP request response
                            self.utils.refreshViewAfterApply();
                            for(var i = self.TNSMapping.length - 1 ; i >= 0 ; i--){
                                if(self.TNSMapping[i].isToBeDeleted) self.TNSMapping.splice(i, 1);
                            }

                            // update TNS mapping lines status
                            self.utils.updateAllTNSMappingLinesStatus();

                            // update the selectors options according to current TNS mapping
                            self.utils.updateSelectorsOptionsStatus();

                            // request has succeed, display success message
                            self.utils.displayAlertMessage('success', TNSMappingNLS.UserMessage.DeploySuccess);

                            Mask.unmask(self.mappingContainer);
                        }

                    });
                } else {
                    this.utils.displayAlertMessage('primary', TNSMappingNLS.UserMessage.NoActionApply);
                }

            },

            /**
             * To call when clicking on "Reset" button created using ParametersLayoutViewUtilities.createApplyResetToolbar
             */
            resetParameters : function() {
                UWA.log('TypesNotSyncMappingLayoutView::resetParameters');

                // check if mapping has been modified, if not, there is no need to call web-services as no action on server side will be performed
                if(this.utils.requireServerActions()){
                    // UI waiting for a response...
                    Mask.mask(this.mappingContainer);

                    var self = this;

                    // call web service to apply new/modified TNS mapping
                    var url = URLHandler.getURL() + "/resources/MappingWS/mapping/resettnsmapping?tenant=" + URLHandler.getTenant();

                    WAFData.authenticatedRequest(url, {
                        timeout: 250000,
                        method: 'POST',
                        data: JSON.stringify({}),
                        type: 'json',

                        headers: {
                            'Content-Type' : 'application/json',
                            'Accept' : 'application/json'
                        },

                        onFailure : function (json) {
                            UWA.log('TypesNotSyncMappingLayoutView::resetParameters - Failure');
                            UWA.log(json);

                            // request has failed, display error message
                            self.utils.displayAlertMessage('error', TNSMappingNLS.UserMessage.ResetFail);

                            Mask.unmask(self.mappingContainer);
                        },

                        onComplete: function(json) {
                            UWA.log('TypesNotSyncMappingLayoutView::resetParameters - Success');
                            UWA.log(json);

                            // update the view according to HTTP request response
                            self.utils.refreshViewAfterReset();
                            for(var i = self.TNSMapping.length - 1 ; i >= 0 ; i--){
                                if(!self.TNSMapping[i].isDeployed) self.TNSMapping.splice(i, 1);
                            }

                            // update TNS mapping lines status
                            self.utils.updateAllTNSMappingLinesStatus();

                            // update the selectors options according to current TNS mapping
                            self.utils.updateSelectorsOptionsStatus();

                            // request has succeed, display success message
                            self.utils.displayAlertMessage('success', TNSMappingNLS.UserMessage.ResetSuccess);

                            Mask.unmask(self.mappingContainer);
                        }

                    });
                } else {
                    this.utils.displayAlertMessage('primary', TNSMappingNLS.UserMessage.NoActionReset);
                }

            }

        });

        return extendedView;
    }
);

/*! Copyright 2017, Dassault Systemes. All rights reserved. */

 /*@quickReview NZV 2023/01/18 Increase timeout in function getListOfDomains  IR-1019489-3DEXPERIENCER2022x*/
/*@quickReview NZV 17/05/09 Add getDimensions function & fixed IR-519160-3DEXPERIENCER2018x*/
/*@quickReview NZV 18/04/27 Function FUN076055 19x Beta2 : Added getPredicatesObject, getPredicatesReturn */
/*global define*/
define(
    'DS/ParameterizationSkeleton/Utils/ParameterizationGenericServices',
    [
        'UWA/Core',
        'UWA/Promise',
        'DS/WAFData/WAFData',
        'DS/SixwDictionaryAccess/SixwDictionaryAccessAPI',
        'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
    ],
    function(UWA, Promise, WAFData, Dico, URLHandler) {

        'use strict';

        var genericWSUtils = {

            compareDimensionObject : function(dimObj1, dimObj2) {
                if (dimObj1.NLS !== undefined && dimObj2.NLS !== undefined) {
                    return dimObj1.NLS.localeCompare(dimObj2.NLS);
                } else {
                    var nameDim1 = dimObj1.Name.toUpperCase(),
                        nameDim2 = dimObj2.Name.toUpperCase(); // ignore upper and lowercase
                    if (nameDim1 < nameDim2) {
                        return -1;
                    }
                    if (nameDim1 > nameDim2) {
                        return 1;
                    }

                    // names must be equal
                    return 0;
                }

            },

            dimensionOnSuccess : [],

            dimensionOnFail : [],

            getDimensions : function (onSuccess, OnDimServiceFail) {

                var url = URLHandler.getURL() + '/resources/dictionary/dimensions';

                if (genericWSUtils.dimensionOnSuccess.length > 0) {
                    genericWSUtils.dimensionOnSuccess.push(onSuccess);
                    genericWSUtils.dimensionOnFail.push(OnDimServiceFail);
                } else {

                    genericWSUtils.dimensionOnSuccess.push(onSuccess);
                    genericWSUtils.dimensionOnFail.push(OnDimServiceFail);
                    WAFData.authenticatedRequest(url, {
                        headers: {
                            'Accept' : 'application/json',
                            //'Content-Type' : 'application/json',
                            'Accept-Language' : widget.lang
                        },
                        method: 'get',
                        type: 'json',

                        onComplete: function (json) {
                            if (json !== 'undefined') {
                                if (json.results !== 'undefined') {
                                    json.results.sort(genericWSUtils.compareDimensionObject);
                                    genericWSUtils.dimensionOnSuccess.forEach(function (item) {
                                        item(json.results);
                                    });
                                }
                            }
                            while (genericWSUtils.dimensionOnSuccess.length > 0) {
                                genericWSUtils.dimensionOnSuccess.shift();
                            }
                            while (genericWSUtils.dimensionOnFail.length > 0) {
                                genericWSUtils.dimensionOnFail.shift();
                            }
                            genericWSUtils.dimensionOnFail = [];
                            genericWSUtils.dimensionOnSuccess = [];
                        },
                        onFailure: function(json) {
                            UWA.log("onFailure : getDimensions funciton failed.Not able to call " + url);
                            UWA.log(json);
                            genericWSUtils.dimensionOnFail.forEach(function (item) {
                                item.call();
                            });
                            while (genericWSUtils.dimensionOnFail.length > 0) {
                                genericWSUtils.dimensionOnFail.shift();
                            }
                            while (genericWSUtils.dimensionOnSuccess.length > 0) {
                                genericWSUtils.dimensionOnSuccess.shift();
                            }
                            genericWSUtils.dimensionOnFail = [];
                            genericWSUtils.dimensionOnSuccess = [];
                        }
                    });
                }
            },

            getSessionInfo : function () {
                var sessionObj = new Promise(function (resolve, reject) {
                    var url = URLHandler.getURL() + '/resources/enocsmrest/session?tenant=' + URLHandler.getTenant();
                    WAFData.authenticatedRequest(url, {
                        headers: {
                            'Accept' : 'application/json',
                            //'Content-Type' : 'application/json',
                            'Accept-Language' : widget.lang
                        },
                        method: 'get',
                        type: 'json',

                        onComplete: function (json) {
                            if (json !== 'undefined') {
                                resolve(json);
                            }
                        },
                        onFailure: function(json) {
                            UWA.log("Paramaterization::Services falied! :" + url);
                            UWA.log(json);
                            reject(json);

                        }
                    });
                });
                return sessionObj;
            }, //end of getSessionInfo
           //Remomve before delivry
            // loginStep : function () {
            //     var loginObj1 = new Promise(function (resolve, reject) {
            //         var url = "https://vdevpril464dsy.ux.dsone.3ds.com:453/iam/login?action=get_auth_params";
            //         WAFData.authenticatedRequest(url, {
            //             headers: {
            //                // 'Accept' : 'text/html',
            //                // 'Content-Type' : 'text/html',
            //                 'Accept-Language' : widget.lang
            //             },
            //             method: 'get',
            //            // type: 'html',

            //             onComplete: function (result) {
            //                 resolve(result);
            //             },
            //             onFailure: function(error, responseAsString) {
            //                 UWA.log("Paramaterization::loginStep1 falied! :" + url);
            //                 UWA.log(error);
            //                 reject(responseAsString);

            //             }
            //         });
            //     });
            //     return loginObj1;
            // },//Remomve before delivry
            // loginToRDFServer : function(userTicket) {
            //     var respJson = JSON.parse(userTicket);
            //     var LT = respJson.lt;
            //     var loginObj = new Promise(function (resolve, reject) {
            //         //var url ='https://vdevpril464dsy.ux.dsone.3ds.com:453/iam/login?service=https%3A%2F%2Fvdevpril510dsy.ux.dsone.3ds.com%2F3DRDFPersist%2Fv0%2Finvoke%2Fdsbase%3AgetFedProperties';
            //         var url = 'https://vdevpril464dsy.ux.dsone.3ds.com:453/iam/login?service=https%3A%2F%2Fvdevpril510dsy.ux.dsone.3ds.com%2F3DRDFPersist%2Fservice%2FrdfQL%3Fquery%3Dshow%2520context';
            //          WAFData.authenticatedRequest(url, {
            //             headers: {
            //                 //'Accept' : 'text/html',
            //                 'Content-Type' : 'application/x-www-form-urlencoded;charset=UTF-8',
            //                 'Accept-Language' : widget.lang
            //             },
            //             //application/x-www-form-urlencoded;charset=UTF-8
            //             method: 'post',
            //            // data : 'lt=LT-10617-RMtdUSexQQ0j7CSyR4fYqgVdXc5PIA&fp=f15adf37375019a0d3b8f5f42d57bfe228fe2da050ef97a7e3f5be92dbc4aaacea07d4b1cd90ef29d22ab22a79a83f2b7413b8834f773b33ab270b4285cc0896&username=VPLMAdminUser&password=Passport1',
            //            data : "lt="+ LT+ "&username=VPLMAdminUser&password=Passport1",
            //             onComplete: function (json) {
            //                 if (json !== 'undefined') {
            //                    resolve(json);
            //                 } 
            //             },
            //             onFailure: function(error, responseAsString) {
            //                 UWA.log("Paramaterization::loginToRDFServer falied! :" + url);
            //                 UWA.log(error);
            //                 reject(error);

            //             } 
            //          });
            //     });
            //     return loginObj;
            // },
            isThisNotARootPredicates : function  (item) {
                // var rootPredicates = ["ds6w:what", "ds6w:why", "ds6w:when", "ds6w:where", "ds6w:how", "ds6w:who"], i;
                // for (i = 0; i < rootPredicates.length; i++) {
                //     if (rootPredicates[i] === item.curi.toLowerCase()) { return false; }
                // }
                // return true;
                return ((item.subPropertyOf === "") ? false : true);
            },

            filter6WRootPredicates : function (listofsixWTags) {
                var predicatesList, propt = "ds6w";
                //for (propt in listofsixWTags) {
                if (listofsixWTags[propt].properties.length > 0) {
                    predicatesList = listofsixWTags[propt].properties;
                    if (predicatesList !== undefined && predicatesList.length > 0) {
                        listofsixWTags[propt].properties = predicatesList.filter(genericWSUtils.isThisNotARootPredicates);
                    }
                }
                //}
                return listofsixWTags;
            },

            getPredicatesObject : function () {
                var rdfPredicateServiceObj = new Promise(function (resolve, reject) {
                        var ontologyServiceObj =  {
                            onComplete: function(result) {
                                UWA.log("Got a predicates result!" + result);
                                resolve(result);
                            },
                            onFailure: function(errorMessage) {
                                UWA.log("predicates service request Fail!" + errorMessage);
                                reject(errorMessage);
                            },
                            tenantId: URLHandler.getTenant(),
                            lang: widget.lang,
                            apiVersion: "R2019x",
							onlyMappable: true //IR-619053-3DEXPERIENCER2019x 							
                        };
                        Dico.get6wProperties(ontologyServiceObj);             
                    });
                return rdfPredicateServiceObj;
            }, //end of getPredicatesObject

            onSuccessPredicateActionList : [],

            OnFailedPredicateActionList : [],

            getPredicatesReturn : function (onSuccess, onFailed) {
                if (genericWSUtils.onSuccessPredicateActionList.length > 0) {
                    genericWSUtils.onSuccessPredicateActionList.push(onSuccess);
                    genericWSUtils.OnFailedPredicateActionList.push(onFailed);
                } else {
                    genericWSUtils.onSuccessPredicateActionList.push(onSuccess);
                    genericWSUtils.OnFailedPredicateActionList.push(onFailed);
                    genericWSUtils.getPredicatesObject()
                        .then(function (result) {
                            result = genericWSUtils.filter6WRootPredicates(result);
                            genericWSUtils.onSuccessPredicateActionList.forEach(function (item) {
                                item(result);
                            });
                            genericWSUtils.OnFailedPredicateActionList = [];
                            genericWSUtils.onSuccessPredicateActionList = [];
                        })['catch'](function (errorMessage) {
                            genericWSUtils.OnFailedPredicateActionList.forEach(function (item) {
                                item(errorMessage);
                            });
                            genericWSUtils.OnFailedPredicateActionList = [];
                            genericWSUtils.onSuccessPredicateActionList = [];
                        });
                }

            },//end of getPredicatesReturn
			//FUN124183
            getListOfDomains : function () {
              var objListDomains = new Promise(function (resolve, reject) {
                  var url =  URLHandler.getURL() + "/resources/ParamWS/access/listofDomains?tenant=" + URLHandler.getTenant();
                  WAFData.authenticatedRequest(url, {
                    headers: {
                        'Accept' : 'application/json',
                        //'Content-Type' : 'application/json',
                        'Accept-Language' : widget.lang
                    },
                    proxy :'passport',
                    method: 'get',
                    type: 'json',
                    //IR-1019489-3DEXPERIENCER2022x
                    timeout: 250000,

                    onComplete: function (json) {
                      if (json !== 'undefined') {
                          resolve(json);
                      }
                    },
                    onFailure: function(json) {
                      UWA.log("Paramaterization::Services falied! :" + url);
                      UWA.log(json);
                      reject(json);
                    }
                  });
              });
              return objListDomains;
            },
			//FUN147251 
			initiateDomainElement : function (domainID) {
              var obj = new Promise(function (resolve, reject) {
                  var url =  URLHandler.getURL() + "/resources/ParamWS/access/DomainElements?tenant=" + URLHandler.getTenant() + "&domainid=" + domainID;
                  WAFData.authenticatedRequest(url, {
                    headers: {
                        'Accept' : 'application/json',
                        //'Content-Type' : 'application/json',
                        'Accept-Language' : widget.lang
                    },
                    //proxy :'passport',
                    method: 'get',
                    type: 'json',
                    timeout:0,
                      onTimeout : function (networkError, error) {
                        error = error || networkError;
                        console.log("initiateDomainElement onTimeout");
                        console.log(error);
                      },

                      onComplete: function (json) {
                          if (json !== 'undefined') {
                              resolve(json);
                          }
                      },
                      onFailure: function(json) {
                          UWA.log("Paramaterization::Services falied! :" + url);
                          UWA.log(json);
                          reject(json);

                      }
                  });
              });
              return obj;
            },
			//FUN147251 
			checkDomainObjectAvailable : function (domainID) {
              var obj = new Promise(function (resolve, reject) {
                var dataInfo = { "about": domainID}
				var url = URLHandler.getURL() + "/resources/ParamWS/integrity/getParamInfo";
				dataInfo.tenant = URLHandler.getTenant();
				WAFData.authenticatedRequest(url, {
					data: dataInfo,
					headers: {
						'Accept': 'application/json'//,
					   // 'Content-Type': 'application/json'
					},
					method: 'get',
					type: 'json',
					//proxy: 'passport',
					onComplete: function(json) {
						resolve(json.infoValue);
					},
					onFailure: function(json) {
						reject(json);
					}
				});

                  
              });
              return obj;
            }			
        };
        return genericWSUtils;
    }
);

/**
* @quickreview  ROW 23:12:29 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationUnitsAndParameters/UnitsAndParametersConfigLayoutView',
  [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/ParametersLayoutView',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationLayoutView',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
    'DS/ParameterizationSkeleton/Views/ParameterizationUnitsAndParameters/ArbitraryUnitsConfigFamilyView',
    'DS/ParameterizationSkeleton/Views/ParameterizationUnitsAndParameters/ParametersConfigFamilyView',
    'DS/ParameterizationSkeleton/Views/ParameterizationUnitsAndParameters/ParametersExtensionsMappingConfigFamilyView',
    'DS/ParameterizationSkeleton/Utils/ParameterizationUnitsAndParameters/UnitsAndParametersParameterizationResourceServices',
    'DS/ParameterizationSkeleton/Utils/DELConfigurationParameterization/DELConfigurationParameterizationWebServices',
    'DS/UIKIT/Mask',
    'i18n!DS/ParameterizationSkeleton/assets/nls/UnitsAndParameters'
  ],
  function (
    UWA,
    ParametersLayoutView,
    DELConfigurationLayoutView,
    DELConfigurationFamilyView,
    ArbitraryUnitsConfigFamilyView,
    ParametersConfigFamilyView,
    ParametersExtensionsMappingConfigFamilyView,
    UnitsAndParametersParameterizationResourceServices,
    DELConfigurationParameterizationWebServices,
    Mask,
    Nls
  ) {

    'use strict';

    var UnitsAndParametersConfigLayoutView = DELConfigurationLayoutView.extend({

      /*
      * init
      */
      init: function init(options) {
        var that = this;
        this._parent(options);
      },

      /*
      * render
      */
      render: function render() {
        var that = this;


        var promiseTab = [];
        var promiseEnvVar = new Promise(function (resolve, reject){
        DELConfigurationParameterizationWebServices.getEnvVar({
          onSuccess : function(mapvarEnv)
          {
            that._mapvarEnv = mapvarEnv;
              resolve();
          },
          onFailure : function(error)
          {
              reject("DELConfigurationParameterizationWebServices.getEnvVar");
            console.error("DELConfigurationParameterizationWebServices.getEnvVar");
          }
        });
        });

        promiseTab.push(promiseEnvVar);
        UWA.Promise.all(promiseTab).then(function(data) {
          DELConfigurationLayoutView.prototype.render.call(that);
          
        });
        return this;
      },

      /*
      * onCompleteRequestParameters
      */
      onCompleteRequestParameters: function onCompleteRequestParameters() {
        var that = this;

        //that._parent();

        var promise = new Promise(function (resolve, reject) {
          UnitsAndParametersParameterizationResourceServices.initAttributeModal(that._domainID, {
            onSuccess: function (xmlMap) {
              that._xmlMap = xmlMap;

              var promiseMapTab = [];
              var keys = Array.from(that._xmlMap.keys());
              var keysLength = keys.length;
              for (var i = 0; i < keysLength; i++) {
                var key = keys[i];
                var xmlDoc = that._xmlMap.get(key);//iFamily.id);
                xmlDoc = xmlDoc.getElementsByTagName('ui');
                if (xmlDoc != null && xmlDoc.length) {
                  if (that._xmlNls === null)
                    that._xmlNls = new Map();

                  xmlDoc = xmlDoc[0];
                  var treelistnls = "";
                  if (xmlDoc.attributes.treelistnls)
                    treelistnls = xmlDoc.attributes.treelistnls.value;

                  var modalnls = "";
                  if (xmlDoc.attributes.modalnls)
                    modalnls = xmlDoc.attributes.modalnls.value;

                  var nodetreenls = "";
                  if (xmlDoc.attributes.nodetreenls)
                    nodetreenls = xmlDoc.attributes.nodetreenls.value;

                  var promiseMap = new Promise(function (resolveMapNls, rejectMapNls) {
                    that.mapNls(key, treelistnls, modalnls, nodetreenls, resolveMapNls, rejectMapNls);
                  });
                  promiseMapTab.push(promiseMap);
                }
              }

              UWA.Promise.all(promiseMapTab).then(function () {
                resolve();
              });
            }
          });
        });

        UWA.Promise.all([promise]).then(function () {
          //removeApply Reset div
          var eltUI = document.getElementById("ApplyResetDiv");
          if (eltUI) {
            var parentNode = eltUI.getParent();
            parentNode.removeChild(eltUI);
          }
          // Hiding Attributes Mapping without PARAMETERS_ATTRIBUTES_MAPPING set. Remove below block to enable attributes mapping
          if (that._mapvarEnv != undefined && that._mapvarEnv["DELMIAParameterizationEnvVariable"] != null && !that._mapvarEnv["DELMIAParameterizationEnvVariable"].includes("PARAMETERS_ATTRIBUTES_MAPPING")) {
            var iFamilies = that.collection._models[0]._attributes.family;
            var newFamilies = [];
            iFamilies.forEach(family => {
              if (family.id != "ParamsCustomAttributes")
                newFamilies.push(family);
            });
            if (newFamilies.length)
              that.collection._models[0]._attributes.family = newFamilies;
          }

          ParametersLayoutView.prototype.onCompleteRequestParameters.call(that);
        });
      },

      /*
      * buildParameterLine
      */
      buildParameterLine: function (iParamObj, familyID, familytbody, popoverPosition) {

        var that = this;
        var args = iParamObj.argument;
        for (var i = 0; i < args.length; i++) {
          var arg = args[i];
          if (arg && arg.defaultValue === "DELConfigurationTreeListView") {
            familytbody.parentElement.style.marginLeft = '-14px';
            var newParamline = UWA.createElement('tr', { title: '' });
            var paramTreeListViewCell = UWA.createElement('td', {
              'width': '100%',
              'title': '',
              'colspan': '4'
            });
            paramTreeListViewCell.setStyle("vertical-align", "text-bottom");
            var contentTreeView = UWA.createElement('div');
            contentTreeView.className = "treeListView";

            var options = {};
            options.xmlDoc = that._xmlMap.get(arg.id);
            options.domainid = that._domainID;
            options.familyid = familyID;
            options.parameterid = iParamObj.id;
            options.argid = arg.id;

            options.treeListViewNls = that._xmlNls.get(arg.id)[0];
            options.modalViewNls = that._xmlNls.get(arg.id)[1];
            options.nodeTreeViewNls = that._xmlNls.get(arg.id)[2];

            var familyView = null;
            if (arg.id === "UnitsAndParamsArbitraryUnitsListArg") {
              familyView = new ArbitraryUnitsConfigFamilyView(options);
            }
            else if (arg.id === "UnitsAndParamsParametersListArg") {
              familyView = new ParametersConfigFamilyView(options);
            }
            else if (arg.id === "UnitsAndParamsParametersCustomAttrListArg") {
              familyView = new ParametersExtensionsMappingConfigFamilyView(options);
            }
            else
              familyView = new DELConfigurationFamilyView(options);

            if (familyView != null && (arg.id === "UnitsAndParamsParametersListArg" || arg.id === "UnitsAndParamsParametersCustomAttrListArg")) {
              Mask.mask(familytbody);
              UWA.Promise.all([familyView.getPromisetoGetInfofromDB()]).then(function () {
                that._listOfFamilyViews.push(familyView);
                var familyViewContent = familyView.buildFamilyContent();
                familyViewContent.inject(contentTreeView);
                contentTreeView.inject(paramTreeListViewCell);
                paramTreeListViewCell.inject(newParamline);
                Mask.unmask(familytbody);
              }).catch(e => {
                console.log(e);
              });
              newParamline.inject(familytbody);

            }
            else if (familyView != null){
              that._listOfFamilyViews.push(familyView);
              var familyViewContent = familyView.buildFamilyContent();
              familyViewContent.inject(contentTreeView);
              contentTreeView.inject(paramTreeListViewCell);
              paramTreeListViewCell.inject(newParamline);
              newParamline.inject(familytbody);
            }

          }
          else
            this._parent(iParamObj, familyID, familytbody, popoverPosition);
        }
      },
    });
    return UnitsAndParametersConfigLayoutView;
  });

/**
* @quickreview  ROW 24:09:02 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationUnitsAndParameters/UnitsAndParametersConfigParentView',
		[
	 'UWA/Core',
	 'DS/ParameterizationSkeleton/Views/ParametersParentView',
	 'DS/ParameterizationSkeleton/Views/ParameterizationUnitsAndParameters/UnitsAndParametersConfigLayoutView'
	 ],
	 function (
		 UWA,
		 ParametersParentView,
		 UnitsAndParametersConfigLayoutView
		)
{

	'use strict';


	var UnitsAndParametersConfigParentView = ParametersParentView.extend({

		init: function (options) {
			options = UWA.clone(options || {}, false);
			this._domainID = options.domainid;
			this._parent(options);
		},

		setup: function (options) {
			UWA.log('UnitsAndParametersConfigParentView Layout::setup!');
			UWA.log(options);

		},

		render : function()
		{
			var that = this;
			var options = this.options;

		  var layoutView = new UnitsAndParametersConfigLayoutView(options);
			return layoutView.render();
		}
	});

	return UnitsAndParametersConfigParentView;
});

/*! Copyright 2017, Dassault Systemes. All rights reserved. */
/*global define, widget, document, setTimeout, console, alert, clearTimeout*/
/*jslint plusplus: true*/
/*jslint nomen: true*/ 
/*@quickReview NZV 25/25/08 IR-1439767-3DEXPERIENCER2026x : Mask Contentdiv so user not able to click multple times
/*@quickReview NZV 25/08/05 FUN153165 : Add a warning message in case of authorized value removal */
/*@quickReview NZV 25/24/03 FUN153165 : Allow removal of authorized values */
/*@quickReview NZV 25/12/03 //FUN153165 : Roll back channges because 25x FD02 was not over. (Allow removal of authorized values) */
/*@quickReview NZV 25/11/03 //FUN153165 : Allow removal of authorized values */
/*@quickReview NZV 24/10/04 IR-1312610-3DEXPERIENCER2024x/25x : For Multivivaluted Boolean type attribute make defalut value empty & make field disable   */
/*@quickReview SDM 24/08/30 IR-1178782-3DEXPERIENCER2025x: Fix format date for default value 
/*@quickReview NZV 23/10/23 IR-1191227-3DEXPERIENCER2023x/24x : Need to allow empty value as Authorized value in case of Mandatory attribute after FUN130113 delivery. */
/*@quickReview NZV 23/10/10 IR-1171967-3DEXPERIENCER2024x : Remove check for "-" as special character for default value */
/*@quickReview NZV 23/3/22 IR-1042260-3DEXPERIENCER2023x : Make FALSE as default value for boolean type */
/*@quickReview NZV 22/12/15 IR-1024188-3DEXPERIENCER2023x : remove hardcoded time instead setting current time. */
/*@quickReview FRH 22/10/24 FUN130113  (mandatory wihout default value) */
/*@quickReview FRH 22/09/05 FUN127527  (multiline) */
/*@quickReview AJY3 21/02/26 FUN106676 delivery */
/*@quickReview NZV 19/10/18 FUN092576 delivery*/
/*@quickReview NZV 19/01/31 FUN085423 delivery*/
/*@quickReview NZV 18/04/27 FUN076055 delivery*/
/*@quickReview NZV 18/02/07 FUN076053 delivery*/
/*@quickReview ZUR 17/10/11 IR-558248-3DEXPERIENCER2018x*/
/*@quickReview NZV 17/08/27 IR-540216-3DEXPERIENCER2018x*/
/*@quickReview NZV 17/07/06 Minor change related to Units NLS value*/
/*@quickReview NZV 17/06/15 Minor change clear dimension dropdown list before populate*/
/*@quickReview NZV 17/06/15 IR-529296-3DEXPERIENCER2018x*/
/*@quickReview NZV 17/05/22 IR-518037-3DEXPERIENCER2018x*/
/*@quickReview ZUR 17/05/10 IR-518037-3DEXPERIENCER2018x*/
/*@quickReview NZV 17/05/09 IR-519160-3DEXPERIENCER2018x minor changes*/
/*@quickReview NZV 17/05/04 IR-519148-3DEXPERIENCER2018x,IR-512104-3DEXPERIENCER2018x,IR-509281-3DEXPERIENCER2018x */
/*@quickReview NZV 17/05/02 Minor change */
/*@quickReview ZUR 17/04/19 IR-514503-3DEXPERIENCER2017x/18x */
/*@quickReview NZV 17/03/06 IR-506136-3DEXPERIENCER2018x fixed -minor change */
/*@quickReview NZV 17/03/02 IR-504465-3DEXPERIENCER2018x fixed -minor change */
/*@fullReview  NZV 17/04/21 Delivery of HL FUN070867  -major change */
/*@fullReview  NZV 17/03/06 IR-506136-3DEXPERIENCER2018x fixed -minor change */
/*@fullReview  NZV 17/03/02 IR-504465-3DEXPERIENCER2018x fixed -minor change */
/*@fullReview  ZUR 15/07/29 2016xFD01 Param Widgetization NG*/
define('DS/ParameterizationSkeleton/Views/ParameterizationDataModeling/AttributesLayoutUtilities',
    [
        'UWA/Core',
        'DS/UIKIT/Input/Button',
        'DS/UIKIT/Modal',
		'DS/UIKIT/Mask',
		'DS/UIKIT/Input/Select',
        'DS/UIKIT/Input/Text',
        'DS/UIKIT/Input/Toggle',
        'DS/UIKIT/Input/Date',
        'DS/UIKIT/Alert',
        'DS/UIKIT/Popover',
        'DS/UIKIT/Autocomplete',
        'UWA/Controls/Tag',
        'DS/ParameterizationSkeleton/Views/ParameterizationDataModeling/AttributesTypesDefine',
        'DS/ParameterizationSkeleton/Utils/ParameterizationGenericServices',
        'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
        'DS/ParameterizationSkeleton/Utils/ParameterizationWebServices',
        'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS'
    ],
    function (UWA,
              Button, Modal, Mask, Select, Text, Toggle, InputDate,
              Alert, Popover, Autocomplete, Tag,
              AttributesTypesDefine, GenericServices,
              ParametersLayoutViewUtilities,ParmWebServices,
              ParamSkeletonNLS) {

        'use strict';

        var AttrUtilsView = {

                init : function () {
                    this.attrDefValueInput = null;
                    this.cellsIndex = [];
                    this.dimensionsList = null;
                    this.dimensionServiceFailed = false;
                    this.dimensionToolTipCell = null;
                    this.userMessaging = null;
                    /*"DeletedNotDeployed"
                    "NewNotDeployed"
                    "StoredButNotDeployed"
                    "Deployed"
                    "Modified"*/
                },

                initCells : function () {
                    this.cellsIndex = {
                        "TypeName" : 0,
                        "AttributeName" : 1,
                        "AttributeUserName" : 2,
                        "DefaultValue" : 3,
                        "Mandatory" : 4,
                        "Export3DXML" : 5,
                        "MultiValuated" : 6, //FUN092576
                        "Multiline" : 7, // FRH, adding multiline FUN127527
                        "resetWhenDuplicate" : 8,
                        "resetWhenRevision" : 9,
                        "ReadOnly" : 10,
                        "Indexed" : 11,
                        "AuthValue" : 12,
                        "SixWTag" : 13,
                        "Dimension" : 14,
                        "Action" : 15,
                        "DeployStatus" : 16

                    };

                    this.dimensionServiceFailed = false;
                    this.dimensionToolTipCell = null;
                    this.dimensionsSelector = null;
                    this.dimensionTitleCell = null;

                },

                dimensionsList : null,
                listOf6Wpredicates : null,

                getDefaultValueInput : function () {
                    return this.attrDefValueInput;
                },

                buildNLSText : function(title1, width1, tooltiptext) {
                    var iCell, iCell1, iCell2, imgInfoSpan, popoverAuth;


                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : width1
                    });

                    iCell1 = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : '92%'
                    }).inject(iCell);

                    UWA.createElement('p', {
                        text   : title1,
                        'class': 'font-3dslight'// font-3dsbold
                    }).inject(iCell1);

                    if (tooltiptext !== '') {
                        iCell2 = UWA.createElement('td', {
                            'Align' : 'left',
                            'width' : '5%'
                        }).inject(iCell);

                        imgInfoSpan = UWA.createElement('span', {
                            'class' : 'fonticon fonticon-info'
                        }).inject(iCell2);

                        imgInfoSpan.setStyle("color", "black");

                        popoverAuth = new Popover({
                            target   : imgInfoSpan,
                            trigger  : "hover",
                            animate  : "true",
                            position : 'top',
                            body     : tooltiptext,
                            title    : ''
                        });
                    }
                    return iCell;
                },
				buildNLSTextHL : function(title1, width1, tooltiptext1, tooltiptext2) {
                    var iCell, iCell1, iCell2, imgInfoSpan, popoverAuth;


                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : width1
                    });

                    iCell1 = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : '92%'
                    }).inject(iCell);

                    UWA.createElement('p', {
                        text   : title1,
                        'class': 'font-3dslight'// font-3dsbold
                    }).inject(iCell1);

                    if (tooltiptext !== '') {
                        iCell2 = UWA.createElement('td', {
                            'Align' : 'left',
                            'width' : '5%'
                        }).inject(iCell);

                        imgInfoSpan = UWA.createElement('span', {
                            'class' : 'fonticon fonticon-info'
                        }).inject(iCell2);

                        imgInfoSpan.setStyle("color", "black");

                        popoverAuth = new Popover({
                            target   : imgInfoSpan,
                            trigger  : "hover",
                            animate  : "true",
                            position : 'top',
                            body     : tooltiptext,
                            title    : ''
                        });
                    }
                    return iCell;
                },
                fetchAndPopulate6WPredicates : function (sixWTagControl, attributeType) {
                    if (AttrUtilsView.listOf6Wpredicates === null) {
                        GenericServices.getPredicatesReturn(function (result) {
                            AttrUtilsView.listOf6Wpredicates = result;
                            AttrUtilsView.FilterPredicatesListbyType(attributeType, AttrUtilsView.listOf6Wpredicates, sixWTagControl);
                        }, function () {
                            UWA.log("getFedProperties failed! call while updating dropdown list of sixWPredicate");
                        });
                    } else {
                        if (sixWTagControl !== undefined && sixWTagControl !== null) {
                            AttrUtilsView.FilterPredicatesListbyType(attributeType, AttrUtilsView.listOf6Wpredicates, sixWTagControl);
                        }
                    }

                },

                addUserMessaging : function (renderToTarget, ihideDelay) {
                    var userMessaging = new Alert({
                        className : 'param-alert',
                        closable: true,
                        visible: true,
                        renderTo : renderToTarget,
                        autoHide : true,
                        hideDelay : ihideDelay,
                        messageClassName : 'warning'
                    });
                    return userMessaging;
                },

                buildTypeSelect : function () {
                    var i, typeID, isOptionSelected,
                        listofTypes = AttributesTypesDefine.getListOfHandledTypes(),
                        typesSelect =  new Select({
                            nativeSelect: true,
                            placeholder: false,
                            multiple: false
                        });

                    for (i = 0; i < listofTypes.length; i++) {
                        typeID = listofTypes[i].type + listofTypes[i].length;
                        isOptionSelected = false;
                        if (typeID  === 'String') {
                            isOptionSelected = true;
                        }

                        typesSelect.add([{
                            label: ParamSkeletonNLS[typeID],
                            value: typeID,
                            selected: isOptionSelected
                        }], false);
                    }
                    return typesSelect;
                },

                buildToolTipForDimension : function(iCell, message, toolTipcolor) {
                    var imgInfoSpan, popoverAuth;

                    if (iCell !== null && AttrUtilsView.dimensionServiceFailed === true) {

                        if (iCell.childNodes[1].childNodes[0].destroy !== undefined) {
                            iCell.childNodes[1].childNodes[0].destroy();
                        }

                        imgInfoSpan = UWA.createElement('span', {
                            'class' : 'fonticon fonticon-info'
                        }).inject(iCell.childNodes[1]);

                        imgInfoSpan.setStyle("color", toolTipcolor);

                        popoverAuth = new Popover({
                            target   : imgInfoSpan,
                            trigger  : "hover",
                            animate  : "true",
                            position : 'top',
                            body     : message,
                            title    : ''
                        });
                    }
                },

                buildDimensionError : function () {
                    var timerconn, userMessaging;
                    AttrUtilsView.dimensionServiceFailed = true;

                    userMessaging = AttrUtilsView.addUserMessaging(document.body, 1500);

                    AttrUtilsView.buildToolTipForDimension(AttrUtilsView.dimensionToolTipCell, ParamSkeletonNLS.DimensionServiceFailed, "orange");

                    if (timerconn) { clearTimeout(timerconn); }
                    timerconn = setTimeout(function() {
                        userMessaging.add({ className: "warning", message: ParamSkeletonNLS.DimensionServiceFailed});
                    }, 40);
                },

                fetchAndSetNLSDimensions : function (dimension, perferredUnit, dimPara) {
                    var i, j, dimName, dimNLSName = "", unitNLSName = "", units = [], nlsStr = "";

                    if (AttrUtilsView.dimensionsList !== null && dimension !== undefined && dimension !== "") {

                        for (i = 0; i < AttrUtilsView.dimensionsList.length; i++) {
                            dimName = AttrUtilsView.dimensionsList[i].Name;
                            if (dimName === dimension) {
                                dimNLSName = AttrUtilsView.dimensionsList[i].NLS;
                                units = AttrUtilsView.dimensionsList[i].Units;

                                if (perferredUnit !== undefined && perferredUnit !== "") {
                                    for (j = 0; j < units.length; j++) {
                                        if (perferredUnit === units[j].Name) {
                                            unitNLSName = units[j].NLSName;
                                            break;
                                        }
                                    }
                                }
                                break;
                            }
                        }
                        if (dimNLSName !== undefined && dimNLSName !== "") {
                            if (unitNLSName !== undefined && unitNLSName !== "") {
                                nlsStr = dimNLSName + "\n(" + unitNLSName + ")";
                            } else if (perferredUnit !== undefined && perferredUnit !== "") {
                                nlsStr = dimNLSName + "\n(" + perferredUnit + ")";
                            } else {
                                nlsStr = dimNLSName;
                            }
                        } else if (dimension !== undefined && dimension !== "") {
                            if (perferredUnit !== undefined && perferredUnit !== "") {
                                nlsStr = dimension + "\n(" + perferredUnit + ")";
                            } else {
                                nlsStr = dimension;
                            }
                        }
                    } else {
                        nlsStr = "";
                    }
                    if (dimPara.setText !== undefined) {
                        dimPara.setText(nlsStr);
                    }
                },

                getNLSDimensionStr : function (dimension, perferredUnit, dimPara) {
                    if (AttrUtilsView.dimensionsList === null) {
                        AttrUtilsView.dimensionServiceFailed = false;
                        GenericServices.getDimensions(function (jsonResult) {
                            if (jsonResult !== 'undefined') {
                                AttrUtilsView.dimensionsList = jsonResult;
                                AttrUtilsView.getNLSDimensionStr(dimension, perferredUnit, dimPara);
                            }
                        },
                            function () {
                                if (AttrUtilsView.dimensionTitleCell !== null) {
                                    if (AttrUtilsView.dimensionTitleCell.childNodes.length === 1) {
                                        UWA.createElement('h5', {
                                            text: ParamSkeletonNLS.DimensionInternalName
                                        }).inject(AttrUtilsView.dimensionTitleCell);
                                    }
                                }
                                AttrUtilsView.dimensionServiceFailed = true;
                                AttrUtilsView.fetchAndSetNLSDimensions(dimension, perferredUnit, dimPara);

                            });
                    } else {
                        AttrUtilsView.fetchAndSetNLSDimensions(dimension, perferredUnit, dimPara);
                    }
                },

                onSuccessOfGetDimensions : function (jsonResult) {
                    if (jsonResult !== 'undefined') {
                        AttrUtilsView.dimensionsList = jsonResult;
                        AttrUtilsView.populateDimenstionSelect();
                    }
                },

                populateDimenstionSelect : function (dimensionsSelect) {
                    var i, dimNLSName, dimName,
                        listofDimension = AttrUtilsView.dimensionsList;

                    dimensionsSelect = AttrUtilsView.dimensionsSelector;
                    dimensionsSelect.remove();

                    if ((dimensionsSelect !== undefined) && (dimensionsSelect !== null)) {
                        if (listofDimension.length > 0) {
                            dimensionsSelect.enable();
                        }
                        for (i = 0; i < listofDimension.length; i++) {
                            dimNLSName = listofDimension[i].NLS;
                            dimName = listofDimension[i].Name;
                            dimensionsSelect.add([{
                                label: dimNLSName,
                                value: dimName
                            }], false);
                        }
                    }
                },

                buildDimensionsSelect : function (dimensionsSelect) {
                    if (AttrUtilsView.dimensionsList === null) {
                        AttrUtilsView.dimensionServiceFailed = false;
                        GenericServices.getDimensions(AttrUtilsView.onSuccessOfGetDimensions, AttrUtilsView.buildDimensionError);
                    } else {
                        AttrUtilsView.populateDimenstionSelect(dimensionsSelect);
                    }
                },

                buildPreUnitsSelect : function (inputElement, unitsSelect) {
                    var i, j, dimNLSName, dimName, unitsName, defaultUnitName,
                        unitsNLS, isOptionSelected, dimensionName, listofDimension,
                        units = null,
                        dimensions = inputElement.getValue();

                    dimensionName = dimensions[0];
                    unitsSelect.clear();
                    unitsSelect.remove();//IR-529296-3DEXPERIENCER2018x

                    if (dimensionName === '') {
                        unitsSelect.disable();
                        return unitsSelect;
                    }

                    listofDimension = AttrUtilsView.dimensionsList;

                    for (i = 0; i < listofDimension.length; i++) {
                        dimNLSName = listofDimension[i].NLS;
                        dimName =  listofDimension[i].Name;

                        if (dimName  === dimensionName) {
                            defaultUnitName = listofDimension[i].MKSUnit;
                            units = listofDimension[i].Units;
                            break;
                        }
                    }
                    if (units !== null) {
                        if (units.length > 0) {
                            unitsSelect.enable();
                        } else {
                            unitsSelect.disable();
                        }

                        for (j = 0; j < units.length; j++) {
                            unitsName = units[j].Name;
                            if (units[j].NLSName !== "") {
                                unitsNLS = units[j].NLSName;
                            } else {
                                unitsNLS = unitsName;
                            }
                            isOptionSelected = false;
                            if (unitsName === defaultUnitName) {
                                isOptionSelected = true;
                            }

                            unitsSelect.add([{
                                label: unitsNLS,
                                value: unitsName,
                                selected: isOptionSelected
                            }], false);
                        }
                    } else {
                        unitsSelect.disable();
                    }

                    return unitsSelect;
                },
				//IR-1071270-3DEXPERIENCER2023x
                buildBooleanDefaultwithSpaceValue : function () {
                    var boolSelect =  new Select({
                            nativeSelect: false,
                            placeholder: false,
                            multiple: false,
                            options: [
										{ value: '', label: "", selected:true},
                                        { value: 'FALSE', label: ParamSkeletonNLS.FalseLabel},
                                       { value: 'TRUE', label: ParamSkeletonNLS.TrueLabel}
                                       ]
                        });
                    return boolSelect;
                },

                buildBooleanDefault : function () {
                    var boolSelect =  new Select({
                            nativeSelect: false,
                            placeholder: false,
                            multiple: false,
                            options: [ //IR-1042260-3DEXPERIENCER2023x : set default value to false
										{ value: 'FALSE', label: ParamSkeletonNLS.FalseLabel, selected:true},
                                       { value: 'TRUE', label: ParamSkeletonNLS.TrueLabel}
                                       ]
                        });
                    return boolSelect;
                },

                buildTextDefault : function (userMessaging) {
                    var timerconn, diffDate,
                        currTime = new Date().getTime(),
                        lastMessageDate = currTime,
                        iDefaulInputText = new Text({
                            id : 'attrDefValueInput',
                            attributes: {
                                value: '',
                                multiline: false,
                                disabled: false
                            },
                            events: {
                                onKeyDown: function () {
                                    if (timerconn) { clearTimeout(timerconn); }
                                    timerconn = setTimeout(function() {
                                        currTime = new Date().getTime();

                                        if (AttrUtilsView.testStrictSpecialCharacters(iDefaulInputText.getValue())) {
                                            diffDate = currTime - lastMessageDate;
                                            if (diffDate > 1500) {
                                                userMessaging.add({ className: "error", message: ParamSkeletonNLS.SpecialCharactersMsg});
                                                lastMessageDate = new Date().getTime();
                                            }
                                            iDefaulInputText.elements.input.setStyle('color', 'red');
                                            iDefaulInputText.focus();
                                        } else if (ParametersLayoutViewUtilities.containsAccents(iDefaulInputText.getValue())) {
                                            diffDate = currTime - lastMessageDate;
                                            if (diffDate > 1500) {
                                                userMessaging.add({ className: "error", message: ParamSkeletonNLS.AccentsnotAllowedMsg});
                                                lastMessageDate = new Date().getTime();
                                            }
                                            iDefaulInputText.elements.input.setStyle('color', 'red');
                                            iDefaulInputText.focus();
                                        } else {
                                            iDefaulInputText.elements.input.setStyle('color', '#555555');
                                        }
                                    }, 20);
                                }//onKeyDown
                            }//events
                        });
                    return iDefaulInputText;
                },

                buildDateDefault : function () {
                    var dateSpan, dateInput, dateCheckbox;
                    dateSpan = UWA.createElement('span');

                    dateInput = new InputDate({
                        value: new Date()
                    }).inject(dateSpan);

                    dateSpan.dateInput = dateInput;

                    dateCheckbox = new Toggle({
                        type: 'checkbox',
                        label: ParamSkeletonNLS.NoDefaultValue
                    }).uncheck().inject(dateSpan);
                    dateSpan.dateCheckbox = dateCheckbox;
                    dateCheckbox.addEvent('onChange', function() {
                        if (this.isChecked()) {
                            dateInput.setDate(null);
                            dateInput.setValue(null);
                            dateInput.disable();
                        } else {
                            dateInput.setDate(new Date());
                            dateInput.enable();
                        }
                    });
                    return dateSpan;
                },

                buildTitlesLine : function (wdthArray) {
                    var iCell, cellsIndex,
                        lineTitle = UWA.createElement('tr', {
                            'class' : 'success'
                        });
                    //initilize variable & constent
                    this.initCells();
                    cellsIndex = this.cellsIndex;
                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : wdthArray[cellsIndex.TypeName].toString() + '%'
                    }).inject(lineTitle);

                    UWA.createElement('h5', {
                        text   : ParamSkeletonNLS.AttributeTypeNLenth
                        //'class': 'font-3dslight'// font-3dsbold
                    }).inject(iCell);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : wdthArray[cellsIndex.AttributeName].toString() + '%'
                    }).inject(lineTitle);

                    UWA.createElement('h5', {
                        text   : ParamSkeletonNLS.AttributeInternalName
                        //'class': 'font-3dslight'
                    }).inject(iCell);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : wdthArray[cellsIndex.AttributeName].toString() + '%'
                    }).inject(lineTitle);

                    UWA.createElement('h5', {
                        text   : ParamSkeletonNLS.AttributeUserName
                        //'class': 'font-3dslight'
                    }).inject(iCell);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : wdthArray[cellsIndex.DefaultValue].toString() + '%'
                    }).inject(lineTitle);

                    UWA.createElement('h5', {
                        text   : ParamSkeletonNLS.AttributeDefaultValue
                        //'class': 'font-3dslight'
                    }).inject(iCell);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : wdthArray[cellsIndex.Mandatory].toString() + '%'
                    }).inject(lineTitle);

                    UWA.createElement('h5', {
                        text   : ParamSkeletonNLS.MandatoryAttributeTitle
                        //'class': 'font-3dslight'
                    }).inject(iCell);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : wdthArray[cellsIndex.Export3DXML].toString() + '%'
                    }).inject(lineTitle);
                    UWA.createElement('h5', {
                        text   : ParamSkeletonNLS.ExportIn3DXML
                        //'class': 'font-3dslight'
                    }).inject(iCell);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : wdthArray[cellsIndex.MultiValuated].toString() + '%'
                    }).inject(lineTitle);

                    UWA.createElement('h5', {
                        text   : ParamSkeletonNLS.MultiValuated
                        //'class': 'font-3dslight'
                    }).inject(iCell);

                    // support of multiline information FUN127527
                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : wdthArray[cellsIndex.Multiline].toString() + '%'
                    }).inject(lineTitle);

                    UWA.createElement('h5', {
                        text   : ParamSkeletonNLS.Multiline
                        //'class': 'font-3dslight'
                    }).inject(iCell);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : wdthArray[cellsIndex.resetWhenDuplicate].toString() + '%'
                    }).inject(lineTitle);

                    UWA.createElement('h5', {
                        text   : ParamSkeletonNLS.ResetOnDuplicate
                        //'class': 'font-3dslight'
                    }).inject(iCell);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : wdthArray[cellsIndex.resetWhenRevision].toString() + '%'
                    }).inject(lineTitle);

                    UWA.createElement('h5', {
                        text   : ParamSkeletonNLS.ResetOnRevision
                        //'class': 'font-3dslight'
                    }).inject(iCell);


                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : wdthArray[cellsIndex.ReadOnly].toString() + '%'
                    }).inject(lineTitle);

                    UWA.createElement('h5', {
                        text   : ParamSkeletonNLS.ReadOnlyAttributeTitle
                        //'class': 'font-3dslight'
                    }).inject(iCell);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : wdthArray[cellsIndex.Indexed].toString() + '%'
                    }).inject(lineTitle);

                    UWA.createElement('h5', {
                        text   : ParamSkeletonNLS.IndexedAttributeTitle
                        //'class': 'font-3dslight'
                    }).inject(iCell);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : wdthArray[cellsIndex.AuthValue].toString() + '%'
                    }).inject(lineTitle);

                    UWA.createElement('h5', {
                        text   : ParamSkeletonNLS.AuthorizedValsTitle
                        //'class': 'font-3dslight'
                    }).inject(iCell);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : wdthArray[cellsIndex.SixWTag].toString() + '%'
                    }).inject(lineTitle);

                    UWA.createElement('h5', {
                        text   : ParamSkeletonNLS.SixWTagAttributeTitle
                        //'class': 'font-3dslight'
                    }).inject(iCell);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : wdthArray[cellsIndex.Dimension].toString() + '%'
                    }).inject(lineTitle);

                    AttrUtilsView.dimensionTitleCell =  UWA.createElement('h5', {
                        text   : ParamSkeletonNLS.Dimensions
                        //'class': 'font-3dslight'
                    }).inject(iCell);

                    //actionWidth = wdthArray[10] + wdthArray[11];

                    iCell = UWA.createElement('td', {
                        'Align'  : 'left',
                        'colspan': '2',
                        'width'  : wdthArray[cellsIndex.Action].toString() + '%'
                    }).inject(lineTitle);

                    UWA.createElement('h5', {
                        text   : ParamSkeletonNLS.ActionsText
                    }).inject(iCell);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : wdthArray[cellsIndex.DeployStatus].toString() + '%'
                    }).inject(lineTitle);

                    UWA.createElement('h5', {
                        text   : ParamSkeletonNLS.DeployStatus
                        //'class': 'font-3dslight'
                    }).inject(iCell);

                    return lineTitle;
                },
                update6WTagCellWithNLS : function (cell, sixWTagValue, isixwTagNLS) {
                    if (isixwTagNLS !== "") {
                        AttrUtilsView.update6WTagCell(cell, isixwTagNLS);
                    } else {

                        if (AttrUtilsView.listOf6Wpredicates !== null) {
                            isixwTagNLS = AttrUtilsView.getMatching6wtagNLS(sixWTagValue, AttrUtilsView.listOf6Wpredicates);
                            AttrUtilsView.update6WTagCell(cell, isixwTagNLS);
                        } else {
                            GenericServices.getPredicatesReturn(function (result) {
                                AttrUtilsView.listOf6Wpredicates = result;
                                isixwTagNLS = AttrUtilsView.getMatching6wtagNLS(sixWTagValue, AttrUtilsView.listOf6Wpredicates);
                                AttrUtilsView.update6WTagCell(cell, isixwTagNLS);
                            }, function (eMessage) {
                                AttrUtilsView.update6WTagCell(cell, sixWTagValue);
                                UWA.log("getFedProperties failed! call while get label value of " + sixWTagValue + eMessage);
                            });
                        }
                    }
                },

                update6WTagCell : function (cell, isixwTag) {
                    if ((isixwTag !== undefined) &&
                            (isixwTag !== '')) {
                        new Tag({
                            value: isixwTag,
                            className: 'border-only',
                            closable: true
                        }).inject(cell);
                    }
                },
				////IR-820267-3DEXPERIENCER2021x
                buildAttributeLine : function (itypeNLen, iName, iInternalName, iDefaultValue, isMand, isReadOnly,
                    isExposedTo3DXML, isMultiValuated/*FUN092576*/, isMultiline,/*FUN127527*/ iDimension, iPerferredUnit, isIndexed, iAuthValues, isixwTag,
                    isixwTagValue, isUsedInOtherSettings, isDeployed, wdthArray, userMessaging,
                    revisionToggle, duplicateToggle,that) {
                    var iCell, removeAttributeButton, deleteSpan, removePop, defaultValuetoShow, iATpos,//editPop, editSpan, editAttributeButton,
                        iconChoice, iconColor,
                        dimPara,
                        defaultDateObj,//sixWTagContainer,
                        defCellTitle = "",
                        removelts = [], dimensionText = "",
                        lineAttr = UWA.createElement('tr'),
                        cellsIndex = this.cellsIndex, sixWTagCell;

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : wdthArray[cellsIndex.TypeName].toString() + '%',
                        'value'  : itypeNLen
                    }).inject(lineAttr);

                    UWA.createElement('p', {
                        text   : ParamSkeletonNLS[itypeNLen],
                        'class': 'font-3dslight'// font-3dsbold
                    }).inject(iCell);

                    iCell = UWA.createElement('td', {
                        'Align'  : 'left',
                        'width'  : wdthArray[cellsIndex.AttributeName].toString() + '%',
                        'value'  : iInternalName
                    }).inject(lineAttr);

                    UWA.createElement('p', {
                        text   : iInternalName,
                        value  : iInternalName,
                        'class': 'font-3dslight'
                    }).inject(iCell);

					//IR-820267-3DEXPERIENCER2021x
                    iCell = UWA.createElement('td', {
                        'Align'  : 'left',
                        'width'  : wdthArray[cellsIndex.AttributeName].toString() + '%',
                        'value'  : iName,
						'internalName' : iInternalName
                    }).inject(lineAttr);

                    UWA.createElement('p', {
                        text   : iName,
                        value  : iName,
                        'class': 'font-3dslight'
                    }).inject(iCell);

                    defaultValuetoShow = iDefaultValue;
                    //ZUR IR-494192-3DEXPERIENCER2017x
                    //default 2017/01/24@11:00:00:GMT (generated 2017-01-24T18:32:22.382Z)
                    //3/23/2017

                    if (itypeNLen === "Date") {
                        defaultDateObj = new Date(iDefaultValue);
                        defCellTitle = defaultDateObj.toDateString();
                        iATpos = iDefaultValue.indexOf("@");
                        if (iATpos > 0) {
                            defaultValuetoShow  = iDefaultValue.substring(0, iATpos);
                        }
                    }

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : wdthArray[cellsIndex.DefaultValue].toString() + '%',
                        'value' : iDefaultValue,
                        'title' : defCellTitle
                    }).inject(lineAttr);

                    UWA.createElement('p', {
                        text   : defaultValuetoShow,
                        'class': 'font-3dslight'
                    }).inject(iCell);

                    /*if (!isMand) {
                        iconChoice = 'cancel-squared';
                        iconColor = 'orange';
                    }*/

                    if (isMand === true) {
                        iconChoice = 'check';
                        iconColor = 'green';
                        iCell = ParametersLayoutViewUtilities.buildImgCell(iconChoice, '1', iconColor, isMand, wdthArray[cellsIndex.Mandatory].toString() + '%', 'center');
                    } else {
                        iCell = UWA.createElement('td', {'width'  : wdthArray[cellsIndex.Mandatory].toString() + '%'}).inject(lineAttr);
                    }
                    iCell.value = isMand;
                    iCell.inject(lineAttr);

                    //expose to 3dXML
                    if (isExposedTo3DXML === true) {
                        iconChoice = 'check';
                        iconColor = 'green';
                        iCell = ParametersLayoutViewUtilities.buildImgCell(iconChoice, '1', iconColor, isExposedTo3DXML, wdthArray[cellsIndex.Export3DXML].toString() + '%', 'center');
                    } else {
                        iCell = UWA.createElement('td', {'width'  : wdthArray[cellsIndex.Export3DXML].toString() + '%'}).inject(lineAttr);
                    }
                    iCell.value = isExposedTo3DXML;
                    iCell.inject(lineAttr);
                   // end expose to 3dxml
                    //expose to MultiValuated - FUN092576
                    if (isMultiValuated === true) {
                        iconChoice = 'check';
                        iconColor = 'green';
                        iCell = ParametersLayoutViewUtilities.buildImgCell(iconChoice, '1', iconColor, isMultiValuated, wdthArray[cellsIndex.MultiValuated].toString() + '%', 'center');
                    } else {
                        iCell = UWA.createElement('td', {'width'  : wdthArray[cellsIndex.MultiValuated].toString() + '%'}).inject(lineAttr);
                    }
                    iCell.value = isMultiValuated;
                    iCell.inject(lineAttr);
                   // end expose to MultiValuated
                    //expose to Multiline - FUN127527
                    if (isMultiline === true) {
                        iconChoice = 'check';
                        iconColor = 'green';
                        iCell = ParametersLayoutViewUtilities.buildImgCell(iconChoice, '1', iconColor, isMultiline, wdthArray[cellsIndex.Multiline].toString() + '%', 'center');
                    } else {
                        iCell = UWA.createElement('td', {'width'  : wdthArray[cellsIndex.Multiline].toString() + '%'}).inject(lineAttr);
                    }
                    iCell.value = isMultiline;
                    iCell.inject(lineAttr);

                   // end expose to Multiline

                    if (duplicateToggle === undefined || duplicateToggle === "") {
                        duplicateToggle = false; //set defual value
                    }
                    //expose to duplicateToggle
                    if (duplicateToggle === true) {
                        iconChoice = 'check';
                        iconColor = 'green';
                        iCell = ParametersLayoutViewUtilities.buildImgCell(iconChoice, '1', iconColor, duplicateToggle, wdthArray[cellsIndex.resetWhenDuplicate].toString() + '%', 'center');
                    } else {
                        iCell = UWA.createElement('td', {'width'  : wdthArray[cellsIndex.resetWhenDuplicate].toString() + '%'}).inject(lineAttr);
                    }
                    iCell.value = duplicateToggle;
                    iCell.inject(lineAttr);
                    //end expose to duplicateToggle
                    //expose to revisionToggle,
                    if (revisionToggle === undefined || revisionToggle === "") {
                        revisionToggle = false; //set defual value
                    }
                    if (revisionToggle === true) {
                        iconChoice = 'check';
                        iconColor = 'green';
                        iCell = ParametersLayoutViewUtilities.buildImgCell(iconChoice, '1', iconColor, revisionToggle, wdthArray[cellsIndex.resetWhenRevision].toString() + '%', 'center');
                    } else {
                        iCell = UWA.createElement('td', {'width'  : wdthArray[cellsIndex.resetWhenRevision].toString() + '%'}).inject(lineAttr);
                    }
                    iCell.value = revisionToggle;
                    iCell.inject(lineAttr);
                    //end expose to revisionToggle
                    if (isReadOnly === true) {
                        iconChoice = 'check';
                        iconColor = 'green';
                        iCell = ParametersLayoutViewUtilities.buildImgCell(iconChoice, '1', iconColor, isReadOnly, wdthArray[cellsIndex.ReadOnly].toString() + '%', 'center');
                    } else {
                        iCell = UWA.createElement('td', {'width'  : wdthArray[cellsIndex.ReadOnly].toString() + '%'}).inject(lineAttr);
                    }
                    iCell.value = isReadOnly;
                    iCell.inject(lineAttr);
                    //NZV : Remove Index toggle button with Function FUN085423
                    if (isIndexed === true) {
                        iconChoice = 'check';
                        iconColor = 'green';
                        iCell = ParametersLayoutViewUtilities.buildImgCell(iconChoice, '1', iconColor, isIndexed, wdthArray[cellsIndex.Indexed].toString() + '%', 'center');
                    } else {
                        iCell = UWA.createElement('td', {'width'  : wdthArray[cellsIndex.Indexed].toString() + '%'}).inject(lineAttr);
                    }
                    iCell.value = isIndexed;
                    iCell.inject(lineAttr);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : wdthArray[cellsIndex.AuthValue].toString() + '%',
                        'value' : iAuthValues
                    }).inject(lineAttr);

                    UWA.createElement('p', {
                        text   : iAuthValues,
                        'class': 'font-3dslight'
                    }).inject(iCell);

                    sixWTagCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : wdthArray[cellsIndex.SixWTag].toString() + '%',
                        'value' : isixwTagValue
                    }).inject(lineAttr);

                    if ((isixwTagValue !== undefined) && (isixwTagValue !== '')) {
                        AttrUtilsView.update6WTagCellWithNLS(sixWTagCell, isixwTagValue, isixwTag);
                    }

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : wdthArray[cellsIndex.Dimension].toString() + '%',
                        'value' : iDimension + "," + iPerferredUnit
                    }).inject(lineAttr);

                    dimPara = UWA.createElement('p', {
                        text   : dimensionText,
                        'class': 'font-3dslight'
                    }).inject(iCell);

                    if ((iDimension !== undefined) && (iDimension !== "")) {
                        dimensionText = AttrUtilsView.getNLSDimensionStr(iDimension, iPerferredUnit, dimPara);

                    }

                    //fonticon fonticon-pencil
                    //fonticon fonticon-fonticon fonticon-cancel fonticon-1.5x

                    /*editElts = AttrUtilsView.createEditActionElements();
                    editSpan = editElts[0];
                    editSpan.inject(iCell);
                    editAttributeButton = editElts[1];
                    editPop = editElts[2];

                    editAttributeButton.addEvent("onClick", function () {
                        UWA.log("editAttributeButton::onClick");
                    });*/
                    //Cell - 10, Action element
                   // var  actionWidth = wdthArray[cellsIndex.Action] + wdthArray[cellsIndex.DeployStatus];
                    /*iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : actionWidth.toString() + '%'
                    }).inject(lineAttr);*/

                    iCell = UWA.createElement('td', {
                        'Align' : 'center',
                        'colspan': '2',
                        'width' : wdthArray[cellsIndex.Action].toString() + '%'
                    }).inject(lineAttr);
                    //NZV - FUN085423
                    var editElts = ParametersLayoutViewUtilities.createActionElements(ParamSkeletonNLS.EditAttribute, false);
                    var editSpan = editElts[0];
                     //actionSpan.setStyle("padding-right", "20px");
                    editSpan.setStyle("float", "left");
                    editSpan.inject(iCell);
                    var editAttributeButton = editElts[1];
                    var editPop = editElts[2];

                    removelts = ParametersLayoutViewUtilities.createActionElements(ParamSkeletonNLS.DeleteAttributetxt, true);
                    deleteSpan = removelts[0];
                    deleteSpan.setStyle("float", "right");
                    deleteSpan.inject(iCell);
                    removeAttributeButton = removelts[1];
                    removePop = removelts[2];

                    iCell = ParametersLayoutViewUtilities.buildDeployStsCell(isDeployed.toString(), wdthArray[cellsIndex.DeployStatus].toString() + '%', '1.5', 'center');

                    if (isDeployed === true) {
                        iCell.value  = "Deployed";
                    } else if (isDeployed === "NewNotDeployed") {
                        iCell.value  = "NewNotDeployed";
                    } else {
                        iCell.value  = "StoredButNotDeployed";//"false"
                    }

                    //iCell.value = isDeployed;
                    iCell.inject(lineAttr);

                    editAttributeButton.addEvent("onClick", function () {
                        AttrUtilsView.showEditAttributeModel(userMessaging,that,lineAttr)
                    });
                    //R-964136-3DEXPERIENCER2022x\23x:get latest info that attribute referenced on other app's parameter
                    removeAttributeButton.addEvent("onClick", function () {
                      var lineDeployStatusValue = iCell.value, objToBeRemoved;//IR-518037-3DEXPERIENCER2018x
                      if (lineDeployStatusValue === "NewNotDeployed") {
                          removePop.destroy();//editPop.remove();
                          AttrUtilsView.attributeLinetobeDeleted(lineAttr);//attrIndexToggle*/
                        } else {
						  //IR-1439767-3DEXPERIENCER2026x : Mask div so user not able to click multple times
						  Mask.mask(that.contentDiv);
                          ParmWebServices.getAttributeUsedInOther(that.handledTypeID,iInternalName,iName).then(function (result) {
                          isUsedInOtherSettings = result.attributeDescription[0].isUsedInOther;
						  if (Mask.isMasked(that.contentDiv)) { Mask.unmask(that.contentDiv); }
						  if (isUsedInOtherSettings === true) {//IR-516226-3DEXPERIENCER2017x/18x
							//IR-964136-3DEXPERIENCER2023x/22x
                            that.userMessaging.add({ className: "warning", message: ParamSkeletonNLS.AttributeUsedInOtherMsg });
                          } else {
                                //AttrUtilsView.showContextualDeleteModal(widget.body, lineAttr, removePop);
                                //FUN102019 21x FD03
                                objToBeRemoved = {popOver : removePop, attrLine : lineAttr};//IR-689657-3DEXPERIENCER2019x/20x : function signature changed
                                ParametersLayoutViewUtilities.showContextualDeleteModal(widget.body, "delAttrModal", ParamSkeletonNLS.removeAttributesWarning + "\n"+ParamSkeletonNLS.removeAttributesWarningSec,
                                    ParamSkeletonNLS.YesText,  ParamSkeletonNLS.NoText, ParamSkeletonNLS.Warning+"!", AttrUtilsView.removeAttribueLine, objToBeRemoved);

                                  }
                                }).catch(function (error) { if (Mask.isMasked(that.contentDiv)) { Mask.unmask(that.contentDiv); } console.log("request isattributereferencedinother failed"+error)})
                              }
                            });

                    return lineAttr;
                },
                //NZV - FUN085423
                showEditAttributeModel : function (userMessaging, that,lineAttr) {
                    var headertitle, modalbodyTable, tbodyreflist, attrLine, listofAddedAttrs,
                        AuthValsInput, typeNLen,
                        OKBtn, CancelBtn, checkResult, hasAuthVals,
                        sixwTagSelector, typesSelect, attrNameInput, attrUserNameInput, attrDefValueInput,
                        currSelectedOpt, iDefaultValue,
                        mandToggle, readonlyToggle, indexedToggle,
                        dateInput, dateSpan, iShortDate,
                        selected6wTag = '',
                        selected6wTagValue = '',
                        inputsArray = [],
                        dimensionsSelector, unitSelect,
                        export3DXMLToggle = false, revisionToggle = null, duplicateToggle = null,
                        trdimValues, trLine, trDim = "", trPreUnits = "", trhasAuthValues=false, trTypeNLen,
                        cellsIndex = this.cellsIndex, isLineModified = -1, i, j, authValuesStr = "", multiValuatedToggle,multilineToggle; // FUN127527 FRH Support multiline

                    UWA.log("showEditAttributeModel::");

                    if (that.editAttributesModal !== null) {
                        that.editAttributesModal.destroy();//Modal already exists
                    }

                    headertitle = UWA.createElement('h4', {
                        text   : ParamSkeletonNLS.EditAttribute,
                        'class': 'font-3dslight' // font-3dsbold
                    });

                    //build line object from reading value from tr
                    trdimValues = lineAttr.cells[cellsIndex.Dimension].value.split(",");

                    if (trdimValues.length > 1) {
                        trDim = trdimValues[0];
                        trPreUnits = trdimValues[1];
                    } else {
                        trDim = trdimValues[0];
                    }
                    //IR-744403-3DEXPERIENCER2021x
                    if(lineAttr.cells[cellsIndex.AuthValue].value != undefined ) {
                        if(lineAttr.cells[cellsIndex.AuthValue].value.indexOf(",") == -1) {
                            lineAttr.cells[cellsIndex.AuthValue].value = lineAttr.cells[cellsIndex.AuthValue].value.trim();
                        } else {
                            //lineAtt.cells[cellsIndex.AuthValue].value = lineAttr.cells[cellsIndex.AuthValue].value.trim();
                        }
                        if (lineAttr.cells[cellsIndex.AuthValue].value !== "")
                            trhasAuthValues = true;
                    }
                    trTypeNLen = AttrUtilsView.getSelectedTypeAndLength(lineAttr.cells[cellsIndex.TypeName].value);
                    trLine = {
                            nlsName          : lineAttr.cells[cellsIndex.AttributeUserName].value,
							internalName	 : lineAttr.cells[cellsIndex.AttributeName].value,//IR-820267-3DEXPERIENCER2021x
                            type             : trTypeNLen[0],
                            maxLength        : trTypeNLen[1],
                            defaultValue     : lineAttr.cells[cellsIndex.DefaultValue].value,
                            isMandatory      : lineAttr.cells[cellsIndex.Mandatory].value,
                            isExposedTo3DXML : lineAttr.cells[cellsIndex.Export3DXML].value, //FUN092576
                            multiValuated    : lineAttr.cells[cellsIndex.MultiValuated].value,
                            multiline        : lineAttr.cells[cellsIndex.Multiline].value, // FUN127527
                            resetWhenDuplicate : lineAttr.cells[cellsIndex.resetWhenDuplicate].value,
                            resetWhenRevision : lineAttr.cells[cellsIndex.resetWhenRevision].value,
                            isReadOnly       : lineAttr.cells[cellsIndex.ReadOnly].value,
                            isIndexed        : lineAttr.cells[cellsIndex.Indexed].value,//lineAttr.cells[cellsIndex.Indexed].childNodes[0].childNodes[0].checked,
                            hasAuthValues    : trhasAuthValues,
                            listofAuthValues : lineAttr.cells[cellsIndex.AuthValue].value,
                            SixWTag          : lineAttr.cells[cellsIndex.SixWTag].value,
                            dimension        : trDim,
                            preferredunit    : trPreUnits

                        }
						//IR-1312610-3DEXPERIENCER2024x/25x
						that.multiValuated = trLine.multiValuated;
						inputsArray        = AttrUtilsView.buildModalSkeleton(that);
						modalbodyTable     = AttrUtilsView.getInputFromSkeleton(inputsArray, "modalbodyTable");
						typesSelect        = AttrUtilsView.getInputFromSkeleton(inputsArray, "typesSelect");
						attrNameInput      = AttrUtilsView.getInputFromSkeleton(inputsArray, "attrNameInput");
						attrUserNameInput  = AttrUtilsView.getInputFromSkeleton(inputsArray, "attrUserNameInput");
						mandToggle         = AttrUtilsView.getInputFromSkeleton(inputsArray, "mandToggle");
						readonlyToggle     = AttrUtilsView.getInputFromSkeleton(inputsArray, "readonlyToggle");
						indexedToggle      = AttrUtilsView.getInputFromSkeleton(inputsArray, "indexedToggle");
						sixwTagSelector    = AttrUtilsView.getInputFromSkeleton(inputsArray, "sixwTagAutoSelect");
						AuthValsInput      = AttrUtilsView.getInputFromSkeleton(inputsArray, "AuthValsInput");
						OKBtn              = AttrUtilsView.getInputFromSkeleton(inputsArray, "OKBtn");
						CancelBtn          = AttrUtilsView.getInputFromSkeleton(inputsArray, "CancelBtn");
						dimensionsSelector = AttrUtilsView.getInputFromSkeleton(inputsArray, "dimensionsSelect");
						unitSelect         = AttrUtilsView.getInputFromSkeleton(inputsArray, "unitSelect");
						export3DXMLToggle  = AttrUtilsView.getInputFromSkeleton(inputsArray, "export3DXMLToggle");
						revisionToggle     = AttrUtilsView.getInputFromSkeleton(inputsArray, "revisionToggle");
						duplicateToggle    = AttrUtilsView.getInputFromSkeleton(inputsArray, "duplicateToggle");
						attrDefValueInput  = AttrUtilsView.getInputFromSkeleton(inputsArray, "attrDefValueInput");
						multiValuatedToggle = AttrUtilsView.getInputFromSkeleton(inputsArray, "multiValuatedToggle");
						// FUN127527 FRH Support multiline
						multilineToggle    = AttrUtilsView.getInputFromSkeleton(inputsArray, "multilineToggle");
                    //initilization from existing values
                    typesSelect.select(String, true, false, false);
                    typesSelect.select(trLine.type, true, false, false);


                    attrNameInput.setValue(trLine.internalName);
                    attrUserNameInput.setValue(trLine.nlsName);
                    attrNameInput.disable();

                    if (trLine.isMandatory === true) {
                        mandToggle.check();
                    } else {
                        mandToggle.uncheck();
                    }
					//FUN119390
                    // FRH: FUN130113: removing the fcat to disable mandatory attribute when object existed
					//if (that.isObjectExistWithConfiguredAttribue === true) {
					//	mandToggle.disable();
					//}
                    if(trLine.isReadOnly === true) {
                        readonlyToggle.check();
                    } else {
                        readonlyToggle.uncheck();
                    }

                    if(trLine.isIndexed === true) {
                        indexedToggle.check();
                    } else {
                        indexedToggle.uncheck();
                        sixwTagSelector.disable();
                    }

                    if(trLine.listofAuthValues !== "") {
                        AuthValsInput.setValue(trLine.listofAuthValues);
                    } else {
                        if (lineAttr.cells[cellsIndex.DeployStatus].value !== "NewNotDeployed") {
                            AuthValsInput.disable();
                        }
                    }

                    if (trLine.type === 'Real') {
                        AttrUtilsView.buildDimensionsSelect(dimensionsSelector);
                        dimensionsSelector.select(trLine.dimension,true, false, false);
                        unitSelect.select(trLine.preferredunit,true, false, false);

                    } else {
                        unitSelect.disable();
                    }
                    dimensionsSelector.disable();

                    if(trLine.isExposedTo3DXML === true) {
                        export3DXMLToggle.check();
                    } else {
                        export3DXMLToggle.uncheck();
                    }
                    //FUN092576
                    if(trLine.multiValuated === true) {
                        multiValuatedToggle.check();
                    } else {
                        multiValuatedToggle.uncheck();
                    }
					multiValuatedToggle.disable();//IR-750288-3DEXPERIENCER2021x
					// FUN127527 FRH Support multiline
                    if(trLine.multiline === true) {
                        multilineToggle.check();
                    } else {
                        multilineToggle.uncheck();
                    }

                    if(trLine.resetWhenRevision === true) {
                        revisionToggle.check();
                    } else {
                        revisionToggle.uncheck();
                    }

                    if(trLine.resetWhenDuplicate === true) {
                        duplicateToggle.check();
                    } else {
                        duplicateToggle.uncheck();
                    }
					//FUN119390
                    if(trLine.type !== 'Date') {
                        this.attrDefValueInput.setValue(trLine.defaultValue);
						if (that.isObjectExistWithConfiguredAttribue === true) {

							if (trLine.defaultValue === "") {
								this.attrDefValueInput.disable();
							} else {
								this.attrDefValueInput.enable();
							}//IR-1042260-3DEXPERIENCER2023x
              if (trLine.type === 'Boolean' && (lineAttr.cells[cellsIndex.DeployStatus].value === "NewNotDeployed") ) {
                this.attrDefValueInput.disable();
              }
						}
                        if (trLine.multiValuated === true) {//IR-750288-3DEXPERIENCER2021x
                            this.attrDefValueInput.disable();
                        }

                    } else {
                       if(trLine.defaultValue !== "") {
                            this.attrDefValueInput.dateInput.setDate(trLine.defaultValue);
							//IR-995980-3DEXPERIENCER2023x
							if (that.isObjectExistWithConfiguredAttribue === true) {
								//IR-951344-3DEXPERIENCER2022x\23x
								this.attrDefValueInput.dateInput.enable();
								this.attrDefValueInput.dateCheckbox.enable();
							}
                        } else {

                            this.attrDefValueInput.dateCheckbox.setCheck(true);
                            this.attrDefValueInput.dateInput.setDate(null);
                            this.attrDefValueInput.dateInput.setValue(null);
							this.attrDefValueInput.dateInput.disable();
							if (that.isObjectExistWithConfiguredAttribue === true) {
								//this.attrDefValueInput.dateInput.disable();
								this.attrDefValueInput.dateCheckbox.disable();
							}
                        }//IR-750288-3DEXPERIENCER2021x
                        if (trLine.multiValuated === true) {
                            this.attrDefValueInput.dateInput.disable();
                            this.attrDefValueInput.dateCheckbox.disable();
                        }

                    }
                    if(trLine.SixWTag !== "") {
                        var ds6wLabel = ""
                        if (AttrUtilsView.listOf6Wpredicates !== null) {
                            ds6wLabel = AttrUtilsView.getMatching6wtagNLS(trLine.SixWTag, AttrUtilsView.listOf6Wpredicates);
                        }
                        sixwTagSelector.onSelect({value:trLine.SixWTag, label:ds6wLabel});
                    }

                    typesSelect.disable();

                    OKBtn.addEvent("onClick", function () {

                        var userSelectDimention = "", perferredUnit = "", attriLineAuthValues = trLine.listofAuthValues,
                        msg ="";

                        typeNLen = AttrUtilsView.getSelectedTypeAndLength(typesSelect.getSelection()[0].value);
                       // userSelectDimention = {};
                        if (typeNLen[0] === 'Boolean') {
                            attrDefValueInput = AttrUtilsView.getDefaultValueInput();
                            currSelectedOpt = attrDefValueInput.getSelection();
                            iDefaultValue = currSelectedOpt[0].value;
                        } else if (typeNLen[0] === 'Date') {
                            //ZUR IR-494192-3DEXPERIENCER2017x
                            dateSpan = AttrUtilsView.getDefaultValueInput();
                            dateInput = dateSpan.dateInput;
                            iShortDate = dateInput.getDate();
                            if (iShortDate !== null) {
                                iShortDate.setHours(11);//ZUR IR-502127-3DEXPERIENCER2018x
                                //toLocaleDateString
                                iDefaultValue = AttrUtilsView.getCATIACompatibleDateFromISOString(iShortDate.toISOString());
                            } else {
                                iDefaultValue = "";
                            }

                        } else if (typeNLen[0] === 'Real') {

                            if (dimensionsSelector.getSelection()[0].value !== '') {

                                userSelectDimention = dimensionsSelector.getSelection()[0].value;

                                if (unitSelect.getSelection()[0].value !== '') {
                                    perferredUnit = unitSelect.getSelection()[0].value;
                                }
                            }
                            iDefaultValue = AttrUtilsView.getDefaultValueInput().getValue();
                        } else {
                            iDefaultValue = AttrUtilsView.getDefaultValueInput().getValue();
                        }
                        listofAddedAttrs = AttrUtilsView.getNamesListofAlreadyAddedAttributes(that.contentDiv);

                        hasAuthVals = false;

                       //IR-744403-3DEXPERIENCER2021x
                        if ((AuthValsInput.getValue() !== undefined) &&
                                (AuthValsInput.getValue() !== '')) {
                            hasAuthVals = true;
                            //Remove spaces between values.
                            authValuesStr = AuthValsInput.getValue();
                            if(authValuesStr.indexOf(",") > -1) {
                                //IR-904152-3DEXPERIENCER2022x,IR-953664-3DEXPERIENCER2022x\23x: Convert space "  " to "" to be aline with TXO
                                const authValues = authValuesStr.split(",");
                                const trimedAuthValues  = authValues.map((item) => item.trim());
                                authValuesStr = trimedAuthValues.join();
                            } //else {}
                            authValuesStr = authValuesStr.trim();
                            AuthValsInput.setValue(authValuesStr);

                        } else {
                            authValuesStr = "";
                        }


                        checkResult = AttrUtilsView.checkOptionsBeforeAddAttrs(typeNLen[0], typeNLen[1],
                            attrNameInput.getValue(), attrUserNameInput.getValue(), iDefaultValue,
                            readonlyToggle.isChecked(), mandToggle.isChecked(), multiValuatedToggle.isChecked(), hasAuthVals,
                            authValuesStr,
                            listofAddedAttrs, that.systemAttributes, true, trLine.nlsName, that.isObjectExistWithConfiguredAttribue);
                        //IR-759885-3DEXPERIENCER2021x
                        if (!(checkResult === "S_OK" ||
                            (checkResult === "AttributeNameNotAllowed" && lineAttr.cells[cellsIndex.DeployStatus].value == "NewNotDeployed"))) {
							if (checkResult === "AttributeNameNotAllowed") {
								 msg = ParamSkeletonNLS[checkResult].format(attrNameInput.getValue());
								 UWA.log("checkResult = " + msg);
								 that.userMessaging.add({ className: "error", message: msg});
							} else {
								UWA.log("checkResult = " + ParamSkeletonNLS[checkResult]);
								if (checkResult == "DefaultNotInAuthValsMsg") {
								  //IR-904152-3DEXPERIENCER2022x,IR-953664-3DEXPERIENCER2022x\23x: add more proper message.
								  that.userMessaging.add({ className: "error", message: ParamSkeletonNLS[checkResult].format(iDefaultValue)});

								} else {
									that.userMessaging.add({ className: "error", message: ParamSkeletonNLS[checkResult]});
								}
							}							
                            if ((checkResult === 'DefaultValueSizeInadequate') ||
                                    (checkResult === 'AccentsnotAllowedMsg') ||
                                      (checkResult === 'DefaultValueSizeInadequate')) {
                                AttrUtilsView.getDefaultValueInput().focus();
                            }

                        } else {
							//FUN153165 : Allow removal of authorized values
                            //Extra validation for Authorzied Values and show wanrning .
                            if ((lineAttr.cells[cellsIndex.DeployStatus].value !== "NewNotDeployed") && (checkResult === "S_OK" )) {
                                if(attriLineAuthValues !== "") {

                                    if(authValuesStr !== "") {
                                        var valueListTab = authValuesStr.split(',');
                                        var attriLineValuesLst = attriLineAuthValues.split(',');
                                        for(i = 0; i < valueListTab.length; i++ ) {
                                            for(j = 0; j < attriLineValuesLst.length; j++ ) {
                                                //IR-749706-3DEXPERIENCER2021x/20x/19x
                                                if(valueListTab[i] === "" || valueListTab[i] === " ") {
                                                    if(attriLineValuesLst[j] === "" || attriLineValuesLst[j] === " ")
                                                    {
                                                        attriLineValuesLst.splice(j, 1);
                                                    }
                                                } else {
                                                    if(valueListTab[i] === attriLineValuesLst[j]) {
                                                        attriLineValuesLst.splice(j, 1);
                                                    }
                                                }
                                            }
                                        }
                                        if(attriLineValuesLst.length > 0 ) {                                           
										   that.userMessagingLong.add({ className: "warning", message: ParamSkeletonNLS["RemovalOfExistingValNotSafe"]});                                          
                                        }
                                    }
                                }
                            }
                            selected6wTag = '';
                            selected6wTagValue = '';

                            if (sixwTagSelector.selectedItems[0] != undefined) {
                                selected6wTag = sixwTagSelector.selectedItems[0].label;
                                selected6wTagValue = sixwTagSelector.selectedItems[0].value;
                            }

                            isLineModified =  AttrUtilsView.checkAndUpdateAttributeLine(lineAttr,typesSelect.getSelection()[0].value,
                                attrUserNameInput.getValue(), iDefaultValue,
								// FUN127527 FRH Support multiline
                                mandToggle.isChecked(), readonlyToggle.isChecked(), export3DXMLToggle.isChecked(), multiValuatedToggle.isChecked(),multilineToggle.isChecked(),
                                userSelectDimention, perferredUnit,
                                indexedToggle.isChecked(),
                                AuthValsInput.getValue(),
                                selected6wTagValue,
                                revisionToggle.isChecked(), duplicateToggle.isChecked(),that.wdthArray);
                            if(isLineModified !== -1) {
                               if (lineAttr.cells[cellsIndex.DeployStatus].value !== "NewNotDeployed") {
                                    lineAttr.cells[cellsIndex.DeployStatus].empty();
                                    lineAttr.cells[cellsIndex.DeployStatus].value = "ModifiedNotDeployed";
                                    var imgSpan = ParametersLayoutViewUtilities.buildImgSpan('fonticon fonticon-pencil fonticon-1.5x', '1.5', 'orange');
                                    lineAttr.cells[cellsIndex.DeployStatus].title = ParamSkeletonNLS.ModifiedNotYetDeployed;
                                    imgSpan.inject(lineAttr.cells[cellsIndex.DeployStatus]);
                                }
                            }
                            that.editAttributesModal.hide();
                            that.editAttributesModal.destroy();
                            lineAttr.focus();
                        }

                    });

                    CancelBtn.addEvent("onClick", function (e) {
                        UWA.log(e);//that.onCancelCalled();
                        that.editAttributesModal.hide();
                        that.editAttributesModal.destroy();
                    });

                    that.editAttributesModal = new Modal({
                        className: 'add-attr-modal',
                        closable: true,
                        header  : headertitle,
                        body    : modalbodyTable,
                        footer  : [ OKBtn, CancelBtn ]
                    }).inject(that.contentDiv);

                    that.editAttributesModal.getContent().setStyle("padding-top", 10);
                    that.editAttributesModal.elements.wrapper.setStyle("width", 800);
                    that.editAttributesModal.show();

                },
                //NZV - FUN085423
				// FUN127527 FRH Support multiline
                checkAndUpdateAttributeLine : function (lineAttr, type, attributeUserName, defaultValue, isMand, isReadOnly, is3DXMLExproted,
                                        MultiValuated, Multiline,dimension, preferredUnit, isIndexed, authValues, selected6wTagValue,
                                        isRevision, isDup, wdthArray) {
                    var changeFound = -1,  cellsIndex = this.cellsIndex, defaultValuetoShow, defaultDateObj, defCellTitle="", iATpos;
                    if(lineAttr.cells[cellsIndex.AttributeUserName].value !== attributeUserName) {
                        changeFound = 1;
                        lineAttr.cells[cellsIndex.AttributeUserName].value = attributeUserName;
                        lineAttr.cells[cellsIndex.AttributeUserName].empty();
                        UWA.createElement('p', {
                            text   : attributeUserName,
                            'class': 'font-3dslight'
                        }).inject(lineAttr.cells[cellsIndex.AttributeUserName]);
                    }

                    if(lineAttr.cells[cellsIndex.DefaultValue].value !== defaultValue) {
                        defaultValuetoShow = defaultValue;
                        if (type === "Date") {
                            defaultDateObj = new Date(defaultValue);
                            defCellTitle = defaultDateObj.toDateString();
                            iATpos = defaultValue.indexOf("@");
                            if (iATpos > 0) {
                                defaultValuetoShow  = defaultValue.substring(0, iATpos);
                            }
                        }

                        changeFound = 2;
                        lineAttr.cells[cellsIndex.DefaultValue].value = defaultValue;
                        lineAttr.cells[cellsIndex.DefaultValue].empty();
                        UWA.createElement('p', {
                            text   : defaultValuetoShow,
                            'class': 'font-3dslight'
                        }).inject(lineAttr.cells[cellsIndex.DefaultValue]);
                         //lineAttr.cells[cellsIndex.DefaultValue].title = defaultValue;
                    }

                    if(lineAttr.cells[cellsIndex.Mandatory].value !== isMand) {
                        changeFound = 3;
                        AttrUtilsView.checkAndModifiedToggle(lineAttr.cells[cellsIndex.Mandatory], isMand,  wdthArray[cellsIndex.Mandatory]);
                    }
                    if(lineAttr.cells[cellsIndex.Export3DXML].value !== is3DXMLExproted) {
                        changeFound = 4;
                        AttrUtilsView.checkAndModifiedToggle(lineAttr.cells[cellsIndex.Export3DXML], is3DXMLExproted,  wdthArray[cellsIndex.Export3DXML]);

                    }
                    //FUN092576
                    if(lineAttr.cells[cellsIndex.MultiValuated].value !== MultiValuated) {
                        changeFound = 4;
                        AttrUtilsView.checkAndModifiedToggle(lineAttr.cells[cellsIndex.MultiValuated], MultiValuated,  wdthArray[cellsIndex.MultiValuated]);

                    }
					// FUN127527 FRH Support multiline
                    if(lineAttr.cells[cellsIndex.Multiline].value !== Multiline) {
                        changeFound = 4;
                        AttrUtilsView.checkAndModifiedToggle(lineAttr.cells[cellsIndex.Multiline], Multiline,  wdthArray[cellsIndex.Multiline]);

                    }
                    if(lineAttr.cells[cellsIndex.resetWhenDuplicate].value !== isDup) {
                        changeFound = 5;
                        AttrUtilsView.checkAndModifiedToggle(lineAttr.cells[cellsIndex.resetWhenDuplicate], isDup,  wdthArray[cellsIndex.resetWhenDuplicate]);

                    }

                    if(lineAttr.cells[cellsIndex.resetWhenRevision].value !== isRevision) {
                        changeFound = 6;
                        AttrUtilsView.checkAndModifiedToggle(lineAttr.cells[cellsIndex.resetWhenRevision], isRevision,  wdthArray[cellsIndex.resetWhenRevision]);
                    }

                    if(lineAttr.cells[cellsIndex.ReadOnly].value !== isReadOnly) {
                        changeFound = 7;
                        AttrUtilsView.checkAndModifiedToggle(lineAttr.cells[cellsIndex.ReadOnly], isReadOnly,  wdthArray[cellsIndex.ReadOnly]);
                    }
                    if(lineAttr.cells[cellsIndex.Indexed].value !== isIndexed) {
                        changeFound = 8;
                        AttrUtilsView.checkAndModifiedToggle(lineAttr.cells[cellsIndex.Indexed], isIndexed,  wdthArray[cellsIndex.Indexed]);
                    }

                    if(dimension !== "") {
                        if(lineAttr.cells[cellsIndex.Dimension].value !== undefined  &&  lineAttr.cells[cellsIndex.Dimension].value !== "")
                        {
                            var dimValues = lineAttr.cells[cellsIndex.Dimension].value.split(",");
                            var dimId, unitId, dimensionText ="";
                            if (dimValues.length > 1) {
                                dimId = dimValues[0];
                                unitId = dimValues[1];
                            } else {
                                dimId = dimValues[0];
                            }
                            if(unitId !== preferredUnit && dimId === dimension) {
                                changeFound = 9;
                                lineAttr.cells[cellsIndex.Dimension].empty();
                                lineAttr.cells[cellsIndex.Dimension].value = dimension+","+preferredUnit;

                                var dimPara = UWA.createElement('p', {
                                    text   : dimensionText,
                                    'class': 'font-3dslight'
                                }).inject(lineAttr.cells[cellsIndex.Dimension]);

                                /* dimensionText = */AttrUtilsView.getNLSDimensionStr(dimId, preferredUnit, dimPara);



                            }

                        }
                    }
                    // ilistofAuthValues = iLines[i].cells[cellsIndex.AuthValue].value;
                    if(lineAttr.cells[cellsIndex.AuthValue].value !== authValues && authValues !== undefined) {
                        changeFound = 10;
                        lineAttr.cells[cellsIndex.AuthValue].value = authValues;
                        lineAttr.cells[cellsIndex.AuthValue].empty();
                        UWA.createElement('p', {
                            text   : authValues,
                            'class': 'font-3dslight'
                        }).inject(lineAttr.cells[cellsIndex.AuthValue]);
                    }
                    if(lineAttr.cells[cellsIndex.SixWTag].value !== selected6wTagValue) {
                        changeFound = 11;
                        lineAttr.cells[cellsIndex.SixWTag].empty();
                        lineAttr.cells[cellsIndex.SixWTag].value = selected6wTagValue;
                        AttrUtilsView.update6WTagCellWithNLS(lineAttr.cells[cellsIndex.SixWTag], selected6wTagValue, "");
                    }

                    // if(changeFound !== -1) {
                    //     lineAttr.cells[cellsIndex.DeployStatus].empty();
                    //     lineAttr.cells[cellsIndex.DeployStatus].value = "ModifiedNotDeployed";
                    //     var imgSpan = ParametersLayoutViewUtilities.buildImgSpan('fonticon fonticon-pencil fonticon-1.5x', '1.5', 'orange');
                    //     lineAttr.cells[cellsIndex.DeployStatus].title = ParamSkeletonNLS.ModifiedNotYetDeployed;
                    //     imgSpan.inject(lineAttr.cells[cellsIndex.DeployStatus]);
                    // }

                    return changeFound;
                },

                checkAndModifiedToggle : function (cellElement, changedValue, width) {
                        cellElement.value = changedValue;
                        cellElement.empty();
                        if(changedValue === true) {
                            ParametersLayoutViewUtilities.buildImgCell('check', '1', 'green', changedValue, width + '%', 'center').inject(cellElement);
                        }
                },

                attributeLinetobeDeleted : function (iLine) {
                    var i, imgSpan,
                        cellsIndex = this.cellsIndex;

                    if (iLine.cells[cellsIndex.DeployStatus].value === "NewNotDeployed") {
                        iLine.remove();
                    } else {
                        for (i = 0; i < 3; i++) {
                            AttrUtilsView.setDeletedCellStyle(iLine.cells[i]);
                        }

                        AttrUtilsView.setDeletedCellStyle(iLine.cells[cellsIndex.AuthValue]);

                        iLine.cells[cellsIndex.SixWTag].empty();
                        iLine.cells[cellsIndex.Dimension].empty();
                        iLine.cells[cellsIndex.Action].empty();
                        //iLine.cells[9].setStyle("visibility", "hidden");//pas terrible

                        //iLine.cells[cellsIndex.DeployStatus].empty();
                       // iLine.cells[10].value = "DeletedNotDeployed";
                        iLine.cells[cellsIndex.DeployStatus].empty();
                        iLine.cells[cellsIndex.DeployStatus].value = "DeletedNotDeployed";
                        imgSpan = ParametersLayoutViewUtilities.buildImgSpan('trash', '1.5', 'red');
                        iLine.cells[cellsIndex.DeployStatus].title = ParamSkeletonNLS.DeletedButNotYetApplied; //NZV:IR-629593-3DEXPERIENCER2019x
                        imgSpan.inject(iLine.cells[cellsIndex.DeployStatus]);
                    }
                },

                removeAttribueLine : function (objToBeRemoved) {
                    objToBeRemoved.popOver.destroy();
                    AttrUtilsView.attributeLinetobeDeleted(objToBeRemoved.attrLine);
                },

                undeleteAttribute : function (iLine,that) {
                    var i, imgSpan,//editSpan, editPop, editAttributeButton,
                        deleteSpan, removeAttributeButton, removePop,
                        removelts = [],
                        cellsIndex = this.cellsIndex,attriList, deployedAttri, isLineModified = -1 ;

                    for (i = 0; i < 3; i++) {
                        AttrUtilsView.setNormalCellStyle(iLine.cells[i]);
                    }
                     AttrUtilsView.setNormalCellStyle(iLine.cells[cellsIndex.AuthValue]);
                    //that
                    attriList = that.collection._models[0]._attributes.listofAttributes;
                    deployedAttri = "";
                    for(i = 0; i < attriList.length; i++) {
                        if (attriList[i].internalName === iLine.cells[cellsIndex.AttributeName].value) {
                            deployedAttri = attriList[i];
                            break;
                        }
                    }
                    //FUN092576
					// FUN127527 FRH Support multiline
                    isLineModified =  AttrUtilsView.checkAndUpdateAttributeLine(iLine, deployedAttri.type,
                                deployedAttri.nlsName, deployedAttri.defaultValue, deployedAttri.isMandatory,
                                deployedAttri.isReadOnly, deployedAttri.isExposedTo3DXML, deployedAttri.multiValuated,deployedAttri.multiline, deployedAttri.dimension,
                                deployedAttri.preferredunit, deployedAttri.isIndexed, deployedAttri.listofAuthValues,
                                deployedAttri.sixWTag, deployedAttri.resetWhenRevision, deployedAttri.resetWhenDuplicate,
                                that.wdthArray);

                    //iLine.cells[9].setStyle("visibility", "block");

                    /*editElts = AttrUtilsView.createEditActionElements();
                    editSpan = editElts[0];
                    editSpan.inject(iLine.cells[8]);
                    editAttributeButton  = editElts[1];
                    editPop = editElts[2];*/

                    //NZV - FUN085423
                    if (iLine.cells[cellsIndex.DeployStatus].value !== "ModifiedNotDeployed") {
                        var editElts = ParametersLayoutViewUtilities.createActionElements(ParamSkeletonNLS.EditAttribute, false);
                        var editSpan = editElts[0];
                        editSpan.setStyle("float", "left");
                        editSpan.inject(iLine.cells[cellsIndex.Action]);
                        var editAttributeButton = editElts[1];
                        var editPop = editElts[2];

                        removelts = ParametersLayoutViewUtilities.createActionElements(ParamSkeletonNLS.DeleteAttributetxt, true);
                        deleteSpan = removelts[0];
                        deleteSpan.setStyle("float", "right");
                        deleteSpan.inject(iLine.cells[cellsIndex.Action]);
                        removeAttributeButton = removelts[1];
                        removePop = removelts[2];
                        // if(deployedAttri.isDeployed == true) {
                        //     iLine[i].cells[cellsIndex.DeployStatus].empty();
                        //     iLine[i].cells[cellsIndex.DeployStatus].value = "Deployed";
                        //     imgSpan = ParametersLayoutViewUtilities.buildImgSpan('check', '1.5', 'green');
                        //     iLine[i].cells[cellsIndex.DeployStatus].title = ParamSkeletonNLS.deployedParamtxt;
                        //  } else {
                        //     iLine.cells[cellsIndex.DeployStatus].empty();
                        //     iLine.cells[cellsIndex.DeployStatus].value = "StoredButNotDeployed";
                        //     imgSpan = ParametersLayoutViewUtilities.buildImgSpan('cog', '1.5', 'black');
                        // }

                       // imgSpan.inject(iLine.cells[cellsIndex.DeployStatus]);

                        removeAttributeButton.addEvent("onClick", function () {
                            /*removePop.destroy(); //removePop.remove();  //editPop.destroy();
                            AttrUtilsView.attributeLinetobeDeleted(iLine);*/
                            //AttrUtilsView.showContextualDeleteModal(widget.body, iLine, removePop);
                            var objToBeRemoved = {popOver : removePop, attrLine : iLine}; //IR-689657-3DEXPERIENCER2019x/20x : function signature changed
                            //FUN102019 21x FD03 : change message & add line break
                            ParametersLayoutViewUtilities.showContextualDeleteModal(widget.body, "delAttrModal", ParamSkeletonNLS.removeAttributesWarning + "\n"+ParamSkeletonNLS.removeAttributesWarningSec,
                                ParamSkeletonNLS.YesText,  ParamSkeletonNLS.NoText, ParamSkeletonNLS.Warning+"!", AttrUtilsView.removeAttribueLine, objToBeRemoved);
                        });

                        editAttributeButton.addEvent("onClick", function () {

                           AttrUtilsView.showEditAttributeModel(that.userMessaging,that,iLine);

                        });
                    }
                    iLine.cells[cellsIndex.DeployStatus].empty();
                    iLine.cells[cellsIndex.DeployStatus].value = "Deployed";
                    imgSpan = ParametersLayoutViewUtilities.buildImgSpan('check', '1.5', 'green');
                    iLine.cells[cellsIndex.DeployStatus].title = ParamSkeletonNLS.deployedParamtxt;
                    imgSpan.inject(iLine.cells[cellsIndex.DeployStatus]);
                },

                setDeletedCellStyle : function (iCell) {
                    var previousVal = iCell.value, showValue = previousVal,iATpos;
                    iCell.empty();
                    iATpos = previousVal.indexOf("@");
                    if (iATpos > 0) {
                        showValue  = previousVal.substring(0, iATpos);
                    }
                    UWA.createElement('del', {
                        text   : showValue,
                        value  : previousVal,//ZUR - IR-497281-3DEXPERIENCER2017x
                        'class': 'font-3dslight'
                    }).inject(iCell);
                },

                setNormalCellStyle : function (iCell) {
                    var previousVal = iCell.value, showValue = previousVal,iATpos;
                    iCell.empty();
                    iATpos = previousVal.indexOf("@");
                    if (iATpos > 0) {
                        showValue  = previousVal.substring(0, iATpos);
                    }
                    UWA.createElement('p', {
                        text   : showValue,
                        value  : previousVal,//ZUR - IR-497281-3DEXPERIENCER2017x
                        'class': 'font-3dslight'
                    }).inject(iCell);
                },

                /*createEditActionElements : function () {
                    var editPop,
                        editElts = [],
                        editSpan = UWA.createElement('span'),
                        editAttributeButton = new Button({
                            className: 'close',
                            icon: 'fonticon fonticon-pencil fonticon-1.5x',//value: 'Button', //fonticon-cancel  fonticon-minus-circled
                            attributes: {
                                disabled: false,
                                'aria-hidden' : 'true'
                                //title : 'delete attribute'
                            }
                        }).inject(editSpan);

                    editPop = new Popover({
                        //class: 'parampopover',
                        target: editSpan,//iCell,
                        trigger : "hover",
                        animate: "true",
                        position: "top",
                        body: 'Edit attribute',
                        title: ''//iParamObj.nlsKey
                    });

                    editElts.push(editSpan);
                    editElts.push(editAttributeButton);
                    editElts.push(editPop);

                    return editElts;
                },*/

                checkIfAttrNameAlreadyUsed : function (attrName, attrUserName, listofAddedAttrs, isEditMode, existingNLSName) {
                    var i;
                    for (i = 0; i < listofAddedAttrs.internalNames.length; i++) {
                        //AJY3 FUN106676 Check internalName only at creation, because it cannot be modified at edition.
                        if (!isEditMode && (attrName.replace(/ /g, "_") ===  listofAddedAttrs.internalNames[i].replace(/ /g, "_"))) {
                            return true;
                        }
                        //AJY3 FUN106676 User names can be empty but cannot be the same if valuated.
                        if (attrUserName && (attrUserName !== existingNLSName) && (attrUserName === listofAddedAttrs.userNames[i])) {
                            return true;
                        }
                        //AJY3 FUN106676 User name can be the same as the attribute internal name, but not the same as
                        //another attribute internal name.
                        if (attrUserName !== attrName && (attrUserName === listofAddedAttrs.internalNames[i]) ){
                            return true;
                        }
                    }
                    return false;
                },

                checkOptionsBeforeAddAttrs : function (attrType, attrLength, attrName, attrUserName, attrValue,
                    isReadOnly, isMandatory, isMultivalue, hasAuthValues, authValuesStr, listofAddedAttrs, allMatrixAttributesnames, isEditMode, existingNLSName, isConfigObjExist) {

                    var i,
                        valueListTab = [],
                        AdditionalSpecialChars = "-.",
						//IR-1171967-3DEXPERIENCER2024x
						AdditionalForDefaultValueSpecialChars = ".",
                        defaultInAuthorized = false;

                    if (attrName === "") {
                        UWA.log(ParamSkeletonNLS.NoAttributeName);
                        return "NoAttributeName";
                    }
                    if (!isNaN(attrName.charAt(0))) {
                        UWA.log(ParamSkeletonNLS.AttributeNameFirstCharNumber);
                        return "AttributeNameFirstCharNumber";
                    }
                    //AJY3 FUN106676 Reactivate spaces check, because internal name is now distinct from user name.
                    if (ParametersLayoutViewUtilities.containsBlanks(attrName)) {
                        return "AttributeNameContainsSpace";
                    }

                    if (ParametersLayoutViewUtilities.containsAccents(attrName)) {
                        return "AccentsnotAllowedInNameMsg";
                    }
                    //IR-759885-3DEXPERIENCER2021x
                    if (AttributesTypesDefine.isAttributeForbidden(attrName) === true) {
                        return "AttributeNameNotAllowed";
                    }
					//IR-877431-3DEXPERIENCER2021x\22x
                    // FUN130113 FRH: I remove the check that mandatory attribute must have default value
                    /*if ((isMandatory && attrValue === "") && (isMultivalue === false)) {
                        UWA.log(ParamSkeletonNLS.AttrMandMustHaveDefVal);
                        return "AttrMandMustHaveDefVal";
                    }*/

                    /* NZV : REACTIVATE for IR-540216-3DEXPERIENCER2018x */
                    if (allMatrixAttributesnames !== undefined) {
                        for (i = 0; i < allMatrixAttributesnames.length; i++) {
                            if (attrName === allMatrixAttributesnames[i]) {
                                UWA.log(ParamSkeletonNLS.DefaultPartNameMsg);
                                return "DefaultPartNameMsg";
                            }
                        }
                    }

                    if (AttrUtilsView.testStrictSpecialCharacters(attrName) || AttrUtilsView.userNameContainsSpecChars(attrUserName)) {
                        UWA.log(ParamSkeletonNLS.SpecialCharactersMsg);
                        return "SpecialCharactersMsg";
                    }

                    if (attrType !== 'Date') {
                        if (AttrUtilsView.testStrictSpecialCharacters(attrValue)) {
                            UWA.log(ParamSkeletonNLS.SpecialCharactersMsg);
                            return "SpecialCharactersMsg";
                        }
                    }

                    if (AttrUtilsView.testStrictSpecialCharacters(attrName, AdditionalSpecialChars)) {
                        UWA.log(ParamSkeletonNLS.SpecialCharactersMsg);
                        return "SpecialCharactersMsg";
                    }
					//IR-1171967-3DEXPERIENCER2024x
                    if (attrType !== 'Real' && attrType !== 'Integer' && attrType !== 'Date') {
                        if (AttrUtilsView.testStrictSpecialCharacters(attrValue, AdditionalForDefaultValueSpecialChars)) {
                            UWA.log(ParamSkeletonNLS.SpecialCharactersMsg);
                            return "SpecialCharactersMsg";
                        }
                    }
                    //IR-744403-3DEXPERIENCER2021x
                    if ((authValuesStr !== "") && (attrType !== 'Boolean')) {
                        valueListTab = authValuesStr.split(',');
                        var duplicateValueArray = valueListTab.filter((item, index) => valueListTab.indexOf(item) !== index);
                        if(duplicateValueArray.length > 0) {
                            return "DuplicateValuesInArray";
                        }
                        for (i = 0; i < valueListTab.length; i++) {
                            if (AttrUtilsView.testStrictSpecialCharacters(valueListTab[i])) {
                                UWA.log(ParamSkeletonNLS.SpecialCharactersMsgAuthVals);
                                return "SpecialCharactersMsgAuthVals";
                            }
                        }
                    }

                    if (ParametersLayoutViewUtilities.containsAccents(attrValue)) {
                        UWA.log(ParamSkeletonNLS.AccentsnotAllowedMsg);
                        return "AccentsnotAllowedMsg";
                    }

                    if ((authValuesStr !== "") && (attrType !== 'Boolean')) {
                        for (i = 0; i < valueListTab.length; i++) {
                            if (ParametersLayoutViewUtilities.containsAccents(valueListTab[i])) {
                                UWA.log(ParamSkeletonNLS.AccentsnotAllowedMsgAuthVals);
                                return "AccentsnotAllowedMsgAuthVals";
                            }
                        }
                    }

                    if ((attrType === 'String') && (attrLength !== 0)) {
                        if (attrValue.length > attrLength) {
                            UWA.log(ParamSkeletonNLS.DefaultValueSizeInadequate);
                            return "DefaultValueSizeInadequate";
                        }

                        if (authValuesStr !== "") {
                            for (i = 0; i < valueListTab.length; i++) {
                                if (valueListTab[i].length > attrLength) {
                                    UWA.log(ParamSkeletonNLS.ProposedValueSizeInadequate);
                                    return "ProposedValueSizeInadequate";
                                }
                            }
                        }
                    }

                    if (attrType === 'Real') {
                        if (!ParametersLayoutViewUtilities.isReal(attrValue)) {
                            UWA.log(ParamSkeletonNLS.DefaultValueNumeric);
                            return "DefaultValueNumeric";
                        }

                        if (authValuesStr !== "") {
                            for (i = 0; i < valueListTab.length; i++) {
                                if (!ParametersLayoutViewUtilities.isReal(valueListTab[i])) {
                                    UWA.log(ParamSkeletonNLS.AuthValsNonNumericMessage);
                                    return "AuthValsNonNumericMessage";
                                }
                            }
                        }
                    } else if (attrType === 'Integer' && attrValue.trim() !== "") {
                        if (!ParametersLayoutViewUtilities.isInteger(attrValue)) {
                            UWA.log(ParamSkeletonNLS.DefaultValueNumericForInt);
                            return "DefaultValueNumericForInt";
                        }
                        if (authValuesStr !== "") {
                            for (i = 0; i < valueListTab.length; i++) {
                                if (!ParametersLayoutViewUtilities.isInteger(valueListTab[i])) {
                                    UWA.log(ParamSkeletonNLS.AuthValsNonNumericForIntMsg);
                                    return "AuthValsNonNumericForIntMsg";
                                }
                            }
                        }
                    }

                    if (hasAuthValues && (isMultivalue !== true) && (attrType !== 'Boolean') && (isConfigObjExist === false) ) {
                        if (authValuesStr !== "") {
                                for (i = 0; i < valueListTab.length; i++) {
                                /*if (attrValue === " " || attrValue === "") {
                                        //IR-749706-3DEXPERIENCER2019x/20x/21x : treating “ “ & “” equal
                                        if (valueListTab[i] === " " || valueListTab[i] === "") {
                                            defaultInAuthorized = true;
                                            break;
                                        }
                                    } else {*/
                                    //IR-904152-3DEXPERIENCER2022x,IR-953664-3DEXPERIENCER2022x\23x: Convert space "  " to "" to be aline with TXO
                                        if (valueListTab[i] === attrValue) {
                                            defaultInAuthorized = true;
                                            break;
                                        }
                                    //}
                                }
                        }
                        if (!defaultInAuthorized) {
                            UWA.log(ParamSkeletonNLS.DefaultNotInAuthValsMsg.format(attrValue));
                            return "DefaultNotInAuthValsMsg";
                        }
                    }
                    //IR-749706-3DEXPERIENCER2021x/20x/19x
					//IR-1191227-3DEXPERIENCER2023x/24x : Commented below check. 
					//This check in not needed after delivery function FUN130113. Since empty default value allow in case of Mandatory attribute
                   /* if(hasAuthValues && isMandatory) {
                        var isAuthValContainEmpty = false;
                        if (authValuesStr !== "") {
                                for (i = 0; i < valueListTab.length; i++) {
                                    if (valueListTab[i] === " " || valueListTab[i] === "") {
                                        isAuthValContainEmpty = true;
                                        break;
                                    }

                                }
                        }
                        if (isAuthValContainEmpty) {
                            UWA.log(ParamSkeletonNLS.DefaultNotInAuthValsMsg);
                            return "MandCannotHaveEmptyAuthVal";
                        }
                    }*/
                    //NZV - FUN085423
                    if (AttrUtilsView.checkIfAttrNameAlreadyUsed(attrName, attrUserName, listofAddedAttrs, isEditMode, existingNLSName)) {
                        UWA.log(ParamSkeletonNLS.AttibutesSameName);
                        return "AttibutesSameName";
                    }
                    return "S_OK";

                    /*addAttributeRow(type, ..., sixWTagNLS, 0, false, false);
                    manageHelpAuthValues();
                    setCurrentReadOnlyStatus(defaultReadOnly);
                    setCurrentMandatoryStatus(defaultMandatory);
                    setCurrentIndexedStatus(defaultIndexed);
                    clearSixWTag();*/
                },

                buildAutoComplete : function () {
                    var sixwTagAutoSelect = new Autocomplete({
                            multiSelect: false,
                            showSuggestsOnFocus: true,
                            filterEngine: function (suggestions) {
                                return suggestions;
                            },
                            events: {//IR-673291-3DEXPERIENCER2019x\20x
                                onKeyDown: function(e) {
                                    if (e.keyCode === 13) {
                                        e.preventDefault();
                                    }
                                },
                                onKeyUp: function(e) {
                                    if (e.keyCode === 13) {
                                        sixwTagAutoSelect.showAll();
                                    }
                                },
                                onUnselect : function (item) {
                                    sixwTagAutoSelect.showAll();
                                    return item;
                                }
                            }
                        });
                    return sixwTagAutoSelect;
                },

                buildModalSkeleton : function (parentElm) {
                    var modalbodyTable, modaltbody, lineModal, errorMsg,
                        iCell, AuthValsInput, timerconn, diffDate,
                        typesSelect, attrNameInput, attrUserNameInput, iDefaultControlCell,
                        mandToggle, readonlyToggle, indexedToggle, export3DXMLToggle,// AuthValsToggle,
                        //imgInfoSpan, popoverAuth,
                        OKBtn, CancelBtn, unitsSelector, /*dimensionsSelector*/
                        currTime = new Date().getTime(),
                        lastMessageDate = currTime,
                        activateError = false,
                        col1Wdth = '50%', col2Wdth = '50%',
                        typeNLen = [], modalSkeleton = [], typeNLenDim = [],
                        that = this, duplicateToggle, revisionToggle, sixwTagAutoSelect,
                        multiValuatedToggle,multilineToggle,/* FUN127527 */ userMessaging = parentElm.userMessaging,MsgShownSpaceInAuthValue=false;

                    that.initCells();
                    modalbodyTable =  UWA.createElement('table', {
                        'id': '',
                        'class': 'table table-condensed table-hover'
                    });
                    modaltbody = UWA.createElement('tbody', {
                        'class': ''
                    }).inject(modalbodyTable);

                    lineModal = UWA.createElement('tr').inject(modaltbody);
                    iCell = AttrUtilsView.buildNLSText(ParamSkeletonNLS.AttributeTypeNLenth, col1Wdth, '');
                    iCell.inject(lineModal);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : col2Wdth
                    }).inject(lineModal);

                    typesSelect = AttrUtilsView.buildTypeSelect();
                    typesSelect.inject(iCell);

                    lineModal = UWA.createElement('tr').inject(modaltbody);
                    iCell = AttrUtilsView.buildNLSText(ParamSkeletonNLS.AttributeInternalName, col1Wdth, '');
                    iCell.inject(lineModal);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : col2Wdth
                    }).inject(lineModal);

                    attrNameInput = new Text({
                        //className: "form-control",
                        placeholder: "...",
                        id : 'attrNameInput',
                        attributes: {
                            value: '',
                            multiline: false,
                            disabled: false
                        }
                    }).inject(iCell);

                    lineModal = UWA.createElement('tr').inject(modaltbody);
                    iCell = AttrUtilsView.buildNLSText(ParamSkeletonNLS.AttributeUserName, col1Wdth, '');
                    iCell.inject(lineModal);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : col2Wdth
                    }).inject(lineModal);

                    attrUserNameInput = new Text({
                        //className: "form-control",
                        placeholder: "...",
                        id : 'attrUserNameInput',
                        attributes: {
                            value: '',
                            multiline: false,
                            disabled: false
                        }
                    }).inject(iCell);

                    lineModal = UWA.createElement('tr').inject(modaltbody);
                    iCell = AttrUtilsView.buildNLSText(ParamSkeletonNLS.AttributeDefaultValue, col1Wdth, '');
                    iCell.inject(lineModal);


                    iDefaultControlCell = UWA.createElement('td', {
                        'id'    : 'iDefaultControlCell',
                        'Align' : 'left',
                        'width' : col2Wdth
                    }).inject(lineModal);

                    this.attrDefValueInput = AttrUtilsView.buildTextDefault(userMessaging);
                    this.attrDefValueInput.inject(iDefaultControlCell);
					//conver to integer
					//FUN119390
					if (parentElm.isObjectExistWithConfiguredAttribue === true) {
						this.attrDefValueInput.disable();
					}

                     // Dimensions
                    lineModal = UWA.createElement('tr').inject(modaltbody);
                    this.dimensionToolTipCell = AttrUtilsView.buildNLSText(ParamSkeletonNLS.Dimensions, col1Wdth, ParamSkeletonNLS.DimensionsToolTip);

                    this.dimensionToolTipCell.inject(lineModal);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : col2Wdth
                    }).inject(lineModal);
                    this.dimensionsSelector = new Select({
                        nativeSelect: true,
                        placeholder: ParamSkeletonNLS.DimensionsSelect,
                        multiple: false
                    });
                    this.dimensionsSelector.disable();
                    this.dimensionsSelector.inject(iCell);
                     //End Dimensions
                    //Add unit combo..
                    lineModal = UWA.createElement('tr').inject(modaltbody);
                    iCell = AttrUtilsView.buildNLSText(ParamSkeletonNLS.PreUnits, col1Wdth, ParamSkeletonNLS.PreferredUnitToolTip);
                    iCell.inject(lineModal);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : col2Wdth
                    }).inject(lineModal);
                    unitsSelector = new Select({
                        nativeSelect: true,
                        placeholder: ParamSkeletonNLS.PreUnitsSelect,
                        multiple: false
                    });

                    unitsSelector.disable();
                    unitsSelector.inject(iCell);
                     //End Unit combo

                     // 3DXML Export
                    lineModal = UWA.createElement('tr').inject(modaltbody);
                    iCell = AttrUtilsView.buildNLSText(ParamSkeletonNLS.ExportIn3DXML, col1Wdth, ParamSkeletonNLS.ExportIn3DXMLToolTip);
                    iCell.inject(lineModal);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : col2Wdth
                    }).inject(lineModal);

                    export3DXMLToggle = new Toggle({
                        type: 'switch',//value: 'option1',
                        label: ''
                    }).uncheck().inject(iCell);
                     //3DXML Export
                     // Multi-valued - FUN092576
                    lineModal = UWA.createElement('tr').inject(modaltbody);
                    iCell = AttrUtilsView.buildNLSText(ParamSkeletonNLS.MultiValuated, col1Wdth, ParamSkeletonNLS.MultiValuatedToolTip);
                    iCell.inject(lineModal);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : col2Wdth
                    }).inject(lineModal);

                    multiValuatedToggle = new Toggle({
                        type: 'switch',//value: 'option1',
                        label: ''
                    }).uncheck().inject(iCell);

                    //FUN099488
                    multiValuatedToggle.enable();
                    //End Multi-valued
                     // Multi-line - FUN127527
                     lineModal = UWA.createElement('tr').inject(modaltbody);
                     iCell = AttrUtilsView.buildNLSText(ParamSkeletonNLS.Multiline, col1Wdth, ParamSkeletonNLS.MultilineToolTip);
                     iCell.inject(lineModal);

                     iCell = UWA.createElement('td', {
                         'Align' : 'left',
                         'width' : col2Wdth
                     }).inject(lineModal);

                     multilineToggle = new Toggle({
                         type: 'switch',//value: 'option1',
                         label: ''
                     }).uncheck().inject(iCell);

                     multilineToggle.enable();
                     //End Multi-valued

                    //Duplicate/Clone
                    lineModal = UWA.createElement('tr').inject(modaltbody);
                    iCell = AttrUtilsView.buildNLSText(ParamSkeletonNLS.ResetOnDuplicate, col1Wdth, ParamSkeletonNLS.ResetOnDuplicateToolTip);
                    iCell.inject(lineModal);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : col2Wdth
                    }).inject(lineModal);

                    duplicateToggle = new Toggle({
                        type: 'switch',//value: 'option1',
                        label: ''
                    }).uncheck().inject(iCell);
                    //End duplicate
                     //Revision
                    lineModal = UWA.createElement('tr').inject(modaltbody);
                    iCell = AttrUtilsView.buildNLSText(ParamSkeletonNLS.ResetOnRevision, col1Wdth, ParamSkeletonNLS.ResetOnRevisionToolTip);
                    iCell.inject(lineModal);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : col2Wdth
                    }).inject(lineModal);

                    revisionToggle = new Toggle({
                        type: 'switch',//value: 'option1',
                        label: ''
                    }).uncheck().inject(iCell);
                    //End - Revision
                    lineModal = UWA.createElement('tr').inject(modaltbody);
                    iCell = AttrUtilsView.buildNLSText(ParamSkeletonNLS.MandatoryAttributeTitle, col1Wdth, '');
                    iCell.inject(lineModal);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : col2Wdth
                    }).inject(lineModal);

                    mandToggle = new Toggle({
                        type: 'switch',//value: 'option1',
                        label: ''
                    }).uncheck().inject(iCell);

	    			//FUN119390
                    // FRH: FUN130113: removing the fcat to disable mandatory attribute when object existed
					//if (parentElm.isObjectExistWithConfiguredAttribue === true) {
					//	mandToggle.disable();
					//}

                    lineModal = UWA.createElement('tr').inject(modaltbody);
                    iCell = AttrUtilsView.buildNLSText(ParamSkeletonNLS.ReadOnlyAttributeTitle, col1Wdth, ParamSkeletonNLS.ReadOnlyAttrTooltip);
                    iCell.inject(lineModal);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : col2Wdth
                    }).inject(lineModal);

                    readonlyToggle = new Toggle({
                        type: 'switch',
                        label: ''
                    }).uncheck().inject(iCell);

                    lineModal = UWA.createElement('tr').inject(modaltbody);
                    iCell = AttrUtilsView.buildNLSText(ParamSkeletonNLS.IndexedAttributeTitle, col1Wdth, ParamSkeletonNLS.AttributeIndexedTooltip);
                    iCell.inject(lineModal);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : col2Wdth
                    }).inject(lineModal);

                    indexedToggle = new Toggle({
                        type: 'switch',
                        label: ''
                    }).check().inject(iCell);

                    lineModal = UWA.createElement('tr').inject(modaltbody);
                    lineModal.inject(modaltbody);
                    iCell = AttrUtilsView.buildNLSText(ParamSkeletonNLS.AuthorizedValsTitle, col1Wdth, ParamSkeletonNLS.AuthorizedValuesTooltip+"<br>"+ParamSkeletonNLS.SpaceNotSupportedInNative+"<br><br>"+"<b>Important:</b><br>"+ParamSkeletonNLS.RemovalOfAuthValuesWaring);
                    iCell.inject(lineModal);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : col2Wdth
                    }).inject(lineModal);

                    AuthValsInput = new Text({
                        //className: "form-control",
                        placeholder: "...",
                        id : 'AuthValsInput',
                        disabled: false,
                        attributes: {
                            value: '',
                            multiline: false
                        }
                    }).inject(iCell);

                    lineModal = UWA.createElement('tr').inject(modaltbody);
                    iCell = AttrUtilsView.buildNLSText(ParamSkeletonNLS.Select6WPredicateTxt, col1Wdth, '');
                    iCell.inject(lineModal);

                    iCell = UWA.createElement('td', {
                        'Align' : 'left',
                        'width' : col2Wdth
                    }).inject(lineModal);

                    sixwTagAutoSelect = this.buildAutoComplete().inject(iCell);

                    this.fetchAndPopulate6WPredicates(sixwTagAutoSelect, 'String');

                    OKBtn = new Button({
                        value : ParamSkeletonNLS.OKButton,
                        id    : "modalOKButton",
                        className : 'btn primary'
                    });

                    CancelBtn = new Button({
                        value : ParamSkeletonNLS.CancelButton,
                        id    : 'modalCancelButton',
                        className : 'btn default'
                    });
					//IR-831003-3DEXPERIENCER2021x/22x
                    AuthValsInput.addEvent("onKeyDown", function () {
                        if (timerconn) { clearTimeout(timerconn); }
                        timerconn = setTimeout(function() {
							var authValuesStr = AuthValsInput.getValue(), i;
							activateError = false;
							var valueListTab = authValuesStr.split(',');
							for (i = 0; i < valueListTab.length; i++) {
								var tempStr = valueListTab[i];
								tempStr = tempStr.trim();
								if(tempStr.length > 0 && tempStr.includes(" ")) {
									 activateError = true;
									break;
								}
							}
							if (activateError === true) {
									currTime = new Date().getTime();
									diffDate = currTime - lastMessageDate;
									if (diffDate > 1500) {
										if(MsgShownSpaceInAuthValue === false) {
										userMessaging.add({ className: "info", message: ParamSkeletonNLS.SpaceNotSupportedInNative});
										lastMessageDate = new Date().getTime();}
										MsgShownSpaceInAuthValue = true;
									}
									AuthValsInput.focus();
								} else {
									MsgShownSpaceInAuthValue=false;
								}

                        }, 20);
                    });
                    attrNameInput.addEvent("onKeyDown", function () {
                        if (timerconn) { clearTimeout(timerconn); }
                        timerconn = setTimeout(function() {
                            activateError = false;
                            if (AttrUtilsView.testStrictSpecialCharacters(attrNameInput.getValue())) {
                                activateError = true;
                                errorMsg = ParamSkeletonNLS.SpecialCharactersMsg;
                            } else if (ParametersLayoutViewUtilities.containsAccents(attrNameInput.getValue())) {
                                activateError = true;
                                errorMsg = ParamSkeletonNLS.AccentsnotAllowedInNameMsg;
                            }
                            //AJY3 FUN106676 Reactivate spaces check, because internal name is now distinct from user name.
                            else if (ParametersLayoutViewUtilities.containsBlanks(attrNameInput.getValue())) {
                                activateError = true;
                                errorMsg = ParamSkeletonNLS.AttributeNameContainsSpace;
                            }

                            if (activateError === true) {
                                currTime = new Date().getTime();
                                diffDate = currTime - lastMessageDate;
                                if (diffDate > 1500) {
                                    userMessaging.add({ className: "error", message: errorMsg});
                                    lastMessageDate = new Date().getTime();
                                }
                                attrNameInput.elements.input.setStyle('color', 'red');
                                attrNameInput.focus();
                            } else {
                                attrNameInput.elements.input.setStyle('color', '#555555');
                            }
                        }, 20);
                    });

                    attrUserNameInput.addEvent("onKeyDown", function () {
                        if (timerconn) { clearTimeout(timerconn); }
                        timerconn = setTimeout(function() {
                            activateError = false;
                            if (AttrUtilsView.userNameContainsSpecChars(attrUserNameInput.getValue())) {
                                activateError = true;
                                errorMsg = ParamSkeletonNLS.SpecialCharactersMsg;
                            }
                            if (activateError === true) {
                                currTime = new Date().getTime();
                                diffDate = currTime - lastMessageDate;
                                if (diffDate > 1500) {
                                    userMessaging.add({ className: "error", message: errorMsg});
                                    lastMessageDate = new Date().getTime();
                                }
                                attrUserNameInput.elements.input.setStyle('color', 'red');
                                attrUserNameInput.focus();
                            } else {
                                attrUserNameInput.elements.input.setStyle('color', '#555555');
                            }
                        }, 20);
                    });

                    this.dimensionsSelector.addEvent("onChange", function () {
                        typeNLenDim = AttrUtilsView.getSelectedTypeAndLength(typesSelect.getSelection()[0].value);
                        if (typeNLenDim[0] === 'Real' && this.getValue()[0] !== "") {
                            AuthValsInput.disable();//ZUR - IR-558248-3DEXPERIENCER2018x
                            AuthValsInput.setValue('');
                        } else if (typeNLenDim[0] === 'Real' && this.getValue()[0] === "") {
                            AuthValsInput.enable();//ZUR - IR-558248-3DEXPERIENCER2018x
                            AuthValsInput.setValue('');
                        }
                        AttrUtilsView.buildPreUnitsSelect(this, unitsSelector);
                    });
                    //FUN092576
                    //IR-750288-3DEXPERIENCER2021x
                    multiValuatedToggle.addEvent("onChange", function () {
                              typeNLen = AttrUtilsView.getSelectedTypeAndLength(typesSelect.getSelection()[0].value);
							  if( this.isChecked() === true) {
										//IR-1312610-3DEXPERIENCER2024x/25x
									if (typeNLen[0] === 'Boolean') {
										that.attrDefValueInput = AttrUtilsView.buildBooleanDefaultwithSpaceValue();										
										that.attrDefValueInput.setValue("");
										that.attrDefValueInput.disable();	
										let oldCombobox = iDefaultControlCell.getChildren()[0]; iDefaultControlCell.removeChild(oldCombobox);
										//add new combox with space value.
										that.attrDefValueInput.inject(iDefaultControlCell);										
									} else if ((typeNLen[0] === 'String') || (typeNLen[0] === 'Integer')) {
                                        that.attrDefValueInput.setValue("");
										 that.attrDefValueInput.disable();

									} else if (typeNLen[0] === 'Date') {
										//that.attrDefValueInput = AttrUtilsView.buildDateDefault();
                                       // that.attrDefValueInput.setValue("");
                                        that.attrDefValueInput.dateInput.setValue("");
                                        that.attrDefValueInput.dateInput.disable()
                                        that.attrDefValueInput.dateCheckbox.disable();

									} else if (typeNLen[0] === 'Real') {
                                        that.attrDefValueInput.setValue("");
										that.attrDefValueInput.disable();
									  }
							  }
							 else {//FUN119390
									if (parentElm.isObjectExistWithConfiguredAttribue === false) {
										if (typeNLen[0] === 'Date') {
											that.attrDefValueInput.dateInput.enable();
											that.attrDefValueInput.dateInput.setDate(new Date());
											that.attrDefValueInput.dateCheckbox.enable();
											//that.attrDefValueInput.dateInput.isDisabled()
										} if (typeNLen[0] === 'Boolean') { //IR-1312610-3DEXPERIENCER2024x/25x
											that.attrDefValueInput = AttrUtilsView.buildBooleanDefault();
											that.attrDefValueInput.enable();	
											let oldCombobox = iDefaultControlCell.getChildren()[0]; iDefaultControlCell.removeChild(oldCombobox);
											that.attrDefValueInput.inject(iDefaultControlCell);	
										}  
										else {
											that.attrDefValueInput.enable();
										}
									}

								}
							}
                        );
                    typesSelect.addEvent("onChange", function () {
                        typeNLen = AttrUtilsView.getSelectedTypeAndLength(this.getSelection()[0].value);
                        //AttrUtilsView.FilterPredicatesListbyType(typeNLen[0], AttrUtilsView.processed6WList, sixwTagSelector);//IR-514503-3DEXPERIENCER2017x/18x
                        AttrUtilsView.fetchAndPopulate6WPredicates(sixwTagAutoSelect, typeNLen[0]);
                        iDefaultControlCell.childNodes[0].destroy();

                        // FUN127527 multiline should be activated only for strings
                        var deactivateMultiline = true;

						//IR-750288-3DEXPERIENCER2021x
                        if (multiValuatedToggle.isDisabled() === false) {
                            if(multiValuatedToggle.isChecked() === true) {
                                multiValuatedToggle.setCheck(false);
                            }
                        }
                        if (typeNLen[0] === 'Boolean') {                            
							//FUN119390 //IR-1312610-3DEXPERIENCER2024x/25x
							if ( (parentElm.isObjectExistWithConfiguredAttribue === true) || (parentElm.multiValuated != undefined && parentElm.multiValuated === true)){
								//IR-1071270-3DEXPERIENCER2023x
								that.attrDefValueInput = AttrUtilsView.buildBooleanDefaultwithSpaceValue();
								that.attrDefValueInput.setValue("");
								that.attrDefValueInput.disable();
							} else {
								that.attrDefValueInput = AttrUtilsView.buildBooleanDefault();
							}
                            AuthValsInput.disable();
                            AuthValsInput.setValue(ParamSkeletonNLS.TrueLabel + ',' + ParamSkeletonNLS.FalseLabel);
                            that.dimensionsSelector.clear();
                            that.dimensionsSelector.disable();
                            AttrUtilsView.buildToolTipForDimension(AttrUtilsView.dimensionToolTipCell, ParamSkeletonNLS.DimensionsToolTip, "black");
                            unitsSelector.clear();
                            unitsSelector.disable();
                        } else if ((typeNLen[0] === 'String') || (typeNLen[0] === 'Integer')) {
                            that.attrDefValueInput = AttrUtilsView.buildTextDefault(userMessaging);
							//FUN119390
							if (parentElm.isObjectExistWithConfiguredAttribue === true){
								that.attrDefValueInput.setValue("");
								that.attrDefValueInput.disable();
							}
                            AuthValsInput.enable();
                            AuthValsInput.setValue('');
                            that.dimensionsSelector.clear();
                            that.dimensionsSelector.disable();
                            AttrUtilsView.buildToolTipForDimension(AttrUtilsView.dimensionToolTipCell, ParamSkeletonNLS.DimensionsToolTip, "black");
                            unitsSelector.clear();
                            unitsSelector.disable();
                            // FUN127527 multiline should be activated only for strings
                            if (typeNLen[0] === 'String') {
                                deactivateMultiline = false;
                            }

                        } else if (typeNLen[0] === 'Date') {
                            that.attrDefValueInput = AttrUtilsView.buildDateDefault();
							//FUN119390
							if (parentElm.isObjectExistWithConfiguredAttribue === true){

								that.attrDefValueInput.dateInput.setValue("");
								//IR-995980-3DEXPERIENCER2023x: to make same behaviour
								that.attrDefValueInput.dateCheckbox.setCheck(true);
								that.attrDefValueInput.dateInput.disable()
								that.attrDefValueInput.dateCheckbox.disable();
							}
                            AuthValsInput.disable();
                            AuthValsInput.setValue('');
                            that.dimensionsSelector.clear();
                            that.dimensionsSelector.disable();
                            AttrUtilsView.buildToolTipForDimension(AttrUtilsView.dimensionToolTipCell, ParamSkeletonNLS.DimensionsToolTip, "black");
                            unitsSelector.clear();
                            unitsSelector.disable();
                        } else if (typeNLen[0] === 'Real') {
                            that.attrDefValueInput = AttrUtilsView.buildTextDefault(userMessaging);
							//FUN119390
							if (parentElm.isObjectExistWithConfiguredAttribue === true){
								that.attrDefValueInput.setValue("");
								that.attrDefValueInput.disable();
							}
                            AuthValsInput.enable();
                            AuthValsInput.setValue('');
                            AttrUtilsView.buildDimensionsSelect(that.dimensionsSelector);
                        }
                        that.attrDefValueInput.inject(iDefaultControlCell);

                        // FUN127527 multiline should be activated only for strings
                        if (deactivateMultiline) {
                            if (multilineToggle.isDisabled() === false) {
                                multilineToggle.disable();
                                multilineToggle.setCheck(false);
                            }
                        } else if (multilineToggle.isDisabled() === true) {
                            multilineToggle.enable();
                            multilineToggle.setCheck(false);
                        }
                    });

                    indexedToggle.addEvent("onChange", function () {
                        if (this.isChecked()) {
                            sixwTagAutoSelect.enable();
                        } else {
                            if (sixwTagAutoSelect.selectedItems[0] !== undefined) {
                                sixwTagAutoSelect.onUnselect(sixwTagAutoSelect.selectedItems[0]);
                            }
                            //sixwTagAutoSelect.clear();
                            sixwTagAutoSelect.disable();
                        }
                    });
                    //AttrUtilsView.FilterPredicatesListbyType('String', this.processed6WList, sixwTagSelector);//IR-514503-3DEXPERIENCER2017x/18x


                    modalSkeleton.push({id: 'typesSelect', obj: typesSelect });
                    modalSkeleton.push({id: 'attrNameInput', obj: attrNameInput });
                    modalSkeleton.push({id: 'attrUserNameInput', obj: attrUserNameInput });
                    modalSkeleton.push({id: 'dimensionsSelect', obj: AttrUtilsView.dimensionsSelector });
                    modalSkeleton.push({id: 'unitSelect', obj: unitsSelector });
                    modalSkeleton.push({id: 'export3DXMLToggle', obj: export3DXMLToggle });
                    modalSkeleton.push({id: 'multiValuatedToggle', obj: multiValuatedToggle }); //FUN092576
                    modalSkeleton.push({id: 'multilineToggle', obj: multilineToggle }); //FUN127527
                    modalSkeleton.push({id: 'mandToggle', obj: mandToggle });
                    modalSkeleton.push({id: 'revisionToggle', obj: revisionToggle });
                    modalSkeleton.push({id: 'duplicateToggle', obj: duplicateToggle });
                    modalSkeleton.push({id: 'readonlyToggle', obj: readonlyToggle });
                    modalSkeleton.push({id: 'indexedToggle', obj: indexedToggle });
                    modalSkeleton.push({id: 'AuthValsInput', obj: AuthValsInput });
                    modalSkeleton.push({id: 'sixwTagAutoSelect', obj: sixwTagAutoSelect });
                    modalSkeleton.push({id: 'modalbodyTable', obj: modalbodyTable });
                    modalSkeleton.push({id: 'OKBtn', obj: OKBtn });
                    modalSkeleton.push({id: 'CancelBtn', obj: CancelBtn });
                    modalSkeleton.push({id: 'attrDefValueInput', obj: this.attrDefValueInput });

                    return modalSkeleton;
                },

                getInputFromSkeleton : function (modalSkeleton, inputID) {
                    var i;
                    for (i = 0; i < modalSkeleton.length; i++) {
                        if (modalSkeleton[i].id === inputID) {
                            return modalSkeleton[i].obj;
                        }
                    }
                },

                getSelectedTypeAndLength : function (selectedVal) {
                    var outArray = [],
                        iStringIndex = selectedVal.indexOf('String');
                        //selectedVal = currentSelectedOption[0].value,

                    if (iStringIndex >= 0) {
                        outArray.push('String');

                        if (selectedVal === 'String') {
                            outArray.push(0);
                        } else {
                            outArray.push(parseInt(selectedVal.substring(6), 10));//10 : radix parameter
                        }
                    } else {
                        outArray.push(selectedVal);
                        outArray.push(0);
                    }
                    return outArray;
                },

                getCurrentAttributesList : function(iContentDiv) {
                    var typeNLenArr, i, ilistofAuthValues,
                        tbodyreflist = iContentDiv.getElements('.attrstbody'),
                        iLines = tbodyreflist[0].childNodes,
                        nbofLines = iLines.length,
                        ilistofAttributes = [], dimValues = [], dimId = "", unitId = "",
                        ihasAuthValues = false,
                        cellsIndex = this.cellsIndex;

                    for (i = 1; i < nbofLines; i++) {

                        if (iLines[i].cells[cellsIndex.DeployStatus].value !== "DeletedNotDeployed") {

                            typeNLenArr = AttrUtilsView.getSelectedTypeAndLength(iLines[i].cells[cellsIndex.TypeName].value);

                            ihasAuthValues = false;
                            ilistofAuthValues = '';
                            if ((iLines[i].cells[cellsIndex.AuthValue].value !== '') &&
                                    (iLines[i].cells[cellsIndex.AuthValue].value !== undefined)) {
                                ihasAuthValues = true;
                                ilistofAuthValues = iLines[i].cells[cellsIndex.AuthValue].value;
                            }
                            if ((iLines[i].cells[cellsIndex.Dimension].value !== '') &&
                                    (iLines[i].cells[cellsIndex.Dimension].value !== undefined)) {
                                dimValues = iLines[i].cells[cellsIndex.Dimension].value.split(",");
                                if (dimValues.length > 1) {
                                    dimId = dimValues[0];
                                    unitId = dimValues[1];
                                } else {
                                    dimId = dimValues[0];
                                }
                            }
                            ilistofAttributes.push({
                                //id Not Needed
                                nlsName          : iLines[i].cells[cellsIndex.AttributeUserName].value,
								internalName	 : iLines[i].cells[cellsIndex.AttributeName].value, //IR-820267-3DEXPERIENCER2021x
                                type             : typeNLenArr[0],
                                maxLength        : typeNLenArr[1],
                                defaultValue     : iLines[i].cells[cellsIndex.DefaultValue].value,
                                isMandatory      : iLines[i].cells[cellsIndex.Mandatory].value,
                                isExposedTo3DXML : iLines[i].cells[cellsIndex.Export3DXML].value,
                                multiValuated    : iLines[i].cells[cellsIndex.MultiValuated].value, //FUN092576
                                resetWhenDuplicate : iLines[i].cells[cellsIndex.resetWhenDuplicate].value,
                                resetWhenRevision : iLines[i].cells[cellsIndex.resetWhenRevision].value,
                                isReadOnly       : iLines[i].cells[cellsIndex.ReadOnly].value,
                                isIndexed        : iLines[i].cells[cellsIndex.Indexed].value,
                                hasAuthValues    : ihasAuthValues,
                                listofAuthValues : ilistofAuthValues,
                                SixWTag          : iLines[i].cells[cellsIndex.SixWTag].value,
                                dimension        : dimId,
                                preferredunit    : unitId,
                                multiline        : iLines[i].cells[cellsIndex.Multiline].value, //FUN127527

                            });
                        }
                    }
                    return ilistofAttributes;
                },

                getNamesListofAlreadyAddedAttributes : function (contentDiv) {
                    var i,
                        tbodyreflist = contentDiv.getElements('.attrstbody'),
                        iLines = tbodyreflist[0].childNodes,
                        listofInternalNames = [], listofUserNames = [];

                    for (i = 1; i < iLines.length; i++) {
                        listofInternalNames.push(iLines[i].cells[this.cellsIndex.AttributeName].childNodes[0].value);
                        listofUserNames.push(iLines[i].cells[this.cellsIndex.AttributeUserName].childNodes[0].value);
                    }

                    return {internalNames : listofInternalNames, userNames : listofUserNames};
                },

                getMatching6wtagNLS : function (isixWID, itagslist) {
                    var i, predicatesList, propt;
                    for (propt in itagslist) {
                        if (itagslist[propt].properties.length > 0) {
                            predicatesList = itagslist[propt].properties;
                            if (predicatesList !== undefined && predicatesList.length > 0) {
                                for (i = 0; i < predicatesList.length; i++) {
                                    if (predicatesList[i].curi ===  isixWID) {
                                        return predicatesList[i].label;
                                    }
                                }
                            }
                        }
                    }
                    UWA.log("getMatching6wtagNLS::Warning, no matching has been found, returning the ID");
                    return isixWID;
                },

                getCATIACompatibleDateFromISOString : function(iISOString) {
                    //2017-01-16T18:32:22.382Z to 2017/01/24@11:00:00:GMT
                    var CATIADate, tPlace = 0;

                    iISOString = iISOString.replace('-', '/');
                    iISOString = iISOString.replace('-', '/');

                    tPlace = iISOString.indexOf('T');
					//IR-1024188-3DEXPERIENCER2023x : remove hardcoded time instead setting current time.
					let d = new Date();
					// SDM-2024/08/30: IR-1178782-3DEXPERIENCER2024x
					// let currentTime = "@"+ d.getUTCHours()+":"+d.getUTCMinutes()+":"+d.getUTCSeconds()+ ":GMT";
					var hour = d.getUTCHours();
                    var min = d.getUTCMinutes();
                    var sec = d.getUTCSeconds();
                    if (min < 10) min = "0"+min;
                    if (sec < 10) sec = "0"+sec;
                    let currentTime = "@"+ hour+":"+min+":"+sec+":GMT";
                    CATIADate = iISOString.substring(0, tPlace) + currentTime;//"@11:00:00:GMT";
                    return CATIADate;
                },

                //IR-514503-3DEXPERIENCER2017x/18x
                FilterPredicatesListbyType : function (attrType, listofsixWTags, sixwTagSelector) {
                    var dataItems, newObject, predicatesList, propt;
                    dataItems = {name : "Avaliable_ds6w_tag", items: []};
                    sixwTagSelector.removeDataset(dataItems.name);
                    for (propt in listofsixWTags) {

                        if (listofsixWTags[propt].properties.length > 0) {
                            newObject = {'label' : listofsixWTags[propt].label, 'items': []};
                            predicatesList = listofsixWTags[propt].properties;

                            if (predicatesList !== undefined && predicatesList.length > 0) {
                                predicatesList.forEach(function (item) {
                                    if (AttrUtilsView.PredicateDataTypeAttributeMatch(item.dataType, attrType) === true) {
                                        newObject.items.push({
                                            value : item.curi,
                                            label : item.label
                                        });
                                    }
                                });

                                if (newObject.items.length > 0) {
                                    //sorting
                                    newObject.items.sort(function (tagOne, tagTwo) {
                                        if (tagOne.label !== undefined && tagTwo.label !== undefined) {
                                            return tagOne.label.localeCompare(tagTwo.label);
                                        }
                                        return false;
                                    });
                                    dataItems.items.push(newObject);
                                }
                            }
                        }
                    }
                    sixwTagSelector.addDataset(dataItems);
                },
                //IR-514503-3DEXPERIENCER2017x/18x
                PredicateDataTypeAttributeMatch : function (iDataType, iAttributeType) {
                    if (iDataType.toUpperCase().indexOf(iAttributeType.toUpperCase()) >= 0) {
                        return true;//string/String(s), integer/Interger, boolean/Boolean, dateTime/Date
                    }
                   // if ((iDataType === "double") && (iAttributeType === "Real"))
                    if ((iDataType.toUpperCase().indexOf("DOUBLE") >= 0) && (iAttributeType === "Real")) {
                        return true;
                    }
                    return false;
                },

                /*testStrictSpecialCharacters : function (attrName) {
                    var regS = /^[0-9a-zA-Z\s_]+$/; //A to Z , 0 to 9, underscores and spaces
                    //var regM = "[A-Za-z0-9_][A-Za-z0-9_\\ -:/]+";
                    if (!regS.test(attrName)) {
                        return true;
                    }
                    return false;
                },

                testStrictSpecialCharacters : function(strtoTest) {
                    return (/^[\w\-\.\s]+$/).test(strtoTest);
                },*/

                userNameContainsSpecChars : function(strtoTest){
                    return strtoTest.indexOf('=') > -1;
                },

                testStrictSpecialCharacters : function(strtoTest, iAdditionalSpecialChars) {
                    var i, firsttest;

                    if (strtoTest === "") {
                        return false;
                    }

                    firsttest = (/^[\w\-\.\s]+$/).test(strtoTest);

                    if (typeof iAdditionalSpecialChars === 'undefined') {
                        return !firsttest;
                    }

                    if (firsttest === true) {
                        for (i = 0; i < strtoTest.length; i++) {
                            if (iAdditionalSpecialChars.indexOf(strtoTest.charAt(i)) !== -1) {
                                return true;
                            }
                        }
                    }
                    return !firsttest;
                },

                UpdateAttributesStsInTable : function(iContentDiv) {
                    var imgSpan,
                        tbodyreflist = iContentDiv.getElements('.attrstbody'),
                        iLines = tbodyreflist[0].childNodes,
                        nbofLines = iLines.length,
                        i = nbofLines - 1,
                        cellsIndex = this.cellsIndex;
                    while (i >= 1) {
                        if (iLines[i].cells[cellsIndex.DeployStatus].value === "DeletedNotDeployed") {
                            iLines[i].remove();
                        } else if (iLines[i].cells[cellsIndex.DeployStatus].value === "NewNotDeployed" || iLines[i].cells[cellsIndex.DeployStatus].value === "ModifiedNotDeployed"
                                || iLines[i].cells[cellsIndex.DeployStatus].value === "StoredButNotDeployed") { //IR-666051-3DEXPERIENCER2018x/19x/20x
                            iLines[i].cells[cellsIndex.DeployStatus].empty();
                            iLines[i].cells[cellsIndex.DeployStatus].value = "Deployed";
                            imgSpan = ParametersLayoutViewUtilities.buildImgSpan('check', '1.5', 'green');
                            iLines[i].cells[cellsIndex.DeployStatus].title = ParamSkeletonNLS.deployedParamtxt;
                            imgSpan.inject(iLines[i].cells[cellsIndex.DeployStatus]);
                        }
                        i--;
                    }
                }

            };

        return AttrUtilsView;
    });



define(
    'DS/ParameterizationSkeleton/Utils/ParameterizationDEL3DOperationsViewer/ParameterizationDEL3DOperationsViewerWebServices',
    [
        'UWA/Core',
        'UWA/Class',
        'DS/WAFData/WAFData',
        'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
    ],
    function(UWA, Class, WAFData, URLHandler) {

        'use strict';

        var ParameterizationDEL3DOperationsViewerWebServices = Class.singleton({
            getAttributesList : function (types, callback) {

                var url = URLHandler.getURL() + "/resources/delmia/mfgparam/configuration/getlistofAttributes";
                var datatoSend = {
                    types : types
                };

                WAFData.authenticatedRequest(url, {
                    timeout: 100000,
                    method: 'POST',
                    data: JSON.stringify(datatoSend),
                    type: 'json',
                    headers: {
                        'Content-Type' : 'application/json',
                        'Accept' : 'application/json'
                    },

                    onFailure : function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function(json) {
                      callback.onSuccess(json);
                    }
                });
            },

            /*
            * getNLSValues
            */
            getNLSValues: function (types,attributes, callback) {

                var url = URLHandler.getURL() + "/resources/delmia/mfgparam/configuration/getNLSValuesForTypesAndAttributes";
                var datatoSend = {
                    types: types,
                    attributes: attributes
                };

                var defaultLanguage = 'en';
                var lang = UWA.is(widget) ? (UWA.is(widget.lang, 'string') ? widget.lang : defaultLanguage) : defaultLanguage;

                WAFData.authenticatedRequest(url, {
                    timeout: 100000,
                    method: 'POST',
                    data: JSON.stringify(datatoSend),
                    type: 'json',
                    headers: {
                        'Accept-Language': lang,
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },

                    onFailure: function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function (json) {
                        callback.onSuccess(json);
                    }
                });
            },

        });
        return ParameterizationDEL3DOperationsViewerWebServices;
    }
);

/* Functions in CustomTableUtil:
 * 1. createTableDiv
 * 2. createTable
 * 3. createTableBody
 * 4. createTableHeader
 * 5. createTableRow
 * 6. createAddNewTableButton
 * 7. createLineEditor
 * 8. insertInputRow
 * 9. populateTreeDocument
 */

define("DS/ParameterizationSkeleton/Utils/ParameterizationXCAD/CustomTableUtil", [
  "UWA/Core",
  "DS/Controls/Button",
  "DS/Controls/LineEditor",
  "DS/Controls/SelectionChips",
  "DS/Controls/SelectionChipsEditor",
  "DS/Controls/ComboBox",
  "DS/Controls/Label",
  "DS/Utilities/WebUXColorEnums",
  "DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler",
  "DS/ParameterizationSkeleton/Utils/ParameterizationXCAD/AJAXUtil",
  "DS/TreeModel/TreeDocument",
  "DS/TreeModel/TreeNodeModel",
  "i18n!DS/ParameterizationSkeleton/assets/nls/XCADMappingNLS"
], function (
  UWA,
  WUXButton,
  WUXLineEditor,
  WUXSelectionChips,
  SelectionChipsEditor,
  WUXComboBox,
  WUXLabel,
  WebUXColorEnums,
  URLHandler,
  AJAXUtil,
  TreeDocument,
  TreeNodeModel,
  XCADMappingNLS
) {
  "use strict";

  var customTableUtil = {
    createTableDiv: function () {
      const tableDiv = UWA.createElement("div", {});
      return tableDiv;
    },

    createTable: function () {
      const table = UWA.createElement("table", {
        class: "table table-hover"
      });

      return table;
    },

    createTableBody: function () {
      const tableBody = UWA.createElement("tbody", {
        class: "fparamtbody"
      });

      return tableBody;
    },

    createTableHeader: function (columnNames, deleteCell, mandColIndex) {
      const headerRow = UWA.createElement("tr", {
        class: "success"
      });

      // Iterate through the column names to create each header cell dynamically
      columnNames.forEach(function (name, index) {
        const cell = UWA.createElement("td", {
          align: "left"
        }).inject(headerRow);

        let displayText = name;
        const titleText = UWA.createElement("h5", {
          text: displayText
        }).inject(cell);

        if (mandColIndex && mandColIndex.includes(index)) {
          const asteriskSpan = UWA.createElement("span", {
            text: " *",
            styles: {
              color: "red"
            }
          });
          titleText.appendChild(asteriskSpan);
        }
      });

      if (deleteCell) {
        UWA.createElement("td", {}).inject(headerRow);
      }

      return headerRow;
    },

    createTableRow: function () {
      const Row = UWA.createElement("tr", {});

      return Row;
    },

    createAddNewTableButton: function () {
      const addCustomTableButton = new WUXButton({
        displayStyle: "normal",
        emphasize: "primary",
        icon: {
          iconName: "plus",
          fontIconFamily: WUXManagedFontIcons.Font3DS
        },
        showLabelFlag: false
      });

      return addCustomTableButton;
    },

    createLineEditor: function (
      placeholder,
      reqFlag,
      xpattern = "^(?=.*[a-zA-Z])[a-zA-Z0-9]([a-zA-Z0-9_\\s\\-]*[a-zA-Z0-9])?$",
      sizeInChar = 20
    ) {
      const nameLineEditor = new WUXLineEditor({
        //id: "customTableNameLineEditor",
        placeholder: placeholder,
        pattern: xpattern,
        requiredFlag: reqFlag,
        sizeInCharNumber: sizeInChar,
        selectAllOnFocus: true,
        displayClearFieldButtonFlag: true,
        maxLength: 35
      });

      return nameLineEditor;
    },

    insertInputRow: function (
      tableBody,
      columnNames,
      detailsData,
      label,
      currentRowInput,
      gcoWizardDialog
    ) {
      var that = this;
      var inputRow = that.createTableRow();
      inputRow.inject(tableBody);

      var rowData = {};

      columnNames.forEach(function (name) {
        var dataCell = UWA.createElement("td").inject(inputRow);

        if (
          name === XCADMappingNLS._3dexperienceTypes ||
          name === XCADMappingNLS.typeClassification ||
          name === XCADMappingNLS.relationshipClass ||
          name === XCADMappingNLS._3dexperienceRel ||
          name === XCADMappingNLS.derivedOutput ||
          name === XCADMappingNLS.iefadmintables ||
          name === XCADMappingNLS.iefwebforms
        ) {
          var option;
          switch (name) {
            case XCADMappingNLS._3dexperienceTypes:
              option = "3dexptype";
              break;

            case XCADMappingNLS.typeClassification:
              option = "typeclassification";
              break;

            case XCADMappingNLS.relationshipClass:
              option = "relationshipclass";
              break;

            case XCADMappingNLS._3dexperienceRel:
              option = "3dexprel";
              break;

            case XCADMappingNLS.derivedOutput:
              option = "derivedoutput";
              break;

            case XCADMappingNLS.iefadmintables:
              option = "iefadmintables";
              break;

            case XCADMappingNLS.iefwebforms:
              option = "iefwebform";
              break;
          }

          var url =
            URLHandler.getURL() +
            "/resources/xcadparam/gco/getValues?" +
            "option=" +
            option +
            "&tenant=" +
            URLHandler.getTenant();

          if (
            name === XCADMappingNLS._3dexperienceRel ||
            name === XCADMappingNLS.relationshipClass
          ) {
            var comboBoxTreeDocument = new TreeDocument();
            const table = that.createTable().inject(dataCell);

            const txtFieldRow = UWA.createElement("tr", {}).inject(table);

            const txtFieldTd = UWA.createElement("td", {}).inject(txtFieldRow);

            var inputField = that
              .createLineEditor(name, false)
              .inject(txtFieldTd);

            const comboBoxRow = UWA.createElement("tr", {}).inject(table);

            const comboBoxTd = UWA.createElement("td", {
              styles: {
                "padding-top": "5px"
              }
            }).inject(comboBoxRow);

            var comboBox = new WUXComboBox({
              enableSearchFlag: false,
              elementsTree: comboBoxTreeDocument
            }).inject(comboBoxTd);

            that
              .populateTreeDocument(comboBoxTreeDocument, url, null)
              .then(function (result) {})
              .catch(function (error) {
                console.log("Error populating classification list:", error);
              });

            comboBox.addEventListener("change", function () {
              const selectedItem = comboBox.value;

              if (selectedItem) {
                inputField.value = selectedItem;
              }
            });

            if (currentRowInput !== null) {
              inputField.value = currentRowInput[name];
            }

            rowData[name] = inputField;
          } else {
            var comboBoxTreeDocument = new TreeDocument();

            const table = that.createTable().inject(dataCell);

            table.setStyles({
              "max-width": "min-content"
              //'overflow': 'auto'  // Optional: handles overflow gracefully
            });

            const chipRow = UWA.createElement("tr", {}).inject(table);

            const chipTd = UWA.createElement("td", {
              colspan: "2"
            }).inject(chipRow);

            const xpattern =
              "^(?=.*[a-zA-Z])[a-zA-Z0-9]([a-zA-Z0-9_\\s\\-]*[a-zA-Z0-9])?$";
            const regex = new RegExp(xpattern);

            const validate = (inputValue) => {
              return new Promise((resolve) => {
                if (regex.test(inputValue)) {
                  resolve(inputValue);
                } else {
                  resolve([]); // Resolve with empty array for invalid input
                }
              });
            };

            var selectionChips;

            if (name === XCADMappingNLS.typeClassification) {
              selectionChips = new WUXSelectionChips({
                mode: WUXSelectionChips.SELECTION_MODE.SINGLE
              }).inject(chipTd);
            } else {
              selectionChips = new SelectionChipsEditor({
                uniqueValue: true,
                customValidator: validate
              }).inject(chipTd);
            }

            function selectCountCallback() {
              if (this.selectedIndexes.length > 0) {
                return {
                  label: this.selectedIndexes.length + " item selected"
                };
              }
              return undefined;
            }
            const selectRow = UWA.createElement("tr", {}).inject(table);

            const comboBoxTd = UWA.createElement("td", {
              width: "85%",
              align: "left",
              styles: {
                "padding-top": "5px",
                "padding-right": "5px"
              }
            }).inject(selectRow);

            var comboBox = new WUXComboBox({
              elementsTree: comboBoxTreeDocument,
              enableSearchFlag: false,
              placeholder: XCADMappingNLS.selectValuesPlacholder,
              displayStyle: "normal",
              getMainElementCustomization: selectCountCallback,
              reachablePlaceHolderFlag: false,
              multiSelFlag: true
            }).inject(comboBoxTd);

            that
              .populateTreeDocument(comboBoxTreeDocument, url, null)
              .then(function (result) {})
              .catch(function (error) {
                console.log("Error populating classification list:", error);
              });

            comboBox.elements.container.style.width = "100%";

            const buttonTd = UWA.createElement("td", {
              width: "15%",
              align: "left"
            }).inject(selectRow);

            let addButton = new WUXButton({
              icon: {
                iconName: "plus",
                fontIconFamily: WUXManagedFontIcons.Font3DS
              },
              showLabelFlag: false
            }).inject(buttonTd);

            if (name === XCADMappingNLS.typeClassification) {
              addButton.addEventListener("buttonclick", function () {
                const selectedItem = comboBox.value;

                if (selectedItem) {
                  selectionChips.addChips(selectedItem);
                }
              });

              if (currentRowInput !== null) {
                selectionChips.addChips(currentRowInput[name]);
              }
            } else {
              addButton.addEventListener("buttonclick", function () {
                const selectedItem = comboBox.value;
                if (selectedItem) {
                  selectionChips.addValues(selectedItem);
                }
              });

              if (currentRowInput !== null) {
                selectionChips.addValues(currentRowInput[name]);
              }
            }

            rowData[name] = selectionChips;
          }
        } else if (name === "Direction") {
          var dirComboBox = new WUXComboBox({
            enableSearchFlag: false,
            elementsList: [
              {
                label: "To",
                value: "to"
              },
              {
                label: "From",
                value: "from"
              }
            ],
            value: "to"
          }).inject(dataCell);

          if (currentRowInput !== null) {
            dirComboBox.value = currentRowInput[name];
          }

          rowData[name] = dirComboBox;
        } else if (
          name === XCADMappingNLS.cadTypes ||
          name === XCADMappingNLS._3dexperienceType ||
          name === XCADMappingNLS._3dexpTypeofDO
        ) {
          var Label = new WUXLabel({
            value: label,
            maxDisplayLength: 25,
            backgroundColor: WebUXColorEnums.COLORS_STATUS.COLOR_SECTION_GRAY
          }).inject(dataCell);

          if (currentRowInput !== null) {
            Label.value = currentRowInput[name];
          }
          rowData[name] = Label;
        } else {
          var inputField = that.createLineEditor(name).inject(dataCell);

          if (currentRowInput !== null) {
            inputField.value = currentRowInput[name];
          }

          rowData[name] = inputField;
        }
      });

      if (label === "relDetails" || label === "initialDetails") {
        var deleteCell = UWA.createElement("td").inject(inputRow);
        var deleteButton = new WUXButton({
          displayStyle: "lite-borders",
          icon: {
            iconName: "trash",
            fontIconFamily: WUXManagedFontIcons.Font3DS
          },
          showLabelFlag: false
        }).inject(deleteCell);

        deleteButton.addEventListener("buttonclick", function () {
          // there should be at least one row
          if (detailsData.length > 1) {
            // Delete the row
            inputRow.remove();

            //Recenter dialog after row deletion
            const dialog = gcoWizardDialog.elements.container;
            const event = new Event("dimensionsChanged", { bubbles: true });
            dialog.dispatchEvent(event);

            // Remove the corresponding rowData from detailsData
            var indexToRemove = detailsData.indexOf(rowData);
            if (indexToRemove !== -1) {
              detailsData.splice(indexToRemove, 1); // Remove rowData from the array
            }
          }
        });
      }

      // Once the row is populated, push the rowData (element references) to the detailsData array
      detailsData.push(rowData);
    },

    populateTreeDocument: function (TreeDocument, url, list) {
      var options = {
        timeout: 250000,
        method: "GET",
        headers: {
          "Content-Type": "application/json",
          Accept: "application/json",
          "X-Requested-With": "XMLHttpRequest"
        }
      };

      return AJAXUtil.Server(url, options) // Return the promise
        .then(function (response) {
          try {
            let parsedResponse = JSON.parse(response);

            if (Array.isArray(parsedResponse)) {
              parsedResponse.forEach(function (val) {
                var node = new TreeNodeModel({
                  label: val,
                  value: val
                });
                TreeDocument.addRoot(node);
              });
              TreeDocument.expandAll();
            }
          } catch (error) {
            console.log("Error parsing JSON:", error);
          }
        })
        .catch(function (error) {
          console.log(
            "ParameterizationXCAD/CustomTableUtil :: Error processing tree document ::",
            error
          );
        });
    }
  };

  return customTableUtil;
});

define("DS/ParameterizationSkeleton/Views/ParameterizationXCAD/AddGCOViewUtilities", [
  "UWA/Core",
  "DS/Windows/ImmersiveFrame",
  "DS/Windows/Dialog",
  "DS/Notifications/NotificationsManagerUXMessages",
  "DS/Notifications/NotificationsManagerViewOnScreen",
  "DS/WAFData/WAFData",
  "DS/Controls/Button",
  "DS/Controls/LineEditor",
  "DS/Controls/Expander",
  "DS/Controls/FilePicker",
  "DS/Controls/TooltipModel",
  "DS/Controls/Toggle",
  "DS/Menu/ContextualMenu",
  "DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler",
  "DS/ParameterizationSkeleton/Utils/ParameterizationXCAD/CustomTableUtil",
  "DS/ParameterizationSkeleton/Utils/ParameterizationXCAD/AJAXUtil",
  "DS/ParameterizationSkeleton/Utils/ParameterizationXCAD/xNotification",
  "i18n!DS/ParameterizationSkeleton/assets/nls/XCADMappingNLS"
], function (
  UWA,
  ImmersiveFrame,
  WUXDialog,
  NotificationsManagerUXMessages,
  WUXNotificationsManagerViewOnScreen,
  WAFData,
  WUXButton,
  WUXLineEditor,
  WUXExpander,
  FilePicker,
  WUXTooltipModel,
  WUXToggle,
  WUXContextualMenu,
  URLHandler,
  CustomTableUtil,
  AJAXUtil,
  xNotification,
  XCADMappingNLS
) {
  "use strict";

  const modalContainer = ".wux-windows-modalDialog";

  var UIview = {
    addGCO: function () {
      var that = this;
      var plusIcon = document.querySelector(".fonticon-plus.wux-ui-3ds");

      const menu = [
        {
          type: "PushItem",
          title: XCADMappingNLS.importTitle,
          icon: "import wux-ui-3ds",
          action: {
            callback: function () {
              that.importGCO();
            }
          }
        },
        {
          type: "PushItem",
          title: XCADMappingNLS.createGCOTitle,
          icon: "new-create wux-ui-3ds",
          action: {
            callback: function () {
              that.gcoWizard();
            }
          }
        }
      ];

      //Boolean flag to track whether the event listener is already added
      if (!plusIcon._contextualMenuListener) {
        WUXContextualMenu.addEventListener(plusIcon, {
          callback: function () {
            return menu;
          }
        });

        // Setting the flag to true once the listener is added
        plusIcon._contextualMenuListener = true;
      }

      //Triggers the contextual menu programmatically on click
      const opts = {
        bubbles: true,
        cancelable: true,
        clientX: plusIcon.getBoundingClientRect().left + 10,
        clientY: plusIcon.getBoundingClientRect().top + 30
      };

      WUXContextualMenu.buildAndDisplayContextualMenu(plusIcon, opts);

      // const menuElement = document.querySelector(".contextual-menu");
      // if (menuElement) {
      //   menuElement.style.zIndex = 9999;
      // }
    },

    importGCO: function () {
      const that = this;

      let immersiveFrame = new ImmersiveFrame({
        identifier: "addGCOIframe"
      });

      WUXNotificationsManagerViewOnScreen.setNotificationManager(
        NotificationsManagerUXMessages
      );
      WUXNotificationsManagerViewOnScreen.setStackingPolicy(1);

      var lineInputIntegration,
        IntegrationInputText,
        lineInputCAD,
        CADInputText,
        iCell,
        inputIntegration,
        inputCADOrigin,
        tableImport,
        deploytbody,
        tooltipCell,
        lineImport,
        cellfileContainer,
        cellImportText,
        fileController,
        importBttnCell,
        importBttn;

      const xpattern = "[a-zA-Z0-9_]+";

      const contentWrapper = UWA.createElement("div", {});

      let mainspanText = UWA.createElement("span");
      mainspanText.textContent = XCADMappingNLS.importHeader;

      mainspanText.style.display = "block";
      mainspanText.style.paddingBottom = "10px";

      contentWrapper.appendChild(mainspanText);

      tableImport = UWA.createElement("table", {
        class: "table table-hover",
        id: ""
      });

      deploytbody = UWA.createElement("tbody", {
        class: "fparamtbody",
        id: ""
      }).inject(tableImport);

      //Line input for integration Name
      lineInputIntegration = UWA.createElement("tr").inject(deploytbody);

      IntegrationInputText = UWA.createElement("td", {
        colspan: "1",
        align: "left"
      }).inject(lineInputIntegration);

      var integText = UWA.createElement("p", {
        text: XCADMappingNLS.integrationLabeltxt,
        class: ""
      }).inject(IntegrationInputText);

      const mandatoryField = UWA.createElement("span", {
        text: " *",
        styles: {
          color: "red"
        }
      });

      integText.appendChild(mandatoryField);

      tooltipCell = UWA.createElement("td", {
        colspan: "1",
        align: "left"
      }).inject(lineInputIntegration);

      that.createTooltip(tooltipCell, XCADMappingNLS.integrationTooltip);

      iCell = UWA.createElement("td", {
        colspan: "2",
        align: "left"
      }).inject(lineInputIntegration);

      inputIntegration = CustomTableUtil.createLineEditor(
        XCADMappingNLS.integrationPlaceholdertxt,
        false,
        xpattern,
        40
      ).inject(iCell);

      //Line input for cad origin
      lineInputCAD = UWA.createElement("tr").inject(deploytbody);

      CADInputText = UWA.createElement("td", {
        colspan: "1",
        align: "left"
      }).inject(lineInputCAD);

      var cadText = UWA.createElement("p", {
        text: XCADMappingNLS.cadOriginInputtxt,
        class: ""
      }).inject(CADInputText);

      const mandatoryFieldCad = UWA.createElement("span", {
        text: " *",
        styles: {
          color: "red"
        }
      });

      cadText.appendChild(mandatoryFieldCad);

      tooltipCell = UWA.createElement("td", {
        colspan: "1",
        align: "left"
      }).inject(lineInputCAD);

      that.createTooltip(tooltipCell, XCADMappingNLS.cadTooltip);

      iCell = UWA.createElement("td", {
        colspan: "2",
        align: "left"
      }).inject(lineInputCAD);

      inputCADOrigin = CustomTableUtil.createLineEditor(
        XCADMappingNLS.cadOriginInputtxt,
        false,
        xpattern,
        40
      ).inject(iCell);

      lineImport = UWA.createElement("tr").inject(deploytbody);

      cellImportText = UWA.createElement("td", {
        align: "left"
      }).inject(lineImport);

      var fileText = UWA.createElement("p", {
        text: XCADMappingNLS.importTitle,
        class: ""
      }).inject(cellImportText);

      const mandatoryFieldfile = UWA.createElement("span", {
        text: " *",
        styles: {
          color: "red"
        }
      });

      fileText.appendChild(mandatoryFieldfile);

      tooltipCell = UWA.createElement("td", {
        align: "left"
      }).inject(lineImport);

      that.createTooltip(tooltipCell, XCADMappingNLS.importTooltip);

      cellfileContainer = UWA.createElement("td", {
        align: "left"
      });

      fileController = new FilePicker({
        placeholder: XCADMappingNLS.fileTooltip,
        fileTypes: ".xml",
        allowResetToUndefinedByUIFlag: true
      }).inject(cellfileContainer);

      var selectedContent = "";

      // Function to read the content of the selected file
      function readFileContent(file) {
        if (!file) return;

        var reader = new FileReader();
        reader.onload = function (event) {
          // Store the content of the file
          selectedContent = event.target.result;
        };

        reader.readAsText(file);
      }

      fileController.addEventListener("change", (e) => {
        var file = fileController.value;

        if (file) {
          readFileContent(file);
        }
      });

      cellfileContainer.inject(lineImport);

      importBttnCell = UWA.createElement("td", {
        align: "left"
      });

      importBttn = new WUXButton({
        label: XCADMappingNLS.importTxt,
        emphasize: "primary",
        icon: {
          iconName: "import wux-ui-3ds",
          fontIconFamily: WUXManagedFontIcons.Font3DS,
          fontIconSize: "1x"
        }
      }).inject(importBttnCell);

      importBttn.addEventListener("buttonclick", function () {
        var fileInput = fileController.value;
        //var that = that;
        if (fileInput) {
          var fileName = fileInput.name;

          const pattern = /^(?=.*[a-zA-Z])[a-zA-Z0-9-_]+$/;

          let integrationName = inputIntegration.value;
          let cadOrigin = inputCADOrigin.value;

          if (fileName.endsWith(".xml")) {
            var textContent = selectedContent.trim();

            if (textContent === "") {
              NotificationsManagerUXMessages.addNotif({
                level: "info",
                title: XCADMappingNLS.emptyFile,
                message: XCADMappingNLS.invalidFileFormat
              });
            } else if (
              !textContent.startsWith(
                '<?xml version="1.0" encoding="UTF-8" ?>'
              ) ||
              textContent.startsWith('<?xml version="1.0" encoding="utf-8" ?>')
            ) {
              NotificationsManagerUXMessages.addNotif({
                level: "info",
                title: XCADMappingNLS.invalidFile,
                message: XCADMappingNLS.invalidFileFormat
              });
            } else {
              //input Validation
              let inputs = [integrationName, cadOrigin];

              function isWhitespaceOrEmpty(value) {
                if (!pattern.test(value)) {
                  return true;
                }
                return false;
              }

              function validateInputs(inputs) {
                for (let input of inputs) {
                  if (isWhitespaceOrEmpty(input)) {
                    return false;
                  }
                }
                return true;
              }

              if (!validateInputs(inputs)) {
                NotificationsManagerUXMessages.addNotif({
                  level: "info",
                  title: XCADMappingNLS.invalidInput,
                  message: XCADMappingNLS.invalidInputmsg
                });
              } else {
                let url =
                  URLHandler.getURL() +
                  "/resources/xcadparam/gco/importGCO?" +
                  "integrationName=" +
                  integrationName +
                  "&cadOrigin=" +
                  cadOrigin +
                  "&fileName=" +
                  fileName +
                  "&tenant=" +
                  URLHandler.getTenant();

                var Data = fileInput;

                WAFData.authenticatedRequest(url, {
                  timeout: 250000,
                  method: "POST",
                  data: Data,
                  //type:,
                  headers: {
                    "Content-Type": "application/xml",
                    "X-Requested-With": "XMLHttpRequest"
                  },
                  onFailure: function () {
                    var infoOptions = {
                      level: "error",
                      title: XCADMappingNLS.importFailed
                    };
                    NotificationsManagerUXMessages.addNotif(infoOptions);

                    immersiveFrame.destroy();
                    importFileDialog.destroy();
                  },
                  onComplete: function (response) {
                    const jsonResponse = JSON.parse(response);

                    var successCode = jsonResponse.success.code || "success";

                    if (successCode == "202") {
                      var type = jsonResponse.success.Type;
                      var gcoName = jsonResponse.success.gcoName;

                      UIview.warningDialog((updateGCO) => {
                        let url =
                          URLHandler.getURL() +
                          "/resources/xcadparam/gco/updateGCO?" +
                          "integrationName=" +
                          integrationName +
                          "&cadOrigin=" +
                          cadOrigin +
                          "&type=" +
                          type +
                          "&gcoName=" +
                          gcoName +
                          "&updateGCO=" +
                          updateGCO +
                          "&fileName=" +
                          fileName +
                          "&tenant=" +
                          URLHandler.getTenant();

                        WAFData.authenticatedRequest(url, {
                          timeout: 250000,
                          method: "POST",
                          data: "",
                          headers: {
                            "Content-Type": "application/xml",
                            "X-Requested-With": "XMLHttpRequest"
                          },
                          onFailure: function () {
                            var infoOptions = {
                              level: "error",
                              title: XCADMappingNLS.importFailed
                            };
                            if (updateGCO) {
                              NotificationsManagerUXMessages.addNotif(
                                infoOptions
                              );
                            }

                            immersiveFrame.destroy();
                            importFileDialog.destroy();
                          },
                          onComplete: function () {
                            var infoOptions = {
                              level: "success",
                              title: XCADMappingNLS.importSuccess,
                              message: XCADMappingNLS.importSuccessmsg
                            };

                            if (updateGCO) {
                              NotificationsManagerUXMessages.addNotif(
                                infoOptions
                              );
                            }

                            immersiveFrame.destroy();
                            importFileDialog.destroy();
                          }
                        });
                      });
                    } else {
                      var infoOptions = {
                        level: "success",
                        title: XCADMappingNLS.importSuccess,
                        message: XCADMappingNLS.importSuccessmsg
                      };

                      NotificationsManagerUXMessages.addNotif(infoOptions);
                      immersiveFrame.destroy();
                      importFileDialog.destroy();
                    }
                  }
                });
              }
            }
          } else {
            NotificationsManagerUXMessages.addNotif({
              level: "info",
              title: XCADMappingNLS.selectFile,
              message: XCADMappingNLS.invalidFileFormat
            });
          }
        } else {
          NotificationsManagerUXMessages.addNotif({
            level: "info",
            title: XCADMappingNLS.selectFile,
            message: XCADMappingNLS.selectFilemsg
          });
        }
      });

      importBttnCell.inject(lineImport);

      lineImport.inject(deploytbody);

      that.createExpander(
        contentWrapper,
        XCADMappingNLS.importTitle,
        tableImport
      );

      var importFileDialog = new WUXDialog({
        immersiveFrame: immersiveFrame,
        identifier: "addGCOIframe",
        title: XCADMappingNLS.createNewGCO,
        domId: "addGCOimportFile",
        content: contentWrapper,
        activeFlag: false,
        movableFlag: false,
        resizableFlag: false,
        modalFlag: true
      });

      importFileDialog.addEventListener("close", function (e) {
        immersiveFrame.destroy();
      });

      immersiveFrame.inject(document.body);
    },

    warningDialog: function (callback) {
      let wimmersiveFrame = new ImmersiveFrame({
        identifier: "warningIframe"
      });
      var myDialog = new WUXDialog({
        immersiveFrame: wimmersiveFrame,
        identifier: "warningIframe",
        title: XCADMappingNLS.warningDtxt,
        content: XCADMappingNLS.warningDcontent,
        activeFlag: false,
        movableFlag: false,
        resizableFlag: false,
        modalFlag: true,
        buttons: {
          No: new WUXButton({
            label: XCADMappingNLS.no,
            onClick: function (e) {
              myDialog.close();
              callback(false);
            }
          }),
          Yes: new WUXButton({
            label: XCADMappingNLS.yes,
            onClick: function (e) {
              myDialog.close();
              callback(true);
            }
          })
        }
      });

      var originalClose = myDialog.close.bind(myDialog);
      myDialog.close = function () {
        // Prevent default close action
      };

      // Allow closing via the buttons by calling the original close method
      myDialog.buttons.No.onClick = function (e) {
        originalClose();
        wimmersiveFrame.destroy();
        callback(false);
      };

      myDialog.buttons.Yes.onClick = function (e) {
        originalClose();
        wimmersiveFrame.destroy();
        callback(true);
      };

      myDialog.addEventListener("clickOutside", function (e) {});

      myDialog.show();
      wimmersiveFrame.inject(document.body);
    },

    createExpander: function (parentDiv, title, content) {
      var iExpander = new WUXExpander({
        header: title,
        body: content,
        style: "filled-separate",
        expandedFlag: true
      }).inject(parentDiv);

      return iExpander;
    },

    createTooltip: function (containerCell, tooltipNLSText) {
      const imgInfoSpan = UWA.createElement("span", {
        class: "fonticon fonticon-info"
      }).inject(containerCell);

      imgInfoSpan.setStyle("color", "black");

      imgInfoSpan.tooltipInfos = new WUXTooltipModel({
        title: "",
        shortHelp: tooltipNLSText,
        mouseRelativePosition: false,
        position: "top"
      });
    },

    gcoWizard: function () {
      var that = this;

      const contentWrapper = UWA.createElement("div", {});

      let wizimmersiveFrame = new ImmersiveFrame({
        identifier: "wizardIframe"
      });

      var gcoWizardDialog = new WUXDialog({
        immersiveFrame: wizimmersiveFrame,
        title: XCADMappingNLS.createNewGCO,
        content: contentWrapper,
        activeFlag: false,
        movableFlag: false,
        resizableFlag: false,
        modalFlag: true,
        buttons: {} // Empty initially,It will update dynamically
      });

      gcoWizardDialog.show();

      // List of Page keys to delete session data
      let keysToDelete = [
        "inputTextTN",
        "initialDetails",
        "policyDetails",
        "formatDetails",
        "relDetails",
        "attributeDetails",
        "otherAttributeDtls"
      ];

      // Override the default close function to prevent default behavior
      var originalClose = gcoWizardDialog.close.bind(gcoWizardDialog);

      gcoWizardDialog.close = function () {
        // Loop through the keys and delete if they exist
        keysToDelete.forEach((key) => {
          if (sessionStorage.getItem(key)) {
            sessionStorage.removeItem(key);
          }
        });

        // Call the original close method after cleanup
        originalClose();
        gcoWizardDialog.destroy();
      };

      gcoWizardDialog.addEventListener("close", function (e) {
        wizimmersiveFrame.destroy();
      });

      // Inject immersive frame into the body
      wizimmersiveFrame.inject(document.body);

      xNotification.init(modalContainer); // Re-initialize (to new modal) when reopening the dialog

      this.inputTextTN(contentWrapper, gcoWizardDialog);
    },

    createButton: function (label, onClickHandler) {
      return new WUXButton({
        label: label,
        onClick: onClickHandler
      });
    },

    inputTextTN: function (container, gcoWizardDialog) {
      var that = this;

      xNotification.clearNotifications();
      const xpattern =
        "^(?=.*[a-zA-Z])[a-zA-Z0-9]([a-zA-Z0-9_\\s]*[a-zA-Z0-9])?$";

      var tableImport = CustomTableUtil.createTable().inject(container);

      var deploytbody = CustomTableUtil.createTableBody().inject(tableImport);

      //Line input for integration Name
      var lineInputIntegration = UWA.createElement("tr").inject(deploytbody);
      var IntegrationInputText = UWA.createElement("td", {
        colspan: "1",
        align: "left"
      }).inject(lineInputIntegration);

      var integText = UWA.createElement("p", {
        text: XCADMappingNLS.integrationLabeltxt,
        class: ""
      }).inject(IntegrationInputText);

      const mandatoryField = UWA.createElement("span", {
        text: " *",
        styles: {
          color: "red"
        }
      });

      integText.appendChild(mandatoryField);

      var tooltipCell = UWA.createElement("td", {
        colspan: "1",
        align: "left"
      }).inject(lineInputIntegration);

      that.createTooltip(tooltipCell, XCADMappingNLS.integrationTooltip);

      var iCell = UWA.createElement("td", {
        colspan: "2",
        align: "left"
      }).inject(lineInputIntegration);

      var inputIntegration = CustomTableUtil.createLineEditor(
        XCADMappingNLS.integrationPlaceholdertxt,
        false,
        xpattern
      );

      inputIntegration.inject(iCell);

      //Line input for cad origin
      var lineInputCAD = UWA.createElement("tr").inject(deploytbody);

      var CADInputText = UWA.createElement("td", {
        colspan: "1",
        align: "left"
      }).inject(lineInputCAD);

      var cadText = UWA.createElement("p", {
        text: XCADMappingNLS.cadOriginInputtxt,
        class: ""
      }).inject(CADInputText);

      const mandatoryFieldCad = UWA.createElement("span", {
        text: " *",
        styles: {
          color: "red"
        }
      });

      cadText.appendChild(mandatoryFieldCad);

      var tooltipCell = UWA.createElement("td", {
        colspan: "1",
        align: "left"
      }).inject(lineInputCAD);

      that.createTooltip(tooltipCell, XCADMappingNLS.cadTooltip);

      var iCell = UWA.createElement("td", {
        colspan: "2",
        align: "left"
      }).inject(lineInputCAD);

      var inputCADOrigin = CustomTableUtil.createLineEditor(
        XCADMappingNLS.cadOriginPlaceholdertxt,
        false,
        xpattern
      );
      var presistedData = that.getSessionStorageData("inputTextTN");
      if (presistedData) {
        inputIntegration.value = presistedData["integrationName"];
        inputCADOrigin.value = presistedData["cadOrigin"];
      }
      inputCADOrigin.inject(iCell);

      gcoWizardDialog.buttons = {
        Ok: this.createButton(XCADMappingNLS.next, () => {
          var inputTextTN = {};

          inputTextTN["integrationName"] = inputIntegration.value;
          inputTextTN["cadOrigin"] = inputCADOrigin.value;

          that.setSessionStorageData("inputTextTN", inputTextTN);

          var sessionData = that.getSessionStorageData("inputTextTN");
          if (sessionData) {
            // Integration Name (mandatory field)

            if (!sessionData["integrationName"]) {
              xNotification.errorMsg(
                XCADMappingNLS.required +
                  " " +
                  XCADMappingNLS.integrationLabeltxt,
                XCADMappingNLS.allowedCharactersErrorMessage,
                modalContainer
              );
              return;
            }

            // CAD Origin (mandatory field)
            if (!sessionData["cadOrigin"]) {
              xNotification.errorMsg(
                XCADMappingNLS.required +
                  " " +
                  XCADMappingNLS.cadOriginInputtxt,
                XCADMappingNLS.allowedCharactersErrorMessage,
                modalContainer
              );
              return;
            }

            container.empty();
            this.initialDetails(container, gcoWizardDialog);
          }
        })
      };
    },

    initialDetails: function (container, gcoWizardDialog) {
      var that = this;

      xNotification.clearNotifications();

      var tableDiv = CustomTableUtil.createTableDiv();
      tableDiv.inject(container);

      var table = CustomTableUtil.createTable();
      table.inject(tableDiv);

      var tableBody = CustomTableUtil.createTableBody();
      tableBody.inject(table);

      var columnNames = [
        XCADMappingNLS.cadType,
        XCADMappingNLS._3dexperienceTypes,
        XCADMappingNLS.typeClassification,
        XCADMappingNLS.typeTemplate,
        XCADMappingNLS.cadtolrdMapping,
        XCADMappingNLS.derivedOutput
      ];

      const mandColIndex = [0, 1, 2];

      var tableHeader = CustomTableUtil.createTableHeader(
        columnNames,
        true,
        mandColIndex
      );
      tableHeader.inject(tableBody);

      var initialDetailsData = [];

      var stordData = that.getSessionStorageData("initialDetails");

      if (stordData !== null) {
        if (Array.isArray(stordData)) {
          stordData.forEach(function (currentRowInput) {
            CustomTableUtil.insertInputRow(
              tableBody,
              columnNames,
              initialDetailsData,
              "initialDetails",
              currentRowInput,
              gcoWizardDialog
            );
          });
        }
      } else {
        CustomTableUtil.insertInputRow(
          tableBody,
          columnNames,
          initialDetailsData,
          "initialDetails",
          null,
          gcoWizardDialog
        );
      }

      const buttonContainer = new UWA.Element("div").inject(tableDiv);

      var addBttn = CustomTableUtil.createAddNewTableButton();
      addBttn.addEventListener("buttonclick", function () {
        CustomTableUtil.insertInputRow(
          tableBody,
          columnNames,
          initialDetailsData,
          "initialDetails",
          null,
          gcoWizardDialog
        );

        const dialog = gcoWizardDialog.elements.container;
        const event = new Event("dimensionsChanged", { bubbles: true });
        dialog.dispatchEvent(event);
      });

      addBttn.inject(buttonContainer);

      gcoWizardDialog.buttons = {
        Cancel: this.createButton(XCADMappingNLS.back, () => {
          var data = that.getRowDataAsObjectInitialDetials(
            initialDetailsData,
            columnNames
          );
          that.setSessionStorageData("initialDetails", data);

          container.empty();
          this.inputTextTN(container, gcoWizardDialog);
        }),

        Ok: this.createButton(XCADMappingNLS.next, () => {
          // Save the current data in session storage
          var data = that.getRowDataAsObjectInitialDetials(
            initialDetailsData,
            columnNames
          );
          that.setSessionStorageData("initialDetails", data);

          var sessionData = that.getSessionStorageData("initialDetails");
          if (sessionData) {
            var cadTypeList = [];
            for (let i = 0; i < sessionData.length; i++) {
              const rowData = sessionData[i];

              // CAD Type (mandatory field)
              if (!rowData[XCADMappingNLS.cadType]) {
                xNotification.errorMsg(
                  XCADMappingNLS.required + " " + XCADMappingNLS.cadType,
                  XCADMappingNLS.allowedCharactersErrorMessage,
                  modalContainer
                );
                return;
              }

              // 3DEXPERIENCE Types (mandatory field)
              if (
                !rowData[XCADMappingNLS._3dexperienceTypes] ||
                !(
                  Array.isArray(rowData[XCADMappingNLS._3dexperienceTypes]) &&
                  rowData[XCADMappingNLS._3dexperienceTypes].length !== 0
                )
              ) {
                xNotification.errorMsg(
                  XCADMappingNLS.required +
                    " " +
                    XCADMappingNLS._3dexperienceTypes,
                  XCADMappingNLS.allowedCharactersErrorMessage,
                  modalContainer
                );
                return;
              }

              // Type Classification (mandatory field)
              if (
                !rowData[XCADMappingNLS.typeClassification] ||
                !(
                  Array.isArray(rowData[XCADMappingNLS.typeClassification]) &&
                  rowData[XCADMappingNLS.typeClassification].length !== 0
                )
              ) {
                xNotification.errorMsg(
                  XCADMappingNLS.required +
                    " " +
                    XCADMappingNLS.typeClassification,
                  XCADMappingNLS.allowedCharactersErrorMessage,
                  modalContainer
                );
                return;
              }

              cadTypeList.push(rowData[XCADMappingNLS.cadType]);
            }

            // Checking Duplicate CAD Type
            if (new Set(cadTypeList).size !== cadTypeList.length) {
              xNotification.errorMsg(
                XCADMappingNLS.duplicate + " " + XCADMappingNLS.cadType,
                XCADMappingNLS.duplicate +
                  " " +
                  XCADMappingNLS.cadType +
                  " " +
                  XCADMappingNLS.isnotallowed,
                modalContainer
              );
              return;
            }

            var allPolicyList = that.getData(
              "initialDetails",
              "policyDetails",
              XCADMappingNLS._3dexperienceTypes
            );
            var allDerivedOutputs = that.getData(
              "initialDetails",
              "formatDetails",
              XCADMappingNLS._3dexperienceTypes
            );

            container.empty();

            if (allPolicyList.length > 0) {
              that.policyDetails(container, gcoWizardDialog);
            } else if (allDerivedOutputs.length > 0) {
              that.formatDetails(container, gcoWizardDialog);
            } else {
              that.relDetails(container, gcoWizardDialog);
            }
          }
        })
      };
    },

    policyDetails: function (container, gcoWizardDialog) {
      var that = this;

      xNotification.clearNotifications();

      var tableDiv = CustomTableUtil.createTableDiv();
      tableDiv.inject(container);

      var table = CustomTableUtil.createTable();
      table.inject(tableDiv);

      var tableBody = CustomTableUtil.createTableBody();
      tableBody.inject(table);

      var columnNames = [
        XCADMappingNLS._3dexperienceType,
        XCADMappingNLS.policy
      ];

      var tableHeader = CustomTableUtil.createTableHeader(columnNames);
      tableHeader.inject(tableBody);

      var policyDetailsData = [];

      var stordData = that.getSessionStorageData("policyDetails");

      if (stordData !== null) {
        if (Array.isArray(stordData)) {
          stordData.forEach(function (currentRowInput) {
            CustomTableUtil.insertInputRow(
              tableBody,
              columnNames,
              policyDetailsData,
              "policyDetails",
              currentRowInput
            );
          });
        }
      }

      gcoWizardDialog.buttons = {
        Cancel: this.createButton(XCADMappingNLS.back, () => {
          var data = that.getRowDataAsObject(policyDetailsData, columnNames);
          that.setSessionStorageData("policyDetails", data);

          container.empty();

          this.initialDetails(container, gcoWizardDialog);
        }),
        Ok: this.createButton(XCADMappingNLS.next, () => {
          var data = that.getRowDataAsObject(policyDetailsData, columnNames);
          that.setSessionStorageData("policyDetails", data);

          var sessionData = that.getSessionStorageData("policyDetails");

          if (sessionData) {
            var formatDetailsData = that.getSessionStorageData("formatDetails");

            container.empty();
            if (formatDetailsData !== null) {
              that.formatDetails(container, gcoWizardDialog);
            } else {
              that.relDetails(container, gcoWizardDialog);
            }
          }
        })
      };
    },

    formatDetails: function (container, gcoWizardDialog) {
      var that = this;

      xNotification.clearNotifications();

      var tableDiv = CustomTableUtil.createTableDiv();
      tableDiv.inject(container);

      var table = CustomTableUtil.createTable();
      table.inject(tableDiv);

      var tableBody = CustomTableUtil.createTableBody();
      tableBody.inject(table);

      var columnNames = [
        XCADMappingNLS.cadTypes,
        XCADMappingNLS._3dexpTypeofDO,
        XCADMappingNLS.typeFormat
      ];

      var tableHeader = CustomTableUtil.createTableHeader(columnNames);
      tableHeader.inject(tableBody);

      var formatDetailsData = [];

      var stordData = that.getSessionStorageData("formatDetails");

      if (stordData !== null) {
        if (Array.isArray(stordData)) {
          stordData.forEach(function (currentRowInput) {
            CustomTableUtil.insertInputRow(
              tableBody,
              columnNames,
              formatDetailsData,
              "formatDetails",
              currentRowInput
            );
          });
        }
      }

      gcoWizardDialog.buttons = {
        Cancel: this.createButton(XCADMappingNLS.back, () => {
          var data = that.getRowDataAsObject(formatDetailsData, columnNames);
          that.setSessionStorageData("formatDetails", data);

          var policyDetailsData = that.getSessionStorageData("policyDetails");
          container.empty();

          if (policyDetailsData !== null) {
            that.policyDetails(container, gcoWizardDialog);
          } else {
            that.initialDetails(container, gcoWizardDialog);
          }
        }),
        Ok: this.createButton(XCADMappingNLS.next, () => {
          var data = that.getRowDataAsObject(formatDetailsData, columnNames);
          that.setSessionStorageData("formatDetails", data);

          var sessionData = that.getSessionStorageData("formatDetails");
          if (sessionData) {
            container.empty();
            this.relDetails(container, gcoWizardDialog);
          }
        })
      };
    },

    relDetails: function (container, gcoWizardDialog) {
      var that = this;

      xNotification.clearNotifications();

      var tableDiv = CustomTableUtil.createTableDiv();
      tableDiv.inject(container);

      var table = CustomTableUtil.createTable();
      table.inject(tableDiv);

      var tableBody = CustomTableUtil.createTableBody();
      tableBody.inject(table);

      var columnNames = [
        XCADMappingNLS.cadRel,
        XCADMappingNLS._3dexperienceRel,
        XCADMappingNLS.Direction,
        XCADMappingNLS.relationshipClass
      ];

      var tableHeader = CustomTableUtil.createTableHeader(columnNames, true);
      tableHeader.inject(tableBody);

      var relDetailsData = [];

      var stordData = that.getSessionStorageData("relDetails");

      if (stordData !== null) {
        if (Array.isArray(stordData)) {
          stordData.forEach(function (currentRowInput) {
            CustomTableUtil.insertInputRow(
              tableBody,
              columnNames,
              relDetailsData,
              "relDetails",
              currentRowInput,
              gcoWizardDialog
            );
          });
        }
      } else {
        CustomTableUtil.insertInputRow(
          tableBody,
          columnNames,
          relDetailsData,
          "relDetails",
          null,
          gcoWizardDialog
        );
      }

      const buttonContainer = new UWA.Element("div").inject(tableDiv);

      var addBttn = CustomTableUtil.createAddNewTableButton();
      addBttn.addEventListener("buttonclick", function () {
        CustomTableUtil.insertInputRow(
          tableBody,
          columnNames,
          relDetailsData,
          "relDetails",
          null,
          gcoWizardDialog
        );

        const dialog = gcoWizardDialog.elements.container;
        const event = new Event("dimensionsChanged", { bubbles: true });
        dialog.dispatchEvent(event);
      });

      addBttn.inject(buttonContainer);

      gcoWizardDialog.buttons = {
        Cancel: this.createButton(XCADMappingNLS.back, () => {
          var data = that.getRowDataAsObject(relDetailsData, columnNames);
          that.setSessionStorageData("relDetails", data);

          container.empty();
          var formatDetailsData = that.getSessionStorageData("formatDetails");
          var policyDetailsData = that.getSessionStorageData("policyDetails");

          if (formatDetailsData !== null) {
            that.formatDetails(container, gcoWizardDialog);
          } else if (policyDetailsData !== null) {
            that.policyDetails(container, gcoWizardDialog);
          } else {
            that.initialDetails(container, gcoWizardDialog);
          }
        }),
        Ok: this.createButton(XCADMappingNLS.next, () => {
          var data = that.getRowDataAsObject(relDetailsData, columnNames);
          that.setSessionStorageData("relDetails", data);

          var sessionData = that.getSessionStorageData("relDetails");
          if (sessionData) {
            var cadRelList = [];
            for (let i = 0; i < sessionData.length; i++) {
              const rowData = sessionData[i];

              // CAD Rel
              if (rowData[XCADMappingNLS.cadRel]) {
                // 3DExperience Rel (mandatory field)
                if (!rowData[XCADMappingNLS._3dexperienceRel]) {
                  xNotification.errorMsg(
                    XCADMappingNLS.required +
                      " " +
                      XCADMappingNLS._3dexperienceRel,
                    XCADMappingNLS.allowedCharactersErrorMessage,
                    modalContainer
                  );
                  return;
                }

                // Relationship Class (mandatory field)
                if (!rowData[XCADMappingNLS.relationshipClass]) {
                  xNotification.errorMsg(
                    XCADMappingNLS.required +
                      " " +
                      XCADMappingNLS.relationshipClass,
                    XCADMappingNLS.allowedCharactersErrorMessage,
                    modalContainer
                  );
                  return;
                }
              }

              if (
                rowData[XCADMappingNLS.cadRel] &&
                rowData[XCADMappingNLS.cadRel].trim() !== ""
              ) {
                cadRelList.push(rowData[XCADMappingNLS.cadRel]);
              }
            }

            // Checking Duplicate CAD Rel
            if (new Set(cadRelList).size !== cadRelList.length) {
              xNotification.errorMsg(
                XCADMappingNLS.duplicate + " " + XCADMappingNLS.cadRel,
                XCADMappingNLS.duplicate +
                  " " +
                  XCADMappingNLS.cadRel +
                  " " +
                  XCADMappingNLS.isnotallowed,
                modalContainer
              );
              return;
            }

            container.empty();
            this.attributeDetails(container, gcoWizardDialog);
          }
        })
      };
    },

    attributeDetails: function (container, gcoWizardDialog) {
      var that = this;

      xNotification.clearNotifications();

      var tableDiv = CustomTableUtil.createTableDiv();
      tableDiv.inject(container);

      var table = CustomTableUtil.createTable();
      table.inject(tableDiv);

      var tableBody = CustomTableUtil.createTableBody();
      tableBody.inject(table);

      var columnNames = [
        XCADMappingNLS.iefadmintables,
        XCADMappingNLS.iefwebforms
      ];

      var tableHeader = CustomTableUtil.createTableHeader(columnNames);
      tableHeader.inject(tableBody);

      var attributeDetailsData = [];

      var stordData = that.getSessionStorageData("attributeDetails");

      if (stordData !== null) {
        if (Array.isArray(stordData)) {
          stordData.forEach(function (currentRowInput) {
            CustomTableUtil.insertInputRow(
              tableBody,
              columnNames,
              attributeDetailsData,
              "otherattr",
              currentRowInput
            );
          });
        }
      } else {
        CustomTableUtil.insertInputRow(
          tableBody,
          columnNames,
          attributeDetailsData,
          "otherattr",
          null
        );
      }

      gcoWizardDialog.buttons = {
        Cancel: this.createButton(XCADMappingNLS.back, () => {
          var data = that.getRowDataAsObject(attributeDetailsData, columnNames);
          that.setSessionStorageData("attributeDetails", data);

          container.empty();
          this.relDetails(container, gcoWizardDialog);
        }),
        Ok: this.createButton(XCADMappingNLS.next, () => {
          var data = that.getRowDataAsObject(attributeDetailsData, columnNames);
          that.setSessionStorageData("attributeDetails", data);

          var sessionData = that.getSessionStorageData("attributeDetails");
          var data = sessionData[0];

          if (sessionData[0]) {
            container.empty();
            this.otherAttributeDtls(container, gcoWizardDialog);
          }
        })
      };
    },

    otherAttributeDtls: function (container, gcoWizardDialog) {
      var that = this;

      xNotification.clearNotifications();

      var tableAttri = UWA.createElement("table", {
        class: "table table-hover",
        id: ""
      }).inject(container);

      var deploytbody = UWA.createElement("tbody", {
        class: "fparamtbody",
        id: ""
      }).inject(tableAttri);

      var columnNames = [XCADMappingNLS.othergcoAttributes, "", ""];
      var tableHeader = CustomTableUtil.createTableHeader(
        columnNames,
        false,
        null
      );
      tableHeader.inject(deploytbody);

      // Array to hold references to the input elements
      var inputElements = [];

      // Helper function to create a row with string info, tooltip, and input (toggle)
      function createRow(rowText, tooltipText, inputVal) {
        var lineInput = UWA.createElement("tr").inject(deploytbody);

        // Create row text
        var textCell = UWA.createElement("td", {
          colspan: "1",
          align: "left"
        }).inject(lineInput);
        UWA.createElement("p", { text: rowText }).inject(textCell);

        // Tooltip
        var tooltipCell = UWA.createElement("td", { colspan: "1" }).inject(
          lineInput
        );
        that.createTooltip(tooltipCell, tooltipText);

        // Input
        var inputCell = UWA.createElement("td", {
          colspan: "1",
          align: "center"
        }).inject(lineInput);

        inputCell.setStyles({
          align: "center"
        });

        let inputElement = new WUXToggle({
          type: "switch",
          value: inputVal ? "true" : "false",
          checkFlag: inputVal ? true : false
        });

        inputElement.addEventListener("change", function (e) {
          if (inputElement.checkFlag) {
            inputElement.value = "true";
          } else {
            inputElement.value = "false";
          }
        });

        inputElement.inject(inputCell);

        // Push the input element to the array for later use
        inputElements.push(inputElement);
      }

      var rowConfig = [
        {
          text: XCADMappingNLS.enableHashcodeComputation,
          tooltip: XCADMappingNLS.enableHashcodeComputationTooltip,
          checkValue: true
        },

        {
          text: XCADMappingNLS.checkUUIDconflict,
          tooltip: XCADMappingNLS.checkUUIDconflictTooltip,
          checkValue: true
        },
        {
          text: XCADMappingNLS.checkObsoleteacrossRevisions,
          tooltip: XCADMappingNLS.checkObsoleteacrossRevisionsTooltip,
          checkValue: true
        },
        {
          text: XCADMappingNLS.usezipinCADFileoperations,
          tooltip: XCADMappingNLS.usezipinCADFileoperationsTooltip,
          checkValue: false
        },
        {
          text: XCADMappingNLS.usezipFileoperations,
          tooltip: XCADMappingNLS.usezipFileoperationsTooltip,
          checkValue: true
        }
      ];

      // Check sessionStorage for existing values and create rows
      var storedData = that.getSessionStorageData("otherAttributeDtls") || {};

      rowConfig.forEach(function (row) {
        var storedValue = storedData[row.text];
        var valueToUse =
          storedValue !== undefined ? storedValue === "true" : row.checkValue;

        createRow.call(that, row.text, row.tooltip, valueToUse);
      });

      function collectAndStoreValues() {
        var otherAttributeDtls = {};

        inputElements.forEach(function (inputElement, index) {
          var rowConfigItem = rowConfig[index];
          otherAttributeDtls[rowConfigItem.text] = inputElement.value;
        });

        that.setSessionStorageData("otherAttributeDtls", otherAttributeDtls);
      }

      gcoWizardDialog.buttons = {
        Cancel: this.createButton(XCADMappingNLS.back, () => {
          collectAndStoreValues();

          container.empty();
          this.attributeDetails(container, gcoWizardDialog);
        }),
        Ok: this.createButton(XCADMappingNLS.next, () => {
          collectAndStoreValues();

          // Proceed to the next page (review page)
          container.empty();
          this.reviewPage(container, gcoWizardDialog);
        })
      };
    },

    reviewPage: function (container, gcoWizardDialog) {
      var that = this;

      var tableAttri = UWA.createElement("table", {
        class: "table table-hover",
        id: ""
      }).inject(container);

      var deploytbody = UWA.createElement("tbody", {
        class: "fparamtbody",
        id: ""
      }).inject(tableAttri);

      // Function to format arrays into comma-separated strings
      function formatArrayToString(array) {
        return array && Array.isArray(array) ? array.join(",") : "";
      }

      // Function to generate formatted strings from session data
      function generateFormattedString() {
        // Fetch session data using getSessionStorageData
        const integrationName =
          that.getSessionStorageData("inputTextTN")?.integrationName;
        const cadOrigin = that.getSessionStorageData("inputTextTN")?.cadOrigin;
        const typeInfo = that.getSessionStorageData("initialDetails") || [];
        const policyInfo = that.getSessionStorageData("policyDetails") || [];
        const format = that.getSessionStorageData("formatDetails") || [];
        const relInfo = that.getSessionStorageData("relDetails") || [];

        const attributeDetails =
          that.getSessionStorageData("attributeDetails") || [];

        const useZipInCADFileOperations =
          that.getSessionStorageData("otherAttributeDtls")?.[
            XCADMappingNLS.usezipinCADFileoperations
          ];
        const checkUUIDConflict =
          that.getSessionStorageData("otherAttributeDtls")?.[
            XCADMappingNLS.checkUUIDconflict
          ];
        const enableHashcodeComputation =
          that.getSessionStorageData("otherAttributeDtls")?.[
            XCADMappingNLS.enableHashcodeComputation
          ];
        const checkObsoleteAcrossRevisions =
          that.getSessionStorageData("otherAttributeDtls")?.[
            XCADMappingNLS.checkObsoleteacrossRevisions
          ];
        const useZipFileOperations =
          that.getSessionStorageData("otherAttributeDtls")?.[
            XCADMappingNLS.usezipFileoperations
          ];

        let result = {};

        // 1.integrationName
        result["integrationName"] = integrationName;

        // 2. cadOrigin
        result["cadOrigin"] = cadOrigin;

        // 3. MCADInteg-BusTypeMapping (for typeInfo and 3DEXPERIENCE Types)
        result["MCADInteg-BusTypeMapping"] = typeInfo
          .map(
            (item) =>
              `${item[XCADMappingNLS.cadType]}|${formatArrayToString(
                item[XCADMappingNLS._3dexperienceTypes]
              )}`
          )
          .join("\n");

        // 4. MCADInteg-TypeClassMapping (for typeInfo and Type Classification)
        result["MCADInteg-TypeClassMapping"] = Object.entries(
          typeInfo.reduce((acc, item) => {
            item[XCADMappingNLS.typeClassification]?.forEach((typeClass) => {
              if (!acc[typeClass]) {
                acc[typeClass] = new Set();
              }
              acc[typeClass].add(item[XCADMappingNLS.cadType]);
            });
            return acc;
          }, {})
        )
          .map(
            ([typeClass, cadTypes]) =>
              `${typeClass}|${Array.from(cadTypes).join(",")}`
          )
          .join("\n");

        // 5. IEF-TypeTemplateMapping
        result["IEF-TypeTemplateMapping"] = typeInfo
          .filter((item) => item[XCADMappingNLS.typeTemplate])
          .map(
            (item) =>
              `${item[XCADMappingNLS.cadType]}|${
                item[XCADMappingNLS.typeTemplate]
              }`
          )
          .join("\n");

        // 6.MCADInteg-CADToLRDMapping (for CAD Type and CADTOLRD Mapping)
        result["MCADInteg-CADToLRDMapping"] = typeInfo
          .filter((item) => item[XCADMappingNLS.cadtolrdMapping])
          .map(
            (item) =>
              `${item[XCADMappingNLS.cadType]}|${
                item[XCADMappingNLS.cadtolrdMapping]
              }`
          )
          .join("\n");

        // 7. MCADInteg-TypeDerivedOutputMapping (for CAD Type to Derived Output)
        result["MCADInteg-TypeDerivedOutputMapping"] = typeInfo
          .filter((item) => item[XCADMappingNLS.derivedOutput])
          .map(
            (item) =>
              `${item[XCADMappingNLS.cadType]}|${formatArrayToString(
                item[XCADMappingNLS.derivedOutput]
              )}`
          )
          .join("\n");

        // 8. MCADInteg-TypePolicyMapping  (3DEXPERIENCE Type to  Policy)
        result["MCADInteg-TypePolicyMapping"] = policyInfo
          .filter((item) => item[XCADMappingNLS.policy])
          .map(
            (item) =>
              `${item[XCADMappingNLS._3dexperienceType]}|${
                item[XCADMappingNLS.policy]
              }`
          )
          .join("\n");

        // 9. MCADInteg-TypeFormatMapping (for format details)
        result["MCADInteg-TypeFormatMapping"] = format
          .filter((item) => item[XCADMappingNLS.typeFormat])
          .map(
            (item) =>
              `${item[XCADMappingNLS.cadTypes]}|${
                item[XCADMappingNLS._3dexpTypeofDO]
              },${item[XCADMappingNLS.typeFormat]}`
          )
          .join("\n");

        // 10. MCADInteg-RelationShipClassMapping (for relInfo)
        result["MCADInteg-RelationShipClassMapping"] = relInfo
          .filter((item) => item[XCADMappingNLS.cadRel])
          .map(
            (item) =>
              `${item[XCADMappingNLS.cadRel]}|${
                item[XCADMappingNLS.relationshipClass]
              }`
          )
          .join("\n");

        // 11. MCADInteg-RelMapping (for relInfo and Direction + 3DExperience Rel) (Mandatory)
        result["MCADInteg-RelMapping"] = relInfo
          .filter((item) => item[XCADMappingNLS.cadRel])
          .map(
            (item) =>
              `${item[XCADMappingNLS.cadRel]}|${
                item[XCADMappingNLS.Direction]
              },${item[XCADMappingNLS._3dexperienceRel]}`
          )
          .join("\n");

        // 12. IEF-AdminTables
        result[XCADMappingNLS.iefadmintables] = attributeDetails
          .filter((item) => item[XCADMappingNLS.iefadmintables])
          .map(
            (item) =>
              `${formatArrayToString(item[XCADMappingNLS.iefadmintables])}`
          )
          .join("\n");

        // 12. IEF-AdminTables
        result[XCADMappingNLS.iefadmintables] = attributeDetails
          .filter((item) => item[XCADMappingNLS.iefadmintables])
          .map((item) =>
            Array.isArray(item[XCADMappingNLS.iefadmintables])
              ? item[XCADMappingNLS.iefadmintables].join("\n")
              : item[XCADMappingNLS.iefadmintables]
          )
          .join("\n");

        // 13. IEF-Webforms
        result[XCADMappingNLS.iefwebforms] = attributeDetails
          .filter((item) => item[XCADMappingNLS.iefwebforms])
          .map((item) =>
            Array.isArray(item[XCADMappingNLS.iefwebforms])
              ? item[XCADMappingNLS.iefwebforms].join("\n")
              : item[XCADMappingNLS.iefwebforms]
          )
          .join("\n");

        // 14. MCADInteg-EnableHashcodeComputation
        result["MCADInteg-EnableHashcodeComputation"] =
          enableHashcodeComputation;

        // 15. IEF-CheckUUIDConflict
        result["IEF-CheckUUIDConflict"] = checkUUIDConflict;

        // 16. IEF-CheckObsoleteAcrossRevisions
        result["IEF-CheckObsoleteAcrossRevisions"] =
          checkObsoleteAcrossRevisions;

        // 17. IEF-Pref-MCADInteg-UseZipInCADFileOperations
        result["IEF-Pref-MCADInteg-UseZipInCADFileOperations"] =
          useZipFileOperations;

        // 18. IEF-Pref-MCADInteg-UseZipInFileOperations
        result["IEF-Pref-MCADInteg-UseZipInFileOperations"] =
          useZipInCADFileOperations;

        return result;
      }

      function createRow(formattedStrings) {
        Object.entries(formattedStrings).forEach(([key, value]) => {
          var lineInput = UWA.createElement("tr").inject(deploytbody);

          // Basic/Attribute
          var attrCell = UWA.createElement("td", {
            colspan: "1",
            align: "left"
          }).inject(lineInput);
          UWA.createElement("p", { text: key }).inject(attrCell);

          // Value
          var valueCell = UWA.createElement("td", {
            colspan: "1",
            align: "left"
          }).inject(lineInput);

          // Split value by newline (\n) and create a new <p> for each part
          const lines = value.split("\n");
          lines.forEach((line) => {
            UWA.createElement("p", { text: line }).inject(valueCell);
          });
        });
      }

      var columnNames = ["Basic/Attribute", "Value"];
      var tableHeader = CustomTableUtil.createTableHeader(columnNames);
      tableHeader.inject(deploytbody);

      const formattedStrings = generateFormattedString();
      createRow(formattedStrings);

      gcoWizardDialog.buttons = {
        Cancel: this.createButton(XCADMappingNLS.back, () => {
          container.empty();
          this.otherAttributeDtls(container, gcoWizardDialog);
        }),
        Ok: this.createButton(XCADMappingNLS.create, () => {
          let url =
            URLHandler.getURL() +
            "/resources/xcadparam/gco/createGCOUsingWz?" +
            URLHandler.getTenant();

          var options = {
            timeout: 250000,
            method: "POST",
            data: JSON.stringify(formattedStrings),
            headers: {
              "Content-Type": "application/json",
              Accept: "application/json"
            }
          };

          AJAXUtil.Server(url, options)
            .then(function (response) {
              try {
                let parsedResponse = JSON.parse(response);
                const code = parsedResponse.success.code;

                if (code == 202) {
                  xNotification.warningMsg(
                    XCADMappingNLS.integAlreadyExist,
                    XCADMappingNLS.tryDiffInteg,
                    modalContainer
                  );
                } else {
                  xNotification.sucessMsg(
                    XCADMappingNLS.gcoSuccess,
                    XCADMappingNLS.importSuccess +
                      " " +
                      XCADMappingNLS.importSuccessmsg,
                    modalContainer
                  );

                  setTimeout(() => {
                    gcoWizardDialog.close();
                  }, 2000);
                }
              } catch (error) {}
            })
            .catch(function (error) {
              console.log(
                "ParameterizationXCAD/AddGCOViewUtilities :: Internal Server Error: ",
                error
              );
              xNotification.errorMsg("error", "GCO creation failed");
            });
        })
      };
    },

    getData: function (dataDialog, currentDialog, colName) {
      var that = this;

      var data = that.getSessionStorageData(dataDialog);
      let outputData;

      if (currentDialog === "formatDetails") {
        outputData = {};
        if (data && Array.isArray(data)) {
          data.forEach((item) => {
            if (item[colName] && Array.isArray(item[colName])) {
              item[colName].forEach((output) => {
                if (
                  output === "3DShape" ||
                  output === "DerivedOutputEntity" ||
                  output === XCADMappingNLS.derivedOutput
                ) {
                  let cadType = item[XCADMappingNLS.cadType];
                  if (!(cadType in outputData)) {
                    outputData[cadType] = output;
                  }
                }
              });
            }
          });
        }
      } else {
        outputData = [];
        if (data && Array.isArray(data)) {
          data.forEach((item) => {
            if (item[colName] && Array.isArray(item[colName])) {
              item[colName].forEach((output) => {
                if (!outputData.includes(output)) {
                  outputData.push(output);
                }
              });
            }
          });
        }
      }

      if (outputData.length > 0 || Object.keys(outputData).length > 0) {
        if (currentDialog === "policyDetails") {
          var policyDetails = [];

          var exptype = XCADMappingNLS._3dexperienceType;
          var policy = XCADMappingNLS.policy;

          var existingPolicyDetails =
            that.getSessionStorageData(currentDialog) || [];

          outputData.forEach((item) => {
            var obj = {};

            obj[exptype] = item;
            obj[policy] = "";

            const existingItem = existingPolicyDetails.find(
              (existing) => existing[exptype] === item
            );
            if (existingItem) {
              obj[policy] = existingItem[policy] || ""; // Use existing policy value if available
            }

            policyDetails.push(obj);
          });
          that.setSessionStorageData(currentDialog, policyDetails);
        }

        if (currentDialog === "formatDetails") {
          var formatDetails = [];

          var CADTypes = XCADMappingNLS.cadTypes;
          var exptype = XCADMappingNLS._3dexpTypeofDO;
          var typeformat = XCADMappingNLS.typeFormat;

          var existingFormatDetails =
            that.getSessionStorageData(currentDialog) || [];
          Object.keys(outputData).forEach((item) => {
            var obj = {};

            obj[CADTypes] = item;
            obj[exptype] = outputData[item];
            obj[typeformat] = "";

            const existingItem = existingFormatDetails.find(
              (existing) => existing[CADTypes] === item
            );
            if (existingItem) {
              obj[typeformat] = existingItem[typeformat] || ""; // Use existing typeformat value if available
            }

            formatDetails.push(obj);
          });
          that.setSessionStorageData(currentDialog, formatDetails);
        }
      }

      return outputData;
    },

    getRowDataAsObjectInitialDetials: function (detailsData, columnNames) {
      var rowDataArray = [];

      detailsData.forEach(function (rowData) {
        var rowObject = {};

        columnNames.forEach(function (columnName) {
          var element = rowData[columnName];
          if (element) {
            if (columnName === XCADMappingNLS.typeClassification) {
              rowObject[columnName] = element.getAllChipsAsLabels();
              return;
            }
            rowObject[columnName] = element.value;
          }
        });

        // Push the row object (key-value pairs) into the rowDataArray
        rowDataArray.push(rowObject);
      });

      return rowDataArray;
    },

    getRowDataAsObject: function (detailsData, columnNames) {
      var rowDataArray = [];

      detailsData.forEach(function (rowData) {
        var rowObject = {};

        columnNames.forEach(function (columnName) {
          var element = rowData[columnName];
          if (element) {
            rowObject[columnName] = element.value;
          }
        });

        // Push the row object (key-value pairs) into the rowDataArray
        rowDataArray.push(rowObject);
      });

      return rowDataArray;
    },

    setSessionStorageData: function (key, value) {
      if (typeof value === "object") {
        value = JSON.stringify(value);
      }
      sessionStorage.setItem(key, value);
    },

    getSessionStorageData: function (key) {
      const value = sessionStorage.getItem(key);

      if (value) {
        try {
          return JSON.parse(value);
        } catch (e) {
          // If parsing fails
          return null;
        }
      }
      return null;
    }
  };

  return UIview;
});

/**
* @quickreview  ROW 25:06:06 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDEL3DOperationsViewer/DEL3DOperationsViewerConfigFamilyView',
  [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
    'DS/ParameterizationSkeleton/Utils/DELConfigurationParameterization/DELConfigurationParameterizationWebServices',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDEL3DOperationsViewer/ParameterizationDEL3DOperationsViewerWebServices',
    'DS/Controls/ModalContainer',
    'DS/Controls/Loader',
    'DS/UIKIT/Mask',
    'DS/ParameterizationSkeleton/Model/DELConfigurationParameterizationModel/DELConfigurationParamTranslationModel',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DEL3DOperationsViewerConfiguration',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DELConfigurationLayoutView'
  ],
  function (
    UWA,
    DELConfigurationFamilyView,
    DELConfigurationParameterizationWebServices,
    ParameterizationDEL3DOperationsViewerWebServices,
    WUXModalContainer,
    WUXLoader,
    Mask,
    DELConfigurationParamTranslationModel,
    Nls,
    layoutViewNls
  ) {

    'use strict';

    var DEL3DOperationsViewerConfigFamilyView = DELConfigurationFamilyView.extend({
      _CONSTANTS: {

        // Column Ids 
        COLUMNIDS: {
          CORPUSTYPE: 'corpusType',
          ATTRIBUTE: 'attribute',
          ROWINDEX: 'rowIndex', // rowIndex is used internally to manage the order. This is not visile in the UI.
          ENTITY_TYPE: 'entityType', // entityType is used internally to send it to Application. This is not visile in the UI.
          TYPE_NAME: 'typeName',// typeName is used internally to to send it to Application. This is not visile in the UI.
        },

        CORPUSTYPES: {
          PRODUCT:1,
          MFGITEM:2,
          SERVICEITEM:3,
          PROCESS: 4,
          RESOURCE: 5
        },

        ATTRIBUTES_RESULTID: {
          ATTRIBUTES: 'attributes',
          TYPES: 'types',
          TYPENAME: 'typeName',
          TYPENLSNAME: 'typeNlsName'
        }
      },
      _typeResult: null,
      _node: null,
      _listTypes: {
        product: ['VPMReference'],
        mfgItem: ['DELFmiFunctionPPRContinuousReference', 'DELFmiFunctionPPRCreateReference','DELFmiFunctionInstance'],
        serviceItem : ['DELFmiFunctionPPRServiceCreateReference','DELFmiFunctionInstance'],
        process: ['DELLmiPPROperationReference', 'DELLmiPPRSystemReference', 'DELLmiOperationPPRInstance', 'DELLmiPPRSystemInstance'],
        resource: ['Resource','ErgoHuman']
      },
      /*
      * init
      */
      init: function init(options) {
        var that = this;
        this._parent(options);

        that._treeListViewNls = Nls;
        that._modalViewNls = Nls;
        that._nodeTreeViewNls = Nls;
      },

      /*
      * render
      */
      render: function render() {
        var that = this;
        this._parent();

        return this;
      },

      /*
       * buildFamilyContent
       */
      buildFamilyContent: function buildFamilyContent() {
        var that = this;
        var contentView = that._parent();

        var typesColOpt = that.treeListView.getColumnOrGroup(that._CONSTANTS.COLUMNIDS.CORPUSTYPE);
        typesColOpt.compareFunction = function (value1, value2, treeNodeModel1, treeNodeModel2, dataIndex) {
          var corpusType1 = treeNodeModel1.options.data[that._CONSTANTS.COLUMNIDS.CORPUSTYPE];
          var corpusType2 = treeNodeModel2.options.data[that._CONSTANTS.COLUMNIDS.CORPUSTYPE];
          var rowIndex1 = treeNodeModel1.options.data[that._CONSTANTS.COLUMNIDS.ROWINDEX];
          var rowIndex2 = treeNodeModel2.options.data[that._CONSTANTS.COLUMNIDS.ROWINDEX];

          return (( that._CONSTANTS.CORPUSTYPES[corpusType1.toUpperCase()] - that._CONSTANTS.CORPUSTYPES[corpusType2.toUpperCase()] ) || (parseInt(rowIndex1) - parseInt(rowIndex2)));
        }
        return contentView;
      },

      /*
       * buildFamilyContent
       */
      getPromiseToUpdateNLS: function getPromiseToUpdateNLS(nodes) {
        var that = this;
        var types = [];
        var attributes = [];
        var promise = null;
        var numberofNodes = nodes.length;
        if (numberofNodes > 0) {
          for (var nodeIndex = 0; nodeIndex < numberofNodes; nodeIndex++) {
            var nodeData = (nodes[nodeIndex]).getData();
            if (nodeData.hasOwnProperty(that._CONSTANTS.COLUMNIDS.ATTRIBUTE)) {
              attributes.push(nodeData[that._CONSTANTS.COLUMNIDS.ATTRIBUTE]);
            }
          }
          promise = new UWA.Promise(function (resolve, reject) {
            ParameterizationDEL3DOperationsViewerWebServices.getNLSValues(types, attributes, {
              onSuccess: function (data) {
                that._nlsResult = data;

                resolve();
              }
            });

          });
        }
        return promise;

      },

      /*
       * buildtreeListView
       */
      buildtreeListView: function buildtreeListView() {
        var that = this;
        that._parent();
        that.treeListView.rowDragEnabledFlag = true;
        that.treeListView.cellDragEnabledFlag = true;
        that.treeListView.rowReorderEnabledFlag = true;
        that.treeListView.cellSelection = 'single';
        that.treeListView.rowSelection = 'single';
        that.treeListView.showSelectionCheckBoxesFlag = false;

        that.treeListView.onDropRowHeader = that._onDrop.bind(that);
        that.treeListView.onDropCell = that._onDrop.bind(that);
        that.treeListView.onDragOverCell = that._onDrag.bind(that);
        that.treeListView.onDragEnterCell = that._onDrag.bind(that);
        that.treeListView.onDragLeaveCell = that._onDrag.bind(that);
        that.treeListView.onDragOverRowHeader = that._onDrag.bind(that);
        that.treeListView.onDragEnterRowHeader = that._onDrag.bind(that);
        that.treeListView.onDragLeaveRowHeader = that._onDrag.bind(that);
      },

      /*
       * _onDrag
       */
      _onDrag: function _onDrag(event, cellInfos) {
        var that = this;
        console.log("onDragRow/Cell");
        // Allow DnD only between the rows of same type.
        if (cellInfos != undefined && cellInfos.nodeModel != undefined && cellInfos.nodeModel.getData() != undefined && cellInfos.nodeModel.getData()[that._CONSTANTS.COLUMNIDS.CORPUSTYPE] &&
          cellInfos.draggedNodes[0] != undefined && cellInfos.draggedNodes[0].getData() != undefined && cellInfos.draggedNodes[0].getData()[that._CONSTANTS.COLUMNIDS.CORPUSTYPE] != undefined &&
          cellInfos.nodeModel.getData()[that._CONSTANTS.COLUMNIDS.CORPUSTYPE] == cellInfos.draggedNodes[0].getData()[that._CONSTANTS.COLUMNIDS.CORPUSTYPE]) {

          return true;
        }
      },

      /*
       * _onDrop
       */
      _onDrop: function _onDrop(event, cellInfos) {
        var that = this;
        console.log("onDropRow/Cell");
        if (cellInfos != undefined && cellInfos.nodeModel != undefined && cellInfos.nodeModel.getData() != undefined && cellInfos.nodeModel.getData()[that._CONSTANTS.COLUMNIDS.CORPUSTYPE] &&
          cellInfos.droppedNodes[0] != undefined && cellInfos.droppedNodes[0].getData() != undefined && cellInfos.droppedNodes[0].getData()[that._CONSTANTS.COLUMNIDS.CORPUSTYPE] != undefined &&
          cellInfos.nodeModel.getData()[that._CONSTANTS.COLUMNIDS.CORPUSTYPE] == cellInfos.droppedNodes[0].getData()[that._CONSTANTS.COLUMNIDS.CORPUSTYPE]) {

          var type = cellInfos.nodeModel.getData()[that._CONSTANTS.COLUMNIDS.CORPUSTYPE];

          var rowsDataBeforeReorder = that.getRowsDataForType(type);
          that.treeListView.onDropCellDefault.call(that.treeListView, event, cellInfos);
          var rowsDataAfterReorder = that.getRowsDataForType(type);

          if (that.IsTableModifiedForType(type)) {
            that._UpdateParameters(type, rowsDataBeforeReorder, rowsDataAfterReorder);
          }
        }
      },

      /*
       * _UpdateParameters
       */
      _UpdateParameters: function _UpdateParameters(type, rowsDataBeforeReorder, rowsDataAfterReorder, bUpdateForDelete) {
        var that = this;
        // Delete Existing Parameters of this type
        var promisesDeleteParams = that._getDeleteParameterPromises(rowsDataBeforeReorder);
        Mask.mask(that.treeListView.elements.body, Nls.orderParametersMaskMessage);
        UWA.Promise.all(promisesDeleteParams).then(function (dataDeleteParams) {
          // Create Parameters for new order of this type
          var promisesSetParams = that._getSetParamsPromises(rowsDataAfterReorder);
          UWA.Promise.all(promisesSetParams).then(function (dataSetParams) {
            // Check for new parameters deployment and update the tree
            var promisesIsDeployed = that._getIsDeployedPromises(rowsDataAfterReorder);
            UWA.Promise.all(promisesIsDeployed).then(function (resultIsDeployed) {
              var listOfnodeTree = [];
              var lengthIsDeployed = resultIsDeployed.length;
              if (rowsDataAfterReorder.length === lengthIsDeployed) {
                for (var idxDeployed = 0; idxDeployed < lengthIsDeployed; idxDeployed++) {
                  var treeNode = that.createtreeNode(resultIsDeployed[idxDeployed].treeNodeData);
                  if (treeNode) {
                    treeNode.addGridAttributes({ isDeployed: resultIsDeployed[idxDeployed].isDeployed });
                    listOfnodeTree.push(treeNode);
                  }
                }
                that.removeNodesOfType(type);
                that.addChild(listOfnodeTree);
              }

              that.displayNotifications({
                level: 'info',
                message: Nls.orderParameters,
                title: Nls.orderParametersTitle
              });
              Mask.unmask(that.treeListView.elements.body);
            }).catch(function (rejectMessages) {
              that.displayNotifications({
                level: 'error',
                message: Nls.orderParametersError,
                title: Nls.orderParametersTitle
              });
              console.error(rejectMessages);
              Mask.unmask(that.treeListView.elements.body);
            });

          }).catch(function (errorMessage) {

            that.displayNotifications({
              level: 'error',
              message: Nls.orderParametersSetError,
              title: Nls.orderParametersTitle
            });
            console.error(errorMessage);
            Mask.unmask(that.treeListView.elements.body);
          });

          if (bUpdateForDelete) {
            that.displayNotifications({
              level: 'info',
              message: layoutViewNls.deleteParameter,
              title: layoutViewNls.deleteParameterTitle
            });
          }

        }).catch(function (errorMessage) {
          that.displayNotifications({
            level: 'error',
            message: Nls.orderParametersDeleteError,
            title: Nls.orderParametersTitle
          });
          console.error(errorMessage);
          Mask.unmask(that.treeListView.elements.body);
        });

      },

      /*
       * _getDeleteParameterPromises
       */
      _getDeleteParameterPromises: function _getDeleteParameterPromises(dataObjectsToDelete) {
        var that = this;
        var promisesDeleteParams = [];
        for (var idxRow = 0; idxRow < dataObjectsToDelete.length; idxRow++) {
          var rowNumber = idxRow + 1;
          dataObjectsToDelete[idxRow][that._CONSTANTS.COLUMNIDS.ROWINDEX] = rowNumber.toString();
          var promiseDeleteParams = new Promise(function (resolve, reject) {
            var dataObject = dataObjectsToDelete[idxRow];
            DELConfigurationParameterizationWebServices.deleteParameter(that._domainID, that._familyID, that._paramID, that._argID, dataObject, {
              onSuccess: function (data) {
                resolve(dataObject);
              },
              onFailure: function (error) {
                reject("DELConfigurationParameterizationWebServices.deleteParameter");
                console.error("DELConfigurationParameterizationWebServices.deleteParameter");
              }
            });
          });
          promisesDeleteParams.push(promiseDeleteParams);
        }
        return promisesDeleteParams;
      },

      /*
       * _getSetParamsPromises
       */
      _getSetParamsPromises: function _getSetParamsPromises(dataObjectsToSetParams) {
        var that = this
        var promisesSetParams = [];
        for (var idxRow = 0; idxRow < dataObjectsToSetParams.length; idxRow++) {
          var rowNumber = idxRow + 1;
          dataObjectsToSetParams[idxRow][that._CONSTANTS.COLUMNIDS.ROWINDEX] = rowNumber.toString();
          var promiseSetParams = new Promise(function (resolve, reject) {
            var dataObject = dataObjectsToSetParams[idxRow];
            DELConfigurationParameterizationWebServices.setParameters(that._domainID, that._familyID, that._paramID, that._argID, dataObject, {
              onSuccess: function (data) {
                resolve(dataObject);
              },
              onFailure: function (error) {
                reject("DELConfigurationParameterizationWebServices.setParameters");
                console.error("DELConfigurationParameterizationWebServices.setParameters");
              }
            });
          });
          promisesSetParams.push(promiseSetParams);
        }
        return promisesSetParams;
      },

      /*
       * _getIsDeployedPromises
       */
      _getIsDeployedPromises: function _getIsDeployedPromises(dataObjectsToCheckIsDeployed) {
        var that = this;
        var promisesIsDeployed = [];
        for (var idxRow = 0; idxRow < dataObjectsToCheckIsDeployed.length; idxRow++) {
          var rowNumber = idxRow + 1;
          dataObjectsToCheckIsDeployed[idxRow][that._CONSTANTS.COLUMNIDS.ROWINDEX] = rowNumber.toString();
          var promiseIsDeployed = new Promise(function (resolve, reject) {
            var dataObject = dataObjectsToCheckIsDeployed[idxRow];
            if (dataObject) {
              DELConfigurationParameterizationWebServices.isDeployed(that._domainID, that._familyID, that._paramID, that._argID, dataObject, {
                onSuccess: function (data) {
                  resolve({ treeNodeData: dataObject, isDeployed: data });
                },
                onFailure: function (error) {
                  reject("DELConfigurationParameterizationWebServices.isDeployed");
                  console.error("DELConfigurationParameterizationWebServices.isDeployed");
                }
              });
            }
          });
          promisesIsDeployed.push(promiseIsDeployed);
        }
        return promisesIsDeployed;
      },

      /*
       * getRowsDataForType
       */
      getRowsDataForType: function getRowsDataForType(type) {
        var that = this;
        var dataObjects = [];
        var colId = that.treeListView.layout.getColumnIndex(that._CONSTANTS.COLUMNIDS.CORPUSTYPE);
        var numberofRows = that.treeListView.getRowModelLength();
        for (var rowIndex = 0; rowIndex < numberofRows; rowIndex++) {
          var cellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: rowIndex, columnID: colId })
          var cellInfos = that.treeListView.getCellInfosAt(cellId);
          if (cellInfos && cellInfos.nodeModel.options.data[that._CONSTANTS.COLUMNIDS.CORPUSTYPE] === type) {
            var rowData = {};
            if (cellInfos != undefined && cellInfos.nodeModel != undefined && cellInfos.nodeModel.options != undefined &&
              cellInfos.nodeModel.options.data != undefined) {
              var uiElementsIDLength = that._uiElementsIDs.length;
              for (var i = 0; i < uiElementsIDLength; i++) {
                var columnName = that._uiElementsIDs[i].id;
                if (cellInfos.nodeModel.options.data[columnName] != undefined) {
                  var cellvalue = cellInfos.nodeModel.options.data[columnName];
                  rowData[columnName] = cellvalue;
                }
              }
              if (cellInfos.nodeModel.options.data[that._CONSTANTS.COLUMNIDS.ENTITY_TYPE] != undefined) {
                var cellvalue = cellInfos.nodeModel.options.data[that._CONSTANTS.COLUMNIDS.ENTITY_TYPE];
                rowData[that._CONSTANTS.COLUMNIDS.ENTITY_TYPE] = cellvalue;
              }
              if (cellInfos.nodeModel.options.data[that._CONSTANTS.COLUMNIDS.TYPE_NAME] != undefined) {
                var cellvalue = cellInfos.nodeModel.options.data[that._CONSTANTS.COLUMNIDS.TYPE_NAME];
                rowData[that._CONSTANTS.COLUMNIDS.TYPE_NAME] = cellvalue;
              }
            }

            dataObjects.push(rowData);
          }
        }
        return dataObjects;
      },

      /*
       * removeNodesOfType
       */
      removeNodesOfType: function removeNodesOfType(type) {
        var that = this;
        var nodesToRemove = [];
        var colId = that.treeListView.layout.getColumnIndex(that._CONSTANTS.COLUMNIDS.CORPUSTYPE);
        var numberofRows = that.treeListView.getRowModelLength();
        for (var rowIndex = 0; rowIndex < numberofRows; rowIndex++) {
          var cellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: rowIndex, columnID: colId })
          var cellInfos = that.treeListView.getCellInfosAt(cellId);
          if (cellInfos && cellInfos.nodeModel.options.data[that._CONSTANTS.COLUMNIDS.CORPUSTYPE] === type) {
            nodesToRemove.push(cellInfos.nodeModel);
          }
        }
        nodesToRemove.forEach(node => {
          var treeDoc = that.treeListView.treeDocument;
          if (treeDoc != undefined)
            treeDoc.removeRoot(node);
        });
      },

      /*
       * IsTableModifiedForType
       */
      IsTableModifiedForType: function IsTableModifiedForType(type) {
        var that = this;
        var bTableModified = false;
        var nbRowsofThisType = 0;
        var colId = that.treeListView.layout.getColumnIndex(that._CONSTANTS.COLUMNIDS.CORPUSTYPE);
        var numberofRows = that.treeListView.getRowModelLength();
        for (var idxRow = 0; idxRow < numberofRows; idxRow++) {
          var cellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: idxRow, columnID: colId })
          var cellInfos = that.treeListView.getCellInfosAt(cellId);
          if (cellInfos && cellInfos.nodeModel.options.data[that._CONSTANTS.COLUMNIDS.CORPUSTYPE] === type) {
            var rowIndex = cellInfos.nodeModel.options.data[that._CONSTANTS.COLUMNIDS.ROWINDEX];
            if (parseInt(rowIndex) != nbRowsofThisType + 1) {
              bTableModified = true;
              break;
            }
            nbRowsofThisType = nbRowsofThisType + 1;
          }
        }
        return bTableModified;
      },

      /* 
      * buildModal
      */
      buildModal: function buildModal(bEditMod) {
        var that = this;
        that._parent(bEditMod);

        var comboAttributeKeys = document.getElementById(that._CONSTANTS.COLUMNIDS.ATTRIBUTE);
        comboAttributeKeys.dsModel.disabled = true;
        comboAttributeKeys.dsModel.elementsList = [];
        comboAttributeKeys.dsModel.selectedIndex = -1;
      },

      /*
      * presetModal
      */
      presetModal: function presetModal(node) {
        console.log("presetModal");
        var that = this;

        var nodeType = node.getData();

        var promise = new UWA.Promise(function (resolve, reject) {
          if (that._typeResult == null || that._typeResult == undefined || that._typeResult[nodeType.corpusType] === undefined || that._typeResult[nodeType.corpusType] === null) {
            if (that._typeResult == null || that._typeResult == undefined)
              that._typeResult = [];

            var listOfTypes = that._listTypes[nodeType.corpusType];

            //loader
            var loader = new WUXLoader({ height: 22 });
            loader.on(Nls.Loading);

            var comboCorpusTypes = document.getElementById(that._CONSTANTS.COLUMNIDS.CORPUSTYPE);
            var comboAttributeKeys = document.getElementById(that._CONSTANTS.COLUMNIDS.ATTRIBUTE);


            //loader
            var loader = new WUXLoader({ height: 22 });
            loader.on(Nls.Loading);

            var parentNodeTypeContainer = comboCorpusTypes.getParent();
            parentNodeTypeContainer.style.position = "sticky";
            WUXModalContainer.createModal(parentNodeTypeContainer/*, loader.elements.container*/);

            var parentNodeKeysContainer = comboAttributeKeys.getParent();
            parentNodeKeysContainer.style.position = "sticky";
            WUXModalContainer.createModal(parentNodeKeysContainer, loader.elements.container);

            ParameterizationDEL3DOperationsViewerWebServices.getAttributesList(listOfTypes, {
              onSuccess: function (data) {
                that._readResponseAndPopulateData(nodeType.corpusType, data)

                loader.off();

                WUXModalContainer.removeModal(parentNodeTypeContainer);
                WUXModalContainer.removeModal(parentNodeKeysContainer);

                parentNodeTypeContainer.style.position = "";
                parentNodeKeysContainer.style.position = "";

                resolve();
              }
            });
          }
          else
            resolve();
        });

        UWA.Promise.all([promise]).then(function () {
          var attributesData = that._typeResult[nodeType.corpusType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES];
          that._updateAttributesListCombo(nodeType.corpusType, attributesData, true);
          DELConfigurationFamilyView.prototype.presetModal.call(that, node);
        });
      },


      /*
      * _updateAttributesListCombo
      */
      _updateAttributesListCombo: function _updateAttributesListCombo(i_corpusType, i_attributesData, bEditMode) {
        var that = this;

        var listForCombo = [];
        var attributesList = [];
        var listAttributesAlredyDefined = that._getListOfAttributesAlreadyDefinedForType(i_corpusType);
        var typekeys = Object.keys(i_attributesData);
        var typekeysLength = typekeys.length;
        for (var i = 0; i < typekeysLength; i++) {
          var typekey = typekeys[i];
          if (typekey && i_attributesData[typekey]) {
            var typeObj = i_attributesData[typekey];
            var attributekeys = Object.keys(typeObj);

            var attributekeysLength = attributekeys.length;
            for (var idxAttr = 0; idxAttr < attributekeysLength; idxAttr++) {
              var attributekey = attributekeys[idxAttr];
              var attrObj = typeObj[attributekey];
              var attr = typekey + '.' + attributekey;
              if ((!attributesList.includes(attr) && !listAttributesAlredyDefined.includes(attr)) || 
              (bEditMode && that._node != null && that._node.getData().hasOwnProperty(that._CONSTANTS.COLUMNIDS.ATTRIBUTE) && that._node.getData()[that._CONSTANTS.COLUMNIDS.ATTRIBUTE] == attr)) {
                attributesList.push(attr);
                var comboLabel = attrObj.NLSName + ' (' + attrObj.Owner + '.' + attributekey + ')';
                var comboValue = attrObj.Owner + '.' + attributekey;
                listForCombo.push({ label: comboLabel, value: comboValue });
              }
            }
            if (listForCombo.length) {
              listForCombo.sort(function (comboValue1, comboValue2) {
                if (comboValue1.label.toLowerCase() === comboValue2.label.toLowerCase())
                  return 0;
                return comboValue1.label.toLowerCase() > comboValue2.label.toLowerCase() ? 1 : -1;
              });
            }
          }
        }

        var attributeEntriesListLength = listForCombo.length;
        if (attributeEntriesListLength > 0) {
          var comboAttributeKeys = document.getElementById(that._CONSTANTS.COLUMNIDS.ATTRIBUTE);
          comboAttributeKeys.dsModel.disabled = false;
          comboAttributeKeys.dsModel.elementsList = listForCombo;
        }

      },

      _getListOfAttributesAlreadyDefinedForType: function _getListOfAttributesAlreadyDefinedForType(i_corpusType) {
        var that = this;
        var listDefinedAttributes = [];
        var treeDoc = that.treeList.dataGridView.treeDocument;
        if (treeDoc) {
          var children = treeDoc.getChildren();
          var childrenLength = children.length;
          for (var idxChild = 0; idxChild < childrenLength; idxChild++) {

            var child = children[idxChild];
            if (child && child.options != undefined &&  child.options != null && child.options.data != undefined &&  
              child.options.data != null && child.options.data.hasOwnProperty(that._CONSTANTS.COLUMNIDS.ATTRIBUTE)  && 
              child.options.data[that._CONSTANTS.COLUMNIDS.ATTRIBUTE] != "" && child.options.data[that._CONSTANTS.COLUMNIDS.CORPUSTYPE] === i_corpusType) {
                listDefinedAttributes.push(child.options.data[that._CONSTANTS.COLUMNIDS.ATTRIBUTE]);
            }
          }
        }
        return listDefinedAttributes;
      },
      /*
      * createtreeNode
      */
      createtreeNode: function createtreeNode(data, grid) {
        var that = this;

        if (data[that._CONSTANTS.COLUMNIDS.CORPUSTYPE] && grid != undefined && grid[that._CONSTANTS.COLUMNIDS.CORPUSTYPE] && data[that._CONSTANTS.COLUMNIDS.ROWINDEX] == undefined && grid[that._CONSTANTS.COLUMNIDS.ROWINDEX] == undefined) {
          var computedRowIndex = that._computeRowIndexForType(data[that._CONSTANTS.COLUMNIDS.CORPUSTYPE]);
          var attributeFullName = data[that._CONSTANTS.COLUMNIDS.ATTRIBUTE];
          var corpusType = data[that._CONSTANTS.COLUMNIDS.CORPUSTYPE];
          if (attributeFullName != undefined && attributeFullName.includes(".")) {
            var ownerName = attributeFullName.split(".")[0];
            var attributeName = attributeFullName.split(".")[1];
            var attrObject = that._typeResult[corpusType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][ownerName][attributeName];
            var strEntityTpye = attrObject.EntityType;
            var strTypeName = attrObject.TypeName;
            var rowIndex = null;
            if (that._bEditMode && that._node != undefined && that._node.getData() != undefined && that._node.getData()[that._CONSTANTS.COLUMNIDS.ROWINDEX] != undefined) {
              rowIndex = that._node.getData()[that._CONSTANTS.COLUMNIDS.ROWINDEX];
              strEntityTpye = that._node.getData()[that._CONSTANTS.COLUMNIDS.ENTITY_TYPE];
              strTypeName = that._node.getData()[that._CONSTANTS.COLUMNIDS.TYPE_NAME];
            }
            else
              rowIndex = computedRowIndex.toString();

            data[that._CONSTANTS.COLUMNIDS.ROWINDEX] = rowIndex;
            grid[that._CONSTANTS.COLUMNIDS.ROWINDEX] = rowIndex;

            data[that._CONSTANTS.COLUMNIDS.ENTITY_TYPE] = strEntityTpye;
            grid[that._CONSTANTS.COLUMNIDS.ENTITY_TYPE] = strEntityTpye;

            if (strTypeName.trim().length != 0) {
              data[that._CONSTANTS.COLUMNIDS.TYPE_NAME] = strTypeName;
              grid[that._CONSTANTS.COLUMNIDS.TYPE_NAME] = strTypeName;
            }
          }
        }

        var translationModel = new DELConfigurationParamTranslationModel({
          data: data,
          grid: grid,
          nls: Nls
        });

        return translationModel;
      },

      /*
      * addChild
      */
      addChild: function addChild(nodesTab) {
        var that = this;
        var nodes = nodesTab;
        //if (that._typeResult == null) {
          UWA.Promise.all([that.getPromiseToUpdateNLS(nodesTab)]).then(function () {
            var numberofNodes = nodes.length;
            if (numberofNodes > 0) {
              for (var nodeIndex = 0; nodeIndex < numberofNodes; nodeIndex++) {
                var nodeData = (nodes[nodeIndex]).getData();
                var nodeGrid = (nodes[nodeIndex]).getGrid();
                if (nodeData.hasOwnProperty(that._CONSTANTS.COLUMNIDS.ATTRIBUTE)) {
                  // We only store actual attribute name in DB, to display we need to construct the NLS name and set it on the grid of DataGrid model.
                  if (that._nlsResult != null && that._nlsResult != undefined && nodeGrid != undefined && nodeGrid.hasOwnProperty(that._CONSTANTS.COLUMNIDS.ATTRIBUTE)) {
                    if (nodeData[that._CONSTANTS.COLUMNIDS.ATTRIBUTE] != undefined && nodeData[that._CONSTANTS.COLUMNIDS.ATTRIBUTE].includes('.')) {
                      var storedAttributeName = nodeData[that._CONSTANTS.COLUMNIDS.ATTRIBUTE];
                      if (that._nlsResult.hasOwnProperty(storedAttributeName)) {
                        var displayLabel = that._nlsResult[storedAttributeName] + ' (' + storedAttributeName + ')';
                        nodeGrid[that._CONSTANTS.COLUMNIDS.ATTRIBUTE] = displayLabel;
                      }
                    }
                  }
                }
              }
            }
            DELConfigurationFamilyView.prototype.addChild.call(that, nodesTab);
            that.treeListView.sortModel = [{ dataIndex: that._CONSTANTS.COLUMNIDS.CORPUSTYPE, sort: '' }];
            that.treeListView.reapplySortModel();
          });
        // }
        // else {
        //   that._parent(nodesTab);
        //   that.treeListView.sortModel = [{ dataIndex: that._CONSTANTS.COLUMNIDS.CORPUSTYPE, sort: '' }];
        //   that.treeListView.reapplySortModel();
        // }
      },

      /*
      * _computeRowIndexForType
      */
      _computeRowIndexForType: function _computeRowIndexForType(type) {
        var that = this;

        var computedIndex = 0;
        var numberOfRowsAlreadyPresentForType = 0;
        try {
          var colId = that.treeListView.layout.getColumnIndex(that._CONSTANTS.COLUMNIDS.CORPUSTYPE);
          var rowModelLength = that.treeListView.getRowModelLength();
          if (rowModelLength) {
            for (var rowIndex = 0; rowIndex < rowModelLength; rowIndex++) {
              var cellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: rowIndex, columnID: colId })
              var cellInfos = that.treeListView.getCellInfosAt(cellId);
              if (cellInfos && cellInfos.nodeModel.options.data[that._CONSTANTS.COLUMNIDS.CORPUSTYPE] === type) {
                numberOfRowsAlreadyPresentForType = numberOfRowsAlreadyPresentForType + 1;
              }
            }
          }
        } catch (error) {
        }
        computedIndex = numberOfRowsAlreadyPresentForType + 1;
        return computedIndex;
      },

      /*
      * mapFunctions
      */
      mapFunctions: function mapFunctions(name) {
        var that = this;
        if (name === "onChangeCorpusTypeCombo")
          return that.onChangeTypeClick.bind(that);
        else return null;
      },

      /*
      * onOKEditButtonClick
      */
      onOKEditButtonClick: function onOKEditButtonClick() {
      var that = this;
      that._bEditMode = true;
      that._parent();
      that._bEditMode = false;
      },

      /*
      * onOKButtonClick
      */
      onOKButtonClick: function onOKButtonClick() {
        var that = this;
        that._parent();
      },

      /*
      * onCancelButtonClick
      */
      onCancelButtonClick: function onCancelButtonClick() {
        var that = this;
        that._parent();
        that._bEditMode = false;
      },

      /*
      * onChangeTypeClick
      */
      onChangeTypeClick: function onChangeTypeClick(type) {
        var that = this;

        var corpusType = null;
        if (type.dsModel != null || type.dsModel != undefined)
          corpusType = ((type.dsModel.elementsList[type.dsModel.selectedIndex].value));

        var comboAttributeKeys = document.getElementById(that._CONSTANTS.COLUMNIDS.ATTRIBUTE);
        comboAttributeKeys.dsModel.disabled = true;
        comboAttributeKeys.dsModel.elementsList = [];
        comboAttributeKeys.dsModel.selectedIndex = -1;


        if (that._typeResult === null || that._typeResult[corpusType] === undefined) {
          if (that._typeResult === null)
            that._typeResult = [];

          var listOfTypes = that._listTypes[corpusType]

          //loader
          var loader = new WUXLoader({ height: 22 });
          loader.on(Nls.Loading);

          var parentNodeKeysContainer = comboAttributeKeys.getParent();
          parentNodeKeysContainer.style.position = "sticky";
          WUXModalContainer.createModal(parentNodeKeysContainer, loader.elements.container);


          ParameterizationDEL3DOperationsViewerWebServices.getAttributesList(listOfTypes, {
            onSuccess: function (data) {
              loader.off();
              WUXModalContainer.removeModal(parentNodeKeysContainer);

              parentNodeKeysContainer.style.position = "";

              that._readResponseAndPopulateData(corpusType,data)
              var attributesData = that._typeResult[corpusType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES];
              that._updateAttributesListCombo(corpusType, attributesData, that._bEditMode);
            },
            onFailure: function (err) {
              loader.off();
              WUXModalContainer.removeModal(parentNodeKeysContainer);

              parentNodeKeysContainer.style.position = "";

              that.displayNotifications({
                level: 'error',
                message: Nls.getAttributesListError,
                title: Nls.getAttributesListTitle
              });
            }
          });
        }
        else {
          var attributesData = that._typeResult[corpusType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES];
          that._updateAttributesListCombo(corpusType, attributesData, that._bEditMode);
        }
      },


      /*
      * Function to read response from getAttributes web service and create local lists for attributes and types 
      */
      _readResponseAndPopulateData: function _readResponseAndPopulateData(corpusType,data) {
        var that = this;
        if (that._typeResult === null)
          that._typeResult = [];

        var typekeys = Object.keys(data);
        typekeys.forEach(iType => {

          var dataType = corpusType;


          if (that._typeResult[dataType] === undefined)
            that._typeResult[dataType] = {};

          var dicotypekeys = Object.keys(data[iType]);
          dicotypekeys.forEach(dicoType => {
            var attrKeys = Object.keys(data[iType][dicoType]);
            attrKeys.forEach(attrKey => {

              if (that._typeResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES] === undefined)
                that._typeResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES] = {};

              var attrObj = data[iType][dicoType][attrKey];


              if (attrKey !== "DicoType") {
                if (attrObj.Owner != dicoType) {
                  if (that._typeResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][attrObj.Owner] === undefined)
                    that._typeResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][attrObj.Owner] = {};

                  that._typeResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][attrObj.Owner][attrKey] = attrObj;
                }
                else {
                  if (that._typeResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType] === undefined)
                    that._typeResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType] = {};

                  that._typeResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType][attrKey] = attrObj;
                }
              }

            });
          });
        });
      },

      /*
      * removeSelectedNode
      */
      removeSelectedNode: function removeSelectedNode(params) {
        console.log("params " + params);
        var that = this;
        var node = params.context.nodeModel;
        var nodeData = node.getData();

        var type = nodeData[that._CONSTANTS.COLUMNIDS.CORPUSTYPE];
        var rowDataObjectsBeforeDelete = that.getRowsDataForType(type)
        var nbRowsPresentForThisType = rowDataObjectsBeforeDelete.length;
        if (nodeData[that._CONSTANTS.COLUMNIDS.ROWINDEX] != undefined && nodeData[that._CONSTANTS.COLUMNIDS.ROWINDEX] != nbRowsPresentForThisType) {
          var treeDoc = params.configurationLayoutView.treeList.dataGridView.treeDocument;
          if (treeDoc)
            treeDoc.removeRoot(node);
          var rowDataObjectsAfterDelete = that.getRowsDataForType(type)
          var bUpdateRequiredAfterDelete = true;
          that._UpdateParameters(type, rowDataObjectsBeforeDelete, rowDataObjectsAfterDelete, bUpdateRequiredAfterDelete);
        }
        else
          that._parent(params);
      },

      /*
      * editSelectedNode
      */
      editSelectedNode: function editSelectedNode(params) {
        console.log("params " + params);
        var that = this;
        that._bEditMode = true;
        that._parent(params);
      },

      /*
      * toJSON // This method is required for reorder, since reorder needs the data to be convererted to json string
      */
      toJSON() {
        return {
          editSelectedNode: this.editSelectedNode,
          removeSelectedNode: this.removeSelectedNode,
        };
      }
    });
    return DEL3DOperationsViewerConfigFamilyView;
  });

/**
* @quickreview  ROW 22:11:08 creation
*/

define('DS/ParameterizationSkeleton/Views/PPRSynchronizationLifeCycle/DELLifeCycleRulesFamilyView',
[
  'UWA/Core',
  'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
  'DS/ParameterizationSkeleton/Utils/DELConfigurationParameterization/DELConfigurationParameterizationWebServices',
  'DS/Controls/ModalContainer',
  'DS/Controls/Loader',
  'DS/ParameterizationSkeleton/Model/DELConfigurationParameterizationModel/DELConfigurationParamTranslationModel',
  'DS/UIKIT/Mask',
  'DS/WAFData/WAFData',
  'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
  'i18n!DS/ParameterizationSkeleton/assets/nls/DELConfigurationLayoutView',
  'i18n!DS/ParameterizationSkeleton/assets/nls/DELLifeCycleRulesModalView',
  'i18n!DS/ParameterizationSkeleton/assets/nls/DELLifeCycleRulesTreeListView',
  'i18n!DS/ParameterizationSkeleton/assets/nls/DELLifeCycleRulesNodeTreeView'
],
function (
  UWA,
  DELConfigurationFamilyView,
  DELConfigurationParameterizationWebServices,
  WUXModalContainer,
  WUXLoader,
  DELConfigurationParamTranslationModel,
  Mask,
  WAFData,
  URLHandler,
  Nls,
  DELLifeCycleRulesModalViewNls,
  DELLifeCycleRulesTreeListViewNls,
  DELLifeCycleRulesNodeTreeViewNls
)
{

  'use strict';

  var DELLifeCycleRulesFamilyView = DELConfigurationFamilyView.extend({

    _typeResult : null,
    _node : null,
    _bEditMode : false,

    /*
    * init
    */
    init : function init(options)
    {
      var that = this;
      this._parent(options);

      that._treeListViewNls = DELLifeCycleRulesTreeListViewNls;
      that._modalViewNls = DELLifeCycleRulesModalViewNls;
      that._nodeTreeViewNls = DELLifeCycleRulesNodeTreeViewNls;
    },

    /*
    * render
    */
    render : function render()
    {
      var that = this;
      this._parent();

      return this;
    },

    /*
    * buildModal
    */
    buildModal : function buildModal(bEditMod)
    {
      var that = this;
      this._parent(bEditMod);
      var comboTypes = document.getElementById("Type");
      var comboLCRules = document.getElementById("LifeCycleRules");
      if(bEditMod){

        comboTypes.dsModel.disabled = true;
        comboLCRules.dsModel.disabled = true;
      }
      else{
        var typeElementsList = comboTypes.dsModel.elementsList;
        var nbTypes = typeElementsList.length;
        var updatedtypeElementsList = [];
        for(var idxTypeElem =0; idxTypeElem < nbTypes; idxTypeElem++){
          var typeElem = typeElementsList[idxTypeElem];
          var count =0;
          var treeDoc = that.treeList.dataGridView.treeDocument;
          if (treeDoc){
            var children = treeDoc.getChildren();
            var childrenLength = children.length;
            for (var idxChild=0;idxChild<childrenLength;idxChild++){

              var child = children[idxChild];
              if(child && typeElem && typeElem.value != undefined && child.options.data.Type === typeElem.value){
                count = count+1;
              }
            }
          }
          if(count < 2)
            updatedtypeElementsList.push(typeElem);
        }
        comboTypes.dsModel.elementsList = updatedtypeElementsList;
        comboTypes.dsModel.enableSearchFlag = false;
      }
    },

    /*
    * presetModal
    */
    presetModal : function presetModal(node)
    {
      console.log("presetModal");
      var that = this;
      this._parent(node);

    },

      /*
      * addChild
      */
      addChild : function addChild(nodesTab)
      {
        var that = this;
        that._parent(nodesTab);
      },

      /*
      * mapFunctions
      */
      mapFunctions: function mapFunctions(name)
      {
         var that = this;
         if (name === "onChangeTypeCombo")
           return that.onChangeTypeClick.bind(that);
         if (name === "onChangeLifeCycleRuleCombo")
           return that.onChangeLifeCycleRuleClick.bind(that);
        // if (name === "getCellKeysSemantics")
        //   return that.getCellKeysSemantics.bind(that)
        // if (name === "getCellAttributesSemantics")
        //   return that.getCellAttributesSemantics.bind(that)
        // else return null;
      },

      /*
      * validateModal
      */
      validateModal : function validateModal()
      {
        var that = this;
        console.log("validateModal");
        var treeNodesList = [];
        var uiElementsIDLength = that._uiElementsIDs.length;
        var uiElementsID = that._uiElementsIDs;
        if(uiElementsIDLength > 1 && that._uiElementsIDs[0].id === "Type" && that._uiElementsIDs[0].type === "multiselcombobox"){
          var uiTypeEl = document.getElementById(that._uiElementsIDs[0].id);
          if(uiTypeEl && uiTypeEl.dsModel.label != undefined && uiTypeEl.dsModel.label != null && uiTypeEl.dsModel.label != ""){

            var typeElementData = uiTypeEl.dsModel.value;
            var typeElementLabels = uiTypeEl.dsModel.label.split(",");

            var typeElementDataLength = typeElementData.length;
            var bOneCommandSelected = false;
            for(var idxType =0; idxType < typeElementDataLength; idxType++){

              var data = new Map();
              var grid = new Map();

              data.set(uiTypeEl.id, typeElementData[idxType]);
              grid.set(uiTypeEl.id, typeElementLabels[idxType]);

              for (var i=1;i<uiElementsIDLength;i++)
              {
                var uiEl = document.getElementById(that._uiElementsIDs[i].id);
                if (uiEl)
                {
                  if (uiEl.dsModel.checkFlag != undefined || uiEl.dsModel.checkFlag != null)
                  {
                    data.set(that._uiElementsIDs[i].id, uiEl.dsModel.checkFlag);
                    grid.set(that._uiElementsIDs[i].id, uiEl.dsModel.checkFlag);
                    if(uiEl.dsModel.checkFlag === true)
                      bOneCommandSelected = uiEl.dsModel.checkFlag;
                  }
                  else
                  {
                    if (that._uiElementsIDs[i].mandatory === true)
                    {
                      var bMandatoryField = false;
                      if (that._uiElementsIDs[i].type != "combobox")
                      {
                        if (uiEl.dsModel.value != undefined && uiEl.dsModel.value != null && uiEl.dsModel.value != "")
                        {
                          bMandatoryField = true;
                          data.set(that._uiElementsIDs[i].id, uiEl.dsModel.value);
                          grid.set(that._uiElementsIDs[i].id, uiEl.dsModel.value);
                        }
                      }
                      else {
                        if (uiEl.dsModel.label != undefined && uiEl.dsModel.label != null && uiEl.dsModel.label != "")
                        {
                          bMandatoryField = true;
                          data.set(that._uiElementsIDs[i].id, uiEl.dsModel.value);//uiEl.dsModel.label);
                          grid.set(that._uiElementsIDs[i].id, uiEl.dsModel.label);
                        }
                      }

                      if (!bMandatoryField) {
                        var mandatoryCol = that._treeListViewNls[that._uiElementsIDs[i].id];
                        var nlsErrorMsg = Nls.columnMandatory;
                        nlsErrorMsg = nlsErrorMsg.replace("%1", mandatoryCol);
                        that._modalView.showToastMessage(2, nlsErrorMsg);
                        return;
                      }
                    }
                    else
                    {
                      if (that._uiElementsIDs[i].type != "combobox")
                      {
                        data.set(that._uiElementsIDs[i].id, uiEl.dsModel.value);
                        grid.set(that._uiElementsIDs[i].id, uiEl.dsModel.value);
                      }
                      else
                      {
                        data.set(that._uiElementsIDs[i].id, uiEl.dsModel.value);//uiEl.dsModel.label);
                        grid.set(that._uiElementsIDs[i].id, uiEl.dsModel.label);
                      }
                    }
                  }
                }
              }
              if(!bOneCommandSelected){
                var nlsErrorMsg = that._modalViewNls.selectAtleastOneCommand;
                that._modalView.showToastMessage(2, nlsErrorMsg);
                return;
              }
              var objData = {};
              var objGrid = {};
              data.forEach(function(value, key){;
                if (value != "" && value != undefined)
                objData[key] = value;
              });

              grid.forEach(function(value, key){
                objGrid[key] = value;
              });


              var treeNodeModel = that.createtreeNode(objData, objGrid);
              treeNodesList.push(treeNodeModel);
            }
          }else {
            var mandatoryCol = that._treeListViewNls[that._uiElementsIDs[0].id];
            var nlsErrorMsg = Nls.columnMandatory;
            nlsErrorMsg = nlsErrorMsg.replace("%1", mandatoryCol);
            that._modalView.showToastMessage(2, nlsErrorMsg);
            return;
          }
        }
        if(treeNodesList.length === 1 && that._bEditMode)
          return treeNodesList[0];
        else
          return treeNodesList;
      },

      /*
      * onOKButtonClick
      */
      /*onOKButtonClick : function onOKButtonClick()
      {
        var that = this;
        var treeListNodes = that.validateModal(false);
        var nbNodesTobeAdded = treeListNodes.length;
        var promisesSetParams = [];
        var listParams = {};
        for(var idxNode=0; idxNode < nbNodesTobeAdded; idxNode++){
          var treeListNode = treeListNodes[idxNode];
          var dataObject = treeListNode.getData();
          var param = {domain:that._domainID, family:that._familyID, parameter:that._paramID,argument:that._argID, params:dataObject};
          listParams[idxNode] = param;
        }
        var contentDiv = "DELDatagridviewparam_DELMBOMLifeCycleRulesTreeListView";
        Mask.mask(that.treeListView.elements.body);
        DELConfigurationParameterizationWebServices.setParametersMulti(listParams, {
          onSuccess : function(dataParams)
          {
            DELConfigurationParameterizationWebServices.isDeployedMulti(listParams, {
                onSuccess : function(dataIsDeployed)
                {
                  var strResponse = JSON.stringify(dataIsDeployed);
                  var response = JSON.parse(strResponse);
                  for(var idxNode=0; idxNode < nbNodesTobeAdded; idxNode++){
                    var treeListNode = treeListNodes[idxNode];
                    //objNode.isDeployed = dataIsDeployed;
                    let type = "";
                    type = treeListNode.getData().Type;
                    const isDeployed = response[treeListNode.getData().Type];//[treeListNode.getData().Type];
                    treeListNode.addGridAttributes({isDeployed : isDeployed});
                  }
                  that.addChild(treeListNodes);

                  that.displayNotifications({
                    level: 'info',
                    message: Nls.setParameters,
                    title: Nls.setParametersTitle
                  });
                  Mask.unmask(that.treeListView.elements.body);
                },
                onFailure : function (err){
                  Mask.unmask(that.treeListView.elements.body);
                }
              });
          },
          onFailure : function (err)
          {
            that.displayNotifications({
              level: 'error',
              message: Nls.setParametersError,
              title: Nls.setParametersTitle
            });
            Mask.unmask(that.treeListView.elements.body);
          }
        });


      },*/
      /*
      * onOKButtonClick
      */
      onOKButtonClick : function onOKButtonClick4()
      {
        var that = this;
        var treeListNodes = that.validateModal(false);
        var nbNodesTobeAdded = treeListNodes.length;
        var promisesSetParams = [];
        Mask.mask(that.treeListView.elements.body);
        for(var idxNode=0; idxNode < nbNodesTobeAdded; idxNode++){


            var promiseSetParams = new Promise(function (resolve, reject){
              var treeListNode = treeListNodes[idxNode];
              if(treeListNode){
                var dataObject = treeListNode.getData();
              DELConfigurationParameterizationWebServices.setParameters(that._domainID, that._familyID, that._paramID, that._argID, dataObject,{
                onSuccess : function(data){
                  resolve(dataObject);
                },
                onFailure : function(error){
                  reject("DELConfigurationParameterizationWebServices.setParameters");
                  console.error("DELConfigurationParameterizationWebServices.setParameters");
                }
              });
            }
            });
            promisesSetParams.push(promiseSetParams);
        }

        UWA.Promise.all(promisesSetParams).then(function(typesSetParams) {

          // Check Deployment and update Tree
          var promisesIsDeployed = [];
          for(var idxNode=0; idxNode < nbNodesTobeAdded; idxNode++){

            var promiseIsDeployed = new Promise(function (resolve, reject){
              var treeListNode = treeListNodes[idxNode];
              if(treeListNode){
                var dataObject = treeListNode.getData();
                DELConfigurationParameterizationWebServices.isDeployed(that._domainID, that._familyID, that._paramID, that._argID, dataObject, {
                  onSuccess : function(data){
                    resolve({treeNode:treeListNode, isDeployed:data});
                  },
                  onFailure : function(error){
                    reject("DELConfigurationParameterizationWebServices.isDeployed");
                    console.error("DELConfigurationParameterizationWebServices.isDeployed");
                  }
                });
              }
            });
            promisesIsDeployed.push(promiseIsDeployed);

          }
          UWA.Promise.all(promisesIsDeployed).then(function(resultIsDeployed){

            var listOfnodeTree = [];
            var lengthIsDeployed = resultIsDeployed.length;
            for(var idxDeployed =0; idxDeployed < lengthIsDeployed; idxDeployed++){

              var treeListNode = resultIsDeployed[idxDeployed].treeNode;
              if(treeListNode){
                treeListNode.addGridAttributes({isDeployed : resultIsDeployed[idxDeployed].isDeployed});
                listOfnodeTree.push(treeListNode);
              }
            }
            that.addChild(listOfnodeTree);

            that.displayNotifications({
              level: 'info',
              message: Nls.setParameters,
              title: Nls.setParametersTitle
            });
            Mask.unmask(that.treeListView.elements.body);
          }).catch(function(rejectMessages){
            that.displayNotifications({
              level: 'error',
              message: Nls.setParametersError,
              title: Nls.setParametersTitle
            });
            console.error(rejectMessages);
            Mask.unmask(that.treeListView.elements.body);
          });


        }).catch(function(rejectMessages){

            that.displayNotifications({
              level: 'error',
              message: Nls.setParametersError,
              title: Nls.setParametersTitle
            });
            console.error(rejectMessages);
            Mask.unmask(that.treeListView.elements.body);

        });

      },


    /*
    * onOKEditButtonClick
    */
    onOKEditButtonClick : function onOKEditButtonClick()
    {
      var that = this;
      that._bEditMode = true;
      that._parent();
      that._bEditMode = false;
    },

    /*
    * onOKButtonClick
    */
    // onOKButtonClick : function onOKButtonClick()
    // {
    //   var that = this;
    //   that._parent();
    // },

    /*
    * onCancelButtonClick
    */
    onCancelButtonClick : function onCancelButtonClick()
    {
      var that = this;
      that._parent();
      that._bEditMode = false;
    },
    /*
    * onChangeTypeClick
    */
    onChangeTypeClick : function onChangeTypeClick(type)
    {
      var that = this;
      if(!that._bEditMode){
        var comboLCRules = document.getElementById("LifeCycleRules");

        var rulesComboElements = comboLCRules.dsModel.elementsList;

        comboLCRules.dsModel.disabled = true;
        comboLCRules.dsModel.elementsList = [];
        comboLCRules.dsModel.selectedIndex = -1;

        var rules = ['LC_ResultingProduct','LC_ExpandMbomStructure'];
        var typeElementData = type.dsModel.value;
        var typeElementLabels = type.dsModel.label.split(",");
        var nbTypes = typeElementData.length;
        var updatedtypeElementsList = [];
        for(var idxTypeElem =0; idxTypeElem < nbTypes; idxTypeElem++){
          var type = typeElementData[idxTypeElem];

          var treeDoc = that.treeList.dataGridView.treeDocument;
          if (treeDoc){
            var children = treeDoc.getChildren();
            var childrenLength = children.length;
            for (var idxChild=0;idxChild<childrenLength;idxChild++){

              var child = children[idxChild];
              if(child && type  && child.options.data.Type === type){

                var idxRule = rules.findIndex((element)=>element === child.options.data.LifeCycleRules);
                if(idxRule != -1)
                rules.splice(idxRule, 1);
              }
            }

          }
        }
        if(rules.length){
          var ruleElementList = [];
          for (var idxRule=0;idxRule<rules.length;idxRule++)
          {
            var element = {};
            if (that._nodeTreeViewNls != null && that._nodeTreeViewNls[rules[idxRule]] != null && that._nodeTreeViewNls[rules[idxRule]] != undefined)
            element = {label: that._nodeTreeViewNls[rules[idxRule]], value: rules[idxRule]};
            else
            element = {label: rules[idxRule], value: rules[idxRule]};
            ruleElementList.push(element);
          }
          comboLCRules.dsModel.elementsList = ruleElementList;
          comboLCRules.dsModel.disabled = false;
        }
        else{
          var nlsErrorMsg = that._modalViewNls.rulesAlreadyDefined;
          that._modalView.showToastMessage(2, nlsErrorMsg);
        }
      }
    },
    onChangeLifeCycleRuleClick : function onChangeLifeCycleRuleClick(type)
    {
      var that = this;
    },

    /*
    * onChangeTypeClick
    */
    // onChangeTypeClick : function onChangeTypeClick(type)
    // {
    //   var that = this;
    //
    //   var types = null;
    //   if (type.dsModel != null || type.dsModel != undefined)
    //     types = type.dsModel.elementsList[type.dsModel.selectedIndex].value;
    //
    //   var comboAttributeKeys = document.getElementById("keys");
    //   comboAttributeKeys.dsModel.disabled = true;
    //   comboAttributeKeys.dsModel.elementsList = [];
    //   comboAttributeKeys.dsModel.selectedIndex = -1;
    //
    //   var comboAttributes = document.getElementById("attributes");
    //   comboAttributes.dsModel.disabled = true;
    //   comboAttributes.dsModel.elementsList = [];
    //   comboAttributes.dsModel.selectedIndex = -1;
    //
    //   if (that._typeResult ===  null || that._typeResult[types] === undefined)
    //   {
    //     if (that._typeResult ===  null)
    //       that._typeResult = [];
    //
    //     var listOfTypes = [];
    //     listOfTypes.push(types);
    //
    //     //loader
    //     var loader = new WUXLoader({height : 22});
    //     loader.on(PPRSynchroLifeCycleNLS.Loading);
    //
    //     var parentNodeKeysContainer = comboAttributeKeys.getParent();
    //     parentNodeKeysContainer.style.position = "sticky";
    //     WUXModalContainer.createModal(parentNodeKeysContainer, loader.elements.container);
    //
    //     var parentNodeAttrContainer = comboAttributes.getParent();
    //     parentNodeAttrContainer.style.position = "sticky";
    //     WUXModalContainer.createModal(parentNodeAttrContainer/*, loader.elements.container*/);
    //
    //      ParameterizationApriso3DExpWebServices.getlistofDELMIATypes(listOfTypes, {
    //        onSuccess : function(data)
    //        {
    //          loader.off();
    //          WUXModalContainer.removeModal(parentNodeKeysContainer);
    //          WUXModalContainer.removeModal(parentNodeAttrContainer);
    //
    //          parentNodeKeysContainer.style.position = "";
    //          parentNodeAttrContainer.style.position = "";
    //
    //          that._typeResult[types] = data;
    //
    //          var keysList = [];
    //          var keys = Object.keys(data);
    //          var keysLength = keys.length;
    //          for (var i=0;i<keysLength;i++)
    //          {
    //            var key = keys[i];
    //            if (key)
    //              keysList.push({label: key, value: key});
    //          }
    //
    //          var keysListLength = keysList.length;
    //          if (keysListLength > 0)
    //          {
    //            //var comboAttributeKeys = document.getElementById("keys");
    //            comboAttributeKeys.dsModel.disabled = false;
    //            comboAttributeKeys.dsModel.elementsList = keysList;
    //            comboAttributeKeys.dsModel.selectedIndex = -1;
    //
    //            //var comboAttributes = document.getElementById("attributes");
    //            comboAttributes.dsModel.disabled = true;
    //            comboAttributes.dsModel.elementsList = [];
    //            comboAttributes.dsModel.selectedIndex = -1;
    //          }
    //        },
    //        onFailure : function(err)
    //        {
    //          loader.off();
    //          WUXModalContainer.removeModal(parentNodeKeysContainer);
    //          WUXModalContainer.removeModal(parentNodeAttrContainer);
    //
    //          parentNodeKeysContainer.style.position = "";
    //          parentNodeAttrContainer.style.position = "";
    //
    //          that.displayNotifications({
    //            level: 'error',
    //            message: Nls.getlistofDELMIATypesError,
    //            title: Nls.getlistofDELMIATypesTitle
    //          });
    //        }
    //    });
    //   }
    //   else
    //   {
    //     var data = that._typeResult[types];
    //
    //     var keysList = [];
    //     var keys = Object.keys(data);
    //     var keysLength = keys.length;
    //     for (var i=0;i<keysLength;i++)
    //     {
    //       var key = keys[i];
    //       if (key)
    //         keysList.push({label: key, value: key});
    //     }
    //
    //     var keysListLength = keysList.length;
    //     if (keysListLength > 0)
    //     {
    //       //var comboAttributeKeys = document.getElementById("keys");
    //       comboAttributeKeys.dsModel.disabled = false;
    //       comboAttributeKeys.dsModel.elementsList = keysList;
    //       comboAttributeKeys.dsModel.selectedIndex = -1;
    //
    //       //var comboAttributes = document.getElementById("attributes");
    //       comboAttributes.dsModel.disabled = true;
    //       comboAttributes.dsModel.elementsList = [];
    //       comboAttributes.dsModel.selectedIndex = -1;
    //     }
    //   }
    // },

    /*
    * onChangeKeyClick
    */
    // onChangeKeyClick : function onChangeKeyClick(data)
    // {
    //   var that = this;
    //
    //   var typesElt = document.getElementById("types");
    //   var types = typesElt.dsModel.elementsList[typesElt.dsModel.selectedIndex].value;
    //
    //   if (that._typeResult[types] != undefined && data.dsModel.elementsList[data.dsModel.selectedIndex] != undefined)
    //   {
    //     var attributesList = that._typeResult[types][data.dsModel.elementsList[data.dsModel.selectedIndex].value].attributes;
    //
    //     var valuesList = [];
    //     var values = Object.values(attributesList);
    //     var valuesLength = values.length;
    //     for (var i=0;i<valuesLength;i++)
    //     {
    //       var value = values[i];
    //       if (value)
    //         valuesList.push({label: value, value: value});
    //     }
    //
    //     if (valuesList.length > 0)
    //    {
    //      var comboAttributes = document.getElementById("attributes");
    //      comboAttributes.dsModel.disabled = false;
    //      comboAttributes.dsModel.elementsList = valuesList;
    //    }
    //
    //   }
    //   else {
    //     var comboKeys = document.getElementById("keys");
    //     comboKeys.dsModel.disabled = true;
    //     comboKeys.dsModel.elementsList = [];
    //   }
    // },

    /*
    * removeSelectedNode
    */
    removeSelectedNode : function removeSelectedNode(params)
    {
      console.log("params " + params);
      var that = this;
      that._parent(params);
    },

    /*
    * editSelectedNode
    */
    editSelectedNode : function editSelectedNode(params)
    {
      console.log("params " + params);
      var that = this;
      that._bEditMode = true;
      that._parent(params);
    }

  });



  return DELLifeCycleRulesFamilyView;
});

/*! Copyright 2017, Dassault Systemes. All rights reserved. */
/*global define, widget, document, setTimeout, console, clearTimeout, FileReader*/
/*jslint plusplus: true*/
/*jslint nomen: true*/
/*! Copyright 2017, Dassault Systemes. All rights reserved. */
/*@quickReview NZV 24/12/06 IR-1315872-3DEXPERIENCER2025x: forbid to render add attribute dialog if page is masked. Add error message if no change found*/
/*@quickReview NZV 24/10/04 IR-1312610-3DEXPERIENCER2024x/25x Minor change*/
/*@quickReview NZV 23/05/22 IR-1088552-3DEXPERIENCER2023x/24x*/
/*@quickReview FRH 22/09/05 FUN127527  (multiline) */
/*@quickReview AJY3 21/02/26 FUN106676 delivery */
/*@quickReview NZV 19/10/18 FUN092576 delivery*/
/*@quickReview NZV 19/01/31 FUN085423 delivery*/
/*@quickReview ZUR 18/04/24 FUN079262 2019x : EBOM-PS Collaboration Mapping Object Widget*/
/*@quickReview NZV 18/02/07 FUN076053 delivery*/
/*@quickReview NZV 17/08/27 IR-540216-3DEXPERIENCER2018x*/
/*@quickReview ZUR 17/08/04 IR-540566-3DEXPERIENCER2018x */
/*@quickReview NZV 17/05/09 Minor change */
/*@quickReview NZV 17/05/04 IR-512104-3DEXPERIENCER2018x */
/*@fullReview  NZV 17/04/21 Delivery of HL FUN070867  -major change */
/*@quickReview ZUR 17/04/19 IR-514503-3DEXPERIENCER2017x/18x, IR-516226-3DEXPERIENCER2017x/18x */
/*@fullReview  ZUR 15/07/29 2016xFD01 Param Widgetization NG*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDataModeling/AttributesLayoutView',
    [
        'UWA/Core',
        'UWA/Class/View',
        'DS/UIKIT/Modal',
        'DS/UIKIT/Popover',
        'DS/UIKIT/Mask',
        'DS/UIKIT/Scroller',
        'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
        'DS/ParameterizationSkeleton/Views/ParameterizationDataModeling/AttributesLayoutUtilities',
        'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
        'DS/ParameterizationSkeleton/Utils/ParameterizationWebServices',
        'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS'
    ],
    function (UWA, View,
              Modal,
              Popover, Mask, Scroller,
              ParametersLayoutViewUtilities, AttributesLayoutUtilities,
              URLHandler, ParameterizationWebServices,
              ParamDataModelingNLS) {

        'use strict';

        var extendedView;

        extendedView = View.extend({
            tagName: 'div',
            className: 'generic-detail',

            init: function (options) {
                var initDate =  new Date();

                options = UWA.clone(options || {}, false);
                this._parent(options);

                this.contentDiv = null;
                this.inputControls = [];
                this.paramScroller = null;
                this.userMessaging = null;
                this.userMessagingLong = null;
                this.lastAlertDate = initDate.getTime();
                this.resetModal = null;
                this.controlDiv = null;
                this.addAttributesModal = null;
                this.editAttributesModal = null;
                this.handledTypeID = null;
                // FUN127527: adding a 5
                this.wdthArray = [10, 13, 13, 10, 5, 5, 5, 5, 5, 5, 5, 5, 15, 16, 16, 3, 7];
                //this.attSynchroCombos = [];
                this.systemAttributes = [];
            },

            setup: function(options) {
                UWA.log('AttributesLayoutView::setup!');
                UWA.log(options);
                //var listoftagsSetup = this.model.get('sixwTagDescription');
            },

            render: function () {
                UWA.log("AttributesLayoutView::render");
                var introDiv,
                    that = this,
                    introText = ParamDataModelingNLS.IntroDivText.format(this.model.get('title'));

                this.contentDiv =  UWA.createElement('div', {'id': 'typeMainDiv'});
                Mask.mask(this.contentDiv);
                this.userMessaging = AttributesLayoutUtilities.addUserMessaging(document.body, 1500);
                this.userMessagingLong = AttributesLayoutUtilities.addUserMessaging(document.body, 5000);//IR-516226-3DEXPERIENCER2017x/18x

                introDiv = UWA.createElement('div', {'class': 'information'}).inject(this.contentDiv);

                /*if ((this.model.get("id") === "AttributeSynchronization")) {
                    introText = ParamDataModelingNLS.IntroSynchroText;
                }*/

                UWA.createElement('p', {
                    text   : introText,
                    'class': 'font-3dslight'//'font-3dsbold'
                }).inject(introDiv);
                // IR-733455-3DEXPERIENCER2021x : sending tool tip for Reset button
                this.controlDiv = ParametersLayoutViewUtilities.createApplyResetToolbar.call(this, this.contentDiv, true,
                                                                  this.applyParams.bind(this), this.resetDMParamsInSession.bind(this), ParamDataModelingNLS.ResetTooltipAttributeMng);

                this.container.setContent(this.contentDiv);
                this.listenTo(this.collection, {
                    onSync: that.onCompleteRequestParameters
                });

                return this;
            },

            onCompleteRequestParameters : function() {
                UWA.log("AttributesLayoutView::onCompleteRequestParameters");
                var i, attributesTable, attrtbody, titlesLine, paramLine, typeNLen,
                    isixWNLS = '', listofAuthValues, //listofSynchros,
                    paramsDIV = ParametersLayoutViewUtilities.createParamsContainerDiv(),
                    listofAttr = this.collection._models[0]._attributes.listofAttributes;
                this.handledTypeID = this.collection._models[0]._attributes.id;
                this.systemAttributes = this.collection._models[0]._attributes.listofSystemAttribues;
				let numberOfObjs = parseInt(this.collection._models[0]._attributes.existingConfiguredObjects);
				//FUN119390
				this.isObjectExistWithConfiguredAttribue = (numberOfObjs == 0) ? false : true;

                attributesTable = UWA.createElement('table', {
                    'class': 'table table-hover'
                }).inject(paramsDIV);//table-bordered

                attrtbody =  UWA.createElement('tbody', {
                    'class': 'attrstbody'
                }).inject(attributesTable);

                if (this.handledTypeID !== "AttributeSynchronization") {

                    titlesLine =  AttributesLayoutUtilities.buildTitlesLine(this.wdthArray);
                    //titlesLine.addClassName("active");
                    titlesLine.inject(attrtbody);

                    for (i = 0; i < listofAttr.length; i++) {

                        typeNLen = listofAttr[i].type;
                        if ((listofAttr[i].type === 'String') && (listofAttr[i].maxLength != 0)) {
                            typeNLen = listofAttr[i].type + listofAttr[i].maxLength;
                        }

                        listofAuthValues = '';
                        if (listofAttr[i].hasAuthValues === true) {
                          //IR-904152-3DEXPERIENCER2022x,IR-953664-3DEXPERIENCER2022x: Convert space "  " to "" to be aline with TXO
                            //Need to remove space..
                            const authValues = listofAttr[i].listofAuthValues.split(",");
                            const trimedAuthValues  = authValues.map((item) => item.trim());
                            listofAuthValues = trimedAuthValues.join();
                        }
                        //FUN092576
						// FUN127527 FRH Support multiline
                        paramLine = AttributesLayoutUtilities.buildAttributeLine(typeNLen,
                            listofAttr[i].nlsName,
							listofAttr[i].internalName,
                            listofAttr[i].defaultValue,
                            listofAttr[i].isMandatory, listofAttr[i].isReadOnly, listofAttr[i].isExposedTo3DXML,
                            listofAttr[i].multiValuated,listofAttr[i].multiline,listofAttr[i].dimension, listofAttr[i].preferredunit, listofAttr[i].isIndexed,
                            listofAuthValues,
                            isixWNLS,
                            listofAttr[i].sixWTag,
                            listofAttr[i].isUsedInOther,
                            listofAttr[i].isDeployed,
                            this.wdthArray,
                            this.userMessagingLong, listofAttr[i].resetWhenRevision, listofAttr[i].resetWhenDuplicate,this);
                        paramLine.inject(attrtbody);
                    }
                }

                /*else {
                    attributesTable.setStyle("width", "70%");
                    //attributesTable.setStyle("margin", "0 auto");//this works correctly
                    //VpmCbpMapping
                    AttributesSynchroView.init(attrtbody);
                    titlesLine = AttributesSynchroView.buildSynchroTitlesLine();
                    titlesLine.inject(attrtbody);
                    UWA.log(this.collection._models[0]);
                    listofSynchros = this.collection._models[0]._attributes.listofSynchros;
                    AttributesSynchroView.buildSynchroView(listofAttr, listofSynchros);
                }*/

                paramsDIV.inject(this.contentDiv);

                this.paramScroller = new Scroller({
                    element: paramsDIV
                }).inject(this.contentDiv);

                Mask.unmask(this.contentDiv);
            },

            showAddElementsModal : function() {
                var headertitle, modalbodyTable, tbodyreflist, attrLine, listofAddedAttrs,
                    AuthValsInput, typeNLen,
                    OKBtn, CancelBtn, checkResult, hasAuthVals,
                    sixwTagSelector, typesSelect, attrNameInput, attrUserNameInput, attrDefValueInput,
                    currSelectedOpt, iDefaultValue,
                    mandToggle, readonlyToggle, indexedToggle,
                    dateInput, dateSpan, iShortDate,
                    selected6wTag = '',
                    selected6wTagValue = '',
                    inputsArray = [],
                    dimensionsSelector, unitSelect,
                    export3DXMLToggle = false, revisionToggle = null, duplicateToggle = null,
                    that = this, multiValuatedToggle, multilineToggle, authValuesStr = "";


                UWA.log("showAddAttributesModal::");
				//IR-1315872-3DEXPERIENCER2025x: forbid add attribute dialog if page is masked.
				if (Mask.isMasked(that.contentDiv) === false) {
					if (that.addAttributesModal !== null) {
						//that.addAttributesModal.show();//Modal already exists
						//NZV : Need to comfirm this change.
						that.addAttributesModal.destroy();
					}  {
						headertitle = UWA.createElement('h4', {
							text   : ParamDataModelingNLS.AddAttributeTxt,
							'class': 'font-3dslight' // font-3dsbold
						});

						//sortedTypes = LifecycleViewUtilities.sortArrayByKey(that.collection._models[0]._attributes.types, "typeNLS");
						//IR-1312610-3DEXPERIENCER2024x/25x : initilize multivalued
						that.multiValuated = false;
						inputsArray        = AttributesLayoutUtilities.buildModalSkeleton(that);
						modalbodyTable     = AttributesLayoutUtilities.getInputFromSkeleton(inputsArray, "modalbodyTable");
						typesSelect        = AttributesLayoutUtilities.getInputFromSkeleton(inputsArray, "typesSelect");
						attrNameInput      = AttributesLayoutUtilities.getInputFromSkeleton(inputsArray, "attrNameInput");
						attrUserNameInput  = AttributesLayoutUtilities.getInputFromSkeleton(inputsArray, "attrUserNameInput");
						mandToggle         = AttributesLayoutUtilities.getInputFromSkeleton(inputsArray, "mandToggle");
						readonlyToggle     = AttributesLayoutUtilities.getInputFromSkeleton(inputsArray, "readonlyToggle");
						indexedToggle      = AttributesLayoutUtilities.getInputFromSkeleton(inputsArray, "indexedToggle");
						sixwTagSelector    = AttributesLayoutUtilities.getInputFromSkeleton(inputsArray, "sixwTagAutoSelect");
						AuthValsInput      = AttributesLayoutUtilities.getInputFromSkeleton(inputsArray, "AuthValsInput");
						OKBtn              = AttributesLayoutUtilities.getInputFromSkeleton(inputsArray, "OKBtn");
						CancelBtn          = AttributesLayoutUtilities.getInputFromSkeleton(inputsArray, "CancelBtn");
						dimensionsSelector = AttributesLayoutUtilities.getInputFromSkeleton(inputsArray, "dimensionsSelect");
						unitSelect         = AttributesLayoutUtilities.getInputFromSkeleton(inputsArray, "unitSelect");
						export3DXMLToggle  = AttributesLayoutUtilities.getInputFromSkeleton(inputsArray, "export3DXMLToggle");
						revisionToggle     = AttributesLayoutUtilities.getInputFromSkeleton(inputsArray, "revisionToggle");
						duplicateToggle    = AttributesLayoutUtilities.getInputFromSkeleton(inputsArray, "duplicateToggle");
						multiValuatedToggle = AttributesLayoutUtilities.getInputFromSkeleton(inputsArray, "multiValuatedToggle");
						// FUN127527 FRH Support multiline
						multilineToggle = AttributesLayoutUtilities.getInputFromSkeleton(inputsArray, "multilineToggle");

						OKBtn.addEvent("onClick", function () {

							var userSelectDimention = "", perferredUnit = "", msg = "";
							//IR-750288-3DEXPERIENCER2021x : Handle default value in case of it is disable
							typeNLen = AttributesLayoutUtilities.getSelectedTypeAndLength(typesSelect.getSelection()[0].value);
						   // userSelectDimention = {};
							if (typeNLen[0] === 'Boolean') {
							  //IR-1042260-3DEXPERIENCER2023x
								  attrDefValueInput = AttributesLayoutUtilities.getDefaultValueInput();
								  currSelectedOpt = attrDefValueInput.getSelection();
								  iDefaultValue = currSelectedOpt[0].value;
								//  if(AttributesLayoutUtilities.getDefaultValueInput().isDisabled()  === false) {
								//     attrDefValueInput = AttributesLayoutUtilities.getDefaultValueInput();
								//     currSelectedOpt = attrDefValueInput.getSelection();
								//     iDefaultValue = currSelectedOpt[0].value;
								//
								// } else { iDefaultValue = "";}
							} else if (typeNLen[0] === 'Date') {
								//ZUR IR-494192-3DEXPERIENCER2017x
								if(AttributesLayoutUtilities.getDefaultValueInput().dateInput.isDisabled()  === false) {
									dateSpan = AttributesLayoutUtilities.getDefaultValueInput();
									dateInput = dateSpan.dateInput;
									iShortDate = dateInput.getDate();
									if (iShortDate !== null) {
										iShortDate.setHours(11);//ZUR IR-502127-3DEXPERIENCER2018x
										//toLocaleDateString
										iDefaultValue = AttributesLayoutUtilities.getCATIACompatibleDateFromISOString(iShortDate.toISOString());
									} else {
										iDefaultValue = "";
									}
								} else {
									iDefaultValue = "";
								}

							} else if (typeNLen[0] === 'Real') {

								if (dimensionsSelector.getSelection()[0].value !== '') {

									userSelectDimention = dimensionsSelector.getSelection()[0].value;

									if (unitSelect.getSelection()[0].value !== '') {
										perferredUnit = unitSelect.getSelection()[0].value;
									}
								}
								if(AttributesLayoutUtilities.getDefaultValueInput().isDisabled()  === false) {
									iDefaultValue = AttributesLayoutUtilities.getDefaultValueInput().getValue();
								} else {
									iDefaultValue = "";
								}
							} else {
								if(AttributesLayoutUtilities.getDefaultValueInput().isDisabled()  === false) {
									iDefaultValue = AttributesLayoutUtilities.getDefaultValueInput().getValue();
								} else {
									iDefaultValue = "";
								}
							}
							listofAddedAttrs = AttributesLayoutUtilities.getNamesListofAlreadyAddedAttributes(that.contentDiv);

							hasAuthVals = false;

							//IR-744403-3DEXPERIENCER2021x
							if ((AuthValsInput.getValue() !== undefined) && (AuthValsInput.getValue() !== '') ) {
								hasAuthVals = true;
								//Remove spaces between values.
								authValuesStr = AuthValsInput.getValue();
								if(authValuesStr.indexOf(",") > -1) {
								  //IR-904152-3DEXPERIENCER2022x,IR-953664-3DEXPERIENCER2022x: Convert space "  " to "" to be aline with TXO
								  const authValues = authValuesStr.split(",");
								  const trimedAuthValues  = authValues.map((item) => item.trim());
								  authValuesStr = trimedAuthValues.join();
								}
								authValuesStr = authValuesStr.trim();
								AuthValsInput.setValue(authValuesStr);

							} else {//IR-1088552-3DEXPERIENCER2023x/24x
							  authValuesStr = "";
							}
							//FUN119390
							checkResult = AttributesLayoutUtilities.checkOptionsBeforeAddAttrs(typeNLen[0], typeNLen[1],
								attrNameInput.getValue(), attrUserNameInput.getValue(), iDefaultValue,
								readonlyToggle.isChecked(), mandToggle.isChecked(), multiValuatedToggle.isChecked(), hasAuthVals,
								authValuesStr,
								listofAddedAttrs, that.systemAttributes, false, "DUMMYUNDEFINEDVALUE", that.isObjectExistWithConfiguredAttribue);
								//IR-953664-3DEXPERIENCER2023x\22x :There is no value to pass as existing NLS attribute name here so we are passing DUMMYUNDEFINEDVALUE.

							if (checkResult !== "S_OK") {
								UWA.log("checkResult = " + ParamDataModelingNLS[checkResult]);
								//IR-759885-3DEXPERIENCER2021x
								if (checkResult === "AttributeNameNotAllowed") {
									msg = ParamDataModelingNLS[checkResult].format(attrNameInput.getValue());
									that.userMessaging.add({ className: "error", message: msg});
								} else {
									if (checkResult == "DefaultNotInAuthValsMsg") {
									  //IR-904152-3DEXPERIENCER2022x,IR-953664-3DEXPERIENCER2022x\23x: Message improvement
										that.userMessaging.add({ className: "error", message: ParamDataModelingNLS[checkResult].format(iDefaultValue)});
									  } else {
										that.userMessaging.add({ className: "error", message: ParamDataModelingNLS[checkResult]});

									  }
								}
								if ((checkResult === 'DefaultValueSizeInadequate') ||
										(checkResult === 'AccentsnotAllowedMsg') ||
										  (checkResult === 'DefaultValueSizeInadequate')) {
									AttributesLayoutUtilities.getDefaultValueInput().focus();
								}

							} else {

								selected6wTag = '';
								selected6wTagValue = '';

								if (sixwTagSelector.selectedItems[0] != undefined) {
									selected6wTag = sixwTagSelector.selectedItems[0].label;
									selected6wTagValue = sixwTagSelector.selectedItems[0].value;
								}
								//FUN092576, IR-820267-3DEXPERIENCER2021x
								// FUN127527 FRH Support multiline
								attrLine = AttributesLayoutUtilities.buildAttributeLine(typesSelect.getSelection()[0].value,
									attrUserNameInput.getValue(), attrNameInput.getValue(), iDefaultValue,
									mandToggle.isChecked(), readonlyToggle.isChecked(), export3DXMLToggle.isChecked(),
									multiValuatedToggle.isChecked(),multilineToggle.isChecked(),userSelectDimention, perferredUnit,
									indexedToggle.isChecked(),
									authValuesStr,
									selected6wTag,
									selected6wTagValue,
									false,
									"NewNotDeployed",//'false',//isDeployed
									that.wdthArray,
									this.userMessagingLong, revisionToggle.isChecked(), duplicateToggle.isChecked(),that);

								tbodyreflist = that.contentDiv.getElements('.attrstbody');
								attrLine.inject(tbodyreflist[0]);
								attrLine.focus();
								that.addAttributesModal.hide();
								that.addAttributesModal.destroy();
							}

						});

						CancelBtn.addEvent("onClick", function (e) {
							UWA.log(e);//that.onCancelCalled();
							that.addAttributesModal.hide();
							that.addAttributesModal.destroy();
						});

						that.addAttributesModal = new Modal({
							className: 'add-attr-modal',
							closable: true,
							header  : headertitle,
							body    : modalbodyTable,
							footer  : [ OKBtn, CancelBtn ]
						}).inject(that.contentDiv);

						that.addAttributesModal.getContent().setStyle("padding-top", 10);
						that.addAttributesModal.elements.wrapper.setStyle("width", 800);
						that.addAttributesModal.show();
					}
				} else {
					that.userMessaging.add({ className: "warning", message: ParamDataModelingNLS.ApplyInProgress});
				}
            },

            resetDMParamsInSession : function () {
                /*if (this.model.get("id") === "AttributeSynchronization") {
                    this.resetSynchroParams();
                } else {*/
                this.confirmationModalShow();
                //}
            },

            confirmationModalShow : function () {
                UWA.log("confirmationModalShow");
                var tbodyreflist = this.contentDiv.getElements('.attrstbody'),
                    iLines = tbodyreflist[0].childNodes,
                    nbofLines = iLines.length,
                    i = nbofLines - 1, deployStatusValue, attriList, deployedAttri, j;

                while (i >= 1) {
                    deployStatusValue = iLines[i].cells[AttributesLayoutUtilities.cellsIndex.DeployStatus].value;
                    if (deployStatusValue === "Deployed") {
                        i--;
                        continue;
                    }
                    attriList = this.collection._models[0]._attributes.listofAttributes;
                    deployedAttri = "";
                    for(j = 0; j < attriList.length; j++) {
                        if (attriList[j].internalName === iLines[i].cells[AttributesLayoutUtilities.cellsIndex.AttributeName].value) {
                            deployedAttri = attriList[j];
                            break;
                        }
                    }
                    if ( deployStatusValue === "NewNotDeployed" || deployedAttri === "") {
                        iLines[i].remove();
                    } else if (deployStatusValue === "DeletedNotDeployed" || deployStatusValue === "ModifiedNotDeployed") {
                        AttributesLayoutUtilities.undeleteAttribute(iLines[i],this);
                    }
                    i--;
                }
                /*
                   "DeletedNotDeployed"
                    "NewNotDeployed"
                    "StoredButNotDeployed"
                    "Deployed"
                */
            },

            /*resetSynchroParams : function () {
                AttributesSynchroView.resetSynchroParams();
            },*/

            applyParams : function () {
                UWA.log("applyParams");

                /*if (this.model.get("id") === "AttributeSynchronization") {
                    this.UpdateSynchroParams();

                } else {*/
                //IR-689657-3DEXPERIENCER2019x/20x : Popup a warning msg when new attribute being added.
                var tbodyreflist = this.contentDiv.getElements('.attrstbody'),
                iLines = tbodyreflist[0].childNodes;
                var newAttributeAdded = false, i, attributeModified = false;
                for(i = 1 ; i < iLines.length; i++) {
                   if("NewNotDeployed" === iLines[i].cells[AttributesLayoutUtilities.cellsIndex.DeployStatus].value) {
                     newAttributeAdded = true;
                   }
				   ////IR-1315872-3DEXPERIENCER2025x:
                   if("ModifiedNotDeployed" === iLines[i].cells[AttributesLayoutUtilities.cellsIndex.DeployStatus].value ||
					"DeletedNotDeployed" === iLines[i].cells[AttributesLayoutUtilities.cellsIndex.DeployStatus].value) {
                     attributeModified = true;
                   }
                }
                if(newAttributeAdded === true) {
                    //FUN102019 21x FD03 : change message and add line break
                    ParametersLayoutViewUtilities.showContextualDeleteModal(widget.body, "longAttrModal", ParamDataModelingNLS.NewAttrAddWarningMsg + "\n"+ParamDataModelingNLS.NewAttrAddWarningMsgSec,
                        ParamDataModelingNLS.YesText,  ParamDataModelingNLS.NoText, ParamDataModelingNLS.Warning+"!", this.UpdateDataModelingParams, this);
                } else {
					if(attributeModified === true) {
						this.UpdateDataModelingParams(this);
					} else { //IR-1315872-3DEXPERIENCER2025x: Add error message if no change found*/
						this.userMessaging.add({ className: "warning", message:ParamDataModelingNLS.NoChangeFound+"!" });
					}
                }
            },
            //IR-689657-3DEXPERIENCER2019x/20x
            UpdateDataModelingParams : function (that) {
                var datatoSend,
                    attributeList = [];

                //if this.handledTypeID === AttributeSynchronization

                Mask.mask(that.contentDiv);
                attributeList = AttributesLayoutUtilities.getCurrentAttributesList(that.contentDiv);

                UWA.log(attributeList);


                datatoSend = {
                    id                      : that.handledTypeID,
                    attributeDescription    : attributeList
                };
                UWA.log(datatoSend);

                ParameterizationWebServices.postAttributesOnServer.call(that, datatoSend, "postattrparams",
                    that.onApplyFailure.bind(that), that.onApplySuccess.bind(that));
            },//of function UpdateCommonParamsOnServer

            /*UpdateSynchroParams : function () {
                var synchroList, datatoSend;
                Mask.mask(this.contentDiv);

                synchroList = AttributesSynchroView.getCurrentSynchroList(this.contentDiv);

                datatoSend = {
                    AttributesSynchronization : synchroList
                };

                UWA.log(datatoSend);

                ParameterizationWebServices.postAttributesOnServer.call(this, datatoSend, "postsynchros",
                    this.onApplyFailure.bind(this), this.onApplySuccess.bind(this));
            },*/

            onApplyFailure : function (json) {
                UWA.log(json);
                Mask.unmask(this.contentDiv);//Rb0afx
                this.userMessaging.add({ className: "error", message: ParamDataModelingNLS.deployFailureMsg });
                //ParamLayoutUtilities.updateIcon(false, theImageCell);
            },

            onApplySuccess : function (json) { //Rb0afx
                var currDate, currTime, diffDate,
                    successmsg = ParamDataModelingNLS.deploySuccessMsg +" " +ParamDataModelingNLS.UpdateIndexAndReloadCache/*IR-733455-3DEXPERIENCER2021x */, attributeList = [], attriList,
                    i = 0, existingAttribute = false, j = 0, modelAttriList, uiAttriList;// + ' - ' + new Date();
                Mask.unmask(this.contentDiv);
                UWA.log(json);

                currDate = new Date();
                currTime = currDate.getTime();
                diffDate = currTime - this.lastAlertDate;
                this.lastAlertDate = currTime;

                if (diffDate >= 2000) {
                    this.userMessagingLong.add({ className: "success", message: successmsg });
                }
                //UPDATE MODEL WITH LATEST CHANGES
                uiAttriList = AttributesLayoutUtilities.getCurrentAttributesList(this.contentDiv);
                modelAttriList = this.collection._models[0]._attributes.listofAttributes;
                for(i =0 ; i < modelAttriList.length; i++) {
                    modelAttriList[i].tempStatus = "ToBeDeleted";
                }

                for(i =0; i < uiAttriList.length; i++) {
                    existingAttribute = false;
                    for(j = 0; j < modelAttriList.length; j++) {
                        if (modelAttriList[j].nlsName && (modelAttriList[j].nlsName === uiAttriList[i].nlsName)) {
                                modelAttriList[j].type             = uiAttriList[i].type;
								modelAttriList[j].internalName 	   = uiAttriList[i].internalName;//IR-820267-3DEXPERIENCER2021x
                                modelAttriList[j].maxLength        = uiAttriList[i].maxLength;
                                modelAttriList[j].defaultValue     = uiAttriList[i].defaultValue;
                                modelAttriList[j].isMandatory      = uiAttriList[i].isMandatory;
                                modelAttriList[j].isExposedTo3DXML = uiAttriList[i].isExposedTo3DXML;
                                modelAttriList[j].multiValuated    = uiAttriList[i].multiValuated; //FUN092576
                                modelAttriList[j].multiline        = uiAttriList[i].multiline; //FUN127527
                                modelAttriList[j].resetWhenDuplicate = uiAttriList[i].resetWhenDuplicate;
                                modelAttriList[j].resetWhenRevision = uiAttriList[i].resetWhenRevision;
                                modelAttriList[j].isReadOnly       = uiAttriList[i].isReadOnly;
                                modelAttriList[j].isIndexed        = uiAttriList[i].isIndexed;
                                modelAttriList[j].hasAuthValues    = uiAttriList[i].hasAuthValues;
                                modelAttriList[j].listofAuthValues = uiAttriList[i].listofAuthValues;
                                modelAttriList[j].SixWTag          = uiAttriList[i].SixWTag;
                                modelAttriList[j].dimension        = uiAttriList[i].dimension;
                                modelAttriList[j].preferredunit    = uiAttriList[i].preferredunit;
                                delete modelAttriList[i].tempStatus;
                                existingAttribute = true;
                            break;
                       }
                    }
                    if (existingAttribute === false) {
                        //add new entry
                        modelAttriList.push({
                                    "id"                : "NotYetCalulated",
                                    "internalName"      : "NotYetCalulated",
                                    "isDeployed"        : true,
                                    "isUsedInOther"     : false,
                                    "parentType"        : "NotYetCalulated",
                                    "nlsName"           : uiAttriList[i].nlsName,
                                    "type"              : uiAttriList[i].type,
                                    "maxLength"         : uiAttriList[i].maxLength,
                                    "defaultValue"      : uiAttriList[i].defaultValue,
                                    "isMandatory"       : uiAttriList[i].isMandatory,
                                    "isExposedTo3DXML"  : uiAttriList[i].isExposedTo3DXML,
                                    "resetWhenDuplicate": uiAttriList[i].resetWhenDuplicate,
                                    "resetWhenRevision" : uiAttriList[i].resetWhenRevision,
                                    "isReadOnly"        : uiAttriList[i].isReadOnly,
                                    "isIndexed"         : uiAttriList[i].isIndexed,
                                    "hasAuthValues"     : uiAttriList[i].hasAuthValues,
                                    "listofAuthValues"  : uiAttriList[i].listofAuthValues,
                                    "SixWTag"           : uiAttriList[i].SixWTag,
                                    "dimension"         : uiAttriList[i].dimension,
                                    "preferredunit"     : uiAttriList[i].preferredunit,
                                    "multiValuated"     : uiAttriList[i].multiValuated, //FUN092576
                                    "multiline"         : uiAttriList[i].multiline //FUN127527
                        });
                    }
                }
                //Remove old attributes if have
               modelAttriList = modelAttriList.filter(function (value, index, arr) {
                        return  (value.tempStatus !== undefined) ? false : true;});
                //var tbodyreflist = this.contentDiv.getElements('.attrstbody');
                /*if (this.model.get("id") === "AttributeSynchronization") {
                    AttributesSynchroView.UpdateSynchrosStsInTable(this.contentDiv);
                } else {*/
                AttributesLayoutUtilities.UpdateAttributesStsInTable(this.contentDiv);

                //}

                //ParamLayoutUtilities.updateIcon(true, theImageCell);
            },

            //show: function () {},
            destroy : function() {
                this.stopListening();
                this._parent.apply(this, arguments);
            }

        });

        return extendedView;
    });

/**
* @quickreview  ROW 22:11:08 creation
*/

define('DS/ParameterizationSkeleton/Views/PPRSynchronizationLifeCycle/DELLifeCycleRulesLayoutView',
    [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationLayoutView',
    'DS/ParameterizationSkeleton/Views/PPRSynchronizationLifeCycle/DELLifeCycleRulesFamilyView'
    ],
    function (
      UWA,
      DELConfigurationLayoutView,
      DELLifeCycleRulesFamilyView
    )
  {

  'use strict';

  var DELLifeCycleRulesLayoutView = DELConfigurationLayoutView.extend({

    /*
    * init
    */
    init : function init(options)
    {
      var that = this;
      this._parent(options);
    },

    /*
    * onCompleteRequestParameters
    */
    onCompleteRequestParameters : function onCompleteRequestParameters() {
      //removeApply Reset div
      var eltUI = document.getElementById("ApplyResetDiv");
      if (eltUI)
      {
          var parentNode = eltUI.getParent();
          parentNode.removeChild(eltUI);
      }

      this._parent();
    },

    /*
    * buildParameterLine
    */
    buildParameterLine : function (iParamObj, familyID, familytbody, popoverPosition) {

      var that = this;
      var args = iParamObj.argument;
      for (var i=0;i<args.length;i++)
      {
        var arg = args[i];
        if (arg && arg.defaultValue === "DELConfigurationTreeListView")
        {
          //this.nbofShownParameters++;
          var contentTreeView = UWA.createElement('div');

          var options = {};
          options.xmlDoc = that._xmlMap.get(arg.id);
          options.domainid = that._domainID;
          options.familyid = familyID;
          options.parameterid = iParamObj.id;
          options.argid = arg.id;

          options.treeListViewNls = that._xmlNls.get(arg.id)[0];
          options.modalViewNls = that._xmlNls.get(arg.id)[1];
          options.nodeTreeViewNls = that._xmlNls.get(arg.id)[2];

          //var familyView = new DELLifeCycleRulesFamilyView(options);
          that._familyView = new DELLifeCycleRulesFamilyView(options);
          that._listOfFamilyViews.push(that._familyView);

          var treelistViewContent = that._familyView.buildFamilyContent();
          treelistViewContent.inject(familytbody);
        }
        else
          this._parent(iParamObj, familyID, familytbody, popoverPosition);
      }
    }

    /*
    * buildFamilyItemContent
    */
    /*buildFamilyItemContent : function buildFamilyItemContent(iFamily, familyPosition) {
      var that = this;

      if (that._xmlMap.get(iFamily.id))
      {
        this.nbofShownParameters++;
        var contentTreeView = UWA.createElement('div');

        var options = {};
        options.xmlDoc = that._xmlMap.get(iFamily.id);
        options.domainid = that._domainID;

        var familyView = new DELLifeCycleRulesFamilyView(options);
        return familyView.buildFamilyContent(iFamily, familyPosition);
        //family.inject(contentTreeView);
      }
      else
        return this._parent(iFamily, familyPosition);
    }*/

  });



  return DELLifeCycleRulesLayoutView;
});

/**
* @quickreview  ROW 22:11:08 creation
*/

define('DS/ParameterizationSkeleton/Views/PPRSynchronizationLifeCycle/DELLifeCycleRulesParentView',
		[
	 'UWA/Core',
	 'DS/ParameterizationSkeleton/Views/ParametersParentView',
	 'DS/ParameterizationSkeleton/Views/PPRSynchronizationLifeCycle/DELLifeCycleRulesLayoutView'
	 ],
	 function (
		 UWA,
		 ParametersParentView,
		 DELLifeCycleRulesLayoutView
		)
{

	'use strict';


	var DELLifeCycleRulesParentView = ParametersParentView.extend({

		init: function (options) {
			options = UWA.clone(options || {}, false);
			this._domainID = options.domainid;
			this._parent(options);
		},

		setup: function (options) {
			UWA.log('DELLifeCycleRulesParentView Layout::setup!');
			UWA.log(options);

		},

		render : function()
		{
			var that = this;
			var options = this.options;

		  var layoutView = new DELLifeCycleRulesLayoutView(options);
			return layoutView.render();
		}
	});

	return DELLifeCycleRulesParentView;
});

define("DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/Api3DSpaceModel", ["require", "exports", "UWA/Core", "DS/WAFData/WAFData", "DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/Api3DSpaceBaseModel"], function (require, exports, UWA, WAFData, Api3DSpaceBaseModelModule) {
    "use strict";
    var Api3DSpaceModelModule;
    (function (Api3DSpaceModelModule) {
        ;
        Api3DSpaceModelModule.Api3DSpaceModel = Api3DSpaceBaseModelModule.Api3DSpaceBaseModel.extend({
            setup: function (attributes, options) {
                var _this = this;
                this._parent(attributes, options);
                this.fetchPromise = null;
                this.modelCallUrlPromise = this.getModelCallUrl().then(function (modelUrl) {
                    _this.url = modelUrl;
                });
            },
            /**
             * Returns a promise of this fetched model
             * If the model has not been fetched yet, it is fetched
             * Else, the previously fetched models are returned
             */
            getFetchPromise: function () {
                var _this = this;
                return this.fetchPromise !== null
                    ? this.fetchPromise
                    : new Promise(function (resolve, reject) {
                        return _this
                            .modelCallUrlPromise
                            .then(function () {
                            return _this.fetch({
                                onComplete: function () {
                                    resolve(this);
                                }.bind(_this),
                                onCancel: reject,
                                onFailure: reject
                            });
                        });
                    });
            },
            sync: function (method, model, options) {
                options = UWA.extend(options, {
                    method: 'GET',
                    type: 'json',
                    timeout: 0
                });
                options = Object.assign({
                    ajax: WAFData.authenticatedRequest
                }, options);
                this._parent.apply(this, [method, model, options]);
            },
            parse: function (data, options) {
                return data;
            },
            /** returns the URL to use to retrieve topologies */
            getModelCallUrl: function () {
                var _this = this;
                return this.get3DSpaceUrl().then(function (_3DSpaceURL) {
                    return _this.getTenant().then(function (tenant) {
                        var xrequestedwith = 'xmlhttprequest';
                        var pathname = _this.getModelPath();
                        var url = new URL(_3DSpaceURL);
                        url.searchParams.append('tenant', tenant);
                        _this.customizeModelCallUrl(url);
                        url.searchParams.append('xrequestedwith', xrequestedwith);
                        url.pathname += pathname;
                        return url.toString();
                    });
                });
            },
            /** returns the path to use to for model call */
            getModelPath: function () {
                throw new Error('getModelPath should be overriden');
            },
            /** customize the url of the model call */
            customizeModelCallUrl: function (url) {
            }
        });
    })(Api3DSpaceModelModule || (Api3DSpaceModelModule = {}));
    return Api3DSpaceModelModule;
});

define("DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/dictionary/Dictionary", ["require", "exports", "DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/Api3DSpaceModel", "DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/dictionary/DictionaryCollection", "DS/ParameterizationSkeleton/Utils/ParameterizationPartSupply/Utils"], function (require, exports, Api3DSpaceModelModule, DictionaryCollectionModule, Utils) {
    "use strict";
    var DictionaryModule;
    (function (DictionaryModule) {
        DictionaryModule.Dictionary = Api3DSpaceModelModule.Api3DSpaceModel.extend({
            /** customize the url of the collection call */
            customizeModelCallUrl: function (url) {
                this._parent(url);
                url.searchParams.append('lang', Utils.Utils.getLang() + (Utils.Utils.getLang() === 'en' ? '' : ';en'));
            },
            parse: function (data, options) {
                var _this = this;
                var lang = Utils.Utils.getLang();
                /** Store DictionaryNLS */
                this.DictionaryNLS = data.DictionaryNLS;
                /** Provide NLS using DictionaryNLS */
                var dictionary = ['Interfaces', 'Types'].reduce(function (enrichedDictionary, currentDictionaryItemKey) {
                    var enrichedDictionaryItem = Object.keys(data.Dictionary[currentDictionaryItemKey]).map(function (key) {
                        var type = data.Dictionary[currentDictionaryItemKey][key];
                        // retrieve type labels in dictionaries
                        if (!type.NameNLS) {
                            var dico = {};
                            var typeKey = 'Type.' + type.Name;
                            if (lang === 'en') {
                                if (data.DictionaryNLS) {
                                    dico.en = data.DictionaryNLS[typeKey];
                                }
                            }
                            else {
                                if (data.DictionaryNLS_en) {
                                    dico.en = data.DictionaryNLS_en[typeKey];
                                }
                                if (data['DictionaryNLS_' + lang]) {
                                    dico[lang] = data['DictionaryNLS_' + lang][typeKey];
                                }
                            }
                            type.NameNLS = dico;
                        }
                        // retrieve attributes labels in dictionaries
                        Object.keys(type.Attributes).map(function (key) {
                            var attribute = type.Attributes[key];
                            if (!attribute.NameNLS) {
                                var dico = {};
                                var attributeKey = 'Attribute.' + type.Name + '.' + attribute.Name;
                                if (lang === 'en') {
                                    if (data.DictionaryNLS) {
                                        dico.en = data.DictionaryNLS[attributeKey];
                                    }
                                }
                                else {
                                    if (data.DictionaryNLS_en) {
                                        dico.en = data.DictionaryNLS_en[attributeKey];
                                    }
                                    if (data['DictionaryNLS_' + lang]) {
                                        dico[lang] = data['DictionaryNLS_' + lang][attributeKey];
                                    }
                                }
                                attribute.NameNLS = dico;
                            }
                        });
                        return type;
                    });
                    enrichedDictionary[currentDictionaryItemKey] = new DictionaryCollectionModule.DictionaryCollection(enrichedDictionaryItem, {
                        isCustom: _this.isCustom(),
                        dictionaryNLS: _this.DictionaryNLS,
                        parse: true
                    });
                    return enrichedDictionary;
                }, {});
                return this._parent(dictionary, options);
            },
            isCustom: function () {
                throw new Error('isCustom must be overriden');
            },
            getTypes: function () {
                return this.get('Types');
            },
            getInterfaces: function () {
                return this.get('Interfaces');
            }
        });
    })(DictionaryModule || (DictionaryModule = {}));
    return DictionaryModule;
});

define('DS/ParameterizationSkeleton/Views/ParamSpecificationManagement/SpecificationUXComponents', [
	'UWA/Core',
    'DS/ParameterizationSkeleton/Views/ParamSpecificationManagement/SpecParamCustomizationUtility',
    'DS/ParameterizationSkeleton/Views/ParamSpecificationManagement/SpecParamAlertUtility',
    'i18n!DS/ParameterizationSkeleton/assets/nls/SpecificationManagementNLS',
    'DS/UIKIT/Input/Toggle',
    'DS/Controls/Button',
    'DS/UIKIT/Input/File',
    'DS/UIKIT/Spinner',
    'DS/UIKIT/Popover',
    'DS/WUXAutoComplete/AutoComplete',
    'DS/TreeModel/TreeDocument', 'DS/TreeModel/TreeNodeModel', "DS/Controls/Label"
], 
function (UWA,SpecParamCustomizationUtility, SpecParamAlertUtility,SpecificationManagementNLS, Toggle, Button, UXFile,  Spinner, Popover, WUXAutoComplete,TreeDocument, TreeNodeModel,WUXLabel) {
    'use strict';

    var productConfig = {};
    var newModelingandSimulationCheckBoxhandler;//FUN152060- added for ModelingandSimulationOptional setting in material section
    var newFormulaCheckBoxhandler;////FUN152060- added for FormulaOptional setting in material section
    var newProductCheckBoxhandler; // cmd hadler to validate & disable type select
    var showOOTBTypeCheckBoxhandler;// cmd hadler to validate & disable type select
    
    /**
     * This method is private.
     * It will create the label case with his text and inject it into parentElement
     * @param {String} text text to display as label
     * @param {HTMLElement} parentElement parentElement to inject the case
     */
    const createLabelCase = function (text, parentElement) {
        UWA.createElement('td', {
            'class': 'speclabels',
            html: text
        }).inject(parentElement);
    };
   
    /**
     * This method is private.
     * It will create an information case with information icon inside. At mouseover it will show a text as tooltip. 
     * This will be injected into parentElement
     * @param {String} text tooltip text
     * @param {HTMLElement} parentElement parentElement to inject the case
     */
    const createInformationCase = function (text, parentElement) {

        const informationCase = UWA.createElement('td', {
            'class': 'spec-bubble-info'
        }).inject(parentElement);

        const informationIcon = UWA.createElement('span', { 'class': "fonticon fonticon-info" }).inject(informationCase);

        //Information tooltip 
        new Popover({
            target: informationIcon,
            trigger: "hover click",
            animate: "true",
            position: "top",
            body: text,
            title: ''
        });

    };
    
    const createEmptyColumns = function ( parentElement, numbOfCols) {
    	for(let i=0;i<numbOfCols;i++){
	    	 UWA.createElement('td', {
	            'class': 'aa'
	        }).inject(parentElement);
    	}
    };

    /**
     * This method is private.
     * It create a case to inject validation states (succes, loading, error) inside. 
     * The case is returned
     * @returns {HTMLTableDataCellElement} validationCase
    */
    const createValidationCase = function () {

        return UWA.createElement('td', {
            'class': 'specvalidation'
        });

    };

    /**
     * This method is private.
     * It will create validation states (succes, loading, error) and return them.
     * @param {HTMLTableDataCellElement} parentElement validation case to inject states inside
     * @returns {Array} states - all states values 
     */
    const createValidationStates = function (parentElement) {
        const states = {
            "ok":
                UWA.createElement('span', {
                    'class': "valid_config fonticon fonticon-2x fonticon-check "
                }),

            "error":
                UWA.createElement('span', {
                    'class': "error_config fonticon fonticon-2x fonticon-wrong "
                }),

            "loader": new Spinner()
        };


        states['ok'].inject(parentElement).hide();
        states['error'].inject(parentElement).hide();
        states['loader'].inject(parentElement).hide();

        return states;
    };

    /**
     * This method is private.
     * It will create checkbox to enable or disable a parameter. The checkbox is injected into parentContainer
     * It will call webServices for it depends of the type. 
     * @param {HTMLElement} parentContainer parentContainer to inject checkbox inside
     * @param {Array} validationStates states to display the good one depends on webServices status (if OK then succes, if calling then loading, if failed then error)
     * @param {String} type Must be : prodSpecOptional / templateOptional
     * @param {String} apiKey The api key linked to the type.
     */
    const createCheckBoxCase = function (parentContainer, validationStates, type, apiKey) {

        const checkBoxCase = UWA.createElement('td', {
            'class': 'specCheckboxCase'
        }).inject(parentContainer);

        const checkBoxContainer = UWA.createElement('div', {
            'class': 'specCheckboxContainer'
        }).inject(checkBoxCase);

        const checkbox = new Toggle(
            {
                label: '',
                type: 'checkbox',
                checked: false,
                className: 'primary checkbox_',
                events: {
                    'onClick': function (event) {
                        const onSuccess = function () {
                            validationStates['loader'].hide();
                            setTimeout(function () {
                                validationStates['ok'].show();
                            }, 300);
                          
                            SpecParamAlertUtility.message('success', SpecificationManagementNLS.SuccessfulSettingsApplied);  // IR-813391-3DEXPERIENCER2021x
                        };

                        const onFailure = function () {
                            validationStates['loader'].hide();
                            setTimeout(function () {
                                validationStates['error'].show();
                            }, 300);
                            SpecParamAlertUtility.message('error', SpecificationManagementNLS.ProcessError);

                        };

                        validationStates['loader'].show();
                        validationStates['ok'].hide();
                        validationStates['error'].hide();
                        if (type === "templateOptional") {
                            let value = "Enabled";
                            if (event.srcElement.checked === false)
                                value = "Disabled"
                            SpecParamCustomizationUtility.setTemplateOptionalParam(value, onSuccess, onFailure);
                        }
                        //FUN152060- added for making service calls to save settings based on user action on DB
                        else if (type === "ModelingandSimulationOptional" || type === "FormulaOptional") {
                            (async () => {//IR-1325526 & IR-1325530- await & async is added to wait for response
                                await validateAndDisableMatTypeSection(type, validationStates).then(function (isValid) {//isValid is required to avoid user disable both settings simultaneously & also to avoid disable formula setting when formulated products are linked to recipe(in both cases no service calls are required)           
                                    if (isValid) {
                                        let value = "Enabled";
                                        if (event.srcElement.checked === false)
                                            value = "Disabled";

                                        if (type === "ModelingandSimulationOptional")
                                            SpecParamCustomizationUtility.setModelingandSimulationOptionalParam(value, onSuccess, onFailure);
                                        else if (type === "FormulaOptional")
                                            SpecParamCustomizationUtility.setFormulaOptionalParam(value, onSuccess, onFailure);
                                    }
                                }).catch(function (err) {
                                    console.log(err);
                                });
                                //
                            })();
                        }
                        //
                        else if (type === "prodSpecOptional" || type === "prodSpecOOTBTypeOptional") {
                            let value = "Enabled";
                            if (event.srcElement.checked === false){
                                value = "Disabled";
                            }
                            validateAndDisablePrdTypeSection();
                            if(type === "prodSpecOptional")
                            SpecParamCustomizationUtility.setProdSpecOptionalParam(value, onSuccess, onFailure);
                            else if(type === "prodSpecOOTBTypeOptional"){
                                SpecParamCustomizationUtility.setOOTBSubTypesOptional(value, onSuccess, onFailure);
                            }
                        }
                    }
                }
            }
        ).inject(checkBoxContainer);
        parentContainer.appendChild(checkBoxCase);
        return checkbox;
    };

    /**
     * This method is private.
     * It will call webService linked to the apiKey to get the value : enabled or disable. Then, check or not the checkbox. 
     * and then, show the call status as validation state display (succes, error)
     * @param {String} apiKey The api key linked to the type.
     * @param {HTMLInputElement} checkbox the checkbox to initialize
     * @param {Array} validationStates states array to display the good one depends of webServices call status
     */
    const initCheckboxState = function (apiKey, checkbox, validationStates) {

        const onSuccess = function (data) {
            if (data.constructor.name != "String") { 
                if (data.settings[0].value === "enabled"){
                    checkbox.elements.content.checked = true;
                } else{
                    checkbox.elements.content.checked = false;
                }
            } else { 
                if (data === "true" || data === "Enabled"){
                    checkbox.elements.content.checked = true;
                    if (apiKey === "prodSpecOptional" ||  apiKey === "prodSpecOOTBTypeOptional") validateAndDisablePrdTypeSection();
                }else{
                    checkbox.elements.content.checked = false;
                    if (apiKey === "prodSpecOptional" ||  apiKey === "prodSpecOOTBTypeOptional") validateAndDisablePrdTypeSection();
                }
            }
            validationStates['ok'].show();
        };

        const onFailure = function (data) {
            validationStates['error'].show();
            console.log(data);
        };

        if (apiKey === "templateOptional" || apiKey === "ModelingandSimulationOptional" ||apiKey === "FormulaOptional" || apiKey === "prodSpecOptional" || apiKey === "prodSpecOOTBTypeOptional")//FUN152060- Material section settings are added ModelingandSimulationOptional & FormulaOptional
            SpecParamCustomizationUtility.getParamsFromServer(apiKey, onSuccess, onFailure);
    };
    
    const initCombobox = function (section, autoComplete, validationStates) {

        const onSuccess = function (data) {
            if (data.constructor.name != "String") { 
            	let selectedUnit = data.settings[0].value;
            	var renderConfig ={};
          		renderConfig.applicableTypes = [{ "dbName":selectedUnit,"nlsLabel":SpecificationManagementNLS[selectedUnit]}];	
            	renderLabels(section,section.labelDiv, renderConfig.applicableTypes);
                if (data.settings[0].value === "Weight"){
                	//autoComplete
                	
                   // checkbox.elements.content.checked = true;
                } else{
                   // checkbox.elements.content.checked = false;
                }
            } 
        };

        const onFailure = function (data) {
            console.log(data);
        };

         SpecParamCustomizationUtility.getParamsFromServer(section.type, onSuccess, onFailure);
    };
    
    //FUN152060- method added to avoid user disable both settings simultaneously & also to avoid disable formula setting when formulated products are linked to recipe 
    const validateAndDisableMatTypeSection = async function(apiKey,validationStates) {//IR-1325526- method is made async

        var isValid = true;
        let showmodeling = newModelingandSimulationCheckBoxhandler ? newModelingandSimulationCheckBoxhandler.isChecked() : true; // default val is true for this setting
        let showformula = newFormulaCheckBoxhandler ? newFormulaCheckBoxhandler.isChecked() : false;// default val is false for this setting

        //Method to be called if service-getLinkInfoFromServer executes successfully
        const onSuccess = function (isLinkEstablished) {
            if (isLinkEstablished) {//if formulated products are linked to recipe avoid user to disable formula setting
                newFormulaCheckBoxhandler.check();
                isValid = false;
                SpecParamAlertUtility.message('error', SpecificationManagementNLS.ErrorMessforDisableFormulaSetting);
                validationStates['loader'].hide();
                setTimeout(function () {
                    validationStates['ok'].show();
                }, 300);
                return isValid;
            }
        };

        //Method to be called if service-getLinkInfoFromServer fails
        //avoid user make any changes to formula setting, since service failed
        const onFailure = function (data) {
            newFormulaCheckBoxhandler.check();
            isValid = false;
            SpecParamAlertUtility.message('error', SpecificationManagementNLS.ErrorMessforFormulaSettingService);
            validationStates['loader'].hide();
            setTimeout(function () {
                validationStates['ok'].show();
            }, 300);
        };

        //If modeling & formula settings are diabled simultaneously
        if(!showmodeling && !showformula){
            if(apiKey=="ModelingandSimulationOptional"){
                newModelingandSimulationCheckBoxhandler.check();
                isValid = false;
                //showmodeling = true;
                SpecParamAlertUtility.message('error',SpecificationManagementNLS.ErrorMessforBothSettings);
                validationStates['loader'].hide();
                setTimeout(function () {
                    validationStates['ok'].show();
                }, 300);
            }
            else if(apiKey=="FormulaOptional"){
                newFormulaCheckBoxhandler.check();
                isValid  = false;
                SpecParamAlertUtility.message('error',SpecificationManagementNLS.ErrorMessforBothSettings);
                validationStates['loader'].hide();
                setTimeout(function () {
                    validationStates['ok'].show();
                }, 300);
            } 
        }  
        //if formula setting is disabled call service -getLinkInfoFromServer to check if formulated products are linked to recipe
        if((apiKey=="FormulaOptional") && !showformula){  
            await SpecParamCustomizationUtility.getLinkInfoFromServer().then(function(resp){
                onSuccess(resp);
            }).catch(function(err){
                onFailure(err);
            });//IR-1325526 & IR-1325530- await is added to wait for response
        }
            return isValid;
      };
      //
    
    const validateAndDisablePrdTypeSection = function() {
        let showNewPrd = newProductCheckBoxhandler ? newProductCheckBoxhandler.isChecked() : true; // default val is component not initialized
        let showTypeChooser = showOOTBTypeCheckBoxhandler ? showOOTBTypeCheckBoxhandler.isChecked() : false;// default val is component not initialized
        //If new product command not enabled
        if(!showNewPrd) showOOTBTypeCheckBoxhandler.disable();
        else showOOTBTypeCheckBoxhandler.enable();
        var isDisabled = !(showNewPrd && showTypeChooser);
    	 productConfig.dropDown.disabled= isDisabled;
    	 if(isDisabled)
    		 productConfig.labelDiv.addClassName("disableClick");
    	 else
    		 productConfig.labelDiv.removeClassName("disableClick");
         productConfig.saveBtn.disabled= isDisabled;
         productConfig.showAll.disabled= isDisabled;
      };
      
    const createNode = function(label, value) {
        var node = new TreeNodeModel({
          label: label,
          value: value
        });
        return node;
      };
      
    const updateNodes= function (model, itemList, listToBeUpdated) {
		var that = this;
		itemList.forEach(function (type) {
				const dbValue = type.dbName;
				if(listToBeUpdated.indexOf(dbValue)==-1){
				let rm_node = new TreeNodeModel({
			          label: type.nlsLabel,
			          value: dbValue
			        });
				model.addRoot(rm_node);
				}			
		});
		return model;
	};

    /**
     * This method is private.
     * This method creating a new Param component as an table row. It inject the component into the parentElement. 
     * @param {any} label This label will be display at first in the row. 
     * @param {any} description This description will be display as tooltip in an information icon.
     * @param {any} parentElement The parentElement to inject the component
     * @param {any} type Must be : prodSpecOptional /templateOptional  - It will create the component linked to the type.
     * @param {any} webServiceKey This is the webServiceKey discribed in PES.
     */
    const createParamComponent = function (label, description, parentElement, type, webServiceKey) {
        createLabelCase(label, parentElement);
        createInformationCase(description, parentElement);

        let validationTD = createValidationCase();
        let states = createValidationStates(validationTD);

        let boxes = createCheckBoxCase(parentElement, states, type, webServiceKey);
        initCheckboxState(webServiceKey, boxes, states);

        validationTD.inject(parentElement);
        return boxes; // to store the cmd handler for validation purpose
    };
    
    const getPageName = function( pageName) {
    	switch(pageName) {
			case "rawMaterialTypes" :
				return "RawMaterial";
			case "productSpecTypes":
				return "ProductSpecification";
			case "formulatedPrdConfig":
				return "FormulatedProduct";
		}
		return null;
	}
    
    
    const updateModel = function (dropDownRef,allTypes, savedTypes, placeholder) {	
    	var typeArr =allTypes;
    	let savedTypesList = savedTypes.applicableTypes;
    	if(savedTypesList ===undefined) savedTypesList =[];
		if (typeArr) {
			let model =dropDownRef ? dropDownRef.elementsTree:"";
			model.prepareUpdate();
			model.empty();
			var savedList = [];
			for(var i=0; i<savedTypesList.length;i++ ){
				savedList.push(savedTypesList[i].dbName);
			}
			updateNodes(model, typeArr, savedList);
			model.pushUpdate();
			dropDownRef.placeholder = placeholder;
		}
    }
    
    const setDropdownAndLabelDiv =  function (section, autoComplete, autoCompleteDiv) {
    	 var infoMessageDiv =  UWA.createElement('div', {'id': section.type+"_infoDiv",
        	 styles:{
    			 'margin':'5px',
    			 'margin-bottom':'10px'
    		 }}).inject(autoCompleteDiv);
    
    	var dropdwonDiv =  UWA.createElement('div', {'id': section.type+"_dropdownDiv", 'class':'labelFont'}).inject(autoCompleteDiv);
    	autoComplete.inject(dropdwonDiv);
    	var labelDiv =  UWA.createElement('div', {'id': section.type+"_labelDiv", 'class':'labelFont'}).inject(autoCompleteDiv);
        labelDiv.setStyle('padding-top',"10px");
        
    	section.dropDown = autoComplete;
    	section.labelDiv = labelDiv;
    }
    
    const setFooterDiv =  function (section, dropDownRef, autoCompleteDiv) {
    	let sectionType = section.type;
    	let footerDiv =  UWA.createElement('div', {'id': sectionType+"footerDiv", 'class':'footerSection'
	   	 											}).inject(autoCompleteDiv);
	   	 
	   	let notifyUnsavedDiv =  UWA.createElement('div', {'id': sectionType+"_UnsavedDiv",'class':'unsavedConfig'
	   	 												}).inject(footerDiv);
	   	 
	   	let buttonDiv =  UWA.createElement('div', {'id': sectionType+"buttonDiv"}).inject(footerDiv);
	       
	   	let saveButton = new Button({ id:sectionType+"saveButton", emphasize: "primary", label: SpecificationManagementNLS.saveButtonText, icon: 'save'}).inject(buttonDiv); // Create the button to send datas
	   	saveButton.elements.container.style.margin = "5px";
	   	section.saveBtn = saveButton;
	   	section.unsavedDiv = notifyUnsavedDiv;
	   	 
	   	var resetButton = new Button({ id:sectionType+"resetButton", emphasize: "info", label: SpecificationManagementNLS.resetButtonText}).inject(buttonDiv); // Create the button to send datas
    	resetButton.elements.container.style.margin = "5px";
    	section.showAll = resetButton; 
    };
    
    const initAllTypes = function (section, savedTypes) {
    	if(section.type !== "formulatedPrdConfig"){
    		let dropDownRef = section.dropDown;
	    	if(section.allTypes && section.allTypes.length !=0){
	    		updateModel(dropDownRef,section.allTypes, savedTypes, SpecificationManagementNLS.SelectTypes);//updateAutoComplete
	    	}else{
	    		let resp =  SpecParamCustomizationUtility.getTypesFromServer(section.type, function (data) {
		        	section.allTypes = data;
		        	if(data==undefined)
		        		section.allTypes=[];
		        	 updateModel(dropDownRef,section.allTypes, savedTypes, SpecificationManagementNLS.SelectTypes);
		        	}, function (data) {
		        		console.log(data);
		        	});
	        }
    	}else {
    		if(section.allTypes && section.allTypes.length !=0){
    			let dropDownRef = section.dropDown;
    			if(savedTypes.length > 0){
    				let temp = savedTypes[0];
    				savedTypes.applicableTypes = [{ "dbName":temp,"nlsLabel":temp}];
    			}
	    		updateModel(dropDownRef,section.allTypes, savedTypes, SpecificationManagementNLS.SelectFBOMunits);//updateAutoComplete
	    	}
    		
	        const onSuccess = function (data) {
	           	let selectedUnit = data;
	           	if(data==undefined || data==""){
					selectedUnit="Percentage";
				}
	            let renderConfig ={};
	            renderConfig.applicableTypes = [{ "dbName":selectedUnit,"nlsLabel":SpecificationManagementNLS[selectedUnit]}];	
	            renderLabels(section,section.labelDiv, renderConfig.applicableTypes);  
	        };

	        const onFailure = function (data) {
	            console.log(data);
	        };

	        SpecParamCustomizationUtility.getParamsFromServer(section.type, onSuccess, onFailure);
	    }
    };
   /*  const updateOnSave = function (section,labelDiv, savedTypes) {
     	
     	SpecParamCustomizationUtility.getAdminTypesFromPageObject(section.type, function(data){
            
     		labelList = data.content;
     		renderLabels(section, labelDiv, labelList);
     		initAllTypes(section, labelList);
     		
		 }, function(err){ console.log(err)});
     }*/
     
     const renderUnsavedNotification = function (section,notify, isFirstLoad){
    	 let notifyMessage = " ";
    	 section.saveBtn.disabled = notify ? false:true;  
    	 if(isFirstLoad)
    		 section.saveBtn.disabled = false;
    	 notifyMessage = notify ? SpecificationManagementNLS.UnsavedNotification : " ";
    	 if(section.type === "productSpecTypes"){ 
    		 if(notify)
    			 notifyMessage = SpecificationManagementNLS.UnsavedNotification;
    		 else
    			 notifyMessage = " ";
     	 }
    	document.getElementById(section.type+"_UnsavedDiv").innerHTML= notifyMessage;
     }
  
     const getSavedTypes = function (section, isFirstLoad) {
      	SpecParamCustomizationUtility.getAdminTypesFromPageObject(section.type, function(data){          
      		const labelList = data.result;
      		if(labelList == undefined) labelList = [];
      		section.dBTypes =labelList.applicableTypes; 
      		renderLabels(section,section.labelDiv, labelList.applicableTypes);
     		initAllTypes(section, labelList);
     		renderUnsavedNotification(section, false, isFirstLoad);
 		 }, function(err){ console.log(err)});
      }
     
     const getSavedConfig = function (section, isFirstLoad) {
     // 	SpecParamCustomizationUtility.getAdminTypesFromPageObject(section.type, function(data){          
      		
      		var renderConfig ={};
      		renderConfig.applicableTypes = [{ "dbName":section.dBTypes[0],"nlsLabel":SpecificationManagementNLS[section.dBTypes[0]]}];
      		renderLabels(section,section.labelDiv, renderConfig.applicableTypes);
     		initAllTypes(section, renderConfig);
     		renderUnsavedNotification(section, false, isFirstLoad);
 		// }, function(err){ console.log(err)});
      }
   
    const renderLabels = function(section, labelDiv, labelList){
    	labelDiv.setContent("");
     	if(labelList){
     		 let clsoableChip = section.type == "formulatedPrdConfig" ? false : true;
	        for (let i = 0; i < labelList.length; i++) {  
	          let label = new WUXLabel({
	            value: labelList[i].nlsLabel,
	            domId: labelList[i].dbName,
	            emphasize: "primary",
	            appearance: clsoableChip ? "closeable-chip" :"chip"
	          }).inject(labelDiv);
	          label.getContent().addClassName("xsr_label");
	          if(clsoableChip){
		          label._closeButton.addEventListener('click', function(e) {
		              console.log(label.value+"_"+ label.domId);
		              let model = null;
		              renderUnsavedNotification(section, true, false);
		              model =section.dropDown.elementsTree;
		              let dbTypes =  [];
		          	  for(var i=0; i<section.dBTypes.length; i++){
		          	   	if(section.dBTypes[i].dbName !== label.domId)
		          	   		dbTypes.push(section.dBTypes[i]);
		          	  }
		          	  section.dBTypes = dbTypes;
		              
		              model.prepareUpdate();
		  			  let rm_node = new TreeNodeModel({
				          label: label.value,
				          value: label.domId
				      });
		  			  model.addRoot(rm_node);
					  model.pushUpdate();
		           })
	          }
	        }
     	}
        
    };
    
	return  {

		getAllTypes: function (section, savedTypes){
			if(section.type == "productSpecTypes")
				productConfig = section;
			initAllTypes(section, savedTypes);
			
		},
		getSavedTypes: function (section){
			if(section.type == "formulatedPrdConfig")
				getSavedConfig(section, true);
			else
				getSavedTypes(section, true);
		},
		loadTypeCache : function (cacheObj){
			componentCache = cacheObj;
			console.log(componentCache);
		},
		loadSubTypes :  function (type, subtypeList) {
			const onSuccess = function (data) {
				subtypeList = data;
				console.log(data);
	        };

	        const onFailure = function (data) {
	            console.log(data);
	        };
	        let resp =  SpecParamCustomizationUtility.getTypesFromServer(type, onSuccess, onFailure);
		},
        /**
         * CreateComponent method - Called in SpecificationManagementView 
         * This method create component and inject it into parentElement. 
         * @param {any} type templateOptional / prodSpecOptional - Use to create the good component
         * @param {any} parentElement this is the element in which the component will be injected
         */
        createComponent: function (type, parentElement) {
            switch(type){
                case "templateOptional" : createParamComponent(
                    SpecificationManagementNLS.SpecificationTemplateOptional,
                    SpecificationManagementNLS.SpecificationTemplateOptionalDesc,
                    parentElement,
                    type,
                    "templateOptional" // contextualDateActivation
                ); break;

                //FUN152060- Modeling and simulation setting component creation
                case "ModelingandSimulationOptional" : newModelingandSimulationCheckBoxhandler = createParamComponent(
                    SpecificationManagementNLS.ModelingandSimulationOptional,
                    SpecificationManagementNLS.ModelingandSimulationOptionalDesc,
                    parentElement,
                    type,
                    "ModelingandSimulationOptional" 
                ); break;
                //

                //FUN152060- Formula setting component creation
                case "FormulaOptional" : newFormulaCheckBoxhandler=createParamComponent(
                    SpecificationManagementNLS.FormulaOptional,
                    SpecificationManagementNLS.FormulaOptionalDesc,
                    parentElement,
                    type,
                    "FormulaOptional"
                ); break;
                //

                case "prodSpecOptional" : newProductCheckBoxhandler = createParamComponent(
                    SpecificationManagementNLS.ProductSpecificationCreateOptional,
                    SpecificationManagementNLS.ProductSpecificationCreateOptionalDesc,
                    parentElement,
                    type,
                    "prodSpecOptional" 
                ); break;

                case "prodSpecOOTBTypeOptional" : showOOTBTypeCheckBoxhandler = createParamComponent(
                    SpecificationManagementNLS.EnableOOTBProductSpecTypes,
                    SpecificationManagementNLS.EnableOOTBProductSpecTypesDesc,
                    parentElement,
                    type,
                    "prodSpecOOTBTypeOptional" 
                ); break;
            }
        },
        
        createLabelAndInfoComponent: function(label, description, parentElement) {
            createLabelCase(label, parentElement);
            createInformationCase(description, parentElement);    
            createEmptyColumns(parentElement,2);
            UWA.createElement('td', {
                'class': 'specvalidation'
            });
        },
        
        /**
         * createDropdownComponent method -
         */
       
        createAutoCompleteSection: function(section, autoCompleteDiv,  subTypeList){
        	
        	let model = new TreeDocument();
            let myAutoComplete = null;
            let sectionType = section.type;

            myAutoComplete = new WUXAutoComplete({
             	  elementsTree: model,
             	  multiSearchMode: true,
             	  domId: sectionType,
             	  placeholder:"Fetching data...",
             	  allowFreeInputFlag: false
            });
            
            myAutoComplete.addEventListener("change", function () {
            	if (myAutoComplete.selectedItems) {
            		renderUnsavedNotification(section, true, false);
				} else {
					console.log("selectedItems empty");
				}
			});
         
            setDropdownAndLabelDiv(section, myAutoComplete, autoCompleteDiv);
            setFooterDiv(section, myAutoComplete, autoCompleteDiv); 
            let notifyUnsavedDiv =section.unsavedDiv;
            
            var saveButton =section.saveBtn;
        	saveButton.getContent().addEventListener('buttonclick', function(){
        		 
                 var selectedData = myAutoComplete.value;
                 if(selectedData === undefined ){
                	 selectedData = [];
                 }
                 var savedTypes = [];
                 
                 section.notifyDiv = notifyUnsavedDiv;
                 if(section.dBTypes && section.dBTypes.length>0)
                	 savedTypes = section.dBTypes;
				 if(savedTypes && savedTypes.length>0)  
					 for(var i=0; i<savedTypes.length; i++) selectedData.push(savedTypes[i].dbName);
				 
                 if(selectedData){
                	 if(selectedData.length >= section.allTypes.length){ 
                		 SpecParamAlertUtility.message('error',SpecificationManagementNLS.AllTypesSelected);
	 	             }else{
    				 var dataToSave = {};
     				 dataToSave.applicableTypes = selectedData;
    				 
                     const onSuccess = function(data){
                         SpecParamAlertUtility.message('success',SpecificationManagementNLS.TypeSaveSuccess);
                         getSavedTypes(section, false);
                         notifyUnsavedDiv.setContent(" ");
                     }
                     const onFailure = function (data) {
                    	 SpecParamAlertUtility.message('error',SpecificationManagementNLS.TypeSaveFailure);
                     };
                     const pageName = getPageName(sectionType);
                     SpecParamCustomizationUtility.saveSubTypesConfig(pageName,dataToSave, onSuccess, onFailure);
                 }                 
                 }
             });

        	 section.showAll.getContent().addEventListener('buttonclick', function(){
        		 initAllTypes(section, []);
        		 renderUnsavedNotification(section, true, false);
        		 section.dBTypes = [];  
        		 section.labelDiv.setContent("");
             });
        	 
        },
  
        /**
         * createDropdownComponent method - for Formulated Product
         */
       
        createAutoCompleteSingleSelection: function(section, autoCompleteDiv,  subTypeList, isMultiselect){
        	
        	let model = new TreeDocument();
            let myAutoComplete = null;
            let sectionType = section.type;
           
            myAutoComplete = new WUXAutoComplete({
             	  elementsTree: model,
             	  multiSearchMode: isMultiselect,
             	  domId: sectionType,
             	  placeholder:"Fetching data...",
             	  allowFreeInputFlag: false
            });
            
            myAutoComplete.addEventListener("change", function () {
            	if (myAutoComplete.selectedItems) {
            		renderUnsavedNotification(section, true, false);
				} else {
					console.log("selectedItems empty");
				}
			});
            setDropdownAndLabelDiv(section, myAutoComplete, autoCompleteDiv);
            setFooterDiv(section, myAutoComplete, autoCompleteDiv);  
         
            //initCombobox(section, myAutoComplete, "" );

            let notifyUnsavedDiv =section.unsavedDiv;
        	var saveButton = section.saveBtn ;
        	saveButton.getContent().addEventListener('buttonclick', function(){
        		
        		var selectedData = myAutoComplete.value == undefined ? "Percentage" : myAutoComplete.value;
        		 const onSuccess = function(data){
                     SpecParamAlertUtility.message('success',SpecificationManagementNLS.BOMUnitsSaveSuccess);
                     section.dBTypes = [selectedData];
                     getSavedConfig(section, false);
                     notifyUnsavedDiv.setContent(" ");
                 }
                 const onFailure = function (data) {
                	 SpecParamAlertUtility.message('error',SpecificationManagementNLS.BOMUnitsSaveFailure);
                 };
                SpecParamCustomizationUtility.setFormulaBOMUnitsParam(selectedData, onSuccess, onFailure);

             });

        	section.showAll.getContent().addEventListener('buttonclick', function(){
        		 initAllTypes(section, []);
        		 renderUnsavedNotification(section, true, false);
        		 section.dBTypes = [];  
        		 section.labelDiv.setContent("");
             });
        	 
        },
	}
});


/*@fullReview  ZUR 15/11/23 2017x Param Skeleton*/
/*global define, widget*/
define('DS/ParameterizationSkeleton/Views/ParamSpecificationManagement/SpecificationManagementView',
    [
        'UWA/Core',
        'UWA/Class/View',
        'DS/UIKIT/Mask',
        'DS/ParameterizationSkeleton/Views/ParamSpecificationManagement/SpecificationUXComponents',
        'DS/Controls/Accordeon',
        'DS/Controls/Expander',
        'i18n!DS/ParameterizationSkeleton/assets/nls/SpecificationManagementNLS'
    ], function (UWA, View, Mask, UXComponent, Accordion,WUXExpander, SpecificationManagementNLS) {

        'use strict';
        var extendedView;
        var xsrTypesCache;
        const baseConfig ={
        		type:null,
        		dropDown:null,
        		allTypes:[],
        		dBTypes:[],
        		labelDiv:null,
        		notifyDiv:null,
        		unsavedDiv:null,
        		saveBtn:null,
        		showAll:null
        }
        var rmConfig = Object.assign({}, baseConfig); 
        rmConfig.type = "rawMaterialTypes";
        var prdConfig =  Object.assign({}, baseConfig);
        prdConfig.type ="productSpecTypes";
        var frmConfig =  Object.assign({}, baseConfig);
        frmConfig.type ="formulatedPrdConfig";
        frmConfig.allTypes = [
			{ "dbName":"Percentage","nlsLabel":SpecificationManagementNLS.Percentage},
			{ "dbName":"Weight","nlsLabel":SpecificationManagementNLS.Weight}
		];

        extendedView = View.extend({

            defaultOptions: {
                type: 'default'
            },

            // The ‘options’ object is passed via the ‘viewOptions’ specified in the Renderer at the Skeleton instantiation
            init : function (options) {
                UWA.log("SpecificationManagementView::init");
                UWA.log(options);
                this.options  = UWA.clone(options || {}, false); //environment options
                this._parent(options); 
                this.childView = null;
                this.isCloud = options.contents.isCloudEnv;//FUN152060- cloud entry added for admins page material setting
            },

            setup: function(options) {
                UWA.log('LayoutView::setup');
                UWA.log(options);
               
            },
            render: function () {
                var that = this;
              
                //This is the main div. 
                that.contentDiv =  UWA.createElement('div', {'id': "specificationParamContainer"});
                that.container.setContent(that.contentDiv);
                that.contentDiv.parentElement.classList.add("configurated-structure-main") ;
                that.createHeader(that.contentDiv);

                // Material section
                if(that.isCloud){
                    var materialTypeSection = UWA.createElement('div', {'id': "materialTypeSection"});
                    that.addMaterialOptional(materialTypeSection);
                }//FUN152060- material section added for admins page only for cloud

                // Product specification section
                var prodSpecTypeSection = UWA.createElement('div', {'id': "prodSpecTypeSection"});
                that.addProductSpecOptional(prodSpecTypeSection);
                UXComponent.createAutoCompleteSection(prdConfig,prodSpecTypeSection, this.xsrTypesCache);
                
                //Raw Material section
                var rawMaterialSection = UWA.createElement('div', {'id': "rawMaterialSection"});
                that.createInformationView('infoTable',SpecificationManagementNLS.InfoLabelForRawMat,SpecificationManagementNLS.InfoDescriptionForRawMat).inject(rawMaterialSection);
                UXComponent.createAutoCompleteSection(rmConfig,rawMaterialSection,this.xsrTypesCache);
                
                // Formulated Product section
                var fomrulatedProdSection = UWA.createElement('div', {'id': "formulatedProdUnitSection"});
                 if(that.isCloud){
                    that.createConfigurationParamView('materialConfigTable',{"FormulaCase" : "FormulaOptional"}).inject(fomrulatedProdSection)
                 }
            	that.createInformationView('infoTable',SpecificationManagementNLS.InfoLabelForFRMProduct,SpecificationManagementNLS.InfoDescForFRMProduct).inject(fomrulatedProdSection);
                UXComponent.createAutoCompleteSingleSelection(frmConfig,fomrulatedProdSection,this.xsrTypesCache, false);
                
               
                UXComponent.getAllTypes(prdConfig,[]);
                UXComponent.getAllTypes(rmConfig,[]);
                UXComponent.getAllTypes(frmConfig,[]);
                UXComponent.getSavedTypes(prdConfig);
                UXComponent.getSavedTypes(rmConfig);
           //     UXComponent.getSavedTypes(frmConfig);

                //FUN152060 - material section info for accordion
                const newItem =
                {
                    header: SpecificationManagementNLS.MaterialAccordionTab,
                    content: materialTypeSection,
                    expandedFlag: true
                };
                //

                //FUN152060 - accordion items info that needs to be shown in admins page 
                var specItems = [
                    {
                        header: SpecificationManagementNLS.GeneralConfigurationAccordionTab,
                        content: that.createConfigurationParamView('generalConfigTable',
                            {
                                "templateOptionalCase": "templateOptional"
                            }
                        ),
                        expandedFlag: true
                    },
                    {
                        header: SpecificationManagementNLS.ProductSpecTypesAccordionTab,
                        content: prodSpecTypeSection,
                        expandedFlag: true
                    },
                    {
                        header: SpecificationManagementNLS.RawMaterialTypesAccordionTab,
                        content: rawMaterialSection,
                        expandedFlag: true
                    },
                    {
                        header: SpecificationManagementNLS.FormulatedProductAccordionTab,
                        content: fomrulatedProdSection,
                        expandedFlag: true
                    }
                ]
                //

                //FUN152060 - if cloud env- add material accordion info to specitems array
                if (that.isCloud) {

                    specItems = [...specItems.slice(0, 1), newItem, ...specItems.slice(1)];
                }
                //

                //FUN152060- Create accrodion for all settiing that are in specItems array
                new Accordion({
                    className: 'filled',
                    exclusive: false,
                    items: specItems
                }).inject(that.contentDiv);
                //
                
                Promise.all([this._fetchPLMTypesPromise]).then(function() {
                  //  this.onCompleteRequestMapping();
                }.bind(this)).catch(function() {
                    Mask.unmask(this.contentDiv);
                }.bind(this));
                
                return that;
            },

            //FUN152060- Material section includes ModelingandSimulationCase & FormulaCase settings
            addMaterialOptional:function(materialTypeSection){
            	var that = this;
            	that.createConfigurationParamView('materialConfigTable',
                        {
            				"ModelingandSimulationCase" : "ModelingandSimulationOptional"
                        }).inject(materialTypeSection);
            },
            //

            addProductSpecOptional:function(prodSpecTypeSection){
            	var that = this;
            	that.createConfigurationParamView('productSpecTable',
                        {
            				"prodSpecOptionalCase" : "prodSpecOptional"
                        }).inject(prodSpecTypeSection);
                that.createConfigurationParamView('productSpecTable',
                        {
            				"prodSpecOOTBTypeOptionalCase" : "prodSpecOOTBTypeOptional"
                        }).inject(prodSpecTypeSection)
            	that.createInformationView('infoTable',SpecificationManagementNLS.InfoLabelForProduct,SpecificationManagementNLS.InfoDescriptionForProduct).inject(prodSpecTypeSection);
            },
         
            createConfigurationParamView: function (id,array) {
                var specConfigParamTable = UWA.createElement('table',
                    {
                        'id': id,
                        'class' : 'specConfigParamTable'
                    }
                );
                Object.entries(array).forEach(entry => {
                    const [key, value] = entry;
                    UXComponent.createComponent(value, this.createTableCase(key, specConfigParamTable));
                });           
                return specConfigParamTable;
            },
            
            createInformationView: function (id, label, description) {
                var informationParamTable = UWA.createElement('table',
                    {
                        'id': id,
                        'class' : 'specConfigParamTable'
                    }
                );
                UXComponent.createLabelAndInfoComponent(label,description,this.createTableCase("infoTable", informationParamTable));       
                return informationParamTable;
            },
            
            createConfigurationTypesView: function () {
                    const element =  UXComponent.createDropdownComponent();
                    return element;
//                return configurationParamTable;
            },
            

            createTableCase: function (id, parentElement) {
                var tableCase =  UWA.createElement('tr', {
                    'id': id,
                    'class': 'specConfigTableCase',
                }).inject(parentElement);

                tableCase.addEventListener('mouseover', function () {
                    tableCase.classList.add('colored')
                });

                tableCase.addEventListener('mouseout', function () {
                    tableCase.classList.remove('colored');
                }); 

                return tableCase;

            },

            createHeader: function (parentElement) {
                UWA.createElement('div', {
                    'id': "specConfigParamTitle",
                    html: SpecificationManagementNLS.SpecManagementHeader
                }).inject(parentElement);
            },
    

            onCompleteRequestMapping : function(){
                Mask.unmask(this.contentDiv);

            },

            destroy: function() {
                this.stopListening();
                this._parent.apply(this, arguments);
            }

        });
        return extendedView;
    });



define("DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/dictionary/DictionaryCUSTO", ["require", "exports", "DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/dictionary/Dictionary"], function (require, exports, DictionaryModule) {
    "use strict";
    var DictionaryCUSTOModule;
    (function (DictionaryCUSTOModule) {
        var KEYS = {
            DictionaryCUSTO_PATH: '/resources/dictionary/DictionaryCUSTO'
        };
        DictionaryCUSTOModule.DictionaryCUSTO = DictionaryModule.Dictionary.extend({
            isCustom: function () {
                return true;
            },
            /** returns the path to use to for collection call */
            getModelPath: function () {
                return KEYS.DictionaryCUSTO_PATH;
            },
            /** customize the url of the collection call */
            customizeModelCallUrl: function (url) {
                this._parent(url);
                url.searchParams.append('nlsResolution', 'false');
                url.searchParams.append('maxAge', '0');
            }
        });
    })(DictionaryCUSTOModule || (DictionaryCUSTOModule = {}));
    return DictionaryCUSTOModule;
});

define("DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/dictionary/DictionaryOOTB", ["require", "exports", "DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/dictionary/Dictionary"], function (require, exports, DictionaryModule) {
    "use strict";
    var DictionaryOOTBModule;
    (function (DictionaryOOTBModule) {
        var KEYS = {
            DictionaryOOTB_PATH: '/resources/dictionary/DictionaryOOTB'
        };
        DictionaryOOTBModule.DictionaryOOTB = DictionaryModule.Dictionary.extend({
            isCustom: function () {
                return false;
            },
            /** returns the path to use to for collection call */
            getModelPath: function () {
                return KEYS.DictionaryOOTB_PATH;
            }
        });
    })(DictionaryOOTBModule || (DictionaryOOTBModule = {}));
    return DictionaryOOTBModule;
});

/**
* @quickreview  ROW 23:12:29 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDEL3DOperationsViewer/DEL3DOperationsViewerConfigLayoutView',
  [
    'UWA/Core',
    'UWA/Utils/InterCom',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationLayoutView',
    'DS/ParameterizationSkeleton/Views/ParameterizationDEL3DOperationsViewer/DEL3DOperationsViewerConfigFamilyView',
    'DS/UIKIT/Input/Button',
    'DS/UIKIT/Input/File',
    'DS/UIKIT/Input/Text',
    'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DEL3DOperationsViewerConfiguration',
    'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS'
  ],
  function (
    UWA,
    InterCom,
    DELConfigurationLayoutView,
    DEL3DOperationsViewerConfigFamilyView,
    Button, UXFile, Text,
    ParamLayoutUtilities,
    Nls,
    ParamSkeletonNLS
  ) {

    'use strict';

    var DEL3DOperationsViewerConfigLayoutView = DELConfigurationLayoutView.extend({

      /*
      * init
      */
      init: function init(options) {
        var that = this;
        this._parent(options);
      },

      /*
      * onCompleteRequestParameters
      */
      onCompleteRequestParameters: function onCompleteRequestParameters() {
        //removeApply Reset div
        var eltUI = document.getElementById("ApplyResetDiv");
        if (eltUI) {
          var parentNode = eltUI.getParent();
          parentNode.removeChild(eltUI);
        }

        this._parent();
      },

      /*
      * buildParameterLine
      */
      buildParameterLine: function (iParamObj, familyID, familytbody, popoverPosition) {

        var that = this;
        var args = iParamObj.argument;
        for (var i = 0; i < args.length; i++) {
          var arg = args[i];
          if (arg && arg.defaultValue === "DELConfigurationTreeListView") {
            //this.nbofShownParameters++;
            familytbody.parentElement.style.marginLeft = '-6px';
            var contentTreeView = UWA.createElement('div');

            var options = {};
            options.xmlDoc = that._xmlMap.get(arg.id);
            options.domainid = that._domainID;
            options.familyid = familyID;
            options.parameterid = iParamObj.id;
            options.argid = arg.id;

            options.treeListViewNls = that._xmlNls.get(arg.id)[0];
            options.modalViewNls = that._xmlNls.get(arg.id)[1];
            options.nodeTreeViewNls = that._xmlNls.get(arg.id)[2];

            //var familyView = new DEL3DOperationsViewerConfigFamilyView(options);
            that._familyView = new DEL3DOperationsViewerConfigFamilyView(options);
            that._listOfFamilyViews.push(that._familyView);

            var treelistViewContent = that._familyView.buildFamilyContent();
            treelistViewContent.inject(familytbody);
          }
        
          else
            this._parent(iParamObj, familyID, familytbody, popoverPosition);
        }
      },

    });
    
    return DEL3DOperationsViewerConfigLayoutView;
  });

/**
* @quickreview  KB9 21:10:25 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDEL3DOperationsViewer/DEL3DOperationsViewerConfigParentView',
		[
	 'UWA/Core',
	 'DS/ParameterizationSkeleton/Views/ParametersParentView',
	 'DS/ParameterizationSkeleton/Views/ParameterizationDEL3DOperationsViewer/DEL3DOperationsViewerConfigLayoutView'
	 ],
	 function (
		 UWA,
		 ParametersParentView,
		 DEL3DOperationsViewerConfigLayoutView
		)
{

	'use strict';


	var DEL3DOperationsViewerConfigParentView = ParametersParentView.extend({

		init: function (options) {
			options = UWA.clone(options || {}, false);
			this._domainID = options.domainid;
			this._parent(options);
		},

		setup: function (options) {
			UWA.log('DEL3DOperationsViewerConfigParentView Layout::setup!');
			UWA.log(options);

		},

		render : function()
		{
			var that = this;
			var options = this.options;

		  var layoutView = new DEL3DOperationsViewerConfigLayoutView(options);
			return layoutView.render();
		}
	});

	return DEL3DOperationsViewerConfigParentView;
});

/**
* @quickreview  NSY5 25:04:04 IR-1382770 - [Console Parameter] Add Corpus Type in Attributes of Process Translation
* @quickreview  NSY5 25:03:12 IR-1374775 - Parameter Console - In Process Translation, Attribute is not displaying inherited attributes
* @quickreview  NSY5 25:01:22 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDELUserExperience/DELProcessTranslationAttributesFamilyView',
  [
  'UWA/Core',
  'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
  'DS/ParameterizationSkeleton/Utils/ParameterizationDELUserExperience/ParameterizationDELUserExperienceWebServices',
  'i18n!DS/ParameterizationSkeleton/assets/nls/DELUserExperienceConfiguration'
  ],
  function (
    UWA,
    DELConfigurationFamilyView,
    ParameterizationDELUserExperienceWebServices,
    Nls
  )
{

  'use strict';

  var DELProcessTranslationAttributesFamilyView = DELConfigurationFamilyView.extend({

    _attributesResult : null,
    _node : null,
    _bEditMode : false,

    _CONSTANTS : {

      // Column Ids
      ATTRIBUTES_COLUMNIDS: {
        CORPUSTYPE: 'CorpusType',
        TYPE: 'Type',
        INCLUDEALLATTRIBUTES: 'IncludeAllAttributes',
        ATTRIBUTE: 'Attribute',
      },

      ATTRIBUTES_RESULTID : {
        ATTRIBUTES: 'attributes',
        TYPES: 'types',
        TYPENAME: 'typeName',
        TYPENLSNAME: 'typeNlsName'
      }
    },
    
    _ListOfTypes : {
      process : ['DELLmiPPROperationReference', 'DELLmiPPRSystemReference', 'DELLmiOperationPPRInstance', 'DELLmiPPRSystemInstance'],
      item: ['DELFmiFunctionReference', 'DELFmiFunctionInstance'],
      resource: ['Worker', 'IndustrialMachine', 'NCMachine', 'ToolDevice', 'Inspect', 'Transport', 'Conveyor', 'UserDefined', 'Sensor', 
        'Pool', 'ResourceManufacturingSetup', 'DELRmiPathway', 'LogicController', 'ControlDevice', 'ErgoHuman', 'Robot', 'ResourceArea', 
        'Organizational', 'WorkCenter', 'ResourceNCCellTemplate', 'ResourceDepartment', 'ResourceFactory', 'ResourceLine'],  
    },

    /*
    * init
    */
    init : function init(options)
    {
      var that = this;
      this._parent(options);

      that._treeListViewNls = Nls;
      that._modalViewNls = Nls;
      that._nodeTreeViewNls = Nls;
      that._needTitleForTreeListView = true;

    },

    /*
    * render
    */
    render : function render()
    {
      var that = this;
      this._parent();

      return this;
    },

    /*
    * mapFunctions
    */
    mapFunctions: function mapFunctions(name)
    {
        var that = this;
        if (name === "onChangeTypeCombo")
          return that.onChangeTypeClick.bind(that);
        if(name === "onChangeIncludeAllAttributes")
          return that._onChangeIncludeAllAttributes.bind(that);
        if(name === "onChangeCorpusTypeCombo")
          return that._onChangeCorpusTypeCombo.bind(that);
        return null;
    },
    
    /*
    * getPromisetoGetInfofromDB
    */
    getPromisetoGetInfofromDB: function getPromisetoGetInfofromDB() {
      var that = this;
      var promise = new UWA.Promise(function (resolve, reject) {

        var tobecalledGetInfofromDB = false;
        var typekeys = Object.keys(that._ListOfTypes);
        for (let iType of typekeys) {
          if (that._attributesResult == null || that._attributesResult == undefined || that._attributesResult[iType] == undefined || that._attributesResult[iType] == null
            || that._attributesResult[iType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES] === undefined || that._attributesResult[iType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES] === null) {
            tobecalledGetInfofromDB = true;
            break;
          }
        }

        if (true === tobecalledGetInfofromDB) {
          if (that._attributesResult == null || that._attributesResult == undefined)
            that._attributesResult = [];

          var listOfTypes = Object.values(that._ListOfTypes).flat();
          ParameterizationDELUserExperienceWebServices.getlistofAllAttributes(listOfTypes, {
            onSuccess: function (data) {
              that._readResponseAndPopulateData(data);
              resolve();
            }
          });
        }
        else
          resolve()
      });
      return promise;
    },

    /*
    * Function to read response from getAttributes web service and create local lists for attributes and types 
    */
    _readResponseAndPopulateData: function _readResponseAndPopulateData(data) {
      var that = this;
      if (that._attributesResult === null)
        that._attributesResult = [];

      var typekeys = Object.keys(data);
      typekeys.forEach(iType => {

        var dataType = null;
        for (const key in that._ListOfTypes) {
            if (that._ListOfTypes[key].includes(iType)) {
              dataType = key;
              break;
            }
        }
        
        if (that._attributesResult[dataType] === undefined)
          that._attributesResult[dataType] = {};

        var dicotypekeys = Object.keys(data[iType]);
        dicotypekeys.forEach(dicoType => {
          var attrKeys = Object.keys(data[iType][dicoType]);
          attrKeys.forEach(attrKey => {

            // 	NSY5 - Fixed IR-1351086 - Parameters Console - Process Flow Diagram - Colors - Some item types are missing
            if (attrKey !== "DicoType") {
              if (that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES] === undefined)
                that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES] = {};
  
              var attrObj = data[iType][dicoType][attrKey];
              
              if (that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType] === undefined)
                that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType] = {};
  
              that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType][attrKey] = attrObj;
  
              if (that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES] === undefined)
                that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES] = {};
  
              if (that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES][dicoType] === undefined)
                that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES][dicoType] = {};
  
              that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES][dicoType][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPENAME] = attrObj.DictionaryName;
              that._attributesResult[dataType][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES][dicoType][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPENLSNAME] = attrObj.DictionaryNLSName;
            }
          });
        });
      });
    },

    /*
    * buildFamilyContent
    */
    buildFamilyContent: function buildFamilyContent() {

      var that = this;
      that._nodeTreeViewNls.treeViewTitle = that._nodeTreeViewNls.attributesTableName;
      
      var content  =this._parent();
      return content;
    },

    /*
    * buildModal
    */
    buildModal : function buildModal(bEditMod)
    {
      var that = this;
      that._modalViewNls.modalTitle = that._modalViewNls.attributesTableName;
      that._modalViewNls.Info = that._modalViewNls.Info_Attributes_modal;
      that._modalViewNls.attributeNameTooltip = that._modalViewNls.attributeNameTooltipForAttributesModal;
      this._parent(bEditMod);
      
      var attributesTypeCombo = document.getElementById(that._CONSTANTS.ATTRIBUTES_COLUMNIDS.TYPE);
      attributesTypeCombo.dsModel.disabled = true;
      
      var attributeCombo = document.getElementById(that._CONSTANTS.ATTRIBUTES_COLUMNIDS.ATTRIBUTE);

      if (bEditMod){
        attributeCombo.dsModel.disabled = false;

        var attrCorpusTypeCombo = document.getElementById(that._CONSTANTS.ATTRIBUTES_COLUMNIDS.CORPUSTYPE);
        attrCorpusTypeCombo.dsModel.disabled = true;
      }
      else {
        attributeCombo.dsModel.disabled = true;
      }
      
      that._uiElementsIDs.forEach(element => {
        if (element.id === that._CONSTANTS.ATTRIBUTES_COLUMNIDS.ATTRIBUTE) {
          element.mandatory = bEditMod;
        }
      });
    },

    /*
    * validateModal
    */
    validateModal : function validateModal()
    {
      var that = this;
      console.log("validateModal");
      var treeNodesList = [];
      var data = new Map();
      var grid = new Map();

      var uiElementsIDLength = that._uiElementsIDs.length;

      var data = new Map();
      var grid = new Map();

      for (var i=0;i<uiElementsIDLength;i++){
        var uiEl = document.getElementById(that._uiElementsIDs[i].id);
        if (uiEl)
        {
          if (uiEl.dsModel.checkFlag != undefined && uiEl.dsModel.checkFlag != null)
          {
            data.set(that._uiElementsIDs[i].id, uiEl.dsModel.checkFlag);
            grid.set(that._uiElementsIDs[i].id, uiEl.dsModel.checkFlag);
          }
          else
          {
            if (that._uiElementsIDs[i].mandatory === true)
            {
              var bMandatoryField = false;
              if (that._uiElementsIDs[i].type != "combobox")
              {
                if (uiEl.dsModel.value != undefined && uiEl.dsModel.value != null && uiEl.dsModel.value != "")
                {
                  bMandatoryField = true;
                  data.set(that._uiElementsIDs[i].id, uiEl.dsModel.value);
                  grid.set(that._uiElementsIDs[i].id, uiEl.dsModel.value);
                }
              }
              else {
                if (uiEl.dsModel.label != undefined && uiEl.dsModel.label != null && uiEl.dsModel.label != "")
                {
                  bMandatoryField = true;
                  data.set(that._uiElementsIDs[i].id, uiEl.dsModel.value);//uiEl.dsModel.label);
                  grid.set(that._uiElementsIDs[i].id, uiEl.dsModel.label);
                }
              }

              if (!bMandatoryField) {
                var mandatoryCol = that._treeListViewNls[that._uiElementsIDs[i].id];
                var nlsErrorMsg = Nls.columnMandatory;
                nlsErrorMsg = nlsErrorMsg.replace("%1", mandatoryCol);
                that._modalView.showToastMessage(2, nlsErrorMsg);
                return;
              }
            }
            else
            {
              if (that._uiElementsIDs[i].type != "combobox")
              {
                data.set(that._uiElementsIDs[i].id, uiEl.dsModel.value);
                grid.set(that._uiElementsIDs[i].id, uiEl.dsModel.value);
              }
              else
              {
                data.set(that._uiElementsIDs[i].id, uiEl.dsModel.value);//uiEl.dsModel.label);
                grid.set(that._uiElementsIDs[i].id, uiEl.dsModel.label);
              }
            }
          }
        }
      }

      var objData = {};
      var objGrid = {};
      data.forEach(function(value, key){;
        if (value != "" && value != undefined)
          objData[key] = value;
      });

      grid.forEach(function(value, key){
        objGrid[key] = value;
      });

      var treeNodeModel = that.createtreeNode(objData, objGrid);
      return treeNodeModel;
    },   

    /*
    * _updateTypeComboinAttributes
    */
    _updateTypeComboinAttributes : function _updateTypeComboinAttributes(datatype)
    {
      var that = this;

      var comboAttributeKeys = document.getElementById(that._CONSTANTS.ATTRIBUTES_COLUMNIDS.TYPE);
      comboAttributeKeys.dsModel.disabled = true;
      comboAttributeKeys.dsModel.elementsList = [];
      comboAttributeKeys.dsModel.selectedIndex = -1;
      if (that._attributesResult !=  null || that._attributesResult[datatype][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES] != undefined){
        var data = that._attributesResult[datatype][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES];
      
        var listForCombo = that._getListOfElementsForTypeCombo(data);
        
        var comboElementsListLength = listForCombo.length;
        if (comboElementsListLength > 0)
        {
          comboAttributeKeys.dsModel.disabled = that._bEditMode;
          comboAttributeKeys.dsModel.elementsList = listForCombo;
          comboAttributeKeys.dsModel.selectedIndex = -1;
          comboAttributeKeys.dsModel.autocompleteFlag = false;
        }
      }
    },

    /*
    * _getListOfElementsForTypeCombo
    */
    _getListOfElementsForTypeCombo : function _getListOfElementsForTypeCombo(data)
    {
      var that = this;

      var listForCombo = [];
      var typesList = [];
      var typekeys = Object.keys(data);
      var typekeysLength = typekeys.length;
      for (var i=0;i<typekeysLength;i++)
      {
        var typekey = typekeys[i];
        if (typekey && data[typekey])
        {
        var typeObj = data[typekey];
        var attributekeys = Object.keys(typeObj);

          var attributekeysLength = attributekeys.length;
          if (attributekeysLength > 0)
          {
            if(!typesList.includes(typekey) )
            {
              typesList.push(typekey);
              var comboLabel = typeObj.typeNlsName;
              var comboValue = typeObj.typeName;  
              if (true === that._bEditMode || false === that._IsIncludeAllAttributeschecked(comboValue)){
                listForCombo.push({label: comboLabel, value: comboValue});
              }
            }
          }
          if (listForCombo.length) {
            listForCombo.sort(function (comboValue1, comboValue2) {
              if (comboValue1.label.toLowerCase() === comboValue2.label.toLowerCase())
                return 0;
              return comboValue1.label.toLowerCase() > comboValue2.label.toLowerCase() ? 1 : -1;
            });
          }
        }
      }
      return listForCombo;
    },

    /*
    * _updateAttributesCombo
    */
    _updateAttributesCombo : function _updateAttributesCombo(datatype)
    {
      var that = this;

      var comboAttributeKeys = document.getElementById(that._CONSTANTS.ATTRIBUTES_COLUMNIDS.ATTRIBUTE);
      comboAttributeKeys.dsModel.disabled = true;
      comboAttributeKeys.dsModel.elementsList = [];
      comboAttributeKeys.dsModel.selectedIndex = -1;

      var iTypeElt = document.getElementById(that._CONSTANTS.ATTRIBUTES_COLUMNIDS.CORPUSTYPE);
      var dataCorpusType = iTypeElt.dsModel.value;

      if (that._attributesResult !=  null && that._attributesResult[dataCorpusType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES] != undefined && that._attributesResult[dataCorpusType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][datatype] != undefined)
      {
        var data = that._attributesResult[dataCorpusType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][datatype];
      
        var listForCombo = that._getListOfElementsForAttributesCombo(data, datatype)
        var comboElementsListLength = listForCombo.length;
        if (comboElementsListLength > 0)
        {
          comboAttributeKeys.dsModel.disabled = false;
          comboAttributeKeys.dsModel.elementsList = listForCombo;
          comboAttributeKeys.dsModel.selectedIndex = -1;
          comboAttributeKeys.dsModel.autocompleteFlag = false;
        }
      }
    },

    /*
    * _getListOfElementsForAttributesCombo
    */
    _getListOfElementsForAttributesCombo : function _getListOfElementsForAttributesCombo(data, typekey)
    {
      var listForCombo = [];
      var attributesList = [];
      var attributekeys = Object.keys(data);

      var attributekeysLength = attributekeys.length;
      for(var idxAttr=0;idxAttr<attributekeysLength;idxAttr++)
      {
        var attributekey = attributekeys[idxAttr];
        var attrObj = data[attributekey];
        var attr = typekey + '.' + attributekey;
        if(!attributesList.includes(attr) )
        {
          attributesList.push(attr);
          var comboLabel = attrObj.NLSName + ' (' + attrObj.Owner + '.' + attributekey  + ')';
          var comboValue = attrObj.Owner + '.' + attributekey;  
          listForCombo.push({label: comboLabel, value: comboValue});
        }
      }
      if (listForCombo.length) {
        listForCombo.sort(function (comboValue1, comboValue2) {
          if (comboValue1.label.toLowerCase() === comboValue2.label.toLowerCase())
            return 0;
          return comboValue1.label.toLowerCase() > comboValue2.label.toLowerCase() ? 1 : -1;
        });
      }

      return listForCombo;
    },
    
    /*
    * _onChangeCorpusTypeCombo
    */
    _onChangeCorpusTypeCombo: function _onChangeCorpusTypeCombo(data) {
      var that = this;

      if (data.dsModel.elementsList[data.dsModel.selectedIndex] != undefined) {
        that._updateTypeComboinAttributes(data.dsModel.elementsList[data.dsModel.selectedIndex].value);
      }
    },

    /*
    * onChangeTypeClick
    */
    onChangeTypeClick: function onChangeTypeClick(type) {
      var that = this;
      var types = null;
      var bDisableIncludeAllAttributes = false;
      if (type.dsModel != null && type.dsModel != undefined)
      {
        if (type.dsModel.selectedIndex != null && type.dsModel.selectedIndex != undefined && type.dsModel.selectedIndex >= 0)
        {
          if (false === that._bEditMode)
            bDisableIncludeAllAttributes = that._checkTypeisAlreadyPresent(type.dsModel.elementsList[type.dsModel.selectedIndex].value);
          else
            bDisableIncludeAllAttributes = !that._IsIncludeAllAttributeschecked(type.dsModel.elementsList[type.dsModel.selectedIndex].value);
          
          types = ((type.dsModel.elementsList[type.dsModel.selectedIndex].value).split("."))[0];
          that._updateAttributesCombo(types);
        }
      }

      var IncludeAllAttributescheckbox = document.getElementById(that._CONSTANTS.ATTRIBUTES_COLUMNIDS.INCLUDEALLATTRIBUTES);
      var Attributescombo = document.getElementById(that._CONSTANTS.ATTRIBUTES_COLUMNIDS.ATTRIBUTE);
      
      IncludeAllAttributescheckbox.dsModel.checkFlag = !bDisableIncludeAllAttributes;
      IncludeAllAttributescheckbox.dsModel.disabled = bDisableIncludeAllAttributes;

      if (bDisableIncludeAllAttributes)
      {
        var nlsInfoMsg = Nls.includeAllAttributesDisabled;
        nlsInfoMsg = nlsInfoMsg.replace("%1", type.dsModel.elementsList[type.dsModel.selectedIndex].label);
        that._modalView.showToastMessage(0, nlsInfoMsg);
      }

      Attributescombo.dsModel.disabled = IncludeAllAttributescheckbox.dsModel.checkFlag;
    },

    /*
    * _IsIncludeAllAttributeschecked
    */
    _IsIncludeAllAttributeschecked: function _IsIncludeAllAttributeschecked(keytocheck) {
      var that = this;
      var bIncludeAllAttributeschecked = false;
      var numberOfRows = that.treeListView.getRowModelLength();
      for (var rowID = 0; rowID < numberOfRows; rowID++) {
        var attrColumnId = that.treeListView.layout.getColumnIndex(that._CONSTANTS.ATTRIBUTES_COLUMNIDS.INCLUDEALLATTRIBUTES);
        var attrCellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: rowID, columnID: attrColumnId });
        var cellInfos = that.treeListView.getCellInfosAt(attrCellId);
        if (keytocheck === cellInfos.nodeModel.options.data[that._CONSTANTS.ATTRIBUTES_COLUMNIDS.TYPE])
        {
          if (true === cellInfos.nodeModel.options.data[that._CONSTANTS.ATTRIBUTES_COLUMNIDS.INCLUDEALLATTRIBUTES])
            bIncludeAllAttributeschecked = true;
          break;
        }
      }
      return bIncludeAllAttributeschecked;
    },

    /*
    * _checkTypeisAlreadyPresent
    */
    _checkTypeisAlreadyPresent: function _checkTypeisAlreadyPresent(keytocheck) {
      var that = this;
      var bTypeAlreadyPresent = false;
      var numberOfRows = that.treeListView.getRowModelLength();
      for (var rowID = 0; rowID < numberOfRows; rowID++) {
        var attrColumnId = that.treeListView.layout.getColumnIndex(that._CONSTANTS.ATTRIBUTES_COLUMNIDS.INCLUDEALLATTRIBUTES);
        var attrCellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: rowID, columnID: attrColumnId });
        var cellInfos = that.treeListView.getCellInfosAt(attrCellId);
        if (keytocheck === cellInfos.nodeModel.options.data[that._CONSTANTS.ATTRIBUTES_COLUMNIDS.TYPE])
        {
          bTypeAlreadyPresent = true;
          break;
        }
      }
      return bTypeAlreadyPresent;
    },

    /*
    * _onChangeIncludeAllAttributes
    */
    _onChangeIncludeAllAttributes: function _onChangeIncludeAllAttributes(type) {
      var that = this;
      var checked = true;
      if (type.dsModel != null && type.dsModel != undefined)
        checked = type.dsModel.checkFlag;

      var Typecombo = document.getElementById(that._CONSTANTS.ATTRIBUTES_COLUMNIDS.TYPE);
      if (Typecombo.dsModel.selectedIndex >= 0) {
        var comboAttributeKeys = document.getElementById(that._CONSTANTS.ATTRIBUTES_COLUMNIDS.ATTRIBUTE);
        comboAttributeKeys.dsModel.disabled = checked;
        if (true === checked)
          comboAttributeKeys.dsModel.value = undefined;
        that._uiElementsIDs.forEach(element => {
          if (element.id === that._CONSTANTS.ATTRIBUTES_COLUMNIDS.ATTRIBUTE) {
            element.mandatory = !checked;
          }
        });
      }
    },
  
    /*
    * addChild
    */
    addChild : function addChild(nodesTab)
    {
        var that = this;
        that._parent(nodesTab);
        that.treeListView.reapplySortModel();
    },

    /*
    * onOKEditButtonClick
    */
    onOKEditButtonClick : function onOKEditButtonClick()
    {
      var that = this;
      that._bEditMode = true;
      that._parent();
      that._bEditMode = false;
    },

    /*
    * onCancelButtonClick
    */
    onCancelButtonClick : function onCancelButtonClick()
    {
      var that = this;
      that._parent();
      that._bEditMode = false;
    },

  /*
    * createtreeNode
    */
    createtreeNode : function createtreeNode(data, grid)
    {
      var that = this;

      var translationModel = that._parent(data, grid);

      if (grid == undefined) {
        var gridTemp = translationModel.getGrid();
        var dataCorpusType = data[that._CONSTANTS.ATTRIBUTES_COLUMNIDS.CORPUSTYPE];
        
        // We only store actual attribute name in DB, to display we need to construct the NLS name and set it on the grid of DataGrid model.
        if (that._attributesResult != null && that._attributesResult != undefined && gridTemp != undefined && gridTemp.hasOwnProperty(that._CONSTANTS.ATTRIBUTES_COLUMNIDS.TYPE)) {
          if (data[that._CONSTANTS.ATTRIBUTES_COLUMNIDS.TYPE] != undefined) {
            var dicoType = data[that._CONSTANTS.ATTRIBUTES_COLUMNIDS.TYPE];
            
            if (that._attributesResult[dataCorpusType][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES][dicoType] != undefined) {
              var attrObj = that._attributesResult[dataCorpusType][that._CONSTANTS.ATTRIBUTES_RESULTID.TYPES][dicoType];
              var displayLabel = attrObj.typeNlsName;
              gridTemp[that._CONSTANTS.ATTRIBUTES_COLUMNIDS.TYPE] = displayLabel;
            }

            if (that._attributesResult != null && that._attributesResult != undefined && gridTemp != undefined && gridTemp.hasOwnProperty(that._CONSTANTS.ATTRIBUTES_COLUMNIDS.ATTRIBUTE)) {
              if (data[that._CONSTANTS.ATTRIBUTES_COLUMNIDS.ATTRIBUTE] != undefined && data[that._CONSTANTS.ATTRIBUTES_COLUMNIDS.ATTRIBUTE].includes('.')) {
                var storedAttribute = data[that._CONSTANTS.ATTRIBUTES_COLUMNIDS.ATTRIBUTE];
                var attribute = ((storedAttribute).split("."))[1];//((((storedAttribute).split("."))[1]).split(" ("))[0];
    
                if (that._attributesResult[dataCorpusType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType] != undefined) {
                  var attrObj = that._attributesResult[dataCorpusType][that._CONSTANTS.ATTRIBUTES_RESULTID.ATTRIBUTES][dicoType];
    
                  dicoType = ((storedAttribute).split("."))[0];
                  var attrkey = Object.keys(attrObj);
                  for (let i = 0; i < attrkey.length; i++ )
                  {
                    if (dicoType === attrObj[attrkey[i]].Owner && attribute === attrObj[attrkey[i]].Name) {
                      var displayLabel = attrObj[attrkey[i]].NLSName + ' (' + attrObj[attrkey[i]].Owner + '.' + attrObj[attrkey[i]].Name  + ')';
                      gridTemp[that._CONSTANTS.ATTRIBUTES_COLUMNIDS.ATTRIBUTE] = displayLabel;
                      break;
                    }
                  }
                }
              }
            }
          }
        }
      }

        return translationModel;
    },

    /*
    * editSelectedNode
    */
    editSelectedNode : function editSelectedNode(params)
    {
      console.log("params " + params);
      var that = this;
      that._bEditMode = true;
      that._parent(params);
    }
  });
  return DELProcessTranslationAttributesFamilyView;
});

define("DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/ApiCollection", ["require", "exports", "UWA/Class/Collection", "DS/ParameterizationSkeleton/Utils/ParameterizationPartSupply/Utils"], function (require, exports, Collection, Utils) {
    "use strict";
    var ApiCollectionModule;
    (function (ApiCollectionModule) {
        /**
         * Collection that handles passport fallbacks
         */
        ApiCollectionModule.ApiCollection = Collection.extend({
            sync: function (method, model, options) {
                var _this = this;
                var onPassportError = function (error, resp, headers) {
                    _this.requireAuthentication();
                };
                var _options = Utils.Utils.clone(options);
                _options.onPassportError = onPassportError;
                return this._parent(method, model, options);
            },
            requireAuthentication: function () {
                return window.location.replace('/authenticate?redirectTo=' + encodeURIComponent(window.location.href));
            }
        });
    })(ApiCollectionModule || (ApiCollectionModule = {}));
    ;
    return ApiCollectionModule;
});

define("DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/Api3DSpaceBaseCollection", ["require", "exports", "DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/ApiCollection"], function (require, exports, ApiCollectionModule) {
    "use strict";
    var ParameterizationURLHandlerPath = 'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler';
    var Api3DSpaceBaseCollectionModule;
    (function (Api3DSpaceBaseCollectionModule) {
        ;
        Api3DSpaceBaseCollectionModule.Api3DSpaceBaseCollection = ApiCollectionModule.ApiCollection.extend({
            setup: function (models, options) {
                this._parent(models, options);
                this.configHelper = options.configHelper;
            },
            /** Returns the current tenant */
            getTenant: function () {
                if (this.promiseTenant) {
                    return this.promiseTenant;
                }
                if (this.configHelper) {
                    this.promiseTenant = Promise.resolve(this.configHelper.getTenant());
                }
                else {
                    this.promiseTenant = new Promise(function (resolve, reject) {
                        new Promise(function (resolve_1, reject_1) { require([ParameterizationURLHandlerPath], resolve_1, reject_1); }).then(function (ParameterizationURLHandler) {
                            resolve(ParameterizationURLHandler.getTenant());
                        });
                    });
                }
                return this.promiseTenant;
            },
            /** Returns the space service url */
            get3DSpaceUrl: function () {
                if (this.promise3DSpaceUrl) {
                    return this.promise3DSpaceUrl;
                }
                if (this.configHelper) {
                    this.promise3DSpaceUrl = this.configHelper.get3DSpaceUrl();
                }
                else {
                    this.promise3DSpaceUrl = new Promise(function (resolve, reject) {
                        new Promise(function (resolve_2, reject_2) { require([ParameterizationURLHandlerPath], resolve_2, reject_2); }).then(function (ParameterizationURLHandler) {
                            resolve(ParameterizationURLHandler.getURL());
                        });
                    });
                }
                return this.promise3DSpaceUrl;
            }
        });
    })(Api3DSpaceBaseCollectionModule || (Api3DSpaceBaseCollectionModule = {}));
    ;
    return Api3DSpaceBaseCollectionModule;
});

define("DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/Api3DSpaceCollection", ["require", "exports", "UWA/Core", "DS/WAFData/WAFData", "DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/Api3DSpaceBaseCollection"], function (require, exports, UWA, WAFData, Api3DSpaceBaseCollectionModule) {
    "use strict";
    var Api3DSpaceCollectionModule;
    (function (Api3DSpaceCollectionModule) {
        ;
        Api3DSpaceCollectionModule.Api3DSpaceCollection = Api3DSpaceBaseCollectionModule.Api3DSpaceBaseCollection.extend({
            setup: function (models, options) {
                var _this = this;
                this._parent(models, options);
                this.fetchPromise = null;
                this.collectionCallUrlPromise = this.getCollectionCallUrl().then(function (collectionUrl) {
                    _this.url = collectionUrl;
                });
            },
            /**
             * Returns a promise of this fetched collection
             * If the collection has not been fetched yet, it is fetched
             * Else, the previously fetched models are returned
             */
            getFetchPromise: function () {
                var _this = this;
                return this.fetchPromise !== null
                    ? this.fetchPromise
                    : new Promise(function (resolve, reject) {
                        return _this
                            .collectionCallUrlPromise
                            .then(function () {
                            return _this.fetch({
                                onComplete: function () {
                                    resolve(this);
                                }.bind(_this),
                                onCancel: reject,
                                onFailure: reject
                            });
                        });
                    });
            },
            sync: function (method, model, options) {
                options = UWA.extend(options, {
                    method: 'GET',
                    type: 'json',
                    timeout: 0
                });
                options = Object.assign({
                    ajax: WAFData.authenticatedRequest
                }, options);
                this._parent.apply(this, [method, model, options]);
            },
            parse: function (data, options) {
                return data;
            },
            /** returns the URL to use to retrieve topologies */
            getCollectionCallUrl: function () {
                var _this = this;
                return this.get3DSpaceUrl().then(function (_3DSpaceURL) {
                    return _this.getTenant().then(function (tenant) {
                        var xrequestedwith = 'xmlhttprequest';
                        var pathname = _this.getCollectionPath();
                        var url = new URL(_3DSpaceURL);
                        url.searchParams.append('tenant', tenant);
                        _this.customizeCollectionCallUrl(url);
                        url.searchParams.append('xrequestedwith', xrequestedwith);
                        url.pathname += pathname;
                        return url.toString();
                    });
                });
            },
            /** returns the path to use to for collection call */
            getCollectionPath: function () {
                throw new Error('getCollectionPath should be overriden');
            },
            /** customize the url of the collection call */
            customizeCollectionCallUrl: function (url) {
            }
        });
    })(Api3DSpaceCollectionModule || (Api3DSpaceCollectionModule = {}));
    return Api3DSpaceCollectionModule;
});

define("DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/Types", ["require", "exports", "DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/Api3DSpaceCollection", "DS/ParameterizationSkeleton/Utils/ParameterizationPartSupply/Utils", "DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/Type"], function (require, exports, Api3DSpaceCollectionModule, Utils, TypeModule) {
    "use strict";
    var TypesModule;
    (function (TypesModule) {
        TypesModule.Types = Api3DSpaceCollectionModule.Api3DSpaceCollection.extend({
            model: TypeModule.Type,
            /** customize the url of the collection call */
            customizeCollectionCallUrl: function (url) {
                this._parent(url);
                url.searchParams.append('lang', Utils.Utils.getLang() + (Utils.Utils.getLang() === 'en' ? '' : ';en'));
            },
            parse: function (data, options) {
                var lang = Utils.Utils.getLang();
                return this._parent(Object.keys(data.Dictionary.Types).map(function (key) {
                    var type = data.Dictionary.Types[key];
                    // retrieve type labels in dictionaries
                    if (!type.NameNLS) {
                        var dico = {};
                        var typeKey = 'Type.' + type.Name;
                        if (lang === 'en') {
                            if (data.DictionaryNLS) {
                                dico.en = data.DictionaryNLS[typeKey];
                            }
                        }
                        else {
                            if (data.DictionaryNLS_en) {
                                dico.en = data.DictionaryNLS_en[typeKey];
                            }
                            if (data['DictionaryNLS_' + lang]) {
                                dico[lang] = data['DictionaryNLS_' + lang][typeKey];
                            }
                        }
                        type.NameNLS = dico;
                    }
                    // retrieve attributes labels in dictionaries
                    Object.keys(type.Attributes).map(function (key) {
                        var attribute = type.Attributes[key];
                        if (!attribute.NameNLS) {
                            var dico = {};
                            var attributeKey = 'Attribute.' + type.Name + '.' + attribute.Name;
                            if (lang === 'en') {
                                if (data.DictionaryNLS) {
                                    dico.en = data.DictionaryNLS[attributeKey];
                                }
                            }
                            else {
                                if (data.DictionaryNLS_en) {
                                    dico.en = data.DictionaryNLS_en[attributeKey];
                                }
                                if (data['DictionaryNLS_' + lang]) {
                                    dico[lang] = data['DictionaryNLS_' + lang][attributeKey];
                                }
                            }
                            attribute.NameNLS = dico;
                        }
                    });
                    return type;
                }), options);
            },
            isCustom: function () {
                throw new Error('isCustom must be overriden');
            }
        });
    })(TypesModule || (TypesModule = {}));
    return TypesModule;
});

define("DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/OOTBTypes", ["require", "exports", "DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/Types"], function (require, exports, TypesModule) {
    "use strict";
    var OOTBTypesModule;
    (function (OOTBTypesModule) {
        var KEYS = {
            DictionaryOOTB_PATH: '/resources/dictionary/DictionaryOOTB'
        };
        OOTBTypesModule.OOTBTypes = TypesModule.Types.extend({
            dictionaryNLS: null,
            isCustom: function () {
                return false;
            },
            parse: function (data, options) {
                // keep a pointer to NLS dictionary
                // not useful at the moment as we don't display OOTB types 
                // this.dictionaryNLS = data.DictionaryNLS;
                return this._parent(data, options);
            },
            /** returns the path to use to for collection call */
            getCollectionPath: function () {
                return KEYS.DictionaryOOTB_PATH;
            },
            // build the complete list of parents for each type
            computeAllParents: function () {
                this.forEach(function (type) {
                    var parents = [];
                    var parentId = type.getParentId();
                    while (parentId) {
                        var parent_1 = this.findWhere({ 'Name': parentId });
                        parents.push(parent_1);
                        parentId = parent_1.getParentId();
                    }
                    type.setParents(parents);
                }, this);
            },
        });
    })(OOTBTypesModule || (OOTBTypesModule = {}));
    return OOTBTypesModule;
});

define("DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/CustomTypes", ["require", "exports", "UWA/Class/Collection", "DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/Types"], function (require, exports, Collection, TypesModule) {
    "use strict";
    var CustomTypesModule;
    (function (CustomTypesModule) {
        var KEYS = {
            DictionaryCUSTO_PATH: '/resources/dictionary/DictionaryCUSTO'
        };
        CustomTypesModule.CustomTypes = TypesModule.Types.extend({
            isCustom: function () {
                return true;
            },
            /** returns the path to use to for collection call */
            getCollectionPath: function () {
                return KEYS.DictionaryCUSTO_PATH;
            },
            /** customize the url of the collection call */
            customizeCollectionCallUrl: function (url) {
                this._parent(url);
                url.searchParams.append('nlsResolution', 'false');
                url.searchParams.append('maxAge', '0');
            },
            // build the complete list of parents for each type
            computeAllParents: function (OOTBTypes) {
                this.forEach(function (type) {
                    var parents = [];
                    var parentId = type.getParentId();
                    while (parentId) {
                        var parent_1 = this.findWhere({ 'Name': parentId }) || OOTBTypes.findWhere({ 'Name': parentId });
                        parents.push(parent_1);
                        parentId = parent_1.getParentId();
                    }
                    type.setParents(parents);
                }, this);
            },
            getSubTypesOf: function (typeName) {
                var subtypes = [];
                this.forEach(function (type) {
                    if (type.findParentByType(typeName)) {
                        subtypes.push(type);
                    }
                });
                return new Collection(subtypes);
            }
        });
    })(CustomTypesModule || (CustomTypesModule = {}));
    return CustomTypesModule;
});

define(
    'DS/ParameterizationSkeleton/Utils/ParameterizationFSX/ParameterizationFSXWebServices',
    [
        'UWA/Promise',
        'DS/WAFData/WAFData',
        'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
        'DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices'
    ],
    function (Promise, WAFData, URLHandler, i3DXCompassPlatformServices) {

        'use strict';
        let searchPromise = undefined;
        let securityContextPromise = undefined;

        const getSecurityContext = function () {
            if (!securityContextPromise) {
                let deferred = Promise.deferred();
                const url = URLHandler.getURL() + "/resources/pno/person/getsecuritycontext?tenant=" + URLHandler.getTenant();
                WAFData.authenticatedRequest(url, {
                    timeout: 5000,
                    method: 'GET',
                    type: 'json',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },

                    onComplete: function (results) {
                        let response = results.SecurityContext;
                        if (!response) {
                            UWA.log("Error: Unable to get security context");
                        }
                        let securityContext = response;
                        deferred.resolve(securityContext);
                    },
                    onFailure: function (results) {
                        securityContextPromise = undefined;
                        deferred.reject('Failed to get security context');
                    }
                });
                securityContextPromise = deferred.promise;
            }
            return securityContextPromise;
        };

        const getFederatedSearchUrl = function () {
            if (!searchPromise) {
                let deferred = Promise.deferred();
                i3DXCompassPlatformServices.getServiceUrl({
                    serviceName: '3DSearch',
                    platformId: URLHandler.getTenant(),
                    onComplete: function (url) {
                        let parts = UWA.Utils.parseUrl(url);
                        let originalPort = parts.port;
                        parts.port = '0';
                        let platformUrl = UWA.Utils.composeUrl(parts).replace(':0', ':' + originalPort);
                        platformUrl += '/search?tenant=' + URLHandler.getTenant();
                        deferred.resolve(platformUrl);
                    },
                    onFailure: function () {
                        // sometimes it happens for whatever reasons that this call fails; make sure
                        // that this error is not 'cached' using the promises.
                        searchPromise = undefined;
                        deferred.reject('Failed to retrieve Search URI');
                    }
                });
                searchPromise = deferred.promise;
            }
            return searchPromise;
        };

        const ParameterizationFSXWebServices = {
            getAllProjAndOrg: function () {

                return new Promise(function (resolve, reject) {
                    const url = URLHandler.getURL() + "/resources/v1/fsxparam/getAllProjAndOrg?tenant=" + URLHandler.getTenant();

                    WAFData.authenticatedRequest(url, {
                        timeout: 10000,
                        method: 'GET',
                        type: 'json',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },

                        onFailure: reject,
                        onComplete: resolve
                    });
                });
            },

            setStandardFsxOwnership: function (jsonArr) {

                const url = URLHandler.getURL() + "/resources/v1/fsxparam/setStandardFsxOwnership?tenant=" + URLHandler.getTenant();
                const datatoSend = {
                    parameter: jsonArr
                };

                return new Promise(function (resolve, reject) {
                    WAFData.authenticatedRequest(url, {
                        timeout: 10000,
                        method: 'POST',
                        data: JSON.stringify(datatoSend),
                        type: 'json',
                        //proxy: 'passport',

                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },

                        onFailure: reject,
                        onComplete: resolve
                    });
                });
            },

            searchUser: function (input) {
                return getSecurityContext().then(securityContext => {
                    return getFederatedSearchUrl().then(url => {
                        let text = input.user;
                        let org = typeof input.organization === 'function' ? input.organization.call() : input.organization;
                        let queryOrg = typeof org === 'string' && org !== '' ? 'AND [ds6w:member]:(' + org.trim() + ')' : '';
                        let datatoSend = {
                            label: '3DSearch-FSXParam-' + (new Date()).getTime(), //identifier for tracking                 
                            query: '[ds6w:type]:Person AND ([ds6w:label]:"' + text.trim() + '" OR [ds6w:label]:(*' + text.trim() + '*) OR [name]:(' + text.trim() + '*)) AND ([current]:Active) ' + queryOrg,
                            order_by: 'desc',
                            order_field: 'relevance',
                            nresults: 10,
                            with_nls: false,
                            with_synthesis: false,
                            with_synthesis_attribute: false,
                            with_synthesis_hierarchical: false,
                            with_indexing_date: false,
                            select_file: [],
                            source: ['3dspace'],
                            select_predicate: [
                                'name',
                                'current',
                                'ds6w:type',
                                'ds6w:label',
                            ],
                            tenant: URLHandler.getTenant(),
                            refine: {},
                            specific_source_parameter: {},
                            login: {
                                '3dspace': {
                                    SecurityContext: securityContext
                                }
                            }
                        };
                        return new Promise(function (resolve, reject) {
                            if (text === '') {
                                resolve({ results: [] });
                            } else {
                                WAFData.authenticatedRequest(url, {
                                    timeout: 10000,
                                    method: 'POST',
                                    data: JSON.stringify(datatoSend),
                                    type: 'json',
                                    //proxy: 'passport',

                                    headers: {
                                        'Content-Type': 'application/json',
                                        'Accept': 'application/json'
                                    },

                                    onFailure: reject,
                                    onComplete: resolve
                                });
                            }
                        });
                    })
                })
            }
        };

        return ParameterizationFSXWebServices;
    }
);

define('DS/ParameterizationSkeleton/Views/ParameterizationFSX/FasteningLayoutView', [
	'UWA/Core',
	'UWA/Class/View',
	'DS/UIKIT/Mask',
	'DS/UIKIT/Scroller',
	'DS/UIKIT/Alert',
	'DS/UIKIT/Popover',
	'DS/UIKIT/Input/Select',
	'DS/WAFData/WAFData',
	'DS/UIKIT/Input/Toggle',
	'DS/UIKIT/Autocomplete',
	'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler',
	'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
	'DS/ParameterizationSkeleton/Views/ParametersLayoutView',
	'DS/ParameterizationSkeleton/Utils/ParameterizationFSX/ParameterizationFSXWebServices',
	'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS',
	'i18n!DS/ParameterizationSkeleton/assets/nls/FasteningNLS'
],
	function (UWA,
		View,
		Mask,
		Scroller,
		Alert,
		Popover,
		Select,
		WAFData,
		Toggle,
		Autocomplete,
		URLHandler,
		ParametersLayoutViewUtilities,
		ParametersLayoutView,
		ParameterizationFSXWebServices,
		ParamSkeletonNLS,
		FasteningNLS) {

		'use strict';

		const extendedView = View.extend({
			tagName: 'div',
			className: 'generic-detail',

			init: function (options) {
				options = UWA.clone(options || {}, false);
				this._parent(options);
				this.columnWidthArray = [60, 5, 25, 10];//[65, 20, 5, 10];
				this.options = options;
				this.contentDiv = null;
				this.paramScroller = null;
				this.controlDiv = null;
				this.inputControls = [];
				this.imgCells = [];
				this.userMessaging = ParametersLayoutViewUtilities.createWdgAlert();;
				this.lastAlertDate = new Date().getTime();
			},


			setup: function (options) {
				UWA.log('FasteningLayoutView ::setup!');
				UWA.log(options);
				this.initAutoComplete();
			},
						
			getOrganizationTitle: function(orgName) {
				let orgObject = {title: orgName}; //default value for compatibility in case the webservice has not been updated on the server
				if (this.projAndOrg["organization"] && this.projAndOrg["organization"].length > 0) {						 
					if (this.projAndOrg["organization"][0].hasOwnProperty('name')) {
						orgObject = this.projAndOrg["organization"].find(item => item.name == orgName);
					}
				}
			
				return orgObject.title;
			},

			initAutoComplete: function () {
				var that = this;
				this.dataSetConfig = {
					//onError: function (data) 					
					dataParser: function (dataset, resultFromFedSearch) {
						//Format auto-complete items from fedsearch users
						let autoCompleteItems = resultFromFedSearch.results.map(res => {
							let itemLabel = res.attributes.find(item => item.name === 'ds6w:label');
							let itemName = res.attributes.find(item => item.name === 'name');
							return (itemLabel && itemName) ? { label: itemLabel.value, value: itemName.value } : { label: 'not found', value: 'not found' };
						})
						return autoCompleteItems;
					},
					remoteSearchEngine: function (dataset, text) {
						//call fedsearch to retrieve users corresponding to typed text
						//then format for auto-complete						
						return new Promise(function (resolve, reject) {
							return ParameterizationFSXWebServices.searchUser({user: text, organization:() => that.getOrganizationTitle(that.fsxOrganization)})
								.then(function (resultFromFedSearch) {
									let results = {
										matchingItems: [],
										dataset: dataset
									};
									results.matchingItems = dataset.dataParser(dataset, resultFromFedSearch);
									resolve(results);
								}).catch(function (err) {
									let results = {
										type: 'error',
										dataset: dataset,
										error: err
									};
									reject(results);
								});
						});
					}.bind(this)
				};
			},

			render: function () {
				UWA.log("FasteningLayoutView::render");

				this.contentDiv = UWA.createElement('div', {
					'id': 'mainParamDiv'
				});
				Mask.mask(this.contentDiv);

				let introDiv = ParametersLayoutViewUtilities.createInfoDiv(this.model.get("introduction"));
				introDiv.inject(this.contentDiv);

				this.parentView = new ParametersLayoutView(this.options);

				var activateApply = true;
				this.controlDiv = ParametersLayoutViewUtilities.createApplyResetToolbar.call(this, this.contentDiv, activateApply,
					this.applyParams.bind(this), this.resetParams.bind(this));

				this.container.setContent(this.contentDiv);

				this.listenTo(this.collection, {
					onSync: this.onCompleteRequestMapping
				});

				return this;
			},

			onCompleteRequestMapping: function () {
				UWA.log('FasteningLayoutView :: onCompleteRequestMapping!');

				let ownership = this.collection._models[0]._attributes;
				this.fsxProject = ownership.fsxProject;
				this.fsxOrganization = ownership.fsxOrganization;
				this.fsxPerson = ownership.fsxPerson;
				let family = {
					id: "fastenerparam",
					parameter: [
						{
							isDeployed: false,
							argument: [
								{
									id: "Argument",
									defaultValue: "",
									type: "string",
									input: "combobox",
									value: ownership.fsxProject //fsxProject, fsxOrganization, fsxPerson
								}
							],
							nlsKey: FasteningNLS.FasteningProjTitle,
							tooltipNlsKey: FasteningNLS.FasteningProjTooltip,
							id: "projects"
						},
						{
							isDeployed: false,
							argument: [
								{
									id: "Argument",
									defaultValue: "",
									type: "string",
									input: "combobox",
									value: ownership.fsxOrganization //fsxProject, fsxOrganization, fsxPerson
								}
							],
							nlsKey: FasteningNLS.FasteningOrgTitle,
							tooltipNlsKey: FasteningNLS.FasteningOrgTooltip,
							id: "organization"
						},
						{
							isDeployed: false,
							argument: [
								{
									id: "Argument",
									defaultValue: "",
									type: "string",
									input: "combobox",
									value: ownership.fsxPerson //fsxProject, fsxOrganization, fsxPerson
								}
							],
							nlsKey: FasteningNLS.FasteningPersonTitle,
							tooltipNlsKey: FasteningNLS.FasteningPersonTooltip,
							id: "person"
						}
					]
				};

				this.paramsDIV = ParametersLayoutViewUtilities.createParamsContainerDiv();
				this.paramsDIV.inject(this.contentDiv);

				var gcoParentDiv = UWA.createElement('div', {	
					'class': 'customTypeParentDivFSX'
				});


				var gcoContentDiv = UWA.createElement('div', {
					'class': 'customTypeContentDiv'
				});

			
				this.baseAccordion = ParametersLayoutViewUtilities.createFamilyUIKITAccordion(this.paramsDIV);

				let tableContent = this.buildTableContent(family);
				tableContent.inject(gcoContentDiv);

				gcoParentDiv.appendChild(gcoContentDiv);

				this.baseAccordion.addItem({
					title: FasteningNLS.FasteningCollabSpaceAccordion,
					content: gcoParentDiv,
					selected: true,
					name: "fstownership",
				});

				gcoContentDiv.appendChild(this.controlDiv);

				this.getOtherDomainDetails();

				UWA.log('unmask');
				Mask.unmask(this.contentDiv);
			},

			buildTableContent: function (iFamily) {

				let familyTable = UWA.createElement('table', {
					'class': 'table table-hover',
					'table-layout': 'fixed',
					'id': iFamily.id + 'familytable'
				});

				let ftbody = UWA.createElement('tbody', {
					'class': 'fparamtbody',
					'id': iFamily.id + 'familytbody'
				}).inject(familyTable);

				this.buildParametersLayout(iFamily, ftbody);

				return familyTable;
			},

			getOtherDomainDetails: function () {
				var that = this;
				var url = URLHandler.getURL() + "/resources/ParamWS/access/DomainElements?tenant=" + URLHandler.getTenant() + "&domainid=FasteningRivetParameterization";
				WAFData.authenticatedRequest(url, {
					timeout: 250000,
					method: 'GET',
					type: 'json',

					headers: {
						'Content-Type': 'application/json',
						'Accept': 'application/json',
						'Accept-Language': widget.lang
					},

					onFailure: function (result) {
						Mask.unmask(that.contentDiv);
						getAlertMessage(ParamSkeletonNLS_en.deployFailureMsg, 'error', this.contentDiv);
					},

					onComplete: function (result) {
						var familyArray = [];

						result.family.forEach(function (family) {
							familyArray.push(family);
						});

						that.loadOtherDomainDetails(familyArray);
					}
				});
			},

			getAlertMessage: function (message, className, toDisplayOn) {

				this.alertOptions = {
					visible: true,
					className: 'param-alert',
					messageClassName: className,
					closable: true,
					renderTo: toDisplayOn,
					autoHide: true,
					hideDelay: 2000
				};

				var alert = new Alert(this.alertOptions);
				alert.add({
					message: message,
				});
			},

			loadOtherDomainDetails: function (result) {
				var that = this;
				try {
					that.divBasicConfig = UWA.createElement('div', {
						'class': 'basicDivScroll',
						'id' : 'divBasicConfig'
					}).inject(that.contentDiv);
					that.altSubAccordean = ParametersLayoutViewUtilities.createFamilyUIKITAccordion(that.paramsDIV);

					var basicConfigParentDiv = UWA.createElement('div', {
						'id': 'basicConfigParentDiv'
					});

					var basicConfigDiv = UWA.createElement('div', {
						'id': 'basicConfigDiv'
					});

					basicConfigParentDiv.appendChild(basicConfigDiv);
					that.model.set("introduction", "");

					that.parentView = that._updateParentViewWithNewDomain(that.parentView, "FasteningRivetParameterization");


					//that.parentView.render();
					that.collection._models[0]._attributes.family = result;
					//that.parentView.onCompleteRequestParameters();

					let familyposition = "mid";
					let iFamilies = this.collection._models[0]._attributes.family;
					let iContent = that.parentView.buildFamilyItemContent(iFamilies[0], familyposition);

					that.altSubAccordean.addItem({
						title: FasteningNLS.FasteningRivetAccordion,
						content: basicConfigParentDiv,
						selected: true,
						name: result.nlsKey
					});

					//that.parentView.contentDiv.appendChild(basicConfigParentDiv);
					basicConfigDiv.appendChild(iContent);

					//paramBasicScroller = new Scroller({
					//	element: basicConfigDiv
					//}).inject(basicConfigParentDiv);
				} catch (error) {
				}
			},

			_updateParentViewWithNewDomain: function (view, domainId) {
				view.options.domainid = domainId;
				view.model.id = domainId;
				view.model._attributes.domainid = domainId;
				view.model._attributes.id = domainId;
				view.connectProps.domainName = domainId;
				view.userMessaging = this.userMessaging;
				view.contentDiv = this.contentDiv;
				//view.userMessaging.renderTo = this.contentDiv;
				view.userMessaging = new Alert({
					className: 'param-alert',
					closable: true,
					visible: true,
					renderTo: document.body,
					autoHide: true,
					hideDelay: 2500,
					messageClassName: 'warning'
				});
				return view;
			},
		
			buildParametersLayout: function (iElements, familytbody) {
				this.buildComboParam(iElements.parameter[0], familytbody);
				this.buildComboParam(iElements.parameter[1], familytbody);
				this.buildAutoComboParam(iElements.parameter[2], familytbody);
			},

			buildComboParam: function (param, familytbody) {
				var that = this;
				let popoverPosition = ParametersLayoutViewUtilities.computePopoverPos(0, "mid", 1);

				let newParamline = UWA.createElement('tr', { title: '' });
				let iArgument = param.argument[0];
				let imgCell = ParametersLayoutViewUtilities.buildDeployStsCell(param.isDeployed, this.columnWidthArray[3].toString() + '%', '2', 'right');//5%
				let paramTextCell = UWA.createElement('td', {
					'width': this.columnWidthArray[0].toString() + '%',
					'title': ''
				});
				paramTextCell.setStyle("vertical-align", "text-bottom");
				UWA.createElement('p', { text: param.nlsKey, 'class': '' }).inject(paramTextCell);
				let paramInfoCell = UWA.createElement('td', {
					'width': this.columnWidthArray[1].toString() + '%',
					'align': 'left'
				});
				paramInfoCell.setStyle("vertical-align", "text-bottom");
				let imgInfoSpan = UWA.createElement('span', {
					'class': 'fonticon fonticon-info'
				}).inject(paramInfoCell);
				imgInfoSpan.setStyle("color", "black");

				let popoverTooltip = new Popover({
					target: imgInfoSpan,
					trigger: "hover",
					animate: "true",
					position: popoverPosition,
					body: param.tooltipNlsKey,
					title: ''
				});

				popoverTooltip.elements.container.setStyle("max-width", "400px");
				let controlObjectCell = ParametersLayoutViewUtilities.buildControlCell(param.id, iArgument, this.columnWidthArray[2].toString() + '%');
				let iController = new Select({
					placeholder: false,
					multiple: false,
					attributes: {
						id: param.id,
						name: param.id,
						disabled: false
					}
				});
				iController.getContent().setStyle("width", "100%");
				iController.getContent().setStyle("text-align", "left");
				this.fillComboBox(iController, param.id, iArgument.value).then(function () {
					iController.addEvent("onChange", function () {
						ParametersLayoutViewUtilities.beingModified(imgCell, ParamSkeletonNLS.ParamBeingModified, '2');
						let valueArray = this.getValue();	
						let value = valueArray === undefined || !Array.isArray(valueArray)	? '' : valueArray[0];
						if (param.id === 'projects') {
							that.fsxProject = value;
						} else if (param.id === 'organization') {
							that.fsxOrganization = value;
						}
						//unselect and clean the cache
						that.inputControls[2].cleanDataset(that.inputControls[2].datasets[0].id);
						//that.updateParameterOnChange(currentValue, controlObjectCell, imgCell);
					});
				});

				iController.inject(controlObjectCell);
				this.inputControls.push(iController);
				this.imgCells.push(imgCell)
				paramTextCell.inject(newParamline);
				paramInfoCell.inject(newParamline);
				controlObjectCell.inject(newParamline);

				imgCell.inject(newParamline);
				newParamline.inject(familytbody);//familyparamtable
			},

			buildAutoComboParam: function (param, familytbody) {
				var that = this;
				let iArgument = param.argument[0];
				let popoverPosition = ParametersLayoutViewUtilities.computePopoverPos(0, "mid", 1);

				let newParamline = UWA.createElement('tr', { title: '' });
				let imgCell = ParametersLayoutViewUtilities.buildDeployStsCell(param.isDeployed, this.columnWidthArray[3].toString() + '%', '2', 'right');//5%
				let paramTextCell = UWA.createElement('td', {
					'width': this.columnWidthArray[0].toString() + '%',
					'title': ''
				});
				paramTextCell.setStyle("vertical-align", "text-bottom");
				UWA.createElement('p', { text: param.nlsKey, 'class': '' }).inject(paramTextCell);
				let paramInfoCell = UWA.createElement('td', {
					'width': this.columnWidthArray[1].toString() + '%',
					'align': 'left'
				});
				paramInfoCell.setStyle("vertical-align", "text-bottom");
				let imgInfoSpan = UWA.createElement('span', {
					'class': 'fonticon fonticon-info'
				}).inject(paramInfoCell);
				imgInfoSpan.setStyle("color", "black");

				let popoverTooltip = new Popover({
					target: imgInfoSpan,
					trigger: "hover",
					animate: "true",
					position: popoverPosition,
					body: param.tooltipNlsKey,
					title: ''
				});

				popoverTooltip.elements.container.setStyle("max-width", "400px");
				let controlObjectCell = ParametersLayoutViewUtilities.buildControlCell(param.id, iArgument, this.columnWidthArray[2].toString() + '%');
				let dynamicController = new Autocomplete({
					placeholder: FasteningNLS.FasteningPersonPlaceholder,
					showSuggestsOnFocus: false,
					minLengthBeforeSearch: 2,
					allowFreeInput: false,
					events: {
						onSelect: function (item) {
							if (that.fsxPerson !== item.value) {
								ParametersLayoutViewUtilities.beingModified(imgCell, ParamSkeletonNLS.ParamBeingModified, '2');								
								that.fsxPerson = item.value;
							}
						},
						onUnselect: function (item) {							
							ParametersLayoutViewUtilities.beingModified(imgCell, ParamSkeletonNLS.ParamBeingModified, '2');
							that.fsxPerson = item.value;
						}
					}
				});

				dynamicController.disable();
				ParameterizationFSXWebServices.searchUser({user: iArgument.value, organization: null})
					.then(function (resultFromFedSearch) {
						let userItem = resultFromFedSearch.results.map(res => {
							let itemLabel = res.attributes.find(item => item.name === 'ds6w:label');
							let itemName = res.attributes.find(item => item.name === 'name');
							return (itemLabel && itemName) ? { label: itemLabel.value, value: itemName.value, selected: true } : {};
						})
						dynamicController.addDataset({ items: userItem }, that.dataSetConfig);
						dynamicController.enable();
					}).catch(function (err) {
						console.log("user not found !");
						dynamicController.addDataset([], that.dataSetConfig);
						dynamicController.enable();
					});


				dynamicController.getContent().setStyle("width", "100%");
				dynamicController.getContent().setStyle("text-align", "left");

				dynamicController.inject(controlObjectCell);
				this.inputControls.push(dynamicController);
				this.imgCells.push(imgCell)
				paramTextCell.inject(newParamline);
				paramInfoCell.inject(newParamline);
				controlObjectCell.inject(newParamline);

				imgCell.inject(newParamline);
				newParamline.inject(familytbody);//familyparamtable
			},

			updateParameterOnChange: function (iValue, ctrlObjectCell, imageCell) {
				let imageTXT = ParamSkeletonNLS.Under_Deploy;
				let ParamID = ctrlObjectCell.getData('argumentNode').paramid;
				let argID = ctrlObjectCell.getData('argumentNode').argumentid;
				let jsonArr = [];
				let ArgArr = [];
				this.resetIsCalled = false;
				ParametersLayoutViewUtilities.beingDeployed(imageCell, imageTXT);

				ArgArr.push({ id: argID, value: iValue });
				let iParam = {
					domain: this.model.get("domainid"),
					id: ParamID,
					argument: ArgArr
				};
				jsonArr.push(iParam);
				return ParameterizationFSXWebServices.setStandardFsxOwnership(jsonArr).then(function (result) {
					return this.onApplySuccess(result, imageCell);
				}.bind(this))
					.catch(function (err) {
						return this.onApplyFailure(err, imageCell);
					}.bind(this));

			},

			onApplyFailure: function (json) {
				UWA.log(json);
				Mask.unmask(this.contentDiv);
				this.userMessaging.add({ className: "error", message: ParamSkeletonNLS.deployFailureMsg });
				this.userMessaging.inject(this.paramsDIV);
				ParametersLayoutViewUtilities.updateIcon(false, this.imgCells[0]);
				ParametersLayoutViewUtilities.updateIcon(false, this.imgCells[1]);
				ParametersLayoutViewUtilities.updateIcon(false, this.imgCells[2]);
			},

			onApplySuccess: function (json) {
				const successmsg = ParamSkeletonNLS.deploySuccessMsg;
				Mask.unmask(this.contentDiv);
				UWA.log(json);

				let currDate = new Date();
				let currTime = currDate.getTime();
				let diffDate = currTime - this.lastAlertDate;
				this.lastAlertDate = currTime;

				if (json.status === "success") {
					if (diffDate >= 2000) {
						this.userMessaging.add({ className: "success", message: successmsg });
						this.userMessaging.inject(this.paramsDIV);
					}
					ParametersLayoutViewUtilities.updateIcon(true, this.imgCells[0]);
					ParametersLayoutViewUtilities.updateIcon(true, this.imgCells[1]);
					ParametersLayoutViewUtilities.updateIcon(true, this.imgCells[2]);
				} else {
					this.onApplyFailure(json);
				}

			},

			fillComboBox: function (controller, key, selectedValue) {
				const getAllProjAndOrg = new Promise(function (resolve, reject) {
					if (this.projAndOrg == null || this.projAndOrg == undefined) {
						return ParameterizationFSXWebServices.getAllProjAndOrg().then(function (result) {
							this.projAndOrg = result;
							resolve(this.projAndOrg);
						}.bind(this));
					} else {
						resolve(this.projAndOrg);
					}
				}.bind(this));

				return getAllProjAndOrg.then(function (projAndOrg) {
					if (projAndOrg) {
						let optionsList = projAndOrg[key].map(function (item) {
							let label = typeof item === 'string' ? item : item.title;
							let value = typeof item === 'string' ? item : item.name;
							//some org object do not have title
							label = label === '' ? value : label;
							return {
								label: label,
								value: value,
								selected: (selectedValue === value)
							};
						});
						optionsList.unshift({
							label: "",
							value: "",
							selected: false
						})
						controller.add(optionsList);
						return controller;
					}
				}).catch(function (err) {
					console.warn(err.message);
				});

			},

			applyParams: function () {
				let inputProject = this.inputControls[0];
				let inputOrg = this.inputControls[1];
				let inputPerson = this.inputControls[2];
				let valueProject = inputProject.getValue();
				let valueOrg = inputOrg.getValue();
				let valuePerson = inputPerson.getValue();
				let ctrlObjectCell = inputProject.getContent().getParent();
				let ParamID = ctrlObjectCell.getData('argumentNode').paramid;
				let argID = ctrlObjectCell.getData('argumentNode').argumentid;
				let jsonArr = [];
				let ArgArr = [];
				this.resetIsCalled = false;
				ParametersLayoutViewUtilities.beingDeployed(this.imgCells[0], ParamSkeletonNLS.Under_Deploy);
				ParametersLayoutViewUtilities.beingDeployed(this.imgCells[1], ParamSkeletonNLS.Under_Deploy);
				ParametersLayoutViewUtilities.beingDeployed(this.imgCells[2], ParamSkeletonNLS.Under_Deploy);
				let strValue = valueProject + ',' + valueOrg + ',' + valuePerson;
				ArgArr.push({ id: argID, value: strValue });
				let iParam = {
					domain: this.model.get("domainid"),
					id: ParamID,
					argument: ArgArr
				};
				jsonArr.push(iParam);
				return ParameterizationFSXWebServices.setStandardFsxOwnership(jsonArr).then(function (result) {
					return this.onApplySuccess(result);
				}.bind(this))
					.catch(function (err) {
						return this.onApplyFailure(err);
					}.bind(this));

			},

			resetParams: function () {
				this.onResetSuccess();
				Mask.unmask(this.contentDiv);
			},

			onResetSuccess: function (json) {
			},

			destroy: function () {
				this.stopListening();
				this._parent.apply(this, arguments);
			}
		});

		return extendedView;
	});

define("DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/MaturityStates", ["require", "exports", "DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/Api3DSpaceCollection"], function (require, exports, Api3DSpaceCollectionModule) {
    "use strict";
    var MaturityStatesModule;
    (function (MaturityStatesModule) {
        var KEYS = {
            TOPOLOGY_POLICY: 'VPLM_SMB_Definition',
            TOPOLOGY_PATH: '/resources/ParamWS/lifecycle/topology'
        };
        MaturityStatesModule.MaturityStates = Api3DSpaceCollectionModule.Api3DSpaceCollection.extend({
            parse: function (_a) {
                var state = _a.state;
                // filter doubles
                state = state.reduce(function (maturityStates, currentState) {
                    if (!maturityStates.some(function (state) { return state.id === currentState.id; })) {
                        maturityStates.push(currentState);
                    }
                    return maturityStates;
                }, []);
                return state;
            },
            /** returns the path to use to for collection call */
            getCollectionPath: function () {
                return KEYS.TOPOLOGY_PATH;
            },
            /** customize the url of the collection call */
            customizeCollectionCallUrl: function (url) {
                var policy = KEYS.TOPOLOGY_POLICY;
                url.searchParams.append('policy', policy);
            }
        });
    })(MaturityStatesModule || (MaturityStatesModule = {}));
    return MaturityStatesModule;
});

define("DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/CollabSpaces", ["require", "exports", "DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/Api3DSpaceCollection", "DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/CollabSpace"], function (require, exports, Api3DSpaceCollectionModule, CollabSpaceModule) {
    "use strict";
    var CollabSpacesModule;
    (function (CollabSpacesModule) {
        var KEYS = {
            CollabSpaces_PATH: '/resources/enocsmrest/admin/collabspaces'
        };
        CollabSpacesModule.CollabSpaces = Api3DSpaceCollectionModule.Api3DSpaceCollection.extend({
            model: CollabSpaceModule.CollabSpace,
            parse: function (data, options) {
                data = data.items;
                return this._parent(data, options);
            },
            /** returns the path to use to for collection call */
            getCollectionPath: function () {
                return KEYS.CollabSpaces_PATH;
            },
        });
    })(CollabSpacesModule || (CollabSpacesModule = {}));
    return CollabSpacesModule;
});

define("DS/ParameterizationSkeleton/Views/ParameterizationPartSupply/ParameterizationPartSupplyView", ["require", "exports", "UWA/Core", "UWA/Class/View", "DS/UIKIT/Mask", "DS/UIKIT/Alert", "DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/MaturityStates", "DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/dictionary/DictionaryCUSTO", "DS/ParameterizationSkeleton/Model/ParameterizationPartSupply/dictionary/DictionaryOOTB", "DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/CollabSpaces", "DS/UIKIT/Modal", "DS/UIKIT/Input/Button", "DS/ParameterizationSkeleton/Utils/ParameterizationPartSupply/Utils", "DS/ParameterizationSkeleton/Views/ParameterizationPartSupply/PartSupplyIndexingManagementDomainView", "i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS"], function (require, exports, UWA, View, Mask, Alert, MaturityStatesModule, DictionaryCUSTOModule, DictionaryOOTBModule, CollabSpacesModule, Modal, Button, Utils, PartSupplyIndexingManagementDomainModule, ParamSkeletonNLS) {
    "use strict";
    return View.extend({
        className: function () {
            return 'partsupply-parameterization-view';
        },
        tagName: 'div',
        init: function (options) {
            options = UWA.clone(options || {}, false);
            this.options = options;
            return this._parent(options);
        },
        setup: function (options) {
            this.configHelper = options.configHelper;
            this.resetModal = null;
            this.domainView = new PartSupplyIndexingManagementDomainModule.PartSupplyIndexingManagementDomainView({});
            this.userMessaging = new Alert({
                closable: true,
                visible: true,
                autoHide: true,
                hideDelay: 2500,
                attributes: {
                    style: 'position: absolute;top: 0;left: 50%;z-index: 2100;visibility: visible;transform: translateX(-50%);'
                    /** @UWA-version */
                }
                /** @UWA-version */
            });
            /** Collection of maturity states retrieved from space service */
            this.maturityStates = new MaturityStatesModule.MaturityStates([], { configHelper: this.configHelper });
            this.maturityStatesPromise = this.maturityStates.getFetchPromise();
            /** Collection of OOTB types retrieved from space service */
            this.DictionaryOOTB = new DictionaryOOTBModule.DictionaryOOTB({}, { configHelper: this.configHelper });
            this.DictionaryOOTBPromise = this.DictionaryOOTB.getFetchPromise();
            /** Collection of custom types retrieved from space service */
            this.DictionaryCUSTO = new DictionaryCUSTOModule.DictionaryCUSTO({}, { configHelper: this.configHelper });
            this.DictionaryCUSTOPromise = this.DictionaryCUSTO.getFetchPromise();
            /** Collection of collaborative spaces retrieved from space service */
            this.CollabSpaces = new CollabSpacesModule.CollabSpaces([], { configHelper: this.configHelper });
            this.CollabSpacesPromise = this.CollabSpaces.getFetchPromise();
            this.listenTo(this.collection, {
                onSync: this._onParametersSync.bind(this)
            });
            this._parent(options);
        },
        render: function () {
            this.userMessaging.inject(this.container);
            this._mask();
            return this;
        },
        _onParametersSync: function () {
            return this.maturityStatesPromise.then(function (maturityStates) {
                // Fixes possible choices for maturity states selectbox since they might have changed
                this.collection.applyPossibleMaturityStates(maturityStates);
                return this.DictionaryOOTBPromise.then(function (DictionaryOOTB) {
                    return this.DictionaryCUSTOPromise.then(function (DictionaryCUSTO) {
                        DictionaryCUSTO.get('Interfaces').computeAllParents(DictionaryOOTB.get('Interfaces'));
                        DictionaryCUSTO.get('Types').computeAllParents(DictionaryOOTB.get('Types'));
                        var subtypesOf3DShape = DictionaryCUSTO.get('Types').getSubTypesOf('3DShape');
                        subtypesOf3DShape.forEach(function (type) {
                            type.computeAllAttributes();
                        });
                        this._createFamilyOfParams();
                        this._unmask();
                    }.bind(this));
                }.bind(this));
            }.bind(this));
        },
        _createFamilyOfParams: function () {
            this._renderReactParameters();
        },
        _mask: function () {
            Mask.mask(this.container);
        },
        _unmask: function () {
            Mask.unmask(this.container);
        },
        _renderReactParameters: function () {
            var _this = this;
            var domain = this.collection.getDomainJSONObject();
            /** uncomment to activate FD01 feature **/
            // domain.family.push({
            //   "family": [],
            //   "parameter": [
            //     {
            //       "argument": [
            //         {
            //           "value": [],
            //           "id": "Argument",
            //           "nlsKey": "Concatenated exclusion rules",
            //           "tooltipNlsKey": "Blabla",
            //           "argValue": '[{"ruleName":"Rule Number One","isOOTB":true,"interfaceType":"Type","interfaceName":"VPMReference","interfaceAttributeName":"PLMEntity.V_nature","interfaceAttributeOperator":"≠","interfaceAttributeValue":"2"},{"ruleName":"Rule Number Two","isOOTB":true,"interfaceType":"Type","interfaceName":"3DShape"}]',
            //           //           "type": "string",
            //           //           "input": "textfield",
            //           "defaultValue": "",
            //           "maxLength": "0"
            //         }
            //       ],
            //       "constant": [],
            //       "id": "ConcatenatedExclusionRules",
            //       "isDeployed": "true",
            //       "nlsKey": "Concatenated exclusion rules",
            //       "tooltipNlsKey": "Concatenated exclusion rules"
            //     }
            //   ],
            //   "column": [],
            //   "id": "PartSupply3DSpaceIndexingManagementExclusionRules",
            //   "nlsKey": "Exclusion Rules",
            //   "tooltipNlsKey": "Rules of exclusion",
            //   "startCollapsed": "false",
            //   "icon": "iconParameterizationDefault.gif"
            // });
            var props = {
                domain: Utils.Utils.clone(domain),
                DictionaryCUSTO: this.DictionaryCUSTO,
                DictionaryOOTB: this.DictionaryOOTB,
                CollabSpaces: this.CollabSpaces,
                postOnServerFunc: function () {
                    var args = [];
                    for (var _i = 0; _i < arguments.length; _i++) {
                        args[_i] = arguments[_i];
                    }
                    _this._mask();
                    _this.collection.postParamsArrOnServer.apply(_this.collection, args);
                },
                onPostSuccess: function () {
                    var args = [];
                    for (var _i = 0; _i < arguments.length; _i++) {
                        args[_i] = arguments[_i];
                    }
                    _this._unmask();
                    _this._renderReactParameters();
                    try {
                        _this.onApplySuccess();
                    }
                    catch (error) {
                    }
                },
                onPostFailure: function () {
                    var args = [];
                    for (var _i = 0; _i < arguments.length; _i++) {
                        args[_i] = arguments[_i];
                    }
                    _this._unmask();
                    _this.onApplyFailure();
                },
                applyDomainStateToBaseCollection: function (domainState) {
                    var domain = _this.collection.find(function (d) { return d.get('id') === domainState.id; });
                    Object.keys(domainState).forEach(function (key) {
                        domain.set(key, domainState[key]);
                    });
                },
                onResetClick: function () {
                    _this._confirmationModalShow();
                }
            };
            this.domainView.inject(this.container, 'top', props);
        },
        /** Overriden from DS/ParameterizationSkeleton/Views/ParametersLayoutView */
        _confirmationModalShow: function () {
            var _this = this;
            var headertitle, OKBtn, CancelBtn, bodyDiv;
            if (this.resetModal !== null) {
                this.resetModal.inject(this.container);
                this.resetModal.show(); //Modal already exists
            }
            else {
                headertitle = UWA.createElement('h4', {
                    text: ParamSkeletonNLS.confirmResetTitle,
                    'class': 'font-3dslight' // font-3dsbold
                });
                OKBtn = new Button({
                    value: ParamSkeletonNLS.OKButton,
                    className: 'btn primary',
                    events: {
                        onClick: function () {
                            _this.resetAndDeloyParams();
                        }
                    }
                });
                CancelBtn = new Button({
                    value: ParamSkeletonNLS.CancelButton,
                    className: 'btn default',
                    events: {
                        onClick: function (e) {
                        }
                    }
                });
                bodyDiv = UWA.createElement('div', {
                    'id': 'resetContentDiv',
                    'width': '100%',
                    'height': '100%'
                });
                UWA.createElement('p', {
                    text: ParamSkeletonNLS.confirmResetMsg,
                    'class': 'font-3dslight' // font-3dsbold
                }).inject(bodyDiv);
                this.resetModal = new Modal({
                    className: "reset-confirm-modal",
                    closable: true,
                    header: headertitle,
                    body: bodyDiv,
                    footer: [OKBtn, CancelBtn]
                }).inject(this.container);
                this.resetModal.getContent().setStyle("padding-top", 1);
                this.resetModal.show();
                this.resetModal.getContent().getElements(".btn").forEach(function (element) {
                    element.addEvent("click", function () {
                        _this.resetModal.hide();
                        _this.resetModal.remove();
                    });
                });
            }
        },
        onApplySuccess: function () {
            this.userMessaging.add({ message: ParamSkeletonNLS.deploySuccessMsg, className: 'success' });
        },
        onApplyFailure: function () {
            this.userMessaging.add({ className: "error", message: ParamSkeletonNLS.deployFailureMsg });
        },
        resetAndDeloyParams: function () {
            var _this = this;
            this._mask();
            var domain = this.collection.at(0)._attributes;
            var jsonArray = domain.family.reduce(function (familyArraySoFar, family) {
                return familyArraySoFar.concat(family.parameter.map(function (parameter) {
                    var param = {
                        id: parameter.id,
                        argument: [{ id: 'Argument', value: parameter.argument[0].defaultValue }],
                        domain: domain.id
                    };
                    return param;
                }));
            }, []);
            var applyDefaultValues = function () {
                var domain = _this.collection.at(0)._attributes;
                var family = domain.family.map(function (_family) {
                    var __family = Utils.Utils.clone(_family);
                    __family.parameter = _family.parameter.map(function (parameter) {
                        var _parameter = Utils.Utils.clone(parameter);
                        var firstArg = Utils.Utils.clone(parameter.argument[0]);
                        firstArg.argValue = parameter.argument[0].defaultValue;
                        _parameter.argument = [firstArg];
                        return _parameter;
                    });
                    return __family;
                });
                _this.collection.at(0).set('family', family);
            };
            this.collection.postParamsArrOnServer(null, jsonArray, null, function () {
                _this._unmask();
            }, function () {
                applyDefaultValues();
                _this._renderReactParameters();
                _this._unmask();
                try {
                    _this.onApplySuccess();
                }
                catch (error) {
                }
            });
        },
        destroy: function () {
            this.domainView.destroy();
        }
    });
});

/**
* @quickreview  KB9 21:10:25 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDisplayProperties/DPConfigurationToastMessage',
[
  'UWA/Class',
  'DS/Controls/Button',
  'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
],
function (
  Class,
  WUXButton,
  URLHandler
)
{
    'use strict';


var DPConfigurationToastMessage = Class.extend({
        contentToastView : null,
        contentView : null,

        /*
        * init
        */
        init : function init(div)
        {
          var that = this;
          that.contentToastView = UWA.createElement('div',
          {
            'id': 'toastMessage'
          }).inject(div);

        },

        /*
        * onClose
        */
        onClose : function onClose()
        {
          var that = this;
          if (that.contentToastView)
            that.contentToastView.className = that.contentToastView.className.replace("show", "");
        },

        /*
        * buildToastMessage
        */
        buildToastMessage : function buildToastMessage(messageType, message)
        {
          var that = this;
          if (that.contentToastView.getChildren().length)
            that.contentToastView.removeChild(that.contentToastView.getChildren()[0]);

          that.contentView = UWA.createElement('div');

          var imgelem = document.createElement("img");
          var iconName = '';
          var backgroundcolor = '';
          if (messageType === 0)//Info
          {
            iconName = 'I_Info';
            backgroundcolor = '#f1f3f4';
          }
          else if (messageType === 1)//Warning
          {
            iconName = 'I_Warning';
            backgroundcolor = '#ffe893';
          }
          else if (messageType === 2)//Error
          {
            iconName = 'I_Error';
            backgroundcolor = '#fff0ee';
          }
          else if (messageType === 3)//Success
          {
            iconName = 'I_Success';
            backgroundcolor = '#edf6eb';
          }

          imgelem.setAttribute("src", URLHandler.getURL() +  '/webapps/ParameterizationSkeleton/assets/icons/'+ iconName +'.png');

          that.contentView.setStyles({
            'background-color': backgroundcolor
          });
          that.contentView.setHTML(message);
          that.contentView.prepend(imgelem);

          var closeToastMessageButton = new WUXButton(
          {
            displayStyle: 'icon',
            icon:
            {
              iconName: 'close',
              fontIconFamily: WUXManagedFontIcons.Font3DS
            },
            iconSize : '0.5',
            onClick: function()
            {
              that.onClose.call(that);
            }
          });
          closeToastMessageButton.elements.container.setStyles({
            'border-style': 'none'
          });
          that.contentView.appendChild(closeToastMessageButton.elements.container);

          that.contentView.inject(that.contentToastView);
          return that.contentToastView;
        },

        /*
        * showToastMessage
        */
        showToastMessage : function showToastMessage(messsageType, message)
        {
          var that = this;
          that.buildToastMessage(messsageType, message);
          if (that.contentToastView.className === "")
          {
            that.contentToastView.className = "show";
            setTimeout(function()
            {
              that.contentToastView.className = that.contentToastView.className.replace("show", "");
            }, 4000);
          }
        }
    });
    return DPConfigurationToastMessage;
});

define("DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/ParameterizationCollection", ["require", "exports", "UWA/Core", "DS/WAFData/WAFData", "DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/Api3DSpaceBaseCollection"], function (require, exports, UWA, WAFData, Api3DSpaceBaseCollectionModule) {
    "use strict";
    var ParameterizationCollectionModule;
    (function (ParameterizationCollectionModule) {
        var handledDomain = null;
        ParameterizationCollectionModule.ParameterizationCollection = Api3DSpaceBaseCollectionModule.Api3DSpaceBaseCollection.extend({
            setup: function (models, options) {
                var _this = this;
                this._parent(models, options);
                var _modelKey = options._modelKey, domainID = _modelKey._attributes.domainid;
                if (UWA.is(this.model, "function")) {
                    this.model = this.model(domainID);
                    handledDomain = domainID;
                }
                this.get3DSpaceUrl().then(function (_3DSpaceURL) {
                    _this.getTenant().then(function (tenant) {
                        _this.url = _3DSpaceURL + "/resources/ParamWS/access/DomainElements?tenant=" + tenant + "&domainid=" + domainID;
                    });
                });
            },
            sync: function (method, model, options) {
                var _this = this;
                var _parent = this._parent;
                this.get3DSpaceUrl().then(function (_3DSpaceURL) {
                    _this.getTenant().then(function (tenant) {
                        options.contentType = 'application/json';
                        // options.lang = widget ? widget.lang : 'en';
                        options.headers = {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json',
                            // 'Accept-Language': widget?.lang ?? 'en'
                        };
                        options = Object.assign({
                            ajax: WAFData.authenticatedRequest,
                            url: _this.url
                        }, options);
                        _parent.apply(_this, [method, model, options]);
                    });
                });
            },
            getDomainJSONObject: function () {
                return this.at(0)._attributes;
            },
            /** Copied from DS/ParameterizationSkeleton/Utils/ParameterizationWebServices */
            postParamsArrOnServer: function () {
                var _this = this;
                var _a = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    _a[_i] = arguments[_i];
                }
                var connectProps = _a[0], jsonArr = _a[1], theImageCell = _a[2], onFailurefct = _a[3], onSuccessfct = _a[4];
                var domain = this.at(0)._attributes;
                this.get3DSpaceUrl().then(function (_3DSpaceURL) {
                    _this.getTenant().then(function (tenant) {
                        var url = _3DSpaceURL + "/resources/ParamWS/access/postparams?tenant=" + tenant, datatoSend = {
                            domain: domain.id,
                            parameter: jsonArr
                        };
                        WAFData.authenticatedRequest(url, {
                            timeout: 100000,
                            method: 'POST',
                            data: JSON.stringify(datatoSend),
                            type: 'json',
                            //proxy: 'passport',
                            headers: {
                                'Content-Type': 'application/json',
                                'Accept': 'application/json'
                            },
                            onFailure: function (err) {
                                onFailurefct(err);
                            },
                            onComplete: function (json) {
                                onSuccessfct(json, theImageCell);
                            }
                        });
                    });
                });
            }
        });
    })(ParameterizationCollectionModule || (ParameterizationCollectionModule = {}));
    ;
    return ParameterizationCollectionModule;
});

define("DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/ParameterizationPartSupplyCollection", ["require", "exports", "UWA/Core", "DS/ParameterizationSkeleton/Collection/ParameterizationPartSupply/ParameterizationCollection"], function (require, exports, UWA, ParameterizationCollectionModule) {
    "use strict";
    return ParameterizationCollectionModule.ParameterizationCollection.extend({
        /** Replaces MaturityStates parameter options by the options retrieved from enovia call */
        applyPossibleMaturityStates: function (maturityStates) {
            this.forEach(function (model) {
                model.get('family').forEach(function (family) {
                    family.parameter.forEach(function (parameter) {
                        if (parameter.id === 'IndexedMaturityStates') {
                            var argumentValue = maturityStates.map(function (maturityState) {
                                return {
                                    "id": maturityState.get('id'),
                                    "nlsKey": maturityState.get('stateUserName')
                                };
                            });
                            parameter.argument = [UWA.extend(parameter.argument[0], {
                                    value: argumentValue
                                })];
                        }
                    }.bind(this));
                }.bind(this));
            }.bind(this));
        }
    });
});

/**
* @quickreview  ROW 23:12:29 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDELUserExperience/DELUserExperienceConfigLayoutView',
  [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationLayoutView',
    'DS/ParameterizationSkeleton/Views/ParameterizationDELUserExperience/DELWebAppsCustomizationFamilyView',
    'DS/ParameterizationSkeleton/Views/ParameterizationDELUserExperience/DELProcessFlowDiagramColorConfigFamilyView',
    'DS/ParameterizationSkeleton/Views/ParameterizationDELUserExperience/DELProcessFlowDiagramAttributesConfigFamilyView',
    'DS/ParameterizationSkeleton/Views/ParameterizationDELUserExperience/DELProcessFlowDiagramAspectRatiosConfigFamilyView',
    'DS/ParameterizationSkeleton/Views/ParameterizationDELUserExperience/DELProcessTranslationLanguagesFamilyView',
    'DS/ParameterizationSkeleton/Views/ParameterizationDELUserExperience/DELProcessTranslationAttributesFamilyView',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
    'DS/UIKIT/Mask',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DELUserExperienceConfiguration'
  ],
  function (
    UWA,
    DELConfigurationLayoutView,
    DELWebAppsCustomizationFamilyView,
    DELProcessFlowDiagramColorConfigFamilyView,
    DELProcessFlowDiagramAttributesConfigFamilyView,
    DELProcessFlowDiagramAspectRatiosConfigFamilyView,
    DELProcessTranslationLanguagesFamilyView,
    DELProcessTranslationAttributesFamilyView,
    DELConfigurationFamilyView,
    Mask,
    Nls
  ) {

    'use strict';

    var DELUserExperienceConfigLayoutView = DELConfigurationLayoutView.extend({

      /*
      * init
      */
      init: function init(options) {
        var that = this;
        this._parent(options);
      },

      /*
      * onCompleteRequestParameters
      */
      onCompleteRequestParameters: function onCompleteRequestParameters() {
        //removeApply Reset div
        var eltUI = document.getElementById("ApplyResetDiv");
        if (eltUI) {
          var parentNode = eltUI.getParent();
          parentNode.removeChild(eltUI);
        }

        this._parent();
      },

      /*
      * buildParameterLine
      */
      buildParameterLine: function (iParamObj, familyID, familytbody, popoverPosition) {

        var that = this;
        var args = iParamObj.argument;
        for (var i = 0; i < args.length; i++) {
          var arg = args[i];
          if (arg && arg.defaultValue === "DELConfigurationTreeListView") {
            familytbody.parentElement.style.marginLeft = '-14px';
            var newParamline = UWA.createElement('tr', {title: ''});
            var paramTreeListViewCell = UWA.createElement('td', {
                'width' : '100%',
                'title' : '',
                'colspan' : '4'
            });
            paramTreeListViewCell.setStyle("vertical-align", "text-bottom");
            var contentTreeView = UWA.createElement('div');
            contentTreeView.className = "treeListView";

            var options = {};
            options.xmlDoc = that._xmlMap.get(arg.id);
            options.domainid = that._domainID;
            options.familyid = familyID;
            options.parameterid = iParamObj.id;
            options.argid = arg.id;

            options.treeListViewNls = that._xmlNls.get(arg.id)[0];
            options.modalViewNls = that._xmlNls.get(arg.id)[1];
            options.nodeTreeViewNls = that._xmlNls.get(arg.id)[2];

            var familyView = null;
            if(arg.id === "DELProcessFlowDiagramColorsListArg"){
              familyView = new DELProcessFlowDiagramColorConfigFamilyView(options);
            }
            else if(arg.id === "DELProcessFlowDiagramAttriutesListArg"){
              familyView = new DELProcessFlowDiagramAttributesConfigFamilyView(options);
            }
            else if(arg.id === "DELWebAppsCustomizationListArg"){
              familyView = new DELWebAppsCustomizationFamilyView(options);
            }
            else if(arg.id === "DELProcessFlowDiagramAspectRatiosListArg"){
              familyView = new DELProcessFlowDiagramAspectRatiosConfigFamilyView(options);
            }
            else if(arg.id === "DELProcessTranslationLanguagesListArg"){
              familyView = new DELProcessTranslationLanguagesFamilyView(options);
            }
            else if(arg.id === "DELProcessTranslationAttributesListArg"){
              familyView = new DELProcessTranslationAttributesFamilyView(options);
            }
            else
              familyView = new DELConfigurationFamilyView(options);
            if( familyView != null && (arg.id === "DELProcessFlowDiagramColorsListArg" || arg.id === "DELProcessFlowDiagramAttriutesListArg" || arg.id === "DELWebAppsCustomizationListArg" || arg.id === "DELProcessTranslationAttributesListArg" || arg.id === "DELProcessTranslationLanguagesListArg"))
            {
              Mask.mask(familytbody);
              UWA.Promise.all([familyView.getPromisetoGetInfofromDB()]).then(function () {
                that._listOfFamilyViews.push(familyView);
                var familyViewContent = familyView.buildFamilyContent();
                familyViewContent.inject(contentTreeView);
                contentTreeView.inject(paramTreeListViewCell);
                paramTreeListViewCell.inject(newParamline);
                Mask.unmask(familytbody);
              }).catch(e=>{
                console.log(e);
              });
              newParamline.inject(familytbody);
          
            }
            else{
              that._listOfFamilyViews.push(familyView);
              var familyViewContent = familyView.buildFamilyContent();
              familyViewContent.inject(contentTreeView);
              contentTreeView.inject(paramTreeListViewCell);
              paramTreeListViewCell.inject(newParamline);
              newParamline.inject(familytbody);
            }
          }
          else
            this._parent(iParamObj, familyID, familytbody, popoverPosition);
        }
      },
    });
    return DELUserExperienceConfigLayoutView;
  });

/**
* @quickreview  KB9 21:10:25 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDELUserExperience/DELUserExperienceConfigParentView',
		[
	 'UWA/Core',
	 'DS/ParameterizationSkeleton/Views/ParametersParentView',
	 'DS/ParameterizationSkeleton/Views/ParameterizationDELUserExperience/DELUserExperienceConfigLayoutView'
	 ],
	 function (
		 UWA,
		 ParametersParentView,
		 DELUserExperienceConfigLayoutView
		)
{

	'use strict';


	var DELProcessFlowDiagramConfigParentView = ParametersParentView.extend({

		init: function (options) {
			options = UWA.clone(options || {}, false);
			this._domainID = options.domainid;
			this._parent(options);
		},

		setup: function (options) {
			UWA.log('DELUserExperienceConfigParentView Layout::setup!');
			UWA.log(options);

		},

		render : function()
		{
			var that = this;
			var options = this.options;

		  var layoutView = new DELUserExperienceConfigLayoutView(options);
			return layoutView.render();
		}
	});

	return DELProcessFlowDiagramConfigParentView;
});

/**
* @quickreview  ROW 25:02:11 creation
*/
define('DS/ParameterizationSkeleton/Views/ParameterizationDisplayProperties/DPConfigurationModalView',
[
  'UWA/Class',
  'DS/UIKIT/Modal',
  'DS/Controls/Button',
  'DS/ParameterizationSkeleton/Views/ParameterizationDisplayProperties/DPConfigurationToastMessage',
  'i18n!DS/ParameterizationSkeleton/assets/nls/DisplayPropertiesNLS',
  'css!UIKIT/UIKIT.css',
  'css!DS/ParameterizationSkeleton/ParameterizationSkeleton.css',
],
function (
  Class,
  Modal,
  WUXButton,
  DPConfigurationToastMessage,
  Nls
) {
  'use strict';

  const modalViewOptions = Object.freeze(
      {
        "OK": 1,
        "OKCANCEL":2,
        "OKCLOSE":3,
        "CLOSE":4
      }
  );

  var DPConfigurationModalView = Class.extend({

    /**
    * init
    */
    init : function init(options)
    {
      var that = this;
      that.options = options;
    },

    /*
    * destroyModal
    */
    destroyModal : function destroyModal()
    {
      var that = this;
      that.modal.destroy();
    },

    /*
    * showToastMessage
    */
    showToastMessage : function showToastMessage(messageType, message)
    {
      var that = this;
      that.ToastMessage.showToastMessage(messageType, message);
    },

    /*
    * buildModal
    */
    buildModal : function buildModal()
    {
      var that = this;

      var contentModalView = UWA.createElement('div');
      contentModalView.class = "contentModalView";
      that.options.content.inject(contentModalView);

      that.ToastMessage = new DPConfigurationToastMessage(contentModalView);
      that.ToastMessage.contentToastView.setStyles({
        'border': '1px solid black',
        'position': 'absolute',
        'z-index': '1',
        'bottom': '50px',
        'width': '80%',
        'margin-left': '10%'
      });

      var footerDiv = UWA.createElement('div');
      footerDiv.class = "footView";
      footerDiv.setStyles({
        display: 'flex',
        'align-items': 'baseline',
        'flex-flow': 'row',
        'width': '100%',
        'margin-left': '35%'
      });

      that.buildButtonsFooter(footerDiv);

      this.modal = new Modal({
        className: 'NotifModal',
        closable: true,
        visible: true,
        header: that.options.title,
        body: contentModalView,
        footer: footerDiv,
        events: {
          onHide: function () {
            that.options.CancelButtonClick();
            that.destroyModal();
          }
        }
      }).inject(document.body);

      var HelpDiv = new UWA.Element('div');
      HelpDiv.inject(footerDiv);

      var HelpButton = new WUXButton(
        {
          displayStyle: 'icon',
          icon:
          {
            iconName: 'help',
            fontIconFamily: WUXManagedFontIcons.Font3DS
          },
          iconSize: '0.5',
          onClick: function () {
            that.ToastMessage.showToastMessage(0, that.options.info);
          }
        }).inject(HelpDiv);

      HelpButton.elements.container.setAttribute("title", Nls.Help);
      return this;
    },

    /*
    * buildModal
    */
    buildButtonsFooter: function buildButtonsFooter(divButtonsFooter) {
      var that = this;
      if (that.options.modalView === modalViewOptions.OK ||
        that.options.modalView === modalViewOptions.OKCLOSE ||
        that.options.modalView === modalViewOptions.OKCANCEL) {
        var okButton = new WUXButton({
          type: 'standard',
          label: Nls.OK,
          displayStyle: 'normal',
          onClick: function (e) {
            var destroy = that.options.OKButtonClick();
            if (destroy === undefined)
              that.modal.destroy();
          }
        });

        okButton.elements.container.setAttribute("title", Nls.OK);
        okButton.elements.container.setStyles({
          'text-align': 'center'
        });

        okButton.elements.container.style["background-color"] = "#368EC4";
        okButton.elements.text.style["color"] = "white";

        okButton.inject(divButtonsFooter);
      }

      if (that.options.modalView === modalViewOptions.OKCLOSE) {
        var closeButton = new WUXButton({
          type: 'standard',
          label: Nls.Close,
          displayStyle: 'normal',
          onClick: function (e) {
            that.options.CancelButtonClick();
            that.modal.destroy();
          }
        });

        closeButton.elements.container.setAttribute("title", Nls.Close);
        closeButton.elements.container.setStyles({
          display: 'inline-block',
          'margin-left': '5px',
          'text-align': 'center'
        })

        closeButton.inject(divButtonsFooter);
      }

      if (that.options.modalView === modalViewOptions.OKCANCEL) {
        var cancelButton = new WUXButton({
          type: 'standard',
          label: Nls.Cancel,
          displayStyle: 'normal',
          onClick: function (e) {
            that.options.CancelButtonClick();
            that.modal.destroy();
          }
        });

        cancelButton.elements.container.setAttribute("title", Nls.Cancel);
        cancelButton.elements.container.setStyles({
          display: 'inline-block',
          'margin-left': '5px',
          'text-align': 'center'
        })

        cancelButton.inject(divButtonsFooter);
      }
      }
    });
    return DPConfigurationModalView;
  });

/**
* @quickreview  ROW 25:02:11 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDisplayProperties/DPConfigurationBaseTableView',
  [
    'UWA/Core',
    'UWA/Class',
    'DS/Tweakers/GeneratedToolbar',
    'DS/ParameterizationSkeleton/Views/ParameterizationDisplayProperties/DPConfigurationTreeListView',
    'DS/Controls/Label',
    'DS/Controls/ComboBox',
    'DS/Controls/LineEditor',
    'DS/Controls/Toggle',
    'DS/Controls/TooltipModel',
    'DS/UIKIT/Alert',
    'DS/ParameterizationSkeleton/Views/ParameterizationDisplayProperties/DPConfigurationModalView',
    'DS/ParameterizationSkeleton/Model/ParameterizationDisplayProperties/DPConfigurationParamTranslationModel',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DisplayPropertiesNLS',
    'css!DS/ParameterizationSkeleton/ParameterizationSkeleton'
  ],
  function (
    UWA,
    Class,
    WUXGeneratedToolbar,
    DPConfigurationTreeListView,
    WUXLabel,
    WUXComboBox,
    WUXEditor,
    WUXToggle,
    WUXTooltipModel,
    Alert,
    DPConfigurationModalView,
    DPConfigurationParamTranslationModel,
    Nls
  ) {

    'use strict';

    var DPConfigurationBaseTableView = Class.extend({

      _uiElementsIDs: [],
      _treeListViewNls: null,
      _modalViewNls: null,
      _nodeTreeViewNls: null,
      _domainID: null,
      _familyID: null,
      _paramID: null,
      _argID: null,

      /*
      * init
      */
      init: function init(options) {

        this._domainID = options.domainid;
        this._familyID = options.familyid;
        this._paramID = options.parameterid;
        this._argID = options.argid;

        this._columns = options.columnsinfo;

        if (options.treeListViewNls != undefined || options.treeListViewNls != null)
          this._treeListViewNls = options.treeListViewNls;

        if (options.modalViewNls != undefined || options.modalViewNls != null)
          this._modalViewNls = options.modalViewNls;

        if (options.nodeTreeViewNls != undefined || options.nodeTreeViewNls != null)
          this._nodeTreeViewNls = options.nodeTreeViewNls;
      },

      /*
      * presetModal
      */
      presetModal: function presetModal(node) {
        console.log("presetModal");
        var that = this;
        that._node = node;

        var nodeGrid = node.getGrid();
        var uiElementsIDLength = that._uiElementsIDs.length;
        for (var i = 0; i < uiElementsIDLength; i++) {
          var eltUI = that._uiElementsIDs[i];
          if (eltUI) {
            var eltUIid = eltUI.id;
            var docElt = document.getElementById(eltUIid);
            if (docElt) {
              if (eltUI.type === "textarea")
                docElt.dsModel.value = nodeGrid[eltUIid];

              if (eltUI.type === "checkbox")
                docElt.dsModel.checkFlag = nodeGrid[eltUIid];

              if (eltUI.type === "combobox" || eltUI.type === "multiselcombobox") {
                var selectedIndex = -1;
                var elementList = docElt.dsModel.elementsList;
                var elementListLength = elementList.length;
                for (var k = 0; k < elementListLength && selectedIndex === -1; k++) {
                  if (elementList[k].label === nodeGrid[eltUIid])
                    selectedIndex = k;
                }

                docElt.dsModel.selectedIndex = selectedIndex;
              }
            }
          }
        }
      },


      /*
      * createtreeNode
      */
      createtreeNode: function createtreeNode(data, grid) {
        var that = this;

        var treeNodeModel = new DPConfigurationParamTranslationModel({
          data: data,
          grid: grid,
          nls: that._nodeTreeViewNls
        });

        return treeNodeModel;
      },

      /*
      * validateModal
      */
      validateModal: function validateModal() {
        var that = this;
        console.log("validateModal");

        var data = new Map();
        var grid = new Map();

        var uiElementsIDLength = that._uiElementsIDs.length;
        var uiElementsID = that._uiElementsIDs;

        for (var i = 0; i < uiElementsIDLength; i++) {
          var uiEl = document.getElementById(that._uiElementsIDs[i].id);
          if (uiEl) {
            if (uiEl.dsModel.checkFlag != undefined || uiEl.dsModel.checkFlag != null) {
              data.set(that._uiElementsIDs[i].id, uiEl.dsModel.checkFlag);
              grid.set(that._uiElementsIDs[i].id, uiEl.dsModel.checkFlag);
            }
            else {
              var bIncludesSpecialCharacter = false;
              if (that._uiElementsIDs[i].mandatory === true) {
                var bMandatoryField = false;
                if (that._uiElementsIDs[i].type != "combobox") {
                  if (uiEl.dsModel.value != undefined && uiEl.dsModel.value != null && uiEl.dsModel.value != "") {
                    bMandatoryField = true;
                    var value = uiEl.dsModel.value;
                    if (value.includes('|') || value.includes('=') || value.includes('}'))
                      bIncludesSpecialCharacter = true;
                    var updatedValueToEscapeSpecialChars = value.replace(',', '\,').replace('"', '\"').replace(/[\\]/g, '\\');
                    data.set(that._uiElementsIDs[i].id, updatedValueToEscapeSpecialChars);
                    grid.set(that._uiElementsIDs[i].id, uiEl.dsModel.value);
                  }
                }
                else {
                  if (uiEl.dsModel.label != undefined && uiEl.dsModel.label != null && uiEl.dsModel.label != "") {
                    bMandatoryField = true;
                    data.set(that._uiElementsIDs[i].id, uiEl.dsModel.value);//uiEl.dsModel.label);
                    grid.set(that._uiElementsIDs[i].id, uiEl.dsModel.label);
                  }
                }

                if (!bMandatoryField) {
                  var mandatoryCol = that._treeListViewNls[that._uiElementsIDs[i].id];
                  var nlsErrorMsg = Nls.columnMandatory;
                  nlsErrorMsg = nlsErrorMsg.replace("%1", mandatoryCol);
                  that._modalView.showToastMessage(2, nlsErrorMsg);
                  return;
                }
              }
              else {
                if (that._uiElementsIDs[i].type != "combobox") {
                  var value = uiEl.dsModel.value;
                  var updatedValueToEscapeSpecialChars = value;
                  if (value != undefined && value != null) {
                    if (value.includes('|') || value.includes('=') || value.includes('}'))
                      bIncludesSpecialCharacter = true;
                    updatedValueToEscapeSpecialChars = value.replace(',', '\,').replace('"', '\"').replace(/[\\]/g, '\\');
                  }
                  data.set(that._uiElementsIDs[i].id, updatedValueToEscapeSpecialChars);
                  grid.set(that._uiElementsIDs[i].id, uiEl.dsModel.value);
                }
                else {
                  data.set(that._uiElementsIDs[i].id, uiEl.dsModel.value);//uiEl.dsModel.label);
                  grid.set(that._uiElementsIDs[i].id, uiEl.dsModel.label);
                }
              }
              if (bIncludesSpecialCharacter) {
                var columnID = that._treeListViewNls[that._uiElementsIDs[i].id];
                var specialChar = "|,=,}";
                var nlsErrorMsg = Nls.containUnsupportedChars;
                nlsErrorMsg = nlsErrorMsg.replace("%1", columnID);
                nlsErrorMsg = nlsErrorMsg.replace("%2", specialChar);
                that._modalView.showToastMessage(2, nlsErrorMsg);
                return;
              }
            }
          }
        }

        var objData = {};
        var objGrid = {};
        data.forEach(function (value, key) {
          ;
          if (value != "" && value != undefined)
            objData[key] = value;
        });

        grid.forEach(function (value, key) {
          objGrid[key] = value;
        });


        var treeNodeModel = that.createtreeNode(objData, objGrid);
        return treeNodeModel;
      },

      /*
      * mapFunctions
      */
      mapFunctions: function mapFunctions(name) {

      },

      /*
      * render
      */
      render: function render() {
        var that = this;
        this._parent();

        return this;
      },

      /*
      * buildtreeListView
      */
      buildtreeListView: function buildtreeListView() {
        var that = this;
        var options = {};
        options.data = [];
        options.columns = that._uiElementsIDs;
        options.nls = that._treeListViewNls;
        options.paramid = this._paramID;

        that.treeList = new DPConfigurationTreeListView(options);
        that.treeListView = that.treeList.buildView(options);
      },


      /*
      * buildFamilyContent
      */
      buildFamilyContent: function buildFamilyContent() {
        var that = this;

        this._uiElementsIDs = [];

        var contentTreeView = UWA.createElement('div');

        var columnsList = that._columns;
        var columnsListLength = columnsList.length;
        for (var i = 0; i < columnsListLength; i++) {
          var uiobjectType = columnsList[i].type;

          var uiojectValue = null;
          if (columnsList[i].value != null && columnsList[i].value != undefined)
            uiojectValue = columnsList[i].value;

          var uiobjectID = null;
          if (columnsList[i].id != null && columnsList[i].id != undefined)
            uiobjectID = columnsList[i].id;

          var uiobjectDisabled = false;
          if (columnsList[i].disabled != undefined && columnsList[i].disabled != null)
            uiobjectDisabled = (columnsList[i].disabled === "true");

          var uiobjectOnChange = null;
          if (columnsList[i].onChange != null && columnsList[i].onChange != undefined)
            uiobjectOnChange = columnsList[i].onChange;

          var uiobjectHidden = null;
          if (columnsList[i].hidden != null && columnsList[i].hidden != undefined)
            uiobjectHidden = (columnsList[i].hidden === "true");

          var uiobjectMandatory = null;
          if (columnsList[i].mandatory != null && columnsList[i].mandatory != undefined)
            uiobjectMandatory = (columnsList[i].mandatory === "true");

          var uiobjectSortable = null;
          if (columnsList[i].sortable != null && columnsList[i].sortable != undefined)
            uiobjectSortable = ((columnsList[i].sortable).toLowerCase?.() === 'true');


          that._uiElementsIDs.push({ id: uiobjectID, type: uiobjectType, value: uiojectValue, disabled: uiobjectDisabled, onChange: uiobjectOnChange, hidden: uiobjectHidden, mandatory: uiobjectMandatory, sortable: uiobjectSortable });
        }

        var divToolbar = document.createElement("div");
        divToolbar.className = "divToolbar";
        contentTreeView.appendChild(divToolbar);

        var JSONToolbar = {
          "entries": [
            {
              "id": "buildModal",
              "dataElements": {
                "typeRepresentation": "functionIcon",
                "tooltip": Nls.Add,
                value: that.buildModal.bind(that, false),
                "icon": {
                  "iconName": "plus",
                  "fontIconFamily": 1
                },
                "position": "far",
                "category": "1"
              }
            }
          ]
        };

        var toolbarModel = WUXGeneratedToolbar.prototype.createTreeDocument(JSONToolbar);
        var toolbar = new WUXGeneratedToolbar({
          overflowManagement: "scroll",
          direction: "horizontal",
          items: toolbarModel
        });

        toolbar.inject(divToolbar);

        that.buildtreeListView();
        that.treeListView.inject(contentTreeView);

        return contentTreeView;
      },

      /*
      * addChild
      */
      addChild: function addChild(nodesTab) {
        var that = this;

        var nodesTabLength = nodesTab.length;
        for (var i = 0; i < nodesTabLength; i++) {
          var grid = nodesTab[i].getGrid();
          grid.delete = {
            module: 'DS/ParameterizationSkeleton/Views/ParameterizationDisplayProperties/DPConfigurationBaseTableView',
            func: 'removeSelectedNode',
            argument: {
              configurationLayoutView: that
            }
          };

          grid.edit = {
            module: 'DS/ParameterizationSkeleton/Views/ParameterizationDisplayProperties/DPConfigurationBaseTableView',
            func: 'editSelectedNode',
            argument: {
              configurationLayoutView: that
            }
          };

        }

        that.treeList.addChild(nodesTab);//nodesTab);
      },

      /*
      * buildModal
      */
      buildModal: function buildModal(bEditMod) {
        var that = this;

        var contentModalView = UWA.createElement('div');


        var uiElementsLength = that._uiElementsIDs.length;
        for (var i = 0; i < uiElementsLength; i++) {
          if (that.treeListView.columns[i].visibleFlag === false)
            continue;

          var uiObject = that._uiElementsIDs[i];
          var subcontentDiv = new UWA.Element('div');
          subcontentDiv.className = "dpSubcontentModalView";
          subcontentDiv.inject(contentModalView);

          var labelTitleNls = uiObject.id;
          var labelTooltipNls = uiObject.id;
          if (that._treeListViewNls != null || that._treeListViewNls != undefined) {
            if (that._treeListViewNls[uiObject.id] != undefined)
              labelTitleNls = that._treeListViewNls[uiObject.id];

            if (that._treeListViewNls[uiObject.id + "Tooltip"] != undefined)
              labelTooltipNls = that._treeListViewNls[uiObject.id + "Tooltip"];
          }

          var myLabel = new WUXLabel({ value: labelTitleNls }).inject(subcontentDiv);
          myLabel.elements["container"].setStyles({
            'width': '60%',
            'height': '3em',
            'background-color': 'white',
            'text-align': 'left',
            display: 'inline-grid'
          });
          var myIcon = new WUXLabel({ icon: "info" }).inject(subcontentDiv);
          myIcon.tooltipInfos = new WUXTooltipModel({
            shortHelp: labelTooltipNls,
            mouseRelativePosition: false,
            position: "bottom"
          });
          myIcon.elements["container"].setStyles({
            'width': '15%',
            'height': '3em',
            'background-color': 'white',
            'text-align': 'left',
            display: 'inline-grid'
          });

          var uiElt = null;
          if (uiObject.type === "textarea") {
            var lOptions = {};

            lOptions.value = uiObject.value;
            lOptions.disabled = uiObject.disabled;
            lOptions.requiredFlag = uiObject.mandatory;
            uiElt = new WUXEditor(lOptions);
            uiElt.elements["container"].setStyles({
              'width': '100%',
              display: 'inline-grid'
            });
            uiElt.elements.container.className += " dptextEditormodal";
          }
          else if (uiObject.type === "checkbox") {
            var lOptions = {};
            lOptions.type = "switch";
            lOptions.value = 0;
            lOptions.disabled = (uiObject.disabled === "true");
            uiElt = new WUXToggle(lOptions);
            if (uiObject.value === "true")
              uiElt.toggle();
            uiElt.elements["container"].setStyles({
              'width': '100%',
              display: 'inline-grid'
            });
            if (uiObject.onChange)
              uiElt.addEventListener('change', that.mapFunctions(uiObject.onChange));
          }
          else if (uiObject.type === "combobox" || uiObject.type === "multiselcombobox") {
            var elementsList = uiObject.value.split(",");
            var elementsListNls = elementsList;
            var elementsListLength = elementsList.length;
            for (var m = 0; m < elementsListLength; m++) {
              if (that._nodeTreeViewNls != null && that._nodeTreeViewNls[elementsList[m]] != null && that._nodeTreeViewNls[elementsList[m]] != undefined)
                elementsListNls[m] = { label: that._nodeTreeViewNls[elementsList[m]], value: elementsList[m] };
              else
                elementsListNls[m] = { label: elementsList[m], value: elementsList[m] };
            }

            var lOptions = {};
            lOptions.elementsList = elementsListNls;
            lOptions.selectedIndexes = [];
            lOptions.displayStyle = "normal";
            lOptions.enableSearchFlag = true;
            lOptions.placeholder = "Select";
            if (that._modalViewNls != null || that._modalViewNls != undefined)
              lOptions.placeholder = that._modalViewNls.Select;

            lOptions.multiSelFlag = false;
            if (uiObject.type === "multiselcombobox")
              lOptions.multiSelFlag = true;

            lOptions.width = "100%";
            lOptions.height = "30px";
            lOptions.disabled = (uiObject.disabled === "true");
            lOptions.generateRegexpString = function (text) {
              return text;
            };

            uiElt = new WUXComboBox(lOptions);
            uiElt.elements.container.className += " dpcomboboxmodal";

            if (uiObject.onChange)
              uiElt.addEventListener('change', that.mapFunctions(uiObject.onChange));
          }
          uiElt.elements.container.setAttribute('id', uiObject.id);
          uiElt.inject(subcontentDiv);
        }

        var options = {};
        options.content = contentModalView;
        options.modalView = 2;
        options.title = "title";
        if (that._modalViewNls != null || that._modalViewNls != undefined)
          options.title = that._modalViewNls.modalTitle;

        if (bEditMod)
          options.OKButtonClick = that.onOKEditButtonClick.bind(that);
        else
          options.OKButtonClick = that.onOKButtonClick.bind(that);
        options.CancelButtonClick = that.onCancelButtonClick.bind(that);

        options.info = "info";
        if (that._modalViewNls != null || that._modalViewNls != undefined)
          options.info = that._modalViewNls.Info;

        that._modalView = new DPConfigurationModalView(options);
        that._modalView.buildModal();
      },

      /*
      * destroyModal
      */
      destroyModal: function destroyModal() {
        that._modalView.destroyModal();
      },

      /*
      * onOKEditButtonClick
      */
      onOKEditButtonClick: function onOKEditButtonClick() {
        var that = this;

        var treeListNode = that.validateModal();
        var data = treeListNode.getData();
        if (data != undefined) {
          var oldnodeData = that._node.getData();
          delete oldnodeData["isDeployed"];
          delete oldnodeData["delete"];
          delete oldnodeData["edit"];

          var oldnodeGrid = that._node.getGrid();

          var treeDoc = that.treeList.dataGridView.treeDocument;
          if (treeDoc) {
            var children = treeDoc.getChildren();
            var childrenLength = children.length;
            for (var i = 0; i < childrenLength; i++) {
              var childrenTMP = children[i];
              if (childrenTMP) {
                var grid = childrenTMP.options.grid;
                if (grid) {
                  var bFound = true;
                  var uiElementsIDLength = that._uiElementsIDs.length;
                  var uiElementsID = that._uiElementsIDs;
                  for (var m = 0; m < uiElementsIDLength && bFound; m++) {
                    if (grid[that._uiElementsIDs[m].id] === "")
                      continue;

                    if (grid[that._uiElementsIDs[m].id] != oldnodeGrid/*that._node*/[that._uiElementsIDs[m].id])
                      bFound = false;
                  }

                  if (bFound) {
                    var objNode = treeListNode.getData();

                    var objNodeGrid = treeListNode.getGrid();
                    objNodeGrid.deploystatus = "notDeployed";
                    objNodeGrid.edit = grid.edit;
                    objNodeGrid.delete = grid.delete;

                    childrenTMP.updateOptions({ data: null });
                    childrenTMP.updateOptions({ grid: objNodeGrid, data: objNode });
                    break;
                  }
                }
              }
            }
          }

          that._node = null;

        }
      },

      /*
      * onOKButtonClick
      */
      onOKButtonClick: function onOKButtonClick() {
        var that = this;
        var treeListNode = that.validateModal();

        treeListNode.addGridAttributes({ deploystatus: "notDeployed" });
        that.addChild([treeListNode]);

      },

      /*
      * updateTreeViewOnApplySuccess
      */
      updateTreeViewOnApplySuccess :function updateTreeViewOnApplySuccess()
      {
        var that = this;
        var treeDoc = that.treeList.dataGridView.treeDocument;
        if (treeDoc) {
          var children = treeDoc.getChildren();
          var nodesTobeRemoved = [];
          var childrenLength = children.length;
          for (var i = 0; i < childrenLength; i++) {
            var childTreeNode = children[i];
            if (childTreeNode) {
              var tempgrid = childTreeNode.options.grid;
              var tempdata = childTreeNode.options.data;
              if (tempgrid && tempdata) {
                if (tempgrid.deploystatus === "deleted") {
                  nodesTobeRemoved.push(childTreeNode);
                }
                else if (tempgrid.deploystatus === "notDeployed") {
                  tempgrid.deploystatus = "deployed";
                  tempdata.deploystatus = "deployed";
                  childTreeNode.updateOptions({ data: null });
                  childTreeNode.updateOptions({ grid: tempgrid, data: tempdata });
                }
              }
            }
          }
          nodesTobeRemoved.forEach(node=>{
            treeDoc.removeRoot(node);
          });

        }
      },

      /*
      * resetTreeviewEntries
      */
      resetTreeviewEntries: function (paramtersArray){
        var that = this;
        var treeDoc = that.treeList.dataGridView.treeDocument;
        if (treeDoc) {
          treeDoc.removeRoots();
          that.populateTreeViewWithSavedParameters(paramtersArray);
        }
      },

      /*
      * populateTreeViewWithSavedParameters
      */
      populateTreeViewWithSavedParameters:function populateTreeViewWithSavedParameters(paramtersJsonArray){
        var that = this;
        var listOfnodeTree = [];
          var ParamsLength = paramtersJsonArray.length;
          for (var i = 0; i < ParamsLength; i++){
            var param = paramtersJsonArray[i];
            if(param["deploystatus"])
              param["deploystatus"] = "deployed";
            listOfnodeTree.push(that.createtreeNode(param));
          }
          that.addChild(listOfnodeTree);
      },

      /*
      * onCancelButtonClick
      */
      onCancelButtonClick: function onCancelButtonClick() {

      },

      /*
      * destroy
      */
      destroy: function destroy() {
        this._uiElementsIDs = [];

        if (this._modalView)
          this._modalView.destroyModal();
        this._parent.apply(this, arguments);
      },

      /*
      * removeSelectedNode
      */
      removeSelectedNode: function removeSelectedNode(params) {
        console.log("params " + params);
        var that = this;

        var node = params.context.nodeModel;
        if (node) {
          var tempgrid = node.options.grid;
          var tempdata = node.options.data;
          if (tempgrid && tempdata) {
              tempgrid.deploystatus = "deleted";
              tempgrid.delete = {};
              tempdata.deploystatus = "deleted";
              node.updateOptions({ data: null });
              node.updateOptions({ grid: tempgrid, data: tempdata });

          }
        }
      },

      /*
      * editSelectedNode
      */
      editSelectedNode: function editSelectedNode(params) {
        console.log("params " + params);

        var node = params.context.nodeModel;
        var bEditMod = true;
        params.configurationLayoutView.buildModal(bEditMod);
        params.configurationLayoutView.presetModal(node);
      },

      /*
      * getRowDataFromTreeView for a given row ID
      */
      getRowDataFromTreeView: function getRowDataFromTreeView(rowID) {
        var that = this;
        var dataObject = {};

        var uiElementsIDLength = that._uiElementsIDs.length;

        for (var i = 0; i < uiElementsIDLength; i++) {
          if (that._getCellValue(rowID, that._uiElementsIDs[i].id) != undefined) {
            var cellValue = that._getCellValue(rowID, that._uiElementsIDs[i].id);
            dataObject[that._uiElementsIDs[i].id] = cellValue;
          }
        }
        var deploystatusCellValue = that._getCellValue(rowID, "deploystatus");
        dataObject["deploystatus"] = deploystatusCellValue;
        return dataObject;
      },

      /*
      * _getCellValue for a given row ID and column name
      */
      _getCellValue: function _getCellValue(rowIndex, ColumnName) {
        var that = this;
        var cellvalue = null;
        if (that.treeListView.layout != undefined) {
          var attrColumnId = that.treeListView.layout.getColumnIndex(ColumnName);
          if (attrColumnId != undefined) {
            var attrCellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: rowIndex, columnID: attrColumnId });
            if (attrCellId != undefined && that.treeListView.getCellInfosAt(attrCellId) != undefined) {
              var cellInfos = that.treeListView.getCellInfosAt(attrCellId);
              if (cellInfos != undefined && cellInfos.nodeModel != undefined && cellInfos.nodeModel.options != undefined &&
                cellInfos.nodeModel.options.data != undefined && cellInfos.nodeModel.options.data[ColumnName] != undefined) {
                cellvalue = cellInfos.nodeModel.options.data[ColumnName];
              }
              if (ColumnName === "deploystatus" && cellInfos != undefined && cellInfos.nodeModel != undefined && cellInfos.nodeModel.options != undefined &&
                cellInfos.nodeModel.options.grid != undefined && cellInfos.nodeModel.options.grid[ColumnName] != undefined) {
                  cellvalue = cellInfos.nodeModel.options.grid[ColumnName];
              }
            }
          }
        }
        return cellvalue;
      },

      /*
      * displayAlertMessage
      */
      displayAlertMessage(message, className) {
        var mainContentDiv = document.getElementById("typeMainDiv");
        this.alertOptions = {
            visible: true,
            className: 'param-alert',
            messageClassName: className,
            closable: true,
            renderTo: mainContentDiv,
            autoHide: true,
            hideDelay: 2000,
        };

        const alert = new Alert(this.alertOptions);
        alert.add({
            message,
        });
      }

    });

    DPConfigurationBaseTableView.removeSelectedNode = function (params) {
      console.log("params " + params);
      var node = params.context.nodeModel;
      var data = node.getData();
      if(data.deploystatus === "deleted")
        return;
      params.configurationLayoutView.removeSelectedNode(params);
    }

    DPConfigurationBaseTableView.editSelectedNode = function (params) {
      console.log("params " + params);
      var node = params.context.nodeModel;
      var data = node.getData();
      if(data.deploystatus === "deleted")
        return;
      params.configurationLayoutView.editSelectedNode(params);
    }

    return DPConfigurationBaseTableView;
  });



define(
    'DS/ParameterizationSkeleton/Utils/ParameterizationDEL3DWorkbook/ParameterizationDEL3DWorkbookWebServices',
    [
        'UWA/Core',
        'UWA/Class',
        'DS/WAFData/WAFData',
        'DS/ParameterizationSkeleton/Utils/ParameterizationURLHandler'
    ],
    function(UWA, Class, WAFData, URLHandler) {

        'use strict';

        var ParameterizationDEL3DWorkbookWebServices = Class.singleton({
            getlistofDELMIATypes : function (types, callback) {

                var url = URLHandler.getURL() + "/resources/delmia/mfgparam/configuration/getlistofDELMIATypes";
                var datatoSend = {
                    types : types
                };

                WAFData.authenticatedRequest(url, {
                    timeout: 100000,
                    method: 'POST',
                    data: JSON.stringify(datatoSend),
                    type: 'json',
                    headers: {
                        'Content-Type' : 'application/json',
                        'Accept' : 'application/json'
                    },

                    onFailure : function (json) {
                        callback.onFailure(json);
                    },

                    onComplete: function(json) {
                      callback.onSuccess(json);
                    }
                });
            }

        });
        return ParameterizationDEL3DWorkbookWebServices;
    }
);

/**
* @quickreview  ROW 25:02:02 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDisplayProperties/DPNLSValuesTableView',
  [
    'UWA/Core',
    'DS/Controls/ModalContainer',
    'DS/Controls/Loader',
    'DS/ParameterizationSkeleton/Views/ParameterizationDisplayProperties/DPConfigurationBaseTableView',
    'DS/ParameterizationSkeleton/Model/ParameterizationDisplayProperties/DPConfigurationParamTranslationModel',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDisplayProperties/ParameterizationDisplayPropertiesWebServices',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DisplayPropertiesNLS'
  ],
  function (
    UWA,
    WUXModalContainer,
    WUXLoader,
    DPConfigurationBaseTableView,
    DPConfigurationParamTranslationModel,
    ParameterizationDisplayPropertiesWebServices,
    Nls
  ) {

    'use strict';

    var DPNLSValuesTableView = DPConfigurationBaseTableView.extend({


      _node: null,
      _bEditMode: false,
      _CONSTANTS: {

        // Column Ids 
        COLUMNIDS: {
          CORPUS_TYPE: 'corpusType',
          TYPE: 'type',
          ATTRIBUTE: 'attribute'
        },

        TYPES_RESULT: {
          ATTRIBUTES: 'attributes',
          TYPES: 'types',
          SUBTYPES: 'subTypes',
          NLS_NAME:'NLSName',
          IsExtension : 'IsExtension',
        },
        FAMILY_ID :'NLSValuesTypesAndAttributes'
      },


      /*
      * init
      */
      init: function init(options) {
        var that = this;
        this._parent(options);

        that._treeListViewNls = Nls;
        that._modalViewNls = Nls;
        that._nodeTreeViewNls = Nls;
        that._needTitleForTreeListView = true;

      },

      /*
      * getPromisetoGetInfofromDB
      */
      getPromisetoFetchNLSValues: function getPromisetoFetchNLSValues(paramtersJsonArray) {
        var that = this;
        var types = [];
        var attributes = [];
        for(var idxparam=0;idxparam<paramtersJsonArray.length;idxparam++){
          var param = paramtersJsonArray[idxparam];
          if(param.hasOwnProperty('type'))
            types.push(param.type);
          if(param.hasOwnProperty('attribute') && param.attribute.length >0){
            if(param.attribute.includes("."))
              attributes.push(param.attribute);
            else
              attributes.push(param.type+"."+param.attribute);
          }
            
        }
        var promises = [];
        var promiseNLSValues = new UWA.Promise(function (resolve, reject) {
          if (that._nlsResult == null || that._nlsResult == undefined) {
            that._nlsResult = {};
            ParameterizationDisplayPropertiesWebServices.getNLS(types,attributes, {
              onSuccess: function (data) { 
                that._nlsResult = data;
                resolve();
              }
            });
          }
          else
            resolve();
        });
        promises.push(promiseNLSValues);

        return promises;
      },

      /*
      * buildFamilyContent
      */
      buildFamilyContent: function buildFamilyContent() {
        var that = this;
        var content = that._parent();
        return content;
      },

      /*
      * buildModal
      */
      buildModal: function buildModal(bEditMod) {
        var that = this;
        that._modalViewNls.modalTitle = that._modalViewNls.Title_NLS_modal;
        that._modalViewNls.Info = that._modalViewNls.Info_NLS_modal;
        that._modalViewNls.typeTooltip = that._modalViewNls.typeTooltip_NLS;
        that._modalViewNls.attributeTooltip = that._modalViewNls.attributeTooltip_NLS;
        that._parent(bEditMod);
        if(!that._bEditMode)
          that.updateCorpusTypesCombo();

        var comboType = document.getElementById(that._CONSTANTS.COLUMNIDS.TYPE);
        comboType.dsModel.disabled = true;
        comboType.dsModel.elementsList = [];
        comboType.dsModel.selectedIndex = -1;

        var comboAttribute = document.getElementById(that._CONSTANTS.COLUMNIDS.ATTRIBUTE);
        comboAttribute.dsModel.disabled = true;
        comboAttribute.dsModel.elementsList = [];
        comboAttribute.dsModel.selectedIndex = -1;
      },
      /*
      * presetModal
      */
      presetModal : function presetModal(node)
      {
        var that = this;

        if(node != null){
          var data = node.getData();
          var grid = node.getGrid();
          var listCorpusTypesCombo = []; 
          listCorpusTypesCombo.push({ label: grid[that._CONSTANTS.COLUMNIDS.CORPUS_TYPE], value: data[that._CONSTANTS.COLUMNIDS.CORPUS_TYPE] });
          var comboCorpusTypes = document.getElementById(that._CONSTANTS.COLUMNIDS.CORPUS_TYPE);
          comboCorpusTypes.dsModel.disabled = true;
          comboCorpusTypes.dsModel.elementsList = listCorpusTypesCombo;
          comboCorpusTypes.dsModel.selectedIndex = 0;
          if (grid[that._CONSTANTS.COLUMNIDS.TYPE] != undefined && grid[that._CONSTANTS.COLUMNIDS.TYPE] != "") {
            var listTypesCombo = [];
            listTypesCombo.push({ label: grid[that._CONSTANTS.COLUMNIDS.TYPE], value: data[that._CONSTANTS.COLUMNIDS.TYPE] });
            var comboTypes = document.getElementById(that._CONSTANTS.COLUMNIDS.TYPE);
            comboTypes.dsModel.disabled = true;
            comboTypes.dsModel.elementsList = listTypesCombo;
            comboTypes.dsModel.selectedIndex = 0;
          }
          if (grid[that._CONSTANTS.COLUMNIDS.ATTRIBUTE] != undefined && grid[that._CONSTANTS.COLUMNIDS.ATTRIBUTE] != "") {
            var listAttributesCombo = [];
            listAttributesCombo.push({ label: grid[that._CONSTANTS.COLUMNIDS.ATTRIBUTE], value: data[that._CONSTANTS.COLUMNIDS.ATTRIBUTE] });
            var comboAttribute = document.getElementById(that._CONSTANTS.COLUMNIDS.ATTRIBUTE);
            comboAttribute.dsModel.disabled = true;
            comboAttribute.dsModel.elementsList = listAttributesCombo;
            comboAttribute.dsModel.selectedIndex = 0;
          }
        }
        DPConfigurationBaseTableView.prototype.presetModal.call(that, node);

      },

      validateModal: function validateModal() {
        var that = this;
        var treeNodeModel = that._parent();
        if (treeNodeModel != null) {
          var data = treeNodeModel.getData();
          var matchingNode = that.getMatchingNodeIfExists(treeNodeModel);
          if (matchingNode != null && !that._bEditMode) {
            var nlsErrorMsg = Nls.Error_rowExistsWithSameData;
            that._modalView.showToastMessage(2, nlsErrorMsg);
            return;
          }
          if ((data.hasOwnProperty(that._CONSTANTS.COLUMNIDS.ATTRIBUTE) && Object.keys(data).length <= 2) || (!data.hasOwnProperty(that._CONSTANTS.COLUMNIDS.ATTRIBUTE) && Object.keys(data).length <= 2)) {
            var nlsErrorMsg = Nls.languagefieldsEmpty;
            that._modalView.showToastMessage(2, nlsErrorMsg);
            return;
          }
          if (matchingNode != null && that.compareNodeData(treeNodeModel, matchingNode) && that._bEditMode) {
            var nlsErrorMsg = Nls.Error_NoFieldEditied;
            that._modalView.showToastMessage(2, nlsErrorMsg);
            return;
          }
        }
        return treeNodeModel;
      },

      /*
       * updateCorpusTypesCombo
       */
      updateCorpusTypesCombo: function updateCorpusTypesCombo() {
        var that = this;

        var comboTypes = document.getElementById(that._CONSTANTS.COLUMNIDS.TYPE);
        comboTypes.dsModel.disabled = true;
        comboTypes.dsModel.elementsList = [];
        comboTypes.dsModel.selectedIndex = -1;

        if (that._corpusTypesResult != null) {
          that.fillCorpusTypesComboList();
        }
        else{
          //loader
          var loader = new WUXLoader({ height: 22 });
          loader.on(Nls.Loading);

          var parentNodeTypesContainer = comboTypes.getParent();
          parentNodeTypesContainer.style.position = "sticky";
          WUXModalContainer.createModal(parentNodeTypesContainer, loader.elements.container);

          ParameterizationDisplayPropertiesWebServices.getListOfCorpusTypes("NLSValuesTypesAndAttributes", {
            onSuccess: function (data) {
              loader.off();
              WUXModalContainer.removeModal(parentNodeTypesContainer);

              parentNodeTypesContainer.style.position = "";

              that._corpusTypesResult = {};
              that._corpusTypesResult = data;
              that.fillCorpusTypesComboList();
            },
            onFailure: function (err) {
              loader.off();
              WUXModalContainer.removeModal(parentNodeTypesContainer);
              parentNodeTypesContainer.style.position = "";
              that.displayAlertMessage(Nls.getTypesError, "error");
            }
          });
        }
      },


      fillCorpusTypesComboList: function fillCorpusTypesComboList() {
        var that = this;
        var comboCorpusTypes = document.getElementById(that._CONSTANTS.COLUMNIDS.CORPUS_TYPE);
        if (that._corpusTypesResult != null || that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES] != undefined) {
          var listForCombo = [];
          var corpusTypes = that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES];
          var corpusTypesLength = corpusTypes.length;
          for (var idxType = 0; idxType < corpusTypesLength; idxType++) {
            var comboValue = corpusTypes[idxType];
            var comboLabel = comboValue;
            if (Nls.hasOwnProperty(corpusTypes[idxType]))
              var comboLabel = Nls[corpusTypes[idxType]];
            listForCombo.push({ label: comboLabel, value: comboValue });
          }

          var comboElementsListLength = listForCombo.length;
          if (comboElementsListLength > 0) {
            if (listForCombo.length) {
              listForCombo.sort(function (comboValue1, comboValue2) {
                if (comboValue1.label.toLowerCase() === comboValue2.label.toLowerCase())
                  return 0;
                return comboValue1.label.toLowerCase() > comboValue2.label.toLowerCase() ? 1 : -1;
              });
            }
            if (!that._bEditMode)
              comboCorpusTypes.dsModel.disabled = false;
            comboCorpusTypes.dsModel.elementsList = listForCombo;
            comboCorpusTypes.dsModel.selectedIndex = -1;
            comboCorpusTypes.dsModel.autocompleteFlag = false;
          }
        }
      },




      /*
      * mapFunctions
      */
      mapFunctions: function mapFunctions(name) {
        var that = this;
        if (name === "onChangeCorpusTypeCombo")
          return that.onChangeCorpusTypeClick.bind(that);
        if (name === "onChangetypeCombo")
           return that.onChangeTypeClick.bind(that);
        if (name === "onChangeAttributeCombo")
          return that.onChangeAttributeClick.bind(that);
        else return null;
      },

      /*
      * onChangeCorpusTypeClick
      */
      onChangeCorpusTypeClick: function onChangeCorpusTypeClick(data) {
        var that = this;
        if (data.dsModel.elementsList[data.dsModel.selectedIndex] != undefined && !that._bEditMode) {
          that.updateTypesAndAttributesCombo(data.dsModel.elementsList[data.dsModel.selectedIndex].value);
        }
      },

      /*
      * onChangeTypeClick
      */
      onChangeTypeClick: function onChangeTypeClick(data) {
        var that = this;
        var uiElementType = null;
        var uiElementAttribute = null;
        that._uiElementsIDs.forEach(element => {
          if (element.id === that._CONSTANTS.COLUMNIDS.TYPE) {
            uiElementType = element;
          }
          if (element.id === that._CONSTANTS.COLUMNIDS.ATTRIBUTE) {
            uiElementAttribute = element;
          }
        });
        if (data.dsModel.selectedIndex != -1) {
          var comboAttribute = document.getElementById(that._CONSTANTS.COLUMNIDS.ATTRIBUTE);
          uiElementType.mandatory = true;
          uiElementAttribute.mandatory = false;
          comboAttribute.dsModel.selectedIndex = -1;
        }
      },

      /*
      * onChangeAttributeClick
      */
      onChangeAttributeClick: function onChangeAttributeClick(data) {
        var that = this;
        var uiElementType = null;
        var uiElementAttribute = null;
        that._uiElementsIDs.forEach(element => {
          if (element.id === that._CONSTANTS.COLUMNIDS.TYPE) {
            uiElementType = element;
          }
          if (element.id === that._CONSTANTS.COLUMNIDS.ATTRIBUTE) {
            uiElementAttribute = element;
          }
        });
        if (data.dsModel.selectedIndex != -1) {
          var comboTypes = document.getElementById(that._CONSTANTS.COLUMNIDS.TYPE);
          uiElementType.mandatory = false;
          uiElementAttribute.mandatory = true;
          comboTypes.dsModel.selectedIndex = -1;
        }
      },      
      /*
      * updateAttributesCombo
      */
      updateTypesAndAttributesCombo: function updateTypesAndAttributesCombo(i_selectedType) {
        var that = this;

        var comboTypes = document.getElementById(that._CONSTANTS.COLUMNIDS.TYPE);
        comboTypes.dsModel.disabled = true;
        comboTypes.dsModel.elementsList = [];
        comboTypes.dsModel.selectedIndex = -1;
        var comboAttribute = document.getElementById(that._CONSTANTS.COLUMNIDS.ATTRIBUTE);
        comboAttribute.dsModel.disabled = true;
        comboAttribute.dsModel.elementsList = [];
        comboAttribute.dsModel.selectedIndex = -1;
        if (that._corpusTypesResult != null && that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES] != undefined &&
          that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][i_selectedType] != undefined && 
          that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][i_selectedType][that._CONSTANTS.TYPES_RESULT.SUBTYPES] != undefined) {
            that. fillTypesComboList(i_selectedType);
            that. fillAttributesComboList(i_selectedType);
        }
        else{
          //loader
          var loader = new WUXLoader({ height: 22 });
          loader.on(Nls.Loading);

          var parentNodeTypesContainer = comboTypes.getParent();
          parentNodeTypesContainer.style.position = "sticky";
          WUXModalContainer.createModal(parentNodeTypesContainer, loader.elements.container);

          var parentNodeAttributesContainer = comboAttribute.getParent();
          parentNodeAttributesContainer.style.position = "sticky";
          WUXModalContainer.createModal(parentNodeAttributesContainer/*, loader.elements.container*/);
          ParameterizationDisplayPropertiesWebServices.getListOfTypesAndAttributesForCorpusTypes(i_selectedType,that._CONSTANTS.FAMILY_ID, {
            onSuccess: function (data) {
              loader.off();
              WUXModalContainer.removeModal(parentNodeTypesContainer);
              WUXModalContainer.removeModal(parentNodeAttributesContainer);

              parentNodeTypesContainer.style.position = "";
              if(that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][i_selectedType] == undefined)
                that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][i_selectedType] ={};
              
              that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][i_selectedType][that._CONSTANTS.TYPES_RESULT.SUBTYPES] = data[i_selectedType];
              that. fillTypesComboList(i_selectedType);
              that.fillAttributesComboList(i_selectedType);
            },
            onFailure: function (err) {
              loader.off();
              WUXModalContainer.removeModal(parentNodeTypesContainer);
              WUXModalContainer.removeModal(parentNodeAttributesContainer);
              parentNodeTypesContainer.style.position = "";
              parentNodeAttributesContainer.style.position = "";
              that.displayAlertMessage(Nls.getTypesError, "error");
            }
          });          
        }
      },


      fillTypesComboList : function fillTypesComboList(i_corpusType){
        var that = this;
        var comboTypes = document.getElementById(that._CONSTANTS.COLUMNIDS.TYPE);
        if (that._corpusTypesResult != null || that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES] != undefined) {
          var listForCombo = [];
          var listAlreadyDefinedTypes = that.getTypesAlreayDefinedForCorpusType(i_corpusType);
          var typesKeys = Object.keys(that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][i_corpusType][that._CONSTANTS.TYPES_RESULT.SUBTYPES])
          var typesKeysLength = typesKeys.length;
          for (var idxTypeKey = 0; idxTypeKey < typesKeysLength; idxTypeKey++) {
            var typeKey = typesKeys[idxTypeKey];
            var type = that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][i_corpusType][that._CONSTANTS.TYPES_RESULT.SUBTYPES][typeKey];
            if (type && type.hasOwnProperty("IsExtension") && type.IsExtension === "false") {
              var comboLabel = type.NLSName;
              var comboValue = type.Name;
              if (!that._bEditMode && !listAlreadyDefinedTypes.includes(comboValue)) {
                listForCombo.push({ label: comboLabel, value: comboValue });
              }
              else if (that._bEditMode)
                listForCombo.push({ label: comboLabel, value: comboValue });
            }
          }

          var comboElementsListLength = listForCombo.length;
          if (comboElementsListLength > 0) {
            if (listForCombo.length) {
              listForCombo.sort(function (comboValue1, comboValue2) {
                if (comboValue1.label.toLowerCase() === comboValue2.label.toLowerCase())
                  return 0;
                return comboValue1.label.toLowerCase() > comboValue2.label.toLowerCase() ? 1 : -1;
              });
            }
            if (!that._bEditMode)
              comboTypes.dsModel.disabled = false;
            comboTypes.dsModel.elementsList = listForCombo;
            comboTypes.dsModel.selectedIndex = -1;
            comboTypes.dsModel.autocompleteFlag = false;
          }
        }
      },

      
      /*
      *
      */
      fillAttributesComboList: function fillAttributesComboList(i_selectedType) {
        var that = this;
        var comboAttribute = document.getElementById(that._CONSTANTS.COLUMNIDS.ATTRIBUTE);
        var listForCombo = [];
        var listAlreadyDefinedAttributes = that.getAttributesAlreayDefinedForType(i_selectedType);
        var typesKeys = Object.keys(that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][i_selectedType][that._CONSTANTS.TYPES_RESULT.SUBTYPES])
        var typesKeysLength = typesKeys.length;
        for (var idxTypeKey = 0; idxTypeKey < typesKeysLength; idxTypeKey++) {
          var typeKey = typesKeys[idxTypeKey];
          var type = that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][i_selectedType][that._CONSTANTS.TYPES_RESULT.SUBTYPES][typeKey];
          var typeAttributes = type[that._CONSTANTS.TYPES_RESULT.ATTRIBUTES];
          var typeAttributesKeys = Object.keys(typeAttributes);
          var typeAttributesKeysLength = typeAttributesKeys.length;
          for (var idxAttributeKey = 0; idxAttributeKey < typeAttributesKeysLength; idxAttributeKey++) {
            var typeAttributeKey = typeAttributesKeys[idxAttributeKey];
            var attrObj = typeAttributes[typeAttributeKey];

            if (attrObj) {
              var comboLabel = attrObj.NLSName + " (" + attrObj.ownerName + "." + attrObj.Name + ")";
              var comboValue = attrObj.ownerName + "." + attrObj.Name;
              if (!that._bEditMode && !listAlreadyDefinedAttributes.includes(comboValue)) {
                listForCombo.push({ label: comboLabel, value: comboValue });
              }
              else if (that._bEditMode)
                listForCombo.push({ label: comboLabel, value: comboValue });
            }
          }
        }
        var comboElementsListLength = listForCombo.length;
        if (comboElementsListLength > 0) {
          if (listForCombo.length) {
            listForCombo.sort(function (comboValue1, comboValue2) {
              if (comboValue1.label.toLowerCase() === comboValue2.label.toLowerCase())
                return 0;
              return comboValue1.label.toLowerCase() > comboValue2.label.toLowerCase() ? 1 : -1;
            });
          }
          if (!that._bEditMode)
            comboAttribute.dsModel.disabled = false;

          comboAttribute.dsModel.elementsList = listForCombo;
          comboAttribute.dsModel.selectedIndex = -1;
          comboAttribute.dsModel.autocompleteFlag = false;
        }
      },

      /*
      * getAttributesAlreayDefinedForType
      */
      getAttributesAlreayDefinedForType: function getAttributesAlreayDefinedForType(type) {
        var that = this;
        var attributes = [];
        var colId = that.treeListView.layout.getColumnIndex(that._CONSTANTS.COLUMNIDS.TYPE);
        var numberofRows = that.treeListView.getRowModelLength();
        for (var rowIndex = 0; rowIndex < numberofRows; rowIndex++) {
          var cellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: rowIndex, columnID: colId })
          var cellInfos = that.treeListView.getCellInfosAt(cellId);
          if (cellInfos && cellInfos.nodeModel.options.data[that._CONSTANTS.COLUMNIDS.TYPE] === type) {
            var rowData = that.getRowDataFromTreeView(rowIndex);
            attributes.push(rowData[that._CONSTANTS.COLUMNIDS.ATTRIBUTE]);
          }
        }
        return attributes;
      },

      /*
      * getTypesAlreayDefinedForCorpusType
      */
      getTypesAlreayDefinedForCorpusType: function getTypesAlreayDefinedForCorpusType(corpusType) {
        var that = this;
        var types = [];
        var colId = that.treeListView.layout.getColumnIndex(that._CONSTANTS.COLUMNIDS.CORPUS_TYPE);
        var numberofRows = that.treeListView.getRowModelLength();
        for (var rowIndex = 0; rowIndex < numberofRows; rowIndex++) {
          var cellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: rowIndex, columnID: colId })
          var cellInfos = that.treeListView.getCellInfosAt(cellId);
          if (cellInfos && cellInfos.nodeModel.options.data[that._CONSTANTS.COLUMNIDS.CORPUS_TYPE] === corpusType) {
            var rowData = that.getRowDataFromTreeView(rowIndex);
            types.push(rowData[that._CONSTANTS.COLUMNIDS.TYPE]);
          }
        }
        return types;
      },

      /*
      * addChild
      */
      addChild : function addChild(nodesTab)
      {
        var that = this;
        that._parent(nodesTab);
        that.treeListView.reapplySortModel();
      },

      /*
      * createtreeNode
      */
      createtreeNode: function createtreeNode(data, grid) {
        var that = this;
        var translationModel = new DPConfigurationParamTranslationModel({
          data: data,
          grid: grid,
          nls: Nls
        });
        // We only store internal names for type, attribute name and display unit name in DB, to display we need to fetch  NLS name and set it on the grid of DataGrid model.
        if (grid == undefined) {
          var gridTemp = translationModel.getGrid();
          if (that._nlsResult != null && that._nlsResult != undefined && gridTemp != undefined &&
            gridTemp.hasOwnProperty(that._CONSTANTS.COLUMNIDS.TYPE) && gridTemp.hasOwnProperty(that._CONSTANTS.COLUMNIDS.ATTRIBUTE)) {
            gridTemp[that._CONSTANTS.COLUMNIDS.TYPE] = that._nlsResult[data[that._CONSTANTS.COLUMNIDS.TYPE]];
            if (data[that._CONSTANTS.COLUMNIDS.ATTRIBUTE].length > 0) {
              var attributekey = data[that._CONSTANTS.COLUMNIDS.ATTRIBUTE]
              if(!data[that._CONSTANTS.COLUMNIDS.ATTRIBUTE].includes("."))
                attributekey = data[that._CONSTANTS.COLUMNIDS.TYPE] + "." + data[that._CONSTANTS.COLUMNIDS.ATTRIBUTE];
              gridTemp[that._CONSTANTS.COLUMNIDS.ATTRIBUTE] = that._nlsResult[attributekey] +  " ("+attributekey+")";
            }
          }
        }
        return translationModel;
      },

      /*
      * compareNodeData
      */
      compareNodeData: function compareNodeData(newNode, existingNode) {
        var that = this;
        var breturn = true;
        if (newNode != null && newNode != undefined && existingNode != null && existingNode != undefined) {
          var newData = newNode.getData();
          var existingData = existingNode.getData();
          var newObjectkeys = Object.keys(newData);
          for (var idxkey = 0; idxkey < newObjectkeys.length; idxkey++) {
            if (newData[newObjectkeys[idxkey]] !== existingData[newObjectkeys[idxkey]]) {
              breturn = false;
              break;
            }
          }
        }
        return breturn;
      },



      /*
      * getMatchingNodeIfExists()
      */
     getMatchingNodeIfExists: function getMatchingNodeIfExists(nodeModel) {
       var that = this;
       var node = null;
       var colId = that.treeListView.layout.getColumnIndex(that._CONSTANTS.COLUMNIDS.TYPE);
       var numberofRows = that.treeListView.getRowModelLength();
       for (var rowIndex = 0; rowIndex < numberofRows; rowIndex++) {
         var cellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: rowIndex, columnID: colId })
         var cellInfos = that.treeListView.getCellInfosAt(cellId);
         if (cellInfos && cellInfos.nodeModel.options.data[that._CONSTANTS.COLUMNIDS.TYPE] === nodeModel.options.data[that._CONSTANTS.COLUMNIDS.TYPE]) {
           var rowData = that.getRowDataFromTreeView(rowIndex);
           if(rowData.hasOwnProperty(that._CONSTANTS.COLUMNIDS.ATTRIBUTE) && (rowData[that._CONSTANTS.COLUMNIDS.ATTRIBUTE] === nodeModel.options.data[that._CONSTANTS.COLUMNIDS.ATTRIBUTE] ||
            (rowData[that._CONSTANTS.COLUMNIDS.ATTRIBUTE] ==="" && !nodeModel.options.data.hasOwnProperty(that._CONSTANTS.COLUMNIDS.ATTRIBUTE)))){
              node = cellInfos.nodeModel;
            break;
           }
         }
       }
       return node;
     },

      /*
      * onOKEditButtonClick
      */
      onOKEditButtonClick: function onOKEditButtonClick() {
        var that = this;
        that._bEditMode = true;
        that._parent();
        that._bEditMode = false;
      },

      /*
      * onCancelButtonClick
      */
      onCancelButtonClick: function onCancelButtonClick() {
        var that = this;
        that._parent();
        that._bEditMode = false;
      },

      /*
      * editSelectedNode
      */
      editSelectedNode: function editSelectedNode(params) {
        console.log("params " + params);
        var that = this;
        that._bEditMode = true;
        that._parent(params);
      },

    });
    return DPNLSValuesTableView;
  });

/**
* @quickreview  ROW 25:02:11 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDisplayProperties/ParamDPNlsValuesView',
  [
    'UWA/Core',
    'UWA/Class/View',
    'DS/UIKIT/Mask',
    'DS/UIKIT/Alert',
    'DS/ParameterizationSkeleton/Views/ParametersLayoutView',
    'DS/ParameterizationSkeleton/Views/ParameterizationDisplayProperties/DPNLSValuesTableView',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDisplayProperties/ParameterizationDisplayPropertiesWebServices',
    'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DisplayPropertiesNLS',
    'css!DS/ParameterizationSkeleton/ParameterizationSkeleton'
  ],
  function (
    UWA,
    View,
    Mask,
    Alert,
    ParametersLayoutView,
    DPNLSValuesTableView,
    ParameterizationDisplayPropertiesWebServices,
    ParametersLayoutViewUtilities,
    DisplayPropertiesNLS,
  ) {

    'use strict';

    var ParamDPNlsValuesView = View.extend({

      /*
      * init
      */
      init: function init(options) {
        this._parent(options);

        this._domainID = options.domainid;
        this._familyID = "NLSValuesTypesAndAttributes";
        this._parameterID = "NLSValuesTypesAndAttriutesParam";
        
        this._mapFamily = new Map();

        this._columnsDefinition = [];
        this._columnsDefinition.push({type:"combobox", id:"corpusType", value:"",disabled:"false",onChange:"onChangeCorpusTypeCombo",mandatory:"true"});
        this._columnsDefinition.push({type:"combobox", id:"type", value:"",disabled:"false",onChange:"onChangetypeCombo",mandatory:"false",sortable:"false"});
        this._columnsDefinition.push({type:"combobox", id:"attribute", value:"",disabled:"false",onChange:"onChangeAttributeCombo",mandatory:"false",sortable:"false"});
        this._columnsDefinition.push({type:"textarea", id:"NLS_en", value:"",hidden:"false"});
        this._columnsDefinition.push({type:"textarea", id:"NLS_fr", value:"",hidden:"false"});
        this._columnsDefinition.push({type:"textarea", id:"NLS_de", value:"",hidden:"true"});
        this._columnsDefinition.push({type:"textarea", id:"NLS_es", value:"",hidden:"true"});
        this._columnsDefinition.push({type:"textarea", id:"NLS_cs", value:"",hidden:"true"});
        this._columnsDefinition.push({type:"textarea", id:"NLS_it", value:"",hidden:"true"});
        this._columnsDefinition.push({type:"textarea", id:"NLS_ja", value:"",hidden:"true"});
        this._columnsDefinition.push({type:"textarea", id:"NLS_ko", value:"",hidden:"true"});
        this._columnsDefinition.push({type:"textarea", id:"NLS_pl", value:"",hidden:"true"});
        this._columnsDefinition.push({type:"textarea", id:"NLS_pt-BR", value:"",hidden:"true"});
        this._columnsDefinition.push({type:"textarea", id:"NLS_ru", value:"",hidden:"true"});
        this._columnsDefinition.push({type:"textarea", id:"NLS_zh", value:"",hidden:"true"});
        this._columnsDefinition.push({type:"textarea", id:"NLS_zh-TW", value:"",hidden:"true"});
        this._columnsDefinition.push({type:"textarea", id:"NLS_tr", value:"",hidden:"true"});
      },

      /*
      * destroy
      */
      destroy: function destroy() {
        var that = this;
        that._parent();

        
        if (that._familyView)
          that._familyView.destroy();
        return that;
      },

      /*
      * render
      */
      render: function render() {
        UWA.log('Display Units LayoutView::render');
        let introDiv;
        let mappingDiv;
        const that = this;

        this.contentDiv = UWA.createElement('div', {
          id: 'typeMainDiv',
        });

        introDiv = UWA.createElement('div', {
          class: 'information',
        }).inject(this.contentDiv);

        UWA.createElement('p', {
          text: DisplayPropertiesNLS.introNLSValues,
          class: 'font-3dslight',
        }).inject(introDiv);
        this.parentView = new ParametersLayoutView(this.options);

        this.controlDiv = ParametersLayoutViewUtilities.createApplyResetToolbar.call(this, this.contentDiv, true,
          this.applyParams.bind(this), this.resetParams.bind(this));

        this.container.setContent(this.contentDiv);



        this.listenTo(this.collection, {
          onSync: that.onCompleteRequestMapping,
        });

        return this;
      },

      /*
      * onCompleteRequestMapping
      */
      onCompleteRequestMapping() {
        const that = this;
        UWA.log('Display Units Layout::Complete rendering!');

        const collection = this.collection._models[0]._attributes;

        Mask.mask(that.contentDiv);


        that.tableDiv = ParametersLayoutViewUtilities.createParamsContainerDiv();;
        var options = {};
        options.columnsinfo = that._columnsDefinition;
        options.domainid = that._domainID;
        options.familyid = "NLSValuesTypesAndAttriutes";

        options.treeListViewNls = DisplayPropertiesNLS;
        options.modalViewNls = DisplayPropertiesNLS;
        options.nodeTreeViewNls = DisplayPropertiesNLS;

        that._familyView = new DPNLSValuesTableView(options);
        //UWA.Promise.all(that._familyView.getPromisetoFetchInfofromDB()).then(function () {
        UWA.Promise.all(that._familyView.getPromisetoFetchNLSValues(collection.ParametersList)).then(function () {  
          var familyViewContent = that._familyView.buildFamilyContent();

          that._familyView.populateTreeViewWithSavedParameters(collection.ParametersList);

          familyViewContent.inject(that.tableDiv);
          that.tableDiv.inject(that.contentDiv);
          Mask.unmask(that.contentDiv);
        }).catch(e => {
          console.log(e);
        });

      },

      /*
      * resetParams
      */
      resetParams() {
        const that = this;
        Mask.mask(this.contentDiv);

        ParameterizationDisplayPropertiesWebServices.resetParameters( that._parameterID,{
          onSuccess : function(json){
            that.onResetSuccess(json);
            Mask.unmask(that.contentDiv);
            that.getAlertMessage(DisplayPropertiesNLS.ResetSuccess, 'success', that.contentDiv);
          },
          onFailure : function (json){
            Mask.unmask(that.contentDiv);
            that.onApplyFailure(DisplayPropertiesNLS.ApplyError);
          }
        });
      },

      /*
      * onResetSuccess
      */
      onResetSuccess(json) {
        const savedInfo = json.ParametersList;
        const that = this;
        that._familyView.resetTreeviewEntries(savedInfo);
      },

      /*
      * onResetFailure
      */
      onResetFailure(message) {
        this.getAlertMessage(message, 'error', this.contentDiv);
      },

      /*
      * applyParams
      */
      applyParams() {
        const that = this;

        var dataObjects = [];
        var numberofRows =   that._familyView.treeListView.getRowModelLength();
        for (var rowIndex = 0; rowIndex < numberofRows; rowIndex++) {
            var rowData = that._familyView.getRowDataFromTreeView(rowIndex);
            if(rowData && (rowData["deploystatus"] ==="deployed" || rowData["deploystatus"] ==="notDeployed")){
              rowData["domainID"] = "DisplayProperties";
              rowData["parameterID"] = "NLSValuesTypesAndAttriutesParam";
              dataObjects.push(rowData);
            }
        }
        
        const payloadToSend = {};
        Mask.mask(this.contentDiv);
        payloadToSend.ParametersList = dataObjects;
        payloadToSend.domainID = that._domainID;
        payloadToSend.familyID = that._familyID;
        payloadToSend.parameterID = that._parameterID;

        ParameterizationDisplayPropertiesWebServices.applyParameters(payloadToSend, {
          onSuccess : function(json){
            if (json.Action == 'Success') {
              that.onApplySuccess();
              Mask.unmask(that.contentDiv);
              that.getAlertMessage(DisplayPropertiesNLS.ApplySuccess, 'success', that.contentDiv);
            } else {
              Mask.unmask(that.contentDiv);
              that.onApplyFailure(json.message);
            }

          },
          onFailure : function (json){
            Mask.unmask(that.contentDiv);
            that.onApplyFailure(DisplayPropertiesNLS.ApplyError);
          }
        });
      },

      /*
      * onApplyFailure
      */
      onApplyFailure(message) {
        this.getAlertMessage(message, 'error', this.contentDiv);
      },

      /*
      * onApplySuccess
      */
      onApplySuccess() {
        var that = this;

        that._familyView.updateTreeViewOnApplySuccess();
        
      },

      /*
      * getAlertMessage
      */
      getAlertMessage(message, className, toDisplayOn) {
        this.alertOptions = {
            visible: true,
            className: 'param-alert',
            messageClassName: className,
            closable: true,
            renderTo: toDisplayOn,
            autoHide: true,
            hideDelay: 2000,
        };

        const alert = new Alert(this.alertOptions);
        alert.add({
            message,
        });
    }
    });

    return ParamDPNlsValuesView;
  });

/**
* @quickreview  ROW 24:01:05 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDEL3DWorkbook/DEL3DWorkbookConfigFamilyView',
  [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationFamilyView',
    'DS/ParameterizationSkeleton/Utils/DELConfigurationParameterization/DELConfigurationParameterizationWebServices',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDEL3DWorkbook/ParameterizationDEL3DWorkbookWebServices',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDEL3DWorkbook/ParameterizationDEL3DWorkbookAttributeUtils',
    'DS/Controls/ModalContainer',
    'DS/Controls/Loader',
    'DS/UIKIT/Mask',
    'DS/ParameterizationSkeleton/Model/DELConfigurationParameterizationModel/DELConfigurationParamTranslationModel',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DEL3DWorkbookConfiguration',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DELConfigurationLayoutView'
  ],
  function (
    UWA,
    DELConfigurationFamilyView,
    DELConfigurationParameterizationWebServices,
    ParameterizationDEL3DWorkbookWebServices,
    ParameterizationDEL3DWorkbookAttributeUtils,
    WUXModalContainer,
    WUXLoader,
    Mask,
    DELConfigurationParamTranslationModel,
    Nls,
    layoutViewNls
  ) {

    'use strict';
    var _CONSTANTS = {

      // Column Ids 
      COLUMNIDS: {
        TYPES: 'types',
        ATTRIBUTE: 'attribute',
        ATTRLABEL: 'attrLabel',
        NEWROW: 'newRow',
        ROWINDEX: 'rowIndex' // rowIndex is used internally to manage the order. This is not visile in the UI.
      }
    };

    var DEL3DWorkbookConfigFamilyView = DELConfigurationFamilyView.extend({

      _typeResult: null,
      _node: null,

      /*
      * init
      */
      init: function init(options) {
        var that = this;
        this._parent(options);

        that._treeListViewNls = Nls;
        that._modalViewNls = Nls;
        that._nodeTreeViewNls = Nls;
      },

      /*
      * render
      */
      render: function render() {
        var that = this;
        this._parent();

        return this;
      },

      /*
       * buildFamilyContent
       */
      buildFamilyContent: function buildFamilyContent() {
        var that = this;
        var contentView = that._parent();

        var typesColOpt = that.treeListView.getColumnOrGroup(_CONSTANTS.COLUMNIDS.TYPES);
        typesColOpt.compareFunction = function (value1, value2, treeNodeModel1, treeNodeModel2, dataIndex) {
          return (((value1.toLowerCase()).localeCompare(value2.toLowerCase())) || (parseInt(treeNodeModel1.options.data[_CONSTANTS.COLUMNIDS.ROWINDEX]) - parseInt(treeNodeModel2.options.data[_CONSTANTS.COLUMNIDS.ROWINDEX])));
        }
        return contentView;
      },

      /*
       * buildtreeListView
       */
      buildtreeListView: function buildtreeListView() {
        var that = this;
        that._parent();
        that.treeListView.rowDragEnabledFlag = true;
        that.treeListView.cellDragEnabledFlag = true;
        that.treeListView.rowReorderEnabledFlag = true;
        that.treeListView.cellSelection = 'single';
        that.treeListView.rowSelection = 'single';
        that.treeListView.showSelectionCheckBoxesFlag = false;

        that.treeListView.onDropRowHeader = that._onDrop.bind(that);
        that.treeListView.onDropCell = that._onDrop.bind(that);
        that.treeListView.onDragOverCell = that._onDrag.bind(that);
        that.treeListView.onDragEnterCell = that._onDrag.bind(that);
        that.treeListView.onDragLeaveCell = that._onDrag.bind(that);
        that.treeListView.onDragOverRowHeader = that._onDrag.bind(that);
        that.treeListView.onDragEnterRowHeader = that._onDrag.bind(that);
        that.treeListView.onDragLeaveRowHeader = that._onDrag.bind(that);
      },

      /*
       * _onDrag
       */
      _onDrag: function _onDrag(event, cellInfos) {
        var that = this;
        console.log("onDragRow/Cell");
        // Allow DnD only between the rows of same type.
        if (cellInfos != undefined && cellInfos.nodeModel != undefined && cellInfos.nodeModel.getData() != undefined && cellInfos.nodeModel.getData()[_CONSTANTS.COLUMNIDS.TYPES] &&
          cellInfos.draggedNodes[0] != undefined && cellInfos.draggedNodes[0].getData() != undefined && cellInfos.draggedNodes[0].getData()[_CONSTANTS.COLUMNIDS.TYPES] != undefined &&
          cellInfos.nodeModel.getData()[_CONSTANTS.COLUMNIDS.TYPES] == cellInfos.draggedNodes[0].getData()[_CONSTANTS.COLUMNIDS.TYPES]) {

          return true;
        }
      },

      /*
       * _onDrop
       */
      _onDrop: function _onDrop(event, cellInfos) {
        var that = this;
        console.log("onDropRow/Cell");
        if (cellInfos != undefined && cellInfos.nodeModel != undefined && cellInfos.nodeModel.getData() != undefined && cellInfos.nodeModel.getData()[_CONSTANTS.COLUMNIDS.TYPES] &&
          cellInfos.droppedNodes[0] != undefined && cellInfos.droppedNodes[0].getData() != undefined && cellInfos.droppedNodes[0].getData()[_CONSTANTS.COLUMNIDS.TYPES] != undefined &&
          cellInfos.nodeModel.getData()[_CONSTANTS.COLUMNIDS.TYPES] == cellInfos.droppedNodes[0].getData()[_CONSTANTS.COLUMNIDS.TYPES]) {
            
            var type = cellInfos.nodeModel.getData()[_CONSTANTS.COLUMNIDS.TYPES];

            var rowsDataBeforeReorder =  that.getRowsDataForType(type);
            that.treeListView.onDropCellDefault.call(that.treeListView, event, cellInfos);
            var rowsDataAfterReorder =  that.getRowsDataForType(type);

            if(that.IsTableModifiedForType(type)){
              that._UpdateParameters(type,rowsDataBeforeReorder,rowsDataAfterReorder);
            }
        }
      },

      /*
       * _UpdateParameters
       */
      _UpdateParameters: function _UpdateParameters(type, rowsDataBeforeReorder,rowsDataAfterReorder, bUpdateForDelete){
        var that = this;
        // Delete Existing Parameters of this type
        var promisesDeleteParams = that._getDeleteParameterPromises(rowsDataBeforeReorder);
        Mask.mask(that.treeListView.elements.body,Nls.orderParametersMaskMessage);
        UWA.Promise.all(promisesDeleteParams).then(function (dataDeleteParams) {
          // Create Parameters for new order of this type
          var promisesSetParams = that._getSetParamsPromises(rowsDataAfterReorder);
          UWA.Promise.all(promisesSetParams).then(function (dataSetParams) {
            // Check for new parameters deployment and update the tree
            var promisesIsDeployed = that._getIsDeployedPromises(rowsDataAfterReorder);
            UWA.Promise.all(promisesIsDeployed).then(function (resultIsDeployed) {
              var listOfnodeTree = [];
              var lengthIsDeployed = resultIsDeployed.length;
              if (rowsDataAfterReorder.length === lengthIsDeployed) {
                for (var idxDeployed = 0; idxDeployed < lengthIsDeployed; idxDeployed++) {
                  var treeNode = that.createtreeNode(resultIsDeployed[idxDeployed].treeNodeData);
                  if (treeNode) {
                    treeNode.addGridAttributes({ isDeployed: resultIsDeployed[idxDeployed].isDeployed });
                    listOfnodeTree.push(treeNode);
                  }
                }
                that.removeNodesOfType(type);
                that.addChild(listOfnodeTree);
              }

              that.displayNotifications({
                level: 'info',
                message: Nls.orderParameters,
                title: Nls.orderParametersTitle
              });
              Mask.unmask(that.treeListView.elements.body);
            }).catch(function (rejectMessages) {
              that.displayNotifications({
                level: 'error',
                message: Nls.orderParametersError,
                title: Nls.orderParametersTitle
              });
              console.error(rejectMessages);
              Mask.unmask(that.treeListView.elements.body);
            });

          }).catch(function (errorMessage) {

            that.displayNotifications({
              level: 'error',
              message: Nls.orderParametersSetError,
              title: Nls.orderParametersTitle
            });
            console.error(errorMessage);
            Mask.unmask(that.treeListView.elements.body);
          });

          if (bUpdateForDelete) {
            that.displayNotifications({
              level: 'info',
              message: layoutViewNls.deleteParameter,
              title: layoutViewNls.deleteParameterTitle
            });
          }

        }).catch(function(errorMessage){
          that.displayNotifications({
            level: 'error',
            message: Nls.orderParametersDeleteError,
            title: Nls.orderParametersTitle
          });
          console.error(errorMessage);
          Mask.unmask(that.treeListView.elements.body);
        });

      },
      
      /*
       * _getDeleteParameterPromises
       */
      _getDeleteParameterPromises: function _getDeleteParameterPromises(dataObjectsToDelete) {
        var that = this;
        var promisesDeleteParams = [];
        for (var idxRow = 0; idxRow < dataObjectsToDelete.length; idxRow++) {
          var rowNumber = idxRow + 1;
          dataObjectsToDelete[idxRow][_CONSTANTS.COLUMNIDS.ROWINDEX] = rowNumber.toString();
          var promiseDeleteParams = new Promise(function (resolve, reject) {
            var dataObject = dataObjectsToDelete[idxRow];
            DELConfigurationParameterizationWebServices.deleteParameter(that._domainID, that._familyID, that._paramID, that._argID, dataObject, {
              onSuccess: function (data) {
                resolve(dataObject);
              },
              onFailure: function (error) {
                reject("DELConfigurationParameterizationWebServices.deleteParameter");
                console.error("DELConfigurationParameterizationWebServices.deleteParameter");
              }
            });
          });
          promisesDeleteParams.push(promiseDeleteParams);
        }
        return promisesDeleteParams;
      },

      /*
       * _getSetParamsPromises
       */
      _getSetParamsPromises:function _getSetParamsPromises(dataObjectsToSetParams){
        var that = this
        var promisesSetParams = [];
        for (var idxRow = 0; idxRow < dataObjectsToSetParams.length; idxRow++) {
          var rowNumber = idxRow + 1;
          dataObjectsToSetParams[idxRow][_CONSTANTS.COLUMNIDS.ROWINDEX] = rowNumber.toString();
          var promiseSetParams = new Promise(function (resolve, reject) {
            var dataObject = dataObjectsToSetParams[idxRow];
            DELConfigurationParameterizationWebServices.setParameters(that._domainID, that._familyID, that._paramID, that._argID, dataObject, {
              onSuccess: function (data) {
                resolve(dataObject);
              },
              onFailure: function (error) {
                reject("DELConfigurationParameterizationWebServices.setParameters");
                console.error("DELConfigurationParameterizationWebServices.setParameters");
              }
            });
          });
          promisesSetParams.push(promiseSetParams);
        }
        return promisesSetParams;
      },

      /*
       * _getIsDeployedPromises
       */
      _getIsDeployedPromises:function _getIsDeployedPromises(dataObjectsToCheckIsDeployed){
        var that = this;
        var promisesIsDeployed = [];
        for (var idxRow = 0; idxRow < dataObjectsToCheckIsDeployed.length; idxRow++) {
          var rowNumber = idxRow + 1;
          dataObjectsToCheckIsDeployed[idxRow][_CONSTANTS.COLUMNIDS.ROWINDEX] = rowNumber.toString();
          var promiseIsDeployed = new Promise(function (resolve, reject) {
            var dataObject = dataObjectsToCheckIsDeployed[idxRow];
            if (dataObject) {
              DELConfigurationParameterizationWebServices.isDeployed(that._domainID, that._familyID, that._paramID, that._argID, dataObject, {
                onSuccess: function (data) {
                  resolve({ treeNodeData: dataObject, isDeployed: data });
                },
                onFailure: function (error) {
                  reject("DELConfigurationParameterizationWebServices.isDeployed");
                  console.error("DELConfigurationParameterizationWebServices.isDeployed");
                }
              });
            }
          });
          promisesIsDeployed.push(promiseIsDeployed);
        }
        return promisesIsDeployed;
      },

      /*
       * getRowsDataForType
       */
      getRowsDataForType : function getRowsDataForType(type){
        var that = this;
        var dataObjects = [];
        var colId = that.treeListView.layout.getColumnIndex(_CONSTANTS.COLUMNIDS.TYPES);
        var numberofRows =   that.treeListView.getRowModelLength();
        for (var rowIndex = 0; rowIndex < numberofRows; rowIndex++) {
          var cellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: rowIndex, columnID: colId })
          var cellInfos = that.treeListView.getCellInfosAt(cellId);
          if (cellInfos && cellInfos.nodeModel.options.data[_CONSTANTS.COLUMNIDS.TYPES] === type) {
            var rowData = that.getRowDataFromTreeView(rowIndex);
            dataObjects.push(rowData);
          }
        }
        return dataObjects;
      },

      /*
       * removeNodesOfType
       */
      removeNodesOfType : function removeNodesOfType(type){
        var that = this;
        var nodesToRemove = [];
        var colId = that.treeListView.layout.getColumnIndex(_CONSTANTS.COLUMNIDS.TYPES);
        var numberofRows =   that.treeListView.getRowModelLength();
        for (var rowIndex = 0; rowIndex < numberofRows; rowIndex++) {
          var cellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: rowIndex, columnID: colId })
          var cellInfos = that.treeListView.getCellInfosAt(cellId);
          if (cellInfos && cellInfos.nodeModel.options.data[_CONSTANTS.COLUMNIDS.TYPES] === type) {
            nodesToRemove.push(cellInfos.nodeModel);
          }
        }
        nodesToRemove.forEach(node=>{
          var treeDoc = that.treeListView.treeDocument;
          if(treeDoc != undefined)
          treeDoc.removeRoot(node);
        });
      },

      IsTableModifiedForType:function IsTableModifiedForType(type){
        var that = this;
        var bTableModified = false;
        var nbRowsofThisType = 0;
        var colId = that.treeListView.layout.getColumnIndex(_CONSTANTS.COLUMNIDS.TYPES); 
        var numberofRows =   that.treeListView.getRowModelLength();
        for (var idxRow = 0; idxRow < numberofRows; idxRow++) {
          var cellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: idxRow, columnID: colId })
          var cellInfos = that.treeListView.getCellInfosAt(cellId);
          if (cellInfos && cellInfos.nodeModel.options.data[_CONSTANTS.COLUMNIDS.TYPES] === type) {
            var rowIndex = cellInfos.nodeModel.options.data[_CONSTANTS.COLUMNIDS.ROWINDEX];
            if (parseInt(rowIndex) != nbRowsofThisType + 1) {
              bTableModified = true;
              break;
            }
            nbRowsofThisType = nbRowsofThisType+1;
          }
        }
        return bTableModified;
      },

      /* 
      * buildModal
      */
      buildModal: function buildModal(bEditMod) {
        this._parent(bEditMod);

        var comboAttributeKeys = document.getElementById(_CONSTANTS.COLUMNIDS.ATTRIBUTE);
        comboAttributeKeys.dsModel.disabled = true;
        comboAttributeKeys.dsModel.elementsList = [];
        comboAttributeKeys.dsModel.selectedIndex = -1;
        var strAttributeLabel = document.getElementById(_CONSTANTS.COLUMNIDS.ATTRLABEL);
        strAttributeLabel.dsModel.disabled = true;
      },

      /*
      * presetModal
      */
      presetModal: function presetModal(node) {
        console.log("presetModal");
        var that = this;

        var nodeType = node.getData();
        var types = null;
        types = ((nodeType.types).split("_"))[0];
        var promise = new UWA.Promise(function (resolve, reject) {
          if (that._typeResult == null || that._typeResult == undefined || that._typeResult[types] === undefined || that._typeResult[types] === null) {
            if (that._typeResult == null || that._typeResult == undefined)
              that._typeResult = [];

            var listOfTypes = [];

            listOfTypes.push(types);

            //loader
            var loader = new WUXLoader({ height: 22 });
            loader.on(Nls.Loading);

            var comboAttributeTypes = document.getElementById(_CONSTANTS.COLUMNIDS.TYPES);
            var comboAttributeKeys = document.getElementById(_CONSTANTS.COLUMNIDS.ATTRIBUTE);
            var strAttributeLabel = document.getElementById(_CONSTANTS.COLUMNIDS.ATTRLABEL);

            //loader
            var loader = new WUXLoader({ height: 22 });
            loader.on(Nls.Loading);

            var parentNodeTypeContainer = comboAttributeTypes.getParent();
            parentNodeTypeContainer.style.position = "sticky";
            WUXModalContainer.createModal(parentNodeTypeContainer/*, loader.elements.container*/);

            var parentNodeKeysContainer = comboAttributeKeys.getParent();
            parentNodeKeysContainer.style.position = "sticky";
            WUXModalContainer.createModal(parentNodeKeysContainer, loader.elements.container);

            var parentNodeAttrContainer = strAttributeLabel.getParent();
            parentNodeAttrContainer.style.position = "sticky";
            WUXModalContainer.createModal(parentNodeAttrContainer/*, loader.elements.container*/);

            ParameterizationDEL3DWorkbookWebServices.getlistofDELMIATypes(listOfTypes, {
              onSuccess: function (data) {
                var defaultAttributes = ParameterizationDEL3DWorkbookAttributeUtils.getDefaultAttributes(types);
                if (typeof defaultAttributes !== 'undefined' && defaultAttributes.hasOwnProperty(types))
                  data[types] = defaultAttributes[types];
                that._typeResult[types] = data;

                loader.off();

                WUXModalContainer.removeModal(parentNodeTypeContainer);
                WUXModalContainer.removeModal(parentNodeKeysContainer);
                WUXModalContainer.removeModal(parentNodeAttrContainer);

                parentNodeTypeContainer.style.position = "";
                parentNodeKeysContainer.style.position = "";
                parentNodeAttrContainer.style.position = "";
                resolve();
              }
            });
          }
          else
            resolve();
        });

        UWA.Promise.all([promise]).then(function () {
          that._updateAttributesListCombo(types);
          DELConfigurationFamilyView.prototype.presetModal.call(that, node);
        });
      },


      /*
      * _updateAttributesListCombo
      */
      _updateAttributesListCombo: function _updateAttributesListCombo(types) {
        var that = this;

        var keysList = [];
        var attributesList = [];
        var keys = Object.keys(that._typeResult[types]);
        var keysLength = keys.length;
        for (var i = keysLength; i >= 0; i--) {
          var key = keys[i];
          if (key) {
            var attributesLength = that._typeResult[types][key].attributes.length;
            for (var idxAttr = 0; idxAttr < attributesLength; idxAttr++) {
              var attr = that._typeResult[types][key].attributes[idxAttr];
              if (key != types)
                attr = key + "." + that._typeResult[types][key].attributes[idxAttr];
              if (!attributesList.includes(attr)) {
                attributesList.push(attr);
                keysList.push({ label: attr, value: attr });
              }
            }

          }
        }

        var keysListLength = keysList.length;
        if (keysListLength > 0) {
          var comboAttributeKeys = document.getElementById(_CONSTANTS.COLUMNIDS.ATTRIBUTE);
          comboAttributeKeys.dsModel.disabled = false;
          comboAttributeKeys.dsModel.elementsList = keysList;
        }

        var strAttributeLabel = document.getElementById(_CONSTANTS.COLUMNIDS.ATTRLABEL);
        strAttributeLabel.dsModel.disabled = false;
      },

      /*
      * createtreeNode
      */
      createtreeNode: function createtreeNode(data, grid) {
        var that = this;

        if (data[_CONSTANTS.COLUMNIDS.TYPES] && grid != undefined && grid[_CONSTANTS.COLUMNIDS.TYPES] && data[_CONSTANTS.COLUMNIDS.ROWINDEX] == undefined && grid[_CONSTANTS.COLUMNIDS.ROWINDEX] == undefined) {
          var computedRowIndex = that._computeRowIndexForType(data[_CONSTANTS.COLUMNIDS.TYPES]);
          var rowIndex = null;
          if (that._bEditMode && that._node != undefined && that._node.getData() != undefined && that._node.getData()[_CONSTANTS.COLUMNIDS.ROWINDEX] != undefined)
            rowIndex = that._node.getData()[_CONSTANTS.COLUMNIDS.ROWINDEX];
          else
            rowIndex = computedRowIndex.toString();
          data[_CONSTANTS.COLUMNIDS.ROWINDEX] = rowIndex;
          grid[_CONSTANTS.COLUMNIDS.ROWINDEX] = rowIndex;

        }

        var translationModel = new DELConfigurationParamTranslationModel({
          data: data,
          grid: grid,
          nls: Nls
        });

        return translationModel;
      },

      /*
      * addChild
      */
      addChild: function addChild(nodesTab) {
        var that = this;

        that._parent(nodesTab);
        that.treeListView.sortModel = [{ dataIndex: _CONSTANTS.COLUMNIDS.TYPES, sort: 'asc' }];
        that.treeListView.reapplySortModel();
      },

      /*
      * _computeRowIndexForType
      */
      _computeRowIndexForType: function _computeRowIndexForType(type) {
        var that = this;

        var computedIndex = 0;
        var numberOfRowsAlreadyPresentForType = 0;
        try {
          var colId = that.treeListView.layout.getColumnIndex(_CONSTANTS.COLUMNIDS.TYPES);
          var rowModelLength = that.treeListView.getRowModelLength();
          if (rowModelLength) {
            for (var rowIndex = 0; rowIndex < rowModelLength; rowIndex++) {
              var cellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: rowIndex, columnID: colId })
              var cellInfos = that.treeListView.getCellInfosAt(cellId);
              if (cellInfos && cellInfos.nodeModel.options.data[_CONSTANTS.COLUMNIDS.TYPES] === type) {
                numberOfRowsAlreadyPresentForType = numberOfRowsAlreadyPresentForType + 1;
              }
            }
          }
        } catch (error) {
        }
        computedIndex = numberOfRowsAlreadyPresentForType + 1;
        return computedIndex;
      },

      /*
      * mapFunctions
      */
      mapFunctions: function mapFunctions(name) {
        var that = this;
        if (name === "onChangeTypeCombo")
          return that.onChangeTypeClick.bind(that);
        if (name === "onChangeAttributeCombo")
          return that.onChangeAttributeClick.bind(that);
        else return null;
      },

      /*
      * onOKEditButtonClick
      */
      onOKEditButtonClick: function onOKEditButtonClick() {
        var that = this;
        that._parent();
      },

      /*
      * onOKButtonClick
      */
      onOKButtonClick: function onOKButtonClick() {
        var that = this;
        that._parent();
      },

      /*
      * onCancelButtonClick
      */
      onCancelButtonClick: function onCancelButtonClick() {
        var that = this;
        that._parent();
      },

      /*
      * onChangeTypeClick
      */
      onChangeTypeClick: function onChangeTypeClick(type) {
        var that = this;

        var types = null;
        if (type.dsModel != null || type.dsModel != undefined)
          types = ((type.dsModel.elementsList[type.dsModel.selectedIndex].value).split("_"))[0];

        var comboAttributeKeys = document.getElementById(_CONSTANTS.COLUMNIDS.ATTRIBUTE);
        comboAttributeKeys.dsModel.disabled = true;
        comboAttributeKeys.dsModel.elementsList = [];
        comboAttributeKeys.dsModel.selectedIndex = -1;

        var strAttributeLabel = document.getElementById(_CONSTANTS.COLUMNIDS.ATTRLABEL);
        strAttributeLabel.dsModel.disabled = true;

        if (that._typeResult === null || that._typeResult[types] === undefined) {
          if (that._typeResult === null)
            that._typeResult = [];

          var listOfTypes = [];
          listOfTypes.push(types);

          //loader
          var loader = new WUXLoader({ height: 22 });
          loader.on(Nls.Loading);

          var parentNodeKeysContainer = comboAttributeKeys.getParent();
          parentNodeKeysContainer.style.position = "sticky";
          WUXModalContainer.createModal(parentNodeKeysContainer, loader.elements.container);

          var parentNodeAttrContainer = strAttributeLabel.getParent();
          parentNodeAttrContainer.style.position = "sticky";
          WUXModalContainer.createModal(parentNodeAttrContainer);

          ParameterizationDEL3DWorkbookWebServices.getlistofDELMIATypes(listOfTypes, {
            onSuccess: function (data) {
              loader.off();
              WUXModalContainer.removeModal(parentNodeKeysContainer);
              WUXModalContainer.removeModal(parentNodeAttrContainer);

              parentNodeKeysContainer.style.position = "";
              parentNodeAttrContainer.style.position = "";

              var defaultAttributes = ParameterizationDEL3DWorkbookAttributeUtils.getDefaultAttributes(types);
              if (typeof defaultAttributes !== 'undefined' && defaultAttributes.hasOwnProperty(types))
                data[types] = defaultAttributes[types];

              that._typeResult[types] = data;
              that._updateAttributesListCombo(types);
            },
            onFailure: function (err) {
              loader.off();
              WUXModalContainer.removeModal(parentNodeKeysContainer);
              WUXModalContainer.removeModal(parentNodeAttrContainer);

              parentNodeKeysContainer.style.position = "";
              parentNodeAttrContainer.style.position = "";

              that.displayNotifications({
                level: 'error',
                message: Nls.getlistofDELMIATypesError,
                title: Nls.getlistofDELMIATypesTitle
              });
            }
          });
        }
        else {
          that._updateAttributesListCombo(types);
        }
      },

      /*
      * onChangeAttributeClick
      */
      onChangeAttributeClick: function onChangeAttributeClick(data) {
        var that = this;

        var typesElt = document.getElementById("types");
        var types = ((typesElt.dsModel.elementsList[typesElt.dsModel.selectedIndex].value).split("_"))[0];

        if (that._typeResult[types] != undefined && data.dsModel.elementsList[data.dsModel.selectedIndex] != undefined) {
          var strAttributeLabel = document.getElementById(_CONSTANTS.COLUMNIDS.ATTRLABEL);
          strAttributeLabel.dsModel.disabled = false;
        }
        else {
          var comboKeys = document.getElementById(_CONSTANTS.COLUMNIDS.ATTRIBUTE);
          comboKeys.dsModel.disabled = true;
          comboKeys.dsModel.elementsList = [];
        }
      },

      /*
      * removeSelectedNode
      */
      removeSelectedNode: function removeSelectedNode(params) {
        console.log("params " + params);
        var that = this;
        var node = params.context.nodeModel;
        var nodeData = node.getData();

        var type = nodeData[_CONSTANTS.COLUMNIDS.TYPES];
        var rowDataObjectsBeforeDelete = that.getRowsDataForType(type)
        var nbRowsPresentForThisType  = rowDataObjectsBeforeDelete.length;
        if (nodeData[_CONSTANTS.COLUMNIDS.ROWINDEX] != undefined && nodeData[_CONSTANTS.COLUMNIDS.ROWINDEX] != nbRowsPresentForThisType)  {
          var treeDoc = params.configurationLayoutView.treeList.dataGridView.treeDocument;
          if (treeDoc)
            treeDoc.removeRoot(node);
            var rowDataObjectsAfterDelete = that.getRowsDataForType(type)
          var bUpdateRequiredAfterDelete = true;
          that._UpdateParameters(type,rowDataObjectsBeforeDelete,rowDataObjectsAfterDelete,bUpdateRequiredAfterDelete);
        }
        else
          that._parent(params);
      },

      /*
      * editSelectedNode
      */
      editSelectedNode: function editSelectedNode(params) {
        console.log("params " + params);
        var that = this;
        that._parent(params);
      },

      /*
      * toJSON // This method is required for reorder, since reorder needs the data to be convererted to json string
      */
      toJSON() {
        return {
          editSelectedNode: this.editSelectedNode,
          removeSelectedNode: this.removeSelectedNode,
        };
      }
    });
    return DEL3DWorkbookConfigFamilyView;
  });

/**
* @quickreview  ROW 25:02:02 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDisplayProperties/DPDisplayUnitsTableView',
  [
    'UWA/Core',
    'DS/Controls/ModalContainer',
    'DS/Controls/Loader',
    'DS/ParameterizationSkeleton/Views/ParameterizationDisplayProperties/DPConfigurationBaseTableView',
    'DS/ParameterizationSkeleton/Model/ParameterizationDisplayProperties/DPConfigurationParamTranslationModel',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDisplayProperties/ParameterizationDisplayPropertiesWebServices',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DisplayPropertiesNLS'
  ],
  function (
    UWA,
    WUXModalContainer,
    WUXLoader,
    DPConfigurationBaseTableView,
    DPConfigurationParamTranslationModel,
    ParameterizationDisplayPropertiesWebServices,
    Nls
  ) {

    'use strict';

    var DPDisplayUnitsTableView = DPConfigurationBaseTableView.extend({


      _node: null,
      _3dspaceDimensions: null,
      _bEditMode: false,
      _CONSTANTS: {

        // Column Ids 
        COLUMNIDS: {
          TYPE: 'type',
          ATTRIBUTE: 'attribute',
          ASENTERED: 'asEntered',
          DISPLAYUNIT: 'displayUnit',
        },

        TYPES_RESULT: {
          ATTRIBUTES: 'attributes',
          TYPES: 'types',
          SUBTYPES: 'subTypes',
          NLS_NAME:'NLSName',
          IsExtension : 'IsExtension',
        },
        FAMILY_ID :'DisplayUnits'
      },

      _ListOfTypes: ['DELFmiFunctionReference','DELLmiPPROperationReference'],

      /*
      * init
      */
      init: function init(options) {
        var that = this;
        this._parent(options);

        that._treeListViewNls = Nls;
        that._modalViewNls = Nls;
        that._nodeTreeViewNls = Nls;
      },

      /*
      * getPromisetoGetInfofromDB
      */
      getPromisetoFetchInfofromDB: function getPromisetoFetchInfofromDB(paramtersJsonArray) {
        var that = this;
        var promises = [];
        var types = [];
        var attributes = [];
        for(var idxparam=0;idxparam<paramtersJsonArray.length;idxparam++){
          var param = paramtersJsonArray[idxparam];

          if(param.hasOwnProperty('attribute') && param.attribute.length >0)
            attributes.push(param.attribute);
        }
        var promiseNLSValues = new UWA.Promise(function (resolve, reject) {
          if (that._nlsResult == null || that._nlsResult == undefined) {
            that._nlsResult = {};
            ParameterizationDisplayPropertiesWebServices.getNLS(types,attributes, {
              onSuccess: function (data) { 
                that._nlsResult = data;
                resolve();
              }
            });
          }
          else
            resolve();
        });
        promises.push(promiseNLSValues);

        var promiseDimensions = new UWA.Promise(function (resolve, reject) {
          if (that._3dspaceDimensions == null || that._3dspaceDimensions == undefined) {
            that._3dspaceDimensions = {};

            ParameterizationDisplayPropertiesWebServices.getlistofDimensions({
              onSuccess: function (data) {
                that._3dspaceDimensions = data;
                resolve();
              }
            });
          }
          else
            resolve()
        });
        promises.push(promiseDimensions);
        return promises;
      },

      /*
      * buildFamilyContent
      */
      buildFamilyContent: function buildFamilyContent() {
        var that = this;
        that._nodeTreeViewNls.treeViewTitle = that._nodeTreeViewNls.aspectRatiosTableName;

        var content = this._parent();
        return content;
      },

    /*
    * presetModal
    */
      presetModal: function presetModal(node) {
        var that = this;
        var nodeData = node.getData();
        var promiseTypes = new UWA.Promise(function (resolve, reject) {
          if (that._corpusTypesResult == null || that._corpusTypesResult == undefined) {
            var comboTypes = document.getElementById(that._CONSTANTS.COLUMNIDS.TYPE);
            //loader
            var loader = new WUXLoader({ height: 22 });
            loader.on(Nls.Loading);

            var parentNodeTypesContainer = comboTypes.getParent();
            parentNodeTypesContainer.style.position = "sticky";
            WUXModalContainer.createModal(parentNodeTypesContainer, loader.elements.container);

            ParameterizationDisplayPropertiesWebServices.getListOfCorpusTypes("DisplayUnits", {
              onSuccess: function (data) {
                loader.off();
                WUXModalContainer.removeModal(parentNodeTypesContainer);

                parentNodeTypesContainer.style.position = "";

                that._corpusTypesResult = {};
                that._corpusTypesResult = data;

                resolve();
              },
              onFailure: function (err) {
                loader.off();
                WUXModalContainer.removeModal(parentNodeTypesContainer);
                parentNodeTypesContainer.style.position = "";
                that.displayAlertMessage(Nls.getTypesError, "error");
              }
            });
          }
          else
            resolve();
        });
        UWA.Promise.all([promiseTypes]).then(function () {
          that.fillCorpusTypesComboList();
          var promiseAttributes = new UWA.Promise(function (resolve, reject) {
            if (that._corpusTypesResult != null && that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES] != undefined &&
              that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][nodeData.type] != undefined &&
              that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][nodeData.type][that._CONSTANTS.TYPES_RESULT.SUBTYPES] != undefined) {
              resolve();
            }
            else {
              var comboAttribute = document.getElementById(that._CONSTANTS.COLUMNIDS.ATTRIBUTE);
              //loader
              var loader = new WUXLoader({ height: 22 });
              loader.on(Nls.Loading);

              var parentNodeTypesContainer = comboAttribute.getParent();
              parentNodeTypesContainer.style.position = "sticky";
              WUXModalContainer.createModal(parentNodeTypesContainer, loader.elements.container);
              ParameterizationDisplayPropertiesWebServices.getListOfTypesAndAttributesForCorpusTypes(nodeData.type,that._CONSTANTS.FAMILY_ID, {
                onSuccess: function (data) {
                  loader.off();
                  WUXModalContainer.removeModal(parentNodeTypesContainer);
                  parentNodeTypesContainer.style.position = "";
                  if(that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][nodeData.type] == null || that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][nodeData.type] == undefined)
                    that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][nodeData.type] = {};
                  that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][nodeData.type][that._CONSTANTS.TYPES_RESULT.SUBTYPES] = data[nodeData.type];
                  resolve();
                },
                onFailure: function (err) {
                  loader.off();
                  WUXModalContainer.removeModal(parentNodeTypesContainer);
                  parentNodeTypesContainer.style.position = "";
                  that.displayAlertMessage(Nls.getTypesError, "error");
                }
              });
            }
          });

          UWA.Promise.all([promiseAttributes]).then(function () {
            that.fillAttributesComboList(nodeData.type);
            DPConfigurationBaseTableView.prototype.presetModal.call(that, node);
          });

        });
      },

      /*
      * buildModal
      */
      buildModal: function buildModal(bEditMod) {
        var that = this;
        that._modalViewNls.modalTitle = that._modalViewNls.Title_DisplayUnits_modal;
        that._modalViewNls.Info = that._modalViewNls.Info_DisplayUnits_modal;
        that._modalViewNls.typeTooltip = that._modalViewNls.typeTooltip_DisplayUnits;
        that._modalViewNls.attributeTooltip = that._modalViewNls.attributeTooltip_DisplayUnits;
        that._parent(bEditMod);

        that.updateTypesCombo();

        var comboAttribute = document.getElementById(that._CONSTANTS.COLUMNIDS.ATTRIBUTE);
        comboAttribute.dsModel.disabled = true;
        comboAttribute.dsModel.elementsList = [];
        comboAttribute.dsModel.selectedIndex = -1;

        var toggleAsEntered = document.getElementById(that._CONSTANTS.COLUMNIDS.ASENTERED);
        toggleAsEntered.dsModel.disabled = true;

        var comboDisplayUnit = document.getElementById(that._CONSTANTS.COLUMNIDS.DISPLAYUNIT);
        comboDisplayUnit.dsModel.disabled = true;
        comboDisplayUnit.dsModel.elementsList = [];
        comboDisplayUnit.dsModel.selectedIndex = -1;

      },

      /*
       * updateTypesCombo
      */
      updateTypesCombo: function updateTypesCombo() {
        var that = this;

        var comboTypes = document.getElementById(that._CONSTANTS.COLUMNIDS.TYPE);
        comboTypes.dsModel.disabled = true;
        comboTypes.dsModel.elementsList = [];
        comboTypes.dsModel.selectedIndex = -1;

        if (that._corpusTypesResult != null) {
          that.fillCorpusTypesComboList();
        }
        else {
          //loader
          var loader = new WUXLoader({ height: 22 });
          loader.on(Nls.Loading);

          var parentNodeTypesContainer = comboTypes.getParent();
          parentNodeTypesContainer.style.position = "sticky";
          WUXModalContainer.createModal(parentNodeTypesContainer, loader.elements.container);

          ParameterizationDisplayPropertiesWebServices.getListOfCorpusTypes("DisplayUnits", {
            onSuccess: function (data) {
              loader.off();
              WUXModalContainer.removeModal(parentNodeTypesContainer);

              parentNodeTypesContainer.style.position = "";

              that._corpusTypesResult = {};
              that._corpusTypesResult = data;
              that.fillCorpusTypesComboList();
            },
            onFailure: function (err) {
              loader.off();
              WUXModalContainer.removeModal(parentNodeTypesContainer);
              parentNodeTypesContainer.style.position = "";
              that.displayAlertMessage(Nls.getTypesError, "error");
            }
          });
        }
      },

      fillCorpusTypesComboList: function fillCorpusTypesComboList() {
        var that = this;
        var comboTypes = document.getElementById(that._CONSTANTS.COLUMNIDS.TYPE);
        if (that._corpusTypesResult != null || that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES] != undefined) {
          var listForCombo = [];
          var corpusTypes = that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES];
          var corpusTypesLength = corpusTypes.length;
          for (var idxType = 0; idxType < corpusTypesLength; idxType++) {
            var comboValue = corpusTypes[idxType];
            var comboLabel = comboValue;
            if (Nls.hasOwnProperty(corpusTypes[idxType]))
              var comboLabel = Nls[corpusTypes[idxType]];
            listForCombo.push({ label: comboLabel, value: comboValue });
          }

          var comboElementsListLength = listForCombo.length;
          if (comboElementsListLength > 0) {
            if (listForCombo.length) {
              listForCombo.sort(function (comboValue1, comboValue2) {
                if (comboValue1.label.toLowerCase() === comboValue2.label.toLowerCase())
                  return 0;
                return comboValue1.label.toLowerCase() > comboValue2.label.toLowerCase() ? 1 : -1;
              });
            }
            if (!that._bEditMode)
              comboTypes.dsModel.disabled = false;
            comboTypes.dsModel.elementsList = listForCombo;
            comboTypes.dsModel.selectedIndex = -1;
            comboTypes.dsModel.autocompleteFlag = false;
          }
        }
      },
 
      /*
      * mapFunctions
      */
      mapFunctions: function mapFunctions(name) {
        var that = this;
        if (name === "onChangetypeCombo")
          return that.onChangeTypeClick.bind(that);
        if (name === "onChangeAttributeCombo")
          return that.onChangeAttributeClick.bind(that);
        if (name === "onAsEnteredToggle")
          return that.onAsEnteredToggle.bind(that);

        else return null;
      },

      /*
      * onChangeTypeClick
      */
      onChangeTypeClick: function onChangeTypeClick(data) {
        var that = this;

        if (data.dsModel.elementsList[data.dsModel.selectedIndex] != undefined && !that._bEditMode) {
          that.updateAttributesCombo(data.dsModel.elementsList[data.dsModel.selectedIndex].value);
        }
      },

      /*
      * onChangeAttributeClick
      */
      onChangeAttributeClick: function onChangeAttributeClick(data) {
        var that = this;
        var uiElementDisplayUnit = null;

        that._uiElementsIDs.forEach(element => {
          if (element.id === that._CONSTANTS.COLUMNIDS.DISPLAYUNIT) {
            uiElementDisplayUnit = element;
          }

          var toggleAsEntered = document.getElementById(that._CONSTANTS.COLUMNIDS.ASENTERED);
        toggleAsEntered.dsModel.disabled = false;

        });
        var comboType = document.getElementById(that._CONSTANTS.COLUMNIDS.TYPE);
        var selectedType = comboType.dsModel.elementsList[comboType.dsModel.selectedIndex].value;
        if (selectedType != undefined && data.dsModel.elementsList[data.dsModel.selectedIndex].value != undefined)
          that.updateDisplayUnitsCombo(selectedType, data.dsModel.elementsList[data.dsModel.selectedIndex].value);
      },

      /*
      * onAsEnteredToggle
      */
      onAsEnteredToggle: function onAsEnteredToggle(data) {
        var that = this;
        var uiElementDisplayUnit = null;

        that._uiElementsIDs.forEach(element => {
          if (element.id === that._CONSTANTS.COLUMNIDS.DISPLAYUNIT) {
            uiElementDisplayUnit = element;
          }
        });
        var comboDisplayUnit = document.getElementById(that._CONSTANTS.COLUMNIDS.DISPLAYUNIT);
        if (data.dsModel.checkFlag) {

          comboDisplayUnit.dsModel.disabled = true;
          comboDisplayUnit.dsModel.elementsList = [];
          comboDisplayUnit.dsModel.selectedIndex = -1;
          uiElementDisplayUnit.mandatory = false;
        }
        else {
          comboDisplayUnit.dsModel.disabled = false;
          uiElementDisplayUnit.mandatory = true;
          var comboType = document.getElementById(that._CONSTANTS.COLUMNIDS.TYPE);
          var selectedType = comboType.dsModel.elementsList[comboType.dsModel.selectedIndex].value;
          var comboAttribute = document.getElementById(that._CONSTANTS.COLUMNIDS.ATTRIBUTE);
          var selectedAttribute = comboAttribute.dsModel.elementsList[comboAttribute.dsModel.selectedIndex].value;
          that.updateDisplayUnitsCombo(selectedType,selectedAttribute);
        }
      },

      /*
      * updateAttributesCombo
      */
      updateAttributesCombo: function updateAttributesCombo(i_selectedType) {
        var that = this;

        var comboAttribute = document.getElementById(that._CONSTANTS.COLUMNIDS.ATTRIBUTE);
        comboAttribute.dsModel.disabled = true;
        comboAttribute.dsModel.elementsList = [];
        comboAttribute.dsModel.selectedIndex = -1;
        if (that._corpusTypesResult != null && that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES] != undefined &&
          that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][i_selectedType] != undefined && 
          that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][i_selectedType][that._CONSTANTS.TYPES_RESULT.SUBTYPES] != undefined) {
            that. fillAttributesComboList(i_selectedType);
        }
        else{
          //loader
          var loader = new WUXLoader({ height: 22 });
          loader.on(Nls.Loading);

          var parentNodeTypesContainer = comboAttribute.getParent();
          parentNodeTypesContainer.style.position = "sticky";
          WUXModalContainer.createModal(parentNodeTypesContainer, loader.elements.container);
          ParameterizationDisplayPropertiesWebServices.getListOfTypesAndAttributesForCorpusTypes(i_selectedType,that._CONSTANTS.FAMILY_ID, {
            onSuccess: function (data) {
              loader.off();
              WUXModalContainer.removeModal(parentNodeTypesContainer);

              parentNodeTypesContainer.style.position = "";
              if(that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][i_selectedType] == undefined)
                that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][i_selectedType] ={};
              
              that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][i_selectedType][that._CONSTANTS.TYPES_RESULT.SUBTYPES] = data[i_selectedType];
              //that._typeResult = data;
              that.fillAttributesComboList(i_selectedType);
            },
            onFailure: function (err) {
              loader.off();
              WUXModalContainer.removeModal(parentNodeTypesContainer);
              parentNodeTypesContainer.style.position = "";
              that.displayAlertMessage(Nls.getTypesError, "error");
            }
          });          
        }
      },

      /*
      *
      */
      fillAttributesComboList: function fillAttributesComboList(i_selectedType) {
        var that = this;
        var comboAttribute = document.getElementById(that._CONSTANTS.COLUMNIDS.ATTRIBUTE);
        var listForCombo = [];
        var listAlreadyDefinedAttributes = that.getAttributesAlreayDefinedForType(i_selectedType);
        var typesKeys = Object.keys(that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][i_selectedType][that._CONSTANTS.TYPES_RESULT.SUBTYPES])
        var typesKeysLength = typesKeys.length;
        for (var idxTypeKey = 0; idxTypeKey < typesKeysLength; idxTypeKey++) {
          var typeKey = typesKeys[idxTypeKey];
          var type = that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][i_selectedType][that._CONSTANTS.TYPES_RESULT.SUBTYPES][typeKey];
          var typeAttributes = type[that._CONSTANTS.TYPES_RESULT.ATTRIBUTES];
          var typeAttributesKeys = Object.keys(typeAttributes);
          var typeAttributesKeysLength = typeAttributesKeys.length;
          for (var idxAttributeKey = 0; idxAttributeKey < typeAttributesKeysLength; idxAttributeKey++) {
            var typeAttributeKey = typeAttributesKeys[idxAttributeKey];
            var attrObj = typeAttributes[typeAttributeKey];

            if (attrObj) {
              var comboLabel = attrObj.NLSName + " (" + attrObj.ownerName + "." + attrObj.Name + ")";
              var comboValue = attrObj.ownerName + "." + attrObj.Name;
              if (!that._bEditMode && !listAlreadyDefinedAttributes.includes(comboValue)) {
                listForCombo.push({ label: comboLabel, value: comboValue });
              }
              else if (that._bEditMode)
                listForCombo.push({ label: comboLabel, value: comboValue });
            }
          }

        }
        var comboElementsListLength = listForCombo.length;
        if (comboElementsListLength > 0) {
          if (listForCombo.length) {
            listForCombo.sort(function (comboValue1, comboValue2) {
              if (comboValue1.label.toLowerCase() === comboValue2.label.toLowerCase())
                return 0;
              return comboValue1.label.toLowerCase() > comboValue2.label.toLowerCase() ? 1 : -1;
            });
          }
          if (!that._bEditMode)
            comboAttribute.dsModel.disabled = false;

          comboAttribute.dsModel.elementsList = listForCombo;
          comboAttribute.dsModel.selectedIndex = -1;
          comboAttribute.dsModel.autocompleteFlag = false;

          var comboDisplayUnit = document.getElementById(that._CONSTANTS.COLUMNIDS.DISPLAYUNIT);
          comboDisplayUnit.dsModel.disabled = true;
          comboDisplayUnit.dsModel.elementsList = [];
          comboDisplayUnit.dsModel.selectedIndex = -1;
        }

      },

      /*
      * getAttributesAlreayDefinedForType
      */
      getAttributesAlreayDefinedForType: function getAttributesAlreayDefinedForType(type) {
        var that = this;
        var attributes = [];
        var colId = that.treeListView.layout.getColumnIndex(that._CONSTANTS.COLUMNIDS.TYPE);
        var numberofRows = that.treeListView.getRowModelLength();
        for (var rowIndex = 0; rowIndex < numberofRows; rowIndex++) {
          var cellId = that.treeListView.layout.getCellIDFromCoordinates({ rowID: rowIndex, columnID: colId })
          var cellInfos = that.treeListView.getCellInfosAt(cellId);
          if (cellInfos && cellInfos.nodeModel.options.data[that._CONSTANTS.COLUMNIDS.TYPE] === type) {
            var rowData = that.getRowDataFromTreeView(rowIndex);
            attributes.push(rowData[that._CONSTANTS.COLUMNIDS.ATTRIBUTE]);
          }
        }
        return attributes;
      },

      /*
      * updateDisplayUnitsCombo
      */
      updateDisplayUnitsCombo: function updateDisplayUnitsCombo(i_selectedType, i_selectedAttribute) {
        var that = this;

        var comboDisplayUnit = document.getElementById(that._CONSTANTS.COLUMNIDS.DISPLAYUNIT);
        var toggleAsEntered = document.getElementById(that._CONSTANTS.COLUMNIDS.ASENTERED);
        if (!toggleAsEntered.dsModel.checkFlag)
          comboDisplayUnit.dsModel.disabled = false;

        var selectedAttributeOwnerType = i_selectedAttribute.split(".")[0];
        var selectedAttribute = i_selectedAttribute.split(".")[1];

        comboDisplayUnit.dsModel.elementsList = [];
        comboDisplayUnit.dsModel.selectedIndex = -1;
        if (that._corpusTypesResult != null && that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][i_selectedType] != undefined &&
          that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][i_selectedType][that._CONSTANTS.TYPES_RESULT.SUBTYPES][selectedAttributeOwnerType] != undefined &&
          that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][i_selectedType][that._CONSTANTS.TYPES_RESULT.SUBTYPES][selectedAttributeOwnerType][that._CONSTANTS.TYPES_RESULT.ATTRIBUTES][selectedAttribute] != undefined) {
          var listForCombo = [];

          var attrObj = that._corpusTypesResult[that._CONSTANTS.TYPES_RESULT.TYPES][i_selectedType][that._CONSTANTS.TYPES_RESULT.SUBTYPES][selectedAttributeOwnerType][that._CONSTANTS.TYPES_RESULT.ATTRIBUTES][selectedAttribute];
          var dimension = attrObj.Dimension;

          var numberOfDimensions = that._3dspaceDimensions.results.length;
          for (var i = 0; i < numberOfDimensions; i++) {
            var dimObj = that._3dspaceDimensions.results[i];
            if (dimObj) {
              var dimName = dimObj.Name;
              if (dimName == (dimension.split("DSDim_"))[1]) {

                var listUnitsForDimension = dimObj.Units.length;
                for (var idxUnit = 0; idxUnit < listUnitsForDimension; idxUnit++) {
                  var unitObj = dimObj.Units[idxUnit];
                  var comboLabel = unitObj.NLSName;
                  var comboValue = unitObj.Name;
                  listForCombo.push({ label: comboLabel, value: comboValue });
                }
                break;
              }
            }
          }

          var comboElementsListLength = listForCombo.length;
          if (comboElementsListLength > 0) {
            if (listForCombo.length) {
              listForCombo.sort(function (comboValue1, comboValue2) {
                if (comboValue1.label.toLowerCase() === comboValue2.label.toLowerCase())
                  return 0;
                return comboValue1.label.toLowerCase() > comboValue2.label.toLowerCase() ? 1 : -1;
              });
            }
            if (!toggleAsEntered.dsModel.checkFlag)
              comboDisplayUnit.dsModel.disabled = false;
            comboDisplayUnit.dsModel.elementsList = listForCombo;
            comboDisplayUnit.dsModel.selectedIndex = -1;
            comboDisplayUnit.dsModel.autocompleteFlag = false;
          }
        }
      },

      /*
      * createtreeNode
      */
      createtreeNode: function createtreeNode(data, grid) {
        var that = this;
        var translationModel = new DPConfigurationParamTranslationModel({
          data: data,
          grid: grid,
          nls: Nls
        });
        // We only store internal names for type, attribute name and display unit name in DB, to display we need to fetch  NLS name and set it on the grid of DataGrid model.
        if (grid == undefined) {
          var gridTemp = translationModel.getGrid();
          if (that._nlsResult != null && that._nlsResult != undefined && gridTemp != undefined &&
            gridTemp.hasOwnProperty(that._CONSTANTS.COLUMNIDS.TYPE) && gridTemp.hasOwnProperty(that._CONSTANTS.COLUMNIDS.ATTRIBUTE)) {

            if (data[that._CONSTANTS.COLUMNIDS.ATTRIBUTE].length > 0) {
              var attributekey = data[that._CONSTANTS.COLUMNIDS.ATTRIBUTE];
              gridTemp[that._CONSTANTS.COLUMNIDS.ATTRIBUTE] = that._nlsResult[attributekey]+ " ("+attributekey+")";
            }

            if (gridTemp.hasOwnProperty(that._CONSTANTS.COLUMNIDS.DISPLAYUNIT) && data[that._CONSTANTS.COLUMNIDS.DISPLAYUNIT].length > 0) {
              var numberOfDimensions = that._3dspaceDimensions.results.length;
              for (var i = 0; i < numberOfDimensions; i++) {
                var dimObj = that._3dspaceDimensions.results[i];
                if (dimObj) {
                  var dimName = dimObj.Name;
                  var listUnitsForDimension = dimObj.Units.length;
                  for (var idxUnit = 0; idxUnit < listUnitsForDimension; idxUnit++) {
                    var unitObj = dimObj.Units[idxUnit];
                    if (unitObj.Name === data[that._CONSTANTS.COLUMNIDS.DISPLAYUNIT]) {
                      gridTemp[that._CONSTANTS.COLUMNIDS.DISPLAYUNIT] = unitObj.NLSName;
                      break;
                    }
                  }
                }
              }
            }
          }
        }
        return translationModel;
      },
      
      /*
      * onOKEditButtonClick
      */
      onOKEditButtonClick: function onOKEditButtonClick() {
        var that = this;
        that._bEditMode = true;
        that._parent();
        that._bEditMode = false;
      },

      /*
      * onCancelButtonClick
      */
      onCancelButtonClick: function onCancelButtonClick() {
        var that = this;
        that._parent();
        that._bEditMode = false;
      },

      /*
      * editSelectedNode
      */
      editSelectedNode: function editSelectedNode(params) {
        console.log("params " + params);
        var that = this;
        that._bEditMode = true;
        that._parent(params);
      },

    });
    return DPDisplayUnitsTableView;
  });

/**
* @quickreview  ROW 25:02:11 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDisplayProperties/ParamDPDisplayUnitsView',
  [
    'UWA/Core',
    'UWA/Class/View',
    'DS/UIKIT/Mask',
    'DS/UIKIT/Alert',
    'DS/ParameterizationSkeleton/Views/ParametersLayoutView',
    'DS/ParameterizationSkeleton/Views/ParameterizationDisplayProperties/DPDisplayUnitsTableView',
    'DS/ParameterizationSkeleton/Utils/ParameterizationDisplayProperties/ParameterizationDisplayPropertiesWebServices',
    'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DisplayPropertiesNLS',
    'css!DS/ParameterizationSkeleton/ParameterizationSkeleton'
  ],
  function (
    UWA,
    View,
    Mask,
    Alert,
    ParametersLayoutView,
    DPDisplayUnitsTableView,
    ParameterizationDisplayPropertiesWebServices,
    ParametersLayoutViewUtilities,
    DisplayPropertiesNLS,
  ) {

    'use strict';

    var ParamDPDisplayUnitsView = View.extend({

      /*
      * init
      */
      init: function init(options) {
        this._parent(options);

        this._domainID = options.domainid;
        this._familyID = "DisplayUnits";
        this._parameterID = "DisplayUnitsParam";
                
        this._mapFamily = new Map();

        this._columnsDefinition = [];
        this._columnsDefinition.push({type:"combobox", id:"type", value:"",disabled:"false",onChange:"onChangetypeCombo",mandatory:"true",sortable:"false"});
        this._columnsDefinition.push({type:"combobox", id:"attribute", value:"",disabled:"false",onChange:"onChangeAttributeCombo",mandatory:"true",sortable:"false"});
        this._columnsDefinition.push({type:"checkbox", id:"asEntered", value:"false",onChange:"onAsEnteredToggle",mandatory:"true",sortable:"false"});
        this._columnsDefinition.push({type:"combobox", id:"displayUnit", value:"",disabled:"false",mandatory:"true",sortable:"false"});
      },

      /*
      * destroy
      */
      destroy: function destroy() {
        var that = this;
        that._parent();

        
        if (that._familyView)
          that._familyView.destroy();
        return that;
      },

      /*
      * render
      */
      render: function render() {
        UWA.log('Display Units LayoutView::render');
        let introDiv;
        let mappingDiv;
        const that = this;

        this.contentDiv = UWA.createElement('div', {
          id: 'typeMainDiv',
        });

        introDiv = UWA.createElement('div', {
          class: 'information',
        }).inject(this.contentDiv);

        UWA.createElement('p', {
          text: DisplayPropertiesNLS.introDisplayUnits,
          class: 'font-3dslight',
        }).inject(introDiv);
        this.parentView = new ParametersLayoutView(this.options);

        this.controlDiv = ParametersLayoutViewUtilities.createApplyResetToolbar.call(this, this.contentDiv, true,
          this.applyParams.bind(this), this.resetParams.bind(this));

        this.container.setContent(this.contentDiv);



        this.listenTo(this.collection, {
          onSync: that.onCompleteRequestMapping,
        });

        return this;
      },

      /*
      * onCompleteRequestMapping
      */
      onCompleteRequestMapping() {
        const that = this;
        UWA.log('Display Units Layout::Complete rendering!');

        const collection = this.collection._models[0]._attributes;

        Mask.mask(that.contentDiv);


        that.tableDiv = ParametersLayoutViewUtilities.createParamsContainerDiv();;
        var options = {};
        options.columnsinfo = that._columnsDefinition;
        options.domainid = that._domainID;
        options.familyid = "DisplayUnits";

        options.treeListViewNls = DisplayPropertiesNLS;
        options.modalViewNls = DisplayPropertiesNLS;
        options.nodeTreeViewNls = DisplayPropertiesNLS;

        that._familyView = new DPDisplayUnitsTableView(options);
        UWA.Promise.all(that._familyView.getPromisetoFetchInfofromDB(collection.ParametersList)).then(function () {
          
          var familyViewContent = that._familyView.buildFamilyContent();

          that._familyView.populateTreeViewWithSavedParameters(collection.ParametersList);

          familyViewContent.inject(that.tableDiv);
          that.tableDiv.inject(that.contentDiv);
          Mask.unmask(that.contentDiv);
        }).catch(e => {
          console.log(e);
        });

      },

      /*
      * resetParams
      */
      resetParams() {
        const that = this;
        Mask.mask(this.contentDiv);

        ParameterizationDisplayPropertiesWebServices.resetParameters(that._parameterID, {
          onSuccess : function(json){
            that.onResetSuccess(json);
            Mask.unmask(that.contentDiv);
            that.getAlertMessage(DisplayPropertiesNLS.ResetSuccess, 'success', that.contentDiv);
          },
          onFailure : function (json){
            Mask.unmask(that.contentDiv);
            that.onApplyFailure(DisplayPropertiesNLS.ApplyError);
          }
        });
      },

      /*
      * onResetSuccess
      */
      onResetSuccess(json) {
        const savedInfo = json.ParametersList;
        const that = this;
        that._familyView.resetTreeviewEntries(savedInfo);
      },

      /*
      * onResetFailure
      */
      onResetFailure(message) {
        this.getAlertMessage(message, 'error', this.contentDiv);
      },

      /*
      * applyParams
      */
      applyParams() {
        const that = this;

        var dataObjects = [];
        var numberofRows =   that._familyView.treeListView.getRowModelLength();
        for (var rowIndex = 0; rowIndex < numberofRows; rowIndex++) {
            var rowData = that._familyView.getRowDataFromTreeView(rowIndex);
            if(rowData && (rowData["deploystatus"] ==="deployed" || rowData["deploystatus"] ==="notDeployed")){
              rowData["domainID"] = "DisplayProperties";
              rowData["parameterID"] = "DisplayUnitsParam";
              if(!rowData.hasOwnProperty("asEntered"))
                rowData["asEntered"] = "false";
              dataObjects.push(rowData);
            }
        }
        
        const payloadToSend = {};
        Mask.mask(this.contentDiv);
        payloadToSend.ParametersList = dataObjects;
        payloadToSend.domainID = that._domainID;
        payloadToSend.familyID = that._familyID;
        payloadToSend.parameterID = that._parameterID;

        ParameterizationDisplayPropertiesWebServices.applyParameters(payloadToSend, {
          onSuccess : function(json){
            if (json.Action == 'Success') {
              that.onApplySuccess();
              Mask.unmask(that.contentDiv);
              that.getAlertMessage(DisplayPropertiesNLS.ApplySuccess, 'success', that.contentDiv);
            } else {
              Mask.unmask(that.contentDiv);
              that.onApplyFailure(json.message);
            }

          },
          onFailure : function (json){
            Mask.unmask(that.contentDiv);
            that.onApplyFailure(DisplayPropertiesNLS.ApplyError);
          }
        });
      },

      /*
      * onApplyFailure
      */
      onApplyFailure(message) {
        this.getAlertMessage(message, 'error', this.contentDiv);
      },

      /*
      * onApplySuccess
      */
      onApplySuccess() {
        var that = this;

        that._familyView.updateTreeViewOnApplySuccess();
        
      },

      /*
      * getAlertMessage
      */
      getAlertMessage(message, className, toDisplayOn) {
        this.alertOptions = {
            visible: true,
            className: 'param-alert',
            messageClassName: className,
            closable: true,
            renderTo: toDisplayOn,
            autoHide: true,
            hideDelay: 2000,
        };

        const alert = new Alert(this.alertOptions);
        alert.add({
            message,
        });
    }
    });

    return ParamDPDisplayUnitsView;
  });

/**
* @quickreview  ROW 23:12:29 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDEL3DWorkbook/DEL3DWorkbookConfigLayoutView',
  [
    'UWA/Core',
    'UWA/Utils/InterCom',
    'DS/ParameterizationSkeleton/Views/DELConfigurationParameterization/DELConfigurationLayoutView',
    'DS/ParameterizationSkeleton/Views/ParameterizationDEL3DWorkbook/DEL3DWorkbookConfigFamilyView',
    'DS/UIKIT/Input/Button',
    'DS/UIKIT/Input/File',
    'DS/UIKIT/Input/Text',
    'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
    'i18n!DS/ParameterizationSkeleton/assets/nls/DEL3DWorkbookConfiguration',
    'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS'
  ],
  function (
    UWA,
    InterCom,
    DELConfigurationLayoutView,
    DEL3DWorkbookConfigFamilyView,
    Button, UXFile, Text,
    ParamLayoutUtilities,
    Nls,
    ParamSkeletonNLS
  ) {

    'use strict';

    var DEL3DWorkbookConfigLayoutView = DELConfigurationLayoutView.extend({

      /*
      * init
      */
      init: function init(options) {
        var that = this;
        this._parent(options);
      },

      /*
      * onCompleteRequestParameters
      */
      onCompleteRequestParameters: function onCompleteRequestParameters() {
        //removeApply Reset div
        var eltUI = document.getElementById("ApplyResetDiv");
        if (eltUI) {
          var parentNode = eltUI.getParent();
          parentNode.removeChild(eltUI);
        }

        this._parent();
      },

      /*
      * buildParameterLine
      */
      buildParameterLine: function (iParamObj, familyID, familytbody, popoverPosition) {

        var that = this;
        var args = iParamObj.argument;
        for (var i = 0; i < args.length; i++) {
          var arg = args[i];
          if (arg && arg.defaultValue === "DELConfigurationTreeListView") {
            //this.nbofShownParameters++;
            familytbody.parentElement.style.marginLeft = '-6px';
            var contentTreeView = UWA.createElement('div');

            var options = {};
            options.xmlDoc = that._xmlMap.get(arg.id);
            options.domainid = that._domainID;
            options.familyid = familyID;
            options.parameterid = iParamObj.id;
            options.argid = arg.id;

            options.treeListViewNls = that._xmlNls.get(arg.id)[0];
            options.modalViewNls = that._xmlNls.get(arg.id)[1];
            options.nodeTreeViewNls = that._xmlNls.get(arg.id)[2];

            //var familyView = new DEL3DWorkbookConfigFamilyView(options);
            that._familyView = new DEL3DWorkbookConfigFamilyView(options);
            that._listOfFamilyViews.push(that._familyView);

            var treelistViewContent = that._familyView.buildFamilyContent();
            treelistViewContent.inject(familytbody);
          }
          else if (arg && arg.id === "ModelDocumentArg") {
            if (that._mapFamily)
              that._mapFamily.set(iParamObj.id, familyID);

            var dplWdthArr = [40, 10, 25, 25, 190];
            var lineModelDocument = UWA.createElement('tr').inject(familytbody);
            var imgCell = ParamLayoutUtilities.buildDeployStsCell(iParamObj.isDeployed, that.columnWidthArray[3].toString() + '%', '2', 'right');//5%
            var cellModelDocumentText = UWA.createElement('td', {
              //'colspan': '2',
              'width': dplWdthArr[0].toString() + '%',
              'align': 'left'
            }).inject(lineModelDocument);

            UWA.createElement('p', {
              text: Nls.ModelDocumentTttle,
              'class': ''
            }).inject(cellModelDocumentText);

            var cellInfo = UWA.createElement('td', {
              'width': dplWdthArr[1].toString() + '%',
              'align': 'left'
            }).inject(lineModelDocument);

            ParamLayoutUtilities.buildPopoverSpan(cellInfo, Nls.MmodelDocumentTooltip);
          
            var controlObjectCell = ParamLayoutUtilities.buildControlCell(iParamObj.id, arg, that.columnWidthArray[2].toString() + '%');
            var modelDocumentName = "";
            if((arg.argValue.split("name:"))[1] != undefined)
              modelDocumentName = (arg.argValue.split("name:"))[1];
            that._storedDocName = arg.argValue;
            var fileNameText = new Text({
              className: "form-control",
              placeholder: "...",
              id: iParamObj.id,
              attributes: {
                value: modelDocumentName,
                multiline: false,
                disabled: false,
                readonly: false
              },
              events: {
                onChange: function () {
                  if(fileNameText.elements.container.value === that._storedDocName || fileNameText.elements.container.value ===""){
                    ParamLayoutUtilities.beingModified(imgCell, ParamSkeletonNLS.ParamBeingModified, '2');
                    that.checkParameterValueOnChange(this, controlObjectCell, imgCell);
                    that._storedDocName = fileNameText.elements.container.value;
                  }
                  else
                  {
                    that.checkParameterValueOnChange(this, controlObjectCell, imgCell);
                    var value = "";
                    if(that._storedDocName.split("name:")[1] != undefined)
                      value = that._storedDocName.split("name:")[1];
                    fileNameText.setValue(value);
                  }
                }
            }
            }).inject(controlObjectCell);
            controlObjectCell.inject(lineModelDocument);

            that._controlObjectCell = controlObjectCell;
            that._imgCell = imgCell;
            //that._imgTitle = ParamSkeletonNLS.ParamBeingModified

            fileNameText.getContent().setStyle("width", 200);
            that._modelDocumentTextElement = fileNameText;

            var buttonSearchCell = UWA.createElement('td', {
              'width': dplWdthArr[3].toString() + '%',
              'align': 'left'
            }).inject(lineModelDocument);

            var searchBttn = new Button({
              className: 'primary',
              id: 'buttonSearch',
              icon: 'search',//'download'//value: 'Button',
              attributes: {
                //disabled: false,
                title: Nls.SearchButtonTooltip,
                //text: ''
              },
              events: {
                onClick: function () {
                  that.launchSearch({
                    title: Nls.SearchTitleForModelDocument,
                    default_search_criteria: "",
                    precond: '(flattenedtaxonomies:"types/Document")',
                    multiSel: false,
                    callback: function (items) {
                      var modelDocIDAndName = "id:"+items[0].id+",name:"+items[0]['ds6w:label_value'];
                      if(that._storedDocName != modelDocIDAndName){
                        that._modelDocumentTextElement.setValue(items[0]['ds6w:label_value']);
                        ParamLayoutUtilities.beingModified(imgCell, ParamSkeletonNLS.ParamBeingModified, '2');
                        that._storedDocName = modelDocIDAndName;
                        that.updateParameterOnChange(modelDocIDAndName,that._controlObjectCell, that._imgCell);
                      }
                    },
                    cancel: function () {
                      // NO OP
                    },
                  });
                }
              }
            }).inject(buttonSearchCell);
            searchBttn.getContent().setStyle("width", '50');
            searchBttn.getContent().setStyle("align", "left");

            imgCell.inject(lineModelDocument);
          }
          else
            this._parent(iParamObj, familyID, familytbody, popoverPosition);
        }
      },

      /**
      * Sends an event to open the search.
      * @param {Object} options - Options to give to the search, described in getSearchOptions.
      */
      launchSearch: function (options) {

        /* eslint-disable camelcase */
        options = UWA.merge(options || {}, {
          title: '',
          widget_id: window.widget.id,
          app_socket_id: window.widget.name + '_' + window.widget.id,
          default_search_criteria: ''
        });
        /* eslint-enable camelcase */

        // Init the socket to talk to the search
        var registrationOptions = this.getSearchOptions(options);
        var socket = new InterCom.Socket(registrationOptions.app_socket_id, {
          dispatchRetryInterval: 5
        });

        // Hear hear and dispatch search event
        socket.subscribeServer('SearchComServer');
        socket.dispatchEvent('RegisterContext', registrationOptions);
        socket.dispatchEvent('InContextSearch', registrationOptions);

        // To destroy the socket
        var destroy = function () {
          // Define later
        };

        // Listener in case of selection
        var select = function (data) {
          if (typeof options.callback === 'function') {
            options.callback.call(null, data);
          }

          // Boom
          destroy();

        };
        socket.addListener('Selected_Objects_search', select);

        // Listener if you cancel the search
        var cancel = function () {
          if (typeof options.cancel === 'function') {
            options.cancel.call(null);
          }

          // Boom
          destroy();
        };
        socket.addListener('onCloseTransient', cancel);

        // Define the function to destroy the socket
        destroy = function () {
          socket.dispatchEvent('UnregisterContext', {
            // eslint-disable-next-line camelcase
            widget_id: registrationOptions.widget_id
          });
          socket.unsubscribeServer('SearchComServer');
          socket.removeListener('Selected_Objects_search', select);
          socket.removeListener('onCloseTransient', cancel);
          socket.disconnect();
        };
      },
      /**
       * Get the options needed to trigger a search.
       * @param {Object} options - The options to set in search options.
       * @return {Object} Returns the options to give to the search API.
       */
      getSearchOptions: function (options) {
        /* jshint -W106 */ // Some baka loves to not follow camel case naming.
        /* eslint-disable camelcase */
        var registrationOptions = {
          title: '',
          role: '',
          mode: 'furtive',
          default_with_precond: true,
          precond: '',
          show_precond: false,
          multiSel: true,
          idcard_activated: false,
          select_result_max_idcard: false,
          itemViewClickHandler: '',
          app_socket_id: options.socket,
          widget_id: options.widget,
          search_delegation: '3dsearch',
          default_search_criteria: ''
        };
        /* jshint +W106 */
        /* eslint-enable camelcase */

        registrationOptions = UWA.merge(options || {}, registrationOptions);

        return registrationOptions;
      },

      /*
      * updateParameterOnChange
      */
      updateParameterOnChange: function (iValue, ctrlObjectCell, imageCell) {

        var that = this;
        var objNode = {
          value: iValue
        };

        var paramID = ctrlObjectCell.getData('argumentNode').paramid;
        var argID = ctrlObjectCell.getData('argumentNode').argumentid;
        var familyID = that._mapFamily.get(paramID);
        var bCanUpdate = true;
        var strErrorMessage = "";
        if (paramID === "ViewerRatio") {
          if (isNaN(iValue)) {
            bCanUpdate = false;
            strErrorMessage = Nls.ErrorMsgNotANumber;
          }
          if (iValue < 0 || iValue > 1) {
            bCanUpdate = false;
            strErrorMessage = Nls.ErrorMsgNotInRange;
          }
        } /* Changes to address IR-1351356 - Remove 2D Orientation Viewer Settings in CSCC for 3DWorkbook.
        else if (paramID === "2DViewerHeight" || paramID === "2DViewerWidth" || paramID === "2DViewerXPosition" || paramID === "2DViewerYPosition") {
          if (isNaN(iValue)) {
            bCanUpdate = false;
            strErrorMessage = Nls.ErrorMsgNotANumber;
          }
          if (!iValue % (!isNaN(parseFloat(iValue)) && 0 <= ~~iValue)) {
            bCanUpdate = false;
            strErrorMessage = Nls.ErrorMsgNotAnInteger;
          }
        }  */else if (paramID === "ModelDocument") {
          if(iValue === "" ||  (iValue === that._storedDocName && isNaN(iValue))){
            //Do Nothing
          }
          else{
            var strWarningMessage = Nls.ModelDocumenttWarningMessage;
            that.userMessaging.add({ className: "warning", message: strWarningMessage });
            return;
          }
          
        }
        if (!bCanUpdate) {
          that.userMessaging.add({ className: "error", message: strErrorMessage });
          return;
        }
        this._parent(iValue, ctrlObjectCell, imageCell);
      }
    });
    
    return DEL3DWorkbookConfigLayoutView;
  });

/**
* @quickreview  KB9 21:10:25 creation
*/

define('DS/ParameterizationSkeleton/Views/ParameterizationDEL3DWorkbook/DEL3DWorkbookConfigParentView',
		[
	 'UWA/Core',
	 'DS/ParameterizationSkeleton/Views/ParametersParentView',
	 'DS/ParameterizationSkeleton/Views/ParameterizationDEL3DWorkbook/DEL3DWorkbookConfigLayoutView'
	 ],
	 function (
		 UWA,
		 ParametersParentView,
		 DEL3DWorkbookConfigLayoutView
		)
{

	'use strict';


	var DEL3DWorkbookConfigParentView = ParametersParentView.extend({

		init: function (options) {
			options = UWA.clone(options || {}, false);
			this._domainID = options.domainid;
			this._parent(options);
		},

		setup: function (options) {
			UWA.log('DEL3DWorkbookConfigParentView Layout::setup!');
			UWA.log(options);

		},

		render : function()
		{
			var that = this;
			var options = this.options;

		  var layoutView = new DEL3DWorkbookConfigLayoutView(options);
			return layoutView.render();
		}
	});

	return DEL3DWorkbookConfigParentView;
});

define('DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/LabelEdgeView', 
[
     'UWA/Core',   
     'egraph/core', 
     'egraph/views', 
     'egraph/utils',    
     'DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/ParamStepGeometry',
],function(UWA, 
           core, views, utils,
           StepGeo)
{  /**
         * Add an edge between two connectors.
         * @param {module:egraph/core.Connector} c1
         * @param {module:egraph/core.Connector} c2
         * @returns {module:egraph/core.Edge} the new edge
         */ 

        var svgNS ='http://www.w3.org/2000/svg',xlinkNS = 'http://www.w3.org/1999/xlink';
        var nextUID_x = 0;

        var exports = {};  
        var currSign = "";//removeit ne sert à rien

        exports.LabelEdgeView = function (signature) {
            
            currSign = signature; //removeit ne sert à rien
            views.SVGEdgeView.call(this);
        },

        utils.inherit(exports.LabelEdgeView, views.SVGEdgeView);

        exports.LabelEdgeView.prototype.className = 'arrow-edge';

        exports.LabelEdgeView.prototype.oncreateDisplay = function (e) {
        var textPath;

        views.SVGEdgeView.prototype.oncreateDisplay.apply(this, arguments);

        // assign a unique ID to the path that can be later referenced
        // by the <textPath>
        this.display.elt.id = makeUniqueID2();

        // create a <textPath> following the edge's path
        textPath = document.createElementNS(svgNS, 'textPath');
        // set the reference to edge's path
        textPath.setAttributeNS(xlinkNS, 'href', '#' + this.display.elt.id);
        // set the offset so that the text anchor is centered --> 20%
        textPath.setAttribute('startOffset', '20%');
        // insert the text content
        textPath.appendChild(document.createTextNode(e.signature));

        // create a <text> for the <textPath>
        this.display.text = document.createElementNS(svgNS, 'text');
        // offset the text of 5 above the path (can't be assigned in CSS)
        this.display.text.setAttribute('dy', '-5');
        // assign the CSS class to the text
        utils.classListAdd(this.display.text, 'edge-text');
        // append the <textPath>
        this.display.text.appendChild(textPath);
        // append the <text> to the structure of the edge's view
        this.structure.root.appendChild(this.display.text);
        };


        function makeUniqueID ()
        {
        
            function next() {
                return '--path' + nextUID++;
            }

            var nextUID = 0;
            UWA.log("next = "+next);
            return next;
        }

        function makeUniqueID2 ()
        {
        
            var yx =  '--path' + nextUID_x++;        
            UWA.log("yx = "+yx);
            return yx;
        }
  


        return exports;

});    

/*global define*/
define('DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/ParamEdgeView',
     [
        'UWA/Core',
        'egraph/core',
        'egraph/views',
        'egraph/utils',
        'DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/LabelEdgeView',
        'DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/ParamStepGeometry'
    ], function(UWA,
           core, views, utils,
           LabelEdgeView, StepGeo) {
        'use strict';

        var edgebuild = {

            buildEdge : function (stub, signature) {
                var edge = new core.Edge(),
                    currstepGeometry = new StepGeo.ParamStepGeometry(stub);

                edge.set('geometry', currstepGeometry);
                edge.views.main = new views.SVGEdgeView('arrow-edge');
                //    edge.views.main = new LabelEdgeView.LabelEdgeView(signature);
                return edge;
            },
        };

        return edgebuild;
    });

define('DS/ParameterizationSkeleton/Views/ParamConfigurationManagement/CfgConfigurationUXComponents', [
    'UWA/Core',
    'DS/ParameterizationSkeleton/Views/ParamConfigurationManagement/CfgParamCustomizationUtility',
    'DS/ParameterizationSkeleton/Views/ParamConfigurationManagement/CfgParamAlertUtility',
    'i18n!DS/ParameterizationSkeleton/assets/nls/ConfigurationManagementNLS',
    'DS/UIKIT/Input/Toggle',
    'DS/UIKIT/Input/Button',
    'DS/UIKIT/Input/File',
    'DS/UIKIT/Spinner',
    'DS/UIKIT/Popover',
    'DS/UIKIT/Input/Text'
],
    function (UWA, CfgParamCustomizationUtility, CfgParamAlertUtility, ConfigurationManagementNLS, Toggle, Button, UXFile, Spinner, Popover, Text) {
        'use strict';

        /**
         * This method is private.
         * It will create the label case with his text and inject it into parentElement
         * @param {String} text text to display as label
         * @param {HTMLElement} parentElement parentElement to inject the case
         */
        const createLabelCase = function (text, parentElement) {
            UWA.createElement('td', {
                'class': 'labels',
                html: text
            }).inject(parentElement);
        };

        /**
         * This method is private.
         * It will create an information case with information icon inside. At mouseover it will show a text as tooltip. 
         * This will be injected into parentElement
         * @param {String} text tooltip text
         * @param {HTMLElement} parentElement parentElement to inject the case
         */
        const createInformationCase = function (text, parentElement) {

            const informationCase = UWA.createElement('td', {
                'class': 'bubble-info'
            }).inject(parentElement);

            const informationIcon = UWA.createElement('span', { 'class': "fonticon fonticon-info" }).inject(informationCase);

            //Information tooltip 
            new Popover({
                target: informationIcon,
                trigger: "hover",
                animate: "true",
                position: "top",
                body: text,
                title: ''
            });

        };

        /**
         * This method is private.
         * It create a case to inject validation states (succes, loading, error) inside. 
         * The case is returned
         * @returns {HTMLTableDataCellElement} validationCase
        */
        const createValidationCase = function () {

            return UWA.createElement('td', {
                'class': 'validation'
            });

        };

        /**
         * This method is private.
         * It will create validation states (succes, loading, error) and return them.
         * @param {HTMLTableDataCellElement} parentElement validation case to inject states inside
         * @returns {Array} states - all states values 
         */
        const createValidationStates = function (parentElement) {
            const states = {
                "ok":
                    UWA.createElement('span', {
                        'class': "Config_valid fonticon fonticon-2x fonticon-check "
                    }),

                "error":
                    UWA.createElement('span', {
                        'class': "Config_error fonticon fonticon-2x fonticon-wrong "
                    }),

                "loader": new Spinner()
            };


            states['ok'].inject(parentElement).hide();
            states['error'].inject(parentElement).hide();
            states['loader'].inject(parentElement).hide();

            return states;
        };

        /**
         * This method is private.
         * It will create checkbox to enable or disable a parameter. The checkbox is injected into parentContainer
         * It will call webServices for it depends of the type. 
         * @param {HTMLElement} parentContainer parentContainer to inject checkbox inside
         * @param {Array} validationStates states to display the good one depends on webServices status (if OK then succes, if calling then loading, if failed then error)
         * @param {String} type Must be : date / unit / static / matrix
         * @param {String} apiKey The api key linked to the type.
         */
        const createCheckBoxCase = function (parentContainer, validationStates, type, apiKey) {

            const checkBoxCase = UWA.createElement('td', {
                'class': 'checkboxCase'
            }).inject(parentContainer);

            const checkBoxContainer = UWA.createElement('div', {
                'class': 'checkboxContainer'
            }).inject(checkBoxCase);

            const checkbox = new Toggle(
                {
                    label: '',
                    type: 'checkbox',
                    checked: false,
                    className: 'primary checkbox_',
                    events: {
                        'onClick': function (event) {
                            const onSuccess = function () {
                                validationStates['loader'].hide();
                                setTimeout(function () {
                                    validationStates['ok'].show();
                                }, 300);
                                CfgParamAlertUtility.message('success', ConfigurationManagementNLS.SuccessfulSettingsApplied);  // IR-813391-3DEXPERIENCER2021x
                            };

                            const onFailure = function () {
                                validationStates['loader'].hide();
                                setTimeout(function () {
                                    validationStates['error'].show();
                                }, 300);
                                CfgParamAlertUtility.message('error', ConfigurationManagementNLS.ProcessError);

                            };

                            validationStates['loader'].show();
                            validationStates['ok'].hide();
                            validationStates['error'].hide();
                            if (type === "date") {
                                let value = "Enabled";
                                if (event.srcElement.checked === false)
                                    value = "Disabled"
                                CfgParamCustomizationUtility.setDateParam(value, onSuccess, onFailure);
                            }
                            else if (type === "unit") {
                                let value = "Enabled";
                                if (event.srcElement.checked === false)
                                    value = "Disabled"
                                CfgParamCustomizationUtility.setUnitParam(value, onSuccess, onFailure);
                            }
                            else if (type === 'static') {
                                let value = 'Enabled';
                                if (event.srcElement.checked === false) value = 'Disabled';
                                CfgParamCustomizationUtility.setStaticMappingParam(value, onSuccess, onFailure);
                            } else if (type === 'matrix') {
                                let value = 'Enabled';
                                if (event.srcElement.checked === false) value = 'Disabled';
                                CfgParamCustomizationUtility.setCompositionMatrixParam(value, onSuccess, onFailure);
                            } else if (type === 'xrevision') {
								let value = 'Enabled';
								if (event.srcElement.checked === false) value = 'Disabled';
								CfgParamCustomizationUtility.setxRevisionParam(value, onSuccess, onFailure);
							}
							else if (type === 'contextualvariant') {
								//FUN148752
								let value = 'Enabled';
								if (event.srcElement.checked === false) value = 'Disabled';
								CfgParamCustomizationUtility.setContextualVariantParam(value, onSuccess, onFailure);
							}
                        }
                    }
                }
            ).inject(checkBoxContainer);
            parentContainer.appendChild(checkBoxCase);
            return checkbox;
        };

        /**
         * This method is private.
         * It will call webService linked to the apiKey to get the value : enabled or disable. Then, check or not the checkbox. 
         * and then, show the call status as validation state display (succes, error)
         * @param {String} apiKey The api key linked to the type.
         * @param {HTMLInputElement} checkbox the checkbox to initialize
         * @param {Array} validationStates states array to display the good one depends of webServices call status
         */
        const initCheckboxState = function (apiKey, checkbox, validationStates) {

            const onSuccess = function (data) {
                if (data.constructor.name != "String") { //If response comming from Static or Matrix web services
                    if (data.settings[0].value === "enabled")
                        checkbox.elements.content.checked = true;
                    else
                        checkbox.elements.content.checked = false;
                } else { // If response coming from date or unit web services
                    if (data === "true" || data === "Enabled")
                        checkbox.elements.content.checked = true;
                    else
                        checkbox.elements.content.checked = false;
                }
                validationStates['ok'].show();
            };

            const onFailure = function (data) {
                validationStates['error'].show();
                console.log(data);
            };

            //if (apiKey === "date" || apiKey === "unit")
            CfgParamCustomizationUtility.getParamsFromServer(apiKey, onSuccess, onFailure);
            //else if (apiKey === "StaticMappingActivation" || apiKey === "CompositionMatrixActivation")
            //CfgParamCustomizationUtility.getParametrizationInformation(apiKey, onSuccess, onFailure);
        };

        /**
         * This method is private.
         * This method creating a new Param component as an table row. It inject the component into the parentElement. 
         * @param {any} label This label will be display at first in the row. It must be like "Enable Data criteria" for example.
         * @param {any} description This description will be display as tooltip in an information icon.
         * @param {any} parentElement The parentElement to inject the component
         * @param {any} type Must be : date / unit / static / matrix - It will create the component linked to the type.
         * @param {any} webServiceKey This is the webServiceKey discribe in PES.
         */
        const createParamComponent = function (label, description, parentElement, type, webServiceKey) {
            createLabelCase(label, parentElement);
            createInformationCase(description, parentElement);

            let validationTD = createValidationCase();
            let states = createValidationStates(validationTD);

            let boxes = createCheckBoxCase(parentElement, states, type, webServiceKey);
            initCheckboxState(webServiceKey, boxes, states);

            validationTD.inject(parentElement);
        };


        return {

            /**
             * CreateComponent method - Called in ConfigurationManagementView 
             * This method create component and inject it into parentElement. You can create 4 differents compononent by changing type.
             * @param {any} type date / unit / static / matrix - Use to create the good component
             * @param {any} parentElement this is the element in which the component will be injected
             */
            ceateComponent: function (type, parentElement) {
                if (type === "date")
                    //this.createDateComponent(parentElement);
                    createParamComponent(
                        ConfigurationManagementNLS.DateCriteriaTitle,
                        ConfigurationManagementNLS.DateDescription,
                        parentElement,
                        type,
                        "date" // contextualDateActivation
                    );
                else if (type === "unit")
                    //this.createUnitComponent(parentElement);
                    createParamComponent(
                        ConfigurationManagementNLS.UnitCriteriaTitle,
                        ConfigurationManagementNLS.UnitDescription,
                        parentElement,
                        type,
                        "unit" //unitActivation
                    );
                else if (type === "static")
                    // this.createStaticMappingComponent(parentElement);
                    createParamComponent(
                        ConfigurationManagementNLS.StaticMappingTitle,
                        ConfigurationManagementNLS.StaticMappingDescription,
                        parentElement,
                        type,
                        "StaticMappingActivation"
                    );
                else if (type === "matrix")
                    //this.createCompositionMatrixComponent(parentElement);
                    createParamComponent(
                        ConfigurationManagementNLS.CompositionMatrixTitle,
                        ConfigurationManagementNLS.CompositionMatrixDescription,
                        parentElement,
                        type,
                        "CompositionMatrixActivation"
                    );
				else if (type === 'xrevision') createParamComponent(ConfigurationManagementNLS.RevisionModeTitle, ConfigurationManagementNLS.RevisionModeDescription, parentElement, type, 'xRevision');
				else if (type === 'contextualvariant') createParamComponent(ConfigurationManagementNLS.ContextualVariantTitle, ConfigurationManagementNLS.ContextualVariantDescription, parentElement, type, 'contextualvariant'); //FUN148752

            },

            /**
             * Create an XSL parameterization component, which contain way to download default and customized XSL and a browse and upload button to set the customized XSL
             * @param {*} configurationXSLDiv 
             */
            createXSLComponents: function (configurationXSLDiv) {
                var selectedContent = "";
                var browseDiv = UWA.createElement('div', { 'id': "browseDiv", 'display': "inline" }).inject(configurationXSLDiv);
                // File Selector component. Allow only one file
                var fileSelector = new UXFile({
                    multiple: false,
                    buttonBefore: false,
                    name: 'file-input',
                    buttonClassName: 'default',
                    placeholder: ConfigurationManagementNLS.SelectAFile,
                    buttonText: ConfigurationManagementNLS.BrowseButtonText
                }).inject(browseDiv);
                // On file change, save the content of the file on a variable
                fileSelector.onChange = function (data) {
                    var putFileInVariable = function (file) {
                        fileSelector.elements.container.getChildren()[0].placeholder = file.name;
                        var reader = new FileReader();
                        reader.onload = function (event) {
                            selectedContent = reader.result;
                        };
                        reader.readAsText(file);
                    }
                    putFileInVariable(fileSelector.elements.input.files[0]);
                }


                // Upload button to upload selected file
                var uploadButton = new Button({ id: "uploadButton", className: "primary", value: ConfigurationManagementNLS.UploadButtonText, icon: 'upload' }).inject(browseDiv); // Create the button to send datas
                uploadButton.elements.container.style.marginTop = "5px";
                uploadButton.addEvent('onClick', function () {//Push content on server
                    var textContent = selectedContent.trim();
                    if (textContent === "") {
                        //Nothing to import
                        CfgParamAlertUtility.message('error', ConfigurationManagementNLS.NoFileToUpload);
                        return;
                    }
                    if (!textContent.startsWith("<?xml version=\"1.0\" encoding=\"utf-8\"?>")) {
                        //Version should be 1.0
                        CfgParamAlertUtility.message('error', ConfigurationManagementNLS.XSLFileError);
                        return;
                    }
                    else {
                        var onSuccess = function (data) {
                            CfgParamAlertUtility.message('success', ConfigurationManagementNLS.XSLUploadSuccessAlert);
                        }
                        CfgParamCustomizationUtility.uploadXSLCusto(textContent, onSuccess, console.log);
                    }
                });


                // Download the customized XSL file
                var downloadCustoButton = new Button({ id: "downloadCustoButton", value: ConfigurationManagementNLS.DowloadCustoButton, icon: 'download' }).inject(browseDiv);
                downloadCustoButton.elements.container.style.float = "right";
                downloadCustoButton.elements.container.style.marginTop = "5px";
                downloadCustoButton.addEvent('onClick', function () {
                    function onSuccessGetXSL(result) {
                        CfgParamCustomizationUtility.download("XslCusto.xsl", result.xslt.content);
                    }
                    CfgParamCustomizationUtility.getCustoXSL(onSuccessGetXSL, console.log);
                });

                // Download the Default XSL file
                var downloadButton = new Button({ id: "downloadButton", value: ConfigurationManagementNLS.DowloadDefaultButton, icon: 'download' }).inject(browseDiv); // Create the button to send datas
                downloadButton.elements.container.style.margin = "5px";
                downloadButton.elements.container.style.float = "right";
                downloadButton.addEvent('onClick', function () {
                    function onSuccessGetXSL(result) {
                        CfgParamCustomizationUtility.download("XslDefault.xsl", result.xslt.content);
                    }
                    CfgParamCustomizationUtility.getDefaultXSL(onSuccessGetXSL, console.log);
                });
            },

            /**
             * Create the UX for Disable Edit variant, which contain Text Editor and Button
             * @param data
             */
            createDisableEditVariantInWebAppComponent(data) {
                let disableEditVariantHeading = UWA.createElement('div', {
                    'class': "disableEditVariantHeading",
                    html: ConfigurationManagementNLS.DisableEditVariantInWebAppHeading
                }).inject(data);

                const disableEditVariantTooltipIcon = UWA.createElement('span', { 'class': "fonticon fonticon-info" }).inject(disableEditVariantHeading);

                new Popover({
                    target: disableEditVariantTooltipIcon,
                    trigger: "hover",
                    animate: "true",
                    position: "top",
                    body: ConfigurationManagementNLS.DisableEditVariantInWebAppTooltip,
                    title: ''
                });
                let disableEditVariantInWebappDiv = UWA.createElement('div', { 'id': "disableEditVariantInWebappDiv", 'display': "flex" }).inject(data);

                let inputText = new Text({
                    attributes: {
                        placeholder: ConfigurationManagementNLS.DisableEditVariantInWebAppLineEditor
                    }
                }).inject(disableEditVariantInWebappDiv);

                var submitButton = new Button({
                    id: "submitButton",
                    className: "primary",
                    value: ConfigurationManagementNLS.ApplyButtonText,
                    icon: 'export'
                }).inject(disableEditVariantInWebappDiv);
                submitButton.disable();
                let onSuccessCallback = function (data) {
                    inputText.setValue(UWA.String.escapeHTML(data));
                    submitButton.enable();
                }
                let onFailureCallback = function (error) {
                    CfgParamAlertUtility.message('error',ConfigurationManagementNLS.DisableEditVariantGetFailed)
                    submitButton.enable();
                }
                CfgParamCustomizationUtility.getParamsFromServer("disabledEditVariant", onSuccessCallback, onFailureCallback);

                let onSuccess = function () {
                    CfgParamAlertUtility.message('success', ConfigurationManagementNLS.DisableEditVariantInWebAppExpressionSuccess);
                    console.log(submitButton)
                    submitButton.enable();
                }
                let onFailure = function (error) {
                    CfgParamAlertUtility.message('error', ConfigurationManagementNLS.DisableEditVariantInWebAppExpressionError, error);
                    submitButton.enable();
                }
                submitButton.addEvent('onClick', function () {
                    submitButton.disable();
                    CfgParamCustomizationUtility.setDisabledEditVariantParam(inputText.getValue(), onSuccess, onFailure);
                }).inject(disableEditVariantInWebappDiv);
                
            }
        }
    });


/*@fullReview  ZUR 15/11/23 2017x Param Skeleton*/
/*global define, widget*/
define('DS/ParameterizationSkeleton/Views/ParamConfigurationManagement/ConfigurationManagementView',
    [
        'UWA/Core',
        'UWA/Class/View',
        'DS/UIKIT/Mask',
        'DS/ParameterizationSkeleton/Views/ParamConfigurationManagement/CfgConfigurationUXComponents',
        'DS/UIKIT/Accordion',
        'i18n!DS/ParameterizationSkeleton/assets/nls/ConfigurationManagementNLS'
    ], function (UWA, View, Mask, UXComponent, Accordion, ConfigurationManagementNLS) {

        'use strict';
        var extendedView;


        extendedView = View.extend({

            defaultOptions: {
                type: 'default'
            },

            // The ‘options’ object is passed via the ‘viewOptions’ specified in the Renderer at the Skeleton instantiation
            init: function (options) {
                UWA.log("ConfigurationManagementView::init");
                UWA.log(options);
                this.options = UWA.clone(options || {}, false); //environment options
                this._parent(options);
                this.childView = null;
            },

            render: function () {
                var that = this;

                //This is the main div. It contains configurationCriteria, configurationFiletring and XSL
                that.contentDiv = UWA.createElement('div', { 'id': "configurationParamContainer" });
                that.container.setContent(that.contentDiv);
                that.contentDiv.parentElement.classList.add("configurated-structure-main");
                that.createHeader(that.contentDiv);

                // It is again for delete the gap between the two items
                var configurationXSLTable = UWA.createElement('table', { 'id': "configurationXSL" });
                configurationXSLTable.style.width = "100%";
                var configurationXSLDiv = UWA.createElement('tr', { 'id': "Elmt1" }).inject(configurationXSLTable);
                UXComponent.createXSLComponents(configurationXSLDiv);

                //add Disable edit variant accordion
                let disableEditVariantTable = UWA.createElement('table', { 'id': "disableEditVariant" });
                let configurationDisableEditVariantInWebAppDiv = UWA.createElement('tr', { 'id': "Elmt2" }).inject(disableEditVariantTable);
                UXComponent.createDisableEditVariantInWebAppComponent(configurationDisableEditVariantInWebAppDiv);

                new Accordion({
                    className: 'filled',
                    exclusive: false,
                    items: [
                        {
                            title: ConfigurationManagementNLS.ConfigurationCriteriaAccordeonTab,
                            content: that.createConfigurationParamView('configurationCriteriaTable',
                                {
                                    "dateTableCase": "date",
                                    "unitTableCase": "unit"
                                }
                            ),
                            selected: true
                        },
                        {
                            title: ConfigurationManagementNLS.ConfigurationFilteringAccordeonTab,
                            content: that.createConfigurationParamView('configurationFileringTable',
                                {
                                    "StaticMappingTableCase": "static",
                                    "CompositionMatrixTableCase": "matrix",
									"ContextualVariantTableCase": "contextualvariant", //FUN148752
                                }
                            ),
                            selected: true
                        },
                        {
                            title: ConfigurationManagementNLS.XSLAccordeonTab,
                            content: configurationXSLTable,
                            selected: true
                        },
                        {
                            title: ConfigurationManagementNLS.ConfigurationCommands,
                            content: disableEditVariantTable,
                            selected: true
                        },
						{
                        title: ConfigurationManagementNLS.RevisionMode,
                        content: that.createConfigurationParamView('configurationxRevisionTable', {
                            xrevisionTableCase: 'xrevision',
                        }),
                        selected: true,
						},
                    ]
                }).inject(that.contentDiv);

                return that;
            },

            createConfigurationParamView: function (id, array) {
                var configurationParamTable = UWA.createElement('table',
                    {
                        'id': id,
                        'class': 'configurationParamTable'
                    }
                );
                Object.entries(array).forEach(entry => {
                    const [key, value] = entry;
                    UXComponent.ceateComponent(value, this.createTableCase(key, configurationParamTable));
                });
                return configurationParamTable;
            },

            createTableCase: function (id, parentElement) {
                var tableCase = UWA.createElement('tr', {
                    'id': id,
                    'class': 'configurationTableCase',
                }).inject(parentElement);

                tableCase.addEventListener('mouseover', function () {
                    tableCase.classList.add('colored')
                });

                tableCase.addEventListener('mouseout', function () {
                    tableCase.classList.remove('colored');
                });

                return tableCase;

            },

            createHeader: function (parentElement) {
                UWA.createElement('div', {
                    'id': "configurationParamTitle",
                    html: ConfigurationManagementNLS.ConfigurationManagementHeader
                }).inject(parentElement);
            },

            onCompleteRequestMapping: function () {
                Mask.unmask(this.contentDiv);

            },

            destroy: function () {
                this.stopListening();
                this._parent.apply(this, arguments);
            }

        });
        return extendedView;
    });





/*global define, UWA*/
/*jslint plusplus: true*/
/*@quickReview ZUR - 2020/05/07 - IR-759264-3DEXPERIENCER2021x*/
define('DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/ParamTransitionsDrag',
    [
        'egraph/core',
        'egraph/views',
        'egraph/utils',
        'egraph/iact',
        'DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/LifecycleEgraphUtilities',
        'DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/ParamEdgeView',
        'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
        'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS'
    ],
    function(core, views, utils, iact, LifecycleEgraphUtilities, ParamEdgeView, ParametersLayoutViewUtilities, ParamSkeletonNLS) {

        'use strict';

        var exports = {},
            grphcopy,
            userSMS,
            errorMsgTime = 0,
            listFbdTransitions = [],
            defaultTransitions = [];

        exports.ParamTransitionsDrag = function (grph, c, userMessaging, listofdefaulttransitions, forbiddenTransitions) {
            UWA.log("ParamTransitionsDrag");
            grphcopy = grph;
            userSMS = userMessaging;
            listFbdTransitions = forbiddenTransitions;
            defaultTransitions = listofdefaulttransitions;
            iact.ConnConnectDrag.call(this, grph, c);
        };

        utils.inherit(exports.ParamTransitionsDrag, iact.ConnConnectDrag);

        exports.ParamTransitionsDrag.prototype.onconnect = function () {
            UWA.log("ParamTransitionsDrag::onconnect");
        };

        exports.ParamTransitionsDrag.prototype.newEdge = function () {
            UWA.log("ParamTransitionsDrag::newEdge");
            //.log(this)//this.edge;//this.edge.cl2;//this.otherConnector.aleft
            return LifecycleEgraphUtilities.builTransitiondEdge(2); //null;//LifecycleView.buildEdge(2);
        };

        exports.ParamTransitionsDrag.prototype.onend = function () {
            UWA.log("ParamTransitionsDrag::onend");
            var edgecopy,
                iSign = [];

            iact.ConnConnectDrag.prototype.onend.apply(this, arguments);
            //.log(this)//this.c.node//this.c.otherConnector;
            //this.updateInputs();

            if (this.edge != null) {
                //iSign = "to" + this.edge.cl2.c.node.name;
                //iSign = ParametersLayoutViewUtilities.removeBlancks(this.edge.cl1.c.node.name + "to" + this.edge.cl2.c.node.name);
                iSign = computeSignatureName(this.edge.cl1.c.node, this.edge.cl2.c.node);

                this.edge.signature = iSign[0];
                this.edge.signatureNLS = iSign[1];
                this.edge.isCritical = false;
                edgecopy =  this.edge;

                if ("CBP" === grphcopy.appCategory) {
                    if (testifaSignatureisNeeded(edgecopy.cl1.c.node, edgecopy.cl2.c.node)) {
                        UWA.log("A signature is needed");
                    }
                }

                redrawTransition(edgecopy.cl1.c.node, edgecopy.cl2.c.node, iSign);
                this.edge.remove();

            }
        };

        exports.ParamTransitionsDrag.prototype.onaccept = function (c1, c2) {
            UWA.log("ParamTransitionsDrag::onaccept");
            var currDate = new Date(),
                currTime = currDate.getTime(),
                diffDate = currTime - errorMsgTime;

            if (checkifNodesAreAlreadyConnected(c1.node.gr.edges, c1, c2)) {

                if (diffDate >= 1400) {
                    errorMsgTime = currTime;
                    userSMS.add({className: "warning", message: ParamSkeletonNLS.DoubleTransitionText});
                }
                return false;
            }
            if (c2.node.stateid === c1.node.stateid) {

                if (diffDate >= 1400) {
                    errorMsgTime = currTime;
                    userSMS.add({className: "warning", message: ParamSkeletonNLS.CyclicTransitionText});
                }
                return false;
            }
            if (checkifForbiddenTransition(c1, c2)) {

                if (diffDate >= 1400) {
                    errorMsgTime = currTime;
                    userSMS.add({className: "warning", message: ParamSkeletonNLS.ForbiddenTransitionText});
                }
                return false;
            }

            return true;
        };

        exports.ParamTransitionsDrag.prototype.onconnect = function (edge, otherConnector, temporaryEdge) {
            UWA.log("onconnect::three");
            //.log(edge);
            this.updateTests();//update the input connectors of the node
        };

        exports.ParamTransitionsDrag.prototype.updateTests = function () {
            UWA.log("updateTests");
        };

        function checkifNodesAreAlreadyConnected(listofEdges, c1, c2) {
            var e;
            for (e = listofEdges.first; e; e = e.next) {
                if ((e.cl1.c.node.stateid == c1.node.stateid) &&
                        (e.cl2.c.node.stateid == c2.node.stateid)) {
                    UWA.log("Check::Nodes Already Connected");
                    return true;
                }
            }

            UWA.log("Check::Nodes can be Connected");
            return false;
        }

        function checkifForbiddenTransition(c1, c2) {
            var i, nbofForbiddenTR =  listFbdTransitions.length;

            for (i = 0; i < nbofForbiddenTR; i++) {
                if ((c1.node.stateid == listFbdTransitions[i].sourceState) &&
                        (c2.node.stateid == listFbdTransitions[i].targetState)) {
                    return true;
                }
            }
            return false;
        }

        function buildNewEdge(stub, iSignature, c1, c2) {
            var edge = ParamEdgeView.buildEdge(stub, iSignature);
            edge.signature = iSignature[0];
            edge.signatureNLS = iSignature[1];
            edge.isCritical = false;
            grphcopy.addEdge(c1, c2, edge);//add the edge to the graph
            return edge;
        }

        function redrawTransition(fromNode, toNode, iTransition) {
            var xdiff = toNode.left - fromNode.left,
                iPositions = Math.round(xdiff / grphcopy.nodeSpacing);

            if (iPositions === 1) {
                buildNewEdge(iPositions, iTransition, fromNode.data.right, toNode.data.left);
            } else if (iPositions < 0) {
                buildNewEdge(iPositions, iTransition, fromNode.data.bottom, toNode.data.bottom);
            } else {
                buildNewEdge(iPositions, iTransition, fromNode.data.top, toNode.data.top);
            }
        }

        function testifaSignatureisNeeded(fromNode, toNode) {
            var e, listofEdges, genSign,
                xdiff = toNode.left - fromNode.left,
                iPositions = Math.round(xdiff / grphcopy.nodeSpacing);

            if (iPositions != 1) {
                //IR-759264-3DEXPERIENCER2021x - ZUR replaced > by !=
                //return true;
                //UWA.log(grphcopy);
                listofEdges = grphcopy.edges;
                
                for (e = listofEdges.first; e; e = e.next) {

                    if (e.cl1.c.node.stateid === fromNode.stateid) {
                        xdiff = e.cl2.c.node.left - e.cl1.c.node.left;
                        iPositions = Math.round(xdiff / grphcopy.nodeSpacing);
                        UWA.log("from : " + e.cl1.c.node.stateid + " to : " + e.cl2.c.node.stateid + " :: " + iPositions);

                        if (iPositions === 1) {
                            if (e.signature === "") {
                                //genSign = ParametersLayoutViewUtilities.removeBlancks(e.cl1.c.node.name + "to" + e.cl2.c.node.name);
                                genSign = ParametersLayoutViewUtilities.removeBlancks(e.cl1.c.node.stateid + "to" + e.cl2.c.node.stateid);
                                e.signature = genSign;
                                e.signatureNLS = genSign;
                            }
                        }
                    }
                }
            }

            return false;
        }

        function computeSignatureName(fromNode, toNode) {

            var i,
                oIDandName = [];

            oIDandName[0] = ParametersLayoutViewUtilities.removeBlancks(fromNode.stateid + "to" + toNode.stateid);
            oIDandName[1] = ParametersLayoutViewUtilities.removeBlancks(fromNode.name + "to" + toNode.name);

            for (i = 0; i < defaultTransitions.length; i++) {
                if ((defaultTransitions[i].sourceState === fromNode.stateid) &&
                        (defaultTransitions[i].targetState === toNode.stateid)) {
                    oIDandName[0] = defaultTransitions[i].name;
                    oIDandName[1] = defaultTransitions[i].name;
                    break;
                }
            }
            return oIDandName;
        }

        return exports;

    });

/*global define, widget, document, setTimeout, console*/
/*jslint plusplus: true*/
/*jslint nomen: true*/
define('DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/LifecycleView',
    [
        'UWA/Core',
        'UWA/Class/View',
        'egraph/core',
        'egraph/views',
        'egraph/iact',
        'egraph/utils',
        'DS/UIKIT/Input/Button',
        'DS/UIKIT/Input/ButtonGroup',
        'DS/UIKIT/Input/Select',
        'DS/UIKIT/Input/Toggle',
        'DS/UIKIT/Modal',
        'DS/UIKIT/Alert',
        'DS/UIKIT/Popover',
        'DS/UIKIT/Mask',
        'DS/UIKIT/Scroller',
        'DS/ParameterizationSkeleton/Utils/ParameterizationDataUtils',
        'DS/ParameterizationSkeleton/Views/ParametersLayoutViewUtilities',
        'DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/LifecycleViewUtilities',
        'DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/LifecycleEgraphUtilities',
        'DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/ParamStepGeometry',
        'DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/ParamNodeView',
        'DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/ParamTransitionsDrag',
        'DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/ParamEdgeView',
        'DS/ParameterizationSkeleton/Utils/ParameterizationWebServices',
        'i18n!DS/ParameterizationSkeleton/assets/nls/ParamSkeletonNLS'
    ],
    function (UWA, View,
              core, views, iact, utils,
              Button, ButtonGroup,Select, Toggle,
              Modal,
              Alert, Popover, Mask, Scroller,
              ParameterizationDataUtils,
              ParametersLayoutViewUtilities,
              LifecycleViewUtilities, LifecycleEgraphUtilities, StepGx, ParamNodeView, ParamTransitionsDrag,
              ParamEdgeView,
              ParameterizationWebServices,
              ParamSkeletonNLS) {

        'use strict';

        var extendedView;

        extendedView =  View.extend({
            tagName: 'div',
            className: 'generic-detail',

            init: function (options) {
                options = UWA.clone(options || {}, false);
                var GraphSettings   = ParameterizationDataUtils.paramStructBuilder("nodewidth,nodeheight,nodeSpacing");
                this.transitionElt  = ParameterizationDataUtils.paramStructBuilder("sourceState,targetState,name,nlsname,isCritical,isDeployed");
                this.stateElt       = ParameterizationDataUtils.paramStructBuilder("stateid,name,allLangNames,isCritical,isEnabled,isDeployed");

                this._parent(options);
                this.stepGeometry = new StepGx.ParamStepGeometry(10);//StepGeometry(10);
                this.grProps = new GraphSettings(180, 110, 320); //(150,100,200);   (180,110,250) 
                this.grph = null;
                this.nodes = [];
                this.contentDiv = null;
                this.userMessaging = null;
                this.userMessagingDrag = null;
                this.policyID = null;
                this.RulesModal = null;
                this.defaulttransitions = [];
                this.forbiddentransitions = [];
                this.defaultstates = [];
                this.rulesTableWdthArr = [15, 10, 10, 35, 20, 5, 5];
                this.errorMsgTime = 0;
                this.renameStates = true;
                this.modifyTopology = true;
                //IR-695253-3DEXPERIENCER2019x FD06, 20x FD01 
                this.lastDeployedStates = [];
                this.lastDeployedTransitions = [];
                this.lastDeployedChecks = [];
                LifecycleEgraphUtilities.addEdgeArrowDesign(widget);
            },

            setup: function(options) {
                UWA.log('LifecycleView::setup!');
                //this.listenTo(this.collection, "onSync", this.render);
                //var statesArray = this.collection._models[0]._attributes.states;

                /* //the good one
                this.listenTo(this.collection, {          
                    onSync: this.render,
                });*/
                UWA.log(options);
            },
            // in:render console.log(this.collection._models.keys());
            /*  var content = [];
            models.keys().forEach(function (key) {
                var value = this.collection._models.get(key);
                console.log("logggggggggggggggg::key = "+key+" and value = "+value);
            }, this);

            this.model.keys().forEach(function (key) {
                var value = this.model.get(key);
                console.log("key = "+key+" and value = "+value);          
            }, this);*/

            render: function () {
                UWA.log("LifecycleView::render");
                var LCChecksDiv, paramScroller, iDivs, contentDiv,
                    that = this;

                iDivs = that.rendereGraphElements();
                contentDiv = iDivs[0];

                Mask.mask(contentDiv);

                this.userMessaging = new Alert({
                    className : 'param-alert',
                    closable: true,
                    visible: true,
                    renderTo : document.body,
                    autoHide : true,
                    hideDelay : 1200,
                    messageClassName : 'warning'
                });

                this.userMessagingDrag = new Alert({
                    className : 'param-alert',
                    closable: true,
                    visible: true,
                    renderTo : document.body,
                    autoHide : true,
                    hideDelay : 1200,
                    messageClassName : 'warning'
                });

                this.renameStates = this.model.get("renameStates");
                this.modifyTopology = this.model.get("modifyTopology");


                //.inject(contentDiv);

                // create the graph

                //LifecycleViewUtilities.addApplyResetToolbar(contentDiv, this.applyParams, this.resetParamsinSession) ;  
                //à tester innerHeight: 516 innerWidth: 1875  outerHeight: 1032 outerWidth: 1920 */
                //UWA.log("policyID=" + that.model.get('id'));
                //UWA.log("width = " + wdth);

                //this.addApplyResetToolbar2(contentDiv);
                this.container.setContent(contentDiv);
                this.contentDiv = contentDiv;
                //FUN087047 : NZV : move LCChecksDiv initilization part of code to function onCompleteRequestTopology
                //LCChecksDiv = LifecycleViewUtilities.buildLifecycleChecksView(this.rulesTableWdthArr);

                //var insertDiv = document.getElementsByClassName("egraph_views_domroot")[0];//OK
                //var insertDiv = document.getElementById("egraph_views_domroot");
                //insertDiv.appendChild(LCChecksDiv);

                /*LCChecksDiv.inject(this.contentDiv);

                paramScroller = new Scroller({
                    element: LCChecksDiv
                }).inject(this.contentDiv);*/

                //this.listenTo(this.model.get('resultsColl'), "onSync", this.onModelLoaded);
                //that.listenTo(that.collection, "onSync", that.onCompleteRequestTopology());

                //the good one 
                this.listenTo(this.collection, {
                    onSync: that.onCompleteRequestTopology
                });

               // this.onCompleteRequestTopology();
                return this;
            },

            rendereGraphElements : function () {

                var sm, that, wdth, hgth, newWdth, newhgth, vpt, transitionDragHandler,
                    canvas,
                    currDate, currTime, diffDate,
                    iDivs =  LifecycleEgraphUtilities.addeGraphDivs();

                canvas = iDivs[1];

                this.grph = new core.EGraph();
                this.grph.nodeSpacing = this.grProps.nodeSpacing;//200

                // add the main view of the graph in 'graph_canvas' div using a
                // HTMLGraphView view to have default display                               
                this.grph.addView('main', new views.HTMLGraphView(canvas));//('main', new views.HTMLGraphView(document.querySelector('#graph_canvas')));

                that = this;
                // instantiate a default state machine to handle mouse & touch interactions
                sm = new iact.StateMachine(this.grph, null, null, this.grph.views.main);

                // override onmousedown to prevent any stopPropagation & preventDefault 
                // to happen and to make sure we don't manipulate the graph when dragging
                // the selection of an input element
                sm.rootState.onmousedown = (function (old_onmousedown) {
                    return function onmousedown(sm, data) {
                        var old_ret, ret;

                        if (data.button === iact.Buttons.LEFT &&
                                data.modifiers === 0 &&
                                data.dom && data.dom.tagName === 'INPUT') {
                            if (data.grElt !== undefined) {
                                if (!sm.graph.isSelected(data.grElt)) {
                                    sm.graph.updateLock();
                                    try {
                                        sm.graph.replaceSelectionWith(data.grElt);
                                        if (data.grElt.bringToFront) {
                                            data.grElt.bringToFront();
                                        }
                                    } finally {
                                        sm.graph.updateUnlock();
                                    }
                                    // after reparenting the focus is not given back to the input
                                    setTimeout(data.dom.focus.bind(data.dom), 0);
                                }
                            }
                            return { state: {
                                onmouseup: function (sm, data) {
                                    if (data.button === iact.Buttons.LEFT) {
                                        return {
                                            state: null
                                        };
                                    }
                              // FIXME: if undefined it should be considered empty
                                    return {};
                                }
                            }};
                        }

                        // by default disable the consumption
                        old_ret = old_onmousedown.apply(this, arguments);
                        if (old_ret) {
                            ret = {};
                            Object.keys(old_ret).forEach(function (k) {
                                if (k !== 'consume') {
                                    ret[k] = old_ret[k];
                                }
                            });
                            return ret;
                        } else {
                            return old_ret;
                        }
                    }
                }(sm.rootState.onmousedown));

                sm.rootState.newDragForElement = function(grph, elt, subElt) {
                    //var drag;
                    /*
                    EGRAPH      number  0   Object is a module:egraph/core.EGraph
                    NODE        number  1   Object is a module:egraph/core.Node
                    GROUP       number  2   Object is a module:egraph/core.Group
                    CONNECTOR   number  3   Object is a module:egraph/core.Connector
                    EDGE        number  4   Object is an module:egraph/core.Edge
                    */
                    if (elt.type === core.Type.CONNECTOR) {
                        UWA.log("CONNECTOR");
                        if (that.modifyTopology) {
                            transitionDragHandler = new ParamTransitionsDrag.ParamTransitionsDrag(grph, elt, that.userMessagingDrag, that.defaulttransitions, that.forbiddentransitions);
                            that.handledeployIndicator();
                            return transitionDragHandler;
                        }
                        currDate = new Date();
                        currTime = currDate.getTime();
                        diffDate = currTime - that.errorMsgTime;
                        if (diffDate >= 1400) {
                            that.errorMsgTime = currTime;
                            that.userMessagingDrag.add({className: "warning", message: ParamSkeletonNLS.TopologyNotModifiable});
                        }
                        return null;//non modifiyable topology
                    }
                    if (elt.type === core.Type.NODE) {
                       /* if (elt.stateid == "controlBox")
                            return iact.DefaultRootState.prototype.newDragForElement.apply(this, arguments);
                        else*/
                        LifecycleEgraphUtilities.removePropsNode();
                        return null;
                    }

                    if (elt.type === core.Type.EDGE) {
                        UWA.log("edge");
                        that.highlightMatchingChecksInTable(elt.cl1.c.node.stateid, elt.cl2.c.node.stateid);
                        LifecycleEgraphUtilities.buildpropsNode.call(that, elt, that.RenameTransition.bind(that));
                        return iact.DefaultRootState.prototype.newDragForElement.apply(this, arguments);
                    } else {
                        // by default we reuse the DefaultRootState's implementation
                        UWA.log("drag::else");
                        //UWA.log(this);
                        return iact.DefaultRootState.prototype.newDragForElement.apply(this, arguments);
                    }
                };

                //utils.inherit(PropsView, views.HTMLNodeView); //ZUR Desactivate
                /*utils.inherit(ChecksListView, views.HTMLNodeView);*/
                /* edge.prototype.onselect = function(e, selected){
                    if (selected) 
                        return (selectNode(e));  
                    };*/
                wdth = this.grph.views.main.domRoot.clientWidth;
                hgth = this.grph.views.main.domRoot.clientHeight;
                newWdth = 600 + (wdth / 2);
                newhgth = 300 + (hgth / 2);
                vpt = utils.changeViewpointScale(this.grph.views.main.vpt, 0.81, [ newWdth, newhgth ], false);//0.75
                //Handling view point 
                this.grph.views.main.setViewpoint(vpt, true);

                return iDivs;

            },

            onCompleteRequestTopology : function () {
                var deployStsDiv,
                    that = this,
                    statesArray = LifecycleViewUtilities.sortArrayByKey(this.collection._models[0]._attributes.states, "visuOrder"),
                    transitionsArray = this.collection._models[0]._attributes.transitions,
                    areAllChecksDeployed = true,
                    deployIndicatorSts = true, LCChecksDiv, paramScroller;

                UWA.log("onCompleteRequestTopology");
                //var statesArray = this.collection._models[0]._attributes.states;
                //FUN087047 
                that.grph.appCategory = this.collection._models[0]._attributes.appCategory;
                if (that.grph.appCategory === "CBP") {
                    this.rulesTableWdthArr = [15, 10, 10, 30, 10, 15, 5, 5];
                } else {
                    this.rulesTableWdthArr = [15, 10, 10, 35, 20, 5, 5];
                }
                LCChecksDiv = LifecycleViewUtilities.buildLifecycleChecksView(this.rulesTableWdthArr, this.grph.appCategory);
                LCChecksDiv.inject(this.contentDiv);
                
                paramScroller = new Scroller({
                    element: LCChecksDiv
                }).inject(this.contentDiv);
				//IR-905184-3DEXPERIENCER2022x                
                this.addApplyResetToolbar2(this.contentDiv);
                if ((this.nodes !== null) && (this.nodes.length === 0)) {

                    that.policyID = that.collection._models[0]._attributes.id;

                    deployIndicatorSts = that.buildLifecycleGraph(statesArray, transitionsArray);

                    areAllChecksDeployed = that.showCurrentLifecycleChecksList(that.collection._models[0]._attributes.checks,
                                                        that.collection._models[0]._attributes.types);

                    if (!areAllChecksDeployed) { deployIndicatorSts = false; }

                    deployStsDiv = LifecycleViewUtilities.addDeployIndicator(deployIndicatorSts);
                    deployStsDiv.inject(that.contentDiv);
                    //IR-729629-3DEXPERIENCER2020x   
                    this.lastDeployedChecks = LifecycleViewUtilities.getCurrentChecks(this.contentDiv, this.grph.appCategory);

                    Mask.unmask(that.contentDiv);
                }
            },

            buildLifecycleGraph : function (statesArray, transitionsArray) {
                function getUserLangValue(allLangNames) {
                    let ret = allLangNames;
                    let aAllLangNames = allLangNames.split(",");
                    let lang = widget.lang;
                    if(lang == "zh") {
                        lang = "zh-CN";
                    }

                    for(let i = 0; i < aAllLangNames.length; i++) {
                        let aValueAndLang = aAllLangNames[i].split("~");

                        if(aValueAndLang[1] == lang) {
                            return aValueAndLang[0];
                        }
                    }
                    return ret;
                }

                var i, defTRcounter, forbiddenTRcount, deployIndicatorSts,
                    defstateCount = 0,
                    stateCount = 0,
                    xStart = 5,
                    xIncr = this.grph.nodeSpacing,
                    that = this;

                for (i = 0; i < statesArray.length; i++) {
                    if (statesArray[i].isDefault.toString() === "false") {
                        that.nodes[stateCount++] = that.lifecycleStateNode(statesArray[i].id, statesArray[i].stateUserName,
                                                                    statesArray[i].isCritical, statesArray[i].isEnabled,
                                                                    xStart, 40, this.grProps);
                        if (statesArray[i].isDeployed !== true) {
                            deployIndicatorSts = false;
                            that.nodes[stateCount - 1].modifiedValue = that.nodes[stateCount - 1].allLangNames;
                        } else { //IR-695253-3DEXPERIENCER2019x FD06, 20x FD01
                            that.lastDeployedStates.push(statesArray[i]);
                        }
                        //this.nodes[stateCount++] = LifecycleViewUtilities.newMixNode(statesArray[i].id, statesArray[i].stateUserName, xStart, 40, this.grProps);                                       
                        xStart = xStart + xIncr;
                    } else {
                        /*this.defaultnodes[defstateCount] =  this.tempMixNode(statesArray[i].id, statesArray[i].stateUserName, 
                                                                    statesArray[i].isCritical, statesArray[i].isEnabled,
                                                                    xdefStart, 40, this.grProps); 
                        xdefStart = xdefStart + xIncr;*/
                        this.defaultstates[defstateCount++] = new this.stateElt(statesArray[i].id, getUserLangValue(statesArray[i].stateUserName), statesArray[i].stateUserName,
                                                                             statesArray[i].isCritical, statesArray[i].isEnabled,
                                                                             false);
                    }
                }
                //this.nodes[stateCount++] = propertiesNode("controlBox",-70, 220);              
                //this.nodes[stateCount++] = ChecksNode("controlBox",550, 220);   
                // add the nodes and an edge; we lock the graph update to only do
                // one update when all nodes will have been added          
                this.grph.updateLock();
                try {
                        // adding the nodes
                    this.nodes.forEach(function (n) {
                        if (n.isEnabled == "true") {
                            that.grph.addNode(n);
                        } else {
                            UWA.log(n);
                        }
                    });
                    // We could have used 'children' property on nodes but this would have been 
                    // less readable than using names in that configuration. This is the added
                    // value of having custom data on nodes depending on the type of graph. 

                    defTRcounter = 0;
                    forbiddenTRcount = 0;
                    //<Transition name="ToRelease" sourceState="IN_WORK" targetState="RELEASED" isDefault="false" isForbidden="false" isCritical="false"/>
                    for (i = 0; i < transitionsArray.length; i++) {
                        if ((transitionsArray[i].isDefault.toString() === "false") && (transitionsArray[i].isForbidden.toString() === "false")) {
                            //this line replaced a lot
                            that.drawtransition(transitionsArray[i], that.grph.nodes);

                            if (transitionsArray[i].isDeployed !== true) {
                                deployIndicatorSts = false;
                            } else {//IR-695253-3DEXPERIENCER2019x FD06, 20x FD01
                                that.lastDeployedTransitions.push(transitionsArray[i]);
                            }

                        } else if (transitionsArray[i].isDefault.toString() === "true") {
                            this.defaulttransitions[defTRcounter++] = new that.transitionElt(transitionsArray[i].sourceState, transitionsArray[i].targetState,
                                                                                                transitionsArray[i].name, transitionsArray[i].nlsname,
                                                                                                transitionsArray[i].isCritical, false);
                        } else if (transitionsArray[i].isForbidden == "true") {
                            this.forbiddentransitions[forbiddenTRcount++] = new that.transitionElt(transitionsArray[i].sourceState, transitionsArray[i].targetState,
                                                                                                transitionsArray[i].name, transitionsArray[i].name,
                                                                                                false, false);
                        }
                    }
                } finally {
                    this.grph.updateUnlock();
                }

                return deployIndicatorSts;
            },

            //show: function () {},
            addNewEdge : function (stub, iSignature, iSignatureNLS, isCritical, c1, c2) {
                 //var edge = this.buildEdge(stub);    
                var edge = ParamEdgeView.buildEdge(stub, iSignature);
                edge.signature = iSignature;
                edge.signatureNLS = iSignatureNLS;
                edge.DeployedSig = iSignatureNLS; //IR-695253-3DEXPERIENCER2019x FD06, 20x FD01
                edge.isCritical = isCritical;
                this.grph.addEdge(c1, c2, edge);// add the edge to the graph
                return edge;
            },

            handleRenamingIssues : function(iNode, that, iEnteredName) {
                //UWA.log(iNode);
                var errorMsg, currDate, currTime, diffDate,
                    checkNameResult;
                    //IR-695253-3DEXPERIENCER2019x FD06, 20 FD01
                if ((iEnteredName != null) /*&&  (iEnteredName != "")*/) {// && (enteredname!=previousName)
                    checkNameResult = that.testStateNamingRules(iNode, iEnteredName, that);
                    if (checkNameResult === "ok") {
                        that.renameSelectedState(that, iNode.stateid, iEnteredName);
                        iNode.views.main.display.elt.removeClassName("my-error-node");
                        that.handledeployIndicator();
                        LifecycleViewUtilities.enableApplyButton(that.contentDiv);
                    } else { //IR-695253-3DEXPERIENCER2019x FD06, 20x FD01
                        errorMsg = ParamSkeletonNLS.SpecialCharactersMessage;
                        if (checkNameResult === "alreadyUsedName") { errorMsg = ParamSkeletonNLS.StateNameAlreadyUsed; }
                        if (checkNameResult === "emptyString") { errorMsg = ParamSkeletonNLS.EmptyValueNotAllowed; }
                        currDate = new Date();
                        currTime = currDate.getTime();
                        diffDate = currTime - that.errorMsgTime;
                        if (diffDate >= 1400) {
                            that.errorMsgTime = currTime;
                            that.userMessaging.add({className: "error", message: errorMsg});
                        }
                        iNode.views.main.display.elt.addClassName("my-error-node");
                        LifecycleViewUtilities.disableApplyButton(that.contentDiv);
                    }
                }
            },

            testStateNamingRules : function (iNode, enteredname, that) {
                var e;
                //IR-695253-3DEXPERIENCER2019x FD06, 20x FD01 : added test for empty state name
                let valueAndLangs = enteredname.split(",");
                for(let i = 0; i < valueAndLangs.length; i++) {
                    let item = valueAndLangs[i];
                    function getLangValue(name, lang) {
                        let ret = '';
            
                        if(name != null) {
                            let langValues = name.split(",");
                            langValues.forEach((value) => {
                                let valueAndLang = value.split("~");
                                if(valueAndLang.length == 2) {
                                    if(valueAndLang[1] == lang) {
                                        ret = valueAndLang[0];
                                    }
                                }
                            });
                
                        }
            
                        return ret;
                    }

                    let valueAndLang = item.split("~");
                    let value = valueAndLang[0].trim();
                    let lang = valueAndLang[1];
                    if(value.length === 0) {
                        return "emptyString";
                    }

                    for (e = that.grph.nodes.first; e; e = e.next) {
                        if ((getLangValue(e.allLangNames, lang) === value) && (e.stateid != iNode.stateid)) {
                            return "alreadyUsedName";
                        }
                    }

                    if (ParametersLayoutViewUtilities.testSpecialCharacters(value)) { return "specialCharacterName"; }
                }
                
                return "ok";
            },

            renameSelectedState : function(that, stateid, newStateName) {
                var e, i,
                    tbodyref = that.contentDiv.getElements('.paramtbody')[0],
                    listofLines = tbodyref.children,
                    nbofLines = listofLines.length;
                function replaceLangValues(node, newStateName) {
                    let valueAndLangs = node.allLangNames.split(",");
                    let newValueAndLangs = newStateName.split(",");
                    let aNewName = [];

                    valueAndLangs.forEach((item) => {
                        let valueAndLang = item.split("~");
                        newValueAndLangs.forEach((itemNew) => {
                            let newValueAndLang = itemNew.split("~");
                            if(newValueAndLang[1] == valueAndLang[1]) {
                                valueAndLang = newValueAndLang;
                            } 
                        });
                        aNewName.push(valueAndLang[0] + "~" + valueAndLang[1]);
                    });

                    node.allLangNames = aNewName.join(",");

                }
                function getLangValue(allLangValues) {
                    let lang = widget.lang;
                    if(lang == "zh") {
                        lang = "zh-CN";
                    }
                    let aAllLangValues = allLangValues.split(",");

                    let ret = "";
                    aAllLangValues.forEach((item) => {
                        let aValueAndLang = item.split("~");
                        if(aValueAndLang[1] == lang) {
                            ret = aValueAndLang[0];
                        }
                    });

                    return ret;
                }

                let lang = widget.lang;
                if(lang == "zh") {
                    lang = "zh-CN";
                }

                for (e = that.grph.nodes.first; e; e = e.next) {
                    if (e.stateid == stateid) {
                        replaceLangValues(e, newStateName);
                        e.modifiedValue = newStateName;
                        //e.name = newStateName;
                        if(newStateName.contains("~" + lang)) {
                            e.views.main.display.elt.getElementsByTagName("td")[0].setContent(getLangValue(newStateName));
                            e.views.main.display.elt.getElementsByTagName("td")[0].setAttribute("title", getLangValue(newStateName));
                        }

                        break;
                    }
                }

                for (i = 2; i < nbofLines; i++) {
                    if(newStateName.contains("~" + lang)) {
                        if (listofLines[i].cells[1].value === stateid) {
                            listofLines[i].cells[1].children[0].innerText = getLangValue(newStateName);
                        }
    
                        if (listofLines[i].cells[2].value === stateid) {
                            listofLines[i].cells[2].children[0].innerText = getLangValue(newStateName);
                        }    
                    }
                }
            },

            testTransitionRenamingRules : function (newName) {

                if (this.grph.appCategory === "VPM") { //IR-695253-3DEXPERIENCER2019x FD06, 20x FD01
                    newName = newName.trim();
                    if(newName.length === 0) {
                        return "emptyString";
                    }
                }
                if (ParametersLayoutViewUtilities.testSpecialCharacters(newName)) { return "specialCharacterName"; }
                return "S_OK";
            },
            //IR-695253-3DEXPERIENCER2019x FD06, 20x FD01 : function signature change
            RenameTransition : function (elt, iElm, isOnFinalChange) {
                var currDate, currTime, diffDate, errorMsg, testResult, iValue = iElm.getValue();
                testResult = this.testTransitionRenamingRules(iValue);
                if (testResult === "S_OK") {
                    elt.signatureNLS = iValue; //elt.signature = iValue;
                    this.handledeployIndicator();
                    LifecycleViewUtilities.enableApplyButton(this.contentDiv);
                } else {
                    if (testResult === "specialCharacterName") {
                        errorMsg = ParamSkeletonNLS.SpecialCharactersMessage;
                    } else {
                        errorMsg = ParamSkeletonNLS.EmptyValueNotAllowed;
                         elt.signatureNLS = elt.DeployedSig;//IR-695253-3DEXPERIENCER2019x FD06, 20x FD01
                    }
                    LifecycleViewUtilities.disableApplyButton(this.contentDiv);

                    currDate = new Date();
                    currTime = currDate.getTime();
                    diffDate = currTime - this.errorMsgTime;
                    if (diffDate >= 1400) {
                        this.errorMsgTime = currTime;
                        this.userMessaging.add({className: "error", message: errorMsg});
                    }

                    if (isOnFinalChange) {
                        LifecycleViewUtilities.enableApplyButton(this.contentDiv);
                        LifecycleEgraphUtilities.removePropsNode();
                    }
                }
            },


            /*handleSignatureOnRename : function (elt, iValue) {
                var currLabel, 
                    that = this;

            if (that.model.get("modifyTopology")) {
                currLabel = elt.signature;         
                 
                if (iValue !== null) {                                       
                    if (testNameForSpecialChar(enteredname)==true)
                    {   
                        alert("<SpecialCharactersMessage>");
                        return;
                    }
                    
                    var policyType = currPolicyDescriptor.appType;                  
                    
                    if ( (policyType == "VPM") && (testNameForBlankChar(enteredname)==true)) {
                        UWA.log("<blankCharactersMessage>");           
                        return;
                    }
                    
                    if (enteredname !== "") {                                   
                       elt.signature = iValue;
                    }
                }                       
            },*/

            /*
            function testNameForBlankChar(iString) {   
                var iChars =" ";
                for (var i = 0; i < iString.length; i++)                        
                    if (iChars.indexOf(iString.charAt(i)) != -1)    
                        return true;
                
                return false;       
            }
            
            function trimGeneratedName(iString) {
                return(iString.replace(/ /g,''));
            }               
            }*/


             /**
             * Factory of node with two inputs and one output (a 'mix' node)
             * @param {number} x
             * @param {number} y
             * @returns {module:egraph/core.Node} the new node
             */
            lifecycleStateNode : function (nodeid, nlsName, isCritical, isEnabled, x, y, graphProps) {
                var stateNodeView,
                    node = new core.Node(),  // create the node
                    offset;

                function getUserLangValue(allLangNames) {
                    let aValueAndLangs = allLangNames.split(",");

                    for(let i = 0; i < aValueAndLangs.length; i++) {
                        let aValueAndLang = aValueAndLangs[i].split("~");
                        let lang = widget.lang;
                        if(lang == "zh") {
                            lang = "zh-CN";
                        }
                        if(aValueAndLang[1] == lang) {
                            return aValueAndLang[0];
                        }
                    }
                    return allLangNames;
                }
                //  node.views.main = new fctNodeView();//new views.HTMLNodeView();//default      
                // ParamNodeView.ParamNodeView.bind(this);
                // var myView = new ParamNodeView.ParamNodeView(that.handleRenamingIssues).bind(this);
                // utils.inherit(myView, views.HTMLNodeView);

                stateNodeView  = new ParamNodeView.ParamNodeView(this, this.renameStates, this.modifyTopology);
                //stateNodeView  = ParamNodeView.ParamNodeView.call(this, this, this.model.get("renameStates"), this.model.get("modifyTopology"));

                node.views.main = stateNodeView;//new views.HTMLNodeView();//default           
                node.data = {};//object will be used to store references to connectors
                node.stateid = nodeid;
                node.name = getUserLangValue(nlsName);
                node.allLangNames = nlsName;
                node.isCritical = isCritical;
                node.isEnabled  = isEnabled;
                // use multiset to force the dispatch of properties change notifications
                // to group all modifications of nodes properties (useless here since
                // nobody listen to the node yet; but good to keep in mind)
                node.multiset('left', x,
                              'top', y,
                              'width', graphProps.nodewidth,
                              'height', graphProps.nodeheight);

                // create connectors and store their eferences in the data object of the node
                offset = Math.round(graphProps.nodeheight / 2);
                node.data.left = LifecycleEgraphUtilities.createConnector(core.BorderCstr.LEFT, offset);
                node.appendConnector(node.data.left);
                node.data.right = LifecycleEgraphUtilities.createConnector(core.BorderCstr.RIGHT, offset);
                node.appendConnector(node.data.right);

                offset = Math.round(graphProps.nodewidth / 2);
                node.data.top = LifecycleEgraphUtilities.createConnector(core.BorderCstr.TOP, offset);
                node.appendConnector(node.data.top);
                node.data.bottom = LifecycleEgraphUtilities.createConnector(core.BorderCstr.BOTTOM, offset);
                node.appendConnector(node.data.bottom);
                return node;
            },

            buildEdge : function (stub) {
                var edge = new core.Edge(),
                    currstepGeometry = new StepGx.ParamStepGeometry(stub);//   StepGeometry(stub);  
                // autoBezierGeometry.minTangentLength = autoBezierGeometry.minTangentLength+20;             
                // edge.set('geometry', autoBezierGeometry);

                UWA.log("Setting stepGeometry.stubScenario = " + currstepGeometry.stubScenario);
                edge.set('geometry', currstepGeometry);
                 //edge.views.main = new views.SVGEdgeView();
                edge.views.main = new views.SVGEdgeView('arrow-edge');

                //edge.views.main = new LabelEdgeView.LabelEdgeView();
                return edge;
            },

            showCurrentLifecycleChecksList : function(iListofChecks, iListofTypes) {
                var i, iTypeNLS, additionalinfoNLS,
                    tbodyref = this.contentDiv.getElements('.paramtbody'),//tbodytest = this.contentDiv.getElements('tbody');
                    nbofChecks = iListofChecks.length,
                    allChecksDeployed = true;

                for (i = 0; i < nbofChecks; i++) {
                    iTypeNLS = this.getTypeNLS(iListofChecks[i].objType, iListofTypes);
                    //additionalInfoNLS = ParamSkeletonNLS.ConsiderChildType + ":" + complementarySelect.getSelection()[0].label;
                    additionalinfoNLS = iListofChecks[i].additionalProps;

                    if ((iListofChecks[i].ruleID === "RejectIfAnyOfTheCommonlyGovernedChildNotOnTargetState") ||
                            (iListofChecks[i].ruleID === "RejectIfAttributeNotValuated")) {
                        if (iListofChecks[i].additionalProps === "ALL") {//NZV:IR-541898 
                            additionalinfoNLS = ParamSkeletonNLS.ConsiderKey.format(ParamSkeletonNLS.AllChildrenTypes);
                        } else {
                            additionalinfoNLS = ParamSkeletonNLS.ConsiderKey.format(this.getTypeNLS(iListofChecks[i].additionalProps, iListofTypes));
                        }
                    }
                    //FUN087047 : added promote
                    this.addChecktoTable(tbodyref[0],
                        iListofChecks[i].objType, iTypeNLS,
                        iListofChecks[i].sourceState, this.getUserStateNameforNode(this.grph.nodes, iListofChecks[i].sourceState),
                        iListofChecks[i].targetState, this.getUserStateNameforNode(this.grph.nodes, iListofChecks[i].targetState),
                        iListofChecks[i].ruleID,
                        iListofChecks[i].additionalProps, additionalinfoNLS,
                        iListofChecks[i].isDeployed, iListofChecks[i].promote);

                    if (!iListofChecks[i].isDeployed) { allChecksDeployed = false; }
                }
                //BuildInitialTable
                return allChecksDeployed;
            },

            getTypeNLS : function (iType, iTypesList) {
                var i;
                for (i = 0; i < iTypesList.length; i++) {
                    if (iTypesList[i].typeID === iType) {
                        return iTypesList[i].typeNLS;
                    }
                }
                return iType;//nothin found, returning original
            },

            addChecktoTable : function(tableID, iTypeID, iTypeNLS, ifromStateID, ifromStateNLS, itoStateID, itoStateNLS, iRuleID, iAdditionalInfo, iAdditionalInfoNLS, isDeployed, iPromote) {
                var ruleTextID, ruleTooltipID, rulePop,
                    iRuleNLS, iRuleTooltip,
                    iCell, lineCheck,
                    iAdditionalInfoUI,
                    deleteSpan, removeLCCheckButton, deletePop,
                    iconChoice = 'cog',
                    k = 0,
                    that = this,
                    iconColor = "orange",//to isDeployed
                    ititle = ParamSkeletonNLS.NotYetDeployed, //NZV:IR-613083-3DEXPERIENCER2019x
                    removelts = [];

                lineCheck = UWA.createElement('tr').inject(tableID); //Adding the line (type)                
                iCell = UWA.createElement('td', {
                    'width' : that.rulesTableWdthArr[k++].toString() + '%',
                    'Align' : 'left'
                }).inject(lineCheck);//object type

                iCell.value = iTypeID;
                UWA.createElement('p', {text: iTypeNLS, 'class': ''}).inject(iCell);

                iCell = UWA.createElement('td', {
                    'width' : that.rulesTableWdthArr[k++].toString() + '%',
                    'Align' : 'left'
                }).inject(lineCheck);//sourceState   

                iCell.value = ifromStateID;
                UWA.createElement('p', {text: ifromStateNLS, 'class': ''}).inject(iCell);

                iCell = UWA.createElement('td', {
                    'width' : that.rulesTableWdthArr[k++].toString() + '%',
                    'Align' : 'left'
                }).inject(lineCheck);//target state   

                iCell.value = itoStateID;
                UWA.createElement('p', {text: itoStateNLS, 'class': ''}).inject(iCell);

                ruleTextID = iRuleID + "Text";
                ruleTooltipID = iRuleID + "Tooltip";
                iRuleNLS = ParamSkeletonNLS[ruleTextID];
                iRuleTooltip = ParamSkeletonNLS[ruleTooltipID];

                iCell = UWA.createElement('td', {
                    'width' : that.rulesTableWdthArr[k++].toString() + '%',
                    'Align' : 'left'
                }).inject(lineCheck);//Rule

                iCell.value = iRuleID;
                UWA.createElement('p', {text: iRuleNLS, 'class': ''}).inject(iCell);
                /*
                var ruleSpan = UWA.createElement('span', {
                                'class' : 'fonticon fonticon-info'        
                            }).inject(iCell);       
                ruleSpan.setStyle("color", "black") ;  */
                rulePop = new Popover({
                    target: iCell,
                    trigger : "hover",
                    animate: "true",
                    position: "top",
                    body: iRuleTooltip,
                    title: ''//iParamObj.nlsKey
                });
                //FUN087047 : Promote option only for ER policies
                if (that.grph.appCategory === "CBP") {
                    if (iPromote !== undefined) {
                        iCell = UWA.createElement('td', {
                            'width' : that.rulesTableWdthArr[k++].toString() + '%',
                            'Align' : 'left'
                        }).inject(lineCheck);//Rule

                        iCell.value = iPromote;
                        
                        if(iPromote === false) {
                            UWA.createElement('p', {text: ParamSkeletonNLS.Demote, 'class': ''}).inject(iCell);
                        } else {
                            UWA.createElement('p', {text: ParamSkeletonNLS.Promote, 'class': ''}).inject(iCell);
                        }
                    }
                }
                //iAdditionalInfo
                iCell = UWA.createElement('td', {
                    'width' : that.rulesTableWdthArr[k++].toString() + '%',
                    'Align' : 'left'
                }).inject(lineCheck);

                iCell.value = iAdditionalInfo;
                iAdditionalInfoUI = iAdditionalInfoNLS;

                if (iAdditionalInfo === "NOINFO") { iAdditionalInfoUI = ""; }

                UWA.createElement('p', {text: iAdditionalInfoUI, 'class': ''}).inject(iCell);

                iCell = UWA.createElement('td', {
                    'width' : that.rulesTableWdthArr[k++].toString() + '%',
                    'Align' : 'left'
                }).inject(lineCheck);
				
				//NZV - IR-666515-3DEXPERIENCER2019x
				removelts = ParametersLayoutViewUtilities.createActionElements(ParamSkeletonNLS.removePromotionRuleTxt, true);
				deleteSpan = removelts[0];
				deleteSpan.inject(iCell);
				removeLCCheckButton = removelts[1];
				deletePop = removelts[2];

				//CRK block the removal for ApplyRouteTemplate specific kind of rule. This should be moved to a configuration file somewhere, but for FD01 it is needed:
				if(iRuleID == 'ApplyRouteTemplate') {
					removeLCCheckButton.setIcon("block");
					removeLCCheckButton.disable();
					deletePop.setBody(ParamSkeletonNLS.removePromotionRuleBlockedByRouteTemplateTxt);
				} else {
					if(removeLCCheckButton) {
						removeLCCheckButton.addEvent("onClick", function () {
							deletePop.destroy();
							lineCheck.remove();
							that.handledeployIndicator();
						});
					}					
				}

                if (isDeployed === true) {
                    iconColor = "green";
                    ititle = ParamSkeletonNLS.Deployed; //NZV-IR-628927-3DEXPERIENCER2019x
                    iconChoice = 'check';
                } else if (isDeployed === false) {
                    iconColor = "orange";
                } else {//"newcheck"
                    lineCheck.addClassName("info");
                /* lineCheck.scrollIntoView(true);////lineCheck.focus();
                    iCell0.scrollIntoView(); iCell0.scrollIntoView(true);*/ //IE pas terrible du tout
                    //lineCheck.scrollTop = tableID.scrollHeight;
                    //lineCheck.parentNode.scrollTop = lineCheck.offsetTop; // marche pas
                }

                iCell = ParametersLayoutViewUtilities.buildImgCell(iconChoice, '1.5', iconColor, ititle, that.rulesTableWdthArr[k++].toString() + '%', 'center');
                iCell.inject(lineCheck);
                iCell.value = isDeployed;

                /* iCell = UWA.createElement('td', {
                    'Align' : 'center'
                    // 'title' : ititle,
                }).inject(lineCheck);
                
                removePop = new Popover({
                    class: 'parampopover',
                    target: iCell,
                    trigger : "hover",
                    animate: "true",
                    position: "top",
                    body: ititle,
                    title: ''//iParamObj.nlsKey
                });

                removeCheckButton = new Button({
                    className: 'close',
                    id  : 'togglepropsBox',
                    icon: 'fonticon fonticon-cancel fonticon-1.5x',//value: 'Button', //fonticon-cancel  fonticon-minus-circled    
                    attributes: {
                        disabled: false,
                        'aria-hidden' : 'true'
                    //  text : ParamWdgNLS.Apply 
                    },
                    events: {
                        onClick: function () {
                               //selectedObjpropsDiv.setStyle("visibility", "hidden");
                            removePop.destroy();
                            lineCheck.remove();
                            that.handledeployIndicator();
                        }
                    }
                }).inject(iCell);*/


                //removeCheckButton.getContent().setStyle("color", iconColor);//"#1D7294"
            },

            highlightMatchingChecksInTable : function (iSourceState, iTargetState) {
                var i,
                    tbodyref = this.contentDiv.getElements('.paramtbody')[0],
                    listofLines = tbodyref.children,
                    nbofLines = listofLines.length;

                LifecycleViewUtilities.clearPreviousChecksHighlighting(listofLines);

                for (i = 2; i < nbofLines; i++) {
                    if ((listofLines[i].cells[1].value === iSourceState)
                            && (listofLines[i].cells[2].value === iTargetState)) {
                        listofLines[i].addClassName("info");//info
                    }
                }
            },

            /*getNodeIndex : function (iNodes, iNodeID) {
                var i,
                    nodesLength = iNodes.length;
                for (i = 0; i < nodesLength; i++) {
                    if (iNodes[i].stateid == iNodeID) {
                        return i;
                    }
                }
                return -1;
            },*/

            getUserStateNameforNode: function(iNodeList, iNodeID) {
                var userStateName = iNodeID,
                    matchingNode = LifecycleViewUtilities.getMatchingNode(iNodeList, iNodeID);

                if (matchingNode !== null) { userStateName = matchingNode.name; }
                return userStateName;
            },

            applyParams : function () {
                var e, i, itr,
                    stateslist, transitionList,
                    iRemStates, nbofRemovedStates,
                    datatoSend,
                    that = this,
                    state = [],
                    transition = [], isSomethingChanged = false, isAnyChangedInTransition = false,
                    isAnyChangeInStates = false, isAnyChangeInChecks = false, countSameTranistion = 0,
                    j = 0, sameCheckCount = 0, tbodyreflist, imgCell;

                if (this.checksBeforeDeploy()) {
                    stateslist = that.grph.nodes;
                    //
                    for (e = stateslist.first; e; e = e.next) {
                        if (e.modifiedValue) {
                            state.push({
                                id: e.stateid,
                                stateUserName :  e.modifiedValue,
                                isCritical : e.isCritical == "false" ? false : true,
                                isEnabled : true
                            });
                            isAnyChangeInStates = true;
                            e.modifiedValue = undefined;
                        }
                    }
                    //Check For Deleted States
                    iRemStates = this.getRemovedStatesList();
                    nbofRemovedStates = iRemStates.length;

                    for (i = 0; i < nbofRemovedStates; i++) {
                        let stateName = iRemStates[i].name;
                        if(!stateName.contains("~")) {
                            let lang = widget.lang;
                            if(lang == "zh") {
                                lang = "zh-CN";
                            }

                            stateName = stateName + "~" + lang;
                        }
                        state.push({
                            id : iRemStates[i].stateid,
                            stateUserName:  stateName,
                            isCritical : iRemStates[i].isCritical === "false" ? false : true,
                            isEnabled : false
                        });
                    }

                    transitionList = that.grph.edges;
                    for (itr = transitionList.first; itr; itr = itr.next) {
                        transition.push({
                            name : itr.signature,
                            nlsname : itr.signatureNLS,
                            sourceState : itr.cl1.c.node.stateid,
                            targetState : itr.cl2.c.node.stateid,
                            isCritical  : itr.isCritical.toString() == "false" ? false : true
                        });
                    }
                    //ZUR IR-712839-3DEXPERIENCER2020x : .toString()
                    //NZV IR-695253-3DEXPERIENCER2019x FD06  20x FD01: Checkng for any modification
                    if(true) {
                         //Check addition & removal of state
                        //if(this.lastDeployedStates.length !== state.length) {
                            //Modification in number of transitions 
                            //isAnyChangeInStates = true;
                        //}
                        //Check NLS name change for states
                        if(isAnyChangeInStates !== true) {
                            //further test
                            for(i = 0; i <  state.length; i++) {
                                
                                for(j = 0; j < this.lastDeployedStates.length; j++) {
                                    if (state[i].id === this.lastDeployedStates[j].id) {
                                        if(state[i].stateUserName === this.lastDeployedStates[j].stateUserName ) {
                                            isAnyChangeInStates = false;
                                            break;
                                        } else {
                                            isAnyChangeInStates = true;
                                             break;
                                        }
                                       
                                    }
                                }
                                if(isAnyChangeInStates === true) {
                                    break;
                                }
                            }
                        }
                    }

                    if (isAnyChangeInStates === false) {
                       //Check adition or removal of transition
                        if (this.lastDeployedTransitions.length !== transition.length) {
                            //Modification in number of transitions 
                            isAnyChangedInTransition = true;
                        }
                        if (isAnyChangedInTransition !== true) {
                            //Check for any signature change/name change of a transition.                           
                            for(i = 0; i <  transition.length; i++) {
                                for (j = 0; j < this.lastDeployedTransitions.length; j++) {
                                    if (transition[i].sourceState === this.lastDeployedTransitions[j].sourceState &&
                                        transition[i].targetState === this.lastDeployedTransitions[j].targetState &&
                                        transition[i].name === this.lastDeployedTransitions[j].name /*not required but save side*/) {
                                        if (transition[i].nlsname === this.lastDeployedTransitions[j].nlsname ) {
                                            isAnyChangedInTransition = false;
                                            countSameTranistion++;
                                            break;
                                        } else {
                                            isAnyChangedInTransition = true;
                                             break;
                                        }
                                    }
                                }
                                if (isAnyChangedInTransition === true) {
                                    break;
                                }
                            }

                            if (isAnyChangedInTransition === false) { 
                                if(countSameTranistion !== this.lastDeployedTransitions.length)  
                                        isAnyChangedInTransition = true;
                            }

                        }
                    }
                    datatoSend = {
                        id          : that.policyID,
                        state       : state,
                        transition  : transition,
                        check       : LifecycleViewUtilities.getCurrentChecks(this.contentDiv, this.grph.appCategory) //FUN087047
                    };
                    if (isAnyChangeInStates === false && isAnyChangedInTransition === false) {
                        //Check addtion or removal of rule
                        if (this.lastDeployedChecks.length !== datatoSend.check.length) {
                            //Modification in number of transitions 
                            isAnyChangeInChecks = true;
                        }
                        if (isAnyChangeInChecks === false) {
                             //Check for any signature change/name change of a transition.                           
                            for (i = 0; i <  datatoSend.check.length; i++) {
                                for (j = 0; j < this.lastDeployedChecks.length; j++) {
                                    if (datatoSend.check[i].objType === this.lastDeployedChecks[j].objType &&
                                        datatoSend.check[i].fromState === this.lastDeployedChecks[j].fromState &&
                                        datatoSend.check[i].toState === this.lastDeployedChecks[j].toState &&
                                        datatoSend.check[i].ruleID === this.lastDeployedChecks[j].ruleID  &&
                                        datatoSend.check[i].additionalProps === this.lastDeployedChecks[j].additionalProps) {
                                        sameCheckCount++;
                                        break;
                                    }
                                }
                                if (isAnyChangeInChecks === true) {
                                    break;
                                }
                            }
                            if (isAnyChangeInChecks === false) {
                                if (sameCheckCount !== datatoSend.check.length)
                                    isAnyChangeInChecks = true;
                            }
                        }
                     }
                    isSomethingChanged = isAnyChangedInTransition || isAnyChangeInStates || isAnyChangeInChecks;
                    if(isSomethingChanged === false) {
                        this.userMessaging.add({className: "error", message: ParamSkeletonNLS.NoChangeFound});
                        tbodyreflist = this.contentDiv.getElements('.indicatortbody');
                        imgCell = LifecycleViewUtilities.getNamingDeployCellSts(tbodyreflist);
                        LifecycleViewUtilities.updateIcon(true, imgCell);
                    }
                        //alert("No changed found");
                    UWA.log(datatoSend);
                    //Comment to tempratory 

                    if(isSomethingChanged === true) {
                        // alert("Something changed ");
                        Mask.mask(that.contentDiv);
                        ParameterizationWebServices.postLifecycleParams.call(this, datatoSend,
                            this.onDeployLCFailure.bind(this), this.onDeployLCSuccess.bind(this,datatoSend));
                    }

                }
            },

            checksBeforeDeploy : function () {
                if (!LifecycleViewUtilities.checkforSingletonStates(this.grph.nodes, this.grph.edges)) {
                    this.userMessaging.add({className: "error", message: ParamSkeletonNLS.SingletonStateText});
                    return false;
                }
                return true;
            },

            launchDeployProcess : function () {
                UWA.log(this.grph);
            },

            resetParamsinSession : function () {
                Mask.mask(this.contentDiv);
                LifecycleViewUtilities.resetLifecycleChecks(this.contentDiv.getElements('.paramtbody')[0].children);//Checks 
                this.resetStates();//States
                this.resetTransitions();//Transitions
                this.handledeployIndicator();//deploy indicator
                LifecycleViewUtilities.enableApplyButton(this.contentDiv);//Apply Button, if it was disabled before
                Mask.unmask(this.contentDiv);
            },

            onDeployLCSuccess : function (data) {
                UWA.log("onDeployLCSuccess");
                UWA.log(data);
                var imgCell, tbodyreflist, transitionList, itr, i;
                this.handleChecksAfterDeploy();
                Mask.unmask(this.contentDiv);
                this.userMessaging.add({className: "success", message: ParamSkeletonNLS.LCParamsDeploySuccess});
                //IR-695253-3DEXPERIENCER2019x FD06, 20x FD01: update deployed parameter for UI
                this.lastDeployedTransitions = data.transition;
                this.lastDeployedStates = data.state;
                this.lastDeployedChecks = data.check;
                //UI update 
                transitionList = this.grph.edges;
                for ( itr = transitionList.first; itr; itr = itr.next) {
                    for ( i = 0 ; i < this.lastDeployedTransitions.length; i++) {

                        if (itr.signature === this.lastDeployedTransitions[i].name) {
                            itr.signatureNLS = this.lastDeployedTransitions[i].nlsname;
                            itr.DeployedSig = this.lastDeployedTransitions[i].nlsname;
                            break;
                        }
                    } 
                }
                tbodyreflist = this.contentDiv.getElements('.indicatortbody');
                imgCell = LifecycleViewUtilities.getNamingDeployCellSts(tbodyreflist);
                LifecycleViewUtilities.updateIcon(true, imgCell);

                LifecycleViewUtilities.UpdateLifecycleChecksStsInTable(this.contentDiv);//update icons
            },

            onDeployLCFailure : function (data) {
                UWA.log("onDeployLCFailure");
                UWA.log(data);
                Mask.unmask(this.contentDiv);
                this.userMessaging.add({className: "error", message: ParamSkeletonNLS.LCParamsDeployFailure});

                var tbodyreflist = this.contentDiv.getElements('.indicatortbody'),
                    imgCell = LifecycleViewUtilities.getNamingDeployCellSts(tbodyreflist);
                LifecycleViewUtilities.updateIcon(false, imgCell);
            },

            handleChecksAfterDeploy : function () {
                var i,//listofPopoversButtons,
                    tbodyref = this.contentDiv.getElements('.paramtbody')[0],
                    //listofLines = tbodyref.children,
                    //listofCloseButtons = tbodyref.getElements('.close');
                    listofCloseButtons = tbodyref.getElements('.cog');
                //
                for (i = 0; i < listofCloseButtons.length; i++) {
                    listofCloseButtons[i].setStyle("color", "green");
                }

                //listofPopoversButtons = tbodyref.getElements('.parampopover');
                /*removeCheckButton.getContent().setStyle("color",iconColor);//"#1D7294"  */
                /*for (var i=0; i<listofCloseButtons.length; i++)
                    listofCloseButtons[i].setStyle("color","green");*/
                //setBody
                //UWA.log(listofCloseButtons);
            },

            /*selectNode : function (e) {
                UWA.log("Node Selected");
               // LifecycleView.buildpropsNode(e, RenameState, RemoveState);
            },*/

            resetStates : function() {
                var i, defstateIndex,
                    nodesLength = this.nodes.length;
                function setModifiedValue(node, newValue) {
                    let aOldValue = node.allLangNames.split(",");
                    let aNewValue = newValue.split(",");

                    let modifiedValue = "";

                    aNewValue.forEach((item1) => {
                        let aNewValueAndLang = item1.split("~");
                        aOldValue.forEach((item2) => {
                            let aOldValueAndLang = item2.split("~");

                            if(aNewValueAndLang[1] == aOldValueAndLang[1] && aNewValueAndLang[0] != aOldValueAndLang[0]) {
                                modifiedValue += item1 + ",";
                            }
                        });
                    });
                    if(modifiedValue.length > 0) {
                        node.modifiedValue = modifiedValue.substring(0, modifiedValue.length - 1);
                    }

                }
                for (i = 0; i < nodesLength; i++) {
                    this.nodes[i].remove();
                }
                for (i = 0; i < nodesLength; i++) {
                    defstateIndex = this.getDefaultStateIndex(this.nodes[i].stateid);
                    if (defstateIndex >= 0) {
                        this.nodes[i].name = this.defaultstates[i].name;
                        setModifiedValue(this.nodes[i], this.defaultstates[i].allLangNames);
                        this.nodes[i].allLangNames = this.defaultstates[i].allLangNames;
                        this.nodes[i].isEnabled = this.defaultstates[i].isEnabled;
                    }
                    this.grph.addNode(this.nodes[i]);
                }
            },

            getDefaultStateIndex: function (stateid) {
                var i,
                    defstatesLength = this.defaultstates.length;
                //
                for (i = 0; i < defstatesLength; i++) {
                    if (stateid == this.defaultstates[i].stateid) {
                        return i;
                    }
                }
                return -1;
            },

            /*
            resetTransitions : function ()
            {            
                var defTransitions = this.defaulttransitions;
                var nbofDefaultTransitions = defTransitions.length;

                for (var i=0; i<nbofDefaultTransitions; i++)
                {
                    var ifromNode = this.getNodeIndex(this.defaultnodes, defTransitions[i].sourceState);
                    var itoNode = this.getNodeIndex(this.defaultnodes, defTransitions[i].targetState);  

                    var xdiff = this.defaultnodes[itoNode].left - this.defaultnodes[ifromNode].left;                            
                    var iPositions = Math.round(xdiff/this.grph.nodeSpacing);

                    if  ((ifromNode>=0) && (itoNode>=0))
                    {
                        if (iPositions == 1)
                                this.addNewEdge(iPositions, defTransitions[i].name, defTransitions[i].isCritical, this.defaultnodes[ifromNode].data.right, this.defaultnodes[itoNode].data.left);
                            else if (iPositions <0)
                                this.addNewEdge(iPositions, defTransitions[i].name, defTransitions[i].isCritical, this.defaultnodes[ifromNode].data.bottom, this.defaultnodes[itoNode].data.bottom);
                            else
                                this.addNewEdge(iPositions, defTransitions[i].name, defTransitions[i].isCritical, this.defaultnodes[ifromNode].data.top, this.defaultnodes[itoNode].data.top);
                    }
                }              
            },*/

            resetTransitions : function () {
                var i,
                    nbofTransitions = this.defaulttransitions.length;

                for (i = 0; i < nbofTransitions; i++) {
                    this.drawtransition(this.defaulttransitions[i], this.grph.nodes);
                }
            },

            drawtransition : function(iTransition, iNodesList) {
                var xdiff, iPositions,
                    fromNode = LifecycleViewUtilities.getMatchingNode(iNodesList, iTransition.sourceState),
                    toNode   = LifecycleViewUtilities.getMatchingNode(iNodesList, iTransition.targetState);

                if ((fromNode !== null) && (toNode !== null)) {
                    xdiff = toNode.left - fromNode.left;
                    iPositions = Math.round(xdiff / this.grph.nodeSpacing);

                    if (iPositions === 1) {
                        this.addNewEdge(iPositions, iTransition.name, iTransition.nlsname, iTransition.isCritical, fromNode.data.right, toNode.data.left);
                    } else if (iPositions < 0) {
                        this.addNewEdge(iPositions, iTransition.name, iTransition.nlsname, iTransition.isCritical, fromNode.data.bottom, toNode.data.bottom);
                    } else {
                        this.addNewEdge(iPositions, iTransition.name, iTransition.nlsname, iTransition.isCritical, fromNode.data.top, toNode.data.top);
                    }
                } else {
                    UWA.log("prb with " + iTransition.sourceState + " or " + iTransition.targetState);
                }
            },

            addApplyResetToolbar2 : function (insertdivID) {
                var applyDiv, tableButtons, lineButtons, buttonApplyCell, applyBttn,
                    buttonResetCell, resetBbttn,
                    that = this;

                applyDiv =  UWA.createElement('div', {
                    'id': 'ApplyResetDivLC'
                }).inject(insertdivID);

                tableButtons = UWA.createElement('table', {
                    'class' : '',
                    'id' : '',
                    'width' : '100%'
                }).inject(applyDiv);

                lineButtons = UWA.createElement('tr').inject(tableButtons);  // tbody

                buttonApplyCell = UWA.createElement('td', {
                    'width' : '50%',
                    'Align' : 'center'
                }).inject(lineButtons);

                applyBttn =  new Button({
                    className: 'primary',
                    id : 'buttonExport',
                    icon : 'export',//'download'//value: 'Button',             
                    attributes: {
                        disabled: false,
                        title: ParamSkeletonNLS.ApplyLifecyleTooltip,
                        text : ParamSkeletonNLS.Apply
                    },
                    events: {
                        onClick: function () {
                            that.applyParams();
                        }
                    }
                }).inject(buttonApplyCell);
                //
                applyBttn.getContent().setStyle("width", 110);
                //
                buttonResetCell = UWA.createElement('td', {
                    'width' : '50%',
                    'Align' : 'center'
                }).inject(lineButtons);
                //
                resetBbttn = new Button({
                    className: 'warning',
                    icon: 'loop',
                    attributes: {
                        disabled: false,
                        title: ParamSkeletonNLS.ResetLifecycle,
                        text : ParamSkeletonNLS.Reset
                    },
                    events: {
                        onClick: function () {
                            that.resetParamsinSession();//testPreviewBlock();                               
                        }
                    }
                }).inject(buttonResetCell);
                //
                resetBbttn.getContent().setStyle("width", 110);
            },

			//NZV - IR-499665-3DEXPERIENCER2017x/IR-538770-3DEXPERIENCER2018x 
            removeElement : function () {
                var e, stateNodeFound = false, eltRemoved = false, isCritical = false;
                for (e = this.grph.selection.first; e; e = e.nextSel) {
                    if ((e.type === core.Type.NODE) &&
                            !e.hidden) {
                        eltRemoved = true;
                        if (e.isCritical == "true") {
                            this.userMessaging.add({
                                className: "warning",
                                message : ParamSkeletonNLS.StateCriticalText.format(e.name)
                            });
                            isCritical = true;
                            break;
                        } else {
                            stateNodeFound = true;
                        }
                    } else if ((e.type === core.Type.EDGE) && !e.hidden) {
                        eltRemoved = true;
                    }
                }
                if (!isCritical && eltRemoved && stateNodeFound) {
                    //IR-689657-3DEXPERIENCER2019x/20x
                    ParametersLayoutViewUtilities.showContextualDeleteModal(widget.body, "delAttrModal", ParamSkeletonNLS.removeStatesWarning, 
                        ParamSkeletonNLS.YesText,  ParamSkeletonNLS.NoText, ParamSkeletonNLS.Warning+"!", this.removeStatesAndTransitions, this);
                } else if (!isCritical && eltRemoved) {
                    this.removeStatesAndTransitions(this);
                } else if (!eltRemoved) {
                    this.userMessaging.add({className: "warning", message: ParamSkeletonNLS.NoObjectedSelectedrmText});
                }
            },

            removeStatesAndTransitions: function (that) {
                var e, cantrmTransition,
                    //eltRemoved = false,
                    eltstoDelete = [],
                    tbodyref = that.contentDiv.getElements('.paramtbody')[0];

                if (that.model.get("modifyTopology")) {

                    LifecycleEgraphUtilities.removePropsNode();

                    for (e = that.grph.selection.first; e; e = e.nextSel) {
                        if ((e.type === core.Type.NODE  ||
                                e.type === core.Type.EDGE) &&
                                !e.hidden) {

                            eltstoDelete.push(e);
                        }
                    }

                    that.grph.updateLock();
                    try {
                        UWA.log("delete");
                        eltstoDelete.forEach(function (e) {

                            if (e.type === core.Type.NODE) {
                                //eltRemoved = true;
                                // 
                                /*if (e.isCritical == "true") {
                                    that.userMessaging.add({
                                        className: "warning",
                                        message : ParamSkeletonNLS.StateCriticalText.format(e.name)
                                    });
                                } else*/ 
                                //{
                                console.log(e);
                                LifecycleViewUtilities.removeRelatedChecksForState(e.stateid, tbodyref);
                                e.remove();
                                that.handledeployIndicator();
                                //}
                            } else if (e.type === core.Type.EDGE) {
                                //eltRemoved = true;

                                if (e.isCritical == "true") {
                                    cantrmTransition = ParamSkeletonNLS.TransitionCriticalText.format(e.cl1.c.node.name, e.cl2.c.node.name);
                                    that.userMessaging.add({className: "warning", message: cantrmTransition});
                                } else {
                                    LifecycleViewUtilities.removeRelatedChecksForTransition(e.cl1.c.node.stateid, e.cl2.c.node.stateid, tbodyref);

                                    if (that.grph.appCategory === "CBP") {
                                        that.handleTransitionRemovalForCBP(e.cl1.c.node, e.cl2.c.node);
                                    }
                                    e.remove();
                                    that.handledeployIndicator();
                                }
                            }
                        });//forEach

                    } finally {
                        that.grph.updateUnlock();
                    }
                    //
                    /*if (!eltRemoved) {
                        that.userMessaging.add({className: "warning", message: ParamSkeletonNLS.NoObjectedSelectedrmText});
                    }*/
                } else {
                    that.userMessaging.add({className: "warning", message: ParamSkeletonNLS.TopologyNotModifiable});
                }
            },


            handledeployIndicator : function () {
                var tbodyreflist = this.contentDiv.getElements('.indicatortbody'),
                    imgCell = LifecycleViewUtilities.getNamingDeployCellSts(tbodyreflist);//"nameDeployIndicator"

                LifecycleViewUtilities.beingModified(imgCell, ParamSkeletonNLS.Being_Modified);
            },

            handleTransitionRemovalForCBP : function (fromNode, toNode) {

                var e, listofEdges,
                    nbofOutTrans = 0,
                    xdiff = toNode.left - fromNode.left,
                    iPositions = Math.round(xdiff /  this.grph.nodeSpacing);

                if (iPositions > 1) {
                    listofEdges = this.grph.edges;
                    for (e = listofEdges.first; e; e = e.next) {
                        if (e.cl1.c.node.stateid === fromNode.stateid) {
                            nbofOutTrans++;
                        }
                    }

                    if (nbofOutTrans == 2) {
                        for (e = listofEdges.first; e; e = e.next) {
                            xdiff = e.cl2.c.node.left - e.cl1.c.node.left;
                            iPositions = Math.round(xdiff / this.grph.nodeSpacing);
                            UWA.log("from : " + e.cl1.c.node.stateid + " to : " + e.cl2.c.node.stateid + " :: " + iPositions);

                            if (iPositions === 1) {
                                if (e.signature !== "") {
                                    e.signature = "";
                                    e.signatureNLS = "";
                                    break;
                                }
                            }
                        }
                    }
                }// of if (iPositions > 1)

            },

            /*
            removeElement_old : function () {
                UWA.log("inside removeElement");
                var i, itr,
                    cantrmTransition,
                    that = this,
                    nodesLength = that.nodes.length,
                    eltRemoved = false,
                    tbodyref = this.contentDiv.getElements('.paramtbody')[0];
                //
                if (that.model.get("modifyTopology")) {
                    for (i = 0;  i < nodesLength; i++) {
                        if (that.nodes[i].isSelected()) {
                            eltRemoved = true;
                            //
                            if (that.nodes[i].isCritical == "true") {
                                that.userMessaging.add({
                                    className: "warning",
                                    message : ParamSkeletonNLS.StateCriticalText.format(that.nodes[i].name)
                                });
                            } else {
                                that.nodes[i].remove();
                                that.removeRelatedChecksForState(that.nodes[i].stateid, tbodyref);
                            }
                        }
                    }

                    var transitionList = that.grph.edges;
                    for (itr = transitionList.first; itr; itr = itr.next) {
                        if (itr.isSelected() == true) {
                            eltRemoved = true;
                            //
                            if (itr.isCritical == "true") {
                                cantrmTransition = ParamSkeletonNLS.TransitionCriticalText.format(itr.cl1.c.node.name, itr.cl2.c.node.name);
                                that.userMessaging.add({className: "warning", message: cantrmTransition});
                            } else {
                                LifecycleViewUtilities.removeRelatedChecksForTransition(itr.cl1.c.node.stateid, itr.cl2.c.node.stateid, tbodyref);
                                itr.remove();
                            }
                        }
                    }
                    //
                    if (!eltRemoved) {
                        this.userMessaging.add({className: "warning", message: ParamSkeletonNLS.NoObjectedSelectedrmText});// + ' - ' + new Date();
                    }
                } else {
                    this.userMessaging.add({className: "warning", message: ParamSkeletonNLS.TopologyNotModifiable});
                }
            },*/

            restoreStates : function () {
                var warningNoRemovedStates, headertitle,
                    OKBtn, CancelBtn,
                    StatesListSelect,
                    restoreStsModal,
                    i,
                    that = this,
                    removedStates = this.getRemovedStatesList(),
                    nbofRemovedStates = removedStates.length;

                if (nbofRemovedStates === 0) {
                    warningNoRemovedStates = ParamSkeletonNLS.NoStatesRemoved;
                    that.userMessaging.add({className: "warning", message: warningNoRemovedStates});
                } else {
                    StatesListSelect =  new Select({
                        nativeSelect: true,
                        placeholder: false,
                        multiple: true
                    });
                    //
                    headertitle = UWA.createElement('h4', {
                        text   : ParamSkeletonNLS.SelectStateToRestore,//NZV-IR-613104-3DEXPERIENCER2019x
                        'class': 'font-3dslight' // font-3dsbold
                    });
                    //
                    OKBtn = new Button({
                        value : ParamSkeletonNLS.OKButton,
                        className : 'btn primary',
                        events : {
                            'onClick' : function() {
                                var selectedStates = StatesListSelect.getValue();//.getValue()[0]
                                that.restoreStatesinSession(selectedStates);
                                that.handledeployIndicator();
                            }
                        }
                    });
                    //    
                    CancelBtn = new Button({
                        value : ParamSkeletonNLS.CancelButton,
                        className : 'btn default',                        
                        events : {
                            'onClick' : function(e) {
                                that.onCancelCalled(e);
                            }
                        }
                    });
                    /*"<button type='button' class='btn btn-primary'>OK</button> " +
                    "<button type='button' class='btn btn-default'>Annuler</button>"*/

                    for (i = 0; i < nbofRemovedStates; i++) {
                        StatesListSelect.add([{
                            label: removedStates[i].name,
                            value: removedStates[i].stateid
                        }]);
                    }
                    //
                    restoreStsModal = new Modal({
                        className: "restore-sts-modal",
                        closable: true,
                        header: headertitle,
                        body:   StatesListSelect,
                        footer: [ OKBtn, CancelBtn ]
                    }).inject(that.contentDiv);
                    //
                    restoreStsModal.getContent().setStyle("padding-top", 90);
                    restoreStsModal.show();
                    //
                    restoreStsModal.getContent().getElements(".btn").forEach(function (element) {
                        element.addEvent("click", function () {
                            restoreStsModal.hide();
                        });
                    });
                }//of else if nbofRemovedStates

            },

            showAddElementsModal : function() {
                var itr, i, e,
                    headertitle,
                    sortedTypes, listofRulesForType, ruleTextID,
                    selectedRule, additionalInfo, additionalInfoNLS,
                    nbofTypes, selectHiddenCell,
                    tbodyref, isCheckAdded,
                    modalbodyTable, modaltbody,
                    lineModal,
                    typeTextCell, selectCell,
                    RulesListSelect,
                    lineComplModal, complementarySelect,
                    OKBtn, CancelBtn,
                    TypesListSelect, listofAttrs,
                    that = this,
                    transitionList = that.grph.edges,
                    addCheckAttrOK = true,
                    isTransitionSelected = false, tempTD, promoteCell, demoteCell, 
                    promoteToggle, actionLabelElm, lineDemotePromote, promoteLabelCell;

                for (e = this.grph.selection.first; e; e = e.nextSel) {
                    if (e.type === core.Type.EDGE) {
                        isTransitionSelected = true;
                        break;
                    }
                }
                // loop on the added elements and log them in the console
                /*for (itr = transitionList.first; itr; itr = itr.next) {
                    if (itr.isSelected()) {
                        isTransitionSelected = true;
                        break;
                    }
                }*/

                if (!isTransitionSelected) {
                    that.userMessaging.add({className: "warning", message: ParamSkeletonNLS.NoTransitionSelected});
                } else {
                    LifecycleEgraphUtilities.removePropsNode();
                    if (that.RulesModal !== null) {
                        that.RulesModal.show();//Modal already exists
                    } else {
                        headertitle = UWA.createElement('h4', {
                            text   : ParamSkeletonNLS.AddNewRule,
                            'class': 'font-3dslight' // font-3dsbold
                        });

                        sortedTypes = LifecycleViewUtilities.sortArrayByKey(that.collection._models[0]._attributes.types, "typeNLS");
                        nbofTypes = sortedTypes.length;

                        //if (( !== '') && (!== undefined))

                        modalbodyTable =  UWA.createElement('table', {
                            'id': '',
                            'class': 'table table-condensed table-hover'
                        });
                        modaltbody = UWA.createElement('tbody', {
                            'class': ''
                        }).inject(modalbodyTable);
                        //FUN087047 : Promote/Demote support
                        if (that.grph.appCategory === "CBP") {
                            lineDemotePromote = UWA.createElement('tr').inject(modaltbody);
                            promoteLabelCell = UWA.createElement('td', {
                                'Align' : 'left',
                                'width' : '20%'
                            }).inject(lineDemotePromote);
                            promoteLabelCell.setStyle('vertical-align','middle');

                            actionLabelElm = UWA.createElement('p', {
                                text   : ParamSkeletonNLS.Action,// font-3dsbold
                                'class': 'font-3dslight'
                            }).inject(promoteLabelCell);
                            tempTD =  UWA.createElement('td', {
                                'Align' : 'left'
                            }).inject(lineDemotePromote);
                            promoteCell = UWA.createElement('td', {
                                'Align' : 'left',
                                'width' : '30%'
                            }).inject(tempTD);
                            demoteCell = UWA.createElement('td', {
                                'Align' : 'center'
                            }).inject(tempTD);
                            promoteToggle = new Toggle(
                                {   name: 'radio2', 
                                    value: 'option1', 
                                    className: 'primary', 
                                    label: ParamSkeletonNLS.Promote }).check().inject(promoteCell);
                            new Toggle()
                                    .setName('radio2')
                                    .setValue('option2')
                                    .setLabel(ParamSkeletonNLS.Demote)
                                    .setClassName('primary')
                                    .inject(demoteCell);
                        }//End of Action
                        lineModal = UWA.createElement('tr').inject(modaltbody);
                        //
                        typeTextCell = UWA.createElement('td', {
                            'Align' : 'left',
                            'width' : '15%'                            
                        }).inject(lineModal);
                        typeTextCell.setStyle('vertical-align','middle');
                        UWA.createElement('p', {
                            text   : ParamSkeletonNLS.DataTypeLabel,// font-3dsbold
                            'class': 'font-3dslight'
                        }).inject(typeTextCell);

                        selectCell = UWA.createElement('td', {
                            'Align' : 'left'
                        }).inject(lineModal);

                        lineComplModal = UWA.createElement('tr');

                        TypesListSelect =  new Select({
                            nativeSelect: true,
                            placeholder: false,
                            multiple: false
                        }).inject(selectCell);

                        for (i = 0; i < nbofTypes; i++) {
                            TypesListSelect.add([{
                                label: sortedTypes[i].typeNLS,
                                value: sortedTypes[i].typeID
                            }]);
                        }
                        //Complementary Select
                        complementarySelect =  new Select({
                            nativeSelect: true,
                            placeholder: false,
                            multiple: false
                        });

                        lineModal = UWA.createElement('tr').inject(modaltbody);

                        typeTextCell = UWA.createElement('td', {
                            'Align' : 'left',
                            'width' : '15%'                            
                        }).inject(lineModal);
                        typeTextCell.setStyle('vertical-align','middle');

                        UWA.createElement('p', {
                            text   : ParamSkeletonNLS.Rulelabel,// font-3dsbold
                            'class': 'font-3dslight'
                        }).inject(typeTextCell);

                        selectCell = UWA.createElement('td', {
                            'Align' : 'left'
                        }).inject(lineModal);

                        RulesListSelect =  new Select({
                            nativeSelect: true,
                            placeholder: false,
                            multiple: false
                            /*events: {
                                'onChange' : function () {
                                    if (this.getValue()[0] === "RejectIfAnyOfTheCommonlyGovernedChildNotOnTargetState") {
                                        lineComplModal.show();
                                        LifecycleViewUtilities.populateAddInfoSelect(complementarySelect, TypesListSelect.getValue(), sortedTypes);
                                    } else {
                                        lineComplModal.hide();
                                    }
                                }
                            }*/
                        }).inject(selectCell);


                        //pour l'initalisation
                        listofRulesForType = sortedTypes[0].listofRules.split(',');

                        for (i = 0; i < listofRulesForType.length; i++) {
                            //if (listofRulesForType[i] !== "RejectIfAttributeNotValuated") {
                            ruleTextID = listofRulesForType[i] + "Text";

                            RulesListSelect.add([{
                                label: ParamSkeletonNLS[ruleTextID],
                                value: listofRulesForType[i]
                            }]);
                            //}
                        }

                        RulesListSelect.addEvent("onChange", function () {
                            if (this.getValue()[0] === "RejectIfAnyOfTheCommonlyGovernedChildNotOnTargetState") {
                                lineComplModal.show();
                                LifecycleViewUtilities.populateAddInfoSelect(complementarySelect, TypesListSelect.getValue(), sortedTypes);
                            } else if (this.getValue()[0] === "RejectIfAttributeNotValuated") {
                                lineComplModal.show();
                                listofAttrs = LifecycleViewUtilities.getListofAttributesForType(TypesListSelect.getValue(), sortedTypes);
                                LifecycleViewUtilities.populateAttributesSelector(complementarySelect, listofAttrs);
                            } else {
                                lineComplModal.hide();
                            }
                        });

                        TypesListSelect.addEvent("onChange", function () {
                            lineComplModal.hide();
                            LifecycleViewUtilities.updateRulesListforType(RulesListSelect, this.getValue(), sortedTypes);
                        });

                        typeTextCell = UWA.createElement('td', {
                            'Align' : 'left',
                            'width' : '15%'
                        }).inject(lineComplModal);

                        UWA.createElement('p', {
                            text   : ParamSkeletonNLS.ConsiderChildType,// font-3dsbold
                            'class': 'font-3dslight'
                        }).inject(typeTextCell);

                        selectHiddenCell = UWA.createElement('td', {
                            'Align' : 'left'
                        }).inject(lineComplModal);

                        complementarySelect.inject(selectHiddenCell);
                        lineComplModal.inject(modaltbody);
                        /*[h9h] Hiding for all cases and not considering rules that requires ComplModal may be the default selected rule*/
                        //lineComplModal.hide();
						/*[h9h] check for rules before showing or Hiding the ComplModel*/
						if(RulesListSelect.getValue()[0] === "RejectIfAnyOfTheCommonlyGovernedChildNotOnTargetState") {
                            lineComplModal.show();
                            LifecycleViewUtilities.populateAddInfoSelect(complementarySelect, TypesListSelect.getValue(), sortedTypes);
                        } else if (RulesListSelect.getValue()[0] === "RejectIfAttributeNotValuated") {
                            lineComplModal.show();
                            listofAttrs = LifecycleViewUtilities.getListofAttributesForType(TypesListSelect.getValue(), sortedTypes);
                            LifecycleViewUtilities.populateAttributesSelector(complementarySelect, listofAttrs);
                        } else {
                            lineComplModal.hide();
                        }

                        OKBtn = new Button({
                            value : ParamSkeletonNLS.OKButton,
                            className : 'btn primary',
                            events : {
                                'onClick' : function() {
                                    var promote = true;
                                    //var selectedStates = StatesListSelect.getValue();//.getValue()[0]
                                    //that.restoreStatesinSession(selectedStates);//StatesListSelect.getValue()
                                    tbodyref = that.contentDiv.getElements('.paramtbody');
                                    addCheckAttrOK = true;

                                    for (itr = transitionList.first; itr; itr = itr.next) {
                                        if (itr.isSelected() === true) {
                                            //var readTypeVal = TypesListSelect.getValue();
                                            //var readTypeNAme = TypesListSelect.getName();
                                            /*UWA.log("complementary");
                                            UWA.log(complementarySelect.getValue());
                                            UWA.log(lineComplModal.hidden);*/

                                            selectedRule = RulesListSelect.getSelection()[0].value;
                                            additionalInfo = "NOINFO";
                                            additionalInfoNLS = "";
                                            //
                                            if (selectedRule === "RejectIfAnyOfTheCommonlyGovernedChildNotOnTargetState") {
                                                additionalInfo = complementarySelect.getSelection()[0].value;
                                                additionalInfoNLS = ParamSkeletonNLS.ConsiderKey.format(complementarySelect.getSelection()[0].label);
                                            }

                                            //ZUR IR-496665-3DEXPERIENCER2017x
                                            if (selectedRule === "RejectIfAttributeNotValuated") {
                                                if (complementarySelect.getOptions().length > 0) {
                                                    additionalInfo = complementarySelect.getSelection()[0].value;
                                                    additionalInfoNLS = ParamSkeletonNLS.ConsiderKey.format(complementarySelect.getSelection()[0].label);
                                                } else {
                                                    that.userMessagingDrag.add({className: "warning", message: ParamSkeletonNLS.NoCustoAttributesAdded});
                                                    addCheckAttrOK = false;
                                                }
                                            }
                                            //FUN087047
                                            if (that.grph.appCategory === "CBP") {
                                                promote = promoteToggle.isChecked();
                                            } else {
                                                promote = true;
                                            }
                                            //var tbodyref = this.contentDiv.getElements('.paramtbody')[0];
                                            isCheckAdded = LifecycleViewUtilities.isCheckAlreadyAdded(TypesListSelect.getSelection()[0].value,
                                                itr.cl1.c.node.stateid, itr.cl2.c.node.stateid,
                                                selectedRule, additionalInfo,
                                                tbodyref[0], promote);

                                            if (addCheckAttrOK) {
                                                if (!isCheckAdded) {
                                                    that.addChecktoTable(tbodyref[0],
                                                        TypesListSelect.getSelection()[0].value, TypesListSelect.getSelection()[0].label,
                                                        itr.cl1.c.node.stateid, itr.cl1.c.node.name,
                                                        itr.cl2.c.node.stateid, itr.cl2.c.node.name,
                                                        selectedRule,
                                                        additionalInfo, additionalInfoNLS,
                                                        "newcheck", promote);
                                                    that.handledeployIndicator();
                                                } else {
                                                    that.userMessaging.add({className: "error", message: ParamSkeletonNLS.CheckAlreadyAdded});
                                                }
                                            }
                                        }
                                    }//of for loop
                                }//of onclick
                            }//events
                        });

                        CancelBtn = new Button({
                            value : ParamSkeletonNLS.CancelButton,
                            className : 'btn default',
                            events : {
                                'onClick' : function(e) {
                                    UWA.log(e);//that.onCancelCalled();
                                }
                            }
                        });

                        that.RulesModal = new Modal({
                            className: "restore-sts-modal",
                            closable: true,
                            header  : headertitle,
                            body    : modalbodyTable,
                            footer  : [ OKBtn, CancelBtn ]
                        }).inject(that.contentDiv);

                        that.RulesModal.getContent().setStyle("padding-top", 90);
                        that.RulesModal.show();

                        that.RulesModal.getContent().getElements(".btn").forEach(function (element) {
                            element.addEvent("click", function () {
                                that.RulesModal.hide();
                            });
                        });
                    }
                }
            },

            restoreStatesinSession : function(ilistofStates) {
                var iRestore, i,
                    that = this,
                    nbofStatestoRestore = ilistofStates.length,
                    nodesLength = that.nodes.length;

                for (iRestore = 0; iRestore < nbofStatestoRestore; iRestore++) {
                    for (i = 0; i < nodesLength; i++) {
                        if (that.nodes[i].stateid == ilistofStates[iRestore]) {
                            that.nodes[i].modifiedValue = that.nodes[i].allLangNames;
                            that.grph.addNode(that.nodes[i]);
                            UWA.log("State Restored " + ilistofStates[iRestore]);
                            break;
                        }
                    }
                }
            },

            onCancelCalled : function(x) {
                UWA.log("onCancelCalled" + x);
            },

            getRemovedStatesList : function () {
                var i,
                    ArrayNodeList = [],
                    nodesLength = this.nodes.length,
                    k = 0;

                for (i = 0; i < nodesLength; i++) {
                    if (this.nodes[i].parent === null) {
                        ArrayNodeList[k++] = this.nodes[i];
                    }
                }
                return ArrayNodeList;
            },

            destroy : function() {
                UWA.log("LifecycleView::destroy");
                this.stopListening();
                this._parent.apply(this, arguments);
            }

        });

        return extendedView;
    });

/*@fullReview  ZUR 16/02/19 2017x Param Skeleton*/
/*global define, widget*/
/*jslint nomen: true*/
define('DS/ParameterizationSkeleton/Views/ParametersCommonView',
    [
        'UWA/Core',
        'UWA/Class/View',
        'DS/ParameterizationSkeleton/Views/ParameterizationDataModeling/AttributesLayoutView',
      'DS/ParameterizationSkeleton/Views/ParameterizationLifecycle/LifecycleView',
        'DS/ParameterizationSkeleton/Views/ParameterizationXCAD/ParamXCADLayoutView'
    ], function (UWA, View, AttributesLayoutView, LifecycleView, ParamXCADLayoutView) {

        'use strict';

        return View.extend({

            defaultOptions: {
                type: 'default'
            },

            init : function (options) {
                UWA.log("ParametersCommonView::init");
                UWA.log(options);
                this.options = options;
                this.childView = null;
            },

        // The ‘options’ object is passed via the ‘viewOptions’ specified in the Renderer at the Skeleton instantiation
            render: function () {
                //options = options || {options = {}};
                //options = UWA.clone(options || {}, false);
                var options = this.options,
                    commonViewSwitcher = this.getCommonView(options);

                if (commonViewSwitcher !== null) {
                    this.childView = commonViewSwitcher;
                    return commonViewSwitcher.render();
                }

                return null;//defaultView.render();
            },

            getCommonView : function (options) {

                if (options.domainid === "AttributeDef") {
                    return new AttributesLayoutView(options);
                }
                if (options.domainid === "XCADParameterization") {
                    return new ParamXCADLayoutView(options);
                }

                return new LifecycleView(options);
            },

            destroy : function() {
                this.childView.destroy();
                this.stopListening();
                this._parent.apply(this, arguments);
            }

        });
    });

