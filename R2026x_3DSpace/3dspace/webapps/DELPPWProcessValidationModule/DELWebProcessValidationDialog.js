window.define&&define("DS/DELPPWProcessValidationModule/DELWebProcessValidationDialog",["DS/DELWebInfrastructureControls/UWAUtils","DS/DELPPWProcessValidationModule/DELWebProcessValidationModel","DS/DELWebInfrastructureControls/DELWebIndexAuthoringMgmt","DS/DELWebInfrastructureControls/DELWebSearchUtils","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/LineEditor","DS/Controls/Editor","DS/Controls/ComboBox","DS/WUXAutoComplete/AutoComplete","DS/Controls/Popup","DS/Controls/Toggle","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Controls/Label","DS/Controls/Scroller","DS/Controls/ProgressBar","DS/Utilities/Dom","DS/VENMomentJS-2.23.0/moment-timezone","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","undefined"!=typeof window?"DS/PlatformAPI/PlatformAPI":"","undefined"!=typeof window?"DS/WidgetServices/securityContextServices/SecurityContextServices":"","DS/DELWebInfrastructureControls/DELWebAjaxModel","undefined"!=typeof window?"i18n!DS/DELPPWProcessValidationModule/assets/nls/DELPPWProcessValidationModule":"","css!DS/DELPPWProcessValidationModule/DELPPWProcessValidationModule.css","DS/DELPPWProcessValidationModule/worker/validationWorker"],(function(e,t,a,s,n,i,o,l,r,d,u,c,p,m,g,_,v,h,w,f,S,D,b,y,k,C,T,I){"use strict";var x=n.inherit({name:"DELWebProcessValidationDialog",_full_name:"",_mapWorkplanProducedItem:{},_dialogAlreadyClosed:!1,publishedProperties:{title:{defaultValue:C.get("Process Validation"),type:"string",category:"Appearance"},modalFlag:{defaultValue:!1,type:"boolean",category:"Behavior"},autoCloseFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},resizableFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},activateButtonsIfActionPerformed:{defaultValue:!1,type:"boolean",category:"Behavior"},width:{defaultValue:Math.max((window.widget&&window.widget.body&&window.widget.body.clientWidth?window.widget.body.clientWidth:0)/2,530),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},minWidth:{defaultValue:330,defaultTouchValue:330,advancedSetter:!0,type:"integer",category:"Appearance"},minHeight:{defaultValue:160,defaultTouchValue:160,advancedSetter:!0,type:"integer",category:"Appearance"},maxHeight:{defaultValue:Math.max(window.widget.body.clientHeight,600),defaultTouchValue:160,advancedSetter:!0,type:"integer",category:"Appearance"}},init:function(e){e?(this.options=Object.assign(this.options||{},e),this.options&&this.options.navigateOnIndex&&"Database"===this.options.navigateOnIndex?a.setDatabase():a.setIndex()):this.options||(this.options={}),this._parent.apply(this,arguments)},destroy:function(){this.options&&this.options.onClose&&!this._dialogAlreadyClosed&&(this._dialogAlreadyClosed=!0,this.options.onClose.call(this)),this._parent.apply(this,arguments)},_postBuildView:function(){this._parent();var a=this;if(!this.immersiveFrame)if(this.options.immersiveFrame)this.immersiveFrame=this.options.immersiveFrame;else{var s=window.document.getElementsByClassName("wux-windows-immersive-frame");if(s&&s.length)for(var n=0;!this.immersiveFrame&&n<s.length;++n)s[n]&&s[n].dsModel&&(this.immersiveFrame=s[n].dsModel)}this.elements.container.addClassName(this.name+"-dlg"),this.elements.mainDiv=e.createElement("div",{class:this.name+"-maindiv"}).inject(this.elements._contentDiv||this.elements.container),this.elements.mainDiv.innerHTML='<div class="processValidationDlgDiv"><div class="process-validation_section mainRow"><table class="process-validation-table"><tr class="process-validation-work-plan"><th><div class="process-validation-work-plan-label">'+C.get("Workplan")+'</div></th><td colspan="2"><div class="process-validation-work-plan-dropdown"></div></td><td style="min-width:80px;"><div class="process-validation-icons"><div class="process-validation-reset_icon"><div style="padding-left:5px;" class="reset_icon"></div></div><div style="padding-left:5px;" class="process-validation-start_icon"></div><div class="process-validation-details_icon"><div style="padding-left:5px;" class="details_icon"></div></div><div class="process-validation-stop_icon" style="padding-left:5px;"></div></div></td></tr><tr class="process-validation-produced-item"><th><div class="process-validation-produced-item-label">'+C.get("Produced Item")+'</div></th><td colspan="2"><div class="process-validation-produced-item-label_RO">'+C.get("Choose a Workplan to see the produced item.")+'</div></td></tr><tr class="process_validation_status_container"><th></th><td colspan="3"><table><tr><td class="process_validation_status">'+C.get("Choose a Workplan to see the details for the Workplan.")+'</td><td style="position:relative;width:100%;" class="process_validation_progress"></td></tr></table></td></tr></table></div><div class="process_validation_list pv_report_process_validation_list" style="height:400px;"><div class="helper" draggable="false"><i class="helper_img wux-ui-3ds wux-ui-3ds-4x wux-ui-3ds-drag-drop"/><h6 class="helper_txt">'+C.get("Drop Workplan here from search")+'</h6></div></div><div class="process_validation_message pv_report_details_message ui-resizable"><div class="resizer-n"></div></div></div>',this.elements._startValidationBtn=new i({type:"button",allowUnsafeHTMLLabel:!0,displayStyle:"lite",disabled:!0,tooltipInfos:{title:"Run"},icon:{iconName:"play",fontIconFamily:window.WUXManagedFontIcons.Font3DS}}).inject(this.elements.mainDiv.querySelector(".process-validation-start_icon")),this.elements._stopValidationBtn=new i({type:"button",allowUnsafeHTMLLabel:!0,displayStyle:"lite",disabled:!0,tooltipInfos:{title:"Stop"},icon:{iconName:"stop",fontIconFamily:window.WUXManagedFontIcons.Font3DS}}).inject(this.elements.mainDiv.querySelector(".process-validation-stop_icon")),this.elements._detailsBtn=new i({type:"button",allowUnsafeHTMLLabel:!0,displayStyle:"lite",disabled:!1,tooltipInfos:{title:"Details"},icon:{iconName:"info",fontIconFamily:window.WUXManagedFontIcons.Font3DS}}).inject(this.elements.mainDiv.querySelector(".details_icon")),this.elements._resetBtn=new i({type:"button",allowUnsafeHTMLLabel:!0,displayStyle:"lite",disabled:!0,tooltipInfos:{title:"Reset"},icon:{iconName:"reset",fontIconFamily:window.WUXManagedFontIcons.Font3DS}}).inject(this.elements.mainDiv.querySelector(".reset_icon")),this.elements._startValidationBtn.getContent().addEventListener("buttonclick",(function(e){a.elements.mainDiv.querySelector(".pv_report_process_validation_list").innerHTML="",a.elements._uwaTree&&(a.elements._uwaTree.destroy(),a.elements._uwaTree=null),a._startValidation(e)})),a._full_name=b.getUser().firstName+" "+b.getUser().lastName,a._addSectionHeaderStatus({text:C.get("Loading..."),user:a._full_name}),k.subscribeEvent("ProcessValidation.Started",(function(e){"string"==typeof e&&(e=JSON.parse(e)),a._addSectionHeaderStatus({ValidationStarted:e.startDateTime,validationStatus:e.status,user:e.user}),e&&e.results&&e.results.workplan_id?a._updateWorkplanStatus(Object.assign({completed_steps:0,total_steps:1},e.results)):a._updateWorkplanStatus({completed_steps:0,total_steps:1}),a.elements&&a.elements._startValidationBtn&&(a.elements._startValidationBtn.disabled=!0),a.elements&&a.elements._stopValidationBtn&&(a.elements._stopValidationBtn.disabled=!1)})),k.subscribeEvent("ProcessValidation.Stopping",(function(e){"string"==typeof e&&(e=JSON.parse(e)),a._selectedWorkPlanIDs=[],a._addSectionHeaderStatus({ValidationEnded:(new Date).toLocaleString(),ValidationStarted:e.ValidationStarted||e.startDateTime,validationStatus:"stopped",validationResult:e.results,user:a._full_name}),e&&e.results&&e.results.workplan_id&&a._updateWorkplanStatus(e,e.status),a.elements&&a.elements._startValidationBtn&&(a.elements._startValidationBtn.disabled=!1)})),k.subscribeEvent("ProcessValidation.Running",(function(e){"string"==typeof e&&(e=JSON.parse(e)),a._addSectionHeaderStatus({validationStatus:"running",ValidationStarted:e.ValidationStarted||e.startDateTime,user:a._full_name}),e&&e.results&&e.results.workplan_id&&a._updateWorkplanStatus(e,e.status),a.elements&&a.elements._startValidationBtn&&(a.elements._startValidationBtn.disabled=!0),a.elements&&a.elements._stopValidationBtn&&(a.elements._stopValidationBtn.disabled=!1)})),k.subscribeEvent("ProcessValidation.Completed",(function(t){"string"==typeof t&&(t=JSON.parse(t)),t&&e.Object.isEmptyObject(t)?a._addSectionHeaderStatus({ValidationStarted:null,ValidationEnded:(new Date).toLocaleString(),validationStatus:"completed",user:b.getUser().firstName+" "+b.getUser().lastName}):(a._addSectionHeaderStatus({ValidationStarted:t.startDateTime,ValidationEnded:t.endDateTime,validationStatus:t.status,user:t.user}),t&&t.results&&t.results.workplan_id&&a._updateWorkplanStatus(t,t.status)),a.elements&&a.elements._stopValidationBtn&&(a.elements._stopValidationBtn.disabled=!0),a.elements&&a.elements._startValidationBtn&&(a.elements._startValidationBtn.disabled=!1)})),k.subscribeEvent("Validation.status",(function(t){if("string"==typeof t&&(t=JSON.parse(t)),t&&t.type&&t.validationStatus&&t.type===this._strValidationType){var s=e.extend(!0,{},t);this._addSectionHeaderStatus(s),t&&t.results&&t.results.workplan_id&&a._updateWorkplanStatus(t,t.status)}})),this.elements._stopValidationBtn.getContent().addEventListener("buttonclick",(function(e){a._stopValidation(e)})),this.elements._detailsBtn.getContent().addEventListener("buttonclick",(function(e){a._detailsBtnClicked(e)})),this.elements._resetBtn.getContent().addEventListener("buttonclick",(function(e){a._resetBtnClicked(e)})),k.getServiceUrl({serviceName:"3DSpace"}).then((function(e){a._SpaceURL=e,a._addWorkplanDropdown()})),this._initEventHandlers();if(t.getAllProcessValidation({}).then((function(t){t&&!e.Object.isEmptyObject(t)||(t={text:C.get("No Validation Run")}),a._addSectionHeaderStatus(t)})),this.options&&this.options.selectedIdArray&&this.options.selectedIdArray.length>0){var o=a._workplanDropdown&&a._workplanDropdown.value?a._workplanDropdown.value.slice(0):[],l=o.slice(0).length;e.each(this.options.selectedIdArray,(function(s,n){var i={workplan:{physicalid:n}},r=function(t){t&&e.Object.isPlainObject(t)&&!e.Object.isEmptyObject(t)&&t&&(t.plmBaseObjectType&&"DELLmiWorkPlanSystemReference"===t.plmBaseObjectType||t.type&&"DELLmiWorkPlanSystemReference"===t.type)&&(a._workplanDropdown?(o.push({label:(t.title||t.V_Name)+"-"+t.revision,value:t.id||t.physicalid}),a.options.selectedIdArray.length+l===o.length&&(a._workplanDropdown.value=o)):setTimeout((function(){r(t)}),500))};t.getWorkPlan(i).then((function(e){r(e)}))}))}a.onResize()},_detailsBtnClicked:function(t){var a=this,s=a._wuxPopup;a._wuxPopup||(s=new u({target:t.target,trigger:"click",position:"bottom",className:"wux-controls-popup process_validation_details_icon"}),a._wuxPopup=s,a._wuxPopup.show());var n="";if(this._objStatus&&this._objStatus.validationStatus){n="<h4>"+C.get("Validation")+" "+(this._objStatus.text||this._objStatus.validationStatus)+"</h4>",e.each({ValidationStarted:"startDate",ValidationEnded:"endDate"},(function(e,t){a._objStatus[e]&&!a._objStatus[t]&&(a._objStatus[t]=new Date(a._objStatus[e]))}));var i=null,o=null;(this._objStatus.startDate||this._objStatus.ValidationStarted||this._objStatus.startDateTime)&&(i=this._objStatus.startDate||this._objStatus.ValidationStarted||this._objStatus.startDateTime,n+="<div>"+C.get("Start Date/Time")+": "+f(i).format("LLL")+"</div>"),(this._objStatus.endDate||this._objStatus.ValidationEnded||this._objStatus.endDateTime)&&(o=this._objStatus.endDate||this._objStatus.ValidationEnded||this._objStatus.endDateTime,n+="<div>"+C.get("End Date/Time")+": "+f(o).format("LLL")+"</div>"),(this._objStatus.full_name||this._objStatus.user)&&(n+="<div>"+C.get("Actor")+": "+(this._objStatus.full_name||this._objStatus.user)+"</div>")}else n=C.get("No Validation Run.");a._wuxPopup.setBody(n)},_resetBtnClicked:function(){var e=this;e._workplanDropdown&&""!==e._workplanDropdown.value&&(e._workplanDropdown.value=[]),e._myLabel&&e._myLabel.value&&(e._myLabel.value="",e._myLabel.destroy()),e.elements.mainDiv.querySelector(".process_validation_list").innerHTML='<div class="helper" draggable="false"><i class="helper_img wux-ui-3ds wux-ui-3ds-4x wux-ui-3ds-drag-drop"/><h6 class="helper_txt">'+C.get("Drop Workplan here from search")+"</h6></div>",e.elements.mainDiv.querySelector(".process-validation-produced-item-label_RO").innerHTML=C.get("Choose a Workplan to see the produced item."),e.elements._progressBar&&(e.elements._progressBar.destroy(),e.elements._progressBar=null)},_onCloseButtonClick:function(){var e=this;e.elements.worker&&e.elements.worker.terminate(),e.elements._progressBar&&e._updateProgressBar(1,1),e._workplanDropdown&&(e._workplanDropdown.disabled=!1);var a={},s={};e._currentRunWorkplanID&&(s.workplanID=e._currentRunWorkplanID,a.workplanID=e._currentRunWorkplanID),e._currentRunProducedItemID&&(s.producedItemID=e._currentRunProducedItemID,a.producedItemID=e._currentRunProducedItemID),t.getCachedResults(s).then((function(e){a.resultsToCache={},a.resultsToCache.startDateTime=e.startDateTime,a.resultsToCache.endDateTime=(new Date).toLocaleString(),a.resultsToCache.user=e.user,a.resultsToCache.status=e.status||"stopped",e.results&&(a.resultsToCache.results=e.results),t.cacheValidationResults(a).then((function(e){e&&e.status&&"stopped"===e.status&&k.publishEvent("ProcessValidation.Stopping",e)}),(function(){k.publishEvent("ProcessValidation.Stopping",a.resultsToCache)}))}),(function(){k.publishEvent("ProcessValidation.Stopping",{})})),e.destroy()},_addSectionHeaderStatus:function(t){var a=this;if(t){this._objStatus=t;var s=null;if(a.elements.mainDiv&&(s=a.elements.mainDiv.querySelector(".process_validation_status")),s){var n=t.text;!n&&t.validationStatus&&(n=window.UWA&&window.UWA.String&&window.UWA.String.capitalize?C.get(window.UWA.String.capitalize(t.validationStatus)):C.get(t.validationStatus)),"completed"!==t.validationStatus&&"passed"!==t.validationStatus||(n=C.get("Validation")+" "+n);var i=t.validationStatus;i&&(i=i.replace(/[\W]+/g,"_"));var o=e.createElement("div");o.classList.add("icon"),o.classList.add(i||"loading");var l=null,r="pass";t.validationResult&&("stopped"===t.validationStatus||t.validationResult.completed_steps>=t.validationResult.total_steps)&&(e.each(t.validationResult,(function(e,t){return!t||!t.result||("pass"===r&&(r=t.result),"warning"===r&&"blocking"===t.result&&(r=t.result),"blocking"!==t.result)})),"warning"===r?l="attention":"blocking"===r?l="alert":"pass"===r&&(l="stopped"===strStatus?"progress-2-stop":"check"));var d="";if(l&&(d="wux-ui-3ds wux-ui-3ds-"+l),"started"===t.validationStatus)n=C.get("Validation Starting..."),o.removeClassName("icon").addClassName("wux-ui-3ds wux-ui-3ds-play");else if("stopping"===t.validationStatus)n=C.get("Validation Stopping..."),o.removeClassName("icon").addClassName(d);else if("completed"===t.validationStatus)if(o.removeClassName("icon").addClassName("wux-ui-3ds"),"no validation running"===t.validationStatus)n=C.get("No Validation Run."),a.elements.mainDiv.querySelector(".process_validation_validation_message").text("");else if("passed"===t.validationStatus)n=C.get("Validation passed - no problems found."),o.addClassName("wux-ui-3ds-check");else if("warning"===t.validationStatus||"stopped"===t.validationStatus)"stopped"===t.validationStatus&&(n=C.get("Validation interrupted - Rerun validation to get complete results.")),o.addClassName(d);else{if("failed"===t.validationStatus){var u=!1;t.resultsDetails?e.each(t.resultsDetails,(function(a){var s=t.resultsDetails[a].PrimaryCapableResources;return e.each(s,(function(e){var t=s[e].msg.messageType;return!(u="ERROR"===t)})),!u})):u=!0,n=u?C.get("Validation failed."):C.get("Validation passed with warnings.")}else"error"===t.validationStatus&&(n=C.get("Validation error."));o.addClassName("wux-ui-3ds-alert")}else"running"===t.validationStatus?n=C.get("Validation Currently Running."):"stopped"===t.validationStatus?(n=C.get("Validation interrupted - Rerun validation to get complete results."),o.removeClassName("icon").addClassName(d)):"error"===t.validationStatus?(n=C.get("Validation error."),o.removeClassName("icon").addClassName(d)):"passed"===t.validationStatus&&(n=C.get("Validation passed - no problems found."),o.removeClassName("icon").addClassName("wux-ui-3ds"),o.addClassName("wux-ui-3ds-check"));(t.ExceptionLocalizedMessage||t.ExceptionMessage)&&(n+=" "+(t.ExceptionLocalizedMessage||C.get(t.ExceptionMessage))),t.textContent=n,o.textContent=n||C.get("No Validation Run"),a._updateSectionHeaderCommands(t);var c=a.elements.mainDiv.querySelector(".process_validation_status");o?a._selectedWorkPlanIDs&&0!==a._selectedWorkPlanIDs.length?"running"===t.validationStatus&&(c.innerHTML="<img src="+a._SpaceURL+"/webapps/DELWebInfrastructure/DSCommon/graphics/loading-small.gif></img>",c.innerHTML+=o.outerHTML):"running"===t.validationStatus?(c.innerHTML="",c.innerHTML="<img src="+a._SpaceURL+"/webapps/DELWebInfrastructure/DSCommon/graphics/loading-small.gif></img>",c.innerHTML+=o.outerHTML):(c.innerHTML="",c.innerHTML=o.outerHTML):t.text?c.textContent=t.text:c.innerHTML=""}else setTimeout((function(){a._addSectionHeaderStatus(t)}),500)}},_updateWorkplanStatus:function(t,a){var s=this;if(t&&t.results&&t.results.workplan_id&&s._workplanDropdown){var n=s._workplanDropdown._selectionChips||s._workplanDropdown.getContent().querySelector(".wux-controls-selectionChips").dsModel;n&&n.getAllChipsOptions?e.each(n.getAllChipsOptions(),(function(i,o){if(o&&o.value&&o.value.options&&o.value.options.value&&o.value.options.value===t.results.workplan_id){var l=null;if(t.results.total_steps)if("stopped"!==a&&(t.results.completed_steps||0)<t.results.total_steps)l=widget.getUrl().substr(0,widget.getUrl().indexOf("/webapps/"))+"/webapps/DELWebInfrastructure/DSCommon/graphics/loading-small.gif";else if("stopped"===a||t.results.completed_steps>=t.results.total_steps){var r="pass";e.each(t.results,(function(e,t){return!t||!t.result||("pass"===r&&(r=t.result),"warning"===r&&"blocking"===t.result&&(r=t.result),"blocking"!==t.result)})),"warning"===r?l="attention":"blocking"===r?l="alert":"pass"===r&&(l="stopped"===a?"progress-2-stop":"check")}l&&(o.icon&&o.icon.getData("strIcon")!==l&&(o.icon.remove(),o.icon=null),o.icon||(o.icon=w.generateIcon(l),o.icon.setData("strIcon",l),n._items&&n._items.length>i&&n._items[i].associatedChipCellView&&n._items[i].associatedChipCellView.prepend(o.icon)),n.updateChipOptions(i,o));var d="";if(t&&t.status){d="<h4>"+C.get("Validation")+" "+t.status+"</h4>",e.each({ValidationStarted:"startDateTime",ValidationEnded:"endDateTime"},(function(e,t){s._objStatus[e]&&!s._objStatus[t]&&(s._objStatus[t]=new Date(s._objStatus[e]))}));var u=null,c=null;t.startDateTime&&(u=t.startDateTime,d+="<div>"+C.get("Start Date/Time")+": "+f(u).format("LLL")+"</div>"),t.endDateTime&&(c=t.endDateTime,d+="<div>"+C.get("End Date/Time")+": "+f(c).format("LLL")+"</div>"),t.user&&(d+="<div>"+C.get("Actor")+": "+t.user+"</div>")}else d=C.get("No Validation Run.");return n._items[0].associatedChipCellView.tooltipInfos.allowUnsafeHTMLTitle=!0,n._items[0].associatedChipCellView.tooltipInfos.title=d,!1}return!0})):e.log("DELWebProcessValidationDialog::_updateWorkplanStatus - invalid selection chip controller!")}else e.log("DELWebProcessValidationDialog::_updateWorkplanStatus - invalid workplan id!")},_initDropEventHandlers:function(){var e=this,t=e.elements.container||e.elements.mainDiv||window.widget.body;window.widget.standalone&&window.jQuery&&window.jQuery.fn&&window.jQuery.fn.droppable?(e.options._dndResultsDraggingStart=window.OpenAjax.hub.subscribe("Search.ResultsDragging.start",(function(){window.jQuery(t).addClass("ds_search_result_droppable").droppable({tolerance:"pointer",drop:function(t,a){e.onDrop(t,a)},greedy:!0,over:function(t,a){e.onDragOver(t,a)}})})),e.options._dndResultsDraggingStop=window.OpenAjax.hub.subscribe("Search.ResultsDragging.stop",(function(){window.jQuery(t).hasClass("ui-droppable")&&window.jQuery(t).droppable("destroy"),window.jQuery(t).removeClass("ds_search_result_droppable")}))):(t.addClassName("ds_search_result_droppable"),t.addEventListener("dragover",(function(t){e.onDragOver(t)})),t.addEventListener("drop",(function(t){e.onDrop(t)})))},onDragOver:function(e){e&&e.stopPropagation&&e.stopPropagation(),e&&e.preventDefault&&e.preventDefault()},onDrop:function(a,n){var i=this;a&&a.stopPropagation&&a.stopPropagation(),a&&a.preventDefault&&a.preventDefault(),s.getUnifiedSearchObjectsFromDrop({ev:a}).then((function(a){if(a&&!e.Object.isEmptyObject(a)){var s=[],n=[];if(e.each(a,(function(e,t){t.type&&"DELLmiWorkPlanSystemReference"===t.type||t.taxonomies&&t.taxonomies.contains("DELLmiWorkPlanSystemReference")?s.push(t.id||t.physicalid):n.push(t)})),n.length>0&&(1===n.length?i._displayNotificationMessage("1 dropped object is not valid"):i._displayNotificationMessage(n.length+" dropped objects are not valid")),s){var o=i._workplanDropdown&&i._workplanDropdown.value?i._workplanDropdown.value.slice(0):[],l=o.slice(0).length,r=[];i._workplanDropdown&&i._workplanDropdown._selectionChips&&i._workplanDropdown._selectionChips._items&&e.each(s,(function(a,s){var n=!1;i._workplanDropdown&&i._workplanDropdown.value&&i._workplanDropdown.value.length>0&&e.each(i._workplanDropdown.value,(function(a,i){i===s?n=!0:t.getWorkPlan({workplan:{physicalid:i}}).then((function(t){if(t&&e.Object.isPlainObject(t)&&!e.Object.isEmptyObject(t)&&t&&(t.plmBaseObjectType&&"DELLmiWorkPlanSystemReference"===t.plmBaseObjectType||t.type&&"DELLmiWorkPlanSystemReference"===t.type)){o.splice(o.indexOf(i),1);o.push({label:(t.title||t.V_Name)+"-"+t.revision,value:t.id||t.physicalid})}}))})),n||r.push(s)})),e.each(r,(function(a,n){var r={workplan:{physicalid:n}};t.getWorkPlan(r).then((function(t){t&&e.Object.isPlainObject(t)&&!e.Object.isEmptyObject(t)&&(o.push({label:(t.title||t.V_Name)+"-"+t.revision,value:t.id||t.physicalid}),s.length+l===o.length&&(i._workplanDropdown.value=o))}))}))}}}))},_updateSectionHeaderCommands:function(e){var t=this;if(t.elements.mainDiv)if(t.elements.mainDiv.querySelector(".process-validation-icons")){var a=t.elements.mainDiv.querySelector(".process-validation-stop_icon"),s=t.elements.mainDiv.querySelector(".process-validation-details_icon"),n=t.elements.mainDiv.querySelector(".process-validation-start_icon");e||(e={});"started"===e.validationStatus||"running"===e.validationStatus?a.style.visibility="visible":"completed"!==e.validationStatus&&"stopped"!==e.validationStatus||(a.style.visibility="hidden"),e.validationStatus&&(s.style.visibility="visible",t.elements.mainDiv.querySelector(".wux-controls-popup")>0&&t._detailsBtnClicked());var i=t.elements.mainDiv.querySelector(".wux-controls-popup");n.style.visibility="visible",i&&t._detailsBtnClicked()}else setTimeout((function(){t._updateSectionHeaderCommands(e)}),500)},_addWorkplanDropdown:function(t){var a=this,s=e.extendElement(a.elements.mainDiv.querySelector("tr .process-validation-work-plan-dropdown"));s.innerHTML="<img src="+a._SpaceURL+"/webapps/DELWebInfrastructure/DSCommon/graphics/loading-small.gif></img>",s.removeClassName("loading"),s.innerHTML="";var n=new d({elementsTree:a._loadAllWorkplansPromise(),allowFreeInputFlag:!1,minLengthBeforeSearch:2,keepSearchResultsFlag:!0}).inject(s);n.elements.container.setStyle("width","100%"),a._workplanDropdownContainer=n.elements.container,a._workplanDropdown=n,n.addEventListener("change",(function(e){var t=e.dsModel.value;t&&0===t.length&&(a.elements._startValidationBtn.disabled=!0),s.value=t,t&&a.onWorkPlanChange(t)}))},_createWorkerFromBlob:function(t){var s=this;return new Promise((function(n,i){var o=null;if("function"==typeof t)o=new Blob([`(${t.toString()})()`],{type:"application/javascript"});else{if("string"!=typeof t)return e.log(s.name+"::_createWorkerFromBlob = unknown type of workerFn to create new web worker from"),null;o=new Blob([t],{type:"application/javascript"})}const l=URL.createObjectURL(o);var r=new Worker(l),d=e.clone(window.require.s.contexts._.config);delete d.shim;var u=window.widget.getValue("pad_security_ctx")||window.widget.getValue("collabSpace")||window.widget.getValue("Credentials");if(u&&0===u.indexOf("ctx::")&&(u=u.substring(5)),!u)return y.getInstance().getSecurityContext({onSuccess:function(e){if(e&&e.SecurityContext)return self.widget&&self.widget.setValue("pad_security_ctx",e.SecurityContext),s._createWorkerFromBlob(t).then(n,i);i(new Error("getSecurityContext"))},onFailure:function(){i(new Error("getSecurityContext"))}});var c=self.enoviaServerCAWidget&&self.enoviaServerCAWidget.contextUser?self.enoviaServerCAWidget.contextUser:null;self&&!c&&self.Foe&&self.Foe.Model&&self.Foe.Model.Session&&(c=self.Foe.Model.Session.get("user")),self&&!c&&self.widget&&!self.widget.standalone&&b&&b.getUser&&b.getUser()&&(c=b.getUser().login),self&&!c&&self.top&&(c=self.top.dsUserLogin),self&&!c&&self.widget&&self.widget.standalone&&s.useFixtures()&&(c="foe_session_fixture"),!s.options.navigateOnIndex&&a.isDatabase()&&(s.options.navigateOnIndex="Database");var p={require_config:d,security_ctx:u,navigateOn:s.options.navigateOnIndex,COMPASS_CONFIG:{userId:c,lang:self.widget&&self.widget.lang,myAppsBaseUrl:k.setupWebRoot(),tenant:self.widget.data.x3dPlatformId}};s._objConfig=p,k.getPlatformServices().then((function(e){if(p.objAllServices=e,!p.COMPASS_CONFIG.myAppsBaseUrl){var t=e["3DCompass"];if(!t||"string"!=typeof t){if(!self.widget||!self.widget.standalone)return void i(new Error("invalid 3DSpace URL"));self&&self.COMPASS_CONFIG.myAppsBaseUrl?t=self&&self.COMPASS_CONFIG.myAppsBaseUrl:s._data.platform_services&&s._data.platform_services["3DSpace"]&&(t=s._data.platform_services["3DSpace"])}if(!t)return void k.getServiceUrl({serviceName:"3DCompass"}).then((function(e){p.objAllServices["3DCompass"]=e,p.COMPASS_CONFIG.myAppsBaseUrl=e,r.postMessage({type:"config",config:p}),n(r)}),i);p.COMPASS_CONFIG.myAppsBaseUrl=t}r.postMessage({type:"config",config:p}),n(r)}),i)}))},_stopValidation:function(e){var a=this;a.elements.worker&&a.elements.worker.postMessage({type:"stop",config:a._objConfig}),a.elements._progressBar&&a._updateProgressBar(1,1),a._workplanDropdown&&(a._workplanDropdown.disabled=!1);var s={},n={};a._currentRunWorkplanID&&(n.workplanID=a._currentRunWorkplanID,s.workplanID=a._currentRunWorkplanID),a._currentRunProducedItemID&&(n.producedItemID=a._currentRunProducedItemID,s.producedItemID=a._currentRunProducedItemID),t.getCachedResults(n).then((function(e){s.resultsToCache={},s.resultsToCache.startDateTime=e.startDateTime,s.resultsToCache.endDateTime=(new Date).toLocaleString(),s.resultsToCache.user=e.user,s.resultsToCache.status="stopped",e.results&&(s.resultsToCache.results=e.results),t.cacheValidationResults(s).then((function(e){e&&e.status&&"stopped"===e.status&&k.publishEvent("ProcessValidation.Stopping",e)}),(function(){k.publishEvent("ProcessValidation.Stopping",s.resultsToCache)}))}),(function(){k.publishEvent("ProcessValidation.Stopping",{})}))},_startValidation:function(a,s){var n=this,i=(n._workplanDropdownContainer,n._workplanDropdown),o=s&&0!==s.length?s:JSON.parse(JSON.stringify(i.value));return n._selectedWorkPlanIDs=o,new Promise((function(s,l){var r=e.clone(window.require.s.contexts._.config);delete r.shim,n._createWorkerFromBlob(I).then((function(l){n.elements.worker=l;var d={type:"start",payload:{key:r,currentSelectedWorkPlanID:o[0],currentSelectedProducedItem:n._mapWorkplanProducedItem[o[0]]?n._mapWorkplanProducedItem[o[0]]:null}},u={};d&&d.payload&&d.payload.currentSelectedWorkPlanID&&(u.workplanID=d.payload.currentSelectedWorkPlanID,n._currentRunWorkplanID=u.workplanID),d&&d.payload.currentSelectedProducedItem&&d.payload.currentSelectedProducedItem&&(u.producedItemID=d.payload.currentSelectedProducedItem,n._currentRunProducedItemID=u.producedItemID),d&&(u.resultsToCache={},u.resultsToCache.startDateTime=(new Date).toLocaleString(),u.resultsToCache.user=b.getUser().firstName+" "+b.getUser().lastName,u.resultsToCache.status="started"),t.cacheValidationResults(u).then((function(e){e&&e.status&&"started"===e.status&&!e.workplan_id&&u.workplanID&&(e.workplan_id=u.workplanID),k.publishEvent("ProcessValidation.Started",u.resultsToCache)}),(function(){k.publishEvent("ProcessValidation.Started",u.resultsToCache)})),n._updateProgressBar(1,0),n.elements.worker.postMessage(d),n._workplanDropdown&&(n._workplanDropdown.disabled=!0);var c=!0;n.elements.worker.onmessage=function(s){if(s&&s.data&&s.data.type)switch(s.data.type){case"complete":if(s&&s.data&&s.data.result){var o={},l={};s.data.result&&s.data.result.workplan_id&&(l.workplanID=s.data.result.workplan_id),s.data.result&&s.data.result.produced_item_id&&(l.producedItemID=s.data.result.produced_item_id),n._selectedWorkPlanIDs&&n._selectedWorkPlanIDs.splice(n._selectedWorkPlanIDs.indexOf(n._selectedWorkPlanIDs[0]),1),t.getCachedResults(l).then((function(e){Object.keys(e)[0];var a=e;d&&d.payload&&d.payload.currentSelectedWorkPlanID&&(o.workplanID=d.payload.currentSelectedWorkPlanID),d&&d.payload.currentSelectedProducedItem&&d.payload.currentSelectedProducedItem&&(o.producedItemID=d.payload.currentSelectedProducedItem),d&&(o.resultsToCache={},o.resultsToCache.startDateTime=a.startDateTime||"",o.resultsToCache.endDateTime=(new Date).toLocaleString(),o.resultsToCache.user=a.user||b.getUser().firstName+" "+b.getUser().lastName,o.resultsToCache.status="completed",o.resultsToCache.results=s.data.result),t.cacheValidationResults(o).then((function(e){e&&e.status&&"completed"===e.status&&k.publishEvent("ProcessValidation.Completed",e)}),(function(){k.publishEvent("ProcessValidation.Completed",o.resultsToCache)}))}),(function(e){e&&k.publishEvent("ProcessValidation.Completed",{})}))}s&&s.data&&s.data.result&&(e.log("completed results: "),e.log(s.data.result),!s.data.result.workplan_id&&l.workplanID&&(s.data.result.workplan_id=l.workplanID),n._populateIssueAndWarningsTable(s.data.result,s.data.type),n._workplanDropdown&&(n._workplanDropdown.disabled=!1)),n._selectedWorkPlanIDs.length>0&&i.value.length>1&&n._startValidation(a,n._selectedWorkPlanIDs);break;case"success":n._displayNotificationMessage(C.get("{0} Success",{0:C.get("Process Validation")}),{level:"success"});break;case"fail":n._displayNotificationMessage(C.get("{0} Failure",{0:C.get("Process Validation")}));break;case"error":var r=C.get("{0} Error",{0:C.get("Process Validation")}),u=s.data.objError||{};e.Object.isPlainObject(u)&&!e.Object.isEmptyObject(u)&&(s.data.message||s.data.msg)?(u.title=r,u.message=s.data.message||s.data.msg,u instanceof Error&&e.log(u)):"string"==typeof u&&(r=u,u={}),n._displayNotificationMessage(r,u);break;case"status":if(c){o={},l={};s.data.options&&s.data.options.workplan_id&&(l.workplanID=s.data.options.workplan_id),s.data.options&&s.data.options.produced_item_id&&(l.producedItemID=s.data.options.produced_item_id),t.getCachedResults(l).then((function(e){Object.keys(e)[0];var a=e;d&&d.payload&&d.payload.currentSelectedWorkPlanID&&(o.workplanID=d.payload.currentSelectedWorkPlanID),d&&d.payload.currentSelectedProducedItem&&d.payload.currentSelectedProducedItem&&(o.producedItemID=d.payload.currentSelectedProducedItem),d&&(o.resultsToCache={},o.resultsToCache.startDateTime=a.startDateTime||"",o.resultsToCache.endDateTime=(new Date).toLocaleString(),o.resultsToCache.user=a.user||b.getUser().firstName+" "+b.getUser().lastName,o.resultsToCache.status="running",o.resultsToCache.results=s.data.options),t.cacheValidationResults(o).then((function(e){e&&"running"===e.status&&k.publishEvent("ProcessValidation.Running",e)}),(function(){k.publishEvent("ProcessValidation.Running",o.resultsToCache)}))}),(function(e){k.publishEvent("ProcessValidation.Running",{})})),c=!1}s.data&&s.data.options&&s.data.options.total_steps&&s.data.options.completed_steps&&(n._updateProgressBar(s.data.options.total_steps,s.data.options.completed_steps),!s.data.options.workplan_id&&l.workplanID&&(s.data.options.workplan_id=l.workplanID),n._populateIssueAndWarningsTable(s.data.options,s.data.type))}},s(n.elements.worker)}),l)}))},_loadAllWorkplansPromise:function(){var a=this;a._workplanDropdownContainer;return function(s){return new Promise((function(n,i){t.getAllWorkPlans({Minimum:["V_Name","taxonomies","revision"],search_str:s}).then((function(t){t=Object.keys(t).sort().reduce((function(e,a){return e[a]=t[a],e}),{});var s=a._workplanDropdownContainer;e.extendElement(s).removeClassName("loading");var i=[];e.each(t,(function(e,t){i.push({label:t.V_Name+"-"+t.revision,value:t.physicalid,description:t.V_Name})})),i=i.sort((function(e,t){return e&&t?""===e.value?-1:""===t.value||e.label>t.label?1:-1:0})),n(i)}))}))}},_populateIssueAndWarningsTable:function(a,s){var n=this,i=[],o=a.workplan_id;t.getWorkPlan({workplan:{physicalid:o}}).then((function(o){var l=!1;e.each(a,(function(t,a){return"workplan_id"!==t&&e.Object.isPlainObject(a)&&a.result&&(l="blocking"===a.result||"warning"===a.result),!l}));if(o&&o.PLMData&&o.PLMData[a.workplan_id]&&(o=o.PLMData[a.workplan_id]),l){n._clearMessage();var r=null;r={label:o.title||o.name||o.V_Name,dsModel:o,grid:{type:C.get("Workplan")||o.plmObjectType||o.type||""},children:[]},k.getReferenceIconPath(o).then((function(t){r.icons=[t],i.push(r),n.addRootNodesToTable(i).then((function(t){n.elements._uwaTree&&n.elements._uwaTree.prepareUpdateView(),e.each(t,(function(t,s){s&&s.options&&s.options.dsModel&&(s.options.dsModel.id||s.options.dsModel.physicalid)===a.workplan_id&&(a.workplan_id&&delete a.workplan_id,e.each(a,(function(t,a){a&&e.Object.isPlainObject(a)&&a.issues&&e.each(a.issues,(function(t,i){var o=i.operation||{};k.getReferenceIconPath(o).then((function(t){var o=null,l=s.getChildren();if(l&&0===l.length?o=null:e.each(l,(function(e,t){if(i&&i.operation){if(i.operation.physicalid===t.options.dsModel.physicalid)return o=t,!1}else if(i&&i.short&&i.short===t.options.dsModel.short)return o=t,!1})),o){(d={label:i.short,dsModel:{messages:a.messages,short:i.short},grid:{type:"blocking"===a.result?C.get("Blocking Issue"):"warning"===a.result?C.get("Warning Issue"):""}}).label=n._addErrorWarningLabel(d,a.result),e.each(l,(function(t,a){var s=!1,l=a.getAllDescendants();a&&a.options&&a.options.dsModel&&a.options.dsModel.physicalid&&e.each(l,(function(e,t){if(t&&t.options&&t.options.dsModel&&t.options.dsModel.short&&t.options.dsModel.short===i.short)return s=t,!1})),s||i&&i.operation&&"physicalid"in a.options.dsModel&&i.operation.physicalid===a.options.dsModel.physicalid&&(o=a,a.addChild(d),n.onResize(),a.setState({state:a.hasChildren()?"expanded":"noChildren"})),a.setState({state:a.hasChildren()?"expanded":"noChildren"})}))}else{var r={};i.operation?r={label:i.operation.V_Name||i.operation.name,dsModel:i.operation,icons:[t],grid:{type:i.operation.plmObjectType||""},children:[]}:!("operation"in i)&&i.short&&(r={label:i.short,dsModel:{messages:a.messages,short:i.short},grid:{type:"blocking"===a.result?C.get("Blocking Issue"):"warning"===a.result?C.get("Warning Issue"):""}});var d=null;i.operation?((d={label:i.short,dsModel:{messages:a.messages,short:i.short},grid:{type:"blocking"===a.result?C.get("Blocking Issue"):"warning"===a.result?C.get("Warning Issue"):""}}).label=n._addErrorWarningLabel(d,a.result),i.short&&r.children.push(d)):"operation"in i||!i.short||d||(r.label=n._addErrorWarningLabel(r,a.result)),s.addChild(r),n.onResize(),s.setState({state:s.hasChildren()?"expanded":"noChildren"})}}))})),n.onResize()}))),s.setState({state:s.hasChildren()?"expanded":"noChildren"})})),n.elements._uwaTree&&(n.elements._uwaTree.reapplySortModel(),n.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0))}))}))}else if(!l&&s&&"complete"===s){var d={},u={};a&&a.workplan_id&&(u.workplanID=a.workplan_id,d.workplanID=a.workplan_id),a&&a.produced_item_id&&(u.producedItemID=a.produced_item_id,d.producedItemID=a.produced_item_id),t.getCachedResults(u).then((function(e){Object.keys(e)[0];var s=e;d.resultsToCache={},d.resultsToCache.startDateTime=s.startDateTime||"",d.resultsToCache.endDateTime=(new Date).toLocaleString(),d.resultsToCache.user=s.user||b.getUser().firstName+" "+b.getUser().lastName,d.resultsToCache.status="passed",d.resultsToCache.results=a,t.cacheValidationResults(d).then((function(e){e&&e.status&&"passed"===e.status&&k.publishEvent("ProcessValidation.Completed",e)}),(function(){k.publishEvent("ProcessValidation.Completed",d.resultsToCache)}))}),(function(e){e&&k.publishEvent("ProcessValidation.Completed",{})}))}}))},_clearMessage:function(){var e=this;e.elements.mainDiv.querySelector(".pv_report_details_message")&&(e.elements.mainDiv.querySelector(".pv_report_details_message").classList.contains("ui-resizable")?(e.elements.mainDiv.querySelector(".pv_report_details_message").innerHTML="",e.elements.mainDiv.querySelector(".pv_report_details_message").innerHTML='<div class="helper" draggable="false"><i class="helper_edit_img wux-ui-3ds wux-ui-3ds-4x wux-ui-3ds-table-row-add"></i><h5 class="helper_edit_txt">'+C.get("Select any issue row")+"</h5></div>"):e.elements.mainDiv.querySelector(".pv_report_details_message").innerHTML='<div class="helper" draggable="false"><i class="helper_edit_img wux-ui-3ds wux-ui-3ds-4x wux-ui-3ds-table-row-add"></i><h5 class="helper_edit_txt">'+C.get("Select any issue row")+"</h5></div>")},_loadDetails:function(t){var a=this,s=a.elements.mainDiv.querySelector(".pv_report_details_message");if(s){var n=null,i=null;if(t&&e.each(t,(function(e,t){t&&t.short&&t.messages&&t.messages[t.short]&&(n=t.messages[t.short].long,i=t.messages[t.short].fixes)})),t||n||i)if(n){var o=a.elements.mainDiv.querySelector(".details_message-container");if(!o){var l='<div class="wux-layouts-gridengine-scroller-container"><div class="details_message-container wux-layouts-gridengine"><table><tr class="error_details"><th class="report_details_message_label"><b>'+C.get("Error Details")+':</b></th><td class="report_details_message_details"></td></tr><tr class="possible_fixes"><th class="report_details_message_label"><b>'+C.get("Possible Fixes")+':</b></th><td class="report_details_message_details"></td></tr></table></div></div>';s.innerHTML="",s.innerHTML+=l,o=a.elements.mainDiv.querySelector(".details_message-container")}var r=n;n&&e.Object.isPlainObject(n)&&n.nlsText&&(r=n.nlsText,n.lang&&window.widget.lang&&(n.lang!==window.widget.lang||n.vars&&n.nlsText.indexOf("{0}")>=0)&&n.text&&(r=0===window.widget.lang.indexOf("en")?C.get(n.text,n.vars):C.get(n.text,e.extend(!0,{defaultValue:n.nlsText},n.vars))));var d=o.querySelector(".error_details .report_details_message_details");d.textContent=r||"";var u=o.querySelector(".possible_fixes .report_details_message_details");u.innerHTML="",i&&("string"==typeof i&&(i=[i]),e.each(i,(function(t,a){if(a){var s=a;a.lang&&window.widget.lang&&a.lang!==window.widget.lang&&a.text&&(s=0===window.widget.lang.indexOf("en")?C.get(a.text,a.vars):C.get(a.text,e.extend(!0,{defaultValue:a},a.vars)));var n="<div> "+(t+1)+". "+s+"</div>";u.innerHTML+=n}})))}else a._clearMessage();else a._clearMessage()}},_addErrorWarningLabel:function(e,t){return"warning"===t?e.label='<span class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-attention"></span> '+e.label:"blocking"===t&&(e.label='<span class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-alert"></span> '+e.label),e.label},_updateProgressBar:function(e,t){var a=this,s=Math.round((t||0)/(e||t||1)*100);a.elements._progressBar?a.elements._progressBar.value=s:a.elements._progressBar=new h({value:s||0}).inject(a.elements.mainDiv.querySelector(".process_validation_progress")),t>=e&&(!a._selectedWorkPlanIDs||0===a._selectedWorkPlanIDs.length)&&setTimeout((function(){a.elements._progressBar&&(a.elements._progressBar.getContent().addClassName("process-validation-fadeOut"),setTimeout((function(){a.elements._progressBar.destroy(),a.elements._progressBar=null}),5e3))}),2e3)},onWorkPlanChange:function(a){var s=this;if(!this._blnIgnoreWorkPlanChange){var n=[];n=(a&&a.length,a),s.elements.mainDiv.querySelector(".process_validation_status")&&(s.elements.mainDiv.querySelector(".process_validation_status").innerHTML=""),s.elements.mainDiv.querySelector(".process_validation_message")&&(s.elements.mainDiv.querySelector(".process_validation_message").innerHTML=""),s.elements._uwaTree&&(s.elements._uwaTree.destroy(),s.elements._uwaTree=null);var i=e.extendElement(s.elements.mainDiv.querySelector("tr .process-validation-produced-item-label_RO"));i.innerHTML="",n&&n.length>0?k.getServiceUrl({serviceName:"3DSpace"}).then((function(a){s._SpaceURL=a,i.innerHTML="<img src="+s._SpaceURL+"/webapps/DELWebInfrastructure/DSCommon/graphics/loading-small.gif></img>";var o=!1,l=0;e.each(n,(function(a,r){t.getWorkPlan({workplan:{physicalid:r}}).then((function(a){t.getProducedItemsForMfgProcess({workplan:{physicalid:r}}).then((function(d){if(l++,d&&1===d.length)d[0]&&d[0].itemRef&&d[0].itemRef.identifier&&t.getProducedItem({physicalid:d[0].itemRef.identifier}).then((function(n){e.Object.isEmptyObject(n)||(i.innerHTML.indexOf("loading")>-1&&(i.innerHTML=""),u&&""!==u.value&&(n.title=u.value+n.title),s._mapWorkplanProducedItem[r]=n.id,(u=new _({value:n.V_Name||n.title}).inject(i)).elements.container.querySelector("span.wux-controls-label-content").addClassName("wux-controls-label-secondary"),s._myLabel=u,s._myLabel.tooltipInfos={title:(a.V_Name||a.title)+"-"+a.revision});var o={};o.workplanID=r,o.producedItemID=n.id,t.getCachedResults(o).then((function(t){t&&!e.Object.isEmptyObject(t)&&(s._addSectionHeaderStatus({ValidationStarted:t.startDateTime,ValidationEnded:t.endDateTime,user:t.user,validationStatus:t.status,validationResult:t.results}),s._updateSectionHeaderCommands(t),t.results&&(t.results.completed_steps&&t.results.total_steps&&t.results.completed_steps>=t.results.total_steps?s._updateWorkplanStatus(t,t.status):s._updateWorkplanStatus(t,"stopped"),!t.results.workplan_id&&o.workplanID&&(t.results.workplan_id=o.workplanID),s._populateIssueAndWarningsTable(t.results)))}),(function(){s._addSectionHeaderStatus({ValidationStarted:null,ValidationEnded:null,user:"",validationStatus:""}),s._updateSectionHeaderCommands()}))})),s.elements._stopValidationBtn.disabled=!0,s.elements.mainDiv.querySelector(".process_validation_status").textContent=C.get("Click the Play button to run validation.");else if(d&&d.length>1){o=!0,i.innerHTML="",(u=new _({value:"Multiple Produced Items"}).inject(i)).elements.container.querySelector("span.wux-controls-label-content").addClassName("wux-controls-label-secondary"),s.elements._startValidationBtn.disabled=!0,s.elements._stopValidationBtn.disabled=!0,s.elements.mainDiv.querySelector(".process_validation_status").textContent=C.get("Process Validation cannot be run on workplan with multiple produced items.")}else if(0===d.length){var u;i.innerHTML="",(u=new _({value:"No Produced Items"}).inject(i)).elements.container.querySelector("span.wux-controls-label-content").addClassName("wux-controls-label-secondary"),o=!0,s.elements._startValidationBtn.disabled=!0,s.elements._stopValidationBtn.disabled=!0,s.elements.mainDiv.querySelector(".process_validation_status").textContent=C.get("Process Validation cannot be run on workplan with no produced items.")}l===n.length&&(o||(s.elements._startValidationBtn.disabled=!1)),s.elements._resetBtn.disabled=!1}))}))}))})):s.elements.mainDiv.querySelector(".process-validation-produced-item-label_RO").innerHTML=C.get("Choose a Workplan to see the produced item.")}},addRootNodesToTable:function(t,a){var s=this;return new Promise((function(n,i){if(!t||!Array.isArray(t)||t.length<=0)return!1;s.addTable().then((function(o){if(!o)return i(new Error("invalid table")),!1;a&&o.getTreeDocument()&&(o.placeholder="",o.getTreeDocument().removeRoots());var l=o.getTreeDocument(),r=l.getRoots(),d=[],u=window.widget.getUrl()||"";u&&(u=(u=u.substr(0,u.lastIndexOf("/"))).substr(0,u.lastIndexOf("/"))),s.elements._uwaTree.prepareUpdateView(),e.each(t,(function(t,a){if(r){var s=!0;if(e.each(r,(function(e,t){return t&&t.options&&t.options.dsModel&&a.dsModel&&("id"in t.options.dsModel?s=t.options.dsModel.id!==a.dsModel.id:"physicalid"in t.options.dsModel&&(s=t.options.dsModel.physicalid!==a.dsModel.physicalid)),s})),!s)return void(d=r)}var n=new g(a);n.dsModel=a.dsModel,l.addRoot(n),d.push(n)})),s.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0),n(d)}),i)}))},addTable:function(){var e=this;return new Promise((function(t,a){if(e.elements&&e.elements.mainDiv&&e.elements.mainDiv.querySelector(".pv_report_process_validation_list")){if(!e.elements._uwaTree){var s={identifier:"DELWebProcessValidationDialog",cellSelection:"none",enableListSelection:!0,canMultiSelect:!0,isEditable:!1,cellDragEnabledFlag:!1,columns:[{text:C.get("Name"),allowUnsafeHTMLContent:!0,dataIndex:"tree",width:"250px"},{text:C.get?C.get("Type"):"Type",dataIndex:"type"}],roots:[]};s.treeDocument=new m,e.elements.mainDiv.querySelector(".pv_report_process_validation_list").innerHTML="",e.elements._uwaTree=new p(s).inject(e.elements.mainDiv.querySelector(".pv_report_process_validation_list")),e.elements._uwaTree.getNodesXSO().onChange((function(){e.onSelectionChange()})),e.elements._uwaTree.getContainingImmersiveFrame&&!e.elements._uwaTree._getContainingImmersiveFrame&&(e.elements._uwaTree._getContainingImmersiveFrame=e.elements._uwaTree.getContainingImmersiveFrame,e.elements._uwaTree.getContainingImmersiveFrame=function(){var e=this._getContainingImmersiveFrame();if(!e){var t=null,a=window.document.getElementsByClassName("wux-windows-immersive-frame");if(a&&a.length)for(var s=0;!t&&s<a.length;++s)a[s]&&a[s].dsModel&&(t=a[s].dsModel);t&&t.getImmersiveFrame&&(e=t.getImmersiveFrame())}return e}),e.onResize()}t(e.elements._uwaTree)}else a(new Error("invalid container"))}))},setObjectIcon:function(e,t,a){return Dfd.PanelCommon.setObjectIcon.call(this,e,t||e.dsModel,a)},onResize:function(){var e=this;if(e.elements.mainDiv){var t=e.elements.mainDiv.querySelector(".pv_report_process_validation_list"),a=(e.elements.mainDiv.querySelector(".process-validation_section.mainRow"),e.elements.mainDiv.querySelector(".pv_report_details_message"));e.elements.mainDiv.clientHeight;if(a&&a.length&&(a.classList.contains("ui-resizable")&&a.removeClassName("ui-resizable"),!a.classList.contains("ui-resizable"))){t.querySelector(".wux-layouts-datagridview").style.height="100%",a.querySelector(".wux-layouts-gridengine-scroller-container,.wux-scroller").style.height="100%";var s=t.offsetTop,n=a.offsetTop,i=Math.max(100,n-s);t.style.height=i+"px";var o=e.element.offsetTop,l=e.element.offsetHeight,r=t.offsetTop,d=t.offsetHeight,u=Math.min(o+l-5,r+d),c=(l=e.element.offsetHeight,Math.max(5,l-u));c<100?a.querySelector(".helper_img,.helper_edit_img").removeClassName("wux-ui-3ds-4x"):a.querySelector(".helper_img,.helper_edit_img").addClassName("wux-ui-3ds-4x");var p=a,m=parseInt(getComputedStyle(p).minHeight,10),g=Math.min(c,m);p.style.top=u+"px",p.style.minHeight=g+"px",p.style.height=c+"px";var _=a.querySelector(".resizer-n"),v=parseInt(getComputedStyle(a).minHeight,10),h=document.querySelector(".scheduling_readiness_validation_list").offsetHeight,w=Math.max(a.offsetHeight,parseInt(.66*(h+a.offsetHeight)));let f,S,D;function b(e){var s=f-e.clientY;let n=Math.min(w,Math.max(v,S+s)),i=D-(n-S);if(n<v){var o=v,l=v-n;t.style.height=D-t.offsetTop-l+"px",a.style.top="",a.style.height=o+"px"}else a.style.top=i+"px",a.style.height=n+"px",t.style.height=i-t.offsetTop+"px"}function y(){document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",y)}_.addEventListener("mousedown",(function(e){e.preventDefault(),f=e.clientY,S=a.offsetHeight,D=a.offsetTop,document.addEventListener("mousemove",b),document.addEventListener("mouseup",y)}))}}},onSelectionChange:function(){var e=this;if(e.elements&&e.elements._uwaTree){var t=e.elements._uwaTree.getNodesXSO().get();if(!t||t.length<=0);else{var a=t[0];e._loadDetails({dsModel:a.options.dsModel})}}else steal.dev.log(this.constructor.fullName+"::onSelectionChange - tree!")},_initEventHandlers:function(){var e=this;this._initDropEventHandlers(),this.addEventListener("close",(function(){e.destroy()}))},clearSelection:function(){},_displayNotificationMessage:function(t,a){e.log("_displayNotificationMessage, strMsg = "+t),e.log(a),D._getNotificationManager||(D._getNotificationManager=D.getNotificationManager,D.getNotificationManager=function(){return this._getNotificationManager()||this._manager}),D.getNotificationManager()||D._manager||(D.setNotificationManager(S),D.setRemoveStackOnFirstTimeoutFlag(!0),D.setStackingPolicy(31)),a||(a={}),a.message||("string"==typeof t?a.message=t:(t.message||t.msg)&&(a.message=t.message||t.msg)),a.level||(a.level="error"),"subtitle"in a||(a.subtitle=""),"sticky"in a||(a.sticky=!1),"category"in a||(a.category=(a.message||"").toString()),"title"in a||(a.title=C.get(e.String.capitalize(a.level.toLowerCase()))),S.addNotif(a),t.stack?window.console&&window.console.warn?window.console.warn(t.stack):e.log(t.stack):a.stack&&(window.console&&window.console.warn?window.console.warn(a.stack):e.log(a.stack))}});return x}));