define("DS/DELPPWProcessValidationModule/worker/rule04_TimeConstraints",[],(function(){"use strict";return function(){var e={};self.onmessage=function(n){if(n&&n.data)switch(n.data.type){case"config":if(n.data.config&&(e=Object.assign(e,n.data.config),(n.data.config.sec_context||n.data.config.security_ctx)&&(self.sec_context=n.data.config.sec_context||n.data.config.security_ctx),n.data.config.COMPASS_CONFIG&&(self.COMPASS_CONFIG=Object.clone?Object.clone(n.data.config.COMPASS_CONFIG):n.data.config.COMPASS_CONFIG),n.data.config.require_config)){if(n.data.config.require_config.baseUrl)importScripts(n.data.config.require_config.baseUrl+"/AmdLoader/AmdLoader.js");else{const e=(self.location+"").replace(/\/[^/]+$/,"/").replace(/:444\/$/,"");var r=null;e.indexOf("blob:")>-1&&(r=e.replace(/^blob:/,"")),importScripts(r+"/3DSpace/webapps/AmdLoader/AmdLoader.js")}self.require&&self.require.config(n.data.config.require_config)}break;case"start":n.data.options&&n.data.options.workplan&&n.data.options.workplan.physicalid&&t(n.data.options);break;default:self.postMessage({type:"error",msg:"Invalid event type = "+n.data.type})}else self.postMessage({type:"error",msg:"Invalid event data"})};var t=function(t){var n={rule04_TimeConstraints:{result:"pass"}};self.require(["DS/DELWebInfrastructureControls/UWAUtils","DS/DELPPWProcessValidationModule/DELWebProcessValidationModel","DS/DELWebInfrastructureControls/DELWebIndexAuthoringMgmt"],(function(r,o,a){r.log("Inside rule04_TimeConstraints require"),e&&(e.objAllServices&&o.updatePlatformServicesCache(e.objAllServices),e.navigateOn&&("Database"===e.navigateOn?a.setDatabase():a.setIndex()));var i=n.rule04_TimeConstraints,s=t.workplan;o.getAllTimeConstraints({physicalid:s.physicalid||s.id}).then((function(e){r.log("workplanTimeConstraintsReturn: "),r.log(e);var t=[];if(e&&e.length){var a=[];r.each(e,(function(e,t){t&&t.fromOperationOcc&&Array.isArray(t.fromOperationOcc)&&1===t.fromOperationOcc.length&&t.toOperationOcc&&Array.isArray(t.toOperationOcc)&&1===t.toOperationOcc.length&&(t.isProductFlow||a.push(t))})),a.length>0&&t.push(new Promise((function(e,t){o.getAllDescendantsForWorkplan({physicalid:s.physicalid||s.id,Depth:1}).then((function(o){r.log("workplanDescendantsReturn: "),r.log(o),o&&!r.Object.isEmptyObject(o)?(r.each(a,(function(e,n){i.result="warning";var a={short:'All relations between Header Operation must be "Product Flow".',timeConstraint:n};i.messages||(i.messages={}),i.messages[a.short]||(i.messages[a.short]={long:"All flows between Header Operations within a Workplan must be Product Flows.",fixes:['Update the relation type to be "Product Flow".',"Remove the relation from the child Header Operation."]}),r.each(["fromOperationOcc","toOperationOcc"],(function(e,i){if(n[i]&&Array.isArray(n[i])&&!(n[i].length<=0)&&n[i][n[i].length-1].instanceObject&&n[i][n[i].length-1].instanceObject.identifier){var s=n[i][n[i].length-1].instanceObject;if(s.physicalid||(s.physicalid=s.identifier),s.ReferencePhysicalid||(o[s.identifier]?s=Object.assign(s,o[s.identifier]):r.each(o,(function(e,t){return t&&t.physicalid===s.identifier&&(s=Object.assign(s,t)),!s.ReferencePhysicalid}))),s.ReferencePhysicalid||s.ReferenceOXID){var c="fromOperationOcc"===i?"operation":"operationTo";a[c+"Instance"]=s,o[s.ReferencePhysicalid]?a[c]=o[s.ReferencePhysicalid]:s.ReferenceOXID&&o[s.ReferenceOXID]?a[c]=o[s.ReferenceOXID]:r.each(o,(function(e,t){return!t||t.physicalid!==s.ReferencePhysicalid&&t.OXID!==s.ReferenceOXID||(a[c]=t,!1)}))}else a[c]=s}else t(new Error("invalid index in the time constraint: "+i))})),a.operationTo&&!a.operation&&(r.log("rule04 - unable to locate FROM operation.  Using TO operation instead..."),a.operation=a.operationTo,a.operationInstance=a.operationToInstance,delete a.operationTo,delete a.operationToInstance),a.operation||t(new Error("rule04: unable to locate operation!")),i.issues||(i.issues=[]),i.issues.push(a)})),e()):self.postMessage({type:"complete",result:n})}),t)})))}Promise.all(t).then((function(){self.postMessage({type:"complete",result:n})}),(function(e){self.postMessage({type:"error",msg:"Unable to retrieve items for operations",objError:e})}))}),(function(e){self.postMessage({type:"error",msg:"Error",objError:e})}))}))}}}));