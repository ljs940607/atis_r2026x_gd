define("DS/DELPPWProcessValidationModule/worker/rule13_CapableResourceOnWorkpanOrSteps",[],(function(){"use strict";return function(){var e={};self.onmessage=function(r){if(r&&r.data)switch(r.data.type){case"config":if(r.data.config&&(e=Object.assign(e,r.data.config),(r.data.config.sec_context||r.data.config.security_ctx)&&(self.sec_context=r.data.config.sec_context||r.data.config.security_ctx),r.data.config.COMPASS_CONFIG&&(self.COMPASS_CONFIG=Object.clone?Object.clone(r.data.config.COMPASS_CONFIG):r.data.config.COMPASS_CONFIG),r.data.config.require_config)){if(r.data.config.require_config.baseUrl)importScripts(r.data.config.require_config.baseUrl+"/AmdLoader/AmdLoader.js");else{const e=(self.location+"").replace(/\/[^/]+$/,"/").replace(/:444\/$/,"");var a=null;e.indexOf("blob:")>-1&&(a=e.replace(/^blob:/,"")),importScripts(a+"/3DSpace/webapps/AmdLoader/AmdLoader.js")}self.require&&self.require.config(r.data.config.require_config)}break;case"start":r.data.options&&r.data.options.workplan&&r.data.options.workplan.physicalid&&s(r.data.options);break;default:self.postMessage({type:"error",msg:"Invalid event type = "+r.data.type})}else self.postMessage({type:"error",msg:"Invalid event data"})};var s=function(s){var r={rule13_CapableResourceOnWorkpanOrSteps:{result:"pass"}};self.require(["DS/DELWebInfrastructureControls/UWAUtils","DS/DELPPWProcessValidationModule/DELWebProcessValidationModel","DS/DELWebInfrastructureControls/DELWebIndexAuthoringMgmt"],(function(a,i,t){a.log("Inside rule13_CapableResourceOnWorkpanOrSteps require"),e&&(e.objAllServices&&i.updatePlatformServicesCache(e.objAllServices),e.navigateOn&&("Database"===e.navigateOn?t.setDatabase():t.setIndex()));var n=s.workplan;i.getAllDescendantsForWorkplan({physicalid:n.physicalid||n.id,Depth:2}).then((function(e){if(e&&!a.Object.isEmptyObject(e)){var s=r.rule13_CapableResourceOnWorkpanOrSteps,t=[];a.each(e,(function(s,r){return!r||r.physicalid!==(n.physicalid||n.id)||((n=Object.assign(n,r)).children&&n.children.length&&a.each(n.children,(function(s,r){r&&(r.OXID&&e[r.OXID]?n.children[s]=Object.assign(e[r.OXID],r):r.physicalid&&e[r.physicalid]?n.children[s]=Object.assign(e[r.physicalid],r):a.each(e,(function(a,i){return r.OXID&&r.OXID===i.OXID?(n.children[s]=Object.assign(e[a],r),!1):!r.physicalid||r.physicalid!==i.physicalid||(n.children[s]=Object.assign(e[a],r),!1)})))})),!1)})),a.each(e,(function(e,r){if(r&&!r.ReferencePhysicalid&&!r.ReferenceOXID){if(r.physicalid!==n.physicalid&&n.children&&n.children.length){var o=!1;if(a.each(n.children,(function(e,s){if(s)return(s.ReferenceOXID&&s.ReferenceOXID===r.OXID||s.ReferencePhysicalid&&s.ReferencePhysicalid===r.physicalid)&&(o=!0),!o})),!o){var c=!1;a.each([r.plmObjectTypeInternal,r.plmBaseObjectType,r.plmObjectType,r.type],(function(e,s){return!(c=(s||"").toLowerCase().indexOf("operationreference")>=0)})),o=!c}if(o)return}t.push(new Promise((function(e,t){i.getPrimaryCapableResources(r).then((function(i){i&&!a.Object.isEmptyObject(i)&&a.each(i,(function(e,a){return!a||!a.physicalid||(s.result="blocking",s.messages||(s.messages={}),s.messages["No capable resources on Work Plan or Operations Steps."]||(s.messages["No capable resources on Work Plan or Operations Steps."]={long:"Primary Resources are not allowed on Work Plan or on Operations Steps.",fixes:["Remove the Primary Resources from the object.","Remove the Operation from the child Header Operation."]}),s.issues||(s.issues=[]),s.issues.push({short:"No capable resources on Work Plan or Operations Steps.",operation:r,resource:a}),r.physicalid===n.physicalid&&(s.issues[s.issues.length-1].workplan=r,delete s.issues[s.issues.length-1].operation),!1)})),e(i)}),t)})))}})),Promise.all(t).then((function(){self.postMessage({type:"complete",result:r})}),(function(e){self.postMessage({type:"error",msg:"Unable to retrieve primary resources for child header operations",objError:e})}))}else self.postMessage({type:"complete",result:r})}),(function(e){self.postMessage({type:"error",msg:"Error",objError:e})}))}))}}}));