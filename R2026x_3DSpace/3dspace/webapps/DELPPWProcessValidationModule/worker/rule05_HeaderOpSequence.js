define("DS/DELPPWProcessValidationModule/worker/rule05_HeaderOpSequence",[],(function(){"use strict";return function(){var e={};self.onmessage=function(o){if(o&&o.data)switch(o.data.type){case"config":if(o.data.config&&(e=Object.assign(e,o.data.config),(o.data.config.sec_context||o.data.config.security_ctx)&&(self.sec_context=o.data.config.sec_context||o.data.config.security_ctx),o.data.config.COMPASS_CONFIG&&(self.COMPASS_CONFIG=Object.clone?Object.clone(o.data.config.COMPASS_CONFIG):o.data.config.COMPASS_CONFIG),o.data.config.require_config)){if(o.data.config.require_config.baseUrl)importScripts(o.data.config.require_config.baseUrl+"/AmdLoader/AmdLoader.js");else{const e=(self.location+"").replace(/\/[^/]+$/,"/").replace(/:444\/$/,"");var a=null;e.indexOf("blob:")>-1&&(a=e.replace(/^blob:/,"")),importScripts(a+"/3DSpace/webapps/AmdLoader/AmdLoader.js")}self.require&&self.require.config(o.data.config.require_config)}break;case"start":o.data.options&&o.data.options.workplan&&o.data.options.workplan.physicalid&&i(o.data.options);break;default:self.postMessage({type:"error",msg:"Invalid event type = "+o.data.type})}else self.postMessage({type:"error",msg:"Invalid event data"})};var i=function(i){var o={rule05_HeaderOpSequence:{result:"pass"}},a=o.rule05_HeaderOpSequence;self.require(["DS/DELWebInfrastructureControls/UWAUtils","DS/DELPPWProcessValidationModule/DELWebProcessValidationModel","DS/DELWebInfrastructureControls/DELWebIndexAuthoringMgmt"],(function(r,t,n){r.log("Inside rule05_HeaderOpSequence require"),e&&(e.objAllServices&&t.updatePlatformServicesCache(e.objAllServices),e.navigateOn&&("Database"===e.navigateOn?n.setDatabase():n.setIndex())),t.getWorkPlan({workplan:i.workplan}).then((function(e){if(e){var i=[];"Advanced"===e.sequencingMode&&i.push(new Promise((function(i,o){t.getAllDescendantsForWorkplan({physicalid:e.physicalid||e.id,Depth:1}).then((function(n){if(n&&!r.Object.isEmptyObject(n)){var s={};r.each(n,(function(i,o){o&&o.physicalid&&!o.ReferencePhysicalid&&o.physicalid!==(e.physicalid||e.id)&&t.isHeaderOperation(o)&&(s[o.physicalid]=o)})),r.Object.isEmptyObject(s)?i(n):t.getAllTimeConstraints({physicalid:e.physicalid||e.id}).then((function(e){r.log("workplanTimeConstraintsReturn: "),r.log(e);var t=[];if(r.each(e,(function(e,i){i&&i.isProductFlow&&"Good"===i.flowType&&i.fromOperationOcc&&Array.isArray(i.fromOperationOcc)&&1===i.fromOperationOcc.length&&i.toOperationOcc&&Array.isArray(i.toOperationOcc)&&1===i.toOperationOcc.length&&t.push(i)})),t.length<=1)i(t);else{var c=[];if(r.each(t,(function(e,i){var a={timeConstraint:i};if(r.each(["fromOperationOcc","toOperationOcc"],(function(e,o){if(i[o]&&Array.isArray(i[o])&&!(i[o].length<=0)&&i[o][i[o].length-1].instanceObject&&i[o][i[o].length-1].instanceObject.identifier){var t=i[o][i[o].length-1].instanceObject;if(t.physicalid||(t.physicalid=t.identifier),t.ReferencePhysicalid||(n[t.identifier]?t=Object.assign(t,n[t.identifier]):r.each(n,(function(e,i){return i&&i.physicalid===t.identifier&&(t=Object.assign(t,i)),!t.ReferencePhysicalid}))),t.ReferencePhysicalid||t.ReferenceOXID){var s="fromOperationOcc"===o?"operation":"operationTo";a[s+"Instance"]=t,n[t.ReferencePhysicalid]?a[s]=n[t.ReferencePhysicalid]:t.ReferenceOXID&&n[t.ReferenceOXID]?a[s]=n[t.ReferenceOXID]:r.each(n,(function(e,i){return!i||i.physicalid!==t.ReferencePhysicalid&&i.OXID!==t.ReferenceOXID||(a[s]=i,!1)}))}}})),a.operation&&a.operationTo)if(delete s[a.operation.physicalid],delete s[a.operationTo.physicalid],0===c.length)c.push(a);else{for(var t=c.length,l=0;l<c.length;++l){if(c[l].operation.physicalid===a.operation.physicalid){l===c[l].length-1?c.push(a):c.splice(l+1,0,a);break}}if(t===c.length)for(l=c.length-1;l>=0;--l){if(c[l].operationTo.physicalid===a.operationTo.physicalid){l===c[l].length-1?c.push(a):c.splice(l+1,0,a);break}}t===c.length&&c.unshift(a)}else o(new Error("rule06: unable to retrieve all the references"))})),c.length>1){for(var l=!0,p=0;l&&p<c.length+1;++p){l=!1;for(var d=0;!l&&d<c.length-1;++d)for(var f=c[d],h=d+1;!l&&h<c.length;++h){var u=c[h];if(!(f&&u&&f.operation&&u.operation&&f.operationTo&&u.operationTo&&f.operationTo.physicalid&&u.operationTo.physicalid))break;f.operationTo.physicalid===u.operation.physicalid&&u.operation.physicalid!==c[h-1].operationTo.physicalid?(c.splice(h,1),c.splice(d+1,0,u)):f.operation.physicalid===u.operationTo.physicalid&&(c.splice(h+1,0,f),c.splice(d,1),l=!0)}}for(var g={},O=0;O<c.length;++O){var y=c[O];if(!r.Object.isEmptyObject(g)&&g[y.operationTo.physicalid]){a.issues||(a.issues=[]),a.issues.push({short:"No Header Operation loops allowed.",operation:y.operation,operationTo:y.operationTo});break}g[y.operation.physicalid]=y.operation}}a.issues&&a.issues.length&&(a.result="blocking",a.messages||(a.messages={}),a.messages[a.issues[0].short]||(a.messages[a.issues[0].short]={long:"No circular loops between the Header Operations are allowed.",fixes:["Remove one or more flows between the Header Operations to remove the loop.","Remove a Header Operation from the sequence."]})),i(t)}}),o)}else o(new Error("invalid response from getAllDescendantsForWorkplan"))}),o)}))),Promise.all(i).then((function(){self.postMessage({type:"complete",result:o})}),(function(e){self.postMessage({type:"error",msg:"Unable to retrieve items for operations",objError:e})}))}else self.postMessage({type:"error",msg:"Unable to locate work plan"})}),(function(e){self.postMessage({type:"error",msg:"Error",objError:e})}))}))}}}));