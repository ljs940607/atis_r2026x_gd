define("DS/DELPPWProcessValidationModule/worker/rule03_ConditionalFlows",[],(function(){"use strict";return function(){var e={};self.onmessage=function(o){if(o&&o.data)switch(o.data.type){case"config":if(o.data.config&&(e=Object.assign(e,o.data.config),(o.data.config.sec_context||o.data.config.security_ctx)&&(self.sec_context=o.data.config.sec_context||o.data.config.security_ctx),o.data.config.COMPASS_CONFIG&&(self.COMPASS_CONFIG=Object.clone?Object.clone(o.data.config.COMPASS_CONFIG):o.data.config.COMPASS_CONFIG),o.data.config.require_config)){if(o.data.config.require_config.baseUrl)importScripts(o.data.config.require_config.baseUrl+"/AmdLoader/AmdLoader.js");else{const e=(self.location+"").replace(/\/[^/]+$/,"/").replace(/:444\/$/,"");var n=null;e.indexOf("blob:")>-1&&(n=e.replace(/^blob:/,"")),importScripts(n+"/3DSpace/webapps/AmdLoader/AmdLoader.js")}self.require&&self.require.config(o.data.config.require_config)}break;case"start":o.data.options&&o.data.options.workplan&&o.data.options.workplan.physicalid&&t(o.data.options);break;default:self.postMessage({type:"error",msg:"Invalid event type = "+o.data.type})}else self.postMessage({type:"error",msg:"Invalid event data"})};var t=function(t){var o={rule03_ConditionalFlows:{result:"pass"}};self.require(["DS/DELWebInfrastructureControls/UWAUtils","DS/DELPPWProcessValidationModule/DELWebProcessValidationModel","DS/DELWebInfrastructureControls/DELWebIndexAuthoringMgmt"],(function(n,i,a){n.log("Inside rule03_ConditionalFlows require"),e&&(e.objAllServices&&i.updatePlatformServicesCache(e.objAllServices),e.navigateOn&&("Database"===e.navigateOn?a.setDatabase():a.setIndex()));var r=o.rule03_ConditionalFlows,s=t.workplan;i.getAllTimeConstraints({physicalid:s.physicalid||s.id}).then((function(e){n.log("workplanTimeConstraintsReturn: "),n.log(e);var t=[];if(e&&e.length){var a=[];n.each(e,(function(e,t){t&&t.isProductFlow&&t.fromOperationOcc&&Array.isArray(t.fromOperationOcc)&&1===t.fromOperationOcc.length&&t.toOperationOcc&&Array.isArray(t.toOperationOcc)&&1===t.toOperationOcc.length&&"Good"!==t.flowType&&a.push(t)})),a.length>0&&t.push(new Promise((function(e,t){i.getAllDescendantsForWorkplan({physicalid:s.physicalid||s.id,Depth:1}).then((function(i){n.log("workplanDescendantsReturn: "),n.log(i),i&&!n.Object.isEmptyObject(i)?(n.each(a,(function(e,o){if("Good"!==o.flowType){r.result="blocking";var a={short:"No conditional flow inside the Workplan.",timeConstraint:o};r.messages||(r.messages={}),r.messages[a.short]||(r.messages[a.short]={long:'There can exist no conditional flows inside the Workplan.  Product flow must always be set to "Good".',fixes:['Update the product flow to be "Good".',"Remove the conditional product flow from the child Header Operation."]}),n.each(["fromOperationOcc","toOperationOcc"],(function(e,r){if(o[r]&&Array.isArray(o[r])&&!(o[r].length<=0)&&o[r][o[r].length-1].instanceObject&&o[r][o[r].length-1].instanceObject.identifier){var s=o[r][o[r].length-1],c=s.instanceObject;if(c.physicalid||(c.physicalid=c.identifier),c.ReferencePhysicalid||(i[c.identifier]?c=Object.assign(c,i[c.identifier]):n.each(i,(function(e,t){return t&&t.physicalid===c.identifier&&(c=Object.assign(c,t)),!c.ReferencePhysicalid}))),c.ReferencePhysicalid||c.ReferenceOXID){var l="fromOperationOcc"===r?"operation":"operationTo";a[l]=s.referenceObject||{},a[l+"Instance"]=c,i[c.ReferencePhysicalid]?a[l]=Object.assign(a[l],i[c.ReferencePhysicalid]):c.ReferenceOXID&&i[c.ReferenceOXID]?a[l]=Object.assign(a[l],i[c.ReferenceOXID]):n.each(i,(function(e,t){return!t||t.physicalid!==c.ReferencePhysicalid&&t.OXID!==c.ReferenceOXID||(a[l]=Object.assign(a[l],t),!1)}))}else a[l]=c}else t(new Error("invalid index in the time constraint: "+r))})),a.operationTo&&!a.operation&&(n.log("rule03 - unable to locate FROM operation.  Using TO operation instead..."),a.operation=a.operationTo,a.operationInstance=a.operationToInstance,delete a.operationTo,delete a.operationToInstance),a.operation||t(new Error("rule03: unable to locate operation!")),r.issues||(r.issues=[]),r.issues.push(a)}})),e()):self.postMessage({type:"complete",result:o})}),t)})))}Promise.all(t).then((function(){self.postMessage({type:"complete",result:o})}),(function(e){self.postMessage({type:"error",msg:"Unable to retrieve items for operations",objError:e})}))}),(function(e){self.postMessage({type:"error",msg:"Error",objError:e})}))}))}}}));