define("DS/DELPPWProcessValidationModule/worker/rule09_ItemConsumption_type",[],(function(){"use strict";return function(){const e=["CreateAssembly","CreateKit","CreateMaterial","ProcessContinuousCreateMaterial","ProcessContinuousProvide","Provide"];var t={};self.onmessage=function(e){if(e&&e.data)switch(e.data.type){case"config":if(e.data.config&&(t=Object.assign(t,e.data.config),(e.data.config.sec_context||e.data.config.security_ctx)&&(self.sec_context=e.data.config.sec_context||e.data.config.security_ctx),e.data.config.COMPASS_CONFIG&&(self.COMPASS_CONFIG=Object.clone?Object.clone(e.data.config.COMPASS_CONFIG):e.data.config.COMPASS_CONFIG),e.data.config.require_config)){if(e.data.config.require_config.baseUrl)importScripts(e.data.config.require_config.baseUrl+"/AmdLoader/AmdLoader.js");else{const e=(self.location+"").replace(/\/[^/]+$/,"/").replace(/:444\/$/,"");var n=null;e.indexOf("blob:")>-1&&(n=e.replace(/^blob:/,"")),importScripts(n+"/3DSpace/webapps/AmdLoader/AmdLoader.js")}self.require&&self.require.config(e.data.config.require_config)}break;case"start":e.data.options&&e.data.options.workplan&&e.data.options.workplan.physicalid&&i(e.data.options);break;default:self.postMessage({type:"error",msg:"Invalid event type = "+e.data.type})}else self.postMessage({type:"error",msg:"Invalid event data"})};var i=function(i){var n={rule09_ItemConsumption_type:{result:"pass"}};self.require(["DS/DELWebInfrastructureControls/UWAUtils","DS/DELPPWProcessValidationModule/DELWebProcessValidationModel","DS/DELWebInfrastructureControls/DELWebIndexAuthoringMgmt"],(function(c,a,s){t&&(t.objAllServices&&a.updatePlatformServicesCache(t.objAllServices),t.navigateOn&&("Database"===t.navigateOn?s.setDatabase():s.setIndex()));var o=i.workplan;a.getAllDescendantsForWorkplan({physicalid:o.physicalid||o.id,Depth:2}).then((function(t){if(c.log("workplanDescendantsReturn: "),c.log(t),t&&!c.Object.isEmptyObject(t)){var i=n.rule09_ItemConsumption_type,s=[];c.each(t,(function(e,i){return!i||i.physicalid!==(o.physicalid||o.id)||((o=Object.assign(o,i)).children&&o.children.length&&c.each(o.children,(function(e,i){i&&(i.OXID&&t[i.OXID]?o.children[e]=Object.assign(t[i.OXID],i):i.physicalid&&t[i.physicalid]?o.children[e]=Object.assign(t[i.physicalid],i):c.each(t,(function(n,c){return i.OXID&&i.OXID===c.OXID?(o.children[e]=Object.assign(t[n],i),!1):!i.physicalid||i.physicalid!==c.physicalid||(o.children[e]=Object.assign(t[n],i),!1)})))})),!1)}));var r=function(n,s){if(n&&s&&s.length)return new Promise((function(o,r){var l=[];c.each(s,(function(s,o){o&&o.itemOcc&&o.itemOcc.length>0&&l.push(new Promise((function(s,r){if(o.itemOcc[o.itemOcc.length-1].instanceObject&&o.itemOcc[o.itemOcc.length-1].instanceObject.identifier&&o.itemOcc[o.itemOcc.length-1].instanceObject.relativePath){var l=Object.assign({physicalid:o.itemOcc[o.itemOcc.length-1].instanceObject.identifier},o.itemOcc[o.itemOcc.length-1].instanceObject),d=new RegExp("dsmfg:MfgItem/([a-zA-Z0-9]*)/").exec(o.itemOcc[o.itemOcc.length-1].instanceObject.relativePath);d&&d.length>1&&(l.ParentPhysicalid=d[1]),a.getProducedItemInstance(l).then((function(l){l&&!c.Object.isEmptyObject(l)&&l.reference?a.getProducedItem({physicalid:l.reference}).then((function(a){if(e.indexOf(a.type)<0){i.result="warning",i.messages||(i.messages={}),i.messages["Items linked to operations must be of a specified type."]||(i.messages["Items linked to operations must be of a specified type."]={long:"The reference of the Item instance linked to operations must be a type (or types deriving from them) contained in a list.",fixes:["Remove the Item from the Operation.","Change the Item linked to the Operation to one of the valid types.","Valid Operation Types: "+e.join(", ")]}),i.issues||(i.issues=[]);var r={short:"Items linked to operations must be of a specified type.",operation:n,item:a};o.operationOcc&&o.operationOcc.length&&o.operationOcc[o.operationOcc.length-1].instanceObject&&(r.operationInstance=o.operationOcc[o.operationOcc.length-1].instanceObject,c.each(t,(function(e,t){return t&&t.physicalid===o.operationOcc[o.operationOcc.length-1].instanceObject.identifier&&(r.operationInstance=Object.assign(r.operationInstance,t)),!r.operationInstance.ReferencePhysicalid})),r.operationInstance.ReferencePhysicalid&&(r.operation={physicalid:r.operationInstance.ReferencePhysicalid},t[r.operationInstance.ReferencePhysicalid]?r.operation=t[r.operationInstance.ReferencePhysicalid]:r.operationInstance.ReferenceOXID&&t[r.operationInstance.ReferenceOXID]?r.operation=t[r.operationInstance.ReferenceOXID]:c.each(t,(function(e,t){return!t||t.physicalid!==r.operationInstance.ReferencePhysicalid||(r.operation=t,!1)})))),i.issues.push(r)}s(a)}),r):r(new Error("Unable to locate produced item reference"))}),r)}else r(new Error("unable to located the implement link's last instanceObject"))})))})),Promise.all(l).then(o,r)}))};c.each(t,(function(e,i){if(i&&!i.ReferencePhysicalid&&!i.ReferenceOXID)if(i.physicalid!==o.physicalid&&o.children&&o.children.length){var n=!1;if(c.each(o.children,(function(e,t){if(t)return(t.ReferenceOXID&&t.ReferenceOXID===i.OXID||t.ReferencePhysicalid&&t.ReferencePhysicalid===i.physicalid)&&(n=!0),!n})),n&&i.children&&i.children.length&&a.isHeaderOperation(i))return void c.each(i.children,(function(e,i){i.OXID&&t[i.OXID]?i=t[i.OXID]:i.physicalid&&t[i.physicalid]?i=t[i.physicalid]:c.each(t,(function(e,t){return n.OXID&&t.OXID===i.OXID||i.physicalid&&t.physicalid===i.physicalid?(i=t,!1):void 0}));var n={physicalid:i.ReferencePhysicalid,OXID:i.ReferenceOXID};n.OXID&&t[n.OXID]?n=t[n.OXID]:n.physicalid&&t[n.physicalid]?n=t[n.physicalid]:c.each(t,(function(e,t){return n.OXID&&t.OXID===n.OXID||n.physicalid&&t.physicalid===n.physicalid?(n=t,!1):void 0})),i.reference=n,i&&a.isOperation(i.reference)&&s.push(new Promise((function(e,t){a.getImplementedItemsForMfgProcess(i).then((function(i){i&&i.length>0?r(n,i).then(e,t):e(i)}),t)})))}))}else i.physicalid===o.physicalid&&s.push(new Promise((function(e,t){a.getImplementedItemsForMfgProcess(i).then((function(n){n&&n.length>0?r(i,n).then(e,t):e(n)}),t)})))})),Promise.all(s).then((function(){self.postMessage({type:"complete",result:n})}),(function(e){self.postMessage({type:"error",msg:"Unable to retrieve items for operations",objError:e})}))}else self.postMessage({type:"complete",result:n})}),(function(e){self.postMessage({type:"error",msg:"Error",objError:e})}))}))}}}));