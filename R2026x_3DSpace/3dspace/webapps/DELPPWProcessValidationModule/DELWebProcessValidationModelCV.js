self.define&&define("DS/DELPPWProcessValidationModule/DELWebProcessValidationModelCV",["DS/DELWebInfrastructureControls/UWAUtils","UWA/Class","UWA/Promise","DS/DELWebInfrastructureControls/DELWebIndexAuthoringMgmt","DS/DELWebInfrastructureControls/DELWebAjaxModel","text!DS/DELPPWProcessModelPlugins/assets/RolesOnImplementLink.json","undefined"!=typeof window?"i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls":""],(function(e,t,i,n,r,s,a){"use strict";var o=2147483647,c={},l=self.Configuration&&self.Configuration.webroot?self.Configuration.webroot:null;l&&r&&r.setupWebRoot&&(l=r.setupWebRoot()),a||(a={get:function(e){return e}});var d=t.singleton({init:function(){c=r.getCacheObject()},get3DSearchString:function(){return"flattenedtaxonomies:types/DELLmiWorkPlanSystemReference"},getAllWorkPlans:function(t,s){var a=d;return new i((function(i,o){t?r.getServiceUrl({serviceName:"3DSearch"}).then((function(l){if(l&&"string"==typeof l){var d="("+a.get3DSearchString()+")";(t.search_str||t.name)&&"*"!==(t.search_str||t.name)&&(d+=" AND ("+(t.search_str||t.name)+")"),t.tenant||(t.COMPASS_CONFIG?t.tenant=t.COMPASS_CONFIG.tenant:self.COMPASS_CONFIG?t.tenant=self.COMPASS_CONFIG.tenant:self.widget&&self.widget.data&&(t.tenant=self.widget.data.x3dPlatformId));var p=self.widget?self.widget.data.appId||self.widget.id:"";self&&self.Foe&&self.Foe.Model&&self.Foe.Model.Session&&(p=self.Foe.Model.Session.get("user"));var u={query:d,label:p+"-DELWebProcessValidationModelCV.getAllWorkPlans-"+(new Date).getTime(),locale:self.widget.lang,tenant:t.platformId||t.tenant,source:["3dspace"],select_predicate:["ds6w:label","ds6w:type","ds6w:kind","ds6w:identifier","ds6wg:revision","bo.PLMEntity.V_Name","taxonomies","vault"],with_synthesis:!1,with_synthesis_attribute:!1};t.Minimum&&Array.isArray(t.Minimum)&&t.Minimum.length&&e.each(t.Minimum,(function(e,t){var i=n.convertAttrToSearchPredicate(t);i&&Array.isArray(i)?i.forEach((function(e){u.select_predicate.indexOf(e)<0&&u.select_predicate.push(e)})):i&&u.select_predicate.indexOf(i)<0&&u.select_predicate.push(i)})),t.startindex&&(c.getAllWorkPlans_next_start&&c.getAllWorkPlans_next_start.indexOf(t.startindex)>=0?u.next_start=c.getAllWorkPlans_next_start:u.start=t.startindex),t.endindex&&(u.nresults="startindex"in t?t.endindex-t.startindex:t.endindex),u=JSON.stringify(u);var f=l+"/search";r.callAuthenticatedRequest(f,"json","POST",u,s).then((function(t){var r={},s=[];t&&t.results&&t.results.length&&(e.each(t.results,(function(t,i){if(i&&i.attributes&&i.attributes.length){var s=n.convertToModelObj(i.attributes);s&&s.physicalid&&(r[s.physicalid]=s)}else e.log("invalid referenceObject attributes!  idxReferenceObject = "+t)})),s=Object.values(r)),i(s)}),o)}else o(new Error("invalid 3DSearch URL"))})):o(new Error("Invalid input parameters!"))}))},getWorkPlan:function(e,t){if(e){var i=["V_SequencingMode"];e.Minimum&&"False"!==e.Minimum?Array.isArray(e.Minimum)&&(e.Minimum=e.Minimum.concat(i),e.Minimum=e.Minimum.filter((function(e,t,i){return i.indexOf(e)===t}))):e.Minimum=i}return d.getReference(e,t)},getReference:function(t,s){return new i((function(i,a){t?r.getServiceUrl({serviceName:"3DSpace"}).then((function(o){if(o&&"string"==typeof o){var c=[];t.physicalid?c.push(t.physicalid):t.workplan&&t.workplan.physicalid?c.push(t.workplan.physicalid):t.QueryList&&t.QueryList.length&&e.each(t.QueryList,(function(e,t){t&&t.physicalid&&c.push(t.physicalid)})),t.tenant||(t.COMPASS_CONFIG?t.tenant=t.COMPASS_CONFIG.tenant:self.COMPASS_CONFIG?t.tenant=self.COMPASS_CONFIG.tenant:self.widget&&self.widget.data&&(t.tenant=self.widget.data.x3dPlatformId));var l=t&&t.COMPASS_CONFIG?t.COMPASS_CONFIG.userId:"";!l&&self.COMPASS_CONFIG&&(l=self.COMPASS_CONFIG.userId);var d={label:l+"-DELWebProcessValidationModelCV.getReference.fetch-"+(new Date).getTime(),tenant:t.platformId||t.tenant,physicalid:c,source:["3dspace"],select_predicate:[]},p=null,u=["V_Name","current","V_discipline","revision","PLM_ExternalID","physicalid","interface","type","taxonomies","vault"];t.Minimum&&Array.isArray(t.Minimum)&&(u=(u=u.concat(t.Minimum)).filter((function(e,t,i){return i.indexOf(e)===t}))),e.each(u,(function(e,t){(p=n.convertAttrToSearchPredicate(t)||t)&&d.select_predicate.indexOf(p)<0&&d.select_predicate.push(p)})),t.Minimum&&Array.isArray(t.Minimum)&&t.Minimum.length&&e.each(t.Minimum,(function(e,t){(p=n.convertAttrToSearchPredicate(t))&&Array.isArray(p)?p.forEach((function(e){d.select_predicate.indexOf(e)<0&&d.select_predicate.push(e)})):p&&d.select_predicate.indexOf(p)<0&&d.select_predicate.push(p)})),d=JSON.stringify(d);var f=o+"/cvservlet/fetch/v2";r.callAuthenticatedRequest(f,"json","POST",d,s).then((function(r){var o=new Map;if(r&&r.results){e.Object.isPlainObject(d)||(d=JSON.parse(d));for(var l=r.results,p=l.length,u=0;u<p;u++){var f=l[u].attributes;if(f)for(var m=f,h=m.length,y=0;y<h;y++)if("resourceid"===m[y].name){var O=n.convertToModelObj(m,!0);d&&d.select_predicate&&d.select_predicate.length&&e.each(d.select_predicate,(function(e,t){t in O||(O[t]=null)})),o.set(m[y].value,O)}}}else if(s&&c&&c.length)return t.blnCachedOk=!1,void s(t).then(i,a);var g={};o.forEach((function(e,t){g[t]=e}));var P={};if(g&&g[t.workplan&&t.workplan.physicalid||t.physicalid])P=g[t.workplan&&t.workplan.physicalid||t.physicalid];else{var _=new Map;_.set("PLMData",g),_.set("SpecifiedRootPhysicalid",t.physicalid),_.forEach((function(e,t){P[t]=e}))}i(P)}),a)}else error("invalid 3DSpace URL")}),a):a(new Error("Invalid input parameters!"))}))},getAllDescendantsForWorkplan:function(t,s){return new i((function(a,c){t?r.getServiceUrl({serviceName:"3DSpace"}).then((function(l){if(l&&"string"==typeof l){if(!t)return e.log("getTree: params must be specified"),void c("params must be specified");if(t.PLM_ExternalID||t.physicalid||t.OXID||t.QueryList)if(!t.QueryList||t.QueryList.length&&t.QueryList instanceof Array||(t.QueryList&&t.QueryList.length&&"string"==typeof t.QueryList&&(t.QueryList=JSON.parse(t.QueryList)),!t.QueryList||t.QueryList.length&&t.QueryList instanceof Array)){var d,p=["V_Name","current","V_discipline","revision","PLM_ExternalID","physicalid","interface","taxonomies","revision","vault"];t.Minimum?("string"==typeof t.Minimum&&"["===t.Minimum[0]&&(t.Minimum=JSON.parse(t.Minimum)),Array.isArray(t.Minimum)&&(t.Minimum=t.Minimum.concat(p),t.Minimum=t.Minimum.filter((function(e,t,i){return i.indexOf(e)===t})))):t.Minimum=p;var u=[];if(!t.QueryList||t.QueryList&&0===t.QueryList.length)u=[t.physicalid],d=(t.Depth||t.depth)+1;else{for(var f={QueryList:[]},m=t.QueryList.length,h=0;h<m;h++)0===(d=t.QueryList[h].Depth||t.QueryList[h].depth||t.Depth||0)?f.QueryList.push(t.QueryList[h]):(d+=1,u.push(t.QueryList[h].physicalid));d&&!isNaN(d)||(d=t.Depth+1)&&!isNaN(d)||(d=t.depth+1)}if(u.length){t.tenant||(t.COMPASS_CONFIG?t.tenant=t.COMPASS_CONFIG.tenant:self.COMPASS_CONFIG?t.tenant=self.COMPASS_CONFIG.tenant:self.widget&&self.widget.data&&(t.tenant=self.widget.data.x3dPlatformId));var y=t&&t.COMPASS_CONFIG?t.COMPASS_CONFIG.userId:"";!y&&self.COMPASS_CONFIG&&(y=self.COMPASS_CONFIG.userId);var O={label:y+"-DELWebProcessValidationModelCV.getAllDescendantsForWorkplan.expand-"+(new Date).getTime(),tenant:t.platformId||t.tenant,multi_root_physicalid:u,expand_iter:Math.min(d,o).toString(),select_rel:["physicalid","ds6w:label","ds6w:type","owner","type","revision","description","taxonomies"],select_bo:["physicalid","ds6w:label","ds6w:type","interface","bo.PLMEntity.V_discipline","revision","identifier","owner","type","current","description","modified","taxonomies","vault"],type_filter_bo:["DELLmiWorkPlanSystemReference"]};t.Minimum&&t.Minimum.length&&("string"==typeof t.Minimum&&"["===t.Minimum.charAt(0)&&(t.Minimum=JSON.parse(t.Minimum)),Array.isArray(t.Minimum)&&e.each(t.Minimum,(function(e,t){var i=n.convertAttrToSearchPredicate(t);i&&Array.isArray(i)?i.forEach((function(e){O.select_bo.indexOf(e)<0&&O.select_bo.push(e),O.select_rel.indexOf(e)<0&&O.select_rel.push(e)})):i&&(O.select_bo.indexOf(i)<0&&O.select_bo.push(i),O.select_rel.indexOf(i)<0&&O.select_rel.push(i))})));var g={},P={batch:{expands:[]},outputs:{select_object:O.select_bo,select_relation:O.select_rel}},_={};e.each(u,(function(e,t){var i={},n=i&&i.vault||"";_[n]||(_[n]=[]),_[n].push({label:y+"-DELWebProcessValidationModelCV.getAllDescendantsForWorkplan.progressiveexpand-"+t+"-"+(new Date).getTime(),root:{physical_id:t},filter:{and:{filters:[{sequence_filter:{sequence:[{uql:'(flattenedtaxonomies:"types/DELLmiWorkPlanSystemReference")'}]}}]}},aggregation_processors:[{truncate:{max_distance_from_prefix:Math.min(d,o).toString(),prefix_filter:{prefix_path:[{physical_id_path:[t]}]}}}],graph:{descending_condition_object:{uql:" NOT ( (flattenedtaxonomies:types/VPMCfgEffectivity) )"},descending_condition_relation:{uql:"(flattenedtaxonomies:reltypes/PLMCoreInstance) OR (flattenedtaxonomies:reltypes/PLMCoreRepInstance) OR (flattenedtaxonomies:types/PLMConnection) OR (flattenedtaxonomies:reltypes/VPLMrel_47_PLMConnection_47_V_Owner) OR (flattenedtaxonomies:reltypes/VPLMrel_47_PLMPort_47_V_Owner) OR (flattenedtaxonomies:reltypes/MfgProcessAlternate) OR (flattenedtaxonomies:reltypes/Reference Document) OR (flattenedtaxonomies:reltypes/SpecificationDocument)"}}})}));var v=l+"/cvservlet/progressiveexpand/v2?output_format=cvjson",M={};P.batch.expands=[];var C=[];e.each(_,(function(t,i){var a=Object.assign({},P);a.batch.expands=i,a=JSON.stringify(a);var o=new e.Promise((function(i,o){r.callAuthenticatedRequest(v,"json","POST",a,s).then((function(r){if("string"==typeof r&&(r=JSON.parse(r)),g={},r&&r.results&&r.results.length){var s={};e.each(r.results,(function(e,t){var i=n.convertToModelObj(t);if(i&&i.physicalid)if(i.from){if(i.taxonomies&&i.taxonomies.split(/[,\/]/).indexOf("PLMInstance")>=0&&(s[i.from]||(s[i.from]={}),i.from!==i.to)){var r={PLM_ExternalID:i.PLM_ExternalID||i.label,ParentPhysicalid:i.from,ReferencePhysicalid:i.to,plmObjectType:i.type,name:i.V_Name};s[i.from][i.to]=Object.assign(r,i),g[i.physicalid]=s[i.from][i.to]}}else i.taxonomies&&i.taxonomies.split(/[,\/]/).indexOf("PLMReference")>=0&&(i.plmObjectType=i.type,i.name=i.V_Name,g[i.physicalid]=i)})),e.each(g,(function(e,t){t.ParentPhysicalid&&!t.ParentOXID&&(t.ParentOXID=g[t.ParentPhysicalid].OXID),t.ReferencePhysicalid&&!t.ReferenceOXID&&(t.ReferenceOXID=g[t.ReferencePhysicalid].OXID)})),e.Object.isEmptyObject(s)||e.each(s,(function(t,i){g[t]&&(g[t].children||(g[t].children=[]),e.each(i,(function(i,n){var r=!0;e.each(g[t].children,(function(e,t){return r=n.physicalid!==t.physicalid})),r&&g[t].children.push(n)})))}));var a={};e.each(g,(function(e,t){t.OXID?a[t.OXID]=t:a[e]=t})),M=M?e.extend(M,a,!0):a}else if(r&&r.errors&&r.errors.length)return void o(t);i(M)}),(function(e){i(t)}))}));C.push(o)})),i.all(C).then((function(){a(M)}),(function(){s?(t.blnCachedOk=!1,s(t).then(a,c)):c("Error")}))}}else c("getAllDescendantsForWorkplan: QueryList Must be an array with at least one item in it");else c("getAllDescendantsForWorkplan: Either QueryList, PLM_ExternalID, physicalid, or OXID must be specified inside params")}else c("invalid 3DSpace URL")})):c("Invalid input parameters!")}))},getAllTimeConstraints:function(t,s){var a=d;return new i((function(i,o){t&&t.physicalid?r.getServiceUrl({serviceName:"3DSpace"}).then((function(l){if(l&&"string"==typeof l){t.tenant||(t.COMPASS_CONFIG?t.tenant=t.COMPASS_CONFIG.tenant:self.COMPASS_CONFIG?t.tenant=self.COMPASS_CONFIG.tenant:self.widget&&self.widget.data&&(t.tenant=self.widget.data.x3dPlatformId));var d=t&&t.COMPASS_CONFIG?t.COMPASS_CONFIG.userId:"";!d&&self.COMPASS_CONFIG&&(d=self.COMPASS_CONFIG.userId);var p={batch:{expands:[{label:d+"-DELWebProcessValidationModelCV.getAllTimeConstraints.progressiveexpand-"+t.physicalid+"-"+(new Date).getTime(),root:{physical_id:t.physicalid},filter:{and:{filters:[{sequence_filter:{sequence:[{uql:'(flattenedtaxonomies:"types/DELLmiWorkPlanSystemReference")'}]}}]}},graph:{descending_condition_object:{uql:"(flattenedtaxonomies:types/DELLmiTimeConstraintCnx) OR (flattenedtaxonomies:types/DELLmiHeaderOperationReference)"},descending_condition_relation:{uql:"(flattenedtaxonomies:reltypes/VPLMrel_47_PLMConnection_47_V_Owner) OR (flattenedtaxonomies:reltypes/DELLmiHeaderOperationInstance)"}}}]},outputs:{select_object:["physicalid","identifier","type","description","ds6w:created","modified","bo.DELLmiTimeConstraintCnx.V_Delay","bo.DELLmiTimeConstraintCnx.V_DelayMode","bo.DELLmiTimeConstraintCnx.V_DependencyType","bo.DELLmiTimeConstraintCnx.V_MaterialNeed","bo.DELLmiTimeConstraintCnx.V_OptionalTimeConstraint","bo.DELLmiTimeConstraintCnx.V_ResourceConstraint","interface","pathsr","cestamp","taxonomies","vault"],select_relation:["ro.PLMInstance.PLM_ExternalID","ds6w:label","physicalid","taxonomies","type","vault"]}},u=l+"/cvservlet/progressiveexpand/v2?output_format=cvjson";r.callAuthenticatedRequest(u,"json","POST",JSON.stringify(p),s).then((function(r){"string"==typeof r&&(r=JSON.parse(r));var s=[];if(r&&r.results&&r.results.length){e.each(r.results,(function(i,r){if("DELLmiHeaderOperationReference"===r.type||r.taxonomies&&r.taxonomies.indexOf("/DELLmiHeaderOperationReference")>0){var o=n.convertToModelObj(r,!0);a._cacheOperationObject(o)}else if("DELLmiHeaderOperationInstance"===r.type||r.taxonomies&&r.taxonomies.indexOf("/DELLmiHeaderOperationInstance")>0){var c=Object.assign({source:l,identifier:r.resourceid||r.physicalid,relativePath:"/resources/v1/modeler/dsprcs/dsprcs:MfgProcess/"+(r.from||t.physicalid)+"/dsprcs:MfgOperationInstance/"+(r.resourceid||r.physicalid),type:r.type||"DELLmiHeaderOperationInstance",ParentPhysicalid:r.from||t.physicalid,ReferencePhysicalid:r.to},n.convertToModelObj(r,!0));a._cacheOperationObject(c)}else if("DELLmiTimeConstraintCnx"===r.type||r.taxonomies&&r.taxonomies.indexOf("/DELLmiTimeConstraintCnx")>0){var d=n.convertToModelObj(r,!0);if(d.pathsr&&d.pathsr.indexOf(" Sep ")>0){var p=d.pathsr.split(" Sep ");if(2===p.length)for(var u=new RegExp("PS\\s+([a-zA-Z0-9]*)\\s+PE"),f=0;f<=1;++f){var m=u.exec(p[f]);m&&2===m.length&&(d[(f?"from":"to")+"OperationOcc"]=[{instanceObject:{identifier:m[1]}}])}}if(!d.flowType)if(d.taxonomies&&d.taxonomies.indexOf("interfaces/DELLmiTimeConstraintCategoryAbstract/")>=0){var h=new RegExp("interfaces/DELLmiTimeConstraintCategoryAbstract/([a-zA-Z0-9]*)").exec(d.taxonomies);h&&h.length>1?d.flowType=h[1].replace("DELLmiTimeConstraint",""):e.log("DELWebProcessValidationModelCV::getAllTimeConstraints - unable to determine flowType for "+(d.resourceid||d.identifier||d.physicalid))}else d.flowType="Good";s.push(d)}}));var d=[];s.length>0&&c.operation&&e.each(s,(function(t,i){var n=!1;e.each(["fromOperationOcc","toOperationOcc"],(function(e,t){return n=!1,i[t].length&&i[t][0]&&i[t][0].instanceObject&&i[t][0].instanceObject.identifier&&(c.operation[i[t][0].instanceObject.identifier]&&(i[t][0].instanceObject=Object.assign(i[t][0].instanceObject,c.operation[i[t][0].instanceObject.identifier])),i[t][0].instanceObject.ReferencePhysicalid&&c.operation[i[t][0].instanceObject.ReferencePhysicalid]&&(i[t][0].referenceObject=Object.assign({},c.operation[i[t][0].instanceObject.ReferencePhysicalid]),n="DELLmiHeaderOperationReference"===i.fromOperationOcc[0].referenceObject.type||i.taxonomies&&i.taxonomies.indexOf("/DELLmiHeaderOperationReference")>0)),n})),n&&d.push(i)})),i(d)}else o(new Error("invalid index response in DELWebProcessValidationModelCV::getAllTimeConstraints"))}),o)}else o("invalid 3DSpace URL")}),o):o(new Error("invalid id"))}))},getProducedItemsForMfgProcess:function(t,n,s){var a=d;return"itemOcc"===n?a.getImplementedItemsForMfgProcess?a.getImplementedItemsForMfgProcess(t,s):s?s(t):(e.log("invalid DELWebProcessValidationModelCV::getImplementedItemsForMfgProcess"),new Error("invalid DELWebProcessValidationModelCV::getImplementedItemsForMfgProcess")):(n||(n="itemRef"),new i((function(i,a){t&&(t.id||t.physicalid||t.workplan)&&(!t.workplan||e.Object.isPlainObject(t.workplan)&&(t.workplan.physicalid||t.workplan.id))?r.getServiceUrl({serviceName:"3DSpace"}).then((function(o){if(o&&"string"==typeof o){t.tenant||(t.COMPASS_CONFIG?t.tenant=t.COMPASS_CONFIG.tenant:self.COMPASS_CONFIG?t.tenant=self.COMPASS_CONFIG.tenant:self.widget&&self.widget.data&&(t.tenant=self.widget.data.x3dPlatformId));var c=t&&t.COMPASS_CONFIG?t.COMPASS_CONFIG.userId:"";!c&&self.COMPASS_CONFIG&&(c=self.COMPASS_CONFIG.userId);var l=t.workplan||t,d={label:c+"-DELWebProcessValidationModelCV.getProducedItemsForMfgProcess.navigate-"+(new Date).getTime(),tenant:t.platformId||t.tenant,input_physical_ids:[l.physicalid||l.id],primitives:[{navigate_to_sr:{id:1,filter:{role:["52"],category:["7"]},mode:"path"},navigate_from_sr:{id:2,mode:"ends",filter:{role:["52"],category:["7"]}}},{navigate_to_sr:{id:3,filter:{role:["51"],category:["5"]},mode:"path"},navigate_from_sr:{id:4,mode:"ends",filter:{role:["51"],category:["5"]}}},{navigate_to_sr:{id:5,filter:{role:["490"]},mode:"path"}}],patterns:{scope_pathSR:[{id:2},{id:3}],resourceArea_pathSR:[{id:5}],scopeInverse_pathSR:[{id:4},{id:1}]},attributes:["ds6w:label","physicalid","ds6w:type","pathsr"],version:3};d=JSON.stringify(d);r._getSecurityContext().then((function(t){var c=o+"/cvservlet/navigate?SecurityContext="+encodeURIComponent(t);r.callAuthenticatedRequest(c,"json","POST",d,s).then((function(t){if(t&&t.result){var r=[];e.each(t.result,(function(t,i){if(!i||!i.input_object||i.input_object.physicalid!==l.physicalid)return e.log("DELWebProcessValidationModelCV::getProducedItemsForMfgProcess - invalid query!"),void e.log(i);if(i.outputs&&i.outputs.scope_pathSR){var s={id:null,isScope:!0};e.each(i.outputs.scope_pathSR,(function(t,i){if(!i||!i.owner||!i.owner.physicalid)return e.log("DELWebProcessValidationModelCV::getProducedItemsForMfgProcess - invalid connection!"),void e.log(i);s.id=i.owner.physicalid,i.elements&&e.each(i.elements,(function(e,t){s[n]={source:o,identifier:t.physicalid,relativePath:"/resources/v1/modeler/dsmfg/dsmfg:MfgItem/"+t.physicalid,type:t["ds6w:type"]||""}})),r.push(s)}))}})),i(r)}else a(new Error("invalid response from DELWebProcessValidationModelCV::getProducedItemsForMfgProcess"))}),a)}))}else a(new Error("invalid 3DSpace URL"))})):a(new Error("invalid id"))})))},getImplementedItemsForMfgProcess:function(t,n){var a=d;return new i((function(o,c){t&&(t.id||t.physicalid||t.workplan)&&(!t.workplan||e.Object.isPlainObject(t.workplan)&&(t.workplan.physicalid||t.workplan.id))?r.getServiceUrl({serviceName:"3DSpace"}).then((function(l){if(l&&"string"==typeof l){t.tenant||(t.COMPASS_CONFIG?t.tenant=t.COMPASS_CONFIG.tenant:self.COMPASS_CONFIG?t.tenant=self.COMPASS_CONFIG.tenant:self.widget&&self.widget.data&&(t.tenant=self.widget.data.x3dPlatformId));var d=t&&t.COMPASS_CONFIG?t.COMPASS_CONFIG.userId:"";!d&&self.COMPASS_CONFIG&&(d=self.COMPASS_CONFIG.userId);var p=t,u={label:d+"-DELWebProcessValidationModelCV.getImplementedItemsForMfgProcess.navigate-"+(new Date).getTime(),tenant:t.platformId||t.tenant,input_physical_ids:[p.physicalid||p.id],primitives:[{navigate_to_sr:{id:1,filter:{role:["52"],category:["7"]},mode:"path"},navigate_from_sr:{id:2,mode:"ends",filter:{role:["52"],category:["7"]}}},{navigate_to_sr:{id:3,filter:{role:["51"],category:["5"]},mode:"path"},navigate_from_sr:{id:4,mode:"ends",filter:{role:["51"],category:["5"]}}}],patterns:{operationProcessImplement_pathSR:[{id:2},{id:3}]},patternTypeFilters:{operationProcessImplement_pathSR:{typesToNotReturn:["PLMCoreReference"],filterLinksOn:"elements"}},attributes:["ds6w:label","physicalid","identifier","type","current","description","bo.MfgProductionPlanning.V_Overlap","bo.ImplementLinkUsageFamily.V_ImplLinkUsage","bo.PLMEntity.V_usage","cestamp","pathsr","interface","taxonomies","vault"],version:3};u=JSON.stringify(u);r._getSecurityContext().then((function(d){var f=l+"/cvservlet/navigate?SecurityContext="+encodeURIComponent(d);r.callAuthenticatedRequest(f,"json","POST",u,n).then((function(r){if(r&&r.result){s&&"string"==typeof s&&(s=JSON.parse(s));var d=[],u=[];e.each(r.result,(function(n,r){if(!r||!r.input_object||r.input_object.physicalid!==p.physicalid)return e.log("DELWebProcessValidationModelCV::getImplementedItemsForMfgProcess - invalid query!"),void e.log(r);r.outputs&&r.outputs.operationProcessImplement_pathSR&&e.each(r.outputs.operationProcessImplement_pathSR,(function(n,r){if(!r||!r.owner||!r.owner.physicalid)return e.log("DELWebProcessValidationModelCV::getImplementedItemsForMfgProcess - invalid connection!"),void e.log(r);var o={name:r.owner.label||r.owner["ds6w:label"]||"",title:"",description:r.owner.description||"",id:r.owner.physicalid,isScope:!1,operationOcc:[{instanceObject:{source:l,identifier:p.physicalid||p.id,relativePath:"/resources/v1/modeler/dsprcs/dsprcs:MfgProcess/"+p.ParentPhysicalid+"/dsprcs:MfgOperationInstance/"+(p.physicalid||p.id),type:p.type||p.plmObjectType||p.plmBaseObjectType}}],itemOcc:[],overlap:"TRUE"===(r.owner.V_Overlap||r.owner["bo.MfgProductionPlanning.V_Overlap"]||"FALSE").toUpperCase(),usage:r.owner.V_ImplLinkUsage||r.owner["bo.ImplementLinkUsageFamily.V_ImplLinkUsage"]||r.owner["bo.MfgProductionPlanning.V_ImplLinkUsage"]||null,cestamp:r.owner.cestamp};if(r.elements&&r.elements.length){e.each(r.elements,(function(e,t){o.itemOcc.push({instancePosition:e,instanceObject:Object.assign({source:l,identifier:t.physicalid,relativePath:"/resources/v1/modeler/dsmfg/dsmfg:MfgItem/EBABCAC100003C1868013D4900013F8C/dsmfg:MfgItemInstance/"+t.physicalid,type:t.type||t["ds6w:type"]||""},t)})}));var c=r.elements[r.elements.length-1];u.push(new i((function(e,i){a.getProducedItemInstance({physicalid:c.physicalid}).then((function(n){var c={physicalid:n.ReferencePhysicalid,OXID:n.ReferenceOXID};a.getProducedItem(c).then((function(i){if(!o.usage&&s&&s.DefaultRoles&&t&&t.reference&&t.reference.type&&s.DefaultRoles[t.reference.type]&&i.type&&s.DefaultRoles[t.reference.type][i.type])o.usage=s.DefaultRoles[t.reference.type][i.type];else if(o.usage){var n=r.owner.V_usage||r.owner["bo.PLMEntity.V_usage"]||null;n&&n!==o.usage&&(o.usageCusto=n)}d.push(o),e(c)}),i)}),i)})))}else e.log("DELWebProcessValidationModelCV::getImplementedItemsForMfgProcess - missing elements!")}))})),i.all(u).then((function(){o(d)}),(function(){n?(t.blnCachedOk=!1,n(t).then(o,c)):c(new Error("DELWebProcessValidationModelCV::getImplementedItemsForMfgProcess"))}))}else c(new Error("invalid response from DELWebProcessValidationModelCV::getImplementedItemsForMfgProcess"))}),c)}))}else c(new Error("invalid 3DSpace URL"))})):c(new Error("invalid id"))}))},getProducedItem:function(e,t){var n=d;return new i((function(i,r){n.getReference(e,t).then((function(e){n._cacheItemObject(e),i(e)}),r)}))},getProducedItemInstance:function(e,t){var r=d;return new i((function(i,s){if(e&&(e.id||e.physicalid)){var a=["ro.PLMInstance.PLM_ExternalID","ds6w:created","ds6w:modified","ro.PLMInstance.V_description","owner","owner.fullname","organization","project","from.physicalid","to.physicalid","cestamp"];e.Minimum&&"False"!==e.Minimum?Array.isArray(e.Minimum)&&(e.Minimum=e.Minimum.concat(a),e.Minimum=e.Minimum.filter((function(e,t,i){return i.indexOf(e)===t}))):e.Minimum=a,r.getReference(e,t).then((function(e){var t=n.convertToModelObj(e,!0);r._cacheItemObject(t),i(t)}),s)}else s(new Error("invalid id"))}))},getResource:function(e,t){if(e){var i=["V_discipline"];e.Minimum&&"False"!==e.Minimum?Array.isArray(e.Minimum)&&(e.Minimum=e.Minimum.concat(i),e.Minimum=e.Minimum.filter((function(e,t,i){return i.indexOf(e)===t}))):e.Minimum=i}return d.getReference(e,t)},getPrimaryCapableResources:function(t,s){return new i((function(i,a){t&&t.physicalid?r.getServiceUrl({serviceName:"3DSpace"}).then((function(o){if(o&&"string"==typeof o){t.tenant||(t.COMPASS_CONFIG?t.tenant=t.COMPASS_CONFIG.tenant:self.COMPASS_CONFIG?t.tenant=self.COMPASS_CONFIG.tenant:self.widget&&self.widget.data&&(t.tenant=self.widget.data.x3dPlatformId));var c=t&&t.COMPASS_CONFIG?t.COMPASS_CONFIG.userId:"";!c&&self.COMPASS_CONFIG&&(c=self.COMPASS_CONFIG.userId);var l={label:c+"-DELWebProcessValidationModelCV.getPrimaryCapableResources.navigate-"+(new Date).getTime(),tenant:t.platformId||t.tenant,input_physical_ids:[t.physicalid],primitives:[{navigate_to_rel:{id:1}}],patterns:{resourceCnx:[{id:1}]},patternTypeFilters:{resourceCnx:{typesToReturn:[t.typeToReturn||"DELAsmProcessCanUseCnx"],filterLinksOn:"elements"}},attributes:["ds6w:label","physicalid","type","current","ds6w:created","ds6w:modified","cestamp","bo.DELAsmProcessCanUseCnx.V_ResourcesQuantity","bo.DELAsmProcessCanUseCnx.V_IsPreferred","bo.DELAsmProcessCanUseCnx.V_ManuallyScheduled","bo.DELAsmProcessCanUseCnx.V_Priority","bo.DELAsmProcessCanUseCnx.V_ToolChangeoverTime","bo.DELAsmProcessCanUseCnx.V_IsReservedFromFirstStep","bo.DELAsmProcessCanUseCnx.V_CapableRscGroupIndex","pathsr"],version:3};l=JSON.stringify(l);r._getSecurityContext().then((function(c){var d=o+"/cvservlet/navigate?SecurityContext="+encodeURIComponent(c);r.callAuthenticatedRequest(d,"json","POST",l,s).then((function(r){if(r&&r.result){var s=[];e.each(r.result,(function(i,r){if(!r||!r.input_object||r.input_object.physicalid!==t.physicalid)return e.log("DELWebProcessValidationModelCV::getPrimaryCapableResources - invalid query!"),void e.log(r);r.outputs&&r.outputs.resourceCnx&&e.each(r.outputs.resourceCnx,(function(t,i){if(!i||!i.physicalid)return e.log("DELWebProcessValidationModelCV::getPrimaryCapableResources - invalid connection!"),void e.log(i);if(i.pathsr&&i.pathsr.indexOf(" Sep ")>0){var r=n.convertToModelObj(i,!0),a=i.pathsr.split(" Sep ");if(2===a.length){r.resource={source:o,identifier:null,relativePath:null,type:"VPMReference"};var c=new RegExp("PS\\s+([a-zA-Z0-9 ]*)\\s+PE").exec(a[0]);c&&2===c.length&&e.each(c[1].split(" "),(function(e,t){r.resource.identifier=t,r.resource.relativePath="/resources/v1/modeler/dsrsc/dsrsc:ResourceItem/"+t}))}if(r&&r.resource&&r.resource.identifier){var l=Object.assign({plmBaseObjectType:r.resource.type,physicalid:r.resource.identifier},r.resource);l.connection=r,s.push(l)}}}))})),i(s)}else a(new Error("invalid response from DELWebProcessValidationModelCV::getPrimaryCapableResources"))}),a)}))}else a(new Error("invalid 3DSpace URL"))})):a("Invalid input parameters!")}))},getSecondaryCapableResources:function(e,t){return d.getPrimaryCapableResources(Object.assign({typeToReturn:"SecondaryCandidateResourceLink"},e),t)},_cacheOperationObject:function(e,t){return d._cacheXXXObject(e,t,"operation")},_cacheWorkplanObject:function(e,t){return d._cacheXXXObject(e,t,"work_plan")},_cacheItemObject:function(e,t){return d._cacheXXXObject(e,t,"item")},_cacheXXXObject:function(t,i,n){var r=d;if(!t||!t.blnDoNotCache){c[n]||(c[n]={});var s=c[n];c.physicalid2OXID||(c.physicalid2OXID={});var a=c.physicalid2OXID,o=null;if(c.PLMExternalID2OXID||(c.PLMExternalID2OXID={}),o=c.PLMExternalID2OXID,t.OXID||t.physicalid){if(t.physicalid&&t.OXID?a[t.physicalid]=t.OXID:t.physicalid&&!t.OXID?a[t.physicalid]&&(t.OXID=a[t.physicalid]):!t.physicalid&&t.OXID&&s[t.OXID]&&(t.physicalid=s[t.OXID].physicalid),t.physicalid&&t.OXID&&(s[t.physicalid]&&!s[t.OXID]?s[t.OXID]=s[t.physicalid]:!s[t.physicalid]&&s[t.OXID]&&(s[t.physicalid]=s[t.OXID])),s[t.OXID||t.physicalid]){var l=Object.assign(s[t.OXID||t.physicalid],t);s[t.OXID||t.physicalid]=l}else s[t.OXID||t.physicalid]=t;if(t.physicalid&&t.OXID&&(s[t.physicalid]=s[t.OXID]),t.AllAttributesRetrieved=!!i||(t.AllAttributesRetrieved||!1),t.PLM_ExternalID&&t.OXID&&(o[t.PLM_ExternalID]=t.OXID),t.physicalid&&t.TargetResourceIds&&t.TargetResourceIds.physicalid&&c.assoc){c.assoc[t.TargetResourceIds.physicalid]||(c.assoc[t.TargetResourceIds.physicalid]={}),c.assoc[t.TargetResourceIds.physicalid].DirectlyAssociated||(c.assoc[t.TargetResourceIds.physicalid].DirectlyAssociated=[]);var p=!1;if(e.each(c.assoc[t.TargetResourceIds.physicalid].DirectlyAssociated,(function(e,i){return!(p=r.checkEquality(t,i))})),p||c.assoc[t.TargetResourceIds.physicalid].DirectlyAssociated.push(t),Foe&&Foe.Model&&Foe.Model.Asset&&Foe.Model.Asset.getOidsFromModel){var u=Foe.Model.Asset.getOidsFromModel(t.TargetResourceIds);Array.isArray(u)||(u=[u]);var f=Foe.Model.Asset.FindPLMObjectInCache({OXID:Foe.Model.Asset.getRootOXID(),physicalid:Foe.Model.Asset.getRootPhysicalid()},"True");e.each(c.assoc,(function(i,n){if(n&&i!==t.TargetResourceIds.physicalid&&u&&u.length&&window.Configuration.useFixtures&&can.fixture){var r=Foe.Model.Asset.FindPLMObjectInCache({physicalid:i},"True");r&&f&&f.V_Name===r.V_Name&&f.physicalid!==r.physicalid&&e.each(u,(function(e,t){t&&t&&t.indexOf(r.physicalid)<0&&u.push(t.replace(f.physicalid,r.physicalid))}))}}))}}}}}});return d}));