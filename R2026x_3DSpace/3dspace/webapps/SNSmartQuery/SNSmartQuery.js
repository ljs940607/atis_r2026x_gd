define("DS/SNSmartQuery/utils/NLQEngineUtils",["UWA/Core","UWA/Class"],(function(e,t){"use strict";return t.singleton({init:function(){},_splitByTag:function(e){return e=e.replace(/(\[\s*\w+:\w+\s*\])\s*:\s*\(\s*(.*?)\s*\)/g,(function(e,t,r){if(r.indexOf("OR")>0){e=t+":"+(r=r.split("OR"))[0].trim();for(var i=1;i<r.length;i++)e+=" OR "+t+":"+r[i].trim();e="("+e+")"}else if(r.indexOf("AND")>0){e=t+":"+(r=r.split("AND"))[0].trim();for(i=1;i<r.length;i++)e+=" AND "+t+":"+r[i].trim();e="("+e+")"}return e}))},_temp:function(e){return e=e.replace(/\n\w+/,"")},_postProcessUql:function(t){let r=this;return t=(t=(t=(t=t.replaceAll("$$me$$","[__USERNAME__]")).replaceAll("$$usertag$$","[__USERTAG__]")).replace(/(\$\$[c|m|p])\s*(=|<=|<|>=|>)\s*(.*?\$\$)/g,(function(e,t,r,i){return"c"==(t=t.substring(2,t.length))?t=t.replace("c","[ds6w:created]"):"m"==t?t=t.replace("m","[ds6w:modified]"):"p"==t&&(t=t.replace("p","[ds6w:plannedEnd]")),t+r+"$$"+i}))).replace(/(\[\s*\w+:\w+\s*\])\s*(=|<=|<|>=|>|:)\s*(\$\$.*?\$\$)/g,(function(t,i,n,a){let s,o;a=a.substring(2,a.length-2);if(/(d|w|m|q|h|y)\d/.test(a)){let t=[...a.matchAll(/(d|w|m|q|h|y)(\d+)/g)],i={d:0,w:1,m:2,q:3,h:4,y:5},n={};t.forEach(((e,t)=>{n[e[1]]={value:Number(e[2]),order:i[e[1]]}})),t.sort(((e,t)=>t.order-e.order));let u={},l=r._date();n.d&&(u.d=n.d.value),n.m&&(u.m=n.m.value-1),n.q&&(u.q=n.q.value,u.m=3*(u.q-1),u.d=1),n.h&&(u.h=n.h.value,u.m=6*(u.h-1),u.d=1),n.y?u.y=n.y.value:u.y=l.getFullYear();let c=function(){var e=new Date(l.getFullYear(),0,1);return Math.ceil(((l-e)/864e5+e.getDay()+1)/7)};n.w&&(u.w=n.w.value,u.d=l.getDate()-l.getDay()-7*(c()-n.w.value),u.m=l.getMonth(),r._validTime(u));let p=u.d;u.d=e.is(u.d)?u.d:1,u.m=e.is(u.m)?u.m:p?l.getMonth():0,s=u,s.value=u.y+"-"+(u.m+1).toString().padStart(2,"0")+"-"+u.d.toString().padStart(2,"0");let d=t[0][1];o=r._upperBoundOffset(e.clone(s),d)}else s=r._lowerBound(a),o=r._upperBoundOffset(e.clone(s),a[0]);return">"==n?t=i+'>"'+o.value+'"':">="==n?t=i+'>"'+s.value+'"':"<"==n?t=i+'<"'+s.value+'"':"<="==n?t=i+'<"'+o.value+'"':"="!=n&&":"!=n||(t=i+'>"'+s.value+'" AND '+i+'<"'+o.value+'"'),t})),t=this._temp(t),t=this._splitByTag(t)},_lowerBound:function(e){let t=0;e.split("-").length>1?t=e.split("-")[1]:e.split("+").length>1&&(t=0-e.split("+")[1]);let r={},i=this._date();switch(e[0]){case"y":r.y=i.getFullYear()-t,r.m=0,r.d=1;break;case"q":r.m=3*(Math.floor(i.getMonth()/3)-t),r.d=1;break;case"m":r.m=i.getMonth()-t,r.d=1;break;case"w":r.d=i.getDate()-i.getDay()-7*t;break;case"d":r.d=i.getDate()-t}return this._validTime(r),r.value=r.y+"-"+(r.m+1).toString().padStart(2,"0")+"-"+r.d.toString().padStart(2,"0"),r},_upperBoundOffset:function(e,t){switch(t){case"y":e.y+=1;break;case"h":e.m+=6;break;case"q":e.m+=3;break;case"m":e.m+=1;break;case"w":e.d+=7;break;case"d":e.d+=1}return e.d?e.d-=1:e.d=-1,this._validTime(e),e.value=e.y+"-"+(e.m+1).toString().padStart(2,"0")+"-"+e.d.toString().padStart(2,"0"),e},_date:function(){return new Date},_validTime:function(t){let r=this._date();e.is(t.y)||(t.y=r.getFullYear()),e.is(t.m)||(t.m=r.getMonth()),e.is(t.d)||(t.d=r.getDate());let i=[31,28,31,30,31,30,31,31,30,31,30,31];for(;t.d<1;){t.m--,-1==t.m&&(t.m+=12,t.y--);let e=t.y%4==0?1:0;t.d+=i[t.m]+(1==t.m?e:0)}for(;t.d>i[t.m]+(1==t.m&&t.y%4==0?1:0);){let e=t.y%4==0?1:0;t.d-=i[t.m]+(1==t.m?e:0),t.m++,12==t.m&&(t.m-=12,t.y++)}for(;t.m<0;)t.m+=12,t.y--;for(;t.m>11;)t.m-=12,t.y++;return t.y>=1970&&t.y<=3e3||(t.y<1970?t.y=1970:t.y>3e3&&(t.y=3e3)),t}})})),define("DS/SNSmartQuery/config/SmartQueryConfig",["UWA/Core","UWA/Class","UWA/Class/Debug","text!DS/SNSmartQuery/assets/SmartQueryConfig.json"],(function(e,t,r,i){"use strict";return t.singleton(r,{init:function(){this._config=JSON.parse(i)},get:function(e){return this._config[e]}})})),define("DS/SNSmartQuery/InContext/InContextHandler",["UWA/Core","UWA/Class"],(function(e,t){"use strict";return t.extend({init:function(t){this.classAttributes=!0===t.show_classification_attributes,this.keywords=!0===t.show_keywords,this.companyTags=!0===t.show_company_tags,this.predicateMap={},this.excludePredicateMap={},this.interfaceMap={},this.source=t.source,this.typesInContext=[],this.excludeTypesInContext=[],e.is(t.types,"array")&&t.types.length?t.types.forEach((t=>{let r={};r.uri=t.uri,r.nlsName=t.nlsName,this.typesInContext.push(r),e.is(t.predicates,"array")&&t.predicates.length?(this.predicateMap[r.uri]=[],t.predicates.forEach((e=>{let t={};t.uri=e.uri,t.nlsName=e.nlsName,t.dimension=t.dimension,this.predicateMap[r.uri].push(t)}))):t.excluded_predicates&&t.excluded_predicates.length&&(this.excludePredicateMap[r.uri]=[],t.excluded_predicates.forEach((e=>{this.excludePredicateMap[r.uri].push(e.uri)}))),e.is(t.extensions,"array")&&t.extensions.length&&(this.interfaceMap[r.uri]=[],t.extensions.forEach((t=>{let i={};i.uri=t.uri,i.nlsName=t.nlsName,this.interfaceMap[r.uri].push(i),e.is(t.predicates,"array")&&t.predicates.length?(this.predicateMap[i.uri]=[],t.predicates.forEach((e=>{let t={};t.uri=e.uri,t.nlsName=e.nlsName,t.dimension=e.dimension,this.predicateMap[i.uri].push(t)}))):e.is(t.excluded_predicates,"array")&&t.excluded_predicates.length&&(this.excludePredicateMap[i.uri]=[],t.excluded_predicates.forEach((e=>{this.excludePredicateMap[i.uri].push(e.uri)})))})))})):t.excluded_types&&t.excluded_types.length&&t.excluded_types.forEach((e=>{this.excludeTypesInContext.push(e.uri)})),this.predicatesInContext=[],this.excludePredicatesInContext=[],e.is(t.predicates,"array")&&t.predicates.length?t.predicates.forEach((e=>{let t={};t.uri=e.uri,t.nlsNalme=e.nlsNalme,t.dimension=e.dimension,this.predicatesInContext.push(t)})):e.is(t.excluded_predicates,"array")&&t.excluded_predicates.length&&t.excluded_predicates.forEach((e=>{this.excludePredicatesInContext.push(e.uri)}))},showClassAttribute:function(){return this.classAttributes},showCompanyTags:function(){return this.companyTags},showKeywords:function(){return!1},getTypesInContext:function(t){if(this.typesInContext&&this.typesInContext.length){let r=[],i=this.typesInContext.map((e=>e.uri));return t.forEach((t=>{let n=t.uri;"3DSpace"===t.service&&(n=t.uri.split(":").pop());let a=i.indexOf(n);if(a>-1){let i=e.clone(t,!0);this.typesInContext[a].nlsName&&(i.displayValue=this.typesInContext[a].nlsName),r.push(i)}})),r=this.getFilteredTypes(r),r}if(this.excludeTypesInContext&&this.excludeTypesInContext.length){let e=this;return(t=this.getFilteredTypes(t)).filter((function(t){return-1==e.excludeTypesInContext.indexOf(t.uri)}))}return t=this.getFilteredTypes(t)},getFilteredTypes:function(e){let t=this;return this.source&&this.source.length?e.filter((function(e){return t.source.indexOf(e.source)>-1})):e},getPredicatesInContext:function(t){if(this.predicatesInContext&&this.predicatesInContext.length){let r=[],i=this.predicatesInContext.map((e=>e.uri));return t.forEach((t=>{let n=i.indexOf(t.uri);if(n>-1){let i=e.clone(t,!0);this.predicatesInContext[n].nlsName&&(i.displayValue=this.predicatesInContext[n].nlsName),r.push(i)}})),r}if(this.excludePredicatesInContext&&this.excludePredicatesInContext.length){let e=this;return t.filter((function(t){return-1==e.excludePredicatesInContext.indexOf(t.uri)}))}return t},getInterfacesInContext:function(t,r){if(this.interfaceMap[t]&&this.interfaceMap[t].length){let i=[],n=this.interfaceMap[t].map((e=>e.uri));return r.forEach((r=>{let a=r.name,s=n.indexOf(a);if(s>-1){let n=e.clone(r,!0);this.interfaceMap[t][s].nlsName&&(n.nlsName=this.interfaceMap[t][s].nlsName),i.push(n)}})),i}return r},updateExtsPredicates:function(t,r,i){if(this.typesInContext&&this.typesInContext.length){let n=this.typesInContext.map((e=>e.uri)),a=[];if(r.forEach((e=>{if(this.excludePredicateMap[e]&&this.excludePredicateMap[e].length){let t=this.excludePredicateMap[e];a=a.concat(t)}})),-1!==n.indexOf(t)&&this.interfaceMap[t]&&this.interfaceMap[t].length){let t=[];return i.forEach((i=>{let n,s=!0;if(-1!==a.indexOf(i.uri)?s=!1:r.forEach((e=>{if(s&&this.predicateMap[e]&&this.predicateMap[e].length){-1===this.predicateMap[e].map((e=>(e.uri===i.uri&&e.nlsName&&(n=e.nlsName),e.uri))).indexOf(i.uri)&&(s=!1)}})),s){let r=e.clone(i,!0);n&&(r.nlsName=n),t.push(r)}})),t}}return i},updateTypePredicates:function(t,r){let i=[],n=[];return t.forEach((e=>{if(this.excludePredicateMap[e]&&this.excludePredicateMap[e].length){let t=this.excludePredicateMap[e];n=n.concat(t)}})),r.forEach((r=>{let a,s=!0;if(-1!==n.indexOf(r.uri)?s=!1:t.forEach((e=>{if(s&&this.predicateMap[e]&&this.predicateMap[e].length){-1===this.predicateMap[e].map((e=>(e.uri===r.uri&&e.nlsName&&(a=e.nlsName),e.uri))).indexOf(r.uri)&&(s=!1)}})),s){let t=e.clone(r,!0);a&&(t.nlsName=a),i.push(t)}})),i},getQuery:function(){}})})),define("DS/SNSmartQuery/context/SNSmartQueryToken",["UWA/Core","UWA/Class"],(function(e,t){"use strict";var r=t.extend({type:void 0,displayValue:void 0,value:void 0,init:function(e){this.type=e.type,this.uri=e.uri,this.displayValue=e.displayValue,this.value=e.value,this.dataTypes=e.dataTypes,this.data=e.data,this.category=e.category,this.isClassAttribute=e.isClassAttribute},getToken:function(e){return new r(e)}});return r})),define("DS/SNSmartQuery/utils/SNMLIClient",["UWA/Core","UWA/Class","UWA/Promise","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","text!DS/SNSmartQuery/assets/MLIClientParams.json","text!DS/SNSmartQuery/assets/prompt.txt"],(function(e,t,r,i,n,a,s,o,u){"use strict";return t.singleton({_defaultMLIClientOptions:JSON.parse(o),init:function(){this._mliUrlPromise=new r((function(t,r){n.getPlatformServices({platformId:s.getActiveTenant()||"OnPremise",onComplete:function(r){e.is(r)?t({mlinference:r.mlinference,aiassistantinfra:r.aiassistantinfra}):t(void 0)},onFailure:function(e){t(void 0)}})})),this._OpFM=a.getOption("OpFM");let t=a.getOption("NLQWithPrompt");this._withPrompt=e.is(t)?t:this._defaultMLIClientOptions.with_prompt,this._localLLM=a.getOption("localLLM")},nlqToUql:function(t){let r=this;e.is(r._localLLM,"object")?r.callLocalLLM(t):r._OpFM?r.callMLI("OpFM",t):r._mliUrlPromise.then((function(e){a.getOption("NLQMLI")?e.mlinference&&r.callMLI(e.mlinference,t):e.aiassistantinfra?r.callAIAssistant(e.aiassistantinfra,t):t.onFailure()}))},buildMLIPayload:function(e){let t={};t.model=e.model||(this._OpFM?this._defaultMLIClientOptions.opModel:this._defaultMLIClientOptions.model),t.max_tokens=this._defaultMLIClientOptions.max_tokens,t.top_p=this._defaultMLIClientOptions.top_p,t.temperature=this._defaultMLIClientOptions.temperature;let r=e.nlq;return this._withPrompt&&(r=u.replaceAll("__QUERY__",e.nlq),r=r.replaceAll("_CURRENTDATETIMEISO_",(new Date).toISOString())),t.messages=[],t.messages.push({role:"user",content:r}),JSON.stringify(t)},buildAssistantPayload:function(e){let t={};return t.prompt=e.nlq,JSON.stringify(t)},buildLLMRequestOptions:function(t){var r={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}};return this._OpFM&&(r.headers.Authorization=atob("QmVhcmVyIG1zdGZOcnIyUlZ6YkJaR3RwclFqWUR2NDcxc1Q0RFE4ai9rQi9pOStTaDA9")),r.onComplete=function(r){console.log(r);let i=JSON.parse(r);i.llm&&(i=i.llm),i&&e.is(i.choices,"array")&&i.choices.length>0&&i.choices[0].message&&i.choices[0].message.content?t.onComplete({uql:{status:"OK",query:i.choices[0].message.content}}):t.onFailure()},r.onFailure=function(e){t.onFailure()},r.ontimeout=function(e){t.ontimeout()},r},callMLI:function(e,t){if(e){let r=this.buildLLMRequestOptions(t);r.data=this.buildMLIPayload(t),i.authenticatedRequest(e+"/foundation-models/v1/chat/completions",r)}},callAIAssistant:function(e,t){if(e){let r=this.buildLLMRequestOptions(t);r.data=this.buildAssistantPayload(t);let n=a.getOption("nlq_agent_name"),s=a.getOption("nlq_agent_api_endpoint");i.authenticatedRequest(e+s+n+"/submit",r)}},callLocalLLM:function(t){var n=this;new r((function(e){var r={method:"POST",proxy:"none",headers:{"Content-Type":"application/json"},data:new Blob([JSON.stringify({data:[t.nlq,n._localLLM.llmPath]})],{type:"application/json"}),url:n._localLLM.url+"/gradio_api/call/predict",onComplete:function(t){console.log("Local LLM request to get event id completed"),e(JSON.parse(t))},onFailure:function(t){console.error("Local LLM request to get event id failed"),e()}};i.handleRequest(r.url,r)})).then((function(a){var s;e.is(a,"object")?(s=a.event_id,new r((function(e){var t={method:"GET",proxy:"none",headers:{Acept:"application/json","Content-Type":"application/json"},url:n._localLLM.url+"/gradio_api/call/predict/"+s,onComplete:function(t){console.log("Local LLM request completed"),e(t)},onFailure:function(t){console.log("Local LLM request to get UQL FAILED"),e()}};i.handleRequest(t.url,t)}))).then((function(e){let r;if(e){const t=e.indexOf("event: complete");if(-1!==t){const i=e.indexOf("\n",t+1);if(-1!==i){const t=e.indexOf("data:",i+1);if(-1!==t){const i=e.indexOf("\n",t+1);if(-1!==i){const n=e.substring(t+6,i);try{console.log("Local LLM request to get UQL completed"),r=JSON.parse(n)[0]}catch(e){console.error("Local LLM request to get UQL FAILED")}}}}}}r?t.onComplete({uql:{status:"OK",query:r}}):t.onFailure()})):t.onFailure()}))}})})),define("DS/SNSmartQuery/SNSmartQueryRules",["UWA/Core","UWA/Class","UWA/Promise","DS/SNInfraUX/Logger","DS/SNSmartQuery/config/SmartQueryConfig"],(function(e,t,r,i,n){"use strict";return t.singleton({TokenType:{START:"START",USER_TEXT:"USER_TEXT",TYPE:"TYPE",INTERFACE:"INTERFACE",L_OPERATOR:"L_OPERATOR",R_OPERATOR:"R_OPERATOR",U_OPERATOR:"U_OPERATOR",PREDICATE:"PREDICATE",PREDICATE_VALUE:"PREDICATE_VALUE",KEYWORD:"KEYWORD",K_KEYWORD:"KEY_KEYWORD",V_KEYWORD:"VALUE_KEYWORD",OPEN_PARENT:"OPEN_PARENT",CLOSE_PARENT:"CLOSE_PARENT",COMPANY_TAG:"COMPANY_TAG",COMMUNITY_TAG:"COMMUNITY_TAG",USER_TAG:"USER_TAG",TYPE_GROUP:"TYPE_GROUP"},SUGGESTION_CATEGORY:{WHO:"ds6w:who",WHAT:"ds6w:what",WHERE:"ds6w:where",WHEN:"ds6w:when",HOW:"ds6w:how",WHY:"ds6w:why",OPERATOR:"OPERATOR",DS_SIX_WG:"ds6wg"},init:function(e){this._smartQueryEngineJson=n.get("SmartQueryEngineRules"),this._smartQueryEngineUqlJson=n.get("SmartQueryEngineUqlRules"),this._parent(e)},getRule:function(e,t){return this._getRule(e,t,this._smartQueryEngineJson)},getUqlRule:function(e,t){return this._getRule(e,t,this._smartQueryEngineUqlJson)},getPredicateValueTokenTypes:function(){let e={};return this._smartQueryEngineUqlJson[this.TokenType.R_OPERATOR].forEach(((t,r)=>{e[t]=!0})),e},_getRule:function(e,t,r){let i=t>0&&e.getAt(t-1),n=i&&i.type||this.TokenType.START,a={};return r[n].forEach(((e,t)=>{a[e]=!0})),a},destroy:function(){}})})),define("DS/SNSmartQuery/utils/StaticDataRepository",["UWA/Core","UWA/Class","UWA/Promise","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/Api/SearchApi","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNSmartQuery/SNSmartQueryRules","DS/WebappsUtils/WebappsUtils","DS/SNInfraUX/SearchSettings","DS/SNSmartQuery/config/SmartQueryConfig","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SNUnitConversion","DS/SNInfraUX/SNPLMDictionary","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/ServiceDelegationLoader","DS/SNInfraUX/PlatformEnvServices","DS/WAFData/WAFData","text!DS/SNSmartQuery/assets/TypeIconInfo.json","i18n!DS/SNSmartQuery/assets/nls/SNSmartQuery.json"],(function(e,t,r,i,n,a,s,o,u,l,c,p,d,g,f,h,y,S,_,m,T,P){"use strict";return t.singleton({_loadTypesPromise:null,_loadPredicatesPromise:null,_staticDatapromiseArray:null,_getLoggedInUserPromise:null,_loggedInUser:null,_predicateDataTypeMap:null,_fedPredicateMap:null,_typePredicatesPromise:null,_jsonVocab:null,init:function(t){this._loadTypesPromise=r.deferred(),this._loadPredicatesPromise=r.deferred(),this._loadAttributePromise=r.deferred(),this._loadDimensionPromise=r.deferred(),this._getLoggedInUserPromise=r.deferred(),this._loadCustoPromise=r.deferred(),this._staticDatapromiseArray=[this._loadTypesPromise.promise,this._loadPredicatesPromise.promise,this._getLoggedInUserPromise.promise,this._loadAttributePromise.promise,this._loadDimensionPromise.promise],this._fedPredicateMap=new Map,this._predicateDataTypeMap=new Map,this._typePredicatesPromise=new Map,e.is(t)&&e.is(t.loadOnDemand)||this._load(),this._rangeValueMap={},this._unitInfoMap={},this.rootMap={},this._sourceMap={},this.intefaceTypeMap={},this._communityContainerUidMap={}},_load:function(){this._loadCusto(),this._getDimensionJson(),this._getClassesFromAllTheSources(),this._loadPredicatesFromFedDictonary(),this._loadClassificationAttributes(),this._loadLoggedInUser()},getStaticDataPromiseArray:function(){return this._staticDatapromiseArray},getTypesPromise:function(){return this._loadTypesPromise.promise},getPreicatesPormise:function(){return this._loadPredicatesPromise.promise},getLoggedInUser:function(){return this._loggedInUser},_getUniqueIdPromise:function(){let e=this;return new r((function(t,r){e._getLoggedInUserPromise.promise.then((function(){t("")}),(function(){t("")}))}))},_getDimensionJson:function(){var e=this,t=new y({});h.setResources({resources:t}),h.loadDictionary().then((function(){i.log("Dictionary loaded"),e._loadDimensionPromise.resolve()}))},setRangeValues:function(t,r,i){r&&t&&i&&(e.is(this._rangeValueMap[r])||(this._rangeValueMap[r]={}),this._rangeValueMap[r][t]=i)},getRangeValues:function(e,t){return t&&e&&this._rangeValueMap[t]&&this._rangeValueMap[t][e]},setPredUnitInfo:function(t,r,i){r&&t&&i&&(e.is(this._unitInfoMap[r])||(this._unitInfoMap[r]={}),this._unitInfoMap[r][t]=i)},getPredUnitInfo:function(e,t){return t&&e&&this._unitInfoMap[t]&&this._unitInfoMap[t][e]},_loadClassificationAttributes:function(){var t={},r=[],a=this;u.getServiceUrl({serviceName:"3DSpace",platformId:n.getActiveTenant()||"OnPremise",onComplete:function(s){var o=s+"/resources/IPClassificationReuse/ClassAttribute/fetchClassificationAttributesDefinition";t.method="GET",t.headers={Accept:"application/json","Accept-Language":n.getLanguage()},t.timeout=3e3,t.onComplete=function(t){a._loadDimensionPromise.promise.then((function(){var i=JSON.parse(t);i.classPredicates&&i.classPredicates[0]&&i.classPredicates[0].vocabularyPredicateInfo&&(i.classPredicates[0].vocabularyPredicateInfo.forEach(((t,i)=>{t.rangeValues&&e.is(t.rangeValues.literalInfo,"array")?a.setRangeValues(t.uri,"classifiationAttr",t.rangeValues.literalInfo):e.is(t.defaultValue,"object")&&(t.defaultValue.isDefault=!0,a.setRangeValues(t.uri,"classifiationAttr",t.defaultValue)),t.dimension&&a.setPredUnitInfo(t.uri,"classifiationAttr",h._dimensions[t.dimension]),a.setPredicateDataType(t);var n={};n.displayValue=t.nlsName,n.value="["+t.uri+"]",n.uri=t.uri,n.suggestionType=l.TokenType.PREDICATE,n.category=l.SUGGESTION_CATEGORY.DS_SIX_WG,n.textToInsert="`"+t.nlsName+"` ",n.dataType=a._getPredicateTypeFromDataType(t),n.iconClass="fonticon-properties",n.classAttribute=!0,n.unitInfo=a.getPredUnitInfo(t.uri,"classifiationAttr"),r.push(n)})),a._loadAttributePromise.resolve(r))}))},t.onFailure=function(e){i.warn("Classification Attribute call - Failed"),a._loadAttributePromise.resolve([])},t.ontimeout=function(e){i.warn("Classification Attribute call - timeOut"),a._loadAttributePromise.resolve([])},m.authenticatedRequest(o,t)},onFailure:function(e){a._loadAttributePromise.resolve([])}})},_fedSearch:function(t){let r=t.onComplete,i=t.onFailure;u.getServiceUrl({serviceName:"3DSearch",platformId:n.getActiveTenant(),onComplete:function(n){if(e.is(n,"string")){let a;if(e.is(t.fedsearchOptions,"function")?a=t.fedsearchOptions():e.is(t.fedsearchOptions)&&(a=t.fedsearchOptions),!a)return void i([]);let s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify(a),onComplete:function(e){let t=JSON.parse(e);r(t)},onFailure:function(e){i([])}};m.authenticatedRequest(n+"/search",s)}else i([])},onFailure:function(e){i([])}})},setPredicateDataType:function(e){this._predicateDataTypeMap.set(e.curi||e.uri,this._getPredicateTypeFromDataType(e))},getPredicateDataType:function(t){let r=this._predicateDataTypeMap.get(t);return(e.is(r)||!t||"$BY"!=t&&"ABOUT"!=t)&&r||"string"},_excludeAndAssignWeight:function(e,t,r,i){let n=d.get("suggestion_preference_weightage").default_weightage,a=d.get("suggestion_preference_weightage").scc_factor;for(var s=0;s<e.length;s++){if(t.indexOf(e[s].uri)>=0){e.splice(s,1),s--;continue}e[s].weightage=n;let o=r.indexOf(e[s].uri);o>=0&&(e[s].weightage*=a),o=i[e[s].uri],o>0&&(e[s].weightage+=(Object.keys(i).length-o+1)/100)}return e.sort(((e,t)=>t.weightage-e.weightage)),e},_getClassesFromAllTheSources:function(){let e=this,t=null,i=d.get("Preferred").types,n=d.get("Excluded").types,a=JSON.parse(T);this._getAvailableSources().then((function(s){s=s.filter((function(e){return e.status})),r.all(e._loadVocabClassesForServices(s)).then((function(r){let o=[];r.forEach(((t,r)=>{t.classInfos.forEach((t=>{e._sourceMap[t.uri]=s[r].name})),o=o.concat(t.classInfos)})),e._loadCustoPromise.promise.then((function(){let r=e._getPreferredTypes();var s=e._getExcludedTypes().concat(n);let u;o=e._excludeAndAssignWeight(o,s,r,i),o=o.map((r=>{let i;return u=r.uri.split(":").pop(),t={displayValue:r.nlsName,value:"3DSpace"===r.service||"3DDrive"===r.service?'flattenedtaxonomies:"types/'+u+'"':'[ds6w:type]:"'+r.uri+'"',suggestionType:l.TokenType.TYPE,uri:r.uri,weightage:r.weightage,source:e._sourceMap[r.uri]},"3DSpace"===r.service&&a.type[u]?i=u:a.type[r.uri]&&(i=r.uri),i?a.type[i].image?t.imageUrl=c.getWebappsBaseUrl()+"TagNavigator/assets/icons/type_icon/"+a.type[i].image:a.type[i].iconClass?t.iconClass=a.type[i].iconClass:t.iconClass="fonticon-3d-object":t.iconClass="fonticon-3d-object",t})),e._loadTypesPromise.resolve(o)}))}))}))},_getAvailableSources:function(){return new r((function(e,t){o.getSearchApiPromise().then((function(){let t=n.getActiveTenant(),r=s.getAvailableSources(t);e(r)}))}))},_loadVocabClassesForServices:function(e){let t=[];let i=n.getActiveTenant(),s=n.getLanguage();return e.forEach((e=>{e.status&&t.push(new r(((t,r)=>{let n=function(e){let t=d.get("sourceNotVocabIntegrated");if(t&&t[e])return t[e]}(e.service);n?t(n):a.loadVocabularyClasses({vocabId:e.service,tenantId:i,lang:s},t)})))})),t},_handleExcludeAndPrefPredicates:function(e){let t=this._getPreferredPredicates(),r=(this._getExcludedPredicates(),d.get("Preferred").predicates),i=d.get("Excluded").predicates;return e=this._excludeAndAssignWeight(e,i,t,r)},_getExcludedTypes:function(){let t=[],r=n.getActiveTenant(),i=p.getOption("topbar_search_banned_list",{tenant:r});return e.is(i)&&e.is(i.types)&&Object.keys(i.types).forEach((r=>{let n=i.types[r];e.is(n,"array")&&(t=t.concat(n))})),t},_getPreferredTypes:function(){return this.prefTypesSCC||[]},_loadPredicatesFromFedDictonary:function(){let e=this,t=null,r=[];var i={};n.getActiveTenant();let s={onComplete:function(n){Object.values(n).forEach((e=>{e.properties.forEach((e=>{i[e.curi]=e.subPropertyOf}))}));var a=function(e){let t=i[e];return t?a(t):e};Object.keys(i).forEach((t=>{e.rootMap[t]=a(t)})),Object.values(n).forEach((i=>{i.properties.forEach((i=>{e._setFedPredicate(i.curi),e.setPredicateDataType(i),t={uri:i.curi,displayValue:i.label,value:"["+i.curi+"]",suggestionType:l.TokenType.PREDICATE,textToInsert:"`"+i.label+"` ",dataType:e._getPredicateTypeFromDataType(i),category:e.rootMap[i.curi]},t.iconClass="fonticon-3ds-"+t.category.substring(5),r.push(t)}))})),e._loadCustoPromise.promise.then((function(){e._loadPredicatesPromise.resolve(r)}))},onFailure:function(t){e._loadPredicatesPromise.resolve(r)},tenantId:n.getActiveTenant(),lang:n.getLanguage(),apiVersion:"R2021x"};a.getFedProperties(s)},loadRelevantPredicates:function(t){var r=this;let i=[];return t.className.forEach(((n,s)=>{let o=r._getJsonVocab(n);o?i.push(o):(e.is(r._typePredicatesPromise[n])||(r._typePredicatesPromise[n]=new Promise(((e,r)=>{let i={className:n,tenantId:t.tenantId};a.loadRelevantPredicates(i,e)}))),i.push(r._typePredicatesPromise[n]))})),i},_getJsonVocab:function(e){if(!this._jsonVocab){this._jsonVocab={};let e=d.get("vocabs");e&&Object.keys(e).forEach((t=>{let i=e[t];i.enable&&i.vocab&&Object.keys(i.vocab).forEach((e=>{i.vocab[e]&&i.vocab[e].predicates&&(this._jsonVocab[e]=new r(((t,r)=>{t({vocabularyPredicateInfo:i.vocab[e].predicates.map((e=>({uri:e.uri,nlsName:e.nlsName?P.get("SNSmartQuery.vocab.predicate."+e.nlsName):P.get("SNSmartQuery.vocab.predicate."+e.uri),type:e.type,category:e.lineage})))})})))}))}))}return this._jsonVocab[e]},_setFedPredicate:function(e){this._fedPredicateMap[e]=e},isFedPredicate:function(e){return this._fedPredicateMap[e]},_getPredicateTypeFromDataType:function(t){var r="",i="string";return e.is(t)&&e.is(t.range)&&e.is(t.range.dataTypes)&&e.is(t.range.dataTypes.length)?"http://www.w3.org/2001/XMLSchema#string"===(r=t.range.dataTypes[0])?i="string":"http://www.w3.org/2001/XMLSchema#boolean"===r?i="boolean":"http://www.w3.org/2001/XMLSchema#integer"===r?i="integer":"http://www.w3.org/2001/XMLSchema#real"===r?i="double":"http://www.w3.org/2001/XMLSchema#dateTime"===r||"http://www.w3.org/2001/XMLSchema#date"===r?i="date":"http://www.w3.org/2001/XMLSchema#double"===r?i="double":("http://www.w3.org/2001/XMLSchema#timestamp"===r||"http://www.w3.org/2001/XMLSchema#time"===r)&&(i="date"):t.dataType?"http://www.w3.org/2001/XMLSchema#dateTime"===(r=t.dataType)||"http://www.w3.org/2001/XMLSchema#date"===r?i="date":"http://www.w3.org/2001/XMLSchema#double"===r?i="double":"http://www.w3.org/2001/XMLSchema#integer"===r?i="integer":"http://www.w3.org/2001/XMLSchema#boolean"===r?i="boolean":"http://www.w3.org/2001/XMLSchema#real"===r?i="double":("http://www.w3.org/2001/XMLSchema#timestamp"===r||"http://www.w3.org/2001/XMLSchema#time"===r)&&(i="date"):e.is(t.type)&&(i=t.type),i},_loadLoggedInUser:function(){let e=this,t=n.getActiveTenant();u.getUser({platformId:t,onComplete:function(t){console.log(t),e._uuid=t.uuid,e._userId=t.id,e._userName='"'+t.firstname+" "+t.lastname+'"',e._loggedInUser="("+t.firstname+" "+t.lastname+")",e._getLoggedInUserPromise.resolve()},onFailure:function(t){console.log(t),e._uuid="Login_Failed",e._getLoggedInUserPromise.reject()}})},_getExcludedPredicates:function(){return this.excludePredSCC||[]},_getPreferredPredicates:function(){return this.prefPredSCC||[]},_loadCusto:function(){var t=this;this.prefPredSCC=[],this.excludePredSCC=[],this.prefTypesSCC=[],this.excludePredTypeMap={};let r=n.getActiveTenant();p.getTenantSettings(r).then((function(){var i=p.getOption("advanced_search",{tenant:r});if(e.is(i)){var n=i["ds6w:type"];e.is(n)&&(Object.keys(n).forEach((function(r){var i=n[r];if(e.is(i,"array"))for(var a=0;a<i.length;a++){var s=i[a];if(!0===s.easyTypeAcess&&t.prefTypesSCC.push(s.uri),e.is(s.uri)){var o=s.predicates;if(e.is(o,"array"))for(let e=0;e<o.length;e++){var u=o[e];u.uri&&t.prefPredSCC.push(u.uri)}var l=s.excluded_predicates;if(e.is(l,"array"))for(let e=0;e<l.length;e++)t.excludePredSCC.push(l[e].uri),t.excludePredTypeMap[s.uri]||(t.excludePredTypeMap[s.uri]=[]),t.excludePredTypeMap[s.uri].push(l[e].uri)}}})),t.prefTypesSCC=t.prefTypesSCC.filter((function(e,t,r){return t===r.indexOf(e)})),t.prefPredSCC=t.prefPredSCC.filter((function(e,t,r){return t===r.indexOf(e)})),t.excludePredSCC=t.excludePredSCC.filter((function(e,t,r){return t===r.indexOf(e)})))}t._loadCustoPromise.resolve()}))}})})),define("DS/SNSmartQuery/Suggesters/KeywordSuggester",["UWA/Core","UWA/Class","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/keywords/SNKeywordManager","DS/SNSmartQuery/SNSmartQueryRules","DS/WebappsUtils/WebappsUtils","DS/SNSmartQuery/utils/StaticDataRepository","i18n!DS/SNSmartQuery/assets/nls/SNSmartQuery.json"],(function(e,t,r,i,n,a,s,o,u){"use strict";return t.singleton({_interfaces:null,_who_keywords:[{displayValue:u.get("SNSmartQuery.keywords.me"),value:"$ME",uri:"keyword:me",category:a.SUGGESTION_CATEGORY.WHO,imageUrl:s.getWebappsBaseUrl()+"TagNavigator/assets/icons/generic_user.png"}],_when_keywords:[{displayValue:u.get("SNSmartQuery.keywords.today"),value:"$TODAY",uri:"keyword:today",category:a.SUGGESTION_CATEGORY.WHEN,imageUrl:s.getWebappsBaseUrl()+"TagNavigator/assets/icons/select-day.png"},{displayValue:u.get("SNSmartQuery.keywords.this_week"),value:"$THIS_WEEK",uri:"keyword:thisweek",category:a.SUGGESTION_CATEGORY.WHEN,imageUrl:s.getWebappsBaseUrl()+"TagNavigator/assets/icons/select-week.png"},{displayValue:u.get("SNSmartQuery.keywords.this_month"),value:"$THIS_MONTH",uri:"keyword:thismonth",category:a.SUGGESTION_CATEGORY.WHEN,imageUrl:s.getWebappsBaseUrl()+"TagNavigator/assets/icons/select-range.png"},{displayValue:u.get("SNSmartQuery.keywords.this_year"),value:"$THIS_YEAR",uri:"keyword:thisyear",category:a.SUGGESTION_CATEGORY.WHEN,imageUrl:s.getWebappsBaseUrl()+"TagNavigator/assets/icons/calendar.png"},{displayValue:u.get("SNSmartQuery.keywords.last_year"),value:"$LAST_YEAR",uri:"keyword:lastyear",category:a.SUGGESTION_CATEGORY.WHEN,imageUrl:s.getWebappsBaseUrl()+"TagNavigator/assets/icons/last-year.png"}],_how_keywords:[{displayValue:u.get("SNSmartQuery.keywords.launch_app"),value:"LAUNCH_APP",category:a.SUGGESTION_CATEGORY.HOW}],init:function(){},getSuggestions:function(t,r){let i=this,n=r.currentPredicate,s=o.getPredicateDataType(n);return new Promise(((t,o)=>{r._inContextHandler&&!1===r._inContextHandler.showKeywords()||!0!==r.rule[a.TokenType.KEYWORD]&&!0!==r.rule[a.TokenType.V_KEYWORD]?t([]):!0===r.rule[a.TokenType.KEYWORD]?t(i._who_keywords.concat(i._when_keywords).concat(i._how_keywords).map((function(e){return e.suggestionType=a.TokenType.KEYWORD,e}))):!0===r.rule[a.TokenType.V_KEYWORD]&&("string"===s||"date"===s?i._getRootWofPredicate(n).then((function(r){e.is(r,"array")&&r.length>0||n.startsWith("ds6wg:")?r[0]&&"ds6w:who"===r[0].lineage?t(i._who_keywords.map((function(e){return e.suggestionType=a.TokenType.V_KEYWORD,e}))):t("date"===s?i._when_keywords.map((function(e){return e.suggestionType=a.TokenType.V_KEYWORD,e})):[]):t(n&&"$BY"==n?i._who_keywords.map((function(e){return e.suggestionType=a.TokenType.V_KEYWORD,e})):[])})):t([]))}))},_getRootWofPredicate:function(e){let t=i.getLanguage(),n=i.getActiveTenant();return new Promise((function(i,a){r.getPropertiesRoots(e,{onComplete:i,onFailure:i,lang:t,tenantId:n})}))}})})),define("DS/SNSmartQuery/Suggesters/CompanyTagSuggester",["UWA/Core","UWA/Class","UWA/Promise","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SNSuggestionHelper","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchSettings","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/utils/StaticDataRepository"],(function(e,t,r,i,n,a,s,o,u,l){"use strict";return t.singleton({init:function(){},getSuggestions:function(e,t){return new Promise(((r,i)=>{t._inContextHandler&&!1===t._inContextHandler.showCompanyTags()?r([]):!0===t.rule[u.TokenType.COMPANY_TAG]&&e&&e.startsWith("#")?a.getEnterpriseConceptsSuggestions("").then((function(e){a.getIcon().then((function(t){let i;e=e.entries,t?n.iconURL_check(t)&&(i=t):t="fonticon-building-office",e=e.map((e=>({displayValue:e.entry,value:e.value,uri:e.value,suggestionType:u.TokenType.COMPANY_TAG,category:u.SUGGESTION_CATEGORY[e.category.toUpperCase()],imageUrl:e.imageUrl?e.imageUrl:void 0,iconClass:e.imageUrl?void 0:t}))),r(e)}))})):r([])}))}})})),define("DS/SNSmartQuery/Suggesters/UnaryOperatorSuggester",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/utils/StaticDataRepository","DS/SNSmartQuery/config/SmartQueryConfig","i18n!DS/SNSmartQuery/assets/nls/SNSmartQuery.json"],(function(e,t,r,i,n,a,s){"use strict";return t.singleton({_relations:null,init:function(){this._relations=a.get("UnaryOperators"),this._relations.forEach(((e,t)=>{e.suggestionType=i.TokenType.U_OPERATOR,e.iconClass=void 0,e.category=i.SUGGESTION_CATEGORY.OPERATOR,e.displayValue=s.get(e.key)}))},getSuggestions:function(e,t){let r=this;return new Promise(((e,n)=>{!0!==t.rule[i.TokenType.U_OPERATOR]?e([]):e(r._relations)}))}})})),define("DS/SNSmartQuery/Suggesters/CommunityTagSuggester",["UWA/Core","UWA/Class","UWA/Promise","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SNSuggestionHelper","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/utils/StaticDataRepository"],(function(e,t,r,i,n,a,s,o,u){"use strict";return t.singleton({init:function(){this.conceptsLoaded=!1},getSuggestions:function(t,i){let a=r.deferred();if(i.community&&!e.is(u._communityContainerUidMap[i.community])){let t=function(t){e.is(t.results,"array")&&t.results.forEach(((e,t)=>{let r,i;e.attributes.forEach(((e,t)=>{"ds6w:containerUid"===e.name&&(r=e.value),"ds6w:where/ds6w:context/ds6w:community"!==e.name&&"ds6w:community"!==e.name||(i=e.value)})),r&&i&&!u._communityContainerUidMap[i]&&(u._communityContainerUidMap[i]=r)})),a.resolve()},r=function(){a.resolve()},n={fedsearchOptions:this._getFedSearchOptions(i),onComplete:t,onFailure:r};u._fedSearch(n)}else a.resolve();return new Promise(((t,r)=>{a.promise.then((function(){!0===i.rule[o.TokenType.COMMUNITY_TAG]&&i.community&&u._communityContainerUidMap[i.community]?require(["DS/TagNavigator/userTags/utils/UserTagsUtils"],(function(r){let a={appName:"3DSearch",currentUser:n.getUserId(),platformId:n.getActiveTenant(),vocabSuggestions:!1,communityTags:!0,existingUserTags:!0,communityId:u._communityContainerUidMap[i.community]};r.getSuggestionsFor3DSwymContent(a).then((function(r){if(UWA.is(r,"object")&&UWA.is(r.suggestions,"array")){let i=r.suggestions.map((t=>{let r=t.sixw.split("/").pop(),i=t.sixw.split("/")[0].substring(5);return{displayValue:e.is(t.dispValue,"array")?t.dispValue.pop():t.dispValue,value:t.isCommunityTag?"["+r+']:"'+t.object_db.replaceAll("_BELCHAR_","//")+'"':"["+r+']:"'+t.object_db+'"',uri:t.object_db,suggestionType:t.isCommunityTag?o.TokenType.COMMUNITY_TAG:o.TokenType.USER_TAG,category:o.SUGGESTION_CATEGORY[i.toUpperCase()],iconClass:"fonticon fonticon-3ds-"+i}}));t(i)}else t([])}),(function(){t([])}))})):t([])}))}))},_getFedSearchOptions:function(e){return{label:"ExpertSearchSuggest-"+n.getUserId()+"-"+(new Date).getTime(),order_by:"desc",order_field:"relevance",query:'[ds6w:community]:"'+e.community+'" NOT [ds6w:type]:"swym:Community"',select_predicate:["ds6w:community","ds6w:containerUid"],nresults:1,source:["swym"],tenant:n.getActiveTenant(),with_nls:!1,with_synthesis:!1}}})})),define("DS/SNSmartQuery/context/ContextManager",["UWA/Core","UWA/Class","DS/SNInfraUX/SearchSettings","DS/SNSmartQuery/SNSmartQueryRules"],(function(e,t,r,i){"use strict";return t.extend({init:function(){this._types=[],this._interfaces=[],this._nls2InternalNameMap=new Map},getContext:function(e,t){var r,i,n,a=void 0;this._types=[];for(var s=0;s<t&&t<=e.length;s++)"PREDICATE"===e[s].type?(a=e[s].uri,n=!!e[s].isClassAttribute):"R_OPERATOR"!==e[s].type&&(a=void 0),this._selectedUnaryOperator="U_OPERATOR.IN"===e[s].uri?"U_OPERATOR.IN":null,r=e[s],"ds6w:where/ds6w:context/ds6w:community"===e[s].uri&&(i=e[s].displayValue);return{types:this._types,interfaces:this._interfaces,currentPredicate:a,currentUnaryOperator:this._selectedUnaryOperator,lastToken:r,isClassAttribute:n,community:i}},addSelectedInterface:function(e){this._interfaces.push(e)},setSelectedUnaryOperator:function(e){this._selectedUnaryOperator=e},resetContext:function(){this._types=[],this._interfaces=[],this._selectedUnaryOperator=null,this._nls2InternalNameMap.clear()},updateContext:function(e){e.type===i.TokenType.INTERFACE?this.addSelectedInterface(e.uri):e.type===i.TokenType.U_OPERATOR?this.setSelectedUnaryOperator(e.uri):this.setSelectedUnaryOperator(null)}})})),define("DS/SNSmartQuery/utils/TypeGroupSuggestHelper",["UWA/Core","UWA/Class","UWA/Promise","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/utils/StaticDataRepository","DS/SNSmartQuery/config/SmartQueryConfig","DS/WebappsUtils/WebappsUtils"],(function(e,t,r,i,n,a,s){"use strict";return t.singleton({init:function(){this.typeCategoryPromise=null,this._category_predicates={}},buildCategories:function(e){let t=this.getCategoryFlatList(e),r=this;t=t.filter((function(e){return!(e.predicate&&e.predicate["ds6w:type"])})),this._buildCategoryPredicateInfo(t),t=t.filter((function(e){let t=0;return Object.keys(r._category_predicates[e.id]).forEach((i=>{t+=r._category_predicates[e.id][i].length})),t<50})),t=t.map((e=>({displayValue:e.label?e.label:e.id,uri:e.id,value:e.id,suggestionType:i.TokenType.TYPE_GROUP,category:i.SUGGESTION_CATEGORY.WHAT,iconClass:e.iconClass,weightage:150,imageUrl:e.imageUrl}))),this.categories=t},getTypeGroupQuery:function(e){let t="",r=this.getPredicatesForCategoryId(e);return r?(Object.keys(r).forEach((e=>{let i="";r[e].forEach((t=>{let r="";r="ds6w:type"===e&&"3dspace"===n._sourceMap["ds6wg:"+t.uri]?'flattenedtaxonomies:"types/'+t.uri+'"':"["+e+']:"'+t.uri+'"',i&&(i+=" OR "),i+=r})),t+=t?" OR ":"",t+=i})),t="("+t+")",t):e},_buildCategoryPredicateInfo:function(t){let r=this;e.is(t,"array")?t.forEach((e=>{this._buildCategoryPredicateInfo(e)})):(this._category_predicates[t.id]=t.predicate?t.predicate:{},t.subCategories.forEach((e=>{r._buildCategoryPredicateInfo(e);let i=r._category_predicates[e.id];Object.keys(i).forEach((i=>{r._category_predicates[t.id][i]||(r._category_predicates[t.id][i]=[]),r._category_predicates[t.id][i]=r._category_predicates[t.id][i].concat(r._category_predicates[e.id][i])}))})))},getCategoryFlatList:function(t){let r=[],i=this;return e.is(t,"array")&&t.forEach((e=>{r.push(e),r=r.concat(i.getCategoryFlatList(e.subCategories))})),r},getPredicatesForCategoryId:function(e){return this._category_predicates[e]},getTypeCategoryPromise:function(){let t=this;return this.typeCategoryPromise||(this.typeCategoryPromise=new r((function(r,i){require(["text!DS/TagNavigator/assets/CriteriaInfo.json","text!DS/TagNavigator/assets/nls/TagNavigator_en.json"],(function(i,n){let a=[];var o=JSON.parse(i),u=JSON.parse(n),l=o.category_resources,c=function(e){let t={},r=e.parent,i=l[r];return r&&i&&(i.imageUrl?t.imageUrl=i.imageUrl:i.iconClass?t.iconClass=i.iconClass:t=c(i)),t};Object.keys(l).forEach(((t,r)=>{let i=l[t];if(i.id=t,i.label=u[t],i.imageUrl=l[t].image,i.imageUrl=i.imageUrl?s.getWebappsBaseUrl()+"TagNavigator/assets/icons/type_icon/"+i.imageUrl:void 0,delete i.image,!e.is(i.imageUrl)&&!e.is(i.iconClass)){let e=c(i);e.imageUrl?i.imageUrl=e.imageUrl:i.iconClass=e.iconClass}i.subCategories=[]})),Object.keys(l).forEach(((t,r)=>{let i=l[t];if(e.is(i.parent)){l[i.parent].subCategories.push(t)}else a.push(t)}));var p=function(e,t){let r={label:t.label,id:t.uri,imageUrl:t.imageUrl,iconClass:t.iconClass,subCategories:[],predicate:{}};return r.predicate[e]=[],r.predicate[e][0]={uri:t.uri},r},d=o.predicate_Mapping;let g=d.active_predicates;for(var f=0;f<g.length;f++)if(d[g[f]]){let t=d[g[f]];Object.keys(t).forEach((r=>{let i={label:void 0,uri:r},n=t[r].category;t[r].image?i.imageUrl=s.getWebappsBaseUrl()+"TagNavigator/assets/icons/type_icon/"+t[r].image:t[r].iconClass?i.iconClass=t[r].iconClass:e.is(n,"string")?l[n].imageUrl?i.imageUrl=l[n].imageUrl:i.iconClass=l[n].iconClass:e.is(n,"array")?n.forEach(((e,t)=>{i[e]=i,l[e].imageUrl?i[e].imageUrl=l[e].imageUrl:i[e].iconClass=l[e].iconClass})):i.iconClass="fonticon-pencil",e.is(n,"string")?l[n].subCategories.push(p(g[f],i)):e.is(n,"array")?n.forEach(((e,t)=>{l[e].subCategories.push(p(g[t],i[e]))})):a.push(p(g[f],i))}))}var h=function(t){return 0===t.subCategories.length||t.subCategories.forEach(((t,r,i)=>{e.is(t,"string")&&(i[r]=h(l[t]))})),t};a.forEach(((t,r,i)=>{e.is(t,"string")&&(i[r]=h(l[t]))})),t.buildCategories(a),r(t.categories)}))}))),this.typeCategoryPromise}})})),define("DS/SNSmartQuery/Suggesters/RelationalOperatorSuggester",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/utils/StaticDataRepository","DS/SNSmartQuery/config/SmartQueryConfig","i18n!DS/SNSmartQuery/assets/nls/SNSmartQuery.json"],(function(e,t,r,i,n,a,s){"use strict";return t.singleton({_relations:null,init:function(){this._relations=a.get("RelationalOperators"),this._relations.forEach(((e,t)=>{e.suggestionType=i.TokenType.R_OPERATOR,e.iconClass="fonticon-math-x-value",e.category=i.SUGGESTION_CATEGORY.OPERATOR})),this._relationsLite=a.get("RelationalOperatorsLite"),this._relationsLite.forEach(((e,t)=>{e.suggestionType=i.TokenType.R_OPERATOR,e.iconClass="fonticon-math-x-value",e.category=i.SUGGESTION_CATEGORY.OPERATOR}))},getOperator:function(t,r){let i=this._relations.filter((function(e){return e.value==r&&e.dataTypes.find((e=>e===t))}));if(i.length>0)return i[0].type=i[0].suggestionType,e.clone(i[0])},getSuggestions:function(t,r){let a=r._nlqMode||r._inContextHandler||!r._liteMode?this._relations:this._relationsLite;return new Promise(((t,o)=>{if(!0!==r.rule[i.TokenType.R_OPERATOR])t([]);else{let i=r.currentPredicate;if("$BY"!=i&&"ABOUT"!=i||t([]),i){let a=r.types.concat(r.interfaces);r.isClassAttribute&&(a=["classifiationAttr"]);for(var u=0;u<a.length;u++){let r=n.getRangeValues(i,a[u]);if(e.is(r,"array")&&r.length>0)return void t([])}}let o=n.getPredicateDataType(i);t(a.filter((function(e){return e.displayValue=e.key&&s.get(e.key)!==e.key?s.get(e.key):e.displayValue,e.dataTypes.find((e=>e===o))})))}}))}})})),define("DS/SNSmartQuery/Suggesters/LogicalOperatorSuggester",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/config/SmartQueryConfig","i18n!DS/SNSmartQuery/assets/nls/SNSmartQuery.json"],(function(e,t,r,i,n,a){"use strict";return t.singleton({_operators:null,init:function(){let e=n.get("LogicalOperators");this._operators=e.map((e=>({displayValue:e.key?a.get(e.key):e.displayValue,value:e.value,suggestionType:"("==e.value?i.TokenType.OPEN_PARENT:")"==e.value?i.TokenType.CLOSE_PARENT:i.TokenType.L_OPERATOR,iconClass:"("==e.value||")"==e.value?void 0:"fonticon-math-x-value",uri:e.value,textToInsert:e.displayValue+" ",category:i.SUGGESTION_CATEGORY.OPERATOR})))},getOperator:function(t){let r=this._operators.filter((function(e){return e.value==t}));if(r.length>0)return r[0].type=r[0].suggestionType,e.clone(r[0])},getSuggestions:function(t,r){let i=this;return new Promise(((t,n)=>{r._nlqMode||r._inContextHandler||!r._liteMode||t([]),e.is(i._operators)?t(i._operators.filter((function(e){return r.rule[e.suggestionType]}))):n(i._operators)}))}})})),define("DS/SNSmartQuery/Suggesters/PredicateSuggester",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","DS/WebappsUtils/WebappsUtils","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SNUnitConversion","DS/SNInfraUX/SNPLMDictionary","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/config/SmartQueryConfig","DS/SNSmartQuery/utils/StaticDataRepository","i18n!DS/SNSmartQuery/assets/nls/SNSmartQuery.json"],(function(e,t,r,i,n,a,s,o,u,l,c,p){"use strict";return t.singleton({init:function(){},getSuggestions:function(t,r){let i=this,a=[],s=r._inContextHandler,o=r.types.length>0,l=r.interfaces.length>0,p=n.getActiveTenant();return new Promise(((t,n)=>{if(!0!==r.rule[u.TokenType.PREDICATE])t([]);else if(l){let n=1===r.types.length?r.types:c.intefaceTypeMap[r.interfaces[0]],o=r.interfaces,u=n.concat(o),l=c.loadRelevantPredicates({className:u,tenantId:p});Promise.all(l).then((function(u){i._buildRangeValues(u);let l=(u=i._manageExcludePredicates(u))[0];u.splice(0,1);let c=u,p=l.vocabularyPredicateInfo,d=i._getCommonPredicates(c);p=s?s.updateTypePredicates(n,p):p,d=s?s.updateExtsPredicates(n[0],o,d):d,a=p.concat(d),a=i._preparePredicates(a),a=i._getPredKeywords(s).concat(a),r._nlqMode||(a=e.clone(a,!0),a=a.filter((function(e){return"ds6w:type"!==e.uri}))),t(a)}))}else if(o){let n=r.types;n.some(((e,t)=>"3dspace"===c._sourceMap[e]));if(n.every(((e,t)=>"3dspace"===c._sourceMap[e]))){let o=c.loadRelevantPredicates({className:n,tenantId:p});Promise.all(o).then((function(o){i._buildRangeValues(o),o=i._manageExcludePredicates(o),a=i._getCommonPredicates(o),a=s?s.updateTypePredicates(n,a):a,a=i._preparePredicates(a),a=i._getPredKeywords(s).concat(a),r._nlqMode||(a=e.clone(a,!0),a=a.filter((function(e){return"ds6w:type"!==e.uri}))),t(a)}))}else c.getPreicatesPormise().then((function(n){n=s?s.getPredicatesInContext(n):c._handleExcludeAndPrefPredicates(n),n=s?n.concat(i._getPredKeywords(s)):i._getPredKeywords(s).concat(n),r._nlqMode||(n=(n=e.clone(n,!0)).filter((function(e){return"ds6w:type"!==e.uri}))),t(n)}))}else c.getPreicatesPormise().then((function(n){n=s?s.getPredicatesInContext(n):c._handleExcludeAndPrefPredicates(n),n=s?n.concat(i._getPredKeywords(s)):i._getPredKeywords(s).concat(n),r._nlqMode||(n=(n=e.clone(n,!0)).filter((function(e){return"ds6w:type"!==e.uri}))),t(n)}))}))},_getPredKeywords:function(e){let t=[];return t=l.get("pred_keywords"),e&&(t=t.filter((function(e){return"$BY"!==e.uri}))),t.forEach((e=>{e.suggestionType=u.TokenType.PREDICATE,e.displayValue=p.get(e.key),e.relativePath&&(e.imageUrl=i.getWebappsBaseUrl()+e.relativePath)})),t},_preparePredicates:function(e){return e=(e=c._handleExcludeAndPrefPredicates(e)).map((e=>{c.setPredicateDataType(e);let t=e.uri.startsWith("ds6wg")?u.SUGGESTION_CATEGORY.DS_SIX_WG:c.rootMap[e.uri];return{displayValue:e.nlsName,value:"["+e.uri+"]",uri:e.uri,suggestionType:u.TokenType.PREDICATE,iconClass:t&&t.startsWith("ds6w:")?"fonticon-3ds-"+t.substring(5):"fonticon-properties-filter",dataType:c.getPredicateDataType(e.uri),category:t,weightage:e.weightage,unitInfo:e.dimension?o._dimensions[e.dimension]:void 0}}))},_buildRangeValues:function(t){t.forEach((t=>{c._rangeValueMap[t.type]||t.vocabularyPredicateInfo.forEach((r=>{r.rangeValues&&e.is(r.rangeValues.literalInfo,"array")&&c.setRangeValues(r.uri,t.type,r.rangeValues.literalInfo)}))}))},_manageExcludePredicates:function(e){let t=[];return e.forEach((e=>{let r={type:e.type,vocabularyPredicateInfo:[]},i=c.excludePredTypeMap[r.type]||[];e.vocabularyPredicateInfo.forEach((e=>{-1===i.indexOf(e.uri)&&r.vocabularyPredicateInfo.push(e)})),t.push(r)})),t},_getCommonPredicates:function(e){let t,r=e[0].vocabularyPredicateInfo;return e.forEach(((e,i)=>{t=e.vocabularyPredicateInfo,r=r.filter((e=>t.some((t=>e.uri===t.uri))))})),r}})})),define("DS/SNSmartQuery/Suggesters/InterfaceSuggester",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","DS/SNInfraUX/SNVocabAccess","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/utils/StaticDataRepository","DS/SNInfraUX/SearchUtils"],(function(e,t,r,i,n,a,s){"use strict";return t.singleton({_interfaces:null,init:function(){},getSuggestions:function(t,r){return new Promise(((t,o)=>{if(!0!==r.rule[n.TokenType.INTERFACE])t([]);else if(1===r.types.length){let o=r.types[0],u=s.getActiveTenant();i.loadRelevantInterfaces({className:o,tenantId:u},(function(i){let s=i.interfaces;s.forEach((e=>{a.intefaceTypeMap[e.name]=o})),s=r._inContextHandler?r._inContextHandler.getInterfacesInContext(o,s):s,r.interfaces&&r.interfaces.length&&!r._nlqMode&&(s=e.clone(s,!0),s=s.filter((function(e){return-1===r.interfaces.indexOf(e.name)}))),t(s.map((e=>({displayValue:e.nlsName,value:'flattenedtaxonomies:"interfaces/'+e.name.replace("ds6wg:","")+'"',suggestionType:n.TokenType.INTERFACE,uri:e.name,textToInsert:"`"+e.nlsName+"` ",iconClass:"fonticon-part-add",category:n.SUGGESTION_CATEGORY.WHAT}))))}))}else t([])}))}})})),define("DS/SNSmartQuery/Suggesters/TypeSuggester",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/SearchSettings","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/utils/StaticDataRepository","DS/SNSmartQuery/utils/TypeGroupSuggestHelper"],(function(e,t,r,i,n,a,s,o,u,l){"use strict";return t.singleton({_types:null,init:function(){},getSuggestions:function(t,r){return new Promise(((t,i)=>{!0!==r.rule[o.TokenType.TYPE]?t([]):u.getTypesPromise().then((function(i){!r._nlqMode&&!r._inContextHandler&&r._liteMode&&r.types&&r.types.length&&t([]),l.getTypeCategoryPromise().then((function(n){s.getOption("groups")&&!e.is(r._inContextHandler)&&(i=n.concat(i)),i=r._inContextHandler?r._inContextHandler.getTypesInContext(i):i,r.interfaces.length>0&&(i=[]),r.types&&r.types.length&&!r._nlqMode&&(i=(i=e.clone(i,!0)).filter((function(e){return-1===r.types.indexOf(e.uri)}))),t(i.map((function(e){return e.category=o.SUGGESTION_CATEGORY.WHAT,e})))}))}),(function(){t([])}))}))}})})),define("DS/SNSmartQuery/Suggesters/ClassificationAttributeSuggester",["UWA/Core","UWA/Class","UWA/Promise","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/utils/StaticDataRepository"],(function(e,t,r,i,n){"use strict";return t.singleton({init:function(){},getSuggestions:function(e,t){let r=this;return new Promise(((e,n)=>{t._inContextHandler&&!1===t._inContextHandler.showClassAttribute()||!0!==t.rule[i.TokenType.PREDICATE]?e([]):r.getClassificationAttributeSuggesterPromise().then((function(t){e(t)}))}))},getClassificationAttributeSuggesterPromise:function(){return n._loadAttributePromise.promise}})})),define("DS/SNSmartQuery/utils/EngineTrackerApi",["UWA/Core","UWA/Class","UWA/Promise","DS/MessageBus/MessageBus","DS/SNSmartQuery/utils/StaticDataRepository"],(function(e,t,r,i,n){"use strict";return t.singleton({init:function(){},predValTracker:function(e,t,r){let a=t.currentUnaryOperator?"string":n.getPredicateDataType(t.currentPredicate);n._getUniqueIdPromise().then((function(n){i.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"Engine",action:"PredValSugg",persDim:{pd1:n,pd2:t.currentUnaryOperator?"IN":t.currentPredicate,pd3:t.types.join(" | "),pd4:a||"-"},persVal:{pv1:r,pv2:t.types.length,pv3:e.length,pv4:Date.now()-t._PredValStartTime}}})}))},SophisticatedFeedbackRating:{GOOD:"GOOD",BAD:"BAD"},SophisticatedFeedbackRatingPV:{GOOD:1,BAD:0},SophisticatedFeedbackKeywords:{FAST:"FAST",ACCURATE:"ACCURATE",RELEVANT:"RELEVANT",SLOW:"SLOW",INACCURATE:"INACCURATE",UNHELPFUL:"UNHELPFUL"},SophisticatedFeedbackKeywordsPV:{FAST:1,ACCURATE:1,RELEVANT:1,SLOW:0,INACCURATE:0,UNHELPFUL:1},feebackTracker:function(t){let r={};t.feedbackRating&&(t.feedbackRating===this.SophisticatedFeedbackRating.GOOD?r.pv1=this.SophisticatedFeedbackRatingPV.GOOD:t.feedbackRating===this.SophisticatedFeedbackRating.BAD&&(r.pv1=this.SophisticatedFeedbackRatingPV.BAD));let a=t.feedbackKeywords;e.is(a,"array")&&(a.indexOf(this.SophisticatedFeedbackKeywords.FAST)>=0?r.pv2=this.SophisticatedFeedbackKeywordsPV.FAST:a.indexOf(this.SophisticatedFeedbackKeywords.SLOW)>=0&&(r.pv2=this.SophisticatedFeedbackKeywordsPV.SLOW),a.indexOf(this.SophisticatedFeedbackKeywords.ACCURATE)>=0?r.pv3=this.SophisticatedFeedbackKeywordsPV.ACCURATE:a.indexOf(this.SophisticatedFeedbackKeywords.INACCURATE)>=0&&(r.pv3=this.SophisticatedFeedbackKeywordsPV.INACCURATE),a.indexOf(this.SophisticatedFeedbackKeywords.RELEVANT)>=0&&(r.pv4=this.SophisticatedFeedbackKeywordsPV.RELEVANT),a.indexOf(this.SophisticatedFeedbackKeywords.UNHELPFUL)>=0&&(r.pv5=this.SophisticatedFeedbackKeywordsPV.UNHELPFUL)),n._getUniqueIdPromise().then((function(e){i.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"sophisticatedFeedback",action:"nlqFeedback",persDim:{pd1:e,pd2:t.feedbackComments},persVal:r}})}))}})})),define("DS/SNSmartQuery/utils/CustomPredicateSuggestHelper",["UWA/Core","UWA/Class","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/utils/StaticDataRepository","DS/SNSmartQuery/config/SmartQueryConfig"],(function(e,t,r,i,n){"use strict";return t.singleton({predicate_suggests:null,init:function(e){let t=this;this.predicate_suggests=n.get("CustomPredicatesSuggests"),Object.keys(this.predicate_suggests).forEach((e=>{t.predicate_suggests[e].forEach((e=>{e.suggestionType=r.TokenType.PREDICATE_VALUE}))})),this._parent(e)},getPredicateSuggests:function(e){return this.predicate_suggests[e].map((function(t){return t.dataType=e,t}))}})})),define("DS/SNSmartQuery/Suggesters/PredicateValueSuggester",["UWA/Core","UWA/Class","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SearchUtils","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WAFData/WAFData","UWA/Promise","DS/SNInfraUX/SearchLogin","DS/SNSmartQuery/utils/CustomPredicateSuggestHelper","DS/SNSmartQuery/config/SmartQueryConfig","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/utils/StaticDataRepository","DS/SNSmartQuery/utils/EngineTrackerApi","DS/SNInfraUX/PlatformEnvServices","DS/SNInfraUX/utils/SearchNlsUtils","DS/SNInfraUX/keywords/SNKeywordManager"],(function(e,t,r,i,n,a,s,o,u,l,c,p,d,g,f,h){"use strict";return t.singleton({_interfaces:null,init:function(){this.imageUrlPromiseMap=new Map},getSuggestions:function(t,r){let i=this,n=r.currentPredicate,a=r.currentUnaryOperator,s=p.getPredicateDataType(n),o=l.get("userSuggest"),u=r.types.concat(r.interfaces);return new Promise(((l,g)=>{if(!0!==r.rule[c.TokenType.PREDICATE_VALUE]||n&&"ds6w:who"==p.rootMap[n]&&o.indexOf(n)>=0)return void l([]);r._PredValStartTime=Date.now(),r.isClassAttribute&&(u=["classifiationAttr"]);var f=[];if(r.currentPredicate){for(var h=0;h<u.length;h++){let t=p.getRangeValues(r.currentPredicate,u[h]);e.is(t,"array")&&(f=f.concat(t))}f.sort(((e,t)=>e.nlsValue.localeCompare(t.nlsValue)));for(h=1;h<f.length;)f[h].nlsValue===f[h-1].nlsValue?f.splice(h,1):h++}if("ds6w:type"===n)return void p.getTypesPromise().then((function(e){l(e.map((e=>{let t={};return e.imageUrl?t.imageUrl=e.imageUrl:e.iconClass&&(t.iconClass=e.iconClass),"fonticon-3d-object"===t.iconClass&&(t.iconClass="fonticon-tag-alt"),t.uri=e.uri,t.displayValue=e.displayValue,t.value=e.value,t.weightage=e.weightage,t.category=c.SUGGESTION_CATEGORY.WHAT,t.suggestionType=c.TokenType.PREDICATE_VALUE,t})))}));let y=[];if(f&&f.length)return f.forEach(((e,t)=>{var i={};i.displayValue=e.nlsValue,i.value=e.value,i.uri=e.value,i.suggestionType=c.TokenType.PREDICATE_VALUE,i.category=r.currentPredicate.startsWith("ds6wg:")?c.SUGGESTION_CATEGORY.DS_SIX_WG:p.rootMap[r.currentPredicate],i.textToInsert="`"+e.nlsValue+"` ",i.iconClass="fonticon-tag-alt",y.push(i)})),d.predValTracker(t,r,y.length),void l(y);if("string"===s||a)i._getSuggestions(t,r).then((function(e){d.predValTracker(t,r,e.length),l(e)}));else{let e=i._getCustomSuggestsForDataType(s);if(e){e.forEach(((e,t)=>{e.category=p.rootMap[n]}));let i=r.lastToken,a=e.filter((function(e){return"custPredVal:range"===e.uri?"PREDICATE"===i.type||"operator:between"===i.uri:"custPredVal:datepicker"!==e.uri||(/operator\:(after|before|on)/.test(i.uri)||"PREDICATE"===i.type)}));d.predValTracker(t,r,a.length),l(a)}else d.predValTracker(t,r,0),l(y)}}))},_getCustomSuggestsForDataType:function(e){return u.getPredicateSuggests(e)},_getSuggestions:function(t,r){let n=this;return new Promise(((a,o)=>{let u=[];if(t&&t.startsWith("@")||"ABOUT"===r.currentPredicate)return void a([]);var l={fedsearchOptions:n._getFedSearchOptions(t,r),onComplete:function(t){e.is(t.results,"array")&&t.results.forEach(((e,t)=>{let r,i;e.attributes.forEach(((e,t)=>{"ds6w:containerUid"===e.name&&(r=e.value),"ds6w:where/ds6w:context/ds6w:community"===e.name&&(i=e.value)})),r&&i&&!p._communityContainerUidMap[i]&&(p._communityContainerUidMap[i]=r)}));let o=[];if(e.is(t.facets,"array")){let y=n._getInPredicates(r);y.indexOf("ds6w:community")>-1&&y.indexOf("ds6w:containerUid")>-1&&(y=y.filter((function(e){return"ds6w:containerUid"!==e})));var l=[];t.facets.forEach(((e,t)=>{y.indexOf(e.sixw.split("/").pop())>=0&&l.push(e)}));var d={facets:l,tenantId:i.getActiveTenant(),onComplete:function(){y.indexOf("ds6w:policy")>-1&&y.indexOf("ds6w:status")>-1&&(l=l.filter((function(e){return"ds6w:status"===e.sixw.split("/").pop()}))),l.forEach((t=>{let r={displayValue:e.is(t.dispValue,"string")?t.dispValue:e.is(t.dispValue,"array")?t.dispValue.pop():t.object,value:'"'+t.object+'"',suggestionType:c.TokenType.PREDICATE_VALUE,uri:t.sixw,category:t.sixw.split("/").pop().startsWith("ds6wg")?c.SUGGESTION_CATEGORY.DS_SIX_WG:p.rootMap[t.sixw.split("/").pop()],textToInsert:"`"+t.object+"` "};if("ds6w:who/ds6w:responsible"===t.sixw||h.getByPredicates().indexOf(t.sixw.split("/").pop())>=0){let e;n.imageUrlPromiseMap.get(t.object)?e=n.imageUrlPromiseMap.get(t.object):(e=s.deferred(),n.imageUrlPromiseMap.set(t.object,e),o.push(t.object)),r.imageUrlPromise=e.promise,r.category=c.SUGGESTION_CATEGORY.WHO}else"ds6w:where/ds6w:context/ds6w:community"===t.sixw?r.iconClass="fonticon-users-alt":r.iconClass="fonticon-tag-alt";u.push(r)})),u.sort(((e,t)=>e.displayValue.localeCompare(t.displayValue)));for(var t=1;t<u.length;)u[t].displayValue===u[t-1].displayValue?u.splice(t,1):t++;if(o.length){require(["DS/TagNavigator/TagsServer","DS/SNInfraUX/SearchUtils"],(function(t,r){if(!n._tagsServer){let e=r.getActiveTenant(),i=g.getServiceURL("cstorage",e);n._tagsServer=new t(i,e,e)}let i=function(t){e.is(t,"array")&&t.forEach((function(e,t){let r,i;e.attributes.forEach((function(e){if("ds6w:label"===e.name){let t=e.value;i=n.imageUrlPromiseMap.get(t)}"preview_url"===e.name&&(r=e.value)})),i&&i.resolve(r)}))};n._tagsServer.getUsersInfo(r.getUserId(),o,(function(e){e.forEach((function(e){e.then(i)}))}),(function(){Logger.log("SmartQueryController::_buildWhosuggestions onFailure")}))}))}a(u)},onFailure:function(){a([])}};f.translateFacets(d)}else a([])},onFailure:function(){a([])}};p._fedSearch(l)}))},_getFedSearchOptions:function(t,r){r.currentPredicate;let n=i.getActiveTenant(),a=this._getInSources(r),s=a.includes("swym"),o=r.types,u="";if(e.is(o,"array")&&o.length>0&&(u=o[0].indexOf("ds6wg:")>=0?'(flattenedtaxonomies:"types/'+o[0].replace("ds6wg:","")+'"':'([ds6w:type]:"'+o[0]+'"',o.forEach(((e,t)=>{t>0&&(e[0].indexOf("ds6wg:")>=0?u+=' OR flattenedtaxonomies:"types/'+e.replace("ds6wg:","")+'"':u+=" OR [ds6w:type]:"+e)})),u+=")"),r.currentUnaryOperator&&t.length>2){let e=this._getInQuery(r,t);e&&(u+=(u?" AND ":"")+e)}if("$BY"===r.currentPredicate){let e=t[0]!==t[t.length-1]||'"'!=t[0]&&"'"!=t[0]&&"*"!=t[0]?"*":"";t=e+t+e,u+=(u?" AND ":"")+h.getKeywordQuery("BY"),u=u.replaceAll("{USER_NAME}",t)}if(!u)return;let l={label:"ExpertSearchSuggest-"+i.getUserId()+"-"+(new Date).getTime(),order_by:"desc",order_field:"relevance",query:u,select_predicate:this._getInPredicates(r),nresults:100,source:a,tenant:n,with_nls:!1};return s||(l.select_synthesis=this._getInPredicates(r)),l},_getAvailableSources:function(){let e=i.getActiveTenant(),t=o.getAvailableSources(e);return t=t.map((e=>e.name)),t},_getInSources:function(t){let r=[],i=this._getAvailableSources();if(t.currentPredicate)p._typesLoaded?(t.types.forEach(((e,t)=>{r.push(p._sourceMap[e])})),r=r.filter((function(e,t,r){return t===r.indexOf(e)}))):r=i;else{if("U_OPERATOR.IN"===t.currentUnaryOperator){let t=l.get("operator_in_suggest_predicates");e.is(t,"array")&&t.forEach((e=>{e.predicate&&e.source&&i.includes(e.source)&&r.push(e.source)}))}}return 0===r.length&&(r=i),r},_getInPredicates:function(t){let r=[],i=t.currentUnaryOperator;if(i){if("U_OPERATOR.IN"===i){let t=this._getAvailableSources(),i=l.get("operator_in_suggest_predicates");e.is(i,"array")&&i.forEach((e=>{e.predicate&&e.source&&t.includes(e.source)&&r.push(e.predicate)}))}}else"$BY"===t.currentPredicate?r=h.getByPredicates():r.push(t.currentPredicate);return r.indexOf("ds6w:status")>-1&&r.push("ds6w:policy"),r.indexOf("ds6w:community")>-1&&r.push("ds6w:containerUid"),r},_getInQuery:function(e,t){let r="";return this._getInPredicates(e).forEach(((e,i)=>{r+=(r?" OR ":"")+"["+e+"]: *"+t+"*"})),r.length>1&&(r="("+r+")"),r},_getRootWofPredicate:function(e){let t=i.getLanguage(),n=i.getActiveTenant();return new Promise((function(i,a){r.getPropertiesRoots(e,{onComplete:i,onFailure:i,lang:t,tenantId:n})}))}})})),define("DS/SNSmartQuery/Suggester",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","DS/SNSmartQuery/config/SmartQueryConfig","DS/SNSmartQuery/context/ContextManager","DS/SNInfraUX/utils/RankingEngine","i18n!DS/SNSmartQuery/assets/nls/SNSmartQuery.json"],(function(e,t,r,i,n,a,s){"use strict";var o=t.extend({init:function(){},getSuggestions:function(t,n){let o=this;n||(n="");let u=this.getProviders();return new Promise(((l,c)=>{if(e.is(u,"array")&&u.length>0){let c=[];require(u,(function(){for(let e=0;e<arguments.length;e++)c.push(arguments[e].getSuggestions(n,t));Promise.all(c).then((function(){let u=[];for(let e=0;e<arguments[0].length;e++)u=u.concat(arguments[0][e]);let c=u.map((function(e){return{displayValue:e.displayValue,value:e.value,type:e.suggestionType,uri:e.uri,imageUrl:e.imageUrl,iconClass:e.iconClass,imageUrlPromise:e.imageUrlPromise,category:e.category,trigram:e.trigram,dataTypes:e.dataType,weightage:e.weightage,unitInfo:e.unitInfo,isClassAttribute:e.classAttribute,matchType:e.matchType,isAtSuggest:e.isAtSuggest}}),o);r.debug("suggestList: ",c),c.forEach(((e,r)=>{if(e.uri&&i.get("synonym")[e.uri]&&(!t._liteMode||t._nlqMode||t._inContextHandler)){e.displayValue=[e.displayValue],i.get("synonym")[e.uri].forEach((t=>{let r=t;s.get("SNSmartQuery.synonym."+t)!=="SNSmartQuery.synonym."+t&&(r=s.get("SNSmartQuery.synonym."+t)),e.displayValue.push(r)}))}}));let p=c.filter((function(e){return e.isAtSuggest}));u=c.filter((function(e){return!e.isAtSuggest}));let d=Date.now(),g=a.getMatchResults(n,u,"displayValue");if(p.length){n&&n.startsWith("@")&&(n=n.substring(1));let e=a.getMatchResults(n,p,"trigram");p=p.filter((function(e){return e.matchType&&"exact"===e.matchType.matchType?e.highLight=e.displayValue:e.highLight=void 0,0==n.length&&(e.matchType="exact"),!e.matchType}));let t=a.getMatchResults(n,p,"displayValue");p=e.concat(t),p.length&&(g=p.concat(g))}if(0==n.length&&t.currentPredicate){let e=[],t=g.filter((function(t){if("KEYWORD"==t.type||"VALUE_KEYWORD"==t.type)return t.matchType="exact",!0;e.push(t)}));g=t.concat(e)}r.debug(Date.now()-d,"ranking engine - time(ms) taken for",n.length+"chars"),g.forEach(((t,r)=>{e.is(t.displayValue,"array")&&(t.bestMatch?(t.onSelectUpdateTo=t.bestMatch,delete t.bestMatch):t.onSelectUpdateTo=t.displayValue[0],t.displayValue=t.displayValue.join(" | "))})),g.forEach(((t,r)=>{if(t.unitInfo&&t.unitInfo.MKSUnit&&e.is(t.unitInfo.Units,"array")){let e,r=t.unitInfo.MKSUnit;t.unitInfo.Units.forEach((t=>{r==t.Name&&(e=t.NLSName)})),e&&(t.displayValue+=" ["+e+"]")}}));let f=[],h=[];if(!t._inContextHandler){for(var y=0;y<g.length;)g[y].weightage&&g[y].weightage>=110?(f.push(g[y]),g.splice(y,1)):g[y].weightage&&g[y].weightage>100?(h.push(g[y]),g.splice(y,1)):y++;f.sort(((e,t)=>t.weightage-e.weightage)),h.sort(((e,t)=>t.weightage-e.weightage))}g=f.concat(h.concat(g));let S=g.filter((function(e){return"exact"===e.matchType})),_=g.filter((function(e){return"simple"===e.matchType})),m=g.filter((function(e){return"extended"===e.matchType})),T=g.filter((function(e){return"lazy"===e.matchType})),P=g.filter((function(e){return!e.matchType}));g=S.concat(_,m,T,P),o.reorder(g),g=g.map((function(e){return{displayValue:e.displayValue,value:e.value,type:e.type,uri:e.uri,imageUrl:e.imageUrl,iconClass:e.iconClass,imageUrlPromise:e.imageUrlPromise,category:e.category,dataTypes:e.dataTypes,isClassAttribute:e.isClassAttribute}})),l(g)}))}))}else l([])}))},getProviders:function(){return i.get("SuggestionProviders")},reorder:function(e){var t=i.get("Reorder"),r=new Map;t.forEach(((e,t)=>{e.forEach(((e,i)=>{r.set(e,[t,i])}))}));for(var n=[],a=0;a<e.length;a++){var s=r.get(e[a].uri);s&&(n[s[0]]=n[s[0]]?n[s[0]]:[],n[s[0]][s[1]]=a)}n=n.filter((function(e){return void 0!==e}));for(a=0;a<n.length;a++){n[a]=n[a].filter((function(e){return void 0!==e}));for(var o=[],u=0;u<n[a].length;u++)o.push(e[n[a][u]]);n[a].sort(((e,t)=>e-t));for(u=0;u<n[a].length;u++)e[n[a][u]]=o[u]}}});return o})),define("DS/SNSmartQuery/Suggesters/AtSuggester",["UWA/Core","UWA/Class","DS/WebappsUtils/WebappsUtils","DS/SNInfraUX/SearchUtils","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/config/SmartQueryConfig","DS/SNSmartQuery/Suggesters/PredicateValueSuggester","DS/SNSmartQuery/utils/StaticDataRepository"],(function(e,t,r,i,n,a,s,o){"use strict";return t.singleton({init:function(){},getSuggestions:function(t,s){let u=a.get("userSuggest");return new Promise(((a,l)=>{if(!0===s.rule[n.TokenType.USER_TEXT]&&t.startsWith("@")||!0===s.rule[n.TokenType.PREDICATE_VALUE]&&"ds6w:who"==o.rootMap[s.currentPredicate]&&u.indexOf(s.currentPredicate)>=0){t.startsWith("@")&&(t=t.substring(1));let u=[];var c={onComplete:function(t){e.is(t.results,"array")?(t.results.forEach(((e,t)=>{var i={};e.attributes.forEach(((e,t)=>{"attribute"===e.format&&"ds6w:label"===e.name&&(i.displayValue=e.value),"internal"===e.format&&"preview_url"===e.name&&(i.imageUrl=e.value),"internal"===e.format&&"resourceid"===e.name&&e.value.startsWith("iam:")&&(i.trigram=e.value.substring(4))})),i.imageUrl||(i.imageUrl=r.getWebappsBaseUrl()+"TagNavigator/assets/icons/generic_user.png"),i.displayValue&&(i.value='"'+i.displayValue+'"',i.uri=i.displayValue,i.suggestionType=!0===s.rule[n.TokenType.PREDICATE_VALUE]?n.TokenType.PREDICATE_VALUE:n.TokenType.USER_TEXT,i.category=n.SUGGESTION_CATEGORY.WHO,i.textToInsert="`"+i.displayValue+"` ",i.isAtSuggest=!0,u.push(i))})),a(u)):a([])},onFailure:function(e){a([])},fedsearchOptions:{label:"ExpertSearchSuggest-"+i.getUserId()+"-"+(new Date).getTime(),tenant:i.getActiveTenant(),query:'[ds6w:type]:"pno:Person"',source:["swym"],nresults:20,specific_source_parameter:{swym:{additional_query:" AND personOrGroup:("+t+")",agoraMode:!0}},with_synthesis:!1,select_predicate:["ds6w:label","ds6w:type"],with_synthesis_attribute:!1,start:0}};o._fedSearch(c)}else a([])}))}})})),define("DS/SNSmartQuery/SNSmartQueryTree",["UWA/Core","UWA/Class","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/config/SmartQueryConfig","DS/SNSmartQuery/Suggesters/RelationalOperatorSuggester","DS/SNSmartQuery/Suggesters/LogicalOperatorSuggester"],(function(e,t,r,i,n,a){"use strict";const s="TNODETYPE_PARENTHESIS",o="TNODETYPE_TYPES",u="TNODETYPE_PV";function l(){}function c(){}function p(){}function d(e,t){this.type=s,this.operands=[],e.operand&&(this.operands.push(e.operand),e.operand.link=this),this.op=e.op,this.op&&(this.op.link=this),this.cp=e.cp,this.cp&&(this.cp.link=this),this.max_idx=t}function g(){}function f(e,t){this.type=o,this.types=e,this.max_idx=t;let r=this;e.forEach(((e,t)=>{e.link=r}))}function h(e,t,r,i){this.type=u,this.p=e,this.o=t,this.v=r,e&&(e.link=this),t&&(t.link=this),r&&(r.link=this),this.max_idx=this.max_idx}function y(e){this.uri=e}const S="AND",_="OR";function m(e){this.theQuery=e,this.itr=0}function T(){this._stack=[]}m.prototype.pos=function(){return this.itr},m.prototype.peek=function(){return this.theQuery._query[this.itr]},m.prototype.next=function(){return this.theQuery._query[this.itr++]},m.prototype.hasNext=function(){return this.itr<this.theQuery._query.length},T.prototype.isEmpty=function(){return 0===this._stack.length},T.prototype.top=function(){return this._stack[this._stack.length-1]},T.prototype.push=function(e){this._stack.push(e)},T.prototype.pop=function(e){return this._stack.pop(e)};var P=t.extend({_theQuery:null,init:function(){this.operands=new T,this.operators=new T},destroy:function(){},_getTnode:function(e,t,r){let i;return i=e.uri===S?new p:"XOR"===e.uri?new c:e.uri===_?new l:new g,i.operator=e,e.link=i,i.operands=t||[],i.operands.forEach((e=>{e&&(e.link=i)})),i.type="",i.link=r,i},_getTypesnode:function(e,t){return new f(e,t)},_getPVnode:function(e){let t,i,n,a=e.peek();return a.type===r.TokenType.PREDICATE&&(t=e.next(),a=e.peek()),!a||a.type!==r.TokenType.R_OPERATOR&&a.type!==r.TokenType.U_OPERATOR||(i=e.next(),a=e.peek()),a&&[r.TokenType.KEYWORD,r.TokenType.USER_TEXT,r.TokenType.PREDICATE_VALUE,r.TokenType.V_KEYWORD,r.TokenType.COMPANY_TAG,r.TokenType.COMMUNITY_TAG,r.TokenType.USER_TAG].includes(a.type)&&(n=e.next()),new h(t,i,n,e.pos())},_getParenthesisNode:function(e,t){return new d(e,t)},_manageLop:function(e){let t=this.operators;t.isEmpty()||this._precedence(t.top().uri)<=this._precedence(e.uri)?t.push(e):this._precedence(t.top().uri)>this._precedence(e.uri)&&(this._merge(e),t.push(e))},_getDefaultLopNode:function(){return new y(i.get("defaultOperator").L_OPERATOR)},buildTree:function(e){this._theQuery=e;let t=this._getQueryIterator(e);return this._buildTree(e,t)},_buildTree:function(e,t,i){let n=!0;for(;t.hasNext();){let a=t.peek(),o=r.getUqlRule(e,t.pos());if(o[a.type]||o[r.TokenType.L_OPERATOR]&&this._manageLop(this._getDefaultLopNode()),a.type==r.TokenType.TYPE||a.type==r.TokenType.INTERFACE||a.type==r.TokenType.TYPE_GROUP){a=t.next();let e=[a];for(a=t.peek();a&&(a.type==r.TokenType.TYPE||a.type==r.TokenType.INTERFACE||a.type==r.TokenType.TYPE_GROUP);)e.push(t.next()),a=t.peek();let i=this._getTypesnode(e,t.pos());this.operands.push(i)}else if(a.type===r.TokenType.L_OPERATOR){if(a=t.next(),!n&&this._isUnaryLop(a)&&this._manageLop(this._getDefaultLopNode()),this._manageLop(a),a=t.peek(),!a||a.type===r.TokenType.CLOSE_PARENT){let e=this.operators.pop(),t=this.operators.pop();if(e&&t&&this._precedence(e.uri)>this._precedence(t.uri)){let r=this._getTnode(e,[this.operands.pop(),void 0]);this.operands.push(r),this.operators.push(t)}else t&&this.operators.push(t),e&&this.operators.push(e)}}else if(a.type===r.TokenType.OPEN_PARENT){let r=t.next(),i=(new P)._buildTree(e,t,!0);i&&i.type===s&&!i.op?i.op=r:i=this._getParenthesisNode({op:r,operand:i}),this.operands.push(i)}else if(a.type===r.TokenType.CLOSE_PARENT){this._merge();let e,r=this.operands.pop();if(e=r?this._getParenthesisNode({op:this.operators.pop(),cp:t.next(),operand:r},t.pos()):this._getParenthesisNode({cp:t.next()},t.pos()),i)return e;this.operands.push(e)}else{let e=this._getPVnode(t);this.operands.push(e)}n&&(n=!1)}return this._merge(),this.operands.pop()},_merge:function(e){let t=this.operands,r=this.operators;if(e)for(;!r.isEmpty()&&this._precedence(r.top().uri)>this._precedence(e.uri);){let e=r.pop(),i=t.pop();if(this._isUnaryLop(e))if(i){let r=this._getTnode(e,[i]);t.push(r)}else{let r=this._getTnode(e,[]);t.push(r)}else{let r=t.pop();if(r&&i){let n=this._getTnode(e,[r,i]);t.push(n)}else if(i){let r=this._getTnode(e,[i]);t.push(r)}else{let r=this._getTnode(e,[]);t.push(r)}}}else{for(;!t.isEmpty()&&!r.isEmpty();){let e=r.pop(),i=t.pop();if(this._isUnaryLop(e))if(i){let r=this._getTnode(e,[i]);t.push(r)}else{let r=this._getTnode(e,[]);t.push(r)}else{let r=t.pop();if(r&&i){let n=this._getTnode(e,[r,i]);t.push(n)}else if(i){let r=this._getTnode(e,[i]);t.push(r)}else{let r=this._getTnode(e,[]);t.push(r)}}}for(;!r.isEmpty();){let e=r.pop(),i=t.pop(),n=this._getTnode(e,[i]);t.push(n)}}},_isUnaryLop:function(e){return e&&"NOT"===e.uri},_precedence:function(e){let t;switch(e){case")":case r.TokenType.CLOSE_PARENT:t=4;break;case"NOT":t=3;break;case"XOR":case S:t=2;break;case _:t=1;break;case"(":case r.TokenType.OPEN_PARENT:t=0}return t},_getQueryIterator:function(e){return new m(e)},_getContextTypes:function(e){let t=[];return e.types?t=t.concat(e.types):e.operands&&e.operands.forEach(((e,r)=>{if(e)if(e.operands){let r=this._getContextTypes(e);t=t.concat(r)}else e.types&&(t=t.concat(e.types))})),t},getContextTypes:function(e,t){let r=[],i=(this.buildTree(e),e.getAt(t-1));if(i&&i.link){let e=i.link,t=e;for(;e.link;)e=e.link,e.operator&&e.operator.uri==S&&(t=e);t&&(t.operator&&t.operator.uri===S||t.types)&&(r=this._getContextTypes(t))}return this._unlinkTree(e),r},_findPostOpen:function(e){if(e){if(e.op)return e.op;if(e.operands&&e.operands[0]&&e.operands[1])return this._findPostOpen(e.operands[0]);if(e.operands&&e.operands[0]){let t=e.operator,r=this._findPostOpen(e.operands[0]);return t&&this._theQuery._find(t)<this._theQuery._find(r)?t:r}if(e.operator)return e.operator;if(e.cp)return e.cp;if(e.types)return e.types[0];if(e.type==u)return e.p||e.o||e.v}},_findPreClose:function(e){if(e){if(e.cp)return e.cp;if(e.operands&&e.operands[0]&&e.operands[1])return this._findPreClose(e.operands[1]);if(e.operands&&e.operands[0]){let t=e.operator,r=this._findPreClose(e.operands[0]);return t&&this._theQuery._find(t)>this._theQuery._find(r)?t:r}if(e.operator)return e.operator;if(e.op)return e.op;if(e.types)return e.types[e.types.length-1];if(e.type==u)return e.v||e.o||e.p}},_addPreOpen:function(e){e.pre_open=e.pre_open?e.pre_open+1:1},_addPostClose:function(e){e.post_close=e.post_close?e.post_close+1:1},_addParenthesis:function(e){let t=this;if(e){if(e.operands&&e.operands.forEach(((e,r)=>{t._addParenthesis(e)})),e.operands&&e.operator&&e.operator.uri==S){let r=e.link;if(r&&r.operator&&r.operator.uri===_){let r=t._findPostOpen(e);t._addPreOpen(r),r=t._findPreClose(e),t._addPostClose(r)}}if(e.type===s)if(e.op){if(!e.cp){let r=t._findPreClose(e);t._addPostClose(r)}}else{let r=t._findPostOpen(e);t._addPreOpen(r)}}},_getClosingPToken:function(){return{value:")",displayValue:")",uri:")",type:r.TokenType.CLOSE_PARENT,automatic:!0}},_getOpenPToken:function(){return{value:"(",displayValue:"(",uri:"(",type:r.TokenType.OPEN_PARENT,automatic:!0}},_checkParenthesisAddition:function(e){let t=!1;for(let r=e._query.length-1;r>=0;r--){let i=e._query[r];if(i.post_close){for(;i.post_close>0;)e._query.splice(r+1,0,this._getClosingPToken()),i.post_close--;delete i.post_close,t=!0}if(i.pre_open){for(;i.pre_open>0;)e._query.splice(r,0,this._getOpenPToken()),i.pre_open--;t=!0,delete i.pre_open}}return t},addParenthesis:function(e){let t=this.buildTree(e);this._addParenthesis(t);let r=this._checkParenthesisAddition(e);return this._unlinkTree(e),r},linkTree:function(e){return this.buildTree(e)},_unlinkTree:function(e){let t=this._getQueryIterator(e);for(;t.hasNext();){let e=t.next();e.link&&delete e.link}},check:function(e){let t=this.buildTree(e),r=this._check(t);return this._unlinkTree(e),r},_check:function(t){return!!t&&(t.type===u?t.p?e.is(t.v):t.o?t.o.type==r.TokenType.U_OPERATOR&&e.is(t.v):e.is(t.v):t.type===o?t.types.length>0:t.type===s?e.is(t.op)&&e.is(t.cp)&&this._check(t.operands[0]):e.is(t.operator)&&this._check(t.operands[0])&&(this._isUnaryLop(t.operator)||this._check(t.operands[1])))},_getQueryStringFromTree:function(e){let t="";return e&&(e.type===u?(e.p&&(t+=e.p.value),e.o&&(t+=(t?" ":"")+e.o.value),e.v&&(t+=(t?" ":"")+e.v.value)):e.type===o?t=e.types.reduce((function(e,t){return e+(e?" OR ":"")+t.value}),""):e.type===s?(e.op&&(t=e.op.value+""),e.operands[0]&&(t+=this._getQueryStringFromTree(e.operands[0])),e.cp&&(t+=e.cp.value)):this._isUnaryLop(e.operator)?(t+=e.operator.uri?e.operator.uri:"",t+=t?" ":"",t+=this._getQueryStringFromTree(e.operands[0])):(t+=this._getQueryStringFromTree(e.operands[0]),t+=t?" ":"",t+=e.operator.uri?e.operator.uri:"",t+=t?" ":"",t+=this._getQueryStringFromTree(e.operands[1]))),t},getQueryStringFromTree:function(e){let t=this.buildTree(e),r=this._getQueryStringFromTree(t);return this._unlinkTree(e),r},_getQuerybricksWithImplicitLop:function(e){let t=[];return e&&(e.type===u?(e.p&&t.push(e.p),e.o&&t.push(e.o),e.v&&t.push(e.v)):e.type===o?e.types.forEach((function(e){t.push(e)})):e.type===s?(e.op&&t.push(e.op),e.operands[0]&&(t=t.concat(this._getQuerybricksWithImplicitLop(e.operands[0]))),e.cp&&t.push(e.cp)):this._isUnaryLop(e.operator)?(t.push(e.operator),t=t.concat(this._getQuerybricksWithImplicitLop(e.operands[0]))):(t=t.concat(this._getQuerybricksWithImplicitLop(e.operands[0])),t.push(e.operator),t=t.concat(this._getQuerybricksWithImplicitLop(e.operands[1])))),t},getQuerybricksWithImplicitOperators:function(e){let t=this.buildTree(e),r=this._getQuerybricksWithImplicitLop(t);return this._unlinkTree(e),r},_getLastBrick:function(e){if(e)if(e.type===u){if(e.v)return e.v;if(e.o)return e.o;if(e.p)return e.p}else{if(e.type===o)return e.types[e.types.length-1];if(e.type===s){if(e.cp)return e.cp;if(e.operands[0])return this._getLastBrick(e.operands[0]);if(e.op)return e.op}else{if(e.operands[1])return this._getLastBrick(e.operands[1]);if(e.operator&&!e.operator instanceof y)return e.operator;if(e.operands[0])return this._getLastBrick(e.operands[0])}}},_addImplicitOpFlag:function(e){if(e)if(e.type===u)e.p&&e.v&&!e.o&&(e.p._irop_=!0);else if(e.type===o);else if(e.type===s)this._addImplicitOpFlag(e.operands[0]);else if(this._addImplicitOpFlag(e.operands[0]),this._addImplicitOpFlag(e.operands[1]),e.operands.length>1&&e.operator instanceof y){let t=this._getLastBrick(e.operands[0]);t&&(t._ilop_=!0)}},_getDefaultLopToken:function(){let e=i.get("defaultOperator").L_OPERATOR,t=a.getOperator(e);return t.automatic=!0,t},_getDefaultRopToken:function(e){let t=i.get("defaultOperator").R_OPERATOR[e],r=n.getOperator(e,t);return r&&(r.automatic=!0),r},addImplicitOperators:function(e){let t=this.buildTree(e);this._addImplicitOpFlag(t);let r=!1;for(let t=e._query.length-1;t>=0;t--){let i=e._query[t];if(i._ilop_){let n=this._getDefaultLopToken();n&&e._query.splice(t+1,0,n),delete i._ilop_,r=!0}if(i._irop_){let n=this._getDefaultRopToken(i.dataTypes);n&&e._query.splice(t+1,0,n),delete i._irop_,r=!0}}return this._unlinkTree(e),r}});return P})),define("DS/SNSmartQuery/utils/NLQEngine",["UWA/Core","UWA/Class","UWA/Promise","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchSettings","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/config/SmartQueryConfig","DS/SNSmartQuery/utils/StaticDataRepository","DS/SNSmartQuery/utils/NLQEngineUtils","DS/SNSmartQuery/utils/SNMLIClient","DS/SNSmartQuery/Suggesters/TypeSuggester","DS/SNSmartQuery/Suggesters/InterfaceSuggester","DS/SNSmartQuery/Suggesters/LogicalOperatorSuggester","DS/SNSmartQuery/Suggesters/RelationalOperatorSuggester","DS/SNSmartQuery/Suggesters/PredicateSuggester","DS/SNSmartQuery/Suggesters/AtSuggester","DS/SNSmartQuery/Suggesters/PredicateValueSuggester","DS/SNSmartQuery/Suggesters/ClassificationAttributeSuggester","i18n!DS/SNSmartQuery/assets/nls/SNSmartQuery.json"],(function(e,t,r,i,n,a,s,o,u,l,c,p,d,g,f,h,y,S,_,m,T,P,E){"use strict";return t.singleton({init:function(){this.activeTenant=a.getActiveTenant()||"OnPremise"},_buildFromString:function(e,t,i){let n=this;return n._smartQuery=i,n._smartQuery.destroy(),new r((function(r,i){let a=function(e){let t;switch(n._smartQuery.destroy(),e){case"$$HALLUCINATION$$":case"sourceVocab":case"typeVocab":case"predVocab":t=E.get("NLQ.LLM.ko_message.outOfScope");break;case"clientBug":t=E.get("NLQ.parse.ko_message.broken");break;case"timeOUT":t=E.get("NLQ.LLM.ko_message.timeOut");break;default:t=E.get("NLQ.LLM.ko_message.notAvailable")}i({error:t})},s=function(e){try{e=d._postProcessUql(e),n._parseUql(e,0).then((function(){n._syntaxHandler(),console.log("parseUql: ",n._smartQuery._query),r(n._smartQuery._query)}),(function(e){a(e)}))}catch(e){a("clientBug")}};u.getOption("parseUQLonFailure")?s(e):g.nlqToUql({formats:["uql"],model:t,nlq:e,onComplete:function(e){e&&e.uql&&"OK"==e.uql.status?s(e.uql.query):a("notAvailable")},onFailure:function(e){a("notAvailable")},ontimeout:function(e){a("timeOUT")}})}))},_treatBrick:function(e){return{displayValue:e.displayValue,value:e.value,type:e.suggestionType?e.suggestionType:e.type,uri:e.uri,imageUrl:e.imageUrl,iconClass:e.iconClass,imageUrlPromise:e.imageUrlPromise,category:e.category,trigram:e.trigram,dataTypes:e.dataType?e.dataType:e.dataTypes,weightage:e.weightage,unitInfo:e.unitInfo,isClassAttribute:e.classAttribute,matchType:e.matchType}},_syntaxHandler:function(){let e=this._smartQuery._query;e&&e.length&&(this._keywordHandle(e),this._operatorHandle(e),this._rangeHandle(e),this._dateTypeHandle(e))},_keywordHandle:function(e){e.forEach(((e,t)=>{"[__USERID__]"===e.value||"__USERID__"===e.value?(e.type="KEYWORD",e.value=p._userId,e.displayValue=e.value):"[__USERNAME__]"!==e.value&&"__USERNAME__"!==e.value||(e.type="KEYWORD",e.value=p._userName,e.displayValue=e.value)}))},_dateTypeHandle:function(t){t.forEach(((t,r)=>{"USER_TEXT"==t.type&&"date"==t.dataTypes&&e.is(t.value,"string")&&(t.uri="custPredVal:datepicker",t.data=[t.value],t.displayValue="Date",t.type="PREDICATE_VALUE",t.category=l.SUGGESTION_CATEGORY.WHEN,t.iconClass="fonticon-calendar-day-move-to")}))},_rangeHandle:function(e){let t=[];for(var r=0;r<e.length;r++){let i=e[r];if("PREDICATE"==i.type&&p.getPredicateDataType(i.uri)){let n=p.getPredicateDataType(i.uri);if("integer"==n||"double"==n||"date"==n){let a="date"==n?"<":"<=",s="date"==n?">":">=";r+1<=e.length&&"R_OPERATOR"==e[r+1].type&&(e[r+1].value==a||e[r+1].value==s)&&r+2<=e.length&&("PREDICATE_VALUE"==e[r+2].type||"USER_TEXT"==e[r+2].type||"VALUE_KEYWORD"==e[r+2].type)&&(t.push({predicate:i.uri,operator:e[r+1].value,position:r}),r++,r++)}}}let i=0;for(r=1;r<t.length;r++)if(t[r].predicate==t[r-1].predicate&&t[r].operator!==t[r-1].operator){let n=t[r].position-1-5*i;if("L_OPERATOR"==e[n-5*i].type&&"AND"==e[n-5*i].value){let n=p.getPredicateDataType(t[r].predicate),a={displayValue:"Range",type:"PREDICATE_VALUE",uri:"custPredVal:range",iconClass:"date"==n?"fonticon-calendar-move-to":"fonticon-double-arrow-horizontal",category:p.rootMap[t[r].predicate],dataTypes:n,data:[e[t[r-1].position+2-5*i].value,e[t[r].position+2-5*i].value]};e.splice(t[r-1].position+1-5*i,6),this._smartQuery.setSuggestion({at:t[r-1].position+1-5*i,selection:a}),i++,r++}}},_operatorHandle:function(e){for(var t=0;t<e.length;t++)if("R_OPERATOR"==e[t].type&&"operator:contains"==e[t].uri&&t+1<=e.length&&("PREDICATE_VALUE"==e[t+1].type||"VALUE_KEYWORD"==e[t+1].type)){e.splice(t,1);let r={displayValue:E.get("SNSmartQuery.relational_operator.is"),value:":",type:"R_OPERATOR",uri:"operator:is",category:"OPERATOR"};this._smartQuery.setSuggestion({at:t,selection:r})}},_parseUql:function(e,t){let i=this,n=this._smartQuery.length(),a=this._smartQuery._getContext(n);a._nlqMode=!0;let o,u={},l=!1,d=r.deferred(),g=e.slice(t).trim();if(0==g.indexOf("[")){o=e.indexOf("]",t),u.type="PREDICATE",u.value=e.slice(t,o+1).trim(),"[ds6w:endorsement]"!=u.value&&"[ds6w:comment]"!=u.value&&"[ds6w:answer]"!=u.value||(u.value="["+u.value.substring(1,u.value.length-1)+"s]"),u.uri=u.value.substring(1,u.value.length-1),u.displayValue=u.uri,o+=1;let n=r.deferred();if("ds6w:type"==u.uri||"ds6w:kind"==u.uri){let r,n,c=e.indexOf(":",o),y=e.indexOf("=",o);c=y>=0&&y<c?y:c,c+=1,g=e.slice(c).trim();let S="";if(0==g.indexOf('\\"')?S='\\"':0==g.indexOf('"')&&(S='"'),S&&0==g.indexOf(S))c=e.indexOf(S,c),r=e.indexOf(S,c+S.length),-1==r||(n=e.slice(c+S.length,r));else{let i=e.slice(c).length-g.trimStart().length,a=g.indexOf(" ",c+i);r=-1!==a?t+a:e.length,n=e.slice(c+i,r)}let _=f;"ds6w:kind"==u.uri&&(_=h),_.getSuggestions("",a).then((function(t){"swym:Wikitree"===n&&(n="swym:WikitreePage"),"swym:Conversation"===n&&(n="swym:DirectMessage"),t.forEach(((t,a)=>{l||t.uri.toLowerCase()!=n.toLowerCase()&&t.uri.split(":").pop().toLowerCase()!=n.toLowerCase()||(u=t,l=!0,o=e.indexOf(S,r)+S.length,d.resolve(t),p.loadRelevantPredicates({className:[t.uri],tenantId:i.activeTenant}),"ds6w:kind"==!u.uri&&s.loadRelevantInterfaces({className:t.uri,tenantId:i.activeTenant}))})),l||(u.errorCode="$$HALLUCINATION$$",o=e.length,d.resolve(u))}))}else n.resolve();n.promise.then((function(){_.getSuggestions("",a).then((function(e){if(e.forEach(((e,t)=>{l||e.uri==u.uri&&(u=e,l=!0,d.resolve(e))})),!l){let e={types:[],interfaces:[],rule:{PREDICATE:!0}};_.getSuggestions("",e).then((function(e){e.forEach(((e,t)=>{l||e.uri==u.uri&&(u=e,l=!0,d.resolve(e))})),l||P.getSuggestions("",a).then((function(e){e.forEach(((e,t)=>{l||e.uri==u.uri&&(u=e,l=!0,d.resolve(e))})),l||("__USERNAME__"!=u.uri&&"__USERID__"!=u.uri&&"__USERTAG__"!=u.uri?u.errorCode="$$HALLUCINATION$$":"__USERTAG__"==u.uri&&(u.displayValue="UserTag",u.value="([ds6w:what]:$$UserTagValue$$ OR [ds6w:who]:$$UserTagValue$$ OR [ds6w:when]:$$UserTagValue$$ OR [ds6w:where]:$$UserTagValue$$ OR [ds6w:why]:$$UserTagValue$$ OR [ds6w:how]:$$UserTagValue$$)"),d.resolve(u))}))}))}}))}))}else if(0==g.indexOf("@@")){t=e.indexOf("@@",t),o=e.indexOf("@@",t+2),u.type="TYPE",u.value=e.slice(t+2,o).trim(),o+=2,u.displayValue=u.value;let r={_nlqMode:!0,types:[],interfaces:[],rule:{TYPE:!0,TYPE_GROUP:!0}};f.getSuggestions("",r).then((function(e){let t=c.get("categories");for(var r=0;r<t.length;r++)if(t[r].internalNLS.toLowerCase()==u.value.toLowerCase()){l=!0,u=t[r],u.type="TYPE_GROUP",u.category="ds6w:what",d.resolve(u);break}if(!l){e=e.filter((function(e){return"TYPE"==e.suggestionType}));let t=c.get("sourcePrefix");for(r=0;r<e.length;r++)if("3dspace"!==e[r].source){let i=u.value.toLowerCase();if("Group"==i&&"foaf:Group"!==e[r].uri)continue;let n=e[r].uri.split(":").slice(-1)[0];if(n=n.toLowerCase(),n==i||t[e[r].source]&&t[e[r].source].toLowerCase()+n==i){l=!0,d.resolve(e[r]);break}}l||(u.type="USER_TEXT",d.resolve(u))}}))}else if(0==g.indexOf("(")||0==g.indexOf(")")||0==g.indexOf("OR")||0==g.indexOf("AND"))0==g.indexOf("(")?(o=e.indexOf("(",t),u.type="OPEN_PARENT",u.value="("):0==g.indexOf(")")?(o=e.indexOf(")",t),u.type="CLOSE_PARENT",u.value=")"):0==g.indexOf("OR")?(o=e.indexOf("OR",t),u.type="L_OPERATOR",u.value="OR"):0==g.indexOf("AND")&&(o=e.indexOf("AND",t),u.type="L_OPERATOR",u.value="AND"),o=e.indexOf(u.value,t),o+=u.value.length,u.uri=e.slice(t-1,o-1),u.displayValue=u.value,y.getSuggestions("",a).then((function(e){e.forEach(((e,t)=>{l||e.value==u.value&&(u=e,l=!0,d.resolve(e))})),l||d.resolve(u)}));else if(0==g.indexOf(":")||0==g.indexOf(">")||0==g.indexOf("<")||0==g.indexOf("=")){let r;0==g.indexOf(">=:")||0==g.indexOf("=>:")||0==g.indexOf(":>=")||0==g.indexOf(":=>")?(u.value=">=",r=[">=:","=>:",":>=",":=>"]):0==g.indexOf("<=:")||0==g.indexOf("=<:")||0==g.indexOf(":<=")||0==g.indexOf(":=<")?(u.value="<=",r=["<=:","=<:",":<=",":=>"]):0==g.indexOf(">=")||0==g.indexOf("=>")?(u.value=">=",r=[">=","=>"]):0==g.indexOf("<=")||0==g.indexOf("=<")?(u.value="<=",r=["<=","=<"]):0==g.indexOf(">:")||0==g.indexOf(":>")?(u.value=">",r=[">:",":>"]):0==g.indexOf("<:")||0==g.indexOf(":<")?(u.value="<",r=["<:",":<"]):0==g.indexOf(">")?u.value=">":0==g.indexOf("<")?u.value="<":0==g.indexOf("==")||0==g.indexOf(":=")?(r=["==",":="],u.value=":"):0!=g.indexOf("=")&&0!=g.indexOf(":")||(r=["=",":"],u.value=":"),r?(r=r.map(((e,t)=>e="\\"+e.split("").join("\\"))),r="("+r.join("|")+")",r=g.match(new RegExp(r)),r=r[0]):r=u.value,o=e.indexOf(r,t),o+=r.length,u.displayValue=u.value,u.type="R_OPERATOR",S.getSuggestions("",a).then((function(e){e.forEach(((e,t)=>{if(!l&&e.value==u.value){if("string"==p.getPredicateDataType(a.currentPredicate)&&"operator:is"==e.uri)return;u=e,l=!0,d.resolve(e)}})),l||d.resolve(u)}))}else{if(0==g.indexOf('"')||0==g.indexOf('\\"')){let r=0==g.indexOf('\\"')?'\\"':'"',i=e.indexOf(r,t),n=e.indexOf(r,i+r.length);o=e.indexOf(r,n)+r.length,u.value=e.slice(i+r.length,n),'"'==u.value[0]&&(u.value=u.value.slice(1)),"date"==p.getPredicateDataType(a.currentPredicate)&&(u.dataType="date")}else{let r=["\\[",'\\"',"OR","AND","\\(","\\)","\\:","\\<\\=","\\>\\=","\\=\\<","\\=\\>","\\<","\\>"];r="("+r.join("|")+")";let i=g.match(new RegExp(r));o=i?t+i.index:e.length,u.value=e.slice(t,o).trim()}u.type="USER_TEXT",u.uri=u.value,u.displayValue=u.value;let r=function(){m.getSuggestions("@"+u.value,a).then((function(e){e.forEach(((e,t)=>{l||e.trigram.toLowerCase()!=u.value.toLowerCase()&&e.displayValue.toLowerCase()!=u.value.toLowerCase()||(l=!0,d.resolve(e))})),l||d.resolve(u)}))};!a.currentPredicate||"PREDICATE"!=a.lastToken.type&&"R_OPERATOR"!=a.lastToken.type?u.value<=5&&u.value>=3?r():d.resolve(u):T.getSuggestions("",a).then((function(e){e.forEach(((e,t)=>{l||e.uri==u.uri&&(u=e,l=!0,d.resolve(e))})),l||("string"==p.getPredicateDataType(a.currentPredicate)&&"ds6w:who"==p.rootMap[a.currentPredicate]?r():d.resolve(u))}))}return new r((function(r,n){d.promise.then((function(a){"$$HALLUCINATION$$"==a.errorCode?n(a.errorCode):o<e.length&&e[o]&&o>t?(a=i._treatBrick(a),i._smartQuery.setSuggestion(a),i._parseUql(e,o).then((function(){r()}),(function(e){n(e)}))):(a=i._treatBrick(a),i._smartQuery.setSuggestion(a),r())}))}))}})})),define("DS/SNSmartQuery/SNSmartQuery",["UWA/Core","UWA/Class","DS/SNInfraUX/SearchSettings","DS/SNSmartQuery/context/SNSmartQueryToken","DS/SNSmartQuery/SNSmartQueryTree","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/config/SmartQueryConfig","DS/SNSmartQuery/context/ContextManager","DS/SNSmartQuery/utils/StaticDataRepository","DS/SNSmartQuery/utils/TypeGroupSuggestHelper","DS/SNSmartQuery/Suggesters/PredicateValueSuggester","DS/SNSmartQuery/Suggester","DS/SNSmartQuery/InContext/InContextHandler","DS/SNSmartQuery/utils/NLQEngine","i18n!DS/SNSmartQuery/assets/nls/SNSmartQuery.json"],(function(e,t,r,i,n,a,s,o,u,l,c,p,d,g,f){"use strict";return t.extend({SUGGESTION_CATEGORY:a.SUGGESTION_CATEGORY,_suggester:null,_contextManager:null,init:function(e){this._query=[],this._add_implicit_operator=e&&e.add_implicit_operator,this._suggester=new p,this._contextManager=new o,this.load(e)},load:function(e){return e&&(e.queryJson&&e.queryJson.length>0&&this.validateQuery(e),e.suggestions&&(this._inContextHandler=new d(e.suggestions))),this._liteMode=!(!e||!e.liteMode),Promise.all(u.getStaticDataPromiseArray())},validateQuery:function(e){let t=!0;for(let r=0;r<e.queryJson.length;r++){let i=e.queryJson[r];if(!this.checkMandatoryParam(i)){t=!1;break}if(!this._getContext(r).rule[i.type]){t=!1;break}this.setSuggestion(i)}t||(this._query=[])},checkMandatoryParam:function(e){return!!(e.type&&e.value&&e.displayValue)},_getContext:function(e){let t=this._contextManager.getContext(this._query,e),r=(new n).getContextTypes(this,e);return t.types=[],t.interfaces=[],r&&r.forEach(((e,r)=>{e.type===a.TokenType.TYPE?t.types.push(e.uri):e.type===a.TokenType.INTERFACE&&t.interfaces.push(e.uri)})),t._liteMode=this._liteMode,t.rule=a.getRule(this,e),t._inContextHandler=this._inContextHandler,t},getSuggestions:function(e,t){let r=this._getContext(e);return this._suggester.getSuggestions(r,t)},setSuggestion:function(t){let r;if(t.selection){r=t.selection;let i=t.at;this._contextManager.updateContext(r);let a=this.getTokenForSuggestion(r);e.is(i)?this.setAt(i,a):this.push(a);let s={suggestionToken:a};if(t.addParenthesis){let e=(new n).addParenthesis(this);s.refresh=e}if(this._add_implicit_operator||t.add_implicit_operator){let e=(new n).addImplicitOperators(this);s.refresh=s.refresh||e}return s.at=this._find(a),s}{r=t,this._contextManager.updateContext(r);let e=this.getTokenForSuggestion(r);return this.push(e),e}},addImplicitOperators:function(){return{refresh:(new n).addImplicitOperators(this)}},removeImplicitOperators:function(){for(let e=this._query.length-1;e>=0;e--)1==this._query[e].automatic&&this.removeAt(e)},getTokenForSuggestion:function(e){return new i(e)},buildQueryString:function(){let t=s.get("defaultOperator").L_OPERATOR,r=s.get("defaultOperator").R_OPERATOR;function i(e,t){if(++t<e.length)return e[t]}function n(t,r,i,n){let a="",s=t.value&&t.value.from?t.value.from:e.is(t.data,"array")?t.data[0]:void 0,o=t.value&&t.value.to?t.value.to:e.is(t.data,"array")?t.data.length>1?t.data[1]:t.data[0]:void 0;return"date"===r&&(e.is(s)&&(s=new Date(s+" 00:00:00"),s=new Date(s).toISOString(),s='"'+s+'"'),e.is(o)&&(o=new Date(o+" 23:59:59"),o=new Date(o).toISOString(),o='"'+o+'"')),"operator:after"===n?o:"operator:before"===n?s:(e.is(s)?(a+=">="+s,e.is(o)&&(a+=" AND ["+i+"]<="+o)):e.is(o)&&(a+=">="+o),a)}function o(e){f+=" "+e}function c(){if(p.length>0){let e=p.join(" OR ");p.length>1&&(e="("+e+")"),f+=" "+e,p=[]}if(g.length>0){let e=g.join(" OR ");g.length>1&&(e="("+e+")"),f+=" AND "+e,g=[]}if(d.length>0){d=d.map((e=>l.getTypeGroupQuery(e)));let e=d.join(" OR ");d.length>1&&(e="("+e+")"),f+=" "+e,d=[]}}let p=[],d=[],g=[],f="";for(let e=0;e<this._query.length;e++)if(this._query[e].type==a.TokenType.TYPE)p.push(this._query[e].value);else if(this._query[e].type==a.TokenType.TYPE_GROUP)d.push(this._query[e].value);else if(this._query[e].type==a.TokenType.INTERFACE)g.push(this._query[e].value);else{c();let s=a.getUqlRule(this,e);if(s[this._query[e].type]||s[a.TokenType.L_OPERATOR]&&o(t),this._query[e].type==a.TokenType.U_OPERATOR){let t=i(this._query,e);if(t&&t.type===a.TokenType.PREDICATE_VALUE){o("["+t.uri.split("/").pop()+"]:")}continue}if(o(this._query[e].value),this._query[e].type==a.TokenType.PREDICATE){let t=i(this._query,e),l=this._query[e].uri,c=u.getPredicateDataType(l);if(t){if(t.type!==a.TokenType.R_OPERATOR)"custPredVal:range"!==t.uri&&"custPredVal:datepicker"!==t.uri&&"ABOUT"!==this._query[e].uri&&(f+=r[c]);else{let r=i(this._query,e+1);"operator:on"===t.uri&&r&&"custPredVal:datepicker"===r.uri||"__USERTAG__"===this._query[e].uri||(f+=t.value),e++,t=i(this._query,e)}t&&(s=a.getPredicateValueTokenTypes(),"custPredVal:range"===t.uri||"custPredVal:datepicker"===t.uri?f+=n(t,c,l,this._query[e].uri):"string"===c&&t.type===a.TokenType.USER_TEXT&&(t.value[0]!==t.value[t.value.length-1]||"*"!==t.value[0]&&'"'!==t.value[0]&&"'"!==t.value[0])?"*"===t.value[0]||"*"===t.value[t.value.length-1]||"+"===t.value[0]?o(t.value):"operator:is"===this._query[e].uri?o('"'+t.value+'"'):(t.value=t.value.replace(/  +/g," ").trim(),"__USERTAG__"!==l?o("(*"+t.value+"*)"):f=f.replaceAll("$$UserTagValue$$",'"'+t.value+'"')):o(t.value),e++)}}}return c(),f.trim()},check:function(){return(new n).check(this)},buildFromNLQ:function(e,t){return g._buildFromString(e,t,this)},push:function(e){this._query.push(e)},pop:function(){return this._query.pop()},length:function(){return this._query.length},getAt:function(e){return this._query[e]},setAt:function(e,t){this._query.splice(e,0,t)},removeAt:function(e){return this._query.splice(e,1)},spliceAt:function(e,t){return this._query.splice(e,0,t)},_find:function(e){for(let t=0;t<this._query.length;t++)if(this._query[t]==e)return t},destroy:function(){return this._query=[],this._suggester&&e.is(this._suggester.destroy,"function")&&this._suggester.destroy(),this._contextManager&&e.is(this._contextManager.resetContext,"function")&&this._contextManager.resetContext(),delete this._inContextHandler,delete this._liteMode,this._parent()},getQueryJson:function(){return this._query.map((function(e){return{displayValue:e.displayValue,value:e.value,type:e.type,uri:e.uri,category:e.category,dataTypes:e.dataTypes}}))}})}));