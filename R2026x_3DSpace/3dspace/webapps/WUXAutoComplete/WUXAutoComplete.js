define("DS/WUXAutoComplete/AutoComplete",["UWA/Core","DS/Utilities/Dom","DS/Controls/Abstract","DS/Controls/SelectionChips","DS/Controls/LineEditor","DS/Controls/Popup","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Utilities/Array","DS/Utilities/KeyboardUtils","DS/Utilities/Utils","DS/Utilities/TouchUtils","i18n!DS/WUXAutoComplete/assets/nls/translation","DS/Menu/Menu","DS/Controls/Loader","DS/Tweakers/TypeUtils","css!DS/WUXAutoComplete/assets/css/wuxautocompleteloader.css"],(function(e,t,i,o,s,l,n,a,d,r,h,p,u,c,_,m,f){"use strict";const g=3,y={ADD:1,REMOVE:2},v={classic:{expanderStyle:"classic",buildLinks:!0,depthIncrement:14},triangle:{expanderStyle:"triangle",buildLinks:!1,depthIncrement:14},none:{expanderStyle:"none",buildLinks:!1,depthIncrement:14}};function C(e){let t;return t=void 0!==e?Array.isArray(e)?this.multiSearchMode?e:e.length?[e[0]]:[]:[e]:[],t}const w={CLOSED:0,DISPLAY_SEARCH:1,DISPLAY_COMPLETE_MODEL:2},I={RESET:0,SELECTION_CHANGE:1,INPUT_CHANGE:2,SHOW_POPUP:3,HIDE_POPUP:4,ESCAPE:5};function b(e){e===I.SELECTION_CHANGE?this._autoCompleteState===w.DISPLAY_SEARCH&&(this._autoCompleteState=w.DISPLAY_COMPLETE_MODEL):e===I.RESET?this._autoCompleteState=w.CLOSED:e===I.INPUT_CHANGE?this._autoCompleteState=w.DISPLAY_SEARCH:e===I.SHOW_POPUP?this._autoCompleteState===w.CLOSED&&(this._autoCompleteState=w.DISPLAY_COMPLETE_MODEL):(e===I.HIDE_POPUP||e===I.ESCAPE)&&(this._autoCompleteState=w.CLOSED)}function M(e){B.call(this,this._valueOperation,{operationType:y.ADD,noOfItemsModified:1},(function(){const t=()=>{this.multiSearchMode?(this._editor.valueToCommit="",this._editor.value=""):this._editor.value=q(this.selectedItems)};if(!e)return void(this.multiSearchMode||(this.allowResetToUndefinedByUIFlag?this.selectedItems=void 0:t()));let i=!0;if(i=this.multiSearchMode?!this.selectedItems||this.selectedItems.every((t=>q(t)!==e)):!this.selectedItems||q(this.selectedItems)!==e,!i)return void t();let o,s=H.call(this,e);if(s=s&&s[0],!s){if(!this.allowFreeInputFlag)return void t();s=new d({label:e,value:e,customNode:!0})}this.multiSearchMode?(o=C.call(this,this.selectedItems),o=o.slice(0),r.pushUnique(o,s)):o=[s],this.selectedItems=o}))}function S(e){let t=0,i=!1;if(!this._dataGridView||!this._dataGridViewContainer)return i;let o=this._dataGridView.layout.getDefaultCellHeight();if(this._modalLoaderIsDisplayed||!this._model||0===this._model.getRoots().length)t=o*g;else{t=0;let i=this._maximumItemsDisplayed*(o+1);const s=e?e.availableSpaces:void 0,l=e?e.positionToTarget:void 0;let n=s&&l?Math.min(s[l]-4,i):i;if(0===this._model.getNumberOfVisibleDescendants())t=o;else{for(let[e,i,s]=[0,0,this._model?this._model.getNumberOfVisibleDescendants():0];e<s&&t<n;e++)i=(this._dataGridView.layout&&this._dataGridView.layout.getRowHeightFunction?this._dataGridView.layout.getRowHeightFunction(e):o)+1,t+=i;this._hasScrollBar=t>=n,t=Math.min(t,n)}}if(t>=1){const e=Math.round(t)+"px";this._dataGridViewContainer.style.height!==e&&(this._dataGridViewContainer.style.height=e,i=!0)}return i}function V(e,i){let o=!1,s=0;if(this.popupSizeAdjustPolicy===l.SizeAdjustPolicyEnum.NoAdjust)s=this._DGVContainerFitWidth;else if(this._dataGridView){const e=this._hasScrollBar?p.getScrollbarWidth():0;let i,o=!0;if(this._model&&this._model.processDescendants({onlyVisibleNodes:!0,processNode:()=>(o=!1,{stopProcessing:!0})}),o){if(void 0===this._customFilterMessageWidth){const e=parseFloat(window.getComputedStyle(this.getContent(),null).getPropertyValue("font-size"));this._customFilterMessageWidth=t.computeStringWidth(this.customFilterMessage,e,"Arial",!0)}i=this._customFilterMessageWidth+(e?0:20)}else i=this._dataGridView._getMaxContentSizeInfo(["tree"],{computeAllRows:this.popupSizeAdjustPolicy===l.SizeAdjustPolicyEnum.AdjustToAllContents}).tree.maxContentSize;s=Math.max(this._DGVContainerMinWidth,i+e),this._DGVContainerWidth!==s&&(this._DGVContainerMinWidth=s)}this._popupConstraintsObject=e;const n=e?e.availableSpaces:void 0;if(n){const e=this._DGVContainerFitWidth+n.left+n.right;s=Math.min(s,e)}return 0!==s&&this._DGVContainerWidth!==s&&(this._DGVContainerWidth=s,this._dataGridViewContainer.setStyle("width",s+"px"),o=!0),(o||i)&&this.elements.popup._updateView(),!this._popupVisibility&&this.elements.popup&&this.elements.popup.visibleFlag&&!this._lockPopupVisibilityChange&&(this._popupVisibility=!0,this.elements.popup.getContent().setStyle("visibility","visible"),this.fire("popupVisibilityChange")),o||i}function D(e){const t=e?e.availableSpaces:void 0;t&&(isNaN(t.left)||isNaN(t.top)||isNaN(t.right)||isNaN(t.bottom))&&(e=void 0);const i=S.call(this,e);return V.call(this,e,i)}function O(e){this._lockPopupVisibilityChange=!0,D.call(this,e),this._lockPopupVisibilityChange=!1}function P(){let e;this._selectionChips&&(e=this._selectionChips.getContent().getDimensions().height),e!==this._selectionChipsHeight&&(this.elements.popup&&this.elements.popup._updateView(),D.call(this)),this._selectionChipsHeight=e}function A(e){if(this._model){let t=this.filterCB(e)||this._getFirstMatchingCellID();D.call(this),this.allowFreeInputFlag&&!this.displayCustomNodeInDropDown||""===e||T.call(this,t)}}function T(e){this._dataGridView&&(this._dataGridView.setActiveCell(e,!0,!0),this._dataGridView.setPreselectedCell(e))}function E(e){if(!this._model)return;const t=this._model.getRoots(),i=t.length>0&&t[0].options.customNode?t[0]:void 0;if(!e||!this.allowFreeInputFlag||!this.displayCustomNodeInDropDown)return void(i&&this._model.removeRoot(i));const o=H.call(this,e);if(o&&o[0])return void(i&&i!==o[0]&&this._model.removeRoot(t[0]));if(i)return void i.updateOptions({label:e,value:e});const s=new d({label:e,value:e,icons:[{iconName:"pencil"}],customNode:!0,_freeInputNode:!0});this._model.addRoot(s,0)}function F(){this._model&&(this._modelToken.forEach((e=>this._model.removeEventListener(e))),this._modelToken=[],this._xsoToken.forEach((e=>this._model.getXSO().unsubscribe(e))),this._xsoToken=[])}function G(e,t){if(!this._modelLoaded)if(this.selectedItems&&t&&(B.call(this,this._valueModifiedbyAPI,!0,(function(){this._model&&(this._model.getXSO().isEmpty()||this._model.getXSO().empty())})),b.call(this,I.RESET),this._properties.value.value=void 0,this._properties.selectedItems.value=void 0,this._selectionChips&&this._selectionChips.removeAllChips(),this._editor&&(this._editor.valueToCommit="",this._editor.value="")),this._model&&A.call(this,""),F.call(this),void 0===e)this._ownModel||(this._model=this._defaultModel,this._dataGridView&&(this._dataGridView.treeDocument=this._defaultModel)),this._model.empty(),this._modelLoaded=!0;else{if(e instanceof a)return U.call(this,e);if(Array.isArray(e))return j.call(this,e);if(e instanceof Function)return this._lastSearchedString=this._editor?this._editor.valueToCommit:"",G.call(this,e.call(this,this._lastSearchedString),!1);if(e instanceof Promise){this._pendingPromiseCounter++;let t=this._promiseId++;this._dataGridView?N.call(this):this._displayDGVLoader=!0,this._latestPromiseId=t,e.then((e=>{J.call(this,t)&&(G.call(this,e,!1),E.call(this,this._editor.valueToCommit))}),(()=>{this._ownModel||(this._model=this._defaultModel),this._model&&this._model.empty(),this._modelLoaded=!0})).finally((e=>{this._dataGridView&&J.call(this,t)&&(this._dataGridView.removeModalLoader(c.get("AutoComplete").Loading),this._modalLoaderIsDisplayed=!1,this._dataGridView.placeholder=this.customFilterMessage,this._editor&&this._editor.valueToCommit!==this._editor.value?A.call(this,this._editor.valueToCommit):D.call(this)),this._pendingPromiseCounter--}))}}}function N(){this._modalLoaderIsDisplayed||(this._model&&this._model.empty(),this._modalLoaderIsDisplayed=!0,this._dataGridView.displayModalLoader(c.get("AutoComplete").Loading),this._dataGridView.placeholder="")}function L(){this._editor&&(void 0===this._editor.valueToCommit||this._editor.valueToCommit.length>=this.minLengthBeforeSearch)&&(!this._modelLoaded||!this.keepSearchResultsFlag&&!Y.call(this)||this.elementsTree instanceof Function&&(!this._lastSearchedString||(this._editor.valueToCommit&&this._editor.valueToCommit.toLowerCase().indexOf(this._lastSearchedString.toLowerCase()))<0))&&(this._modelLoaded=!1,G.call(this,this.elementsTree,!1))}function R(e,t){let i=!1;if(t){let o;t.forEach((function(t){t.options.customNode&&(o||(o=e.reduce((function(e,t){return t.options.customNode&&e.push(q(t)),e}),[])),o.indexOf(q(t))>-1)?i=!0:r.pushUnique(e,t)}))}return i}function x(){const e=this;if(0===this._modelToken.length){const t=()=>{D.call(this)},i=this._model.addModelEventListener("addChild",t);this._modelToken.push(i);const o=this._model.addModelEventListener("removeChild",t);this._modelToken.push(o);const s=this._model.onPostExpand((function(){D.call(e)}));this._modelToken.push(s);const l=this._model.onPostCollapse((function(){D.call(e)}));this._modelToken.push(l)}if(0===this._xsoToken.length){const t=this._model.getXSO().onPostAdd((function(t){e._valueModifiedbyAPI||B.call(e,e._valueOperation,{operationType:y.ADD,noOfItemsModified:t.length},(function(){if(e.multiSearchMode){let i=[];e.selectedItems&&(i=e.selectedItems.slice(0));let o=R(i,t);e.selectedItems=i,e.minLengthBeforeSearch?e._hidePopup():o?(e._editor.valueToCommit="",E.call(e,""),A.call(this,"")):P.call(e)}else e._hidePopup(),e.selectedItems=t[0];b.call(e,I.SELECTION_CHANGE)}))}));this._xsoToken.push(t);const i=this._model.getXSO().onPostRemove((function(t){e.displayCustomNodeInDropDown&&t[0].options&&t[0].options.customNode||e._valueModifiedbyAPI||B.call(e,e._valueOperation,{operationType:y.REMOVE,noOfItemsModified:t.length},(function(){if(e.multiSearchMode){let i=[];e.selectedItems&&(i=e.selectedItems.slice(0)),t.forEach((function(e){for(let t=i.length-1;t>=0;t--)if(i[t]===e){i.splice(t,1);break}})),e.selectedItems=i,b.call(e,I.SELECTION_CHANGE),e.minLengthBeforeSearch&&void 0!==e._editor.value&&e._editor.value.length<e.minLengthBeforeSearch?e._hidePopup():P.call(e)}}))}));this._xsoToken.push(i)}}function U(e){if(e instanceof a){this._ownModel=!1;const t=!this.isDirty("value")&&!this.isDirty("selectedItems"),i=C.call(this,this.selectedItems);if(t){const t=e.getXSO().get(),o=Array(i.length).fill(!1);i.length>0&&(e.search({match:e=>{const s=i.indexOf(e.nodeModel);if(-1!==s){o[s]=!0,i[s].select(),delete i[s].options.customNode;const l=t.indexOf(e.nodeModel);return-1!==l&&t.splice(l,1),!0}return!1},shouldStop:()=>o.every((e=>!0===e))}),i.forEach(((e,t)=>{!1===o[t]&&(e.options.customNode=!0)})),i.push(...t))}this._model=e,this._modelLoaded=!0,this._dataGridView&&(this._dataGridView.treeDocument=this._model),t&&i.length>0&&B.call(this,this._valueOperation,{operationType:y.ADD,noOfItemsModified:i.length},(function(){(this.multiSearchMode||this.selectedItems!==i[0])&&(this.selectedItems=i)})),x.call(this)}}function j(t){if(Array.isArray(t)){this._ownModel=!0;const i=!this.isDirty("value")&&!this.isDirty("selectedItems"),o=C.call(this,this.selectedItems),s=Array(o.length).fill(!1);let l=[];for(let n=0;n<t.length;n++){const a=t[n],r="object"==typeof a,h=r?a.hasOwnProperty("value")?a.value:a.label:a+"",p=r?a.label||("object"==typeof a.value?a.value.label:a.value+""):a+"",u=r?a.typeRepresentation:typeof a,c=r?a.tooltip:void 0,_=r&&a.hasOwnProperty("grid");let m=r?a.icons:void 0;m||!a.icon||f.doesTypeRepresentationHandleIcon(u||this.columnOptions&&this.columnOptions.typeRepresentation)&&r&&this.columnOptions&&this.columnOptions.typeRepresentation&&K(this.columnOptions.typeRepresentation)&&"object"!=typeof a.value||(m=[a.icon]);const g=m;let y,v=!0;if(i&&(v=o.every(((t,i)=>!!s[i]||(q(t)!==p||t.options.value!==h&&t.options.value.value!==h||!e.equals(t.options.icons,g)||(y=t,s[i]=!0,delete y.options.customNode,!1))))),v){let e={label:p,value:h,icons:g,typeRepresentation:u,tooltip:c};_&&(e.grid=a.grid),r&&this.columnOptions&&this.columnOptions.typeRepresentation&&K(this.columnOptions.typeRepresentation)&&"object"!=typeof a.value&&(e.value=a),y=new d(e)}l.push(y)}i&&o.forEach(((e,t)=>{!1===s[t]&&(e.options.customNode=!0)})),this._model&&this._ownModel||(this._model=this._defaultModel),this._model.empty(),this._model.addRoot(l),this._dataGridView&&(this._dataGridView.treeDocument=this._model),this._modelLoaded=!0,i&&this._model.getXSO().add(o),x.call(this)}}function B(e,t,i){let o=this._valueModifiedbyAPI;!0===e.hasOwnProperty("operationType")&&!0===e.hasOwnProperty("noOfItemsModified")?(this._valueOperation.operationType=t.operationType,this._valueOperation.noOfItemsModified=t.noOfItemsModified):this._valueModifiedbyAPI=t,i.call(this),e.operationType&&e.noOfItemsModified?(this._valueOperation.operationType=void 0,this._valueOperation.noOfItemsModified=void 0):this._valueModifiedbyAPI=o}let k=function(){this._selectionChips=new o({fireOnlyFromUIInteractionFlag:!0,disabled:this.disabled}),this._selectionChips.getContent().addClassName("wux-controls-autoComplete-selectionChips"),this._selectionChips.touchMode=this.touchMode,this._selectionChips.selection.mode=o.SELECTION_MODE.SINGLE;let e=this;t.addEventOnElement(this,this._selectionChips,"onPostRemove",(function(t){e._valueModifiedbyAPI||B.call(e,e._valueOperation,{operationType:y.REMOVE,noOfItemsModified:t.options.chips.length},(function(){if(e.multiSearchMode&&t.options.chips){if(t.options.allChipsRemoved)return void(e.selectedItems=[]);for(let i=0;i<t.options.chips.length;i++){const o=t.options.chips[i].chipOptions;if(o.value&&o.value.options.customNode){const t=C.call(e,e.selectedItems).findIndex((e=>e===o.value));if(-1!==t){const i=e.selectedItems.slice(0);i.splice(t,1),e.selectedItems=i}}else if(o.value){let t=H.call(e,o.value);t&&t[0]&&o.value.unselect()}}}}))})),t.addEventOnElement(this,this._selectionChips,"change",(function(e){e.stopPropagation()}))};function H(t){const i=!1;let o;o=Array.isArray(t)?Array.from(t,(e=>({value:e,found:!1}))):[{value:t,found:!1}];const s=Array(o.length).fill(void 0);if(!this._model||0===o.length)return s;const l=o.length;let n=0;const a=(e,t)=>(n++,o[e].found=!0,s[e]=t,!0);return this._model.search({useTransaction:!1,match:t=>{const s=t.nodeModel,l=s.options.label,n=s.options.value,r=n instanceof Object&&n.hasOwnProperty("value")?n.value:n;for(let t=0;t<o.length;t++){const n=o[t].value,h=o[t].found,p=typeof n;if(null!=n&&!0!==h){if(s.options.hasOwnProperty("value")&&void 0!==r){if("string"===p){if("string"==typeof r&&e.equals(n.toLowerCase(),r.toLowerCase()))return a(t,s);i}else if("number"===p){if("number"==typeof r&&n===r)return a(t,s);i}else if("object"===p){if(n instanceof d&&e.equals(n.options.value,r)||e.equals(n,r))return a(t,s);if(n.hasOwnProperty("value")&&e.equals(n.value,r))return a(t,s);if(e.equals(n,r))return a(t,s)}i}if(s.options.hasOwnProperty("label")&&void 0!==l){if("string"===p){if("string"==typeof l&&e.equals(n.toLowerCase(),l.toLowerCase()))return a(t,s);i}else if("number"===p){if("number"==typeof l&&n===l)return a(t,s);i}else if("object"===p&&(n instanceof d&&e.equals(n.options.label,l)||e.equals(n,l)))return a(t,s);i}}}},shouldStop:()=>l===n}),s}function W(){let e,t=this;return this.selectedItems&&Array.isArray(this.selectedItems)&&this.selectedItems.forEach((function(i,o){t._selectionChips._items[o].isSelected&&(e=i)})),void 0===e&&(e=Array.isArray(this.selectedItems)?this.selectedItems[this.selectedItems.length-1]:this.selectedItems),e}function X(){if(this._dataGridView){let e,t=-1;if(this._autoCompleteState===w.DISPLAY_COMPLETE_MODEL){if(e=W.call(this),e){if(e.options.customNode||this._model!==e.getTreeDocument())return!1;t=this._dataGridView.layout.getCellIDFromCoordinates({rowID:e._getRowID(),columnID:0})}T.call(this,t)}else t=this._dataGridView.getPreselectedCellID(),e=t&&t>=0?this._dataGridView.getNodeModelAt(t):void 0;return this._dataGridView.ensureNodeModelVisible(e,!1,!0,0)}}function q(e){if(e){let t;return"string"==typeof e||"number"==typeof e?t=e+"":"object"==typeof e.options&&(e.options.label?t=e.options.label:e.options.value&&("string"==typeof e.options.value||"number"==typeof e.options.value?t=e.options.value+"":"object"==typeof e.options.value&&(t=e.options.value.label?e.options.value.label:""))),t}}function z(e,t){let i;if(e.options.hasOwnProperty("value")&&void 0!==e.options.value){let o=e.options.value;i=o instanceof Object&&o.hasOwnProperty("value")&&!t.multiSearchMode?o.value:o}else i=e.options.label;return i}function K(e){return"object"===e||"url"===e||"user"===e||"detailedInfo"===e||"detailedUser"===e}function Y(){return 0!==this._pendingPromiseCounter}function J(e){return this._latestPromiseId===e}return i.inherit({name:"autoComplete",publishedProperties:{placeholder:{defaultValue:c.get("AutoComplete").Placeholder,type:"string",category:"Appearance"},multiSearchMode:{defaultValue:!0,type:"boolean",category:"Behavior"},displayCustomNodeInDropDown:{defaultValue:!0,type:"boolean",category:"Behavior",noNeedToApplyFlag:!0},value:{defaultValue:void 0,type:"object",category:"Appearance"},elementsTree:{defaultValue:void 0,type:"object",category:"Model"},selectedItems:{defaultValue:void 0,type:"Array",category:"Appearance"},filterCB:{defaultValue:function(e){return this.filterItems(e),this._getFirstMatchingCellID()},type:"function",category:"Behaviour"},defaultFilterOptions:{defaultValue:void 0,type:"object",category:"Behaviour"},customFilterMessage:{defaultValue:c.get("AutoComplete").CustomFilterMessage,type:"string",category:"Appearance"},allowFreeInputFlag:{defaultValue:!0,type:"boolean",category:"Behavior",noNeedToApplyFlag:!0},allowResetToUndefinedByUIFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},minLengthBeforeSearch:{defaultValue:0,type:"integer",category:"Behavior",noNeedToApplyFlag:!0},typeDelayBeforeSearch:{defaultValue:0,type:"integer",category:"Behavior",noNeedToApplyFlag:!0},keepSearchResultsFlag:{defaultValue:!0,type:"boolean",category:"Behavior",noNeedToApplyFlag:!0},popupSizeAdjustPolicy:{defaultValue:l.SizeAdjustPolicyEnum.AdjustToVisibleContents,type:"integer",category:"Appearance"},popupConstraint:{defaultValue:"screen",type:"string",category:"Appearance"},getChipInfo:{defaultValue:function(e){return this.getDefaultChipInfo(e)},type:"function"},columnOptions:{defaultValue:void 0,type:"object",category:"Appearance"},displayLoader:{defaultValue:!1,type:"boolean",category:"Appearance"}},_privateProperties:{_maximumItemsDisplayed:{defaultValue:10,type:"integer",category:"Appearance"}},_autoCompleteState:w.CLOSED,getDefaultChipInfo:function(e){let t,i,o=q(e),s=function(e){if(e){let t;return"object"==typeof e.options&&(e.options.subLabel?t=e.options.subLabel:e.options.value&&"object"==typeof e.options.value&&(t=e.options.value.subLabel?e.options.value.subLabel:"")),t}}(e);if(s&&(o=o+"("+s+")"),!e.options._freeInputNode){if(e.options.icons&&e.options.icons.length>0){for(let i=0;i<e.options.icons.length;i++)if("object"==typeof e.options.icons[i]?!e.options.icons[i].position||"near"===e.options.icons[i].position:e.options.icons[i]){t=e.options.icons[i];break}}else t=e.options.icon||("object"==typeof e.options.value?e.options.value.icon:void 0);const s="user"===this.getTypeRepresentation(e)||"detailedUser"===this.getTypeRepresentation(e);!t&&s&&(t={userName:o}),i={roundFlag:s}}return{label:o,icon:t,_iconOptions:i}},canClosePopup:function(e){if(e)return!0;let t=W.call(this);if(void 0!==t){if(this._dataGridView){let e=-1;e=this._dataGridView.layout.getCellIDFromCoordinates({rowID:t._rowID,columnID:0}),T.call(this,e)}return!1}return!0},getTypeRepresentation:function(e){return(e?e.options.typeRepresentation:void 0)||this.columnOptions&&void 0!==this.columnOptions.getTypeRepresentation&&this.columnOptions.getTypeRepresentation({nodeModel:e})||this.columnOptions&&this.columnOptions.typeRepresentation||"string"},keymaps:{tab:"manageTab","shift+tab":"manageTab",esc:"manageEscape",up:"upMove",down:"downMove",pageup:"pageupMove",pagedown:"pagedownMove",home:"homeMove",end:"endMove",return:"manageReturn"},commands:{manageTab:function(e){return this._hidePopup(),b.call(this,I.SELECTION_CHANGE),M.call(this,this._editor.valueToCommit),{stopPropagation:!1}},manageEscape:function(e){return b.call(this,I.ESCAPE),this.elements.popup&&this.elements.popup.visibleFlag&&(!this.multiSearchMode&&this._editor&&this._editor.elements.inputField&&this.selectedItems&&(this._editor.valueToCommit=q(this.selectedItems),this._editor.value=q(this.selectedItems)),this.callMethodFromUIInteraction("_hidePopup")),{stopPropagation:!1}},upMove:function(){return this._manageNavigationKey("up")},downMove:function(){return this._manageNavigationKey("down")},pageupMove:function(){return this._manageNavigationKey("pageup")},pagedownMove:function(){return this._manageNavigationKey("pagedown")},homeMove:function(){return this._manageNavigationKey("home",!0)},endMove:function(){return this._manageNavigationKey("end",!0)},manageReturn:function(e){return{stopPropagation:!1,infos:{actionPerformed:e.actionPerformed}}}},buildView:function(){this.elements.container.addClassName("wux-controls-autoComplete"),this._modelLoaded=!1,this._defaultModel=new a,this._ownModel=!1,this._model=null,this._promiseId=0,this._pendingPromiseCounter=0,this._latestPromiseId=-1,this._modalLoaderIsDisplayed=!1,this._lastSearchedString="",this._valueOperation={operationType:void 0,noOfItemsModified:void 0},this._xsoToken=[],this._modelToken=[],this._nbItemsToDisplay=-1,this._valueModifiedbyAPI=!1,this._selectionChipsHeight=0,this._DGVContainerFitWidth=0,this._DGVContainerMinWidth=0,this._DGVContainerWidth=0},_postBuildView:function(){if(void 0===this._editor){this._editor=new s({placeholder:this.placeholder,displayStyle:"text",fireOnlyFromUIInteractionFlag:!0,selectAllOnFocus:!0,disabled:this.disabled}),this._editor.getContent().addClassName("wux-controls-autoComplete-editor"),this._updateEditorMinWidth();let e=this;this._editor.tooltipInfos={getAllInformationCB:function(){return e._buildLineEditorTooltip()}}}this._editor.touchMode=this.touchMode,this._applyMultiSearchMode(),this.multiSearchMode||this.selectedItems&&(this._editor.value=Array.isArray(this.selectedItems)?q(this.selectedItems[0]):q(this.selectedItems)),this._delayPopupCreation()},_buildLineEditorTooltip:function(){let e,i,o;this.touchMode||u.getTouchMode()?(e=14,i=22,o=2):(e=12,i=12,o=2),e=this.touchMode||u.getTouchMode()?14:12;return{model:{updateModel:!0,shortHelp:t.computeStringWidth(this.placeholder,e,"Arial")+i+o>this._editor.getContent().offsetWidth&&this.placeholder||""}}},handleEvents:function(){let e=this,i=function(){let t=!1;!e._valueModifiedbyAPI&&e._dataGridView&&(e._dataGridView.setScrollerPosition({x:0,y:0,animate:!1}),e._dataGridView.setActiveCell(-1,!0,!0),e._dataGridView.setPreselectedCell(-1)),e._valueModifiedbyAPI||(!(e._editor&&void 0!==e._editor.valueToCommit&&""!==e._editor.valueToCommit&&e._editor.valueToCommit.length>=e.minLengthBeforeSearch)||e.elements.popup&&e.elements.popup.visibleFlag?e.elements.popup&&e.elements.popup.visibleFlag&&e._editor&&void 0!==e._editor.valueToCommit&&e._editor.valueToCommit.length<e.minLengthBeforeSearch&&e._hidePopup():(e._showPopup(),t=!0)),!t&&e.elements.popup&&e.elements.popup.visibleFlag&&L.call(e),e.displayCustomNodeInDropDown&&E.call(e,e._editor.valueToCommit),A.call(e,e._editor.valueToCommit),e.elements.popup&&e.elements.popup.visibleFlag&&e._dataGridView&&(e._dataGridView.setFindStr(e._editor.valueToCommit,!1,void 0,!0,e._hasARegExpFilter),V.call(e))};t.addEventOnElement(this,this._editor,"uncommittedChange",(function(t){if(t.stopPropagation(),e._selectionAllowed=!1,!e._valueModifiedbyAPI){if(_.hide(),e.elements.popup&&e.elements.popup.visibleFlag&&e._editor&&void 0!==e._editor.valueToCommit&&e._editor.valueToCommit.length<e.minLengthBeforeSearch)return void e._hidePopup();T.call(e,-1)}b.call(e,I.INPUT_CHANGE),!e._valueModifiedbyAPI&&e.typeDelayBeforeSearch>0?(this._debouncedlaunchSearch||(this._debouncedlaunchSearch=p.debounce(i,e.typeDelayBeforeSearch)),this._debouncedlaunchSearch()):i(),e.fire("uncommittedChange",t.options)})),t.addEventOnElement(this,this._editor,"change",(function(t){t.stopPropagation(),e._valueModifiedbyAPI||(M.call(e,e._editor.value),e._hidePopup())})),t.addEventOnElement(this,this,"keydown",(function(t){t.keyCode===h.SPACE&&e._selectionAllowed&&!t.actionPerformed?e._manageSpace(t):t.keyCode===h.HOME?e._manageNavigationKey("home",!0):t.keyCode===h.END?e._manageNavigationKey("end",!0):t.keyCode!==h.ENTER||t.actionPerformed||e._manageReturn(t)}),!0)},_manageSpace:function(e){if(this.multiSearchMode&&this.elements.popup&&this.elements.popup.visibleFlag&&this._dataGridView){let t=this._dataGridView.getActiveCellID();if(t>=0){let i=this._dataGridView.getNodeModelAt(t);i&&(i.isSelected()?i.unselect():i.select(),e&&(e.stopPropagation(),e.preventDefault()),this._editor&&this._editor.focus({preventScroll:!0}))}}},_manageReturn:function(e){let t,i=!1;if(this.elements.popup&&this.elements.popup.visibleFlag){if(this._dataGridView){let e=this._dataGridView.getActiveCellID();e>=0&&(t=this._dataGridView.getNodeModelAt(e))}this._hidePopup()}if(t&&(this.allowFreeInputFlag||void 0===t.options.customNode)){let e=!1;if(t.options.customNode&&this.multiSearchMode&&Array.isArray(this.selectedItems)){let i=q(t);for(let t=0;t<this.selectedItems.length;t++)if(this.selectedItems[t].options.customNode&&q(this.selectedItems[t])===i){e=!0;break}}e||t.select(),i=!0}else this._editor.value&&(M.call(this,this._editor.value),i=!0);i&&(e.actionPerformed=i)},_manageNavigationKey:function(e,t){if(_.hide(),b.call(this,I.SHOW_POPUP),this.elements.popup&&this.elements.popup.visibleFlag){if(this._dataGridView){let i=-1,o=this._dataGridView.getActiveCellID();this._selectionAllowed=!0,i=void 0===o||o<0?this._dataGridView.layout.getCellIDFromCoordinates({rowID:"end"===e?this._dataGridView.model.length-1:0,columnID:0}):this._dataGridView.computeCellIDFromActiveCell(e,t),T.call(this,i)}}else this._showPopup();return{preventDefault:!0}},_getDefaultCellHeight:function(){if(this.columnOptions&&this.columnOptions.autoRowHeightFlag||!this._dataGridView.layout||this._dataGridView.layout.getRowHeightFunction)return this.touchMode?40:27;this._dataGridView.layout.getRowHeightFunction=function(){return this._dataGridView.layout.getDefaultCellHeight()}.bind(this)},_delayPopupCreation:function(){if(!this._delayPopupCreationInfos){let i=this,o={target:this,position:"bottom",offset:{x:0,y:4},trigger:"click escape",toggleFlag:!0,forceKeepOrientation:!0,constraint:this.popupConstraint,className:"wux-controls-autoComplete-popup wux-controls-popup",alignment:"near",overlap:!1,shouldDisplayCallback:function(){return L.call(i),!(i._editor&&(!(""!==i._editor.valueToCommit&&void 0!==i._editor.valueToCommit||i._model&&0!==i._model.getRoots().length||Y.call(i))||void 0!==i._editor.valueToCommit&&i._editor.valueToCommit.length<i.minLengthBeforeSearch))},getBody:function(){i._dataGridViewContainer=new e.Element("div"),i._dataGridViewContainer.addClassName("wux-controls-autoComplete-dataGridViewContainer");let o=i.columnOptions&&i.columnOptions.style&&v[i.columnOptions.style]?i.columnOptions.style:"classic",s={treeDocument:i._model,cellSelection:"none",selectionBehavior:{toggle:!0,selectOnPointerUp:!0},showAlternateBackgroundFlag:!1,showRowBorderFlag:!0,selectionStyle:"lightSelectionEdging",rowSelection:i.multiSearchMode?"multiple":"single",selectNextCellOnEnterFlag:!1,layoutOptions:{columnsHeader:!1,rowsHeader:!1},treeNodeCellOptions:v[o],touchMode:i.touchMode},a={autoRowHeightFlag:!1,typeRepresentation:i.typeRepresentation,getCellTypeRepresentation:i.typeRepresentation?void 0:function(e){return i.getTypeRepresentation(e.nodeModel)},getCellValue:function(e){return e.nodeModel?"string"===i.getTypeRepresentation(e.nodeModel)&&"string"==typeof e.nodeModel.options.label&&""!==e.nodeModel.options.label?e.nodeModel.options.label:e.nodeModel.options.value:""},getCellIcons:function(e){let t=e.nodeModel&&e.nodeModel.getIcons?e.nodeModel.getIcons():[];return t&&0!==t.length||!e.nodeModel||!e.nodeModel.options.icon||(t=[e.nodeModel.options.icon]),t},getCellTooltip:function(e){return e.nodeModel&&e.nodeModel.options.tooltip?e.nodeModel.options.tooltip:i._dataGridView?i._dataGridView.getCellDefaultTooltip(e):void 0}},d=Object.assign(a,i.columnOptions),r={dataIndex:"tree",text:"",showTextFlag:!1,icon:void 0,minWidth:40,width:"auto",visibleFlag:!0,editableFlag:!1,editionPolicy:"EditionOnDoubleClick",resizableFlag:!1,selectableFlag:!1,sortableFlag:!1,groupableFlag:!1,printableFlag:!1,massUpdateAllowedFlag:!1,splittableFlag:!1,compareFunctionCB:void 0,autoSizePadding:0,pinned:"unpinned",onCellRequest:void 0,hasCellValue:void 0,setCellValue:void 0,getCellValueForCopy:void 0,getCellValueForSort:void 0,processCellValueFromPaste:void 0,getCellValueForExport:void 0,getCellValueForSort:void 0,getCellKPIColor:void 0,getCellGroupingKey:void 0,getGroupingNodeOptions:void 0};return d=Object.assign(d,r),s.columns=[d],i._dataGridView=new n(s),i._dataGridView._setScrollbarsHidden({horizontal:!0}),i.customFilterMessage&&(i._dataGridView.placeholder=i.customFilterMessage),i._displayDGVLoader&&(N.call(i),i._displayDGVLoader=void 0),i._dataGridView.getContent().addClassName("wux-controls-autoComplete-dataGridView"),i._dataGridView.inject(i._dataGridViewContainer),t.addEventOnElement(i,i._dataGridView,"focus",(function(e){i._editor&&i._editor._onFocusReceived(!1)})),t.addEventOnElement(i,i._dataGridView,"click",(function(e){if(void 0!==this._preselectedCellStableID&&"object"==typeof this._preselectedCellStableID){let e=this._preselectedCellStableID.nodeModel;if(e){let t=q(e);if(i.selectedItems&&i.selectedItems.options){t===q(i.selectedItems)&&(i._editor.valueToCommit=t)}}}})),t.addEventOnElement(i,i._dataGridView,"preselectedCellChange",(function(e){if(!i._selectionChips||!i._selectionChips._items||0===i._selectionChips._items.length)return;let t=!1;e.dsModel._preselectedCellStableID&&i._selectionChips._items.forEach((function(o){e.dsModel._preselectedCellStableID.nodeModel===o.chipOptions.value&&(i._selectionChips.selectChip(o),t=!0)})),void 0!==e.dsModel._preselectedCellStableID&&t||i._selectionChips._items.forEach((function(e){i._selectionChips.unselectChip(e)})),e.stopPropagation()})),i._dataGridView._getScroller().onScrollEnd((function(){(i.popupSizeAdjustPolicy===l.SizeAdjustPolicyEnum.AdjustToVisibleContents||i._lockPopupVisibilityChange)&&(i._lockPopupVisibilityChange=!1,V.call(i))})),i._dataGridViewContainer},overlapCallback:O.bind(this),beforeDisplayCallback:function(){i._lockPopupVisibilityChange=!0,i.elements.popup.getContent().setStyle("visibility","hidden"),i._popupVisibility=!1;let e=0,t=0;if(!i.multiSearchMode&&i._editor&&i._editor.elements.inputField){const o=window.getComputedStyle(i._editor.elements.inputField);0===parseInt(o.borderLeft.slice(0,-2))&&(e=-1,t=2),i.elements.popup.offset={x:e,y:4}}{let e="";i._autoCompleteState!==w.DISPLAY_SEARCH&&(i.displayCustomNodeInDropDown&&E.call(i,i._editor.valueToCommit),i._dataGridView&&(i._dataGridView.setActiveCell(-1,!0,!0),i._dataGridView.setPreselectedCell(-1)),A.call(i,""),i._dataGridView&&i._dataGridView.setFindStr(e,!1,void 0,!0))}i._DGVContainerFitWidth=i.elements.container.getBoundingClientRect().width+t,i._DGVContainerMinWidth=i._DGVContainerFitWidth,i._DGVContainerWidth=i._DGVContainerFitWidth,i._dataGridViewContainer.style.width=i._DGVContainerWidth+"px",i._lockPopupVisibilityChange=!1}},s=function(e){i.elements.popup=e,i._editor.preventBlurForTargetedElements([i.elements.popup]),t.addEventOnElement(i,e,"show",(async function(e){e.stopPropagation(),b.call(i,I.SHOW_POPUP),i._dataGridView.subscribeOnceToAllCellsRendered((function(){i._dataGridView.layout.prepareLayout(),S.call(i,i._popupConstraintsObject);X.call(i)?i._lockPopupVisibilityChange=!0:V.call(i,i._popupConstraintsObject),i.fire("show")}))})),t.addEventOnElement(i,e,"hide",(function(e){e.stopPropagation(),b.call(i,I.HIDE_POPUP),i.fire("hide")}))};this._delayPopupCreationInfos=l.delayPopupCreation(o,s)}},_applyProperties:function(e){if(this._parent(e),this.isDirty("placeholder")&&this._applyPlaceholder(e.placeholder),this.isDirty("multiSearchMode")&&this._applyMultiSearchMode(e.multiSearchMode),this.isDirty("elementsTree")&&this._applyElementsTree(e.elementsTree),this.isDirty("value")&&e&&e.hasOwnProperty("value"))this._applyValue(e.value);else if(this.isDirty("selectedItems")&&e&&e.hasOwnProperty("selectedItems"))this._applySelectedItems(e.selectedItems);else if(this.isDirty("elementsTree")&&this.elementsTree&&this.elementsTree instanceof a){let e=this.elementsTree.getXSO().get();e.length>0&&B.call(this,this._valueOperation,{operationType:y.ADD,noOfItemsModified:e.length},(function(){this.selectedItems=e}))}this.isDirty("customFilterMessage")&&this._applyCustomFilterMessage(e.customFilterMessage),this.isDirty("allowResetToUndefinedByUIFlag")&&this._applyAllowResetToUndefinedByUIFlag(e.allowResetToUndefinedByUIFlag),this.isDirty("displayLoader")&&this._applyDisplayLoader()},_applyDisabled:function(){this._parent(),this._editor&&(this._editor.disabled=this.disabled),this._selectionChips&&(this._selectionChips.disabled=this.disabled)},_applyPlaceholder:function(){this._editor&&(this._editor.placeholder=this.placeholder,this._updateEditorMinWidth())},_updateEditorMinWidth:function(){if(this._editor){let e=40;if(this.placeholder){let i,o,s,l,n;this.touchMode||u.getTouchMode()?(i=14,o=22,s=2,l=40,n=93):(i=12,o=12,s=2,l=40,n=80);let a=t.computeStringWidth(this.placeholder,i,"Arial",!1,!1);e=Math.max(Math.min(a+o+s,n),l)}this._editor.getContent().setStyle("min-width",e+"px"),this._editorMinWidth=e}},_applyMultiSearchMode:function(e){this.multiSearchMode?(this._editor&&!0===this.elements.container.hasChildNodes()&&this._editor.remove(),void 0!==this.elements.popup&&B.call(this,this._valueModifiedbyAPI,!0,(function(){this._dataGridView.rowSelection="multiple"})),this._selectionChips||k.call(this),this._editor&&this._editor.elements.inputField&&this._selectionChips&&!1===this.elements.container.hasChildNodes()&&(this._editor.displayStyle="lite",this._selectionChips.addLastWidget(this._editor),this._selectionChips.inject(this.elements.container))):(this._selectionChips&&!0===this.elements.container.hasChildNodes()&&this._selectionChips.remove(),this.elements.popup&&B.call(this,this._valueModifiedbyAPI,!0,(function(){this._dataGridView.rowSelection="single"})),this._editor&&this._editor.elements.inputField&&!1===this.elements.container.hasChildNodes()&&(this._editor.displayStyle="text",this._editor.inject(this.elements.container))),this._applyAllowResetToUndefinedByUIFlag(),void 0!==e&&this.multiSearchMode!==e&&(this.isDirty("value")||this.isDirty("selectedItems")||(B.call(this,this._valueModifiedbyAPI,!0,(function(){this._model&&(this._model.getXSO().isEmpty()||this._model.getXSO().empty())})),this._properties.value.value=void 0,this._properties.selectedItems.value=void 0,this._selectionChips&&this._selectionChips.removeAllChips(),this._editor&&(this._editor.valueToCommit="",this._editor.value="")))},_applyValue:function(e,t){if(void 0===this.value)return this.selectedItems=[],b.call(this,I.SELECTION_CHANGE),void(this._modelLoaded||this.fire("change"));let i=C.call(this,this.value);this.multiSearchMode?Array.isArray(this.value)||(this._properties.value.value=i):Array.isArray(this.value)&&(this._properties.value.value=i[0]),B.call(this,this._valueModifiedbyAPI,!0,(function(){let o=[];const s=H.call(this,i);for(let l=0;i.length>l;l++){let n=s[l];if(!n&&i[l]&&""!==i[l])if(this.allowFreeInputFlag||this.elementsTree instanceof Function){let e,t,o=i[l],s=i[l];i[l]instanceof d?(s=i[l].options.value,o=i[l].options.label,e=i[l].options.icon,t=i[l].options.icons,o=o||s):"object"==typeof i[l]&&this.columnOptions&&this.columnOptions.typeRepresentation&&"object"!=typeof i[l].value?(o=i[l].label,s=i[l]):"object"==typeof i[l]&&i[l].value&&(o=i[l].label?i[l].label:i[l].value,s=i[l].value,e=i[l].icon,t=i[l].icons),t&&e?t.push(e):e&&(t=[e]),n=new d({label:o,value:s,icon:e,icons:t,customNode:!0})}else if(!this.multiSearchMode){if(this._modelLoaded)return void(this.value=e);this._editor.value="object"==typeof t?t.label||t.value:t}n&&R(o,[n])}this.selectedItems=this.multiSearchMode?o:o[0],b.call(this,I.SELECTION_CHANGE)})),P.call(this)},_applyElementsTree:function(e){this._modelLoaded=!1,(this.elements.popup&&this.elements.popup.visibleFlag||!this.elementsTree||this.elementsTree instanceof a||Array.isArray(this.elementsTree))&&G.call(this,this.elementsTree,!this.isDirty("value")&&!this.isDirty("selectedItems"))},filterItems:function(e,t){if(this._model){let i=t&&t.property||this.defaultFilterOptions&&this.defaultFilterOptions.property||"label",o=t&&t.type||this.defaultFilterOptions&&this.defaultFilterOptions.type||"contains",s=t&&t.filterId||this.defaultFilterOptions&&this.defaultFilterOptions.filterId||"stringRegexp",l=t?t.filterOptions||this.defaultFilterOptions&&this.defaultFilterOptions.filterOptions:void 0;"stringRegExp"===s&&(this._hasARegExpFilter="stringRegexp"===s),this._model.getFilterManager().setPropertyFilterModel(i,{filterId:s,filterModel:{condition1:{type:o,filter:e}},filterOptions:l})}},_getFirstMatchingCellID:function(){let e=-1;if(!this._dataGridView||!this._model)return e;let t=this._model.getFilterManager();return this._model.processDescendants({processNode:i=>{if(i.nodeModel.canBeFiltered(t.propertyId)&&!t.isDataFiltered(i.nodeModel))return e=this._dataGridView.layout.getCellIDFromCoordinates({rowID:i.nodeModel._getRowID(),columnID:0}),{stopProcessing:!0}},onlyVisibleNodes:!0}),e},_applySelectedItems:function(e){T.call(this,-1);let t=this,i=C.call(this,this.selectedItems);this.multiSearchMode?Array.isArray(this.selectedItems)||(this._properties.selectedItems.value=i):Array.isArray(this.selectedItems)&&(this._properties.selectedItems.value=i[0]),b.call(this,I.SELECTION_CHANGE);let o=[];for(let e=0;e<i.length;e++)r.pushUnique(o,i[e]);i.length!==o.length&&(i=o,this.multiSearchMode?this._properties.selectedItems.value=i:this._properties.selectedItems.value=i[0]);const s=H.call(this,i);for(let e=0;e<s.length;e++)s[e]||(i[e].options.customNode=!0);if(this.multiSearchMode){let e=[];B.call(this,this._valueModifiedbyAPI,!0,(function(){let e=[];if(this._model&&!this._model.getXSO().isEmpty()){let t=this._model.getXSO(),o=t.get();for(let s=0;s<o.length;s++)-1===i.indexOf(o[s])?t.remove(o[s]):e.push(o[s])}for(let t=0;i.length>t;t++)-1===e.indexOf(i[t])&&i[t].select();if(this._selectionChips){let e,t=[];i.forEach((function(i){e=this.getChipInfo(i),r.pushUnique(t,{label:e.label,value:i,icon:e.icon,tooltip:e.tooltip||i.options.tooltip,_iconOptions:e._iconOptions})}),this),this._selectionChips.removeAllChips(),this._selectionChips.addChips(t)}A.call(this,""),this._editor&&(this._editor.valueToCommit="",this._editor.value="")})),i.forEach((function(i){let o=z(i,t);e.push(o)})),(this._properties.value.value||e&&e.length>0)&&(this._properties.value.value=e)}else B.call(this,this._valueModifiedbyAPI,!0,(function(){let e;this._valueOperation.operationType!==y.REMOVE&&(this._model&&!this._model.getXSO().isEmpty()&&this._model.getXSO().empty(),i.length>0&&i[0]&&i[0].select()),this._editor&&(this._editor.value=i[0]?q(i[0]):""),i[0]&&(e=z(i[0],this)),this._properties.value.value=e}));E.call(this,"");let l=[];if(e)for(let t=0;t<e.length;t++)l.push(z(e[t],this));this.fire("change",{oldValue:l})},hide:function(){_.hide(),this._hidePopup(),this._parent()},showPopup:function(){this._showPopup()},hidePopup:function(){this._hidePopup()},_showPopup:function(){if(this.elements.popup){if(this.elements.popup.visibleFlag)return;this.elements.popup.visibleFlag=!0}else this._delayPopupCreationInfos&&"function"==typeof this._delayPopupCreationInfos.createVisiblePopup&&this._delayPopupCreationInfos.createVisiblePopup()},_hidePopup:function(){if(this.elements.popup&&this.elements.popup.visibleFlag&&(this.elements.popup.visibleFlag=!1,b.call(this,I.HIDE_POPUP),this._editor)){let e=this;setTimeout((function(){e._editor&&!e._editor._isFocused()&&e._editor._onFocusReceived(!1)}),1)}},_onFocusReceived:function(){this._parent(),this._editor&&this._editor._onFocusReceived()},_giveFocus:function(){this._parent(),this._editor&&this._editor._giveFocus()},_applyCustomFilterMessage:function(){this._dataGridView&&(this._dataGridView.placeholder=this.customFilterMessage),this._customFilterMessageWidth=void 0},_applyAllowResetToUndefinedByUIFlag:function(){this._editor&&(this._editor.displayClearFieldButtonFlag=this.allowResetToUndefinedByUIFlag&&!this.multiSearchMode)},_applyTouchMode:function(){this._parent(),this._getCurrentTouchMode()?this.elements.container.setAttributeNode(document.createAttribute("touch-mode")):this.elements.container.removeAttribute("touch-mode"),this._editor&&(this._editor.touchMode=this.touchMode),this._selectionChips&&(this._selectionChips.touchMode=this.touchMode),this._dataGridView&&(this._dataGridView.touchMode=this.touchMode),this._customFilterMessageWidth=void 0},_applyDisplayLoader:function(){let t=!("boolean"==typeof this.displayLoader&&!this.displayLoader);if(t&&this._loaderStarted)return void this._updateLoaderValue();if(!t){this._loaderStarted=!1;let e=function(){if(this._loadingContainer&&!this._loaderStarted){this._loadingContainer.remove();let e=this._dataGridView.getContent();e&&e.removeClassName("wux-controls-autoComplete-dataGridView-loading"),this._dataGridViewContainer.removeClassName("wux-controls-autoComplete-dataGridViewContainer-withLoader")}}.bind(this);return void(this._loader&&(this.__ODT_TEST_NO_ANIMATION?(this._loader.off(),e()):(this._loader._modelEvents.subscribeOnce({event:"END"},e),this._loader.off())))}this._loaderStarted=!0;let i=function(){if(!this._loaderStarted)return;this._loadingContainer||(this._loadingContainer=new e.Element("div"),this._loadingContainer.addClassName("wux-controls-autoComplete-loader-container"),this._loader=new m({text:c.get("AutoComplete").Loading_Alt}),this._loader.getContent().addClassName("wux-controls-autoComplete-loader"),this._loader.__underDefaultHeightUseAltValueDisplay=!0,this._loader.inject(this._loadingContainer)),this._loader.touchMode=this.touchMode,this._loader.elements.progressBar.touchMode=this.touchMode;let t=this._dataGridView.layout.getDefaultCellHeight();t+=1,this._loader.height=this.touchMode?22:16,this._loader.text=c.get("AutoComplete").Loading_Alt,this._updateLoaderValue(),this._loader.on(),this._loadingContainer.style.setProperty("--autocomplete-loader-container-height",t+"");let i=this._dataGridView.getContent();i&&(i.addClassName("wux-controls-autoComplete-dataGridView-loading"),i.style.setProperty("--autocomplete-loader-container-height",t+"")),this._dataGridViewContainer.appendChild(this._loadingContainer),this._dataGridViewContainer.addClassName("wux-controls-autoComplete-dataGridViewContainer-withLoader"),this._dataGridViewContainer.style.setProperty("--autocomplete-loader-container-height",t+"")}.bind(this);this.elements.popup&&this.elements.popup.visibleFlag?i():this.addEventListener("show",i,{once:!0})},_updateLoaderValue:function(){this._loader&&("number"==typeof this.displayLoader?this._loader.update(this.displayLoader+"%"):this._loader.update(""))},_getElementToFocus:function(){return this._editor._getElementToFocus()},getValueToCommit:function(){return this._editor?this._editor.valueToCommit:""},destroy:function(){this._dataGridView&&(this._dataGridView.destroy(),delete this._dataGridView),this._editor&&(this._editor.destroy(),delete this._editor),this._selectionChips&&(this._selectionChips.destroy(),delete this._selectionChips),this.elements.popup&&this.elements.popup.visibleFlag&&(this.elements.popup.visibleFlag=!1),this._parent()}})})),define("DS/WUXAutoComplete/typings/types",[],(()=>{}));