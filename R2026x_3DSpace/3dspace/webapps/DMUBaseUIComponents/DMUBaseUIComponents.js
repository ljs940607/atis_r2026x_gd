define("DS/DMUBaseUIComponents/DMUCommonCommandsComponent",[],(function(){"use strict";let e=null,t=null,n=null,i=[{id:"AnnotationSwitchOnOff",type:"check",localStorageID:"CAT3DAnnotationSwitchOnOffCmd"},{id:"AnnotationBlanking",type:"check",localStorageID:"CAT3DAnnotationBlankingCmd"},{id:"CATRelatedData3DGridHdr",type:"check",localStorageID:"CATRelatedData3DGridCmd"},{id:"CATWebUXGenerateIssueHdr",type:"default",init:"true"},{id:"CATWebUXGenerateIssueTemplateHdr",type:"default",init:"true"},{id:"CATWebUXGenerateTaskHdr",type:"default",init:"true"},{id:"CATWebUXGenerateCAHdr",type:"default",init:"true"},{id:"PIMWebUXGenerateTaskHdr",type:"default",init:"true",enable:"false"},{id:"PIMWebUXGenerateIssueHdr",type:"default",init:"true",enable:"false"},{id:"PIMWebUXGenerateIssueTemplateHdr",type:"default",init:"true",enable:"false"},{id:"PIMWebUXGenerateCAHdr",type:"default",init:"true",enable:"false"},{id:"DMUCopyHdr",type:"default",enable:"false"},{id:"DMUCutHdr",type:"default",enable:"false"},{id:"DMUPasteHdr",type:"default",enable:"false"},{id:"DMUPasteSpecialHdr",type:"default",enable:"false"},{id:"CAT3DComposeExamineSelectionHdr",type:"default",enable:"false"},{id:"UPSAuthReplaceByExisting",type:"default",enable:"false"},{id:"UPSAuthUnparent",type:"default",enable:"false"},{id:"DMUSwitch3DMarkersResponsiveDisplayHdr",type:"check",localStorageID:"DMU3DMarkersResponsiveDisplay"},{id:"CATW3DBoxesHdr",type:"check",localStorageID:"CATW3DBoxesCmd"},{id:"CATRevealRelatedDataHdr",type:"check",localStorageID:"CATRevealRelatedDataCmd"},{id:"CAT3DComposeMoveHdr",type:"default"}],o=function(e){for(let t=0;t<i.length;t++)if(i[t].id===e)return i[t];return!1};return class{constructor(i){this.initialize=function(){e=this,t=e.getExecutionContext();let a=i.commandIds;return t&&t.getComponent&&(n=t.getComponent(WAfrStandardComponentKey.HandlerComponent)),new Promise((async e=>{if(a&&a.length)for(let e=0;e<a.length;e++){let t=o(a[e].id);t&&("check"===t.type?"CATW3DBoxesHdr"!==t.id||localStorage.getItem(t.localStorageID)?"CATRevealRelatedDataHdr"!==t.id||localStorage.getItem(t.localStorageID)?(await n.setCheckState({id:t.id,state:"true"===localStorage.getItem(t.localStorageID)}),"AnnotationSwitchOnOff"===t.id&&("true"===localStorage.getItem(t.localStorageID)?(n.enableCheck("AnnotationFilter"),n.enableCheck("AnnotationBrowser"),n.enableCheck("AnnotationSemanticBrowser")):(n.disableCheck("AnnotationFilter"),n.disableCheck("AnnotationBrowser"),n.disableCheck("AnnotationSemanticBrowser")))):(await n.setCheckState({id:t.id,state:!0}),await n.setCheckState({id:t.id,state:!1})):await n.setCheckState({id:t.id,state:!0}):"default"===t.type&&("true"===t.init&&await n.executeHandler({id:t.id,args:{init:!0}}),t.enable&&("true"===t.enable?n.enableHandler(t.id):n.disableHandler(t.id))))}e()}))},this.clean=function(){return new Promise((e=>{e()}))},this.destroy=function(){return new Promise((e=>{e()}))},this.canBeParallelized=function(){return!1}}}})),define("DS/DMUBaseUIComponents/DMURichTextServices",["require","exports","DS/CKEditor/CKEditor","DS/PADUtils/PADUtilsServices","DS/WAFData/WAFData","DS/PADUtils/PADContext","DS/WebappsUtils/WebappsUtils","UWA/Core","DS/DMUBaseExperience/DMUContextManager","i18n!DS/DMUBaseUIComponents/assets/nls/DMUBaseUIComponents"],(function(e,t,n,i,o,a,s,r,l,c){"use strict";const d="p;p{margin-*};blockquote;strong;s;u;li;ul;ol;em;a[href];br;span(DMUCKEditorReferenceCheck)[data-id,contenteditable]";["openlink","mentions","balloontoolbar","balloonpanel","autocomplete","textwatcher"].forEach((e=>{n.plugins.addExternal(e,s.getWebappsAssetUrl("DMUBaseUIExtComponents",`ckeditor/plugins/${e}/`),"plugin.js")}));const u={1:{icon:"wux-ui-3ds-i-question",color:"rgb(0, 125, 163)"},2:{icon:"wux-ui-3ds-check",color:"#477738"},3:{icon:"wux-ui-3ds-wrong",color:"#ea4f37"}},p={1:{icon:"wux-ui-3ds-attention",color:"#007DA3"},2:{icon:"wux-ui-3ds-level-low",color:"rgb(71,119,56)"},3:{icon:"wux-ui-3ds-level-medium",color:"rgb(232,123,0)"},4:{icon:"wux-ui-3ds-level-high",color:"rgb(234,79,55)"},5:{icon:"wux-ui-3ds-check",color:"rgb(71, 119, 56)"},6:{icon:"wux-ui-3ds-alert",color:"rgb(153, 7, 7)"}};n.on("dialogDefinition",(function(e){let t=e.data.name,i=e.data.definition;"link"===t&&(i.minHeight=50,i.resizable=n.DIALOG_RESIZE_NONE,i.buttons[0]=i.buttons[0].override({class:"wux-controls-abstract wux-controls-button wux-ui-state-primary wux-ui-style-normal"}),i.buttons[1]=i.buttons[1].override({class:"wux-controls-abstract wux-controls-button wux-ui-state-secondary wux-ui-style-normal"}),i.contents[0].elements[0].className="DMUCKEditorDialogNoDisplay",i.contents[0].elements[1].className="DMUCKEditorDialogNoDisplay",i.contents[0].elements[2].children[0].children[0].className="DMUCKEditorDialogNoDisplay",i.dialog.parts.dialog.getElementsByTag("td").getItem(0).setStyle("borderRadius","6px"),i.dialog.parts.dialog.getElementsByTag("td").getItem(0).setStyle("overflow","hidden"),i.dialog.parts.title.setStyles({background:"#FFFFFF",padding:"5px",fontSize:"14px"}),i.dialog.parts.close.setStyle("top ","4px"),i.dialog.parts.footer.setStyle("background ","#f1f1f1"))}));let m=window.widget&&window.widget.lang;"zh"===m&&(m+="-cn");const g={title:!1,extraPlugins:"balloontoolbar,openlink,link,liststyle",removePlugins:"liststyle,elementspath,magicline,exportpdf,copyformatting,editorplaceholder,resize,iframe,smiley,forms,maximize,print,save,table,tabletools,tableselection,uploadwidget,uploadimage,showblocks,showborders,contextmenu",linkShowAdvancedTab:!1,linkShowTargetTab:!1,linkDefaultProtocol:"https://",language:m,dialog_noConfirmCancel:!0,toolbar:[],height:150,startupFocus:!1,toolbarLocation:"bottom",allowedContent:d,shiftEnterMode:n.ENTER_P,removeFormatTags:"a,b,big,cite,code,del,dfn,em,font,i,ins,kbd,q,s,samp,small,span,strike,strong,sub,sup,tt,u,var",removeButtons:"PasteFromWord",enableContextMenu:!1,on:{paste:function(e){const t=e.data,i=e.editor.dataProcessor,o=new n.filter(d);t.dataValue=i.toHtml(t.dataValue,{filter:o,fixForBody:!1})},instanceReady:function(e){let t=e.editor;t.dataProcessor.writer.setRules("p",{breakAfterClose:!1}),t.ui.addButton("OpenLink",{command:"openLink",toolbar:"links,50",label:c.openLink});t.balloonToolbars.create({cssSelector:"div"}).toolbar.addItems({bold:t.ui.create("Bold"),italic:t.ui.create("Italic"),underline:t.ui.create("Underline"),strike:t.ui.create("Strike"),sep1:t.ui.create("-"),numberedList:t.ui.create("NumberedList"),bulletedList:t.ui.create("BulletedList"),sep2:t.ui.create("-"),outdent:t.ui.create("Outdent"),indent:t.ui.create("Indent"),sep3:t.ui.create("-"),removeFormat:t.ui.create("RemoveFormat"),sep4:t.ui.create("-"),link:t.ui.create("Link")}),t.balloonToolbars.create({buttons:"OpenLink,Link,Unlink",cssSelector:"a[href]"})}}};let f;function h(e,t){let n="",i=t;for(;i;)n+="&#32;&#32;&#32;&#32;",i=i.getAscendant("li");let o=1;t.children.forEach((t=>{const i="ol"===e?o+". ":"- ";"li"===t.name?(t.setHtml("&#13;"+n+i+t.getHtml()),o++):t.setHtml(n+t.getHtml())}))}function w(e){let t=document.createElement("textarea");return t.innerHTML=e,t.value}class v{static getMentionsFromContent(e){const t=/<a href="[^"]+login=([^"]+)&[^"]+type=([^&]+)&[^"]+">@([^<]+)<\/a>/g;let n,i=[];for(;null!==(n=t.exec(e));){const e=w(n[1].toLocaleLowerCase()),t=n[2].toLocaleLowerCase(),o=n[3];i.push({id:e,name:o,type:t})}return i}static createRichTextElement({className:e,allowMentions:t}={}){const s=r.createElement("div",{class:e});s.setAttribute("contenteditable","true"),s.addEventListener("contextmenu",(e=>{e.stopImmediatePropagation()}));const c=t?{...g,extraPlugins:g.extraPlugins+",mentions",mentions:[{feed:async function(e,t){var a,s;null===(s=null===(a=n.currentInstance)||void 0===a?void 0:a.balloonToolbars)||void 0===s||s.hide();const r=await("boolean"==typeof f?Promise.resolve(f):new Promise((function(e){window.require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],(function(t){t.getServiceUrl({serviceName:"usersgroup",platformId:i.getPlatformId(),onComplete:function(t){f="string"==typeof t&&""!==t,e(f)},onFailure:function(){f=!1,e(f)}})}))}))),l=i.get3DSearchUrl()+"/search";o.authenticatedRequest(l,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({start:0,nresults:20,tenant:i.getPlatformId(),source:["swym"].concat(r?["usersgroup"]:[]),specific_source_parameter:{usersgroup:{additional_query:`AND [ds6w:label]:(${encodeURIComponent(e.query)}*)`},swym:{additional_query:` AND personOrGroup:(${encodeURIComponent(e.query)})`}},select_predicate:["ds6w:label","ds6w:type"],label:"DMUCommentUserMention-"+Date.now(),query:'[ds6w:type]:("foaf:Group" OR "pno:Person")',with_synthesis:!1,with_synthesis_attribute:!1,locale:"en"}),onComplete:function(e){const n=JSON.parse(e).results;n&&t(n.map((e=>{var t,n,i;const o=null===(t=e.attributes.find((e=>"resourceid"===e.name)))||void 0===t?void 0:t.value;if(!o)return null;const a=/(<uuid:)/g.test(o)?o:null===(n=/:(.*)/g.exec(o))||void 0===n?void 0:n.at(1);if(!a)return null;const s=null===(i=e.attributes.find((e=>"ds6w:type"===e.name)))||void 0===i?void 0:i.value.split(":")[1].toLowerCase();return{id:a.toUpperCase(),type:s,avatar:e.attributes.find((e=>"preview_url"===e.name)).value,fullname:e.attributes.find((e=>"ds6w:label"===e.name)).value}})).filter(Boolean))}})},minChars:2,marker:"@",itemTemplate:'<li data-id="{id}" class="DMUCKEditorMentionListItem"><img src="{avatar}" /><span>{fullname} ({id})</span></li>',outputTemplate:`<a href="${i.getPlatformURL("3DDashboard")}//#app:X3DPRFL_AP/content:url=${encodeURIComponent(i.getPlatformURL("3DSwym"))}&login={id}&type={type}&facet=0">@{fullname}</a><span>&nbsp;</span>`},{feed:function(e,t){var i,o,s,r;null===(o=null===(i=n.currentInstance)||void 0===i?void 0:i.balloonToolbars)||void 0===o||o.hide();const c=l.getReviewContext({context:a.get()}),d=null===(s=null==c?void 0:c.getValidation())||void 0===s?void 0:s.getChecks(),m=(null===(r=null==c?void 0:c.getValidation())||void 0===r?void 0:r.getHighlights())||[];d&&d.length&&t(d.map((t=>{if(!t.getAttribute("sName").toLowerCase().includes(e.query.toLowerCase()))return null;const n=t.getAttribute("sPlmID"),i=m.filter((e=>(e.getAttribute("lAssociatedChecks")||[]).includes(n)));let o="";i.forEach((e=>{const t=e.getAttribute("sRating"),n=5===parseInt(t)?0:parseInt(t),i=5===parseInt(o)?0:parseInt(o);(!o||n>=i)&&(o=t)}));const a=o?p[o]:u[t.getAttribute("sStatus")]||u[1];return{id:n,checkName:t.getAttribute("sName"),status:t.getAttribute("sStatus"),statusIconClass:a.icon,statusColor:a.color}})).filter(Boolean))},minChars:0,marker:"&",itemTemplate:'<li data-id="{id}" class="DMUCKEditorMentionListItem"><span class="wux-ui-3ds {statusIconClass}" style="color:{statusColor}"></span><span>&nbsp;{checkName}</span></li>',outputTemplate:'<span data-id="{id}" class=DMUCKEditorReferenceCheck contenteditable="false">{checkName}</span>&nbsp;'}]}:g;let d=n.inline(s,c);const m=[];let h;d.on("contentDom",(function(){let e=d.editable();e&&e.attachListener(e,"click",(function(t){const i=t.data.getTarget();let o=new n.dom.elementPath(i,e).contains("a");if(o&&2!==t.data.$.button&&o.isReadOnly())return void window.open(o.getAttribute("href"));let a=new n.dom.elementPath(i,e).contains("span",!1,!0);if(a&&a.hasClass("DMUCKEditorReferenceCheck")&&2!==t.data.$.button&&m.length){let e=!1;if(!d.readOnly){const n=i.$.firstChild;let o=document.createRange();o.selectNodeContents(n);let a=o.getClientRects();if(a){const n=a[0];n&&t.data.$.clientX>n.x+n.width&&(e=!0)}}if(e)a.remove();else{const e=a.$.dataset.id;m.forEach((t=>t({id:e})))}}}))})),d.on("key",(e=>{13===e.data.keyCode&&(e.cancel(),d.focusManager.blur(),d.element.$.blur())})),d.on("focus",(()=>{s.setAttribute("spellcheck",!0)})),d.on("blur",(()=>{s.setAttribute("spellcheck",!1)}));let w=Promise.resolve();const D={focus:()=>{s.focus(),d.focus()},destroy:()=>{m.length=0,d.destroy(),s.destroy()},setReadOnly:e=>{h&&clearInterval(h),d.editable()?d.setReadOnly(e):h=setInterval((()=>{d.editable()&&(clearInterval(h),d.setReadOnly(e))}),100)},blur:()=>d.focusManager.blur(!0),addEventListener:(e,t)=>{if("onNewMentions"===e){let e;d.on("focus",(()=>{const t=d.getData();e=v.getMentionsFromContent(t)})),d.on("blur",(()=>{const n=d.getData();let i=v.getMentionsFromContent(n).filter((t=>!(null==e?void 0:e.some((e=>e.id===t.id)))));i.length&&t(i)}))}else"onCheckSelected"===e?m.push(t):d.on("blur",(()=>{const e=d.getData();d.checkDirty()&&(t(e),d.resetDirty())}))},setData:e=>(w=new Promise((t=>{d.setData(e,{callback:()=>t()})})),w),getData:()=>d.getData(),inject:e=>(e.appendChild(s),D),selectText:()=>{w.then((()=>{var e,t;null===(e=window.getSelection())||void 0===e||e.removeAllRanges();let n=document.createRange();n.selectNodeContents(s),null===(t=window.getSelection())||void 0===t||t.addRange(n),D.focus()}))}};return D}static formatRichTextToExportToPDF(e){const t=new n.htmlParser.filter({elements:{p:function(e){e.setHtml("&#13;"+e.getHtml())},strong:function(e){e.attributes.style="font-weight:bold"},b:function(e){e.attributes.style="font-weight:bold"},em:function(e){e.attributes.style="font-style:italic"},i:function(e){e.attributes.style="font-style:italic"},u:function(e){e.attributes.style="text-decoration:underline"},s:function(e){e.attributes.style="text-decoration:line-through"},ol:function(e){h("ol",e),e.replaceWithChildren()},ul:function(e){h("ul",e),e.replaceWithChildren()},a:function(e){e.setHtml(e.getHtml()+` (<span style="text-decoration:underline">${e.attributes.href.replaceAll("&","&amp;")}</span>)`),e.attributes.style="color:#368EC4",delete e.attributes.href}}}),i=new n.htmlParser.filter({elementNames:[[/^strong$/,"span"],[/^em$/,"span"],[/^p$/,"span"],[/^i$/,"span"],[/^u$/,"span"],[/^s$/,"span"],[/^a$/,"span"],[/^li$/,"span"],[/^ol$/,"span"],[/^ul$/,"span"]]}),o=n.htmlParser.fragment.fromHtml(e),a=new n.htmlParser.basicWriter;return t.applyTo(o),i.applyTo(o),o.writeHtml(a),a.getHtml().replace("&#13;","").replaceAll("&#13;","\n").replaceAll(/<br ?\/?>/g,"\n").replaceAll("&nbsp;","&#32;")}}return v})),define("DS/DMUBaseUIComponents/DMUSearchMembersServices",["UWA/Core","DS/PADUtils/PADUtilsServices","DS/WAFData/WAFData","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/SearchUtils","i18n!DS/DMUBaseUIComponents/assets/nls/DMUBaseUIComponents"],(function(e,t,n,i,o,a){"use strict";var s=function(t){var n,o=window.widget;return n=t&&e.is(t.securityContexts,"string")?t.securityContexts:i.getSetting("pad_security_ctx"),t&&!1===t.encode?n="ctx::"+decodeURIComponent(i.getSetting("pad_security_ctx")):t&&!0===t.encode&&void 0!==t.securityContexts&&(n="ctx::"+encodeURIComponent(n)),{Accept:"application/json","Content-Type":"application/json","Accept-Language":o.lang,SecurityContext:n}};return{getMembers:function(i){var o={method:"POST"};(i=e.is(i)?i:{}).isfederated=!0,o.headers=s({encode:!0});var a=i.text,r={with_indexing_date:!0,with_nls:!1,label:"yus-1515078503005",locale:"en",select_predicate:["ds6w:label","ds6w:type","ds6w:description","ds6w:identifier","ds6w:responsible","ds6wg:fullname"],select_file:["icon","thumbnail_2d"],query:"OnPremise"===t.getPlatformId()?'((([ds6w:type]:"Person" AND [ds6w:identifier]:(*'+a+'*)) OR ([ds6w:type]:"Person" AND [ds6wg:fullname]:(*'+a+'*)) OR ([ds6w:type]:"Person" AND [firstname]:(*'+a+'*)) OR ([ds6w:type]:"Person" AND [lastname]:(*'+a+'*))) AND policycurrent:"Person.Active")':'((([ds6w:type]:"Person" AND [ds6w:identifier]:(*'+a+'*)) OR ([ds6w:type]:"Person" AND [ds6wg:fullname]:(*'+a+'*))) AND policycurrent:"Person.Active")',order_by:"desc",order_field:"relevance",nresults:1e3,start:"0",source:[],tenant:t.getPlatformId()};o.data=JSON.stringify(r);var l=new Promise((function(e,n){o.onComplete=function(n){let i=JSON.parse(n);var o=[];i&&i.results&&Array.isArray(i.results)&&i.results.forEach((function(e){var n={},i=e.attributes;"OnPremise"===t.getPlatformId()?i.forEach((function(e){"ds6w:what/ds6w:type"===e.name&&(n.type=e.value),"resourceid"===e.name&&(n.id=e.value),"ds6w:identifier"===e.name&&(n.identifier=e.value),"ds6wg:fullname"===e.name&&(n.name=e.value),"type_icon_url"===e.name&&(n.icon=e.value)})):i.forEach((function(e){"ds6w:what/ds6w:type"===e.name&&(n.type=e.value,n.type.includes("foaf")&&(n.type=n.type.slice(5))),"resourceid"===e.name&&(n.id=e.value),"ds6w:identifier"===e.name&&(n.identifier=e.value),"ds6wg:fullname"===e.name&&(n.name=e.value),"type_icon_url"===e.name&&(n.icon=e.value)})),o.push(n)}));e(o)},o.onFailure=function(e){n(e)}}));let c=null;return c=i.platformOptions?i.platformOptions.get3DSearchUrl():t.get3DSearchUrl(),n.authenticatedRequest(c+"/search",o),l},searchMember:function(e){o.inAppsSearch({title:a.membersAdditionPanel[e.roleType.toLowerCase()],default_search_criteria:"",precond:'(flattenedtaxonomies:"types/Person" AND policycurrent:"Person.Active")',multiSel:!0,callback:function(t){for(var n=[],i=0;i<t.length;i++)n.push({objectId:t[i].id,identifier:t[i]["ds6w:identifier"],objectType:t[i]["ds6w:type"],displayType:t[i]["ds6w:type_value"],displayName:t[i]["ds6w:label"],serviceId:t[i].sourceid});var o={data:{}};o.data.items=n,e.onSearchOkButtonClicked(o)},cancel:function(){}})}}})),define("DS/DMUBaseUIComponents/DMUCommonWidgetComponent",["DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSharedSettings","DS/PADServices/utils/GlobalModelEvents","DS/DMUBaseExperience/DMUContextManager","UWA/Core","DS/Controls/Loader","i18n!DS/DMUBaseUIComponents/assets/nls/DMUBaseUIComponents"],(function(e,t,n,i,o,a,s){"use strict";let r,l,c={CATA3I_AP:{uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXLandingPageSync"]},CATC3D_AP:{uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXAuthoring3D","ENXLandingPageSync"]},ENOR3D_AP:{uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXEnrich","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXEnrich","ENXLandingPageSync"]},ENOR3R_AP:{uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXEnrich","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXEnrich","ENXLandingPageSync"]},ENOR3V_AP:{uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXEnrich","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXEnrich","ENXLandingPageSync"]},ENOI3D_AP:{uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXLandingPageSync"]},ENOI3S_AP:{uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXLandingPageSync"]}},d=!1;return class{constructor(){let u,p=[];this.initialize=async function(n){r=this,l=this.getExecutionContext(),this.enableSwitchApp();let p=l&&l.getTargetApp()&&l.getTargetApp().options&&l.getTargetApp().options.id?l.getTargetApp().options.id:window.widget.getValue("appId")?window.widget.getValue("appId"):"";if(window.widget.setValue("appId",p),l.getSourceApp&&!l.getSourceApp()){let e=o.createElement("div",{class:"DMULoadingWidgetMask"}).inject(document.body);e.setAttribute("style","width: 100%;height: 100%;position: absolute;top: 0;z-index: 1;background-color: white;display: flex;justify-content: center; align-items: center;");let t=(l.getTargetApp&&l.getTargetApp()&&l.getTargetApp().getTitle()?l.getTargetApp().getTitle():n.title?n.title:"")+" "+s.initializing;new a({text:t}).inject(e).on(),u=l.getComponent("AFR_ModelEvents").subscribe({event:"onDidLoadApp"},(()=>{var e=window.document.getElementsByClassName("DMULoadingWidgetMask");e&&e.length&&e[0].destroy(),u&&(l.getComponent("AFR_ModelEvents").unsubscribe(u),u=void 0)}))}await async function(t,n){t&&await new Promise((i=>{require(["text!"+t],(function(t){let o=JSON.parse(t);if(d){if(o&&o.eno3dviewerinfra&&o.eno3dviewerinfra.run_options){let t=o.eno3dviewerinfra.run_options;t&&t.enopad3dviewer_allowDnD&&e.setSetting("enopad3dviewer_allowDnD",t.enopad3dviewer_allowDnD.value),t&&t.authorized_root_types&&e.setSetting("authorized_root_types",t.authorized_root_types.value),t&&t.supported_root_types&&e.setSetting("supported_root_types",t.supported_root_types.value),t&&t.landingPage_defaultSearchPrecondition&&e.setSetting("landingPage_defaultSearchPrecondition",t.landingPage_defaultSearchPrecondition.value)}i()}else e.setApp(o,"eno3dviewerinfra",!1).then((()=>{let t="en",o=n.getComponent(WAfrStandardComponentKey.WidgetProxyComponent)||widget;o.getLanguage&&void 0!==o.getLanguage()?t=o.getLanguage():null===o.lang&&void 0===o.lang||(t=o.lang),e.setSetting("lang",t),d=!0,i()}))}))}))}(n.appOptionsFilePath,l),await function(t){return new Promise((n=>{!window.widget.data.x3dShareId&&c[t]?require(["DS/ENOXInterWdgCom/LinkManager"],(o=>{e.setSetting("activateWidgetLink",!0),o.initializeWidgetLink(window.widget,{appIds:[],uses:c[t]?c[t].uses:void 0,implements:c[t]?c[t].implements:void 0,open:!0}).then((()=>{o.subscribe("DS/ExternalWdgtCom/Find",(e=>{let t=i.giveEventsController({context:l.getComponent("Viewer")});t&&t.fireEvent("onCrossWidgetFind",e)})),r.publishWidgetLinkData=function(e){o.publish("DS/ExternalWdgtCom/Find",{paths:e.paths})},n()}))})):n()}))}(p),await async function(){await t.addAsyncSharedSettings(window.widget,["x3dPlatformId","showWelcomePanel","autoreload","pad_security_ctx","synthesisModeOnInstance","pgpFromServer","activateSGI"]),window.widget.mergePreferences&&(window.widget.mergePreferences(e.getWidgetPreferences()),e.updateWidgetPreferences())}()},this.enableSwitchApp=function(){p.push(n.subscribe({event:"ExternalSwitchRequested"},(function(e){l.switchApp(e.id).then((()=>{window.console.log(`Transition to ${e.id} is a success !`)}))})))},this.clean=function(){return new Promise((e=>{u&&(l.getComponent("AFR_ModelEvents").unsubscribe(u),u=void 0),l=void 0,e()}))},this.destroy=function(){return new Promise((e=>{p.forEach(n.unsubscribe,n),d=!1,e()}))},this.getSessionWidget=function(){return window.widget},this.canBeParallelized=function(){return!1}}}})),define("DS/DMUBaseUIComponents/DMUCommonContextComponent",["DS/WebappsUtils/WebappsUtils","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUToolsClipping"],(function(e,t,n){"use strict";return class{constructor(){this._identifiers={view:"",widget:""},this._contextConfigPath="",this._nlsAMDPath="",this._contextConfig=[],this._nls=null,this._nlsAMDPromises=[],this._wafrContextContainer=null,this._isContextBarVisible=!1,this._view=null,this._widget=null;let i=this,o=[],a=function(o,a){var s=[],r=[],l=Boolean(0===a.length);if(!l){let e=t.get();var c=e&&e[0]&&e[0].pathElement?e[0].pathElement.getLastElement(!0):null;""===(c&&c.getDMUType?c.getDMUType():"")&&(r=o.ContextMenu.onGeometry)}l&&("CATWebUXODTApp_AP"===i.getExecutionContext().getSourceApp().options.id||i.getExecutionContext().getSourceApp().options.id.includes("ENOI3"))&&(r=o.ContextMenu.onEmptiness);for(var d=0;d<r.length;++d)if("openwith"===r[d].identifier||"CATWebUXODTApp_AP"===i.getExecutionContext().getSourceApp().options.id||i.getExecutionContext().getSourceApp().options.id.includes("ENOI3")){var u=r[d];let t=[];if(u.submenu){let n="ambience"===u.identifier;for(let o=0;o<u.submenu.length;++o)"SeparatorItem"===u.submenu[o].type?t.push({type:u.submenu[o].type}):t.push({title:i._nls[u.submenu[o].handlerId?u.submenu[o].handlerId:u.submenu[o].identifier],type:u.submenu[o].type,handlerId:u.submenu[o].handlerId,icon:u.submenu[o].iconPath?e.getWebappsAssetUrl(u.submenu[o].module,u.submenu[o].iconPath):void 0,state:u.submenu[o].state,action:{this:i,callback:function(e,t,n){if("WAfrCheckHandlerItem "===e[t].type&&(e[t].state="selected"===e[t].state?void 0:"selected"),!0===n){for(let t=0;t<e.length;++t)e[t].state=void 0;e[t].state="selected",window.localStorage.setItem("ENO3DViewViewerAmbience",e[t].identifier)}i.getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:e[t].handlerId})}.bind(i,u.submenu,o,n)}})}const n={title:i._nls[u.handlerId?u.handlerId:u.identifier],type:u.type,handlerId:u.handlerId,icon:u.iconPath?e.getWebappsAssetUrl(u.module,u.iconPath):void 0,state:t.length>0?void 0:u.state,action:t.length>0?void 0:{this:i,callback:i.getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler.bind(i,{id:u.handlerId})}};t.length>0&&(n.submenu=t),s.push(n)}if(s&&s.length){let e=n.getContextaulMenuforClippingNewInfra(i.getExecutionContext().getComponent("Viewer"));e&&e.submenu&&e.submenu.length&&s.push(e)}return s},s=function(e,n){if(!0===(0===n.length))return[];if("CATWebUXODTApp_AP"===!i.getExecutionContext().getSourceApp().options.id||!i.getExecutionContext().getSourceApp().options.id.includes("ENOI3"))return[];if(1===t.get().length&&i._view._areValidPaths(t.get())){let n=!1;return 2===t.get()[0].pathElement.externalPath.length&&(n=!0),!0===n?{WAfrCtxBarRow1:{model:[e.ContextBar.WAfrCtxBarRow1.model[1]]}}:{WAfrCtxBarRow1:{model:[e.ContextBar.WAfrCtxBarRow1.model[0]]}}}return[]},r=function(e){i._x=e.clientX,i._y=e.clientY},l=function(e){return new Promise(((t,n)=>{require([e],t,n)}))},c=function(){return new Promise(((e,t)=>{var n;(n=i._nlsAMDPath,new Promise(((e,t)=>{l(`i18n!${n}`).then(e).catch(t)}))).then((t=>{i._nls=t,e()})).catch(t)}))};this.getPickedPath=function(e){return i._view.get3DViewer().pick({xPix:e.XmousePositionWithDevPxRatio,yPix:e.YmousePositionWithDevPxRatio},"mesh",!0).path},this.canBeParallelized=function(){return!1},this.initialize=function(e){return this._identifiers={view:e.viewIdentifier,widget:e.widgetIdentifier},this._contextConfigPath=e.ctxOptions,this._nlsAMDPath=e.nlsAMDPath,i._view=i.getExecutionContext().getComponent(i._identifiers.view),i._widget=i.getExecutionContext().getComponent(i._identifiers.widget),new Promise((async e=>{await function(){const e=[];return new Promise(((t,n)=>{for(let t=0;t<i._contextConfigPath.length;++t)e.push(new Promise((e=>{var o;(o=i._contextConfigPath[t],new Promise(((e,t)=>{l(`text!${o}`).then(e).catch(t)}))).then((t=>{try{i._contextConfig.push(JSON.parse(t)),e()}catch(e){i._DEBUG&&window.window.console.error("ENO3DContextMenuComponent._loadConfigurationFromFile failed to load configuration"+e),n(e)}})).catch(n)})));Promise.all(e).then(t).catch(n)}))}(),await c(),await new Promise((e=>{for(let e=0;e<i._contextConfig.length;++e)for(let t=0;t<i._contextConfig[e].ContextMenu.onEmptiness.length;++t){const n=i._contextConfig[e].ContextMenu.onEmptiness[t];if(n.submenu)for(let e=0;e<n.submenu.length;++e)"ENO3DToggleStatusBarCmd"===n.submenu[e].identifier?n.submenu[e].state="true"===window.localStorage.getItem("ENO3DViewStatusBarExpandState")?"selected":void 0:n.submenu[e].identifier===window.localStorage.getItem("ENO3DViewViewerAmbience")&&(n.submenu[e].state="selected",i.getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:n.submenu[e].identifier}))}e()})),await new Promise(((e,t)=>{const n=i._view.getDOMElement("container");try{n.addEventListener("click",r),n.addEventListener("contextmenu",r),e()}catch(e){i._DEBUG&&window.window.console.error("ENO3DContextMenuComponent._listenContextEvent\n\t"+e),t(e)}})),await new Promise((e=>{var t=i.getExecutionContext().getComponent(WAfrStandardComponentKey.UIComponent);i._wafrContextContainer=t.getContextualUIComponentManager();for(let e=0;e<i._contextConfig.length;++e){o.push(`ENO3DContextMenu-${e}`);const t={subscriberId:`ENO3DContextMenu-${e}`,merge:!0,onContextualMenuReady:function(e,t){return a(e,i.getPickedPath(t))}.bind(i,i._contextConfig[e]),onContextualBarReady:function(e,t,n){return s(e,t)}.bind(i,i._contextConfig[e])};i._wafrContextContainer.register(t)}e()})),i.getExecutionContext().setContext("ContextReady",!0),e()}))},this.clean=function(){return new Promise((async e=>{for(let e=0;e<o.length;e++)await i._wafrContextContainer.unregister(o[e]);o=[],this._contextConfig=[],e()}))},this.destroy=function(){return new Promise((e=>{e()}))}}}})),define("DS/DMUBaseUIComponents/DMUCommonLandingPage",["DS/PADServices/views/LandingPage","DS/PADServices/utils/GlobalModelEvents","DS/DMUBaseExperience/DMUContextManager","DS/PADUtils/PADSettingsMgt","DS/CATWebUXComponents/DMUFrameWindow"],(function(e,t,n,i,o){"use strict";return class{constructor(a){let s,r,l,c,d,u,p,m,g,f,h,w={widget:a.widgetIdentifier,landingPage:a.landingPageIdentifier},v=!1,D=!0,y=this;this.params={widget:window.widget,readOnlyApp:!1,renderDiv:d,onLandingPageReady:function(){y._widget&&(y._widget.viewerAttachment(d),y._widget.viewerAttachment=null)}};const C=a.recentKeys,b=["ds6w:label","ds6w:type","ds6wg:revision","ds6w:status","owner","ds6w:responsible","ds6w:modified","ds6w:project","ds6w:identifier"];let S,P=[],A=[],E=[];function x(e){r&&e&&e.length&&(y.showWelcomePanel(!1),setTimeout((function(){r.addRootNodesFromContent({json3DXContent:{protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",data:{items:e.map((function(e){return{envId:require("DS/PADUtils/PADUtilsServices").getPlatformId(),objectId:e.id,objectType:e.type,displayName:e.displayName}}))}}})}),500))}async function N(e){try{let t=require("DS/DMUReadPersistence/DMUWebServicesUtils"),n=await t.getParentTypes(e);return[e].concat(n)}catch{return[e]}}async function I(e){let t=!0;if(e.length>1)for(const n of e){let e=await N(n["ds6w:type"]);if(!e.includes("VPMReference")&&!e.includes("R2V_Activity")){t=!1;break}}t?x.call(this,e.map((function(e){return{id:e.resourceid,type:e["ds6w:type_value"],displayName:e["ds6w:label"]}}))):p.dropMultiNoAutorized&&function(e,t,n){S&&(S.destroy(),S=null);try{let i=require("DS/DMUControls/EXPNotify");S=new i({body:n.getFrameWindow().getUIFrame(),type:e,message:t})}catch{return new Error("Cannot retrieve module")}}("warning",p.dropMultiNoAutorized,r)}let M=function(){P.push(t.subscribe({event:"ENXViews/LandingPage/refreshCustom"},k.bind(y))),P.push(t.subscribe({event:"ENXViews/LandingPage/openCustom"},(function(e){var t=U(),n=[];e.customitem2open.forEach((function(e){C.some((function(i){if(t[i.key]&&t[i.key][e])return n.push({id:e,type:i.type}),!0}))})),x.call(y,n)}))),P.push(t.subscribe({event:"ENXViews/LandingPage/removeFromView"},(function(e){if(e&&e.customitem2remove&&e.customitem2remove.length)if(s.getSourceApp().options.id.includes("I3D")||s.getSourceApp().options.id.includes("I3S")){var t=require("DS/PIMwebViewController/PIMwebItfCtrl").getItfCtrl({pad3DViewer:s.getComponent("Viewer")}),i=t.getLoadedData(),o=[];e.customitem2remove.forEach((function(e){i[e]&&-1===o.indexOf(e)?o.push(e):Object.keys(i).forEach((function(t){i[t].indexOf(e)>-1&&-1===o.indexOf(t)&&o.push(t)}))})),o.forEach(t.removeIsr,t)}else{var a=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),l=a.getRoots(r).map((function(e){return a.getNodeID(e)})),c=n.getReviewContext({context:r}),d=c?c.getReviewCtxInformation():{},u=d?d.reviewId:null,p=[];r.getApplicativeData().getLoadedItfData&&(p=r.getApplicativeData().getLoadedItfData().data),r.getApplicativeData().removeDIFAnnotSetKeepPrd&&e.customitem2remove.forEach((e=>{r.getApplicativeData().removeDIFAnnotSetKeepPrd(e)})),e.customitem2remove.indexOf(u)>-1&&n.removeReviewContext({context:r}),p.forEach((function(t){(t.metricID.length?t.metricID:[t.isrID]).some((function(n){if(e.customitem2remove.indexOf(n)>-1)return r.getApplicativeData().removeIsrKeepContext(t.isrID),!0}),y)}),y),l.forEach((function(t){e.customitem2remove.indexOf(t)>-1&&r.removeRoots({pids:[t]})}),y)}}))),P.push(t.subscribe({event:"ENXViews/LandingPage/removeFromStore"},(function(e){var n;if(e&&e.customitem2remove&&e.customitem2remove.length)if(s.getSourceApp().options.id.includes("I3D")||s.getSourceApp().options.id.includes("I3S")){n=y.params.widget.getValue("xsceneStoredObjects");let i=[];n=n?JSON.parse(n):{},e.customitem2remove.forEach((function(e){n.isr&&n.isr[e]&&-1===i.indexOf(e)?(i.push(e),delete n.isr[e]):n.itf&&n.itf[e]&&-1===i.indexOf(n.itf[e])&&(i.push(n.itf[e]),delete n.itf[e])})),y.params.widget.setValue("xsceneStoredObjects",JSON.stringify(n)),t.publish({event:"ENXViews/LandingPage/removeFromView",data:{customitem2remove:i}})}else{n=U();let i=[];e.customitem2remove.forEach((function(e){C.some((function(t){if(n[t.key]&&n[t.key][e]&&-1===i.indexOf(e))return i.push(e),delete n[t.key][e],!0}))})),y.params.widget.setValue("xsceneStoredObjects",JSON.stringify(n)),t.publish({event:"ENXViews/LandingPage/removeFromView",data:{customitem2remove:i}})}}))),P.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelMkp"},(function(){p.mkp&&e.launchSearch({title:p.mkp,precondition:'flattenedtaxonomies:"types/Markup"OR flattenedtaxonomies:"types/DMUMarkupRepReference"',showApplyButton:!1,ok:I.bind(y)})}))),P.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelHighlights"},(function(){e.launchSearch({title:p.highlights,precondition:'flattenedtaxonomies:"types/DMUValidationExposedPresentation"',showApplyButton:!1,ok:I.bind(y)})}))),P.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelRvw"},(function(){e.launchSearch({title:p.rvw,precondition:'flattenedtaxonomies:"types/DMUValidationValidation"',showApplyButton:!1,ok:I.bind(y)})}))),y&&y.params&&y.params.widget&&y.params.widget.data&&"ENOR3V_AP"===y.params.widget.data.appId&&P.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomPanelNewActivity"},(function(){require(["DS/CATWebUXComponents/DMUCommandsManager"],(e=>{let t=e.getCommand("DMUReviewHdr",r?r.getCommandContext():void 0);y.showWelcomePanel(!1),t.begin()}))}))),P.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelIsr"},(function(){p.isr&&e.launchSearch({title:p.isr,precondition:'flattenedtaxonomies:"types/SIMItfSimulation"',showApplyButton:!1,ok:I.bind(y)})}))),P.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelItf"},(function(){p.itf&&e.launchSearch({title:p.itf,precondition:'flattenedtaxonomies:"types/PLMPIMMetricReference"',showApplyButton:!1,ok:I.bind(y)})}))),P.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDrw"},(function(){p.drw&&e.launchSearch({title:p.drw,precondition:'flattenedtaxonomies:"types/Drawing"',showApplyButton:!1,ok:I.bind(y)})}))),P.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFLayout"},(function(){p.difLayout&&e.launchSearch({title:p.difLayout,precondition:'flattenedtaxonomies:"types/DIFLayout"',showApplyButton:!1,ok:I.bind(y)})}))),P.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFSheet"},(function(){p.difSheet&&e.launchSearch({title:p.difSheet,precondition:'flattenedtaxonomies:"types/DIFSheet"',showApplyButton:!1,ok:I.bind(y)})}))),P.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFAnnotationSet"},(function(){p.difAnnotSet&&e.launchSearch({title:p.difAnnotSet,precondition:'flattenedtaxonomies:"types/DIFAnnotationSet"',showApplyButton:!1,ok:I.bind(y)})}))),P.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelFailureModesEffectsAnalysis"},(function(){p.fmea&&e.launchSearch({title:p.fmea,precondition:'flattenedtaxonomies:"types/FailureModesEffectsAnalysis"',showApplyButton:!1,ok:I.bind(y)})}))),P.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDocument"},(function(){p.doc&&e.launchSearch({title:p.doc,precondition:'flattenedtaxonomies:"types/Document"',showApplyButton:!1,ok:I.bind(y)})}))),P.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelRequirement"},(function(){p.req&&e.launchSearch({title:p.req,precondition:'flattenedtaxonomies:"types/Requirement"',showApplyButton:!1,ok:I.bind(y)})}))),P.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelRequirementSpec"},(function(){p.reqSpec&&e.launchSearch({title:p.reqSpec,precondition:'flattenedtaxonomies:"types/Requirement Specification"',showApplyButton:!1,ok:I.bind(y)})}))),P.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelMsr"},(function(){p.msr&&e.launchSearch({title:p.msr,precondition:'flattenedtaxonomies:"types/DesignSight"',showApplyButton:!1,ok:I.bind(y)})}))),P.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelHeaderWorkplan"},(function(){p.hWorkplan&&e.launchSearch({title:p.hWorkplan,precondition:'flattenedtaxonomies:"types/DELLmiHeaderWorkPlanReference"',showApplyButton:!1,ok:I.bind(y)})}))),P.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelWorkplan"},(function(){p.workplan&&e.launchSearch({title:p.workplan,precondition:'flattenedtaxonomies:"types/DELLmiWorkPlanSystemReference"',showApplyButton:!1,ok:I.bind(y)})}))),P.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomPanelPrefCmd"},(function(){require(["DS/CATWebUXComponents/DMUCommandsManager","DS/CATWebUXPreferences/CATWebUXPreferencesManager"],(function(e,t){let n=t.givePreferenceManager({context:r.getFrameWindow()});if(n)var i=n.subscribe("onPreferencesPanelDestroyed",function(){n.unsubscribe(i),this.showWelcomePanel(!0)}.bind(y));y.showWelcomePanel(!1),e&&e.getCommand("CATWebUXPreferencesHdr",r&&r.getCommandContext?r.getCommandContext():null).begin()}))}))),P.push(t.subscribe({event:"ENXViews/WelcomePanel/action/userAssistance"},(function(){let e=require("DS/WebUAUtils/WebUAUtils");window.open(e.getHelpFullPath(function(){if(!s)return;let e,t=s.getSourceApp().options.id;return e=t.includes("R3R")?p.userAssistanceURL_R3R:t.includes("R3V")?p.userAssistanceURL_R3V:t.includes("I3D")?p.userAssistanceURL_I3D:t.includes("I3S")?p.userAssistanceURL_I3S:p.userAssistanceURL,e}()))}))),P.push(t.subscribe({event:"ENXViews/WelcomePanel/action/whatsNew"},(function(){let e=require("DS/WebUAUtils/WebUAUtils");window.open(e.getEmbeddedHelpFullPath(function(){if(!s)return;let e,t=s.getSourceApp().options.id;return e=t.includes("R3R")?p.whatsNewURL_R3R:t.includes("R3V")?p.whatsNewURL_R3V:t.includes("I3D")?p.whatsNewURL_I3D:t.includes("I3S")?p.whatsNewURL_I3S:p.whatsNewURL,e}()))})))};function U(){var e=window.widget.getValue("xsceneStoredObjects");return e&&"string"==typeof e||(e='{"products":{},"filters":{}}'),JSON.parse(e)}function k(e){if(e&&e.length){t.publish({event:"ENXViews/LandingPage/addOrRefresh",data:{objects:e.map((function(e){return{resourceid:e,openWithFilter:!1,loading:!0,fromCustom:!0}}))}});var i=setInterval((function(){c&&(clearInterval(i),setTimeout((function(){!function(e,t){require("DS/WAFData/WAFData").authenticatedRequest(require("DS/PADUtils/PADUtilsServices").get3DSpaceUrl()+"/cvservlet/fetch/v2?tenant="+require("DS/PADUtils/PADUtilsServices").getPlatformId(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx")},data:JSON.stringify({physicalid:e,label:"M3DFetchForWelcomePanel"+Date.now(),select_predicate:b,select_file:["icon","thumbnail_2d"]}),onComplete:t,onFailure:function(){},onTimeout:function(){}})}(e,(async function(i){if(c){if(i&&JSON.parse(i).results)var o=((i?JSON.parse(i):{}).results||[]).map((function(e){var t={},i=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),o=i.getRoots(r).map((function(e){return i.getNodeID(e)})),a=n.getReviewContext({context:r}),s=a?a.getReviewCtxInformation():{};s&&s.reviewId&&o.push(s.reviewId),r.getApplicativeData().getLoadedItfData&&r.getApplicativeData().getLoadedItfData().data.forEach((function(e){o=o.concat(e.metricID.length?e.metricID:[e.isrID])})),e.attributes.forEach((function(e){"ds6w:label"===e.name?t[e.name]=e.value.escapeHTML():t[e.name]=e.value}));var l=t["ds6w:type"],c={resourceid:t.resourceid,label:t["ds6w:label"],serviceId:"R2V_Activity"===l?"r2vsurvey":void 0,icons:[t.type_icon_url],thumbnail:t.preview_url,grid:t,subLabel:t["ds6w:responsible"]+" | "+new Date(t["ds6w:modified"]).toLocaleString(),description:t["ds6w:identifier"],openWithFilter:!1,fromCustom:!0,loading:void 0,opened:o.indexOf(t.resourceid)>-1,item2Load:{}};return c.item2Load[c.resourceid]={},"SIMItfSimulation"!==l&&"Markup"!==l&&"DMUMarkupRepReference"!==l&&"PLMPIMMetricReference"!==l&&"DIFAnnotationSet"!==l||(c.addRemoveFromViewCtx=!0),c}));else{var a={data:{select_file:["icon","thumbnail_2d"],select_predicate:["ds6w:label","ds6w:type","ds6w:responsible","type_icon_url","preview_url","resourceid","ds6w:modified","ds6w:identifier","ds6w:project","owner","ds6wg:revision","ds6w:status"],pids:e}};await function(e){return new Promise((function(t,n){var i=e.data,o=require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx"),a=require("DS/PADUtils/PADUtilsServices").getPlatformId(),s=require("DS/PADUtils/PADUtilsServices").get3DSpaceUrl()+"/resources/enoauthoring/fetch/v1?SecurityContext="+encodeURIComponent(o)+"&tenant="+a,r=Object.assign({label:"M3DDBFetchForWelcomePanel"+Date.now(),physicalid:i.pids,select_predicate:i.select_predicate,select_file:["icon","thumbnail_2d"],select_pgp:["Show","Hide"],extensions:["XCADExtension","EnterpriseExtension","MaterialUsageExtension"],locale:require("DS/PADUtils/PADSettingsMgt").getSetting("lang"),tenant:require("DS/PADUtils/PADUtilsServices").getPlatformId(),types:["DMUMarkupRepReference"]}),l=UWA.extend({method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":require("DS/PADUtils/PADSettingsMgt").getSetting("lang"),SecurityContext:require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx"),SecurityToken:"sbo6|"+o+"|preferred"},onComplete:function(e){var n=JSON.parse(e);t(n)},onFailure:function(e){n(e)},onTimeout:function(e){n(e)}},e);l.data=r,l.data=JSON.stringify(l.data),require("DS/WAFData/WAFData").authenticatedRequest(s,l)}))}(a).then((function(e){if(e.results.length&&e.results[0].attributes&&e.results[0].attributes.length){var n,i,a,s,l,c,d,u,p=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),m={},g=p.getRoots(r).map((function(e){return p.getNodeID(e)}));e.results[0].attributes.forEach((function(e){"ds6w:type"===e.name&&(n=e.value,m["ds6w:type"]=e.value),"ds6w:label"===e.name&&(i=e.value,m["ds6w:label"]=e.value),"ds6w:responsible"===e.name&&(l=e.value,m["ds6w:responsible"]=e.value),"ds6w:modified"===e.name&&(c=e.value,m["ds6w:modified"]=e.value),"type_icon_url"===e.name&&(a=e.value,m.type_icon_url=e.value),"resourceid"===e.name&&(d=e.value,m.resourceid=e.value),"thumbnail_2d"===e.name&&(s=e.value,m.preview_url=e.value),"ds6w:identifier"===e.name&&(u=e.value,m["ds6w:identifier"]=e.value),"ds6w:status"===e.name&&(u=e.value,m["ds6w:status"]=e.value),"owner"===e.name&&(u=e.value,m.owner=e.value),"ds6wg:revision"===e.name&&(u=e.value,m["ds6wg:revision"]=e.value)}));var f={resourceid:d,label:i,serviceId:"R2V_FeatureState"===n?"r2vsurvey":void 0,icons:[a],thumbnail:s,grid:m,subLabel:l+" | "+new Date(c).toLocaleString(),description:u,openWithFilter:!1,fromCustom:!0,loading:void 0,opened:g.indexOf(d)>-1,item2Load:{}};f.item2Load[d]={},(o=[]).push(f),t.publish({event:"ENXViews/LandingPage/addOrRefresh",data:{objects:o}})}})).catch((function(e){console.log(e)}))}t.publish({event:"ENXViews/LandingPage/addOrRefresh",data:{objects:o}})}}))}),500))}),100)}}function R(){return new Promise((e=>{var t=U();if(C){var i=Array.prototype.concat.apply([],C.map((function(e){return Object.keys(t[e.key]||[])})));k.call(y,i)}let o=function(){var e=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),t=window.document.getElementsByClassName("DMULoadingPanel");e.length&&(e[0].dsModel.off(),e[0].dsModel.destroy(),e=null),t.length&&t[0].destroy()};A.push(r.subscribe({event:"onRootAdded"},(function(e){var t=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),n=e.id,i=r.getController().getNode({id:n}),o=t.getNodeType(i);if("DesignSight"===o||"DIFLayout"===o||"DIFSheet"===o||"Document"===o||"Requirement"===o||"Requirement Specification"===o){"DesignSight"===o?window.widget.setValue("mkpSession",JSON.stringify({type:"msr",plmType:o,id:n})):window.widget.setValue("mkpSession",JSON.stringify({type:"Document"===o||"Requirement"===o||"Requirement Specification"===o?o:"2D",plmType:o,id:n}));var a=U();a[o="DIFLayout"===o?"difLayout":"DIFSheet"===o?"difSheet":"Requirement"===o?"req":"Requirement Specification"===o?"reqSpec":"DesignSight"===o?"msr":"doc"]||(a[o]={}),a[o][n]={},window.widget.setValue("xsceneStoredObjects",JSON.stringify(a)),y.showWelcomePanel(!1),k.call(y,[n]),D&&(D=!1)}else if("R2V_Activity"===o){var s=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),l=window.document.getElementsByClassName("DMULoadingPanel");s.length&&(s[0].dsModel.off(),s[0].dsModel.destroy(),s=null),l.length&&l[0].destroy()}}))),A.push(r.subscribe({event:"onRootRemoved"},function(e){var t=U();["difLayout","difSheet","doc","req","reqSpec","msr"].some((function(n){return t[n]&&t[n][e.id]}))&&(k.call(this,[e.id]),window.widget.deleteValue("mkpSession"))}.bind(y))),A.push(r.subscribe({event:"onBeginRootLoading"},(function(){o()})));var a=n.getEventsController({viewer:r.getViewer()});E.push(a.addEvent("onReviewCtxInformationChanged",(function(e){var t=U();t.mkp||(t.mkp={}),t.mku||(t.mku={}),t.rvw||(t.rvw={}),t.highlight||(t.highlight={}),"Markup"===e.reviewType?t.mkp[e.reviewId]={}:"DMUValidationValidation"===e.reviewType?t.rvw[e.reviewId]={}:"DMUValidationExposedPresentation"===e.reviewType?t.highlight[e.highlightId]={}:"DMUMarkupRepReference"===e.reviewType&&(t.mku[e.reviewId]={}),window.widget.setValue("xsceneStoredObjects",JSON.stringify(t)),k.call(y,[e.reviewId])}))),E.push(a.addEvent("onReviewRemoved",(function(e){var t=U();(e&&t.mkp&&t.mkp[e.reviewId]||e&&t.mku&&t.mku[e.reviewId])&&k.call(y,[e.reviewId]),window.widget.deleteValue("reviewIdInSession")}))),E.push(a.addEvent("onWorkplanLoadSuccess",(function(e){var t=U();t.workplan||(t.workplan={}),t.hdrWorkplan||(t.hdrWorkplan={}),"DELLmiWorkPlanSystemReference"===e.type?t.workplan[e.id]={}:"DELLmiPPRHeaderProcessReferenceAbstract"===e.type&&(t.hdrWorkplan[e.id]={}),window.widget.setValue("xsceneStoredObjects",JSON.stringify(t)),k.call(y,[e.id])}))),E.push(a.addEvent("onFMEALoadSuccess",(function(e){var t=U();t.fmea||(t.fmea={}),"FailureModesEffectsAnalysis"===e.type&&(t.fmea[e.id]={}),window.widget.setValue("xsceneStoredObjects",JSON.stringify(t)),k.call(y,[e.id])}))),a.addEvent("onBeginContextLoading",(function(e){o()})),e()}))}function _(e){require(["DS/PADUtils/PADCommandProxy","DS/PADUtils/PADSharedSettings","i18n!DS/PADUtils/assets/nls/PADUtils"],(function(t,o,a){var r=[],c=[];g=function(){l.widget.setPreferences([]),r.forEach((function(e){e.cb&&i.removeEvent(e.cb,e.padFct)})),g=function(){}};const d=function(){r.forEach((function(e){var t=e.preference.name,n=l.widget.getValue(t),o=i.getSetting(t);(n="boolean"===e.preference.type&&"boolean"!=typeof n?"true"===n:n)!==o&&i.setSetting(t,n),e.fct&&e.fct(n)})),i.updateWidgetPreferences();let e=n.giveEventsController({context:l.viewer});!f&&r.length&&(f=t.create({events:{onPreferenceModification:function(e){r.some((function(t){if(e.name===t.preference.name){if("boolean"!=typeof e.value&&"string"!=typeof e.value)throw new Error("Value must be a string or a boolean");if(i.getSetting(e.name)!==e.value){if("boolean"===t.preference.type&&"boolean"!=typeof e.value)throw new Error("Preference is a boolean type so value must be a boolean");t.debounce=!0,l.widget.setValue(e.name,e.value),i.setSetting(e.name,e.value)}return t.fct&&t.fct(e.value),!0}}))},onSelect:function(t){e&&e.fireEvent("onCrossWidgetSelection",t)}}})),e&&(e.addEvent("onFireCrossWidgetSelection",(e=>{f&&f.select(e)})),e.addEvent("onFireCrossWidgetFind",(e=>{e&&e.paths&&e.paths.length&&s.getComponent("Widget").publishWidgetLinkData(e)}))),r.forEach((function(e){e.cb&&i.addEvent(e.cb,e.padFct=function(t){e.debounce?e.debounce=!1:f&&f.preferenceModification({name:e.preference.name,value:t})})}))};i.setSetting("syncAutoReload",!0),o.addSharedSettings(l.widget),r.push({preference:{name:"changeControlActivation",type:"boolean",label:a.changeControlActivation_label,defaultValue:!1},fct:function(e){h&&h[e?"show":"hide"]()},cb:"onChangeControlActivation",debounce:!1}),r.push({preference:{name:"changeControlPosition",type:"list",label:a.changeControlPosition_label,defaultValue:"top-right",options:[{label:a["top-right_label"],value:"top-right"},{label:a["top-left_label"],value:"top-left"},{label:a["bottom-left_label"],value:"bottom-left"},{label:a["bottom-right_label"],value:"bottom-right"}]},fct:function(e){h&&h.setPosition(e)}}),i.setSetting("authorizeChangeControl",!0),e?function(){let e=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"),t=require("DS/PADUtils/PADCommandProxy");h=e,h.renderDiv||h.initialize2(l.viewer.getFrameWindow().getViewerFrame(),t.appId(),l.widget.getValue("changeControlActivation")?"show":"hide","top-right",(function(){h.addEvent("onAuthoringCtxVisible",(function(e){e.showAuthoringContext&&l.widget.setValue("changeControlActivation",!0)}))}))}():c=["webapi_timeout"],c.forEach((function(e){l.widget.deleteValue(e)})),c.length=0,r.forEach((function(e){l.widget.mergePreferences([e.preference])})),d(),function(){let e=require("i18n!DS/ENOPAD3DViewer/assets/nls/PAD3DViewer");l.widget.addEvent("onChangeFlexibleAssembliesSupport",(function(e,t){i.setSetting(e,t)}));var t=i.getSetting("enopad3dviewer_roles");let n=!0,o=require("DS/PADUtils/PADUtilsServices").isCloud(),a=require("DS/PADUtils/PADSession").isAuthoring();for(var s=0;s<t.length;s++)if("E19"===t[s].id&&(!t[s].platforms||t[s].platforms&&t[s].platforms.indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)){n=!1;break}!n||o||a?(l.widget.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"hidden",defaultValue:!1,label:e.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:!1}),i.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",!1)):l.widget.getPreference("enopad3dviewer_flexibleAssemblySupportActivated")||(l.widget.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"boolean",defaultValue:!1,label:e.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:void 0!==l.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated")&&l.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated")}),i.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",l.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated"))),i.setSetting("enopad3dviewer_staticMappingSupportActivated",!a)}(),l.widget.addEvent("endEdit",d)}))}a.nls&&require(["i18n!"+a.nls],(function(t){if(!t)return;p=t,u=e.getDefaultActivities();let n=2;p.rvw&&(u.activities[0].section.actions.splice(n,0,{id:"welcomePanelRvw",title:p.rvw,icon:"review"}),n+=1),p.highlights&&(u.activities[0].section.actions.splice(n,0,{id:"welcomePanelHighlights",title:p.highlights,icon:"highlight-review"}),n+=1),p.mkp&&(u.activities[0].section.actions.splice(n,0,{id:"welcomePanelMkp",title:p.mkp,icon:"app-3dmarkup"}),n+=1),p.difAnnotSet&&(n+=3,u.activities[0].section.actions.splice(n,0,{id:"welcomePanelDIFAnnotationSet",title:p.difAnnotSet,icon:"annotation"}),n+=1),p.isr&&(n=a.nls.includes("I3D")?2:n,u.activities[0].section.actions.splice(n,0,{id:"welcomePanelIsr",title:p.isr,icon:"interference-simulation"}),n+=1),p.itf&&(n=a.nls.includes("I3D")?3:n,u.activities[0].section.actions.splice(n,0,{id:"welcomePanelItf",title:p.itf,icon:"interference-metric"}),n+=1),p.msr&&(u.activities[0].section.actions.splice(n,0,{id:"welcomePanelMsr",title:p.msr,icon:"physics-simulation"}),n+=1),p.drw&&(u.activities[0].section.actions.splice(n,0,{id:"welcomePanelDrw",title:p.drw,icon:"drawing"}),n+=1),p.reqSpec&&(u.activities[0].section.actions.splice(n,0,{id:"welcomePanelRequirementSpec",title:p.reqSpec,icon:"requirement-specification"}),n+=1),p.req&&(u.activities[0].section.actions.splice(n,0,{id:"welcomePanelRequirement",title:p.req,icon:"requirement"}),n+=1),p.difLayout&&(u.activities[0].section.actions.splice(n,0,{id:"welcomePanelDIFLayout",title:p.difLayout,icon:"fl-diagrams"}),n+=1),p.difSheet&&(u.activities[0].section.actions.splice(n,0,{id:"welcomePanelDIFSheet",title:p.difSheet,icon:"fl-diagram"}),n+=1),p.fmea&&(u.activities[0].section.actions.splice(n,0,{id:"welcomePanelFailureModesEffectsAnalysis",title:p.fmea,icon:"failure-mode-analysis"}),n+=1),p.doc&&(u.activities[0].section.actions.splice(n,0,{id:"welcomePanelDocument",title:p.doc,icon:"doc"}),n+=1),p.hWorkplan&&(u.activities[0].section.actions.splice(n,0,{id:"welcomePanelHeaderWorkplan",title:p.hWorkplan,icon:"chart-timeline"}),n+=1),p.workplan&&(u.activities[0].section.actions.splice(n,0,{id:"welcomePanelWorkplan",title:p.workplan,icon:"chart-schedule"}),n+=1),p.startNewActivity&&p.newReview&&(y.getWidget().data.appId||y.getWidget().data.afrAppId).includes("R3V")&&u.activities.push({section:{id:"NewActivitySection",title:p.startNewActivity,actions:[{id:"welcomPanelNewActivity",title:p.newReview,icon:"review"}]}}),p.customApp&&p.prefs&&u.activities.push({section:{id:"customizeAppSection",title:p.customApp,actions:[{id:"welcomPanelPrefCmd",title:p.prefs,icon:"cog"}]}}),p.contentAndKnowledge&&p.userAssistance&&p.whatsNew&&u.activities.push({section:{id:"contentAndKnowledge",title:p.contentAndKnowledge,actions:[{id:"userAssistance",title:p.userAssistance,icon:"help"},{id:"whatsNew",title:p.whatsNew,icon:"megaphone"}]}})})),this.getWidgetComponent=function(){return this.getExecutionContext().getComponent(w.widget)},this.getWidget=function(){return this.getWidgetComponent().getSessionWidget()},this.createLandingPage=function(){return d=this.params.renderDiv=document.querySelector(".wafr-uiframe.wux-afr-framewindow"),c=new e({widget:window.widget,appReady:!1,readOnlyApp:!1,renderDiv:this.params.renderDiv,externalViewerMgt:!0,externalViewerMgtCB:function(e,t){!0!==t&&this.showWelcomePanel("viewer"!==e)}.bind(this),globalSearchPrecond:require("DS/PADUtils/PADSettingsMgt").getSetting("landingPage_defaultSearchPrecondition"),defaultActionId:u?u.defaultActionId:void 0,activities:u?u.activities:void 0,modelEvents:t,onLandingPageReady:this.params.onLandingPageReady}),c.initialize()},this.getLandingPage=function(){return c},this.initialize=function(){return y=this,s=this.getExecutionContext(),r=s.getComponent("Viewer"),l={widget:window.widget,viewer:r},r&&(r._identifiers.landingPage=this.getRegisteredIdentifier(),o.init(r,{executionContext:s}),_(r)),M(),new Promise(((e,t)=>{c?R().then((function(){c.options.renderDiv||(c.options.renderDiv=document.querySelector(".wafr-uiframe.wux-afr-framewindow")),v=!0,e()})).catch((e=>{a.DEBUG&&window.console.error("ENO3DLandingPageComponent.initialize\n\tFatal error during initialization",e),t(e)})):y.createLandingPage().then((()=>{R().then((function(){c.options.renderDiv||(c.options.renderDiv=document.querySelector(".wafr-uiframe.wux-afr-framewindow")),v=!0,e()})).catch((e=>{a.DEBUG&&window.console.error("ENO3DLandingPageComponent.initialize\n\tFatal error during initialization",e),t(e)}))}))}))},this.setViewer=function(e){r||(r=e),c&&c.setViewer(r,!1),this.showWelcomePanel(!1)},this.appReady=function(e,t){if(this.isAppReady=!0,m=this.params.widget.getValue("X3DContentId"),v){let c=this.params.widget.id.indexOf("preview")>-1;if(m&&e)e.appInitFromTransition({x3dContent:JSON.parse(m),onNoActionDone:function(){y.showWelcomePanel(!1),t(r,JSON.parse(m))}});else if(m)r.addRootNodesFromContent({json3DXContent:JSON.parse(m),dispatch:!1});else if(!0===this.params.widget.getValue("autoreload")||!0===this.params.widget.getValue("autoreloadPreviewApp")&&!c){var n=this.params.widget.getValue("reviewIdInSession");if(n){var i=JSON.parse(n);"_DMUValidationExposedPresentation"===i.objectType?x.call(this,[{id:i.reviewId,type:"DMUValidationExposedPresentation"}]):"_DMUValidationValidation"===i.objectType?x.call(this,[{id:i.reviewId,type:"DMUValidationValidation"}]):x.call(this,[{id:i.reviewID,type:i.reviewType}])}else{var o=this.params.widget.getValue("mkpSession");if((o=o?JSON.parse(o):null)&&"ITF"===o.type||e){var a=this.params.widget.getValue("ItfSimuInSession");if((a=a?JSON.parse(a):null)&&!Array.isArray(a)&&"object"==typeof a){var s=Object.keys(a);if(1===s.length){var l={},d=s[0];e&&e.load?(Array.isArray(a[d])&&a[d].length?l.metricID=a[d]:l.isrID=d,this.showWelcomePanel(!1),e.load(l)):Array.isArray(a[d])&&a[d].length?x.call(this,a[d].map((function(e){return{id:e,type:"PLMPIMMetricReference"}}))):x.call(this,[{id:d,type:"SIMItfSimulation"}])}}}else o&&o.id&&("2D"===o.type||"Document"===o.type||"msr"===o.type)&&x.call(this,[{id:o.id,type:o.plmType}])}}c?this.params.widget.setValue("autoreloadPreviewApp",!0):this.params.widget.deleteValue("autoreloadPreviewApp"),!1===this.params.widget.getValue("autoreload")&&this.params.widget.deleteValue("reviewIdInSession")}return c.appReady()},this.clean=function(){var e=n.getEventsController({viewer:r.getViewer()});return E.forEach(e.removeEvent,e),E=[],A.forEach(r.unsubscribe,r),A=[],P.forEach(t.unsubscribe,t),P.length=0,r._identifiers.landingPage="LandingPage",Promise.resolve()},this.destroy=function(){return g&&g(),f&&(f.destroy(),f=null),c.dispose(),c=null,r=null,m=void 0,v=!1,u=null,Promise.resolve()},this.showWelcomePanel=function(e){let t=this.getExecutionContext().getSourceApp(),n=this.getExecutionContext().getTargetApp();Boolean(t&&n)&&e&&(e=!1);let i=document.querySelector(".landing-welcome");if(i&&!e&&i.classList.add("landing-hidden"),c.elements.mainBody.style.display=e?"":"none",e){c.redraw();var o=document.getElementsByClassName("DMULoadingWidgetMask");o&&o.length&&o[0].destroy()}},this.canBeParallelized=function(){return!1}}}})),define("DS/DMUBaseUIComponents/DMUComment",["require","exports","DS/VisuEvents/EventsManager","UWA/Core","DS/Controls/Popup","DS/Utilities/TouchUtils","DS/Menu/ContextualMenu","DS/DMUBaseUIComponents/DMURichTextServices","i18n!DS/DMUBaseUIComponents/assets/nls/DMUBaseUIComponents","css!DS/DMUBaseUIComponents/DMUBaseUIComponents.css"],(function(e,t,n,i,o,a,s,r,l){"use strict";return class{constructor(e){let t=this;let c,d,u,p,m,g,f,h,w,v,D,y,C,b,S=e.commentData,P=e.displayMode||"normal",A=!0,E=i.createElement("div",{class:"DMUCommentMainDiv"+(S.markedAsDeleted?" DMUCommentDeleted":"")+(S.isExternal?" DMUExternalComment":"")}),x={},N=!1;function I(t){let n=t.from[0].view;if(n.classList.contains("DMUCommentCtxMenu"))return;let i=t.from[0].event.composedPath(),o=!n.classList.contains("DMUCommentReplyButton")&&(n===E||i&&i.find((e=>e.classList.contains("DMUCommentMainDiv")))===E);e.onClickCB&&E&&e.onClickCB({target:S,event:t,selected:o,div:E,isEnableEdition:Boolean(o&&n.getTagName&&"p"===n.getTagName()&&!S.isReadOnly())})}function M(t){var n;if(A){const i="data"in t?t.data.event:t.from[0].event;let o=i.composedPath();!(null===(n=i.target)||void 0===n?void 0:n.isContentEditable)&&(i.target===E||o&&o.find((e=>e.classList.contains("DMUCommentMainDiv")))===E)&&e.onCtxMenuCB&&e.onCtxMenuCB({target:S,event:i})}}function U(t){e.onReplyCB&&e.onReplyCB({target:S,event:t,allowReplies:Boolean(e.allowReplies)})}function k(){if(!d)return;const e=`${(null==p?void 0:p.getText())||""}${m?" - "+m.getText():""}${S.markupName?"\n"+S.markupName:""}`;d.setAttribute("title",e)}async function R(){if(!E||!p||!m)return;if(S.owner){if(S.owner.color||S.isExternal){let e=S.isExternal?"#77797C":S.owner.color;d&&d.getStyle("color").replace(/\s/g,"")!==e&&d.setStyle("color",e||"")}S.owner.name&&p.getText()!==S.owner.name&&(p.setText(S.owner.name),k()),S.owner.imageUrl&&"normal"===P&&(c?c.src!==S.owner.imageUrl&&(c.src=S.owner.imageUrl):c=i.createElement("img",{src:S.owner.imageUrl,events:{load:function(){c&&u&&d&&d.firstChild&&d.firstChild===u&&(d.removeChild(u),d.appendChild(c))},error:function(){u&&c&&d&&d.firstChild&&d.firstChild===c&&(d.removeChild(c),d.appendChild(u))}}}))}S.date&&m.getText()!==S.date&&(m.setText(S.date),k()),b&&S.markupName&&S.markupName!==b.getText()&&b.setText(S.markupName);let t=!S.isReadOnly()&&!S.hasAlertFlag()&&!S.disableEdition;f&&(f&&f.setReadOnly(!t),await f.setData(S.content)),S.isReadOnly()||S.hasAlertFlag()&&!E.hasClassName("readOnly")?(E.addClassName("readOnly"),v&&v.setStyle("display",S.hasAlertFlag()?"block":"none")):S.isReadOnly()||S.hasAlertFlag()||!E.hasClassName("readOnly")||(E.removeClassName("readOnly"),v&&v.setStyle("display","none"));const n=e.allowReplies&&!S.isReadOnly()&&!S.hasAlertFlag()&&S.allowReply;h&&h.setStyle("display",n&&!N?"":"none")}function _(){if(S.isReply&&e.allowReplies&&E.addClassName("reply"),(S.isReadOnly()||S.hasAlertFlag())&&E.addClassName("readOnly"),"normal"===P){d=i.createElement("div",{class:"DMUCommentPictureDiv"}).inject(E),u=i.createElement("i",{class:"wux-ui-3ds wux-ui-3ds-user"}).inject(d),S.isReply&&e.allowReplies||(g=i.createElement("div",{class:"DMUCommentRepliesCount"}).inject(E));let t=i.createElement("div",{class:"DMUCommentHeader"}).inject(E),s=i.createElement("div",{class:"DMUCommentHeaderInformation"}).inject(t),c=i.createElement("div",{class:"DMUCommentUserInformation"}).inject(s);if(p=i.createElement("div",{class:"DMUCommentOwner"}).inject(c),m=i.createElement("div",{class:"DMUCommentDate"}).inject(c),y=i.createElement("div",{class:"DMUCommentInformationIconDiv"}).inject(t),S.markedAsDeleted&&i.createElement("i",{class:"wux-ui-3ds-comment-delete wux-ui-3ds",title:l.commentDeleted}).inject(y),S.markupName&&!S.isReply&&(b=i.createElement("div",{class:"DMUCommentHeaderSubInformation",text:S.markupName}).inject(s)),f=r.createRichTextElement({className:"DMUCommentContent",allowMentions:e.allowReplies}).inject(E),f.addEventListener("onChange",(function(t){S.disableEdition||!e.onEditionEndCB||S.isReadOnly()||S.hasAlertFlag()||e.onEditionEndCB({target:S,value:t})})),f.addEventListener("onNewMentions",(function(t){S.disableEdition||e.onNewMentionsCB&&e.onNewMentionsCB({target:S,mentions:t})})),f.addEventListener("onCheckSelected",(function(t){e.onCheckSelectedCB&&e.onCheckSelectedCB({target:S,check:t})})),!S.isReadOnly()&&!S.hasAlertFlag()){let t=e.allowReplies?"reply":"plus",s=e.allowReplies?l.replyButtonLabel:l.addButtonLabel;h=i.createElement("div",{class:"DMUCommentReplyButton wux-ui-3ds wux-ui-3ds-"+t}).inject(E),a.getTouchMode()&&h.addClassName("touchMode"),new o({target:h,trigger:"hover",offset:{x:e.allowReplies?-10:-35,y:10},position:"bottom",arrowBoxFlag:!0}).setBody(s),e.onReplyCB&&n.addEvent(h,"onPrimaryPointerClick",U)}v=i.createElement("div",{class:"DMUCommentAlert wux-ui-3ds wux-ui-3ds-attention ",styles:{display:S.hasAlertFlag()?"block":"none"}}).inject(E),new o({target:v,trigger:"hover",position:"left",offset:{x:-10,y:-20}}).setBody(l.pointedPageRemoved)}else if("light"===P){E.hasClassName("DMUCommentMainDivLightMode")||E.addClassName("DMUCommentMainDivLightMode"),i.createElement("i",{class:"wux-ui-3ds wux-ui-3ds-comment"}).inject(E);let e=i.createElement("div",{class:"DMUCommentHeader"}).inject(E);p=i.createElement("div",{class:"DMUCommentOwner"}).inject(e),m=i.createElement("div",{class:"DMUCommentDate"}).inject(e)}e.onClickCB&&n.addEvent(E,"onPrimaryPointerClick",I),e.onCtxMenuCB&&!D&&(w=i.createElement("div",{class:"DMUCommentCtxMenu wux-ui-3ds wux-ui-3ds-chevron-down"}).inject(E),n.addEvent(w,"onPrimaryPointerClick",M),D=s.addEventListener(E,{callback:M})),e.onEnterCB&&E.addEventListener("mouseenter",(function(){E&&!E.hasClassName("hover")&&E.addClassName("hover"),e.onEnterCB&&e.onEnterCB({target:S,prehighlightedFlag:!0})})),e.onLeaveCB&&E.addEventListener("mouseleave",(function(){E&&E.hasClassName("hover")&&E.removeClassName("hover"),e.onLeaveCB&&e.onLeaveCB({target:S,prehighlightedFlag:!1})})),R()}e.allowReplies&&!S.isReply&&(E.style.setProperty("--last-reply-height","95px"),E.style.setProperty("--left-pos-line","23px")),this.getCommentDiv=function(){return E},this.update=async function(e){if(!e)return;let t=Object.keys(e);for(let n=0;n<t.length;n++)S[t[n]]!==e[t[n]]&&(S[t[n]]=e[t[n]]);await R()},this.updateDisplayMode=t=>{t!==P&&(P=t,e.onClickCB&&n.removeEvent(E,"onPrimaryPointerClick",I),e.onReplyCB&&h&&n.removeEvent(h,"onPrimaryPointerClick",U),e.onCtxMenuCB&&D&&(n.removeEvent(w,"onPrimaryPointerClick",M),s.removeEventListener(E,D),D=null),d&&d.firstChild&&d.firstChild.removeEvents(),f&&f.destroy(),E&&(E.removeEvents(),E.remove()),_())},this.setCtxMenuAvailability=function(e){A!==e&&(A=e,R())},this.addInformationIcon=({id:e,fontIcon:t,color:o,onClick:a})=>{y&&(x[e]?(x[e].iconDiv.setStyle("color",o||"rgb(119, 121, 124)"),x[e].iconDiv.className="DMUInformationIcon wux-ui-3ds "+t+(a?" DMUInformationIconHoverable":""),x[e].onClickToken&&(n.removeEventFromToken(x[e].onClickToken),x[e].onClickToken=void 0),a&&(x[e].onClickToken=n.addEvent(x[e].iconDiv,"onPrimaryPointerClick",(()=>a())))):(x[e]={iconDiv:i.createElement("i",{class:"DMUInformationIcon wux-ui-3ds "+t+(a?" DMUInformationIconHoverable":""),styles:{color:o||"rgb(119, 121, 124)"}})},a&&(x[e].onClickToken=n.addEvent(x[e].iconDiv,"onPrimaryPointerClick",(()=>a()))),y.appendChild(x[e].iconDiv)))},this.hideReplyButton=e=>{N=e,h&&h.setStyle("display",e?"none":"")},this.removeInformationIcon=e=>{y&&x[e]&&(x[e].onClickToken&&n.removeEventFromToken(x[e].onClickToken),y.removeChild(x[e].iconDiv),delete x[e])},this.updateDate=function(e){e&&m&&m.getText()!==e&&(m.setText(e),k())},this.enableContentEdition=function(e){setTimeout((function(){f&&(f.focus(),e&&f.selectText())}))},this.setInEdition=function(e){E&&(e?E.hasClassName("selected")||E.addClassName("selected"):E.hasClassName("selected")&&E.removeClassName("selected"))},this.updateRepliesCount=function(e){g&&(0===e?g.setStyle("visibility","hidden"):g.setStyle("visibility","visible"),g.setText("("+e+")")),t.updateTimelineLength()},this.setDisplayFlag=function(e,t){E&&(e?(E.setStyles({"padding-left":"5px","border-left":"5px solid "+(t?"#57B847":"#368EC4")}),E.style.setProperty("--left-pos-line","19px")):(E.setStyles({"padding-left":"","border-left":""}),E.style.setProperty("--left-pos-line","23px")))},this.setVisibleFlag=function(e){E&&(e?E.setStyle("display",""):E.setStyle("display","none"))},this.setHovered=function(e){E&&(e?E.hasClassName("hover")||E.addClassName("hover"):E.hasClassName("hover")&&E.removeClassName("hover"))},this.updateTimelineLength=function(){if(!E||S.isReply||!e.allowReplies)return;const t=E.lastChild,n=t&&t.getSize().height;n&&E.style.setProperty("--last-reply-height",n+"px")},this.setLoadingFlag=function(e){t.hideReplyButton(e),e?C=i.createElement("i",{class:"DMUCommentLoadingIcon"}).inject(E):C&&(C.remove(),C=null)},this.setUnselectableFlag=function(e){e?E.hasClassName("unselectable")||E.addClassName("unselectable"):E.hasClassName("unselectable")&&E.removeClassName("unselectable")},this.remove=function(){e.onClickCB&&n.removeEvent(E,"onPrimaryPointerClick",I),e.onReplyCB&&h&&n.removeEvent(h,"onPrimaryPointerClick",U),e.onCtxMenuCB&&D&&(n.removeEvent(w,"onPrimaryPointerClick",M),s.removeEventListener(E,D),D=null),x&&Object.keys(x).forEach((e=>t.removeInformationIcon(e))),d&&d.firstChild&&d.firstChild.removeEvents(),f&&f.destroy(),E&&(E.removeEvents(),E.remove(),E.destroy()),C=b=g=f=m=p=d=h=y=u=v=c=w=null},_()}}}));