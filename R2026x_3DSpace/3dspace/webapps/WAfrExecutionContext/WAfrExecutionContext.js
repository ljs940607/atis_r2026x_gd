define("DS/WAfrExecutionContext/mod_Component",["UWA/Core"],(function(t){"use strict";var e=Object.create(null),n=function(){};function o(t,e){if("object"!=typeof e)throw new Error("target obj to update must be an object");var n;n=t.prototype,Object.keys(n).forEach((function(t){e.hasOwnProperty(t)||Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}function i(t,e){if("function"!=typeof e)throw new Error("parameters must be constructors (i.e. functions)");o(t,e.prototype)}e.Component=n,n.implementsBy=function(t){i(n,t)},n.mixinProperties=function(t){o(n,t)},n.prototype.getExecutionContext=function(){return this._private._executionContext},n.prototype.setExecutionContext=function(t){this._private=this._private||Object.create(null),this._private._executionContext=t},n.prototype.getRegisteredIdentifier=function(){return this._private._identifier},n.prototype.setRegisteredIdentifier=function(t){this._private=this._private||Object.create(null),this._private._identifier=t},n.prototype.setInitializedState=function(t){if("boolean"!=typeof t)throw new Error("Initialization state must be a boolean value");this._private=this._private||Object.create(null),this._private._initialized=t},n.prototype.isInitialized=function(){return this._private._initialized},n.prototype.initialize=function(){return Promise.resolve()},n.prototype.clean=function(){return Promise.resolve()},n.prototype.destroy=function(){return Promise.resolve()},n.prototype.canBeParallelized=function(){return!0};var r=function(){};e.StandardComponent=r,n.implementsBy(r),r.implementsBy=function(t){i(r,t)},r.prototype.configure=function(){return Promise.resolve()},r.prototype.getExposedComponentCtor=function(){return null},r.prototype.getExposedComponent=function(){return this._private?this._private._publicComponent:null},r.prototype.setExposedComponent=function(t){this._private=this._private||Object.create(null),this._private._publicComponent=t},r.prototype.generateInterpreter=function(t){return null},r.prototype.getCurrentInterpreter=function(){return this._private._currentInterpreter},r.prototype.setCurrentInterpreter=function(t){this._private=this._private||Object.create(null),this._private._currentInterpreter=t},r.prototype.canBeParallelized=function(){return!1};var s=function(){};return e.Interpreter=s,s.prototype.interpret=function(t,e){throw new Error("Not implemented")},s.prototype.commit=function(t,e){throw new Error("Not implemented")},s.prototype.enrich=function(t,e){},e})),define("DS/WAfrExecutionContext/mod_HomePageManager",["DS/WAfrUtils/Logger"],(function(t){"use strict";function e(t){return"mod_WelcomeScreen"===t}function n(t){return t.options&&t.options.welcomeScreen}function o(t){let e=[];return t&&t.components&&t.components.keep&&(e=t.components.keep),e}return{HomePageManager:class{constructor(){this._private=Object.create(null),this._private.homePageRequested=!1,this._private.homePageDisplayed=!1,this._private.componentKeys=[]}get homePageRequested(){return this._private.homePageRequested}set homePageRequested(t){this._private.homePageRequested=t}get homePageDisplayed(){return this._private.homePageDisplayed}set homePageDisplayed(t){this._private.homePageDisplayed=t}set componentKeys(t){if(!Array.isArray(t))throw new Error("componentKeys must be an array");this._private.componentKeys=t}get componentKeys(){return this._private.componentKeys}hasComponentKey(t){return this._private.componentKeys.includes(t)}removeComponentKey(t){const e=this._private.componentKeys.findIndex((e=>e===t));-1!==e&&this._private.componentKeys.splice(e,1)}isHomePageAvailableComponent(t){let o=!1;return(n(t)||e(t.key))&&(o=!0),o}parseComponent(t,e,n){let o=e;return this.homePageRequested&&(this.isHomePageAvailableComponent(t)?n.push(t.key):o=!1),o}async initializeSequence(e){t.log("[Home Page Manager] Initialize WS applicative components"),await e.initializeApplicativeComponents(e.createComponentIterator(this.componentKeys)),t.log("[Home Page Manager] Set Up the application Home Screen"),await this.setUp(e),this.homePageDisplayed=!0}async setUp(t){const e=t.getSourceApp(),n=t.getProcessingApplication();await new Promise(((t,o)=>{const i=n.setUpWS({sourceApp:e,done:t,failure:o});i&&i.then(t,o)}))}cleanComponentMetadata(t){if(this.homePageRequested){const e=t.getSourceApp(),i=t.getTargetApp();if(!e||!i)throw new Error("Missing sourceApp or targetApp");const r=i.getTransitionFrom(e.getId()),s=i.getTransitionFromFamily(e.getFamily());let a=[];a=o(r),a=a.concat(o(s));(e.getIdCard().components||[]).forEach((e=>{-1===a.indexOf(e.key)&&(n(e)||t.removeMetadata(e.key))}))}}},isHomePageComponent:e}})),define("DS/WAfrExecutionContext/mod_ExecutionContext",["UWA/Utils","UWA/Core","DS/WAfrExecutionContext/mod_Component","DS/WAfrExecutionContext/mod_ExecutionContextInterpreter","DS/WAfrExecutionContext/mod_HomePageManager","DS/WAfrUtils/Logger","DS/WAfrContainer/App","DS/WAfrUtils/mod_PromiseUtils","DS/WAfrUtils/mod_ConcatenationUtils","DS/WAfrUtils/mod_Performances","DS/WebUAUtils/WebUAUtils","DS/WAfrModelEvents/mod_ModelEvents","UWA/Class/Promise"],(function(t,e,n,o,i,r,s,a,p,c,h,d){"use strict";const l=d.DEFAULT_COMPONENT_NAME,u=a.promisifiedRequire,m=p.hasConfigurationFor,f=p.getConfiguration,g=c.Performances,_="WAFR: ",C=i.HomePageManager,w=Object.create(null),x="a2x";function y(t){return t._extensions.get(x)}function A(t){const e=t._homePageManager;if(!e)throw new Error("No HomePageManager associated to the ExecutionContext");return e}function E(t){try{const e=t.getComponent(l),n={pv1:Date.now()-t.getSourceApp()?.getStartTimeApp()},o={pd1:t.getSourceApp()?.getUUID()||"None"},i={appID:t.getSourceApp()?.getId?.()||"None",pds:o,pvs:n};e?e.publish({event:"app_end",data:i}):console.error("Model events is undefined")}catch(t){console.error(t)}}function I(t){return{current:0,next:function(){return this.current>=t.length?null:t[this.current++]}}}function v(t){const e=n.Component.prototype,o=Object.keys(e);for(let e=0;e<o.length;e++){const n=o[e];if(!t.hasOwnProperty(n))return!1}return!0}async function S(t,e){for(let n=0;n<t.length;++n)await e(t[n])}async function D(t,e,n){const o=t.length,i=[];let r=null;for(let s=n?o-1:0;n?s>=0:s<o;n?--s:++s)r=e(t[s]),i.push(r);await Promise.all(i)}async function P(t){const e=t.iterator,n=t.action,o=t.inverse;if(null===n||"function"!=typeof n)throw new Error("The action cannot be null and must be a function returning a promise");if(!e)throw new Error("iterator must be defined.");const i=[],r=[];let s=e.next(),a=0;for(;s;)s.canBeParallelized()?i.push(s):o?r.unshift(s):r.push(s),s=e.next(),a+=1;o?(await D(i,n,o),await S(r,n)):(await S(r,n),await D(i,n,o))}function b(t,e,n){const o=t._stdComponents,i=t._appComponents,r=t._components;if(n){for(let t=i.length-1;t>=0;--t){const n=i[t];e(r[n],n)}for(let t=o.length-1;t>=0;--t){const n=o[t];e(r[n],n)}}else{for(const t of o)e(r[t],t);for(const t of i)e(r[t],t)}}function W(t,e,o){return o?n.Component.implementsBy(t):n.StandardComponent.implementsBy(t),new t(e)}async function k(t,e){if(t&&t._registry){r.log("[Execution context] getConfigurationData using registry.");const n=t._registry,o=n.get("getAppInfo"),i=n.get("setBrand"),s=n.get("getConfiguration"),a=n.get("setViewData"),p=t.getContainerView(),c=await o(e);let h="";c&&(h=await i(p,c.brand));let d=await s(c,p,this);return d?await a(p,d):d={},d.appId=e,d.title=c.title,d.brand=h,d.afrAppId||(d.afrAppId=e),d}throw new Error("Error while retrieving the Execution Context or its registry")}async function M(t){if(!t)throw new Error("The execution context must be defined to fetch its widget's data");const e=t.getContainerView();if(!e)throw new Error("Impossible to retrieve the execution context's widget data.");return e.getValues()}function R(t){return{getId:t.getId.bind(t),getComponent:function(e){return t.getComponent(e,!0)},registerComponent:function(e,n){t.registerApplicationComponent(e,n)},createAndRegisterComponent:t.createAndRegisterApplicationComponent.bind(t),unregisterComponent:t.unregisterApplicationComponent.bind(t),isRegisteredComponent:t.isRegisteredComponent.bind(t),recycleComponent:t.recycleComponent.bind(t),getData:function(){},getSourceApp:t.getSourceApp.bind(t),getTargetApp:t.getTargetApp.bind(t),getComponents:function(e){return t.getComponents(e,!0)},getContext:function(){return e.clone(t._contexts)},setContext:t.setContext.bind(t),switchApp:function(e,n){return e&&n?async function(t,e,n){if(!t)throw new Error("Execution context must be defined to perform a switch of application specialization");const o=t.getSourceApp(),i=t._masterAppId;let r;("localhost"===location.hostname||i===e||o&&o.getId()===e)&&(r=await M(t)),r&&r.afrSpecializations||(r=await k(t,e));let s=r&&r.afrSpecializations;if(!s||!Array.isArray(s))throw new Error("No compatible applications found in the declared configuration");if(!s.includes(n))throw new Error("The given application is not authorized to switch in the current execution context");if(!t._container)throw new Error("Cannot find the related container to the current Execution Context.");const a=await t._container.getApplicationJSON({afrAppId:n});t._masterAppId=e;const p={appIds:{appId:a.appId,afrAppId:a.appId},appInfo:null};return await t.load(a,void 0,p)}(t,e,n):async function(t,e){if(!t)throw new Error("Execution Context must be defined !");t._masterAppId!==e&&t._cleanSpecializationsData();const n=await k(t,e);if(n&&n.afrVersion&&"0.1"===n.afrVersion){const o={appId:e,afrAppId:e};return await t.load(n,void 0,o)}{const o=n&&n.afrAppId||e;if(!t._container)throw new Error("Cannot find the related container.");const i=await t._container.getApplicationJSON({afrAppId:o}),r={appId:e,afrAppId:o};return await t.load(i,void 0,r)}}(t,e)},gotoWelcomeScreen:function(){return t.gotoWelcomeScreen()},gotoApp:function(){return t.gotoApp()},getWelcomeScreenState:function(){return t.getWelcomeScreenState()},getWidgetID:t.getWidgetID.bind(t)}}return w.ExecutionContext=class{constructor(n){this._perf=new g,n=e.merge(n||{},{config:{components:[],interpreters:[]}}),this._id=n.id||t.getUUID(),this._registry=n&&n.registry,this._registry||r.error("[Execution context] No registry found"),this._config=n.config,this._config.interpreters=this._config.interpreters||[],this._interpreter=o.generateExecutionContextInterpreter(),this._extensions=new Map,this._components=Object.create(null),this._stdComponents=[],this._appComponents=[],this._handlers={},this.exposedApi=R(this),this._version=null,this._container=n.container,this._contexts=Object.create(null),this._homePageManager=new C,this._isConfigured=!1,this._container&&(this._container.subscribe("onReuseContext."+this.getId(),(t=>{this._cleanSpecializationsData();const e=t.applicationConcatenation||t;n={appIds:t.appIds,appInfo:t.appInfo},this.load(e,void 0,n).then(console.log,console.warn)})),this._container.subscribe("displayAfrLoader",(t=>{this.displayLoader(t)})),this._container.subscribe("hideAfrLoader",(()=>{this.hideLoader()})))}_cleanSpecializationsData(){const t=this.getContainerView();if(!t)throw new Error("Error while retrieving the containerView related to the current ExecutionContext");t.setValue("afrSpecializations",void 0),this._masterAppId&&delete this._masterAppId}async _initExecutionContext(t,n,o){await this._interpreter.updateConditionalContent(t),await this._interpreter.interpret(t,this),await this.registerStandardComponents();let i=await this.loadApp(t,o);if(this._targetApp=i.app,!this._targetApp)throw new Error("Not found a target app !");await this.prepareTransition(i),this._isConfigured=!1,this._components=e.merge(this._components,i.metaDatas),Object.keys(i.metaDatas).forEach((t=>{this._components[t].resetInfo&&!this._components[t].ctor&&(delete this._components[t],this._components[t]=i.metaDatas[t])})),this._appComponents=i.componentsKeys;A(this).componentKeys=i.WSComponentsKeys;let s=!1;for(let e in this._handlers){s=!1;for(let n=0;n<t.handlers.check.length;n++)t.handlers.check[n].identifier===e&&(t.handlers.check[n].defaultState=this._handlers[e],s=!0);if(!s){const n="default";for(let o=0;o<t.radioGroup.items.length;o++)t.radioGroup.items[o].identifier===e&&(t.radioGroup.items[o][n]=this._handlers[e])}}return await this.callAllInterpreters(t,n),r.log("[Execution context] Initialize standard components"),await this.initializeStandardComponents(this.createComponentIterator(this._stdComponents)),i}async _appPromiseSequence(t){let e=[],n=[],o=[];t&&0!==Object.keys(t).length&&t.componentsKeys&&t.componentsKeys.forEach((t=>{this._components[t].component&&n.push(this._components[t].component)}));for(const i of this._appComponents){const r=this._components[i];r.component?t||r.component.isInitialized()||(r.context&&r.context.fit||!r.context)&&n.push(r.component):(r.context&&r.context.fit||!r.context)&&(r.ctor?(this.registerComponentThruMetaData(i,r),n.push(r.component)):(o.push(r.module),e.push(i)))}await new Promise(((t,i)=>{require(o,function(){let i,r,s,a;for(arguments.length!=o.length&&t(),i=0;i<arguments.length;i++)r=arguments[i],s=e[i],a=this._components[s],a.ctor=r,this.registerComponentThruMetaData(s,a),n.push(a.component);t()}.bind(this),i)})),await this.initializeApplicativeComponents(I(n)),r.log("[Execution context] Configure standard components"),this._isConfigured||await this.configureComponents({iterator:this.createComponentIterator(this._stdComponents),setConfiguredFlag:!0}),r.log("[Execution context] Initialize application");const i=await this.setUpApp();i&&(r.warn("[WARNING] App should use the UIFrame component to add UI to their App"),i.inject(this.getUiContainer()));A(this).homePageDisplayed=!1}createComponentIterator(t){return e=t,n=this._components,{current:0,next:function(){let t;for(;this.current<e.length&&!t;){const o=e[this.current];t=n[o]?n[o].component:void 0,this.current+=1}return t}};var e,n}whenAvailable(){return Promise.resolve()}_disposeExecutionContext(){this._timerHandle&&clearTimeout(this._timerHandle),this._sourceApp&&this._sourceApp.dispose(),b(this,(t=>{t.component&&(t.component.clean(!0),t.component.setInitializedState(!1),t.component.destroy(!0),t.component.setExecutionContext(null),this.removeComponent(t))}),!0),delete this._components,delete this._stdComponents,delete this._appComponents,delete this.exposedApi,delete this._contexts,this._container=null}whenAvailableAfterClose(){return Promise.resolve()}setView(t){this._view=t}getUiContainer(){return this._view.getDom()}getContainerView(){return this._container?this._container._view:null}getTargetApp(){return this._targetApp}getWidgetID(){if(!this._container)throw new Error("No container attached to this execution context.");return this._container.id}getSourceApp(){return this._sourceApp}getProcessingApplication(){let t=this.getTargetApp();if(!t&&(t=this.getSourceApp(),!t))throw new Error("No processing application found (no source app, no target app)");return t}getId(){return this._id}get applicationContext(){return console.warn("[WAfrExecutionContext] Deprecated getter applicationContext on ExecutionContext. Use exposedApi instead."),this.exposedApi}getComponent(t,e){if(!t)throw new Error(`Invalid identifier ${t}`);let n;if(this._components){const o=this._components[t];if(o&&o.component){const t=o.component;e?t.getExposedComponent&&t.getExposedComponent()?n=t.getExposedComponent():o.standard||(n=t):n=t}}return n}async cleanComponent(t,e){if(!t)throw new Error("Component must be defined");const n=t.getRegisteredIdentifier();if(null==n||"string"!=typeof n)throw new Error(`Invalid identifier ${n}`);const i=this._components[n];if(!i)throw new Error("The MetaData for this component do not exists");return r.log("[Execution context] clean component",n),await t.clean(),i.standard||t.setInitializedState(!1),i.recycled&&i.context&&(o.evaluate(this._contexts,i.context),i.recycled=i.context.fit),i.recycled||i.standard?i.recycled=!1:(r.log("[Execution context] destroy component",n),await t.destroy(),r.log("[Execution context] Remove component",n," from execution context"),this.removeComponent(i,e&&!i.standard)),t}async unregisterComponent(t,e){if(null==t||"string"!=typeof t)throw new Error(`Invalid identifier ${t}`);if(this._components[t]){const n=this._components[t];if(n.standard&&e)throw new Error("Invalid access, try to unregister a standard component from application side");const o=n.component;return r.log("[Execution context] clean component",t),await o.clean(),r.log("[Execution context] destroy component",t),await o.destroy(),r.log("[Execution context] Remove component",t,"from execution context"),this.removeComponent(n,!0),o}}isRegisteredComponent(t){if(!t)throw new Error("The component is null or undefined");let e=!1;const n=t.getRegisteredIdentifier(),o=this._components[n];return o&&o.component&&(o.component===t||o.component.getExposedApi&&o.component.getExposedApi()===t)&&(e=!0),e}async cleanComponents(t){return await P({action:e=>this.cleanComponent(e,!!t&&t.removeForGood),inverse:!0,iterator:t&&t.iterator?t.iterator:this.createComponentIterator(this._appComponents.concat(this._stdComponents))})}async destroyComponents(t){if(!t)throw new Error("Missing iterator");return await P({action:async t=>{r.log("[Execution context] destroy component",t.getRegisteredIdentifier());const e=this._components[t.getRegisteredIdentifier()];await t.destroy();const n=!e.standard;return this.removeComponent(e,n)},inverse:!0,iterator:t})}recycleComponent(t,e){if(null==t||"string"!=typeof t)throw new Error("Invalid identifier "+t);const n=this._components[t];if(n){if(n.standard)throw new Error("Cannot recycle a standard component");if(!n.recycled&&(n.recycled=!0,e)){const e=this._targetApp.options.appConfig.components.find((e=>e.key==t));n.options=e.options,n.component&&(n.component.options=e.options),e.when?(n.context={element:e.key,when:o.parseWhen(e.when)},o.evaluate(this._contexts,n.context)):delete n.context}}}getComponents(t,e){if(!t)throw new Error("Predicate function is mandatory");const n=[];let o;return b(this,((i,r)=>{o=this.getComponent(r,e),o&&t(o)&&n.push(o)})),n}registerComponent(t,e,n,o){if(null==t||"string"!=typeof t)throw new Error("Invalid identifier "+t);if(null==e)throw new Error("Component cannot be null");if(o&&!v(Object.getPrototypeOf(e))&&!v(e))throw new Error("the given component do not contains some methods of DS/WAfrExecutionContext/mod_Component");if("setExecutionContext"in e==!1||"setRegisteredIdentifier"in e==!1)throw new Error("The component do not implements module:DS/WAfrExecutionContext/mod_Component~Component. Use applyComponentMixin first from the context.");if(this._components[t])throw new Error("An component has already been registered with this identifier "+t);const i=n?this._appComponents:this._stdComponents,r={standard:!n};this._components[t]=r,i.push(t),this.registerComponentThruMetaData(t,r,e)}removeComponent(t,e){if(!t)throw new Error("You must provide a metaData");if(!t.component)throw new Error("The component is already removed");const n=t.component.getRegisteredIdentifier();if(t.component.setExecutionContext(null),t.component.setRegisteredIdentifier(null),delete t.component,e){const e=t.standard?this._stdComponents:this._appComponents,o=e.indexOf(n);if(o>=0&&e.splice(o,1),!t.standard){A(this).removeComponentKey(n)}delete this._components[n]}}registerComponentThruMetaData=function(t,e,o){if(!e)throw new Error("The metaData do not exist: the module may not be required");if(e.component)throw new Error("The component: "+e.component._private._identifier+" is already created");if(!o){if(!e.ctor)throw new Error("The Component constructor must be defined.");if("function"!=typeof e.ctor)throw new Error(" Component constructor must be a constructor (i.e. functions)");o=W(e.ctor,e.options,!e.standard)}e.component=o;const i=e.standard?this:this.exposedApi;e.component.setExecutionContext(i),e.component.setRegisteredIdentifier(t);const r=e.component.createExposedComponent&&e.component.createExposedComponent();if(r)n.Component.mixinProperties(r),r.setExecutionContext(this.exposedApi),r.setRegisteredIdentifier(t),e.component.setExposedComponent(r);else{const n=e.component.getExposedComponentCtor&&e.component.getExposedComponentCtor();if(n){const o=W(n,void 0,!0);o.setExecutionContext(this.exposedApi),o.setRegisteredIdentifier(t),e.component.setExposedComponent(o)}}return e.component};removeMetadata(t){this._components&&delete this._components[t]}createAndRegisterComponent(t,e,n,o){if(this._components[t])return;const i=W(e,n,o);if(this.registerComponent(t,i,o),!this._components[t])throw new Error("The metaData for component do not exist !");return this._components[t].ctor=e,i}async requireStandardComponents(t,e){if(t.length!==e.length)throw new Error("Modules and keys do not have the same size!");let n,o,i,r,s;return new Promise(((a,p)=>{require(t,function(){let t;for(n=0;n<arguments.length;n+=1)o=arguments[n],i=e[n],t=this._components[i],r=t.ctorImport,s=r?o[r]:o,t.ctor=s,this.registerComponentThruMetaData(i,t);a()}.bind(this),p)}))}async registerStandardComponents(){r.log("[Execution context] Register standard components if need ");let t=[],n=[];if(this._stdComponents.length>0){let e;const i=[],r=[];for(const s of this._stdComponents){const a=this._components[s];a.context&&(o.evaluate(this._contexts,a.context),e=a.context.fit,a.component?!e&&a.component&&(i.push(a.component),r.push(a.component)):e&&(t.push(a.module),n.push(s)))}await this.cleanComponents({iterator:I(i)}),await this.destroyComponents(I(r))}else{const o=this.parseComponents(this._config.components,!1);this._components=e.merge(this._components,o.metaDatas),this._stdComponents=o.componentsKeys,t=o.readyModules,n=o.readyKeys}return await this.requireStandardComponents(t,n)}async initializeStandardComponents(t){if(!t)throw new Error("Missing iterator parameter");let e=null;return await P({action:async t=>{e=t.getCurrentInterpreter&&t.getCurrentInterpreter(),e&&e.commit&&e.commit(this,{componentId:t.getRegisteredIdentifier()});const n=this._perf.start(_+"initialize std :"+t._private._identifier);await t.initialize(),this._perf.stop(n)},iterator:t})}async enrichStandardComponents(t){const e=this._interpreters;for(let n=0;n<e.length;++n){const o=e[n];o.enrich&&await o.enrich(t,this)}}async configureComponents(t){await P({action:async function(t){return await t.configure()},iterator:t&&t.iterator?t.iterator:this.createComponentIterator(this._stdComponents)}),t&&t.setConfiguredFlag&&(this._isConfigured=!0)}registerApplicationComponent(t,e){if(!e)throw new Error("Component is null");return this.registerComponent(t,e,!0,!0)}createAndRegisterApplicationComponent(t,e,n){if(!e)throw new Error("Component is null");return this.createAndRegisterComponent(t,e,n,!0)}getApplicationComponent(t){return this.getComponent(t,!0)}unregisterApplicationComponent(t){return this.unregisterComponent(t,!0)}isRegisteredApplicationComponent(t){return this.isRegisteredComponent(t)}recycleApplicationComponent(t,e,n){if(e){if(!e.metaDatas[t])throw new Error('The App "'+this._targetApp.getId()+'" has requested to recycle the component "'+t+'" but do not declare it in its list of components :\n'+JSON.stringify(e.metaDatas,null,2))}return this.recycleComponent(t,n)}async prepareTransition(t){let e,n,o=0;if(!this._sourceApp)return;await this._sourceApp.onWillLeave(this._targetApp),await this._targetApp.onWillEnter(this._sourceApp);let i=!0,r=this._targetApp.getTransitionFrom(this._sourceApp.getId());if(r||(r=this._targetApp.getTransitionFromFamily(this._sourceApp.getFamily())),r){const s=r.components||{},a=r.handlers||{};if(null!=r.resetInfo&&(i=r.resetInfo),s.keep)if("@all"===s.keep)for(e in this.exposedApi._components)this.recycleApplicationComponent(e,t,i);else if(Array.isArray(s.keep))for(;o<s.keep.length;o++)n=s.keep[o],this.recycleApplicationComponent(n,t,i);if(a.keep&&Array.isArray(a.keep)){const e=this._sourceApp.options.appConfig.handlers.check,n=t.app.options.appConfig.handlers.check,i=this._sourceApp.options.appConfig.radioGroup.items,r=t.app.options.appConfig.radioGroup.items;let s="",p=s,c=s;const h=this.getComponent(WAfrStandardComponentKey.HandlerComponent);for(o=0;o<a.keep.length;o++){c=a.keep[o],s=p="";for(let t=0;t<e.length;t++)if(e[t].identifier==c){s=e[t].identifier+"-"+e[t].check.identifier+"-"+e[t].uncheck.identifier;break}for(let t=0;t<n.length;t++)if(n[t].identifier===c){p=n[t].identifier+"-"+n[t].check.identifier+"-"+n[t].uncheck.identifier;break}if(p===s&&""!=s){const t=h.getCheckState({id:c});this._handlers[c]=t}else{for(let t=0;t<i.length;t++)if(i[t].identifier==c)for(let e=0;e<i[t].items.length;e++)1==h.getRadioItemState({radioId:i[t].identifier,id:i[t].items[e].identifier})&&(s=i[t].identifier+"-"+i[t].items[e].identifier+"-"+i[t].items[e].check.identifier+"-"+i[t].items[e].uncheck.identifier);for(let t=0;t<r.length;t++)if(r[t].identifier==c)for(let e=0;e<r[t].items.length;e++)if(p=r[t].identifier+"-"+r[t].items[e].identifier+"-"+r[t].items[e].check.identifier+"-"+r[t].items[e].uncheck.identifier,p==s){const n=r[t].items[e].identifier;this._handlers[c]=n;break}}}}}await this.cleanComponents({removeForGood:!0});return A(this).cleanComponentMetadata(this),t}async initializeApplicativeComponents(t){if(!t)throw new Error("Missing iterator in initializeApplicativeComponents");return await P({action:async t=>{let e=this._perf.start(_+"initialize "+t._private._identifier);const n=this._components[t.getRegisteredIdentifier()];await t.initialize(n&&n.options),t.setInitializedState(!0),this._perf.stop(e)},iterator:t})}async load(t,e,n){if(!t.appId&&!t.afrAppId)throw new Error("Not found a valid App id from the current Id Card ");h.setAppid(t.appId||t.afrAppId),this.onWillLoadApp(t.appId||t.afrAppId),e||(e=t.afrVersion||"0.1"),r.log("[Execution context] load new app "+t.appId);try{if(m(t,"a2x")){if(!this._extensions.has(x)){const e=new((await u("DS/WAfrA2XExecutionContext/mod_ExecutionContextA2XExtension")).ExecutionContextA2XExtension)(t);this._extensions.set(x,e)}}else if(this._extensions.has(x)){const t=new Error("Trying to switch from an A2X to a non-A2X Application");console.error(t)}const o=y(this);let i;if(o&&await o.beginLoad(this,t,e,n),this.setInitialContext(t.initialContext),this._sourceApp&&(t.afrTransitionsFrom||t.afrTransitionsFromFamily)&&(i=t.afrTransitionsFrom?t.afrTransitionsFrom[this._sourceApp.getId()]:null,i||(i=t.afrTransitionsFromFamily?t.afrTransitionsFromFamily[this._sourceApp.getFamily()]:null),i&&"ReuseContext"===i.type)){const t=i.components||{};if(t.keep){if("@all"===t.keep)throw"TODO";if(Array.isArray(t.keep)){const e={};for(let n=0;n<t.keep.length;n++){const o=t.keep[n],i=this._components[o];i&&i.context&&!0===i.context.fit&&Object.keys(i.context.when).forEach((function(t){e[t]=i.context.when[t]}))}Object.keys(e).forEach((t=>{const n=e[t];null!=n&&(this._contexts[t]=String(n))}))}}}const s=await this._initExecutionContext(t,e,n),a=A(this);o&&(a.homePageRequested=a.homePageRequested&&o.allowHomePage(this.getWidgetID())),function(t,e){if(!t||!e)throw new Error("Missing parameter in configureApplication.");e._executionContext=t.exposedApi,e.setContainer(t.getContainerView())}(this,s.app),a.homePageRequested?await a.initializeSequence(this):o?await o.load(this):await this._appPromiseSequence(s);const p=this.getComponent(l);r.log("[Execution context] set the target app",this._targetApp,"as source app"),this.getSourceApp()&&!this.getSourceApp().isDisposeCalled()&&(E(this),this.getSourceApp().dispose());const c={pd1:this._targetApp.getUUID?.()||"None"},h={appID:this._targetApp?.getId?.()?this._targetApp.getId():"",pds:c};p?p.publish({event:"app_launch",data:h}):console.error("Model events is undefined"),this._sourceApp=this._targetApp,this._targetApp=null,this.hideLoader(),this.onDidLoadApp()}catch(t){return this.getSourceApp()&&h.setAppid(this.getSourceApp().getId()),this.hideLoader(),this.onDidFailToLoadApp(t),this._targetApp=null,Promise.reject(t)}}async loadApp(t,e){return await new Promise(((n,o)=>{let i=t.afrCode;i||(i="DS/WAfrAppManager/App"),i=i.replace(/\./g,"/");const a=this.parseComponents(t.components||[],!0),p=[i].concat(a.readyModules);let c,h,d,l,u,m;r.log("[Execution Context] Require modules",p),require(p,function(){const o=arguments[0];if(arguments.length!==a.readyKeys.length+1)throw new Error("The count of arguments and components do not fit");for(c=0;c<a.readyKeys.length;c++)h=a.readyKeys[c],d=a.metaDatas[h],l=arguments[c+1],u=d.ctorImport,m=u?l[u]:l,d.ctor=m,this.registerComponentThruMetaData(h,d);const i=new o({appConfig:t,appIds:e?e.appIds:null,appInfo:e?e.appInfo:null});if(i instanceof s==!1)throw new Error("The app loaded is not an instance of DS/WAfrAppManager/App");if(!i.getId())throw new Error("The app loaded do not have an id");const p=y(this);p&&p.overloadApp(i,this),r.log("[App Interpreter] Success require App and components"),n({app:i,metaDatas:a.metaDatas,componentsKeys:a.componentsKeys,WSComponentsKeys:a.WSComponentsKeys})}.bind(this),o)}))}async callAllInterpreters(t,e){r.log("[Execution context] Start interpret id card");const n=[];let o=this._version!==e;const i=f(t);if(!this._interpreters){this._interpreters=[],o=!1;for(let t=0;t<this._config.interpreters.length;++t){const n=this._config.interpreters[t].module,o=await n.generateInterpreter(e,i);this._interpreters.push(o)}}const s=this._interpreters;for(let r=0;r<this._interpreters.length;++r){let a=null;o?(a=await this._config.interpreters[r].module.generateInterpreter(e,i),s[r]=a):a=s[r];const p=this._config.interpreters[r].target,c=this.getComponent(p);if(!c)throw new Error("No component associated to the given interpreter");if(c.setCurrentInterpreter(a),a){const e=a.interpret(t,this,{componentId:p});n.push(e)}}return await Promise.all(n)}async setUpApp(){const t=this.getProcessingApplication(),e=this._sourceApp;if(!t)throw new Error("Missing parameter while calling SetUp function.");return await new Promise(((n,o)=>{const i=t.setUp({sourceApp:e,done:n,failure:o});i&&i.then(n,o)}))}async dispose(){E(this);const t=y(this);t&&await t.dispose(this),await this._disposeExecutionContext()}onDidChangeContext(){this._timerHandle=null;const t=this._contexts;b(this,(function(e){e.context&&o.evaluate(t,e.context)})),this.onDidProcessContextualComponent()}parseComponents(t,e){const n=[],i=[],r={},s=[],a=[];for(let p of t){let t=!0,c={module:p.code,ctorImport:p.ctor,options:p.options,standard:!e,resetInfo:p.resetInfo};if(r[p.key]=c,s.push(p.key),p.when&&(c.context={element:p.key,when:o.parseWhen(p.when)},o.evaluate(this._contexts,c.context),t=c.context.fit),e){t=A(this).parseComponent(p,t,a)}t&&(n.push(p.code),i.push(p.key))}return{readyModules:n,readyKeys:i,metaDatas:r,componentsKeys:s,WSComponentsKeys:a}}setInitialContext(t){const e=Object.create(null);let n;Object.keys(t||e).forEach((function(o){n=t[o],null!=n&&(e[o]=String(n))})),this._contexts=e}setContext(t,e){return this._contexts[t]!==e&&(e?this._contexts[t]=String(e):delete this._contexts[t],this._timerHandle&&clearTimeout(this._timerHandle),this._timerHandle=setTimeout(this.onDidChangeContext.bind(this,this._contexts),0)),this}_dispatchEvent(t,e){const n=this.getComponent("AFR_ModelEvents");n&&n.publish({event:t,scope:"ALL",data:e})}onWillLoadApp(t){this._dispatchEvent("onWillLoadApp",t)}onDidLoadApp(t){this._dispatchEvent("onDidLoadApp",t)}onDidFailToLoadApp(t){this._dispatchEvent("onDidFailToLoadApp",t)}onDidContextualComponentsUpdate(){this._dispatchEvent("onDidContextualComponentsUpdate")}async onDidProcessContextualComponent(){const t=[],e=[],n=[],o=[],i=[],r=[],s=A(this);b(this,((a,p)=>{if(a.context){let c=!0;a.standard||s.hasComponentKey(p)||(c=c&&!s.homePageDisplayed),c&&a.context.fit&&!a.component?a.ctor?(this.registerComponentThruMetaData(p,a),a.standard?i.push(a.component):r.push(a.component)):(t.push(a.module),e.push(p)):a.context.fit||a.component&&(n.push(a.component),a.standard&&o.push(a.component))}})),await new Promise(((n,o)=>{let s,a,p,c;require(t,function(){if(arguments.length!==t.length)return n();for(s=0;s<arguments.length;s++)a=arguments[s],p=e[s],c=this._components[p],c.ctor=a,c=this._components[p],this.registerComponentThruMetaData(p,c),c.standard?i.push(c.component):r.push(c.component);n()}.bind(this),o)})),await this.cleanComponents({iterator:I(n)}),await this.destroyComponents(I(o)),await this.initializeStandardComponents(I(i)),await this.initializeApplicativeComponents(I(r)),s.homePageDisplayed||s.homePageRequested||await this.configureComponents({iterator:I(i),setConfiguredFlag:!1}),this.onDidContextualComponentsUpdate()}displayLoader(t){this._container&&this._container.id!=t.id||this._view&&this._view.displayLoader(t)}hideLoader(){this._view&&this._view.hideLoader()}async gotoWelcomeScreen(){const t=y(this);t&&await t.gotoWelcomeScreen(this);const e=A(this);e.homePageRequested=!0,await e.setUp(this);const n=this.getComponent("AFR_UIFrameManager");n&&n.isStatusBarDisplayed()&&n._privateSetStatusBarWrapperVisibility(!1),e.homePageDisplayed=!0}async gotoApp(){A(this).homePageRequested=!1;const t=y(this);if(t)return await t.gotoApp(this);const e=this.getComponent("AFR_UIFrameManager");return e&&e.isStatusBarDisplayed()&&e._privateSetStatusBarWrapperVisibility(!0),await this._appPromiseSequence()}getWelcomeScreenState(){return A(this).homePageDisplayed}},w})),define("DS/WAfrExecutionContext/mod_ExecutionContextInterpreter",["DS/WAfrUtils/mod_Performances","DS/WAfrExecutionContext/mod_HomePageManager"],(function(t,e){"use strict";const n=t.Performances,o=e.isHomePageComponent;function i(t,e){const n=t.split("==");if(2!==n.length)throw new Error("Bad syntax, expected expression like A == B, found "+t);const o=n[0].trim(),i=n[1].trim();if(o.indexOf('"')>=0||i.indexOf('"')>=0)throw new Error('Bad syntax, key and value should not contain double quote ", found '+t);if(o.indexOf(" ")>=0||i.indexOf(" ")>=0)throw new Error("Bad syntax, key and value should not contain space, found "+t);e[o]=i}function r(t,e,n){const o="["+t.module+"] "+t.func,i=n.start(o);return new Promise(((o,r)=>{function s(){n.stop(i),o()}function a(){n.stop(i),r()}require([t.module],(function(n){return(0,n[t.func])(s,a,e)}),(function(t){return n.stop(i),r(t)}))}))}class s{constructor(){this._perf=new n,this._executionContext=void 0,this._components=[],this._UIModel=void 0}interpret(t,e,n){this._executionContext=e,this._components=t.components,this._UIModel=t.UIModel;let i=!1;this._components&&this._components.forEach((function(t){t&&o(t.key)&&(i=!0)}));const r=this._executionContext._homePageManager;if(!r)throw new Error("No HomePageManager associated to the ExecutionContext");return this._components&&i&&!this._executionContext.getSourceApp()?r.homePageRequested=!0:i||(r.homePageRequested=!1,r.homePageDisplayed=!1),Promise.resolve()}updateConditionalContent(t){let e=Promise.resolve();if(t.conditions){const n={appId:t.appId};let o=[],i=[];for(const[e,s]of Object.entries(t.conditions))o.push(e),i.push(r(s,n,this._perf));e=Promise.allSettled(i).then((e=>{let n={};for(let t=0;t<o.length;++t)n[o[t]]=e[t];let i=t.components;if(i)for(let t=i.length-1;t>=0;--t)i[t].condition&&"rejected"===n[i[t].condition].status&&i.splice(t,1);let r=t.handlers.default;if(r)for(let t=r.length-1;t>=0;--t)r[t].condition&&"rejected"===n[r[t].condition].status&&r.splice(t,1);let s=t.handlers.check;if(s)for(let t=s.length-1;t>=0;--t)s[t].condition&&"rejected"===n[s[t].condition].status&&s.splice(t,1);let a=t.radioGroup;if(a&&(a=a.items,a))for(let t=a.length-1;t>=0;t--)a[t].condition&&"rejected"===n[a[t].condition].status&&a.splice(t,1);let p=t.UIModel;if(p&&(p=p.handlerList,p))for(let t=p.length-1;t>=0;t--)p[t].condition&&"rejected"===n[p[t].condition].status&&p.splice(t,1);let c=t.UIModel;if(c&&(c=c.categories,c))for(let t=c.length-1;t>=0;t--)c[t].condition&&"rejected"===n[c[t].condition].status&&c.splice(t,1)}))}return e}}return{generateExecutionContextInterpreter:function(t){return new s},parseWhen:function(t){const e={};if(t.indexOf("&&")>=0){const n=t.split("&&");if(n.length<2)throw new Error("Bad syntax, expected expression like A == B && C == D, found "+t);n.forEach((t=>{i(t,e)}))}else i(t,e);return e},evaluate:function(t,e){let n=!0;Object.keys(e.when).forEach((function(o){n=n&&e.when[o]===t[o]})),n&&!e.fit?e.fit=!0:n||(e.fit=!1)}}}));