define("DS/IterationsWidget/IterationsDataGridTable",["UWA/Controls/Abstract","UWA/Core","DS/ENOjquery/ENOjquery","DS/ENO6WPlugins/jQueryUI","DS/IterationsWidget/IterationsServices","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/Tweakers/GeneratedToolbar","i18n!DS/IterationsWidget/assets/nls/IterationsWidget"],(function(t,e,i,n,o,s,r,a,l,d){"use strict";return t.extend({init:function(t,e,i,n,o,s,r){this._parent({}),this._oid=i.oid,this.NLS=t,this.lang=e,this._isODT=n,this._parentContainer=i.parentContainer,this._actionsContainer=i.actionsContainer,this.list=i.iterations,this._treeList=null,this.selectedObjects=[],this._po_exposed=s||{},this.withTooltipByPath=r||!1,this.buildUITree(i.iterations,o)},buildUITree:function(t,n){var d=this;this.container=e.createElement("div",{class:"iterations-datagrid-list-container"}),this.container.setStyle("position","relative"),this.container.setStyle("overflow","hidden"),this.container.setStyle("width","100%"),this.container.setStyle("height","100%"),this._treeModel=new s({id:"iterations-datagrid-list-model"});var c=!1,h=!1,u=!1;t.forEach((t=>{t.isMIB?c=!0:h=!0,t.newDataFormat&&(u=!0)})),this._treeModel.prepareUpdate();for(var m=[],p=t.length-1;p>=0;p--){var g=t[p],f=p;(g.isMIB||g.newDataFormat)&&(f=g.displayed_iteration);var v=g.name;void 0!==g.selectedobject&&1==g.selectedobject&&(v+=this.NLS.get("LastSavedModelString"));var b=new Date(parseInt(g.date_ms)).toLocaleString(this.lang);!u&&g.date.indexOf("*")>=0&&(b+="(*)");var w=g.icon_fullpath,_=new r({label:p,grid:{tree:g,specific:g.specific,number:f,name:v,icon_fullpath:w,description:g.description,date:b,datems:g.date_ms,modified_by:g.modified_by,iternumber:g.iternumber,isMIB:g.isMIB,iterationObj:p}});this._treeModel.addRoot(_),m.push(_)}this._treeModel.pushUpdate();var y=[];let S={text:this.NLS.get("iterationNumber"),dataIndex:"number",width:"40px",fontWeight:"bolder",pinned:"left",typeRepresentation:"integer",sortableFlag:!0,alignment:"near"};n&&n.dgv_columns&&n.dgv_columns.column_iternumber&&(n.dgv_columns.column_iternumber.nlsKey&&(S.text=this.NLS.get(n.dgv_columns.column_iternumber.nlsKey)),n.dgv_columns.column_iternumber.hasOwnProperty("visible")&&(S.visibleFlag=n.dgv_columns.column_iternumber.visible),n.dgv_columns.column_iternumber.hasOwnProperty("sortable")&&(S.sortableFlag=n.dgv_columns.column_iternumber.sortable)),y.push(S);let C={text:this.NLS.get("iterationName"),dataIndex:"name",width:"auto",fontWeight:"bolder",sortableFlag:!0,visibleFlag:!!h,getCellSemantics:function(t){if(t.nodeModel&&t.nodeModel.getAttributeValue("icon_fullpath"))return{icon:t.nodeModel.getAttributeValue("icon_fullpath")}}};n&&n.dgv_columns&&n.dgv_columns.column_name&&(n.dgv_columns.column_name.nlsKey&&(C.text=this.NLS.get(n.dgv_columns.column_name.nlsKey)),n.dgv_columns.column_name.hasOwnProperty("visible")&&(C.visibleFlag=n.dgv_columns.column_name.visible),n.dgv_columns.column_name.hasOwnProperty("sortable")&&(C.sortableFlag=n.dgv_columns.column_name.sortable)),y.push(C);let I={text:this.NLS.get("iterationModificationDate"),dataIndex:"date",width:"auto",fontWeight:"bolder",sortableFlag:!1,compareFunction:function(t,e,i,n){return i.options.grid.datems-n.options.grid.datems}};n&&n.dgv_columns&&n.dgv_columns.column_date&&(n.dgv_columns.column_date.nlsKey&&(I.text=this.NLS.get(n.dgv_columns.column_date.nlsKey)),n.dgv_columns.column_date.hasOwnProperty("visible")&&(I.visibleFlag=n.dgv_columns.column_date.visible),n.dgv_columns.column_date.hasOwnProperty("sortable")&&(I.sortableFlag=n.dgv_columns.column_date.sortable)),y.push(I);let T={text:this.NLS.get("modifiedBy"),dataIndex:"modified_by",width:"auto",fontWeight:"bolder",sortableFlag:!0,visibleFlag:!!c};n&&n.dgv_columns&&n.dgv_columns.column_onwer&&(n.dgv_columns.column_onwer.nlsKey&&(T.text=this.NLS.get(n.dgv_columns.column_onwer.nlsKey)),n.dgv_columns.column_onwer.hasOwnProperty("visible")&&(T.visibleFlag=n.dgv_columns.column_onwer.visible),n.dgv_columns.column_onwer.hasOwnProperty("sortable")&&(T.sortableFlag=n.dgv_columns.column_onwer.sortable)),y.push(T);let x={text:this.NLS.get("iterationComments"),dataIndex:"description",width:"auto",fontWeight:"bolder",sortableFlag:!1,typeRepresentation:"multilineString"};n&&n.dgv_columns&&n.dgv_columns.column_comment&&(n.dgv_columns.column_comment.nlsKey&&(x.text=this.NLS.get(n.dgv_columns.column_comment.nlsKey)),n.dgv_columns.column_comment.hasOwnProperty("visible")&&(x.visibleFlag=n.dgv_columns.column_comment.visible),n.dgv_columns.column_comment.hasOwnProperty("sortable")&&(x.sortableFlag=n.dgv_columns.column_comment.sortable)),y.push(x);var D=!1;this._actionsContainer.restoreBtn&&this._actionsContainer.restoreBtn.displayInCtxMenu&&(D=!0),this._actionsContainer.openBtn&&this._actionsContainer.openBtn.displayInCtxMenu&&(D=!0),D&&y.push({text:this.NLS.get("IterationsDataGridTableMenu"),dataIndex:"ContextualMenuColumn",hasCellValue:function(){return!0}});let W=[],A=[];if(this._actionsContainer.restoreBtn){let t="toolbar_restore",e={position:"far",tooltip:this._actionsContainer.restoreBtn.title,disabled:!0,typeRepresentation:"functionIcon",icon:{iconName:"fonticon fonticon-rotate-ccw",fontIconFamily:1},value:function(t){console.log("on_toolbar_restore"),d._actionsContainer.restoreBtn.onclick()}};n&&n.behaviors&&n.behaviors.restoreAction&&n.behaviors.restoreAction.fonticon&&(e.icon={iconName:n.behaviors.restoreAction.fonticon,fontIconFamily:1});let i={id:t,dataElements:e};A.push(this._actionsContainer.restoreBtn.title),W.push(i)}if(this._actionsContainer.openBtn){let t="toolbar_open",e={position:"far",tooltip:this._actionsContainer.openBtn.title,disabled:!0,typeRepresentation:"functionIcon",icon:{iconName:"fonticon fonticon-download",fontIconFamily:1},value:function(t){console.log("on_ID_open"),d._actionsContainer.openBtn.onclick()}};n&&n.behaviors&&n.behaviors.openAction&&n.behaviors.openAction.fonticon&&(e.icon={iconName:n.behaviors.openAction.fonticon,fontIconFamily:1});let i={id:t,dataElements:e};A.push(this._actionsContainer.openBtn.title),W.push(i)}this.onContextualEvent=function(){var t=[];if(d._actionsContainer.restoreBtn&&d._actionsContainer.restoreBtn.displayInCtxMenu){let e={type:"PushItem",title:d._actionsContainer.restoreBtn.title,action:{callback:function(){d._actionsContainer.restoreBtn.onclick()}},state:d._actionsContainer.restoreBtn.disabled?"disabled":"enabled"};n&&n.behaviors&&n.behaviors.restoreAction&&n.behaviors.restoreAction.fonticon&&(e.fonticon={content:n.behaviors.restoreAction.fonticon}),t.push(e)}if(d._actionsContainer.openBtn&&d._actionsContainer.openBtn.displayInCtxMenu){let e={type:"PushItem",title:d._actionsContainer.openBtn.title,action:{callback:function(){d._actionsContainer.openBtn.onclick()}},state:d._actionsContainer.openBtn.disabled?"disabled":"enabled"};n&&n.behaviors&&n.behaviors.openAction&&n.behaviors.openAction.fonticon&&(e.fonticon={content:n.behaviors.openAction.fonticon}),t.push(e)}return t};var O=new a({treeDocument:this._treeModel,identifier:this.options.identifier,rowSelection:"multiple",cellSelection:"none",columns:y,showRowBorderFlag:!0,showContextualMenuColumnFlag:D,layoutOptions:{rowsHeader:!1},onContextualEvent:this.onContextualEvent});let L=new e.Element("div");if(L.addClassName("ifmcontent"),L.setStyle("height","100%"),W.length){let t=l.prototype.createTreeDocument({entries:W}),e=new l({items:t});e.getContent().setStyle("position","relative"),e.getContent().setStyle("padding-bottom","5px"),e.getContent().setStyle("border-bottom","1px solid #b4b6ba"),e.inject(L),this._treeListToolbar=e;let n=e.getContent().getElementsByClassName("wux-generated-toolbar-items-tweaker");for(let t=0;t<n.length&&t<A.length;t++)this.withTooltipByPath&&n[t].addClassName("withTooltipByPath"),this.withTooltipByPath&&i(n[t]).attr("title",A[t]);if(this.withTooltipByPath){var M=i(".withTooltipByPath");M&&"function"==typeof M.tooltip&&M.tooltip({})}}let P=new e.Element("div");P.addClassName("dgvcontent"),P.setStyle("position","relative"),W.length?P.setStyle("height","calc(100% - 32px)"):P.setStyle("height","100%"),O.inject(P),P.inject(L),L.inject(this.container),this._treeList=O,i(L).data("_po_exposed",this._po_exposed),this._po_exposed.getRows=function(){var t=[];return d._treeModel.getRoots().forEach(((e,i)=>{var n=e.options.grid,o={row:i,number:n.iternumber,comment:n.description,modification_date:n.date,modifier:n.modified_by};t.push(o)})),t},this._po_exposed.getRowNumber=function(t){var e=d._treeModel.getRoots(),i={number:t};return e.forEach(((e,n)=>{if(e.options.grid.iternumber===t){var o=e.options.grid,s={row:n,number:o.iternumber,comment:o.description,modification_date:o.date,modifier:o.modified_by};i=s}})),i},this._po_exposed.selectRowNumbers=function(t){var e=d._treeModel.getRoots(),i=d._treeList.getNodesXSO(),n=[];return i.empty(),e.forEach(((e,o)=>{t.forEach((t=>{if(e.options.grid.iternumber===t){i.add(e),d._treeList.ensureNodeModelVisible(e);var s=e.options.grid,r={row:o,number:s.iternumber,comment:s.description,modification_date:s.date,modifier:s.modified_by};n.push(r)}}))})),n},this._po_exposed.getSelectedRows=function(){var t=d._treeList.getNodesXSO().get(),e=[];return t.forEach(((t,i)=>{var n=t.options.grid,o={row:i,number:n.iternumber,comment:n.description,modification_date:n.date,modifier:n.modified_by};e.push(o)})),e},this._po_exposed.isRestoreEnabled=function(){return!!d._actionsContainer.restoreBtn&&!d._actionsContainer.restoreBtn.disabled},this._po_exposed.clickOnRestore=function(){return!(!d._actionsContainer.restoreBtn||d._actionsContainer.restoreBtn.disabled)&&(d._actionsContainer.restoreBtn.onclick(),!0)},this._po_exposed.isOpenEnabled=function(){return!!d._actionsContainer.openBtn&&!d._actionsContainer.openBtn.disabled},this._po_exposed.clickOnOpen=function(){return!(!d._actionsContainer.openBtn||d._actionsContainer.openBtn.disabled)&&(d._actionsContainer.openBtn.onclick(),!0)};var B=O.getNodesXSO();B.onPostAdd((function(t){var e=d._treeList.getNodesXSO().get();d.onRowClick.call(d,e)})),B.onPostRemove((function(t){var e=d._treeList.getNodesXSO().get();d.onRowClick.call(d,e)}));var R=[],k=new Map;this._treeModel.getRoots().forEach((t=>{if(t.options.grid.modified_by){var e=t.options.grid.modified_by;k.has(e)||(k.set(e,[]),R.push((new o).using(n).GETRequestPromise("resources/modeler/pno/person/"+encodeURIComponent(e)).then((t=>{if(t.OK)return{key:e,val:t.OK};if(t.error)throw new Error(t.error);throw new Error})).catch((t=>(console.log("failed to get info for "+e+": "+t),{key:e,val:null}))))),k.get(e).push(t)}})),Promise.all(R).then((t=>{this._treeModel.prepareUpdate(),t.forEach((t=>{if(t.key&&t.val&&k.has(t.key)){var e=k.get(t.key),i=t.val.firstname?t.val.firstname:"",n=t.val.lastname?t.val.lastname:"";e.forEach((t=>{i&&n?t.setAttribute("modified_by",i+" "+n):i?t.setAttribute("modified_by",i):n&&t.setAttribute("modified_by",n)}))}})),this._treeModel.pushUpdate()})).catch((t=>{console.log(t)}))},onRowClick:function(t){var e=this,i=[];if(t.forEach((function(t){var e=t.options.grid.iterationObj;i.push(e)})),this.selectedObjects=i,this._actionsContainer.restoreBtn)if(i&&1!=i.length)this._actionsContainer.restoreBtn.disable(),this._treeListToolbar&&this._treeListToolbar.updateNodeModel("toolbar_restore",{disabled:!0});else if(i&&1==i.length){var n=e.list[i[0]].name,o=e.list[i[0]].isLastIter,s=e.NLS.get("LastSavedModelString");-1!==n.indexOf(s)||o?(this._actionsContainer.restoreBtn.disable(),this._treeListToolbar&&this._treeListToolbar.updateNodeModel("toolbar_restore",{disabled:!0})):(this._actionsContainer.restoreBtn.enable(),this._treeListToolbar&&this._treeListToolbar.updateNodeModel("toolbar_restore",{disabled:!1}))}if(this._actionsContainer.buttonRestoreCV5)if(i&&1!=i.length)this._actionsContainer.buttonRestoreCV5.disabled=!0;else if(i&&1==i.length){n=e.list[i[0]].name,o=e.list[i[0]].isLastIter,s=e.NLS.get("LastSavedModelString");-1!==n.indexOf(s)||o?this._actionsContainer.buttonRestoreCV5.disabled=!0:this._actionsContainer.buttonRestoreCV5.disabled=!1}if(this._actionsContainer.openBtn)if(i&&i.length>=2)this._actionsContainer.openBtn.enable(),this._treeListToolbar&&this._treeListToolbar.updateNodeModel("toolbar_open",{disabled:!1});else if(i&&1==i.length){n=e.list[i[0]].name,o=e.list[i[0]].isLastIter,s=e.NLS.get("LastSavedModelString");this._actionsContainer.openBtn.allowOnLastIter||-1===n.indexOf(s)&&!o?(this._actionsContainer.openBtn.enable(),this._treeListToolbar&&this._treeListToolbar.updateNodeModel("toolbar_open",{disabled:!1})):(this._actionsContainer.openBtn.disable(),this._treeListToolbar&&this._treeListToolbar.updateNodeModel("toolbar_restore",{disabled:!0}))}else this._actionsContainer.openBtn.disable(),this._treeListToolbar&&this._treeListToolbar.updateNodeModel("toolbar_open",{disabled:!0})}})})),define("DS/IterationsWidget/IterationsTable",["UWA/Controls/Abstract","UWA/Core","DS/ENOjquery/ENOjquery","DS/IterationsWidget/IterationsGrid","DS/TreeModel/TreeDocument","DS/Tree/TreeListView","DS/TreeModel/TreeNodeModel","i18n!DS/IterationsWidget/assets/nls/IterationsWidget","css!DS/IterationsWidget/IterationsTable"],(function(t,e,i,n,o,s,r,a){"use strict";var l=t.extend({init:function(t,e,i,n,o){this._parent({}),this._oid=i.oid,this.NLS=t,this.lang=e,this._isODT=n,this._parentContainer=i.parentContainer,this._actionsContainer=i.actionsContainer,this._addinmode=i.addinmode,this._iterationsGrid=i.iterationsGrid,this._iterationsPlayer=i.iterationsPlayer,this.newGETRequestPromise=i.newGETRequestPromise,this.list=i.iterations,this._treeList=null,this.selectedObjects=[],this._po_exposed=o||{},this.buildUITree(i.iterations)},buildUITree:function(t){var n=this;this.container=e.createElement("div",{class:"iterationsTreeListViewContainer"}),this._treeModel=new o({id:"iterations-webinwin-list",class:"iterations-webinwin-list"});var l=!1,d=!1;t.forEach((t=>{t.isMIB?l=!0:d=!0}));for(var c=[],h=t.length-1;h>=0;h--){var u=t[h],m=h.toString();u.isMIB&&(m=u.displayed_iteration.toString());var p=u.name;void 0!==u.selectedobject&&1==u.selectedobject&&(p+=a.LastSavedModelString);var g=new Date(parseInt(u.date_ms)).toLocaleString(this.lang);u.date.indexOf("*")>=0&&(g+="(*)");var f=new r({label:h,data:u,grid:{tree:u,number:m,name:p,description:u.description,date:g,modified_by:u.modified_by,iternumber:u.iternumber,isMIB:u.isMIB,iterationObj:h}});f.onSelect(this.onNodeClick.bind(this)),f.onUnselect(this.onNodeClick.bind(this)),this._treeModel.addChild(f),c.push(f)}var v=[];v=v.concat([{dataIndex:"tree",isHidden:!0,width:"auto"},{text:a.iterationNumber,dataIndex:"number",width:"10%",fontWeight:"bolder",isSortable:!0}]),d&&v.push({text:a.iterationName,dataIndex:"name",width:"auto",fontWeight:"bolder"}),l&&v.push({text:a.modifiedBy,dataIndex:"modified_by",width:"auto",fontWeight:"bolder",isSortable:!1}),v=v.concat([{text:a.iterationModificationDate,dataIndex:"date",width:"auto",fontWeight:"bolder",isSortable:!1},{text:a.iterationDescription,dataIndex:"description",width:"auto",fontWeight:"bolder",isSortable:!1},{dataIndex:"iterationObj",isHidden:!0,width:"auto"}]);var b=new s({class:"iterationsTreeListView",id:"iterationsTreeListViewId",enableListSelection:!0,height:"auto",resize:{columns:!0,rows:!0},selection:{nodes:!0,rowHeaders:!0,columnHeaders:!1,toggle:!0,canMultiSelect:!0,unselectAllOnEmptyArea:!0},columns:v,treeDocument:this._treeModel});if(this._treeList=b,this._treeList.inject(this.container),this._treeList.getManager().onPostUpdateViewOnce((function(){var t=this.getScroller();void 0!==typeof t&&null!=t&&t.elements.container.setAttribute("data-rec-id","wux-scroller")})),i(this.container).data("_po_exposed",this._po_exposed),this._po_exposed.getRows=function(){var t=[];return n._treeModel.getRoots().forEach(((e,i)=>{var n=e.options.grid,o={row:i,number:e._rowID,comment:n.description,modification_date:n.date,modifier:n.modified_by};t.push(o)})),t},this._po_exposed.getRowNumber=function(t){var e=n._treeModel.getRoots(),i=null;if(t>=0&&t<e.length){var o=e[t],s=o.options.grid;i={row:t,number:o._rowID,comment:s.description,modification_date:s.date,modifier:s.modified_by}}return i},this._po_exposed.selectRowNumbers=function(t){var e=n._treeModel.getRoots(),i=n._treeList.getManager().getNodesXSO(),o=[];return i.empty(),t.forEach((t=>{if(t>=0&&t<e.length){var n=e[t];i.add(n);var s=n.options.grid,r={row:t,number:n._rowID,comment:s.description,modification_date:s.date,modifier:s.modified_by};o.push(r)}})),o},this._po_exposed.getSelectedRows=function(){var t=n._treeList.getManager().getNodesXSO().get(),e=[];return t.forEach(((t,i)=>{var n=t.options.grid,o={row:i,number:t._rowID,comment:n.description,modification_date:n.date,modifier:n.modified_by};e.push(o)})),e},this._po_exposed.isRestoreEnabled=function(){return!!n._actionsContainer.restoreBtn&&!n._actionsContainer.restoreBtn.disabled},this._po_exposed.clickOnRestore=function(){return!(!n._actionsContainer.restoreBtn||n._actionsContainer.restoreBtn.disabled)&&(n._actionsContainer.restoreBtn.onclick(),!0)},this._addinmode&&"catiav5"===this._addinmode.toLowerCase()){this.container.getElement(".wux-tree-treelistview").setStyle("height","inherit"),this.container.getElement(".wux-datagrid").setStyle("height","inherit"),this.container.getElement(".wux-layouts-gridengine").setStyle("height","inherit");var w=28*(t.length+1);w>=280?this.container.getElement(".wux-layouts-gridengine").setStyle("min-height","280px"):this.container.getElement(".wux-layouts-gridengine").setStyle("min-height",w+"px")}var _=[],y=new Map;this._treeModel.getRoots().forEach((t=>{if(t.options.grid.modified_by){var e=t.options.grid.modified_by;y.has(e)||(y.set(e,[]),_.push(n.newGETRequestPromise("resources/modeler/pno/person/"+encodeURIComponent(e)).then((t=>t.OK?{key:e,val:t.OK}:{key:e,val:null})))),y.get(e).push(t)}})),Promise.all(_).then((t=>{this._treeModel.prepareUpdate(),t.forEach((t=>{if(t.key&&t.val&&y.has(t.key)){var e=y.get(t.key),i=t.val.firstname?t.val.firstname:"",n=t.val.lastname?t.val.lastname:"";e.forEach((t=>{i&&n?t.setAttribute("modified_by",i+" "+n):i?t.setAttribute("modified_by",i):n&&t.setAttribute("modified_by",n)}))}})),this._treeModel.pushUpdate()})).catch((t=>{console.log(t)}))},checkRestoreBtn:function(){var t=this,e=t._treeList.options.treeDocument.getSelectedNodes();Array.isArray(e)&&0==e.length&&t._actionsContainer.buttonRestoreCV5&&(t._actionsContainer.buttonRestoreCV5.disabled=!0)}});return l.prototype.onNodeClick=function(t){var e=this,i=document.getElementById("iterationCompareViewContainer"),o=document.getElementById("iterationPlayerContainer");if(e._treeList&&!e._treeList.clicked){e._treeList.clicked=!1;e._treeList.getManager().getDocument().getChildren();for(var s=e._treeList.getManager().getSelectedRows(),r=[],a=0;a<s.length;a++){var l=e._treeList.getManager().getTreeNodeModelFromRowID(s[a]);if(null!=l){var d=l.options.grid.iterationObj;r.push(d)}}if(this.selectedObjects=r,r&&2==r.length){if(e._actionsContainer.buttonRestoreCV5&&(e._actionsContainer.buttonRestoreCV5.disabled=!0),e._actionsContainer.restoreBtn&&e._actionsContainer.restoreBtn.disable(),!0===e._actionsContainer._disableCompareBtn?e._actionsContainer.compareBtn&&e._actionsContainer.compareBtn.disable():e._actionsContainer.compareBtn&&e._actionsContainer.compareBtn.enable(),e._actionsContainer.openBtn&&e._actionsContainer.openBtn.enable(),i&&o){i.hidden="",o.hidden="hidden";var c=[];for(a=0;a<r.length;a++)c.push(e.list[r[a]]);for(;i.hasChildNodes();)i.removeChild(i.lastChild);var h=new n(c,30,this.NLS);h.show(),h.inject(i)}}else{if(r&&0==r.length?(e._actionsContainer.openBtn&&e._actionsContainer.openBtn.disable(),e._actionsContainer.buttonRestoreCV5&&(e._actionsContainer.buttonRestoreCV5.disabled=!0)):e._actionsContainer.openBtn&&e._actionsContainer.openBtn.enable(),r&&1==r.length){var u=e.list[r[0]].name,m=e.list[r[0]].isLastIter,p=e.NLS.get("LastSavedModelString");-1!==u.indexOf(p)||m?(e._actionsContainer.restoreBtn&&e._actionsContainer.restoreBtn.disable(),e._actionsContainer.openBtn&&e._actionsContainer.openBtn.disable(),e._actionsContainer.buttonRestoreCV5&&(e._actionsContainer.buttonRestoreCV5.disabled=!0)):e._actionsContainer.buttonRestoreCV5?e._actionsContainer.buttonRestoreCV5.disabled=!1:(e._actionsContainer.restoreBtn&&e._actionsContainer.restoreBtn.enable(),e._actionsContainer.openBtn&&e._actionsContainer.openBtn.enable())}else e._actionsContainer.restoreBtn&&e._actionsContainer.restoreBtn.disable(),e._actionsContainer.buttonRestoreCV5&&(e._actionsContainer.buttonRestoreCV5.disabled=!1);e._actionsContainer.compareBtn&&e._actionsContainer.compareBtn.disable(),i&&o&&(e._iterationsGrid&&e._iterationsGrid.hide(),i.hidden="hidden",o.hidden="")}if(r&&1!=r.length&&e._actionsContainer.buttonRestoreCV5&&(e._actionsContainer.buttonRestoreCV5.disabled=!0),e._iterationsPlayer&&1==r.length){var g=e.list[r[0]].id;e._iterationsPlayer.timepointChangeFromList(g)}}},l})),define("DS/IterationsWidget/Toolbar",["UWA/Class","DS/WidgetServices/WidgetServices"],(function(t,e){"use strict";return t.extend({init:function(t,e,i,n,o){this._parent({}),this.buttonWidth=t,this.buttons=[],this.align=n;var s="calc(100% - "+e+"px)";"top"==i&&(s="0px"),void 0===o&&(o=!0),o&&(this.container=new UWA.Element("div",{styles:{position:"absolute",height:e+"px",top:s,width:"100%","z-index":"100"}}),this.container.setAttribute("data-rec-id","toolbarDiv"))},inject:function(t){this.container&&this.container.inject(t)},center:function(){var t=this.buttonWidth*this.buttons.length;this.container&&(this.container.style.left="calc(50% - "+t/2+"px)")},recomputeButtonsPosition:function(){var t=0;this.buttons.forEach((e=>{"none"!=e.style.display&&("right"==this.align?e.style.right=t*this.buttonWidth+"px":e.style.left=t*this.buttonWidth+"px",t++)}))},addButton:function(t,i,n,o,s,r){t&&(t=e.getRealPath("IterationsWidget/"+t,widget,!1)),n&&(n=e.getRealPath("IterationsWidget/"+n,widget,!1)),void 0===s&&(s=!0);var a=this,l=null;(l="right"==this.align?new UWA.Element("div",{styles:{position:"absolute",top:"0px",right:this.buttons.length*this.buttonWidth+"px",height:"100%"},title:i}):new UWA.Element("div",{styles:{position:"absolute",top:"0px",left:this.buttons.length*this.buttonWidth+"px",height:"100%"},title:i})).onclickFun=o,this.buttons.push(l),l.setAttribute("data-rec-id",i+"-div");var d=new UWA.Element("img",{src:t});return d.setAttribute("data-rec-id",t+"img-"+i),d.inject(l),s&&this.container?l.inject(this.container):l.style.display="none",r&&(l.displayInCtxMenu=!0),l.check=function(){d.src=n,d.style.cursor="default"},l.uncheck=function(){d.src=t,d.style.cursor="pointer"},l.hide=function(){l.style.visibility="hidden"},l.show=function(){l.style.visibility="inherit"},l.displayNone=function(){l.style.display="none",a.recomputeButtonsPosition()},l.displayOn=function(){l.style.display="inherit",a.recomputeButtonsPosition()},l.disable=function(){l.style.opacity="0.5",l.style.cursor="default",l.disabled=!0},l.enable=function(){l.style.opacity="1.0",l.style.cursor="pointer",l.disabled=!1},l.onclick=function(){l.disabled||l.onclickFun()},l},appendChild:function(t){this.container&&this.container.appendChild(t)}})})),define("DS/IterationsWidget/Point",["UWA/Class"],(function(t){"use strict";var e=t.extend({init:function(t,e){this.x=t,this.y=e},add:function(t,i){return new e(this.x+t,this.y+i)},toString:function(){return this.x+","+this.y}});return e})),define("DS/IterationsWidget/ext/IWextS_ShapeServices",["UWA/Class","DS/WebInWinHelper/WebInWinHelper","DS/ENOCollabToolsUI/tracker/ENOCollabTrackerBackEnd"],(function(t,e,i){"use strict";var n=function(t){window.webinwinSocket&&window.webinwinSocket.dispatchEvent("onDispatchToWin",{notif_name:"onLogLineToCNEXTOUTPUT",notif_parameters:"lf_web_in_win: "+t},"lf_web_in_win"),console.log(t)};return t.singleton({init:function(){},defaultLoadIterations:function(t){if(this.options._isWebInWinODTMode){if(console.log("cas _isWebInWinODTMode window.parent.iterationlistResult: "+window.parent.iterationlistResult),console.log("cas _isWebInWinODTMode window.iterationlistResult: "+window.iterationlistResult),n=window.parent.iterationlistResult||window.iterationlistResult){var e=JSON.parse(n);return console.log("parse iterationlistResult OK"),Promise.resolve(e.results)}return Promise.reject()}if(this.options._isODT||this.options._isODT2){var n;if(console.log("cas ODT window.parent.iterationlistResult: "+window.parent.iterationlistResult),console.log("cas ODT window.iterationlistResult: "+window.iterationlistResult),n=window.parent.iterationlistResult||window.iterationlistResult){e=JSON.parse(n);return console.log("parse iterationlistResult OK"),Promise.resolve(e.results)}return Promise.reject()}{var o={UXName:"Iterations"};o.isWebInWin=!!window.webinwinSocket,this.options&&this.options.client_app_domain&&(o.client_app_domain=this.options.client_app_domain),this.options&&this.options.client_app_name&&(o.client_app_name=this.options.client_app_name);let e={};i.enrichRequestWithMetricsWebInWin(e,o);let n="objectId="+t;return e&&e.metrics&&e.metrics.UXName&&(n+="&metrics_UXName="+encodeURIComponent(e.metrics.UXName)),e&&e.metrics&&e.metrics.client_app_domain&&(n+="&metrics_client_app_domain="+encodeURIComponent(e.metrics.client_app_domain)),e&&e.metrics&&e.metrics.client_app_name&&(n+="&metrics_client_app_name="+encodeURIComponent(e.metrics.client_app_name)),this.options.GETRequestPromise("resources/iteration/list/iterationlist",n).then((t=>{if(t.OK)return t.OK.results;throw new Error(t.error)}))}},openIterationInWin:function(t){return new Promise(((i,o)=>{n("launchWinOpenIterations: "+t.length),e.launchWinOpenIterations(this.options.socket,t),n("launchWinOpenIterations done"),i()}))},restoreIterationInWin:function(t,i){return new Promise(((i,o)=>{n("launchWinRestoreIterations: "+t.currentObj.physicalid+" "+t.iteration.physicalid),e.launchWinRestoreIterations(this.options.socket,t.currentObj,t.iteration),n("launchWinRestoreIterations done"),i()}))}})})),define("DS/IterationsWidget/TimelineConfig",["UWA/Class"],(function(t){"use strict";return t.extend({init:function(){this.timepointHeight=12,this.timepointTopMargin=20,this.height=50,this.paddingLeft=8,this.paddingRight=8,this.paddingTop=60,this.timespanMinWidth=5,this.sliderWidth=10},getTimespanMinWidth:function(){return this.timespanMinWidth},getSliderWidth:function(){return this.sliderWidth},getTimepointTopMargin:function(){return this.timepointTopMargin},getTimepointHeight:function(){return this.timepointHeight},getWidth:function(){return this.width},getHeight:function(){return this.height},getPaddingLeft:function(){return this.paddingLeft},getPaddingRight:function(){return this.paddingRight},getPaddingTop:function(){return this.paddingTop}})})),define("DS/IterationsWidget/CGRViewer",["UWA/Controls/Abstract","DS/Visualization/WebGLV6Viewer","DS/Visualization/Node3D","DS/Visualization/Viewpoint","DS/Visualization/ModelLoader","DS/Visualization/ThreeJS_DS"],(function(t,e,i,n,o,s){"use strict";return t.extend({init:function(t,e,i){this._parent({}),this.buildUI(),this.onViewpointMove=null},buildUI:function(){this.elements.container=new UWA.Element("div",{styles:{position:"absolute",height:"100%",width:"100%"}}),this.elements.container.setAttribute("data-rec-id","iterationsPlayer-CGRViewerContainer"),this.viewer=new e({div:this.elements.container,antiAliasing:"SMAA",useShadowMap:!1,infinitePlane:!1,displayGrid:!1,highlight:{activated:!1,displayHL:!1}}),this.viewer.setVisuEnv("None"),this.viewer.setLightOnViewpoint(!0);var t={viewer:this.viewer};this.viewpoint=new n(t),this.viewpoint.setDefaultController(!0,"CATIA"),this.viewer.setPicking({activated:!0,computeNormalDepth:!0,displayHL:!0,primitive:!1,trapSelection:!0}),this.viewer.setPrePicking({activated:!0,computeNormalDepth:!0,disableWhileMoving:!0,displayHL:!0,gpu:!0,primitive:!1});var s=this;this.viewpoint.onMove((function(){if(s.viewer.render(),null!=s.onViewpointMove){var t=s.getViewpointJson();s.onViewpointMove(t)}})),this.viewer.addViewpoint(this.viewpoint),this.modelLoader=new o(this.viewer.getWebGLContext(),!1),this.sceneGraph=new i,this.viewer.addNode(this.sceneGraph),this.modelLoader.setSceneGraph(this.sceneGraph),this.modelLoader.setRenderCallback(this.viewer.render),this.modelLoader.setFileType("cgr")},getViewpointJson:function(){var t={target:this.viewpoint.control.target,orientation:this.viewpoint.control.orientation,distanceToTarget:this.viewpoint.control.distanceToTarget};return JSON.stringify(t)},setViewpoint:function(t){if(this.getViewpointJson()!=t){var e=JSON.parse(t),i={};i.target=new s.Vector3(e.target.x,e.target.y,e.target.z),i.orientation=new s.Quaternion(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w),i.distanceToTarget=e.distanceToTarget,this.viewpoint.control.moveTo(i)}},loadModels:function(t){if(null!=t){var e=0,i=this;!function t(n){if(!(e>=n.length)){var o=n[e];i.loadModel(o,(function(){e++,t(n)}))}}(t)}},loadModel:function(t,e){var n=this,o=new i(t);o.setVisibility(!1),this.sceneGraph.addChild(o);var s=t;this.modelLoader.setOnLoadedCallback((function(){n.viewpoint.reframe(),e()}));var r=new XMLHttpRequest;r.onload=function(t){var e=new Uint8Array(t.target.response);n.modelLoader.loadModelFromBuffer(e,o)},r.onerror=function(){console.log("Load failed !")},r.open("GET",s,!0),r.responseType="arraybuffer",r.send(null)},showModel:function(t){if(this.hideAll(),null!=t){var e=this.sceneGraph.getChildByName(t);null!=e&&(e.setVisibility(!0),this.viewer.render())}},hideAll:function(){for(var t=this.sceneGraph.children.length,e=0;e<t;e++){this.sceneGraph.children[e].setVisibility(!1)}this.viewer.render()}})})),define("DS/IterationsWidget/ContextMenu",["UWA/Class"],(function(t){"use strict";return t.extend({init:function(){this._parent({}),this.contextMenu=new UWA.Element("div",{class:"wux-afr-contextual-menu",styles:{position:"absolute",top:"115px",left:"210px",visibility:"hidden"}});var t=new UWA.Element("div",{class:"wux-afr wux-afr-view wux-afr-state-labels"});t.inject(this.contextMenu);var e=new UWA.Element("div",{class:"wux-afr-cmdWorkbench",styles:{display:"inline-block"}});e.inject(t),this.cmdContainer=new UWA.Element("div",{class:"wux-afr-cmdContainer","data-name":"Views","data-visibility":"1","data-representationtype":"AfrActionBarSection"}),this.cmdContainer.inject(e)},inject:function(t){this.contextMenu.inject(t);var e=this,i=!1,n=!1;t.onmousedown=function(t){2==t.button&&(i=!0)},t.onmousemove=function(t){i&&(n=!0)},t.oncontextmenu=function(t){if(n)return i=!1,n=!1,!0;if(0!=t.buttons)return!0;i=!1,n=!1;var o=t.clientX,s=t.clientY;return e.contextMenu.setStyle("top",s+"px"),e.contextMenu.setStyle("left",o+"px"),e.contextMenu.setStyle("visibility","visible"),!1},t.onclick=function(t){e.contextMenu.setStyle("visibility","hidden")}},addMenuItem:function(t,e,i){var n=this,o=new UWA.Element("div",{class:"wux-afr-cmdstarter",events:{click:function(){i(),n.contextMenu.setStyle("visibility","hidden")}}});o.inject(this.cmdContainer),new UWA.Element("div",{styles:{width:"32px",height:"32px","line-height":"32px",display:"inline-block","vertical-align":"top","background-size":"cover","background-image":'url("'+t+'")'}}).inject(o),new UWA.Element("div",{class:"wux-afr-label",styles:{display:"inline-block"},text:e}).inject(o)}})})),define("DS/IterationsWidget/Timer",["UWA/Class"],(function(t){"use strict";return t.extend({init:function(t,e){this.interval=t,this.timeout=e,this.ontick=null,this.ontimeout=null,this.id=null,this.elapsed=0},start:function(){this.elapsed=0,this.stop(),this.resume()},stop:function(){this.pause()},pause:function(){clearInterval(this.id)},resume:function(){var t=this;this.id=setInterval((function(){if(t.elapsed+=t.interval,null!=t.timeout&&t.elapsed>=t.timeout)return t.stop(),void t.postTimeoutEvent();t.postIntervalEvent()}),t.interval)},postIntervalEvent:function(){null!=this.ontick&&this.ontick()},postTimeoutEvent:function(){null!=this.ontimeout&&this.ontimeout()}})})),define("DS/IterationsWidget/TimeAxis",["UWA/Controls/Abstract"],(function(t){"use strict";return t.extend({init:function(t){this.offFillColor="#42a2da",this.offStrokeColor="#368ec4",this.overStrokeColor="#005685",this.onStrokeColor="#003c5a",this.onFillColor="#005685",this.container=document.createElementNS("http://www.w3.org/2000/svg","g"),this.container.setAttribute("class","timeline-timeAxis"),this.container.setAttribute("data-rec-id","timeline-timeAxis"),this.timeline=t,this._parent({}),this.fillLinearGradient=this.addLinearGradient(this.container,"fill_lg",this.offFillColor,"#f2f2f2"),this.strokeLinearGradient=this.addLinearGradient(this.container,"stroke_lg",this.offStrokeColor,"#b4b6ba"),this.rect=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.rect.setAttribute("rx","5"),this.rect.setAttribute("ry","5"),this.rect.setAttribute("data-rec-id","svg-rect-timeAxis"),this.rect.setAttribute("fill","url(#fill_lg)"),this.rect.setAttribute("stroke","url(#stroke_lg)"),this.rect.setAttribute("stroke-width","2"),this.container.appendChild(this.rect),this.setMouseOffSliderStyle()},addLinearGradient:function(t,e,i,n){var o=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");o.setAttribute("id",e),o.setAttribute("x1","0"),o.setAttribute("x2","1"),o.addStop=function(t,e){var i=document.createElementNS("http://www.w3.org/2000/svg","stop");return i.setAttribute("offset",t),i.setAttribute("stop-opacity","1"),i.setAttribute("stop-color",e),o.appendChild(i),i};var s=o.addStop("0%",i),r=o.addStop("20%",i),a=o.addStop("20%",n);o.addStop("100%",n);return o.setColorChangePos=function(t){r.setAttribute("offset",100*t+"%"),a.setAttribute("offset",100*t+"%")},o.updateColor1=function(t){s.setAttribute("stop-color",t),r.setAttribute("stop-color",t)},t.appendChild(o),o},inject:function(t){t.appendChild(this.container)},setMouseOffSliderStyle:function(){this.fillLinearGradient.updateColor1(this.offFillColor),this.strokeLinearGradient.updateColor1(this.offStrokeColor)},setMouseOverSliderStyle:function(){this.fillLinearGradient.updateColor1(this.offStrokeColor),this.strokeLinearGradient.updateColor1(this.overStrokeColor)},setMouseOnSliderStyle:function(){this.fillLinearGradient.updateColor1(this.onFillColor),this.strokeLinearGradient.updateColor1(this.onStrokeColor)},onSliderMoved:function(t){this.fillLinearGradient.setColorChangePos(t),this.strokeLinearGradient.setColorChangePos(t)},onResize:function(t){var e=this.timeline.getWidth()+this.timeline.config.getSliderWidth(),i=this.timeline.config.getTimepointHeight(),n=this.timeline.config.getPaddingTop();this.rect.setAttribute("x",this.timeline.config.getPaddingLeft()),this.rect.setAttribute("y",n),this.rect.setAttribute("width",e),this.rect.setAttribute("height",i)}})})),define("DS/IterationsWidget/RestoreConfirmationDialog",["UWA/Controls/Abstract","DS/LifecycleControls/CommandDialogWUX"],(function(t,e){"use strict";return t.extend({init:function(t,e,i,n,o,s,r){this.parent=t,this.ok=e,this.cancel=i,this.error=n,this._po_exposed=r,this.build(o,s)},inject:function(t){this.injectable.inject(t)},build:function(t,i){var n=this;let o=new UWA.Element("div"),s=new UWA.Element("div");s.innerHTML=t.get("restoreConfirmationDialogLabel"),s.inject(o);let r=new e;this.injectable=r.createDialog(o,{title:i,container:n.parent,OKBtnText:t.get("restoreCommentsDialogTitle"),CancelBtnText:t.get("cancelCommentsButtonTitle"),modalFlag:!0,closeButtonFlag:!0,resizableFlag:!0,onClose:function(t){r.destroy(),n.cancel()},onOk:function(t){r.destroy(),n.ok()}}),this._po_exposed&&(this._po_exposed.ConfirmAndClickOnOK=function(){console.log("ConfirmAndClickOnOK before onclick"),r.buttons.Ok.elements.button.click()})}})})),define("DS/IterationsWidget/RestoreCommentsDialog",["UWA/Controls/Abstract","DS/LifecycleControls/CommandDialogWUX","DS/Controls/LineEditor"],(function(t,e,i){"use strict";return t.extend({init:function(t,e,i,n,o,s,r,a){this.parent=t,this.ok=e,this.cancel=i,this.error=n,this.panelOptions=r,this._po_exposed=a,this.build(o,s)},inject:function(t){this.injectable.inject(t)},build:function(t,n){var o=this;let s=new UWA.Element("div"),r=new UWA.Element("div");r.inject(s);const a=UWA.createElement("span");if(a.textContent=t.get("restoreCommentsDialogCommentsLabel"),r.appendChild(a),this.panelOptions&&this.panelOptions.mandatoryComment){const t=UWA.createElement("i");t.className="icon",t.textContent="*",t.setStyle("color","red"),r.appendChild(t)}let l=new i({displayClearFieldButtonFlag:!0});l.inject(s),l.getContent().setStyle("width","100%");let d=new e;this.injectable=d.createDialog(s,{title:n,container:o.parent,OKBtnText:t.get("restoreCommentsDialogTitle"),CancelBtnText:t.get("cancelCommentsButtonTitle"),modalFlag:!0,closeButtonFlag:!0,resizableFlag:!0,onClose:function(t){d.buttons.Ok.disabled=!0,d.destroy(),o.cancel()},onOk:function(t){d.buttons.Ok.disabled=!0,d.destroy(),o.ok(l.value)}}),l.addEventListener("uncommittedChange",(function(){o.panelOptions&&o.panelOptions.mandatoryComment&&!l.valueToCommit?d.buttons.Ok.disabled=!0:d.buttons.Ok.disabled=!1})),o.panelOptions&&o.panelOptions.mandatoryComment&&!l.value&&(d.buttons.Ok.disabled=!0)}})})),define("DS/IterationsWidget/ext/IWextS_MIBServices",["UWA/Class","DS/WidgetServices/WidgetServices","DS/ENOCollabToolsUI/tracker/ENOCollabTrackerBackEnd"],(function(t,e,i){"use strict";return t.singleton({init:function(){},loadMIBIterations:function(t){if(this.options._isODT||this.options._isODT2){console.log("cas ODT window.parent.iterationlistResult: "+window.parent.iterationlistResult),console.log("cas ODT window.iterationlistResult: "+window.iterationlistResult);var n=window.parent.iterationlistResult||window.iterationlistResult;if(n){var o=JSON.parse(n);return console.log("parse iterationlistResult OK"),Promise.resolve(o.results)}return Promise.reject()}var s={versionid:t};return i.enrichRequestWithMetrics(s,{UXName:"Iterations"}),this.options.POSTRequestPromise("resources/v1/dslc/iterationgraph",null,s).then((t=>{if(t.OK){let e=t.OK;if(Array.isArray(e.iterationgraphs)&&1==e.iterationgraphs.length)return e.iterationgraphs[0].iterations;throw new Error("loadIterations (MIB case) failed: "+e)}throw new Error(t.error)})).then((i=>{let n=[];return i.forEach((i=>{let o={};o.id=t+"/"+i.id,o.fullcontenturl=t+"/"+i.id,o.isMIB=!0,o.iternumber=parseInt(i.id),o.displayed_iteration=o.iternumber,o.owner=i.owner,o.comment=i.comment,o.date=i.creation;let s=e.formatDateObj(i.creation);"Invalid Date"===s.toString()&&console.log("invalid date returned from server: "+i.creation),o.date_ms=s.getTime(),o.specific={versionid:t,iterationid:i.id},n.push(o)})),n})).then((t=>{t.sort((function(t,e){return t.iternumber<e.iternumber?-1:t.iternumber>e.iternumber||t.sandbox?1:e.sandbox?-1:0})),t.forEach(((t,e)=>{t.displayed_iteration=e+1}));var e=t.slice(-1);return 1==e.length&&(e[0].lastIter=!0),t}))},restoreIterationPromise:function(t,e){console.log("restore MIB iteration");var i={versionid:t.versionid,iterationid:t.iterationid,graph:!1};return this.options.POSTRequestPromise("resources/v1/dslc/restoreversioniteration",null,i).then((t=>{if(t.OK){let e=t.OK;if(e&&!e.errorID)return{success_message_key:"restoreSuccessful",success_message_dic:""};throw new Error(e&&e.errorMessage?e.errorMessage:NLS.get("restoreFailed"))}throw new Error}))}})})),define("DS/IterationsWidget/IterationsSWWidget",["UWA/Controls/Abstract","UWA/Core","DS/PlatformAPI/PlatformAPI","DS/LifecycleControls/CommandDialog","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/TreeModel/TreeDocument","DS/Tree/TreeListView","DS/TreeModel/TreeNodeModel","DS/UIKIT/Mask","i18n!DS/IterationsWidget/assets/nls/IterationsWidget"],(function(t,e,i,n,o,s,r,a,l,d,c){"use strict";return t.extend({executeCmd:function(t,e,n){var o=this;o._parent(e),o.familyPhysicalid=null,o.selected=null,o.object=t[0],o.buildUI(),d.mask(o.tableContainer),i.subscribe("webinwin:win:notification",(function(t){var e=JSON.parse(t);"iterations/getFamilyPhysicalid"==e.operation&&null==o.familyPhysicalid&&(o.familyPhysicalid=e.familyPhysicalid,o.selected=e.iterationPhysicalid,o.onGetFamilyPhysicalid(e.familyPhysicalid))}));var s='{"operation":"iterations/getFamilyPhysicalid","confPhysicalid":"'+o.object.physicalid+'"}';i.publish("webinwin:web:notification",s),n()},onGetFamilyPhysicalid:function(t){var i=this;if(""==t){i.close();var r=e.createElement("div",{styles:{height:"100%"}}),a=s.get3DSpaceBaseUrl(widget.getValue("x3dPlatformId"))+"/webapps/IterationsWidget/assets/images/warning.png";r.innerHTML='<img src="'+a+'"></img>'+c.invalidTypeSW;var l=new n,h=l.create(r,{title:c.Title,closeButton:!0,resizable:!0,buttonStyle:l.buttonStyle.ok,onOk:function(){l.destroy()}},this);return h.inject(widget.body),void h.setNewSize({width:400})}s.app_initialization((function(){var e={objectId:t,metrics_UXName:"Iterations",metrics_UXSub:"SOLIDWORKS"};i.options&&i.options.client_app_domain&&(e.metrics_client_app_domain=i.options.client_app_domain),i.options&&i.options.client_app_name&&(e.metrics_client_app_name=i.options.client_app_name),o.get(i.object.tenant,"/resources/iteration/list/iterationlist",e,(function(t){d.unmask(i.tableContainer);var e=t.results;e.sort((function(t,e){return t.date_ms==e.date_ms?0:t.date_ms<e.date_ms?1:-1})),i.currentState=e[0].physicalid,i.buildTable(e)}),(function(t){d.unmask(i.tableContainer),i.tableContainer.innerHTML='<label style="font-family: arial; font-size: 13px;">'+c.LoadFail+"</label>",console.log("loadIterations failed: "+t)}))}))},buildUI:function(){this.tableContainer=e.createElement("div",{styles:{height:"100%"}});var t=new n,o=this,s="";this.object&&(s=" - "+this.object.displayName+" "+this.object.revision),this.dlg=t.create(this.tableContainer,{title:c.Title+s,OKBtnText:c.RestoreIterationSW,closeButton:!0,resizable:!0,buttonStyle:t.buttonStyle.okCancel,enableCmd:function(){return null!=o.selected},onOk:function(){o.close();var t='{"operation":"iterations/replaceContent","iterationPhysicalid":"'+o.selected+'","familyPhysicalid":"'+o.familyPhysicalid+'"}';i.publish("webinwin:web:notification",t)},onClose:function(){o.close()}},this),this.dlg.cmdDlg=t,this.dlg.inject(widget.body);var r=widget.getValue("iterations_dlg_size");null==r&&(r='{ "width":600, "height":300 }'),this.dlg.setNewSize(JSON.parse(r)),setTimeout((function(){o.dlg.setMinSize(280,220)}),10)},onSelect:function(t){this.selected=t,this.dlg.cmdDlg.updateUI()},buildTable:function(t){var e=this,n=new r({}),o=-1;console.log("widget.lang: "+widget.lang);for(var s=0;s<t.length;s++){var d=t[s],h=t.length-s,u=new Date(parseInt(d.date_ms)).toLocaleString(widget.lang),m=d.revision_comment;d.name.includes("*(Current State)")&&(m="");var p=new l({grid:{numberLabel:h.toString(),name:d.name.replace("*(Current State)"," "+c.LastSavedModelStringSW),date:u,iterComment:m}});p.physicalid=d.physicalid,e.selected==d.physicalid&&(o=s),n.addChild(p)}var g=new a({class:"iterationsTreeListView2",enableListSelection:!0,enableDragAndDrop:!1,treeDocument:n,selection:{rowHeaders:!1,columnHeaders:!0,canMultiSelect:!1},resize:{columns:!0,rows:!1},columns:[{dataIndex:"tree",isHidden:!0},{text:c.iterationNumberSW,dataIndex:"numberLabel",width:"10%",fontWeight:"bolder",sortFunction:function(t,e){var i=parseInt(t.options.grid.numberLabel,10),n=parseInt(e.options.grid.numberLabel,10);return i===n?0:i>n?1:-1}},{text:c.iterationNameSW,dataIndex:"name",width:"auto",fontWeight:"bolder"},{text:c.iterationCmtSW,dataIndex:"iterComment",width:"auto",fontWeight:"bolder"},{text:c.iterationModificationDate,dataIndex:"date",width:"auto",fontWeight:"bolder"}]});g.getManager().onReady((function(){i.publish("odt:iterations:sw",{event:"iterations_table_ready"})})),g.getManager().getNodesXSO().onChange((function(){var t=g.getManager(),i=t.getSelectedRows();if(i.length>0){var n=t.getTreeNodeModelFromRowID(i[0]);e.onSelect(n.physicalid)}else e.onSelect(null)})),g.inject(this.tableContainer),-1!=o&&(g.getNthRoot(o).select(),g.elements.container.getElementsByClassName("wux-datagrid")[0].focus()),this.tableContainer.getElement(".wux-tree-treelistview").setStyle("height","100%"),this.tableContainer.getElement(".wux-datagrid").setStyle("height","100%"),this.tableContainer.getElement(".wux-layouts-gridengine").setStyle("height","100%"),this.tableContainer.getElement(".wux-layouts-gridengine").setStyle("min-height","80px")},close:function(){var t=this.dlg.getModalBodySize();t.height=this.dlg.getContainerHeight();var e="iterations_dlg_size";widget.getValue(e)||widget.addPreference({name:e,type:"hidden",defaultValue:"{}"}),widget.setValue(e,JSON.stringify(t)),this.dlg.cmdDlg.destroy()}})})),define("DS/IterationsWidget/Checkbox",["UWA/Controls/Abstract"],(function(t){"use strict";return t.extend({init:function(t){this.label=t,this._parent({}),this.buildUI(),this.oncheck=null,this.onuncheck=null,this.checked=!1},buildUI:function(){this.elements.container=new UWA.Element("label",{text:" "+this.label,styles:{"font-family":"arial","font-size":"13px"}})}})})),define("DS/IterationsWidget/ext/IWextS_Default",["UWA/Controls/Abstract"],(function(t){"use strict";return t.extend({behaviors:{},dgv_columns:{},name:"IWextS_Default",newDataFormat:!0,init:function(t,e,i){this._parent(t),this.otp=e,this.oid=i},isMIB:()=>!1,isSupportedType:()=>!1,toString:function(){return this.name}})})),define("DS/IterationsWidget/CGRViewerWidget",["UWA/Controls/Abstract","DS/LifecycleServices/LifecycleServicesSettings","DS/WebappsUtils/WebappsUtils"],(function(t,e,i){"use strict";return t.extend({init:function(t,e,i){this._parent({}),this.tenant=t,this.lang=e,this._isODT=i,this.bufferedModels=null,this.bufferedActiveModel=null,this.id=this.register(),this.cgrViewerLoaded=!1,this.bufferedOnViewpointMove=null,this.onViewpointMove=null,window["onCGRViewerFrameLoaded"+this.id]=this.onCGRViewerFrameLoaded,window["onCGRViewerViewpointMove"+this.id]=this.onCGRViewerViewpointMove,this.buildUI()},loadModels:function(t){this.bufferedModels=t,this.loadBufferedModels()},showModel:function(t){this.bufferedActiveModel=t,this.showBufferedModel()},setViewpoint:function(t){1==this.cgrViewerLoaded&&null!=this.iframe.contentWindow&&this.iframe.contentWindow.setViewpoint(t)},register:function(){window.cgrViewers=window.cgrViewers||[];var t=window.cgrViewers.length;return window.cgrViewers[t]=this,t},buildUI:function(){this.iframe=UWA.createElement("iframe");var t=i.getProxifiedWebappsBaseUrl(),e=i.getWebappsBaseUrl(),n="";t&&!this._isODT2?(console.log("CGRViewerWidget using getProxifiedWebappsBaseUrl"),console.log("CGRViewerWidget getProxifiedWebappsBaseUrl: "+t.substring(0,100)),n=t+"IterationsWidget/CGRViewer.html?id="+this.id+"&lang="+this.lang):e&&!this._isODT2?(console.log("CGRViewerWidget using getWebappsBaseUrl"),console.log("CGRViewerWidget getWebappsBaseUrl: "+e.substring(0,100)),n=e+"IterationsWidget/CGRViewer.html?id="+this.id+"&lang="+this.lang):(console.log("CGRViewerWidget using else case"),n="CGRViewer.html?id="+this.id+"&lang="+this.lang),this.iframe.src=n,this.iframe.className="CGRViewerWidget",this.iframe.width="100%",this.iframe.height="100%",this.iframe.style.border="0px",this.elements.container=this.iframe,this.iframe.setAttribute("data-rec-id","CGRViewerWidget"),this.iframe.setAttribute("data-rec-frame-id","CGRViewerWidget")},onCGRViewerFrameLoaded:function(t){var e=window.cgrViewers[t];e.cgrViewerLoaded=!0,e.loadBufferedModels(),e.showBufferedModel(),e.addBufferedViewpointMoveEventListener()},onCGRViewerViewpointMove:function(t,e){var i=window.cgrViewers[t];null!=i.onViewpointMove&&i.onViewpointMove(e)},loadBufferedModels:function(){1==this.cgrViewerLoaded&&null!=this.iframe.contentWindow&&this.iframe.contentWindow.loadModels(this.bufferedModels)},showBufferedModel:function(){1==this.cgrViewerLoaded&&null!=this.iframe.contentWindow&&this.iframe.contentWindow.showModel(this.bufferedActiveModel)},addViewpointMoveEventListener:function(t){this.bufferedOnViewpointMove=t,addBufferedViewpointMoveEventListener()},addBufferedViewpointMoveEventListener:function(){1==this.cgrViewerLoaded&&null!=this.iframe.contentWindow&&(this.iframe.contentWindow.onViewpointMove=this.bufferedOnViewpointMove)}})})),define("DS/IterationsWidget/ext/IWextS_DocumentServices",["UWA/Class"],(function(t){"use strict";return t.singleton({init:function(){},loadDocumentIterations:function(t){console.log("loadDocumentIterations on: "+t),console.log("load Document Iteration");let e=null,i=t;return 65==t.length&&(e=t.substring(0,32),i=t.substring(33)),console.log("documentid: "+e),console.log("selectedfileid: "+i),Promise.resolve().then((()=>this.options.GETRequestPromise("resources/v1/modeler/documents/getMasterObjectInfo/"+i,""))).then((t=>{if(!t||!t.OK||"Success"!=t.OK.status)throw t?new Error(t.error||t.OK.status):new Error;e=t.OK.documentId,console.log("corrected documentid: "+e)})).then((()=>this.options.GETRequestPromise("resources/v1/modeler/documents/"+e+"/files/"+i+"/versions","$include=files&$fields=all&includeLastestVersion=true"))).then((t=>{var n=[];if(!t.OK)throw new Error(t.error);var o=t.OK;return o.success&&o.data&&o.data.length>=1&&o.csrf&&o.data.forEach((t=>{var s={id:t.id,lastIter:t.id===i||void 0,name:t.dataelements.title,comment:t.dataelements.comments,date:t.dataelements.originated,owner:t.relateddata&&t.relateddata.ownerInfo&&t.relateddata.ownerInfo.length>=1&&t.relateddata.ownerInfo[0].dataelements&&t.relateddata.ownerInfo[0].dataelements.name?t.relateddata.ownerInfo[0].dataelements.name:void 0,iternumber:parseInt(t.dataelements.revision)};let r=new Date(s.date);"Invalid Date"===r.toString()&&console.log("invalid date returned from server: "+s.date),t.dataelements.image&&(s.icon_fullpath=t.dataelements.image),s.date_ms=r.getTime(),s.specific={data:t,documentid:e,fileid:t.id,selectedfileid:i,id:t.id,csrf:o.csrf},n.push(s)})),n}))},openIterationPromise:function(t){var e=this;console.log("open Document Iterations "+t.length);var i=[];return t.forEach((t=>{var n=t.documentid,o=t.fileid,s=t.id,r=t.csrf;console.log("open docid:"+n+", fileid:"+o+", versionid:"+s),i.push(e.options.PUTRequestPromise("resources/v1/modeler/documents/"+n+"/files/"+o+"/versions/"+s+"/DownloadTicket",null,{csrf:r}).then((t=>{if(t&&t.OK&&!t.OK.errorID&&t.OK.data&&1==t.OK.data.length)return[t.OK.data[0].dataelements.fileName,t.OK.data[0].dataelements.ticketURL];throw t.error.error?new Error(t.error.error):t.error?new Error(t.error):new Error})).then((([t,e])=>{require(["DS/DocumentManagement/IndependentServiceBase"],(function(t){(new t).downloadWithPost(e,{})}),(function(t){console.log("no IndependentServiceBase")}))})))})),Promise.all(i)},restoreIterationPromise:function(t,e){console.log("restore Document iteration");var i=this,n=t.documentid,o=t.fileid,s={csrf:t.csrf};return null!=e&&null!=e&&(s.data=[{dataelements:{comments:e}}]),console.log("launch Document Restore Iteration / docid:"+n+", fileid:"+o),new Promise(((t,e)=>{var n={};i.options&&i.options.change_autc&&(n.change={id:i.options.change_autc}),i.options&&i.options.conf_autc&&(n.evolution={id:i.options.conf_autc}),t(n)})).then((t=>{var e={};return t&&t.change&&t.change.id&&(e["DS-Change-Authoring-Context"]="pid:"+t.change.id),t&&t.evolution&&t.evolution.id&&(e["DS-Configuration-Authoring-Context"]="pid:"+t.evolution.id),i.options.PUTRequestPromise("resources/v1/modeler/documents/"+n+"/files/"+o+"/makeLatestVersion",null,s,e)})).then((t=>{if(!t||!t.OK||t.OK.errorID)throw t.error&&t.error.error?new Error(t.error.error):t.error?new Error(t.error):new Error(t);console.log("Document Restore Iteration done");var e=t.OK.data&&1==t.OK.data.length?t.OK.data[0].id:void 0;if(e){var i={created:[],deleted:[],modified:[]};return i.created.push({operation:"RestoreIteration",physicalid:e,sourceObjectId:o}),i.modified.push({physicalid:n,operation:"RestoreIteration"}),{newid:n+"-"+e,event:i,success_message_key:"restoreSuccessful",success_message_dic:""}}}))}})})),define("DS/IterationsWidget/TimelineData",["UWA/Class"],(function(t){"use strict";return t.extend({init:function(){this.data=[]},add:function(t,e,i,n){var o={id:t,time:e,label:i,img:n};this.data.push(o)},getCount:function(){return this.data.length},get:function(t){return this.data[t]},getMaxTimespan:function(){var t=this.data.length;return 0==t||1==t?0:this.data[t-1].time-this.data[0].time},getMinTimespan:function(){for(var t=this.data.length,e=0,i=0;i<t-1;i++){var n=this.data[i+1].time-this.data[i].time;(0==i||n<e)&&(e=n)}return e}})})),define("DS/IterationsWidget/CGRViewerContextMenu",["UWA/Class","DS/IterationsWidget/ContextMenu"],(function(t,e){"use strict";return t.extend({init:function(t){this._parent({}),this.cgrViewer=t,this.root3DSpaceUrl=this.get3DSpaceUrl(),this.menu=new e;var i=this;this.getNls((function(t){i.addMenuItems(t)}))},getUrlParamVal:function(t){for(var e=window.location.search.substring(1).split("&"),i=0;i<e.length;i++){var n=e[i].split("=");if(n[0]==t)return decodeURIComponent(n[1])}return""},getNls:function(t){var e=this.getUrlParamVal("lang");e=e||"en";var i={};require(["text!DS/IterationsWidget/assets/nls/IterationsWidget_"+e+".json"],(function(e){i.json=JSON.parse(e),i.get=function(t){return i.json[t]},t(i)}))},addMenuItems:function(t){this.addMenuItem("/webapps/ViewerCommands/assets/icons/32/$/I_NoVisuEnv.png",t.get("Basic"),"None"),this.addMenuItem("/webapps/ViewerCommands/assets/icons/32/$/I_WhiteMirrorVisuEnv.png",t.get("WhiteReview"),"V6"),this.addMenuItem("/webapps/ViewerCommands/assets/icons/32/$/I_CleanSpaceVisuEnv.png",t.get("PureWhite"),"CleanSpace"),this.addMenuItem("/webapps/ViewerCommands/assets/icons/32/$/I_DarkBlueVisuEnv.png",t.get("BlueDesign"),"DarkBlue"),this.addMenuItem("/webapps/ViewerCommands/assets/icons/32/$/I_DarkGreyVisuEnv.png",t.get("DarkReview"),"DarkGrey"),this.addMenuItem("/webapps/ViewerCommands/assets/icons/32/$/I_ShinyVisuEnv.png",t.get("DarkMirror"),"Shiny")},addMenuItem:function(t,e,i){var n=this;this.menu.addMenuItem(this.root3DSpaceUrl+t,e,(function(){n.cgrViewer.setVisuEnv(i)}))},get3DSpaceUrl:function(){var t=window.location.href,e=t.indexOf("webapps");return t.substring(0,e)},inject:function(t){this.menu.inject(t)}})})),define("DS/IterationsWidget/ext/IWextS_Shape",["DS/IterationsWidget/ext/IWextS_Default","DS/IterationsWidget/ext/IWextS_ShapeServices"],(function(t,e){"use strict";return t.extend({name:"IWextS_Shape",newDataFormat:!1,init:function(t,i,n){this._parent(t,i,n),this.loadIterationsService=e.defaultLoadIterations.bind(this),this.openService=e.openIterationInWin.bind(this),this.restoreService=e.restoreIterationInWin.bind(this)},isSupportedType:()=>!0})})),define("DS/IterationsWidget/ext/IWextS_Document",["DS/IterationsWidget/ext/IWextS_Default","DS/IterationsWidget/ext/IWextS_DocumentServices"],(function(t,e){"use strict";return t.extend({behaviors:{newDialogFrame:!0,newDGV:!0,disableIterationToolbar:!0,iterationTable_withCtxMenu:!0,openAction:{nlsKey:"DownloadIteration",fonticon:"fonticon fonticon-download",addInToolbar:!1,addInCtxMenu:!0,allowOnLastIter:!0},restoreAction:{nlsKey:"RestoreIteration2",fonticon:"fonticon fonticon-rotate-ccw",addInToolbar:!1,addInCtxMenu:!0,withCommentsInput:!0,withCSFilter:!1},sorting_key:"date"},dgv_columns:{column_iternumber:{sortable:!0},column_name:{nlsKey:"iterationName_Document",visible:!0,sortable:!0},column_onwer:{nlsKey:"owner",visible:!0,sortable:!0},column_date:{nlsKey:"iterationCreationDate",sortable:!0},column_comment:{sortable:!0}},name:"IWextS_Document",init:function(t,i,n){this._parent(t,i,n),this.loadIterationsService=e.loadDocumentIterations.bind(this),this.openService=e.openIterationPromise.bind(this),this.restoreService=e.restoreIterationPromise.bind(this)},isSupportedType:()=>!0})})),define("DS/IterationsWidget/Tooltip",["UWA/Controls/Abstract","DS/IterationsWidget/Point"],(function(t,e){"use strict";var i=t.singleton({init:function(){this.fontSize=12,this.frameThickness=3,i.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),i.container.setAttribute("style","position:absolute;z-index:1000"),i.text=document.createElementNS("http://www.w3.org/2000/svg","text"),i.text.setAttribute("style","-webkit-user-select:none"),i.text.setAttribute("font-family","Arial, sans-serif"),i.text.setAttribute("font-size",this.fontSize),i.text.setAttribute("y",0),i.text.setAttribute("text-anchor","middle"),i.rect=document.createElementNS("http://www.w3.org/2000/svg","rect"),i.container.appendChild(i.rect),i.container.appendChild(i.text),i.rect.setAttribute("style","fill:#fff;stroke-width:1;stroke:#000"),this._parent({})},show:function(t,e,n,o){i.text.textContent="",this.addTextContent(n),document.body.appendChild(i.container);var s=i.text.getBoundingClientRect();this.w=s.width+2*this.frameThickness,this.h=s.height+2*this.frameThickness,i.container.style.width=this.w+1,i.container.style.height=this.h+1,i.container.setAttribute("height",this.h+1),i.container.style.top=e+"px",i.container.style.left=t-s.width/2+"px",i.rect.setAttribute("width",this.w),i.rect.setAttribute("height",this.h),i.rect.setAttribute("transform","translate(1, 0)"),i.text.setAttribute("transform","translate("+this.w/2+", 0)"),i.container.offsetLeft<0?i.container.style.left="0px":i.container.offsetLeft+this.w>window.innerWidth&&(i.container.style.left=window.innerWidth-this.w+"px"),i.container.offsetTop<0?i.container.style.top="0px":i.container.offsetTop+this.h>window.innerHeight&&(i.container.style.top=window.innerHeight-this.h+"px")},addTextContent:function(t){var e=t.split("<br>"),i=e.length;this.lines=i;for(var n=0;n<i;n++){var o=document.createElementNS("http://www.w3.org/2000/svg","tspan");o.setAttribute("x","0"),o.setAttribute("dy","1.2em"),o.textContent=e[n],this.text.appendChild(o)}},hide:function(){null!=i.container.parentNode&&i.container.parentNode.removeChild(i.container)}});return UWA.namespace("DS/IterationsWidget/Tooltip",i)})),define("DS/IterationsWidget/IterationsServices",["UWA/Controls/Abstract","DS/WAFData/WAFData","DS/IterationsWidget/ext/IWextS_Default"],(function(t,e,i){"use strict";return t.extend({init:function(){},_usingOptions:function(t){this.tenant=t.tenant,this.SecurityContext=t.SecurityContext,this.platform3DSpaceURL=t.platform3DSpaceURL},_usingExtImpl:function(t,e,i){this.extImpl=t,this.newDataFormat=t.newDataFormat,this.listTable=e,this.oid=i,t.options.GETRequestPromise=this.GETRequestPromise.bind(this),t.options.PUTRequestPromise=this.PUTRequestPromise.bind(this),t.options.POSTRequestPromise=this.POSTRequestPromise.bind(this)},using:function(t,e,n){return t&&t instanceof i?(this._usingOptions(t.options),this._usingExtImpl(t,e,n)):this._usingOptions(t),this},_GETRequestPromise:function(t,i,n,o,s){var r=t+o+"?tenant="+i;s&&(r=r+"&"+s);var a={Accept:"application/json","Content-Type":"application/json"};return a.SecurityContext=n,new Promise((t=>{e.authenticatedRequest(r,{method:"GET",headers:a,timeout:864e5,type:"json",onComplete:function(e){t({OK:e})},onFailure:function(e,i,n){i&&console.log(i),t({error:i||e,waf_error:e})},onTimeout:function(){console.log("webservice failed: A connection timeout occured."),t({error:"timeout"})}})}))},_PUTRequestPromise:function(t,i,n,o,s,r,a){var l=t+o+"?tenant="+i;s&&(l=l+"&"+s);var d=a||{};return d.Accept="application/json",d["Content-Type"]="application/json",d.SecurityContext=n,new Promise((t=>{e.authenticatedRequest(l,{method:"PUT",headers:d,timeout:864e5,type:"json",data:JSON.stringify(r),onComplete:function(e){t({OK:e})},onFailure:function(e,i,n){i&&console.log(i),t({error:i||e,waf_error:e})},onTimeout:function(){console.log("webservice failed: A connection timeout occured."),t({error:"timeout"})}})}))},_POSTRequestPromise:function(t,i,n,o,s,r){var a=t+o+"?tenant="+i;s&&(a=a+"&"+s);var l={Accept:"application/json","Content-Type":"application/json"};return l.SecurityContext=n,new Promise((t=>{e.authenticatedRequest(a,{method:"POST",headers:l,timeout:864e5,type:"json",data:JSON.stringify(r),onComplete:function(e){t({OK:e})},onFailure:function(e,i,n){i&&console.log(i),t({error:i||e,waf_error:e})},onTimeout:function(){console.log("webservice failed: A connection timeout occured."),t({error:"timeout"})}})}))},GETRequestPromise:function(t,e){var i=this.tenant,n=this.SecurityContext,o=this.platform3DSpaceURL;return this._GETRequestPromise(o,i,n,t,e)},PUTRequestPromise:function(t,e,i,n){var o=this.tenant,s=this.SecurityContext,r=this.platform3DSpaceURL;return this._PUTRequestPromise(r,o,s,t,e,i,n)},POSTRequestPromise:function(t,e,i){var n=this.tenant,o=this.SecurityContext,s=this.platform3DSpaceURL;return this._POSTRequestPromise(s,n,o,t,e,i)},_openIterations:function(t,e,i,n){console.log("open iterations");var o=n.selectedObjects,s=t.get("LastSavedModelString"),r=[];if(console.log("sel.length: "+o.length),0==o.length)return;for(var a=0;a<o.length;a++){var l=n.list[o[a]];-1===l.name.indexOf(s)?(r.push(l),console.log("sel "+a+" => "+l.name),console.log("sel "+a+" => "+l.physicalid)):(console.log("sel "+a+" (skipped) => "+l.name),console.log("sel "+a+" (skipped) => "+l.physicalid))}let d=[];return r.forEach((t=>d.push(t.specific))),i||(d=r),e(d).then((t=>(console.log("Open Iteration done"),t)))},_restoreIterations:function(t,e,i,n,o){console.log("restore iterations");var s=i.selectedObjects;if(1!=s.length)return;var r=i.list[s[0]];let a=r.specific;return e||(a={currentObj:{physicalid:n},iteration:r}),t(a,o).then((t=>(console.log("Restore Iteration launched"),t)))},loadIterations:function(t){return(0,this.extImpl.loadIterationsService)(t)},restoreIterations:function(t){return this._restoreIterations(this.extImpl.restoreService,this.newDataFormat,this.listTable,this.oid,t)},openIterations:function(t){return this._openIterations(t,this.extImpl.openService,this.newDataFormat,this.listTable)}})})),define("DS/IterationsWidget/ext/IWextS_Factory",["UWA/Class","DS/IterationsWidget/IterationsServices"],(function(t,e){"use strict";return t.singleton({init:function(){},_getIsKindOfPromise:function(t,i,n){if(!n){var o=[];return i.forEach((()=>o.push(!1))),o}if(i.includes(n)){o=[];return i.forEach((t=>o.push(t===n))),o}var s={types:[n]};return(new e).using(t).POSTRequestPromise("resources/enong/dico/gettypeshierarchy",null,s).then((t=>{if(t.OK){let o=t.OK.types_hierarchies[0].hierarchy;var e=[];return i.forEach((t=>e.push(t===n||o.includes(t)))),e}throw new Error(t.error)}))},load:function(t,e,i,n){return Promise.resolve().then((()=>this._getIsKindOfPromise(t,["CATPart","3DShape","SystemModel","Document","CONTROLLED DOCUMENTS","Requirement Specification","DOCUMENTS"],e))).then((([o,s,r,a,l,d,c])=>{var h="";return h=e?o||s||n&&"3DPart"===n?"Shape":r?"SystemModel":i&&i.startsWith("cid:")?"MIB":a||l||d?"Document":e:"Shape",!c||a||l||d||console.log("current type is a DOCUMENTS, but not a Document, nor a CONTROLLED DOCUMENT, nor a Requirement Specification"),new Promise((function(n,o){var s="DS/IterationsWidget/ext/IWextS_";s+=h||"Default",require([s],(function(o){var s=new o(t,e,i);console.log("extension: "+s.toString()),s.facext=h,n(s)}),(function(t){console.log("no ext found"),o(t)}))}))}))}})})),define("DS/IterationsWidget/TimelineSlider",["UWA/Controls/Abstract","DS/IterationsWidget/Point"],(function(t,e){"use strict";return t.extend({init:function(t){this.mouseOffStrokeColor="#368ec4",this.mouseOverStrokeColor="#77797c",this.mouseOnStrokeColor="#003c5a",this.mouseOffFillColor="#f1f1f1",this.mouseOverFillColor="#f1f1f1",this.mouseOnFillColor="#005685",this.container=document.createElementNS("http://www.w3.org/2000/svg","g"),this.container.setAttribute("class","timeline-slider"),this.container.setAttribute("data-rec-id","timeline-slider"),this.mousedown=!1,this.x=0,this.thickness=6,this.timeline=t,this._parent({}),this.rect=document.createElementNS("http://www.w3.org/2000/svg","circle"),this.rect.setAttribute("data-rec-id","timeline-slider-polygon"),this.rect.setAttribute("style","fill:"+this.mouseOffFillColor+";stroke:"+this.mouseOffStrokeColor+";stroke-width:2"),this.container.appendChild(this.rect),this.rect.onmousedown=this.onmousedown.bind(this),this.rect.onmouseenter=this.onmouseenter.bind(this),this.rect.onmouseleave=this.onmouseleave.bind(this),document.addEventListener("mousemove",this.onmousemove.bind(this)),document.addEventListener("mouseup",this.onmouseup.bind(this)),this.onmove=null,this.onbegindrag=null,this.onenddrag=null,this.onmousehover=null,this.onmouseout=null,this.w=this.timeline.config.getSliderWidth(),this.onmouseup()},inject:function(t){t.appendChild(this.container)},setPosition:function(t){t>1?t=1:t<0&&(t=0);var i=this.timeline.getWidth();this.x=i*t;var n=this.timeline.config.getSliderWidth(),o=this.timeline.timelineToCanvas(this.x),s=this.timeline.config.getPaddingTop()-this.thickness,r=this.timeline.config.getTimepointHeight()+2*this.thickness;new e(o-n/2,s).add(n,0).add(0,r).add(-n,0);this.rect.setAttribute("cx",o),this.rect.setAttribute("cy",s+r/2),this.rect.setAttribute("r",r/2),null!=this.onmove&&this.onmove(t)},onmousedown:function(t){var e=null==t.offsetX?t.layerX:t.offsetX;this.clickXOffset=this.timeline.canvasToTimeline(e)-this.x,this.mousedown=!0,t.cancelBubble=!0,t.stopPropagation(),t.preventDefault(),null!=this.onbegindrag&&this.onbegindrag(),this.rect.setAttribute("style","fill:"+this.mouseOnFillColor+";stroke:"+this.mouseOnStrokeColor+";stroke-width:2")},onmouseenter:function(t){this.mousedown||(this.onmousehover&&this.onmousehover(),this.rect.setAttribute("style","fill:"+this.mouseOverFillColor+";stroke:"+this.mouseOverStrokeColor+";stroke-width:2"))},onmouseleave:function(t){this.mousedown||(this.onmouseout&&this.onmouseout(),this.rect.setAttribute("style","fill:"+this.mouseOffFillColor+";stroke:"+this.mouseOffStrokeColor+";stroke-width:2"))},onmousemove:function(t){if(this.mousedown){t.preventDefault();var e=this.timeline.clientToTimeline(t.clientX)-this.clickXOffset;this.setPosition(e/this.timeline.getWidth())}},onmouseup:function(t){this.mousedown&&(this.rect.setAttribute("style","fill:"+this.mouseOverFillColor+";stroke:"+this.mouseOverStrokeColor+";stroke-width:2"),this.mousedown=!1,null!=this.onenddrag&&this.onenddrag())}})})),define("DS/IterationsWidget/ext/IWextS_MIB",["DS/IterationsWidget/ext/IWextS_Default","DS/IterationsWidget/ext/IWextS_MIBServices"],(function(t,e){"use strict";return t.extend({behaviors:{newDialogFrame:!0,newDGV:!0,disableIterationToolbar:!0,restoreAction:{fonticon:"fonticon fonticon-rotate-ccw",withCSFilter:!0,withConfirmationPanel:!0}},name:"IWextS_MIB",init:function(t,i,n){this._parent(t,i,n),n&&n.startsWith("cid:")&&(this.caseMIB=!0),this.loadIterationsService=e.loadMIBIterations.bind(this),this.restoreService=e.restoreIterationPromise.bind(this)},isMIB(){return this.caseMIB}})})),define("DS/IterationsWidget/ext/IWextS_SystemModel",["DS/IterationsWidget/ext/IWextS_MIB"],(function(t){"use strict";return t.extend({name:"IWextS_SystemModel",init:function(t,e,i){this._parent(t,e,i)},isSupportedType:()=>!0})})),define("DS/IterationsWidget/Label",["UWA/Controls/Abstract","DS/IterationsWidget/Point"],(function(t,e){"use strict";return t.extend({init:function(t,e){this.arrowWidth=5,this.arrowHeight=3,this.textHeight=18,this.container=document.createElementNS("http://www.w3.org/2000/svg","g"),this.text=document.createElementNS("http://www.w3.org/2000/svg","text"),this.addTextContent(t),this.text.setAttribute("style","-webkit-user-select:none"),this.text.setAttribute("font-family","Arial, sans-serif");this.text.setAttribute("font-size",12),this.text.setAttribute("text-anchor","middle"),this.frameThickness=3,this.frame=document.createElementNS("http://www.w3.org/2000/svg","polygon"),this.frame.setAttribute("style","fill:#eee;stroke-width:1;stroke:#000"),this.container.appendChild(this.frame),this.container.appendChild(this.text),this.hide(),this.text.setAttribute("data-rec-id",t),this.frame.setAttribute("data-rec-id",t+"polygon")},addTextContent:function(t){var e=t.split("<br>"),i=e.length;this.lines=i;for(var n=0;n<i;n++){var o=document.createElementNS("http://www.w3.org/2000/svg","tspan");o.setAttribute("x","0"),o.setAttribute("dy","1.2em"),o.textContent=e[n],this.text.appendChild(o),o.setAttribute("data-rec-id",e[n])}},inject:function(t){t.appendChild(this.container)},show:function(){this.container.style.visibility="visible"},hide:function(){this.container.style.visibility="hidden"},getWidth:function(){return this.text.getBoundingClientRect().width+2*this.frameThickness},getHeight:function(){return this.text.getBoundingClientRect().height+2*this.frameThickness},updateFrame:function(t){var i=this.getWidth(),n=this.getHeight(),o=new e(-i/2,0),s=o.add(i,0),r=s.add(0,n),a=r.add(-3,0),l=r.add(-i,0),d=l.add(3,0),c=new e(-t,n+this.arrowHeight),h=c.add(-this.arrowWidth/2,-this.arrowHeight),u=h.add(this.arrowWidth,0);h.x<d.x?u=(h=d).add(1.5*this.arrowWidth,0):h.x+this.arrowWidth>a.x&&(h=a.add(1.5*-this.arrowWidth,0),u=a);var m=[o,s,r,a,u,c,h,d,l];this.frame.setAttribute("points",this.pointsToString(m))},update:function(t,e){var i=e+15;this.container.setAttribute("transform","translate("+t+","+i+")"),this.text.setAttribute("x","0"),this.updateFrame(t)},pointsToString:function(t){for(var e="",i=0;i<t.length;i++)0!=i&&(e+=" "),e+=t[i].toString();return e}})})),define("DS/IterationsWidget/CGRGridView",["UWA/Controls/Abstract","DS/IterationsWidget/CGRViewerWidget","DS/IterationsWidget/Checkbox"],(function(t,e,i){"use strict";return t.extend({init:function(t,e){this._parent({}),this.elements.container=new UWA.Element("div",{styles:{position:"absolute",height:"100%",width:"100%","overflow-y":"auto"},class:"CGRGridView"}),this._isODT=e,this.elements.container.setAttribute("data-rec-id","cgrgridviewdiv"),this.cgrViewers=[],this.viewerDivs=[],this.onselectchange=null;for(var i=t.length,n=0;n<i;n++)this.addViewer(t[n])},onViewpointMove:function(t){for(var e=this.cgrViewers.length,i=0;i<e;i++){this.cgrViewers[i].setViewpoint(t)}},showSelected:function(){for(var t=this.viewerDivs.length,e=0;e<t;e++){var i=this.viewerDivs[e];i.selected?i.show():i.hide()}},showAll:function(){for(var t=this.viewerDivs.length,e=0;e<t;e++){this.viewerDivs[e].show()}},addViewer:function(t){var n=new UWA.Element("div",{styles:{display:"inline - block",width:"250px",height:"250px",border:"1px solid grey",position:"relative",float:"left","margin-top":"10px","margin-left":"20px","margin-right":"30px","margin-bottom":"0px"},class:"CGRGridViewCell"}).inject(this.elements.container);n.setAttribute("data-rec-id",t.label+"-CGRGridViewCell");var o=new e("",this._isODT);this.cgrViewers.push(o),this.viewerDivs.push(n),o.inject(n);var s=[t.url];if(o.loadModels(s),o.showModel(s[0]),o.onViewpointMove=this.onViewpointMove.bind(this),null!=t.label){var r=new UWA.Element("div",{styles:{width:"100%",height:"20px",bottom:"0px",position:"absolute",color:"rgb(142, 142, 142)","text-align":"center","background-color":"rgba(255,255,255,0.9)","font-family":"arial","font-size":"13px"},class:"CGRGridViewCellLabel"});r.setAttribute("data-rec-id",t.label+"CGRGridViewCellLabel"+this.viewerDivs.length),r.inject(n),new i(t.label).inject(r)}},setODT:function(t){this._isODT=t}})})),define("DS/IterationsWidget/Timepoint",["UWA/Controls/Abstract","DS/IterationsWidget/Label","DS/IterationsWidget/Tooltip"],(function(t,e,i){"use strict";return t.extend({init:function(t,i,n,o,s){this.container=document.createElementNS("http://www.w3.org/2000/svg","g"),this.container.setAttribute("class","timeline-timepoint"),this._isODT=s,this.parent=o,this.obj=t,this.timeline=i,this.nextTimepoint=null,this.previousTimepoint=n,null!=n&&(n.nextTimepoint=this),this.h=this.timeline.config.getTimepointHeight(),this.y=this.timeline.config.getPaddingTop(),this._parent({}),this.color="rgb(54, 142, 196)",this.line=document.createElementNS("http://www.w3.org/2000/svg","line"),this.line.setAttribute("style","stroke:"+this.color+";stroke-width:2"),this.line.setAttribute("x1",0),this.line.setAttribute("y1",this.y),this.line.setAttribute("x2",0),this.line.setAttribute("y2",this.y+this.h),this.rect=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.rect.setAttribute("y",this.y-5),this.container.appendChild(this.rect),this.container.appendChild(this.line),this.from=0,this.to=this.timeline.getWidth(),this.hilighted=!1,this.label=new e(this.obj.label,this._isODT),this.label.inject(this.container),this.resetRectStyle(),this.container.setAttribute("data-rec-id","timeline-timepoint"),this.rect.setAttribute("data-rec-id","timeline-timepoint-rectangle")},getNext:function(){return this.nextTimepoint},getPrevious:function(){return this.previousTimepoint},activate:function(){var t=this.getPercentPosition();this.timeline.moveSlider(t)},inject:function(t){t.appendChild(this.container)},hilight:function(){this.unprehilight(),this.hilighted=!0,this.rect.setAttribute("style","fill:#368ec4;stroke-width:0"),this.rect.setAttribute("height",2),this.label.show()},unhilight:function(){this.hilighted=!1,this.resetRectStyle(),this.line.style.stroke=this.color,this.label.hide()},prehilight:function(t){if(!this.hilighted){this.rect.setAttribute("style","fill:#ccc;stroke-width:0"),this.rect.setAttribute("height","2");var e=this.container.getBoundingClientRect(),n=this.timeline.timelineToClient(t);i.show(n,e.top,this.obj.label)}},unprehilight:function(){this.hilighted||(this.resetRectStyle(),i.hide())},resetRectStyle:function(){this.rect.setAttribute("height","0")},getPercentPosition:function(){var t=this.timeline.getData(),e=t.getCount();if(1==e)return.5;var i=t.get(0).time,n=t.get(e-1).time;return(this.obj.time-i)/(n-i)},getPosition:function(){var t=this.timeline.getWidth();return this.getPercentPosition()*t},calcFromTo:function(){this.from=0,this.to=this.timeline.getWidth(),null!=this.previousTimepoint&&(this.from=(this.previousTimepoint.x+this.x)/2,this.previousTimepoint.to=this.from)},updateLabel:function(){var t=0,e=this.label.getWidth();this.x-e/2<0?t=e/2-this.x:this.timeline.getWidth()-this.x<e/2&&(t=this.timeline.getWidth()-this.x-e/2),this.label.update(t,0)},onResize:function(t){this.y;this.x=this.getPosition(),this.updateLabel(),this.calcFromTo()},onResized:function(){this.container.setAttribute("transform","translate("+this.x+")"),this.rect.setAttribute("x",this.from-this.x);var t=this.to-this.from;t>0&&this.rect.setAttribute("width",t)},getPercent:function(t){return(t*this.timeline.getWidth()-this.from)/(this.to-this.from)},hitTestX:function(t){return this.from<=t&&t<=this.to},hitTestY:function(t){return t>=this.y&&t<=this.y+this.h},hitTest:function(t,e){return null==e?this.hitTestX(t):this.hitTestX(t)&&this.hitTestY(e)},onmousemove:function(t,e){this.prehilight(t)},onmouseout:function(){this.unprehilight()}})})),define("DS/IterationsWidget/IterationsGrid",["UWA/Controls/Abstract","DS/IterationsWidget/CGRGridView","DS/IterationsWidget/Checkbox"],(function(t,e,i){"use strict";return t.extend({init:function(t,e,i,n){i,this.iterations=t,this.top=e,this._parent({}),this._isODT=n,this.elements.container=new UWA.Element("div",{styles:{position:"absolute",top:this.top+"px",height:"calc(100% - "+this.top+"px)",width:"100%"},class:"IterationsGrid"}),this.elements.container.setAttribute("data-rec-id","IterationsGridDiv"),this.hide(),this.uiBuilt=!1},hide:function(){this.elements.container.style.visibility="hidden"},show:function(){this.elements.container.style.visibility="visible",0==this.uiBuilt&&(this.uiBuilt=!0,this.buildUI())},buildUI:function(){new UWA.Element("div",{styles:{position:"absolute",top:"-22px",left:"150px","z-index":"200"}}).inject(this.elements.container).setAttribute("data-rec-id","IterationsGridShowOptionsDiv");for(var t=[],i=this.iterations.length,n=0;n<i;n++){var o=this.iterations[n];t.push({url:o.cgr,label:o.date})}var s=new e(t,this._isODT);s.inject(this.elements.container),s.showAll(),s.onselectchange=function(){}}})})),define("DS/IterationsWidget/TimelineWidget",["UWA/Controls/Abstract","DS/IterationsWidget/Timepoint","DS/IterationsWidget/TimeAxis","DS/IterationsWidget/TimelineSlider","DS/IterationsWidget/TimelineConfig"],(function(t,e,i,n,o){"use strict";return t.extend({init:function(t,e){this.width=500,this.config=new o,this.data=t,this._isODT=e,this.svg=null,this._parent({}),window.addEventListener("resize",this.onResize.bind(this)),this.timepoints=[],this.timeaxis=null,this.slider=null,this.buildUI(),this.activeTimepoint=null,this.lastActiveTimepoint=null,this.sliderPosition=0,this.lastHoverTimepoint=null,this.activeTimepointChanged=null,this.activeTimepointChangedFromList=null,this.onsliderbegindrag=null,this.onsliderenddrag=null},buildUI:function(){this.container=new UWA.Element("div",{styles:{"overflow-x":"auto","overflow-y":"hidden",width:"100%",height:"100%"},class:"timeline-container"}),this.container.setAttribute("data-rec-id","timeline-container"),this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("class","timeline-canvas"),this.svg.setAttribute("style","position:relative;height:100%;"),this.container.appendChild(this.svg),this.buildTimeAxis(),this.timepointContainer=document.createElementNS("http://www.w3.org/2000/svg","g"),this.timepointContainer.setAttribute("class","timeline-timepoints");var t=this.config.getPaddingLeft()+this.config.getSliderWidth()/2;this.timepointContainer.setAttribute("transform","translate("+t+")"),this.svg.appendChild(this.timepointContainer),this.buildTimepoints(),this.buildSlider(),this.container.addEventListener("mousedown",this.onmousedown.bind(this)),this.container.addEventListener("mousemove",this.onmousemove.bind(this)),this.svg.setAttribute("data-rec-id","timeline-canvas"),this.timepointContainer.setAttribute("data-rec-id","timeline-timepoints")},getActiveTimepoint:function(){return this.activeTimepoint},moveSlider:function(t){this.slider.setPosition(t)},moveSliderFromList:function(t){this.slider.setPosition(t)},getWidth:function(){return this.width},onmousedown:function(t){var e=null==t.offsetY?t.layerY:t.offsetY;if(this.hitTestY(e)){var i=null==t.offsetX?t.layerX:t.offsetX,n=this.canvasToTimeline(i)/this.getWidth();this.moveSlider(n)}},hitTestY:function(t){var e=this.config.getTimepointHeight(),i=this.config.getPaddingTop();return t>=i&&t<=i+e},onmousemove:function(t){var e=null==t.offsetY?t.layerY:t.offsetY,i=null==t.offsetX?t.layerX:t.offsetX,n=this.canvasToTimeline(i);null!=this.lastHoverTimepoint&&0==this.lastHoverTimepoint.hitTest(n,e)&&this.lastHoverTimepoint.onmouseout();for(var o=0;o<this.timepoints.length;o++){var s=this.timepoints[o];if(s.hitTest(n,e)){this.lastHoverTimepoint=s,s.onmousemove(n,e);break}}},buildTimepoints:function(){for(var t=null,i=0;i<this.data.getCount();i++){var n=new e(this.data.get(i),this,t,this,this._isODT);n.inject(this.timepointContainer),t=n,this.timepoints.push(n)}},buildTimeAxis:function(){this.timeaxis=new i(this),this.timeaxis.inject(this.svg)},buildSlider:function(){this.slider=new n(this),this.slider.onmove=this.onSliderMoved.bind(this),this.slider.onenddrag=this.onSliderEndDragged.bind(this),this.slider.onbegindrag=this.onSliderBeginDragged.bind(this),this.slider.onmousehover=this.onSliderMouseHover.bind(this),this.slider.onmouseout=this.onSliderMouseOut.bind(this),this.slider.inject(this.svg)},getTimepoint:function(t){for(var e=t*this.getWidth(),i=this.timepoints.length,n=0;n<i;n++){var o=this.timepoints[n];if(o.hitTest(e))return o.index=n,o}return null},getSliderPosition:function(){return this.sliderPosition},getSlider:function(){return this.slider},getScrollLeft:function(){return this.container.scrollLeft},recalcWidth:function(){var t=this.container.offsetWidth,e=this.config.getPaddingLeft()+this.config.getPaddingRight()+this.config.getSliderWidth();t-e>=0&&(this.width=t-e)},getData:function(){return this.data},onResize:function(t){this.recalcWidth(),this.svg.style.width="100%";for(var e=0;e<this.timepoints.length;e++)this.timepoints[e].dispatchEvent("onResize");for(e=0;e<this.timepoints.length;e++)this.timepoints[e].onResized();this.timeaxis.dispatchEvent("onResize"),this.moveSlider(this.sliderPosition)},onSliderMoved:function(t){null!=this.activeTimepoint&&this.activeTimepoint.unhilight(),this.activeTimepoint=this.getTimepoint(t),null!=this.activeTimepoint&&this.activeTimepoint.hilight(),this.sliderPosition=t,null!=this.activeTimepointChanged&&null!=this.activeTimepoint&&this.lastActiveTimepoint!=this.activeTimepoint&&(this.activeTimepointChanged(this.activeTimepoint.obj.id),this.lastActiveTimepoint=this.activeTimepoint),this.timeaxis.onSliderMoved(t)},onSliderMovedFromList:function(t){this.activeTimepoint=this.getTimepoint(t),null!=this.activeTimepoint&&this.activeTimepoint.hilight(),this.sliderPosition=t,null!=this.activeTimepointChangedFromList&&null!=this.activeTimepoint&&this.lastActiveTimepoint!=this.activeTimepoint&&(this.activeTimepointChangedFromList(this.activeTimepoint.obj.id),this.lastActiveTimepoint=this.activeTimepoint,this.lastHoverTimepoint.unhilight(),this.lastHoverTimepoint=this.activeTimepoint,this.lastHoverTimepoint.hilight())},onSliderMouseHover:function(){this.timeaxis.setMouseOverSliderStyle()},onSliderMouseOut:function(){this.timeaxis.setMouseOffSliderStyle()},onSliderBeginDragged:function(){null!=this.onsliderbegindrag&&this.onsliderbegindrag(),this.timeaxis.setMouseOnSliderStyle()},onSliderEndDragged:function(){null!=this.onsliderenddrag&&this.onsliderenddrag(),this.timeaxis.setMouseOverSliderStyle()},addActiveTimepointChangeEventListener:function(t){this.activeTimepointChanged=t},addActiveTimepointChangeFromListEventListener:function(t){this.activeTimepointChangedFromList=t},clientToTimeline:function(t){var e=this.clientToCanvas(t);return this.canvasToTimeline(e)},canvasToTimeline:function(t){return t-this.config.getPaddingLeft()-this.config.getSliderWidth()/2},timelineToCanvas:function(t){return t+this.config.getPaddingLeft()+this.config.getSliderWidth()/2},timelineToClient:function(t){var e=this.timelineToCanvas(t);return this.canvasToClient(e)},clientToCanvas:function(t){var e=this.getCanvasClientLeft();return t+this.getScrollLeft()-e},canvasToClient:function(t){var e=this.getCanvasClientLeft();return t-this.getScrollLeft()+e},getCanvasClientLeft:function(){return this.container.getClientRects()[0].left}})})),define("DS/IterationsWidget/IterationsPlayer",["UWA/Controls/Abstract","DS/IterationsWidget/Toolbar","DS/IterationsWidget/CGRViewerWidget","DS/IterationsWidget/TimelineData","DS/IterationsWidget/TimelineWidget","DS/IterationsWidget/Timer","DS/IterationsWidget/Tooltip"],(function(t,e,i,n,o,s,r){"use strict";var a=null;return t.extend({init:function(t,e,i,n,o,r,l){a=i,this.tenant=n,this.lang=o,this.paused=!1,this.viewEvenly=e,this.iterations=t,this._bIsWebInWin=r,this._isODT=l,this._parent({}),this.buildUI(),this.hide(),this.interval=10,this.iterationDuration=1e3,this.timer=null,this.timer=new s(this.interval),this.timer.ontick=this.onTimerTick.bind(this),this.timer2=null,this.timer2=new s(this.interval),this.timer2.ontick=this.onTimer2Tick.bind(this)},buildUI:function(){this.container=new UWA.Element("div",{styles:{position:"absolute",height:"100%",width:"100%"},class:"IterationsPlayer"});this.timelineContainer=new UWA.Element("div",{styles:{position:"absolute",height:"80px",width:"100%",left:"0px",bottom:"25px"}}),this.timelineContainer.inject(this.container);var t=new e(25,25,"bottom");this.firstButton=t.addButton("assets/images/first.png",a.get("First")),this.firstButton.onclick=this.first.bind(this),this.previousButton=t.addButton("assets/images/previous.png",a.get("Previous")),this.previousButton.onclick=this.previous.bind(this),this.backPlayButton=t.addButton("assets/images/back_play.png",a.get("BackPlay")),this.backPlayButton.onclick=this.backPlay.bind(this),this.pauseButton=t.addButton("assets/images/pause.png",a.get("Pause")),this.pauseButton.onclick=this.pause.bind(this),this.playButton=t.addButton("assets/images/play.png",a.get("Play")),this.playButton.onclick=this.play.bind(this),this.nextButton=t.addButton("assets/images/next.png",a.get("Next")),this.nextButton.onclick=this.next.bind(this),this.lastButton=t.addButton("assets/images/last.png",a.get("Last")),this.lastButton.onclick=this.last.bind(this),t.inject(this.container),t.center(),this.buildTimeline(this.iterations),this.buildCGRViewer(this.iterations),this.timelineContainer["data-rec-id"]="timeLineContainer",this.container["data-rec-id"]="iterationsPlayer"},hide:function(){this.container.style.visibility="hidden",this.removeTimeline(),r.hide()},showEvenly:function(){this.container.style.visibility="visible",this.viewEvenly=!0,this.buildTimeline(this.iterations)},showPropotionally:function(){this.container.style.visibility="visible",this.viewEvenly=!1,this.buildTimeline(this.iterations)},buildTimeline:function(t){if(this.removeTimeline(),null!=t){this.timelineData=this.getTimelineData(t),this.timeline=new o(this.timelineData,this._isODT),this.timeline.inject(this.timelineContainer),this.timeline.addActiveTimepointChangeEventListener(this.onActiveTimepointChange.bind(this)),this._bIsWebInWin&&this.timeline.addActiveTimepointChangeFromListEventListener(this.onActiveTimepointChangeFromList.bind(this));var e=this;this.timeline.onslidermove=function(){e.container.style.pointerEvents="none"},this.timeline.onsliderenddrag=function(){e.container.style.pointerEvents=""},1==this.timelineData.getCount()?this.timeline.moveSlider(.5):this.timeline.moveSlider(1)}},buildCGRViewer:function(t){this.cgrViewer=new i(this.tenant,this.lang,this._isODT),this.cgrViewer.inject(this.container);for(var e=[],n=t.length-1;n>=0;n--){var o=t[n];e.push(o.cgr)}e.length>0&&(this.cgrViewer.loadModels(e),this.cgrViewer.showModel(e[0]))},removeTimeline:function(){for(;this.timelineContainer.firstChild;)this.timelineContainer.removeChild(this.timelineContainer.firstChild)},getTimelineData:function(t){var e=new n,i=t.length;if(i>0)for(var o=0;o<i;o++){var s=t[o],r=s.id,l=s.date_ms;this.viewEvenly&&(l=o);var d=s.title;if(null==d&&(d=o),s.fullcontenturl)l=o,d=a.get("Iteration")+" "+s.displayed_iteration,e.add(r,l,d);else{var c=new Date(parseInt(s.date_ms)).toLocaleString();s.date.indexOf("*")>=0&&(c+="(*)");var h=(d=a.get("Iteration")+" "+d)+"<br>"+c;e.add(r,l,h)}}return e},onActiveTimepointChange:function(t){if(null!=this.cgrViewer){var e=this.getCgr(t);this.cgrViewer.showModel(e)}},onActiveTimepointChangeFromList:function(t){if(null!=this.cgrViewer){var e=this.getCgr(t);this.cgrViewer.showModel(e)}},timepointChangeFromList:function(t){if(null!=this.cgrViewer){var e=this.getCgr(t);this.cgrViewer.showModel(e);var i=this.getRowId(t),n=this.iterations.length,o=0;o=n>1?0==i?0:i==n-1?1:i/(n-1):.5,this.timeline.moveSliderFromList(o)}},getCgr:function(t){for(var e=this.iterations.length,i=0;i<e;i++){var n=this.iterations[i];if(n.id==t)return n.cgr}return null},getRowId:function(t){for(var e=this.iterations.length,i=0;i<e;i++){if(this.iterations[i].id==t)return i}return null},onTimerTick:function(){var t=this.timeline.getSliderPosition(),e=this.timeline.getTimepoint(t),i=e.index,n=e.getPercent(t),o=this.interval/this.iterationDuration;(n+=o)>=1&&(n=o/10,i++);if(i<this.iterations.length){t=this.getTimelinePosition(i,n);this.timeline.moveSlider(t)}else this.timer.stop(),this.timeline.moveSlider(1)},onTimer2Tick:function(){var t=this.timeline.getSliderPosition(),e=this.timeline.getTimepoint(t),i=e.index,n=e.getPercent(t),o=this.interval/this.iterationDuration;(n-=o)<=0&&(n=1-o/10,i--);if(i>=0){t=this.getTimelinePosition(i,n);this.timeline.moveSlider(t)}else this.timer2.stop(),this.timeline.moveSlider(0)},getTimelinePosition:function(t,e){var i=this.iterations.length;if(0==i)return 0;if(1==i)return e;var n=this.getTimepointTime(0),o=this.getTimepointTime(i-1),s=this.getTimepointTime(t),r=n;t>0&&(r=(s+this.getTimepointTime(t-1))/2);var a=o;t<i-1&&(a=(s+this.getTimepointTime(t+1))/2);return(r+e*(a-r)-n)/(o-n)},getTimepointTime:function(t){return parseInt(this.timelineData.data[t].time)},first:function(){this.pause(),this.iterations&&(this.iterations.length<=1?this.timeline.moveSlider(.5):this.timeline.moveSlider(0))},previous:function(){if(this.pause(),this.iterations)if(this.iterations.length<=1)this.timeline.moveSlider(.5);else{var t=this.timeline.getActiveTimepoint().getPrevious();null!=t&&t.activate()}},backPlay:function(){(this.timer.stop(),this.iterations)&&(this.iterations.length<=1?this.timeline.moveSlider(.5):(0==this.timeline.getSliderPosition()&&this.timeline.moveSlider(1),this.timer2.start()))},pause:function(){this.timer.stop(),this.timer2.stop()},play:function(){(this.timer2.stop(),this.iterations)&&(this.iterations.length<=1?this.timeline.moveSlider(.5):(1==this.timeline.getSliderPosition()&&this.timeline.moveSlider(0),this.timer.start()))},next:function(){if(this.pause(),this.iterations)if(this.iterations.length<=1)this.timeline.moveSlider(.5);else{var t=this.timeline.getActiveTimepoint().getNext();null!=t&&t.activate()}},last:function(){this.pause(),this.iterations&&(this.iterations.length<=1?this.timeline.moveSlider(.5):this.timeline.moveSlider(1))}})})),define("DS/IterationsWidget/IterationsInternalWidget",["UWA/Controls/Abstract","UWA/Core","DS/IterationsWidget/IterationsPlayer","DS/IterationsWidget/IterationsGrid","DS/IterationsWidget/Toolbar","DS/IterationsWidget/IterationsTable","DS/IterationsWidget/IterationsDataGridTable","DS/IterationsWidget/IterationsServices","DS/IterationsWidget/RestoreCommentsDialog","DS/IterationsWidget/RestoreConfirmationDialog","DS/IterationsWidget/ext/IWextS_Factory","DS/Controls/Button","DS/Controls/TooltipModel","DS/LifecycleServices/LifecycleAlert","DS/LifecycleCmd/MessageMediator","DS/WebInWinHelper/WebInWinHelper","DS/ENOCollabToolsUI/tracker/ENOCollabTracker","css!DS/IterationsWidget/Iterations"],(function(t,e,i,n,o,s,r,a,l,d,c,h,u,m,p,g,f){return t.extend({init:function(t,i,n,o){this._parent(i),this.innerWidgetOptions=n,this.NLS=o,this.container=e.createElement("div"),this.container.classList.add("iterationsBody"),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative"},using:function(t){return this.innerWidgetParams=t,this},load:function(t){var e=this,i=this.NLS,n=this.innerWidgetOptions,o=this.innerWidgetParams;this.container.innerHTML="";var s=t||o.objectId;if(null==s||""==s)return this.container.innerHTML='<label style="font-family: arial; font-size: 13px;">'+i.get("NoInput")+"</label>",void(this.container.id="iterationsBody-");var r=o.objectType,l=o.objectUsage;this.container.id="iterationsBody-"+s;var d=Date.now(),h={};h.socket=n.webinwinSocket,h.platform3DSpaceURL=n.platform3DSpaceURL,h.SecurityContext=n.SecurityContext,h.tenant=n.tenant,h._isWebInWinODTMode=n.isWebInWinODTMode,h._isODT=n.isODT1,h._isODT2=n.isODT2,h.isWebInWin=n.wintop,h.addinmode=n.addinmode,h.client_app_domain=n.client_app_domain,h.client_app_name=n.client_app_name,h.change_autc=n.change_autc,h.conf_autc=n.conf_autc,c.load(h,r,s,l).then((t=>Promise.all([(new a).using(t).loadIterations(s),t,t&&t.newDataFormat]))).then((([t,i,n])=>e.onIterationsLoaded(o,s,t,i,n,d))).catch((t=>e.onIterationsLoadingError(t)))},onIterationsLoaded:function(t,e,i,n,o,s){var r=this,a=this.NLS,l=this.innerWidgetOptions,d=t.objectType,c=[];if(i.forEach((t=>{var e={name:"",date:"",date_ms:0,cgr:null,modified_by:"",description:"",id:"",fullcontenturl:"",physicalid:"",iternumber:-1,isMIB:!1,newDataFormat:!1};o?(e.id=t.id,t.lastIter&&(e.isLastIter=!0),e.name=t.name,e.modified_by=t.owner,e.description=t.comment,e.date=t.date,e.date_ms=t.date_ms,e.iternumber=t.iternumber,e.displayed_iteration=t.iternumber,e.newDataFormat=!0,e.specific=t.specific,t.isMIB&&(e.isMIB=t.isMIB,e.fullcontenturl=t.fullcontenturl),t.icon_fullpath&&(e.icon_fullpath=t.icon_fullpath)):(e.id=t.id,e.physicalid=t.physicalid,t.name&&(e.name=t.name.replace("*(Current State)",a.get("LastSavedModelString")),e.date=t.date),e.date_ms=t.date_ms,e.cgr=t.cgr),e.name||(e.name=""),c.push(e)})),0==c.length)return void(this.container.innerHTML='<label style="font-family: arial; font-size: 13px;">'+a.get("NoIteration")+"</label>");n.behaviors&&n.behaviors.sorting_key&&"date"===n.behaviors.sorting_key?c.sort((function(t,e){return t.date_ms<e.date_ms?-1:t.date_ms>e.date_ms?1:0})):o||c.sort((function(t,e){return t.date_ms<e.date_ms?-1:t.date_ms>e.date_ms?1:0})),this.container.innerHTML="",r.buildUI(n,l,c,e),r.viewEvenly(),this.container.setAttribute("data-rec-id","iterationsBody"),console.log("iterationsloaded"),l.odt_iterationsloaded&&l.odt_iterationsloaded();let h={UXName:"Iterations",numberObjects:1,actionStatus:"success",actionTime:Date.now()-s};d&&(h.typeObjects=d),h.pv16=c.length,r.trackerEvent=f.createInitActionEvent(h,r.trackerEvent),f.checkAndTrackPageEvent(r.trackerEvent),console.log("iterationsloaded done")},onIterationsLoadingError:function(t){var e=this.NLS;this.container.innerHTML="timeout"==t?'<label style="font-family: arial; font-size: 13px;">'+e.get("Timeout")+"</label>":'<label style="font-family: arial; font-size: 13px;">'+e.get("LoadFail")+"</label>",console.log("loadIterations failed: "+t)},buildUI:function(t,o,a,l){for(var d=this,c=this.NLS,m=(o=this.innerWidgetOptions,this.container),p=t.options.isWebInWin,f=t.options.addinmode,v=o._po_exposed||{},b=!1,w=0;w<a.length;w++){var _=a[w];void 0!==_.cgr&&null!==_.cgr&&(b=!0)}var y=!1;if(p&&null==f){var S=o._licenseList;void 0!==typeof S&&S.length>0&&S.forEach((function(t){("MES.prd"===t.license&&"0"===t.authorized||"HA1.prd"===t.license&&"0"===t.authorized)&&(y=!0)}))}var C={withIterationsPlayer:!1,withIterationsTable:!1,withCompareBtn:!1,withOpenBtn:!1,withRestoreBtn:!1,withToolbar:!0};b&&(C.withIterationsPlayer=!0),b||(C.withIterationsTable=!0),p&&(C.withIterationsTable=!0),!p||null!=f&&"catiav5"===f.toLowerCase()||(C.withCompareBtn=!0),!p||null!=f&&"catiav5"===f.toLowerCase()||(C.withOpenBtn=!0),!p||null!=f&&"catiav5"===f.toLowerCase()||(C.withRestoreBtn=!0),t&&t.behaviors&&t.behaviors.disableIterationToolbar&&(C.withToolbar=!1);var I=0;C.withToolbar&&(I=20);var T=a.length+" "+c.get("Results");this.buildToolbarAndActions(I,T,C,t,l,v),y&&this.compareBtn&&this.compareBtn.disable();var x=null,D=null,W=null;if(C.withIterationsPlayer){(x=new e.Element("div",{id:"iterationPlayerContainer"})).style.position="absolute",x.style.width="100%",x.style.height="calc(100% - "+(I+2)+"px)",C.withIterationsTable&&(x.style.height="calc(50% - "+(I+2)+"px)"),x.style.top=I+2+"px";var A=new i(a,!0,c,o.tenant,o.lang,p,o.isODT);this.iterationsPlayer=A,A.inject(x),x.inject(m),(D=new e.Element("div",{id:"iterationCompareViewContainer"})).style.position="absolute",D.style.width="100%",D.style.height="calc(100% - "+(I+2)+"px)",C.withIterationsTable&&(D.style.height="calc(50% - "+(I+2)+"px)"),D.style.top=I+2+"px",D.style.visibility="hidden";var O=new n(a,I,o.isODT);this.iterationsGrid=O,O.inject(D),D.inject(m)}var L=null;if(C.withIterationsTable){(W=new e.Element("div",{id:"iterationslistcontainer"})).style.position="absolute",W.style.width="100%",!C.withIterationsPlayer||null!=f&&"catiav5"===f.toLowerCase()?C.withIterationsPlayer&&null!=f&&"catiav5"==f.toLowerCase()?(W.style.top="50%",W.style.height="calc(50% - "+(I+4)+"px)"):W.style.height="100%":(W.style.top="50%",W.style.height="50%");var M={parentContainer:W,oid:l,iterations:a,actionsContainer:this,addinmode:f,iterationsGrid:this.iterationsGrid,iterationsPlayer:this.iterationsPlayer};let i=!!t&&(t.behaviors.newDGV||t.behaviors.newDialogFrame);L=i?new r(c,o.lang,M,o.isODT,t,v,!0):new s(c,o.lang,M,o.isODT,v),this.listTable=L,L.inject(W),W.inject(m)}if(null!=f&&"catiav5"===f.toLowerCase()){var P=e.Element("div",{id:"restoreButtonDiv"});this.buttonCloseCV5=new h({domId:"idCloseButton",label:c.get("CATIAV5CancelButton"),emphasize:"secondary",showLabelFlag:!0,disabled:!1,tooltipInfos:new u({shortHelp:c.get("CATIAV5cancelButtonShortHelp"),mouseRelativePosition:!0}),onClick:function(){var t=o.webinwinSocket;g.closePanel(t)}}).inject(P),this.buttonRestoreCV5=new h({domId:"idRestoreButton",label:c.get("CATIAV5RestoreButton"),emphasize:"primary",showLabelFlag:!0,disabled:!0,tooltipInfos:new u({shortHelp:c.get("CATIAV5restoreIterationsShortHelp"),mouseRelativePosition:!0}),onClick:function(){d.restoreIterations(t,L,l)}}).inject(P),W&&P.inject(W)}if(m.addEventListener("click",(function(t){L&&L.checkRestoreBtn&&L.checkRestoreBtn()})),null!=f&&"catiav5"===f.toLowerCase()){var B=o.webinwinSocket;g.viewReadyFireWintopNotif(B)}},viewEvenly:function(){this.evenViewButton&&this.evenViewButton.check(),this.propotionViewButton&&this.propotionViewButton.uncheck(),this.gridViewButton&&this.gridViewButton.uncheck(),this.iterationsGrid&&this.iterationsGrid.hide(),this.iterationsPlayer&&this.iterationsPlayer.showEvenly()},viewPropotionally:function(){this.evenViewButton&&this.evenViewButton.uncheck(),this.propotionViewButton&&this.propotionViewButton.check(),this.gridViewButton&&this.gridViewButton.uncheck(),this.iterationsGrid&&this.iterationsGrid.hide(),this.iterationsPlayer&&this.iterationsPlayer.showPropotionally()},viewGrid:function(){this.evenViewButton&&this.evenViewButton.uncheck(),this.propotionViewButton&&this.propotionViewButton.uncheck(),this.gridViewButton&&this.gridViewButton.check(),this.iterationsPlayer&&this.iterationsPlayer.hide(),this.iterationsGrid&&this.iterationsGrid.show()},buildToolbarAndActions:function(t,e,i,n,s,r){var a=this,l=this.NLS,d=new o(30,t,"top","right",i.withToolbar);if(i.withToolbar&&d.inject(this.container),t>0&&(d.container.innerText=e||""),i.withIterationsPlayer&&(this.gridViewButton=d.addButton("assets/images/grid_view.png",l.get("GridView"),"assets/images/grid_view_active.png",(()=>a.viewGrid())),this.gridViewButton.hide()),i.withIterationsPlayer&&(this.propotionViewButton=d.addButton("assets/images/timeline_view.png",l.get("TimelineView"),"assets/images/timeline_view_active.png",(()=>a.viewPropotionally())),this.evenViewButton=d.addButton("assets/images/seq_view.png",l.get("SequentialView"),"assets/images/seq_view_active.png",(()=>a.viewEvenly()))),i.withCompareBtn&&(this.compareBtn=d.addButton("assets/images/I_PartComparison.png",l.get("CompareIteration"),null,(()=>a.compareIterations(this.listTable))),this.compareBtn.disable()),n.openService&&(n&&n.behaviors.openAction||i.withOpenBtn)){let t="OpenIteration";n.behaviors.openAction&&n.behaviors.openAction.nlsKey&&(t=n.behaviors.openAction.nlsKey);let e=!0,i=!1;n.behaviors.openAction&&n.behaviors.openAction.addInToolbar&&(e=n.behaviors.openAction.addInToolbar),n.behaviors.openAction&&n.behaviors.openAction.addInCtxMenu&&(i=n.behaviors.openAction.addInCtxMenu),this.openBtn=d.addButton("assets/images/I_OpenIteration.png",l.get(t),null,(()=>a.openIterations(n,l,this.listTable,s)),e,i),n.behaviors.openAction&&n.behaviors.openAction.allowOnLastIter&&(this.openBtn.allowOnLastIter=!0),this.openBtn.disable()}if(n.restoreService&&(n&&n.behaviors.restoreAction||i.withRestoreBtn)){let t="RestoreIteration";n.behaviors.restoreAction&&n.behaviors.restoreAction.nlsKey&&(t=n.behaviors.restoreAction.nlsKey);let e=!0,i=!1;n.behaviors.restoreAction&&n.behaviors.restoreAction.addInToolbar&&(e=n.behaviors.restoreAction.addInToolbar),n.behaviors.restoreAction&&n.behaviors.restoreAction.addInCtxMenu&&(i=n.behaviors.restoreAction.addInCtxMenu),this.restoreBtn=d.addButton("assets/images/I_ManageAccess_NothingToCommit.png",l.get(t),null,(()=>a.restoreIterations(n,this.listTable,s,r)),e,i),this.restoreBtn.disable()}return d},_filterValidSCsForRestore:function(t,e){e.options.SecurityContext},restoreIterations:function(t,e,i,n){var o=this.NLS,s=this.innerWidgetOptions;let r=!1,c=!1,h=!1,u=!1;s&&s.mandatoryComment,t.behaviors&&t.behaviors.restoreAction&&t.behaviors.restoreAction.withCommentsInput&&(r=t.behaviors.restoreAction.withCommentsInput),t.behaviors&&t.behaviors.restoreAction&&t.behaviors.restoreAction.withConfirmationPanel&&(c=t.behaviors.restoreAction.withConfirmationPanel),t.behaviors&&t.behaviors.restoreAction&&t.behaviors.restoreAction.withCSFilter&&(h=t.behaviors.restoreAction.withCSFilter);var g=null,v=!1,b=void 0;Promise.resolve().then((()=>{if(h)return this._filterValidSCsForRestore(o,t)})).then((()=>{if(r)return new Promise(((t,i)=>{let n=o.get("restoreCommentsDialogTitle");var r=e.selectedObjects;1==r.length&&e.list[r[0]].name&&(n+=" - "+e.list[r[0]].name);var a={};a.mandatoryComment=s.mandatoryComment;new l(this.container,(e=>{t(e)}),(()=>{v=!0,console.log("cancelled"),t()}),(t=>{i(t)}),o,n,a)}))})).then((t=>{if(!v)return b=t,c?new Promise(((t,i)=>{let s=o.get("restoreConfirmationDialogTitle");var r=e.selectedObjects;1==r.length&&e.list[r[0]].name&&(s+=" - "+e.list[r[0]].name);new d(this.container,(()=>{t()}),(()=>{v=!0,console.log("cancelled"),t()}),(t=>{i(t)}),o,s,n)})):void 0})).then((()=>{if(!v)return g=Date.now(),(new a).using(t,e,i).restoreIterations(b)})).then((t=>{if(!v){var e=void 0,i=void 0,n=void 0;t&&t.newid&&(e=t.newid),t&&t.event&&(i=t.event),t&&t.success_message_key&&(n=t.success_message_key),i&&(console.log("postMessage RestoreIterationMessageMediator"),p.dispatchEvent("onModification",i)),console.log("success_message_key: "+n);var s={eventID:"success",msg:o.get(n)};return n&&m.displayNotification(s),e}})).then((t=>{if(v)return;let e={numberObjects:1,actionStatus:"success",actionTime:g?Date.now()-g:0};this.trackerEvent=f.createValidationEventFromEvent(e,this.trackerEvent),f.checkAndTrackPageEvent(this.trackerEvent),this.load(t)})).catch((t=>{let e={numberObjects:1,actionStatus:"failure",actionTime:g?Date.now()-g:0};this.trackerEvent=f.createValidationEventFromEvent(e,this.trackerEvent),f.checkAndTrackPageEvent(this.trackerEvent),console.log(t);let i=o.get("restoreFailed");"string"==typeof t&&(i=t),t&&"string"==typeof t.message&&(i=t.message);var n={eventID:"error",msg:i};m.displayNotification(n)}))},openIterations:function(t,e,i,n){(new a).using(t,i,n).openIterations(e)},compareIterations:function(t){console.log("compare iterations");var e;if(2==(e=t.selectedObjects).length){for(var i=[],n=0;n<e.length;n++)i.push(t.list[e[n]]);console.log("launchWinCompareIterations: "+i[0].physicalid+" "+i[1].physicalid),g.launchWinCompareIterations(this.innerWidgetOptions.webinwinSocket,i[0],i[1]),console.log("launchWinCompareIterations done")}}})})),define("DS/IterationsWidget/IterationsWidget",["UWA/Controls/Abstract","UWA/Core","DS/UIKIT/Modal","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/PlatformAPI/PlatformAPI","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","i18n!DS/IterationsWidget/assets/nls/IterationsWidget","DS/LifecycleCmd/MessageMediator","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/LifecycleAlert","DS/ENOCollabToolsUI/tracker/ENOCollabTracker","DS/WebappsUtils/WebappsUtils","DS/IterationsWidget/ext/IWextS_Factory","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/IterationsWidget/IterationsInternalWidget","i18n!DS/UIKIT/assets/nls/UIKIT","css!DS/LifecycleControls/assets/styles/LifecycleModals"],(function(t,e,i,n,o,s,r,a,l,d,c,h,u,m,p,g,f,v,b,w){"use strict";var _=t.extend({init:function(t,e,i){this._parent(i),this.wintop=!1,this.addinmode=null},executeCmd:function(t,e,i){this.usage=null;e&&e.context&&e.context.selectedNodesObjects&&Array.isArray(e.context.selectedNodesObjects)&&e.context.selectedNodesObjects.length>0&&(this.usage=e.context.selectedNodesObjects[0]["attribute[PLMEntity.V_usage]"]),e&&e.isODT&&(this._isODT=e.isODT),e&&e.isODT2&&(this._isODT2=e.isODT2),e&&e.odt_iterationsloaded&&(this.odt_iterationsloaded=e.odt_iterationsloaded),e&&e.iterationlistResult&&(window.iterationlistResult=e.iterationlistResult),e&&e.iterationlistResult&&(this.iterationlistResult=e.iterationlistResult),this.setOptions({wintop:!1}),this._parent(e),this.buildUI();let n=t.length>0?t[0]:null;c.getSecurityContextPromise(n.tenant).then((t=>{var e={};return e.tenant=n.tenant,e.platform3DSpaceURL=h.get3DSpaceBaseUrl(n.tenant)+"/",e.SecurityContext=t,g.load(e,n?n.type:void 0,n?n.physicalid:void 0,this.usage)})).then((t=>new Promise(((i,o)=>{try{this.setObject(n,t,(()=>{i()})),t&&t.behaviors.newDialogFrame?this.showDialog2(document.body,e):this.showDialog(document.body)}catch(t){o(t)}})))).catch((t=>{console.log(t);var i=t;t.hasOwnProperty("message")&&(i=t.message);var n={eventID:"error",msg:i};e.context&&"function"==typeof e.context.displayNotification?e.context.displayNotification(n):u.displayNotification(n)})).finally((()=>{i()}))},buildUI:function(){var t=this.elements.container=e.createElement("div");t.style.width="100%",t.style.height="100%"},buildWebInWinUI:function(t,i,n){this._isWebInWinODTMode=i;var o=null;o=this.elements.container=e.createElement("div",{id:"iterationsWidgetIframe","data-socket":t}),this.addinmode=n,o.style.width="100%",o.style.height="100%"},setObject:function(t,e,i){var n,o,s=this;if(this.object=t,null==t)throw l.NoInput;if(n=t.physicalid,o=t.type,"clear"!==n){if(!this.options.wintop){if("Folder"==t.type||"RootFolder"==t.type)throw l.Folder+l.iterationUnsupportedType;var r=!1;if(n.startsWith("cid:")&&(r=!0),"CATPart"===t.type&&(r=!0),"3DShape"===t.type&&(r=!0),"3DPart"===this.usage&&(r=!0),e&&e.isSupportedType()&&(r=!0),!r)throw t.type+l.iterationUnsupportedType}this.tenant=t.tenant,c.getSecurityContextPromise(this.tenant).then((function(t){var e={},r={};{e.tenant=s.tenant,e.SecurityContext=t;let i=s._isODT||s._isODT2;e.isODT=i;let n=!!s._isODT||void 0,o=!!s._isODT2||void 0;e.isODT1=n,e.isODT2=o,s.odt_iterationsloaded&&(e.odt_iterationsloaded=s.odt_iterationsloaded),s.options&&s.options.odt_iterationsloaded&&(e.odt_iterationsloaded=s.options.odt_iterationsloaded),s.iterationlistResult&&(e.iterationlistResult=s.iterationlistResult),s.options&&s.options.iterationlistResult&&(e.iterationlistResult=s.options.iterationlistResult);let r=s._isWebInWinODTMode;e.isWebInWinODTMode=r;let c=widget.lang;e.lang=c;let h=s.options.wintop;e.wintop=h;let u=s.addinmode;e.addinmode=u;var l=window._licenseList;e._licenseList=l,s.options.mandatoryComment&&(e.mandatoryComment=s.options.mandatoryComment),s.options.client_app_domain&&(e.client_app_domain=s.options.client_app_domain),s.options.client_app_name&&(e.client_app_name=s.options.client_app_name);try{var d=a.get();d&&d.change&&d.change.id&&(e.change_autc=d.change.id),d&&d.evolution&&d.evolution.id&&(e.conf_autc=d.evolution.id)}catch(t){console.log("CfgAuthoringContext.get failed")}try{window.webinwinSocket=window._webinwincom_socket,e.webinwinSocket=window.webinwinSocket}catch(t){console.log("info: failed to read window.parent._webinwincom_socket")}i&&(e._po_exposed={}),i&&(window._po_exposed=e._po_exposed)}{let t=n;r.objectId=t;let e=o;r.objectType=e;let i=s.usage;r.objectUsage=i}var c={},h=new Promise(((t,i)=>{var n="text!DS/IterationsWidget/assets/nls/IterationsWidget_"+e.lang+".json";require([n],(e=>{c.json=JSON.parse(e),c.get=function(t){return c.json[t]},t()}),i)}));console.log("inner window.location.href: "+(window.location?window.location.href.substring(0,100):"???"));var u=new Promise(((t,i)=>{let n=e.wintop,o=e.isODT;if(n||o){var s=window.location.href,r=s.indexOf("webapps");return e.platform3DSpaceURL=s.substring(0,r),void t()}let a=e.tenant;f.getPlatformServices({platformId:a,onComplete:i=>{console.log("onComplete of getPlatformServices"),e.platform3DSpaceURL=i["3DSpace"]+"/",t()},onFailure:()=>{console.log("onFailure of getPlatformServices"),i()}})}));Promise.all([h,u]).then((function(){console.log("platform3DSpaceURL: "+e.platform3DSpaceURL);let t=new v(s,{},e,c);t.using(r).load(),t.container.inject(s.elements.container),i&&i()}))}))}else this.elements.container.src="clear"},showDialog:function(t){var e=this,n="";null!=this.object&&(n=" - "+this.object.name+" "+this.object.revision);for(var o="IterationsWidgetDialog Lifecycle_Modals",s=t.getElementsByClassName(o),r=s.length,a=0;a<r;a++){var d=s[a];t.removeChild(d)}var c=new i({className:o,closable:!0,header:l.get("Title")+n});if(c.inject(t),c.setBody(this),c.elements.container.setStyle("top","20px"),c.elements.wrapper.setStyle("width","100%"),c.elements.wrapper.setStyle("height","100%"),c.elements.content.setStyle("height","100%"),c&&c.elements&&c.elements.header){var h=c.elements.header.getElement(".close.fonticon.fonticon-cancel");h&&(h.setText(""),h.removeClassName("fonticon"),h.removeClassName("fonticon-cancel"),h.setStyle("text-align","center"),h.setAttributes({title:b.close})),c.elements.closeTooltip&&c.elements.closeTooltip.elements&&c.elements.closeTooltip.elements.container.addClassName("hideDefaultTooltip")}c.show(),e.myModal=c,widget.addEvent("onRefresh",(function(){null!=e.myModal&&(e.myModal.destroy(),e.myModal=null)}))},showDialog2:function(t,e){var i=new n({});i.inject(t);var r="";this.object&&(r=" - "+this.object.name),this.object&&this.object.revision&&(r=" - "+this.object.name+" "+this.object.revision),this.object&&this.object.displayName&&(r=" - "+this.object.displayName);var a=this.object?this.object.type:"NoType",d=t.offsetWidth-20,c=t.offsetHeight-100,h=new o({identifier:e.identifier||"IterationsWidget_"+a,immersiveFrame:i,title:l.get("Title")+r,content:this.elements.container,modalFlag:!0,resizableFlag:!0,height:c>0?c:void 0,width:d>0?d:void 0,buttons:{Close:new s({onClick:function(t){h.close()}})}});h.elements.container.addClassName("IterationsWidgetDialog"),this.elements.container.parentNode.setStyle("overflow-y","hidden"),widget.addEvent("onRefresh",(function(){null!=h&&(h.destroy(),h=null)}))}});return _}));