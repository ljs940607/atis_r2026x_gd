define("DS/DMUPlayComment/DMUSelectPreviousCommentCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseUIControllers/DMUCommentsController"],(function(e,t){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e);var n=this;this._parentBeginExecute=this.beginExecute,this.beginExecute=function(){this._parentBeginExecute();var e=t.giveDMUCommentsController({context:n.getFrameWindow()});e&&e.selectNextOrPreviousComment(!1),require(["DS/DMUBaseExperience/EXPUtils"],(function(e){e._sendUsageProbe("command","SelectPreviousComment")})),n.end?n.end():n.done()}}})})),define("DS/DMUPlayComment/DMUCommentImport",["UWA/Class"],(function(e){"use strict";return e.extend({init:function(e){this.importData=function(t,n,i){t&&n&&e&&(n.fillObjectAttributes(e,t,i),n.registerForPostImport(e))},this.afterImport=function(){if(e){for(var t=e;t&&"DMUMarkup"!==t.getType();)t=t.getParent();e.fireEvent("onDMUObjectInitialized",{dmuObject:e,dmuCont:t})}}}})})),define("DS/DMUPlayComment/DMUSelectNextCommentCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseUIControllers/DMUCommentsController"],(function(e,t){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e);var n=this;this._parentBeginExecute=this.beginExecute,this.beginExecute=function(){this._parentBeginExecute();var e=t.giveDMUCommentsController({context:n.getFrameWindow()});e&&e.selectNextOrPreviousComment(!0),require(["DS/DMUBaseExperience/EXPUtils"],(function(e){e._sendUsageProbe("command","SelectNextComment")})),n.end?n.end():n.done()}}})})),define("DS/DMUPlayComment/DMUComment",["require","exports","DS/DMUPlayComment/DMUCommentImport","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUOverloadableObject","DS/DMUBaseUI/DMUNode3D","DS/DMUBaseExperience/DMUContextManager"],(function(e,t,n,i,o,s,r){"use strict";let a=[{name:"sOwner",type:"string",JSONname:"PropertiesCommentBase.Owner"},{name:"sTextContents",type:"string",JSONname:"PropertiesCommentBase.TextContents",defaultValue:[""]},{name:"fCreationDate",type:"float",JSONname:"PropertiesCommentBase.CreationDate"},{name:"fLastModificationDate",type:"float",JSONname:"PropertiesCommentBase.LastModificationDate"},{name:"bMarkedAsDeleted",type:"boolean",JSONname:"PropertiesCommentBase.MarkedAsDeleted"},{name:"sParentCommentId",type:"string",JSONname:"PropertiesComment.ParentCommentId"},{name:"lReplies",type:"listObjects",JSONname:"PropertiesComment.Replies",defaultValue:null}];return class extends o{constructor(e,t,o,m){super(e,t),this.addParameters(a);let d,l=this,u=o,c=m;const g="DS/DMUComment/DMUCommentContextualBar",h="Marker";let C,p=[];this.setAttribute("sType","Comment"),this.initAuthoringData=function(){-1!==r.getAuthoringFeatureTypes().indexOf(h)&&(-1===r.getAuthoringFeatureTypes().indexOf(h)||l.getSharedContextualMenuCommandList||window.require([g],(function(e){var n;let o=new e;l.getSharedContextualMenuCommandList=o.getSharedContextualMenuCommandList,l.getContextualMenuCommandList=o.getContextualMenuCommandList,o.register({frmWindow:l.getFrameWindow(),type:l.getType(),experience:(null===(n=null==t?void 0:t.getParent())||void 0===n?void 0:n.getValidation())?"review":"markup"});let s=1===i.get().length?i.get()[0].pathElement.clone():null;s&&s.getLastElement(!0).getDMUType&&s.getLastElement(!0)===l.getNode()&&(i.empty(),i.add({pathElement:s}))})))},this.removeAuthoringData=function(){-1!==r.getAuthoringFeatureTypes().indexOf(h)&&-1!==r.getAuthoringFeatureTypes().indexOf(h)&&window.require([g],(function(e){var n;let i=new e;l.getSharedContextualMenuCommandList=null,l.getContextualMenuCommandList=null,i.unregister({frmWindow:l.getFrameWindow(),experience:(null===(n=null==t?void 0:t.getParent())||void 0===n?void 0:n.getValidation())?"review":"markup"})}))};let f=new n(l);this.importData=f.importData,this.afterImport=f.afterImport,this.initAuthoringData();let D=new s({frmWindow:this.getFrameWindow(),getType:this.getType});D.setPickParent(!0),this.setNode(D),this.setReadOnly(Boolean(o)),this.isExternal=function(){return Boolean(u)},this.getExternalStatus=function(){return c?String(c):""},this.setAlertFlag=function(e){e!==d&&(d=e,l.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:l}))},this.hasAlertFlag=function(){return d},this.isReply=function(){return Boolean(l.getAttribute("sParentCommentId"))},this.getParentCommentId=function(){return l.getAttribute("sParentCommentId")};let M=this.refreshNode;this.refreshNode=function(){let e=l.getNode();if(e&&(!t||!t.isImporting())){e.setName(l.getAttribute("sName"));let t=l.getActiveFlag()&&l.isDisplayed()&&l.isVisible();e.setVisibility(t),e.setVisibilityFree(!t),M()}};let U=this.isReadOnly.bind(this);this.isReadOnly=function(){return U()||Boolean(l.getAttribute("bMarkedAsDeleted"))},this.addAssociatedHighlightData=function(e){p.some((t=>t.id===e.id))||(p.push(e),l.fireEvent("onDMUCommentAssociatedToHighlight",{dmuObject:l,highlights:p}))},this.updateAssociatedHighlightData=function(e){const t=p.find((t=>t.id===e.id));t&&(e.rating&&(t.rating=e.rating),"hasIssue"in e&&(t.hasIssue=e.hasIssue),"hasTask"in e&&(t.hasTask=e.hasTask),"hasImpactedChecks"in e&&(t.hasImpactedChecks=e.hasImpactedChecks),l.fireEvent("onDMUCommentAssociatedToHighlight",{dmuObject:l,highlights:p}))},this.removeAssociatedHighlightData=function({id:e}){let t=p.findIndex((t=>t.id===e));-1!==t&&(p.splice(t,1),l.fireEvent("onDMUCommentAssociatedToHighlight",{dmuObject:l,highlights:p}))},this.getAssociatedHighlightData=function(){return p},this.setPreviewFlag=e=>{C=e},this.isPreview=()=>C,this.getTextContent=function(){const e=(l.getAttribute("sTextContents")||[]).join("\n");let t=document.createElement("div");t.innerHTML=e;return t.innerText},this.getReferencedCheckIds=()=>{const e=(l.getAttribute("sTextContents")||[]).join("\n");let t=document.createElement("div");t.innerHTML=e;const n=t.querySelectorAll("span[data-id]");return Array.from(n).map((e=>e.getAttribute("data-id")||""))},this.importDeprecatedReplies=e=>{let t=l.getAttribute("lReplies");if(t){t=t.slice();let n=e.getDMUComments().indexOf(l);t.forEach((function(t,i){l.getNode().removeChild(t.getNode()),t.setAttributes([{name:"sType",value:"Comment"},{name:"sParentCommentId",value:l.getAttribute("sUuid")}]),e.addDMUComment(t,n+1+i)})),l.setAttribute("lReplies",null)}},this.deprecatedAddDMUReply=function(e,t){if(!e||!e.getType||"DMUComment"!==e.getType())return;let n=l.getAttribute("lReplies")||[];"number"==typeof t?n.splice(t,0,e):n.push(e),l.setAttribute("lReplies",n),e.getNode&&l.getNode().addChild(e.getNode()),l.fireEvent("onDMUObjectAddedInObject",{dmuObject:e,parentObject:l})}}}}));