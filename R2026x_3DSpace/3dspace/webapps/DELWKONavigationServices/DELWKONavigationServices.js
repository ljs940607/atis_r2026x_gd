define("DS/DELWKONavigationServices/DELWKOPathSRParser",["UWA/Core","DS/DELPPWLoggerModel_FD02/LoggerUtils"],(function(e,t){"use strict";return function(){var n,i,s,o={AssetContextLink:{BUS:{name:"AssetContextLink",type:"AssetContextLink",to:{role:"R_486",category:"S_1"}}},DELIsSerializedFrom:{BUS:{name:"DELIsSerializedFrom",type:"DELIsSerializedFrom",to:{role:"R_460",category:"S_1"}}},DELFmiProcessPrereqMaterializationCnx:{BUS:{name:"scope",type:"ResultingProductLink",from:{role:"R_150",category:"S_7"},to:{role:"R_149",category:"S_5"}}},DELFmiProcessOutputPrereqMaterializationCnx:{BUS:{name:"resultingProduct",type:"ResultingProductLink",from:{role:"R_150",category:"S_7"},to:{role:"R_149",category:"S_5"}}},DELFmiProcessImplementCnx:{BUS:{name:"scope",type:"ProductImplementLink",from:{role:"R_52",category:"S_7"},to:{role:"R_51",category:"S_5"}}},PartialProductImplementLink:{BUS:{name:"partialScope",type:"PartialProductImplementLink",to:{role:"R_51",category:"S_5"}}},MfgProductionPlanning:{BUS:{name:"scope",type:"ProcessImplementLink",from:{role:"R_52",category:"S_7"},to:{role:"R_51",category:"S_5"}},REL:{name:"operationProcessImplement",type:"ProcessImplementLinkOcc",from:{role:"R_52",category:"S_7"},to:{role:"R_51",category:"S_5"}}},PartialProcessImplementLink:{BUS:{name:"PartialProcessImplementLink",type:"PartialProcessImplementLink",to:{role:"R_51",category:"S_1"}}},DELLmiTimeConstraintCnx:{REL:{name:"productFlow",type:"DELLmiTimeConstraintCnx",from:{role:"R_248",category:"S_1"},to:{role:"R_249",category:"S_1"}}},DELLmiMaterialPathCnxCust:{BUS:{name:"Material",type:"DELLmiMaterialPathCnxCust",from:{role:"R_295",category:"S_1"},to:{role:"R_294",category:"S_1"}}},HistorizationLinkRefRef:{BUS:{name:"historization",type:"HistorizationLinkRefRef",from:{role:"R_308",category:"S_7"},to:{role:"R_307",category:"S_5"}}},DELAsmProcessCanUseCnx:{BUS:{name:"candidateResource",type:"DELAsmProcessCanUseCnx",from:{role:"R_203",category:"S_5"},to:{role:"R_204",category:"S_6"}}},SecondaryCandidateResourceLink:{BUS:{name:"secondaryResource",type:"SecondaryCandidateResourceLink",from:{role:"R_461",category:"S_1"},to:{role:"R_247",category:"S_1"}}},CapableResourcesStructureLink:{BUS:{name:"CapableResourcesStructureLink",type:"CapableResourcesStructureLink",to:{role:"R_490",category:"S_1"}}},DELLmiProductionSystemOutputCnxToMBOM:{BUS:{name:"mbomOperationOutput",type:"DELLmiProductionSystemOutputCnxToMBOM",from:{role:"R_296",category:"S_1"},to:{role:"R_363",category:"S_1"},tryToFindFromSide:!0}},PLMDocConnection:{BUS:{name:"document",type:"PLMDocConnection",to:{role:"R_87",category:"S_1"}}},PPRContextSystemCnxDisc:{BUS:{name:"system",type:"PPRContextSystemCnxDisc",to:{role:"R_246",category:"S_6"}}},PPRContextProcessCnxDisc:{BUS:{name:"process",type:"PPRContextProcessCnxDisc",to:{role:"R_115",category:"S_6"}}}},r={ProductImplementLinkOcc:{REL:{name:"productMbomImplement",type:"ProductImplementLinkOcc",to:{role:"R_51",category:"S_5"}}},DELIsSerializedFromOp:{REL:{name:"DELIsSerializedFromOp",type:"DELIsSerializedFromOp",to:{role:"R_460",category:"S_5"}}}},a=" ";return n=function(e){return e.indexOf("LT_BO")>-1},i=function(e){var t,n;return t=e.indexOf("PS"),t+=3,n=e.indexOf("PE")-1,e.substring(t,n).split(a)},s=function(i,s,c,l,d,u,p,f){var h,m,y,g,I,P,v,O,R,D,_=function(e){P.from.role===h&&P.from.category===m?f.from=e:P.to.role===h&&P.to.category===m&&(f.to=e)};return g=i.indexOf("R"),I=i.indexOf(a,g),h=i.substring(g,I),g=i.indexOf("S"),I=i.indexOf(a,g),m=i.substring(g,I),g=i.indexOf("I"),I=i.indexOf(a,g),v=i.substring(g,I),O=parseInt(v.split("_")[1]),P=l?o[c]:r[c],e.is(P)?(P=n(i)?P.BUS:P.REL,e.is(P)&&function(n){var i;switch(n){case"ResultingProductLink":1===s.length&&(R=s[0],O>0&&(e.is(f.isRefRef)||(f.isRefRef=!0),P.from.role===h&&P.from.category===m?f.from=u.physicalid.value:P.to.role===h&&P.to.category===m&&(f.to=s[0]),e.is(f.type)||(f.type=n),e.is(f.from)&&e.is(f.to)&&(f.PID=f.type+"|"+f.from+"|"+f.to)));break;case"ProductImplementLink":s.length>0&&(R=s[s.length-1],O>0&&(e.is(f.isRefRef)||(f.isRefRef=!0),_(R),e.is(f.type)||(f.type=n),e.is(f.from)&&e.is(f.to)&&(f.PID=f.type+"|"+f.from+"|"+f.to)));break;case"DELIsSerializedFromOp":case"ProductImplementLinkOcc":O>0&&(D=s,e.is(f.isRefRef)||(f.isRefRef=!1),P.to.role===h&&P.to.category===m&&(f.to=D,f.from=d.physicalid.value),e.is(f.type)||(f.type=n),f.PID=f.type+"|"+f.from+"|"+e.Json.encode(f.to));break;case"ProcessImplementLink":1===s.length&&(R=s[0],O>0&&(e.is(f.isRefRef)||(f.isRefRef=!0),_(R),e.is(f.type)||(f.type=n),e.is(f.from)&&e.is(f.to)&&(f.PID=f.type+"|"+f.from+"|"+f.to)));break;case"PartialProcessImplementLink":case"AssetContextLink":case"CapableResourcesStructureLink":case"PartialProductImplementLink":1===s.length&&(R=s[0],O>0&&(e.is(f.isRefRef)||(f.isRefRef=!0),P.to.role===h&&P.to.category===m&&(f.to=R,e.is(d)&&(f.from=d.physicalid.value)),e.is(f.type)||(f.type=n),e.is(f.from)&&e.is(f.to)&&(f.PID=f.type+"|"+f.from+"|"+f.to)));break;case"ProcessImplementLinkOcc":case"DELLmiTimeConstraintCnx":O>0&&(D=s,e.is(f.isRefRef)||(f.isRefRef=!1),_(D),e.is(f.type)||(f.type=n));break;case"DELLmiMaterialPathCnxCust":D=s.slice(0,s.length-1),O>0&&(e.is(f.isRefRef)||(f.isRefRef=!1),_(D),e.is(f.type)||(f.type=n));break;case"HistorizationLinkRefRef":case"DELAsmProcessCanUseCnx":case"SecondaryCandidateResourceLink":1===s.length&&(R=s[0],O>0&&(e.is(f.isRefRef)||(f.isRefRef=!0),_(R),e.is(f.type)||(f.type=n)));break;case"DELLmiProductionSystemOutputCnxToMBOM":1===s.length&&(R=s[0],O>0&&(e.is(f.isRefRef)||(f.isRefRef=!0),P.from.role===h&&P.from.category===m?e.is(P.tryToFindFromSide,"boolean")&&!0===P.tryToFindFromSide&&(R!==u.physicalid.value?(i=p.get(R),e.is(i)?i["from.physicalid"].value===u.physicalid.value?f.from=i["from.physicalid"].value:(y=e.is(u)&&e.is(u["ds6w:label"])&&e.is(u["ds6w:label"].value,"string")?u["ds6w:label"].value:"ds6w:label Not Defined",t.log('PathSRParser: Unable to find "from" side of "mbomSystemOutput" link of '+y)):(f.idToResolve=R,f.deferResolution=!0)):f.from=R):P.to.role===h&&P.to.category===m&&(f.to=R),e.is(f.type)||(f.type=n)));break;case"PLMDocConnection":1===s.length&&(R=s[0],O>0&&(e.is(f.isRefRef)||(f.isRefRef=!0),P.to.role===h&&P.to.category===m&&(f.to=R,e.is(u)&&(f.from=u.physicalid.value)),e.is(f.type)||(f.type=n)));break;case"PPRContextSystemCnxDisc":case"PPRContextProcessCnxDisc":1===s.length&&(R=s[0],O>0&&(e.is(f.isRefRef)||(f.isRefRef=!0),P.to.role===h&&P.to.category===m&&(f.to=R,e.is(u)&&(f.from=u.physicalid.value)),e.is(f.type)||(f.type=n),e.is(f.from)&&e.is(f.to)&&(f.PID=f.type+"|"+f.from+"|"+f.to)))}}(P.type)):t.error("PathSRParser: Link currently not supported"),f},{parse:function(t,n){var o,r=n||{},a=e.is(r.type)?r.type:null,c=!e.is(r.isRefRef,"boolean")||r.isRefRef,l=e.is(r.referenceEntity)?r.referenceEntity:null,d=e.is(r.ioPortToPlmPortMap)?r.ioPortToPlmPortMap:null,u=null;return e.is(t.pathsr)&&(o=t.pathsr.value,u={from:null,to:null,type:null,PID:null,isRefRef:null,deferResolution:!1},o.split("Sep").forEach((function(n){var o;o=i(n),c?u=s(n,o,a,c,t,l,d,u):e.is(a)||(a="DELLmiExecHeaderOperationInstance"===t.type.value?"DELIsSerializedFromOp":"ProductImplementLinkOcc",u=s(n,o,a,c,t,null,null,u))})),e.is(u.isRefRef)||(u.isRefRef=!1),!1!==u.deferResolution||e.is(u.from)&&e.is(u.to)||(u=null)),u}}}})),define("DS/DELWKONavigationServices/DELWKONavigateOnDB",["UWA/Core","UWA/Promise","DS/DELPPWNavigationServices_FD02/NavigationBase","DS/DELPPWWebServices_FD02/WebserviceUtils","DS/DELPPWModelParsers_FD02/ConnectionParser","DS/DELPPWModelServices_FD02/ModelUtils","DS/DELPPWLoggerModel_FD02/LoggerUtils","DS/DELWKOIndexServices/DELWKOIndexParser"],(function(e,t,n,i,s,o,r,a){"use strict";return n.extend({init:function(e){e=e||{},this._parent(e)},_getDescendants:function(t,n,s,r){var a,c,l,d,u=this;r=r||{},c=isNaN(r.expandLevel)?o.getPrefExpandLevel():r.expandLevel,d={pid:Array.isArray(t)?null:t,expandLevel:c,ordered:!e.is(r)||(!e.is(r.ordered,"boolean")||r.ordered)},l=e.is(r.context)?r.context:this,(a={url:"dsmfg/private/V0/invoke/getDescendants",method:"POST",onComplete:function(e){u.onGetDescendants(e,n,c,r,t),s.call(l)}}).data=e.Json.encode(d),e.is(r.onFailure,"function")&&(a.onFailure=r.onFailure),e.is(r.onTimeout,"function")&&(a.onTimeout=r.onTimeout),e.is(r.onCancel,"function")&&(a.onCancel=r.onCancel),i.webServiceRequest(a)},onGetDescendants:function(t,n,i,s,o){var r=-1===i,a=Array.isArray(o)?o:[o],c=e.clone(a);t.forEach((function(e){var t=e.attributesValue;Object.prototype.hasOwnProperty.call(t,"isInstanceOf")?(n.stackedInstances.push(e),2===i&&a.indexOf(t.isAggregatedBy)>-1&&c.push(t.isInstanceOf)):(e.queriedForChildren=r,n.stackedReferences.push(e))})),2===i&&n.stackedReferences.forEach((function(e){c.indexOf(e.attributesValue.PID)>-1&&(e.queriedForChildren=!0)}))},_getDescendantsAndLinks:function(t,n,s,r){var a,c,l,d=this,u=[],p={};r=r||{},p={expandLevel:l=isNaN(r.expandLevel)?o.getPrefExpandLevel():r.expandLevel,ordered:!e.is(r)||(!e.is(r.ordered,"boolean")||r.ordered),fetchInverseRelations:!!e.is(r)&&(!!e.is(r.fetchInverseRelations,"boolean")&&r.fetchInverseRelations)},e.is(r.gridIDs)&&Array.isArray(r.gridIDs)&&(p.gridIDs=r.gridIDs),e.is(r.filterQuery)&&(p.cfgFilter=r.filterQuery),c=e.is(r.context)?r.context:this,a={method:"POST",onComplete:function(e){Array.isArray(e)?e.forEach((function(e){d.onGetDescendantsAndLinks(e,u,n,l,r,t)})):d.onGetDescendantsAndLinks(e,u,n,l,r,t),s.call(c,u)}},Array.isArray(t)&&t.length>1?(p.pidArray=t,a.url="dsmfg/private/V0/invoke/getMultipleDescendantsAndLinks"):(a.url="dsmfg/private/V0/invoke/getDescendantsAndLinks",p.pid=Array.isArray(t)?t[0]:t),a.data=e.Json.encode(p),e.is(r.onFailure,"function")&&(a.onFailure=r.onFailure),e.is(r.onTimeout,"function")&&(a.onTimeout=r.onTimeout),e.is(r.onCancel,"function")&&(a.onCancel=r.onCancel),i.webServiceRequest(a)},onGetDescendantsAndLinks:function(t,n,i,o,r,a){var c=e.is(r.withLinksResolved,"boolean")?r.withLinksResolved?n:null:n,l=-1===o,d=!0,u=Array.isArray(a)?a:[a],p=e.clone(u);i.documentIdMap=e.merge(i.documentIdMap,t.documents),Array.isArray(r.gridIDs)&&r.gridIDs.length>0&&(d=!1),e.is(t.instancesAndReferences)&&(t.instancesAndReferences.forEach((function(t){var n=t.attributesValue;Object.prototype.hasOwnProperty.call(n,"isInstanceOf")?(t.queriedForConnections=d,e.is(r.filterQuery)&&(t.filterQuery=r.filterQuery),i.stackedInstances.push(t),2===o&&u.indexOf(n.isAggregatedBy)>-1&&p.push(n.isInstanceOf)):(t.queriedForChildren=l,t.queriedForConnections=d,i.stackedReferences.push(t))})),2===o&&i.stackedReferences.forEach((function(e){p.indexOf(e.attributesValue.PID)>-1&&(e.queriedForChildren=!0)}))),t.connections.forEach((function(e){s.parse(e,i,c)}))},_addToCollections_v2:function(t,n){n=n||{};var i={instancesAndReferences:[],connections:[],documents:e.is(n.documentIdMap)?n.documentIdMap:{}},s=this,o=[],r=[],a=[],c=[],l=[],d=[];t.stackedConnections.forEach((function(e){"DELAsmProcessCanUseCnx"===e.type?o.push(e.to):"ProductionPlanLink"===e.type?a.push(e.to):"PartialProductImplementLink"===e.type&&r.push(e.to),d.push(s.collectionUtils.addConn(e,{silent:!0}))})),i.connections.push.apply(i.connections,c),t.stackedConnections=[];t.stackedReferences.forEach((function(e){var t=!0;null==e||"WORKORDER"!==e.attributesValue.PPRTYPE&&"EXECHEADER"!==e.attributesValue.PPRTYPE&&"RESOURCE"!==e.attributesValue.PPRTYPE&&"PROCESS"!==e.attributesValue.PPRTYPE||(t=!1),null==e||"PROCESS"!==e.attributesValue.PPRTYPE||r.includes(e.attributesValue.PID)||(t=!0),null==e||"RESOURCE"!==e.attributesValue.PPRTYPE||o.includes(e.attributesValue.PID)||(t=!0),c.push(s.collectionUtils.addRef(e,{silent:t}))})),i.instancesAndReferences.push.apply(i.instancesAndReferences,c),t.stackedReferences=[],t.stackedInstances.forEach((function(e){(null==e||"SYSTEM"!==e.attributesValue.PPRTYPE&&"OPERATION"!==e.attributesValue.PPRTYPE)&&l.push(s.collectionUtils.addInst(e,{silent:!0}))})),i.instancesAndReferences.push.apply(i.instancesAndReferences,l),t.stackedInstances=[],n.callback(i)},getDescendants_v2:function(t,n){var i=this,s={},o=n.stackedObjects||{stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}};n=n||{},e.is(n.silentMode)&&(s={silent:!0}),e.is(n.withLinks,"boolean")&&n.withLinks?i._getDescendantsAndLinks(t,o,(function(t){(t=Array.from(new Set(t))).length>0?(e.is(n)&&(n.withLinksResolved=!1),n.stackedObjects=o,i.getDescendants_v2(t,n)):(n=e.merge(n,s),i._addToCollections_v2(o,n))}),n):i.getDescendants_v2(t,o,(function(){n=e.merge(n,s),i._addToCollections_v2(o,n)}),n)},getDescendants:function(t,n){var i=this,s={},o=n.stackedObjects||{stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}};n=n||{},e.is(n.silentMode)&&(s={silent:!0}),e.is(n.withLinks,"boolean")&&n.withLinks?i._getDescendantsAndLinks(t,o,(function(t){(t=Array.from(new Set(t))).length>0?(e.is(n)&&(n.withLinksResolved=!1),n.stackedObjects=o,i.getDescendants(t,n)):(n.silentMode=!1,n=e.merge(n,s),i._addToCollections(o,n))}),n):i.getDescendants(t,o,(function(){n=e.merge(n,s),i._addToCollections(o,n)}),n)},getConnectionsByModel:function(t,n,i,s,o){var r,a,c=this,l=e.is(o,"function"),d=e.is(t)?t.id:null,u=e.is(n)?n.id:null;r={relationTypes:i,isRefRefOnly:s,onComplete:function(){a=c.collectionUtils.getImpactedConnections(d,u,r),l&&o(a)},onFailure:function(){l&&o(a)}},c.fetchConnections(d,u,r)},fetchConnections:function(t,n,s,o){var c,l,d,u,p,f,h=this,m=[];s=s||{},d=h.collectionUtils.needToQueryForConnections(h.collectionUtils.references,t)?t:null,u=h.collectionUtils.needToQueryForConnections(h.collectionUtils.instances,n)?n:null,o=!!e.is(o)&&o,e.is(d)||e.is(u)||o?(p=!!e.is(s.isRefRefOnly)&&s.isRefRefOnly,f=e.is(s.relationTypes,"array")?s.relationTypes:[],h.collectionUtils.connections.fetch({data:{parentPID:t,instancePID:n,gridIDs:e.Json.encode(f)},headers:i.getHeaders({serviceName:"3DSpace"}),wait:!0,remove:!1,onComplete:function(i,d){var u;e.is(t)&&!p&&(c=h.collectionUtils.getReferenceFromCollection(t),e.is(c)?("PART"===c.get("PPRTYPE")&&(u=a.translatePredicateToAttribute(c._attributes,{type:"entity"}),c.set(u)),c.setAdditionalInfo({queriedForConnections:!0})):r.debug(h.name,"could not get reference pid %s",t)),e.is(n)&&!p&&(l=h.collectionUtils.getInstanceFromCollection(n),e.is(l)&&l.setAdditionalInfo({queriedForConnections:!0})),e.is(s.onComplete,"function")&&(o?(e.is(d,"array")&&d.forEach((function(n){var i=n["from.attributesValue"],s=n["to.attributesValue"];e.is(i)&&e.is(s)&&e.is(s.physicalid,"string")&&t===s.physicalid&&m.push(i)})),s.onComplete.call(s.context,m)):s.onComplete.call(null))},onFailure:function(){r.debug(h.name,"Fetching of connections failed: %s , %s",t,n),e.is(s.onFailure,"function")&&s.onFailure.call(null)}})):e.is(s.onComplete,"function")&&s.onComplete.call(null)},fetchRoot:function(t,n){var i=n||{},s=e.is(i.context)?i.context:null,o=!e.is(i.silent)||i.silent,r=!!e.is(i.forceDBMode)&&i.forceDBMode,a=e.is(i.onComplete,"function")?i.onComplete:null,c=e.is(i.onFailure,"function")?i.onFailure:null,l={onComplete:function(t){var n,i={forceDBMode:r};e.is(a,"function")&&(e.is(t.instancesAndReferences)?(n=t.instancesAndReferences,i=e.merge(i,{isArray:!0})):n=t,a.call(s,n,i))},onFailure:function(t){e.is(c,"function")&&c.call(s,t)},silent:o};e.is(t,"array")?this.collectionUtils.fetchRefList(t,l):this.collectionUtils.fetchRef({PID:t},e.merge(l,{add:e.is(i.add)?i.add:void 0}))},fetchInstancesAndTheirReferences:function(e,t){this.collectionUtils.fetchInstancesAndTheirReferences(e,t)},getWhereUsedReferences:function(t,n){var s,o,r=this,a=e.is(n,"function"),c={callback:function(t){var i=[],s=[];e.is(t)&&e.is(t.instancesAndReferences,"array")&&t.instancesAndReferences.forEach((function(e){e.isReference()?i.push(e):s.push(e)})),a&&n(i,s)}},l={stackedReferences:[],stackedInstances:[]};e.is(t)&&(s=t.id),i.webServiceRequest({url:"dsmfg/private/V0/invoke/whereUsed",method:"GET",data:{pid:s},onComplete:function(t){t.forEach((function(t){o=t.attributesValue,e.is(o)&&(Object.prototype.hasOwnProperty.call(o,"isInstanceOf")?l.stackedInstances.push(t):l.stackedReferences.push(t))})),r._addToCollections(l,c)},onFailure:function(){a&&n([])}})}})})),define("DS/DELWKONavigationServices/DELWKONavigateOnIndex",["UWA/Core","DS/DELPPWNavigationServices_FD02/NavigationBase","DS/DELWKONavigationServices/DELWKOPathSRParser","DS/DELPPWWebServices_FD02/WebserviceUtils","DS/DELWKODicoServices/DELWKODicoUtils","DS/DELWKOIndexServices/DELWKOIndexParser","DS/DELPPWResourceServices_FD02/ResourceUtils","DS/DELPPWModelServices_FD02/ModelUtils","DS/DELPPWLoggerModel_FD02/LoggerUtils"],(function(e,t,n,i,s,o,r,a,c){"use strict";var l=function(e){var t=["ImplementLinkUsageFamily","SymbolicLinkForScope"];return e=1===(e=(e=Array.isArray(e)?e:[e]).filter((function(e){return-1===t.indexOf(e)}))).length?e[0]:null};return t.extend({_selectFacet:[],_computeBo:[],_selectPredicates:{},FETCH_CHUNK_SIZE:1e3,init:function(e){e=e||{},this._parent(e),this.selectPredicates={},this.pathSRParser=new n},getSelectUnit:function(t,n){var i,a=o.translatePredicateToAttribute(t,n),c={};return a.forEach((function(n,o){!(i=s.getAttributeInfo(n))||!i.ManipulationUnit||e.is(i.HasRangeDefined)&&"Yes"===i.HasRangeDefined||(c[t[o]]=r.getLabelForUnit(i.Magnitude,i.ManipulationUnit))})),c},fetchRoot:function(t,n){var i=this,s=n||{},o=e.is(s.context)?s.context:null,r=e.is(s.onComplete,"function")?s.onComplete:null,a=e.is(s.onFailure,"function")?s.onFailure:null,c=e.merge({onComplete:function(t){var s,c,l=function(t){var s=i.collectionUtils.addRef(t.attributes,n);return e.is(t.ds6w)&&s.setAdditionalInfo({ds6w:t.ds6w}),s};e.is(t)?e.is(t,"array")?0===t.length?a():(c=t.map(l),e.is(r,"function")&&r.call(o,c)):e.is(t.attributes)&&e.is(t.attributes.PID)?(s=l(t),e.is(r,"function")&&r.call(o,s)):a():a()},onFailure:a},s);i.fetchOnIndex(t,c)},fetchOnIndex:function(t,n){var s=i.get3DSpaceUrl()+"cvservlet/fetch/v2",r=n||{},c=e.is(r.type,"string")?r.type:"entity",l=e.is(r.context)?r.context:null,d=e.is(t)?e.is(t,"array")?t:[t]:null,u=e.is(r.select_predicate)?r.select_predicate:this.getSelectPredicate(c),p=this.getSelectUnit(u),f=!e.is(r.withSynthesisAttribute,"boolean")||r.withSynthesisAttribute,h={label:a.getCVServletLabel(),physicalid:d,select_predicate:u,locale:widget.locale,lang:widget.lang,select_unit:p,with_synthesis_attribute:f};i.webServiceRequest({url:s,method:"POST",headers:i.getHeaders({isJsonOnly:!0}),data:e.Json.encode(h),options:n,onComplete:function(t){var n,i=[];e.is(t)&&e.is(t.results)&&(n=e.is(t.results,"array")?t.results:null),e.is(n,"array")&&n.forEach((function(t){var n=o.parseFetchResult(t),s=o.translatePredicateToAttribute(n.attributes,{type:c});e.merge(s,o.translatePredicateToAttribute(n.ds6w,{type:c,fromExpandService:!0})),n.attributes=s,i.push(n)})),e.is(r.onComplete,"function")&&(i=i.length>0?i.length>1?i:i[0]:[],r.onComplete.call(l,i))},onFailure:function(t){e.is(r.onFailure,"function")&&r.onFailure.call(l,t)}})},setSelectPredicate:function(t,n){var i,s,r=e.is(this.mandatoryPredicates)&&e.is(this.mandatoryPredicates.refMandatoryAttributes,"array")?this.mandatoryPredicates.refMandatoryAttributes:["PID","type","V_Name","PLM_ExternalID","V_discipline","description","V_MaterialNeed","interface","V_IsPreferred","V_SequencingMode"],a=e.is(this.mandatoryPredicates)&&e.is(this.mandatoryPredicates.instMandatoryAttributes,"array")?this.mandatoryPredicates.instMandatoryAttributes:["PID","type","V_Name","PLM_ExternalID","V_discipline","isAggregatedBy","isInstanceOf","V_TreeOrder","V_X2DPos","V_Y2DPos"];r.forEach((function(e){-1===n.boAttrName.indexOf(e)&&n.boAttrName.push(e)})),a.forEach((function(e){-1===n.roAttrName.indexOf(e)&&n.roAttrName.push(e)})),i=e.is(this._selectPredicates[t])?this._selectPredicates[t]:{},s={entity:o.translateAttributeToPredicate(n.boAttrName,{type:"entity"}),relation:o.translateAttributeToPredicate(n.roAttrName,{type:"relation"})},e.is(i.entity)||e.is(i.relation)?(s.entity.forEach((function(e){-1===i.entity.indexOf(e)&&i.entity.push(e)})),s.relation.forEach((function(e){-1===i.relation.indexOf(e)&&i.relation.push(e)})),this._selectPredicates[t]=i):this._selectPredicates[t]=s},getSelectPredicate:function(e,t){var n=[],i=this._selectPredicates;if(e=e||"entity",t)switch(e){case"entity":n=i[t].entity;break;case"relation":n=i[t].relation}else switch(e){case"entity":Object.keys(i).forEach((function(e){var t=i[e].entity;Object.keys(t).map((function(e){return t[e]})).forEach((function(e){-1===n.indexOf(e)&&n.push(e)}))}));break;case"relation":Object.keys(i).forEach((function(e){var t=i[e].relation;Object.keys(t).map((function(e){return t[e]})).forEach((function(e){-1===n.indexOf(e)&&n.push(e)}))}))}return n},navigateScopes:function(t,n,i){var s={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},o=i||{},r=this,a=!1;o=e.merge(o,{callback:n}),t.length>0?this.getProductScopedLinks(t,(function(t){var n;e.is(t)&&e.is(t.result,"array")&&e.is(t.result[0])&&(n=t.result[0].outputs.scopes,e.is(n)&&n.forEach((function(e){s.stackedReferences.push(e),a=!0}))),!0===a?r._addToCollections(s,o):o.callback(null)}),e.extend(i,{context:this})):n(null)},getReferenceFromInstance:function(t,n,s){var o,r,c,l=i.get3DSpaceUrl()+"cvservlet/navigate?SecurityContext="+i.getSecurityContext(),d=[],u={},p=this.getSelectPredicate("entity").concat(this.getSelectPredicate("relation"));for(o=p.length;o--;)u[c=p[o]]||(d.unshift(c),u[c]=!0);s=s||{},t instanceof Array||(t=[t]),s.selectBo instanceof Array&&(d=s.selectBo),d.push("pathsr"),r={label:a.getCVServletLabel(),input_physical_ids:t,primitives:[{navigate_from_rel:{id:1},navigate_to_rel:{id:2}}],patterns:{refsFrom:[{id:1}],refsTo:[{id:2}]},patternTypeFilters:{scopes:{typesToNotReturn:["PLMCoreInstance"],filterLinksOn:"elements"}},attributes:d,fileAttributes:[],version:3},e.is(s.expandIter,"string")&&(r.expand_iter=s.expandIter),r=e.Json.encode(r),i.webServiceRequest({url:l,method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:r,onComplete:function(e){n instanceof Function&&n.call(s.context,e)},onFailure:function(e,t){s.onFailure instanceof Function&&s.onFailure(t)}})},getProductScopedLinks:function(t,n,s){var o,r,c,l=i.get3DSpaceUrl()+"cvservlet/navigate?SecurityContext="+i.getSecurityContext(),d=[],u={},p=this.getSelectPredicate("entity").concat(this.getSelectPredicate("relation"));for(o=p.length;o--;)u[c=p[o]]||(d.unshift(c),u[c]=!0);s=s||{},t instanceof Array||(t=[t]),s.selectBo instanceof Array&&(d=s.selectBo),d.push("pathsr"),r={label:a.getCVServletLabel(),input_physical_ids:t,primitives:[{navigate_from_sr:{id:1,mode:"contains",filter:{role:["51"],category:["5"]}},navigate_from_rel:{id:2}}],patterns:{scopes:[{id:1},{id:2}]},patternTypeFilters:{scopes:{typesToNotReturn:["PLMCoreInstance"],filterLinksOn:"elements"}},attributes:d,fileAttributes:[],version:3},e.is(s.expandIter,"string")&&(r.expand_iter=s.expandIter),r=e.Json.encode(r),i.webServiceRequest({url:l,method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:r,onComplete:function(e){n instanceof Function&&n.call(s.context,e)},onFailure:function(e,t){s.onFailure instanceof Function&&s.onFailure(t)}})},navigateOnIndex:function(t,n,s){var o,r,c,l=i.get3DSpaceUrl()+"cvservlet/navigate?SecurityContext="+i.getSecurityContext(),d=[],u={},p=this.getSelectPredicate("entity").concat(this.getSelectPredicate("relation"));for(o=p.length;o--;)u[c=p[o]]||(d.unshift(c),u[c]=!0);s=s||{},t instanceof Array||(t=[t]),s.selectBo instanceof Array&&(d=s.selectBo),d.push("pathsr"),r={label:a.getCVServletLabel(),input_physical_ids:t,primitives:[{navigate_to_sr:{id:1,filter:{role:["52"],category:["7"]},mode:"path"},navigate_from_sr:{id:2,mode:"ends",filter:{role:["52"],category:["7"]}}},{navigate_to_sr:{id:3,filter:{role:["51"],category:["5"]},mode:"path"},navigate_from_sr:{id:4,mode:"ends",filter:{role:["51"],category:["5"]}}},{navigate_to_sr:{id:5,filter:{role:["203"],category:["5"]},mode:"path"},navigate_from_sr:{id:6,filter:{role:["203"],category:["5"]}}},{navigate_to_sr:{id:7,filter:{role:["204"],category:["6"]},mode:"path"},navigate_from_sr:{id:8,filter:{role:["204"],category:["6"]}}},{navigate_to_sr:{id:9,filter:{role:["296"],category:["1"]},mode:"path"},navigate_from_sr:{id:10,filter:{role:["296"],category:["1"]}}},{navigate_to_sr:{id:11,filter:{role:["363"],category:["1"]},mode:"path"},navigate_from_sr:{id:12,filter:{role:["363"],category:["1"]}}},{navigate_to_rel:{id:13,filter:{rel_type:["MfgProcessAlternate"]},mode:"return_rel"},navigate_from_rel:{id:14,filter:{rel_type:["MfgProcessAlternate"]},mode:"return_rel"}},{navigate_to_rel:{id:15,filter:{rel_type:["VPLMrel_47_PLMPort_47_V_Owner"]}},navigate_from_rel:{id:16,filter:{rel_type:["VPLMrel_47_PLMPort_47_V_Owner"]},mode:"return_rel"}},{navigate_to_sr:{id:17,filter:{role:["296"],category:["1"]}}},{navigate_to_sr:{id:18,filter:{role:["308"],category:["7"]},mode:"path"},navigate_from_sr:{id:19,filter:{role:["308"],category:["7"]}}},{navigate_to_sr:{id:20,filter:{role:["307"],category:["5"]},mode:"path"},navigate_from_sr:{id:21,filter:{role:["307"],category:["5"]}}},{navigate_to_rel:{id:22,filter:{rel_type:["VPLMrel_47_PLMConnection_47_V_Owner"]}},navigate_to_sr:{id:23,filter:{role:["87"],category:["1"]},mode:"path"}},{navigate_to_sr:{id:24,filter:{role:["248"],category:["1"]},mode:"path"},navigate_from_sr:{id:25,mode:"ends",filter:{role:["248"],category:["1"]}}},{navigate_to_sr:{id:26,filter:{role:["249"],category:["1"]},mode:"path"},navigate_from_sr:{id:27,mode:"ends",filter:{role:["249"],category:["1"]}}},{navigate_to_sr:{id:28,filter:{role:["295"],category:["1"]},mode:"path"},navigate_from_sr:{id:29,filter:{role:["295"],category:["1"]}}},{navigate_to_sr:{id:30,filter:{role:["294"],category:["1"]},mode:"path"},navigate_from_sr:{id:31,filter:{role:["294"],category:["1"]}}},{navigate_to_sr:{id:32,filter:{role:["461"],category:["1"]},mode:"path"},navigate_from_sr:{id:33,filter:{role:["461"],category:["1"]}}},{navigate_to_sr:{id:34,filter:{role:["247"],category:["1"]},mode:"path"},navigate_from_sr:{id:35,filter:{role:["247"],category:["1"]}}},{navigate_to_sr:{id:36,filter:{role:["490"],category:["1"]},mode:"path"},navigate_from_sr:{id:37,mode:"ends",filter:{role:["490"],category:["1"]}}},{navigate_to_sr:{id:38,filter:{role:["51"],category:["5"]},mode:"last"}},{navigate_to_sr:{id:39,filter:{role:["51"],category:["1"]},mode:"path"},navigate_from_sr:{id:40,mode:"ends",filter:{role:["51"],category:["1"]}}}],patterns:{scope_pathSR:[{id:2},{id:3}],scopeInverse_pathSR:[{id:4},{id:1}],partialScope_pathSR:[{id:38}],partialScopeInverse_pathSR:[{id:4}],HeaderOperationPartialScope_pathSR:[{id:39}],HeaderOperationPartialScopeInverse_pathSR:[{id:40}],candidateResource_pathSR:[{id:6},{id:7}],candidateResourceInverse_pathSR:[{id:8},{id:5}],SecondaryResource_pathSR:[{id:33},{id:34}],SecondaryResourceInverse_pathSR:[{id:35},{id:32}],capableResourcesStructure_pathSR:[{id:36}],capableResourcesStructureInverse_pathSR:[{id:37}],mbomSystemOutput_pathSR:[{id:15},{id:10},{id:11}],mbomSystemOutputInverse_pathSR:[{id:12},{id:9}],mbomSystemOutputInverse_relation:[{id:12},{id:17},{id:16}],mbomOperationOutput_pathSR:[{id:10},{id:11}],mbomOperationOutputInverse_pathSR:[{id:12},{id:9}],alternate_relation:[{id:13}],alternateInverse_relation:[{id:14}],historization_pathSR:[{id:19},{id:20}],historizationInverse_pathSR:[{id:21},{id:18}],document_pathSR:[{id:22},{id:23}],productFlow_pathSR:[{id:25},{id:26}],productFlowInverse_pathSR:[{id:27},{id:24}],productMbomImplement_pathSR:[{id:3}],productMbomImplementInverse_pathSR:[{id:4}],Material_pathSR:[{id:29},{id:30}],MaterialInverse_pathSR:[{id:31},{id:28}],operationProcessImplement_pathSR:[{id:2},{id:3}],operationProcessImplementInverse_pathSR:[{id:4},{id:1}]},patternTypeFilters:{mbomSystemOutputInverse_pathSR:{typesReturn:["DELLmiProdSystemIOPort"]},mbomOperationOutputInverse_pathSR:{typesToNotReturn:["DELLmiProdSystemIOPort"]},productMbomImplement_pathSR:{typesToNotReturn:["PLMCoreReference"]},productMbomImplementInverse_pathSR:{typesToNotReturn:["DELFmiProcessImplementCnx","DELFmiFunctionIdentifiedInstance","MfgProductionPlanning","PLMCoreReference"]},scope_pathSR:{typesToNotReturn:["PLMCoreInstance"],filterLinksOn:"elements"},scopeInverse_pathSR:{typesToNotReturn:["PLMCoreInstance"],filterLinksOn:"elements"},partialScope_pathSR:{typesToReturn:["VPMReference"]},partialScopeInverse_pathSR:{typesToNotReturn:["DELFmiProcessImplementCnx","PLMCoreInstance","MfgProductionPlanning","DELLmiHeaderOperationReference"],filterLinksOn:"elements"},HeaderOperationPartialScope_pathSR:{typesToNotReturn:["VPMReference"],filterLinksOn:"elements"},HeaderOperationPartialScopeInverse_pathSR:{typesToReturn:["DELLmiHeaderOperationReference"]},operationProcessImplement_pathSR:{typesToNotReturn:["PLMCoreReference"],filterLinksOn:"elements"},operationProcessImplementInverse_pathSR:{typesToNotReturn:["PLMCoreReference"],filterLinksOn:"elements"}},attributes:d,fileAttributes:[],version:3},e.is(s.expandIter,"string")&&(r.expand_iter=s.expandIter),r=e.Json.encode(r),i.webServiceRequest({url:l,method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:r,onComplete:function(e){n instanceof Function&&n.call(s.context,e)},onFailure:function(e,t){s.onFailure instanceof Function&&s.onFailure(t)}})},navigateInverseOnIndex:function(t,n,s){var o,r,c,l=i.get3DSpaceUrl()+"cvservlet/navigate?SecurityContext="+i.getSecurityContext(),d=[],u={},p=this.getSelectPredicate("entity").concat(this.getSelectPredicate("relation"));for(o=p.length;o--;)u[c=p[o]]||(d.unshift(c),u[c]=!0);s=s||{},t instanceof Array||(t=[t]),s.selectBo instanceof Array&&(d=s.selectBo),d.push("pathsr"),r={label:a.getCVServletLabel(),input_physical_ids:t,primitives:[{navigate_to_sr:{id:1,filter:{role:["52"],category:["7"]},mode:"path"}},{navigate_from_sr:{id:4,mode:"ends",filter:{role:["51"],category:["5"]}}},{navigate_to_sr:{id:5,filter:{role:["203"],category:["5"]},mode:"path"}},{navigate_from_sr:{id:8,filter:{role:["204"],category:["6"]}}},{navigate_to_sr:{id:9,filter:{role:["296"],category:["1"]},mode:"path"}},{navigate_from_sr:{id:12,filter:{role:["363"],category:["1"]}}},{navigate_from_rel:{id:14,filter:{rel_type:["MfgProcessAlternate"]},mode:"return_rel"}},{navigate_from_rel:{id:16,filter:{rel_type:["VPLMrel_47_PLMPort_47_V_Owner"]},mode:"return_rel"}},{navigate_to_sr:{id:17,filter:{role:["296"],category:["1"]}}},{navigate_to_sr:{id:18,filter:{role:["308"],category:["7"]},mode:"path"}},{navigate_from_sr:{id:21,filter:{role:["307"],category:["5"]}}},{navigate_to_sr:{id:24,filter:{role:["248"],category:["1"]},mode:"path"}},{navigate_from_sr:{id:27,mode:"ends",filter:{role:["249"],category:["1"]}}},{navigate_to_sr:{id:28,filter:{role:["295"],category:["1"]},mode:"path"}},{navigate_from_sr:{id:31,filter:{role:["294"],category:["1"]}}},{navigate_to_sr:{id:32,filter:{role:["461"],category:["1"]},mode:"path"}},{navigate_from_sr:{id:35,filter:{role:["247"],category:["1"]}}},{navigate_from_sr:{id:37,mode:"ends",filter:{role:["490"],category:["1"]}}},{navigate_to_rel:{id:42,filter:{rel_type:["DELIsSerializedFrom"]},mode:"return_rel"}},{navigate_from_rel:{id:44,mode:"return_rel"}},{navigate_to_sr:{id:43,filter:{rel_type:["MfgProductionPlanning"]},mode:"path"}},{navigate_to_sr:{id:45,filter:{role:["490","486"]},mode:"path"}},{navigate_to_sr:{id:46,filter:{role:["247"],category:["1"]},mode:"path"}},{navigate_to_sr:{id:47,filter:{role:["204"],category:["1"]},mode:"path"}},{navigate_to_sr:{id:98,filter:{role:["361"]},mode:"path"}},{navigate_to_sr:{id:99,filter:{role:["460"],category:["5"],rel_type:["DELIsSerializedFrom"]},mode:"path"}},{navigate_from_sr:{id:40,mode:"ends",filter:{role:["51"],category:["1"]}}}],patterns:{scopeInverse_pathSR:[{id:4},{id:1}],partialScopeInverse_pathSR:[{id:4}],HeaderOperationPartialScopeInverse_pathSR:[{id:40}],candidateResourceInverse_pathSR:[{id:8},{id:5}],SecondaryResourceInverse_pathSR:[{id:35},{id:32}],capableResourcesStructureInverse_pathSR:[{id:37}],mbomSystemOutputInverse_pathSR:[{id:12},{id:9}],mbomSystemOutputInverse_relation:[{id:12},{id:17},{id:16}],mbomOperationOutputInverse_pathSR:[{id:12},{id:9}],alternateInverse_relation:[{id:14}],historizationInverse_pathSR:[{id:21},{id:18}],productFlowInverse_pathSR:[{id:27},{id:24}],productMbomImplementInverse_pathSR:[{id:4}],MaterialInverse_pathSR:[{id:31},{id:28}],operationProcessImplementInverse_pathSR:[{id:4},{id:1}],serializedFrom_pathSR:[{id:42}],mfgProductionPlanning_pathSR:[{id:43}],productionplan_pathSR:[{id:44}],assetContext_pathSR:[{id:45}],assignedWorkCenter_pathSR:[{id:46}],opserializedFrom_pathSR:[{id:99}],build_pathSR:[{id:98}]},patternTypeFilters:{mbomSystemOutputInverse_pathSR:{typesReturn:["DELLmiProdSystemIOPort"]},mbomOperationOutputInverse_pathSR:{typesToNotReturn:["DELLmiProdSystemIOPort"]},productMbomImplementInverse_pathSR:{typesToNotReturn:["DELFmiProcessImplementCnx","DELFmiFunctionIdentifiedInstance","MfgProductionPlanning","PLMCoreReference"]},scopeInverse_pathSR:{typesToNotReturn:["PLMCoreInstance"],filterLinksOn:"elements"},partialScopeInverse_pathSR:{typesToNotReturn:["DELFmiProcessImplementCnx","PLMCoreInstance","MfgProductionPlanning","DELLmiHeaderOperationReference"],filterLinksOn:"elements"},HeaderOperationPartialScopeInverse_pathSR:{typesToReturn:["DELLmiHeaderOperationReference"]},operationProcessImplementInverse_pathSR:{typesToNotReturn:["PLMCoreReference"],filterLinksOn:"elements"},productionplan_pathSR:{typesToReturn:["DELLmiWorkOrderInstance","DELLmiProductionPlanReference","DELLmiWorkOrderReference"]},mfgProductionPlanning_pathSR:{typesToNotReturn:["VPMReference","Builds","Hardware Build","Software Build"],filterLinksOn:"elements"},assetContext_pathSR:{typesToReturn:["VPMReference"],filterLinksOn:"elements"},assignedWorkCenter_pathSR:{typesToReturn:["VPMReference"],filterLinksOn:"elements"},build_pathSR:{typesToReturn:["Builds","Hardware Build","Software Build"],filterLinksOn:"elements"}},attributes:d,fileAttributes:[],version:3},e.is(s.expandIter,"string")&&(r.expand_iter=s.expandIter),r=e.Json.encode(r),i.webServiceRequest({url:l,method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:r,onComplete:function(e){n instanceof Function&&n.call(s.context,e)},onFailure:function(e,t){s.onFailure instanceof Function&&s.onFailure(t)}})},_getMultipleNavigateOnIndexPromise:function(t,n,i){var s=parseInt(widget.getValue("navigateSplitSize")),o=this,r=i||{};return new Promise((function(i,a){var c,l={},d={},u={};n.stackedReferences.forEach((function(t){l[t.PID]=e.clone(t)})),n.stackedInstances.forEach((function(t){d[t.PID]=e.clone(t)})),n.stackedConnections.forEach((function(t){u[t.PID]=e.clone(t)})),c=o.splitIntoChunks(t,s).map((function(e){return new Promise((function(t,n){var i={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}};e.forEach((function(e){Object.prototype.hasOwnProperty.call(l,e)?i.stackedReferences.push(l[e]):Object.prototype.hasOwnProperty.call(d,e)&&i.stackedInstances.push(d[e])})),r.onFailure=function(){n("Navigate Failure")},o._navigateNodes(e,i,(function(e){t({linkedRefIds:e,stackedObjects:i})}),r)}))})),Promise.all(c).then((function(t){var s,o=[],r={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}};t.forEach((function(t){o=o.concat(t.linkedRefIds),r.stackedReferences=r.stackedReferences.concat(t.stackedObjects.stackedReferences),r.stackedInstances=r.stackedInstances.concat(t.stackedObjects.stackedInstances),r.stackedConnections=r.stackedConnections.concat(t.stackedObjects.stackedConnections),e.merge(r.documentIdMap,t.stackedObjects.documentIdMap)})),s=function(t,n){var i={},s=[];return t.forEach((function(e){i[e.PID]=e})),e.extend(n,i),Object.keys(n).forEach((function(e){s.push(n[e])})),s},n.stackedReferences=s(r.stackedReferences,l),n.stackedInstances=s(r.stackedInstances,d),n.stackedConnections=s(r.stackedConnections,u),e.merge(n.documentIdMap,r.documentIdMap),i(o)})).catch((function(e){"string"==typeof e&&a(e),a("Navigate Error")}))}))},navigateNodes:function(e,t,n,i){this._getMultipleNavigateOnIndexPromise(e,t,i).then((function(e){n(e)})).catch((function(e){c.error("ERROR: "+e)}))},_navigateNodes:function(t,n,i,s){var o=[],r=this;s=s||{},t.length>0?r.navigateOnIndex(t,(function(t){e.is(t)&&e.is(t.result,"array")&&r.onNavigatedNodes(t,o,n,!0),i(o)}),e.extend(s,{context:this})):i(o)},navigateInverseNodes:function(t,n,i,s){var o=[],r=this,a={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}};s=s||{},t.length>0?this.navigateInverseOnIndex(t,(function(t){var s={referenceIds:new Set,instanceIds:new Set},c={referenceConnectionsMap:{},instanceConnectionsMap:{}},l=new Set;e.is(t)&&e.is(t.result,"array")&&this.onNavigatedNodesV2(t,o,s,c,n,!1),this._getStackedConnectionsFromMap(c.referenceConnectionsMap).forEach((function(e){"DELAsmProcessCanUseCnx"===e.type&&l.add(e.PID)})),this.navigateNodes(Array.from(l),a,(function(e){a.stackedConnections.forEach((function(e){r._addConnectionToMap(e.to,e,c.referenceConnectionsMap)})),e.forEach((function(e){s.referenceIds.add(e)})),i(s,c)}))}),e.extend(s,{context:this})):i(o)},onNavigatedNodes:function(t,n,i,r){var a=t.result,c=this,d=function(t,r,a,d,u){var p,f,h,m,y=a.physicalid;u=u||{},s.isEntityConnection(r.type)&&(s.isEntityReference(a.type)||s.isEntityInstance(a.type)||"SecondaryCandidateResourceLink"===r.type&&s.isEntityConnection(a.type))&&("Document"===a.type&&i.documentIdMap?(i.documentIdMap[t]instanceof Array||(i.documentIdMap[t]=[]),i.documentIdMap[t].push(y)):(r=e.merge(o.translatePredicateToAttribute(r,{type:"entity"}),o.translatePredicateToAttribute(r,{type:"relation"})),d?(r.from=t,r.to=y):(r.from=y,r.to=t),"ProductImplementLinkOcc"===r.type?u.occurencePath&&(d?r.to=u.occurencePath:r.from=u.occurencePath,r.PID="ProductImplementLinkOcc|"+t+"|"+e.Json.encode(u.occurencePath)):"ProcessImplementLinkOcc"===r.type?(e.is(u.owner)&&e.is(u.owner.pathsr)&&(f=c.getPathsFromSR(u.owner.pathsr),e.is(f)&&e.is(f.from)&&(t=p=f.from),e.is(f)&&e.is(f.to)&&(h=f.to)),u.occurencePath&&(d?(r.to=u.occurencePath,e.is(p)&&(r.from=p)):(r.from=u.occurencePath,e.is(h)&&(r.to=h))),r.V_usage=l(r.V_usage)):"DELLmiTimeConstraintCnx"===r.type?e.is(u.owner)&&e.is(u.owner.pathsr)&&(f=c.getPathsFromSR(u.owner.pathsr),e.is(f)&&e.is(f.from)&&(p=f.from),e.is(f)&&e.is(f.to)&&(h=f.to),d?(r.from=p,r.to=h):(r.to=p,r.from=h)):"CapableResourcesStructureLink"!==r.type&&"SystemImplementLink"!==r.type&&"PartialProductImplementLink"!==r.type&&"ProductImplementLink"!==r.type&&"ProcessImplementLink"!==r.type&&"PartialProcessImplementLink"!==r.type||(r.PID=r.type+"|"+r.from+"|"+r.to),i.stackedConnections.push(r),s.isEntityReference(a.type)&&-1===n.indexOf(y)?n.push(y):s.isEntityInstance(a.type)&&!c.collectionUtils.isInstance(y)&&Object.prototype.hasOwnProperty.call(a,"from.physicalid")&&(m=a["from.physicalid"],e.is(m)&&-1===n.indexOf(m)&&n.push(m))))};a.forEach((function(t){var o,a,l,u,p,f,h,m,y,g=t.outputs,I=t.input_object.physicalid;for(m=0,y=i.stackedReferences.length;m<y;m++)if((f=i.stackedReferences[m]).PID===I){r?(f.queriedForConnections=!0,f.queriedForDocuments=!0):f.inverseConnectionsFetched=!0;break}for(m=0,y=i.stackedInstances.length;m<y;m++)if((h=i.stackedInstances[m]).PID===I){r?h.queriedForConnections=!0:h.inverseConnectionsFetched=!0;break}for(o in g)Object.prototype.hasOwnProperty.call(g,o)&&(a=g[o],p=-1===o.indexOf("Inverse"),-1!==o.indexOf("_pathSR")?a.forEach((function(t){var r,a;t&&-1!==o.indexOf("capableResourcesStructure")?(u={type:"CapableResourcesStructureLink"},l=t.elements?t.elements[0]:t,d(I,u,l,p)):e.is(t)&&o.includes("partialScope")?d(I,u={type:"PartialProductImplementLink"},l=t,p):t&&-1!==o.indexOf("HeaderOperationPartialScope")?(u={type:"PartialProcessImplementLink"},l=t.elements?t.elements[0]:t,d(I,u,l,p)):t&&t.elements&&(-1!==o.indexOf("productMbomImplement")?(r=t.elements.map((function(e){return e.physicalid})),a=t.elements[t.elements.length-1],d(I,u={type:"ProductImplementLinkOcc"},a,p,{occurencePath:r})):-1!==o.indexOf("operationProcessImplement")?(r=t.elements.map((function(e){return e.physicalid})),a=t.elements[t.elements.length-1],(u=t.owner).type="ProcessImplementLinkOcc",d(I,u,a,p,{occurencePath:r,owner:t.owner})):-1!==o.indexOf("productFlow")?(r=t.elements.map((function(e){return e.physicalid})),a=t.elements[t.elements.length-1],u=t.owner,d(I,u,a,p,{occurencePath:r,owner:t.owner})):-1!==o.indexOf("Material")?(l=null,t.elements.reverse().some((function(e){var t=!1;return s.isEntityInstance(e.type)&&(l=e,t=!0),t})),e.is(l)&&(u=t.owner,d(I,u,l,p))):(l=t.elements[0],u=t.owner,d(I,u,l,p),"DELAsmProcessCanUseCnx"===l.type&&(u=c.parsePrimaryLinkFromLinkedObj(l,i),n.push(u.from),n.push(u.to))))})):-1!==o.indexOf("_relation")&&a.forEach((function(e){var t,n;-1!==o.indexOf("alternate")?(u=e,l=p?e.to:e.from,delete e["from.physicalid"],delete e["to.physicalid"],d(I,u,l,p)):-1!==o.indexOf("mbomSystemOutput")&&(t=o.split("_relation")[0],n=g[t+"_pathSR"],l=e.from,n&&(n.forEach((function(t){t&&t.elements&&t.elements[0].physicalid===e.to.physicalid&&(u=t.owner)})),u&&d(I,u,l,p)))})))}))},onNavigatedNodesV2:function(t,n,i,r,a,c){var d=t.result,u=this,p=function(t,c,d,p,f){var h,m,y,g,I=d.physicalid;f=f||{},s.isEntityConnection(c.type)&&(s.isEntityReference(d.type)||s.isEntityInstance(d.type)||"SecondaryCandidateResourceLink"===c.type&&s.isEntityConnection(d.type))&&("Document"===d.type&&a.documentIdMap?(a.documentIdMap[t]instanceof Array||(a.documentIdMap[t]=[]),a.documentIdMap[t].push(I)):(c=e.merge(o.translatePredicateToAttribute(c,{type:"entity"}),o.translatePredicateToAttribute(c,{type:"relation"})),p?(c.from=t,c.to=I):(c.from=I,c.to=t),"ProductImplementLinkOcc"===c.type?f.occurencePath&&(p?c.to=f.occurencePath:c.from=f.occurencePath,c.PID="ProductImplementLinkOcc|"+t+"|"+e.Json.encode(f.occurencePath)):"DELIsSerializedFromOp"===c.type?c.PID="DELIsSerializedFromOp|"+t+"|"+e.Json.encode([c.to]):"ProcessImplementLinkOcc"===c.type?(e.is(f.owner)&&e.is(f.owner.pathsr)&&(m=u.getPathsFromSR(f.owner.pathsr),e.is(m)&&e.is(m.from)&&(t=h=m.from),e.is(m)&&e.is(m.to)&&(y=m.to)),f.occurencePath&&(p?(c.to=f.occurencePath,e.is(h)&&(c.from=h)):(c.from=f.occurencePath,e.is(y)&&(c.to=y))),c.V_usage=l(c.V_usage)):"DELLmiTimeConstraintCnx"===c.type?e.is(f.owner)&&e.is(f.owner.pathsr)&&(m=u.getPathsFromSR(f.owner.pathsr),e.is(m)&&e.is(m.from)&&(h=m.from),e.is(m)&&e.is(m.to)&&(y=m.to),p?(c.from=h,c.to=y):(c.to=h,c.from=y)):"CapableResourcesStructureLink"!==c.type&&"SystemImplementLink"!==c.type&&"PartialProductImplementLink"!==c.type&&"ProductImplementLink"!==c.type&&"ProcessImplementLink"!==c.type&&"PartialProcessImplementLink"!==c.type&&"AssetContextLink"!==c.type&&"DELIsGeneratedFromProcessFilteredBy"!==c.type||(c.PID=c.type+"|"+c.from+"|"+c.to),a.stackedConnections.push(c),"SecondaryCandidateResourceLink"===c.type?u._addConnectionToMap(c.to,c,r.referenceConnectionsMap):s.isEntityReference(d.type)?(u._addConnectionToMap(c.to,c,r.referenceConnectionsMap),n.push(I),i.referenceIds.add(I)):s.isEntityInstance(d.type)&&(u._addConnectionToMap(c.to,c,r.instanceConnectionsMap),i.instanceIds.add(I),!u.collectionUtils.isInstance(I)&&Object.prototype.hasOwnProperty.call(d,"from.physicalid")&&(g=d["from.physicalid"],e.is(g)&&-1===n.indexOf(g)&&n.push(g)))))};d.forEach((function(t){var n,o,l,d,f,h,m,y,g,I=t.outputs,P=t.input_object.physicalid;for(y=0,g=a.stackedReferences.length;y<g;y++)if((h=a.stackedReferences[y]).PID===P){c?(h.queriedForConnections=!0,h.queriedForDocuments=!0):h.inverseConnectionsFetched=!0;break}for(y=0,g=a.stackedInstances.length;y<g;y++)if((m=a.stackedInstances[y]).PID===P){c?m.queriedForConnections=!0:m.inverseConnectionsFetched=!0;break}for(n in I)Object.prototype.hasOwnProperty.call(I,n)&&(o=I[n],f=-1===n.indexOf("Inverse"),-1!==n.indexOf("_pathSR")?o.forEach((function(t){var o,c;if(t&&-1!==n.indexOf("capableResourcesStructure"))p(P,d={type:"CapableResourcesStructureLink"},l=t,f);else if(t&&"build_pathSR"===n)l=t.elements[t.elements.length-1],p(P,d={type:"DELIsGeneratedFromProcessFilteredBy",isRefRef:!0},l,f);else if(t&&"serializedFrom_pathSR"===n)d=t,l=t.to,p(P,d,l,f);else if(t&&"opserializedFrom_pathSR"===n){P=t.owner.physicalid,(l=t.elements[t.elements.length-1]).type="DELLmiExecHeaderOperationInstance";var d={};d.physicalid=t.elements[t.elements.length-1].physicalid,d.type="DELIsSerializedFromOp",p(P,d,l,f)}else t&&-1!==n.indexOf("assetContext")?(l=t.elements[t.elements.length-1],p(P,d={type:"AssetContextLink",isRefRef:!0},l,f)):t&&-1!==n.indexOf("assignedWorkCenter")?(l=t.elements[t.elements.length-1],(d=t.owner).type="AssignedWorkCenterLink",p(P,d,l,f)):t&&-1!==n.indexOf("productionplan")?(f=!1,(d=t).type="ProductionPlanLink",l=t.from,p(P,d,l,f)):e.is(t)&&n.includes("partialScope")?p(P,d={type:"PartialProductImplementLink"},l=t,f):t&&-1!==n.indexOf("HeaderOperationPartialScope")?p(P,d={type:"PartialProcessImplementLink"},l=t,f):t&&t.elements&&(-1!==n.indexOf("productMbomImplement")?(o=t.elements.map((function(e){return e.physicalid})),c=t.elements[t.elements.length-1],p(P,d={type:"ProductImplementLinkOcc"},c,f,{occurencePath:o})):-1!==n.indexOf("operationProcessImplement")?(o=t.elements.map((function(e){return e.physicalid})),c=t.elements[t.elements.length-1],(d=t.owner).type="ProcessImplementLinkOcc",p(P,d,c,f,{occurencePath:o,owner:t.owner})):-1!==n.indexOf("productFlow")?(o=t.elements.map((function(e){return e.physicalid})),c=t.elements[t.elements.length-1],d=t.owner,p(P,d,c,f,{occurencePath:o,owner:t.owner})):-1!==n.indexOf("Material")?(l=null,t.elements.reverse().some((function(e){var t=!1;return s.isEntityInstance(e.type)&&(l=e,t=!0),t})),e.is(l)&&(d=t.owner,p(P,d,l,f))):(l=t.elements[0],d=t.owner,p(P,d,l,f),"DELAsmProcessCanUseCnx"===l.type&&(d=u.parsePrimaryLinkFromLinkedObj(l,a),u._addConnectionToMap(d.to,d,r.referenceConnectionsMap),i.referenceIds.add(d.from),i.referenceIds.add(d.to))))})):-1!==n.indexOf("_relation")&&o.forEach((function(e){var t,i;-1!==n.indexOf("alternate")?(d=e,l=f?e.to:e.from,delete e["from.physicalid"],delete e["to.physicalid"],p(P,d,l,f)):-1!==n.indexOf("mbomSystemOutput")&&(t=n.split("_relation")[0],i=I[t+"_pathSR"],l=e.from,i&&(i.forEach((function(t){t&&t.elements&&t.elements[0].physicalid===e.to.physicalid&&(d=t.owner)})),d&&p(P,d,l,f)))})))}))},parsePrimaryLinkFromLinkedObj:function(t,n){var i,s,r;return i={type:{name:"type",value:t.type},pathsr:{name:"pathsr",value:t.pathsr}},s=this.pathSRParser.parse(i,{type:i.type.value,isRefRef:!0}),(r=e.merge(o.translatePredicateToAttribute(t,{type:"entity"}),o.translatePredicateToAttribute(t,{type:"relation"}))).from=s.from,r.to=s.to,e.is(n)&&e.is(n.stackedConnections,"array")&&n.stackedConnections.push(r),r},expandOnIndex:function(t,n,s){var r,c,l,d,u,p=i.get3DSpaceUrl()+"cvservlet/expand",f=this.getSelectPredicate("entity"),h=this.getSelectPredicate("relation"),m=this.getSelectUnit(f),y=this._selectFacet,g=this._computeBo,I=["union","intersection","minus"];if(s=s||{},e.is(s.selectBo,"array")&&(f=s.selectBo),e.is(s.selectRel,"array")&&(h=s.selectRel),e.is(s.selectFacets,"array")&&(y=s.selectFacets),e.is(s.computeBo,"array")&&(g=s.computeBo),e.is(s.filterQuery,"object")&&(r=s.filterQuery),c={label:a.getCVServletLabel(),select_bo:f,select_rel:h,select_ds6w_facet:y,compute_select_bo:g,locale:widget.locale,lang:widget.lang,select_unit:m},l=["MfgProcessAlternate","Alternate"],e.is(r)){for(d in e.merge(c,r),r)if(Object.prototype.hasOwnProperty.call(r,d)&&-1!==I.indexOf(d)&&(u=r[d].expand,e.is(u,"array"))){u.forEach((function(e){e.no_type_filter_rel=l}));break}p=i.get3DSpaceUrl()+"cvservlet/multiexpand"}else t instanceof Array?c.multi_root_physicalid=t:c.root_physicalid=t,e.is(s.expandIter,"string")&&(c.expand_iter=s.expandIter),c.no_type_filter_rel=l;c=e.Json.encode(c),i.webServiceRequest({url:p,method:"POST",headers:i.getHeaders({isJsonOnly:!0}),data:c,onComplete:function(e){var t;n instanceof Function&&(t=o.parseNavigateResult(e),n.call(s.context,t))},onFailure:function(e){s.onFailure instanceof Function&&s.onFailure.call(s.context,e)}})},progressiveExpandOnIndex:function(t,n,s){var r,c=i.get3DSpaceUrl()+"cvservlet/progressiveexpand/v2?output_format=cvjson",l=this.getSelectPredicate("entity"),d=this.getSelectPredicate("relation");this.getSelectUnit(l),this._selectFacet,this._computeBo;s=s||{},e.is(s.selectBo,"array")&&(l=s.selectBo),e.is(s.selectRel,"array")&&(d=s.selectRel),l.push("pathsr"),d.push("pathsr"),d.push("interfaceforkind");var u={};e.is(s.filterQuery,"object")?(r=s.filterQuery).outputs={hits:{predefined_computation:["icons"]},format:"entity_relation_occurrence",select_object:l,select_relation:d}:(u={all:1},r={batch:{expands:[{graph:{descending_condition_relation:{uql:'(flattenedtaxonomies:"reltypes/PLMInstance")'}},label:a.getCVServletLabel(),root:{physical_id:t[0]},filter:u,aggregation_processors:[{truncate:{max_distance_from_prefix:1e5,prefix_filter:{prefix_path:[{physical_id_path:t}]}}}]}]},outputs:{hits:{predefined_computation:["icons"]},format:"entity_relation_occurrence",select_object:l,select_relation:d}}),r=e.Json.encode(r),i.webServiceRequest({url:c,method:"POST",headers:i.getHeaders({isJsonOnly:!0}),data:r,onComplete:function(e){var t;n instanceof Function&&(t=o.parseProgressiveExpandNavigateResult(e),n.call(s.context,t))},onFailure:function(e){s.onFailure instanceof Function&&s.onFailure.call(s.context,e)}})},expandOnIndexV2:function(t,n,s){var r,c,l,d,u,p,f=i.get3DSpaceUrl()+"cvservlet/expand",h=this.getSelectPredicate("entity"),m=this.getSelectPredicate("relation"),y=this.getSelectUnit(h,{type:"entity"}),g=this.getSelectUnit(m,{type:"relation"}),I=this._selectFacet,P=this._computeBo,v=["union","intersection","minus"];if(y=e.merge(y,g),s=s||{},e.is(s.selectBo,"array")&&(h=s.selectBo),e.is(s.selectRel,"array")&&(m=s.selectRel),e.is(s.selectFacets,"array")&&(I=s.selectFacets),e.is(s.computeBo,"array")&&(P=s.computeBo),e.is(s.filterQuery,"object")&&(r=s.filterQuery),h.push("pathsr"),m.push("pathsr"),m.push("interfaceforkind"),c={label:a.getCVServletLabel(),select_bo:h,select_rel:m,select_ds6w_facet:I,compute_select_bo:P,locale:widget.locale,lang:widget.lang,select_unit:y},l=[],e.is(s.excludeRelationTypes,"array")?s.excludeRelationTypes.forEach((function(e){l.push(e)})):s.excludeRelationTypes=d,d=["VPMCfgEffectivity"],e.is(s.excludeBOTypes,"array")?d.forEach((function(e){-1===s.excludeBOTypes.indexOf(e)&&s.excludeBOTypes.push(e)})):s.excludeBOTypes=d,e.is(r)){for(u in e.merge(c,r),r)if(Object.prototype.hasOwnProperty.call(r,u)&&-1!==v.indexOf(u)&&(p=r[u].expand,Array.isArray(p))){p.forEach((function(t){t.no_type_filter_rel=l,e.is(s.excludeBOTypes,"array")&&(t.no_type_filter_bo=s.excludeBOTypes)}));break}f=i.get3DSpaceUrl()+"cvservlet/multiexpand"}else t instanceof Array?c.multi_root_physicalid=t:c.root_physicalid=t,e.is(s.expandIter,"string")&&(c.expand_iter=s.expandIter),e.is(s.excludeBOTypes,"array")&&(c.no_type_filter_bo=s.excludeBOTypes),c.no_type_filter_rel=l;c=e.Json.encode(c),i.webServiceRequest({url:f,method:"POST",headers:i.getHeaders({isJsonOnly:!0}),data:c,onComplete:function(e){var t;n instanceof Function&&(t=o.parseNavigateResult(e),n.call(s.context,t))},onFailure:function(e){s.onFailure instanceof Function&&s.onFailure.call(s.context,e)}})},expandNodes:function(t,n,i,s){var o,r,l,d,u=this,p=[];s=s||{},o=e.is(s.context)?s.context:this,r=isNaN(s.expandLevel)?a.getPrefExpandLevel():s.expandLevel,l=e.is(s.filterQuery)?s.filterQuery:null,d=function(t){e.is(t,"array")?u.onExpandedNodes(t,p,n,r,l):c.debug("ERROR in expand result"),i.call(o,p)},t.length>0?u.progressiveExpandOnIndex(t,d,e.extend(s,{context:u,expandIter:r.toString()})):i.call(o,p)},onExpandedNodes:function(t,n,i,r,a,c){var l,d=this;isNaN(c)&&(c=0),(-1===r||c<=r)&&Array.isArray(t)&&t.forEach((function(t){var u,p=o.translatePredicateToAttribute(t,{type:"entity",fromExpandService:!0});(-1===r||c<r)&&(e.is(a)||(p.queriedForChildren=!0)),n.push(p.PID),i.stackedReferences.push(p),t.getChildren().forEach((function(t){(l=t.getChildren().filter((function(e){return s.isEntityReference(e.type.value)&&"MfgProcessAlternate"!==t.type.value}))).length>0&&(u=o.translatePredicateToAttribute(t,{type:"relation",fromExpandService:!0}),e.is(a)&&(u.filterQuery=a),n.push(u.PID),i.stackedInstances.push(u),d.onExpandedNodes(l,n,i,r,a,c+1))}))}))},expandPromise:function(t,n,i){var s=this,o=i||{};return new Promise((function(i,r){var l,d,u,p=!1,f={referenceIds:new Set,instanceIds:new Set},h={referenceConnectionsMap:{},instanceConnectionsMap:{}};l=isNaN(o.expandLevel)?a.getPrefExpandLevel():o.expandLevel,d=e.is(o.filterQuery)?o.filterQuery:null,u=function(t){var o=function(t,n){var i,s,o;if(n.size>0)for(s=0,o=t.length;s<o;s++)i=t[s].PID,e.is(i)&&n.has(i)&&n.delete(i)};e.is(t,"array")?(Object.prototype.hasOwnProperty.call(n,"ioPortToPlmPortMap")||(n.ioPortToPlmPortMap=new Map),s.onExpandedNodesV2Recursive(t,f,h,n,l,d,p),e.is(n.deferredConnections)&&(n.deferredConnections.forEach((function(t){var i=n.ioPortToPlmPortMap.get(t.idToResolve);e.is(i)&&(t.from=i["from.physicalid"].value,delete t.idToResolve,s._addConnectionToMap(t.to,t,h.referenceConnectionsMap),f.referenceIds.add(t.to))})),delete n.deferredConnections),n.ioPortToPlmPortMap.clear(),delete n.ioPortToPlmPortMap,o(n.stackedReferences,f.referenceIds),o(n.stackedInstances,f.instanceIds),i({linkedObjIds:f,stackedObjects:n,connectionsMap:h})):(c.debug("ERROR in expand result"),r("ERROR in expand result"))},t.length>0?(l>-1&&(p=!0,l+=1),s.progressiveExpandOnIndex(t,u,e.extend(o,{context:s,expandIter:l.toString()}))):i({linkedObjIds:f,stackedObjects:n})}))},_addConnectedObjIdsToLinkedObj:function(e,t){Array.isArray(e)?e.forEach((function(e){t.add(e)})):t.add(e)},_addConnectionToMap:function(e,t,n){var i,s;s=n[i=Array.isArray(e)?e.toString():e],Array.isArray(s)?s.some((function(e){return e.PID===t.PID}))||(n[i]=s.concat(t)):n[i]=[t]},onExpandedNodesV2Recursive:function(t,n,i,r,a,c,d,u){var p,f,h,m,y=this;isNaN(u)&&(u=0),d&&u===a||(h=d&&u===a-1||u===a,f=p=d&&u>=a-1,(-1===a||u<=a)&&Array.isArray(t)&&t.forEach((function(t){var g,I;if(e.is(t.pathsr)){["CapableResourcesStructureLink","PartialProductImplementLink","PartialProcessImplementLink"].forEach((function(s){const o=y.pathSRParser.parse(t,{isRefRef:!0,type:s});e.is(o)&&(y._addConnectedObjIdsToLinkedObj(o.to,n.referenceIds),y._addConnectionToMap(o.to,o,i.referenceConnectionsMap))}))}g=o.translatePredicateToAttribute(t,{type:"entity",fromExpandService:!0}),-1!==a&&h||e.is(c)||(g.queriedForChildren=!0),g.directConnectionsFetched=!0,g.queriedForDocuments=!0,r.stackedReferences.push(g),t.getChildren().forEach((function(h){var g,P,v,O=[],R=[];if("MfgProcessAlternate"===h.type.value)v=o.translatePredicateToAttribute(h,{type:"entity",fromExpandService:!0}),(v=e.merge(v,o.translatePredicateToAttribute(h,{type:"relation",fromExpandService:!0}))).from=h["from.physicalid"].value,v.to=h["to.physicalid"].value,y._addConnectedObjIdsToLinkedObj(v.to,n.referenceIds),y._addConnectionToMap(v.to,v,i.referenceConnectionsMap);else if(s.isEntityConnection(h.type.value))R.push(h),"DELLmiExecTimeConstraintRelation"===h.type.value&&y.collectionUtils.addExecTimeConstraintRelation(h);else if("SpecificationDocument"===h.type.value||"Reference Document"===h.type.value){const e=h["to.physicalid"].value,t=h["from.physicalid"].value;r.documentIdMap[t]instanceof Array||(r.documentIdMap[t]=[]),r.documentIdMap[t].push({PID:e,type:h.type.value}),m=!0}h.getChildren().forEach((function(e){s.isEntityReference(e.type.value)?"MfgProcessAlternate"!==h.type.value&&"SpecificationDocument"!==h.type.value&&"Reference Document"!==h.type.value&&O.push(e):s.isEntityConnection(e.type.value)?R.push(e):"DELLmiProdSystemIOPort"===e.type.value&&r.ioPortToPlmPortMap.set(e.physicalid.value,h)})),R.forEach((function(s){var a,c,d,u=!1;g=y.pathSRParser.parse(s,{type:s.type.value,isRefRef:!0,referenceEntity:t,ioPortToPlmPortMap:r.ioPortToPlmPortMap}),e.is(g)&&(!f||g.isRefRef)&&(a=o.translatePredicateToAttribute(s,{type:"entity",fromExpandService:!0}),a=e.merge(a,o.translatePredicateToAttribute(a,{type:"relation"})),e.is(g.type)&&(a.type=g.type),e.is(g.PID)&&(a.PID=g.PID),e.is(g.from)&&(a.from=g.from),e.is(g.to)&&(a.to=g.to),"PLMDocConnection"===g.type?(c=a.to,d=a.from,r.documentIdMap[d]instanceof Array||(r.documentIdMap[d]=[]),r.documentIdMap[d].push({PID:c,type:"PLMDocConnection"}),m=!0):"ProcessImplementLinkOcc"===g.type?a.V_usage=l(a.V_usage):"DELLmiTimeConstraintCnx"===g.type&&(a.flowType=g.flowType||""),e.is(g.deferResolution,"boolean")&&g.deferResolution&&(u=!0,a.idToResolve=g.idToResolve,Object.prototype.hasOwnProperty.call(r,"deferredConnections")||(r.deferredConnections=[]),r.deferredConnections.push(a)),m||u||(g.isRefRef?(y._addConnectedObjIdsToLinkedObj(a.to,n.referenceIds),y._addConnectionToMap(a.to,a,i.referenceConnectionsMap)):(y._addConnectedObjIdsToLinkedObj(a.to,n.instanceIds),y._addConnectionToMap(a.to,a,i.instanceConnectionsMap))))})),O.length>0&&(s.isEntityConnection(h.type.value)||(p||(e.is(h.pathsr)&&(P=y.pathSRParser.parse(h,{isRefRef:!1}),e.is(P)&&(y._addConnectedObjIdsToLinkedObj(P.to,n.instanceIds),y._addConnectionToMap(P.to,P,i.instanceConnectionsMap))),I=o.translatePredicateToAttribute(h,{type:"relation",fromExpandService:!0}),e.is(c)&&(I.filterQuery=c),I.directConnectionsFetched=!0,r.stackedInstances.push(I)),y.onExpandedNodesV2Recursive(O,n,i,r,a,c,d,u+1)))}))})))},findMissingLinkedObjects:function(t,n){var i,s=this,o={referencesPID:[t],instancesPID:[]},r={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}};s.collectionUtils.expandOnBackbone(t,o),o.referencesPID.forEach((function(t){var n,i=s.collectionUtils.getReferenceFromCollection(t);e.is(i)&&(n=i.pick("PID"),r.stackedReferences.push(n))})),o.instancesPID.forEach((function(t){var n,i=s.collectionUtils.getInstanceFromCollection(t);e.is(i)&&(n=i.pick("PID"),r.stackedInstances.push(n))})),i=s.collectionUtils._removeDuplicate(o.referencesPID.slice().concat(o.instancesPID.slice())),s.navigateNodes(i,r,(function(e){s.expandNodes(e,r,(function(){s._addToCollections(r,n)}),n)}))},getDescendants:function(e,t){var n=this,i={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}};t=t||{},e instanceof Array||(e=[e]),this.expandNodes(e,i,(function(e){n.navigateNodes(e,i,(function(e){n.expandNodes(e,i,(function(){n._addToCollections(i,t)}),t)}),t)}),t)},getDescendantsV2:function(t,n){var i,s,o,r,a,l=this,d=n||{},u=e.is(d.callback,"function")?d.callback:null;t instanceof Array||(t=[t]),i={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},l.expandPromise(t,i,d).then((function(e){var t;o=e.connectionsMap.instanceConnectionsMap,s=e.connectionsMap.referenceConnectionsMap,r=l._addToCollectionPromise(e.stackedObjects,null,d);var n=[];return e.stackedObjects.stackedReferences.forEach((function(e){n.push(e.PID)})),l.getInverseConnections(n,{onComplete:function(e){},onFailure:function(e){}}),t={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},l._fetchConnectedInstancesPromise(e.linkedObjIds,o,t)})).then((function(e){a=r.then((function(t){return e.stackedObjects.stackedConnections=l._getStackedConnectionsFromMap(o),l._addToCollectionPromise(e.stackedObjects,t,d)}));var t=[];e.stackedObjects.stackedInstances.forEach((function(e){t.push(e.PID)})),l.getInverseConnections(t,{onComplete:function(e){},onFailure:function(e){}});var n={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}};return l._fetchConnectedReferencesPromise(e.referenceIds,s,n)})).then((function(e){e.stackedReferences.forEach((function(e){l.collectionUtils.addRef(e,{silent:!1})})),a.then((function(t){return e.stackedConnections=l._getStackedConnectionsFromMap(s),l._addToCollectionPromise(e,t,d)})).then((function(e){u.call(d.context,e)}))})).catch((function(e){c.debug("getDescendants:- failed : "+e)}))},_fetchConnectedInstancesPromise:function(t,n,i){var s=this,o=t.referenceIds;return new Promise((function(r,a){var c=[];t.instanceIds.forEach((function(e){c.push(e)})),c.length>0?s.fetchMultipleOnIndexPromise(c,{type:"relation",silent:!0,withSynthesisAttribute:!1,chunkSize:s.FETCH_CHUNK_SIZE}).then((function(s){var a,l,d,u=null;for(c.length!==s.length&&(u=new Set(t.instanceIds)),a=0,l=s.length;a<l;a++)d=s[a].attributes,i.stackedInstances.push(d),d.isInstanceOf&&o.add(d.isInstanceOf),null!==u&&u.delete(d.PID);e.is(u)&&u.size>0&&u.forEach((function(e){Object.keys(n).forEach((function(t){t.indexOf(e)>-1&&delete n[t]}))})),r({referenceIds:o,stackedObjects:i})})).catch((function(){a()})):r({referenceIds:o,stackedObjects:i})}))},_fetchConnectedReferencesPromise:function(t,n,i){var s=this;return new Promise((function(o,r){var a=[];t.forEach((function(e){a.push(e)})),a.length>0?s.fetchMultipleOnIndexPromise(a,{type:"entity",silent:!0,withSynthesisAttribute:!1,chunkSize:s.FETCH_CHUNK_SIZE}).then((function(s){var r,c,l,d=null;for(a.length!==s.length&&(d=new Set(t)),r=0,c=s.length;r<c;r++)l=s[r].attributes,i.stackedReferences.push(l),null!==d&&d.delete(l.PID);e.is(d)&&d.size>0&&d.forEach((function(e){delete n[e]})),o(i)})).catch((function(){r()})):o(i)}))},_getStackedConnectionsFromMap:function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n=n.concat(e[t]));return n},_mergeCallbackResult:function(t,n){var i,s={};for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Array.isArray(t[i])?s[i]=t[i].concat(n[i]):e.is(t[i],"object")&&(s[i]={},e.merge(s[i],t[i]),e.merge(s[i],n[i])));return s},_addToCollectionPromise:function(t,n,i){var s=this;return new Promise((function(o){i.callback=function(t){var i;i=e.is(n)?s._mergeCallbackResult(n,t):t,o(i)},s._addToCollections(t,i)}))},fetchMultipleOnIndexPromise:function(t,n){var i=this,s=n||{},o=e.is(s.type)?s.type:"entity",r=!e.is(s.silent,"boolean")||s.silent,a=e.is(s.chunkSize)?s.chunkSize:i.FETCH_CHUNK_SIZE,c=!e.is(s.withSynthesisAttribute,"boolean")||s.withSynthesisAttribute,l=e.is(s.select_predicate)?s.select_predicate:null;return new Promise((function(e,n){var s;s=i.splitIntoChunks(t,a).map((function(e){return new Promise((function(t,n){i.fetchOnIndex(e,{type:o,withSynthesisAttribute:c,select_predicate:l,silent:r,onComplete:function(e){var n=Array.isArray(e)?e:[e];t(n)},onFailure:function(){n()},context:i})}))})),Promise.all(s).then((function(t){var n;n=t.reduce((function(e,t){return e.concat(t)}),[]),e(n)})).catch((function(){n()}))}))},findMissingObj:function(t,n){var i=t.get("from"),s=t.get("to"),o=t.get("type"),r=!0,a=this,c=function(t,i){e.is(t,"array")?t.forEach((function(t){e.is(t,"string")&&!a.collectionUtils.isInstance(t)&&n.missingInstanceObjects.push(t)})):e.is(t,"string")&&(i?a.collectionUtils.isReference(t)||n.missingReferenceObjects.push(t):a.collectionUtils.isInstance(t)||n.missingInstanceObjects.push(t))};"ProductImplementLinkOcc"!==o&&"DELLmiTimeConstraintCnx"!==o&&"DELLmiMaterialPathCnxCust"!==o||(r=!1),"SecondaryCandidateResourceLink"!==o&&c(i,r),c(s,r)},fetchMissingObjects:function(t,n){var i,s,o,r=n||{},a={stackedReferences:[],stackedInstances:[]},l=this,d=parseInt(widget.getValue("navigateFetchSplitSize"));o=function(t,n){var i=function(t){var n=e.is(t.attributes)?t.attributes:t;e.is(t.ds6w)&&(n.ds6w=t.ds6w),a.stackedReferences.push(n)};e.is(n)&&(e.is(n,"array")?n.forEach(i):i(n)),t(a)},s=function(){return new Promise((function(e){t.missingReferenceObjects.length>0?(t.missingReferenceObjects=l.collectionUtils._removeDuplicate(t.missingReferenceObjects),l.fetchMultipleOnIndexPromise(t.missingReferenceObjects,{chunkSize:d}).then((function(t){o(e,t)}))):o(e)}))},i=function(n,i){var s=function(n){var i=e.is(n.attributes)?n.attributes:n;e.is(n.ds6w)&&(i.ds6w=n.ds6w),a.stackedInstances.push(i),e.is(i.isInstanceOf,"string")&&""!==i.isInstanceOf&&(l.collectionUtils.isReference(i.isInstanceOf)||t.missingReferenceObjects.push(i.isInstanceOf))};e.is(i)&&(e.is(i,"array")?i.forEach(s):s(i)),n()},function(){return new Promise((function(e){t.missingInstanceObjects.length>0?(t.missingInstanceObjects=l.collectionUtils._removeDuplicate(t.missingInstanceObjects),l.fetchMultipleOnIndexPromise(t.missingInstanceObjects,{type:"relation",chunkSize:d}).then((function(t){i(e,t)}))):i(e)}))}().then(s).then((function(e){l._addToCollections(e,r)})).catch((function(e){c.error("NavigateOnIndex.fetchMissingObjects : FAILURE in bring back missing objects "+e)}))},getConnectionsByModel:function(t,n,i,s,o){var r=this,a=[],c=[],l=e.is(t)?t.get("PID"):null,d=e.is(n)?n.get("PID"):null,u={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},p={documentIdMap:u.documentIdMap},f=function(){var t=[],n={missingInstanceObjects:[],missingReferenceObjects:[]},a={callback:function(){e.is(o,"function")&&o(t)}};t=r.collectionUtils.getImpactedConnections(l,d,{relationTypes:i,isRefRefOnly:s}),e.is(t,"array")&&t.forEach((function(e){r.findMissingObj(e,n)})),r.fetchMissingObjects(n,a)},h=function(){var i={queriedForConnections:!0},s={callback:function(){e.is(t)&&t.setAdditionalInfo(i),e.is(n)&&n.setAdditionalInfo(i),f()}};r._addToCollections(u,s)};e.is(l)&&r.collectionUtils.needToQueryForConnections(r.collectionUtils.references,t)&&(r.collectionUtils.needToQueryForDirectConnections(r.collectionUtils.references,t)?a.push(l):r.collectionUtils.needToQueryForInverseConnections(r.collectionUtils.references,t)&&c.push(l)),e.is(d)&&r.collectionUtils.needToQueryForConnections(r.collectionUtils.instances,n)&&(r.collectionUtils.needToQueryForDirectConnections(r.collectionUtils.instances,n)?a.push(d):r.collectionUtils.needToQueryForInverseConnections(r.collectionUtils.instances,n)&&c.push(d)),a.length>0&&c.length>0?r.navigateNodes(a.concat(c),u,h,p):a.length>0?r.navigateNodes(a,u,h,p):c.length>0?r.navigateInverseNodes(c,u,h,p):f()},getInverseConnections:function(t,n){var i,s,o=this,r=n||{};i=o.splitIntoChunks(t,1e3).map((function(e){return new Promise((function(t,n){var i={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},s={onFailure:function(e){n(e)}};o.navigateInverseNodes(e,i,(function(n,s){i.stackedConnections=[],e.forEach((function(e){(o.collectionUtils.getInstanceFromCollection(e)||o.collectionUtils.getReferenceFromCollection(e)).setAdditionalInfo({queriedForConnections:!0})})),t({linkedObjIds:n,connectionsMap:s})}),s)}))})),Promise.all(i).then((function(t){return new Promise((function(n){var i={referenceIds:new Set,instanceIds:new Set},s={referenceConnectionsMap:{},instanceConnectionsMap:{}};t.forEach((function(t){t.linkedObjIds.referenceIds.forEach((function(e){i.referenceIds.add(e)})),t.linkedObjIds.instanceIds.forEach((function(e){i.instanceIds.add(e)})),e.merge(s.referenceConnectionsMap,t.connectionsMap.referenceConnectionsMap),e.merge(s.instanceConnectionsMap,t.connectionsMap.instanceConnectionsMap)})),n({linkedObjIds:i,connectionsMap:s})}))})).catch((function(t){e.is(r.onFailure,"function")&&r.onFailure(t)})).then((function(e){var t,n,i=e.connectionsMap.instanceConnectionsMap,a=e.connectionsMap.referenceConnectionsMap;e.linkedObjIds.referenceIds.size>0||e.linkedObjIds.instanceIds.size>0?(t={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},n={referenceIds:new Set,instanceIds:new Set},e.linkedObjIds.referenceIds.forEach((function(e){o.collectionUtils.isReference(e)||n.referenceIds.add(e)})),e.linkedObjIds.instanceIds.forEach((function(e){o.collectionUtils.isInstance(e)||n.instanceIds.add(e)})),o._fetchConnectedInstancesPromise(n,i,t).then((function(e){var t;return e.stackedObjects.stackedConnections=o._getStackedConnectionsFromMap(i),s=o._addToCollectionPromise(e.stackedObjects,null,r),t={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},o._fetchConnectedReferencesPromise(e.referenceIds,a,t)})).then((function(e){s.then((function(t){return e.stackedConnections=o._getStackedConnectionsFromMap(a),o._addToCollectionPromise(e,t,r)})).then((function(){r.onComplete()}))}))):((t={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}}).stackedConnections=o._getStackedConnectionsFromMap(a),o._addToCollectionPromise(t,null,r).then((function(){r.onComplete(e.stackedConnections)})))})).catch((function(t){e.is(r.onFailure,"function")&&r.onFailure(t)}))},getPathsFromSR:function(t){var n,i,s,o,r=null;return n=t.indexOf(" PS "),n+=4,i=t.indexOf(" PE "),-1===n||-1===i?(c.log("Error parsing fromOcc from attribute pathSR: "+t),null):(s=t.substring(n,i).split(" "),n=t.indexOf(" PS ",n),n+=4,i=t.indexOf(" PE",i+4),-1===n||-1===i?(c.log("Error parsing toOcc from attribute pathSR: "+t),null):(o=t.substring(n,i).split(" "),e.is(s)&&e.is(o)&&(r={from:s,to:o}),r))},_getAltSubContextMfgRelations:function(t){var n=this;return new Promise((function(s,o){var r,c,l,d=i.get3DSpaceUrl()+"cvservlet/navigate?SecurityContext="+i.getSecurityContext(),u=[],p={},f=n.getSelectPredicate("entity").concat(n.getSelectPredicate("relation"));for(r=f.length;r--;)p[l=f[r]]||(u.unshift(l),p[l]=!0);t instanceof Array||(t=[t]),u.push("pathsr"),c={label:a.getCVServletLabel(),input_physical_ids:t,primitives:[{navigate_to_rel:{id:1,filter:{bo_type:["DELFmiProcessOutputPrereqMaterializationCnx"]}},navigate_to_sr:{id:2,filter:{role:["51"],category:["5"]},mode:"path"}}],patterns:{resProd_relation:[{id:1}],productMbomImplement_pathSR:[{id:2}]},attributes:u,fileAttributes:[],version:3},c=e.Json.encode(c),i.webServiceRequest({url:d,method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:c,onComplete:function(e){s(e)},onFailure:function(e,t){o(t)}})}))},_getAltSubContextProducts:function(t){var n,i=this,s=function(e,t){var n,s,o=null;return(n=e.filter((function(e){var t=e["ds6w:kind"];return t.includes("EIN")||t.includes("3D-EIN")})).map((function(e){return e.pathsr}))).length>0&&(s={pathsr:{value:n=n[0]}},o={referenceId:i.pathSRParser.parse(s,{type:"DELFmiProcessOutputPrereqMaterializationCnx",isRefRef:!0,referenceEntity:{physicalid:{value:t}}}).to,instanceId:null}),o},o=function(e){var t,n=null;return(t=e.map((function(e){var t=e.elements;return t[t.length-1]}))).length>0&&(n={referenceId:(t=t[0])["to.physicalid"],instanceId:t.physicalid}),n};return n=t.reduce((function(t,n){var i=n.referenceId,s=n.instanceId;return e.is(i)&&t.push(i),e.is(s)&&t.push(s),t}),[]),new Promise((function(r,a){i._getAltSubContextMfgRelations(n).then((function(n){var i,a,c,l={};i=function(t){var n=t.result,i=new Map,r=new Map;return n.forEach((function(t){var n,a,c,l,d=t.outputs,u=t.input_object.physicalid;for(n in d)Object.prototype.hasOwnProperty.call(d,n)&&(a=d[n],"resProd_relation"===n?(c=s(a,u),e.is(c)&&i.set(u,c)):"productMbomImplement_pathSR"===n&&(l=o(a),e.is(l)&&r.set(u,l)))})),{resultingProductsMap:i,implementedProductsMap:r}}(n),a=i.resultingProductsMap,c=i.implementedProductsMap,t.forEach((function(t){var n=t.referenceId,i=t.instanceId;e.is(n)&&a.has(n)?l[n]=a.get(n):e.is(i)&&c.has(i)&&(l[i]=c.get(i))})),r(l)})).catch((function(e){c.log(e),a(e)}))}))},getMultipleAltSubContextProductsPromise:function(t){var n=this;return new Promise((function(i,s){var o;o=n.splitIntoChunks(t,25).map((function(e){return n._getAltSubContextProducts(e)})),Promise.all(o).then((function(t){var n;n=t.reduce((function(t,n){return e.merge(t,n)}),{}),i(n)})).catch((function(e){s(e)}))}))}})})),define("DS/DELWKONavigationServices/DELWKONavigateOnCloud",["UWA/Core","UWA/Promise","DS/DELPPWNavigationServices_FD02/NavigationBase","DS/DELWKONavigationServices/DELWKONavigateUtil","DS/DELPPWWebServices_FD02/WebserviceUtils","DS/DELPPWModelServices_FD02/ModelUtils","DS/DELWKOIRPCModels/DELWKOProductionPlanReferenceModel","DS/DELWKOIRPCModels/DELWKOWorkOrderReferenceModel","DS/DELWKOIRPCModels/DELWKOExecHeaderOperationReferenceModel","DS/DELWKOIRPCModels/DELWKOExecHeaderOperationInstanceModel","DS/DELWKOIRPCModels/DELWKOOperationStepReferenceModel","DS/DELWKOIRPCModels/DELWKOOperationStepInstanceModel","DS/DELWKOIRPCModels/DELWKOPrimaryCapableResourceModel","DS/DELWKOIRPCModels/DELWKOPrimaryResourceLinkModel","DS/DELWKOIRPCModels/DELWKOSecondaryCapableResourceModel","DS/DELWKOIRPCModels/DELWKOSecondaryResourceLinkModel"],(function(e,t,n,i,s,o,r,a,c,l,d,u,p,f,h,m){"use strict";var y=1e3;return n.extend({init:function(e){e=e||{},this.uniqueFetchObjectsIDs=[],this._parent(e)},getWhereUsedReferences:function(t,n,i){var s,o=this,r=e.is(n,"function");e.is(t)&&(s=t.id);var a=[],c=[],l=o.collectionUtils.getImpactedConnections(s);e.is(l)&&e.is(l,"array")&&l.forEach((function(t){var n=t.get("from"),i=o.collectionUtils.getReferenceModel(n),s=t.get("to"),r=o.collectionUtils.getReferenceModel(s),l=[];l.push(i),l.push(r),l.forEach((t=>{e.is(t)&&(t.isReference()?a.push(t):c.push(t))}))})),r&&(n(a,c),i(l))},fetchMultiple:function(e,n){var i=this;return new t((function(t,n){i.collectionUtils.fetchRefList(e,{onComplete:function(e){t(e.instancesAndReferences)}})}))},fetchRoot:function(t,n){var i=n||{},s=e.is(i.context)?i.context:null,o=!e.is(i.silent)||i.silent,r=!!e.is(i.forceDBMode)&&i.forceDBMode,a=e.is(i.onComplete,"function")?i.onComplete:null,c=e.is(i.onFailure,"function")?i.onFailure:null,l={onComplete:function(t){var n,i={forceDBMode:r};e.is(a,"function")&&(e.is(t.instancesAndReferences)?(n=t.instancesAndReferences,i=e.merge(i,{isArray:!0})):n=t,a.call(s,n,i))},onFailure:function(t){e.is(c,"function")&&c.call(s,t)},silent:o};e.is(t,"array")?this.collectionUtils.fetchRefList(t,l):this.collectionUtils.fetchRefList([t],l)},_getAttributesEntityOnIndex:function(t,n){return this.collectionUtils.getAttributesOnIndex(t,{onComplete:function(t){e.is(n)&&e.is(n.onComplete,"function")&&n.onComplete(t)},onFailure:function(t){e.is(n)&&e.is(n.onFailure,"function")&&n.onFailure(t)},type:"entity"})},_getAttributesRelationOnIndex:function(t,n){return this.collectionUtils.getAttributesOnIndex(t,{onComplete:function(t){e.is(n)&&e.is(n.onComplete,"function")&&n.onComplete(t)},onFailure:function(t){e.is(n)&&e.is(n.onFailure,"function")&&n.onFailure(t)},type:"relation"})},_addToCollections:function(t,n){n=n||{},t.onComplete=function(t){e.is(n.auxiliaryView)||t.instancesAndReferences.forEach((function(e){"WORKORDER"!==e.get("PPRTYPE")&&"EXECHEADER"!==e.get("PPRTYPE")&&"STEP"!==e.get("PPRTYPE")||e.setAdditionalInfo({queriedForConnections:!0})})),Object.prototype.hasOwnProperty.call(n,"callback")&&n.callback instanceof Function&&n.callback(t)},this.collectionUtils.addToCollections(t)},onCompleteFromWorkOrders:function(t,n,i,s){var o=this,p={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},f=[],h=[],m=[],g=s;g.type="DELLmiWorkOrderReference",p.stackedReferences.push(g),p.silentMode=n.silentMode;var I=new a({id:s.id});if((e.is(n.silentMode,"boolean")&&!n.silentMode||n.refreshMode)&&!e.is(n.auxiliaryView)&&e.is(s.itemRef)&&e.is(s.itemRef.identifier)&&(p.stackedConnections.push({PID:o.collectionUtils.createRandomPID(),from:I.get("PID"),to:s.itemRef.identifier,type:"PartialProductImplementLink"}),e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(s.itemRef.identifier)&&h.push(s.itemRef.identifier)),(e.is(n.silentMode,"boolean")&&!n.silentMode||n.refreshMode)&&!e.is(n.auxiliaryView)&&e.is(s.serializedFrom)&&e.is(s.serializedFrom.identifier)&&(p.stackedConnections.push({PID:o.collectionUtils.createRandomPID(),from:I.get("PID"),to:s.serializedFrom.identifier,type:"DELIsSerializedFrom"}),e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(s.serializedFrom.identifier)&&h.push(s.serializedFrom.identifier)),(e.is(n.silentMode,"boolean")&&!n.silentMode||n.refreshMode)&&!e.is(n.auxiliaryView)&&e.is(s.assetContext)&&e.is(s.assetContext.identifier)&&(p.stackedConnections.push({PID:o.collectionUtils.createRandomPID(),from:I.get("PID"),to:s.assetContext.identifier,type:"AssetContextLink"}),e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(s.assetContext.identifier)&&h.push(s.assetContext.identifier)),(e.is(n.silentMode,"boolean")&&!n.silentMode||n.refreshMode)&&!e.is(n.auxiliaryView)&&e.is(s.build)&&(e.is(s.build)&&p.stackedConnections.push({PID:o.collectionUtils.createRandomPID(),from:I.get("PID"),to:s.build.identifier,type:"DELIsGeneratedFromProcessFilteredBy"}),e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(s.build.identifier)&&h.push(s.build.identifier)),(e.is(n.silentMode,"boolean")&&!n.silentMode||n.refreshMode)&&!e.is(n.auxiliaryView)&&e.is(s.productionPlanId)){var P=new r({id:s.productionPlanId});p.stackedConnections.push({PID:o.collectionUtils.createRandomPID(),from:P.get("PID"),to:I.get("PID"),type:"ProductionPlanLink"});var v=o.collectionUtils.getProductionPlanAttributesOnCloud([s.productionPlanId],{onComplete:function(e){var t=e;t.type="DELLmiProductionPlanReference",p.stackedReferences.push(t)}});f.push(v)}var O=s.workOrderOperations;((-1===i||i>0)&&e.is(O)&&O.length>0&&O.forEach((t=>{var n=new c({id:t.id}),s=new l({id:t.id});t.primaryCapableResources.forEach((t=>{var i=t.resource;e.is(i)&&(e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(i.identifier)&&(h.push(i.identifier),o.uniqueFetchObjectsIDs.push(i.identifier)),t.from=n.get("PID"),t.to=i.identifier,t.type="DELLmiExecAsmProcessCanUseCnx",p.stackedConnections.push(t))})),t.secondaryCapableResources.forEach((t=>{var i=t.resource;e.is(i)&&(e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(i.identifier)&&(h.push(i.identifier),o.uniqueFetchObjectsIDs.push(i.identifier)),t.from=n.get("PID"),t.to=i.identifier,t.type="DELLmiExecSecondaryCandidateResourceLink",p.stackedConnections.push(t))}));var r=t.assignedWorkCenter;e.is(r)&&(e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(r.identifier)&&(h.push(r.identifier),o.uniqueFetchObjectsIDs.push(r.identifier)),p.stackedConnections.push({PID:o.collectionUtils.createRandomPID(),from:n.get("PID"),to:r.identifier,type:"AssignedWorkCenterLink"}));var a=t.itemSpecifications;e.is(a)&&a.forEach((t=>{var n=t.itemRef;if(e.is(n)){if(e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(n.identifier)&&(o.uniqueFetchObjectsIDs.push(n.identifier),h.push(n.identifier)),e.is(t.itemOcc)&&t.itemOcc.length>0){t.itemOcc.forEach((t=>{e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(t)&&(o.uniqueFetchObjectsIDs.push(t),m.push(t))}));var i={};i.PID=t.id.toString(),i.to=s.get("PID"),i.from=t.itemOcc,i.type="ItemSpecOcc",i.V_usage=t.usage,p.stackedConnections.push(i)}}}));-1===i&&e.is(t.workOrderOperationSteps)&&t.workOrderOperationSteps.forEach((t=>{var i=new d({id:t.id}),s=new u({id:t.id}),r=t.stepInstanceId;if(e.is(r)){var a=Object.assign({},t);a.type="DELLmiOperationReference",a.icontype=t.type,p.stackedReferences.push(a);var c=Object.assign({},t);c.type="DELLmiOperationInstance",c.icontype=t.type,c.isAggregatedBy=n.get("PID"),c.isInstanceOf=i.get("PID"),p.stackedInstances.push(c),p.stackedConnections.push({PID:r,from:s.get("PID"),to:[r],type:"DELIsSerializedFromOp"}),t.operationStepTimeConstraints.forEach((e=>{var t=new d({id:e.fromWorkOrderOperationStepId.toString()}),n=new d({id:e.toWorkOrderOperationStepId.toString()});e.toWorkOrderOperationId=n.get("PID"),e.fromWorkOrderOperationId=t.get("PID"),e.type="DELLmiExecTimeConstraintRelationOnStep",p.stackedConnections.push(e)}));var l=t.itemSpecifications;e.is(l)&&l.forEach((t=>{var n=t.itemRef;if(e.is(n)){if(e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(n.identifier)&&(o.uniqueFetchObjectsIDs.push(n.identifier),h.push(n.identifier)),e.is(t.itemOcc)&&t.itemOcc.length>0){t.itemOcc.forEach((t=>{e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(t)&&(o.uniqueFetchObjectsIDs.push(t),m.push(t))}));var i={};i.PID=t.id.toString(),i.to=s.get("PID"),i.from=t.itemOcc,i.type="ItemSpecOcc",i.V_usage=t.usage,p.stackedConnections.push(i)}}}));var f=t.workInstructions;e.is(f)&&f.forEach((t=>{e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(t.wkiInstanceId)&&(o.uniqueFetchObjectsIDs.push(t.wkiInstanceId),m.push(t.wkiInstanceId))})),e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(r)&&(o.uniqueFetchObjectsIDs.push(r),m.push(r))}}));var f=Object.assign({},t);f.type="DELLmiExecHeaderOperationReference",p.stackedReferences.push(f);var y=Object.assign({},t);y.type="DELLmiExecHeaderOperationInstance",y.isAggregatedBy=I.get("PID"),y.isInstanceOf=n.get("PID"),p.stackedInstances.push(y),t.workOrderOperationTimeConstraints.forEach((e=>{var t=new c({id:e.fromWorkOrderOperationId.toString()}),n=new c({id:e.toWorkOrderOperationId.toString()});e.toWorkOrderOperationId=n.get("PID"),e.fromWorkOrderOperationId=t.get("PID"),e.type="DELLmiExecTimeConstraintRelation",p.stackedConnections.push(e)})),e.is(t.operationInstanceId)&&(e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(t.operationInstanceId)&&(o.uniqueFetchObjectsIDs.push(t.operationInstanceId),m.push(t.operationInstanceId)),p.stackedConnections.push({PID:t.operationInstanceId,from:s.get("PID"),to:[t.operationInstanceId],type:"DELIsSerializedFromOp"}))})),e.is(m)&&m.length>0)&&o.splitIntoChunks(m,y).forEach((t=>{var n=o._getAttributesRelationOnIndex(t,{onComplete:function(t){if(e.is(t)&&Array.isArray(t))t.forEach((t=>{var n=t.attributes;n.physicalid=t.attributes.PID,n.type=t.attributes.type,p.stackedInstances.push(n),e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(n.isAggregatedBy)&&(h.push(n.isAggregatedBy),o.uniqueFetchObjectsIDs.push(n.isAggregatedBy)),e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(n.isInstanceOf)&&(h.push(n.isInstanceOf),o.uniqueFetchObjectsIDs.push(n.isInstanceOf))}));else{var n=t.attributes;n.physicalid=t.attributes.PID,n.type=t.attributes.type,p.stackedInstances.push(n),e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(n.isAggregatedBy)&&(h.push(n.isAggregatedBy),o.uniqueFetchObjectsIDs.push(n.isAggregatedBy)),e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(n.isInstanceOf)&&(h.push(n.isInstanceOf),o.uniqueFetchObjectsIDs.push(n.isInstanceOf))}},onFailure:function(e){}});f.push(n)}));if(e.is(f)&&0===f.length){var R=[];if(e.is(h)&&h.length>0)o.splitIntoChunks(h,y).forEach((t=>{var n=o._getAttributesEntityOnIndex(t,{onComplete:function(t){if(e.is(t)&&Array.isArray(t))t.forEach((e=>{var t=e.attributes;t.physicalid=e.attributes.PID,t.type=e.attributes.type,p.stackedReferences.push(t)}));else{var n=t.attributes;n.physicalid=t.attributes.PID,n.type=t.attributes.type,p.stackedReferences.push(n)}},onFailure:function(e){}});R.push(n)}));e.is(R)&&0===R.length?((-1===i||i>0)&&t.setAdditionalInfo({queriedForChildren:!0}),n.silentMode=e.is(n.refreshMode)?!n.refreshMode:n.silentMode,o._addToCollections(p,n)):e.Promise.all(R).then((function(s){(-1===i||i>0)&&t.setAdditionalInfo({queriedForChildren:!0}),n.silentMode=e.is(n.refreshMode)?!n.refreshMode:n.silentMode,o._addToCollections(p,n)}))}else e.Promise.all(f).then((function(s){var r=[];e.is(h)&&h.length>0&&o.splitIntoChunks(h,y).forEach((t=>{var n=o._getAttributesEntityOnIndex(t,{onComplete:function(t){if(e.is(t)&&Array.isArray(t))t.forEach((e=>{var t=e.attributes;t.physicalid=e.attributes.PID,t.type=e.attributes.type,p.stackedReferences.push(t)}));else{var n=t.attributes;n.physicalid=t.attributes.PID,n.type=t.attributes.type,p.stackedReferences.push(n)}},onFailure:function(e){}});r.push(n)}));e.is(r)&&0===r.length?(n.silentMode=e.is(n.refreshMode)?!n.refreshMode:n.silentMode,o._addToCollections(p,n)):e.Promise.all(r).then((function(s){(-1===i||i>0)&&t.setAdditionalInfo({queriedForChildren:!0}),n.silentMode=e.is(n.refreshMode)?!n.refreshMode:n.silentMode,o._addToCollections(p,n)}))}))},onCompleteFromExecHeaders:function(t,n,i,s){var o=this,r={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},a=[],f=[],m=[],g=s;g.type="DELLmiExecHeaderOperationReference",r.stackedReferences.push(g);var I=new c({id:s.id}),P=new l({id:s.id}),v=s;e.is(v.primaryCapableResources)&&v.primaryCapableResources.forEach((t=>{var n=t.resource;e.is(n)&&(e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(n.identifier)&&(f.push(n.identifier),o.uniqueFetchObjectsIDs.push(n.identifier)),t.from=I.get("PID"),t.to=n.identifier,t.type="DELLmiExecAsmProcessCanUseCnx",r.stackedConnections.push(t))})),e.is(v.secondaryCapableResources)&&v.secondaryCapableResources.forEach((t=>{var n=t.resource;e.is(n)&&(e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(n.identifier)&&(f.push(n.identifier),o.uniqueFetchObjectsIDs.push(n.identifier)),t.from=I.get("PID"),t.to=n.identifier,t.type="DELLmiExecSecondaryCandidateResourceLink",r.stackedConnections.push(t))}));var O=v.assignedWorkCenter;e.is(O)&&(e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(O.identifier)&&(f.push(O.identifier),o.uniqueFetchObjectsIDs.push(O.identifier)),r.stackedConnections.push({PID:o.collectionUtils.createRandomPID(),from:I.get("PID"),to:O.identifier,type:"AssignedWorkCenterLink"}));var R=v.itemSpecifications;e.is(R)&&R.forEach((t=>{var n=t.itemRef;if(e.is(n)){if(e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(n.identifier)&&(o.uniqueFetchObjectsIDs.push(n.identifier),f.push(n.identifier)),e.is(t.itemOcc)&&t.itemOcc.length>0){t.itemOcc.forEach((t=>{e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(t)&&(o.uniqueFetchObjectsIDs.push(t),m.push(t))}));var i={};i.PID=t.id.toString(),i.to=P.get("PID"),i.from=t.itemOcc,i.type="ItemSpecOcc",i.V_usage=t.usage,r.stackedConnections.push(i)}}}));((-1===i||i>0)&&e.is(v.workOrderOperationSteps)&&v.workOrderOperationSteps.forEach((t=>{var n=new d({id:t.id}),i=new u({id:t.id}),s=t.stepInstanceId;if(e.is(s)){var a=Object.assign({},t);a.type="DELLmiOperationReference",a.icontype=t.type,r.stackedReferences.push(a);var c=Object.assign({},t);c.type="DELLmiOperationInstance",c.icontype=t.type,c.isAggregatedBy=I.get("PID"),c.isInstanceOf=n.get("PID"),r.stackedInstances.push(c),r.stackedConnections.push({PID:s,from:i.get("PID"),to:[s],type:"DELIsSerializedFromOp"}),t.operationStepTimeConstraints.forEach((e=>{var t=new d({id:e.fromWorkOrderOperationStepId.toString()}),n=new d({id:e.toWorkOrderOperationStepId.toString()});e.toWorkOrderOperationId=n.get("PID"),e.fromWorkOrderOperationId=t.get("PID"),e.type="DELLmiExecTimeConstraintRelationOnStep",r.stackedConnections.push(e)}));var l=t.primaryResourceLinkDetails;e.is(l)&&l.forEach((t=>{var i=o.collectionUtils.getConnectionFromCollection(new p({id:t.primaryCapableResourceId}));if(e.is(i)){var s={};s.id=o.collectionUtils.createRandomPID(),s.from=n.get("PID"),s.to=i.get("resource").identifier,s.type="DELLmiExecAsmProcessCanUseCnxDetails",r.stackedConnections.push(s)}}));var y=t.secondaryResourceLinkDetails;e.is(y)&&y.forEach((t=>{var i=o.collectionUtils.getConnectionFromCollection(new h({id:t.secondaryCapableResourceId}));if(e.is(i)){var s={};s.id=o.collectionUtils.createRandomPID(),s.from=n.get("PID"),s.to=i.get("resource").identifier,s.type="DELLmiExecSecondaryCandidateResourceLinkDetails",r.stackedConnections.push(s)}}));var g=t.itemSpecifications;e.is(g)&&g.forEach((t=>{var n=t.itemRef;if(e.is(n)){if(e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(n.identifier)&&(o.uniqueFetchObjectsIDs.push(n.identifier),f.push(n.identifier)),e.is(t.itemOcc)&&t.itemOcc.length>0){t.itemOcc.forEach((t=>{e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(t)&&(o.uniqueFetchObjectsIDs.push(t),m.push(t))}));var s={};s.PID=t.id.toString(),s.to=i.get("PID"),s.from=t.itemOcc,s.type="ItemSpecOcc",s.V_usage=t.usage,r.stackedConnections.push(s)}}})),m.push(s)}})),e.is(m)&&m.length>0)&&o.splitIntoChunks(m,y).forEach((t=>{var n=o._getAttributesRelationOnIndex(t,{onComplete:function(t){if(e.is(t)&&Array.isArray(t))t.forEach((t=>{var n=t.attributes;n.physicalid=t.attributes.PID,n.type=t.attributes.type,r.stackedInstances.push(n),e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(n.isAggregatedBy)&&(f.push(n.isAggregatedBy),o.uniqueFetchObjectsIDs.push(n.isAggregatedBy)),e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(n.isInstanceOf)&&(f.push(n.isInstanceOf),o.uniqueFetchObjectsIDs.push(n.isInstanceOf))}));else{var n=t.attributes;n.physicalid=t.attributes.PID,n.type=t.attributes.type,r.stackedInstances.push(n),e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(n.isAggregatedBy)&&(f.push(n.isAggregatedBy),o.uniqueFetchObjectsIDs.push(n.isAggregatedBy)),e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(n.isInstanceOf)&&(f.push(n.isInstanceOf),o.uniqueFetchObjectsIDs.push(n.isInstanceOf))}},onFailure:function(e){}});a.push(n)}));if(e.is(a)&&0===a.length){var D=[];if(e.is(f)&&f.length>0)o.splitIntoChunks(f,y).forEach((t=>{var n=o._getAttributesEntityOnIndex(t,{onComplete:function(t){if(e.is(t)&&Array.isArray(t))t.forEach((e=>{var t=e.attributes;t.physicalid=e.attributes.PID,t.type=e.attributes.type,r.stackedReferences.push(t)}));else{var n=t.attributes;n.physicalid=t.attributes.PID,n.type=t.attributes.type,r.stackedReferences.push(n)}},onFailure:function(e){}});D.push(n)}));e.is(D)&&0===D.length?((-1===i||i>0)&&t.setAdditionalInfo({queriedForChildren:!0}),n.silentMode=e.is(n.refreshMode)?!n.refreshMode:n.silentMode,o._addToCollections(r,n)):e.Promise.all(D).then((function(s){(-1===i||i>0)&&t.setAdditionalInfo({queriedForChildren:!0}),n.silentMode=e.is(n.refreshMode)?!n.refreshMode:n.silentMode,o._addToCollections(r,n)}))}else e.Promise.all(a).then((function(s){var a=[];e.is(f)&&f.length>0&&o.splitIntoChunks(f,y).forEach((t=>{var n=o._getAttributesEntityOnIndex(t,{onComplete:function(t){if(e.is(t)&&Array.isArray(t))t.forEach((e=>{var t=e.attributes;t.physicalid=e.attributes.PID,t.type=e.attributes.type,r.stackedReferences.push(t)}));else{var n=t.attributes;n.physicalid=t.attributes.PID,n.type=t.attributes.type,r.stackedReferences.push(n)}},onFailure:function(e){}});a.push(n)}));e.is(a)&&0===a.length?(n.silentMode=e.is(n.refreshMode)?!n.refreshMode:n.silentMode,o._addToCollections(r,n)):e.Promise.all(a).then((function(e){(-1===i||i>0)&&t.setAdditionalInfo({queriedForChildren:!0}),o._addToCollections(r,n)}))}))},onCompleteFromSteps:function(t,n,i,s){var o=this,r={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},a=[],c=[],l=[],p=s;p.type="DELLmiOperationPPRReference",r.stackedReferences.push(p);var h=new d({id:s.id}),g=new u({id:s.id}),I=p.primaryResourceLinkDetails;e.is(I)&&I.forEach((t=>{var n=o.collectionUtils.getConnectionFromCollection(new f({id:t.id}));if(e.is(n)){var i={};i.id=o.collectionUtils.createRandomPID(),i.from=h.get("PID"),i.to=n.get("resource").identifier,i.type="DELLmiExecAsmProcessCanUseCnxDetails",r.stackedConnections.push(i)}}));var P=p.secondaryResourceLinkDetails;e.is(P)&&P.forEach((t=>{var n=o.collectionUtils.getConnectionFromCollection(new m({id:t.id}));if(e.is(n)){var i={};i.id=o.collectionUtils.createRandomPID(),i.from=h.get("PID"),i.to=n.get("resource").identifier,i.type="DELLmiExecSecondaryCandidateResourceLinkDetails",r.stackedConnections.push(i)}}));var v=p.operationStepTimeConstraints;e.is(v)&&v.forEach((e=>{var t=new d({id:e.fromWorkOrderOperationStepId.toString()}),n=new d({id:e.toWorkOrderOperationStepId.toString()});e.toWorkOrderOperationId=n.get("PID"),e.fromWorkOrderOperationId=t.get("PID"),e.type="DELLmiExecTimeConstraintRelationOnStep",r.stackedConnections.push(e)}));var O=p.workInstructions;e.is(O)&&O.forEach((t=>{e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(t.wkiInstanceId)&&(o.uniqueFetchObjectsIDs.push(t.wkiInstanceId),l.push(t.wkiInstanceId))}));var R=p.itemSpecifications;(e.is(R)&&R.forEach((t=>{var n=t.itemRef;if(e.is(n)){if(e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(n.identifier)&&(o.uniqueFetchObjectsIDs.push(n.identifier),c.push(n.identifier)),e.is(t.itemOcc)&&t.itemOcc.length>0){t.itemOcc.forEach((t=>{e.is(o.uniqueFetchObjectsIDs)&&!o.uniqueFetchObjectsIDs.includes(t)&&(o.uniqueFetchObjectsIDs.push(t),l.push(t))}));var i={};i.PID=t.id.toString(),i.to=g.get("PID"),i.from=t.itemOcc,i.type="ItemSpecOcc",i.V_usage=t.usage,r.stackedConnections.push(i)}}})),e.is(c)&&c.length>0)&&o.splitIntoChunks(c,y).forEach((t=>{var n=o._getAttributesEntityOnIndex(t,{onComplete:function(t){if(e.is(t)&&Array.isArray(t))t.forEach((e=>{var t=e.attributes;t.physicalid=e.attributes.PID,t.type=e.attributes.type,r.stackedReferences.push(t)}));else{var n=t.attributes;n.physicalid=t.attributes.PID,n.type=t.attributes.type,r.stackedReferences.push(n)}},onFailure:function(e){}});a.push(n)}));e.is(l)&&l.length>0&&o.splitIntoChunks(l,y).forEach((t=>{var n=o._getAttributesRelationOnIndex(t,{onComplete:function(t){if(e.is(t)&&Array.isArray(t))t.forEach((e=>{var t=e.attributes;t.physicalid=e.attributes.PID,t.type=e.attributes.type,r.stackedInstances.push(t)}));else{var n=t.attributes;n.physicalid=t.attributes.PID,n.type=t.attributes.type,r.stackedInstances.push(n)}},onFailure:function(e){}});a.push(n)}));if(e.is(a)&&0===a.length){var D=[];if(e.is(c)&&c.length>0)o.splitIntoChunks(c,y).forEach((t=>{var n=o._getAttributesEntityOnIndex(t,{onComplete:function(t){if(e.is(t)&&Array.isArray(t))t.forEach((e=>{var t=e.attributes;t.physicalid=e.attributes.PID,t.type=e.attributes.type,r.stackedReferences.push(t)}));else{var n=t.attributes;n.physicalid=t.attributes.PID,n.type=t.attributes.type,r.stackedReferences.push(n)}},onFailure:function(e){}});D.push(n)}));e.is(D)&&0===D.length?((-1===i||i>0)&&t.setAdditionalInfo({queriedForChildren:!0}),n.silentMode=e.is(n.refreshMode)?!n.refreshMode:n.silentMode,o._addToCollections(r,n)):e.Promise.all(D).then((function(s){(-1===i||i>0)&&t.setAdditionalInfo({queriedForChildren:!0}),n.silentMode=e.is(n.refreshMode)?!n.refreshMode:n.silentMode,o._addToCollections(r,n)}))}else e.Promise.all(a).then((function(e){(-1===i||i>0)&&t.setAdditionalInfo({queriedForChildren:!0}),o._addToCollections(r,n)}))},getDescendants:function(t,n){var i=this,r=n.stackedObjects||{stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}};n=n||{};var a=widget.getBool("showOperationSteps");if(!e.is(n.expandLevel)||e.is(n.expandLevel)&&n.expandLevel>=0||e.is(n.expandLevel)&&-1===n.expandLevel){var c=o.getPrefExpandLevel();e.is(n.expandLevel)&&(c=n.expandLevel),Array.isArray(t)||(t=[t]),i.uniqueFetchObjectsIDs=[];var l=[];t.forEach((t=>{var n=i.collectionUtils.getReferenceFromCollection(t);e.is(n)&&i.collectionUtils.needToQueryForChildren(n)&&l.push(n)})),l.forEach((t=>{var o={};"WORKORDER"===t.get("PPRTYPE")?(e.is(a)&&!1===a&&(void 0===n.loadRootOnly||e.is(n.loadRootOnly)&&!1===n.loadRootOnly)&&(c=1),o={url:t.url("step"),method:"GET",headers:{},onComplete:i.onCompleteFromWorkOrders.bind(i,t,n,c),onFailure:function(e){}}):"EXECHEADER"===t.get("PPRTYPE")?(e.is(a)&&!1===a&&(void 0===n.loadRootOnly||e.is(n.loadRootOnly)&&!1===n.loadRootOnly)&&(c=0),o={url:t.url("step"),method:"GET",headers:{},onComplete:i.onCompleteFromExecHeaders.bind(i,t,n,c),onFailure:function(e){}}):"STEP"===t.get("PPRTYPE")&&a&&(o={url:t.url(),method:"GET",headers:{},onComplete:i.onCompleteFromSteps.bind(i,t,n,c),onFailure:function(e){}}),s.webServiceRequest(o)}))}else{r={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}};i._addToCollections(r,n)}}})})),define("DS/DELWKONavigationServices/DELWKONavigateUtil",["UWA/Core","UWA/Class","DS/DELPPWNavigationServices_FD02/NavigateUtil","DS/DELPPWWebServices_FD02/WebserviceUtils","DS/DELPPWNavigationServices_FD02/SwitchDBModeManager","DS/DELPPWModelParsers_FD02/ConnectionParser","DS/DELWKOIndexServices/DELWKOIndexParser","DS/DELPPWModelServices_FD02/ModelUtils","DS/DELPPWModelServices_FD02/BehaviorUtil","DS/DELPPWModelServices_FD02/Navigation/IndexedDBUtils","DS/DELWKONavigationServices/DELWKONavigateOnDB","DS/DELWKONavigationServices/DELWKONavigateOnIndex","DS/DELPPWNavigationServices_FD02/NavigateOnDemand","DS/DELWKONavigationServices/DELWKONavigateOnCloud","DS/DELPPWModelServices_FD02/CollectionUtils","DS/DELPPWLoggerModel_FD02/LoggerUtils"],(function(e,t,n,i,s,o,r,a,c,l,d,u,p,f,h,m){"use strict";var y=t.singleton({name:"DELWKONavigateUtil",uninitializedCalls:"throw",init:function(e){if(!(e=e||{}).indexMappingXML)throw new Error("indexMappingXML option not defined");this.options=e,l.init(),y._connectionParser=o.init({collectionUtils:this.options.collectionUtils})},setup:function(t,n){var s=this,o=new Promise((function(e,t){i.getXMLValues(s.options.indexMappingXML,(function(t){e(t)}),(function(e){t(e)}))})),a=new Promise((function(t,n){e.is(s.options.mandatoryPredicates,"string")&&s.options.mandatoryPredicates.length>0?require(["text!"+s.options.mandatoryPredicates],(function(e){var n=JSON.parse(e);t(n)}),(function(){n("mandatory Predicates defined but not loaded !!!")})):t(null)}));Promise.all([o,a]).then((function(n){var i={collectionUtils:s.options.collectionUtils,mandatoryPredicates:e.is(n[1])?n[1]:null};r.setIndexMapping(n[0]),y.navigateOnDB=new d(i),y.navigateOnIndex=new u(i),y.NavigateOnDemand=new p(i),y.navigateOnCloud=new f(i),m.debug("Succesfully initialized navigations."),t()}),(function(e){m.debug("Failed to initialize Navigations. Failure desc:"+e),n(e)}))},isWorkOrderIds:function(t){var n=!1,i=new RegExp("[0-9A-F]{32}");return e.is(t)&&Array.isArray(t)?t.forEach((e=>{i.test(e)||(n=!0)})):i.test(t)||(n=!0),n},getConnectionParser:function(){return y._connectionParser},getConnectionsFromServer:function(t,n,i){var s=i||{},o=e.is(s.context)?s.context:null;a.isNavigateOnDemand()?this.NavigateOnDemand.getConnections(t,n,i):n.call(o)},getDescendantsFromServer_v2:function(t,n,i){var o=i||{},r=a.getNavigateOnDatabasePreference(),l=a.isNavigateOnDemand(),d=s.isDbMode(),u=e.is(o.context)?o.context:null,p=!!e.is(o.forceDBMode,"boolean")&&o.forceDBMode;o=e.merge({callback:function(t){t.instancesAndReferences.forEach((function(e){e.isInstance()&&h.manageLinearProductFlowsOnCreateInstance(e)})),e.is(n,"function")&&n.call(u,t)},fillLinksAndDocuments:!1,withLinks:!0},o),this.isWorkOrderIds(t)?this.navigateOnCloud.getDescendants(t,o):p||r||d?this.navigateOnDB.getDescendants_v2(t,o):l?this.NavigateOnDemand.getDescendants(t,o):c.isExpandFetchFetchEnabled()?this.navigateOnIndex.getDescendantsV2(t,o):this.navigateOnIndex.getDescendants(t,o)},getDescendantsFromServer:function(t,n,i){var o=i||{},r=a.getNavigateOnDatabasePreference(),l=a.isNavigateOnDemand(),d=s.isDbMode(),u=e.is(o.context)?o.context:null,p=!!e.is(o.forceDBMode,"boolean")&&o.forceDBMode;o=e.merge({callback:function(t){t.instancesAndReferences.forEach((function(e){e.isInstance()&&h.manageLinearProductFlowsOnCreateInstance(e)})),e.is(n,"function")&&n.call(u,t)},fillLinksAndDocuments:!1,withLinks:!0},o),this.isWorkOrderIds(t)?this.navigateOnCloud.getDescendants(t,o):p||r||d?this.navigateOnDB.getDescendants(t,o):l?this.NavigateOnDemand.getDescendants(t,o):c.isExpandFetchFetchEnabled()?this.navigateOnIndex.getDescendantsV2(t,o):this.navigateOnIndex.getDescendants(t,o)},getInverseConnectionsFromServer:function(e,t){this.isWorkOrderIds(e)||this.navigateOnIndex.getInverseConnections(e,t)},setSelectPredicate:function(e,t){this.navigateOnIndex.setSelectPredicate(e,t)},fetchRoot:function(t,n){var i,s,o,r,c,l=this,d=n||{},u=e.is(d.context)?d.context:null,p=!!e.is(n.WithSynthesisAttribute)&&n.WithSynthesisAttribute,f=!!e.is(d.forceDBMode)&&d.forceDBMode;s=e.is(d.onComplete,"function")?d.onComplete:null,i=e.is(d.onFailure,"function")?d.onFailure:null,c=function(t,n){var i=e.is(t,"array")?t.slice():[t];return n=n||[],e.is(n,"array")||(n=[n]),n.forEach((function(e){var t=i.indexOf(e.id);t>-1&&i.splice(t,1)})),i},o=function(n,i){var o;i=i||{},(o=c(t,n)).length>0&&(i.modelsNotRetrieved=o),e.is(s,"function")&&s.call(u,n,i)},l.isWorkOrderIds(t)?l.navigateOnCloud.fetchRoot(t,e.merge({onComplete:o},d)):!0===p?l.navigateOnIndex.fetchRoot(t,d):!0!==a.getNavigateOnIndex()||f?l.navigateOnDB.fetchRoot(t,e.merge({onComplete:o},d)):(r=function(n){var s,r,a=c(t,n);a.length>0?(s=function(i,s){var r,a=[];(i=e.is(i,"array")?i:[i]).forEach((function(e){a.push(e.id)})),e.is(t,"array")?(r=[],e.is(n)&&(n=e.is(n,"array")?n:[n],r=r.concat(n)),i=e.is(i,"array")?i:[i],r=r.concat(i)):r=i,s.modelsFromForceDB=a,o(r,s)},r=function(){e.is(n)?o(n):i&&i.call(u,"Object not found in index mode for PID:"+t)},l.navigateOnDB.fetchRoot(a,e.merge({onComplete:s,onFailure:r,forceDBMode:!0},d))):o(n)},l.navigateOnIndex.fetchRoot(t,e.merge({onComplete:r,onFailure:r},d)))},fetchMultiplePromise:function(e,t){return this.isWorkOrderIds(e)?this.navigateOnCloud.fetchMultiple(e,t):this.navigateOnIndex.fetchMultipleOnIndexPromise(e,t)},findMissingLinkedObjects:function(t,n,i){var s=e.merge({callback:n},i);this.navigateOnIndex.findMissingLinkedObjects(t,s)},getConnectionsByModel:function(t,n,i){var s=i||{},o=!!e.is(s.forceDBMode)&&s.forceDBMode;!a.getNavigateOnIndex()&&!a.isNavigateOnDemand()||o?this.navigateOnDB.getConnectionsByModel(t,n,s.relationTypes,s.isRefRefOnly,s.onComplete):this.navigateOnIndex.getConnectionsByModel(t,n,s.relationTypes,s.isRefRefOnly,s.onComplete)},fetchInstancesAndTheirReferences:function(e,t){return this.navigateOnDB.fetchInstancesAndTheirReferences(e,t)},getWhereUsedReferences:function(e,t,n){this.isWorkOrderIds(e)?this.navigateOnCloud.getWhereUsedReferences(e,t,n):this.navigateOnDB.getWhereUsedReferences(e,t)},getProductScopedLinksFromIndex:function(e,t,n){this.navigateOnIndex.getProductScopedLinks(e,t,n)},getProductScopedLinksFromDB:function(t,n){e.is(this.navigateOnDB)||(this.navigateOnDB=new d(this.options)),this.navigateOnDB.fetchConnections(t,null,n,!0)},navigateScopesFromIndex:function(e,t,n){this.navigateOnIndex.navigateScopes(e,t,n)},navigateOnIndex:function(e,t,n){this.navigateOnIndex.navigateOnIndex(e,t,n)},getReferenceFromInstance:function(e,t,n){this.navigateOnIndex.getReferenceFromInstance(e,t,n)},fetchOnIndex:function(e,t){this.navigateOnIndex.fetchOnIndex(e,t)}});return y}));