define("DS/XCTWebCreativeAppPlay/StuTriggerZoneManagerWeb",["UWA/Core","UWA/Class","DS/StuTriggerZones/StuTriggerZoneManager","DS/StuTriggerZones/StuTriggerZoneActor","DS/StuCore/StuContext","DS/StuMath/StuBox","DS/MathematicsES/MathsDef"],(function(e,t,n,r,i,o,s){"use strict";n.prototype.getTriggerZoneManager=function(){return new a},n.prototype.deleteTriggerZoneManager=function(){};var a=t.extend({__stu__Init:function(){this._uObjectID=1,this._triggerZones=[],this._triggeringObjects=[],this._interactionsMap={}},__stu__Dispose:function(){},__stu__RegisterTriggerZone:function(e){this._triggerZones.push({id:this._uObjectID,stuObject:e.getStuObject()});var t=this._uObjectID;return this._uObjectID++,t},__stu__RegisterTriggeringObject:function(e){this._triggeringObjects.push({id:this._uObjectID,stuObject:e.getStuObject()});var t=this._uObjectID;return this._uObjectID++,t},__stu__GetNbTriggerZones:function(){return this._triggerZones.length},__stu__GetNbTriggeringObjects:function(){return this._triggeringObjects.length},__stu__UnRegisterTriggerZone:function(e){var t=this._triggerZones.map((function(e){return e.id})).indexOf(e);t>=0&&this._triggerZones.splice(t,1)},__stu__UnRegisterTriggeringObject:function(e){var t=this._triggeringObjects.map((function(e){return e.id})).indexOf(e);t>=0&&this._triggeringObjects.splice(t,1)},__stu__Run:function(){this.refreshTransform(this._triggerZones),this.refreshTransform(this._triggeringObjects),this._computeInteractions()},refreshTransform:function(e){for(var t=0;t<e.length;t++){var n=e[t].stuObject.getTransform();e[t].transform?e[t].transfoChanged=this.areTransfoEqual(e[t].transform,n):e[t].transfoChanged=!0,e[t].transform=n,e[t].transfoChanged&&(this.refreshBB(e[t]),this.refreshOBBCornerPoints(e[t]))}},refreshBB:function(e){var t=new o;e.stuObject.StuIRepresentation.GetBoundingBox(t,e.transform,0),e.bb=t},refreshOBBCornerPoints:function(e){var t=new o;e.stuObject.StuIRepresentation.GetOrientedBoundingBox(t,{orientation:e.transform,excludeChildren:!1},e.transform);var n,r=t.high.x-t.low.x,i=t.high.y-t.low.y,s=t.high.z-t.low.z,a=[];for(n=0;n<4;n++)a[n]=t.low.clone();for(n=0;n<4;n++)a[n+4]=t.high.clone();for(a[1].x+=r,a[2].y+=i,a[3].z+=s,a[4].x-=r,a[5].y-=i,a[6].z-=s,n=0;n<8;n++)a[n].applyTransformation(e.transform);e.obbCornerPoints=a},_computeInteractions:function(){for(var e=0;e<this._triggerZones.length;e++)for(var t=0;t<this._triggeringObjects.length;t++)(this._triggerZones[e].transfoChanged||this._triggeringObjects[t].transfoChanged)&&this._computeInteraction(this._triggerZones[e],this._triggeringObjects[t])},_computeInteraction:function(t,n){var r,o=this.isIntersectByBoundingBox(t.bb,n.bb);-1!==o&&(o=this.isIntersectByOrientedBoundingBox(t.obbCornerPoints,n.obbCornerPoints)),(r=e.is(this._interactionsMap[t.id])&&e.is(this._interactionsMap[t.id][n.id])?this._interactionsMap[t.id][n.id]:-1)!==o&&(r<0&&o>=0&&i.TriggerZoneManager.getInstance().onTriggerZoneEntry(t.id,n.id),r>=0&&o<0&&i.TriggerZoneManager.getInstance().onTriggerZoneExit(t.id,n.id),o>0&&r<=0&&i.TriggerZoneManager.getInstance().onTriggerZoneInclusion(t.id,n.id,o),o<=0&&r>0&&i.TriggerZoneManager.getInstance().onTriggerZoneEndInclusion(t.id,n.id,o)),e.is(this._interactionsMap[t.id])||(this._interactionsMap[t.id]={}),this._interactionsMap[t.id][n.id]=o},isIntersectByBoundingBox:function(e,t){return e.high.x<t.low.x||e.high.y<t.low.y||e.high.z<t.low.z||t.high.x<e.low.x||t.high.y<e.low.y||t.high.z<e.low.z?-1:0},isIntersectByOrientedBoundingBox:function(e,t){var n,r=[],i=[];for(n=0;n<8;n++)r.push(new s.Vector3D(e[n].x,e[n].y,e[n].z)),i.push(new s.Vector3D(t[n].x,t[n].y,t[n].z));var o=[],a=[];for(n=1;n<=3;n++)o.push(s.Vector3D.sub(r[n],r[0])),a.push(s.Vector3D.sub(i[n],i[0]));var u=-1;for(n=0;n<3&&!((u=this.projectionsAreIntersected(r,i,o[n],u))<0);n++);if(u>=0)for(n=0;n<3&&!((u=this.projectionsAreIntersected(r,i,a[n],u))<0);n++);if(u>=0)for(n=0;n<3;n++)for(var c=0;c<3;c++){var l=o[n].clone().cross(a[c]);if((u=this.projectionsAreIntersected(r,i,l,u))>=0)break}return u},projectionsAreIntersected:function(e,t,n,r){if(n.isEqual(new s.Vector3D(0,0,0),1e-6))return r;for(var i,o=s.normalize(n),a=Number.MAX_VALUE,u=-Number.MAX_VALUE,c=Number.MAX_VALUE,l=-Number.MAX_VALUE,p=0;p<8;p++){var d=e[p].dot(o),h=t[p].dot(o);a=d<a?d:a,u=d>u?d:u,c=h<c?h:c,l=h>l?h:l}return i=0!==r?c<a&&l>u&&(-1===r||1===r)?1:a<c&&u>l&&(-1===r||2===r)?2:0:r,u<c||a>l?-1:i},areTransfoEqual:function(e,t){for(var n=e.getCoefficients(),r=t.getCoefficients(),i=0;i<12;++i)if(Math.abs(n[i]-r[i])>1e-6)return!0;return!1}});return a})),define("DS/XCTWebCreativeAppPlay/managers/CXPWebPlayManager",["UWA/Core","UWA/Class/Events","DS/StuCore/StuContext","DS/EPTaskPlayer/EPTaskPlayerDefine","DS/StuRenderEngine/StuRenderManager","DS/EPEventServices/EPEventServices","DS/CAT3DExpModel/CAT3DXModel","text!DS/XCTWebExperienceAppPlay/assets/XCTWebExperienceAppPlayPrototypeBuild.json","DS/XCTWebExperienceAppPlay/CXPWebRenderManager","DS/XCTWebExperienceAppPlay/StuEnvServices","DS/XCTWebExperienceAppPlay/StuProfilingServices","DS/XCTWebExperienceAppPlay/StuVisuServices","DS/XCTWebExperienceAppPlay/CXPWebCapacityLauncher","DS/XCTWebExperienceAppPlay/StuMaterialsManager","DS/XCTWebExperienceAppPlay/CXPConfServices","DS/XCTWebExperienceAppPlay/StuWebPlayerWeb","DS/StuCore/StuInterpolationManager"],(function(e,t,n,r,i,o,s,a){"use strict";var u=e.Class.extend(t,{Build:function(){this._playState=this.ePlayState.eStop,this._prototypeBuildTables=JSON.parse(a),this._stuClass={},this._stuClassDeferred={};const e=this._experienceBase.getManager("CAT3DXAVPComManager");e&&(e.registerCommandFromSwift("playExperience",(async()=>{await this.play()})),e.registerCommandFromSwift("pauseExperience",(async()=>{await this.pause()})),e.registerCommandFromSwift("restartExperience",(async()=>{await this.stop(),await this.play()})))},Dispose:function(){delete this._prototypeBuildTables,this._stuClass={},this._stuClassDeferred={},this.stop(),this._dynamicObjectsFactory=null},ePlayState:{eStop:0,ePause:1,eStart:2,ePlaying:3,eStopping:4},getPlayState:function(){return this._playState},_setPlayState:function(e){this._playState=e,this.dispatchEvent("PlayStateChanged",e)},GetProtobuildFromComponent:function(e){return this._getPrototypeBuildClassFromComponent(e).then((function(e){return new e}))},_getPrototypeBuildClassFromComponent:function(t){var n=t.GetType();if(this._stuClass[n])return e.Promise.resolve(this._stuClass[n]);if(this._stuClassDeferred[n])return this._stuClassDeferred[n].promise;var r=this._getPrototypeBuildFileFromComponent(t);if(r){this._stuClassDeferred[n]=new e.Promise.deferred;var i=this;return require([r],(function(){i._stuClass[n]=arguments[0],i._stuClassDeferred[n].resolve(arguments[0]),delete i._stuClassDeferred[n]})),this._stuClassDeferred[n].promise}return e.Promise.reject("Warning : "+n+" not (longer) supported")},_getPrototypeBuildFileFromComponent:function(e){for(var t=e.GetTypes(),n=t.length-1;n>=0;n--){var r=t[n];if(this._prototypeBuildTables.hasOwnProperty(r))return this._prototypeBuildTables[r]}},play:function(){switch(this.getPlayState()){case this.ePlayState.eStop:return this._play();case this.ePlayState.ePause:return this._resume();default:return e.Promise.resolve()}},_play:function(){this._setPlayState(this.ePlayState.eStart);var t=s.GetExperience();t.QueryInterface("CATI3DXVolatileEO").setVolatile();var o=this._experienceBase.getManager("CAT3DXVisuManager").getViewer();i.getInstance().setViewer(o),i.getInstance().setViewpoint(o.currentViewpoint),n.initContext();var a=this;return this._experienceBase.getManager("CAT3DExperienceESExportManager").export(t).then((function(e){a._experienceBase.getManager("CXPWebEventListenerManager").start(),n.initExperience(e),r.start(),n.activateExperience(),a._setPlayCursor(),a._startDate=Date.now(),a._frameNumber=0,a._setPlayState(a.ePlayState.ePlaying)})).catch((function(t){return a._setPlayState(a.ePlayState.eStop),console.error(t),e.Promise.reject(t)}))},_resume:function(){return this._experienceBase.getManager("CXPWebEventListenerManager").start(),r.resume(),this._setPlayState(this.ePlayState.ePlaying),e.Promise.resolve()},pause:function(){return this.getPlayState()===this.ePlayState.ePlaying&&(this._experienceBase.getManager("CXPWebEventListenerManager").stop(),r.pause(),this._setPlayState(this.ePlayState.ePause)),e.Promise.resolve()},stop:function(){this.getPlayState()!==this.ePlayState.ePlaying&&this.getPlayState()!==this.ePlayState.ePause||(this._setPlayState(this.ePlayState.eStopping),this._restoreAuthoringCursor(),n.deactivateExperience(),r.stop(),n.disposeExperience(),this._experienceBase.getManager("CXPWebEventListenerManager").stop(),n.disposeContext(),this._experienceBase.getManager("CAT3DExperienceESExportManager").cleanProjectedESObjectMap(),s.GetExperience().QueryInterface("CATI3DXVolatileEO").restorePersistent(),this._removeVolatilesObjects(),this._setPlayState(this.ePlayState.eStop));return e.Promise.resolve()},isPlaying:function(){return this.getPlayState()===this.ePlayState.ePlaying},_setPlayCursor:function(){var e=0;this.onClickableEnterEvent=function(){e++,document.body.style.cursor="pointer"},this.onClickableExitEvent=function(){0===--e&&(document.body.style.cursor="default")};var t=o.getEventByType("ClickableEnterEvent");o.addObjectListener(t,this,"onClickableEnterEvent");var n=o.getEventByType("ClickableExitEvent");o.addObjectListener(n,this,"onClickableExitEvent"),document.body.style.cursor="default"},_restoreAuthoringCursor:function(){var e=o.getEventByType("ClickableEnterEvent");o.removeObjectListener(e,this,"onClickableEnterEvent");var t=o.getEventByType("ClickableExitEvent");o.removeObjectListener(t,this,"onClickableExitEvent"),document.body.style.cursor="auto"},createVolatileeObjectFromTemplate:function(e,t,n,r,i){var o=s.getObjectBuilder()._createVolatileComponentFromTemplate(e,t,n,r,i);return this._experienceBase.getManager("CAT3DExperienceESExportManager").exportSubExperienceObject(o)},createVolatileObjectFromPrototype:function(e,t,n,r,i){var o=s.getObjectBuilder(),a=this;return o._createVolatileComponentFromPrototype(e,t,n,r,i).then((function(e){return a._experienceBase.getManager("CAT3DExperienceESExportManager").exportSubExperienceObject(e)}))},removeVolatileObject:function(e){this._experienceBase.getManager("CAT3DExperienceESExportManager").removeProjectedESObject(e),s.getObjectBuilder()._removeVolatileComponent(e)},_removeVolatilesObjects:function(){s.getObjectBuilder()._removeVolatilesObjects()},GetType:function(){return"CXPWebPlayManager"}});return u})),define("DS/XCTWebCreativeAppPlay/StuXRControllerManagerAVP",["DS/StuCore/StuContext","DS/StuCore/StuManager","DS/CAT3DExpModel/CAT3DXModel","DS/EPInputs/EPDevice","DS/EPInputs/EPDevicePressEvent","DS/EPInputs/EPDeviceReleaseEvent","DS/EPInputs/EPDeviceTrackerEvent"],(function(e,t,n,r,i,o,s){"use strict";var a=function(){t.call(this),this._rightControllers=[],this._leftControllers=[],this.name="XRControllerManagerAVP"};return(a.prototype=new t).constructor=a,a.prototype.getCurrentRightController=function(e){for(let e=0;e<this._rightControllers.length;e++)if(this._rightControllers[e].isActive())return this._rightControllers[e]},a.prototype.getCurrentLeftController=function(e){for(let e=0;e<this._leftControllers.length;e++)if(this._leftControllers[e].isActive())return this._leftControllers[e]},a.prototype.registerController=function(e){1===e.deviceID||14===e.deviceID?this._rightControllers.push(e):2===e.deviceID||15===e.deviceID?this._leftControllers.push(e):console.warn("XRControllerManagerAVP.registerController, unkown deviceID")},a.prototype.unregisterController=function(e){if(1===e.deviceID||14===e.deviceID){let t=this._rightControllers.indexOf(e);-1!==t&&this._rightControllers.splice(t,1)}else if(2===e.deviceID||15===e.deviceID){let t=this._leftControllers.indexOf(e);-1!==t&&this._leftControllers.splice(t,1)}else console.warn("XRControllerManagerAVP.unregisterController, unkown deviceID")},a.prototype.onInitialize=function(){const e=n.GetExperience()._experienceBase.getManager("CAT3DXAVPComManager");e&&(e.registerCommandFromSwift("onXRControllerTransformReceived",(e=>{const t=e.matrixRight,n=e.vectorRight,i=e.matrixLeft,o=e.vectorLeft,a=this.getCurrentRightController(),u=this.getCurrentLeftController();if(a){let e=a.getTransform().clone();e.matrix.coef=t,e.vector.x=n[0],e.vector.y=n[1],e.vector.z=n[2],a.setTransform(e);let r=new DSMath.Vector3D(e.matrix.coef[0],e.matrix.coef[3],e.matrix.coef[6]),i=new DSMath.Vector3D(e.matrix.coef[1],e.matrix.coef[4],e.matrix.coef[7]);a.rotateAround(a.getPosition(),r,-Math.PI/2),a.rotateAround(a.getPosition(),i,Math.PI)}if(u){let e=u.getTransform().clone();e.matrix.coef=i,e.vector.x=o[0],e.vector.y=o[1],e.vector.z=o[2],u.setTransform(e);let t=new DSMath.Vector3D(e.matrix.coef[0],e.matrix.coef[3],e.matrix.coef[6]),n=new DSMath.Vector3D(e.matrix.coef[1],e.matrix.coef[4],e.matrix.coef[7]);u.rotateAround(u.getPosition(),t,Math.PI/2),u.rotateAround(u.getPosition(),n,Math.PI)}this.myDevice||(this.myDevice=new r);var c={};c.trackerValue=t.concat(n),c.tracker=1,c.trackerName="controllerTracker_1",c.device=this.myDevice;var l=new s(c);l.trackerValue=t.concat(n),l.tracker=1,l.trackerName="controllerTracker_1",l.device=this.myDevice,EP.EventServices.dispatchEvent(l);var p={};p.trackerValue=i.concat(o),p.tracker=2,p.trackerName="controllerTracker_2",p.device=this.myDevice;var d=new s(p);d.trackerValue=i.concat(o),d.tracker=2,d.trackerName="controllerTracker_2",d.device=this.myDevice,EP.EventServices.dispatchEvent(d)})),e.registerCommandFromSwift("onSpatialPress",(e=>{this.myDevice||(this.myDevice=new r);let t=0,o="buttonName",s=1,a="trackerName";"right"===e.hand?(t=4,o="bTrigger_1",s=1,a="controllerTracker_1"):"left"===e.hand?(t=12,o="bTrigger_2",s=2,a="controllerTracker_2"):console.error("wrong definition of controller direction");const u=n.GetExperience()._experienceBase,c=u.getManager("CAT3DExperienceESExportManager"),l=u.ComponentsMap.GetComponentFromID(e.pathOfIds);let p=c.getProjectedESObject(l);var d={index:0};d.button=t,d.buttonName=o,d.device=this.myDevice,d.actor=p,d.tracker=s,d.trackerName=a;var h=new i(d);h.index=0,h.button=t,h.buttonName=o,h.device=this.myDevice,h.actor=p,h.tracker=s,h.trackerName=a,EP.EventServices.dispatchEvent(h)})),e.registerCommandFromSwift("onSpatialRelease",(e=>{let t=0,n="buttonName",r=1,i="trackerName";"right"===e.hand?(t=4,n="bTrigger_1",r=1,i="controllerTracker_1"):"left"===e.hand?(t=12,n="bTrigger_2",r=2,i="controllerTracker_2"):console.error("wrong definition of controller direction");var s={index:0};s.button=t,s.buttonName=n,s.device=this.myDevice,s.tracker=r,s.trackerName=i;var a=new o(s);a.index=0,a.button=t,a.buttonName=n,a.device=this.myDevice,a.tracker=r,a.trackerName=i,EP.EventServices.dispatchEvent(a)})))},a.prototype.onDispose=function(){const e=n.GetExperience()._experienceBase.getManager("CAT3DXAVPComManager");e&&(e.unregisterCommandFromSwift("onXRControllerTransformReceived"),e.unregisterCommandFromSwift("onSpatialPress"),e.unregisterCommandFromSwift("onSpatialRelease"))},e.registerManager(a),a})),define("DS/XCTWebCreativeAppPlay/managers/XCTCreativeExperiencePlayerAPIManager",["UWA/Core","UWA/Class","DS/CAT3DExpModel/CAT3DXModel"],(function(e,t,n){"use strict";return t.extend({Dispose:function(){},GetType:function(){return"XCTCreativeExperiencePlayerAPIManager"},play:function(){return this._experienceBase.getManager("CXPWebPlayManager").play()},pause:function(){return this._experienceBase.getManager("CXPWebPlayManager").pause()},stop:function(){return this._experienceBase.getManager("CXPWebPlayManager").stop()},isPlaying:function(){return this._experienceBase.getManager("CXPWebPlayManager").isPlaying()},muteAll:function(){var e=this._experienceBase.getManager("CXPWebSoundManager");if(e)return e.mute()},unmuteAll:function(){var e=this._experienceBase.getManager("CXPWebSoundManager");if(e)return e.unmute()},getScenes:function(){return this._getScenes().map((function(e){return e.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName")}))},getCurrentScene:function(){var e=this._getCurrentScene();if(e)return e.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName")},playScene:function(e){if(this.isPlaying()){var t=this._getSceneByName(e);if(t)this._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(t).activate();else console.warn(e+" doesnt exist")}else console.warn("The experience must be playing to play a scene")},getPermanentActs:function(){return this._getPermanentActs().map((function(e){return e.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName")}))},playPermanentAct:function(e){if(this.isPlaying()){var t=this._getPermanentActByName(e);if(t)this._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(t).starts();else console.warn(e+" doesnt exist")}else console.warn("The experience must be playing to play an act")},getCurrentPermanentAct:function(){if(this.isPlaying()){var e=this._getPermanentScenario();if(e)return this._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(e).GetCurrentAct().name}},getActsFromScene:function(e){return this._getActsFromScene(e).map((function(e){return e.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName")}))},playActFromCurrentScene:function(e){if(this.isPlaying()){var t=this.getCurrentScene(),n=this._getActFromSceneByName(t,e);if(n)this._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(n).starts();else console.warn(e+" doesnt exist")}else console.warn("The experience must be playing to play an act")},getCurrentActFromCurrentScene:function(){if(this.isPlaying()){var e=this.getCurrentScene(),t=this._getScenarioFromScene(e);if(t){var n=this._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(t);if(null!=n)return n.GetCurrentAct().name}}},_getScenes:function(){var e=n.GetExperience();return e?e.QueryInterface("CATI3DExperienceObject").GetValueByName("scenes"):[]},_getSceneByName:function(e){for(var t=this._getScenes(),n=0;n<t.length;n++)if(e===t[n].QueryInterface("CATI3DExperienceObject").GetValueByName("_varName"))return t[n]},_getCurrentScene:function(){var e=n.GetExperience();if(e){var t=e.QueryInterface("CATI3DExperienceObject").GetValueByName("currentScene");if(t)return t}},_getPermanentActs:function(){var e=this._getPermanentScenario();return e?e.QueryInterface("CATI3DExperienceObject").GetValueByName("acts"):[]},_getPermanentActByName:function(e){for(var t=this._getPermanentActs(),n=0;n<t.length;n++)if(e===t[n].QueryInterface("CATI3DExperienceObject").GetValueByName("_varName"))return t[n]},_getPermanentScenario:function(){var e=n.GetExperience();if(!e)return[];var t=e.QueryInterface("CATI3DExperienceObject").GetValueByName("scenarios");return t&&1===t.length?t[0]:void 0},_getActsFromScene:function(e){var t=this._getScenarioFromScene(e);return t?t.QueryInterface("CATI3DExperienceObject").GetValueByName("acts"):[]},_getActFromSceneByName:function(e,t){for(var n=this._getActsFromScene(e),r=0;r<n.length;r++)if(t===n[r].QueryInterface("CATI3DExperienceObject").GetValueByName("_varName"))return n[r]},_getScenarioFromScene:function(e){return this._getSceneByName(e).QueryInterface("CATI3DExperienceObject").GetValueByName("scenario")}})})),define("DS/XCTWebCreativeAppPlay/StuSoundListenerWrapperWeb",[],(function(){"use strict";var e=function(){};return e.prototype.getVolume=function(){if(void 0!==this.listener)return this.listener._volume},e.prototype.setVolume=function(e){if(void 0!==this.listener&&(this.listener._volume=e),void 0!==this.listSoundPlayers)for(let t of this.listSoundPlayers)t.setListenerVolume(e)},e.prototype.setTransformation=function(e){var t=e.vector,n=e.matrix.getFirstColumn(),r=e.matrix.getThirdColumn();void 0!==t&&void 0!==n&&void 0!==r&&(this.setPosition(t),this.setOrientation(n,r))},e.prototype.setPosition=function(e){if(void 0!==this.listener&&(this.listener._position=e),void 0!==this.listSoundPlayers)for(let t of this.listSoundPlayers)t.setListenerPosition(e)},e.prototype.setOrientation=function(e,t){if(void 0!==this.listener&&(this.listener._forward=e,this.listener._up=t),void 0!==this.listSoundPlayers)for(let n of this.listSoundPlayers)n.setListenerDirection(e,t)},e})),define("DS/XCTWebCreativeAppPlay/StuSoundSourceWrapperWeb",["DS/VENHowler/2.2.3/dist/howler"],(function(e){"use strict";var t=function(){};const n=function(e){return e*(180/Math.PI)},r=function(e){return e*(Math.PI/180)};return t.prototype.initEngine=function(){this.resource=null,void 0!==this.sound&&null!==this.sound&&this.sound.unload(),e&&e.Howler&&(e.Howler.pos(0,0,0),e.Howler.orientation(0,0,-1,0,1,0))},t.prototype.playSoundEngine=function(){this.initEngine()},t.prototype.stopSoundEngine=function(){this.initEngine(),this.mustResetWrappers=!0},t.prototype.getEngineStatus=function(){let e=-1;return null!==this.sound&&void 0!==this.sound&&(this.isPaused()?e=0:this.isPlaying()?e=1:this.isStopped()&&(e=2)),e},t.prototype.setResource=function(t){if(null===t)return;let n=this;return t._modelObject.QueryInterface("CATI3DXSoundResourceAsset").getSound().then((function(r){if(void 0!==n.resource&&null!==n.resource&&n.resource.src===r.src)return;n.resource=r;const i=r.src;void 0!==n.sound&&(n.isPlaying()?n.mustPlay=!0:n.mustPlay=!1,n.sound.unload());var o=t._modelObject.QueryInterface("CATI3DXSoundResourceAsset").getExtension();n.sound=new e.Howl({src:[i],format:[o],html5:!1,autoplay:void 0!==n.mustPlay&&n.mustPlay,volume:void 0!==n.volume?n.volume:1,loop:void 0===n.mustLoop||n.mustLoop,spatial:void 0===n.mustSpatialize||n.mustSpatialize,rate:void 0!==n.speed?n.speed:1,orientation:[1,0,0],stereo:0,pos:[0,0,0],coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"exponential",maxDistance:1e4,refDistance:1,rolloffFactor:1,panningModel:"HRTF",onstart:function(){console.log("start!")},onpause:function(){n.isPausedNotStopped=!0},onstop:function(){n.isPausedNotStopped=!1}})})).then((function(e){return e})).catch((function(e){return UWA.Promise.reject(e)}))},t.prototype.getConeInnerAngle=function(){return null!==this.sound&&void 0!==this.sound?r(this.sound.pannerAttr.coneInnerAngle):-1},t.prototype.setConeInnerAngle=function(e){return null!==this.sound&&void 0!==this.sound?(this.sound.pannerAttr.coneInnerAngle=n(e),1):-1},t.prototype.getConeOuterAngle=function(){return null!==this.sound&&void 0!==this.sound?r(this.sound.pannerAttr.coneOuterAngle):-1},t.prototype.setConeOuterAngle=function(e){return null!==this.sound&&void 0!==this.sound?(this.sound.pannerAttr.coneOuterAngle=n(e),1):-1},t.prototype.getRollOffFactor=function(){return null!==this.sound&&void 0!==this.sound?this.sound.pannerAttr.rolloffFactor:-1},t.prototype.setRollOffFactor=function(e){return null!==this.sound&&void 0!==this.sound?(this.sound.pannerAttr.rolloffFactor=e,1):-1},t.prototype.getTempo=function(){return-1},t.prototype.setTempo=function(e){return-1},t.prototype.getVolume=function(){return null!==this.sound&&void 0!==this.sound?this.sound.volume():-1},t.prototype.setVolume=function(e){null!==this.sound&&void 0!==this.sound&&e>0?this.sound.volume(e):e>0&&(this.volume=e)},t.prototype.getPitch=function(){return null!==this.sound&&void 0!==this.sound?this.sound.rate():-1},t.prototype.setPitch=function(e){null!==this.sound&&void 0!==this.sound&&e>.001?this.sound.rate(e):e>.001&&(this.pitch=e)},t.prototype.setTransformation=function(e){var t=e.vector,n=e.matrix.getFirstColumn();void 0!==t&&void 0!==n&&(this.setPosition(t),this.setDirection(n))},t.prototype.setPosition=function(e){null!==this.sound&&void 0!==this.sound&&"loaded"===this.sound.state()?this.sound.pos(e.x,e.y,e.z):this.position=e},t.prototype.setDirection=function(e){null!==this.sound&&void 0!==this.sound&&"loaded"===this.sound.state()?this.sound.orientation(e.x,e.y,e.z):this.direction=e},t.prototype.setSpeed=function(e){null!==this.sound&&void 0!==this.sound?this.sound.rate(e.x):this.speed=e.x},t.prototype.isLooping=function(){return null!==this.sound&&void 0!==this.sound&&this.sound.loop()},t.prototype.getPlayPostion=function(){if(null!==this.sound&&void 0!==this.sound&&0!==this.sound.duration()){let e=-1;return e=this.sound.seek()/this.sound.duration()*100,e}return-1},t.prototype.getDuration=function(){return null!==this.sound&&void 0!==this.sound&&0!==this.sound.duration()?this.sound.duration():-1},t.prototype.setSpatialized=function(e){null!==this.sound&&void 0!==this.sound?this.sound.spatial=e:this.mustSpatialize=e},t.prototype.setLoopMode=function(e){null!==this.sound&&void 0!==this.sound?this.sound.loop(e):this.mustLoop=e},t.prototype.setListenerVolume=function(t){e&&e.Howler&&e.Howler.volume(t)},t.prototype.setListenerPosition=function(t){null!==this.sound&&void 0!==this.sound&&"loaded"===this.sound.state()&&e&&e.Howler&&e.Howler.pos(t.x,t.y,t.z)},t.prototype.setListenerDirection=function(t,n){null!==this.sound&&void 0!==this.sound&&"loaded"===this.sound.state()&&n&&e&&e.Howler&&e.Howler.orientation(t.x,t.y,t.z,n.x,n.y,n.z)},t.prototype.play=function(){null!==this.sound&&void 0!==this.sound?(this.sound.playing()&&this.sound.stop(),this.sound.play()):this.mustPlay=!0},t.prototype.pause=function(){null!==this.sound&&void 0!==this.sound&&this.isPlaying()&&this.sound.pause()},t.prototype.stop=function(){null===this.sound||void 0===this.sound||this.isStopped()||this.sound.stop()},t.prototype.isPlaying=function(){return null!==this.sound&&void 0!==this.sound&&this.sound.playing()},t.prototype.isPaused=function(){return null!==this.sound&&void 0!==this.sound&&!this.sound.playing()&&this.isPausedNotStopped},t.prototype.isStopped=function(){return null!==this.sound&&void 0!==this.sound&&!this.sound.playing()&&!this.isPausedNotStopped},t})),define("DS/XCTWebCreativeAppPlay/commands/XCTWebSoundMuteCmd",["UWA/Core","UWA/Class/Listener","DS/ApplicationFrame/Command"],(function(e,t,n){"use strict";return e.Class.extend(n,t,{init:function(e){this._parent(e,{isAsynchronous:!0});var t=this.getFrameWindow(),n=t._experienceBase;this.listenTo(n.getManager("CXPWebPlayManager"),"PlayStateChanged",this._switchEnableFromPlayState.bind(this)),t.getActionBar().onActionBarReady((()=>{this.getFrameWindow()._actionBar.elements.container.getChildren()[0].getChildren()[2].getChildren()[1].getChildren()[0].getChildren()[5].hide()}))},beginExecute:function(){this._soundUnmute(),this.done()},endExecute:function(){this._soundUnmute(),this.done()},_soundUnmute:function(){var e=this.getFrameWindow()._experienceBase;if(e){var t=e.getManager("CXPWebSoundManager");t&&t.unmute()}},_switchEnableFromPlayState:function(e){var t=this.getFrameWindow()._experienceBase;if(t){var n=t.getManager("CXPWebPlayManager");n.ePlayState.ePlaying===e||n.ePlayState.ePause===e?this.enable():this.disable()}}})})),define("DS/XCTWebCreativeAppPlay/commands/XCTWebSoundCmd",["UWA/Core","UWA/Class/Listener","DS/ApplicationFrame/Command"],(function(e,t,n){"use strict";return e.Class.extend(n,t,{init:function(e){this._parent(e,{isAsynchronous:!0});var t=this.getFrameWindow()._experienceBase;this.listenTo(t.getManager("CXPWebPlayManager"),"PlayStateChanged",this._switchEnableFromPlayState.bind(this)),this._isExperiencePlaying=!1,this._resumeSoundOnNextPlay=!1;var n=t.getManager("CXPWebSoundManager");n&&this.listenTo(n,"SoundMuteStateChanged",this._switchMuteImageIcon.bind(this))},beginExecute:function(){this._soundMute(),this.done()},endExecute:function(){this._soundMute(),this.done()},_soundMute:function(){var e=this.getFrameWindow()._experienceBase;if(e){var t=e.getManager("CXPWebSoundManager");t&&t.mute()}},_switchMuteImageIcon:function(e){e?(this.getFrameWindow()._actionBar.elements.container.getChildren()[0].getChildren()[2].getChildren()[1].getChildren()[0].getChildren()[4].hide(),this.getFrameWindow()._actionBar.elements.container.getChildren()[0].getChildren()[2].getChildren()[1].getChildren()[0].getChildren()[5].show()):(this.getFrameWindow()._actionBar.elements.container.getChildren()[0].getChildren()[2].getChildren()[1].getChildren()[0].getChildren()[5].hide(),this.getFrameWindow()._actionBar.elements.container.getChildren()[0].getChildren()[2].getChildren()[1].getChildren()[0].getChildren()[4].show())},_switchEnableFromPlayState:function(e){var t=this.getFrameWindow()._experienceBase;if(t){var n=t.getManager("CXPWebPlayManager");n.ePlayState.ePlaying===e||n.ePlayState.ePause===e?this.enable():this.disable(),e===n.ePlayState.ePlaying?this._playFromExperience():e===n.ePlayState.ePause&&this._pauseFromExperience()}},_playFromExperience:function(){if(this._isExperiencePlaying=!0,this._resumeSoundOnNextPlay){this._resumeSoundOnNextPlay=!1;var e=this.getFrameWindow()._experienceBase;if(!e)return;var t=e.getManager("CXPWebSoundManager");t&&t.play()}},_pauseFromExperience:function(){var e=this.getFrameWindow()._experienceBase;if(e){var t=e.getManager("CXPWebSoundManager");t&&t.pause(),this._isExperiencePlaying=!1,this._resumeSoundOnNextPlay=!0}}})})),define("DS/XCTWebCreativeAppPlay/managers/CXPWebPlayDependanciesManager",["UWA/Core","UWA/Class","DS/XCTWebCreativeAppPlay/StuTriggerZoneManagerWeb"],(function(e){"use strict";return e.Class.extend({GetType:function(){return"CXPWebPlayDependanciesManager"}})})),define("DS/XCTWebCreativeAppPlay/extensions/StuEXRHandPrototypeBuild",["UWA/Core","DS/XCTWebExperienceAppPlay/extensions/StuE3DActorPrototypeBuild","DS/XCTWebCreativeAppPlay/StuXRControllerManagerAVP"],(function(e,t,n){"use strict";return t.extend({build:function(e){return this._parent(e).then((t=>(n.getInstance().registerController(e),t)))},disposeESObject:function(e){n.getInstance().unregisterController(e),this._parent(e)}})})),define("DS/XCTWebCreativeAppPlay/extensions/StuEXRControllerPrototypeBuild",["UWA/Core","DS/XCTWebExperienceAppPlay/extensions/StuE3DActorPrototypeBuild","DS/XCTWebCreativeAppPlay/StuXRControllerManagerAVP"],(function(e,t,n){"use strict";return t.extend({build:function(e){return this._parent(e).then((t=>(n.getInstance().registerController(e),t)))},disposeESObject:function(e){n.getInstance().unregisterController(e),this._parent(e)}})})),define("DS/XCTWebCreativeAppPlay/extensions/StuESoundListenerPrototypeBuild",["UWA/Core","DS/XCTWebExperienceAppPlay/extensions/StuEExperienceBasePrototypeBuild","DS/XCTWebCreativeAppPlay/StuSoundListenerWeb"],(function(e,t){"use strict";return t.extend({})})),define("DS/XCTWebCreativeAppPlay/StuSoundSourceWrapperAVP",["DS/XCTWebCreativeAppPlay/StuSoundSourceWrapperManagerAVP"],(function(e){"use strict";var t=function(e){this.soundPlayerBehavior=e};const n=function(e){return e*(180/Math.PI)},r=function(e){return e*(Math.PI/180)};return t.prototype.initEngine=function(){this.resource=null},t.prototype.playSoundEngine=function(){this.initEngine()},t.prototype.stopSoundEngine=function(){this.initEngine(),this.mustResetWrappers=!0},t.prototype.getEngineStatus=function(){let e=-1;return null!==this.isPlayingFlag&&void 0!==this.isPlayingFlag&&(this.isPaused()?e=0:this.isPlaying()?e=1:this.isStopped()&&(e=2)),e},t.prototype.setResource=function(t){if(null===t)return;return this.soundHasFinishedLoading=!1,t._modelObject.QueryInterface("CATI3DXSoundResourceAsset").getSound().then((async n=>{if(void 0!==this.resource&&null!==this.resource&&this.resource.src===n.src)return;this.resource=n;const r=e.getAVPManager();void 0!==this.pathOfIds&&this.isPlaying()&&(this.mustPlay=!0);const i=t._modelObject.QueryInterface("CATI3DXSoundResourceAsset").getName(),o=this.soundPlayerBehavior.CATI3DExperienceObject._modelObject.QueryInterface("CATI3DExperienceObject").GetPathOfIds().toString();if(this.pathOfIds=o,this.initEngine(),console.log("Instantiate AVP sound file"),r){void 0===this.isLoop&&(this.isLoop=!1),r.sendCommandToSwift("SendSoundFileNameAsync",{fileName:i,pathOfIds:o,mustLoop:this.isLoop}).then((e=>{this.soundHasFinishedLoading=!0,this.mustPlay&&(this.mustPlay=!1,this.play()),this.mustSpatialize&&this.setSpatialized(this.mustSpatialize)}))}})).then((e=>e)).catch((e=>UWA.Promise.reject(e)))},t.prototype.getConeInnerAngle=function(){return null!==this.sound&&void 0!==this.sound?r(this.sound.pannerAttr.coneInnerAngle):-1},t.prototype.setConeInnerAngle=function(e){return null!==this.sound&&void 0!==this.sound?(this.sound.pannerAttr.coneInnerAngle=n(e),1):-1},t.prototype.getConeOuterAngle=function(){return null!==this.sound&&void 0!==this.sound?r(this.sound.pannerAttr.coneOuterAngle):-1},t.prototype.setConeOuterAngle=function(e){return null!==this.sound&&void 0!==this.sound?(this.sound.pannerAttr.coneOuterAngle=n(e),1):-1},t.prototype.getRollOffFactor=function(){return null!==this.sound&&void 0!==this.sound?this.sound.pannerAttr.rolloffFactor:-1},t.prototype.setRollOffFactor=function(e){return null!==this.sound&&void 0!==this.sound?(this.sound.pannerAttr.rolloffFactor=e,1):-1},t.prototype.getTempo=function(){return-1},t.prototype.setTempo=function(e){return-1},t.prototype.getVolume=function(){return this.volume},t.prototype.setVolume=function(t){const n=e.getAVPManager();n&&void 0!==this.pathOfIds&&t>0?(n.sendCommandToSwift("SetVolumeSoundAsync",{pathOfIds:this.pathOfIds,value:t}),this.volume=t):t>0&&(this.volume=t)},t.prototype.getPitch=function(){return this.speed},t.prototype.setPitch=function(t){const n=e.getAVPManager();n&&void 0!==this.pathOfIds&&t>.001?(n.sendCommandToSwift("SetSpeedSoundAsync",{pathOfIds:this.pathOfIds,value:t}),this.speed=t):t>.001&&(this.speed=t)},t.prototype.setTransformation=function(e){var t=e.vector,n=e.matrix.getFirstColumn();void 0!==t&&void 0!==n&&(this.setPosition(t),this.setDirection(n))},t.prototype.setPosition=function(t){const n=e.getAVPManager();n&&void 0!==this.pathOfIds?n.sendCommandToSwift("SetPositionSoundAsync",{pathOfIds:this.pathOfIds,vector:[t.x,t.y,t.z]}):this.position=t},t.prototype.setDirection=function(t){e.getAVPManager()&&void 0!==this.pathOfIds||(this.direction=t)},t.prototype.setSpeed=function(e){this.setPitch(e.x)},t.prototype.isLooping=function(){return this.isLoop},t.prototype.getPlayPostion=function(){return this.playPosition},t.prototype.getDuration=async function(){const t=e.getAVPManager();if(!t||!this.pathOfIds)throw new Error("avpComManager or pathOfIds udnefined");try{const e=await t.sendCommandToSwift("GetDurationSoundAsync",{pathOfIds:this.pathOfIds});return this.duration=e,this.duration}catch(e){throw new Error(`Error while trying to get duration : ${e.message}`)}},t.prototype.setSpatialized=function(t){if(void 0===STU.Experience.getCurrent())return;const n=e.getAVPManager();n&&this.pathOfIds?n.sendCommandToSwift("SetSpatializationSoundAsync",{pathOfIds:this.pathOfIds,boolean:t}):this.mustSpatialize=t},t.prototype.setLoopMode=function(e){void 0!==STU.Experience.getCurrent()&&(this.isLoop=e)},t.prototype.setListenerVolume=function(t){e.getAVPManager()},t.prototype.setListenerPosition=function(t){const n=e.getAVPManager();null!==this.sound&&void 0!==this.sound&&"loaded"===this.sound.state()&&n&&n.pos(t.x,t.y,t.z)},t.prototype.setListenerDirection=function(t,n){const r=e.getAVPManager();null!==this.sound&&void 0!==this.sound&&"loaded"===this.sound.state()&&n&&r&&r.orientation(t.x,t.y,t.z,n.x,n.y,n.z)},t.prototype.play=function(){const t=e.getAVPManager();t&&void 0!==this.pathOfIds&&!0===this.soundHasFinishedLoading?t.sendCommandToSwift("PlaySoundAsync",{pathOfIds:this.pathOfIds}):this.mustPlay=!0,this.playPosition=1},t.prototype.pause=function(){if(void 0===STU.Experience.getCurrent())return;const t=e.getAVPManager();t&&this.pathOfIds&&t.sendCommandToSwift("PauseSoundAsync",{pathOfIds:this.pathOfIds}),this.isPausedNotStopped=!0},t.prototype.stop=function(){if(void 0===STU.Experience.getCurrent())return;const t=e.getAVPManager();t&&this.pathOfIds&&t.sendCommandToSwift("StopSoundAsync",{pathOfIds:this.pathOfIds}),this.isPausedNotStopped=!1,this.playPosition=0},t.prototype.isPlaying=function(){const t=e.getAVPManager();if(t&&this.pathOfIds){t.sendCommandToSwift("GetSoundIsPlayingSync",{pathOfIds:this.pathOfIds}).then((e=>{this.isPlayingFlag=e}))}return this.isPlayingFlag},t.prototype.isPaused=function(){return this.isPlaying()&&this.isPausedNotStopped},t.prototype.isStopped=function(){return this.isPlaying()&&!this.isPausedNotStopped},t})),define("DS/XCTWebCreativeAppPlay/StuSoundSourceWrapperManagerAVP",["DS/XCTWebCreativeAppPlay/StuSoundSourceWrapperAVP"],(function(e){"use strict";return{getAVPManager:function(){let e=STU.Experience.getCurrent();if(e){let t=e.CATI3DExperienceObject.getModelObject()._experienceBase.getManager("CAT3DXAVPComManager");return this.avpComManager===t||(t&&t.registerCommandFromSwift("onSoundFinished",(t=>{let n=e.CATI3DExperienceObject.getModelObject()._experienceBase.getManager("CAT3DExperienceESExportManager");const r=e.CATI3DExperienceObject.getModelObject()._experienceBase.ComponentsMap.GetComponentFromID(t);let i=n.getProjectedESObject(r);i&&(i._sndSoundWrapper.playPosition=0)})),this.avpComManager=t),t}}}})),define("DS/XCTWebCreativeAppPlay/extensions/StuESoundPlayerPrototypeBuild",["UWA/Core","DS/XCTWebExperienceAppPlay/extensions/StuEExperienceBasePrototypeBuild","DS/XCTWebCreativeAppPlay/StuSoundPlayerWeb"],(function(e,t){"use strict";return t.extend({})})),define("DS/XCTWebCreativeAppPlay/StuSoundPlayerWeb",["DS/StuSound/StuSoundPlayer","DS/XCTWebCreativeAppPlay/StuSoundSourceWrapperWeb","DS/XCTWebCreativeAppPlay/managers/StuSoundManagerWeb","DS/XCTWebCreativeAppPlay/StuSoundSourceWrapperAVP","DS/StuWebPlayer/StuWebPlayer"],(function(e,t,n,r,i){"use strict";return e.prototype._listSoundPlayers=[],e.prototype.getListSoundWebPlayers=function(){return e.prototype._listSoundPlayers},e.prototype._registerSoundWebPlayer=function(t){e.prototype._listSoundPlayers.push(t)},e.prototype._deleteAllSoundWebPlayer=function(){e.prototype._listSoundPlayers.splice(0,e.prototype._listSoundPlayers.length)},e.prototype.buildWrapper=function(){if(e.prototype._listSoundPlayers.length>0){let t=e.prototype._listSoundPlayers[e.prototype._listSoundPlayers.length-1];null!==t&&!0===t.mustResetWrappers&&e.prototype._deleteAllSoundWebPlayer()}if(i.getInstance().isAVPEnabled()){let t=new r(this);return e.prototype._registerSoundWebPlayer(t),t}{let n=new t;return e.prototype._registerSoundWebPlayer(n),n}},e})),define("DS/XCTWebCreativeAppPlay/managers/CXPWebSoundManager",["UWA/Core","UWA/Class/Events","DS/XCTWebCreativeAppPlay/StuSoundPlayerWeb"],(function(e,t,n){"use strict";return e.Class.extend(t,{Build:function(){this.pausedSoundPlayers=[]},Dispose:function(){delete this.pausedSoundPlayers},mute:function(){let e=n.prototype.getListSoundWebPlayers();for(let t of e)void 0!==t&&void 0!==t.sound&&t.sound.mute(!0);this.dispatchEvent("SoundMuteStateChanged",!0)},unmute:function(){let e=n.prototype.getListSoundWebPlayers();for(let t of e)void 0!==t&&void 0!==t.sound&&t.sound.mute(!1);this.dispatchEvent("SoundMuteStateChanged",!1)},play:function(){n.prototype.getListSoundWebPlayers();for(let e of this.pausedSoundPlayers)void 0!==e&&e.play()},pause:function(){let e=n.prototype.getListSoundWebPlayers();for(let t of e)void 0!==t&&t.isPlaying()&&(t.pause(),this.pausedSoundPlayers.push(t))},GetType:function(){return"CXPWebSoundManager"}})})),define("DS/XCTWebCreativeAppPlay/StuSoundListenerWeb",["DS/StuSound/StuSoundListener","DS/XCTWebCreativeAppPlay/StuSoundListenerWrapperWeb","DS/XCTWebCreativeAppPlay/StuSoundPlayerWeb"],(function(e,t,n){"use strict";return e.prototype.buildWrapper=function(){let e=this,r=new t;return void 0!==r&&(r.listSoundPlayers=n.prototype.getListSoundWebPlayers(),r.listener=e),r},e})),define("DS/XCTWebCreativeAppPlay/managers/StuSoundManagerWeb",["UWA/Core","DS/StuSound/StuSoundManager","DS/XCTWebCreativeAppPlay/managers/CXPWebSoundManager"],(function(e,t){"use strict";return t.prototype.mute=function(){var e=STU.Experience.getCurrent().CATI3DExperienceObject.getModelObject()._experienceBase.getManager("CXPWebSoundManager");void 0!==e&&"function"==typeof e.mute&&e.mute()},t.prototype.unmute=function(){var e=STU.Experience.getCurrent().CATI3DExperienceObject.getModelObject()._experienceBase.getManager("CXPWebSoundManager");void 0!==e&&"function"==typeof e.unmute&&e.unmute()},t}));