/*!  COPYRIGHT DASSAULT SYSTEMES 2014   */
define("DS/SNSearchUX/helpers/SmartspeechUtils",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","UWA/Promise","DS/SNInfraUX/Logger"],(function(e,t,n,i,s,o){"use strict";return t.singleton(i,n,{name:"DS_SmartspeechUtils",_SpeechRecognition:null,_SpeechGrammarList:null,init:function(){this._SpeechRecognition=null},build:function(t,n,i,s){let o=this;if(null===o._SpeechRecognition){o._SpeechRecognition=new webkitSpeechRecognition,o._SpeechGrammarList=new webkitSpeechGrammarList;let a="en-US";navigator&&navigator.languages&&e.is(navigator.languages,"array")&&navigator.languages.length>0&&(a=navigator.languages[0]),o._SpeechRecognition.lang=a,o._SpeechRecognition.onerror=s,o._SpeechRecognition.onnomatch=i,o._SpeechRecognition.onresult=t,o._SpeechRecognition.onspeechend=n}},start:function(){let t=this;e.is(t._SpeechRecognition)&&t._SpeechRecognition.start()},stop:function(){let t=this;e.is(t._SpeechRecognition)&&t._SpeechRecognition.stop()},getspeechRecognition:function(){return this._SpeechRecognition}})})),define("DS/SNSearchUX/dropdown/categoryContentView",["DS/SNResultUX/views/helpers/utils/AbstractMultiView","UWA/Core","UWA/Element","DS/SNInfraUX/Logger","DS/TreeModel/TreeDocument","DS/Utilities/Utils","DS/SNInfraUX/SearchUtils","DS/SNResultUX/views/helpers/utils/SearchMultiViewUtils","DS/SNInfraUX/SearchSettings","DS/SNSearchUX/SuggestionUXHelper","DS/SNSearchUX/helpers/GuidedTrackerUtils"],(function(e,t,n,i,s,o,a,r,c,l,d){"use strict";return e.extend({_lastQuery:"",_initCollectionListener:function(e){let t=this;this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){},onSync:function(){},onSetTags:function(e){},OnGroupingChange:function(e){i.log("categoryContentView OnGroupingChange Event",e),t._viewAllProvide=!1,t._refreshViewFromOnGrouping(e)}})},_loadViews:function(e,c){let l=this;require(["DS/SNResultUX/views/WebUX/CollectionView/ResponsiveTilesCollectionView"],(function(u){let h=l.getOptionCommon();h.height="inherit",h.useDragAndDrop=t.is(c)&&t.is(c.useDragAndDrop)?c.useDragAndDrop:!a.isWebInWin(),h.displayedOptionalCellProperties=["contextualMenu","description"],l._utils&&l._utils._isIncontextBuilderMode&&(h.displayedOptionalCellProperties=["description"]);let p=l.multiViewContainer&&l.multiViewContainer.getDimensions(),g=p&&p.height,_=0,m=l.collections.length;for(let a=e;a<m;a++){let e=l.collections[a];try{if(!t.is(e,"object")||0===e.totalCount&&(!t.is(c)||!t.is(c.forceToDisplaySection))){l.views[a]=null,_++;continue}let i,p={inContextBuilderMode:l._utils&&l._utils._isIncontextBuilderMode,guided:c&&c.guided},S={};S.onclick=()=>{p&&p.guided||(d.categoryHeaderTracker(e.headTitle),l._clickOnHeader(e))},c&&c.guided&&(i=new UWA.Element("div",{class:"nlq-brick-resultCount-container"}).inject(l.multiViewContainer));let f=r.createSearchMultiViewLabel(e,l.id,S,!0,p);f.title=e.headTitle,f.id=e.id;let C=n.create("div",{class:"my-content-lens-div wux-controls-abstract wux-controls-button wux-ui-state-primary wux-ui-style-lite","touch-mode":!0,tabindex:"0"}).inject(f);n.create("span",{class:"my-content-lens wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-chevron-right wux-ui-3ds-lg"}).inject(C);if(f.inject(c&&c.guided?i:l.multiViewContainer),c&&c.guided&&c.nlqBrickContainer&&c.nlqBrickContainer.inject(i),!t.is(e,"object")||0===e.totalCount)continue;let y={...h},v=new s({useAsyncPreExpand:!0,shouldAcceptDrag:function(){return!1},shouldAcceptDrop:function(){return!1}});l.collection._treeDocument=v,l.collection.generateTreeModelAsync(e._models,v),y.model=v,y.collection=e,e._treeDocument=v;let b="tile",w=t.is(b)?b:"tile",D={model:y.model,type:w,tag:a};if(-1!==e.totalCount){if("tile"!==b)throw new Error("[MultiView] - incorrect view model given.");if(D.view=l._instantiateResponsiveCollection(u,y,a),D.view&&D.view.onReady((()=>{l.setPoolMultiViewContainerHeight(l.container.scrollHeight);let e=o.debounce((function(e){D.view.requestDelayedModelData(e);let t=D.view._dimensions;l._heightInjected+=48,l._heightInjected+=t&&t.height,l._heightInjected<=g&&a===m-1&&(l._reachBottomEventFire=!0,l._onInfiniteScrollMulti(null,(()=>{l._reachBottomEventFire=!1})))}),1);D.view._updateDimensions(),D.view.invalidateLayout({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1}),D.view._onEndResizeOrOnReadyModelCompletionRequest("OnEndResize"),e("OnResize"),D.view._modelEvents.publish({event:"ENDRESIZE",context:D.view})})),l.views[a]=D,t.is(b)){let e=l.views[a]&&l.views[a].view&&l.views[a].view.getContent();e&&e.inject(l.multiViewContainer)}l._buildViewMore(e,c)}}catch(e){i.log("categoryContentView::_loadViews onFailure: ",e)}}_>0&&(l._reachBottomEventFire=!0,l._onInfiniteScrollMulti(null,(()=>{l._reachBottomEventFire=!1}))),l.unmask()}))},_buildViewMore:function(e){},_onInitTreeDocumentAsyncCB:function(e){let n=this;const{query:s}=e;n._lastQuery!==s&&!0!==n._onGroupingCompute&&(n._emptyViews(),n._resetViews(),n._onGroupingCompute=!0,null!==n.collectionUX&&delete n.collectionUX,n.mask(),l.getSuggestHelper().then((function(){let o=l.getSuggests({search_text:s,nresults:n._nresults?n._nresults:void 0,facets:void 0,select_predicate:["ds6w:label","ds6w:containerUid","ds6w:community","ds6w:modified","ds6w:description","ds6w:responsible","owner","ds6w:responsibleUid","ds6w:type"],feature:c.getOption("fedsearch_query_label.feature_id.InstantSearch")});n.collections=[];let a=0,r=Object.keys(o),d=r.length,u=!1;for(let c=0;c<d;c++){o[r[c]].then((function(i){let o=i.collection,r=o&&o.nhits?o.nhits:o.hits;if(r>0){let e=i.nls,a=i.id,c=i.iconInfo;t.is(c)&&t.is(c.classes)||(c={classes:" fonticon-search"}),o.id=a,o.query=s,o.icon=c,o.headTitle=e,o.totalCount=r,n.collections.push(o),u=!0}a++,a===d&&(!0===u?(n._loadViews(0),n.multiViewContainer&&n.multiViewContainer.show(),u=!0,n._onGroupingCompute=!1,n._lastQuery=s):t.is(e.noresult)&&(n.unmask(),n.multiViewContainer&&n.multiViewContainer.hide(),e.noresult.call(void 0),u=!0),n._onGroupingCompute=!1,n._lastQuery=s)}),(function(o){i.log("categoryContentView::_onInitTreeDocumentAsyncCB onFailure: ",o),t.is(e.noresult)&&(n.unmask(),n.multiViewContainer&&n.multiViewContainer.hide(),u=!0,e.noresult.call(void 0)),n._onGroupingCompute=!1,n._lastQuery=s}))}!1===u&&0===d&&(n.unmask(),n.multiViewContainer&&n.multiViewContainer.hide(),t.is(e.noresult)&&e.noresult.call(void 0),n._onGroupingCompute=!1,n._lastQuery=s)}),(function(o){i.log("categoryContentView::_onInitTreeDocumentAsyncCB onFailure: ",o),t.is(e.noresult)&&(n.unmask(),n.multiViewContainer&&n.multiViewContainer.hide(),haveresults=!0,e.noresult.call(void 0)),n._onGroupingCompute=!1,n._lastQuery=s})))}})})),define("DS/SNSearchUX/dropdown/guidedContentView",["DS/SNSearchUX/dropdown/categoryContentView","UWA/Core","DS/MessageBus/MessageBus","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNSearchUX/helpers/GuidedTrackerUtils","DS/Controls/Button","i18n!DS/SNSearchUX/assets/nls/GuidedMode.json"],(function(e,t,n,i,s,o,a,r,c){"use strict";return e.extend({_initCollectionListener:function(e){this._parent(e),this._onDragStartCell=n.subscribe({channel:"SearchDropDown",topic:"onDragStart",callback:this._onDragStartListen.bind(this)})},_onInitTreeDocumentAsyncCB:function(e){let n=this;const{query:s,nlq:o,utils:r}=e;if(n._utils=r,!0===n._onGroupingCompute)return;n._emptyViews(),n._resetViews(),n._onGroupingCompute=!0,null!==n.collectionUX&&delete n.collectionUX,n.mask();let l=window.devicePixelRatio;l<1&&(l=1/l);let d=n.multiViewContainer&&n.multiViewContainer.getDimensions(),u=d&&d.width,h=d&&d.height;h-=88;let p=Math.ceil(u/486),g=Math.ceil(h/80)*p;g-=g%2?1:2;let _=g>1?g:n.collection.nresults;n.collection._resetState(),n.collection.setRequestCriteria("fed_search",{ignoreRestrictedSources:!1,order_by:"desc",order_field:"relevance",query:s,nlq:o,nresults:_,refine:{allfilters:{},localfilters:{}},select_file:["icon","thumbnail_2d"],source:[],with_synthesis:!1,with_synthesis_hierarchical:!1,next_start:"0"}),n.collection.setPageSize(_),n.collection.fetch({onComplete:function(s,o){i.log("guidedContentView::onComplete: ",o),n.unmask(),n.collections=[];let r=s&&s.nhits?s.nhits:s.hits,l=n._utils._controller&&n._utils._controller._smartQuery?n._utils._controller._smartQuery.length():0;if(a.resultsTracker(l,r),r>0){let t=c.get("search.searchResults.title"),i=n.id,o={classes:" fonticon-search"};s.id=i,s.icon=o,s.headTitle=t,s.totalCount=r,s.pageSize=_,s._guidedMode=!0;let a=!0;n._utils._isIncontextBuilderMode&&(a=!1),s.setSNSkeleton(n._utils.getSNSkeleton()),n._utils.getSNSkeleton()._onesearch_collection=s,n.collections.push(s),n._loadViews(0,{useDragAndDrop:a,onclickViewAll:e.onclickViewAll,guided:c.get("smart.mode.search.results.title"),nlqBrickContainer:n.nlqBrickContainer}),n._onGroupingCompute=!1}else t.is(e.noresult)&&(n.unmask(),n.hideEmptyView(),e.noresult.call(void 0),n._onGroupingCompute=!1)},onFailure:function(e){n.unmask(),n.hideEmptyView(),n._onGroupingCompute=!1,i.log("guidedContentView::onFailure: ",e)}})},_buildViewMore:function(e,n){let i=this;if(i._utils._isIncontextBuilderMode)return;let s=e,o=s.pageSize,l=null;if(s.totalCount>o){c.get("search.result.view.more");l=new r({label:c.get("smart.mode.nlq.seeAll"),class:"nlqModeSearchButton",touchMode:"true",emphasize:"primary"}),l.elements.container.addClassName("nlqModeSearchButton"),l.addEventListener("buttonclick",(()=>{a.seeAllResultsTracker(),t.is(n.onclickViewAll)&&n.onclickViewAll.call(void 0)})),l.inject(i.multiViewContainer),l.onclick=()=>{t.is(n.onclickViewAll)&&n.onclickViewAll.call(void 0)}}},_onDragStartListen:function(e){let t;this._utils&&this._utils.modalVisibility(!1),e&&e[0]&&e[0].getType()&&(t=e[0].getType()),a.DragNDropTracker(t),i.log("guidedContentView::_onDragStartListen")},destroy:function(){n.unsubscribe(this._onDragStartCell),this._parent()}})})),define("DS/SNSearchUX/dropdown/resultsContentView",["DS/SNSearchUX/dropdown/categoryContentView","UWA/Core","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchResultCategories","DS/SNResultUX/utils/ResultCategoryUXHelper"],(function(e,t,n,i,s,o){"use strict";return e.extend({_onInitTreeDocumentAsyncCB:function(e){let t=this;if(!0===t._onGroupingCompute)return;t._emptyViews(),t._resetViews(),t._onGroupingCompute=!0,null!==t.collectionUX&&delete t.collectionUX;let s=t._getEmbeddedTaggerTags(e);void 0!==s&&(t.mask(),o.getResultCategoryUXHelper().then((function(){t.collectionUX=o.getResultsCollections({search_text:t._query,nresults:t._nresults?t._nresults:void 0,categories:s.Tags,facets:t.collection.parsed_response&&t.collection.parsed_response.getTags().summaryData,feature:i.getOption("fedsearch_query_label.feature_id.6WSearch")}),t.collectionUX.getFirstPage({onComplete:function(){let e=t.collectionUX.getCategoryCollectionsList();t.collections=e,t._loadViews(0),t._onGroupingCompute=!1},onFailure:function(e){n.log("resultsContentView::_onInitTreeDocumentAsyncCB onFailure: ",e),t._onGroupingCompute=!1}})})))},fetch:function(e){n.log("resultsContentView::fetch: ",e);let i=this,s=SearchPreferences.getItem("searchSort");i.collection._resetState(),i.collection.getTaggerProxy()&&i.collection.getTaggerProxy().unsetTags(),i.collection.setRequestCriteria("fed_search",{ignoreRestrictedSources:!1,order_by:UWA.is(s)?s.order_by:"desc",order_field:UWA.is(s)?s.order_field:"relevance",query:e.query,refine:{allfilters:{},localfilters:{}},select_file:["icon","thumbnail_2d"],source:[],with_synthesis:!0,with_synthesis_hierarchical:!0,next_start:"0"}),i._query=e.query,t.is(e.count)||(e.count=3),i.collection.setPageSize(e.count);let o=document.body.getElement("#dropdown-search-global-embedded");t.is(o)&&(o=o.querySelector(".embedded-all"),o=o&&o.querySelector(".root-icon-div"),o&&t.Event.dispatchEvent(o,"click")),i.collection.fetch({onComplete:function(s,o){if(n.log("resultsContentView::onComplete: ",o),(s&&s.nhits?s.nhits:s.hits)>0){let e=i.collection.getTaggerProxy();if(t.is(e)){require(["DS/TagNavigator/TagNavigator"],(function(e){let n=e&&e.get6WTagger("DropDownContext");n&&(n.setAsCurrent(),n.focusOnCC("SearchDropDown"));let i=document.body.getElement("#dropdown-search-global-embedded");t.is(i)&&(i=i.querySelector(".embedded-what"),i=i&&i.querySelector(".root-icon-div"),i&&t.Event.dispatchEvent(i,"click"))}))}}else t.is(e.noresult)&&e.noresult.call(void 0)},onFailure:function(e){n.log("resultsContentView::onFailure: ",e)}})}})})),define("DS/SNSearchUX/InContextSearch",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Debug","UWA/Class/Collection","UWA/Promise","UWA/Utils","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SearchPreferences","require","DS/MessageBus/MessageBus","DS/SNInfraUX/Logger"],(function(e,t,n,i,s,o,a,r,c,l,d,u,h,p,g){"use strict";return t.extend(n,i,{_socket:null,_registered_search_ctx:null,_isWidgetMaximized:!1,_pubsub_loaded:!1,init:function(t){this.setDebugMode(r.getDebugMode()),this._socket=c.createSocket({socket_id:"incontextsearch_socket_id"}),this.setOptions(t);var n=this;h(["DS/PubSub/PubSub"],(function(t){n._pubsub_loaded=!0,e.is(t)&&t.add("onViewChange",(function(t){var i,s,o,a=t.widgetId||t.id,c=!1;if(e.is(e.Widgets)&&e.is(e.Widgets.instances)&&(e.Widgets.instances.filter((function(t){return e.is(t.id)&&-1!==t.id.indexOf("preview")&&!t.events.onDestroy})).forEach((function(e){e.addEvent("onDestroy",(function(){n.computeSearchBar&&n.computeSearchBar()}))})),s=(s=e.Widgets.instances.filter((function(e){return e.id===a}))).length>0?s[0]:null),o=e.is(n.getOption("addinMode"),"string")||e.is(s)&&s.getValue("stayOnSearch")||!1,e.is(s)&&!0===s.getValue("noSearchModeChange")&&(c=!0),e.is(n._registered_search_ctx)&&e.is(n.getInContextOptions(a)))(i=n.getInContextOptions(a)).id===a&&("maximized"===t.type||"fullscreen"===t.type?(n._isWidgetMaximized=!0,e.is(i.search_delegation)&&"3ddashboard"===i.search_delegation&&!o?!0===r.getOption("find_in_this_tab_default")&&n._socket.dispatchEvent("onSetFindInTab",i):o||(n._socket.dispatchEvent("onSetInAppContext",{isInAppContext:!0}),n._socket.dispatchEvent("onSetFindInApp",i))):"windowed"!==t.type&&"minimized"!==t.type||(n._isWidgetMaximized=!1,n._socket.dispatchEvent("onSetInAppContext",{isInAppContext:!1}),!0!==r.getOption("find_in_this_tab_default")||o?n._socket.dispatchEvent("clickOnChoiceSearch",{resetNLS:!0,focus:!1}):n._socket.dispatchEvent("onSetFindInTab",null)));else{if(e.is(s)&&(s&&l.checkSearchAppId(s.getValue("appId"))&&n._socket.dispatchEvent("3DSearchWidgetmaximized",t.type),s&&l.checkSearchAppId(s.getValue("appId"))&&("maximized"===t.type||"fullscreen"===t.type)||"3DSearch"===s.title&&-1<s.id.indexOf("preview")))return void(n._isWidgetMaximized=!0);"windowed"!==t.type&&"minimized"!==t.type||(n._isWidgetMaximized=!1,n._socket.dispatchEvent("onSetInAppContext",{isInAppContext:!1}),!0!==r.getOption("find_in_this_tab_default")||o||!1===c&&n._socket.dispatchEvent("onSetFindInTab",null))}}))})),e.is(t.addinMode,"string")&&require(["DS/PlatformAPI/PlatformAPI"],(function(e){n.log("InContextSearch: addinMode found, start subscribing to webinwin:win:notification"),e.subscribe("webinwin:win:notification",n._onWinNotif.bind(n))})),this._socket.addListener("RegisterContext",this._registerContext.bind(this)),this._socket.addListener("TemporaryBypassFedsearch",this._temporaryBypassFedsearch.bind(this)),this._socket.addListener("InContextSearch",this._inContextSearch.bind(this)),this._socket.addListener("UnregisterContext",this._unregisterContext.bind(this)),this._socket.addListener("IncontextBuildQuery",this._incontextBuildSmartQuery.bind(this)),this._socket.addListener("onCloseTransient",(function(){n.setIncontextSearchActive(!1)}));p.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"IncontextBuilderEnd",callback:function(e){n._incontextBuildQueryOptions&&n._socket.dispatchEvent("IncontextBuildQuery_Response",e,n._incontextBuildQueryOptions.app_socket_id)}})},_onWinNotif:function(t){if(e.is(t,"object")&&e.is(t.event,"string")&&e.is(t.content,"object"))switch(t.event){case"RegisterContext":this.log("webinwin:win:notification for RegisterContext notif received, options="+JSON.stringify(t)),this._registerContext(t.content);break;case"InContextSearch":this.log("webinwin:win:notification for InContextSearch notif received, options="+JSON.stringify(t)),this._inContextSearch(t.content)}else this.log("webinwin:win:notification does not contain info in expected format")},getInContextOptions:function(t){var n,i=this._registered_search_ctx.get({id:t});return e.is(i)&&(n=i.toJSON()),n},_registerContext:function(t){this.log("Register Search Context"),g.groupCollapsed("Incontext Parameters(Register)>>"),g.log(t),g.groupEnd();this._addAdvSearchOption(t),e.is(this._registered_search_ctx)||(this._registered_search_ctx=new s),this._cleanSourceValue(t),this._cleanOrderFields(t);var n=this.getInContextOptions(t.widget_id);e.is(n)?(this.log("A Context in already registered for Widget Id "+t.widget_id+". Update it"),this._registered_search_ctx.remove({id:t.widget_id}),t.id=t.widget_id,this._registered_search_ctx.add(t)):(this.log("Register the context for Widget Id "+t.widget_id),t.id=t.widget_id,this._registered_search_ctx.add(t)),this._socket.dispatchEvent("RegisterContext_Response",t,t.app_socket_id)},_amIAMaximizedWidget:function(t){return!(!e.is(e.Widgets)||!e.is(e.Widgets.instances))&&0!==e.Widgets.instances.filter((function(e){return e.id===t&&"maximized"===e.getView().type})).length},_temporaryBypassFedsearch:function(t){if(e.is(t.bypass_url))if(e.is(this._registered_search_ctx)){var n={id:t.widget_id},i=this._registered_search_ctx.where(n);if(e.is(i)&&i.length>0)for(var s=0;s<i.length;s++)e.is(i[s])&&e.is(i[s]._attributes)&&(i[s]._attributes.bypass_url=t.bypass_url);else this.log("No context registered with Widget Id "+t.widget_id)}else this.log("No context registered")},_inContextSearch:function(t){this.log("In Context search Activated"),g.groupCollapsed("Incontext Parameters(Search)>>"),g.log(t),g.groupEnd();var n=this;n._addAdvSearchOption(t);var i={inCtx_widget_id:t.widget_id};this._promise=new o((function(i){!0===t.default_with_precond&&e.is(t.default_search_criteria)&&t.default_search_criteria.length>0?t.default_search_criteria.indexOf(":")>0?require(["DS/SNInfraUX/utils/WildcardMgr"],(function(e){n._socket.dispatchEvent("fetchPQsFromServer"),d.getPQFetchPromise().then((function(){var n=e.manageWildcardAddtion(t.default_search_criteria);n=l.replacePQsWithCVPrefixes(n),i(n)}))})):require(["DS/SNInfraUX/utils/WildcardMgr"],(function(e){var n=e.manageWildcardAddtion(t.default_search_criteria,{addWildCard_inCtx:t.addWildCard});i(n)})):i()}));var s=[this._promise];s.push(this.checkPreviousIncontextSearchPromise()),o.all(s).then((function(s){delete n._promise,n._promise=null,n.resetPrevIncontextSearchPromises(),n.setIncontextSearchActive(!0),s=s[0],!0===t.default_with_precond?(e.is(t.default_search_criteria)&&t.default_search_criteria.length>0&&(i.value=s,i.displayValue=e.is(t.search_criteria_to_display)?t.search_criteria_to_display:t.default_search_criteria,i.searchStringToDisplayInSearchField=e.is(t.search_criteria_to_display)?t.search_criteria_to_display:t.default_search_criteria),e.is(t.precond)&&t.precond.trim().length>0&&(e.is(i.value)&&i.value.trim().length>0?i.value=i.value+" AND "+t.precond:i.value=t.precond),e.is(t.displayValue)&&(i.searchStringToDisplayInSearchField=t.displayValue)):i.focus=!0,e.is(t.global_actions)&&(i.incontext_global_actions=t.global_actions),e.is(t.itemViewClickHandler)&&t.itemViewClickHandler.trim().length>0&&(i.itemViewClickHandler=t.itemViewClickHandler),n._cleanSourceValue(t),i.source=t.source,e.is(t.tenant)&&(i.tenant=t.tenant),e.is(t.advanced_search)&&(i.advanced_search=t.advanced_search,i.advanced_search.default_search_criteria=i.value,i.advanced_search.showByDefault&&l.setSidePanelTaggerContextPromise(n.getOption("addinMode"))),e.is(t.recent_search)&&(i.recent_search=t.recent_search),i.savedSearch=t.savedSearch;var o={id:t.widget_id},a=n._registered_search_ctx.where(o);if(e.is(a)&&a.length>0){if(1!==a.length)throw new Error("2 search context have been registered for the same Widget Id "+t.widget_id);n.log("A Context in already registered for Widget Id "+t.widget_id+". Update it");var r=a[0].toJSON();e.is(t.context_title,"string")?(n._registered_search_ctx.remove({id:t.widget_id}),r.context_title=t.context_title,n._registered_search_ctx.add(r)):e.is(r.context_title,"string")&&(n._registered_search_ctx.remove({id:t.widget_id}),delete r.context_title,n._registered_search_ctx.add(r))}e.is(n.getOption("addinMode"))&&(i.forceWidgetUXRecreation=!0),i.tag_filter=t.tag_filter,i.refine=t.tag_filter,l.autocompleteRendered().then((function(){function e(){n._socket.dispatchEvent("onInContextSearch",{inContextOptions:t,placeholder:void 0}),n._socket.dispatchEvent("search",i)}if(p.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"checkSidePanelStatus"}),n._hasGlobalChannelSubscriptipons()){var s=p.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"InContextInit",callback:function(){e(),p.unsubscribe(s)}});p.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"activateInContextSearch",data:t})}else e()}))})),r.getOption("isx2a")&&require(["DS/PlatformAPI/PlatformAPI"],(function(e){let t={type:"X2AEvent",category:"3DSearch",event:{name:"InContextSearch",data:{action:"activate"}}};n.log("Publish X2A Event when in-ctx search opened in XApp :-",t),e.publish("webinwin:web:notification",t)}))},_incontextBuildSmartQuery:function(e){this._incontextBuildQueryOptions=e,p.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"InContextSophisticatedMode",data:e})},checkPreviousIncontextSearchPromise:function(){var t=this;return new o((function(n,i){"3DDashboard"===l.identifyClientInfo().identifier&&t.isIncontextSearchActive()?(e.is(t.deactivateIncontextSearchPromise)||(t.deactivateIncontextSearchPromise=o.deferred(),t.incontextSidepanelStatusPromise=o.deferred(),p.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"deactivateInContextSearch",data:{}})),o.all([t.deactivateIncontextSearchPromise.promise,t.incontextSidepanelStatusPromise.promise]).then(n)):n()}))},resetPrevIncontextSearchPromises:function(){delete this.deactivateIncontextSearchPromise,this.deactivateIncontextSearchPromise=null,delete this.incontextSidepanelStatusPromise,this.incontextSidepanelStatusPromise=null},setIncontextSearchActive:function(e){this.incontextSearchActive=e},isIncontextSearchActive:function(){return this.incontextSearchActive},_addAdvSearchOption:function(t){!0===r.getOption("forceAdvancedSearch",{tenant:t.tenant?t.tenant:l.getActiveTenant()})&&"socket_id_#saved_search_edit#"!=t.app_socket_id&&e.is(t.advanced_search,"object")&&(t.advanced_search.showByDefault=!0,t.advanced_search.searchOnInit=!1)},_hasGlobalChannelSubscriptipons:function(){var t=p.getSubscriptions({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"activateInContextSearch"});return e.is(t,"array")&&t.length>0},_cleanOrderFields:function(t){e.is(t.order_field,"array")&&t.order_field.length>0&&e.is(t.order_by,"array")&&t.order_by.length>0?(t.order_field=t.order_field[0],t.order_by=t.order_by[0]):(t.order_field=void 0,t.order_by=void 0)},_cleanSourceValue:function(t){e.is(t.source)&&e.is(t.source,"string")&&(t.source=[t.source])},_unregisterContext:function(t){this.log("Unregister search Context"),g.groupCollapsed("Incontext Parameters(Un-Register)>>"),g.log(t),g.groupEnd();var n=t;if(e.is(n,"string")&&(n={widget_id:t,widgetId:t}),e.is(this._registered_search_ctx)){var i={id:n.widget_id},s=this._registered_search_ctx.where(i);e.is(s)&&s.length>0?this._registered_search_ctx.remove({id:n.widget_id}):this.log("No context registered with Widget Id "+n.widget_id)}else this.log("No context registered")}})})),define("DS/SNSearchUX/helpers/GuidedTrackerUtils",["UWA/Core","UWA/Class","UWA/Promise","DS/MessageBus/MessageBus","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNInfraUX/SearchUtils"],(function(e,t,n,i,s,o){"use strict";return t.singleton({init:function(e){i.subscribe({channel:"ContextualAction",topic:"track",callback:this.contextualActionTracker.bind(this)})},_publish:function(e){i.publish({channel:"SearchTrackerApi",topic:"hit",data:e})},resultsTracker:function(e,t){let n={category:"PreviewResults",action:"status",persDim:{pd1:"",pd2:"",pd3:"",pd4:""},persVal:{pv1:e||0,pv2:t||0}};this._publish(n)},contextualActionTracker:function(e){let t={category:"resultInteraction",action:"contextualAction",persDim:{pd1:"",pd2:e.type?e.type:"-",pd3:e.actionId?e.actionId:"-",pd4:e.title?e.title:"-"}};this._publish(t)},InlineSuggestionPinUnpinTracker:function(e){let t={category:"3DSearch",action:"InlineSuggestionPinUnpinTracker",persDim:{pd1:e}};this._publish(t)},DragNDropTracker:function(e){let t={category:"resultInteraction",action:"DragNdrop",persDim:{pd1:"",pd2:e||void 0}};this._publish(t)},pinTracker:function(e){let t={category:"inputInteraction",action:"Pinning Query",persDim:{pd1:""},persVal:{pv1:e}};this._publish(t)},instantAppTracker:function(e,t){let n={category:"resultInteraction",action:"AppClick",persDim:{pd1:"",pd2:e,pd3:t}};this._publish(n)},shortcutsTracker:function(e){let t={category:"Shortcuts",action:e.startsWith("Alt")?"AltKeys":e,persDim:{pd1:"",pd2:e}};this._publish(t)},activationTracker:function(){this._absoluteStart=Date.now(),this._publish({category:"toggle",action:"Activation",persDim:{pd1:""}})},deactivationTracker:function(){let e={category:"toggle",action:"Deactivation",persDim:{pd1:""},persVal:{pv1:this._absoluteStart?this._absoluteStart-Date.now():0}};this._absoluteStart=void 0,this._publish(e)},searchTracker:function(e){let t={category:"inputInteraction",action:"search",persDim:{pd1:"",pd2:""},persVal:{pv1:e}};this._publish(t)},selectTracker:function(t){let n={category:"suggestionInteraction",action:"selection",persDim:{pd1:"",pd2:t.uri?t.uri:"-",pd3:t.type?t.type:"-",pd4:t.matchType?t.matchType:"-",pd5:t.value?t.value:"-",pd6:t.category?t.category:"-",pd7:e.is(t.highLight,"string")?t.highLight:e.is(t.highLight,"array")?t.highLight.join("%"):"-"},persVal:{pv1:e.is(t.highLight,"string")?t.highLight.length:e.is(t.highLight,"array")?t.highLight.join("").length:0,pv2:t.weightage?t.weightage:0,pv3:t.index?t.index:0}};this._publish(n)},helpTracker:function(){this._publish({category:"inputInteraction",action:"search",persDim:{pd1:"",pd2:"Gone through Help"}})},switcherTracker:function(e){let t={category:"switcherInteraction",action:"searchmode",persDim:{pd1:"",pd2:e||"fullSearch"}};this._publish(t)},categoryHeaderTracker:function(e){let t={category:"resultInteraction",action:"categoryResult",persDim:{pd1:e.category}};this._publish(t)},seeAllResultsTracker:function(){this._publish({category:"resultInteraction",action:"seeAllResults"})},guidedExpertMode:function(e){let t={category:"guidedLiteModeInteraction",action:"guidedMode",persDim:{pd1:e||"guidedSearchIntermediate"}};this._publish(t)},searchInTitleOnly:function(e){let t={category:"resultInteraction",action:"searchInTitleOnly",persDim:{pd1:e}};this._publish(t)},suggestionSelectionTracker:function(e){let t={category:"inlineSuggestionInteraction",action:"suggestionSelection",persDim:{pd1:e.value,pd2:e.type}};this._publish(t)}})})),define("DS/SNSearchUX/SearchHistoric",["UWA/Core","UWA/Class","UWA/Class/Debug"],(function(e,t,n){"use strict";return t.singleton(n,{history:{},init:function(){},getHistoric:function(){return e.is(localStorage.SNSearchBoxStore)?JSON.parse(localStorage.SNSearchBoxStore):[]},setHistoricInLocalStorage:function(){var e=this.getHistoric();localStorage.SNSearchBoxStore=JSON.stringify(e)},storeValueInDataBase:function(t){if(!e.is(t,"string"))throw new Error("null value given to SearchView._storeValueInLocalStorage!");if(t.trim().length<=0)return;t=t.trim();var n=this.getHistoric();let i=n.slice();i.forEach(((e,t,n)=>{n[t]=e.toLowerCase().trim()}));let s=0;if(i=i.filter((function(e,t,i){return t!==i.indexOf(e)&&(n.splice(t-s,1),s++),t===i.indexOf(e)})),-1===i.indexOf(t.toLowerCase()))n.length>=100&&n.shift(),n.push(t);else{let e=i.indexOf(t.toLowerCase());n.splice(e,1),n.push(t)}localStorage.SNSearchBoxStore=JSON.stringify(n)}})})),define("DS/SNSearchUX/SearchSecondaryMenu",["UWA/Core","UWA/Element","UWA/Controls/Abstract","UWA/Promise","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SNSearchTypeCusto","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/PlatformEnvServices","DS/SNResultUX/utils/ExternalComponentHelpers","DS/UIKIT/DropdownMenu","DS/UIKIT/Input/Toggle","DS/PlatformAPI/PlatformAPI","DS/MessageBus/MessageBus","DS/PubSub/PubSub","DS/UIKIT/SuperModal","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json","text!DS/SNSearchUX/assets/templates/SearchInformation.html","DS/WebappsUtils/WebappsUtils","DS/SNUQLEditor/SNUQLEditorUX"],(function(e,t,n,i,s,o,a,r,c,l,d,u,h,p,g,_,m,S,f,C,y,v,b){"use strict";return n.extend({_secondaryMenu:null,_autocomplete:null,_socket:null,currentMode:null,currentSearch:null,_secondaryOptionToHide:[],searchTabId:null,src_ressource:null,_searchOptionDividerId:"searchOptionDivider",_predefinedQueryDividerId:"predifinedQueryDivider",_inAppContext:!1,_inContextOptions:null,_AsyncSearchDropdownPromise:i.deferred(),_temporarilyOutOfContext:null,init:function(e){this._buildSecondaryMenu(e)},_buildSecondaryMenu:function(t){var n=this;if(e.is(t)&&(this._secondaryOptionToHide=[],e.is(t.socket)&&(this._socket=t.socket),e.is(t)&&e.is(t.secondaryMenuOptions)&&e.is(t.secondaryMenuOptions.hideTenantMenu)&&!0===t.secondaryMenuOptions.hideTenantMenu&&(this.hideTenantMenu=!0),e.is(t.autocomplete)&&e.is(t.target))){this._autocomplete=t.autocomplete,this._autocomplete.secondaryMenu=this,this.currentSearch=C.searchNew;var i=C.get("find_in_tab.shortHelp");"3DSwym"===o.identifyClientInfo().identifier&&(i=C.get("find_in_page.shortHelp"));let s=[];o.identifyClientInfo()&&"3DSwym"===o.identifyClientInfo().identifier?s=[{text:C.searchNew,className:"secondaryMenuSearch",fonticon:"search",title:C.get("search.shortHelp")},{text:C.search_current_tab,className:"secondaryMenuSearchInCurrentTab",fonticon:"filter",title:i},{text:C.adv_search,className:"secondaryMenuAdvanced",fonticon:"search-cog",title:C.get("adv_search.shortHelp")},{id:n._searchOptionDividerId,className:"divider"},{text:C.LastSearchResults,className:"secondaryMenuLastSearch",fonticon:"search-recent",title:C.get("LastSearchResults.shortHelp")},{text:C.MySavedSearches,className:"secondaryMenuFavorite",fonticon:"favorite-on",title:C.get("MySavedSearches.shortHelp")},{text:C.mycontent,className:"secondaryMenuMyContent",fonticon:"user",title:C.get("mycontent.shortHelp")},{id:n._predefinedQueryDividerId,className:"divider"},{text:C.PredefinedQuery,className:"secondaryMenuPQ",fonticon:"help",title:C.get("PredefinedQuery.shortHelp")},{text:C.SearchOptions,className:"secondaryMenuOptions",fonticon:"cog",title:C.get("SearchOptions.shortHelp")},{text:C.get("FUN136528-activate"),className:"secondaryMenuBetaFUN124298",fonticon:"info",title:C.get("FUN136528-activate")}]:o.identifyClientInfo()&&"3DDashboard"===o.identifyClientInfo().identifier?(s=[{text:C.searchNew,className:"secondaryMenuSearch",fonticon:"search",title:C.get("search.shortHelp")},{text:C.informationAction,className:"secondaryMenuInfo",fonticon:"info",title:C.get("info.shortHelp")},{text:C.adv_search,className:"secondaryMenuAdvanced",fonticon:"search-cog",title:C.get("adv_search.shortHelp")},{id:n._searchOptionDividerId,className:"divider"},{text:C.LastSearchResults,className:"secondaryMenuLastSearch",fonticon:"search-recent",title:C.get("LastSearchResults.shortHelp")},{text:C.MySavedSearches,className:"secondaryMenuFavorite",fonticon:"favorite-on",title:C.get("MySavedSearches.shortHelp")},{text:C.mycontent,className:"secondaryMenuMyContent",fonticon:"user",title:C.get("mycontent.shortHelp")},{id:n._predefinedQueryDividerId,className:"divider"},{text:C.PredefinedQuery,className:"secondaryMenuPQ",fonticon:"help",title:C.get("PredefinedQuery.shortHelp")},{text:C.SearchOptions,className:"secondaryMenuOptions",fonticon:"cog",title:C.get("SearchOptions.shortHelp")},{text:C.get("FUN136528-activate"),className:"secondaryMenuBetaFUN124298",fonticon:"info",title:C.get("FUN136528-activate")}],!0===c.getOption("ExpertMode")&&s.push({text:"ExpertQuery",className:"secondaryMenuExpertQuery",fonticon:"text",title:"Expert Query"})):s=[{text:C.searchNew,className:"secondaryMenuSearch",fonticon:"search",title:C.get("search.shortHelp")},{text:C.adv_search,className:"secondaryMenuAdvanced",fonticon:"search-cog",title:C.get("adv_search.shortHelp")},{id:n._searchOptionDividerId,className:"divider"},{text:C.LastSearchResults,className:"secondaryMenuLastSearch",fonticon:"search-recent",title:C.get("LastSearchResults.shortHelp")},{text:C.MySavedSearches,className:"secondaryMenuFavorite",fonticon:"favorite-on",title:C.get("MySavedSearches.shortHelp")},{text:C.mycontent,className:"secondaryMenuMyContent",fonticon:"user",title:C.get("mycontent.shortHelp")},{id:n._predefinedQueryDividerId,className:"divider"},{text:C.PredefinedQuery,className:"secondaryMenuPQ",fonticon:"help",title:C.get("PredefinedQuery.shortHelp")},{text:C.SearchOptions,className:"secondaryMenuOptions",fonticon:"cog",title:C.get("SearchOptions.shortHelp")},{text:C.get("FUN136528-activate"),className:"secondaryMenuBetaFUN124298",fonticon:"info",title:C.get("FUN136528-activate")}],this._secondaryMenu=new p({className:"searchOptionMenu",maxItemsBeforeScroll:50,items:s,position:"bottom left",offset:{y:-3,x:0},target:t.target,closeOnClick:!0,events:{onClick:function(t,i){switch(m.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"dropdownbeta",persDim:{pd14:i.name,pd15:i.className}}}),i.name){case C.searchNew:var s=n._autocomplete._getClearSearchBtn();(""!==n._autocomplete.getInputValue()||e.is(s.isHidden)&&!1===s.isHidden())&&n._searchInCurrentTab(""),n._clickOnSearch(),n._autocomplete._findInthisTabOnClick(!1),""!==n._autocomplete.getInputValue()&&n._onViewSearch();break;case C.search_current_tab:"3DSwym"===o.identifyClientInfo().identifier?(n._clickOnSearchInCurrentTab(),""!==n._autocomplete.getInputValue()&&n._onViewSearch()):n._clickOnInformation();break;case C.informationAction:n._clickOnInformation();break;case C.adv_search:n._clickOnAdvancedSearch(t);break;case C.LastSearchResults:n.clickOnLastSearchResult();break;case C.MySavedSearches:n._clickOnFavoriteSearches(t);break;case C.mycontent:n._clickOnMyContent(t);break;case C.PredefinedQuery:n._autocomplete._showPQSelectionUX();break;case C.SearchOptions:n._clickOnSearchOptions(t);break;case C.get("FUN136528-activate"):n._clickOnSearchBETA(t);break;case"ExpertQuery":console.log("Expert mode query invocked..."),n._launchUQLEditor();break;default:e.is(i.className)&&i.className.contains("secondaryMenuTenant")&&!i.className.contains("Selector")&&(n._autocomplete._setPlaceHolderValue(C.search+" "+i.name),n.src_ressource.setActiveTenant(i.attributes.tenantId),n._updateMenuOnTenantSelection(i.attributes.tenantId),n._autocomplete.options.events.setSourceCStorage(n.getCurrentTenant().tenantId),""!==n._autocomplete.getInputValue()&&n._onViewSearch())}},onShow:function(){},onHide:function(){}}}),this._toggleDropDownMenuItem(C.LastSearchResults,"hide"),(e.is(c.getOption("search_compact_mode"))&&!0===c.getOption("search_compact_mode")||"tablet"===o.getDeviceType()&&"portrait"===o.getViewportOrientation())&&this._setSecondaryHiddenOptionsPermanent([C.adv_search,C.MySavedSearches,C.PredefinedQuery,C.SearchOptions],!0),("3DDashboard"!==o.identifyClientInfo().identifier||c.getOption("addinmode"))&&this._setSecondaryHiddenOptionsPermanent([C.informationAction],!1)}},_launchUQLEditor:function(){new b},_clickOnInformation:function(){var t=this._autocomplete.getInputValue();e.is(t)&&S.dispatch("3DSearch:open3DDSearchInTab",{query:t,submit:!0})},setInContextState:function(e){this._inContext=e},setInAppContext:function(t){if(!1===t.setInAppContext&&(this._inContextOptions=null),this._inAppContext=t.isInAppContext,!0===t.isInAppContext&&e.is(t.data)&&e.is(t.data.search_criteria_to_display,"string")?this._autocomplete.setFieldValue(t.data.search_criteria_to_display):this.currentMode!==C.search_current_tab&&this._autocomplete.setFieldValue(""),t.isInAppContext&&e.is(t.data)&&e.is(t.data.search_criteria))switch(t.data.search_criteria){case o.SearchTypeEnum.MY_CONTENT:this._clickOnMyContent({focus:!1});break;case o.SearchTypeEnum.FAVORITE_SEARCH:this._clickOnFavoriteSearches({focus:!1});break;case o.SearchTypeEnum.ADVANCED_SEARCH:this._clickOnAdvancedSearch({focus:!1})}this._temporarilyOutOfContext=!1},setFindInContext:function(t,n){this._setFindInContext(t),e.is(n)?this._autocomplete._setPlaceHolderValue(n):this._isMenuItemHidden(C.select_tenant)||this._autocomplete._setPlaceHolderValue(C.get("search"))},_setFindInContext:function(t){var n=this;this._autocomplete._internalSearchCriteria=null,this._autocomplete.elements.input.readOnly=!1,e.is(t.widget_id)&&"widget_id_#saved_search_edit#"!==t.widget_id?this._toggleDropDownMenuItem(C.LastSearchResults,"hide"):this.editFavoriteSearchMode(t);var i=!1;t&&t.UXOptions&&!1===t.UXOptions.menuMyFavorites&&(i=!0),i&&this._AsyncSearchDropdownPromise.promise.then((function(){n._toggleDropDownMenuItem(C.MySavedSearches,"hide")}));var s=!1;t&&t.UXOptions&&!1===t.UXOptions.menuMyContent&&(s=!0),s&&this._toggleDropDownMenuItem(C.mycontent,"hide"),e.is(t)&&e.is(t.tenant)?(this._autocomplete.options.events.setSourceCStorage(t.tenant),this.setCurrentTenant(t.tenant),this._clickOnSearch({focus:!1})):this._autocomplete.options.events.setSourceCStorage(this.getCurrentTenant());var o=!0;t&&t.advanced_search&&(o=!1,t.advanced_search.exclusive&&this._toggleDropDownMenuItem(C.searchNew,"hide")),o&&this._AsyncSearchDropdownPromise.promise.then((function(){n._toggleDropDownMenuItem(C.adv_search,"hide")}));this._AsyncSearchDropdownPromise.promise.then((function(){n._toggleDropDownMenuItem(C.PredefinedQuery,"hide")})),this._inContextOptions=t},restoreAppContext:function(e){if(this._inAppContext&&e&&(!e.in_apps_search||e.in_apps_search.widget_id!==this._inContextOptions.widget_id))return!1;this._autocomplete.elements.suggestsContainer.getChildren().forEach((function(e){e.show()})),e&&e.in_apps_search&&e.in_apps_search.advanced_search&&e.in_apps_search.advanced_search.exclusive&&this._toggleDropDownMenuItem(C.searchNew,"show"),this.setInAppContext({isInAppContext:!1}),this.currentMode===C.searchNew?this._clickOnSearch({focus:!1,noFocus:!0}):this.currentMode===C.search_current_tab&&this.clickOnSearchInTab()},editFavoriteSearchMode:function(t){this._toggleDropDownMenuItem(C.MySavedSearches,"hide"),this._toggleDropDownMenuItem(C.mycontent,"hide"),e.is(t)&&e.is(t.advanced_search)?this._toggleDropDownMenuItem(C.adv_search,"show"):this._toggleDropDownMenuItem(C.adv_search,"hide"),this._toggleDropDownMenuItem(C.PredefinedQuery,"hide"),this._toggleDropDownMenuItem(C.search_current_tab,"hide"),this._toggleDropDownMenuItem(C.searchNew,"show")},_onViewSearch:function(){S.dispatch("onViewSearch")},showLastSearch:function(){this._toggleDropDownMenuItem(C.LastSearchResults,"show")},_switchSearchMode:function(){d.getItem("searchMode")===C.searchNew?this._clickOnSearch():d.getItem("searchMode")===C.search_current_tab&&this._clickOnSearchInCurrentTab()},_searchInCurrentTab:function(t,n){e.is(n)?S.dispatch("SearchQuery",[t,n]):S.dispatch("SearchQuery",[t])},_toggleDropDownMenuItem:function(t,n){if(!(e.is(this._secondaryOptionToHide)&&e.is(this._secondaryOptionToHide.length)&&this._secondaryOptionToHide.length>0&&this._secondaryOptionToHide.indexOf(t)>=0)&&e.is(this._secondaryMenu)&&e.is(this._secondaryMenu.items)){if(e.is(t)){var i=this._findDropDownMenuItem(t);e.is(i)&&e.is(i.elements)&&e.is(n)&&("show"===n?this._showItem(i):"hide"===n&&this._hideItem(i))}var s=this._findDropDownMenuItem(C.LastSearchResults),o=this._findDropDownMenuItem(C.MySavedSearches),a=this._findDropDownMenuItem(C.mycontent),r=this._findDropDownMenuDivider(this._searchOptionDividerId);s.elements.container.isHidden()&&o.elements.container.isHidden()&&a.elements.container.isHidden()?this._hideItem(r):this._showItem(r);var c=this._findDropDownMenuItem(C.PredefinedQuery),l=this._findDropDownMenuDivider(this._predefinedQueryDividerId);c.elements.container.isHidden()?this._hideItem(l):this._showItem(l)}},_hideItem:function(t){var n="";e.is(t)&&e.is(t.className)&&(n=t.className+" ");var i={id:t.id,className:n+"secondaryMenuHidden"};this._secondaryMenu.updateItem(i)},_showItem:function(t){if(e.is(t)&&e.is(t.className)){var n=t.className;n.contains("secondaryMenuHidden")&&(n=n.replace(/secondaryMenuHidden/g,""));var i={id:t.id,className:n};this._secondaryMenu.updateItem(i)}},_isMenuItemHidden:function(t){if(e.is(t)){var n=this._findDropDownMenuItem(t);return!(!e.is(n.className)||!n.className.contains("secondaryMenuHidden"))}return null},_setSecondaryHiddenOptions:function(t){switch(e.is(t)||(t=""),this._toggleDropDownMenuItem(C.MySavedSearches,"show"),this._toggleDropDownMenuItem(C.mycontent,"show"),this._toggleDropDownMenuItem(C.adv_search,"show"),this._toggleDropDownMenuItem(C.Howtosearch,"show"),this._toggleDropDownMenuItem(C.search_current_tab,"show"),this._toggleDropDownMenuItem(C.SearchOptions,"show"),this._toggleDropDownMenuItem(C.PredefinedQuery,"show"),this._toggleDropDownMenuItem(C.SearchBETA,"show"),this.currentSearch===C.search_current_tab?this._toggleDropDownMenuItem(C.PredefinedQuery,"hide"):this._toggleDropDownMenuItem(C.PredefinedQuery,"show"),t){case C.searchNew:this._toggleDropDownMenuItem(C.search_current_tab,"hide");break;case C.MySavedSearches:case C.mycontent:case C.adv_search:this._toggleDropDownMenuItem(C.PredefinedQuery,"hide"),this._toggleDropDownMenuItem(C.search_current_tab,"hide");break;case"inContext":this._toggleDropDownMenuItem(C.search_current_tab,"hide"),this._toggleDropDownMenuItem(C.SearchOptions,"hide"),this._toggleDropDownMenuItem(C.SearchBETA,"hide")}e.is(this._inAppContext)&&!0===this._inAppContext&&(this._toggleDropDownMenuItem(C.SearchOptions,"hide"),this._toggleDropDownMenuItem(C.adv_search,"hide"),this._toggleDropDownMenuItem(C.MySavedSearches,"hide"),this._toggleDropDownMenuItem(C.PredefinedQuery,"hide"),this._toggleDropDownMenuItem(C.SearchBETA,"hide"))},_setSecondaryHiddenOptionsPermanent:function(t,n){if(e.is(n)&&!0===n&&(this._secondaryOptionToHide=[]),e.is(t,"array"))for(var i=0;i<t.length;i++)this._toggleDropDownMenuItem(t[i],"hide"),e.is(this._secondaryOptionToHide)&&this._secondaryOptionToHide.indexOf(t[i])<0&&this._secondaryOptionToHide.push(t[i])},_unsetSecondaryHiddenOptionsPermanent:function(t){if(e.is(t,"array")){for(var n=[],i=0;i<this._secondaryOptionToHide.length;i++)t.includes(this._secondaryOptionToHide[i])||n.push(this._secondaryOptionToHide[i]);this._secondaryOptionToHide=n;for(var s=0;s<t.length;s++)this._toggleDropDownMenuItem(t[s],"show")}},_findDropDownMenuItem:function(t){if(e.is(this._secondaryMenu)&&e.is(this._secondaryMenu.items)){for(var n=0;n<this._secondaryMenu.items.length;n++)if(this._secondaryMenu.items[n].text===t)return this._secondaryMenu.items[n];return{}}},_findDropDownMenuDivider:function(t){if(e.is(this._secondaryMenu)&&e.is(this._secondaryMenu.items)){for(var n=0;n<this._secondaryMenu.items.length;n++)if(this._secondaryMenu.items[n].id===t)return this._secondaryMenu.items[n];return{}}},initTenantOnSecondaryMenu:function(t){if(e.is(this._secondaryMenu)&&e.is(t.sources)){this.src_ressource=new a(t.sources);for(var n=this.src_ressource.getAvailableTenants(),i=this._findDropDownMenuItem(C.select_tenant),s=0;s<n.length;s++)this.src_ressource.active_tenant===n[s].tenantId&&n.length>1&&(this._autocomplete._setPlaceHolderValue(C.search+" "+n[s].displayName),this._autocomplete.setSelectedTenant(n[s].tenantId));if(n.length<=1&&(this._toggleDropDownMenuItem(C.Wheretosearch,"hide"),this._toggleDropDownMenuItem(C.select_tenant,"hide"),1===n.length&&e.is(i)&&e.is(i.elements)&&e.is(i.elements.container)&&e.is(i.elements.container.setAttribute,"function"))){let s=n[0].tenantId;i.elements.container.setAttribute("activetenant",s),e.is(t)&&e.is(t.sources)&&e.is(t.sources.available_tenants,"object")&&e.is(t.sources.available_tenants[s])&&e.is(t.sources.available_tenants[s].displayName)&&i.elements.container.setAttribute("activetenantnls",t.sources.available_tenants[s].displayName)}var r=this;e.is(this.hideTenantMenu)&&!0===this.hideTenantMenu&&this._setSecondaryHiddenOptionsPermanent([C.select_tenant]),o.isRoleAvailable(["CSV"],this.src_ressource.active_tenant,(function(e){!0!==e&&r._setSecondaryHiddenOptionsPermanent([C.adv_search,C.MySavedSearches,C.PredefinedQuery,C.SearchOptions]),r._AsyncSearchDropdownPromise.resolve()})),C.search_current_tab===d.getItem("searchMode")&&o.identifyClientInfo()&&"3DDashboard"!==o.identifyClientInfo().identifier?this._clickOnSearchInCurrentTab():this._clickOnSearch()}},isSingleTenant:function(){return!(u.getAvailableTenantsForSearch().length>1)},getCurrentTenant:function(){if(e.is(this.src_ressource)){var t=this.src_ressource.getAvailableTenants();if(this._isMenuItemHidden(C.select_tenant)&&1===t.length){if(e.is(t[0].name))var n={tenantId:t[0].tenantId,tenantName:t[0].name};else n={tenantId:t[0].tenantId,tenantName:t[0].displayName};return n}for(var i=0;i<t.length;i++)if(t[i].tenantId===this.src_ressource.getActiveTenant())return{tenantId:t[i].tenantId,tenantName:t[i].displayName}}return{tenantId:null,tenantName:null}},setCurrentTenant:function(t){if(!this._isMenuItemHidden(C.select_tenant))for(var n=0;n<this._secondaryMenu.items.length;n++)if(e.is(this._secondaryMenu.items[n].attributes)&&e.is(this._secondaryMenu.items[n].attributes.tenantId)&&this._secondaryMenu.items[n].attributes.tenantId===t)return void this._secondaryMenu.toggleSelection(this._secondaryMenu.items[n]);this.src_ressource.setActiveTenant(t)},_manageSecondaryMenuOptions:function(t){var n=[];e.is(t)&&(e.is(t.enable_my_content)&&!1===t.enable_my_content&&n.push(C.mycontent),e.is(t.enable_favorite_searches)&&!1===t.enable_favorite_searches&&n.push(C.MySavedSearches),e.is(t.enable_search_in_this_tab)&&!1===t.enable_search_in_this_tab&&n.push(C.search_current_tab),e.is(t.enable_predefined_query)&&!1===t.enable_predefined_query&&this._toggleDropDownMenuItem(C.PredefinedQuery)),this._setSecondaryHiddenOptionsPermanent(n)},setSelectedPQPrefix:function(e){this._autocomplete._internalSearchCriteria=null,this._autocomplete.setFieldValue(e),this._autocomplete.elements.input.focus(),!0===this._autocomplete._pqSelect&&this._clickOnSearch({focus:!1}),this._autocomplete._pqSelect=!1},_clickOnMyRecentContent:function(t){this._autocomplete._myRecentContentIsActive=!0;this._clickOnSearch({focus:!1});var n="*";!t||"*"===t.paramsFilter||this._autocomplete.getPlaceHolder()!==C.searchNew&&this._autocomplete.getPlaceHolder()!==C.get("myrecentcontent")||(n=this._autocomplete.getInputValue()?this._autocomplete.getInputValue():t.paramsFilter,this._autocomplete.setFieldValue(n)),this._autocomplete._setInternalCriteria(null),this._autocomplete.options.events.setSourceCStorage(this.getCurrentTenant().tenantId),e.is(t,"object")&&e.is(t.focus)&&!1===t.focus||(e.is(t)?this._autocomplete.dispatchEvent("myRecentContent",{sFilter:n,widgetId:t.widgetId}):this._autocomplete.dispatchEvent("myRecentContent",{sFilter:n}))},setSearchMode:function(t){var n={focus:!1};this.currentMode===C.searchNew&&this._isMenuItemHidden(C.select_tenant)?this._clickOnSearch(n):(this.currentMode!==C.searchNew||this._isMenuItemHidden(C.select_tenant))&&(this.currentMode===C.search_current_tab?(e.is(t.noFocus)&&(n=null),this._clickOnSearchInCurrentTab(n)):this.currentMode===C.adv_search?this._clickOnAdvancedSearch(n):this.currentMode===C.mycontent?this._clickOnMyContent(n):this.currentMode===C.MySavedSearches&&this._clickOnFavoriteSearches(n))},selectTenantOnTabActivation:function(t){if(e.is(t,"object")&&e.is(t.tenant,"string")&&t.tenant.length>0){if("OnPremise"===t.tenant||this._isMenuItemHidden(C.select_tenant))return;this.setCurrentTenant(t.tenant),d.setItem("defaultTenantId",t.tenant),d.commit(),this._updateMenuOnTenantSelection(t.tenant)}},_updateMenuOnTenantSelection:function(t){var n=this;o.isRoleAvailable(["CSV"],t,(function(t){!0===t?n._inAppContext?(e.is(n._inContextOptions)&&e.is(n._inContextOptions.advanced_search)?n._toggleDropDownMenuItem(C.adv_search,"show"):n._toggleDropDownMenuItem(C.adv_search,"hide"),e.is(n._inContextOptions)&&e.is(n._inContextOptions.UXOptions)&&!1===n._inContextOptions.UXOptions.menuMyFavorites?n._toggleDropDownMenuItem(C.MySavedSearches,"hide"):n._toggleDropDownMenuItem(C.MySavedSearches,"show"),n._toggleDropDownMenuItem(C.PredefinedQuery,"hide")):!0!==c.getOption("search_compact_mode")&&n._unsetSecondaryHiddenOptionsPermanent([C.adv_search,C.MySavedSearches,C.PredefinedQuery,C.SearchOptions]):n._setSecondaryHiddenOptionsPermanent([C.adv_search,C.MySavedSearches,C.PredefinedQuery,C.SearchOptions])}))},setCurrentMode:function(e){if(this.currentMode=e,o.isODTMode())switch(e){case C.searchNew:this._autocomplete.elements.input.setAttribute("currentMode","search");break;case C.search_current_tab:this._autocomplete.elements.input.setAttribute("currentMode","searchInCurrentTab");break;case C.adv_search:this._autocomplete.elements.input.setAttribute("currentMode","advancedSearch");break;case C.MySavedSearches:this._autocomplete.elements.input.setAttribute("currentMode","favoriteSearch");break;case C.mycontent:this._autocomplete.elements.input.setAttribute("currentMode","myContent")}},_clickOnSearchOptions:function(t){var n=this;e.is(t)&&e.is(t.stopPropagation,"function")&&t.stopPropagation(),require(["DS/SNResultUX/views/utils/SearchOptionsUI"],(function(e){new e({tenant:n.getCurrentTenant()})}))},_clickOnSearchBETA:function(e){new f({renderTo:document.body,className:"search-beta-warning-reload-page",okButtonText:"OK"}).confirm(C.get("FUN136528-modal-text-activate"),C.get("FUN136528-modal-title-activate"),function(e){!0===e&&(m.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"dropdownbeta",persDim:{pd16:"activate",pd18:"activate"}}}),d.setItem("BETA-FUN136528",!0),d.commit(),location.reload())}.bind(this))},_clickOnSearch:function(t){this.setCurrentMode(C.searchNew),this.currentSearch=C.searchNew;var n=!1;if(e.is(t)&&e.is(t.resetNLS)&&(n=!0),this._autocomplete._adv_Search_activated=!1,d.setItem("searchMode",C.searchNew),d.commit(),this._inAppContext||(this._toggleDropDownMenuItem(C.PredefinedQuery,"show"),this._toggleDropDownMenuItem(C.MySavedSearches,"show")),this._toggleDropDownMenuItem(C.mycontent,"show"),e.is(t)&&e.is(t.hiddenOptions))for(let e=0;e<t.hiddenOptions.length;e++)this._toggleDropDownMenuItem(t.hiddenOptions[e],"hide");this._autocomplete.getPlaceHolder()!==this._autocomplete._findInTabNLS&&(this._autocomplete._isTypeListDone=!0,t={adv_search_field:this._isTypeValue,focus:!1});if(0===this._autocomplete._typeList.length&&(this._autocomplete._typeList=l.getSearchTypeCustoList()),this._autocomplete._isTypeListMode&&this._autocomplete._isTypeListDone&&this._autocomplete._typeList.length&&-1!==this._autocomplete._typeList.indexOf(t.adv_search_field))return this._clickOnAdvancedSearch(t),this._autocomplete._isTypeListMode=!1,void(this._autocomplete._isTypeListDone=!1);this._autocomplete._setInternalCriteria(null),this._autocomplete.elements.input.readOnly=!1,e.is(t,"object")&&e.is(t.focus)&&!0!==t.focus||this._autocomplete.elements.input.focus(),""===this._autocomplete.getInputValue()&&this._autocomplete.hideClearSearchButton();var i=C.get("search");if(e.is(this.src_ressource)&&this.src_ressource.getAvailableTenants().length>1){var s=this.getCurrentTenant();e.is(s)&&e.is(s.tenantName)&&(i+=" "+s.tenantName)}else i=C.get("searchNew");this._autocomplete._setPlaceHolderValue(i),(e.is(this.src_ressource)&&!e.is(t,"object")||!e.is(t.setTenant)||!1!==t.setTenant)&&this._autocomplete.options.events.setSourceCStorage(this.getCurrentTenant().tenantId);var o=this._autocomplete.getInputValue();n&&(o=""),this._autocomplete.setFieldValue(o)},_clickOnSearchInCurrentTab:function(t){e.is(t)?(e.is(t.name)&&(this._autocomplete._setPlaceHolderValue(C.replace(C.get("find_in_specific_tab"),{tab:t.name})),this._autocomplete._changeSearchBtnIcon("fonticon-filter")),e.is(t.id)&&(this.searchTabId=t.id)):(this._autocomplete._setPlaceHolderValue(C.search_current_tab),this._autocomplete._changeSearchBtnIcon("fonticon-filter")),!0===this._autocomplete.betaProgramState&&this._autocomplete._clearDropDown(),this.setCurrentMode(C.search_current_tab),this.currentSearch=C.search_current_tab,d.setItem("searchMode",C.search_current_tab),d.commit(),this._toggleDropDownMenuItem(C.PredefinedQuery,"hide"),this._autocomplete._findInthisTabOnClick(!0)},clickOnLastSearchResult:function(){this.setCurrentMode(C.searchNew),this.currentSearch=C.searchNew,this._autocomplete.setFieldValue(""),this._autocomplete._setPlaceHolderValue(C.searchNew),this._autocomplete.hideClearSearchButton(),this._autocomplete.dispatchEvent("onSelect",["","LastSearch"]),this._inAppContext||(this._toggleDropDownMenuItem(C.mycontent,"show"),this._toggleDropDownMenuItem(C.MySavedSearches,"show"),this._clickOnSearch({focus:!1}))},_clickOnAdvancedSearch:function(t){this.setCurrentMode(C.adv_search),this._setSecondaryHiddenOptions(C.adv_search),this._autocomplete._setInternalCriteria(null),this._autocomplete._adv_Search_activated=!0;var n=C.adv_search;e.is(this.src_ressource)&&this.src_ressource.getAvailableTenants().length>1&&(n+=" "+this.getCurrentTenant().tenantName),this._autocomplete._setPlaceHolderValue(n),this._autocomplete.setFieldValue(""),this._autocomplete.elements.input.readOnly=!0,e.is(t,"object")&&e.is(t.setTenant)&&!1===t.setTenant||this._autocomplete.options.events.setSourceCStorage(this.getCurrentTenant().tenantId),e.is(t)&&e.is(t.adv_search_field,"string")&&t.adv_search_field.length>0?this._autocomplete.dispatchEvent("advancedSearch",t.adv_search_field):e.is(t,"object")&&e.is(t.focus)&&!1===t.focus||this._autocomplete.dispatchEvent("advancedSearch")},_clickOnMyContent:function(t){this.setCurrentMode(C.mycontent),this._setSecondaryHiddenOptions(C.mycontent),this._autocomplete._setInternalCriteria(null);var n=C.mycontent;e.is(this.src_ressource)&&this.src_ressource.getAvailableTenants().length>1&&(n+=" "+this.getCurrentTenant().tenantName),this._autocomplete._setPlaceHolderValue(n),this._autocomplete.setFieldValue(""),this._autocomplete.hideClearSearchButton(),this._autocomplete.elements.input.readOnly=!0,e.is(t,"object")&&e.is(t.setTenant)&&!1===t.setTenant||this._autocomplete.options.events.setSourceCStorage(this.getCurrentTenant().tenantId),e.is(t,"object")&&e.is(t.focus)&&!1===t.focus||this._autocomplete.dispatchEvent("myContent")},_clickOnFavoriteSearches:function(t){this.setCurrentMode(C.MySavedSearches),this._setSecondaryHiddenOptions(C.MySavedSearches),this._autocomplete._setInternalCriteria(null);var n=C.MySavedSearches;e.is(this.src_ressource)&&this.src_ressource.getAvailableTenants().length>1&&(n+=" "+this.getCurrentTenant().tenantName),this._autocomplete._setPlaceHolderValue(n),this._autocomplete.setFieldValue(""),this._autocomplete.hideClearSearchButton(),this._autocomplete.elements.input.readOnly=!0,m.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"manualSwitchToView",data:{view:d.getItem("LastSearchViewMode")}}),e.is(t,"object")&&e.is(t.setTenant)&&!1===t.setTenant||this._autocomplete.options.events.setSourceCStorage(this.getCurrentTenant().tenantId),e.is(t,"object")&&e.is(t.focus)&&!1===t.focus||this._autocomplete.dispatchEvent("favoriteSearches")}})})),define("DS/SNSearchUX/dropdown/myContentView",["DS/SNSearchUX/dropdown/categoryContentView","UWA/Core","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchPreferences","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,n,i,s){"use strict";return e.extend({_onInitTreeDocumentAsyncCB:function(e){let t=this;if(!0===t._onGroupingCompute)return;let o=i.getItem("searchSort");t._emptyViews(),t._resetViews(),t._onGroupingCompute=!0,null!==t.collectionUX&&delete t.collectionUX,t.mask(),t.hideEmptyView(),t.collection._resetState(),t.collection.setRequestCriteria("fed_search",{ignoreRestrictedSources:!1,order_by:UWA.is(o)?o.order_by:"desc",order_field:UWA.is(o)?o.order_field:"relevance",query:"#myContent",nresults:t.collection.nresults,refine:{allfilters:{},localfilters:{}},select_file:["icon","thumbnail_2d"],source:[],with_synthesis:!1,with_nls:!0,with_synthesis_hierarchical:!1,next_start:"0"}),t.collection.setPageSize(t.collection.nresults),t.collection.fetch({onComplete:function(i,o){n.log("myContentView::onComplete: ",o),t.unmask(),t.collections=[];let a=i?i.nhits?i.nhits:i.hits?i.hits:0:0,r=s.get("myContentTitle"),c=t.id;i.id=c,i.icon={classes:" fonticon-user"},i.headTitle=r,i.totalCount=a,t.collections.push(i),t._loadViews(0,{forceToDisplaySection:!0}),t._onGroupingCompute=!1,0===a?(t.unmask(),t.hideEmptyView(),e.noresult.call(void 0)):e.onComplete.call(void 0)},onFailure:function(e){t.unmask(),t.hideEmptyView(),t._onGroupingCompute=!1,n.log("resultsContentView::onFailure: ",e)}})}})})),define("DS/SNSearchUX/dropdown/SearchDropDownPQs",["UWA/Core","UWA/Element","UWA/Promise","UWA/Controls/Abstract","DS/UIKIT/Autocomplete","DS/Controls/Button","DS/Controls/Expander","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SearchVersioning","DS/SNInfraUX/SearchUtils","text!DS/SNSearchUX/assets/templates/SearchDropDown/SpecialCharacterDocumentation.json","i18n!DS/SNSearchUX/assets/nls/SearchDropDown.json","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/TaggerConfigAccess"],(function(e,t,n,i,s,o,a,r,c,l,d,u,h,p,g){"use strict";return i.extend({predefinedQueriesElementList:[],_searchDropDown:null,_webInwin:!1,_eventManager:void 0,init:function(t){let n=this;n._parent(t),e.is(t)&&(e.is(t.eventManager)&&(n._eventManager=t.eventManager),e.is(t.searchDropDown)&&(n._searchDropDown=t.searchDropDown),e.is(t.webInwin)&&(n._webInwin=t.webInwin))},createPredefinedQueriesComponent:function(){let t=this,n=new r({});c.fetchPQsFromServer(n).then((function(){var n=c.getPQs(),i=c.getPQNLS(),s=[];e.is(n)&&n.PQ.forEach((function(e){s.push({id:e.pqid,value:e.value,abbreviations:e.abbreviations,title:i[e.pqid+".Title"]})})),s.sort((function(e,t){return e.title<t.title?-1:e.title>t.title?1:0}));let o=g.getConfiguredPQs({tenantID:d.getActiveTenant()});o&&o.then((function(e){t.loadPredefinedQueries(e)}),(function(){console.log("Failed to get Configured PQ settings"),t.loadPredefinedQueries(s)}))}))},mergeRecursive:function(t,n){for(var i in n)n.hasOwnProperty(i)&&(e.is(t[i],"array")?t[i]=t[i].concat(n[i]):e.is(t[i],"object")&&e.is(n[i],"object")?this.mergeRecursive(t[i],n[i]):t[i]||(t[i]=n[i]))},buildPredefinedQueriesComponent:function(n){let i=this;if(!e.is(i._searchDropDown))return;let o=i.elements,a=new s({noResultsMessage:!1,placeholder:h.get("PQs.find"),events:{onKeyUp:function(e){i.filterPredefinedQueries(e.currentTarget.value)}}}).inject(o.predefinedQueriesInput);a.elements.input.addClassName("predefined-queries-search-field"),a.elements.input.addEventListener("blur",(function(e){i._searchDropDown.setFocus()})),a.elements.clear.addEventListener("click",(function(e){i._searchDropDown.noBlur=!0,i._searchDropDown.noFocus=!0,i.filterPredefinedQueries("")})),o.predefinedQueriesTable=t.create("table",{class:"predefined-queries-table"}).inject(o.predefinedQueriesContent),o.predefinedQueriesTableBody=t.create("tbody",{class:"predefined-queries-table-body"}).inject(o.predefinedQueriesTable)},loadPredefinedQueries:function(n){let i=this;if(!e.is(i._searchDropDown))return;let s=i.elements;i.predefinedQueriesElementList=[],s.predefinedQueriesTableBody.empty(),n.forEach((function(e,n){let o;o=n%2==0?t.create("tr",{class:"predefined-queries-grey"}).inject(s.predefinedQueriesTableBody):t.create("tr",{class:"predefined-queries-white"}).inject(s.predefinedQueriesTableBody),i.predefinedQueriesElementList.push(o);let a=t.create("table").inject(o),r=t.create("tbody").inject(a);t.create("td",{text:e.title,class:"predefined-queries-content-left"}).inject(r);let c=t.create("td",{class:"predefined-queries-content-right"}).inject(r);e.abbreviations.split(",").forEach((function(e){t.create("a",{text:e+":",class:"predefined-queries-content-abbreviation"}).inject(c).addEventListener("click",(function(e){let t=e.currentTarget.getText();i._searchDropDown.setInputValue(t),i._searchDropDown.setFocus(),t.length>2&&!0!==i._searchDropDown._inContextMode&&i._searchDropDown.switchActiveTabinstantSearchTab(t),!0===i._webInwin&&i._eventManager&&i._eventManager.dispatchEvent("onPQ",{displayString:t}),i._searchDropDown.hideSettingPQs()})),t.create("span",{text:" "}).inject(c)}))}))},filterPredefinedQueries:function(t){if(e.is(t)&&""!==t){var n=0;this.predefinedQueriesElementList.forEach((function(e,i){e.getText().toLowerCase().contains(t.toLowerCase())?(e.show(),e.removeClassName("predefined-queries-white"),e.removeClassName("predefined-queries-grey"),n%2==0?e.addClassName("predefined-queries-grey"):e.addClassName("predefined-queries-white"),n++):e.hide()}))}else this.predefinedQueriesElementList.forEach((function(e,t){e.show(),e.removeClassName("predefined-queries-white"),e.removeClassName("predefined-queries-grey"),t%2==0?e.addClassName("predefined-queries-grey"):e.addClassName("predefined-queries-white")}))},buildPredefinedQueriesDocumentation:function(n){var i=t.create("table",{class:"predefined-queries-table"}).inject(n),s=t.create("tbody").inject(i);JSON.parse(u).documentation.forEach(function(n){var i=t.create("tr").inject(s),o=t.create("td",{html:h.get(n.title)}).inject(i),a=t.create("td",{html:h.get(n.content)}).inject(i);e.is(n.options)&&e.is(n.options.isHeader)?(o.addClassName("predefined-queries-documentation-header"),a.addClassName("predefined-queries-documentation-header")):i.addClassName("predefined-queries-documentation-content")}.bind(this))},buildHelp:function(n,i){let s=this;if(!e.is(s._searchDropDown)||!e.is(n))return;let r=this.elements;r.predefinedQueriesTabContainer=n,r.predefinedQueriesDocumentationTextContainer=t.create("div",{class:"predefined-queries-documentation-container"}),this.buildPredefinedQueriesDocumentation(r.predefinedQueriesDocumentationTextContainer),r.userAssistanceContainer=new t.create("div",{class:"special-characters-link-container"}).inject(r.predefinedQueriesTabContainer),r.userAssistanceLink=new o({label:h.get("PQs.user.assistance"),emphasize:"secondary",icon:{iconName:"search-book",fontIconSize:"inherit",fontIconFamily:WUXManagedFontIcons.Font3DS},onClick:function(){let e=l.getCurrentRelease().slice(1);window.open("http://help.3ds.com/HelpDS.aspx?P=11&V="+e+"&L="+d.getLanguage()+"&F=EXP3DBasicsUserMap/exp3dbasics-m-Searching-for-content-sb.htm","_blank","popup")}}).inject(r.userAssistanceContainer),r.closeLink=new o({displayStyle:"lite",emphasize:"secondary",icon:{iconName:"close",fontIconSize:"1x",fontIconFamily:WUXManagedFontIcons.Font3DS},onClick:function(){s._searchDropDown.hideSettingPQs()}}).inject(r.userAssistanceContainer),r.closeLink.elements.iconPlaceholder.setAttributes({title:"Close"}),r.specialCharactersExpander=new a({header:h.get("PQs.special.characters"),body:r.predefinedQueriesDocumentationTextContainer,style:"filled-separate",expandedFlag:!0}).inject(r.predefinedQueriesTabContainer),r.specialCharactersExpander.elements.container.addClassName("special-characters-container"),r.specialCharactersExpander.elements.container.addClassName("expanded"),r.specialCharactersExpander.getContent().addEventListener("expand",(function(){r.specialCharactersExpander.elements.container.addClassName("expanded"),r.specialCharactersExpander.elements.container.removeClassName("collapsed"),!i&&r.typeShortcutsExpander.close()})),r.specialCharactersExpander.getContent().addEventListener("collapse",(function(){r.specialCharactersExpander.elements.container.removeClassName("expanded"),r.specialCharactersExpander.elements.container.addClassName("collapsed")})),r.typeShortcutsContent=t.create("div",{class:"predefined-queries-container"}),r.predefinedQueriesInput=t.create("div",{class:"predefined-queries-input"}).inject(r.typeShortcutsContent),r.predefinedQueriesContent=t.create("div",{class:"predefined-queries-content"}).inject(r.typeShortcutsContent),this.buildPredefinedQueriesComponent(),r.typeShortcutsExpander=new a({header:h.get("PQs.type.shortcuts"),body:r.typeShortcutsContent,style:"filled-separate"}).inject(r.predefinedQueriesTabContainer),r.typeShortcutsExpander.elements.container.addClassName("type-shortcuts-container"),r.typeShortcutsExpander.getContent().addEventListener("expand",(function(){r.typeShortcutsExpander.elements.container.addClassName("expanded"),r.typeShortcutsExpander.elements.container.removeClassName("collapsed"),!i&&r.specialCharactersExpander.close(),r.typeShortcutsExpander.expand()})),r.typeShortcutsExpander.getContent().addEventListener("collapse",(function(){r.typeShortcutsExpander.elements.container.removeClassName("expanded"),r.typeShortcutsExpander.elements.container.addClassName("collapsed")}))},destroy:function(){this._parent()}})})),define("DS/SNSearchUX/helpers/ToxicityCheck",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","UWA/Element","UWA/Promise","text!DS/SNSearchUX/assets/ToxicWords.json"],(function(e,t,n,i,s,o,a){"use strict";return t.singleton(i,n,{init:function(){this.splitRegex=/\b|_/g,this.placeHolder="*",this.regex=/[^a-zA-Z0-9|$|@]|\^/g,this.replaceRegex=/\w/g,this.list=JSON.parse(a).words},isProfane(e){return this.list.filter((t=>new RegExp(`\\b${t.replace(/(\W)/g,"\\$1")}\\b`,"gi").test(e))).length>0||!1},replaceWord(e){return e.replace(this.regex,"").replace(this.replaceRegex,this.placeHolder)},clean(e){const t=this.splitRegex.exec(e);return e&&t?e.split(this.splitRegex).map((e=>this.isProfane(e)?this.replaceWord(e):e)).join(t[0]):e}})})),define("DS/SNSearchUX/utils/SearchViewEvents",["UWA/Core","UWA/Controls/Abstract","DS/PubSub/PubSub","DS/PlatformAPI/PlatformAPI","DS/SNInfraUX/Logger","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json"],(function(e,t,n,i,s,o){"use strict";return t.extend({init:function(t){e.is(t)&&e.is(t.searchView)?(this.searchView=t.searchView,this.setup()):s.error("Initialization of Search view events failed")},setup:function(){i.subscribe("search.secondaryMenu:lastSearchResults",function(){this.searchView.autocomplete.setFieldValue(""),n.dispatch("onViewSearch")}.bind(this)),n.add("search.scope:tab",function(t){e.is(that.topBarMenu)&&this.searchView.topBarMenu._clickOnSearchInCurrentTab(t)}.bind(this)),n.add("search:showLastSearchResult",function(t,n){e.is(this.searchView.topBarMenu)&&!this.searchView.topBarMenu._inAppContext&&this.searchView.topBarMenu.currentMode!==o.search_current_tab&&(this.searchView.topBarMenu.showLastSearch(),this.searchView.reSearch=!0,this.searchView.reSearchQuery={value:t,searchStringToDisplayInSearchField:n})}.bind(this)),n.add("tab:change",function(){n.dispatch("SearchQuery",[""]),e.is(this.searchView.topBarMenu)&&e.is(this.searchView.topBarMenu.currentMode)&&this.searchView.topBarMenu.currentMode===o.search_current_tab&&this.searchView.autocomplete.setFieldValue("")}.bind(this)),n.add("onViewSearch",function(t){e.is(t)&&e.is(t.displayString)&&e.is(t.query)?this.searchView.socket.dispatchEvent("search",{value:t.query,searchStringToDisplayInSearchField:t.displayString,source:t.source,testing:t.objectToPreview,inputSearchString:t.inputSearchString}):this.searchView._onSearch({adv_search_status:!1})}.bind(this))}})})),define("DS/SNSearchUX/SearchUxPowerBy",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Debug","UWA/Class/Collection","UWA/Promise","UWA/Utils","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/MessageBus/MessageBus","DS/SNInfraUX/Logger","DS/PlatformAPI/PlatformAPI"],(function(e,t,n,i,s,o,a,r,c,l,d,u){"use strict";return t.extend(n,i,{_local_actions:"server",_mode:null,_protocol:"v1",init:function(e){this.setDebugMode(r.getDebugMode()),this.setOptions(e);var t=r.getOption("searchprotocolv2");e.addinMode&&t||c.setPowerByInitDone(),t&&(u.subscribe("webinwin:win:notification",this._onWinNotif.bind(this)),u.publish("webinwin:web:notification",JSON.stringify({event:"search_options_init",content:{}})),this._protocol="v2"),this._subscribeToLocalActionsRequests()},getPowerByOptions:function(){if("v2"==this._protocol){let e={hasPowerByActions:!1};return"sidebar"==this._mode&&(e.hasPowerByActions="none"!=this._local_actions),e}},_subscribeToLocalActionsRequests:function(){var e=this;l.subscribe({channel:"SearchUXPowerByIntegration",topic:"HasPowerByActionsReq",callback:e._hasPowerByActions.bind(e)}),l.subscribe({channel:"SearchUXPowerByIntegration",topic:"PowerByActionsReq",callback:e._getPowerByActions.bind(e)})},_onWinNotif:function(t){if(e.is(t,"object")&&e.is(t.event,"string")&&e.is(t.content,"object"))switch(t.event){case"search_options_set":this.log("webinwin:win:notification for search_options_set notif received, options="+JSON.stringify(t)),this._setPowerByOptions(t.content);break;case"search_contextualaction_set":this.log("webinwin:win:notification for search_contextualaction_set notif received, options="+JSON.stringify(t)),this._setPowerByActions(t.content)}else this.log("webinwin:win:notification does not contain info in expected format")},_setPowerByOptions:function(e){["incontext","sidebar"].indexOf(e.mode)>-1&&(this._mode=e.mode),["local","server","none"].indexOf(e.local_actions)>-1?this._local_actions=e.local_actions:this._local_actions="server",c.setPowerByInitDone()},_setPowerByActions:function(e){var t=this._mapPowerByActions(e);l.publish({channel:"SearchUXPowerByIntegration",topic:"PowerByActionsRes",data:t})},_mapPowerByActions:function(e){return e.actions.forEach((function(e){e.actions.forEach((function(e){e.sourcejs="DS/SNResultUX/utils/PowerByActionsHandler"}))})),e},_hasPowerByActions:function(e){l.publish({channel:"SearchUXPowerByIntegration",topic:"HasPowerByActionsRes",data:"none"===this._local_actions?"local":this._local_actions})},_getPowerByActions:function(e){if("none"===this._local_actions){var t={actions:[],status:"success"};e.objects.forEach((function(e){var n={id:e.id,actions:[]};t.actions.push(n)})),this._setPowerByActions(t)}else u.publish("webinwin:web:notification",JSON.stringify({event:"search_contextualaction_get",content:e}))}})})),define("DS/SNSearchUX/utils/SearchOptionsPopup",["UWA/Controls/Abstract","UWA/Core","UWA/Element","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/ComboBox","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SecurityContextManager","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,n,i,s,o,a,r,c,l,d,u){"use strict";return e.extend({elements:{},initialSettings:{},settings:{},tenant:null,init:function(e){this._parent(e),t.is(e)&&t.is(e.tenant)&&(this.tenant=e.tenant),t.is(this.immersiveFrame)||(this.immersiveFrame=new i({}).inject(document.body));var n=this.build();this.dialog=new s({immersiveFrame:this.immersiveFrame,title:"Search Settings",content:n,buttons:{Cancel:new o({label:"Cancel",touchMode:!0,onClick:function(e){this.dialog.close(),this.dispatchEvent("onClosePopup",[])}.bind(this)}),Ok:new o({label:"Apply",touchMode:!0,disabled:!0,onClick:function(e){var t=new s({immersiveFrame:this.immersiveFrame,title:"Apply Settings Changes",content:'<div class="search-popup-confirm-dialog">You\'re about to leave without applying your changes. Do you want to apply your changes ? The page will be reloaded.</div>',buttons:{Ok:new o({label:"Apply Changes",touchMode:!0,onClick:function(e){this.apply()}.bind(this)}),Cancel:new o({label:"Cancel",touchMode:!0,onClick:function(e){t.close()}.bind(this)})}})}.bind(this)})}}),this.load()},apply:function(){t.is(this.elements.useTabsCheckbox)&&l.setItem("search_tabbed_ui",this.elements.useTabsCheckbox.checked);var e=this.elements.resultsRevisionsSelect.elementsList[this.elements.resultsRevisionsSelect.selectedIndex].name,n=this.elements.resultsRevisionsSelect.elementsList[this.elements.resultsRevisionsSelect.selectedIndex].value;l.setItem("revisionDisplayType",{id:e,exprn:n}),"3DSpace"!==r.identifyClientInfo().identifier&&!0!==this.webInwin&&this.settings.listofCredentialObjectsArray.forEach(function(e){e.displayName===this.elements.collabSpaceCredentialsSelect.elementsList[this.elements.collabSpaceCredentialsSelect.selectedIndex].label&&l.setItem("securityContext"+this.tenant+r.getUserId(),JSON.stringify(e))}.bind(this)),l.commit();var i={labelItem:this.elements.csvSeparatorSelect.elementsList[this.elements.csvSeparatorSelect.selectedIndex].label,valueItem:this.elements.csvSeparatorSelect.elementsList[this.elements.csvSeparatorSelect.selectedIndex].value},s={};c.getOption("date_display_mode_array").forEach(function(e){u.get(e.id+".title")===this.elements.dateFormatSelect.elementsList[this.elements.dateFormatSelect.selectedIndex].label&&(s=e)}.bind(this));var o={csvMode:i,dateDisplayMode:s};l.setPreference({name:"optionMode",value:JSON.stringify(o),tenantId:this.tenant,onComplete:function(){location.reload(!0)}.bind(this),onFailure:function(e){Logger.error("Failure, Unable to save preferences :",e)}})},build:function(){var e=this.elements;return e.container=n.create("div",{class:"search-popup-content"}),e.layoutTitle=n.create("div",{class:"setting-container"}).inject(e.container),n.create("div",{class:"label-container-title",text:"Layout"}).inject(e.layoutTitle),"3DSpace"!==r.identifyClientInfo().identifier&&(e.useTabs=n.create("div",{class:"setting-container tabbed"}).inject(e.container),e.useTabsContainer=n.create("div",{class:"option-container"}).inject(e.useTabs),e.useTabsCheckbox=n.create("input",{class:"settings-tabs-checkbox",type:"checkbox"}).inject(e.useTabsContainer),e.useTabsCheckbox.addEventListener("change",function(e){this.setApplyButtonState()}.bind(this)),e.useTabsTitle=n.create("span",{class:"settings-tabs-title",text:"Use Tabs to Show Search"}).inject(e.useTabsContainer)),e.resultPresentation=n.create("div",{class:"setting-container"}).inject(e.container),n.create("div",{class:"label-container-title",text:"Result Presentation"}).inject(e.resultPresentation),e.dateFormat=n.create("div",{class:"setting-container date-format"}).inject(e.container),n.create("div",{class:"label-container",text:"Display Date Format"}).inject(e.dateFormat),e.dateFormatContainer=n.create("div",{class:"option-container-select"}).inject(e.dateFormat),e.dateFormatSelect=new a({touchMode:!0,enableSearchFlag:!1}).inject(e.dateFormatContainer),e.dateFormatSelect.addEventListener("change",function(e){this.setApplyButtonState()}.bind(this)),e.resultExport=n.create("div",{class:"setting-container"}).inject(e.container),n.create("div",{class:"label-container-title",text:"Search Result Export"}).inject(e.resultExport),e.csvSeparator=n.create("div",{class:"setting-container csv-separator"}).inject(e.container),n.create("div",{class:"label-container",text:"CSV Separator"}).inject(e.csvSeparator),e.csvSeparatorContainer=n.create("div",{class:"option-container-select"}).inject(e.csvSeparator),e.csvSeparatorSelect=new a({touchMode:!0,enableSearchFlag:!1}).inject(e.csvSeparatorContainer),e.csvSeparatorSelect.addEventListener("change",function(e){this.setApplyButtonState()}.bind(this)),e.collabSpace=n.create("div",{class:"setting-container"}).inject(e.container),n.create("div",{class:"label-container-title",text:"Collaborative Spaces"}).inject(e.collabSpace),e.resultsRevisions=n.create("div",{class:"setting-container results-revision"}).inject(e.container),n.create("div",{class:"label-container",text:"Search Results Revisions"}).inject(e.resultsRevisions),e.resultsRevisionsContainer=n.create("div",{class:"option-container-select"}).inject(e.resultsRevisions),e.resultsRevisionsSelect=new a({touchMode:!0,enableSearchFlag:!1}).inject(e.resultsRevisionsContainer),e.resultsRevisionsSelect.addEventListener("change",function(e){this.setApplyButtonState()}.bind(this)),"3DSpace"!==r.identifyClientInfo().identifier&&!0!==this.webInwin&&(e.collabSpaceCredentials=n.create("div",{class:"setting-container credentials"}).inject(e.container),n.create("div",{class:"label-container",text:"Collaborative Spaces Credentials"}).inject(e.collabSpaceCredentials),e.collabSpaceCredentialsContainer=n.create("div",{class:"option-container-select"}).inject(e.collabSpaceCredentials),e.collabSpaceCredentialsSelect=new a({touchMode:!0,enableSearchFlag:!1}).inject(e.collabSpaceCredentialsContainer),e.collabSpaceCredentialsSelect.addEventListener("change",function(e){this.setApplyButtonState()}.bind(this))),e.container},load:function(){var e=this.elements;if("3DSpace"!==r.identifyClientInfo().identifier){let n=l.getItem("search_tabbed_ui");e.useTabsCheckbox.checked=!!t.is(n)&&n,this.initialSettings.useTabs=this.elements.useTabsCheckbox.checked}let n=c.getOption("date_display_mode_array");i=[],t.is(n)&&n.length>0&&(n.forEach(function(e){i.push({label:u.get(e.id+".title"),value:e.value})}.bind(this)),this.elements.dateFormatSelect.elementsList=i);var i=[];let s=c.getOption("csvSeparatorArray");if(t.is(s)&&s.length>0&&(s.forEach(function(e){i.push({label:u.get("csvSeparatorUI.values."+e.id),value:e.value})}.bind(this)),this.elements.csvSeparatorSelect.elementsList=i),l.getItemPromise("optionMode",this.tenant).then(function(e){t.is(e)&&(this.elements.csvSeparatorSelect.value=c.getOption("csvSeparator"),t.is(e.csvMode)&&t.is(e.csvMode.valueItem)&&(this.elements.csvSeparatorSelect.value=e.csvMode.valueItem),this.initialSettings.csvSeparator=this.elements.csvSeparatorSelect.elementsList[this.elements.csvSeparatorSelect.selectedIndex].label,t.is(e.dateDisplayMode)&&t.is(e.dateDisplayMode.id)?Array.from(this.elements.dateFormatSelect.elementsList).forEach(function(t,n){t.label===u.get(e.dateDisplayMode.id+".title")&&(this.elements.dateFormatSelect.selectedIndex=n)}.bind(this)):this.elements.dateFormatSelect.selectedIndex=0,this.initialSettings.dateFormat=this.elements.dateFormatSelect.elementsList[this.elements.dateFormatSelect.selectedIndex>=0?this.elements.dateFormatSelect.selectedIndex:0].label)}.bind(this)),i=[],r.isRoleAvailable(["CSV"],this.tenant,function(e){if(!0===e){let e=c.getOption("show_search_results_revision_array");t.is(e)&&e.length>0&&(e.forEach(function(e){i.push({label:u.get(e.id+".title"),value:e.exprn,name:e.id})}.bind(this)),this.elements.resultsRevisionsSelect.elementsList=i);let n=t.is(l.getItem("revisionDisplayType"))?l.getItem("revisionDisplayType"):c.getOption("defaultRevision",{tenant:this.tenant});t.is(n)?(Array.from(this.elements.resultsRevisionsSelect.elementsList).forEach(function(e,t){e.label===u.get(n.id+".title")&&(this.elements.resultsRevisionsSelect.selectedIndex=t)}.bind(this)),this.initialSettings.searchResultRevisions=this.elements.resultsRevisionsSelect.elementsList[this.elements.resultsRevisionsSelect.selectedIndex].label):(this.elements.resultsRevisionsSelect.selectedIndex=0,this.initialSettings.searchResultRevisions=this.elements.resultsRevisionsSelect.elementsList[0].label)}}.bind(this)),i=[],"3DSpace"!==r.identifyClientInfo().identifier&&!0!==this.webInwin){let e=r.identifyClientInfo(void 0),n=!1;if(t.is(e)&&t.is(e.identifier)&&("3DDashboard"===e.identifier||"3DSwym"===e.identifier)&&(n=!0),t.is(e)&&t.is(e.addinmode)&&"catiav5"===e.addinmode&&(n=!0),c.getOption("global_action_credentials")&&!0===n){var o=0;d.getSecurityContextPromise(this.tenant).then(function(e){var n=l.getItem("securityContext"+this.tenant+r.getUserId());t.is(n,"string")&&(n=JSON.parse(n)),this.settings.listofCredentialObjectsArray=e,this.settings.listofCredentialObjectsArray.forEach(function(e){t.is(e.isDefault)&&!0===e.isDefault?i.unshift({label:u.get(e.displayName),value:e.name}):i.push({label:u.get(e.displayName),value:e.name})}.bind(this)),i.forEach(function(e,i){t.is(n)&&t.is(n.name)&&n.name===e.value&&(o=i,this.elements.collabSpaceCredentialsSelect.value=e.value)}.bind(this)),this.elements.collabSpaceCredentialsSelect.elementsList=i,this.initialSettings.collaborativeSpaceCredentials=this.elements.collabSpaceCredentialsSelect.elementsList[o].label,this.elements.collabSpaceCredentialsSelect.selectedIndex=o}.bind(this))}}},isUpdated:function(){var e=!1;return t.is(this.initialSettings.useTabs)&&this.initialSettings.useTabs!==this.elements.useTabsCheckbox.checked&&(e=!0),t.is(this.initialSettings.csvSeparator)&&this.elements.csvSeparatorSelect.selectedIndex>=0&&this.initialSettings.csvSeparator!==this.elements.csvSeparatorSelect.elementsList[this.elements.csvSeparatorSelect.selectedIndex].label&&(e=!0),t.is(this.initialSettings.dateFormat)&&this.elements.dateFormatSelect.selectedIndex>=0&&this.initialSettings.dateFormat!==this.elements.dateFormatSelect.elementsList[this.elements.dateFormatSelect.selectedIndex].label&&(e=!0),t.is(this.initialSettings.searchResultRevisions)&&this.elements.resultsRevisionsSelect.selectedIndex>=0&&this.initialSettings.searchResultRevisions!==this.elements.resultsRevisionsSelect.elementsList[this.elements.resultsRevisionsSelect.selectedIndex].label&&(e=!0),t.is(this.initialSettings.collaborativeSpaceCredentials)&&this.elements.collabSpaceCredentialsSelect.selectedIndex>=0&&this.initialSettings.collaborativeSpaceCredentials!==this.elements.collabSpaceCredentialsSelect.elementsList[this.elements.collabSpaceCredentialsSelect.selectedIndex].label&&(e=!0),e},setApplyButtonState:function(){this.isUpdated()?this.dialog.buttons.Ok.disabled=!1:this.dialog.buttons.Ok.disabled=!0}})})),define("DS/SNSearchUX/SuggestionUXHelper",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Promise","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchResultCategories"],(function(e,t,n,i,s,o){"use strict";return t.singleton(n,{init:function(){},getSuggestionCategories:function(){return o.getActiveCategories(this.ResultCategoryUXHelper._getTenant(),"suggestion")},getSuggestHelper:function(){var e=this;return this._suggestHelperPromise||(this._suggestHelperPromise=new i((function(t,n){require(["DS/SNResultUX/utils/ResultCategoryUXHelper"],(function(n){e.ResultCategoryUXHelper=n,n.getResultCategoryUXHelper().then((function(){t()}))}))}))),this._suggestHelperPromise},getSuggests:function(e){return this.ResultCategoryUXHelper.getCategoryResultsCollectionPromise("suggestion",e)},buildSearchParams:function(t){return this.ResultCategoryUXHelper.buildSearchParams(e.extend({group:"suggestion"},t))}})})),define("DS/SNSearchUX/utils/SearchHelpPopup",["UWA/Controls/Abstract","UWA/Core","UWA/Element","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Accordeon","DS/Controls/LineEditor","DS/Controls/Scroller","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/PredefinedQueries","text!DS/SNSearchUX/assets/templates/SearchDropDown/SpecialCharacterDocumentation.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,n,i,s,o,a,r,c,l,d,u,h,p,g,_){"use strict";return e.extend({elements:{},init:function(e){this._parent(e),t.is(this.immersiveFrame)||(this.immersiveFrame=new i({}).inject(document.body));var n=this.build();this.dialog=new s({immersiveFrame:this.immersiveFrame,title:"Search Help",content:n,buttons:{Cancel:new o({label:"Close",touchMode:!0,onClick:function(e){this.dialog.close()}.bind(this)})}})},build:function(){var e=this.elements;return e.container=n.create("div",{class:"search-popup-content"}),e.accordeon=new a({items:[{header:"Special Characters",content:this.buildDocumentation()},{header:"Predefined Query",content:this.buildPredefinedQueriesComponent()}],style:"filled-separate",touchMode:!0}).inject(e.container),e.accordeon.expandItem(0),e.container},buildDocumentation:function(){var e=n.create("table",{class:"predefined-queries-table"}),i=n.create("tbody").inject(e);return JSON.parse(g).documentation.forEach(function(e){var s=n.create("tr").inject(i),o=n.create("td",{html:e.title}).inject(s),a=n.create("td",{html:e.content}).inject(s);t.is(e.options)&&t.is(e.options.isHeader)?(o.addClassName("predefined-queries-documentation-header"),a.addClassName("predefined-queries-documentation-header")):s.addClassName("predefined-queries-documentation-content")}.bind(this)),e},buildPredefinedQueriesComponent:function(){var e=n.create("div",{class:"predefined-queries-container"});new r({placeholder:"Search",displayClearFieldButtonFlag:!0,touchMode:!0}).inject(e).addEventListener("uncommittedChange",function(e){this.filterPredefinedQueries(e.currentTarget.getElement("input").value)}.bind(this)),this.elements.predefinedQueriesTable=n.create("table",{class:"predefined-queries-table"}).inject(e),this.elements.predefinedQueriesList=n.create("tbody",{class:"predefined-queries-table-body"}).inject(this.elements.predefinedQueriesTable);var i=new h({});return p.fetchPQsFromServer(i).then(function(){var e=p.getPQs(),n=p.getPQNLS(),i=[];t.is(e)&&e.PQ.forEach((function(e){i.push({id:e.pqid,value:e.value,abbreviations:e.abbreviations,title:n[e.pqid+".Title"]})})),i.sort((function(e,t){return e.title<t.title?-1:e.title>t.title?1:0}));let s=l.getActiveTenant();d.getTenantSettings(s).then((function(){let e=d.getOption("pqs",{tenant:s}),n=e.selected_pqs,i=e.selected_custom_pqs;this.mergeRecursive(n,i),t.is(n)&&this.loadPredefinedQueries(n)}),(function(){reject("Failed to get Tenant settings")})),this.loadPredefinedQueries(i)}.bind(this)),e},mergeRecursive:function(e,n){for(var i in n)n.hasOwnProperty(i)&&(t.is(e[i],"array")?e[i]=e[i].concat(n[i]):t.is(e[i],"object")&&t.is(n[i],"object")?this.mergeRecursive(e[i],n[i]):e[i]||(e[i]=n[i]))},loadPredefinedQueries:function(e){var t=this.elements;this.predefinedQueriesElementList=[],t.predefinedQueriesList.empty();new c(t.predefinedQueriesList,{}).inject(this.elements.predefinedQueriesTable);e.forEach(function(e,i){let s;s=i%2==0?n.create("tr",{class:"predefined-queries-grey"}).inject(t.predefinedQueriesList):n.create("tr",{class:"predefined-queries-white"}).inject(t.predefinedQueriesList),this.predefinedQueriesElementList.push(s);let o=n.create("table").inject(s),a=n.create("tbody").inject(o);n.create("td",{text:e.title,class:"predefined-queries-content-left"}).inject(a);let r=n.create("td",{class:"predefined-queries-content-right"}).inject(a);e.abbreviations.split(",").forEach(function(e){n.create("a",{text:e+":",class:"predefined-queries-content-abbreviation"}).inject(r).addEventListener("click",function(e){let t=e.currentTarget.getText();this.dialog.close(),this.dispatchEvent("setFieldValue",[t])}.bind(this)),n.create("span",{text:" "}).inject(r)}.bind(this))}.bind(this))},filterPredefinedQueries:function(e){if(t.is(e)&&""!==e){var n=0;this.predefinedQueriesElementList.forEach((function(t,i){t.getText().toLowerCase().contains(e.toLowerCase())?(t.show(),t.removeClassName("predefined-queries-white"),t.removeClassName("predefined-queries-grey"),n%2==0?t.addClassName("predefined-queries-grey"):t.addClassName("predefined-queries-white"),n++):t.hide()}))}else this.predefinedQueriesElementList.forEach((function(e,t){e.show(),e.removeClassName("predefined-queries-white"),e.removeClassName("predefined-queries-grey"),t%2==0?e.addClassName("predefined-queries-grey"):e.addClassName("predefined-queries-white")}))}})})),define("DS/SNSearchUX/SearchUX_TopBar",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Debug","UWA/Class/Options","UWA/Class/Collection","UWA/Promise","DS/TransientWidget/TransientWidget","DS/PubSub/PubSub","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchVersioning","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchUtils","DS/SNSearchUX/InContextSearch","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchControlCenterFetchService","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SearchLogin","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNInfraUX/Api/SearchApi","DS/SNInfraUX/SearchRevisionDelegator","DS/SNInfraUX/utils/WildcardMgr","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json","DS/SNInfraUX/Logger","DS/SNSearchUX/SearchUxPowerBy","DS/TransientWidget/Tool/TransientMessaging","DS/TransientWidget/Tool/Mapping"],(function(e,t,n,i,s,o,a,r,c,l,d,u,h,p,g,_,m,S,f,C,y,v,b,w,D,I,E,T,x){"use strict";var M="fitted",N=t.singleton(n,i,{_resourcesMgt:null,_selectedSource:null,_url_settings:{},_socket:null,_active_3dsearch_widget:null,_wdg_ready:!0,_ctx_search:null,_currentTabId:null,_topframe_search_delegation:!1,_SWFilteringCheckDone:!0,result_ux_customization:{},_PQEvaluationPromisePC:o.deferred(),_EasyType:null,_sidePanelClose:!0,_topFrame:null,_firstInit:!1,_sidePanelHide:!1,searchUxPowerBy:null,_stackTransient:[],_prevent3dSearchSidePanelPositionBack:!1,isCtxWdg:!1,_is_title_only_search:!1,_resurrectSearch:!1,init:function(t){I.group("SearchUX_TopBar.init"),I.log("JS code level for search: ",l.getCurrentVersion()),I.log("options:",t);var n=this;this.isCtxWdg=!1,this._resurrectSearch=t.resurrectSearch||!1,this._overrideTransientMessaging(),this._onNotODTContext();var i=window.location.search.substring(1);if(i){for(var s=i.split("&"),o=0;o<s.length;o++){var a=s[o].split("=");1===a.length?this._url_settings[a[0]]=!0:2===a.length&&a[0].length>0&&(this._url_settings[a[0]]=a[1])}h.urlSettings(this._url_settings)}for(let e=0,n=t.events.length;e<n;e++)void 0===t.events[e]&&unset(t.events[e]);this.setOptions(t),e.is(t)&&e.is(t.userId)?(g.setUserId(t.userId),I.log("Connected User = "+g.getUserId())):I.log("SearchTopBar:init Input options do not contain the connected userId"),!0===h.getOption("forceSearchTransientAndNoTab")?(u.setItem("integratedSearch",!1),u.commit({})):!0!==h.getOption("publicBetaUser")||"tablet"!==g.getDeviceType()&&""!==g.getDeviceCategory()||"3DSwym"===g.identifyClientInfo().identifier||"3DSpace"===g.identifyClientInfo().identifier||void 0!==this.getAddinMode()||(u.setItem("integratedSearch",!0),u.commit({})),this.searchUxPowerBy=new E({addinMode:this.getAddinMode()}),g.activateCompactOrComfortMode(),g.ensureBetaStatus().then(function(){this.setDebugMode(h.getDebugMode()),this._resourcesMgt=new d(e.is(t)?t.ressources:{}),v.setResourceMgt(this._resourcesMgt);var i=this._resourcesMgt.getActiveTenant();b.initialize(i),h.getTenantSettings(i).then(function(){g.activateCompactOrComfortMode(i),void 0!==t&&void 0!==this.options.ressources&&this._buildUI(),e.is(n.options.searchParams)&&(e.is(n.options.searchParams.close,"function")&&e.is(n.options.searchParams.isOpen,"function")&&e.is(n.options.searchParams.open,"function")&&(n._topframe_search_delegation=!0),n.options.searchParams.pqAccessEvalcallback&&(n.pqAccessEvalcallback=n.options.searchParams.pqAccessEvalcallback),n.options.searchParams.resultUX_customization&&n._addResultUX_customization(n.options.searchParams.resultUX_customization),e.is(n.options.searchParams.searchHelper,"function")&&(n.searchHelper=n.options.searchParams.searchHelper),e.is(n.options.searchParams.search_settings,"object")&&h.initialize({search_settings:n.options.searchParams.search_settings}),g.autocompleteRendered().then((function(){e.is(n.options.searchParams.onSearchInit,"function")&&n.options.searchParams.onSearchInit.call()}))),n._initTopFrame(t)}.bind(n))}.bind(this)),I.groupEnd()},_overrideTransientMessaging:function(){let e=this;T.getInstance().on(x.TransientMessaging.ShowWidget,(function(t){if(void 0!==e.getAddinMode())return;if(!0===u.getItem("integratedSearch")&&e._topFrame&&(t.data.closeSearch&&!0===t.data.closeSearch||t.options.closeSearch&&!0===t.options.closeSearch)&&"X3DOPMR_AP"!==t.appId&&"X3DMCTY_AP"!==t.appId)return e._topFrame._frame.closePanel("right","search"),e._topFrame._onRightPanelStateChange("closed"),e._stackTransient=[],void(e._prevent3dSearchSidePanelPositionBack=!0);e._stackTransient.push(t.appId);let n=g.getSearchAppId();n!==t.appId&&-1!==e._stackTransient.indexOf(n)&&(e._stackTransient=[],a.closeWidget(n))}))},_onNotODTContext:function(){if(!1===g.isODTMode()){require(["DS/WidgetPreview/Controller/TransientManager"],(function(e){e.getInstance().getUpdatedStartingData=t=>{var n,i=e.getInstance(),s=i.apps[t||i.activeAppId],o=s&&s.startingData||{};return n=UWA.clone(o),Object.keys(n).forEach((function(e){n[e]=s.model.widgets[0].widget.data[e]})),("X3DSEAR_AP"==t||"X3PSEAR_AP"==t)&&n.settings_topbar&&delete n.settings_topbar,n}}))}},_initTopFrame:function(t){let n=this;require(["DS/TopFrame/TopFrame"],(function(i){n._topFrame=i,!0===u.getItem("integratedSearch")&&(e.is(t.events)&&e.is(t.events.initFrame,"function")&&t.events.initFrame.call(void 0,n._topFrame),e.is(n._topFrame)&&e.is(n._topFrame._frame)&&(n._topFrame._frame.addEvent("onPanelClose",(function(t){g.isFUN109031Active()&&e.is(t)&&e.is(t.panel)&&"left"===t.panel&&e.is(t.tag)&&"myAppsCtn"===t.tag&&(h.options.search_settings.taggerClosed=!0,c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"showEmbeddedView"})),g.isFUN109031Active()&&e.is(t)&&e.is(t.panel)&&"left"===t.panel&&e.is(t.tag)&&"taggerCtn"===t.tag&&(h.options.search_settings.taggerClosed=!0),e.is(t)&&e.is(t.tag)&&"taggerCtn"!==t.tag&&("right"===t.panel&&c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"datagrid_preference_force_close"}),"right"===t.panel&&(n._sidePanelStatus=g.SidePanelStatus.SIDE_PANEL_CLOSED),n._sidePanelClose=!0,n._sidePanelHide=!0,n._socket.dispatchEvent("showSearchInThisTab"),e.is(t)&&e.is(t.panel)&&"left"===t.panel&&e.is(t.tag)&&"dashboardMenuCtn"===t.tag||(n._socket.dispatchEvent("onCloseTransientTopBar"),n._socket.dispatchEvent("showSearchInThisTab"),c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"datagrid_preference_force_close"})),"right"===t.panel&&t.tag===g.getSearchAppId()&&(c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"sidePanelClosed"}),n._ctx_search.incontextSidepanelStatusPromise||(n._ctx_search.incontextSidepanelStatusPromise=o.deferred()),n._ctx_search.incontextSidepanelStatusPromise&&n._ctx_search.incontextSidepanelStatusPromise.resolve()),!0===g.isTaggerOpenedByCode()&&n._socket.dispatchEvent("closeTagger"),"right"===t.panel&&t.tag===g.getSearchAppId()&&n._socket.dispatchEvent("setTaggerContextOn3DDActiveTab"))})),n._topFrame._frame.addEvent("onPanelOpen",(function(t){"right"===t.panel&&!0===n._sidePanelClose&&(e.is(n._topFrame.isTaggerVisible,"function")&&!0===n._topFrame.isTaggerVisible()?g.setTaggerOpenedByCode(!1):g.setTaggerOpenedByCode(!0),n._sidePanelStatus=g.SidePanelStatus.SIDE_PANEL_OPEN),t.position&&"right"===t.panel&&"maximized"===t.position&&e.is(n._topFrame.isTaggerVisible,"function")&&!1===n._topFrame.isTaggerVisible()&&g.getSearchAppId()===t.tag&&n._isOpenTaggerSidePanelViewOnSearch()&&(!e.is(h.options.search_settings.taggerClosed)||e.is(h.options.search_settings.taggerClosed)&&0==h.options.search_settings.taggerClosed)&&n._openTagger(),setTimeout((function(){if(e.is(t)&&e.is(t.tag)&&t.tag===g.getSearchAppId()&&e.is(t.position)){var i=0,s=n._isSearchWidgetAvailable();if(i=void 0===s.maxIndex&&void 0!==s.indexSide?s.indexSide:s.maxIndex,e.is(s.wdg_search_items)&&s.wdg_search_items.length>0&&e.is(s.wdg_search_items[i])){var o=s.wdg_search_items[i].get("widget_id");if(e.is(o)){let i=g.getSearchWidget(o),s=!1;if(e.is(i)&&e.is(i.getValue,"function")&&(s=i.getValue("previewMode")),"fitted"===t.position||"maximized"===t.position)n._socket.dispatchEvent("hideSearchInThisTab"),e.is(n._topFrame.isTaggerVisible())&&n._topFrame.isTaggerVisible()&&g.getsearchType()===g.SearchTypeEnum.ADVANCED_SEARCH&&(n._socket.dispatchEvent("showAdvancedSearch",{adv_search_field:null,widgetId:o,sidePanelStatus:n._sidePanelStatus}),g.setTaggerOpenedByCode(!0)),n._socket.dispatchEvent("manageActionIconOnSidePanel",{widgetId:o,activation:!1,position:t.position});else{n._socket.dispatchEvent("showSearchInThisTab"),n._socket.dispatchEvent("manageActionIconOnSidePanel",{widgetId:o,activation:!0,position:t.position});var a=document.querySelector("#tagnavigator");e.is(a)&&(a=a.hasClassName("maximized")),e.is(a)&&!0===a||!0===g.isTaggerOpenedByCode()&&n._socket.dispatchEvent("closeTagger")}!1===n._prevent3dSearchSidePanelPositionBack?u.setLocalStorageItem("3dSearch-sidePanelPositionBack",t.position):n._prevent3dSearchSidePanelPositionBack=!1}}require(["DS/PlatformAPI/PlatformAPI"],(function(e){e.publish("sideOnPanelOpen",t)}))}}),1e3)}))))}))},_buildUI:function(){if(!0===h.getOption("universal_search")){var t=this;I.log("User "+this.options.userId+" belong to the white list"),this._initializePlatforms();var n=h.getOption("fed_search_init_timeout");e.is(n,"number")&&(0===n&&this._loginToSources(),n>0&&setTimeout((function(){t._loginToSources()}),1e3*n)),this._intializeSocket(),this._ctx_search=new _({addinMode:this.getAddinMode()}),this._ctx_search.computeSearchBar=this.computeSearchBar.bind(this),this._ctx_search._socket.addListener("addResultUX_customization",(function(e){t._addResultUX_customization(e)})),this._socket.addListener("search",(function(n){!0!==t._is_title_only_search||e.is(n.inCtx_widget_id)||(n.isTitleOnly=!0),t._setSearchFieldCurrentMode("search"),(e.is(n.reSearch)&&!0!==n.reSearch||!e.is(n.reSearch))&&u.getItem("integratedSearch")&&!0===t._sidePanelClose&&t._socket.dispatchEvent("clearfilterbyclosesidepanel"),t._addSearchTypeInformationAndLaunchWidget(n,g.SearchTypeEnum.SEARCH);c.publish({channel:"TopBar_Suggest",topic:"CancelSuggest",data:!0}),g.setsearchType(g.SearchTypeEnum.SEARCH)})),this._socket.addListener("myContent",(function(e){t._setSearchFieldCurrentMode("myContent"),(u.getItem("integratedSearch")&&!0===t._sidePanelClose||g.isFUN109031Active())&&t._socket.dispatchEvent("clearfilterbyclosesidepanel",{bOnlyCurrentTab:!0}),t._addSearchTypeInformationAndLaunchWidget(e,g.SearchTypeEnum.MY_CONTENT),g.setsearchType(g.SearchTypeEnum.MY_CONTENT),t._openEmbeddedTagger()})),this._socket.addListener("myRecentContent",(function(e){t._addSearchTypeInformationAndLaunchWidget(e,g.SearchTypeEnum.MY_RECENT_CONTENT),g.setsearchType(g.SearchTypeEnum.MY_RECENT_CONTENT)})),this._socket.addListener("advancedSearch",(function(e){g.setSidePanelTaggerContextPromise(t.getAddinMode()),t._setSearchFieldCurrentMode("advancedSearch"),I.log("[3dSearch - adv search mode]",g.getsearchType()),u.getItem("integratedSearch")&&!0===t._sidePanelClose&&g.SearchTypeEnum.ADVANCED_SEARCH!==g.getsearchType()&&t._socket.dispatchEvent("clearfilterbyclosesidepanel"),u.setLocalStorageItem("3dSearch-sidePanelPositionBack",M),t._addSearchTypeInformationAndLaunchWidget(e,g.SearchTypeEnum.ADVANCED_SEARCH),g.setsearchType(g.SearchTypeEnum.ADVANCED_SEARCH),u.setItem("errorManager:limit",void 0),r.dispatch("errorManager:clear")})),this._socket.addListener("favoriteSearches",(function(e){t._setSearchFieldCurrentMode("favoriteSearch"),u.getItem("integratedSearch")&&!0===t._sidePanelClose&&t._socket.dispatchEvent("clearfilterbyclosesidepanel"),t._addSearchTypeInformationAndLaunchWidget(e,g.SearchTypeEnum.FAVORITE_SEARCH),g.setsearchType(g.SearchTypeEnum.FAVORITE_SEARCH),t._openEmbeddedTagger()})),c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"favoriteSearches",callback:function(){u.getItem("integratedSearch")&&!0===t._sidePanelClose&&t._socket.dispatchEvent("clearfilterbyclosesidepanel"),u.setLocalStorageItem("3dSearch-sidePanelPositionBack",M),console.log(M),t._addSearchTypeInformationAndLaunchWidget({value:g.SearchTypeEnum.FAVORITE_SEARCH,adv_search:!1,searchType:g.SearchTypeEnum.FAVORITE_SEARCH,active_tenant:"OnPremise",value:g.SearchTypeEnum.FAVORITE_SEARCH},g.SearchTypeEnum.FAVORITE_SEARCH),g.setsearchType(g.SearchTypeEnum.FAVORITE_SEARCH)}}),this._socket.addListener("focusOnSearch",this._prepareLaunchWdg),this._socket.addListener("hideAdvancedSearch",(function(){t._socket.dispatchEvent("hideAdvancedSearch",{})})),this._socket.addListener("showAdvancedSearch",(function(n){if(e.is(n)&&(!0!==u.getItem("integratedSearch")||"normal"!==u.getLocalStorageItem("3dSearch-sidePanelPositionBack"))){var i=t._isSearchWidgetAvailable();if(e.is(i)&&!0===i.wdg_available){var s=void 0===i.maxIndex&&void 0!==i.indexSide?i.indexSide:i.maxIndex,o=i.wdg_search_items[s].get("widget_id");e.is(o)&&(n.widgetId=o)}n.sidePanelStatus=t._sidePanelStatus}})),this._socket.addListener("openTagger",(function(){t._openTagger()})),c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"openTagger",callback:function(){t._openTagger()}}),r.add("search:refreshSearchField",(function(e){t._socket.dispatchEvent("onRefreshSearchField",e)})),this._socket.addListener("setTaggerMode",(function(n){if(e.is(t.options.events.setTaggerMode,"function")&&t.options.events.setTaggerMode(n),!0===t._firstInit&&e.is(n)&&"criteria"===n){var i=t._isSearchWidgetAvailable();if(e.is(i)&&!0===i.wdg_available){var s=void 0===i.maxIndex&&void 0!==i.indexSide?i.indexSide:i.maxIndex,o=i.wdg_search_items[s].get("widget_id");e.is(o)&&(!e.is(u.getItem("integratedSearch"))||!0===u.getItem("integratedSearch")&&"normal"!==u.getLocalStorageItem("3dSearch-sidePanelPositionBack"))&&t._socket.dispatchEvent("showAdvancedSearch",{adv_search_field:null,widgetId:o,sidePanelStatus:t._sidePanelStatus})}t._firstInit=!1}})),this._socket.addListener("closeTagger",(function(){e.is(t.options.events.closeTagger,"function")&&t.options.events.closeTagger()})),this._socket.addListener("clearSearch",(function(){"3DDashboard"===t._resourcesMgt.getActiveTenant()&&e.is(t.options.events.clearSearch,"function")&&t.options.events.clearSearch.call(void 0,null)})),this._socket.addListener("closeTransient",(function(n){e.is(t.options.events.closeTagger,"function")&&t.options.events.closeTagger.call(void 0,null),t._topframe_search_delegation?t.options.searchParams.close.call(void 0,n):h.getOption("transient_widget")&&(t._stackTransient=[],a.closeWidget(g.getSearchAppId()))})),this._socket.addListener("onDragStart",(function(){t._topframe_search_delegation?t.options.searchParams.close.call():e.is(t.options)&&e.is(t.options.addinMode)&&e.is(t.options.addinMode.value,"string")&&("solidworks"===t.options.addinMode.value||"catiav5"===t.options.addinMode.value)||!1!==u.getItem("integratedSearch")||setTimeout((function(){!0===g.isTaggerOpenedByCode()&&t._socket.dispatchEvent("closeTagger"),a.hide()}),250),!0===u.getItem("integratedSearch")&&e.is(t._topFrame)&&e.is(t._topFrame._frame)&&(t._topFrame._frame.isPanelMaximized("right")||t._topFrame._frame.isPanelFitted("right"))&&(t._topFrame._frame.closePanel("right",{}),t._topFrame._onRightPanelStateChange("closed")),t._socket.dispatchEvent("onResultDrag")})),this._socket.addListener("onReshow",(function(){e.is(t.options)&&e.is(t.options.addinMode)&&e.is(t.options.addinMode.value,"string")&&("solidworks"===t.options.addinMode.value||"catiav5"===t.options.addinMode.value)||(t._stackTransient=[],a.closeWidget(g.getSearchAppId()))})),this._socket.addListener("onShowPQListUX",(function(){t.buildPQAccessMap(),t._PQEvaluationPromisePC.promise.then((function(){require(["DS/SNResultUX/SearchPQListUX"],(function(e){e.showPQSelector({pqAccessMap:t.pqAccessMap,pqSelectionCallback:function(e){t._socket.dispatchEvent("onPQPrefixSelect",e)}})}))}))})),this._socket.addListener("getsearchTopbarResouceJson",(function(n){t._socket.dispatchEvent("searchTopbarResouceJson",{resources:t._resourcesMgt.toJSON(),tenants:t._resourcesMgt.getAvailableTenants(),active_tenant:t._resourcesMgt.getActiveTenant()},e.is(n)?n.socket_id:null)})),this._socket.addListener("fetchPQsFromServer",(function(){f.fetchPQsFromServer(t._resourcesMgt)})),this._socket.addListener("hideSidePanel",(function(){e.is(t._topFrame)&&e.is(t._topFrame._frame)&&(t._topFrame._frame.closePanel("right","search"),t._topFrame._onRightPanelStateChange("closed")),t._topFrame._onRightPanelStateChange("closed"),t._sidePanelHide=!0})),this._socket.addListener("3DSearchWidgetmaximized",(function(e){if(!0===u.getItem("integratedSearch")&&t._topFrame&&"search"===t._topFrame._visibleXApp){var n=t._topFrame._frame.isPanelOpen("right");"windowed"===e&&!1===t._sidePanelHide?(t._topFrame._updateColumn("right","search"),t._sidePanelHide=!0):"maximized"===e&&!0===n?(t._sidePanelHide=!1,t._topFrame._frame.closePanel("right","search"),t._topFrame._onRightPanelStateChange("closed")):null===n&&"windowed"===e&&!0===t._sidePanelHide&&!0!==t._sidePanelClose&&t._topFrame._updateColumn("right","search")}"fullscreen"===e&&t._openTagger()})),this._socket.addListener("topBar-LastSearch-clearLocalFilter",(function(){u.getItem("integratedSearch")&&!0===t._sidePanelClose&&t._socket.dispatchEvent("clearfilterbyclosesidepanel")})),this._socket.addListener("set_title_only_search",(function(e){t._is_title_only_search=e.is_title_only})),c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"deactivateIncontextSearchStarted",callback:function(e){t._ctx_search.incontextSidepanelStatusPromise||(t._ctx_search.incontextSidepanelStatusPromise=o.deferred());var n=t.isIntegratedSearch();e.closeSidePanel&&n&&t._ctx_search._incontextSidepanelStatus?(t._topFrame._frame.closePanel("right",{}),t._topFrame._onRightPanelStateChange("closed"),t._socket.dispatchEvent("closeTagger")):t._ctx_search.incontextSidepanelStatusPromise.resolve(),t._ctx_search.deactivateIncontextSearchPromise||(t._ctx_search.deactivateIncontextSearchPromise=o.deferred()),o.all([t._ctx_search.deactivateIncontextSearchPromise.promise,t._ctx_search.incontextSidepanelStatusPromise.promise]).then((function(){t._ctx_search.setIncontextSearchActive(!1)}))}}),c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"deactivateIncontextSearchEnded",callback:function(){t._ctx_search.deactivateIncontextSearchPromise&&t._ctx_search.deactivateIncontextSearchPromise.resolve()}}),c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"checkSidePanelStatus",callback:function(){t._ctx_search._incontextSidepanelStatus=t._sidePanelClose}}),c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"search-maximiseEditingFavoriteSearch",callback:function(){"search"===t._topFrame._visibleApp&&t._topFrame.openPanel("right",{appId:g.getSearchAppId(),fit:!0}).then((function(){t._topFrame._onRightPanelStateChange("fitted")}))}}),c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"onDeactivateIncontextSearchNoTab",callback:function(){t._topFrame._frame.closePanel("right",{}),t._topFrame._onRightPanelStateChange("closed"),t._forceRelaunchSearch=!0}}),c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"onInitTreeDocumentAbstractViewCB",callback:function(){!0===t._resurrectSearch&&(t._topFrame._visibleXApp="search",t._afterOpenPanelRightCb())}}),c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"onSearchWidgetUpdatePreferences",callback:function(e){e&&e.data&&t._topFrame.updateRightPanelData&&t._topFrame.updateRightPanelData({xAppTag:g.getSearchAppId(),xAppData:e.data})}});var i=g.identifyClientInfo();e.is(i)&&"3DSwym"!==i||r.add("tab:change",(function(e){t._currentTabId=e,t.computeSearchBar(e)})),r.add("dashboard:change",(function(){t._socket.dispatchEvent("clearSearch",{noFocus:!0}),e.is(t._topFrame)&&t._topFrame._frame&&t._topFrame._frame._shownTags&&(g.SEARCH_APP_ID==t._topFrame._frame._shownTags.right||g.SEARCH_APP_ID_PUBLIC==t._topFrame._frame._shownTags.right)&&(t._topFrame._frame.closePanel("right"),t._topFrame._onRightPanelStateChange("closed"))}))}},_isOpenTaggerSidePanelViewOnSearch:function(){return!0!==g.isFUN109031Active()||this.isCtxWdg},_openTagger:function(){e.is(this.options.events.openTagger,"function")&&(this.options.events.openTagger(),g.setTaggerOpenedByCode(!0))},_setSearchFieldCurrentMode:function(t){if(!g.isODTMode())return;let n=e.extendElement(document.body).getElement(".nv-autocomplete-input");e.is(n)&&n.setAttribute("currentmode",t)},setTagPinnedToQuery:function(t){var n=JSON.parse(u.getLocalStorageItem("taggerPinned"))||{};n=n[g.getUserId()]||{};var i="3DDashboard"===g.identifyClientInfo().identifier,s="";(i=(!document.querySelector(".topbar-app-brand")||!document.querySelector(".topbar-app-brand").innerText.match(/enovia/i))&&i)||(s=window.location.hostname);var o=n[s]||{keep:[]},a={};o.keep&&o.keep.forEach((function(e){var t=JSON.parse(e.predicate),n=t.predicate;t.disptext=t.dispValue,delete t.predicate,delete t.dispValue,a[n]=[t]})),!t.refine&&e.is(a,"object")&&Object.keys(a).length>0&&(t.refine={allfilters:a})},computeSearchBar:function(t){var n,i;if(t=t||this._currentTabId||g.getCurrentTabId(),e.is(this._ctx_search)&&e.is(this._ctx_search._socket)){var s=e.Widgets.instances.filter((function(e){return e.context===t&&"maximized"===e.getView().type}));1===s.length?(n=s[0],e.is(this._ctx_search._registered_search_ctx)?(i=this._ctx_search.getInContextOptions(n.id),e.is(i)&&!n.getValue("stayOnSearch")?e.is(i.search_delegation)&&"3ddashboard"===i.search_delegation?this._ctx_search._socket.dispatchEvent("onSetFindInTab",i):(this._ctx_search._socket.dispatchEvent("onSetInAppContext",!0),this._ctx_search._socket.dispatchEvent("onSetFindInApp",i)):n.getValue("stayOnSearch")||(this._ctx_search._socket.dispatchEvent("onSetInAppContext",!1),this._ctx_search._socket.dispatchEvent("onSetFindInTab",n.getValue("searchNLS")||null))):!n.getValue("stayOnSearch")&&e.is(n.getTitle,"function")&&"Unified Search"!==n.getTitle()&&this._ctx_search._socket.dispatchEvent("onSetInAppContext",!1)):(this._ctx_search._socket.dispatchEvent("onSetInAppContext",!1),!0===h.getOption("find_in_this_tab_default")?this._socket.dispatchEvent("onSetFindInTab",null):this._socket.dispatchEvent("onSetBackSearchOrFindInTab",{resetNLS:!0,focus:!1}))}},buildPQAccessMap:function(){var e=this;f.fetchPQsFromServer(e._resourcesMgt).then((function(){var t=f.getPQs();if(e.searchHelper){var n={};n.PQ={PQ:t.PQ,requested_info:["access"]},n.onComplete=function(t){var n=t.PQ.PQ;e.pqAccessMap={},n.forEach((function(t){e.pqAccessMap[t.pqid]=t.viewData.access})),e._PQEvaluationPromisePC.resolve()},e.searchHelper.call(void 0,n)}else if(e.pqAccessEvalcallback){var i={PQ:t.PQ,onComplete:function(t){e.pqAccessMap=t,e._PQEvaluationPromisePC.resolve()}};e.pqAccessEvalcallback.call(void 0,i)}else e.pqAccessMap=null,e._PQEvaluationPromisePC.resolve()}))},_openEmbeddedTagger:function(){!this._isOpenTaggerSidePanelViewOnSearch()&&g.isFUN109031Active()&&e.is(this.options.events.closeTagger,"function")&&this._socket.dispatchEvent("closeTagger")&&g.setTaggerOpenedByCode(!1),setTimeout((function(){c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"showEmbeddedView"})}),500)},_intializeSocket:function(){I.log("_intializeSocket");var t=this;this._active_3dsearch_widget=new s,this._socket=p.createSocket({socket_id:"searchtopbar_socket_id"}),e.is(this.options)&&e.is(this.options.x3dPlatformId,"string")&&this._resourcesMgt.setActiveTenant(this.options.x3dPlatformId),g.getSearchViewPromise().then((function(){I.log("SearchView promise resolved"),t._socket.dispatchEvent("onSetSources",{sources:t._resourcesMgt.toJSON(),searchParams:t.options.searchParams}),e.is(t.getAddinMode(),"string")&&require(["DS/PlatformAPI/PlatformAPI"],(function(e){g.getPowerByInitPromise().then((function(){I.log("publishing search_ready event"),e.publish("webinwin:web:notification",JSON.stringify({event:"search_ready",source:g.getSearchAppId(),version:"1.0",content:{status:!0}}))}))})),g.setSearchReady()})),this._socket.addListener("setSelectedSource",(function(e){I.log("The selected source have been modified ["+e.value+"]");try{t._resourcesMgt.setActiveTenant(e.value)}catch(t){I.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+e.value+")")}})),this._socket.addListener("onSearch",(function(n){if(I.log("Launch command from the result wdg ["+n+"]"),e.is(n.parameters,"object")&&e.is(n.parameters.search_criteria)){if(e.is(n.tabInfo,"object")&&e.is(n.tabInfo.tenant,"string")&&!0===n.transient_widget){try{t._resourcesMgt.setActiveTenant(n.tabInfo.tenant)}catch(e){I.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+n.tabInfo.tenant+")")}t._socket.dispatchEvent("onSelectTenantAfterTabActivation",{tenant:n.tabInfo.tenant})}var i={focus:!1,setTenant:!1};e.is(n.parameters.search_criteria_to_display,"string")&&(i.searchStringToDisplayInSearchField=n.parameters.search_criteria_to_display);var s=!n.in_apps_search&&e.is(n.tabInfo,"object")&&(!0===n.transient_widget||"3DDashboard"!==n.tabInfo.client_identifier);if(n.parameters.search_criteria===g.SearchTypeEnum.MY_CONTENT)s&&(null==i.searchStringToDisplayInSearchField&&(i.searchStringToDisplayInSearchField=D.mycontent),t._socket.dispatchEvent("clickOnChoiceMyContent",i));else if(n.parameters.search_criteria===g.SearchTypeEnum.FAVORITE_SEARCH)s&&t._socket.dispatchEvent("clickOnChoiceFavoriteSearch",i);else if(n.parameters.search_criteria===g.SearchTypeEnum.MY_RECENT_CONTENT);else if(!0===n.parameters.adv_search||n.parameters.search_criteria===g.SearchTypeEnum.ADVANCED_SEARCH)s&&t._socket.dispatchEvent("clickOnChoiceAdvancedSearch",i);else{var o=n.parameters.search_criteria;e.is(n.parameters.originalSearchCriteria,"string")&&(o=n.parameters.originalSearchCriteria),e.is(n.parameters.search_criteria_to_display,"string")&&(o=n.parameters.search_criteria_to_display);var a=o,r=n.parameters.search_criteria,c=t._isWidgetMaximized(n.widget_id,t._currentTabId);n.transient_widget||"3DSwym"===g.identifyClientInfo().identifier||c&&n.in_apps_search||(a=null,r=null);var l=!1;!0===c&&!1===n.transient_widget&&(l=!0),t._socket.dispatchEvent("onRefreshSearchField",{searchStringToDisplayInSearchField:a,internalSearchCriteria:r,isPinnedWidgetMaximized:l}),s&&(i.hiddenOptions=[D.search_current_tab],t._socket.dispatchEvent("clickOnChoiceSearch",i))}}})),this._socket.addListener("onSearchModeSwitch",(function(n){e.is(n,"object")&&e.is(n.new_mode,"string")&&(t._socket.dispatchEvent("onSwitchMode",n),n.new_mode===g.SearchTypeEnum.MY_RECENT_CONTENT&&"*"===n.paramsFilter&&t._socket.dispatchEvent("onRefreshSearchField",""))})),this._socket.addListener("onSearchFromCompass",(function(n){t.init3DSearchWidgetCreatedFromCompass(n);var i=h.getOption("search_compact_mode")||"tablet"===g.getDeviceType();if(!(e.is(window)&&e.is(window.innerWidth)&&!(window.innerWidth>958)||e.is(t.getAddinMode(),"string")&&-1!==["solidworks","catiav5"].indexOf(t.getAddinMode())||!1!==i||!0===h.options.search_settings.taggerClosed)){require(["DS/TopFrame/TopFrame"],(function(n){var i=!1;if(e.is(n))try{e.is(n.isTaggerVisible,"function")&&!0===n.isTaggerVisible()&&(i=!0)}catch(t){e.is(n._isTaggerVisible)&&!0===n._isTaggerVisible&&(i=!0),I.log(t)}var s=u.getLocalStorageItem("3dSearch-sidePanelPositionBack")||M;!1===i&&"normal"!==s&&!0!==g.isFUN109031Active()&&-1===["iphone","android"].indexOf(g.getDeviceCategory())?t._openTagger():g.setTaggerOpenedByCode(!1)}))}"windowed"!==n.mode&&("3DSwym"!==g.identifyClientInfo().identifier&&t._socket.dispatchEvent("onSetFocusInSearchField",{}),setTimeout((function(){e.is(n)&&e.is(n.x3dPlatformId,"string")&&n.x3dPlatformId.length>0&&t._socket.dispatchEvent("onSelectTenant",n.x3dPlatformId)}),200))})),this._socket.addListener("onWdgEndEdit",(function(){t._wdg_ready=!0})),this._socket.addListener("onWdgCreation",(function(n){if(e.is(n.widget_id)){var i=!1;e.is(n.tabid)&&(t._currentTabId=n.tabid,i=!0);var s=t._currentTabId;null===s&&(s=g.getCurrentTabId());var o=t._isWidgetMaximized(n.widget_id,s);!0===i&&e.is(t._topFrame)&&t._topFrame.toggleTagger&&t._topFrame.toggleTagger(!0),I.log("onWdgCreation"),I.log("Widget id ["+n.widget_id+"]"),I.log("Active Tab id ["+s+"]"),I.log("isMaximized ["+o+"]"),t._active_3dsearch_widget.add({widget_id:n.widget_id,active_tab:s,isMaximized:o,isDefault:"true"===n.transient_widget}),"true"===n.transient_widget&&t._socket.dispatchEvent("hideSearchInThisTab")}t._wdg_ready=!0})),this._socket.addListener("onViewChange",(function(n){I.log("onViewChange ["+n.widget_id+"]");var i={active_tab:t._currentTabId,widget_id:n.widget_id},s=t._active_3dsearch_widget.where(i);if(e.is(s)&&1===s.length){I.log("Widget ["+s[0].get("widget_id")+"] in store with maximized option "+s[0].get("isMaximized"));var o=s[0].get("widget_id"),a=t._isWidgetMaximized(o,s[0].get("active_tab"));s[0].set("isMaximized",a),I.log("Maximized option is now set to "+s[0].get("isMaximized"));var r={widgetId:o,maximized:a};t._socket.dispatchEvent("toggleProxyFocus",r)}else I.log("No widget with _this id found in the store")})),this._socket.addListener("onDestroyWidget",(function(e){var n=t._active_3dsearch_widget.where({widget_id:e.widget_id});t._active_3dsearch_widget.remove(n),p.unsubscribeServer(e.widget_id)})),this._socket.addListener("onCloseTransient",(function(e){c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"datagrid_preference_force_close"}),c.publish({channel:"searchView",topic:"deactivateInContextSearch",data:e})})),this._socket.addListener("onSetFocusInSearchField",(function(){t._socket.dispatchEvent("onSetFocusInSearchField",{}),setTimeout((function(){var t=require("DS/TopBar/TopBar");e.is(t)&&e.is(t.view)&&e.is(t.view.focusOnSearch,"function")&&t.view.focusOnSearch()}),100)})),this._socket.addListener("onSearchItemClick",this._manageExternalIdCardDelegation.bind(this)),g.setSearchUXTopbarSocketInitialized()},_manageExternalIdCardDelegation:function(t){var n=this;if(e.is(n.options.searchParams)){var i=!0;if(t.in_apps_search&&(i=!e.is(t.in_apps_search.idcard_activated)||t.in_apps_search.idcard_activated),i){var s=!1;t.in_apps_search?s=!!e.is(t.in_apps_search.external_idcard)&&t.in_apps_search.external_idcard:e.is(n.options.searchParams.external_idcard,"function")?s=n.options.searchParams.external_idcard.call():e.is(n.options.searchParams.external_idcard)&&(s=n.options.searchParams.external_idcard),!0===s&&e.is(n.options.searchParams.idcard,"function")&&n.options.searchParams.idcard.call(void 0,t.model)}}},_addResultUX_customization:function(e){var t=this;Object.keys(e).forEach((function(n){t.result_ux_customization[n]=e[n]}))},getResultUX_customization:function(e){return e?this.result_ux_customization[e]:Object.keys(this.result_ux_customization).length>0?this.result_ux_customization:void 0},_isSearchWidgetAvailable:function(t){var n=this,i={wdg_available:!1,maxIndex:void 0,indexSide:void 0,active_tab:null,wdg_search_items:null};i.active_tab=g.getCurrentTabId(),null===i.active_tab&&(i.active_tab=n._currentTabId);let s=n._active_3dsearch_widget.where({active_tab:i.active_tab}),o=n._active_3dsearch_widget.where({isDefault:!0});if(i.wdg_search_items=function(e){for(var t=e.concat(),n=0;n<t.length;++n)for(var i=n+1;i<t.length;++i)t[n]===t[i]&&t.splice(i--,1);return t}(s.concat(o)),I.log("Check if a widget is available for update"),i.wdg_available=!1,e.is(i.wdg_search_items)&&i.wdg_search_items.length>0){var a=!0;if(e.is(t,"object")&&!0===t.forceWidgetUXRecreation&&(a=!1),a){var r=i.wdg_search_items.length;if(r){I.log("A search widget is already instanciated ==> Check if it is still in the active tab");var c=0;for(c=0;c<r;c++){var l=i.wdg_search_items[c].get("widget_id");e.is(e.Widgets)&&e.is(e.Widgets.instances)&&e.Widgets.instances.length>0&&e.Widgets.instances.filter((function(n){if(n.id===l&&n.context===i.active_tab||n.getValue("search_wdg_id")===l){var s=["maximized","fullscreen"];e.is(t,"object")&&e.is(t.viewType,"string")&&t.viewType.length>0&&(s=[t.viewType]),s.includes(n.getView().type)&&(i.wdg_available=!0,i.maxIndex=c,i.currentWidget=n),"sidepanel"===n.getView().type&&(I.log("Widget available reuse it Side"),i.wdg_available=!0,i.indexSide=c,i.currentWidget=n),e.is(t,"object")&&e.is(t.isRecentContent,"boolean")&&t.isRecentContent&&e.is(t.widgetId)&&n.id===t.widgetId&&(I.log("Type of search is recent content"),i.wdg_available=!0,i.indexSide=c,i.currentWidget=n),s.includes("windowed")&&"fullscreen"===n.getView().type&&(I.log("LIP specific case"),i.wdg_available=!0,i.maxIndex=c,i.currentWidget=n)}}))}}}}else I.log("No widget registered in the active tab");return i},init3DSearchWidgetCreatedFromCompass:function(t){var n=this._isSearchWidgetAvailable({viewType:t.mode}),i={};if(i.active_tab=n.active_tab,!0===n.wdg_available){var s=0;if(void 0===n.maxIndex&&void 0!==n.indexSide){if(s=n.indexSide,e.is(t.mode)&&"windowed"===t.mode){var o=this._isSearchWidgetAvailable({viewType:"maximized"});e.is(o)&&e.is(o.maxIndex)&&void 0!==o.maxIndex&&(s=o.maxIndex)}}else s=n.maxIndex;i.ressources=new d(this.options.ressources);try{i.ressources.setActiveTenant(t.x3dPlatformId)}catch(e){I.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+t.x3dPlatformId+")")}this._socket.dispatchEvent("onSearchFromCompassInit",i,"widget_socket_"+n.wdg_search_items[s].get("widget_id"))}},isIntegratedSearch:function(){return u.getItem("integratedSearch")||!1},loadViewData:function(t,n,i){let s=this;if(e.is(t.viewData)||(t.viewData={}),!e.is(t.viewData.global_actions)){var o=s.getResultUX_customization("global_actions");e.is(o)&&e.is(o.actions)&&e.is(o.app_socket_id)&&(t.viewData.global_actions=o),e.is(n)&&(e.is(i.incontext_global_actions)?t.viewData.global_actions={actions:i.incontext_global_actions,app_socket_id:n.app_socket_id}:n.global_actions&&(t.viewData.global_actions={actions:n.global_actions,app_socket_id:n.app_socket_id}))}t.incontext_global_actions=t.viewData.global_actions},_initializePlatforms:function(){y.getPlatformServices({onComplete:function(t){if(e.is(t,"array")){var n=[],i=0,s=t.length;for(i=0;i<s;i++){var o=t[i],a={};a.id=o.platformId,a.name=o.displayName,a.services=[];var r=Object.getOwnPropertyNames(o);if(e.is(r,"array"))for(var c=0,l=r.length;c<l;c++)o[r[c]]&&0===o[r[c]].indexOf("http")&&a.services.push({id:r[c],url:o[r[c]]});n.push(a)}g.setPlatforms(n)}},onFailure:function(){I.log("oFailure")}})},_loginToSources:function(){I.groupCollapsed("loginToSources");var t="",n=this._resourcesMgt.getAvailableTenants();if(e.is(n,"array")&&1===n.length)t=n[0].tenantId,I.log("Single Tenant: "+t);else if(e.is(n,"array")&&n.length>1){var i=this._resourcesMgt.getActiveTenant();if(I.log("Multiple tenants avaialable, active tenant: "+i),"3DDashboard"===i){var s=u.getItem("defaultTenantId");I.log("Tenant from preferences: "+s),this._resourcesMgt.getTenantInfo(s)?(t=s,I.log("Tenant found in preferences is available")):(I.log("Tenant found in preferences is NOT available"),t=n[0].tenantId)}else t=i}I.log("Tenant for Login is: "+t),I.groupEnd(),C.login({resources:this._resourcesMgt,tenantID:t,onComplete:function(e){var t=[];0===(t=g.getActiveDataSource()).length&&(e.forEach((function(e){t.push(e.name)})),g.setActiveDataSource(t),g.setActiveDataSourcePromise())},onFailure:function(){}}),!0===h.getOption("force_loading_WebUX_js")&&require(["WebUX/WebUX"],(function(e){I.log("WebUX is LOADED")}))},_afterOpenPanelRightCb:function(){let e=this;require(["DS/TagNavigator/TagNavigator"],(function(t){e._sidePanelClose=!1;let n=Object.assign({},e._topFrame.XAPPS,e._topFrame._externalApps),i=e._topFrame._visibleApp,s=(n&&i&&n[i]||{}).widget,o=t.get6WTagger("RightPanelContext");o?(s&&s.id&&o.setAsCurrent().focusOnCC(s.id),!0===e._resurrectSearch&&(s&&s.data&&!0===s.data.adv_search&&(e._socket.dispatchEvent("showAdvancedSearch",{adv_search_field:null,widgetId:s.id,sidePanelStatus:e._sidePanelStatus}),g.setTaggerOpenedByCode(!0)),e._resurrectSearch=!1),g.resolveSidePanelTaggerContextPromise()):e._resurrectSearch=!1}))},_addSearchTypeInformationAndLaunchWidget:function(t,n){var i={};if(e.is(t,"object")&&(i=t),e.is(this.options)&&e.is(this.options.searchParams))if(e.is(this.options.searchParams.source,"array"))i.source=this.options.searchParams.source;else if(e.is(this.options.searchParams.getSources,"function")){var s=this.options.searchParams.getSources();e.is(s,"array")&&(i.source=s)}i.searchType=n,this._prepareLaunchWdg(i)},_prepareLaunchWdg:function(t){this._EasyType=t.adv_search_field,this._updateTenantFromIncontextOptions(t);var n={selected_source:this._resourcesMgt.toJSON(),openTagger:this.options.events.openTagger,setTaggerMode:this.options.events.setTaggerMode,closeTagger:this.options.events.closeTagger};let i=this.getResultUX_customization();if(e.is(i)&&(n.result_ux_customization=i),!0===this._isWidgetReadyToLaunch()||!1===this._isSearchWidgetAvailable().wdg_available){var s=f.isAPrefixedPQSearch(t.value);if(e.is(this.searchHelper)&&e.is(s)&&!e.is(t.inCtx_widget_id)){var o=f.getPQObjFromPQPrefix(s),a={};let e=this;a.PQ={PQ:[o],requested_info:["datagridview_columns","global_actions"]},a.onComplete=function(i){var s=i.PQ.PQ[0];s.viewData&&s.viewData.datagridview_columns&&(t.viewData={SearchColumnCustoDefinition:{viewId:"###"+o.pqName,viewDefinition:[]}},o.viewData.datagridview_columns.forEach((function(e){t.viewData.SearchColumnCustoDefinition.viewDefinition.push({uri:e})}))),s.viewData&&s.viewData.global_actions&&(!t.viewData&&(t.viewData={}),t.viewData.global_actions=s.viewData.global_actions),e._launchWdg(n,t)},this.searchHelper.call(void 0,a)}else this._launchWdg(n,t)}},_launchWdg:function(t,n){var i=this,s=this.isIntegratedSearch();this.setTagPinnedToQuery(n),this.isCtxWdg=void 0!==n.inCtx_widget_id,h.options.search_settings.adv_search_field=null,e.is(n.adv_search_field,"string")&&n.adv_search_field.length>0&&(h.options.search_settings.adv_search_field=n.adv_search_field);var o=!1;n.searchType===g.SearchTypeEnum.MY_RECENT_CONTENT&&(o=!0),g.deleteHelperCollection(g.TRANSIENT_WIDGET_HELPER_ID);var r,c=this._isSearchWidgetAvailable({forceWidgetUXRecreation:n.forceWidgetUXRecreation,isRecentContent:o,widgetId:n.widgetId});if(n.active_tab=c.active_tab,n&&e.is(n.inCtx_widget_id,"string")&&(r=i._ctx_search.getInContextOptions(n.inCtx_widget_id),e.is(r)&&(n.customization_options=r)),u.getItem("integratedSearch")&&!1===s&&!0===c.wdg_available&&(c.wdg_available=!1),!0===c.wdg_available){var l,d="SearchComServer",p=0;p=void 0===c.maxIndex&&void 0!==c.indexSide?c.indexSide:c.maxIndex,!0===s&&void 0!==c.indexSide&&void 0!==c.maxIndex&&i._topFrame&&i._topFrame._frame&&!0===i._topFrame._frame.isPanelOpen("right")&&(i._topFrame._frame.isPanelMaximized("right")||i._topFrame._frame.isPanelFitted("right"))&&(p=c.indexSide),r&&i.loadViewData(n,r,n);let t=c.wdg_search_items[p].get("widget_id");t&&0===t.indexOf("preview")&&!0!==u.getItem("integratedSearch")&&void 0===this.getAddinMode()&&a._isBetaEnabled().then((e=>!0!==e.value&&0===i._stackTransient.length&&a.showWidget(g.getSearchAppId(),"",{},{mode:"transient"}))),l="widget_socket_"+t;var _="SearchComServer_"+t;e.is(i._socket.servers,"array")&&i._socket.servers[_]&&(d=_);var S=!0;if(e.is(i._topFrame)&&void 0===c.maxIndex&&!0===s)if(e.is(n)&&e.is(n.fromEmptyString)&&!0===n.fromEmptyString&&(S=!1,!1===i._sidePanelClose&&(S=!0)),!0===i._sidePanelClose||n.searchType===g.SearchTypeEnum.ADVANCED_SEARCH||i._topFrame._visibleXApp){var y={appId:g.getSearchAppId()};"fitted"===(x=u.getLocalStorageItem("3dSearch-sidePanelPositionBack")||M)&&(y.fit=!0),"normal"===x&&(y.minimized=!0),"maximized"===x&&(y.fit=!0),i._topFrame.openPanel("right",y).then((function(){i._afterOpenPanelRightCb()})),i._topFrame._visibleXApp="search"}else i._topFrame._frame.showPanelContent("right","search");if(n.active_tenant=i._resourcesMgt.getActiveTenant(),!0===n.reSearch&&(S=!0),r&&r.advanced_search&&r.advanced_search.showByDefault&&1!=r.advanced_search.searchOnInit&&(n.adv_search=!0,n.value=g.SearchTypeEnum.ADVANCED_SEARCH),!0===S&&i._socket.dispatchEvent("onSearchWdgUpd",n,l,d),n.searchType===g.SearchTypeEnum.ADVANCED_SEARCH){var v={widgetId:t,maximized:!0};i._socket.dispatchEvent("toggleProxyFocus",v)}var b=h.getOption("search_compact_mode")||"tablet"===g.getDeviceType();!0===h.getOption("debug_mode")||e.is(window)&&e.is(window.innerWidth)&&!(window.innerWidth>958)||e.is(i.getAddinMode(),"string")&&-1!==["solidworks","catiav5"].indexOf(i.getAddinMode())||!1!==b||!0===h.options.search_settings.taggerClosed||!0===h.getOption("no_TopFrame_ODT")||!e.is(i._topFrame)||!e.is(i._topFrame.isTaggerVisible,"function")||!1!==i._topFrame.isTaggerVisible()||!r||"widget_id_#saved_search_edit#"!==r.id||!0!==g.isFUN109031Active()||i._openTagger()}else{if(!0===(!!i._topframe_search_delegation&&i.options.searchParams.isOpen.call()))I.log("A search widget is already instantiated ==> Update its content"),i._socket.dispatchEvent("onSearchWdgUpd",n),i._wdg_ready=!0;else{var w={search_ressources:t.selected_source,transient_context:"true",reSearch:n.refine,settings_topbar:h.serialize(),search_criteria_to_display:n.searchStringToDisplayInSearchField,recent_filter:n.searchStringToDisplayInSearchField};this.searchUxPowerBy&&(w.powerByOptions=this.searchUxPowerBy.getPowerByOptions()),n&&e.is(n.value,"string")&&n.value.length>0?(w.search_criteria=n.value,w.adv_search=n.adv_search,w.adv_search_field=n.adv_search_field):w.focus=!0;var D=!0;if(n){if(e.is(n.searchStringToDisplayInSearchField)&&(w.search_criteria_to_display=n.searchStringToDisplayInSearchField),e.is(n.inputSearchString)&&(w.inputSearchString=n.inputSearchString),e.is(r)){if(w.customization_options=r,w.customization_options&&n.advanced_search&&n.advanced_search.showByDefault&&(w.customization_options.advanced_search||(w.customization_options.advanced_search=n.advanced_search),w.adv_search=!0,!0===n.advanced_search.searchOnInit&&(D=!0),w.customization_options.advanced_search.default_search_criteria=n.advanced_search.default_search_criteria,w.search_criteria=g.SearchTypeEnum.ADVANCED_SEARCH,D=!1),e.is(n.displayValue)?w.search_criteria_to_display=n.displayValue:e.is(w.search_criteria_to_display)||(w.search_criteria_to_display=""),e.is(r.bypass_url)&&("5746ca20-811a-11e4-b116-123b93f75cba"===h.options.search_settings.temp_bypass_fedsearch||"5746cf02-811a-11e4-b116-123b93f75cba"===h.options.search_settings.temp_bypass_fedsearch)){var E=w.search_ressources.available_tenants[w.search_ressources.active_tenant];e.is(E)&&e.is(E.sources)&&e.is(E.sources.search)&&(E.sources.search.url=r.bypass_url,I.log("Temporary bypass of fed_search url by app with UIID "+h.options.search_settings.temp_bypass_fedsearch+": "+E.sources.search.url))}n.recent_search&&(w.customization_options.recent_search=n.recent_search)}e.is(n.content,"string")&&(w.content=n.content),w.viewData=n.viewData,e.is(w.viewData)||(w.viewData={}),i.loadViewData(w,r,n),e.is(n.itemViewClickHandler)?w.itemViewClickHandler=n.itemViewClickHandler:e.is(r)&&e.is(r.itemViewClickHandler)&&r.itemViewClickHandler.trim().length>0&&(w.itemViewClickHandler=r.itemViewClickHandler),e.is(n.source)?w.source=n.source:e.is(r)&&e.is(r.source)&&(e.is(r.source,"array")?w.source=r.source:e.is(r.source,"string")&&(w.source=[r.source])),w.search_mode=e.is(n.search_mode)?n.search_mode:"index"}w.tag_filter=n.tag_filter,e.is(t.result_ux_customization)&&(w.result_ux_customization=t.result_ux_customization);var T=g.getSearchAppId();I.log("Widget App Id: "+T),i._wdg_ready=!1,!0===h.getOption("pcs_analysis")&&I.info("Launch widget at: "+Date.now());if(function(){C.login({resources:i._resourcesMgt,onComplete:function(){},onFailure:function(){I.log("login for helper search FAILED")}});require(["DS/SNResultUX/collections/SearchCollection","DS/SNInfraUX/utils/WildcardMgr","DS/SNResultUX/utils/SNResultTypeCustoHelper"],(function(t,s,o){var a=function(){if(n&&n.advanced_search&&n.advanced_search.showByDefault&&(n.advanced_search.searchOnInit&&(n.value=n.advanced_search.default_search_criteria),n.advanced_search["ds6w:type"])){var a="";n.advanced_search["ds6w:type"].forEach((function(e){var t=e.uri.split(":");a.length>0&&(a+=" OR "),a=a+'flattenedtaxonomies:"types/'+t[t.length-1]+'"'})),a.length>0&&(e.is(n.value,"string")&&n.value.length>0?n.value=n.value+" AND  ("+a+")":n.value=a)}if(n&&e.is(n.value,"string")&&n.value.length>0){var r=n.value;if(r!==g.SearchTypeEnum.ADVANCED_SEARCH&&D){var c=e.is(n.inCtx_widget_id);c||(r=s.manageWildcardAddtion(r)),m.setResources({resources:i._resourcesMgt});var l=new t(null,{event:{onSetup:function(t){t._isAHelper=!0,t.setSearchRessources(i._resourcesMgt);var s={query:r,mode:w.search_mode,with_synthesis:!g.isFetchSynthesisSeparately(),source:e.is(w.source)?w.source:[],refine:n.refine,originalSearchCriteria:n.searchStringToDisplayInSearchField,isTitleOnly:n.isTitleOnly,nlq:"NLQ Search"===n.searchStringToDisplayInSearchField?n.inputSearchString:void 0};if(!e.is(s.source)||s.source.length<1){var a=i.getOption("searchParams");if(e.is(a))if(e.is(a.source,"array"))s.source=a.source;else if(e.is(a.getSources,"function")){var l=i.options.searchParams.getSources();e.is(l,"array")&&(s.source=l)}}if(!c){var d=o.getGlobalSearchTypeCustoQuery(r);e.is(d)&&g.addSourceSpecificParameter(s,{sourceIds:["3dspace"],param:{id:"additional_query",value:d}})}if(e.is(w.customization_options)&&(t._ctx_options=w.customization_options),e.is(t._ctx_options)&&(s.recent_search=t._ctx_options.recent_search,e.is(t._ctx_options.specific_source_parameter))){var u={specific_source_parameter:t._ctx_options.specific_source_parameter};s.context=u}if(t.setRequestCriteria("fed_search",s,c),n.viewData&&n.viewData.SearchColumnCustoDefinition&&n.viewData.SearchColumnCustoDefinition.viewDefinition){var h=[];n.viewData.SearchColumnCustoDefinition.viewDefinition.forEach((function(e){h.push(e.uri)})),t.setAttributesToRetrieve(h)}}},fetchSynthesisSeparately:g.isFetchSynthesisSeparately()});g.setHelperCollection(g.TRANSIENT_WIDGET_HELPER_ID,l),l.getFirstPageOfResults({reset:!0,onComplete:function(){l._currentState=g.HelperCollectionStatus.SEARCH_SUCCEEDED,I.log("helper search succeeded"),e.is(l._CBOnComplete,"function")&&(I.log("launching _CBOnComplete"),l._setTagsPromise&&l._setTagsPromise.resolve(),l._CBOnComplete.apply(l,arguments))},onFailure:function(t,n){l._currentState=g.HelperCollectionStatus.SEARCH_FAILED,I.log("helper search failed"),e.is(l._CBOnFailure,"function")?(I.log("launching _CBOnFailure"),l._CBOnFailure.apply(l,arguments)):l.fedSearch_error=n}}),I.log("helper search launched"),l._currentState=g.HelperCollectionStatus.SEARCH_IN_PROGRESS}}};n&&!e.is(n.inCtx_widget_id)&&e.is(n.value,"string")&&n.value.indexOf(":")>0?f.fetchPQsFromServer(i._resourcesMgt).then((()=>{a.call()})):a.call()}))}.call(),i._topframe_search_delegation){i.options.searchParams.open.call(void 0,{app_id:T,widget_title:"",preferences_wdg:w});b=h.getOption("search_compact_mode")||"tablet"===g.getDeviceType();!0===h.getOption("debug_mode")||e.is(window)&&e.is(window.innerWidth)&&!(window.innerWidth>958)||e.is(i.getAddinMode(),"string")&&-1!==["solidworks","catiav5"].indexOf(i.getAddinMode())||!1!==b||!0===h.options.search_settings.taggerClosed||!0===h.getOption("no_TopFrame_ODT")||!e.is(i._topFrame)||!e.is(i._topFrame.isTaggerVisible,"function")||!1!==i._topFrame.isTaggerVisible()||!0===g.isFUN109031Active()?g.setTaggerOpenedByCode(!1):i._openTagger()}else{let t=g.identifyClientInfo();if(e.is(i._topFrame)&&(!0===s||"3DSwym"===t.identifier&&!1===t.deprecated)){var x,N={appId:T,data:w,sidePanel:!0};"fitted"===(x=u.getLocalStorageItem("3dSearch-sidePanelPositionBack")||M)&&(N.fit=!0),"normal"===x&&(N.minimized=!0),"maximized"===x&&(N.fit=!0),i._topFrame._visibleXApp="search",i._topFrame.openPanel("right",N).then((function(){i._afterOpenPanelRightCb()})),i._firstInit=!0}else{w.x3dPlatformId=w.search_ressources.active_tenant,a.showWidget(T,"",w,{mode:"transient"});b=h.getOption("search_compact_mode")||"tablet"===g.getDeviceType();!0===h.getOption("debug_mode")||e.is(window)&&e.is(window.innerWidth)&&!(window.innerWidth>958)||e.is(i.getAddinMode(),"string")&&-1!==["solidworks","catiav5"].indexOf(i.getAddinMode())||!1!==b||!0===h.options.search_settings.taggerClosed||!0===h.getOption("no_TopFrame_ODT")||!e.is(i._topFrame)||!e.is(i._topFrame.isTaggerVisible,"function")||!1!==i._topFrame.isTaggerVisible()||!0===g.isFUN109031Active()?g.setTaggerOpenedByCode(!1):i._openTagger()}}}}},_isWidgetReadyToLaunch:function(){return this._wdg_ready},_updateTenantFromIncontextOptions:function(t){if(e.is(t))if(e.is(t.tenant))try{this._resourcesMgt.setActiveTenant(t.tenant)}catch(e){I.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+t.tenant+")")}else if(e.is(t.inCtx_widget_id,"string")){var n=this._ctx_search.getInContextOptions(t.inCtx_widget_id);if(e.is(n)&&e.is(n.tenant))try{this._resourcesMgt.setActiveTenant(n.tenant)}catch(e){I.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+n.tenant+")")}else{var i=this._resourcesMgt.getAvailableTenants();1===i.length&&this._resourcesMgt.setActiveTenant(i[0].tenantId)}}},getAddinMode:function(){var t,n=this.getOption("addinMode");return e.is(n,"object")&&(t=n.value),t},_isWidgetMaximized:function(t,n){var i;if(e.Widgets){var s=u.getItem("integratedSearch");i=e.Widgets.instances.filter((function(i){return!1===s?!(!e.is(i,"object")||"maximized"!==i.getView().type||(i.id!==t||i.context!==n)&&i.getValue("search_wdg_id")!==t):!(!e.is(i,"object")||"maximized"!==i.getView().type||(i.id!==t||i.context!==n)&&i.getValue("search_wdg_id")!==t)&&(e.is(i.getValue("appId")===g.getSearchAppId())&&(i.context=n),!0)}))}return i&&i.length>0}});return N})),define("DS/SNSearchUX/dropdown/SearchDropDownUtils",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","UWA/Element","UWA/Promise","DS/PubSub/PubSub","DS/i3DXCompassServices/i3DXCompassPubSub","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/UIKIT/Modal","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/WebappsUtils/WebappsUtils","DS/Controls/Toggle","DS/Controls/Expander","DS/Controls/Button","DS/Controls/ComboBox","DS/Controls/Label","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/ServiceDelegationLoader","DS/SNInfraUX/utils/SNCompassUtils","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/keywords/SNKeywordManager","DS/SNInfraUX/Api/SearchApi","DS/SNResultUX/utils/SearchTagsTransformation","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/ExternalComponentHelpers","DS/SNResultUX/collections/SearchCollection","DS/SNResultUX/layouts/SNSkeletonMgt_v2","DS/SNSearchUX/SuggestionUXHelper","DS/SNSearchUX/helpers/GuidedTrackerUtils","DS/SNSearchUX/dropdown/myContentView","DS/SNSearchUX/dropdown/categoryContentView","DS/SNSearchUX/dropdown/resultsContentView","DS/SNSearchUX/dropdown/guidedContentView","text!DS/SNSearchUX/assets/templates/SearchDropDown/headerSections.html","text!DS/SNSearchUX/assets/templates/SearchDropDown/SearchDropDown.html","text!DS/SNSearchUX/assets/templates/SearchDropDown/SearchDropDownNoHistory.html","text!DS/SNSearchUX/assets/templates/GuidedMode/GuidedMode.html","text!DS/SNSearchUX/assets/templates/GuidedMode/GuidedModeExample.html","text!DS/SNSearchUX/assets/templates/GuidedMode/GuidedModeBeta.html","text!DS/SNSearchUX/assets/templates/GuidedMode/GuidedModeBetaNotif.html","text!DS/SNSearchUX/assets/templates/GuidedMode/GuidedModeHelp.html","text!DS/SNSearchUX/assets/templates/GuidedMode/NLQBrickCont.html","text!DS/SNSearchUX/assets/templates/GuidedMode/GuidedMode.json","text!DS/SNSearchUX/assets/NLQModels.json","text!DS/SNSearchUX/assets/SmartQueryNLQ.json","i18n!DS/SNSearchUX/assets/nls/SearchDropDown.json","i18n!DS/SNSearchUX/assets/nls/GuidedMode.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json","DS/vue-3.4.15/vue","DS/WUXAutoComplete/AutoComplete","DS/Controls/Editor","DS/SNSmartQuery/utils/EngineTrackerApi","DS/MessageBus/MessageBus"],(function(e,t,n,i,s,o,a,r,c,l,d,u,h,p,g,_,m,S,f,C,y,v,b,w,D,I,E,T,x,M,N,k,A,O,P,L,U,V,Q,F,B,R,H,j,q,X,W,G,z,K,J,Y,$,Z,ee,te,ne,ie,se,oe,ae,re,ce){"use strict";var le=t.singleton(i,n,{name:"DS_SearchDropDownUtils",_myContentView:null,_categoryContentView:[],_guidedContentView:null,_resultsContentView:null,_taggerProxy:null,_resutlsContentcollection:null,_searchtabbuttonscontainer:null,_nlsPromises:{},_modal:null,_modalVisibility:!1,_modalBody:null,_SmartQueryController:null,_guidedModeDiv:null,_SearchDropDownSettings:null,_SearchDropDownPQs:null,_settingsDisplay:!1,_helpsDisplay:!1,_dropdown:null,_isIncontextBuilderMode:!1,_toggleactivation:!1,_toggle:null,_togglecontainer:null,_togglecontainerDropdown:null,_skeleton:null,_guidedModeBetaClose:null,init:function(){this._init()},_init:function(){this._myContentView=null,this._categoryContentView=[],this._guidedContentView=null,this._resultsContentView=null,this._taggerProxy=null,this._resutlsContentcollection=null,this._searchtabbuttonscontainer=null,this._nlsPromises={},this._modal=null,this._modalBody=null,this._SmartQueryController=null,this._guidedModeDiv=null,this._SearchDropDownSettings=null,this._SearchDropDownPQs=null,this._settingsDisplay=!1,this._helpsDisplay=!1,this._dropdown=null,this._isIncontextBuilderMode=!1,this._toggle=null,this._togglecontainer=null,this._togglecontainerDropdown=null,this._modalVisibility=!1,this._toggleactivation=!1,this._skeleton=null,this._guidedModeBetaClose=E.getItem("guidedModeBetaClose"),this._currentSearchMode=void 0},clean:function(){document.body.removeEventListener("click",this._onClickbody.bind(this)),this._modalBody&&this._modalBody.removeEventListener("keyup",this._onkeyupbody.bind(this)),this._myContentView&&e.is(this._myContentView.destroy,"function")&&this._myContentView.destroy(),this._categoryContentView=[],this._guidedContentView&&e.is(this._guidedContentView.destroy,"function")&&this._guidedContentView.destroy(),this._resultsContentView&&e.is(this._resultsContentView.destroy,"function")&&this._resultsContentView.destroy(),this._resutlsContentcollection&&e.is(this._resutlsContentcollection.destroy,"function")&&this._resutlsContentcollection.destroy(),this._modal&&e.is(this._modal.destroy,"function")&&this._modal.destroy(),this._SmartQueryController&&e.is(this._SmartQueryController.destroy,"function")&&this._SmartQueryController.destroy(),this._SearchDropDownSettings&&e.is(this._SearchDropDownSettings.destroy,"function")&&this._SearchDropDownSettings.destroy(),this._SearchDropDownPQs&&e.is(this._SearchDropDownPQs.destroy,"function")&&this._SearchDropDownPQs.destroy(),this._toggle&&e.is(this._toggle.destroy,"function")&&this._toggle.destroy(),this._init()},cleanController:function(){this._SmartQueryController&&this._SmartQueryController.clean()},getSNSkeleton:function(){return this._initSkeletonMgt()},getGuidedmodeStatus:function(){return this._toggleactivation},getModalBody:function(){return this._modalBody},getMyContentView:function(){return this._myContentView&&this._myContentView.multiViewContainer},getCategoryContentView:function(e){return this._categoryContentView[e]&&this._categoryContentView[e].multiViewContainer},getGuidedContentView:function(){return this._guidedContentView&&this._guidedContentView.multiViewContainer},getResultsContentView:function(){return this._resultsContentView&&this._resultsContentView.multiViewContainer},setController:function(e){this._SmartQueryController=e},setAltKeyStatus:function(e){this._altKey=e},getController:function(e){return this._SmartQueryController},_activationGuidedMode:function(e){const{dropdown:t}=e;E.setItem("smartMode",this._toggleactivation),E.commit(),!0===t.webInwin&&t.eventManager.dispatchEvent("onGuidedMode",!0)},buildFullDropDown:function(e){let t=this;this._toggleactivation=!0,v.log("SearchDropDownUtils::buildFullDropDown options: ",e),this._currentSearchMode=E.getItem("searchMode")||"standardSearch",t._resources=e.srcRessource,t._promiseVocabNLS("ds6w",{resources:t._resources}),t.isNLQMode=e.dropdown._nlqMode,t.isNLQMode&&"nlqSearch"===this.currentSearchMode?t.userHasAccesstoNLQ().then((function(){t._buildModalContent(e)})):t._buildModalContent(e)},userHasAccesstoNLQ:function(){let e=this;return new Promise((t=>{e.isNLQMode&&(T.getOption("NLQMode")&&!e.NLQCheck?(e.NLQCheck=!0,t()):e.NLQCheck||Promise.all([M.getLoggedInUserFromCompassPromise(),N.getUserGroupMemberDetails({userGroupName:"3DSEARCH_NATURAL_LANGUAGE_AI",tenant:b.getActiveTenant()})]).then((([n,i])=>{let s=!1,o=n.firstname.toLowerCase()+"."+n.lastname.toLowerCase()+"@3ds.com";e.loggedInUser=n.firstname+"_"+n.lastname,i=i&&i.length>0?i[0].members:[];for(let e=0;e<i.length;e++)if(i[e]===o){s=!0;break}e.NLQCheck=!0,s||(e.isNLQMode=!1),t()})).catch((()=>{e.isNLQMode=!1,t()})))}))},_buildModalContent:function(t){let n=this;v.log("SearchDropDownUtils::buildFullDropDown options: ",t);const{dropdown:i,incontextOptions:o,placeHolderValue:a}=t;let r=E.getItem("searchMode")?E.getItem("searchMode"):"standardSearch";if((!i.isSmartMode()||i.isSmartMode()&&!i.isGuidedMode()&&r.contains("guidedSearch")||!n.isNLQMode&&"nlqSearch"===r)&&(n._currentSearchMode=r="standardSearch",E.setItem("searchMode",n._currentSearchMode),E.commit()),i.elements.searchDropdownHeader.getChildren().length||n._createSwitcherBody(t.dropdown),n._isIncontextBuilderMode?(i.elements.dropdownContainer.addClassName("new-search-mode"),i.elements.dropdownContainer.addClassName("enable-guided-mode"),n._currentSearchMode=r="guidedSearchExpert"):(n._currentSearchMode=r,"standardSearch"===r&&"standardSearch"===r&&"PartSupply"!=a&&"OnePart Search"!=a&&"Relations"!=a&&i.loadStdSearch()),T.getOption("search_web_in_win")&&window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("SearchModeInDropDown",n._currentSearchMode),n._SmartQueryController&&n._SmartQueryController.setCurrentSearchMode(n._currentSearchMode),n._dropdown=i,this._modalBody=n._dropdown.elements.searchTabContainer,s.create("div",{class:""}),r&&("nlqSearch"!=r||n.isNLQMode)||(r="standardSearch",E.setItem("searchMode",r),E.commit()),"standardSearch"!==r&&(i.noBlur=!0,i.elements.input.blur(),r.contains("guidedSearch")?i.elements.searchTabContainer.addClassName("guided-mode"):i.elements.searchTabContainer.addClassName("nlq-mode"),n.showguidedContainer()),n.isNLQMode){let e=te.get("smart.mode.nlq.searchingFor");J=J.replace("###searchingFor###",e)}i.elements.searchDropdownInput.getChildren().length?n._SmartQueryController.setInContextBuilderMode(o):n.initializeSmartQuery(t)},initializeSmartQuery:function(t){let n=this;const{dropdown:i,incontextOptions:s}=t;require(["DS/SNSearchUX/helpers/SmartQueryController"],(function(t){let o=e.extendElement(i.elements.searchDropdowInput),a=e.extendElement(i.elements.customSuggestions),r=e.extendElement(i.elements.resultsContainer),c=e.extendElement(i.elements.instantSearchEmptyView),l=e.extendElement(i.elements.instantSearchContainer),d=e.extendElement(i.elements.instantSearchTabContainer),u=e.extendElement(i.elements.searchTabContainer);!0===n._toggleactivation&&n._togglecontainer&&n._activationcontent&&n._activationcontent.inject(n._togglecontainer),n._SmartQueryController=new t({dropdown:i,incontextOptions:s,containerinput:o,containersuggestion:a,containerresult:r,instantSearchTab:d,instantSearch:l,instantSearchEmptyView:c,dropdownFull:!0,nlqContainer:u,_currentSearchMode:n._currentSearchMode}),n.createInputEditor(i,s),n.isNLQMode&&T.getOption("NLQModel")&&(n.dataModelBox||(n.dataModelBox=new S({elementsList:JSON.parse($).models,selectedIndex:0,touchMode:!0,domId:"data-model-chooser"}),n.dataModelBox.inject(n._dataModelContainer),n.dataModelBox.addEventListener("change",function(){n._SmartQueryController._updateDataModelValue(n.dataModelBox.value)}.bind(n))),"nlqSearch"==_currentSearchMode&&n._SmartQueryController._updateDataModelValue(n.dataModelBox.value)),setTimeout((function(){n._SmartQueryController.setInContextBuilderMode(s),n.switcherBody._container.getElement(".guided-lite-mode-cont").removeClassName("disable"),n._modalBody.addEventListener("click",(function(){i.elements.contentContainer.focus()})),n._modalBody.addEventListener("keyup",n._onkeyupbody.bind(n)),document.body.addEventListener("click",n._onClickbody.bind(n))}),150)}))},buildMyContent:function(t){let n=this;v.log("SearchDropDownUtils::buildMyContent options: ",t);const{container:i,count:s,srcRessource:o,dropdown:a,eventManager:r,webInwin:c,noresult:l,onComplete:d}=t;let u;if(n._dropdown=a,e.is(n._myContentView))return n._myContentView.collection&&n._myContentView.collection.dispatchEvent("OnGroupingChange",{noresult:l,onComplete:d}),void v.log("SearchDropDownUtils::buildMyContent OnGroupingChange");n._promiseVocabNLS("ds6w",{resources:o});let h=new P;h.setSearchRessources(o),h._fromDropDown=!0,h._isCategoryHelperCollection=!0,u=new Q({collection:h,id:"myContentDropdown"}),u.collection.nresults=s,u.collection._fromDropDown=!0,u.container=i,u.render(),u.getCurrentViewId=function(){return u.getViewId()},u._clickOnHeader=function(t){e.is(a)&&(n.modalVisibility(!1),a.setPlaceHolderValue(ee.get("search.myContent.title")),a._changeIcon("user"),r&&r.dispatchEvent("myContent",{adv_search:!1,value:b.SearchTypeEnum.MY_CONTENT,search_myContent:b.SearchTypeEnum.MY_CONTENT}))},u.mask=function(){n._mask(i)},u.unmask=function(){n._unmask(i)},u.onItemTitleClick=function(e,t){let i={dropdown:a,eventManager:r,webInwin:c};n._onItemTitleClick(e,t,i)},h&&h.dispatchEvent("OnGroupingChange",{noresult:l,onComplete:d}),n._myContentView=u},buildInstantSearchNoResultMessage:function(e){let t,n=te.get("instantnoresultbegin.text"),i=T.getOption("result_categories",{tenant:e});if(!i||!i.suggestion.list.length)return n="",n;t=i&&i.suggestion.list||[],t=t.filter((function(e){return!1!==e.active&&(void 0===e.active&&e.category,!0)}));for(let e=0;e<t.length;e++)n+=0==e?"(":"",n+=`${t[e].name}`,n+=e===t.length-1?")":", ";return n},_loadNlqExamples:function(){let e=this._SmartQueryController&&this._SmartQueryController.getSelectionChipLineEditorValue()||"";e=e.trim();let t=E.getItem("NLQUserQuery")||[],n=[{text:"Search History",isTitle:!0,icon:"clock",action:"delete"}];for(let i=0;i<t.length&&!(n.length>=10);i++){let s=t[i].queryString;this.buildNLQExampleBySearching(e,s,n)}n.length<=1?(this._dropdown.addSuggestList(n,this._dropdown.elements.suggestions),this._createEmptyView(this._dropdown.elements.suggestions),this._dropdown.elements.suggestions.querySelector(".search-dropdown-clear-history-icon.fonticon.fonticon-trash").addClassName("disable-button")):(this._dropdown.elements.suggestions.removeClassName("empty-view-center"),this._dropdown.addSuggestList(n,this._dropdown.elements.suggestions),this._dropdown.elements.suggestions.querySelector(".search-dropdown-clear-history-icon.fonticon.fonticon-trash").removeClassName("disable-button"))},buildNLQExampleBySearching:function(e,t,n){let i=e?e.split(" "):[],s=t.toLowerCase();if(e.length){let e=!1;for(let t=0;t<i.length;t++){let n=i[t].toLowerCase(),o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");e=!(!new RegExp("\\b"+o+"\\b","gi").test(s)&&!s.includes(n))}e&&n.push({text:t,action:"clear"})}else n.push({text:t,action:"clear"})},buildcategoryContent:function(t){let n=this;v.log("SearchDropDownUtils::buildcategoryContent options: ",t);const{id:i,container:s,dropdown:o,srcRessource:a,eventManager:r,webInwin:c,query:l,count:d,noresult:u}=t;let h={query:l,noresult:u};if(e.is(n._categoryContentView,"array")){let t=n._categoryContentView[i]&&n._categoryContentView[i].collection;if(e.is(t))return void(t&&t.dispatchEvent("OnGroupingChange",h))}let p=new P;p.setSearchRessources(a),p._fromDropDown=!0;let g=new F({collection:p,id:i});n._categoryContentView[i]=g,g.container=s,g._nresults=d||2,g.render(),g.getCurrentViewId=function(){return g.getViewId()},g._clickOnHeader=function(t){if(!e.is(t)&&!e.is(t.id))return;let i={category_id:t.id,usertext:t.query,dropdown:o,eventManager:r,webInwin:c};n.onClickSection(i)},g.mask=function(){n._mask(s)},g.unmask=function(){n._unmask(s)},g.onItemTitleClick=function(e,t){let i={dropdown:o,eventManager:r,webInwin:c};n._onItemTitleClick(e,t,i)},g.collection&&g.collection.dispatchEvent("OnGroupingChange",h)},buildguidedContent:function(t,n){let i=this;v.log("SearchDropDownUtils::buildMyContent options: ",t);const{container:s,srcRessource:o,dropdown:a,eventManager:r,webInwin:c,query:l,nlq:d,count:u,noresult:h,onclickViewAll:p}=t;if(e.is(i._guidedContentView))return void(d&&!l?t.noresult():(i._guidedContentView.collection&&i._guidedContentView.collection.dispatchEvent("OnGroupingChange",{query:l,nlq:d,noresult:h,onclickViewAll:p,utils:i}),v.log("SearchDropDownUtils::buildMyContent OnGroupingChange")));i._promiseVocabNLS("ds6w",{resources:o});let g=new P;g.setSearchRessources(o),g._fromDropDown=!0,i._guidedContentView=new R({collection:g,id:"guidedDropdown"}),i._guidedContentView.collection.nresults=u||5,i._guidedContentView.container=s,i._guidedContentView.nlqBrickContainer=i.nlqBrickContainer,i._guidedContentView.render(),i._guidedContentView.getCurrentViewId=function(){return i._guidedContentView.getViewId()},i._guidedContentView._clickOnHeader=function(t){(e.is(t)||e.is(t.id))&&(i._SmartQueryController&&i._SmartQueryController._isIncontextBuilderMode||i._SmartQueryController&&i._SmartQueryController._applySearch())},i._guidedContentView.mask=function(){i._mask(s)},i._guidedContentView.unmask=function(){i._unmask(s)},i._guidedContentView.onItemTitleClick=function(e,t){let n={dropdown:a,eventManager:r,webInwin:c};i._onItemTitleClick(e,t,n)},d&&!l?t.noresult():g&&g.dispatchEvent("OnGroupingChange",{query:l,nlq:d,noresult:h,onclickViewAll:p,utils:i})},buildresutlsContent:function(t){let n=this;v.log("SearchDropDownUtils::buildresutlsContent options: ",t);const{container:i,dropdown:s,srcRessource:o,eventManager:a,webInwin:r,query:c,noresult:l}=t;if(e.is(n._resultsContentView))return void n._resultsContentView.fetch({query:c,count:2,noresult:l});n._resutlsContentcollection=new P,n._resutlsContentcollection.setSearchRessources(o),n._resutlsContentcollection.setTagsTransformer(new k({isTransientWidget:!0})),n._resutlsContentcollection._fromDropDown=!0;require(["DS/TagNavigatorProxy/TagNavigatorProxy"],(function(e){n._resutlsContentcollection.setTaggerProxy(n._createTaggerProxy(e,o))})),n._resultsContentView=new B({collection:n._resutlsContentcollection,id:"resutlsDropdown"}),n._resultsContentView.container=i,n._resultsContentView._nresults=2,n._resultsContentView.render(),n._resultsContentView.getCurrentViewId=function(){return n._resultsContentView.getViewId()},n._resultsContentView._clickOnHeader=function(t){if(!e.is(t)&&!e.is(t.id))return;let i={category_id:t.id,usertext:t.query,dropdown:s,eventManager:a,webInwin:r};n.onClickSection(i)},n._resultsContentView.mask=function(){n._mask(i)},n._resultsContentView.unmask=function(){n._unmask(i)},n._resultsContentView.onItemTitleClick=function(e,t){let i={dropdown:s,eventManager:a,webInwin:r};n._onItemTitleClick(e,t,i)},n._resultsContentView.fetch({query:c,count:2,noresult:l})},buildheaderSection:function(e){let t=this;v.log("SearchDropDownUtils::buildheaderSection options: ",e);const{container:n,dropdown:i,eventManager:s,webInwin:o,myContent:a,favoriteSearch:r,SimilarSearch:c,PartSupply:l,Relations:d}=e;let u=b.escapeHtml(ee.get("search.myContent.title")),h=b.escapeHtml(ee.get("search.favoriteSearch")),p=b.escapeHtml(ee.get("search.advancedSearch")),g=b.escapeHtml(ee.get("search.DDM_SomeCommands_SimilarSearch_Header")),_=b.escapeHtml(ee.get("search.PartSupplyHeader")),m=b.escapeHtml(ee.get("search.DDM_SomeCommands_RelNavWbWn_Header")),S=b.escapeHtml(ee.get("smart.mode.examples.title")),f=b.escapeHtml(ee.get("search.noResults")),C=b.escapeHtml(ee.get("search.myContent.noResults"));H=(H=(H=(H=(H=(H=(H=(H=(H=(H=H.replace("###myContent###",u)).replace("###myFavorite###",h)).replace("###advSearch###",p)).replace("###DDM_SomeCommands_SimilarSearch_Header###",g)).replace("###PartSupplyHeader###",_)).replace("###DDM_SomeCommands_RelNavWbWn_Header###",m)).replace("###DDM_SomeCommands_RelNavWbWn_Header###",m)).replace("###examples###",S)).replace("###noResults###",f)).replace("###noResultsSubText###",C),t._searchtabbuttonscontainer=n,t._searchtabbuttonscontainer.innerHTML=H;let y={container:t._searchtabbuttonscontainer,dropdown:i,eventManager:s,webInwin:o,myContent:a,favoriteSearch:r,SimilarSearch:c,PartSupply:l,Relations:d,strmycontent:u,strmyfav:h,stradvSearch:p,strSimilarSearch:g,strPartSupply:_,strRelations:m};t._buildheaderSection(y)},buildguidedModeDiv:function(t){let n=this;if(!e.is(t))return;let i=e.extendElement(t.fullContainer.querySelector(".guidedmode-examples")),s=E.getItem("searchMode")||"";return"guidedSearchIntermediate"!=s||T.getOption("IntermediateMode")||(s="fullSearch"),(s.contains("guidedSearch")||"nlqSearch"==s)&&i&&i.show(),n._guidedModeDiv=i,n._buildexamplesList(),n._guidedModeDiv},hideAllContainer:function(){let t=this,n=e.extendElement(t._modalBody.querySelector(".instant-search-warning-message"));n&&n.hide();let i=e.extendElement(t._modalBody.querySelector(".instant-search-container"));i&&i.removeClassName("limitReached");let s=e.extendElement(t._modalBody.querySelector(".instant-search-empty-view"));s&&s.hide();let o=e.extendElement(t._modalBody.querySelector(".searchResults-container"));o&&o.hide();let a=e.extendElement(t._modalBody.querySelector(".instant-search-apps"));a&&a.hide()},showguidedContainer:function(t){let n=this,i=this._dropdown;e.is(n._modalBody)&&(!n._SmartQueryController||n._SmartQueryController&&!n._SmartQueryController.getSmartQueryLength()?(n._isIncontextBuilderMode?i.switchActiveTab(null,null,!0):i.switchActiveTab(n._dropdown.elements.instantSearchTabContainer,n._dropdown.elements.searchTab,!0),i.elements.guidedSamples.removeClassName("hide"),n._SmartQueryController&&(n._SmartQueryController._apply&&(n._SmartQueryController._apply.disabled=!0),n._SmartQueryController._previewButton&&!n._SmartQueryController._SelectionChipsEditor._lineEditor.value&&(n._SmartQueryController._previewButton.disabled=!0),n._SmartQueryController._clearbutton&&!n._SmartQueryController._SelectionChipsEditor._lineEditor.value&&(n._SmartQueryController._clearbutton.disabled=!0)),this._currentSearchMode.contains("guidedSearch")?(i.elements.searchTabContainer.addClassName("guided-mode"),i.elements.searchTabContainer.removeClassName("nlq-mode"),i.elements.searchHelpTooltip.title=b.escapeHtml(ie.get("GuidedPredefinedQuery")),i.elements.searchHelpTooltip.longHelp=b.escapeHtml(ie.get("GuidedPredefinedQuery.shortHelp")),n._SmartQueryController&&n._SmartQueryController._apply&&n._SmartQueryController._apply.show(),n._SmartQueryController&&n._SmartQueryController._apply&&n._SmartQueryController._previewButton.hide(),n._focusOnLineEditor(),n._SmartQueryController&&n._SmartQueryController.setSmartQuery(this._currentSearchMode)):"nlqSearch"===n._currentSearchMode&&(i.elements.searchTabContainer.addClassName("nlq-mode"),i.elements.searchTabContainer.removeClassName("guided-mode"),i.elements.searchTabContainer.removeClassName("show-results"),i.elements.searchHelpTooltip.title=b.escapeHtml(ie.get("NLQPredefinedQuery")),i.elements.searchHelpTooltip.longHelp=b.escapeHtml(ie.get("NLQPredefinedQuery.shortHelp")),this._loadNlqExamples(),n._SmartQueryController&&n._SmartQueryController._apply&&n._SmartQueryController._apply.hide(),n._SmartQueryController&&n._SmartQueryController._apply&&n._SmartQueryController._previewButton.show(),this.infoTooltip&&(this.infoTooltip.shortHelp=b.escapeHtml(te.get("smart.mode.nlq.info")))),n._SmartQueryController&&n._SmartQueryController.setPlaceHolder(),!1!==t&&i.disableTopBarField(),this._buildexamplesList()):n._SmartQueryController&&n._SmartQueryController.getSmartQueryLength()&&(!1!==t&&i.disableTopBarField(),n._focusOnLineEditor()))},showSettingsHelpsContainer:function(t){let n=this;if(e.is(n._modalBody)){let i=e.extendElement(n._modalBody.querySelector(".search-setting-pq"));i&&(t?i.removeClassName("hide-settings"):i.addClassName("hide-settings"))}},onClickObject:function(t){v.log("SearchDropDownUtils::onClickObject: ",t);const{model:n,text:i,webInwin:s,eventManager:o}=t;let l=n.getSourceID(),d=n.getServiceID(),u=n.getPlatformID(),h=n.get("resourceid"),p=A.buildCompassSelectionData({widgetId:"",selectedModels:[n]});r.publish("setX3DContent",p),"3dspace"===l?e.is(i)&&(a.dispatch("onViewSearch",[{displayString:i,query:'[ds6w:label]:"'+i+'"'}]),s&&!0===s&&o&&o.dispatchEvent("onViewSearch",{displayString:i,query:'[ds6w:label]:"'+i+'"'})):c.getServiceUrl({serviceName:d,platformId:u,onComplete:function(t){w.load({serviceID:d,platformID:u,serviceURL:t}).then((function(i){if(e.is(i.getDoubleClickAction,"function")){let s={model:n,serviceURL:t,appID:b.getSearchAppId(),client_feature:"search_topbar_suggest",onComplete:function(t){e.is(t)&&e.is(t.id,"string")&&e.is(t.sourceJS,"string")&&t.sourceJS.length>0&&require([t.sourceJS],(function(e){e.executeAction({action_id:t.id,actionsHelper:{getModel:function(){return n},getPlatformID:function(){return u},getClientInfo:function(){return b.identifyClientInfo("")},getValue:function(e){let t=e.predicate?e.predicate:e.attribute;return n.get(t+"_value")}},object_ids:[h]})}))},onFailure:function(e){v.log("SearchDropDownUtils::onClickObject onFailure: ",e)}};i.getDoubleClickAction.call(void 0,s)}}))}})},onClickSection:function(t){const{category_id:n,usertext:i,dropdown:s,eventManager:o,webInwin:r}=t;let c=this;U.getSuggestHelper().then((function(){let t=U.buildSearchParams({category_id:n,search_text:i});t.objectToPreview="instantSearch",a.dispatch("onViewSearch",[e.extend({displayString:i},t)]),e.is(r)&&!0===r&&o&&o.dispatchEvent("onViewSearch",e.extend({displayString:i},t)),c.modalVisibility(!1)}))},onClickApp:function(t){const{appTitle:n,appId:i,webInwin:s,eventManager:o}=t;this._modalVisibility&&V.instantAppTracker(i,n),e.is(i)&&(s&&!0===s?o&&o.dispatchEvent("onClickApp",{appId:i}):D.launchApplicationFormCompass(i).then((function(e){A._displayAlert({message:e,className:"success"})}),(function(e){A._displayAlert({message:e,className:"error"})})))},getHistoryListFromLocalStorage:function(){return e.is(localStorage.SNSearchBoxStore)?JSON.parse(localStorage.SNSearchBoxStore).reverse():[]},removeHistoryFromLocalStorage:function(e,t){let n=this.getHistoryListFromLocalStorage();n.reverse();let i=n.filter((function(t){return t!==e}));n.length!==i.length&&(localStorage.SNSearchBoxStore=JSON.stringify(i))},clearHistoryFromLocalStorage:function(){localStorage.SNSearchBoxStore=JSON.stringify([]),this._SmartQueryController&&(this._SmartQueryController._historyList=[])&&this._SmartQueryController.hideHistory()},removeHistoryElement:function(t,n){let i=this,s=t.getParent();if(e.is(s)){let e=s.getText(),t=s.getParent();s.remove(),"fullSearch"==n&&t&&t.getChildren()&&0==t.getChildren().length&&this._SmartQueryController.destroySugDropdown(),i.removeHistoryFromLocalStorage(e,s.id)}},_mask:function(e){O.showOverlayLoader(void 0,e)},_unmask:function(e){O.hideOverlayLoader(e)},_onItemTitleClick:function(t,n,i){let s=this;if(e.is(i)&&e.is(t)&&e.is(n)&&(s._dropdown._guidedMode&&s._dropdown.enableTopBarField(),!0!==s._isIncontextBuilderMode)){let e=n&&n._models[t._rowID];s.modalVisibility(!1);let o={model:e,text:e.getDisplayName(),webInwin:i.webInwin,eventManager:i.eventManager};v.log("SearchDropDownUtils::_onItemTitleClick: ",o),s.onClickObject(o)}},_promiseVocabNLS:function(t,n){let i=this;return i._nlsPromises[t]||(i._nlsPromises[t]=new o((function(i,s){I.setResources(n),I.loadVocabulary(t,(function(t){e.is(t)&&"success"===t.status?i():s()}))}))),i._nlsPromises[t]},modalVisibility:function(e,t){let n=this,i=n._modalBody&&n._modalBody.getParent();i&&i.removeClassName("escape"),i&&i.removeClassName("display"),!0===e?(i&&i.addClassName("display"),n._modal&&n._modal.show(),n._modalVisibility=!0,!0!==n._isIncontextBuilderMode&&(E.setItem("guidedModeBetaClose",!0),E.commit(),n._guidedModeBetaClose=!0),v.log("SearchDropDownUtils::modalVisibility true")):(i&&i.addClassName("escape"),"iphone"===b.getDeviceCategory()?n._dropdown&&n._dropdown.elements.dropdownContainer.addClassName("autocomplete-hidden"):n._dropdown&&n._dropdown.onBlur(void 0,!0),n._modal&&n._modal.hide(),n._modalVisibility=!1,t&&t.currentTarget&&t.currentTarget.focus(),n._SmartQueryController&&n._SmartQueryController.destroySugDropdown(),v.log("SearchDropDownUtils::modalVisibility false"))},setInContextMode:function(t,n){let i=this;if(!0===t&&(!n||n&&"furtive"===n.inContextOptions.mode)){let t=e.extendElement(i._searchtabbuttonscontainer.querySelector("#myFavoriteDropdown"));t&&t.hide()}else{let t=e.extendElement(i._searchtabbuttonscontainer.querySelector("#myFavoriteDropdown"));t&&t.show()}},getInContextMode:function(){return this._inContextMode},_buildheaderSection:function(t){let n=this;if(!e.is(t))return;const{container:i,dropdown:s,eventManager:o,webInwin:a,myContent:r,favoriteSearch:c,SimilarSearch:l,PartSupply:d,Relations:u,strmycontent:h,strmyfav:p,stradvSearch:g,strSimilarSearch:_,strPartSupply:m,strRelations:S}=t;let f=e.extendElement(i.querySelector("#myContentDropdown"));e.is(f)&&e.is(r)&&!0===r&&(O.tooltip(f,{title:h,position:"bottom",reshowDelay:1,mouseRelativePosition:!0,longHelp:b.escapeHtml(ee.get("search.myContent.LongHelp"))}),f.show(),f.addEventListener("click",(function(e){n.modalVisibility(!1,e),o&&o.dispatchEvent("myContent",{value:b.SearchTypeEnum.MY_CONTENT,search_myContent:b.SearchTypeEnum.MY_CONTENT,adv_search:!1}),s&&(s.setPlaceHolderValue(ee.get("search.myContent.title")),s.elements.input.readOnly=!0,s._changeIcon("user"))}))),f=e.extendElement(i.querySelector("#myFavoriteDropdown")),e.is(f)&&(e.is(c)&&!0===c?(O.tooltip(f,{title:p,position:"bottom",reshowDelay:1,mouseRelativePosition:!0,longHelp:b.escapeHtml(ee.get("search.favoriteSearch.LongHelp"))}),f.show(),f.addEventListener("click",(function(e){n.modalVisibility(!1,e),o&&o.dispatchEvent("favoriteSearches",{value:b.SearchTypeEnum.FAVORITE_SEARCH,adv_search:!1}),s&&(s.setPlaceHolderValue(ee.get("search.favoriteSearch")),s.elements.input.readOnly=!0,s._changeIcon("on"))}))):f.hide()),f=e.extendElement(i.querySelector("#advSearchDropdown")),e.is(f)&&(O.tooltip(f,{title:g,position:"bottom",reshowDelay:1,mouseRelativePosition:!0,longHelp:b.escapeHtml(ee.get("search.advancedSearch.LongHelp"))}),f.addEventListener("click",(function(e){n.modalVisibility(!1,e),o&&o.dispatchEvent("advancedSearch",{value:b.SearchTypeEnum.ADVANCED_SEARCH,adv_search:!0}),s&&(n._SmartQueryController&&n._SmartQueryController._clearInputEditor(),s.elements.input.value="",s.setPlaceHolderValue(ee.get("search.advancedSearch")),s.elements.input.readOnly=!0,s._changeIcon("cog"))}))),f=e.extendElement(i.querySelector("#DDM_SomeCommands_SimilarSearch_Header")),e.is(f)&&e.is(l)&&!0===l&&(O.tooltip(f,{title:_,position:"bottom",reshowDelay:1,mouseRelativePosition:!0,longHelp:b.escapeHtml(ee.get("search.DDM_SomeCommands_SimilarSearch_Header.LongHelp"))}),f.show(),f.addEventListener("click",(function(e){n.modalVisibility(!1,e),o&&o.dispatchEvent("otherCommand",{value:"SimilarSearch"}),s&&s.setPlaceHolderValue(_)}))),f=e.extendElement(i.querySelector("#PartSupplyHeader")),e.is(f)&&e.is(d)&&!0===d&&(O.tooltip(f,{title:m,position:"bottom",reshowDelay:1,mouseRelativePosition:!0,longHelp:b.escapeHtml(ee.get("search.PartSupplyHeader.LongHelp"))}),f.show(),f.addEventListener("click",(function(e){n.modalVisibility(!1,e),o&&o.dispatchEvent("otherCommand",{value:"PartSupplyHeader"}),s&&s.setPlaceHolderValue(m)}))),f=e.extendElement(i.querySelector("#DDM_SomeCommands_RelNavWbWn_Header")),e.is(f)&&e.is(u)&&!0===u&&(O.tooltip(f,{title:S,position:"bottom",reshowDelay:1,mouseRelativePosition:!0,longHelp:b.escapeHtml(ee.get("search.DDM_SomeCommands_RelNavWbWn_Header.LongHelp"))}),f.show(),f.addEventListener("click",(function(e){n.modalVisibility(!1,e),o&&o.dispatchEvent("otherCommand",{value:"RelationalExplorer"}),s&&s.setPlaceHolderValue(S)})))},buildNLQFeedBackBtn:function(){let t=this,n=e.extendElement(t.switcherBody._container.getElement("#nlqFeedback"));if(n){n.empty();let e=s.create("span",{class:"fonticon fonticon-thumbs-up"}).inject(n);e.addClassName("disable-button"),e.addEventListener("click",(function(){var{queryValue:e,statement:n}=t._SmartQueryController.getQueryValueAndStatement();t.FeedbackContainer?(t.feedbackFormVueInstance.queryValue=e,t.feedbackFormVueInstance.statement=n,t.FeedbackContainer.show()):t.buildNLQFeedBackFormVue3(e,n)}))}},buildNLQFeedBackForm:function(){let e=this;e.feedbackOkDisbaled=!0,e.selectedRating=null,e.feedbackValue=null;let{queryValue:t,statement:n}=e._SmartQueryController.getQueryValueAndStatement();e.nlqFeedbackOkButton=new u({value:ee.get("NLQFeedback.ok"),className:"primary",disabled:!0,events:{onClick:function(){e.createIdea(t,n)}}}),e.selectedTagIndex=[],e._modal&&e._modal.elements&&e._modal.elements.container&&e._modal.elements.container.addClassName("nlqFeedbackFormloader"),e.feedbackModal=new l({header:ee.get("NLQFeedback.heading"),className:"nlqFeedback",closable:!0,body:"",events:{onHide:function(){e.selectedRating=null,e.feedbackValue=null,e.selectedTagIndex=[],e.feedbackModal.destroy(),e._modal&&e._modal.elements&&e._modal.elements.container&&e._modal.elements.container.removeClassName("nlqFeedbackFormloader")}},footer:[e.nlqFeedbackOkButton,new u({value:ee.get("NLQFeedback.cancel"),className:"default nlqFeedbackCancel",events:{onClick:function(){e.feedbackModal.destroy()}}})]}).inject(document.body),e.feedbackModal.show();let i=s.create("form",{class:"nlqFeedbackForm",autocomplete:"off"}),o=new d({className:"vertical",fields:[{type:"text",value:n,name:"my_text",label:ee.get("NLQFeedback.userText"),disabled:!0},{type:"text",value:t,name:"my_text",label:ee.get("NLQFeedback.queryLabel"),disabled:!0}]}).inject(i);var a=s.create("div",{class:"form-group",styles:{"padding-top":"2px"}}).inject(o.elements.container);s.create("label",{text:ee.get("NLQFeedback.ratingLabel"),requiredFlag:!0}).inject(a);new UWA.Element("span",{text:" *",class:"tn-utv-mandatoryFieldSign"}).inject(a).hide();var r=s.create("div",{class:"ratingStar"}).inject(a);e.rating_element=[];for(let t=4;t>=0;t--)e.rating_element[t]=s.create("radio",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-favorite-on",events:{click:function(t){e.selectedRating=t.target.index,e.rating_element.forEach(((t,n)=>{e.selectedRating>=n?t.classList.add("active"):t.classList.remove("active")}))}}}).inject(r),e.rating_element[t].index=t;var c=s.create("div",{class:"form-group"}).inject(o.elements.container);s.create("label",{text:ee.get("NLQFeedback.question"),class:""}).inject(c),e.mandatoryFieldSign1=new UWA.Element("span",{text:" *",class:"tn-utv-mandatoryFieldSign"}).inject(c);var p=s.create("div",{class:"feedbackAnswerBtn"}).inject(c);this.feedbackAnswerBtn=[];let g=T.getOption("NlqFeedback").communityTags;for(let t=0;t<g.length;t++)this.feedbackAnswerBtn[t]=new u({value:g[t].dispVaue,className:"default",styles:{"text-wrap":"wrap"},events:{onClick:()=>{e.createIssue(t)}}}).inject(p),this.feedbackAnswerBtn[t].elements.input.style["text-wrap"]="wrap";var _=s.create("div",{class:"form-group"}).inject(o.elements.container);s.create("label",{text:ee.get("NLQFeedback.feedbackLabel"),class:""}).inject(_);e.feedbackValue=new h({multiline:!0,placeholder:ee.get("NLQFeedback.textEditorPlaceholder"),rows:4}).inject(_),e.feedbackModal.setBody(i)},buildNLQFeedBackFormVue3:function(e,t){let n=this;n.nlqFeedbackMetaData=n.getNLQFeedbackMetaData(),n.FeedbackContainer=s.create("div",{class:"feedbackModal",events:{click:function(e){e.stopPropagation()}}}).inject(document.body);n.feedbackForm=se.createApp({template:'\n        <form class="feedback-form" @click="stopPropagation" autocomplete="off">\n          <div class="header">\n          <h4 >{{heading}}</h4>\n          <span @click="closeFeedbackForm" class="close fonticon fonticon-cancel"></span>\n          </div>\n          <div class="feedback-modal-content" @click="stopPropagation">\n            <div class="feedback-rating">\n              <p>{{experience}}</p>\n              <div ref="action_btn_container" class="action-btn-container ">\n\n              </div>\n            </div>\n            <div ref="nlqFeedbackAutoComplete" @click="stopPropagation" class="feedback-keywords">\n              <p>{{chipsLabel}}</p>\n\n            </div>\n            <div ref="feedbackTextSection" class="feedback-comments">\n              <p>{{feedbackLabel}}</p>\n            </div>\n            <div v-if="testQA" class="user-query">\n              <p>User Query :</p>\n              <div>{{statement}}</div>\n            </div>\n            <div v-if="testQA" class="uql-query">\n              <p>UQL Query :</p>\n              <div>{{queryValue}}</div>\n            </div>\n          </div>\n          <div ref="footer" class="footer">\n            <span class="search-info wux-ui-3ds wux-ui-3ds-info" ref="informationIcon"></span>\n            <div ref="share_cancel_btn_container" class="footer-action-btns">\n            </div>\n          </div>\n        </form>\n      ',data:()=>({share:ee.get("NLQFeedback.ok"),heading:ee.get("NLQFeedback.heading"),cancel:ee.get("NLQFeedback.cancel"),experience:ee.get("NLQFeedback.ratingLabel"),chipsLabel:ee.get("NLQFeedback.chipsLabel"),feedbackLabel:ee.get("NLQFeedback.feedbackLabel"),statement:t,queryValue:e,testQA:T.getOption("NLQFeedbackQATest")}),components:{},methods:{stopPropagation:function(e){e.stopPropagation()},closeFeedbackForm:function(){n.FeedbackContainer.hide(),n.feedbackRating=void 0,n.feedbackComments=void 0,n.feedbackKeywords=void 0,this.thumbsUpButton.checkFlag=!1,this.thumbsDownButton.checkFlag=!1,this.nlqFeedbackAutoComplete.elementsTree=[],this.nlqFeedbackAutoComplete.placeholder=ee.get("NLQFeedback.selectKeywords"),this.nlqFeedbackAutoComplete.disabled=!0,this.textAreaMessage.value=void 0,this.textAreaMessage.disabled=!0,this.shareButton.disabled=!0},async shareFeedbackData(){try{n.FeedbackContainer.hide(),n.feedbackKeywords=this.nlqFeedbackAutoComplete.value||[],n.feedbackComments=this.textAreaMessage.value;let e=n.nlqFeedbackMetaData.communityTags;const t=n.feedbackKeywords.map((t=>{const n=e.find((e=>e.dispValue===t));return n?n.internalValue:null})).filter(Boolean);re.feebackTracker({feedbackRating:n.feedbackRating,feedbackKeywords:t,feedbackComments:n.feedbackComments}),await n.createIdea(this.queryValue,this.statement)}catch(e){console.error("Error:",e);let t=n.nlqFeedbackMetaData.communityURL,i=ee.get("NLQFeedback.errorNotification")+'<a target="_blank" href="'+t+'">Community</a> ';A._displayAlert({message:i,className:"error",container:document.getElement(".search-drop-down.modal.modal-root")})}finally{this.closeFeedbackForm()}}},mounted(){let e=this;e.thumbsUpButton=new m({domId:"thumbs-up-btn",icon:{iconName:"thumbs-up",fontIconFamily:WUXManagedFontIcons.Font3DS},type:"radio"}).inject(this.$refs.action_btn_container),e.thumbsUpButton.addEventListener("buttonclick",(function(){n.feedbackRating="GOOD",e.nlqFeedbackAutoComplete.disabled=!1,e.textAreaMessage.disabled=!1,e.shareButton.disabled=!1,e.nlqFeedbackAutoComplete.elementsTree=i,e.nlqFeedbackAutoComplete.placeholder=ee.get("NLQFeedback.selectKeywords")})),e.thumbsDownButton=new m({domId:"thumbs-down-btn",icon:{iconName:"thumbs-down",fontIconFamily:WUXManagedFontIcons.Font3DS},type:"radio"}).inject(this.$refs.action_btn_container),e.thumbsDownButton.addEventListener("buttonclick",(function(t){n.feedbackRating="BAD",e.nlqFeedbackAutoComplete.disabled=!1,e.textAreaMessage.disabled=!1,e.shareButton.disabled=!1,e.nlqFeedbackAutoComplete.elementsTree=s,e.nlqFeedbackAutoComplete.placeholder=ee.get("NLQFeedback.selectKeywords")}));let t=n.nlqFeedbackMetaData.communityTags;var i=[],s=[];for(let e=0;e<t.length;e++){let n=t[e].dispValue;"GOOD"===t[e].category?i.push({label:n,value:n}):s.push({label:n,value:n})}e.nlqFeedbackAutoComplete=new oe({elementsTree:[],allowFreeInputFlag:!1,disabled:!0,placeholder:ee.get("NLQFeedback.selectKeywords"),getChipInfo:function(e){return{label:e.options.value}}}),e.nlqFeedbackAutoComplete.inject(this.$refs.nlqFeedbackAutoComplete),e.nlqFeedbackAutoComplete.addEventListener("change",(function(){e.nlqFeedbackAutoComplete.value.length>=("GOOD"===n.feedbackRating?i.length:s.length)?e.nlqFeedbackAutoComplete.placeholder="":e.nlqFeedbackAutoComplete.placeholder=ee.get("NLQFeedback.selectKeywords")})),e.textAreaMessage=new ae({placeholder:ee.get("NLQFeedback.textEditorPlaceholder"),nbRows:4,newLineMode:"enter",maxlength:1e3,disabled:!0}).inject(this.$refs.feedbackTextSection),e.shareButton=new m({label:ee.get("NLQFeedback.ok"),domId:"share-button",emphasize:"primary",disabled:!0}).inject(this.$refs.share_cancel_btn_container),e.shareButton.addEventListener("click",(function(){e.shareFeedbackData()})),e.cancelButton=new m({label:ee.get("NLQFeedback.cancel"),emphasize:"secondary"}).inject(this.$refs.share_cancel_btn_container),e.cancelButton.addEventListener("click",(function(){e.closeFeedbackForm()})),O.tooltip(this.$refs.informationIcon,{shortHelp:b.escapeHtml(ee.get("NLQFeedback.informationTooltip")),position:"bottom",reshowDelay:1,mouseRelativePosition:!0})}}),n.feedbackForm.config.compilerOptions={runtimeGlobalName:"require('DS/vue-3.4.15/vue')"},n.feedbackFormVueInstance=n.feedbackForm.mount(n.FeedbackContainer)},getNLQFeedbackMetaData:()=>({communityContainerId:"swym:215dsi0708:DSEXT001:community:d80Ryk3pS26XRXtfnAmtWA",communityURL:"https://dsext001-eu1-215dsi0708-3dswym.3dexperience.3ds.com/community/swym:215dsi0708:DSEXT001:community:d80Ryk3pS26XRXtfnAmtWA",communityInternalPODURL:"https://dsext001-eu1-215dsi0708-3dswym.3dexperience.3ds.com",communityTags:[{tag:"ds6wclassifier:why_BELCHAR__#ct#_Fast",predicate:"ds6w:why",dispValue:ee.get("NLQFeedback.fastKeyword"),category:"GOOD",internalValue:"FAST"},{tag:"ds6wclassifier:what_BELCHAR__#ct#_Accurate",predicate:"ds6w:what",dispValue:ee.get("NLQFeedback.accurateKeyword"),category:"GOOD",internalValue:"ACCURATE"},{tag:"ds6wclassifier:why_BELCHAR__#ct#_Relevant",predicate:"ds6w:why",dispValue:ee.get("NLQFeedback.relevantKeyword"),category:"GOOD",internalValue:"RELEVANT"},{tag:"ds6wclassifier:why_BELCHAR__#ct#_Slow",predicate:"ds6w:why",dispValue:ee.get("NLQFeedback.slowKeyword"),category:"BAD",internalValue:"SLOW"},{tag:"ds6wclassifier:why_BELCHAR__#ct#_Inaccurate",predicate:"ds6w:why",dispValue:ee.get("NLQFeedback.inaccurateKeyword"),category:"BAD",internalValue:"INACCURATE"},{tag:"ds6wclassifier:what_BELCHAR__#ct#_Unhelpful",predicate:"ds6w:what",dispValue:ee.get("NLQFeedback.unhelpfulKeyword"),category:"BAD",internalValue:"UNHELPFUL"}]}),createIssue:function(e){let t=this.selectedTagIndex.indexOf(e);t>-1?(this.selectedTagIndex.splice(t,1),this.feedbackAnswerBtn[e].setClassName("default")):(this.feedbackAnswerBtn[e].setClassName("primary"),this.selectedTagIndex.push(e)),this.nlqFeedbackOkButton.enable()},createIdea:async function(e,t){try{let n=this,i=b.getActiveTenant(),s=n.nlqFeedbackMetaData.communityInternalPODURL,o=n.nlqFeedbackMetaData.communityContainerId,a=await b._getCsrfTokenPromise(i,s);t="Feedback - "+t;let r=`${ee.get("NLQFeedback.queryLabel")} -${e}`;n.feedbackRating&&(r+=`<br/>Rating:${n.feedbackRating}`),n.feedbackComments.length>0&&(r+=`<br/>Feedback :${n.feedbackComments}`);let c=n.nlqFeedbackMetaData.communityTags;c=c.filter((e=>n.feedbackKeywords.includes(e.dispValue)));let l=await b._createIdea(i,a,t,r,c,o,s);if(l.result){let e=l.result,t='<a target="_blank" href="'+(s+"/community/"+e.container.subject6wuri+"?content="+e.subject6wuri)+'">Idea</a> '+ee.get("NLQFeedback.notification");A._displayAlert({message:t,className:"success",container:document.getElement(".search-drop-down.modal.modal-root")})}}catch(e){console.error("Error:",e);let t=_this.nlqFeedbackMetaData.communityURL,n=ee.get("NLQFeedback.errorNotification")+'<a target="_blank" href="'+t+'">Community</a> ';A._displayAlert({message:n,className:"error",container:document.getElement(".search-drop-down.modal.modal-root")})}},buildNLQEdit:function(){let t=this,n=e.extendElement(t._modalBody.querySelector(".nlq-brick-container"));if(n){new m({class:"nlqModeEdit",icon:{iconName:"pencil",fontIconFamily:WUXManagedFontIcons.Font3DS},touchMode:"true",emphasize:"primary",showLabelFlag:!1,onClick:function(e){}.bind(t)}).inject(n).hide()}},buildNLQQuery:function(e){this.nlqBrickContainer||(this.nlqBrickContainer=new UWA.Element("div",{class:"nlq-brick-container"}));this.nlqBrickContainer.getElement(".brick-blocks");this.nlqBrickContainer.empty(),e.forEach(((e,t)=>{e.associatedChipCellView.inject(this.nlqBrickContainer)})),this._guidedContentView&&(this._guidedContentView.nlqBrickContainer=this.nlqBrickContainer),T.getOption("NLQFeedback")&&this.buildNLQFeedBackBtn()},_buildDisplayValue:function(t){let n=t.displayValue;if(t&&e.is(t.data,"array")){let i,s=t.data.length;n=s>1?"@0 "+te.get("date.and")+" @1":"@0";for(let o=0;o<s;o++)if("date"===t.dataTypes){let s=new Date(t.data[o]);if(e.is(s)){let a=e.is(s.toISOString,"function")?s.toISOString().split("T")[0]:t.data[o];i=n.replace("@"+o.toString(),a),n=i}}else{let e=t.data[o];i=n.replace("@"+o.toString(),e),n=i}}return n},_buildexamplesList:function(){let e=this;e.examplesList&&this.examplesList.unmount();let t=this._dropdown.elements.guidedSamples;e.clearcontainer(t);let n={template:'<div class="example">\n              <div class="examples-content" @click="addToSearch">\n              <div class="examples-text" v-html="examplesText"></div>\n              <div id="add-search">\n                <span class="wux-ui-3ds-search-add wux-ui-3ds"></span>\n              <div>\n              </div>\n            </div>',props:{examplesText:"HTML",actionHandler:"Function",blocks:"Object",statement:"String"},data(){},methods:{addToSearch(){e._SmartQueryController&&(e._currentSearchMode.contains("guidedSearch")?e._SmartQueryController.addGuidedFromModel(this.blocks):(e._SmartQueryController.setInputValue(this.statement),e._SmartQueryController.nlqInputValueTooltip?e._SmartQueryController.nlqInputValueTooltip.elements.body.innerText!=this.statement&&(e._SmartQueryController.nlqInputValueTooltip=e._SmartQueryController.nlqInputValueTooltip.setBody(this.statement)):e._SmartQueryController.nlqInputValueTooltip=e._SmartQueryController.createNLQInputTooltip(this.statement),e._SmartQueryController._previewButton.disabled=!0,e._SmartQueryController.loadNLQChipAndResult(this.statement)),e.disbaleANDOperator())}}};this.examplesList=se.createApp({template:'\n        <div class="guided-info">\n          <div class="info-icon wux-ui-3ds-info wux-ui-3ds"></div>\n          <div class="info-text">{{infoText}}</div>\n        </div>\n        <div class="guided-common-samples-title">{{title}}</div>\n          <div v-if="showExamples" class="example-container" v-for="example in examples">\n            <Example :examplesText="example.result" :blocks="example.blocks" :statement="example.text" />\n          </div>\n          <div v-else class="common-samples-empty-view">\n            <div class="instant-search-empty-view-image fonticon fonticon-search"></div>\n            <div class="instant-search-empty-view-text">{{noMatchMsg}}</div>\n          </div>\n        </div>\n        ',data:()=>({title:e._currentSearchMode.contains("guidedSearch")?ee.get("guidedModeTitle"):ee.get("NLQModeTitle"),examples:[],blocks:[],statement:"",infoText:te.get("smart.mode.info.text"),showExamples:!0,noMatchMsg:ee.get("NLQMode.noCommonSearches")}),components:{Example:n},methods:{},mounted(){let t=this;if(e._currentSearchMode.contains("guidedSearch")){JSON.parse(Y).Examples.forEach((function(n){let i=n.title,s=n.blocks,o=n.display,a=[];s.forEach((e=>{a.push(e.type)}));let r={};r.blocks=s,r.result=e._buildblock(o,i,a),t.examples.push(r)}))}else{let n=JSON.parse(Z),i=[],s=e._SmartQueryController&&e._SmartQueryController.getSelectionChipLineEditorValue()||"";s=s.trim();for(let t in n)""!=t&&e.buildNLQExampleBySearching(s,t,i);0===i.length&&(t.showExamples=!1),i.forEach((function(e){let n={};n.result=`<span>${e.text}</span>`,n.text=e.text,t.examples.push(n)}))}}}),this.examplesList.config.compilerOptions={runtimeGlobalName:"require('DS/vue-3.4.15/vue')"},this.examplesList.mount(t)},_buildExample:function(t){if(!e.is(t))return;let n=W.replace("###NlsKey###",b.escapeHtml(te.get("smart.mode.example.add"))),i=s.create("div",{class:"example"});return i.innerHTML=n,i.inject(t),e.extendElement(i)},_buildblock:function(t,n,i){if(!e.is(t))return;let s=t.length,o="",a=n;for(let e=0;e<s;e++){let n=t[e];o=a.replace(n,'<span class="block search-'+i[e].toLowerCase()+(i[e-1]&&"PREDICATE"==i[e-1]||"R_OPERATOR"==i[e-1]?" capsule":"")+'">'+n+"</span>"),a=o}return a},_buildGuidedModeHelp:function(e){if(!e.getElement(".guided-mode-help-container")){let t=s.create("div",{class:"guided-mode-help-body"});JSON.parse(Y).toTranslate.forEach(((e,t)=>{let n=b.escapeHtml(te.get("smart.mode.help."+e));K=K.replaceAll("###GuidedHelp"+e+"###",n)})),t.innerHTML=K,this.guidedHelp=new _({header:te.get("smart.mode.guidedModeHelp"),body:t,style:"filled-separate",expandedFlag:!0}).inject(e),this.guidedHelp.elements.container.addClassName("guided-mode-help-container")}},_manageSettingsHelp:function(t){let n=this;if(!e.is(t)||!e.is(n._modalBody))return;const{settings:i,helps:s}=t;e.is(i)&&(!0===i?(n._modalBody.removeClassName("helps"),n._modalBody.removeClassName("settings"),n._modalBody.addClassName("settings"),n._helpsDisplay=!1):n._modalBody.removeClassName("settings"),n._settingsDisplay=i),e.is(s)&&(!0===s?(n._modalBody.removeClassName("helps"),n._modalBody.removeClassName("settings"),n._modalBody.addClassName("helps"),V.helpTracker(),n._settingsDisplay=!1):n._modalBody.removeClassName("helps"),n._helpsDisplay=s)},_createTaggerProxy:function(t,n){let i=this;if(!e.is(n))return;if(e.is(i._taggerProxy))return i._taggerProxy;let s={enablePLM:!1,tenant:n.active_tenant,filteringMode:"FilteringOnServer",disableAutoComplete:!0,searchMoreTagsOnDemand:!0,freeInput:!1,defaultDatePicker:!0,preciseCount:!1,exclude:!0,simplified:{data_location:!0,type_categorization:!0,person_data:!0,editTagsRelationships:!0},enableGrouping:{maxLevels:1,withIconInfo:!0},contextId:"DropDownContext",widgetId:"SearchDropDown",embeddedTagger:{target:"#dropdown-search-global-embedded",rootw:{"ds6w:what":{}},multiselect:!1},events:{addGroupingChangeListener:i._OnGroupingChange.bind(i)}};return i._taggerProxy=t.createProxy(s),i._taggerProxy},_OnGroupingChange:function(t){let n=this;e.is(t,"object")&&n._resutlsContentcollection&&n._resutlsContentcollection.dispatchEvent("OnGroupingChange",t),e.is(n._taggerProxy)&&n._taggerProxy.setStatus({action:"grouping",status:!0,message:"Grouping sucessful"})},_onkeyupbody:function(t){let n,i=this;if(!i._modalBody.getParent().hasClassName("autocomplete-hidden")){if(27===t.keyCode&&(i._dropdown&&i._dropdown.elements.dropdownContainer.addClassName("autocomplete-hidden"),i._dropdown.enableTopBarField(),i._SmartQueryController&&i._SmartQueryController.sugDropdown&&i._SmartQueryController.sugDropdown.hide(),n="Escape"),18!==t.keyCode||i.timeOut)if(!0!==i._altKey&&!0!==t.altKey||!(83===t.keyCode||67===t.keyCode||80===t.keyCode||81===t.keyCode||72===t.keyCode||88===t.keyCode||79===t.keyCode||t.keyCode>=49&&t.keyCode<=57||t.keyCode>=97&&t.keyCode<=105))191==t.keyCode?(n="JumpToSearch",i._focusOnLineEditor()):i._SmartQueryController.removeShortcuts();else{switch(i._focusOnLineEditor(),t.keyCode){case 83:n="Alt_Search";case 79:i._SmartQueryController._apply&&i._SmartQueryController._apply.fire("buttonclick"),n="Alt_InContext_OK";break;case 67:i._SmartQueryController._clearbutton&&i._SmartQueryController._clearbutton.fire("buttonclick");break;case 80:n="Alt_Pin";case 88:n="Alt_InContext_Cancel",i._SmartQueryController._savebutton&&i._SmartQueryController._savebutton.fire("buttonclick");break;case 81:n="Alt_Settings",i._manageSettingsHelp({settings:!i._settingsDisplay});break;case 72:n="Alt_Help",i._manageSettingsHelp({helps:!i._helpsDisplay})}if(t.keyCode>=49&&t.keyCode<=57?i.headerNumber=t.keyCode-49:t.keyCode>=97&&t.keyCode<=105&&(i.headerNumber=t.keyCode-97),e.is(i.headerNumber,"number")&&i.headerNumber<=i._modalBody.querySelectorAll(".AltNumber").length){let e=i.headerNumber;for(s=0;s<i._modalBody.querySelectorAll(".AltNumber").length;s++)n="Alt_Number",i._modalBody.querySelectorAll(".AltNumber")[s].parentNode.querySelector(".item-circle")&&(i._modalBody.querySelectorAll(".AltNumber")[s].parentNode.querySelector(".item-circle").querySelector(".fonticon-expand-down")||s==e)&&i._modalBody.querySelectorAll(".AltNumber")[s].parentNode.parentNode.querySelector(".section-title").click();let t=0;for(s=0;s<e;s++)t+=parseInt(i._modalBody.querySelectorAll(".AltNumber")[s].parentNode.parentNode.querySelectorAll(".suggestion-content").length);i._SmartQueryController._lastIndex=t,i._SmartQueryController._mouveOnIndex(),i.headerNumber=void 0}i.timeOut=!0,setTimeout((function(){i.timeOut=!1}),250),i._SmartQueryController.removeShortcuts()}else if(i._SmartQueryController._clearbutton&&i._SmartQueryController._clearbutton.getContent().hasClassName("AltKeys"))i._SmartQueryController.removeShortcuts(),n="Alt_Hide",i._focusOnLineEditor();else{let t=i._modalBody.getParent();i._modalBody.querySelector(".wux-controls-lineEditor-lite").blur(),i._SmartQueryController._clearbutton&&i._SmartQueryController._clearbutton.getContent().addClassName("AltKeys"),i._SmartQueryController._previewButton&&i._SmartQueryController._previewButton.getContent().addClassName("AltKeys"),i._SmartQueryController._apply&&i._SmartQueryController._apply.getContent().addClassName("AltKeys"),i._SmartQueryController._savebutton&&i._SmartQueryController._savebutton.getContent().addClassName("AltKeys"),e.extendElement(t.getParent().querySelector("#settingsDropdown")).addClassName("AltKeys"),e.extendElement(t.getParent().querySelector("#pqsDropdown")).addClassName("AltKeys");for(var s=0;s<t.querySelectorAll(".AltNumber").length;s++)t.querySelectorAll(".AltNumber")[s].setAttribute("style","--key:'"+(s+1)+"'"),t.querySelectorAll(".AltNumber")[s].addClassName("AltKeys");n="Alt_Show",i._altKey=!0}i._SmartQueryController._inEdition||i.notifTimeOut||i._modalBody.querySelector(".wux-controls-lineEditor-lite")==document.activeElement||18==t.keyCode||17==t.keyCode||9==t.keyCode||1==t.altKey||t.keyCode>=37&&t.keyCode<=40||(i.notifTimeOut=!0,i._modalBody.querySelector(".search-notification-text")&&i._modalBody.querySelector(".search-notification-text").setAttribute("style","display:block"),n="ShowNotification",setTimeout((function(){i.notifTimeOut=!1,i._modalBody.querySelector(".search-notification-text")&&i._modalBody.querySelector(".search-notification-text").setAttribute("style","display:none")}),5e3)),n&&V.shortcutsTracker(n),t.stopPropagation(),t.preventDefault(),i._focusOnLineEditor()}},_focusOnLineEditor:function(){this._SmartQueryController&&this._SmartQueryController.focusEditor()},_onClickbody:function(t){let n=this;if(!1===n._modalVisibility||!0===n._isIncontextBuilderMode)return;let i=t,s=["modal-open","wux-","btn-root","sn-search-field","fonticon-cancel"],o=[T.getOption("command_id.add_tag"),ne.get("add_tag.add_tag_header"),T.getOption("command_id.new_preview"),ne.get("previewTitle"),"exportAs",ne.get("exportAs")];if(i.target&&!i.target.getClosest(".nlqFeedback")){let t=!0;for(let e=0;e<s.length&&(t=i.target.className.contains(s[e]),!0!==t);e++);if(!1===t){let a=n._modalBody&&n._modalBody.contains(i.target);if(a=!i.target.hasClassName("search-dropdown-content")&&a,!1===a){let n=document.body.querySelector("#search-lightbox");if(e.is(n))a=n.contains(i.target);else if(i.target.className.contains("item")){a=!1;let e=i.target.getText()&&i.target.getText().length?i.target.getText():i.target.id;for(let n=0;n<s.length;n++)if(t=e.contains(o[n]),!0===t){a=!0;break}}}!1===a&&(v.log("SearchDropDownUtils::_onClickbody and onblur"),n.modalVisibility(!1))}}},_initSkeletonMgt:function(){let e=this;return null===e._skeleton&&(e._skeleton=new L({messagingChannel:void 0,resources:e._resources,tagger_proxy:void 0,powerByOptions:void 0,in_apps_search:void 0,furtive:!1,widgetId:""}),e._skeleton.informationsAction=!1,e._modalBody.currentViewId="searchdropdown",e._modalBody.contentsViews=[],e._modalBody.contentsViews.searchdropdown=e._modalBody,e._modalBody.isMultiSelMode=function(){return!1},e._skeleton._skeleton.placeHolder=e._modalBody,e._skeleton._skeleton.getViewAt=function(t){return e._modalBody},e._skeleton._skeleton.isMultiSelMode=function(){return!1}),e._skeleton},clearcontainer:function(t){let n=this;if(e.is(t)){let e=t.getChildren();e.length>0&&e.forEach((function(e){n._clearcontainer(e),e.remove()})),t.empty()}},_clearcontainer:function(t){if(e.is(t)){let e=t.getChildren();e.length>0&&e.forEach((function(e){e.remove()})),t.empty()}},getQueryStringFromLNP:function(e){v.log("SearchDropDownUtils:getQueryStringFromLNP");const{queryinput:t}=e;return new o((function(e,t){t()}))},_createSwitcherBody:function(t){let n=this;this.switcherBody=se.createApp({template:'\n        <div class="search-header">\n          <div :class="switcherClass" ref="switcherCont"></div>\n          <div class="search-toggle" :id="searchTitleButton" @click="enableSearchInTitle" ref="searchTitleCont"></div>\n          <div class="guided-lite-mode-cont disable">\n            <span class="search-info wux-ui-3ds wux-ui-3ds-info" ref="searchInfo"></span>\n            <div class="search-info" id="nlqFeedback" ref="nlqFeedback"></div>\n          </div>\n        </div>\n      ',data:()=>({switcherClass:"searchdropdown-mode-switcher",searchTitleButton:"search-title-only",guidedOperator:"guided-lite-mode",currentSearchMode:n._currentSearchMode}),methods:{_changeMode(i){let s=i.dsModel._lastValidatedSelectedIndex,o=this.searchTreeDocument.getRoots()[s]._options.id;this.currentSearchMode=n._currentSearchMode="guidedSearch"===o?E.getItem("guidedSearchMode")||"guidedSearchExpert":o,T.getOption("search_web_in_win")&&window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("SearchModeInDropDown",this.currentSearchMode),E.setItem("searchMode",n._currentSearchMode),E.commit(),n.changeSearchView(t),V.switcherTracker(n._currentSearchMode)},_preSelection(){let e=this;n.userHasAccesstoNLQ().then((function(){n.isNLQMode&&e.addNLQMode()})),n._SmartQueryController&&n._SmartQueryController.sugDropdown&&n._SmartQueryController.sugDropdown.hide()},enableSearchInTitle(e){let i=this.searchTitleOnly.checkFlag;n.searchInTitleOnly=i,n._dropdown._SearchDropDownPQs.elements.typeShortcutsExpander&&n._dropdown._SearchDropDownPQs.elements.typeShortcutsExpander.elements.container.toggleClassName("hidePQ",i),t.eventManager.dispatchEvent("set_title_only_search",{is_title_only:i}),E.setItem("titleOnly",i),E.commit(),V.searchInTitleOnly(i)},addNLQMode:function(){let e=new y({label:te.get("switcher.nlqSearch"),icons:[{iconName:"search-swym"}],id:"nlqSearch"});this.searchTreeDocument.addRoot(e)}},mounted(){if(t.isGuidedMode()||n.isNLQMode){this.searchTreeDocument=new C;var e=new y({label:te.get("switcher.standardSearch"),icons:[{iconName:"search"}],id:"standardSearch"});this.searchTreeDocument.addRoot(e),t.isGuidedMode()&&(e=new y({label:te.get("switcher.guidedSearch"),icons:[{iconName:"search-cog"}],id:"guidedSearch"})),this.searchTreeDocument.addRoot(e);let i=n._currentSearchMode;i.contains("guidedSearch")&&(i="guidedSearch"),n.isNLQMode&&"nlqSearch"===i&&(n.NLQCheck=!0,this.addNLQMode());let s=this.searchTreeDocument.getRoots().findIndex(((e,t)=>{if(e._options.id==i)return t}));this.searchSwitcher=new S({elementsTree:this.searchTreeDocument,domId:"search-dropdown-switcher",enableSearchFlag:!1,selectedIndex:s,displayStyle:"lite",touchMode:!0}).inject(this.$refs.switcherCont),this.searchSwitcher.addEventListener("change",this._changeMode.bind(n)),this.searchSwitcher.addEventListener("preDropdown",this._preSelection.bind(n))}let i=E.getItem("titleOnly");this.searchTitleOnly=new g({label:te.get("search-title-only"),type:"switch",touchMode:!0,checkFlag:i,domId:"search-in-title"}).inject(this.$refs.searchTitleCont),t.eventManager.dispatchEvent("set_title_only_search",{is_title_only:i}),this.searchTitleOnly.addEventListener("click",this.enableSearchInTitle.bind(n)),n.infoTooltip=O.tooltip(this.$refs.searchInfo,{shortHelp:b.escapeHtml(te.get("smart.mode.nlq.info")),position:"bottom",reshowDelay:1,mouseRelativePosition:!0}),O.tooltip(this.$refs.nlqFeedback,{position:"bottom",reshowDelay:1,mouseRelativePosition:!0,longHelp:b.escapeHtml(te.get("nlqFeedback"))})}}),this.switcherBody.config.compilerOptions={runtimeGlobalName:"require('DS/vue-3.4.15/vue')"},this.switcherBody.mount(t.elements.searchDropdownHeader)},createInputEditor:function(e,t){let n=this;n.inputEditorView=se.createApp({template:"<div class='smart-queries-editor' ref='inputEditor'></div>",data(){},methods:{},mounted(){n._SmartQueryController.render(e.elements.searchDropdownInput,this.$refs.inputEditor)}}),n.inputEditorView.config.compilerOptions={runtimeGlobalName:"require('DS/vue-3.4.15/vue')"},n.inputEditorView.mount(e.elements.searchDropdownInput)},changeSearchView:function(e){let t=this._currentSearchMode;this._SmartQueryController&&(this._SmartQueryController.setCurrentSearchMode(t),this._SmartQueryController.destroySmartQuery()),"standardSearch"===t?(e.elements.searchTabContainer.removeClassName("guided-mode"),e.elements.searchTabContainer.removeClassName("nlq-mode"),e.elements.guidedSamples.addClassName("hide"),e.loadStdSearch(),e.enableTopBarField(),this.searchInTitleOnly&&e.eventManager.dispatchEvent("set_title_only_search",{is_title_only:!0}),e.elements.searchHelpTooltip.title=b.escapeHtml(ie.get("PredefinedQuery")),e.elements.searchHelpTooltip.longHelp=b.escapeHtml(ie.get("PredefinedQuery.shortHelp"))):(this._dropdown.elements.instantSearchTabContainer.removeClassName("limitReached"),this._dropdown.elements.rightContentContainer.removeClassName("limitReached"),this._dropdown.elements.instantSearchEmptyView&&this._dropdown.elements.instantSearchEmptyView.hide(),this.showguidedContainer(),this.searchInTitleOnly&&e.eventManager.dispatchEvent("set_title_only_search",{is_title_only:!1}))},switchActiveTab:function(){"standardSearch"==this._currentSearchMode?this._dropdown.activateSearchTab(this._dropdown.elements.searchTab):this._SmartQueryController&&this._SmartQueryController.getSmartQueryLength()?this._SmartQueryController.buildQuerySearch():this.showguidedContainer()},isGuided:function(){return"standardSearch"!==this._currentSearchMode},disbaleANDOperator:function(e){let t=this._dropdown.elements.searchDropdownHeader.getElement(".guided-lite-mode-cont");t&&t.toggleClassName("disable",e)},setIncontextMode:function(){this._dropdown.elements.tabContainer.hide(),this._dropdown._onBuilderModeFocus()},resetIncontextMode:function(){this._isIncontextBuilderMode=!1,this._dropdown&&this._dropdown.setInputValue(""),this._dropdown&&this._dropdown.onBlur(void 0,!0),this._dropdown.elements.tabContainer.show(),this._dropdown.noFocus=!1,this.switcherBody=null,this._dropdown._guidedMode?this._SmartQueryController.setPlaceHolder():(this._dropdown.elements.dropdownContainer.removeClassName("enable-guided-mode"),this._dropdown.setPlaceHolderValue(ee.get("search.tab.search"))),this._dropdown.enableTopBarField()},_createEmptyView:function(e){e.getChildren().forEach(function(e){e.className.contains("search-history-container")&&e.destroy()}.bind(this));let t=s.create("div",{class:"container-empty-view"}).inject(e);this._dropdown._buildNoHistoryIconAndPlaceholder(t),e.addClassName("empty-view-center")}});return le})),define("DS/SNSearchUX/helpers/SmartQueryUtils",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","UWA/Element","UWA/Promise","DS/WebappsUtils/WebappsUtils","DS/PubSub/PubSub","DS/Controls/SelectionChips","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/utils/SNCompassUtils","DS/SNInfraUX/SNSuggestionHelper","DS/SNInfraUX/utils/RankingEngine","DS/SNSearchUX/dropdown/SearchDropDownUtils","DS/SNResultUX/utils/ExternalComponentHelpers","i18n!DS/SNSearchUX/assets/nls/GuidedMode.json","text!DS/SNSearchUX/assets/templates/GuidedMode/suggestionTab.html"],(function(e,t,n,i,s,o,a,r,c,l,d,u,h,p,g,_,m,S){"use strict";var f=t.singleton(i,n,{name:"DS_SmartQueryUtils",_controller:null,_maxDiplay:10,_Appssuggestions:null,_appsPromise:null,_dropdownFull:!1,_maxSuggests:5,init:function(){this._controller=null,this._appsPromise=null,this._maxDiplay=10,this._Appssuggestions=[],this._dropdownFull=!1,this._maxSuggests=5,this.sections=["compTag","commTag","user","optr","type","intf","tags","clat","keys","tagv"]},clean:function(){this._Appssuggestions=[],this.hidesuggestionTab({controller:this._controller})},setMaxToDisplay:function(t){let n=this;l.log("SmartQueryUtils::setMaxToDisplay value: ",t),e.is(t)?n._maxDiplay=t:n._maxDiplay=10},setController:function(e){l.log("SmartQueryUtils::setController"),this._controller=e},setdropdownFull:function(e){l.log("SmartQueryUtils::setdropdownFull"),this._dropdownFull=e},clearcontainer:function(e){g.clearcontainer(e)},_clearcontainer:function(e){g._clearcontainer(e)},_buildMoreLess:function(t){let n=this;if(!e.is(t))return;const{showall:i,container:o,containerTitle:a,sectioncontent:r}=t;if(e.is(i)&&!1===i){let e=s.create("div",{class:"show-more-container suggestion-content"});e.inject(r),e.innerHTML="...",e.title=d.escapeHtml(m.get("showAll")),e.addEventListener("click",(function(e){e.stopPropagation(),t.showall=!t.showall,t.mouseupCB.call(n,t)}))}a&&a.addEventListener("click",(function(e){e.stopPropagation(),t.showall=!t.showall,t.mouseupCB.call(n,t)}))},_buildWhosuggestions:function(t){l.log("SmartQueryUtils::_buildWhosuggestions");const{suggestions:n,controller:i,container:s}=t;let o=n.length,a=0,r=e.extendElement(s);for(;a<o;a++){let t=n[a];if(e.is(t)){let n=t.imageUrlPromise;e.is(n)&&n.then((function(n){let i=e.clone(t.displayValue).replace(/ /g,""),s=r&&r.querySelector("#"+i);s&&(s.src=n)}))}}return o},displaySections:function(e){const{dropdown:t,value:n,controller:i,historyOnly:s,container:o,mode:a}=e;this._createAllSectionHeaders(e);i._listOfFreesuggestions,i._freeContainer},buildCategories:function(t){if(!e.is(t))return;let n=this;const{controller:i,suggestions:s,value:o=""}=t;i._listOfFreesuggestions=[],i._listOfAppssuggestions=[];for(let e=0;e<n.sections.length;e++)i["_"+n.sections[e]+"List"]=[];i.getmainLayoutSimplified();let a=!1,r=s.length;if(r){let t=0;for(;t<r;t++){let n=s[t];if(e.is(n)){let e=n.type;switch("PREDICATE"===e&&n.isClassAttribute&&(e="CLASS_ATTR"),e){case"TYPE":case"TYPE_GROUP":i._typeList.push(n);break;case"INTERFACE":i._intfList.push(n);break;case"L_OPERATOR":case"R_OPERATOR":case"U_OPERATOR":case"CLOSE_PARENT":case"OPEN_PARENT":i._optrList.push(n);break;case"PREDICATE":i._tagsList.push(n);break;case"CLASS_ATTR":i._clatList.push(n);break;case"PREDICATE_VALUE":case"VALUE_KEYWORD":i._tagvList.push(n);break;case"COMPANY_TAG":i._compTagList.push(n);break;case"COMMUNITY_TAG":case"USER_TAG":i._commTagList.push(n);break;case"KEYWORD":case"KEY_KEYWORD":i._keysList.push(n);break;case"USER_TEXT":i._userList.push(n);break;default:console.log("Error")}}}n._computeRankingList(s,i._listOfFreesuggestions)}else e.is(o)&&o.length>0&&(a=!0);let c={displayValue:o,type:"USER_TEXT",uri:"",iconClass:"fonticon-pencil",value:o};if(c.displayValue&&i._listOfFreesuggestions.push(c),(3===n._maxDiplay||o.length>0)&&(a=!0),!0===a&&0===i._smartQuery.length()&&!1===n._dropdownFull){}l.groupCollapsed("******** SmartQueryUtils::buildCategories ********"),l.log("SmartQueryUtils::buildCategories: list Of suggestions: ",s),l.log("SmartQueryUtils::buildCategories: list Of Search suggestions = ",i._listOfFreesuggestions);for(let e=0;e<n.sections.length;e++)l.log("SmartQueryUtils::buildCategories: list Of "+n.sections[e]+" suggestions = ",i["_"+n.sections[e]+"List"]);l.log("SmartQueryUtils::buildCategories: list Of Apps suggestions = ",i._listOfAppssuggestions),l.groupEnd("******** SmartQueryUtils::buildCategories ********")},_createAllSectionHeaders:function(t){if(!e.is(t))return;let n=this;const{dropdown:i,value:s,controller:o,container:a}=t;n.clearcontainer(a),o._appsContainer=null,o._freeContainer=null,o._histories=null,o._userTextContainer=null;for(let e=0;e<n.sections.length;e++)o["_"+n.sections[e]+"Container"]=null;o._userTextContainer=n._createSectionHeaders({container:o._userTextContainer,classname:"section-content-userTextContainer",maincontainer:a}),o._freeContainer=n._createSectionHeaders({container:o._freeContainer,classname:"section-content-free",maincontainer:a}),o._histories=n._createSectionHeaders({container:o._histories,classname:"section-content-history",maincontainer:a});for(let e=0;e<n.sections.length;e++)o["_"+n.sections[e]+"Container"]=n._createSectionHeaders({container:o["_"+n.sections[e]+"Container"],classname:"section-content-"+n.sections[e],maincontainer:a});!1===n._dropdownFull&&(o._appsContainer=n._createSectionHeaders({container:o._appsContainer,classname:"section-content-Apps",maincontainer:a}))},_createSectionHeaders:function(t){if(!e.is(t))return;let n=this;const{container:i,maincontainer:o,classname:a=""}=t;l.log("SmartQueryUtils::_createSectionHeaders Section: ",a);let r=i;return e.is(r)?n._clearcontainer(r):r=s.create("div",{class:a}).inject(o),r.hide(),r},_populateSectionSuggestions:function(t){if(!e.is(t))return;const{suggestions:n,dropdown:i,value:o,controller:r,container:c,maincontainer:u,showall:h,font:p="",nls:g="",classname:_=""}=t;l.log("SmartQueryUtils::_populateSectionSuggestions Section: ",_);let S=0;e.is(n)&&(S=n.length);let f=[],C=this;if(0===S||!e.is(c))return;let y,v,b=c;if(e.is(b)&&C._clearcontainer(b),b.show(),g&&g.length>0&&(v=s.create("div",{class:"section-title"}).inject(b)),p.length&&v){y=s.create("div",{class:"item-circle"}).inject(v),y.hide();let e=p;!0===h&&(e=p.replace("right","down")),s.create("span",{class:"fonticon "+e}).inject(y)}v&&s.create("div",{class:"section-title-text AltNumber",text:d.escapeHtml(m.get(g))+(/section\-content\-(compTag|commTag|user|type|intf|tags|clat|tagv)/.test(_)?"   [ "+S+" ]":"")}).inject(v);let w=s.create("div",{class:"section-content"}).inject(b),D=S;!1===h&&S>C._maxDiplay&&(D=C._maxDiplay,/section\-content\-(compTag|commTag|user|optr|type|intf|tags|clat|keys|tagv|history)/.test(_)&&(D=4));let I={controller:r,suggestions:n,container:b};C._buildWhosuggestions(I);for(let t=0;t<D;t++){let i=n[t];e.is(i)&&f.push({text:i.displayValue,trueDisplayValue:i.onSelectUpdateTo||void 0,imageUrl:i.imageUrl,iconClass:i.iconClass,imageUrlPromise:i.imageUrlPromise,highLight:i.highLight,type:e.is(i.type)?i.type:void 0})}f.map((t=>t.mouseupCB=((t,n)=>{l.log("SmartQueryUtils::_populateSectionSuggestions select value: ",t),e.is(n)&&"USER_TEXT"===n?r._buildUserFreeText(t,n):(C.setMaxToDisplay(),r._pressEnter=!0,r._buildChipAndSuggestion(t,n))}).bind(i)));let E=a.getWebappsBaseUrl()+"TagNavigator/assets/icons/generic_user.png";f.forEach((function(t){let n=t.type?t.type.toLowerCase():"",i=s.create("div",{class:"suggestion-content search-"+n,title:t.text}).inject(w);if(i.type=t.type,t.trueDisplayValue&&(i.trueDisplayValue=t.trueDisplayValue),i.addEvent("click",function(t){let n=this;if(n&&e.is(n.mouseupCB))return n.mouseupCB.call(n,t.currentTarget&&t.currentTarget.getText(),n.type),t}.bind(t)),e.is(t.imageUrlPromise)){let e=s.create("span",{class:"suggestion-image"}).inject(i);s.create("img",{src:E,class:"image",width:"17px",height:"auto",id:t.text.replace(/ /g,"")}).inject(e)}else if(e.is(t.imageUrl)){let e=s.create("span",{class:"suggestion-image"}).inject(i);s.create("img",{src:t.imageUrl,class:"image",width:"17px",height:"auto"}).inject(e)}else if(e.is(t.iconClass)){s.create("span",{class:"fonticon "+t.iconClass+" suggestion-icon"}).inject(i)}let o=s.create("div",{class:"suggestion-text"}).inject(i),a=C._createspan({value:t.highLight,valuetrue:t.text});o.innerHTML=a||t.text})),S>C._maxDiplay&&(y&&y.show(),t.container=b,t.containerTitle=v,t.sectioncontent=w,t.mouseupCB=C._populateSectionSuggestions,C._buildMoreLess(t))},_populateHistorySection:function(t){if(!e.is(t))return;const{suggestions:n,dropdown:i,value:o,controller:a,container:r,maincontainer:c,showall:u,font:h="",classname:p="",nls:_="",history:S=!0}=t;let f=0;e.is(n)&&(f=n.length);let C=[],y=this,v=r;if(e.is(v)?y._clearcontainer(v):v=s.create("div",{class:p}).inject(c),v.show(),0===f)return v.hide(),v;let b=d.escapeHtml(m.get(_)),w=d.escapeHtml(m.get("search.history.clear")),D=s.create("div",{class:"section-title"}).inject(v);if(!0===S){let e=s.create("div",{class:"item-circle"}).inject(D);s.create("span",{class:"fonticon fonticon-trash",title:w+" "+b}).inject(e);e&&e.addEvent("click",(function(e){e.stopPropagation(),i.displayClearHistoryModal(e),i.noBlur=!0}))}D&&s.create("div",{class:"section-title-text AltNumber",text:b}).inject(D);let I=s.create("div",{class:"section-content"}).inject(v),E=f;for(let t=0;t<E;t++){let i=n[t];e.is(i)&&C.push({text:i.displayValue,iconClass:i.iconClass,highLight:i.highLight,action:i.action,type:e.is(i.type)?i.type:"history",model:e.is(i.model)?i.model:void 0,id:e.is(i.id)?i.id:void 0})}return C.map((e=>e.mouseupCB=(e,t,n)=>{l.log("SmartQueryUtils::_populateHistorySection select value: ",e),0===a._smartQuery.length()?(y.setMaxToDisplay(),a._pressEnter=!0,a._buildChipAndSuggestion(e,t)):a._buildUserFreeText(e)})),C.forEach((function(t){let n=s.create("div",{class:"suggestion-content",title:t.text,id:e.is(t.id)?t.id:void 0}).inject(I);if(n.type=t.type,n.addEvent("click",(function(n){if(e.is(t.mouseupCB))return t.mouseupCB.call(i,n.currentTarget&&n.currentTarget.getText(),t.type,t.model),n})),e.is(t.iconClass)){s.create("span",{class:"fonticon "+t.iconClass+" suggestion-icon"}).inject(n)}let o=s.create("div",{class:"suggestion-text"}).inject(n),a=y._createspan({value:t.highLight,valuetrue:t.text});if(o.innerHTML=a||t.text,e.is(t.action)){s.create("span",{class:"search-history-delete fonticon fonticon-close",title:w+" '"+t.text+"'"}).inject(n).addEvent("click",(function(e){setTimeout((function(){y._controller&&y._controller.focusEditor()}),150),g.removeHistoryElement(e.currentTarget),e.stopPropagation()}))}})),v},_createspan:function(t){if(!e.is(t))return;const{value:n,valuetrue:i}=t;if(!e.is(n)||0===n.length)return;let s=[];e.is(n,"string")?s[0]=n:s=n;let o=/[!"#$%&' ()*+,-./\\:;<=>?@[\]^_`{|}~]/g,a=i;for(var r=0;r<s.length;r++){let t=e.clone(s[r]);t=t.replace(/  +/g," ").trim(),t=t.toLowerCase();let n=t;t=n.replace(o,"");let i=[...n.matchAll(/[!"#$%&' ()*+,-./\\:;<=>?@[\]^_`{|}~]/g)],c=n;i.forEach(((e,t)=>{let n=e.index;c=c.slice(0,n+t)+"\\"+c.slice(n+t)}));let l=new RegExp(c,"i"),d=a.lastIndexOf("</span>"),u=d>-1?a.slice(d+7):a,h=u.match(l),p=a.indexOf(h[0],a.length-u.length);a=a.substr(0,p)+'<span class="highlightedSearchCriteria">'+h[0]+"</span>"+a.slice(p+h[0].length)}let c='<span title="">';return c+='<span class="searchItemSpan">',c+=a,c+="</span>",c+="</span>",c},populateAppsSection:function(t){if(!e.is(t))return;const{suggestions:n,dropdown:i,value:o,controller:a,container:r,maincontainer:c,showall:u,classname:h="",nls:p="",font:g=""}=t;let _=0;if(e.is(n)&&(_=n.length),0===_)return;let S=[],f=this,C=r;e.is(C)?f._clearcontainer(C):C=s.create("div",{class:h}).inject(c);let y=s.create("div",{class:"section-title"}).inject(C),v=s.create("div",{class:"item-circle"}).inject(y);s.create("span",{class:"fonticon "+g}).inject(v);s.create("div",{class:"section-title-text",text:d.escapeHtml(m.get(p))}).inject(y);let b=s.create("div",{class:"section-content"}).inject(C),w=_;!1===u&&_>f._maxDiplay&&(w=f._maxDiplay);for(let t=0;t<w;t++){let i=n[t];e.is(i)&&S.push({text:i.displayValue,imageUrl:e.is(i.imageUrl)?i.imageUrl:void 0})}return S.map((e=>e.mouseupCB=(e=>{l.log("SmartQueryUtils::populateAppsSection select value: ",e),f.setMaxToDisplay(),a._pressEnter=!0,a._buildChipAndSuggestion(e)}).bind(i))),S.forEach((function(t){let n=s.create("div",{class:"app-item",title:t.text}).inject(b);n.addEvent("mouseup",function(n){if(e.is(t.mouseupCB))return t.mouseupCB.call(this,n.currentTarget&&n.currentTarget.getText()),n}.bind(i));s.create("div",{class:"img-unselect",styles:{"background-image":"url("+t.imageUrl+")"}}).inject(n);s.create("div",{class:"item-view-content-wrapper",text:t.text}).inject(n)})),C},_getAppsFromCompassPromise:function(){let t=this;return t._appsPromise||(t._appsPromise=new o((function(n,i){u.getApplicationsFromCompass("",1e3).then((function(s){e.is(s)&&e.is(s.count)&&e.is(s.data)?(s.data.forEach((function(e){t._Appssuggestions.push({displayValue:e.title,type:"USER_TEXT",uri:"",value:e.title,imageUrl:e.icon,appInfos:e})})),n(t._Appssuggestions)):i()}))}))),t._appsPromise},getApps:function(t){let n=this;if(!e.is(t))return;let i=t.query;n._getAppsFromCompassPromise().then((function(){let s=new RegExp("^"+e.String.escapeRegExp(i),"i");if(e.is(t.oncomplete)){let e=n._Appssuggestions.filter((function(e){return e=e.displayValue,s.test(e)}));t.oncomplete.call(n,e)}}))},launchApp:function(t){if(!e.is(t))return;const{appInfos:n,dropdown:i}=t;e.is(n)&&e.is(i)&&i._onClickApp({currentTarget:{id:n.id}})},buildTweaker:function(t){let n=this;if(!e.is(t))return;l.log("SmartQueryUtils::buildTweaker Enter ");const{suggestion:i,container:o,datevalue:a,controller:r,chip:c,buildTweaker:d,onUpdateData:u}=t;let h,p,_,S,f,C,y=i.type,v=(i.value,i.dataTypes),b=i.uri,w=(r._smartQuery.getAt(r._smartQuery.length()-1),!1);if("PREDICATE_VALUE"===y){let t=v;l.log("SmartQueryUtils::buildTweaker : ",v),"date"===t?(w=!0,h="DS/Tweakers/TweakerDate",e.is(i.data,"array")&&i.data.length?(_=new Date(i.data[0]),i.data.length>1&&(S=new Date(i.data[1]))):(_=new Date(Date.now()-864e5),S=new Date(Date.now()+1728e5)),l.log("SmartQueryUtils::buildTweaker Tweaker Type: ",h)):"double"!==t&&"integer"!==t||(f="number",C=.1,_=0,S=0,"integer"===t&&(f="integer",C=1,_=0,S=0),e.is(i.data,"array")&&i.data.length&&(_="integer"===t?parseInt(i.data[0]):parseFloat(i.data[0]),i.data.length>1&&(S="integer"===t?parseInt(i.data[1]):parseFloat(i.data[1]))),l.log("SmartQueryUtils::buildTweaker Number: ",t),h="DS/Tweakers/TweakerNumber",w=!0),e.is(a,"array")&&a.length&&(l.log("SmartQueryUtils::buildTweaker old date "),"custPredVal:range"===b?(l.log("SmartQueryUtils::buildTweaker REBUILD"),e.is(i.data)&&(i.data=[])):(l.log("SmartQueryUtils::buildTweaker EDITBUILD"),2===a.length&&a.pop(),i.data=a,i.data[0].getContent().inject(o),w=!1,u.call(r,i.data))),!0===w?require([h],(function(e){if(l.log("SmartQueryUtils::buildTweaker create new date "),"custPredVal:range"===b){if(o.querySelector(".wux-chip-cell-label").hide(),"nlqSearch"!==g._currentSearchMode){let t=new e({value:_,disabled:!1,units:p,touchMode:!1,valueType:f,stepValue:C});t.inject(o);s.create("li",{class:"wux-chip-cell-label date",text:m.get("date.and")}).inject(o);let a=new e({value:S,disabled:!1,units:p,touchMode:!1,valueType:f,stepValue:C});a.inject(o),t.addEventListener("change",function(e){a.disabled=!1,a.elements.internalView.elements.calendarButton&&a.elements.internalView.elements.calendarButton.getContent().click()}.bind(o)),a.addEventListener("change",function(e){let t={chip:this,readOnly:!0};n.manageTweaker(t),r.refreshTweakerToReadonly(t),r.buildQuerySearch()}.bind(c)),setTimeout((function(){t.elements.internalView.elements.calendarButton&&t.elements.internalView.elements.calendarButton.getContent().click(),t.elements.internalView.elements.inputField&&t.elements.internalView.elements.inputField.select()}),100),i.data=[t.value,a.value],c.data=[t,a]}else{let e=_,n=S;if("date"===t){const t=new Date(_),i=new Date(S),s={year:"numeric",month:"long",day:"numeric"};e=t.toLocaleDateString("en-US",s),n=i.toLocaleDateString("en-US",s)}s.create("li",{class:"wux-chip-cell-label date",text:e}).inject(o),s.create("li",{text:m.get("date.and")}).inject(o),s.create("li",{class:"wux-chip-cell-label date",text:n}).inject(o)}u.call(r,i.data)}else{if("nlqSearch"!==g._currentSearchMode){let t=new e({value:_,disabled:!1,units:p,touchMode:!1,valueType:f,stepValue:C});t.inject(o),t.elements.internalView.elements.calendarButton.getContent().click(),i.data=[t.value],c.data=[t],t.addEventListener("change",function(e){let t={chip:c,readOnly:!0};i&&(i.data=[this.value]),n.manageTweaker(t),r.refreshTweakerToReadonly(t),r.buildQuerySearch()}.bind(t))}else{const e={year:"numeric",month:"long",day:"numeric"},t=new Date(_).toLocaleDateString("en-US",e);s.create("li",{class:"wux-chip-cell-label date",text:t}).inject(o)}o.querySelector(".wux-chip-cell-label").hide(),u.call(r,i.data)}})):u.call(r)}else u.call(r);l.log("SmartQueryUtils::buildTweaker END ")},manageTweaker:function(t){if(!e.is(t))return;const{chip:n,readOnly:i}=t;let s=n.chipOptions&&n.chipOptions.suggestion,o=e.is(n.data)?n.data:void 0;if(e.is(o,"array")){let t,a,r=o.length;t=r>1?"@0 "+m.get("date.and")+" @1":"@0";let c=!1;for(let n=0;n<r;n++){let r=o[n];if(e.is(r))if(i&&!0===i){let i=e.is(r.value)&&e.is(r.value.toISOString,"function")?r.value.toISOString().split("T")[0]:r.value;a=t.replace("@"+n.toString(),i),t=a,c=!0,r.hide(),s&&e.is(s.data,"array")&&(s.data[n]=i)}else r.show()}if(c){let t=e.is(n.associatedChipCellView)?n.associatedChipCellView.querySelector(".date"):void 0,i=e.is(n.associatedChipCellView)?n.associatedChipCellView.querySelector(".wux-chip-cell-label"):n.labelUx;i.innerHTML=a,i&&i.show(),t&&t.hide()}else{let t=e.is(n.associatedChipCellView)?n.associatedChipCellView.querySelector(".wux-chip-cell-label"):n.labelUx,i=e.is(n.associatedChipCellView)?n.associatedChipCellView.querySelector(".wux-controls-lineeditor"):n.lineEditor,s=e.is(n.associatedChipCellView)?n.associatedChipCellView.querySelector(".date"):void 0;i&&i.hide(),t&&t.hide(),s&&s.show()}}},buildChipsFromsmartQuery:function(t){let n=this;if(!e.is(t))return;l.log("SmartQueryUtils::buildChipsFromsmartQuery Enter ");const{chipsEditor:i,smartQuery:s,model:o,controller:a,buildTweaker:r}=t;let c;if(i&&i._selectionChips.removeAllChips(),e.is(o)){let e=o.length;for(let t=0;t<e;t++){let e=o[t];c=n.buildChipFromModel({chipsEditor:i,object:e,controller:a},t),s.push(e)}}else{let e=s.length();for(let t=0;t<e;t++){let e=s.getAt(t);c=n.buildChipFromModel({chipsEditor:i,object:e.suggestion?e.suggestion:e,controller:a,buildTweaker:r},t)}}return c},buildChipFromModel:function(t,n){let i=this;if(!e.is(t))return;l.log("SmartQueryUtils::buildChipFromModel Enter ");const{chipsEditor:s,object:o,controller:a,buildTweaker:r}=t;let d=f.buildChipData({suggestion:o}),u=s&&s._selectionChips;s||(u=new c);let h=["open_parent","close_parent","l_operator","r_operator"].findIndex((e=>d.type===e)),p=u.addChip({label:d.label,icon:h>-1?null:d.icon,index:s?n:void 0,suggestion:o});if(e.is(p)&&e.is(p.associatedChipCellView)){p.associatedChipCellView.setAttribute("draggable","false"),p.associatedChipCellView.addClassName("search-"+d.type),e.is(d.predicate)&&!0===d.predicate&&p.associatedChipCellView.addClassName("predicate");let t={index:n,smartQuery:a._smartQuery,currObj:o};if(!0===f.ifCapsule(t)&&p.associatedChipCellView.addClassName("capsule"),(!0===f.ifUnderParen(t)||u._items[n-1]&&u._items[n-1].associatedChipCellView.hasClassName("under_parenthesis")&&!d.type.contains("parent"))&&p.associatedChipCellView.addClassName("under_parenthesis"),e.is(r)&&!0===r){let t;e.is(a._selectedChip)&&e.is(a._selectedChip.suggestion.data)&&(t=a._selectedChip.suggestion.data);let n={suggestion:o,container:p.associatedChipCellView,datevalue:t,controller:a,chip:p,buildTweakerbool:r,onUpdateData:function(t){e.is(t)?o.data=t:a._addAfterEditor(a._lastPosIndexInEditor)}};i.buildTweaker(n)}p.associatedChipCellView.addEvent("click",a._onclickChange.bind(a))}return p},_buildcompleteSuggestion:function(t){if(!e.is(t))return;l.log("SmartQueryUtils::_buildcompleteSuggestion Enter ");let n=t.type,i={};"OPEN_PARENT"===n?(i.category="OPERATOR",i.displayValue=t.displayValue,i.type=t.type,i.uri="(",i.value=t.value):"CLOSE_PARENT"===n?(i.category="OPERATOR",i.displayValue=t.displayValue,i.type=t.type,i.uri=")",i.value=t.value):"L_OPERATOR"===n||"R_OPERATOR"===n?(i.category="OPERATOR",i.displayValue=t.displayValue,i.type=t.type,i.uri=t.uri,i.value=t.value):"USER_TEXT"===n&&(i.displayValue=t.displayValue,i.type=t.type,i.value=t.value),t.suggestion=i},_buildDateTweakerQuery:function(t){if(!e.is(t))return;l.log("SmartQueryUtils::_buildDateTweakerQuery START");const{smartQuery:n=n}=t;let i=n.length();n.getAt(i-1);for(let t=0;t<i;t++){let i,s=n.getAt(t),o=(s.type,s.value,s.dataTypes);if(i=s.suggestion?s.suggestion.data:s.data,"PREDICATE_VALUE"===s.type&&e.is(o)&&e.is(i,"array")){s.data=i;let t,n=i[0],o={};if(2===i.length){t=i[1]}e.is(n)&&(o.from=e.is(n.toISOString,"function")?n.toISOString().split("T")[0]:n,o.to=e.is(n.toISOString,"function")?n.toISOString().split("T")[0]:n),e.is(t)&&(o.to=e.is(n.toISOString,"function")?t.toISOString().split("T")[0]:t),l.log("SmartQueryUtils::_buildDateTweakerQuery query: ",o),s.value=o}}l.log("SmartQueryUtils::_buildDateTweakerQuery END")},buildQuerySearch:function(t){if(!e.is(t))return;const{smartQuery:n,onComplete:i}=t;this._buildDateTweakerQuery(t);let s=n&&n.buildQueryString(),o=!1;if(1===(n&&n.length())){let t=n.getAt(0);if(e.is(t)){if("USER_TEXT"===t.type){s.split(" ").length>0&&(o=!0)}}}!0!==o||this._isIncontextBuilderMode?i&&i.call(void 0,s):g.getQueryStringFromLNP({queryinput:s}).then((function(e){i&&i.call(void 0,e)}),(function(e){i&&i.call(void 0,s)})),l.group("******** SmartQueryUtils::buildQuerySearch ********"),l.log("QueryString: ",s),l.groupEnd("******** SmartQueryUtils::buildQuerySearch ********")},buildChipData:function(t){let n,i;if(!e.is(t))return;if(t&&t.suggestion&&t.suggestion.error)return{type:"user_text",label:t.suggestion.error,icon:{iconName:"error",fontIconFamily:WUXManagedFontIcons.Font3DS},preidcate:!1};let s=t.suggestion.type.toLowerCase(),o=t.suggestion.category,a=(t.suggestion.uri,t.suggestion.iconClass),r=!1;return e.is(s)&&(n=t.suggestion.displayValue,i={iconName:"",fontIconFamily:WUXManagedFontIcons.Font3DS},"user_text"===s?-1!==n.indexOf("(")||-1!==n.indexOf(")")?s="user_text parenthesis":e.is(t.suggestion.appInfos)?s="user_text app":i.iconName="pencil":"keyword"===s?-1===n.indexOf("(")&&-1===n.indexOf(")")||(s="keyword parenthesis"):"predicate"===s&&(r=!0),"ds6w:who"===o?!0===r&&(i.iconName="6w-who",s="type"):"ds6w:what"===o?(i.iconName="6w-what",s="type"):"ds6w:when"===o?"value_keyword"===s?i.iconName=void 0:(i.iconName="6w-when",s="type"):"ds6w:where"===o?(i.iconName="6w-where",s="type"):"ds6w:how"===o?i.iconName="6w-how":e.is(a)&&"pencil"!==i.iconName?i.iconName=a.replace("fonticon-",""):("OPERATOR"===o||s.contains("predicate"))&&(i.iconName=void 0)),{type:s,label:n,icon:i,predicate:r}},foundCloseparenthesis:function(t,n){let i=[],s=e.is(this._controller._SelectionChipsEditor)&&this._controller._SelectionChipsEditor._selectionChips._items,o=s.length;for(let r=0;r<o;r++){let c=s[r],l=c.chipOptions.label;"("!==l&&")"!==l||i.push({label:l,chip:c}),c&&c.associatedChipCellView&&c.associatedChipCellView.removeClassName("parenthesis_bracket")}let a=i.length;i.join("");if(a){let d=[],u=0;for(u=0;u<a;u++)d.push(i[u].label);let h,p,g,_=d.join("");function m(e,t){let n=[];for(let i=t;i>=0;i--)if(")"==e[i])n.push(e[i]);else if("("==e[i]&&(n.pop(),0==n.length))return i}if(e.is(t,"number")){h=s[t];let S=0;for(u=0;u<a;u++){if(i[u].chip.chipOptions.index===t){S=u;break}}if(e.is(h)&&e.is(h.chipOptions)){let f=h.chipOptions.label;if(")"===f)g=m(_,S);else if("("===f){function C(e,t){let n=[];for(let i=t;i<e.length;i++)if("("==e[i])n.push(e[i]);else if(")"==e[i]&&(n.pop(),0==n.length))return i}g=C(_,S)}}}else e.is(t,"object")&&e.is(t.chipOptions)&&")"===t.chipOptions.label&&(h=t,g=m(_,_.length-1));e.is(g)&&g<a&&(p=i[g].chip,h&&h.associatedChipCellView.addClassName("parenthesis_bracket"),p&&p.associatedChipCellView.addClassName("parenthesis_bracket"))}if(e.is(n,"boolean"))return a%2==0},loadHistory:function(t={}){let n=[];if(g.getHistoryListFromLocalStorage().length>0){let i=0,s=t.value;g.getHistoryListFromLocalStorage().forEach((function(t){let o=!1;e.is(s)?t.toLowerCase().indexOf(s.toLowerCase())>=0&&(o=!0,i++):(o=!0,i++),!0===o&&i<=10&&n.push({displayValue:t,highLight:s,iconClass:"fonticon-clock",action:"clear",type:"history"})}))}return n},_buildHistory:function(t){let n=this;if(!e.is(t))return;const{controller:i}=t;i._historyList=[];let s=n.loadHistory(t);if(i._historyList.push(...s),i._historyList.length){let e={dropdown:t.dropdown,value:t.value,controller:i,showall:!1,suggestions:i._historyList,container:t.controller._histories,font:"fonticon-clock",classname:"section-content-history",nls:"smart.mode.section.history",maincontainer:t.container};return t.controller._histories.show(),n._populateHistorySection(e)}},_removeObjectArray:function(e,t){let n=e.length,i=0,s=t;for(;i<n;i++){let t=e[i];s=s.filter((function(e){return e.type!==t.type&&e.displayValue!==t.displayValue}))}return s},_computeRankingList:function(t,n){let i=t.length,s=0;for(i=i>=6?6:i;s<i;s++){let i=t[s];e.is(i)&&n.push(i)}},ifCapsule:function(t){let n=!1;if(!e.is(t))return n;l.log("SmartQueryUtils::ifCapsule Enter ");const{index:i,smartQuery:s,currObj:o}=t;let a=s.length();if(a>0&&i<=a){let t=s.getAt(i-1);if(e.is(t)){let e=t.type;if("OPEN_PARENT"===o.type||"CLOSE_PARENT"===o.type)return n;"PREDICATE"!==e&&"R_OPERATOR"!==e||(n=!0)}}return n},ifUnderParen:function(t){let n=!1;if(!e.is(t))return n;const{index:i,smartQuery:s,currObj:o}=t;let a=s.length();if(a>0&&i<=a){let t=s.getAt(i-1),a=s.getAt(i);if(e.is(t)){let e=t.type;if("CLOSE_PARENT"===e)return n;if("OPEN_PARENT"===e||t.under_paren){if(o&&("OPEN_PARENT"===o.type||"CLOSE_PARENT"===o.type))return n;a&&("OPEN_PARENT"===a.type&&"CLOSE_PARENT"===a.type||(a.under_paren=!0,n=!0))}}}return n},addsuggestionTab:function(t){if(!e.is(t))return false;l.log("SmartQueryUtils::addsuggestionTab Enter ");const{controller:n,container:i}=t;e.is(n._suggestionTab)||(n._suggestionTab=s.create("div",{class:"autosuggest"}),n._suggestionTab.innerHTML=S,n._suggestionTab.inject(i))},hidesuggestionTab:function(t){if(!e.is(t))return false;l.log("SmartQueryUtils::hidesuggestionTab Enter ");const{controller:n}=t;n&&n._suggestionTab&&n._suggestionTab.hide()},completesuggestionTab:function(t){let n=this;if(!e.is(t))return false;l.log("SmartQueryUtils::completesuggestionTab Enter options: ",t);const{controller:i,value:s,highLight:o}=t;if(e.is(i._suggestionTab)){let t=e.extendElement(i._suggestionTab.querySelector(".guided-suggest-text"));if(e.is(t)){o&&s&&0==o.toLowerCase().indexOf(s.toLowerCase())?t.innerText=o.substring(s.length):t.innerText=o||"";let e=t.getStyle("overflow"),a=i._suggestionTab.getStyle("font"),r=n._getTextWidth(s,a)+14;if(e&&"hidden"===e){let e=parseInt(t.getStyle("max-width"));t.setStyle("width",e-r+16+"px")}i._suggestionTab.setStyle("left",r+"px"),i._suggestionTab.show()}}},_getTextWidth:function(e,t){let n=(this.canvas||(this.canvas=document.createElement("canvas"))).getContext("2d");return n.font=t,n.measureText(e).width},getChipPlaceholder:function(e){return"Start Typing..."}});return f})),define("DS/SNSearchUX/helpers/SmartQueryController",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Debug","UWA/Element","UWA/Promise","DS/PubSub/PubSub","DS/MessageBus/MessageBus","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/Controls/SelectionChipsEditor","DS/Controls/LineEditor","DS/Controls/Button","DS/Controls/ComboBox","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/Utilities/Utils","DS/SNSmartQuery/SNSmartQuery","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/Logger","DS/SNInfraUX/keywords/SNKeywordManager","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchPreferences","DS/SNResultUX/utils/ExternalComponentHelpers","DS/SNResultUX/utils/SearchServices","DS/SNSearchUX/helpers/SmartQueryUtils","DS/SNSearchUX/helpers/SmartspeechUtils","DS/SNSearchUX/helpers/GuidedTrackerUtils","DS/SNSearchUX/dropdown/SearchDropDownUtils","DS/SNSearchUX/helpers/ToxicityCheck","text!DS/SNSearchUX/assets/SmartQueryNLQ.json","i18n!DS/SNSearchUX/assets/nls/GuidedMode.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json","i18n!DS/SNSearchUX/assets/nls/SearchDropDown.json"],(function(e,t,n,i,s,o,a,r,c,l,d,u,h,p,g,_,m,S,f,C,y,v,b,w,D,I,E,T,x,M,N,k,A,O,P){"use strict";return t.extend(n,i,{_smartQuery:null,_listOfsuggestions:[],_listOfAppssuggestions:[],_listOfFreesuggestions:[],_SelectionChipsEditor:null,_container:null,_dropdown:null,_lastchip:null,_lastvalue:"",_father:null,_bresultFound:!1,_lastIndex:-1,_contentSpeech:null,_speechRecognition:null,_speechstart:0,_compassApp:!1,_selectedChip:null,_apply:null,_clearbutton:null,_previewButton:null,_appsContainer:null,_freeContainer:null,_lastselectedIndex:-1,_computesug:!1,_inEdition:!1,_inEditionEnter:!1,_pressEnter:!1,_lastPosIndexInEditor:-1,_buildQuerySearchTimeout:0,_containerinput:null,_containersuggestion:null,_containerresult:null,_containerInstantSearchTab:null,_containerinstantSearch:null,_containerinstantSearchEmptyView:null,_containerinstantSearchEmpty:null,_dropdownFull:!1,_buildListOfTypesDone:!1,_mainLayoutSimplified:!0,_maxToDisplay:5,_tosave:!1,_isIncontextBuilderMode:!1,activateSearchSuggestionPanel:!0,_containerNLQBricks:null,_historyList:[],init:function(t){this.setDebugMode(f.getDebugMode()),this.setOptions(t),this.inContextOptions=t.incontextOptions,this._smartQuery=new S({liteMode:!0}),this._dropdown=t.dropdown?t.dropdown:null,this._container=t.container?t.container:null,this._father=t.smartQueries?t.smartQueries:null,this._containerinput=t.containerinput?t.containerinput:null,this._containersuggestion=t.containersuggestion?t.containersuggestion:null,this._containerresult=t.containerresult?t.containerresult:null,this._containerInstantSearchTab=t.instantSearchTab?t.instantSearchTab:null,this._containerinstantSearch=t.instantSearch?t.instantSearch:null,this._containerinstantSearchEmptyView=t.instantSearchEmptyView?t.instantSearchEmptyView:null,this._containerinstantSearchEmpty=t.instantSearchEmpty?t.instantSearchEmpty:null,this._containerNLQBricks=t.nlqContainer?t.nlqContainer:null,this._bresultFound=!1,this._lastIndex=-1,this._contentSpeech=null,this._speechRecognition=null,this._speechstart=0,this._compassApp=!1,this._selectedChip=null,this._apply=null,this._clearbutton=null,this._previewButton=null,this.sections=["compTag","commTag","user","optr","type","intf","tags","clat","keys","tagv"];for(let e=0;e<this.sections.length;e++)this["_"+this.sections[e]+"Container"]=null;this._appsContainer=null,this._freeContainer=null,this._computesug=!1,this._inEdition=!1,this._inEditionEnter=!1,this._pressEnter=!1,this._lastselectedIndex=-1,this._lastPosIndexInEditor=-1,this._buildQuerySearchTimeout=0,this._dropdownFull=!!t.dropdownFull&&t.dropdownFull,this._buildListOfTypesDone=!1,this._tosave=!1,this.activateSearchSuggestionPanel=b.getItem("activateSearchSuggestionPanel")||!1,this._currentSearchMode=t._currentSearchMode,I.setController(this),!1===this._dropdownFull&&x.setController(this),e.is(this._containerinstantSearch)||(this._containerinstantSearch=this._dropdown.elements.instantSearchContainer),e.is(this._containerinstantSearchEmptyView)||(this._containerinstantSearchEmptyView=this._dropdown.elements.instantSearchEmptyView),e.is(this._containerresult)||(this._containerresult=this._dropdown.elements.searchResultsContainer),I.setdropdownFull(this._dropdownFull),this.noResultMessage=v.escapeHtml(k.get("noresultfound.text")),e.is(window.notifs)||(window.notifs=c,l.setNotificationManager(window.notifs))},computeSmartQuery:function(t){let n=this;return C.log("SmartQueryController::computeSmartQuery parameters: ",t),new o((function(i,s){if(e.is(n._smartQuery)&&e.is(t)&&e.is(t.value)){let s=t.value;if(e.is(s)){C.log("SmartQueryController::computeSmartQuery computeSmartQuery: ",s);let e={resolve:i,value:s,parameters:t};n._buildSuggestion(e)}}else s(new Error("SmartQueryController error inputs values"))}))},onSetSuggestion:function(t,n){let i=this;return C.log("SmartQueryController::onSetSuggestion",t),new o((function(s,o){if(e.is(i._smartQuery)&&e.is(t)){let t=n;if(e.is(t)){let n=i._lastPosIndexInEditor>0?i._lastPosIndexInEditor-1:0,a={selection:t,at:n,addParenthesis:!0,add_implicit_operator:b.getItem("activateImplicitOperator")},r=n+1,c=JSON.parse(JSON.stringify(t));c.index=n,T.selectTracker(c);let l=i._smartQuery.setSuggestion(a);if(e.is(l)){let n=l.suggestionToken;if(n.suggestion=t,e.is(n.value)||(n.value=t.displayValue),e.is(t.appInfos)&&(n.appInfos=t.appInfos),e.is(t.data)&&(n.data=t.data),e.is(t.dataTypes)&&(n.dataTypes=t.dataTypes),C.log("SmartQueryController::onSetSuggestion resolve: ",l),!0===l.refresh)i._refreshSuggestion(r);else{let e={resolve:s};i._buildSuggestion(e)}i._currentSearchMode.contains("guidedSearch")?i._SelectionChipsEditor.placeholder=P.get("GuidedModePlaceholder"):i._SelectionChipsEditor.placeholder=P.get("NLQModePlaceholder")}else o(new Error("SmartQueryController onSetSuggestion error inputs values"))}else o(new Error("SmartQueryController onSetSuggestion error inputs values"))}else o(new Error("SmartQueryController onSetSuggestion error inputs values"))}))},_refreshSuggestion:function(t){let n=this,i={chipsEditor:n._SelectionChipsEditor,smartQuery:n._smartQuery,controller:n,buildTweaker:n._buildTweaker},s=I.buildChipsFromsmartQuery(i),o=!0,a=!1;if(e.is(s)){let e=s.chipOptions.suggestion;if("L_OPERATOR"===e.type&&(a=!0),"CLOSE_PARENT"===e.type&&(o=!1,i.smartQuery.length())){let e=n._smartQuery._query;"L_OPERATOR"!==e[e.length-2].type&&"PREDICATE"!==e[e.length-2].type||(t+=1)}}if(n._lastPosIndexInEditor=t&&a?n._smartQuery.length()+1:t||(o?n._smartQuery.length()+1:n._smartQuery.length()-1),n._lastvalue="",n._SelectionChipsEditor._lineEditor.value="",n._SelectionChipsEditor._lineEditor.valueToCommit="","nlqSearch"==n._currentSearchMode&&n.nlqInputValueTooltip&&(n.nlqInputValueTooltip=n.nlqInputValueTooltip.destroy()),n._selectedChip=null,n._addAfterEditor(n._lastPosIndexInEditor),!1===o){let e=n._SelectionChipsEditor._selectionChips,t=e&&e.elements.container.getElement(".wux-controls-lastWidget-selectionChips");t&&(t.removeClassName("between"),setTimeout((function(){t.addClassName("edition")}),100))}n._lastchip=s,n._buildSuggestion();I.foundCloseparenthesis(s,!0);n._checkBeforeToLaunchSearch(),e.is(n._clearbutton)&&(n._clearbutton.disabled=!1)},_buildSuggestion:function(t={}){let{resolve:n,value:i,selectedIndex:s,itime:o,parameters:a}=t;C.log("SmartQueryController::_buildSuggestion value: ",i);let r=this,c=i;r._compassApp=!1,r._lastIndex=-1;let l=r._lastPosIndexInEditor,d=e.is(s)?s:l,u=r._lastPosIndexInEditor>=0&&r._smartQuery.getAt(r._lastPosIndexInEditor);if(l>=0){C.log("SmartQueryController::_buildSuggestion Size of _smartQuery: ",r._smartQuery.length());let t="";if(null!==r._selectedChip){t=r._selectedChip.suggestion&&r._selectedChip.suggestion.displayValue;for(let n=0;n<l;n++){let i=r._smartQuery.getAt(n);e.is(i)&&t===i.displayValue&&(u=i,d=n,n=l,C.log("SmartQueryController::_buildSuggestion Found display Name : ",t))}}}if(e.is(u)){let t=u.type;if("KEYWORD"===t){if(C.log("type === KEYWORD"),"ApplicationsFromCompass"===y.getKeywordQuery(u.value.toUpperCase())){C.log("SmartQueryController::_buildSuggestion Keyword === ApplicationsFromCompass"),r._compassApp=!0}}else if("USER_TEXT"===t){let t=u.appInfos;e.is(t)?(r._compassApp=!0,r._displayApp(t)):"("===u.value&&(u.value===c&&(c=""),d--)}}if(!1===r._compassApp&&!1===r._computesug){let t=e.is(o)?o:100;clearTimeout(r._getSuggestionsTimeout),r._getSuggestionsTimeout=setTimeout((function(){x._mask(r._containersuggestion?r._containersuggestion:r._dropdown.elements.customSuggestions),x._mask(x._modalBody.querySelector("inlineSuggestionDropdown")),r._computesug=!0,C.log("SmartQueryController::_buildSuggestion index",d),r._smartQuery.getSuggestions(d>=0?d:0,c).then((t=>{r._computesug=!1,r._cleanlistOf(),r._listOfsuggestions=t,I.buildCategories({controller:r,suggestions:t,value:i}),x._unmask(r._containersuggestion?r._containersuggestion:r._dropdown.elements.customSuggestions),x._unmask(x._modalBody.querySelector("inlineSuggestionDropdown")),r._currentSearchMode.contains("guidedSearch")&&(r._listOfFreesuggestions&&r._listOfFreesuggestions.length?r.sugDropdownLoading(r._listOfFreesuggestions,i):r.sugDropdown.hide()),e.is(n)&&n(t),C.groupCollapsed("******** SmartQueryController::_buildSuggestion getSuggestions ********"),C.info("SmartQueryController::_buildSuggestion getSuggestions for index: ",d),C.info("SmartQueryController::_buildSuggestion getSuggestions for value: ",i),C.info("SmartQueryController::_buildSuggestion _smartQuery: ",r._smartQuery._query),C.info("SmartQueryController::_buildSuggestion chips: ",r._SelectionChipsEditor._selectionChips._items),C.info("SmartQueryController::_buildSuggestion current index: ",r._lastPosIndexInEditor),C.info("SmartQueryController::_buildSuggestion getSuggestions: ",t),C.groupEnd("******** SmartQueryController::_buildSuggestion getSuggestions ********")}),(function(){r._cleanlistOf(),r._populateSuggestions(),r._computesug=!1,x._unmask(r._containersuggestion?r._containersuggestion:r._dropdown.elements.customSuggestions),C.log("SmartQueryController::_buildSuggestion Error")}))}),t)}},getmainLayoutSimplified:function(){return this._mainLayoutSimplified},_clearInputEditor:function(){let e=this;e._SelectionChipsEditor&&e._SelectionChipsEditor._selectionChips.removeAllChips(),e._SelectionChipsEditor._lineEditor.value="",e._SelectionChipsEditor._lineEditor.valueToCommit="","nlqSearch"==e._currentSearchMode&&e.nlqInputValueTooltip&&(e.nlqInputValueTooltip=e.nlqInputValueTooltip.destroy()),x.disbaleANDOperator(!1)},clean:function(t){C.log("SmartQueryController::clean");let n=this;n.destroySugDropdown(),n._clearInputEditor(),n._cleanlistOf(),I.clean(),n._lastchip=null,n._bresultFound=!1,n._lastIndex=-1,n._compassApp=!1,n._lastselectedIndex=-1,n._computesug=!1,n._inEdition=!1,n._inEditionEnter=!1,n._pressEnter=!1,n._lastPosIndexInEditor=-1,n._listOfsuggestions=[],n._moveEditortoEnd(),n._buildListOfTypes(),e.is(n._clearbutton)&&(n._clearbutton.disabled=!0),e.is(n._apply)&&n._DisableSearch(!0),e.is(n._previewButton)&&(n._previewButton.disabled=!0),"nlqSearch"===n._currentSearchMode&&x._modalBody.removeClassName("show-results"),n.focusEditor(),e.is(t)||n.setStartFullDropdown()},_cleanlistOf:function(){C.log("SmartQueryController::_cleanlistOf"),this._listOfsuggestions=[],this._listOfAppssuggestions=[],this._listOfFreesuggestions=[];for(let e=0;e<this.sections.length;e++)this["_"+this.sections[e]+"List"]=[]},render:function(t,n){if(!e.is(t))return;let i=this;if(i._initSelectionChipsEditor(),e.is(i._SelectionChipsEditor)&&i._SelectionChipsEditor.inject(n),i._SelectionChipsEditor){let t=s.create("div",{class:"smart-queries-search-option"}).inject(i._SelectionChipsEditor.getContent());i._clearbutton=new h({domId:"clearAll",icon:{iconName:"trash",fontIconFamily:WUXManagedFontIcons.Font3DS},touchMode:"true",displayStyle:"lite",emphasize:"primary",disabled:!0,onClick:function(e){i._containerinstantSearchEmpty&&i._containerinstantSearchEmptyView.hide(),i.clear()}.bind(i)}).inject(t),i._clearbutton.getContent().setAttribute("style","--key: 'C'"),i._clearbutton.getContent().setAttributeNode(document.createAttribute("touch-mode")),i._previewButton=new h({label:"",domId:"previewButton",icon:{iconName:"status-ok",fontIconFamily:WUXManagedFontIcons.Font3DS},touchMode:"true",displayStyle:"lite",disabled:!0,showLabelFlag:!1,onClick:function(){i.focusEditor(),i._previewButton.disabled=!0,i._clearbutton.disabled=!0,i.loadNLQChipAndResult(i.getSelectionChipLineEditorValue())}}).inject(t),i._previewButton.getContent().setAttribute("style","--key: 'P'"),i._previewButton.getContent().setAttributeNode(document.createAttribute("touch-mode")),i._previewButton.elements.button.style.overflow="visible",i._currentSearchMode&&i._currentSearchMode.contains("guidedSearch")&&i._previewButton.hide(),i._apply=new h({label:"",domId:"search",icon:{iconName:"search",fontIconFamily:WUXManagedFontIcons.Font3DS},touchMode:"true",displayStyle:"lite",disabled:!0,showLabelFlag:!1,onClick:function(e){i._applySearch(),i.removeShortcuts()}}).inject(t),i._apply.getContent().setAttribute("style","--key: 'S'"),i._apply.getContent().setAttributeNode(document.createAttribute("touch-mode")),i._apply.elements.button.style.overflow="visible",i._currentSearchMode&&i._currentSearchMode.contains("nlqSearch")&&i._apply.hide(),w.tooltip(i._clearbutton,{title:v.escapeHtml(k.get("smart.mode.clear")),position:"bottom",reshowDelay:1,mouseRelativePosition:!0,longHelp:void 0}),w.tooltip(i._apply,{title:v.escapeHtml(k.get("smart.mode.apply")),position:"bottom",reshowDelay:1,mouseRelativePosition:!0,longHelp:void 0}),w.tooltip(i._previewButton,{title:"Enter",position:"bottom",reshowDelay:1,mouseRelativePosition:!0,longHelp:void 0});let o=n.querySelector("input");e.is(o)&&o.addEventListener("keyup",i._inputEditorkeyup.bind(i)),e.is(o)&&o.addEventListener("keydown",i._inputEditorkeydown.bind(i)),e.is(i._containerinput)&&i._updateUI(),this.setPlaceHolder()}return n},_updateDataModelValue:function(e){this.dataModelValue=e},loadNLQChipAndResult:function(t){let n=x._modalBody,i=this.getLimitCount();i++;let s=x.loggedInUser,o=b.getItem("perUserQueryCounter");o[s].count=i,b.setItem("perUserQueryCounter",o),b.commit();let a=n.getElement(".smart-queries-editor");if(i<50){a.removeClassName("disabled");let i=this,s=i._dropdown.elements.instantSearchTabContainer;"relative"!==s.style.position&&(s.style.position="relative"),x._mask(s),i._smartQuery&&e.is(i._smartQuery.destroy,"function")&&i._smartQuery.destroy(),i._smartQuery=new S,i._smartQuery.buildFromNLQ(t,i.dataModelValue).then((e=>{n.addClassName("show-results"),x._unmask(s),i.buildNLQChipsAndQuery(t,e)})).catch((e=>{n.addClassName("show-results"),x._unmask(s);let o=[e];i.buildNLQChipsAndQuery(t,o)}))}else{i>parseInt(f.getOption("NLQQueryLimit"),10)&&(a.addClassName("disabled"),this._addLimitReachedNotif())}},getLimitCount:function(){let e=b.getItem("perUserQueryCounter"),t=x.loggedInUser,n=new Date,i=n.getFullYear()+"-"+n.getMonth()+"-"+n.getDate(),s=0;return e&&e[t]?e[t].date===i?s=e[t].count:e[t]={count:0,date:i}:(e={},e[t]={count:0,date:i}),b.setItem("perUserQueryCounter",e),b.commit(),s},_addLimitReachedNotif:function(){var e={level:"info",title:k.get("nlq.search.limitExceeded:title"),message:k.replace(k.get("nlq.search.limitExceeded:message"),{count:parseInt(f.getOption("NLQQueryLimit"),10)}),sticky:!0,poNotifId:"search-nlq-limit"};c._counterNotifications||c.addNotif(e)},_removeLimitReachedNotif:function(){l.removeNotifications(null,"info"),c._counterNotifications=0,c._currentLengthHistory=0},_initSelectionChipsEditor:function(){let t=this;e.is(t._SelectionChipsEditor)||(t._SelectionChipsEditor=new d({selection:{toggle:!1,unselectAllOnEmptyArea:!1},touchMode:!0,customValidator:function(n){e.is(n)&&n.length&&t._SelectionChipsEditor._lineEditor&&(t._SelectionChipsEditor._lineEditor.value=n,t._SelectionChipsEditor._lineEditor.valueToCommit=n)}}),t._SelectionChipsEditor.getContent().setAttributeNode(document.createAttribute("touch-mode")),t._SelectionChipsEditor._getElementToFocus().addEventListener("focus",t._clickOnChipsEditor.bind(t)),t._SelectionChipsEditor.addEventListener("onPostRemove",t._ChipChange.bind(t)),t._SelectionChipsEditor._lineEditor.addEventListener("uncommittedChange",t._inputEditoruncommittedChange.bind(t)),t._SelectionChipsEditor._lineEditor.addEventListener("change",t._inputEditorchange.bind(t)),t._SelectionChipsEditor._selectionChips.addEventListener("click",t._clickOnSelectionChipsDiv.bind(t),!0))},_clickOnChipsEditor:function(t){let n=this;e.is(n._dropdown)&&(C.log("SmartQueryController::_clickOnChipsEditor"),n._dropdown.noBlur=!0,n._dropdown.noFocus=!0,!0===n._inEdition&&(n.clickOnChipsEditorTimeout&&clearTimeout(n.clickOnChipsEditorTimeout),n.clickOnChipsEditorTimeout=setTimeout((function(){n._ChipEditionClose(!0),null!==n._selectedChip&&(n._selectedChip=null,n._computesug=!1,n.buildQuerySearch(),n._buildSuggestion()),n._SelectionChipsEditor._selectionChips.unselectAllChips()}),150)))},_buildListOfTypes:function(){let t=this;if(C.log("SmartQueryController::_buildListOfTypes"),!e.is(t._smartQuery))return;let n=t._smartQuery.length(),i=t._listOfsuggestions.length;0===n&&0===i&&(I.setMaxToDisplay(t._maxToDisplay),t.computeSmartQuery({value:"",historyOnly:!0}).then((function(){t._buildListOfTypesDone=!0})))},_inputEditorchange:function(t){let n=this;e.is(n._dropdown)&&(t.stopPropagation(),n.inputEditorchangeTimeout&&clearTimeout(n.inputEditorchangeTimeout),n.inputEditorchangeTimeout=setTimeout((function(){let i=t.dsModel;e.is(i)&&!1===n._pressEnter&&e.is(i.value)&&0===i.value.length&&e.is(i.valueToCommit)&&0===i.valueToCommit.length&&(C.groupCollapsed("SmartQueryController::_inputEditorchange"),C.log("SmartQueryController::_inputEditorchange _buildSuggestion"),n._buildSuggestion(),C.groupEnd()),n._pressEnter=!1}),300))},clearSugDropDownItems:function(e,t){let n=this;if(n.sugDropdown&&n.sugDropdown.items){length=n.sugDropdown.items.length;for(let e=length-1;e>=0;e--)n.sugDropdown.removeItem(e);if(n.sugDropdown.elements.container.addClassName("no-shimmer"),n.sugDropdown.elements.container.removeClassName("shimmer"),e){n.sugDropdown.elements.container.removeClassName("no-shimmer"),n.sugDropdown.elements.container.addClassName("shimmer");for(let e=0;e<8;e++)n.sugDropdown.addItem({text:" ",icon:"fonticon",className:"shimmerBG"})}n._smartQuery.length()&&t&&n._checkBeforeToLaunchSearch()&&n.sugDropdown.addItem({handler:e=>{e.stopPropagation(),n._applySearch(),n.removeShortcuts()},text:k.get("enterToSearch"),icon:"fonticon fonticon-search",id:"enter-to-search",selectable:!0})}},destroySugDropdown:function(){this.sugDropdown&&(this.sugDropdown.destroy(),this.sugDropdown=null)},checkVisibilityOfDropdown:function(){return!this._dropdown.isDropDownVisible()||!x._modalBody.hasClassName("guided-mode")||x._modalBody.closest(".helps-settings")||0==this.getSelectionChipLineEditorValueLength()&&0==this._smartQuery.length()},sugDropdownLoading:function(e,t){let n=this;n.checkVisibilityOfDropdown()||(n.debounceTimeOut&&clearTimeout(n.debounceTimeOut),n._selectedChip&&n._selectedChip.suggestion.dataTypes&&"date"==n._selectedChip.suggestion.dataTypes.toLowerCase()&&n._selectedChip.suggestion.type&&"predicate_value"==n._selectedChip.suggestion.type.toLowerCase()||(n.debounceTimeOut=setTimeout((()=>{let i=e,s=[],o=7,a=!1,r=!1;for(let e=0;e<i.length&&e<o;e++){let c=!1,l=i[e];if(!l.displayValue||l.displayValue&&l.displayValue.length<0){o++;continue}if(l.imageUrl){let e=/^[^\s]+\.(jpg|jpeg|png)$/;l.imageUrl.match(e)||(l.imageUrl=l.imageUrl+".png",c=!0,a=!0)}let d=l.imageUrl||(l.iconClass?"fonticon fonticon-lightbulb"==l.iconClass?l.iconClass:"fonticon "+l.iconClass:void 0),u="TYPE"==l.type?"Type : ":"PREDICATE"==l.type?"Attribute : ":"";"USER_TEXT"!=l.type||r||(r=!0),e===i.length-1&&t&&s.push({className:"divider"}),s.push({handler:t=>{t.stopPropagation(),n._pressEnter=!0,n._lastvalue=l.displayValue,n._createFromInput(l.displayValue,l.type,e),T.suggestionSelectionTracker({value:l.displayValue,type:e>0?"SERVER_SUG":l.type})},text:"USER_TEXT"==l.type?P.get("searchFreeText",{freeText:l.displayValue}):l.displayValue,icon:d,type:l.type,value:l.value,id:l.displayValue.replace(" ","_")+"_"+e,category:l.category,selectable:!0,className:c?"brokenLink":"",title:u+l.displayValue})}if(n.clearSugDropDownItems(void 0,s.length),n.createInlineSugDropdown(),n.sugDropdown.addItem(s),a){let e=n.sugDropdown.elements.container.getElements("li.item.brokenLink");for(let t of e){let e=t.getElement("img"),n=e.getAttribute("src");n=n.replace(".png",""),e.setAttribute("src",n)}}let c,l,d=n.sugDropdown.elements.container.querySelectorAll("li.item");if(function(e,t){let n;e&&(n=new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi")),t.forEach((e=>{let t=e.getElement(".item-text");const i=t.innerHTML.replace(n,(e=>`<mark>${e}</mark>`));t.innerHTML=i}))}(t,d),d.length&&d[0].addClassName("js-selected"),n.checkVisibilityOfDropdown())return;null!==n._selectedChip&&(c=n._selectedChip.lineEditor&&n._selectedChip.lineEditor._myInput,l=c),c||(c=x._modalBody.querySelector(".wux-controls-lineEditor-lite")),n.sugDropdown.options.target=l||n._SelectionChipsEditor._lineEditor&&n._SelectionChipsEditor._lineEditor.elements.inputField,n.sugDropdown.options.target&&(n.sugDropdown.updatePosition(),n.sugDropdown.show());let u=c.selectionStart;c.focus(),c&&c.value&&!n.fromBackspace?(o=c.value.length,u<o?c.setSelectionRange(u,u):(u=o,c.setSelectionRange(o,o))):n.fromBackspace&&n.getSelectionChipLineEditorValueLength()>0&&c.select()}),800)))},createInlineSugDropdown:function(e){let t=this;e=e||t._SelectionChipsEditor&&t._SelectionChipsEditor._lineEditor&&t._SelectionChipsEditor._lineEditor.elements.inputField,t.sugDropdown||"guidedSearchExpert"===t._currentSearchMode&&t.activateSearchSuggestionPanel||(t.sugDropdown=new g({target:e,items:[],className:"inlineSuggestionDropdown no-shimmer",closeOnClick:!1,removeOnHide:!1,bound:!0,maxItemsBeforeScroll:9,events:{onClickOutside:function(){t.sugDropdown.hide()}}}),t.sugDropdown.elements.container.addEventListener("keydown",(e=>{let n=e.target,i=e.key;if(("ArrowDown"===i||"ArrowUp"===i)&&n&&n.querySelector("li.js-selected")){let e=n.querySelectorAll("li"),t=0;for(let n=0;n<e.length;n++)if(e[n].hasClassName("js-selected")){t=n;break}e[t].scrollIntoView({behaviour:"smooth",block:"nearest"})}else{let n;n=null!==t._selectedChip?t._selectedChip.lineEditor._myInput:x._modalBody.querySelector(".wux-controls-lineEditor-lite");let i=n.selectionStart;n.focus(),n&&n.value&&(length=n.value.length,i<length?n.setSelectionRange(i,i):(i=length,n.setSelectionRange(length,length))),t._inputEditorkeyup(e)}})))},_buildNotification:function(){let e=x._modalBody.getElement(".smart-queries-editor");D._displayAlert({message:"Your query contains some toxic word. Please correct the word before proceeding further",className:"error toxicity",container:e})},_inputEditoruncommittedChange:function(t){let n=this;if(e.is(n._dropdown)&&(t.stopPropagation(),C.log("SmartQueryController::_inputEditoruncommittedChange"),n._removeAutocomplete(),e.is(t.options)&&e.is(t.options.uncommittedValue))){let i=t.options.uncommittedValue;i=i.trim();let s=i.length;if(e.is(i,"string")){if("nlqSearch"==n._currentSearchMode)return n._apply.hide(),n._DisableSearch(!0),n._previewButton.show(),x._loadNlqExamples(),x._buildexamplesList(),i.length>2?(n.inputDebounceTime&&clearTimeout(n.inputDebounceTime),n.inputDebounceTime=setTimeout((function(){let e=M.isProfane(i);e&&n._buildNotification(),n._previewButton.disabled=e}),500)):n._previewButton.disabled=!0,void(n._clearbutton.disabled=!s);n.createInlineSugDropdown(t.dsModel.elements.inputField),I.hidesuggestionTab({controller:n}),C.log("SmartQueryController::_inputEditoruncommittedChange: ",i),!1===n._compassApp&&(0===s?(0===n._smartQuery.length()?(n._listOfsuggestions=[],n._buildListOfTypes(),n.setStartFullDropdown(),n._DisableSearch(!0)):(n.clearSugDropDownItems(!0),n._buildSuggestion(),n._clearbutton&&(n._clearbutton.disabled=!1)),x.isNLQMode&&"nlqSearch"===n._currentSearchMode&&n._containerNLQBricks&&n._containerNLQBricks.hide(),n.shimmerTimeout&&clearTimeout(n.shimmerTimeout)):(0===n._smartQuery.length()?s>2?n._DisableSearch(!1):n._DisableSearch(!0):n._checkBeforeToLaunchSearch(),s&&n._clearbutton&&(n._clearbutton.disabled=!1,n.clearSugDropDownItems(!0),n.sugDropdown&&!n.sugDropdown.isVisible&&n.sugDropdown.show(),n._SelectionChipsEditor._lineEditor&&n._SelectionChipsEditor._lineEditor.elements.container.hasAttribute("focused")||n.focusEditor(!0),n.populateFromKeyUpSuggestions(i)))),n._buildListOfTypesDone=!1,n._lastvalue=i}else!1===n._buildListOfTypesDone&&(n._listOfsuggestions=[],n._buildListOfTypes(),I.hidesuggestionTab({controller:n}),n.setStartFullDropdown())}},_removeAutocomplete:function(){let t=this;if(t._suggestionTab){e.extendElement(t._suggestionTab.querySelector(".guided-suggest-text")).innerText="",t._suggestionTab.hide()}},_inputEditorkeydown:function(t){let n=this;if(n._backspaceNullInput=!1,e.is(n._dropdown)){if(e.is(t.code)){let e=t.key;if("Backspace"===e||"Delete"===e)0===t.target.value.length&&(n._backspaceNullInput=!0);else if("ArrowDown"===e){if(n.sugDropdown&&n.sugDropdown.isVisible&&n.sugDropdown.elements&&n.sugDropdown.elements.container){n.sugDropdown.show();let e=n.sugDropdown.elements.container,t=e.querySelectorAll("li.js-selected");for(let e=0;e<t.length;e++)t[e].removeClassName("js-selected");var i=new KeyboardEvent("keydown",{key:"ArrowDown",code:"ArrowDown",keyCode:40,charCode:0,which:40,bubbles:!0,cancelable:!0});n.sugDropdown.items&&n.sugDropdown.items.length>7&&e.getChildren()&&e.getChildren().length>0&&(e=e.getChildren()[0]),e.dispatchEvent(i)}}else"Tab"!==e&&"Enter"!==e||!n._currentSearchMode.contains("guidedSearch")||t.preventDefault()}t.stopPropagation()}},_inputEditorkeyup:function(t){let n=this;if(!e.is(n._dropdown))return;n.fromBackspace=!1;n._suggestionTab&&n._suggestionTab.querySelector(".guided-suggest-text")&&n._suggestionTab.querySelector(".guided-suggest-text").getText();n._removeAutocomplete();let i=!1,s=n._listOfsuggestions.length+n._listOfFreesuggestions.length,o=n._SelectionChipsEditor._selectionChips&&n._SelectionChipsEditor._selectionChips._items.length,a=o-1,r=n._SelectionChipsEditor._lineEditor.valueToCommit;if("nlqSearch"==n._currentSearchMode&&(n.nlqInputValueTooltip?n.nlqInputValueTooltip=n.nlqInputValueTooltip.setBody(r):n.nlqInputValueTooltip=n.createNLQInputTooltip(r)),e.is(t.code)){let c=t.key;if(C.log("SmartQueryController::_inputEditorkeyup: ",c),16===t.keyCode)return;if("Enter"===c||n._currentSearchMode.contains("guidedSearch")&&"Tab"===c){if(x.isNLQMode&&"nlqSearch"===n._currentSearchMode&&""!==r)return n.focusEditor(),n._previewButton.disabled=!0,n._clearbutton.disabled=!0,n.loadNLQChipAndResult(r);if(n._currentSearchMode.contains("guidedSearch")){let e=-1;if(t.stopPropagation(),n.sugDropdown){let t=n.sugDropdown.elements.container.querySelectorAll("li.item");for(let n=0;n<t.length;n++)if(t[n].hasClassName("js-selected")||t[n].hasClassName("selected")){e=n;break}if(t.length){if("enter-to-search"==t[0].id&&(e-=1,e<0&&(n._applySearch(),n.removeShortcuts())),e>=0){let t=n._listOfFreesuggestions[e];return void n._createFromInput(t.displayValue,t.type,e)}if("Tab"===c)return}}}if(!0!==n._pressEnter){n._pressEnter=!0;let e=n._lastvalue;if(n.getSmartQueryLength()&&0===e.length&&n._lastIndex<0)return void n._applySearch()}let e,i=n.getsuggestionContainer().querySelector(".hover");if(i&&i.hasClassName("show-more-container"))return void i.dispatchEvent(new Event("click"));i&&(value=i.title,e=i.type),n._createFromInput(value,e,s),n._lastvalue="","Enter"===c&&null===n._selectedChip&&n.focusEditor()}else if("ArrowUp"===c){if(n._lastIndex<1){let e=n.getsuggestionContainer(),t=e.getElement(".suggestion-content.hover"),i=e.getElements(".suggestion-content").indexOf(t);n._lastIndex=i}n._lastIndex--,i=!0,n._lastIndex<0&&n._lastPosIndexInEditor--}else if("ArrowLeft"===c){if(r.length)return;this.clearSugDropDownItems(!0),n._lastIndex--,i=!0,n._lastIndex<0&&n._lastPosIndexInEditor--,n._SelectionChipsEditor.placeholder=""}else if("ArrowDown"===c)i=!0,n._lastIndex++,n._lastIndex<0&&(n._lastPosIndexInEditor++,n._lastPosIndexInEditor<=a&&(n._lastIndex=0));else if("ArrowRight"===c){if(r.length)return;this.clearSugDropDownItems(!0),i=!0,n._lastIndex++,n._lastIndex<=0&&(n._lastPosIndexInEditor++,n._lastPosIndexInEditor<=a&&(n._lastIndex=-1),n._lastPosIndexInEditor>a&&(n._moveEditortoEnd(!0,!0),n._SelectionChipsEditor.placeholder=P.get("GuidedModePlaceholder")))}else if("Escape"===c)n._onEscape(t);else if("Backspace"!==c&&"Delete"!==c||""!==r){if(!(x.isNLQMode&&"nlqSearch"===n._currentSearchMode||"?"!==c||!0!==n._dropdownFull))return x._manageSettingsHelp({helps:!0}),x._SearchDropDownPQs.elements.specialCharactersExpander.getContent().dispatchEvent(new Event("collapse")),void x._SearchDropDownPQs.elements.typeShortcutsExpander.getContent().dispatchEvent(new Event("expand"));n._managecusorEdition()}else{if(n._backspaceNullInput){let t;if("Delete"===c){if(t=n._lastPosIndexInEditor<o?n._lastPosIndexInEditor:null,null===t||-1===n._lastPosIndexInEditor)return}else t=n._lastPosIndexInEditor>0?n._lastPosIndexInEditor-1:-1;if(t>=0&&o>t){e.is(n._selectedChip)&&(t=n._selectedChip.index),n._SelectionChipsEditor._selectionChips.removeChip(t),n._removeQueryAt(t,!0),n.getSelectionChipLineEditorValueLength()>0&&n._SelectionChipsEditor._lineEditor._myInput.select();let i=n._smartQuery.length();o=n._SelectionChipsEditor._selectionChips&&n._SelectionChipsEditor._selectionChips._items.length,i>o&&n._removeQueryAt(i-1,!0),n._selectedChip=null,n._changeChipIndexAfter(t),"Backspace"===c&&n._lastPosIndexInEditor--,I.setMaxToDisplay(),n.fromBackspace=!0,n._buildSuggestion({value:n.getSelectionChipLineEditorValue()}),o=n._SelectionChipsEditor._selectionChips._items.length,o&&(n.buildQuerySearch(),n._lastchip=n._SelectionChipsEditor._selectionChips._items[o-1],n._manageChip(n._lastchip,!1))}(n._lastPosIndexInEditor<0||-1===t||n._lastPosIndexInEditor===o)&&n._moveEditortoEnd(!0,void 0)}o=n._SelectionChipsEditor._selectionChips._items.length,n._currentSearchMode.contains("guidedSearch")&&n._lastPosIndexInEditor>0?n._SelectionChipsEditor.placeholder=P.get("GuidedModePlaceholder"):"nlqSearch"==n._currentSearchMode&&0==n.getSelectionChipLineEditorValueLength()&&(n._SelectionChipsEditor.placeHolder=P.get("NLQModePlaceholder")),0===o&&0==n.getSelectionChipLineEditorValueLength()?(n._checkBeforeToLaunchSearch(),e.is(n._clearbutton)&&(n._clearbutton.disabled=!0),n._bresultFound=!1,n.clean(!1),n._smartQuery._query=[],n._lastselectedIndex=-1,n._lastPosIndexInEditor=-1,I.setMaxToDisplay(n._maxToDisplay),n.setStartFullDropdown(),n._currentSearchMode.contains("guidedSearch")&&(n._SelectionChipsEditor.placeholder=P.get("GuidedModePlaceholder"))):n._checkBeforeToLaunchSearch(),I.hidesuggestionTab({controller:n})}i&&n._currentSearchMode.contains("guidedSearch")&&(n._lastIndex>=0?(n._lastIndex<0&&(n._lastIndex=0),n._lastIndex>=s&&(n._lastIndex=s-1),n._mouveOnIndex()):(n._lastPosIndexInEditor<0?n._lastPosIndexInEditor=0:o===n._lastPosIndexInEditor&&(n._lastPosIndexInEditor=o,n._lastIndex=0,n._mouveOnIndex()),n._mouveOnChipEditor(),I.foundCloseparenthesis(n._lastPosIndexInEditor)))}},_removeQueryAt:function(t,n){let i=this,s="",o=i._smartQuery&&i._smartQuery.removeAt(t);if(e.is(o,"array")&&o.length){s=o[0].displayValue;let t=o[0].data;if(e.is(t,"array")){let n=t.length;for(let i=0;i<n;i++){let n=t[i];e.is(n)&&e.is(n.destroy,"function")&&(n.destroy(),n=null,t[i]=n)}}}if(n){this._lastChipText=s;let e=i._SelectionChipsEditor._selectionChips,t=e&&e.elements.container.getElement(".wux-controls-lastWidget-selectionChips");t&&(t.removeClassName("between"),t.addClassName("edition")),this.setInputValue(s,!0)}},_createFromInput:async function(t,n,i,s){let o=this;if(o.previousChip=null,!e.is(o._dropdown)||!e.is(t))return;if(t.length<1)return;C.log("SmartQueryController::_createFromInput");let a=!1,r=t,c=n,l=s||o._haveSuggestionFrom(n,t,i);e.is(l)?a=!0:(l=o._listOfsuggestions.find(((t,n)=>e.clone(t.displayValue).toLowerCase()===r.toLowerCase()&&n===i)),e.is(l)?a=!0:(l={displayValue:r,type:"USER_TEXT",uri:"",iconClass:"fonticon-pencil",value:t},o._listOfFreesuggestions.push(l),a=!0,c="USER_TEXT")),I.setMaxToDisplay(),I.hidesuggestionTab({controller:o}),!0===a&&e.is(l)?(C.log("SmartQueryController::_createFromInput build founded element: ",l),await o._buildChipAndSuggestion(l.displayValue,c,i,s),x.disbaleANDOperator(!0)):!1===o._inEdition&&(C.log("SmartQueryController::_createFromInput build user text: ",r),o._buildUserFreeText(r)),o._compassApp=!1},_ChipChange:function(t){let n=this;if(!e.is(n._dropdown)||!e.is(n._SelectionChipsEditor))return;t.stopPropagation(),C.groupCollapsed("SmartQueryController::_ChipChange");let i=t.options;if(e.is(i))if(e.is(i.allChipsRemoved)&&!0===i.allChipsRemoved)C.log("SmartQueryController::_ChipChange Remove All"),n.clear();else{let t=i.chips;if(e.is(t)&&t.length){let t=n._SelectionChipsEditor._selectionChips.getNumberOfChips();if(t){C.log("SmartQueryController::_ChipChange index; ",t);let i=n._SelectionChipsEditor._selectionChips._items[t-1];e.is(i)&&(n._smartQuery.removeAt(t-1),n._lastchip=i,n._manageChip(n._lastchip,!1),C.log("SmartQueryController::_ChipChange last chip; ",i),n._buildSuggestion(),n.buildQuerySearch())}else n.clean()}else n.clean()}C.groupEnd()},_onEscape:function(e){this._ChipEditionClose(!0),this._moveEditortoEnd(!0,!0),I.foundCloseparenthesis()},_onclickChange:async function(t){let n=this;if(!e.is(n._dropdown)||!e.is(n._SelectionChipsEditor)||!0===n._inEdition)return;if(e.is(t)&&e.is(t.stopPropagation,"function")&&t.stopPropagation(),C.log("SmartQueryController::_onclickChange"),!0===t.target.className.contains("wux-spinbox-input"))return;let i=e.is(t)&&e.is(t.dsModel)?t.dsModel:n._SelectionChipsEditor._selectionChips;if(e.is(i)){let s=i.getSelectedChipsOptions();if(e.is(s)){let o=s[0];if(e.is(o))if(n.previousChip&&(await n._createFromInput(n.previousChip.label,n.previousChip.suggestion.type,void 0,n.previousChip.suggestion),n.previousChip=null),n._lastselectedIndex=o.index,C.log("SmartQueryController::_onclickChange selectedindex: ",n._lastselectedIndex),e.is(n._selectedChip)&&n._selectedChip.index===n._lastselectedIndex){let e=t.currentTarget.parentNode,s=i&&i.elements.container.getElement(".wux-controls-lastWidget-selectionChips");e.insertBefore(s,t.currentTarget.nextSibling),n._lastPosIndexInEditor=n._lastselectedIndex,C.log("SmartQueryController::_onclickChange Enter to edition"),n._selectedChip=null,n.previousChip=o,n._SelectionChipsEditor._selectionChips.removeChip(n._lastselectedIndex),n._removeQueryAt(n._lastselectedIndex,!0),n.getSelectionChipLineEditorValueLength()>0&&n._SelectionChipsEditor._lineEditor._myInput.select(),n.fromBackspace=!0,n._changeChipIndexAfter(n._lastselectedIndex);n._lastselectedIndex;n._buildSuggestion({value:n.getSelectionChipLineEditorValue()});let a=n._SelectionChipsEditor._selectionChips._items.length;a&&(n.buildQuerySearch(),n._lastchip=n._SelectionChipsEditor._selectionChips._items[a-1],n._manageChip(n._lastchip,!1))}else C.log("SmartQueryController::_onclickChange select"),n._selectedChip=null,n._selectedChip=o,setTimeout((function(){n.focusEditor()}),100)}}},_buildChipEdition:function(){let t=this;if(!e.is(t._dropdown)||!e.is(t._selectedChip)||e.is(t._selectedChip.lineEditor))return;C.log("SmartQueryController::_buildChipEdition");let n=t._selectedChip.index,i=t._SelectionChipsEditor._selectionChips._items.length;if(n>=0&&n<i){let i=t._SelectionChipsEditor._selectionChips._items[n];if(e.is(i)&&e.is(i.associatedChipCellView)&&e.is(i.associatedChipCellView.childNodes)){let n,s=i.associatedChipCellView.childNodes.length;for(let e=0;e<s&&(n=i.associatedChipCellView.childNodes[e],"wux-chip-cell-label"!==n.className);e++);if(e.is(n)){let s=n.getDimensions();n.setStyle("display","none"),t._selectedChip.labelUx=n;let o=new u({value:t._selectedChip.label,selectAllOnFocus:!0,placeholder:t._selectedChip.label});o.touchMode=!1,C.log("SmartQueryController::_buildChipEdition build WUXLineEditor"),i.associatedChipCellView.insertBefore(o.getContent(),n),o.getContent().setStyle("width",s.width+"px"),t._selectedChip.lineEditor=o,t._selectedChip.lineEditor=o,t._selectedChip.lineEditor._myInput.focus();let a=t._selectedChip.lineEditor._myInput.value;if(t._selectedChip.lineEditor._myInput.value=" ",t._selectedChip.lineEditor._myInput.value=a,o.addEventListener("uncommittedChange",t._inputEditoruncommittedChange.bind(t)),o.addEventListener("keyup",t._inputEditorkeyup.bind(t)),o.addEventListener("keydown",t._inputEditorkeydown.bind(t)),e.is(t._selectedChip.suggestion.data)){let e={chip:i,readOnly:!1};I.manageTweaker(e)}}}}},getSelectionChipLineEditorValue:function(){return this._SelectionChipsEditor&&this._SelectionChipsEditor._lineEditor&&this._SelectionChipsEditor._lineEditor.valueToCommit.trim()},getSelectionChipLineEditorValueLength:function(){let e=0;return this.getSelectionChipLineEditorValue&&(e=this.getSelectionChipLineEditorValue().length),e},getSmartQueryLength:function(){let e=0;return this._smartQuery&&this._smartQuery._query&&this._smartQuery._query.length>0&&(e=this._smartQuery._query.length),e},_ChipEditionClose:function(t){let n=this;if(e.is(n._dropdown)){if(C.log("SmartQueryController::_ChipEditionClose"),e.is(n._lastchip)&&e.is(n._lastchip.chipOptions)&&e.is(t)){let e={chip:n._lastchip,readOnly:!0};I.manageTweaker(e)}n._checkBeforeToLaunchSearch(),e.is(n._selectedChip)&&e.is(n._selectedChip.lineEditor)&&(n._inEditionEnter=!1,n._inEdition=!1,n._pressEnter=!1,n._selectedChip.labelUx.setStyle("display","inline-block"),n._selectedChip.lineEditor.removeEventListener("uncommittedChange",n._inputEditoruncommittedChange.bind(n)),n._selectedChip.lineEditor.removeEventListener("keydown",n._inputEditoruncommittedChange.bind(n)),e.is(n._selectedChip.lineEditor.destroy,"function")&&n._selectedChip.lineEditor.destroy(),n._selectedChip.lineEditor=null,C.log("SmartQueryController::_ChipEditionClose delete lineEditor"))}},populateFromKeyUpSuggestions:function(t){let n=this;if(!e.is(n._dropdown))return;if("nlqSearch"===n._currentSearchMode)return;C.log("SmartQueryController::populateFromKeyUpSuggestions value: ",t);let i=n._SelectionChipsEditor._selectionChips&&n._SelectionChipsEditor._selectionChips._items.length;t&&t.length>0||i>0?I.setMaxToDisplay():I.setMaxToDisplay(n._maxToDisplay),n._populateFromKeyUpSuggestionsTimeout&&clearTimeout(n._populateFromKeyUpSuggestionsTimeout),n._populateFromKeyUpSuggestionsTimeout=setTimeout((function(){n.computeSmartQuery({value:t}).then((function(){if(0===n._smartQuery.length()){0==t.length&&n.setStartFullDropdown()}}))}),100)},buildNLQChipsAndQuery:function(e,t){let n=[];t&&(n=t),this._containerNLQBricks&&this._containerNLQBricks.show();let i=[];n.forEach(((e,t)=>{let n={object:e,controller:this,index:t,buildTweaker:!0};i.push(I.buildChipFromModel(n,t))})),x.buildNLQQuery(i),this.buildQuerySearch(e)},focusEditor:function(t){let n=this;if(!e.is(n._SelectionChipsEditor)||x._modalBody.closest(".helps-settings"))return;n._SelectionChipsEditor._lineEditor.focus(),f.getOption("search_web_in_win")&&(this._SelectionChipsEditor.touchMode=!0);let i=n.getSelectionChipLineEditorValue();if(!n.fromBackspace){let e=i,s=n._SelectionChipsEditor._lineEditor&&n._SelectionChipsEditor._lineEditor._myInput,o=s.selectionStart;t||(n._SelectionChipsEditor._lineEditor.value="",n._SelectionChipsEditor._lineEditor.value=e,"nlqSearch"==n._currentSearchMode&&n.nlqInputValueTooltip?n.nlqInputValueTooltip.elements.body.innerText!=e&&(n.nlqInputValueTooltip=n.nlqInputValueTooltip.setBody(i)):n.nlqInputValueTooltip&&(n.nlqInputValueTooltip=n.nlqInputValueTooltip.destroy())),0!=o?s.setSelectionRange(o,o):(length=s.value.length,s.setSelectionRange(length,length))}if(!t){if(n._currentSearchMode.contains("guidedSearch")){let e={value:i};(i||n._smartQuery.length())&&this._dropdown.isDropDownVisible()&&(n.sugDropdown||n.createInlineSugDropdown(),n.clearSugDropDownItems(!0),n.sugDropdown&&!n.sugDropdown.isVisible&&n.sugDropdown.show(),n._buildSuggestion(e))}i&&(n._clearbutton.disabled=!1,i.length>2&&(n._previewButton.disabled=!1))}},_populateSuggestions:function(t,n,i){let s=this;if(!e.is(s._dropdown))return;for(let e=0;e<s.sections.length;e++)s["_"+s.sections[e]+"Container"]=null;s._appsContainer=null,s._freeContainer=null,i=e.is(i)?i:e.is(n)&&n.length>0?void 0:!(s._smartQuery.length()>0)||void 0,i=!s._isIncontextBuilderMode&&i;let o={dropdown:s._dropdown,value:n,controller:s,historyOnly:i,container:s._containersuggestion?s._containersuggestion:s._dropdown.elements.customSuggestions,mode:s._currentSearchMode};I.displaySections(o);let a=s.getSelectionChipLineEditorValue();s._currentSearchMode.contains("guidedSearch")&&a&&a.length>=2&&!s._isIncontextBuilderMode&&s.sugDropdownLoading(s._listOfFreesuggestions,n)},_buildChip:function(t,n,i,s){let a=this;return a.destroySugDropdown(),new o((function(o,r){C.log("****** SmartQueryController::_buildChip: ",t),e.is(t)&&e.is(a._SelectionChipsEditor)||r(),null===a._selectedChip&&a._manageChip(a._lastchip);let c=s||a._haveSuggestionFrom(n,t,i);if(c||"USER_TEXT"!==n||(c={displayValue:t,type:"USER_TEXT",value:t}),e.is(c)){c.onSelectUpdateTo&&(c.displayValue=c.onSelectUpdateTo);let t=c.type.toLowerCase(),n=a._lastPosIndexInEditor>0?a._lastPosIndexInEditor:0;if(e.is(t)){let i,s=c;if("history"===t&&(c.type="USER_TEXT"),null!==a._selectedChip&&!0===a._inEdition&&(n=a._selectedChip.index,a._SelectionChipsEditor._selectionChips.removeChip(n)),C.log("SmartQueryController::_buildChip: index: ",n),x.isNLQMode&&"nlqSearch"===a._currentSearchMode?o(c):(i=I.buildChipFromModel({chipsEditor:a._SelectionChipsEditor,object:s,controller:a},n),a._removeAutocomplete(),a._lastPosIndexInEditor=n+1,a._lastvalue="",a._SelectionChipsEditor._lineEditor.value="",a._SelectionChipsEditor._lineEditor.valueToCommit="",a._tosave=!0),a._changeChipIndexAfter(a._lastPosIndexInEditor),e.is(i)&&e.is(i.associatedChipCellView)){let t;e.is(a._selectedChip)&&e.is(a._selectedChip.suggestion.data)&&(t=a._selectedChip.suggestion.data);let r={suggestion:s,container:i.associatedChipCellView,datevalue:t,controller:a,chip:i,onUpdateData:function(t){e.is(t)?c.data=t:a._addAfterEditor(a._lastPosIndexInEditor),o(c)}};I.buildTweaker(r),null===a._selectedChip?(a._manageChip(i,!1),a._lastchip=i):(C.log("SmartQueryController::_buildChip: EDITION REPLACE index: ",n),C.log("SmartQueryController::_buildChip: EDITION REPLACE suggestion: ",s),a._removeQueryAt(n),a._smartQuery.spliceAt(n,s),a._lastchip=i);I.foundCloseparenthesis(i,!0);a._checkBeforeToLaunchSearch(),e.is(a._clearbutton)&&(a._clearbutton.disabled=!1)}}}else c=a._listOfAppssuggestions.find((e=>e.displayValue===t)),e.is(c)&&a._dropdown._onClickApp({currentTarget:{id:c.appInfos.id}}),r()}))},_addAfterEditor:function(t,n){C.log("SmartQueryController::_addAfterEditor index: ",t);let i=this;if(!e.is(i._SelectionChipsEditor)||!e.is(i._SelectionChipsEditor._selectionChips))return;let s=i._SelectionChipsEditor._selectionChips;if(t>(s&&s._items&&s._items.length-1))return i._moveEditortoEnd(n),void C.log("SmartQueryController::_addAfterEditor _moveEditortoEnd");let o=s&&s._items[t];if(e.is(o)){let t=o.associatedChipCellView,a=t&&t.getParent(),r=s&&s.elements.container.getElement(".wux-controls-lastWidget-selectionChips");r&&(r.removeClassName("between"),r.hasClassName("edition")||r.addClassName("between"),a.insertBefore(r,t)),e.is(n)&&!0===n&&(C.log("SmartQueryController::_addAfterEditor _buildSuggestion"),i._buildSuggestion()),setTimeout((function(){i.focusEditor()}),100)}},_changeChipIndexAfter:function(t){C.log("SmartQueryController::_changeChipIndexAfter index: ",t);let n=this;if(!e.is(n._SelectionChipsEditor)||!e.is(n._SelectionChipsEditor._selectionChips))return;let i=n._SelectionChipsEditor._selectionChips;if(e.is(i)){let n=i._items.length;for(;t<n;t++){let n=i._items[t];e.is(n)&&e.is(n.chipOptions)&&(n.chipOptions.index=t)}}},_moveEditortoEnd:function(t,n,i){C.log("SmartQueryController::_moveEditortoEnd");let s=this;if(!e.is(s._SelectionChipsEditor)||!e.is(s._SelectionChipsEditor._selectionChips))return;let o=s._SelectionChipsEditor._selectionChips;e.is(n)&&!0===n&&(o&&o.unselectAllChips(),s._selectedChip=null);let a=o&&o.elements.container.getElement(".wux-controls-lastWidget-selectionChips");a&&(a.removeClassName("between"),a.removeClassName("edition"));let r=o&&o._items;if(e.is(r)&&r.length){let n=r[r.length-1].associatedChipCellView;(n&&n.getParent()).insertBefore(a,n.nextSibling),s._lastPosIndexInEditor=r.length,e.is(t)&&!0===t&&s._buildSuggestion({value:s.getSelectionChipLineEditorValue()}),setTimeout((function(){i||s.focusEditor()}),100)}else s._lastPosIndexInEditor=-1},_managecusorEdition:function(){C.log("SmartQueryController::_managecusorEdition");let t=this;if(!e.is(t._SelectionChipsEditor)||!e.is(t._SelectionChipsEditor._selectionChips))return;let n=t._SelectionChipsEditor._selectionChips,i=n&&n._items&&n._items.length-1;if(t._lastPosIndexInEditor<=i){let e=n&&n.elements.container.getElement(".wux-controls-lastWidget-selectionChips");if(e){e.className.indexOf("between")>0&&(e.removeClassName("between"),e.addClassName("edition"))}}I.foundCloseparenthesis()},_buildChipAndSuggestion:async function(t,n,i,s){C.log("SmartQueryController::_buildChipAndSuggestion: ",t);let o=this;I.hidesuggestionTab({controller:o});let a=await o._buildChip(t,n,i,s);null===o._selectedChip&&e.is(t)&&t.length>0?o.onSetSuggestion(t,a):(o._ChipEditionClose(),o._selectedChip=null,o._buildSuggestion(),o.focusEditor()),!1===o._compassApp&&"Date"!==a.displayValue&&o.buildQuerySearch(),o._compassApp=!1},_buildUserFreeText:function(t,n){C.log("SmartQueryController::_buildUserFreeText: ",t);let i={displayValue:t,type:e.is(n)?n:"USER_TEXT",uri:"",iconClass:"fonticon-pencil",value:t};this._listOfsuggestions.push(i),this._buildChipAndSuggestion(t,n)},_manageChip:function(t,n=!0){if(!e.is(t))return;e.is(t.associatedChipCellView),this._updateUI()},_updateUI:function(t){let n=this,i=e.is(n._container)?n._container:n._containerinput;if(!e.is(i))return;let s=i.getDimensions();if(e.is(n._containerresult));else{let i=s.height+5,o=n._container.getParent().getChildren(),a=o.length,r="calc(100% - "+i+"px)";if(e.is(t))for(let e=1;e<a;e++)o[e].style.removeProperty("height");else for(let e=1;e<a;e++)o[e].setStyle("height",r)}},_applySearch:function(){let t=this;if(C.log("SmartQueryController::_applySearch"),!e.is(t._dropdown)||!e.is(t._smartQuery))return;t.destroySugDropdown();let n=t._SelectionChipsEditor._lineEditor.valueToCommit;if(t._freeTextToBrickPromise=o.deferred(),t._lastvalue&&t._lastvalue.length&&t._currentSearchMode.contains("guidedSearch")){let e=t._lastvalue,n="USER_TEXT";t._buildChip(e,n).then((n=>{t.onSetSuggestion(e,n),t._freeTextToBrickPromise.resolve()}),(function(){t._freeTextToBrickPromise.resolve()}))}else t._freeTextToBrickPromise.resolve();if(!0===t._isIncontextBuilderMode)return t._incontextBuilderModePrecond=void 0,t._freeTextToBrickPromise.promise.then((function(){let e={smartQuery:t._smartQuery,onComplete:function(e){r.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"IncontextBuilderEnd",data:{selected_query:e,queryJson:t._smartQuery.getQueryJson(),selected_command:"OK"}})}};I.buildQuerySearch(e),x.resetIncontextMode()})),void(t._isIncontextBuilderMode=!1);let i=!0,s=t._smartQuery.length();if(s){let n=t._smartQuery.getAt[s-1];if(e.is(n)){let t=n.type,s=n.appInfos;"USER_TEXT"===t&&e.is(s)&&(i=!1)}}!0===i&&(x.modalVisibility(!1),t._dropdown&&t._dropdown.onBlur(void 0,!0),t._freeTextToBrickPromise.promise.then((function(){let e={smartQuery:t._smartQuery,onComplete:function(e){let i="";t._currentSearchMode.contains("guidedSearch")?i=k.get("search.fromsearchResults.title"):"nlqSearch"===t._currentSearchMode&&(i=k.get("search.nlqsearchResults.title")),a.dispatch("onViewSearch",[{displayString:i,query:e,fromsmartSearch:!0,inputSearchString:n}]),!0===t._dropdown.webInwin&&t._dropdown.eventManager&&t._dropdown.eventManager.dispatchEvent("onViewSearch",{displayString:i,query:e,fromsmartSearch:!0}),T.searchTracker(t._smartQuery.length()),setTimeout((function(){t._currentSearchMode.contains("guidedSearch")?(t._dropdown&&t._dropdown.setInputValue(""),t._dropdown&&t._dropdown.setPlaceHolderValue(k.get("search.fromsearchResults.title")),t._refreshSearchResults(e,void 0)):"nlqSearch"===t._currentSearchMode?t._dropdown&&t._dropdown.setPlaceHolderValue(k.get("search.nlqsearchResults.title")):t._dropdown&&t._dropdown.setInputValue(t._lastvalue),t._dropdown.enableTopBarField()}),1e3)}};I.buildQuerySearch(e)}))),!0===t._dropdown.webInwin&&t._dropdown.eventManager.dispatchEvent("onGuidedMode",!1)},_save:function(){let e=this;if(C.log("SmartQueryController::_save"),!0===e._isIncontextBuilderMode)return e._incontextBuilderModePrecond=void 0,r.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"IncontextBuilderEnd",data:{selected_command:"CANCEL"}}),e._isIncontextBuilderMode=!1,void x.resetIncontextMode()},buildQuerySearch:function(t){let n=this;if(!0===n._checkBeforeToLaunchSearch()||n._isIncontextBuilderMode||x.isNLQMode&&"nlqSearch"===n._currentSearchMode){if(C.log("SmartQueryController::buildQuerySearch"),!e.is(n._dropdown)||!e.is(n._smartQuery))return;n._dropdown.switchActiveTab(n._containerresult,null,!0);let i={smartQuery:n._smartQuery,onComplete:function(e){n._incontextBuilderModePrecond&&(e=n._incontextBuilderModePrecond+" AND ("+e+")"),n.queryValue=e,n._refreshSearchResults(e,x.isNLQMode?t:void 0)}};I.buildQuerySearch(i)}},getQueryValueAndStatement:function(){return{statement:this._SelectionChipsEditor&&this._SelectionChipsEditor._lineEditor&&this._SelectionChipsEditor._lineEditor.valueToCommit,queryValue:this.queryValue}},_refreshSearchResults:function(t,n){let i=this;e.is(i._dropdown)&&e.is(i._smartQuery)&&(x.hideAllContainer(),this._containerinstantSearchEmptyView&&this._containerinstantSearchEmptyView.hide(),clearTimeout(i._dropdown._categorySuggestTimeout),i._dropdown._categorySuggestTimeout=setTimeout((function(){C.log("SmartQueryController::_refreshSearchResults");let e=5;!0===i._dropdownFull&&(e=10);let s=i._SelectionChipsEditor._lineEditor.valueToCommit;i._dropdown.switchActiveTab(i._containerresult,null,!0),i.nlqLRU(s,t);let o={container:i._containerresult,dropdown:i._dropdown,srcRessource:i._dropdown._srcRessource,webInwin:i._dropdown.webInwin,eventManager:i._dropdown.eventManager,query:t,nlq:n,count:e,noresult:()=>{i._dropdown.switchActiveTab(i._containerInstantSearchTab,null,!0),i._containerinstantSearchEmptyView&&i._containerinstantSearchEmptyView.show(),i._containerinstantSearchEmptyView&&i._containerinstantSearchEmptyView.getElement(".nlq-bricks-container")&&i._containerinstantSearchEmptyView.getElement(".nlq-bricks-container").empty(),i._dropdown.elements.guidedSamples.addClassName("hide"),"nlqSearch"==i._currentSearchMode&&i._containerinstantSearchEmptyView&&i._containerinstantSearchEmptyView.getElement(".nlq-bricks-container")&&x.nlqBrickContainer.inject(i._containerinstantSearchEmptyView.getElement(".nlq-bricks-container"))},onclickViewAll:()=>{i._applySearch()}};if(x.buildguidedContent(o,n),"nlqSearch"==i._currentSearchMode&&(i._previewButton&&i._previewButton.hide(),i._DisableSearch(!1),i._apply&&i._apply.show(),i._clearbutton&&(i._clearbutton.disabled=!1),f.getOption("NLQFeedback"))){let e=document.querySelector("#nlqFeedback .fonticon-thumbs-up");e&&e.removeClassName("disable-button")}}),100))},_mouveOnElement:function(t,n=0){let i=this;if(!e.is(i._dropdown))return;let s=i.getsuggestionContainer().querySelectorAll(".suggestion-content");for(const e of s)e.removeClassName("hover");let o=s[n];if(e.is(o)){let e,t;o.addClassName("hover"),e=o.title,t=o.type,i._lastIndex++,o.trueDisplayValue&&(e=o.trueDisplayValue),i._completesuggestionTab(i._lastvalue,e);let n=i._lastIndex+1,a=s.length;for(;n<a;n++){let i=s[n];if(i.title===e&&i.type===t){i.addClassName("hover");break}}}},_mouveOnIndex:function(){let t=this;if(!e.is(t._dropdown))return;let n=t.getsuggestionContainer(),i=0;for(const e of n.querySelectorAll(".suggestion-content"))e.removeClassName("hover"),i++;t._lastIndex>=i&&(t._lastIndex=i-1);let s,o,a=0;for(const e of n.querySelectorAll(".suggestion-content")){if(a===t._lastIndex){e.addClassName("hover"),e.scrollIntoView(!1),o=e.title,s=e.type,e.trueDisplayValue&&(o=e.trueDisplayValue);break}a++}t._completesuggestionTab(t._lastvalue,o),t._currentsuggestion=t._haveSuggestionFrom(s,o)},_mouveOnChipEditor:function(){let t=this;e.is(t._SelectionChipsEditor)&&e.is(t._SelectionChipsEditor._selectionChips)&&t._lastPosIndexInEditor>=0&&t._addAfterEditor(t._lastPosIndexInEditor,!0)},_speech:function(){let t=this;if(null===t._speechRecognition){let n=function(e){C.log("SmartQueryController::onend: ",e),t._contentSpeech.removeClassName("record"),t._speechstart=0,E.stop()},i=function(e){C.log("SmartQueryController::onnomatch: ",e),t._contentSpeech.removeClassName("record"),t._speechstart=0,E.stop()},s=function(e){C.log("SmartQueryController::onerror: ",e),t._contentSpeech.removeClassName("record"),t._speechstart=0,E.stop()},o=function(n){let i=n.results[0][0].transcript;if(e.is(i,"string")&&i.length>=0){C.log("SmartQueryController::_speech: ",i);i.split(" ");t._SelectionChipsEditor._lineEditor.value=i}};E.build(o,n,i,s),t._speechRecognition=E.getspeechRecognition()}t._contentSpeech.removeClassName("record"),0===t._speechstart?(E.start(),t._speechstart=1,t._contentSpeech.addClassName("record")):(E.stop(),t._speechstart=0)},_displayApp:function(e){this._father&&this._father._displayApp(e)},_statusOK:function(){},_statusKO:function(){},_checkToEnableDisableSearch:function(t){let n=this;if(!e.is(n._apply))return;let i=e.is(t)?t:I.foundCloseparenthesis(void 0,!0);e.is(i)&&!0===i?n._DisableSearch(!1):n._DisableSearch(!0)},_DisableSearch:function(t){let n=this,i=t;e.is(n._apply)&&(n._apply.disabled=i,n._savebutton&&(0!==n._smartQuery.length()&&!1!==n._tosave||(i=!0),!1===n._tosave&&(i=!0)),n._isIncontextBuilderMode&&n._clearbutton&&n._savebutton?(n._ok.disabled=i,n._savebutton.disabled=!1,n._clearbutton.disabled=!1):n._savebutton&&(n._savebutton.disabled=i))},_checkBeforeToLaunchSearch:function(){let t=this,n=!1;return e.is(t._smartQuery)&&0!==t._smartQuery.length()?(n=t._smartQuery.check(),n?t._DisableSearch(!1):t._DisableSearch(!0),n):n},_checkresults:function(t){let n=this;!e.is(n._contentStatus)&&!e.is(t)||e.is(t.results)?n._statusOK():e.is(t.infos)&&e.is(t.infos.nresults)&&0===t.infos.nresults&&n._containerinstantSearchEmptyView&&n._containerinstantSearchEmptyView.show()},setInputValue:function(t){e.is(this._SelectionChipsEditor)&&(this._SelectionChipsEditor._lineEditor.value=t,this._SelectionChipsEditor._lineEditor.valueToCommit=t,t&&(this._clearbutton.disabled=!1),this.focusEditor())},setStartFullDropdown:function(){!1===this._isIncontextBuilderMode&&(x.hideAllContainer(),x.showguidedContainer())},_haveSuggestionFrom:function(t,n,i){let s,o=this;function a(e,t,n){return e.find((function(e,s){return e&&e.displayValue===n&&e.type===t&&s===i}))}if(s=a(o._listOfFreesuggestions,t,n),!e.is(s)&&(s=a(o._historyList,t,n),!e.is(s)))for(let e=0;e<o.sections.length&&(s=a(o["_"+o.sections[e]+"List"],t,n),!s);e++);return s},hideHistory:function(e){this._histories&&this._histories.hide()},refreshTweakerToReadonly:function(e){let t=this;t._SelectionChipsEditor._selectionChips&&t._SelectionChipsEditor._selectionChips.unselectAllChips(),t._mouveOnChipEditor(),t._inEdition=!1,t._inEditionEnter=!1},addGuidedFromModel:function(t){let n=this;e.is(t)&&(n._buildTweaker=!0,n._smartQuery._query=t,n.clean(),n._refreshSuggestion(),t&&t.length&&(n.buildQuerySearch(),n.focusEditor()),n._buildTweaker=!1)},_completesuggestionTab:function(e,t){!this._inEdition&&I.completesuggestionTab({controller:this,value:e,highLight:t})},setInContextBuilderMode:function(t){let n=this;t&&t.suggestions?(n._currentSearchMode="guidedSearchExpert",n._dropdown.elements.searchTabContainer.classList.add("incontext-builder-mode"),n._dropdown.elements.searchTabContainer.classList.remove("nlq-mode"),n._dropdown.elements.searchTabContainer.classList.add("guided-mode"),x.showguidedContainer(),n._incontxtToggle=!0,n._isIncontextBuilderMode=!0,n._smartQuery&&n._smartQuery._query&&n._smartQuery._query.length&&(n._lastSearchQuery=n._smartQuery._query,n._lastSearchPlaceHolder=n._lastvalue?n._lastvalue:""),n.clean(),n._smartQuery&&e.is(n._smartQuery.destroy,"function")&&n._smartQuery.destroy(),n._smartQuery=new S(t),n._refreshSuggestion(),n._ok||(n._ok=new h({label:A.get("OKButton"),domId:"ok",icon:{iconName:"search",fontIconFamily:WUXManagedFontIcons.Font3DS},touchMode:!0,disabled:!0,emphasize:"primary",onClick:function(e){n._applySearch(),n.removeShortcuts()}}).inject(n._dropdown.elements.inContextActions),n._apply.getContent().setAttribute("style","--key: 'O'"),w.tooltip(n._apply,{title:v.escapeHtml(k.get("smart.incontext.ok")),position:"bottom",reshowDelay:1,mouseRelativePosition:!0})),n._savebutton||(n._savebutton=new h({label:A.get("CancelButton"),domId:"cancel",touchMode:!0,emphasize:"primary",disabled:!1,onClick:function(e){n._save(),n.removeShortcuts()}.bind(n)}).inject(n._dropdown.elements.inContextActions),n._savebutton.getContent().setAttribute("style","--key: 'X'"),w.tooltip(n._savebutton,{title:v.escapeHtml(k.get("smart.incontext.exit")),position:"bottom",reshowDelay:1,mouseRelativePosition:!0})),n._dropdown.elements.inContextActions.show(),x.setIncontextMode(),t.precond&&t.precond.length&&(n._incontextBuilderModePrecond=t.precond,n._refreshSearchResults(t.precond))):(x._currentSearchMode=b.getItem("searchMode"),n._dropdown.elements.inContextActions.hide(),n._dropdown.elements.searchTabContainer.classList.remove("incontext-builder-mode"),n._currentSearchMode=b.getItem("searchMode"),n._currentSearchMode.contains("guidedSearch")?x.showguidedContainer():n._currentSearchMode.contains("nlqSearch")?(n._dropdown.elements.searchTabContainer.classList.add("nlq-mode"),n._dropdown.elements.searchTabContainer.classList.remove("guided-mode")):n._dropdown.elements.searchTabContainer.classList.remove("guided-mode"),n._incontxtToggle=void 0,n._dropdown.elements.tabContainer.show())},removeShortcuts:function(){let t=this,n=x.getModalBody().getParent();t._clearbutton&&t._clearbutton.getContent().removeClassName("AltKeys"),t._previewButton&&t._previewButton.getContent().removeClassName("AltKeys"),t._apply&&t._apply.getContent().removeClassName("AltKeys"),t._savebutton&&t._savebutton.getContent().removeClassName("AltKeys"),t._ok&&t._ok.getContent().removeClassName("AltKeys"),e.extendElement(n.getParent().querySelector("#pqsDropdown")).removeClassName("AltKeys"),e.extendElement(n.getParent().querySelector("#settingsDropdown")).removeClassName("AltKeys");for(var i=0;i<n.querySelectorAll(".AltNumber").length;i++)n.querySelectorAll(".AltNumber")[i].removeClassName("AltKeys");x.setAltKeyStatus(!1)},_manageSuggestTab:function(){let e=this;e._currentSearchMode.contains("guidedSearch")?I.addsuggestionTab({controller:e,container:e._SelectionChipsEditor._lineEditor.getContent()}):(e._removeAutocomplete(),e.focusEditor())},getsuggestionContainer:function(){let t=this,n=t._containersuggestion?t._containersuggestion:t._dropdown.elements.customSuggestions;return e.is(t._popinMode)&&!0===t._popinMode&&(n=t._popinContainer),n},destroy:function(){return this.destroySugDropdown(),this._SelectionChipsEditor&&this._SelectionChipsEditor._getElementToFocus().removeEventListener("focus",this._clickOnChipsEditor.bind(this)),this._SelectionChipsEditor&&this._SelectionChipsEditor.removeEventListener("click",this.focusEditor.bind(this)),this._SelectionChipsEditor&&this._SelectionChipsEditor.removeEventListener("onPostRemove",this._ChipChange.bind(this)),this._SelectionChipsEditor&&this._SelectionChipsEditor._lineEditor.removeEventListener("uncommittedChange",this._inputEditoruncommittedChange.bind(this)),this._SelectionChipsEditor&&this._SelectionChipsEditor._lineEditor.removeEventListener("change",this._inputEditorchange.bind(this)),this._SelectionChipsEditor&&this._SelectionChipsEditor._selectionChips.removeEventListener("click",this._clickOnSelectionChipsDiv.bind(this)),this._SelectionChipsEditor&&e.is(this._SelectionChipsEditor.destroy,"function")&&this._SelectionChipsEditor.destroy(),this._smartQuery&&e.is(this._smartQuery.destroy,"function")&&this._smartQuery.destroy(),this._listOfSelection=[],this._parent()},_clickOnSelectionChipsDiv:function(t){let n=this;const i=t.currentTarget;this.doubleClick?(clearTimeout(this.doubleClick),n.doubleClick=null,t&&t.stopPropagation()):n.doubleClick=setTimeout((async()=>{if(n.doubleClick=null,n._currentSearchMode.contains("guidedSearch")){const s=i.getElements("div[draggable]");if(t.target&&("wux-chip-cell-label"==t.target.className||t.target.hasClassName("wux-controls-datepicker-button")||t.target.hasClassName("wux-chip-cell-container search-type wux-ui-state-prehighlighted wux-ui-state-highlighted")||t.target.hasClassName("wux-ui-state-undefined wux-controls-lineEditor-lite")||t.target.getParent()&&t.target.getParent().hasClassName("wux-controls-datepicker-button")))return;let o=document.querySelector("div.wux-controls-lastWidget-selectionChips> div > input");if((o?o.value:"").length>0&&n.previousChip){let e=n.previousChip;e&&(await n._createFromInput(e.label,e.suggestion.type,void 0,e.suggestion),n.previousChip=null)}if(0===s.length)return void(n.getSelectionChipLineEditorValue()||n.focusEditor());const a=s[0].getBoundingClientRect(),r=s[s.length-1].getBoundingClientRect(),c=t.clientY;if(c<a.top||c>r.bottom)return void n.focusEditor();if(!e.is(n._SelectionChipsEditor)||!e.is(n._SelectionChipsEditor._selectionChips))return;let l=n._SelectionChipsEditor._selectionChips,d=l&&l.elements.container.getElement(".wux-controls-lastWidget-selectionChips");d&&(d.removeClassName("between"),d.addClassName("between"));const u=i.getBoundingClientRect(),h=t.clientX-u.left,p=t.clientY-u.top;for(let e=0;e<s.length;e++){const t=s[e].getBoundingClientRect();if(p<t.bottom-u.top&&h<t.left-u.left)return i.insertBefore(d,s[e]),n._lastPosIndexInEditor=e,n._buildSuggestion(),void(n._SelectionChipsEditor.placeholder="")}n._lastPosIndexInEditor=s.length,t.target.matches("input")?d&&d.removeClassName("between"):(n._moveEditortoEnd(!0,null,!0),i.appendChild(d)),n._SelectionChipsEditor.placeholder=P.get("GuidedModePlaceholder")}else"nlqSearch"!==n._currentSearchMode&&(n.selectionStart=n._SelectionChipsEditor._lineEditor._myInput.selectionStart,n.focusEditor())}),200)},clear:function(){let e=this;e._SelectionChipsEditor._selectionChips.removeAllChips(),e.clean(),e._isIncontextBuilderMode?(e.addGuidedFromModel([]),e._containerresult.hide()):(e.addGuidedFromModel([]),e.setPlaceHolder()),e._clearbutton.disabled=!0,e.removeShortcuts()},toggleGuidedMode:function(t){let n=this;n._smartQuery&&e.is(n._smartQuery.destroy,"function")&&n._smartQuery.destroy(),n._smartQuery=new S("guidedSearchIntermediate"===t?{liteMode:!0}:n.inContextOptions)},setCurrentSearchMode:function(e){this._currentSearchMode=e},destroySmartQuery:function(){I.hidesuggestionTab({controller:this}),this._smartQuery&&(this._smartQuery._query=[]),this.destroySugDropdown(),this.clean(!1)},setPlaceHolder:function(){x.isNLQMode&&"nlqSearch"===this._currentSearchMode?(this._SelectionChipsEditor.placeholder=P.get("NLQModePlaceholder"),this._dropdown.setPlaceHolderValue(k.get("search.nlqsearchResults.title"))):this._currentSearchMode&&this._currentSearchMode.contains("guidedSearch")?(this._SelectionChipsEditor.placeholder=P.get("GuidedModePlaceholder"),this._dropdown.setPlaceHolderValue(k.get("search.fromsearchResults.title"))):this._dropdown.setPlaceHolderValue(k.get("smart.mode.apply"))},setSmartQuery:function(e){this.toggleGuidedMode(e)},nlqLRU:function(e,t,n){let i=JSON.parse(N),s=b.getItem("NLQUserQuery")||[];if("deleteAll"===n&&(s=[]),f.getOption("NLQMode")&&"nlqSearch"===this._currentSearchMode&&!i[e]){let i=-1,o=e&&e.toLowerCase();for(let e=0;e<s.length;e++)if(s[e].queryString.toLowerCase()==o){i=e;break}-1!=i&&s.splice(i,1),"deleteAll"!==n&&"clear"!==n&&s.unshift({queryString:e,uqlSearchQuery:t}),s.length>100&&s.pop(),b.setItem("NLQUserQuery",s),b.commit(),"clear"===n&&0==s.length&&(this._dropdown.elements.suggestions.querySelector(".search-dropdown-clear-history-icon.fonticon.fonticon-trash").addClassName("disable-button"),x._createEmptyView(this._dropdown.elements.suggestions)),"clear"!==n&&x._loadNlqExamples()}},createNLQInputTooltip:function(e){return new _({target:this._SelectionChipsEditor._lineEditor._myInput,position:"bottom-left",body:e})}})})),define("DS/SNSearchUX/helpers/SmartQueries",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/View","UWA/Element","DS/UIKIT/Spinner","DS/Controls/Toggle","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchPreferences","DS/SNSearchUX/helpers/SmartQueryController","DS/SNSearchUX/helpers/SmartQueryUtils","DS/SNSearchUX/dropdown/SearchDropDownUtils","i18n!DS/SNSearchUX/assets/nls/GuidedMode.json"],(function(e,t,n,i,s,o,a,r,c,l,d,u,h){"use strict";return i.extend(n,{_container:null,_activatecontainer:null,_content:null,_contentDiv:null,_activationcontent:null,_value:null,_smartQueryControllerInstance:null,_toggle:null,_toggleactivation:!1,_dropdown:null,_spinnerContainerTypes:null,_appContainer:null,_appContainerImage:null,_appContainerText:null,_guidedModeContent:null,init:function(e){return this._container=e.container?e.container:null,this._activatecontainer=e.activationcontainer?e.activationcontainer:null,this._dropdown=e.dropdown?e.dropdown:null,this._content=null,this._contentDiv=null,this._toggle=null,this._value=null,this._smartQueryControllerInstance&&this._smartQueryControllerInstance.destroy()&&(this._smartQueryControllerInstance=null),this._smartQueryControllerInstance=new l({dropdown:this._dropdown,container:this._container,smartQueries:this}),this._toggleactivation=c.getItem("smartMode"),this._spinnerContainerTypes=null,this._appContainer=null,this._appContainerImage=null,this._appContainerText=null,this._guidedModeContent=null,this._parent(e)},initEnd:function(){let t,n=this;if(!e.is(n._dropdown))return;if(null===n._spinnerContainerTypes){n._spinnerContainerTypes=s.create("div",{class:"custom-suggestion-container-content-spinner-container"}).inject(n._dropdown.elements.suggestionContainer),t=(new o).inject(n._spinnerContainerTypes).show();s.create("span",{class:"spinner-container-label",text:h.get("smart.mode.loading")}).inject(n._spinnerContainerTypes)}n._smartQueryControllerInstance&&n._smartQueryControllerInstance._buildListOfTypes(),e.is(n._toggleactivation)&&!1!==n._toggleactivation?(n._toggle.inject(n._contentDiv),n._container.show(),n._dropdown.elements.customSuggestions.show(),setTimeout((function(){n._dropdown.elements.dropdownContainer.className.contains("autocomplete-hidden")&&n._dropdown.elements.dropdownContainer.removeClassName("autocomplete-hidden"),e.is(n._dropdown.elements.suggestions)&&n._dropdown.elements.suggestions.setStyle("display","none"),n._disabledInput(),n._hideSections(),n._dropdown.switchActiveTabinstantSearchTab(),n._smartQueryControllerInstance._clickOnChipsEditor()}),500),!0===n._dropdown.webInwin&&n._dropdown.eventManager.dispatchEvent("onGuidedMode",!0)):(e.is(n._dropdown.elements.suggestions)&&n._dropdown.elements.suggestions.setStyle("display","block"),n._dropdown.switchActiveTab(n._dropdown.elements.searchTabContainer,n._dropdown.elements.searchTab),n._enabledInput(),n._toggle.inject(n._activationcontent),n._dropdown.elements.customSuggestions.hide());let i=e.extendElement(document.body).getElement(".main");e.is(i)&&i.addEventListener("click",n._clickOut.bind(n));let a=e.extendElement(document.body).getElement(".right");e.is(a)&&a.addEventListener("click",n._clickOut.bind(n))},render:function(){let t=this;if(!e.is(t._dropdown))return;t._content=s.create("div",{class:"smart-queries-content"}).inject(t._container),t._activationcontent=s.create("div",{class:"smart-queries-activation-content"}).inject(t._activatecontainer),t._contentDiv=s.create("div",{class:"smart-queries-content-div"}).inject(t._content);t._smartQueryControllerInstance.render(t._content);t._container.hide(),t._toggle=new a({type:"switch",touchMode:!0,label:h.get("smart.mode.activation"),checkFlag:t._toggleactivation}),t._toggle.addEventListener("buttonclick",(function(n){if(e.is(n)&&e.is(n.dsModel)){let i=n.dsModel;if(e.is(i)){if(t._toggleactivation=i.checkFlag,!0===t._toggleactivation)t._toggle.inject(t._contentDiv),t._container.show(),e.is(t._dropdown.elements.suggestions)&&t._dropdown.elements.suggestions.setStyle("display","none"),t._disabledInput(),t._hideSections(),t._dropdown.switchActiveTabinstantSearchTab(),t._smartQueryControllerInstance._buildSuggestion(),t._smartQueryControllerInstance._updateUI(),t._smartQueryControllerInstance.focusEditor(),t._dropdown.elements.customSuggestions.show(),!0===t._dropdown.webInwin&&t._dropdown.eventManager.dispatchEvent("onGuidedMode",!0);else{t._dropdown.switchActiveTab(t._dropdown.elements.searchTabContainer,t._dropdown.elements.searchTab),t._enabledInput(),t._toggle.inject(t._activationcontent),t._container.hide(),e.is(t._dropdown.elements.suggestions)&&t._dropdown.elements.suggestions.setStyle("display","block"),t._smartQueryControllerInstance._updateUI(!1),t._hidesearchResultsSections(),t._dropdown.elements.customSuggestions.hide(),t._dropdown.onClick();let n=u.getMyContentView();e.is(n)||t._dropdown.refreshMyContent(),!0===t._dropdown.webInwin&&t._dropdown.eventManager.dispatchEvent("onGuidedMode",!1)}c.setItem("smartMode",t._toggleactivation),c.commit()}}}))},renderRight:function(t){let n=this;e.is(n._dropdown)&&(n._dropdown.elements.searchResultsContainer=s.create("div",{class:"searchResults-container"}).inject(n._dropdown.elements.instantSearchContainer).hide())},isToggleactivation:function(){return this._toggleactivation},_disabledInput:function(){let t=this;if(e.is(t._dropdown)){t._dropdown.setPlaceHolderValue(h.get("search.fromsearchResults.title")),t._dropdown.elements.input.removeClassName("enabled"),t._dropdown.elements.input.setAttribute("disabled",""),t._dropdown.elements.input.addClassName("disabled");let n=document.querySelector(".run_btn_search.fonticon.fonticon-search");e.is(n)&&e.is(n.removeClassName,"function")&&(n.removeClassName("enabled"),n.addClassName("disabled")),n=document.querySelector(".run_ctn_search.ctn_search"),e.is(n)&&e.is(n.removeClassName,"function")&&(n.removeClassName("enabled"),n.addClassName("disabled"))}},_enabledInput:function(){let t=this;if(e.is(t._dropdown)){t._dropdown.elements.input.removeAttribute("disabled"),t._dropdown.elements.input.removeClassName("disabled"),t._dropdown.elements.input.addClassName("enabled");let n=document.querySelector(".run_btn_search.fonticon.fonticon-search");e.is(n)&&e.is(n.removeClassName,"function")&&(n.removeClassName("disabled"),n.addClassName("enabled")),n=document.querySelector(".run_ctn_search.ctn_search"),e.is(n)&&e.is(n.removeClassName,"function")&&(n.removeClassName("disabled"),n.addClassName("enabled"))}},_hideSections:function(){let t=this;if(!e.is(t._dropdown))return;t._dropdown.categoryList.forEach((function(t){e.is(t)&&(t.container.hide(),t.header.hide())}));let n=u.getCategoryContentView();if(n&&n.hide(),t._appContainer&&t._appContainer,!0===t._smartQueryControllerInstance._bresultFound)t._showsearchResultsSections();else{let n=t._dropdown.elements.instantSearchEmptyView;e.is(n)&&(t._dropdown.elements.instantSearchEmptyView.hide(),e.is(t._guidedModeContent)||(t._guidedModeContent=u.buildguidedModeDiv({controller:t._smartQueryControllerInstance,parent:n.getParent()})),e.is(t._guidedModeContent)&&t._guidedModeContent.show(),t._dropdown.elements.searchResultsContainer&&t._dropdown.elements.searchResultsContainer.hide())}},_showsearchResultsSections:function(){let t,n=this;if(!e.is(n._dropdown))return t;n._guidedModeContent&&n._guidedModeContent.hide(),n._dropdown.elements.instantSearchEmptyView&&n._dropdown.elements.instantSearchEmptyView.hide(),n._dropdown.elements.searchResultsContainer&&n._dropdown.elements.searchResultsContainer.show();let i=u.getCategoryContentView();return i&&i.hide(),n._dropdown.categoryList.forEach((function(e){e.title.getAttribute("title")===h.get("search.searchResults.title")&&(t=e,t.container.show(),t.header.show(),t.spinner.hide())})),t},_hidesearchResultsSections:function(){let t,n=this;return e.is(n._dropdown)?(n._guidedModeContent&&n._guidedModeContent.hide(),n._dropdown.elements.instantSearchEmptyView&&n._dropdown.elements.instantSearchEmptyView.hide(),n._dropdown.elements.searchResultsContainer&&n._dropdown.elements.searchResultsContainer.hide(),n._dropdown.categoryList.forEach((function(e){e.title.getAttribute("title")===h.get("search.searchResults.title")&&(t=e,t.container.hide(),t.header.hide(),t.spinner.hide())})),t):t},_applySearch:function(){e.is(this._smartQueryControllerInstance)&&this._smartQueryControllerInstance._applySearch()},clean:function(){this._value="",this._smartQueryControllerInstance.clean()},_displayApp:function(t){let n=this;e.is(n._dropdown)&&e.is(t)&&(null===n._appContainer&&(n._appContainer=s.create("div",{class:"instant-search-app-view",title:h.get("smart.mode.section.start").replace("###",t.title)}).inject(n._dropdown.elements.instantSearchContainer).hide(),n._appContainerImage=s.create("div",{class:"instant-search-app-view-image"}).inject(n._appContainer),n._appContainerText=s.create("div",{class:"instant-search-app-view-text",text:"No found"}).inject(n._appContainer),n._appContainer.dropdown=n._dropdown,n._appContainer.addEvent("click",(function(e){d.launchApp({dropdown:this.dropdown,appInfos:this.appInfos})}))),e.is(t)&&n._appContainer&&(n._appContainer.appInfos=t,n._appContainer.title=h.get("smart.mode.section.start").replace("###",t.title),n._hideSections(),n._hidesearchResultsSections(),n._dropdown.elements.instantSearchEmptyView.hide(),n._dropdown.elements.instantSearchEmptyView.hide(),n._appContainer.show(),n._appContainerImage.style.backgroundImage="url("+t.icon+")",n._appContainerText.setText(t.title)))},_clickOut:function(t){let n=this;e.is(n._dropdown)&&(n._dropdown.elements.dropdownContainer.className.contains("autocomplete-hidden")||!0===n._toggleactivation&&(r.log("SmartQueryController::_clickOut"),n._dropdown.onBlur(void 0,!0),n._enabledInput(),setTimeout((function(){n._dropdown&&n._dropdown.setInputValue(""),n._dropdown&&n._dropdown.setPlaceHolderValue(h.get("search.fromsearchResults.title"))}),500)))},destroy:function(){let t=e.extendElement(document.body).getElement(".main");e.is(t)&&t.removeEventListener("click",_this._clickOut.bind(_this));let n=e.extendElement(document.body).getElement(".right");return e.is(n)&&n.removeEventListener("click",_this._clickOut.bind(_this)),this._smartQueryControllerInstance&&this._smartQueryControllerInstance.destroy(),this._parent()}})})),define("DS/SNSearchUX/dropdown/SearchDropDownSettings",["UWA/Core","UWA/Element","UWA/Promise","UWA/Controls/Abstract","DS/UIKIT/SuperModal","DS/UIKIT/Scroller","DS/Controls/ComboBox","DS/Controls/Button","DS/Controls/Toggle","DS/SNInfraUX/SecurityContextManager","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchUtils","DS/MessageBus/MessageBus","DS/PubSub/PubSub","DS/SNSearchResultsCusto/views/SearchResultsCustomizationPanel","DS/SNSearchUX/helpers/GuidedTrackerUtils","DS/SNSearchUX/dropdown/SearchDropDownUtils","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationPreferences","DS/SNResultUX/utils/ExternalComponentHelpers","DS/SNResultUX/utils/SearchServices","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json","i18n!DS/SNSearchUX/assets/nls/SearchDropDown.json"],(function(e,t,n,i,s,o,a,r,c,l,d,u,h,p,g,_,m,S,f,C,y,v,b,w){"use strict";return i.extend({settings:{},_searchDropDown:null,_webInwin:!1,_eventManager:void 0,_srcRessource:void 0,init:function(t){let n=this;n._parent(t),e.is(t)&&(e.is(t.eventManager)&&(n._eventManager=t.eventManager),e.is(t.searchDropDown)&&(n._searchDropDown=t.searchDropDown),e.is(t.webInwin)&&(n._webInwin=t.webInwin),n._srcRessource=null)},initCustoSettings:function(e){this._CustoPanel=new _,this._CustoPanel.setup(e)},initSettings:function(t){e.is(t)&&(this._srcRessource=t,this._initDefaultSettings())},_initDefaultSettings:function(){let t=this;if(t.initialSettings={},!e.is(t.elements))return;if("3DSpace"!==h.identifyClientInfo().identifier&&t.elements.settingCheckbox_2){let n=u.getItem("search_tabbed_ui");t.elements.settingCheckbox_2.checked=!!e.is(n)&&n,t.initialSettings.searchTabbedUI=t.elements.settingCheckbox_2.checked}if(!0===t._webInwin&&t.elements.settingCheckbox_2_1){let n=u.getItem("search_double_click_open");t.elements.settingCheckbox_2_1.checked=!!e.is(n)&&n,t.initialSettings.doubleclickopen=t.elements.settingCheckbox_2_1.checked}var n=[];let i=d.getOption("csvSeparatorArray");e.is(i)&&i.length>0&&(i.forEach((function(e){n.push({label:v.get("csvSeparatorUI.values."+e.id),value:e.value})})),t.elements.settingsSelect_3.elementsList=n);let s=d.getOption("date_display_mode_array");n=[],e.is(s)&&s.length>0&&(s.forEach((function(e){n.push({label:v.get(e.id+".title"),value:e.value})})),t.elements.settingsSelect_4.elementsList=n);let o=f.getActiveCustomization();if(e.is(o)?this.initialSettings.resultAttributesCustomization=o.customizationId||o.getCustomizationId():this.initialSettings.resultAttributesCustomization="Default",u.getItemPromise("optionMode",t._srcRessource.active_tenant).then((function(n){e.is(n)&&(t.elements.settingsSelect_3.value=d.getOption("csvSeparator"),e.is(n.csvMode)&&e.is(n.csvMode.valueItem)&&(t.elements.settingsSelect_3.value=n.csvMode.valueItem),t.initialSettings.csvSeparator=t.elements.settingsSelect_3.elementsList[t.elements.settingsSelect_3.selectedIndex].label,e.is(n.dateDisplayMode)&&e.is(n.dateDisplayMode.id)?Array.from(t.elements.settingsSelect_4.elementsList).forEach((function(e,i){e.label===v.get(n.dateDisplayMode.id+".title")&&(t.elements.settingsSelect_4.selectedIndex=i)})):t.elements.settingsSelect_4.selectedIndex=0,t.initialSettings.dateFormat=t.elements.settingsSelect_4.elementsList[t.elements.settingsSelect_4.selectedIndex>=0?t.elements.settingsSelect_4.selectedIndex:0].label)})),n=[],h.isRoleAvailable(["CSV"],t._srcRessource.active_tenant,(function(i){if(!0===i){let i=d.getOption("show_search_results_revision_array");e.is(i)&&i.length>0&&(i.forEach((function(e){n.push({label:v.get(e.id+".title"),value:e.exprn,name:e.id})})),t.elements.settingsSelect_5.elementsList=n);let s=e.is(u.getItem("revisionDisplayType"))?u.getItem("revisionDisplayType"):d.getOption("defaultRevision",{tenant:t._srcRessource.active_tenant});e.is(s)?(Array.from(t.elements.settingsSelect_5.elementsList).forEach((function(e,n){e.label===v.get(s.id+".title")&&(t.elements.settingsSelect_5.selectedIndex=n)})),t.initialSettings.searchResultRevisions=t.elements.settingsSelect_5.elementsList[t.elements.settingsSelect_5.selectedIndex].label):(t.elements.settingsSelect_5.selectedIndex=0,t.initialSettings.searchResultRevisions=t.elements.settingsSelect_5.elementsList[0].label)}})),n=[],"3DSpace"!==h.identifyClientInfo().identifier&&!1===t._webInwin&&(t.handleSecurityContext(),t.elements.MSF_Checkbox)){let n=u.getItem("activateMSFIntegration");t.elements.MSF_Checkbox.checked=!!e.is(n)&&n,t.initialSettings.activateMSFIntegration=t.elements.MSF_Checkbox.checked}if(t.elements.keepColumnSorting){let n=u.getItem("search_keepColumnSorting");t.elements.keepColumnSorting.checked=!!e.is(n)&&n,t.initialSettings.keepColumnSorting=t.elements.keepColumnSorting.checked}if(t.elements.pinContextualSuggestion){let n=u.getItem("activateSearchSuggestionPanel");t.elements.pinContextualSuggestion.checked=!!e.is(n)&&n,t.initialSettings.pinContextualSuggestion=t.elements.pinContextualSuggestion.checked}if(t.elements.implicitOperator){let n=u.getItem("activateImplicitOperator");t.elements.implicitOperator.checkFlag=!!e.is(n)&&n,t.initialSettings.implicitOperator=t.elements.implicitOperator.checkFlag}if(t.elements.logicalOperator){let n=u.getItem("activateLogicalOperator");t.elements.logicalOperator.checkFlag=!e.is(n)||n,t.initialSettings.logicalOperator=t.elements.logicalOperator.checkFlag}t.elements.applySettingsContainer&&t.setButtonState()},handleSecurityContext:function(){let t=this,n=h.identifyClientInfo(void 0),i=!1;if(e.is(n)&&e.is(n.identifier)&&("3DDashboard"===n.identifier||"3DSwym"===n.identifier)&&(i=!0),e.is(n)&&e.is(n.addinmode)&&"catiav5"===n.addinmode&&(i=!0),d.getOption("global_action_credentials")&&!0===i){var s=[],o=0;l.getSecurityContextPromise(t._srcRessource.active_tenant).then((function(n){var i=u.getItem("securityContext"+t._srcRessource.active_tenant+h.getUserId());e.is(i,"string")&&(i=JSON.parse(i)),t.settings.listofCredentialObjectsArray=n,t.settings.listofCredentialObjectsArray.forEach((function(e){s.push({label:v.get(e.displayName),value:e.name})})),s.forEach((function(n,s){e.is(i)&&e.is(i.name)&&i.name===n.value&&(o=s,t.elements.settingsSelect_6.value=n.value)})),t.elements.settingsSelect_6.elementsList=s,t.elements.settingsSelect_6.elementsList&&t.elements.settingsSelect_6.elementsList[o]&&(t.initialSettings.collaborativeSpaceCredentials=t.elements.settingsSelect_6.elementsList[o].label),t.elements.settingsSelect_6.selectedIndex=o}))}},hasSettingsChanged:function(){var t=!1;return e.is(this.initialSettings.keepColumnSorting)&&e.is(this.elements.keepColumnSorting)&&this.initialSettings.keepColumnSorting!==this.elements.keepColumnSorting.checked&&(t=!0),e.is(this.initialSettings.instantSearch)&&this.initialSettings.instantSearch!==this.elements.settingCheckbox_1.checked&&(t=!0),e.is(this.initialSettings.searchTabbedUI)&&this.initialSettings.searchTabbedUI!==this.elements.settingCheckbox_2.checked&&(t=!0),e.is(this.initialSettings.doubleclickopen)&&this.initialSettings.doubleclickopen!==this.elements.settingCheckbox_2_1.checked&&(t=!0),e.is(this.initialSettings.csvSeparator)&&this.initialSettings.csvSeparator!==this.elements.settingsSelect_3.elementsList[this.elements.settingsSelect_3.selectedIndex].label&&(t=!0),e.is(this.initialSettings.dateFormat)&&this.initialSettings.dateFormat!==this.elements.settingsSelect_4.elementsList[this.elements.settingsSelect_4.selectedIndex].label&&(t=!0),e.is(this.initialSettings.searchResultRevisions)&&this.initialSettings.searchResultRevisions!==this.elements.settingsSelect_5.elementsList[this.elements.settingsSelect_5.selectedIndex].label&&(t=!0),e.is(this.initialSettings.collaborativeSpaceCredentials)&&this.initialSettings.collaborativeSpaceCredentials!==this.elements.settingsSelect_6.elementsList[this.elements.settingsSelect_6.selectedIndex].label&&(t=!0),e.is(this.initialSettings.activateMSFIntegration)&&e.is(this.elements.MSF_Checkbox)&&this.initialSettings.activateMSFIntegration!==this.elements.MSF_Checkbox.checked&&(t=!0),e.is(this.initialSettings.pinContextualSuggestion)&&e.is(this.elements.pinContextualSuggestion)&&this.initialSettings.pinContextualSuggestion!==this.elements.pinContextualSuggestion.checked&&(t=!0),e.is(this.initialSettings.implicitOperator)&&e.is(this.elements.implicitOperator)&&this.initialSettings.implicitOperator!==this.elements.implicitOperator.checkFlag&&(t=!0),e.is(this.initialSettings.logicalOperator)&&e.is(this.elements.logicalOperator)&&this.initialSettings.logicalOperator!==this.elements.logicalOperator.checkFlag&&(t=!0),e.is(this.initialSettings.resultAttributesCustomization)&&e.is(this.elements.settingsSelect_custo_selector)&&this.initialSettings.resultAttributesCustomization!==this.elements.settingsSelect_custo_selector.elementsList[this.elements.settingsSelect_custo_selector.selectedIndex]&&(t=!0),t},setButtonState:function(){this.hasSettingsChanged()?this.elements.settingsApply.disabled=!1:this.elements.settingsApply.disabled=!0},buildSettings:function(n){let i=this;if(!e.is(i._searchDropDown)||!e.is(n))return;let l=this.elements;l.settingsTabContainer=n,l.settingsContainer=t.create("div",{class:"settings-container"}).inject(l.settingsTabContainer);var u=l.settingsContainer.getElement("settings-container");if(new o({element:u}).inject(l.settingsContainer),l.applySettingsContainer=t.create("div",{class:"apply-container"}).inject(l.settingsTabContainer),l.settingsClose=new t.create("div",{class:"settings-close"}).inject(l.settingsContainer),l.closeLink=new r({displayStyle:"lite",emphasize:"secondary",icon:{iconName:"close",fontIconSize:"1x",fontIconFamily:WUXManagedFontIcons.Font3DS},onClick:function(){i._searchDropDown.hideSettingPQs(),i.setButtonState()}}).inject(l.settingsClose),l.closeLink.elements.iconPlaceholder.setAttributes({title:"Close"}),"3DSpace"!==h.identifyClientInfo().identifier&&(l.title_1=t.create("div",{class:"setting-container"}).inject(l.settingsContainer),t.create("div",{class:"label-container-title",text:w.get("Tab.setting.layout")}).inject(l.title_1),l.setting_2=t.create("div",{class:"setting-container tabbed"}).inject(l.settingsContainer),l.settingContainer_2=t.create("div",{class:"option-container"}).inject(l.setting_2),l.settingCheckbox_2=t.create("input",{class:"settings-useTabs-checkbox",type:"checkbox"}).inject(l.settingContainer_2),l.settingCheckbox_2.addEventListener("change",(function(e){i._searchDropDown.noBlur=!1,i.setButtonState()})),l.settingTitle_2=t.create("span",{class:"settings-useTabs-title",text:w.get("Tab.setting.show")}).inject(l.settingContainer_2)),!0===i._webInwin&&(l.setting_2_1=t.create("div",{class:"setting-container dbl-clk"}).inject(l.settingsContainer),l.settingContainer_2_1=t.create("div",{class:"option-container"}).inject(l.setting_2_1),l.settingCheckbox_2_1=t.create("input",{class:"settings-instant-search-checkbox",type:"checkbox"}).inject(l.settingContainer_2_1),l.settingCheckbox_2_1.addEvent("click",(function(t){if(e.is(t)&&e.is(t.target)){let e=t.target.checked;i._eventManager&&i._eventManager.dispatchEvent("doubleclickopen",{value:e}),i.setButtonState()}})),l.settingTitle_2_1=t.create("span",{class:"settings-instant-search-title",text:w.get("search_double_click_open")}).inject(l.settingContainer_2_1)),l.title_2=t.create("div",{class:"setting-container"}).inject(l.settingsContainer),t.create("div",{class:"label-container-title",text:w.get("Tab.setting.result")}).inject(l.title_2),l.setting_4=t.create("div",{class:"setting-container date-format"}).inject(l.settingsContainer),t.create("div",{class:"label-container",text:w.get("Tab.setting.date.format")}).inject(l.setting_4),l.settingContainer_4=t.create("div",{class:"option-container-select"}).inject(l.setting_4),l.settingsSelect_4=new a({touchMode:!0,enableSearchFlag:!1,domId:"id-date-format"}).inject(l.settingContainer_4),l.settingsSelect_4.addEventListener("change",(function(e){i._searchDropDown.noBlur=!1,i.setButtonState()})),l.settingsSelect_4.elements.mainElement.addEventListener("blur",(function(){i._searchDropDown.noBlur=!1,i._searchDropDown.setFocus()})),!0===f.isBETAEnabled()){l.title_custo=t.create("div",{class:"setting-container"}).inject(l.settingsContainer),t.create("div",{class:"label-container-title",text:w.get("Tab.setting.customization")}).inject(l.title_custo),l.setting_custo_selector=t.create("div",{class:"setting-container custo_selector"}).inject(l.settingsContainer),t.create("div",{class:"label-container",text:w.get("Tab.setting.active.customization")}).inject(l.setting_custo_selector),l.settingContainer_custo_selector=t.create("div",{class:"option-container-select"}).inject(l.setting_custo_selector);let n=f.buildUserCustomizationList(),s=f.getActiveCustomization();if(e.is(s))var g=s.customizationId||s.getCustomizationId(),_=n.findIndex((e=>e===g));l.settingsSelect_custo_selector=new a({elementsList:n,currentValue:n[_]||"Default",touchMode:!0,enableSearchFlag:!1}).inject(l.settingContainer_custo_selector),"mobile"!==h.getDeviceType()&&"tablet"!==h.getDeviceType()&&(l.settingsSelect_custo_button=new r({icon:{iconName:"cog",fontIconSize:"2x"}}).inject(l.settingContainer_custo_selector),l.settingsSelect_custo_button.addEventListener("click",function(){this.initCustoSettings(this)}.bind(this))),l.settingsSelect_custo_selector.addEventListener("change",(function(e){i._searchDropDown.noBlur=!1,i.setButtonState()})),l.settingsSelect_custo_selector.elements.mainElement.addEventListener("blur",(function(){i._searchDropDown.noBlur=!1,i._searchDropDown.setFocus()})),p.subscribe({channel:"3dSearch_results_customization",topic:"3dSearch_new_customization_in_localStorage",callback:()=>{e.is(l.settingsSelect_custo_selector)&&(l.settingsSelect_custo_selector.elementsList=f.buildUserCustomizationList())}}),p.subscribe({channel:"3dSearch_results_customization",topic:"3dSearch_customization_deleted_from_localStorage",callback:()=>{e.is(l.settingsSelect_custo_selector)&&(l.settingsSelect_custo_selector.elementsList=f.buildUserCustomizationList())}})}l.settingsKeepColumnSortingContainerWrapper=t.create("div",{class:"setting-container keepcolumn"}).inject(l.settingsContainer),l.settingsKeepColumnSortingContainer=t.create("div",{class:"option-container"}).inject(l.settingsKeepColumnSortingContainerWrapper),l.keepColumnSorting=t.create("input",{class:"settings-keepColumnSorting-checkbox",type:"checkbox"}).inject(l.settingsKeepColumnSortingContainer),l.keepColumnSortingTitle=t.create("span",{class:"settings-keepColumnSorting-title",text:w.get("Tab.setting.keepColumnSorting.title")}).inject(l.settingsKeepColumnSortingContainer),l.keepColumnSorting.addEventListener("change",(function(e){i._searchDropDown.noBlur=!1,i.setButtonState()})),l.title_3=t.create("div",{class:"setting-container"}).inject(l.settingsContainer),t.create("div",{class:"label-container-title",text:w.get("Tab.setting.export")}).inject(l.title_3),l.setting_3=t.create("div",{class:"setting-container csv-separator"}).inject(l.settingsContainer),t.create("div",{class:"label-container",text:w.get("Tab.setting.csv")}).inject(l.setting_3),l.settingContainer_3=t.create("div",{class:"option-container-select"}).inject(l.setting_3),l.settingsSelect_3=new a({touchMode:!0,enableSearchFlag:!1,domId:"id-csv-separator"}).inject(l.settingContainer_3),l.settingsSelect_3.addEventListener("change",(function(e){i._searchDropDown.noBlur=!1,i.setButtonState()})),l.settingsSelect_3.elements.mainElement.addEventListener("blur",(function(){i._searchDropDown.noBlur=!1,i._searchDropDown.setFocus()})),l.title_4=t.create("div",{class:"setting-container"}).inject(l.settingsContainer),t.create("div",{class:"label-container-title",text:w.get("Tab.setting.collaborative")}).inject(l.title_4),l.setting_5=t.create("div",{class:"setting-container results-revision"}).inject(l.settingsContainer),t.create("div",{class:"label-container",text:w.get("Tab.setting.revisions")}).inject(l.setting_5),l.settingContainer_5=t.create("div",{class:"option-container-select"}).inject(l.setting_5),l.settingsSelect_5=new a({touchMode:!0,enableSearchFlag:!1,domId:"id-results-revision"}).inject(l.settingContainer_5),l.settingsSelect_5.addEventListener("change",(function(e){i._searchDropDown.noBlur=!1,i.setButtonState()})),l.settingsSelect_5.elements.mainElement.addEventListener("blur",(function(){i._searchDropDown.noBlur=!1,i._searchDropDown.setFocus()})),"3DSpace"!==h.identifyClientInfo().identifier&&!1===i._webInwin&&(l.setting_6=t.create("div",{class:"setting-container credentials"}).inject(l.settingsContainer),t.create("div",{class:"label-container",text:w.get("Tab.setting.credentials")}).inject(l.setting_6),l.settingContainer_6=t.create("div",{class:"option-container-select"}).inject(l.setting_6),l.settingsSelect_6=new a({touchMode:!0,enableSearchFlag:!1,domId:"id-credentials"}).inject(l.settingContainer_6),l.settingsSelect_6.addEventListener("change",(function(e){i._searchDropDown.noBlur=!1,i.setButtonState()})),l.settingsSelect_6.elements.mainElement.addEventListener("blur",(function(e){i._searchDropDown.noBlur=!1,i._searchDropDown.setFocus()})));let m=h.identifyClientInfo(d.getOption("addinmode"));if(e.is(m)&&"3DDashboard"==m.identifier&&!e.is(m.addinmode)&&"tablet"!=h.getDeviceType()){l.crossLinkCollaboration=t.create("div",{class:"setting-container"}).inject(l.settingsContainer),t.create("div",{class:"label-container-title",text:w.get("Tab.setting.cross")}).inject(l.crossLinkCollaboration),l.crossLinkContainer=t.create("div",{class:"setting-container tabbed"}).inject(l.settingsContainer),l.crossLinkOptionContainer=t.create("div",{class:"option-container"}).inject(l.crossLinkContainer),l.MSF_Checkbox=t.create("input",{class:"settings-MSF-checkbox",type:"checkbox"}).inject(l.crossLinkOptionContainer),l.MSF_Checkbox.addEventListener("change",(function(e){i._searchDropDown.noBlur=!1,i.setButtonState(),i.elements.MSF_Checkbox.checked&&y._displayAlert({message:w.get("Tab.setting.microsoft_collaboration.alert")})})),l.MSF_Title=t.create("span",{class:"settings-MSF-title",text:w.get("Tab.setting.microsoft_collaboration")}).inject(l.crossLinkOptionContainer);let e=t.create("span",{class:"fonticon fonticon-info tooltip_icon"}).inject(l.crossLinkOptionContainer);e.setStyle("color","#b4b6ba"),C.tooltip(e,{position:"top",shortHelp:w.get("Tab.setting.microsoft_collaboration.tooltipMsg")})}if("tablet"!=h.getDeviceType()&&(!0===S.getGuidedmodeStatus()||d.getOption("GuidedMode",{tenant:h.getActiveTenant()}))){if(l.inlineSuggestion=t.create("div",{class:"setting-container guidedModeHeading"}).inject(l.settingsContainer),t.create("div",{class:"label-container-title",text:w.get("Tab.setting.GuidedMode.heading")}).inject(l.inlineSuggestion),l.inlineSuggestionContainer=t.create("div",{class:"setting-container tabbed"}).inject(l.settingsContainer),d.getOption("pinSuggestion")){l.inlineSuggestionOptionContainer=t.create("div",{class:"option-container"}).inject(l.inlineSuggestionContainer),l.pinContextualSuggestion=t.create("input",{class:"settings-pin-checkbox",type:"checkbox"}).inject(l.inlineSuggestionOptionContainer),l.pinContextualSuggestion.addEventListener("change",(function(e){i._searchDropDown.noBlur=!1,i.setButtonState()})),l.MSF_Title=t.create("span",{class:"settings-pin-title",text:w.get("Tab.setting.pinContextualSuggestion.title")}).inject(l.inlineSuggestionOptionContainer);let e=t.create("span",{class:"fonticon fonticon-info tooltip_icon"}).inject(l.inlineSuggestionOptionContainer);e.setStyle("color","#b4b6ba"),C.tooltip(e,{position:"top",shortHelp:w.get("Tab.setting.pinContextualSuggestion.tooltipMsg")})}l.implicitOperatorContainer=t.create("div",{class:"option-container implicitOperatorContainer"}).inject(l.inlineSuggestionContainer),l.implicitOperator=new c({label:w.get("Tab.setting.implicitOperator.title"),domId:"id-implicitOperator",type:"checkbox"}).inject(l.implicitOperatorContainer),l.implicitOperator.addEventListener("change",(function(e){i._searchDropDown.noBlur=!1,i.setButtonState()}));let e=t.create("span",{class:"fonticon fonticon-info tooltip_icon"}).inject(l.implicitOperatorContainer);e.setStyle("color","#b4b6ba"),C.tooltip(e,{position:"top",shortHelp:w.get("Tab.setting.implicitOperator.tooltipMsg")}),l.logicalOperatorContainerDiv=t.create("div",{class:"setting-container tabbed"}).inject(l.settingsContainer),l.logicalOperatorContainer=t.create("div",{class:"option-container logicalOperatorContainer"}).inject(l.logicalOperatorContainerDiv),l.logicalOperator=new c({label:w.get("Tab.setting.logicalOperator.title"),domId:"id-logicalOperator",type:"checkbox"}).inject(l.logicalOperatorContainer),l.logicalOperator.addEventListener("change",(function(e){i._searchDropDown.noBlur=!1,i.setButtonState()}));let n=t.create("span",{class:"fonticon fonticon-info tooltip_icon"}).inject(l.logicalOperatorContainer);n.setStyle("color","#b4b6ba"),C.tooltip(n,{position:"top",shortHelp:w.get("Tab.setting.logicalOperator.tooltipMsg")})}l.settingsApply=new r({label:v.get("APPLYButton"),emphasize:"secondary",touchMode:!0,onClick:function(){new s({renderTo:document.body,className:"WarningReloadPage",okButtonText:v.get("settings-Apply")}).confirm(v.get("settings-confirm"),v.get("settings-Changes"),(function(e){!0===e?i.applySettings():!1===e&&i._initDefaultSettings()}))}}).inject(l.applySettingsContainer),l.settingsApply.disabled=!0,l.settingsApply.elements.container.addClassName("apply-button"),!0===f.isBETAEnabled()&&l.settingsApply.elements.container.addClassName("BETA-FUN146944")},applySettings:function(){let t=this;if(e.is(t.elements.settingCheckbox_2)&&u.setItem("search_tabbed_ui",t.elements.settingCheckbox_2.checked),e.is(t.elements.settingCheckbox_2_1)&&u.setItem("search_double_click_open",t.elements.settingCheckbox_2_1.checked),e.is(t.elements.MSF_Checkbox)&&u.setItem("activateMSFIntegration",t.elements.MSF_Checkbox.checked),e.is(t.elements.pinContextualSuggestion)){if(u.setItem("activateSearchSuggestionPanel")!=t.elements.pinContextualSuggestion.checked){let e=t.elements.pinContextualSuggestion.checked?"Pin":"UnPin";m.InlineSuggestionPinUnpinTracker(e)}u.setItem("activateSearchSuggestionPanel",t.elements.pinContextualSuggestion.checked)}if(e.is(t.elements.keepColumnSorting)&&u.setItem("search_keepColumnSorting",t.elements.keepColumnSorting.checked),e.is(t.elements.implicitOperator)&&u.setItem("activateImplicitOperator")!=t.elements.implicitOperator.checkFlag&&u.setItem("activateImplicitOperator",t.elements.implicitOperator.checkFlag),e.is(t.elements.logicalOperator)&&u.getItem("activateLogicalOperator")!==t.elements.logicalOperator.checkFlag){const e=t.elements.logicalOperator.checkFlag;S._currentSearchMode.contains("guidedSearch")&&(S._currentSearchMode=e?"guidedSearchExpert":"guidedSearchIntermediate",S._SmartQueryController.toggleGuidedMode(S._currentSearchMode),m.guidedExpertMode(S._currentSearchMode),u.setItem("guidedSearchMode",S._currentSearchMode),u.setItem("searchMode",S._currentSearchMode)),u.setItem("activateLogicalOperator",t.elements.logicalOperator.checkFlag)}var n=t.elements.settingsSelect_5.elementsList[t.elements.settingsSelect_5.selectedIndex].name,i=t.elements.settingsSelect_5.elementsList[t.elements.settingsSelect_5.selectedIndex].value;u.setItem("revisionDisplayType",{id:n,exprn:i}),"3DSpace"!==h.identifyClientInfo().identifier&&!1===t._webInwin&&t.settings.listofCredentialObjectsArray.forEach((function(e){e.displayName===t.elements.settingsSelect_6.elementsList[t.elements.settingsSelect_6.selectedIndex].label&&u.setItem("securityContext"+t._srcRessource.active_tenant+h.getUserId(),JSON.stringify(e))})),u.commit();var s={labelItem:t.elements.settingsSelect_3.elementsList[t.elements.settingsSelect_3.selectedIndex].label,valueItem:t.elements.settingsSelect_3.elementsList[t.elements.settingsSelect_3.selectedIndex].value},o={};d.getOption("date_display_mode_array").forEach((function(e){v.get(e.id+".title")===t.elements.settingsSelect_4.elementsList[t.elements.settingsSelect_4.selectedIndex].label&&(o=e)}));var a={csvMode:s,dateDisplayMode:o};let r;e.is(t.elements.settingsSelect_custo_selector)&&e.is(t.elements.settingsSelect_custo_selector.elementsList)&&(r=t.elements.settingsSelect_custo_selector.elementsList[t.elements.settingsSelect_custo_selector.selectedIndex],e.is(r)&&(f.switchActiveCustomization(r),t.initialSettings.resultAttributesCustomization=r)),u.setPreference({name:"optionMode",value:JSON.stringify(a),tenantId:t._srcRessource.active_tenant,onComplete:function(){!0===t._webInwin?(t._eventManager&&t._eventManager.dispatchEvent("applySettings",{name:"optionMode",value:JSON.stringify(a),tenantId:t._srcRessource.active_tenant,search_tabbed_ui:e.is(t.elements.settingCheckbox_2)&&t.elements.settingCheckbox_2.checked,search_double_click_open:e.is(t.elements.settingCheckbox_2_1)&&t.elements.settingCheckbox_2_1.checked,revisionDisplayType:{id:n,exprn:i}}),t._searchDropDown.hideSettingPQs(),t._initDefaultSettings()):location.reload(!0)},onFailure:function(e){Logger.error("Failure, Unable to save preferences :",e)}})},destroy:function(){this._parent()}})})),define("DS/SNSearchUX/SearchDropDown",["UWA/Core","UWA/Element","UWA/Event","UWA/Utils","UWA/Controls/Abstract","UWA/Utils/InterCom","DS/MessageBus/MessageBus","require","css!DS/SNSearchUX/SNSearchUX.css","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SNSearchTypeCusto","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchLogin","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchDoubleClickHandler","UWA/Promise","DS/SNSearchUX/SuggestionUXHelper","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/PubSub/PubSub","DS/UIKIT/Spinner","DS/WebappsUtils/WebappsUtils","DS/UIKIT/DropdownMenu","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNInfraUX/utils/SNCompassUtils","DS/SNInfraUX/ServiceDelegationLoader","DS/SNResultUX/models/SearchItemModel","DS/SNSearchUX/SearchSecondaryMenu","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json","DS/SNInfraUX/SNSuggestionHelper"],(function(e,t,n,i,s,o,a,r,c,l,d,u,h,p,g,_,m,S,f,C,y,v,b,w,D,I,E,T,x,M,N,k,A,O){"use strict";var P=!1,L="";return s.extend({_clearSearch:null,_searchBtn:null,_autocompleteSuggests:null,_timeoutId:null,_suggestTimeout:null,_secondTimeoutId:null,_inAppContext:!1,_temporarilyOutOfContext:!1,_inContextOptions:null,_inContextMode:null,_previouslyActiveSource:null,_sitChoice:null,_findInTabNLS:null,_cstoreChoice:[],_cstoreSources:[],_src_ressource:null,_searchStringToDisplayInSearchField:null,_internalSearchCriteria:null,_isTypeListMode:!1,_typeList:[],_suggestionsInPipeline:0,_cancel_suggest_update:!1,_searchResourcesSet:C.deferred(),canvas:null,itemCache:{},serverSuggests:{},dataCache:{},typeTimeout:null,_betaSuggestionTimer:500,addinMode:void 0,init:function(t){if(this._parent(t),e.is(t)&&e.is(t.isBetaOn)&&!0===t.isBetaOn){if(this.betaProgramState=!0,e.is(i.parseQuery(window.location.search).debounce)){var n=parseInt(i.parseQuery(window.location.search).debounce);"number"==typeof n&&(this._betaSuggestionTimer=n)}}else this.betaProgramState=!1;t.addinMode&&(this.addinMode=t.addinMode),this.buildSkeleton(),this.attachEvents(),this._createCompassClientSocket()},_createCompassClientSocket:function(){this._compass_socket=new o.Socket("com.ds.searchdropdown"),this._compass_socket.subscribeServer("com.ds.compass",window)},_buildCategories:function(){this.elements.categoriesContainer=t.create("div",{id:"search-suggests-categories",class:"search-suggests-categories"}).inject(this.elements.suggestsContainer),this.elements.categories=[],y.getSuggestHelper().then(function(){for(var e,t=y.getSuggestionCategories(),n=0;n<t.length;n++)e=this._addCategoryToDropDown(t[n].nls,t[n].id),this._hideCategory(e)}.bind(this));let e={tenant:p.getActiveTenant()};if(!0===h.getOption("activate_instant_search_apps",e)){let e=this._addCategoryAppToDropDown("App");this._hideCategory(e)}},_getSuggestCategoriesResult:function(t){t.length>=3&&!1===this._isPredefinedQueryInstantSearch(t)?(this._showSuggestSpinner(),this._showCategoryContainer(),this.dispatchEvent("onUpdateSuggests"),clearTimeout(this._categorySuggestTimeout),this._categorySuggestTimeout=setTimeout(function(){let n={tenant:p.getActiveTenant()};!0===h.getOption("activate_instant_search_apps",n)&&x.getApplicationsFromCompass(t).then(function(t){e.is(t)&&e.is(t.count)&&e.is(t.data)&&this._updateCategoryApp(t.data,t.count)}.bind(this)),y.getSuggestHelper().then(function(){var n=y.getSuggests({search_text:t,feature:h.getOption("fedsearch_query_label.feature_id.InstantSearch")});Object.keys(n).forEach(function(t){n[t].then(function(n){this.getInputValue().length>=3&&(e.is(n.collection)&&e.is(n.nls)?this._updateCategory(t,n.collection,n.nls,n.collection.hits):e.is(n.nls)&&this._updateCategory(t,[],n.nls,0))}.bind(this),(function(e){console.log(t,": ",e)}))}.bind(this))}.bind(this))}.bind(this),this._betaSuggestionTimer)):this._clearDropDown()},_addCategoryToDropDown:function(e,n){var i=t.create("ul",{id:"search-suggests-categories-"+e,class:"search-suggest-category"}).inject(this.elements.categoriesContainer),s=t.create("li",{class:"search-category-label-container"}).inject(i),o=t.create("img",{class:"search-category-img"}).inject(s),r=t.create("div",{class:"search-category-label",html:A.get(e)}).inject(s),c=t.create("div",{class:"search-category-view-all",html:A.get("search.suggestion.viewAll"),title:A.replace(A.get("search.suggestion.tooltip"),{category:e})}).inject(s);return c.addEventListener("click",function(e){a.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"ClickOnViewMore",persDim:{pd1:"0"}}}),this._onClickViewAll(n,e)}.bind(this)),this.elements.categories.push({container:i,labelContainer:s,img:o,label:r,viewAll:c,item:[],model:{}}),i},_addCategoryAppToDropDown:function(e){var n=t.create("ul",{id:"search-suggests-categories-"+e,class:"search-suggest-category"}).inject(this.elements.categoriesContainer),i=t.create("li",{class:"search-category-label-container",style:"color: red"}).inject(n),s=t.create("li",{class:"search-category-item-container"}).inject(n),o=t.create("img",{class:"search-category-img",src:I.getWebappsAssetUrl("SNSearchUX","images/APPICON.png")}).inject(i),r=t.create("div",{class:"search-category-label",html:A.get(e)}).inject(i),c=t.create("div",{class:"search-category-view-all",html:A.get("search.suggestion.viewAll"),title:A.replace(A.get("search.suggestion.tooltip"),{category:e})}).inject(i);return c.addEventListener("click",function(e){a.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"ClickOnViewMore",persDim:{pd1:"0"}}}),x.searchApplicationsInCompass(this.getInputValue())}.bind(this)),this.elements.categories.push({container:n,labelContainer:i,itemContainer:s,img:o,label:r,viewAll:c,item:[],model:{}}),n},_updateCategory:function(n,i,s,o){var a=this;this._hideSuggestSpinner();var r=this.elements.categories.filter((e=>e.container.id.includes(s)));if(r.length>0&&o>0){var c=r[0];this._clearCategory(c.container),this._showCategory(c.container);var l=c.label;if(l.setText(s+" ("+o+")"),l.setAttribute("count",o),l.setAttribute("title",s),i.length>0){var d,u,h,p;this._activateCategory(c,o);for(var g=0;g<i.length;g++){d=(p=i._models[g]).get("ds6w:label_value");var _="search-category-item-rounded";if(u=p.get("preview_url"),e.is(u)||(u=p.get("type_icon_url"),_=""),c.item.push(t.create("li",{class:"search-category-item"}).inject(c.container)),(h=c.item[c.item.length-1]).model=p,e.is(p)&&h.addEventListener("click",(function(e){a._onClickItem(e)})),e.is(u)&&t.create("img",{src:u,class:_}).inject(h),e.is(d)){var m=t.create("div",{html:d,title:d}).inject(h);m.setAttribute("title",d),a._resizeCategorySuggestion(m)}}c.img.src=p.get("type_icon_url")}else this._deactivateCategory(c)}},_updateCategoryApp:function(n,i){var s="App",o=this.elements.categories.filter((e=>e.container.id.includes(s)));if(o.length>0&&i>0){var a=o[0];this._clearCategory(a.container),this._showCategory(a.container);var r,c=a.label;if(c.setText(s+" ("+i+")"),c.setAttribute("count",i),c.setAttribute("title",s),n.length>0){this._activateCategory(a,i);for(var l=0;l<n.length;l++)if(e.is(n[l].id)){if(a.item.push(t.create("div",{class:"search-category-item-horizontal",id:n[l].id}).inject(a.itemContainer)),(r=a.item[a.item.length-1]).addEventListener("click",function(e){this._onClickItemApp(e)}.bind(this)),e.is(n[l].icon)&&t.create("img",{src:n[l].icon}).inject(r),e.is(n[l].title)){r.title=n[l].title;var d=t.create("div",{class:"search-category-item-horizontal-title",html:n[l].title}).inject(r);d.setAttribute("title",n[l].title),this._resizeCategoryAppTitle(d)}if(e.is(n[l].type)&&"Widget"===n[l].type){var u=t.create("div",{class:"search-category-app-widget-container"}).inject(r);t.create("div",{class:"search-category-app-widget-icon"}).inject(u)}}}else this._deactivateCategory(a)}},_onClickItem:function(t){var n=t.currentTarget.model,i=n.getSourceID(),s=n.getServiceID(),o=n.getPlatformID(),r=n.get("resourceid"),c=S.buildCompassSelectionData({widgetId:"",selectedModels:[n]});if(this._compass_socket.dispatchEvent("onSetX3DContent",c),a.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"ClickOnResult",persDim:{pd1:n._attributes["ds6w:label_value"],pd2:n._attributes["ds6w:responsible"],pd3:n._attributes["ds6w:created"],pd4:n._attributes["ds6w:community"],pd5:n._attributes["ds6w:type"],pd6:c.source,pd7:s}}}),"3dspace"===i){let e=t.target.title;w.dispatch("onViewSearch",[{displayString:e,query:'[ds6w:label]:"'+e+'"'}])}else T.getServiceUrl({serviceName:s,platformId:o,onComplete:function(t){M.load({serviceID:s,platformID:o,serviceURL:t}).then((function(i){if(e.is(i.getDoubleClickAction,"function")){let s={model:n,appID:p.getSearchAppId(),client_feature:"search_topbar_suggest",serviceURL:t,onComplete:function(t){e.is(t)&&e.is(t.id,"string")&&e.is(t.sourceJS,"string")&&t.sourceJS.length>0&&require([t.sourceJS],(function(e){e.executeAction({action_id:t.id,actionsHelper:{getModel:function(){return n},getPlatformID:function(){return o},getClientInfo:function(){return p.identifyClientInfo("")},getValue:function(e){var t=e.predicate?e.predicate:e.attribute;return n.get(t+"_value")}},object_ids:[r]})}))},onFailure:function(e){console.log(e)}};i.getDoubleClickAction.call(void 0,s)}}))}})},_onClickItemApp:function(t){e.is(t.currentTarget.id)&&x.launchApplicationFormCompass(t.currentTarget.id).then((function(e){S._displayAlert({message:e,className:"success"})}),(function(e){S._displayAlert({message:e,className:"error"})}))},_onClickViewAll:function(t,n){if(!e.is(n)||!n.target.hasClassName("search-category-label-empty")){var i=this.getInputValue(),s=y.buildSearchParams({category_id:t,search_text:i});s.objectToPreview="instantSearch",w.dispatch("onViewSearch",[e.extend({displayString:i},s)])}},_resizeCategorySuggestion:function(e){let t=window.getComputedStyle(e,null).getPropertyValue("font");if(0!==e.offsetWidth&&e.offsetWidth<=this.getTextWidth(e.textContent,t)){for(var n=e.textContent,i=0;i<50&&this.getTextWidth(n+"...")>e.offsetWidth-26;)n=n.slice(0,n.length-2),i++;e.setText(n+"...")}},_resizeCategoryAppTitle:function(e){window.getComputedStyle(e,null).getPropertyValue("font");if(0!==e.offsetWidth){for(var t=e.textContent,n=e.getParent().getParent().getSize().width,i=0;i<50&&this.getTextWidth(t+"...")>n/4;)t=t.slice(0,t.length-2),i++;i>0&&e.setText(t+"...")}},_isPredefinedQueryInstantSearch:function(e){return/^(\w{3}[:]$)/.test(e)},refreshCategories:function(){this._getSuggestCategoriesResult(this.getInputValue())},_clearDropDown:function(){this._hideSuggestSpinner();for(var e=0;e<this.elements.categories.length;e++)this._clearCategory(this.elements.categories[e].container),this._hideCategory(this.elements.categories[e].container);this._hideCategoryContainer()},_clearCategory:function(e){for(var t=e.getChildren(),n=0;n<t.length;n++)if(t[n].hasClassName("search-category-item-container"))for(var i=t[n].getChildren(),s=0;s<i.length;s++)i[s].destroy();else t[n].hasClassName("search-category-label-container")||t[n].destroy()},_hideCategory:function(e){this._clearCategory(e)&&e.hide()},_showCategory:function(e){e.show()},_activateCategory:function(t,n){t.labelContainer.hasClassName("search-category-label-empty")&&t.labelContainer.removeClassName("search-category-label-empty"),e.is(t.img)&&e.is(t.img.src)&&t.img.show(),e.is(t.viewAll)&&e.is(t.viewAll.show)&&(e.is(n)&&n<1?t.viewAll.hide():t.viewAll.show())},_deactivateCategory:function(t){t.labelContainer.hasClassName("search-category-label-empty")||t.labelContainer.addClassName("search-category-label-empty"),e.is(t.img)&&e.is(t.img.src)&&t.img.hide(),e.is(t.viewAll)&&e.is(t.viewAll.hide)&&t.viewAll.hide()},_hideSuggestSpinner:function(){e.is(this.elements.suggestSpinnerContainer)&&this.elements.suggestSpinnerContainer.hide()},_showSuggestSpinner:function(){e.is(this.elements.suggestSpinnerContainer)&&this.elements.suggestSpinnerContainer.show()},_hideCategoryContainer:function(){this.elements.categoriesContainer.isHidden()||this.elements.categoriesContainer.hide()},_showCategoryContainer:function(){this.elements.categoriesContainer.isHidden()&&this.elements.categoriesContainer.show()},isDropDownVisible:function(){return!this.elements.suggestsContainer.isHidden()},setInContextMode:function(e){this._inContextMode=e,!0===e&&!0===this.betaProgramState&&this._clearDropDown()},getInContextMode:function(){return!!e.is(this._inContextMode)&&this._inContextMode},_suggestPreviousQueries:function(t,n){var i=null,s=null;if(0===this._typeList.length&&(this._typeList=g.getSearchTypeCustoList()),this._isTypeListMode=!1,this._value=n,this._typeList.length&&0===n.length&&(i=this._typeList,this._isTypeListMode=!0),e.is(localStorage.SNSearchBoxStore)){i=JSON.parse(localStorage.SNSearchBoxStore);var o=[];n&&""!==n.replace(/\s+/g,"")?i.forEach((function(e){0===e.indexOf(n)&&e!==n&&o.push(e)})):o=i,s=o.reverse();var a=10;!0===h.getOption("search_compact_mode")&&(a=h.getOption("suggest_max")),!0===this.betaProgramState&&!0!==this._inContextMode&&this.secondaryMenu.currentMode!=A.search_current_tab&&this.getInputValue().length>=3&&(a=2),s.length>a&&(s=s.slice(0,a)),t.dispatchEvent("onUpdateSuggests",[s]),t.typeTimeout=null}else t.dispatchEvent("onUpdateSuggests",[s]);this.historySuggestions=s},getServerSuggestions:function(t){var n,i=this,s={query:t.replace(/^\s+|\s+$/g,""),input:t.replace(/^\s+|\s+$/g,"").split(" ")};if(e.is(i.secondaryMenu)&&e.is(i.secondaryMenu.getCurrentTenant)&&(n=i.secondaryMenu.getCurrentTenant()),t.length){if(!0===p.isSuggestAvailable(n)){this.getSearchResources().then((function(){m.login({resources:i._src_ressource,onComplete:function(){!function(){var t=h.getOption("suggest_length"),n=h.getOption("suggest_max_length");if(s.query.length>t-1&&s.query.length<n&&!e.is(i._inContextOptions)&&i.elements.input.placeholder===i._getPlaceHolderTextDependingOnActiveTenant("searchNew")){i._suggestionsInPipeline++;var o=O.getIcon(),a=O.getEnterpriseConceptsSuggestions(s.query);!1===i._src_ressource.getSuggestions(s,(function(t){C.all([a,o]).then((function([n,s]){t=O._prioritizeSuggestions(t,n),i._suggestionsInPipeline--;var o=(t=t||[]).map((function(t){return e.is(t.isEnterpriseConcept)&&s?t.icon=s:t.icon="lightbulb",{label:t.entry,command:t.entry,icon:t.icon,highLight:e.is(t.isEnterpriseConcept)?t.highLight:void 0}}));i._cancel_suggest_update||o.length>0&&0===i._suggestionsInPipeline&&i.dispatchEvent("onUpdateSuggests",{serverSuggests:o})}))}))&&i._suggestionsInPipeline--}}()},onFailure:function(){}})}))}}else i.dispatchEvent("onUpdateSuggests",{serverSuggests:[]})},getSearchResources:function(){return this._searchResourcesSet.promise},_buildSearchChoice:function(t){var n=t.sources,i=this;a.subscribe({channel:"TopBar_Suggest",topic:"CancelSuggest",callback:function(){i._cancel_suggest_update=!0}});this.elements;if(this.elements.container.addEvent("drop",(function(e){var t=null,n=!!document.documentMode,i=!n&&!!window.StyleMedia;if(n||i||""===e.dataTransfer.getData("shortData")){if(""!==e.dataTransfer.getData("text")){var s=JSON.parse(e.dataTransfer.getData("text"));t=[],s.data.items.forEach((function(e){t.push('"'+e.displayName+'"')}))}}else e.preventDefault(),t=JSON.parse(e.dataTransfer.getData("shortData"));e.target.value=t.join(" OR "),e.stopPropagation(),e.preventDefault()})),this.elements.container.addEvent("paste",(function(t){var n,s=A.search;if(e.is(i.secondaryMenu)&&e.is(i.secondaryMenu.getCurrentTenant)&&(n=i.secondaryMenu.getCurrentTenant()),e.is(n)&&"OnPremise"!==n.tenantId&&e.is(i.secondaryMenu)&&!i.secondaryMenu.isSingleTenant()?s+=" "+n.tenantName:s=A.searchNew,i.elements.input.placeholder===s||i.elements.input.placeholder===A.search_current_tab){var o=0;if(e.is(t.target)&&e.is(t.target.selectionStart)&&e.is(t.target.selectionEnd)&&(o=t.target.value.length-(t.target.selectionEnd-t.target.selectionStart)),0===o&&e.is(t)){var a=null;e.is(t.clipboardData)&&e.is(t.clipboardData.getData,"function")?(a=t.clipboardData.getData("text/plain"),i.getServerSuggestions(a)):e.is(window.clipboardData)&&e.is(window.clipboardData.getData,"function")&&(a=window.clipboardData.getData("Text"),i.getServerSuggestions(a));var r="";if(e.is(a,"string")&&a.length>0){var c=a.indexOf("\t")>=0,l=a.indexOf("\n")>=0,d=a.indexOf("||")>=0,u=a.indexOf("&&")>=0,p=a.indexOf("\\&&")>=0,g=a.indexOf("\\||")>=0;if(i._setInternalCriteria(a),!1===c&&!1===l&&!1===d&&!1===u)return void i.showClearSearchButton();var _=a.split("\n"),m="",S=!1;if(e.is(_,"array")&&_.length>0){for(var f=0,C=_.length;f<C;f++)if(e.is(_[f],"string")&&(_[f]=_[f].trim(),_[f].length>0)){var y=null,v="AND";c=(m=_[f]).indexOf("\t")>=0,d=m.indexOf("||")>=0,u=m.indexOf("&&")>=0,p=m.indexOf("\\&&")>=0,g=m.indexOf("\\||")>=0,!0===p&&(m=m.replace(/\\\&/g,"##__##")),!0===g&&(m=m.replace(/\\\|/g,"__##__")),!0===c?y=m.split("\t"):!0===u?y=m.split("&&"):!0===d?(y=m.split("||"),v="OR"):y=[m];for(var b="",w=0,D=y.length;w<D;w++)e.is(y[w],"string")&&(y[w].trim(),y[w].length>0&&(!0===p&&(y[w]=y[w].replace(/##__##/g,"&")),!0===g&&(y[w]=y[w].replace(/__##__/g,"|")),b.length>0&&(b+=" "+v+" "),y[w].length>1&&'"'===y[w][0]&&'"'===y[w][y[w].length-1]&&(y[w]=y[w].substr(1,y[w].length-2)),y[w]=y[w].replace(/\\([\s\S])|(")/g,"\\$1$2"),b+='"'+y[w]+'"'));b.length>0&&(!0===S&&(r+=" OR "),C>1&&(r+="("),r+=b,C>1&&(r+=")"),S=!0)}var I=h.getOption("maxTopBarInput");r.length>I&&(r=r.substring(0,I)),t.target.value=r,r.length>0&&i.showClearSearchButton(),t.stopPropagation(),t.preventDefault()}}}}})),e.is(n)||(n=this.options.allSources),!e.is(n,"object"))throw new Error("Invalid value for allSources in SearchAutocomplete._buildSearchChoice!");n.loadPredicates=!0,this._src_ressource=new d(n),this._searchResourcesSet.resolve(),this._cstoreSources=this._src_ressource.getAvailableTenants(),this._cstoreSources.length>1&&(P=!0),e.is(this._cstoreSources,"array")&&this._cstoreSources.length>0&&(L=this._cstoreSources[0].tenantId),p.setAutocompleteRendered()},_getSearchBtn:function(){return null===this._searchBtn&&(this._searchBtn=e.extendElement(document.body).getElement(".run_btn_search")),this._searchBtn},_changeSearchBtnIcon:function(t){var n=this._getSearchBtn();if(e.is(n)){for(var i=n.classList,s=new RegExp("fonticon-\\S+$"),o=0;o<i.length;o++)s.test(i[o])&&n.removeClassName(i[o]);n.addClassName(t)}},setInAppContext:function(t){!1===t.isInAppContext&&(this._inContextOptions=null),this._inAppContext=t.isInAppContext,!0===t.isInAppContext&&e.is(t.data)&&e.is(t.data.search_criteria_to_display,"string")?this.setFieldValue(t.data.search_criteria_to_display):(this.secondaryMenu.currentMode,A.search_current_tab,this.setFieldValue("")),this._temporarilyOutOfContext=!1},_setFindInApp:function(t){if(this._internalSearchCriteria=null,this._setPlaceHolderValue(A.get("find_in_app")),e.is(this._sitChoice)&&(this._sitChoice.setHTML(A.get("find_in_app")),this._sitChoice.getParent().addClassName("selected")),e.is(t)&&e.is(t.tenant)){if(this.options.events.setSourceCStorage(t.tenant),this._cstoreSources.length>1&&e.is(this._cstoreChoice)&&this._cstoreChoice.length>0)for(var n=0;n<this._cstoreSources.length;n++)this._cstoreSources[n].tenantId===t.tenant?this._cstoreChoice[n].getParent().addClassName("active"):this._cstoreChoice[n].getParent().removeClassName("active");this._setPlaceHolderValue(this._getPlaceHolderTextDependingOnActiveTenant("find_in_app"))}else this.options.events.setSourceCStorage(L);this._inContextOptions=t},setFindInApp:function(e){this.keepPreviousSearchMode(),this._setFindInApp(e)},keepPreviousSearchMode:function(){this.elements.input.placeholder===this._findInTabNLS||this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("find_in_app")?this._previouslyActiveSource=p.SearchTypeEnum.SEARCH_IN:this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("search")?this._previouslyActiveSource=p.SearchTypeEnum.SEARCH:this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("mycontent")?this._previouslyActiveSource=p.SearchTypeEnum.MY_CONTENT:this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("adv_search")?this._previouslyActiveSource=p.SearchTypeEnum.ADVANCED_SEARCH:this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("MySavedSearches")?this._previouslyActiveSource=p.SearchTypeEnum.FAVORITE_SEARCH:this._previouslyActiveSource=p.SearchTypeEnum.SEARCH_IN},onSwitchToFindInApp:function(e){this._setFindInApp(e)},buildSkeleton:function(){var e=this.elements,n=this.options.className;e.form=t.create("form",{class:n,autocomplete:"off"}),e.inputContainer=t.create("div",{class:n+"-searchbox"}).inject(e.form),e.input=t.create("input",{class:n+"-input",placeholder:this.options.placeholder,type:"text",maxlength:h.getOption("maxTopBarInput")}).inject(e.inputContainer),this.resetInput(),e.suggestsContainer=t.create("div",{class:n+"-suggests"}).inject(e.form),e.serverSuggests=t.create("ul",{id:"search-suggests-server"}).inject(e.suggestsContainer),e.suggests=t.create("ul",{id:"search-suggests-history"}).inject(e.suggestsContainer),e.container=e.form,!0===this.betaProgramState&&(e.suggestSpinnerContainer=t.create("ul",{id:"search-suggests-spinner-container",class:"search-suggests-spinner-container"}).inject(e.suggestsContainer).hide(),e.suggestSpinner=new D({className:"search-suggests-spinner"}).inject(e.suggestSpinnerContainer).show(),this._buildCategories())},getSuggestions:function(t){var n,i,s,o=this;if(t)return this.dataCache[t]?(this.dispatchEvent("onUpdateSuggests",[this.dataCache[t]]),void(this.typeTimeout=null)):this.options.suggestUrl&&(n=(s=this.options.suggestUrl.split("?"))[0],i=s[1].replace("{text}",t),e.is(this.options.source))?(i=this.options.source.getServicesData("suggest",t),UWA.Data.request(n,{method:this.options.method||"POST",data:this.options.data||i,type:this.options.type||"json",headers:this.options.headers||{"Content-Type":"application/json"},onComplete:function(e){return(e=o.dataParse(e)).length>0&&(o.dataCache[t]=e,o.dispatchEvent("onUpdateSuggests",[e])),o.typeTimeout=null,o.typeTimeout},proxy:this.options.proxy||null})):void 0},onUpdateSuggests:function(t){this.dispatchEvent("onShowSuggests");var n,i,s,o=this.elements,r=this;null===t&&(o.suggests.empty(),o.serverSuggests.empty()),e.is(t)&&e.is(t.serverSuggests,"array")&&t.serverSuggests.length>0?(o.suggestsContainer.show(),s=t.serverSuggests,o.serverSuggests.empty(),r.serverSuggests={},s.forEach((function(e){n=r.createSuggestElement(!0,e.command,e.icon,e.highLight,o.serverSuggests,e.label),r.resizeText(n),r.serverSuggests[e.command]=r.querySuggest(e),n.addEvent("click",(function(){a.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"ClickOnSuggestionIndex",persDim:{pd1:e.label}}}),r.dispatchEvent("onSelect",[e.command,r.serverSuggests[e.command]])}))}))):(e.is(t)&&e.is(t.history,"Array")||Array.isArray(t))&&(s=t.history||t,o.suggests.empty(),o.serverSuggests.empty(),s.forEach((function(e){i=r.getFormattedSuggest(e),n=r.createSuggestElement(!1,i,"clock",o.input.value,o.suggests),r.resizeText(n),n.addEvent("click",(function(e){var t=e.currentTarget.title,n=r.historySuggestions.findIndex((e=>e===t));a.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"ClickOnSuggestionHistory",persDim:{pd1:t,pd2:"index: "+n}}}),r.dispatchEvent("onSelect",[t,e])}))}))),0===o.suggests.childElementCount&&0===o.serverSuggests.childElementCount&&(!1===this.betaProgramState||e.is(o.categoriesContainer)&&o.categoriesContainer.isHidden())?o.suggestsContainer.hide():o.suggestsContainer.show(),0===o.suggests.childElementCount?o.suggests.hide():o.suggests.show(),0===o.serverSuggests.childElementCount?o.serverSuggests.hide():o.serverSuggests.show()},onHideSuggests:function(){this.elements.container.removeClassName(this.options.className+"-suggestsDisplayed")},onShowSuggests:function(){this.elements.container.addClassName(this.options.className+"-suggestsDisplayed")},createSuggestElement:function(n,i,s,o,a,r){var c,l,d;(l=n?t.create("div",{class:"search-suggest-div-element",title:i}):t.create("div",{class:"search-history-div-element",title:i}),s)&&(p.iconURL_check(s)?((d=t.create("span",{class:"fonticon"})).inject(l),t.create("img",{src:s,width:"17px",height:"auto"}).inject(d)):(s.startsWith("fonticon-")&&(s=s.replace(/fonticon-/g,"")),(d=t.create("span",{class:"fonticon fonticon-"+(s||"clock")})).inject(l)));if((c=n?t.create("a",{class:"search-suggest-element"}).inject(l):t.create("a",{class:"search-history-element"}).inject(l)).setText(i),o||(o=e.String.escapeHTML(this.elements.input.value.split(" ").pop())),o&&r){function _(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}(r=e.String.escapeHTML(r||""))&&i!==r&&(c.innerHTML='<span style="color:#ccc; font-size:13px;">'+function(e,t,n){let i=e;if(i){let e=i.lastIndexOf(t);e>=0&&(i=i.substring(0,e)+n+i.substring(e+t.length))}return i}(c.innerHTML,r,"</span>"+r));var u=_(o),h=new RegExp(u+"(?!.*"+u+")","i"),g=r.replace(h,"<strong>$&</strong>");c.innerHTML=g}return l.inject(a),l},onClick:function(e){a.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"focusOnSearchField"}}),-1===this.elements.form.className.indexOf("nv-autocomplete-suggestsDisplayed")&&this.onFocus(e),!0===this.betaProgramState&&!0!==this._inContextMode&&this.refreshCategories()},onFocus:function(){if(this._cancel_suggest_update=!1,this._inContextOptions&&this._inContextOptions.advanced_search&&this._inContextOptions.advanced_search.exclusive)this.dispatchEvent("onUpdateSuggests",[[]]);else{var e=this.getInputValue();this._suggestPreviousQueries(this,e),this.getServerSuggestions(e),this.dispatchEvent("onShowSuggests"),""===e&&!0===h.options.search_settings.search_on_keyup&&this.dispatchEvent("defaultSearch",{value:"*"})}},onBlur:function(){!0!==this.preventBlur?setTimeout(function(){this.dispatchEvent("onHideSuggests"),e.is(this.elements.searchOptions)&&this.elements.searchOptions._secondaryMenu.hide(),this._cancel_suggest_update=!0}.bind(this),200):this.preventBlur=!1},onKeyUp:function(t){var i=this;if(38!==t.keyCode&&40!==t.keyCode&&37!==t.keyCode&&39!==t.keyCode&&35!==t.keyCode&&36!==t.keyCode&&27!==t.keyCode){if(e.is(this.elements.input)&&"?"===this.getInputValue())return this.setFieldValue(""),void this._showPQSelectionUX();this._setInternalCriteria(null);var s=t.srcElement;if(s.value.length>=s.maxLength){var o={level:"warning",title:A.get("searchFieldMaxLengthTitle"),message:A.replace(A.get("searchFieldMaxLengthText"),{number:h.getOption("maxTopBarInput")}),sticky:!0,poNotifId:"search-query-long"};b.removeLastNotificationDisplayed(),v.addNotif(o)}var a=n.getElement(t);a.value?a.value.length>0?(this.showClearSearchButton(),this._suggestPreviousQueries(this,a.value)):(this.elements.input.placeholder!==A.search_current_tab&&this.hideClearSearchButton(),this._suggestPreviousQueries(this,a.value)):(this.elements.input.placeholder!==this._findInTabNLS&&this.elements.input.placeholder!==A.search_current_tab&&this.hideClearSearchButton(),this._suggestPreviousQueries(this,a.value)),!1===h.options.search_settings.search_on_keyup?!0===this.betaProgramState&&!0!==this._inContextMode&&this.secondaryMenu.currentMode!=A.search_current_tab?(i._getSuggestCategoriesResult(a.value),clearTimeout(this._suggestTimeout),this._suggestTimeout=setTimeout((function(){i.getServerSuggestions(a.value)}),350)):(clearTimeout(this._suggestTimeout),this._suggestTimeout=setTimeout((function(){i.getServerSuggestions(a.value)}),350)):(a.value&&0===a.value.length&&clearTimeout(this._secondTimeoutId),clearTimeout(this._timeoutId),this._timeoutId=setTimeout(function(e){return function(){e&&e.length>0&&i.options.events.onSearch(e),i._suggestPreviousQueries(i,e),clearTimeout(i._suggestTimeout),i._suggestTimeout=setTimeout((function(){i.getServerSuggestions(e)}),350)}}(a.value),500))}},onKeyDown:function(e){var t=UWA.Event.whichKey(e);38===e.keyCode?this._arrowKeyOnSuggestions(e,-1):40===e.keyCode?this._arrowKeyOnSuggestions(e,1):27===e.keyCode?this._escapeKeyOnSuggestions(e):"ctrl+a"===t&&e.stopPropagation()},attachEvents:function(){var t;(t=this.elements).input.addEvent("keyup",this.onKeyUp.bind(this)),-1===["iphone","ipad","android"].indexOf(p.getDeviceCategory())?t.input.addEvent("blur",this.onBlur.bind(this)):t.input.addEvent("focusout",this.onBlur.bind(this)),t.input.addEvent("focus",this.onFocus.bind(this)),t.form.addEvent("submit",function(i){var s=this.itemCache[t.input.value.toLowerCase()];return a.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"HitOnEnter-SearchField",persDim:{pd1:t.input.value}}}),n.stop(i),e.is(this.serverSuggests)&&-1!==Object.keys(this.serverSuggests).indexOf(t.input.value)?(this.dispatchEvent("onSelect",[t.input.value,this.serverSuggests[t.input.value]]),t.input.blur(),this.dispatchEvent("onHideSuggests")):this.options.shouldExist&&!s||(this.options.suggestKey&&s&&(t.input.value=s[this.options.suggestKey]),this.dispatchEvent("onSelect",[t.input.value,s]),t.input.blur(),this.dispatchEvent("onHideSuggests")),!1}.bind(this)),(t=this.elements).input.addEvent("keydown",this.onKeyDown.bind(this)),t.input.addEvent("click",this.onClick.bind(this))},dataParse:function(t){var n,i,s,o=this.options.dataParser;if(e.is(o,"function"))t=o(t);else{if(Json.isJson(t))t=Json.decode(t),s=!0;else for(n in t=Json.xmlToJson(t))if(t.hasOwnProperty(n)){t=t[n];break}for(n in t)t.hasOwnProperty(n)&&(i||(i=n),Array.isArray(t[n])&&(t=t[n],s=!0));!s&&i&&(t=[t[i]])}return Array.isArray(t)?t:[]},_escapeKeyOnSuggestions:function(){this.dispatchEvent("onHideSuggests")},_arrowKeyOnSuggestions:function(t,i){var s=this._getSuggestions().getChildren()[0].getChildren().concat(this._getSuggestions().getChildren()[1].getChildren());if(!0===this.betaProgramState)for(var o=0;o<this.elements.categories.length;o++)for(var a=0;a<this.elements.categories[o].item.length;a++)s.push(this.elements.categories[o].item[a]);if(!(s.length<1)){this.dispatchEvent("onShowSuggests");var r=-1,c=-1;for(o=0;o<s.length;o++)if(s[o].hasClassName("suggestion-selected")){r=o;break}if((c=r+i)<0&&(c=s.length-1),c>s.length-1&&(c=0),r>=0&&s[r].removeClassName("suggestion-selected"),c>=0){s[c].addClassName("suggestion-selected");var l=n.getElement(t);e.is(l)&&(l.value=s[c].getText()),this.showClearSearchButton()}}},_showPQSelectionUX:function(){this.dispatchEvent("showPQListUX")},onSelect:function(t,n,i){e.is(i,"string")&&i.length>0&&(this._isTypeListMode=!0,this._value=""),this._setInputValue(t),this.dispatchEvent("onHideSuggests"),this.showClearSearchButton()},_getClearSearchBtn:function(){return null===this._clearSearch&&(this._clearSearch=e.extendElement(document.body).getElement(".clear_btn_search")),this._clearSearch},showClearSearchButton:function(){var t=this._getClearSearchBtn();if(e.is(t)&&e.is(t.show,"function")){t.setStyle("display","inline-block"),t.show();var n=e.extendElement(document.body).getElement(".nv-autocomplete-input");e.is(n)&&n.addClassName("clear-visible")}},hideClearSearchButton:function(){var t=this._getClearSearchBtn();if(e.is(t)&&e.is(t.hide,"function")){t.hide();var n=e.extendElement(document.body).getElement(".nv-autocomplete-input");e.is(n)&&n.removeClassName("clear-visible")}},_setPlaceHolderValue:function(t){if(!e.is(t,"string"))throw new Error("Bad arg in _setPlaceHolderValue!");switch(t){case A.get("MySavedSearches"):this._changeSearchBtnIcon("fonticon-favorite-on");break;case A.get("mycontent"):this._changeSearchBtnIcon("fonticon-user");break;case A.get("search"):this._changeSearchBtnIcon("fonticon-search");break;case A.get("similar_search"):this._changeSearchBtnIcon("fonticon-search-similar");break;case this._findInTabNLS:this._changeSearchBtnIcon("fonticon-filter");break;case A.get("adv_search"):this._changeSearchBtnIcon("fonticon-search-cog");break;default:this._changeSearchBtnIcon("fonticon-search")}if(!e.is(this.elements.input)||!e.is(this.elements.input.placeholder))throw new Error("placeholder not found!");this.elements.input.placeholder=t},getPlaceHolder:function(){return this.elements.input.placeholder},_getSuggestions:function(){return null===this._autocompleteSuggests&&(this._autocompleteSuggests=e.extendElement(document.body).getElement(".nv-autocomplete-suggests")),this._autocompleteSuggests},_setInputValue:function(e){this.elements.input.value=e},getInputValue:function(){return void 0===this.elements.input.value?"":this.elements.input.value},setFieldValue:function(t){this._setInputValue(t),this._searchStringToDisplayInSearchField=t,e.is(t,"string")&&t.length>0?this.showClearSearchButton():this.hideClearSearchButton()},_setInternalCriteria:function(e){this._internalSearchCriteria=e},_getPlaceHolderTextDependingOnActiveTenant:function(t){if(!e.is(t,"string")||0===t.length)throw new Error("E_INVALIDARG: need a key !");var n=A.get(t);return this._cstoreSources.length>1&&(e.is(A[t+"_in_active"])?n=A.replace(A.get(t+"_in_active"),{tenant:this.getSelectedTenant().displayName}):n+=" "+this.getSelectedTenant().displayName),n},isMultiTenantContext:function(){return P},setSelectedTenant:function(t){L=t,e.is(this._src_ressource)&&this._src_ressource.setActiveTenant(L)},getSelectedTenant:function(){if(!P)throw new Error("E_INVALIDARG: not in multi tenant context, check first using isMultiTenantContext before calling this function !");var t=null;if(e.is(this.secondaryMenu)&&e.is(this.secondaryMenu.getCurrentTenant)){var n=this.secondaryMenu.getCurrentTenant();t={tenantId:n.tenantId,displayName:n.tenantName}}return null===t&&(t={tenantId:L,displayName:L}),t},_findInthisTabOnClick:function(e){!0===e&&this._restoreActiveSearchInTab(),p.isOneSearchInternalProd()&&(u.setItem("find_in_this_tab_default",e),h.changeSettings({find_in_this_tab_default:e}),u.commit())},_restoreActiveSearchInTab:function(){var t=this;if("3DDashboard"===p.identifyClientInfo().identifier){require(["DS/Dashboard/PublicAPI"],(function(n){var i=n.getActiveTab();e.is(i)&&e.is(i.shouldPropagateSearch)&&!0===i.shouldPropagateSearch&&e.is(i.shouldPropagateSearchArg,"string")&&0<i.shouldPropagateSearchArg.length&&t.setFieldValue(i.shouldPropagateSearchArg)}))}},getFocus:function(){this.elements.input.focus()},querySuggest:function(e){return{search_type:"#search",value:e.command,searchStringToDisplayInSearchField:e.label,internalSearchCriteria:null,adv_search:!1}},resetInput:function(){this.elements.input.placeholder?this._setInputValue(""):this._setInputValue(this.options.placeholder),this.resetCache()},resetCache:function(){this.dataCache={},this.itemCache={}},resizeText:function(e){var t=e.getElementsByTagName("a")[0],n=e.getElementsByTagName("span")[0],i=window.getComputedStyle(t,null).getPropertyValue("font");if(0!==e.offsetWidth&&0!==n.offsetWidth&&e.offsetWidth-n.offsetWidth-20<=this.getTextWidth(t.text,i)){for(var s=t.text,o=0;o<50&&this.getTextWidth(s+"...")>e.offsetWidth-n.offsetWidth-20;)s=s.slice(0,s.length-2),o++;t.setText(s+"...")}},getTextWidth:function(t,n){e.is(this.canvas)||(this.canvas=document.createElement("canvas"));var i=this.canvas.getContext("2d");return i.font=n,i.measureText(t).width},getFormattedSuggest:function(t){return this.options.suggestFormat.replace(/\{(\w+)\}/g,(function(n,i){return e.is(t,"string")?t:t[i]}))}})})),define("DS/SNSearchUX/SearchDropDown2",["UWA/Core","UWA/Element","UWA/Promise","UWA/Controls/Abstract","DS/SNInfraUX/Logger","DS/SNUQLEditor/SNUQLEditorUX","DS/SNSearchUX/utils/SearchOptionsPopup","DS/SNSearchUX/utils/SearchHelpPopup","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/ServiceDelegationLoader","DS/SNInfraUX/utils/SNCompassUtils","DS/SNInfraUX/SNSuggestionHelper","DS/SNInfraUX/SearchLogin","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/collections/SearchCollection","DS/SNResultUX/utils/ExternalComponentHelpers","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationPreferences","DS/SNSearchUX/dropdown/SearchDropDownPQs","DS/SNSearchUX/dropdown/SearchDropDownSettings","DS/SNSearchUX/dropdown/SearchDropDownUtils","DS/SNSearchUX/helpers/SmartQueryController","DS/UIKIT/Autocomplete","DS/UIKIT/Scroller","DS/UIKIT/SuperModal","DS/UIKIT/Spinner","DS/Controls/Button","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/PubSub/PubSub","DS/MessageBus/MessageBus","DS/PlatformAPI/PlatformAPI","DS/WebappsUtils/WebappsUtils","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/i3DXCompassServices/i3DXCompassPubSub","text!DS/SNSearchUX/assets/templates/SearchDropDown/SearchSettingsTabContent.html","css!DS/SNSearchUX/SNSearchUX.css","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json","i18n!DS/SNSearchUX/assets/nls/SearchDropDown.json","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/Api/SearchApi","text!DS/SNSearchUX/assets/templates/SearchDropDown/SearchDropDownNoHistory.html","DS/vue-3.4.15/vue","text!DS/SNSearchUX/assets/templates/SearchDropDown/SearchDropDownNoSearchSuggestions.html"],(function(e,t,n,i,s,o,a,r,c,l,d,u,h,p,g,_,m,S,f,C,y,v,b,w,D,I,E,T,x,M,N,k,A,O,P,L,U,V,Q,F,B,R,H,j,q,X,W,G){"use strict";return i.extend({tabContainerList:[],tabList:[],categoryList:[],categoryListFull:[],predefinedQueriesElementList:[],maxServerSuggestions:5,maxSuggests:10,limitReachedFUN141960:!1,isSuggestsCustom:!1,settings:{},webInwin:!1,maxResultDisplayedMyContent:5,_SearchDropDownPQs:null,_SearchDropDownSettings:null,_guidedMode:!1,_nlqMode:!1,_smartMode:!1,_helpssettings:!1,_tabletorientation:null,_lastMoveIndex:-1,_Isx2aIncontext:!1,init:function(t){this._lastMoveIndex=-1,this._Isx2aIncontext=!1,this._parent(t),e.is(t)&&e.is(t.eventManager)&&(this.eventManager=t.eventManager),!0===d.getOption("search_web_in_win")&&(this.webInwin=!0),this.collection=new f,this.build(t),this.initEvents()},clean:function(){document.body.removeEventListener("click",this._onClickbody.bind(this),!1),this._SearchDropDownSettings&&this._SearchDropDownSettings.destroy(),this._SearchDropDownPQs&&this._SearchDropDownPQs.destroy(),e.is(this._tabletorientation)&&O.unsubscribe(this._tabletorientation),w.clean()},initEvents:function(){A.add("search:addSuggestionsFromList",function(e){this.switchActiveTab(this.elements.instantSearchTabContainer),this.addSuggestList(e.suggestions,this.elements.suggestions)}.bind(this))},initSources:function(t){let n=this;n._srcRessource=t,n._SearchDropDownSettings&&n._SearchDropDownSettings.initSettings(n._srcRessource),l.isRoleAvailable(["CSV"],this._srcRessource.active_tenant,function(t){!0!==t&&(n.maxResultDisplayedMyContent=7,e.is(this.elements.predefinedQueriesTab)&&this.elements.predefinedQueriesTab.destroy(),e.is(this.elements.settingsTab)&&this.elements.settingsTab.destroy(),e.is(this.elements.buttonContainer)&&this.elements.buttonContainer.destroy(),e.is(this.elements.historyContainer)&&this.elements.historyContainer.setStyle("height","100%"),e.is(this.elements.myContentContainer)&&this.elements.myContentContainer.setStyle("height","100%"),e.is(this.elements.dropdownContainer)&&this.elements.dropdownContainer.addClassName("csv-role")),n._smartDropdown(t)}.bind(this))},_smartDropdown:function(t){let n=this,i=l.getDeviceType();if("tablet"===i||"mobile"===i)s.log("SearchDropDown2::initSources DeviceType: ",i);else{let i=d.getOption("GuidedMode",{tenant:n._srcRessource.getActiveTenant()}),s=d.getOption("NLQModeEnabled",{tenant:n._srcRessource.getActiveTenant()}),o=d.getOption("NLQMode"),a=d.getOption("GuidedSearch"),r=n._srcRessource.getActiveTenant();if(i&&t||s&&"onPremise"!==r||o){let r=!0,c=d.getOption("addinmode");if(!0!==this.webInwin||e.is(a)&&!1!==a?-1!==["solidworks","catiav5"].indexOf(c)&&(r=!1):r=!1,!0===r){n._smartMode=!0;let e={container:n.elements.smartQueriesActivationContainer,dropdown:n,state:!0,guidedModeBetaContainer:this.elements.guidedModeBetaContainer};i&&t&&(n._guidedMode=!0),(s||o)&&(n._nlqMode=!0),w._activationGuidedMode(e)}}}},build:function(n){let i=this;var s=this.elements;this.tabContainerList=[],this.tabList=[],document.body.addEventListener("click",i._onClickbody.bind(i),!1);var o="sn-search-field uwa-autocomplete nv-autocomplete";s.form=t.create("form",{class:o,autocomplete:"off"}),s.form.addEvent("paste",this.paste.bind(this)),s.form.addEvent("drop",this.drop.bind(this)),s.form.addEvent("submit",(e=>(e.preventDefault(),!1))),s.clearSearchButton=document.body.getElement(".clear_btn_search"),e.is(s.clearSearchButton)&&(s.clearSearchButton.addEventListener("mousedown",function(e){this.elements.dropdownContainer.hasClassName("autocomplete-hidden")||(this.noBlur=!0,this.setFocus())}.bind(this)),s.clearSearchButton.addEventListener("mouseup",function(e){}.bind(this))),s.runSearchButton=document.body.getElement(".run_btn_search"),e.is(s.runSearchButton)&&s.runSearchButton.addEventListener("mousedown",function(e){this.noBlur=!1,this.elements.dropdownContainer.addClassName("autocomplete-hidden")}.bind(this)),s.inputContainer=t.create("div",{class:o+"-searchbox"}).inject(s.form),s.input=t.create("input",{class:o+"-input",placeholder:"Search",type:"text"}).inject(s.inputContainer),s.input.addEvent("keyup",this.onKeyUp.bind(this)),s.input.addEvent("keydown",this.onKeyDown.bind(this)),s.input.addEvent("focus",this.onFocus.bind(this)),s.input.addEvent("click",this.onClick.bind(this));let a=l.getDeviceType();s.dropdownContainer=t.create("div",{class:o+"-container"+("tablet"===a&&"portrait"===l.getViewportOrientation()||"mobile"===a?" searchMobileFormat":"")}).addClassName("autocomplete-hidden").inject(s.form),i._tabletorientation=O.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"bodyWidthUpdate",callback:function(){let e=l.getDeviceType(),t=l.getViewportOrientation();"tablet"===e?(s.dropdownContainer.removeClassName("searchMobileFormat"),s.dropdownContainer.removeClassName("iphone"),"portrait"===t?(i.hideSettingPQs(),s.dropdownContainer.addClassName("searchMobileFormat"),s.dropdownContainer.addClassName("iphone")):"landscape"===t&&s.dropdownContainer.addClassName("searchMobileFormat")):"mobile"===e&&(s.dropdownContainer.removeClassName("landscape"),"landscape"===t&&s.dropdownContainer.addClassName("landscape"))}});let r=l.getViewportOrientation();"mobile"===a||"iphone"===l.getDeviceCategory()?(s.dropdownContainer.addClassName("iphone"),"landscape"===r&&s.dropdownContainer.addClassName("landscape")):"tablet"===a&&"portrait"===r?s.dropdownContainer.addClassName("iphone"):"tablet"===a&&"landscape"===r&&s.dropdownContainer.addClassName("searchMobileFormat"),s.dropdownContainer.addEvent("mousedown",function(e){document.activeElement.hasClassName("sn-search-field uwa-autocomplete nv-autocomplete-input")&&(this.noBlur=!0)}.bind(this)),s.dropdownContainer.addEventListener("click",function(e){if(this.isDropDownVisible()){if(this._smartMode&&"standardSearch"!==w._currentSearchMode)return;e.target.className.contains("predefined-queries-search-field")||this.setFocus()}}.bind(this)),-1===["iphone","ipad","android"].indexOf(l.getDeviceCategory())?s.input.addEvent("blur",this.onBlur.bind(this)):s.input.addEvent("focusout",this.onBlur.bind(this)),s.contentContainer=t.create("div",{class:"search-global-content-container"}).inject(s.dropdownContainer),s.tabContainer=t.create("div",{class:"search-global-footer-container"}).inject(s.dropdownContainer),s.contentEmbedded=t.create("div",{class:"search-global-embedded",id:"dropdown-search-global-embedded"}).inject(s.contentContainer),"iphone"===l.getDeviceCategory()&&s.tabContainer.addEventListener("touchstart",function(e){this.elements.dropdownContainer.addClassName("autocomplete-hidden"),e.stopImmediatePropagation()}.bind(this)),s.searchTabContainer=t.create("div",{class:"search-tab-container",tabindex:"-1"}).inject(s.contentContainer),s.searchDropdownHeader=t.create("div",{class:"search-dropdown-header"}).inject(s.searchTabContainer),s.searchDropdownInput=t.create("div",{class:"search-dropdown-guided-input"}).inject(s.searchTabContainer),s.searchTabContent=t.create("div",{class:"search-tab-content",styles:{display:"flex"}}).inject(s.searchTabContainer),this.tabContainerList.push(s.searchTabContent),s.historyContainer=t.create("div",{class:"history-container"}).inject(s.searchTabContent),s.historyContentContainer=t.create("div",{class:"history-container-content"}).inject(s.historyContainer),s.rightContentContainer=t.create("div",{class:"right-content-container"}).inject(s.searchTabContent),s.myContentContainer=t.create("div",{class:"mycontent-container"}).inject(s.rightContentContainer),s.myContentEmptyView=t.create("div",{class:"mycontent-empty-view"}).inject(s.myContentContainer).hide(),s.myContentEmptyViewImage=t.create("div",{class:"mycontent-empty-view-image fonticon fonticon-search"}).inject(s.myContentEmptyView),s.myContentEmptyViewMainText=t.create("div",{class:"mycontent-empty-view-text",text:R.get("search.noResults")}).inject(s.myContentEmptyView),s.myContentEmptyViewSubtext=t.create("div",{class:"mycontent-empty-view-subtext",text:R.get("search.myContent.noResults")}).inject(s.myContentEmptyView),s.myContentInContextEmpty=t.create("div",{class:"mycontent-empty-view"}).inject(s.myContentContainer),s.buttonContainer=t.create("div",{class:"search-tab-buttons-container"}).inject(s.rightContentContainer);let c={dropdown:i,container:s.buttonContainer,webInwin:i.webInwin,eventManager:i.eventManager,myContent:!0,favoriteSearch:!0,SimilarSearch:e.is(n.SimilarSearch)?n.SimilarSearch:void 0,PartSupply:e.is(n.PartSupply)?n.PartSupply:void 0,Relations:e.is(n.Relations)?n.Relations:void 0};w.buildheaderSection(c),s.settingsTabContainer=t.create("div",{class:"settings-tab-container"}).hide().inject(s.contentContainer),this.tabContainerList.push(s.settingsTabContainer),i._SearchDropDownSettings=new b({eventManager:i.eventManager,webInwin:i.webInwin,searchDropDown:i}),O.subscribe({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_switch_customization",callback:()=>{}}),i._SearchDropDownSettings.buildSettings(s.settingsTabContainer),s.predefinedQueriesTabContainer=t.create("div",{class:"predefined-queries-tab-container search-popup-content"}).hide().inject(s.contentContainer),i.tabContainerList.push(s.predefinedQueriesTabContainer),i._SearchDropDownPQs=new v({eventManager:i.eventManager,webInwin:i.webInwin,searchDropDown:i}),i._SearchDropDownPQs.buildHelp(s.predefinedQueriesTabContainer),s.instantSearchTabContainer=t.create("div",{class:"instant-search-tab-container"}).hide().inject(s.searchTabContainer),this.tabContainerList.push(s.instantSearchTabContainer),d.getOption("FUN141960")&&(s.instantSearchWarningMessage=t.create("div",{class:"instant-search-warning-message search-warning-message"}).inject(s.instantSearchTabContainer).hide(),i._buildWarningMessageNotification(s.instantSearchWarningMessage)),s.resultsContainer=t.create("div",{class:"guided-results-container"}).hide().inject(s.searchTabContainer),this.tabContainerList.push(s.resultsContainer),!1===this.webInwin&&this.eventManager&&this.eventManager.addListener("onResultDrag",function(){this.onBlur(null,!0),this.enableTopBarField()}.bind(this)),s.suggestionContainer=t.create("div",{class:"suggestion-container"}).inject(s.instantSearchTabContainer),s.suggestions=t.create("div",{class:"suggestion-container-content"}).inject(s.suggestionContainer),s.customSuggestions=t.create("div",{class:"custom-suggestion-container-content"}).hide().inject(s.suggestionContainer),s.instantSearchContainer=t.create("div",{class:"instant-search-container"}).inject(s.instantSearchTabContainer),s.instantSearchEmptyView=t.create("div",{class:"instant-search-empty-view"}).inject(s.instantSearchContainer).hide(),s.guidedSamples=t.create("div",{class:"guided-common-samples-container"}).inject(s.instantSearchTabContainer),s.predefinedQueriesTab=t.create("div",{class:"search-dropdown-tab-predefined-queries",id:"pqsDropdown"}).inject(s.tabContainer),s.predefinedQueriesTab.addEvent("click",(function(t){i.switchActiveTab(s.predefinedQueriesTabContainer,t.currentTarget),e.is(i._SearchDropDownPQs)&&(i.showSettingPQs(),i._SearchDropDownPQs.elements.predefinedQueriesTableBody&&0===i._SearchDropDownPQs.elements.predefinedQueriesTableBody.getChildren().length&&i._SearchDropDownPQs.createPredefinedQueriesComponent(),"standardSearch"==w._currentSearchMode?(w.guidedHelp&&w.guidedHelp.elements.container.addClassName("hidePQ"),i._SearchDropDownPQs.elements.typeShortcutsExpander&&i._SearchDropDownPQs.elements.typeShortcutsExpander.elements.container.removeClassName("hidePQ")):w._currentSearchMode.contains("guidedSearch")?(w._buildGuidedModeHelp(s.predefinedQueriesTabContainer),w.guidedHelp&&w.guidedHelp.elements.container.removeClassName("hidePQ"),i._SearchDropDownPQs.elements.typeShortcutsExpander&&i._SearchDropDownPQs.elements.typeShortcutsExpander.elements.container.addClassName("hidePQ")):(w.guidedHelp&&w.guidedHelp.elements.container.addClassName("hidePQ"),i._SearchDropDownPQs.elements.typeShortcutsExpander&&i._SearchDropDownPQs.elements.typeShortcutsExpander.elements.container.addClassName("hidePQ")))})),s.searchHelpTooltip=C.tooltip(s.predefinedQueriesTab,{title:l.escapeHtml(B.get("PredefinedQuery")),position:"bottom",reshowDelay:1,mouseRelativePosition:!0,longHelp:l.escapeHtml(B.get("PredefinedQuery.shortHelp"))}),this.tabList.push(s.predefinedQueriesTab),s.predefinedQueriesTabIcon=t.create("span",{class:"fonticon fonticon-help search-dropdown-tab-icon"}).inject(s.predefinedQueriesTab),s.predefinedQueriesTabText=t.create("div",{class:"search-dropdown-tab-text",text:R.get("search.tab.help"),title:R.get("search.tab.help")}).inject(s.predefinedQueriesTab),s.settingsTab=t.create("div",{class:"search-dropdown-tab-settings",id:"settingsDropdown"}).inject(s.tabContainer),s.settingsTab.addEvent("click",(function(t){let n=!1;i._smartMode&&(n=!0),i.switchActiveTab(s.settingsTabContainer,t.currentTarget,n),i._SearchDropDownSettings._initDefaultSettings(),e.is(i._SearchDropDownSettings)&&i.showSettingPQs()})),C.tooltip(s.settingsTab,{title:l.escapeHtml(B.get("SearchOptions")),position:"bottom",reshowDelay:1,mouseRelativePosition:!0,longHelp:l.escapeHtml(B.get("SearchOptions.shortHelp"))}),this.tabList.push(s.settingsTab),s.settingsTabIcon=t.create("span",{class:"fonticon fonticon-cog search-dropdown-tab-icon"}).inject(s.settingsTab),s.settingsTabText=t.create("div",{class:"search-dropdown-tab-text",text:R.get("search.tab.settings"),title:R.get("search.tab.settings")}).inject(s.settingsTab),s.searchTab=t.create("div",{class:"search-dropdown-tab-mycontent tab-selected"}).inject(s.tabContainer),s.searchTab.addEvent("click",function(e){this.activateSearchTab(e.currentTarget)}.bind(this)),this.tabList.push(s.searchTab),s.searchTabIcon=t.create("span",{class:"fonticon fonticon-search search-dropdown-tab-icon"}).inject(s.searchTab),s.searchTabText=t.create("div",{class:"search-dropdown-tab-text",text:R.get("search.tab.search"),title:R.get("search.tab.search")}).inject(s.searchTab),s.guidedModeBetaContainer=t.create("div",{class:"guidedModeBeta-container"}).hide().inject(s.contentContainer),this.tabContainerList.push(s.guidedModeBetaContainer),s.inContextActions=t.create("div",{class:"inContext-actions-container"}).hide().inject(s.searchTabContainer),this.buildHistories({historyContainer:this.elements.historyContainer,historyContentContainer:s.historyContentContainer}),this.categoryList=this._buildCategories(),s.container=s.form,O.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"InContextSophisticatedMode",callback:t=>{i.onBlur(void 0,!0),i._srcRessource=new h({active_tenant:t.tenant?t.tenant:l.getActiveTenant()});let n={dropdown:i,incontextOptions:t,srcRessource:i._srcRessource,webInwin:i.webInwin,eventManager:i.eventManager,inputValue:"",favoriteSearch:!0,SimilarSearch:e.is(i.getOption("SimilarSearch"))?i.getOption("SimilarSearch"):void 0,PartSupply:e.is(i.getOption("PartSupply"))?i.getOption("PartSupply"):void 0,Relations:e.is(i.getOption("Relations"))?i.getOption("Relations"):void 0,noresult:()=>{i.elements.myContentEmptyView&&i.elements.myContentEmptyView.show()}};w._isIncontextBuilderMode=!0,w.buildFullDropDown(n),i._createInstantSearchEmpty()}}),l.setAutocompleteRendered()},buildHistories:function(t){if(!e.is(t))return;const{historyContainer:n,historyContentContainer:i}=t;this.elements.historyContainer=n,this.elements.historyContentContainer=i;let s=[];this.getHistoryListFromLocalStorage().length>0?(this.destroySuggestionEmptyView(n),s.push({text:R.get("search.history"),action:"delete",isTitle:!0,icon:"clock"}),this.getHistoryListFromLocalStorage().slice(0,this.maxSuggests).forEach((function(e){s.push({text:e,action:"clear"})})),this.addSuggestList(s,i)):this.createSuggestionEmptyView(n)},getServerSuggestions:function(t){if(e.is(this._srcRessource)&&e.is(t,"string")){var n=_.getEnterpriseConceptsSuggestions(t),i=_.getIcon();this._srcRessource.getSuggestions({query:t},function(t){Promise.all([n,i]).then(function([n,i]){var s=[];(s=_._prioritizeSuggestions(t,n,!0)).slice(0,this.maxServerSuggestions);var o=this.getHistoryListFromLocalStorage(),a=s.length<o.length&&s.length<5?this.maxSuggests-s.length:5,r=o.length<s.length&&o.length<5?this.maxSuggests-o.length:5;let c=[];s.length>0&&c.push({text:R.get("search.suggestions"),isTitle:!0,icon:"status-ok"}),s.slice(0,r).forEach(function(t){e.is(t.isEnterpriseConcept)?c.push({text:t.entry,filter:t.highLight,type:"suggestion"}):c.push({text:t.entry,filter:this.getInputValue(),type:"suggestion"})}.bind(this)),c.push({text:R.get("search.history"),action:"delete",isTitle:!0,icon:"clock"});var d=0;o.forEach(function(e){e.toLowerCase().indexOf(this.getInputValue().trim().toLowerCase())>=0&&d<a&&(c.push({text:e,action:"clear",filter:this.getInputValue()}),d++)}.bind(this)),0===d&&(c=c.filter((e=>!(e.text===R.get("search.history"))))),c.length?(this.elements.suggestions.removeClassName("no-search-suggestions"),this.addSuggestList(c,this.elements.suggestions)):(G=(G=G.replace("###searchsuggestions###",l.escapeHtml(R.get("search.suggestions")))).replace("###nosuggestions###",l.escapeHtml(R.get("search.noSuggestions"))),this.elements.suggestions.addClassName("no-search-suggestions"),this.elements.suggestions.innerHTML=G)}.bind(this))}.bind(this))}},_getMyContentOptions:function(){return{dropdown:this,collection:this.collection,srcRessource:this._srcRessource,count:10,webInwin:this.webInwin}},refreshMyContent:function(){let e=this,t=this.getInputValue();if(this._inContextMode&&t.length)return this.inContextEmptyView||(this.inContextEmptyView=this._createInstantSearchemptyView(this.elements.myContentInContextEmpty)),this.inContextEmptyView.toShowComponent=!0,this.elements.myContentInContextEmpty.show(),this.elements.myContentEmptyView.hide(),void this.elements.myContentContainer.getElement(".search-multi-view").hide();this.inContextEmptyView&&(this.inContextEmptyView.toShowComponent=!1),this.elements.myContentInContextEmpty.hide();let n=e.maxResultDisplayedMyContent;e.elements.myContentEmptyView&&e.elements.myContentEmptyView.hide();let i={dropdown:e,container:e.elements.myContentContainer,collection:e.collection,srcRessource:e._srcRessource,count:n,webInwin:e.webInwin,eventManager:e.eventManager,noresult:()=>{e.elements.myContentEmptyView&&e.elements.myContentEmptyView.setStyle("order","1"),e.elements.myContentEmptyView&&e.elements.myContentEmptyView.setStyle("margin-top","0%"),e.elements.myContentEmptyView&&e.elements.myContentEmptyView.show(),w.getMyContentView()&&w.getMyContentView().setStyle("height","auto")},onComplete:()=>{e.elements.myContentEmptyView&&e.elements.myContentEmptyView.setStyle("order","unset"),w.getMyContentView()&&w.getMyContentView().setStyle("height","100%")}};w.buildMyContent(i)},getInputValue:function(){return void 0===this.elements.input.value?"":this.elements.input.value},setInputValue:function(e){this.elements.input.value=e},setFieldValue:function(t){this.setInputValue(t),e.is(t,"string")&&t.length>0?this.showClearSearchButton():this.hideClearSearchButton(),this.refreshHistoryList()},setPlaceHolderValue:function(e){this.elements.input.placeholder=e,"Search"===e&&this._changeIcon("search")},getPlaceHolderValue:function(){return this.elements.input.placeholder},resetSearchField:function(t,n){this._lastMoveIndex=-1,this.setFieldValue(e.is(t)?t:""),this.setPlaceHolderValue(B.get("search")),e.is(n)&&(this.noFocus=n),!this._smartMode||this._smartMode&&("standardSearch"===w._currentSearchMode||!w._currentSearchMode)||this._inContextMode?this.activateSearchTab(this.elements.searchTab):w._SmartQueryController&&(w._SmartQueryController.destroySmartQuery(),this.elements.instantSearchEmptyView&&this.elements.instantSearchEmptyView.hide(),w.showguidedContainer(!1))},_setInternalCriteria:function(e){this._internalSearchCriteria=e},showClearSearchButton:function(){this.elements.clearSearchButton&&this.elements.clearSearchButton.show()},hideClearSearchButton:function(){this.elements.clearSearchButton&&this.elements.clearSearchButton.hide()},drop:function(e){var t=null,n=!!document.documentMode,i=!n&&!!window.StyleMedia;if(n||i||""===e.dataTransfer.getData("shortData")){if(""!==e.dataTransfer.getData("text")){var s=JSON.parse(e.dataTransfer.getData("text"));t=[],s.data.items&&s.data.items.forEach((function(e){t.push('"'+e.displayName+'"')}))}}else e.preventDefault(),t=JSON.parse(e.dataTransfer.getData("shortData"));e.target.value=t.join(" OR "),e.stopPropagation(),e.preventDefault()},paste:function(t){var n=B.get("search"),i=this,s=this._srcRessource&&this._srcRessource.getActiveTenant()?this._srcRessource.getActiveTenant():void 0;if(e.is(s)&&"OnPremise"!==s.tenantId&&!this._srcRessource.isSingleTenant()?n+=" "+s.tenantName:n=B.get("searchNew"),this.elements.input.placeholder===n||this.elements.input.placeholder===B.get("search_current_tab")){var o=0;if(e.is(t.target)&&e.is(t.target.selectionStart)&&e.is(t.target.selectionEnd)&&(o=t.target.value.length-(t.target.selectionEnd-t.target.selectionStart)),0===o&&e.is(t)){var a=null;e.is(t.clipboardData)&&e.is(t.clipboardData.getData,"function")?(a=t.clipboardData.getData("text/plain"),i.getServerSuggestions(a)):e.is(window.clipboardData)&&e.is(window.clipboardData.getData,"function")&&(a=window.clipboardData.getData("Text"),i.getServerSuggestions(a));var r="";if(e.is(a,"string")&&a.length>0){var c=a.indexOf("\t")>=0,l=a.indexOf("\n")>=0,u=a.indexOf("||")>=0,h=a.indexOf("&&")>=0,p=a.indexOf("\\&&")>=0,g=a.indexOf("\\||")>=0;if(i._setInternalCriteria(a),!1===c&&!1===l&&!1===u&&!1===h)return void i.showClearSearchButton();var _=a.split("\n"),m="",S=!1;if(e.is(_,"array")&&_.length>0){for(var f=0,C=_.length;f<C;f++)if(e.is(_[f],"string")&&(_[f]=_[f].trim(),_[f].length>0)){var y=null,v="AND";c=(m=_[f]).indexOf("\t")>=0,u=m.indexOf("||")>=0,h=m.indexOf("&&")>=0,p=m.indexOf("\\&&")>=0,g=m.indexOf("\\||")>=0,!0===p&&(m=m.replace(/\\\&/g,"##__##")),!0===g&&(m=m.replace(/\\\|/g,"__##__")),!0===c?y=m.split("\t"):!0===h?y=m.split("&&"):!0===u?(y=m.split("||"),v="OR"):y=[m];for(var b="",w=0,D=y.length;w<D;w++)e.is(y[w],"string")&&(y[w].trim(),y[w].length>0&&(!0===p&&(y[w]=y[w].replace(/##__##/g,"&")),!0===g&&(y[w]=y[w].replace(/__##__/g,"|")),b.length>0&&(b+=" "+v+" "),y[w].length>1&&'"'===y[w][0]&&'"'===y[w][y[w].length-1]&&(y[w]=y[w].substr(1,y[w].length-2)),y[w]=y[w].replace(/\\([\s\S])|(")/g,"\\$1$2"),b+='"'+y[w]+'"'));b.length>0&&(!0===S&&(r+=" OR "),C>1&&(r+="("),r+=b,C>1&&(r+=")"),S=!0)}var I=d.getOption("maxTopBarInput");r.length>I&&(r=r.substring(0,I)),t.target.value=r,r.length>0&&i.showClearSearchButton(),t.stopPropagation(),t.preventDefault()}}}}},setFocus:function(){e.is(this.noFocus)&&!0===this.noFocus?(this.noFocus=!1,this.onBlur()):this.elements.input.focus()},_createThumbnailSection:function(n){if(e.is(n)&&e.is(n.title)&&e.is(n.count)&&e.is(n.containerClassName)){var i,s=t.create("div",{class:n.containerClassName}),o=t.create("div",{id:"AppsDropdown",class:n.containerClassName+"-header"}).inject(s),a=t.create("div",{class:n.containerClassName+"-content"}).inject(s);i=t.create("div",{class:"search-multi-view-icon fonticon fonticon-app"}).inject(o);var r=e.is(n.count)?"<b>"+n.title+"</b> | "+n.count:"<b>"+n.title+"</b> | 0",c=t.create("div",{class:n.containerClassName+"-title",title:n.title,html:r}).inject(o),l=t.create("div",{class:n.containerClassName+"-link",text:R.get("search.sectionlink"),title:R.get("search.sectionlink")+" "+n.title}).inject(o);let u=t.create("div",{class:"my-content-lens-div wux-controls-abstract wux-controls-button wux-ui-state-primary wux-ui-style-lite","touch-mode":!0,tabindex:"0"}).inject(o);t.create("span",{class:"my-content-lens wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-chevron-right wux-ui-3ds-lg"}).inject(u);var d=t.create("div",{class:n.containerClassName+"-spinner-container"}).inject(s);(new x).inject(d).show();return{container:s,header:o,image:i,title:c,content:a,link:l,spinner:d}}return null},_createThumbnailObject:function(n,i){var s=t.create("div",{class:"section-thumbnail"});if(e.is(n)){var o=t.create("div",{class:"section-thumbnail-content",title:n.title}).inject(s);e.is(i)&&(o.model=i,o.addEvent("mousedown",function(e){this.noBlur=!0}.bind(this)),o.addEvent("mouseup",function(e){this.onBlur(),this._onClickObject(e)}.bind(this))),e.is(n.id)&&(o.id=n.id,o.addEvent("mousedown",function(e){this.noBlur=!0}.bind(this)),o.addEvent("mouseup",function(e){this.onBlur(),this._onClickApp(e)}.bind(this)));t.create("img",{class:"section-thumbnail-image",src:n.image}).inject(o);if(e.is(n.type)&&"Widget"===n.type)t.create("img",{class:"section-thumbnail-image-native",src:L.getWebappsAssetUrl("SNSearchUX","images/NATIVEICON.png")}).inject(o);var a=t.create("div",{class:"section-thumbnail-title"}).inject(o);if(e.is(n.icon))t.create("img",{class:"section-thumbnail-content-icon"}).inject(a).src=n.icon;t.create("div",{class:"section-thumbnail-content-text",text:n.title}).inject(a)}return s},_buildCategories:function(e){let t=[];var n=this._createThumbnailSection({title:R.get("Application"),icon:"",containerClassName:"section-container",count:0});return n.container.inject(e||this.elements.instantSearchContainer).hide(),n.header.addEventListener("click",function(e){g.searchApplicationsInCompass(this.getInputValue()),this.onBlur(),!0===this.webInwin&&this.eventManager&&this.eventManager.dispatchEvent("OnApplication",{value:this.getInputValue()})}.bind(this)),t.push(n),t},_updateCategory:function(t,n){var i;if(t.forEach((function(e){e.title.getAttribute("title")===n.title&&(i=e)})),this._clearCategory(i.container),i.container.setAttribute("count",n.count),0!==n.count||e.is(n.noHide)){var s="<div>"+n.title+"</div>"+(this.limitReachedFUN141960?"":"<div>|</div><div>"+n.hits+"</div>");i.title.setHTML(s),i.container.show(),i.header.show();for(var o=0;o<n.results.length;o++)"Application"===n.title&&this._createThumbnailObject(n.results[o]).inject(i.content)}else i.container.hide(),i.header.hide();this._isContainerEmpty(this.elements.instantSearchContainer)?this.elements.instantSearchEmptyView.show():this.elements.instantSearchEmptyView&&this.elements.instantSearchEmptyView.hide()},_isContainerEmpty:function(e){var t=["-empty-view","section-myContent"],n=e.getChildren(),i=!0;for(let e=0;e<n.length;e++)"none"===n[e].style.display||t.some((function(t){return n[e].className.indexOf(t)>=0}))||(i=!1);return i},_clearCategory:function(t){e.is(t)&&t.getChildren().forEach((function(e){(e.className.contains("section-object")&&e.destroy(),e.className.contains("section-container-content"))&&e.getChildren().forEach((function(e){e.className.contains("section-thumbnail")&&e.destroy()}))}))},_getCategoriesSuggestions:function(t){let n=this;const{query:i,instantSearchContainer:s,count:o,noresult:a,fromFull:r}=t;if(this.elements.instantSearchContainer=s,s&&s.removeClassName("withApps"),s&&s.removeClassName("full"),i.length>=3){let c;c=e.is(r)&&!0===r?n.categoryListFull:n.categoryList,0===c.length&&(c=this._buildCategories(s),e.is(r)&&!0===r&&(n.categoryListFull=c)),clearTimeout(this._categorySuggestTimeout),this._categorySuggestTimeout=setTimeout(function(){c.forEach(function(e){"Application"===e.title.getAttribute("title")&&(this._clearCategory(e.container),e.container.show(),e.spinner.show())}.bind(this)),g.getApplicationsFromCompass(i,(e.is(r),3)).then(function(t){if(e.is(t)&&e.is(t.count)&&e.is(t.data)){var n;c.forEach(function(e){"Application"===e.title.getAttribute("title")&&(n=e,e.spinner.hide())}.bind(this));var i=[];t.data.forEach((function(e){i.push({title:e.title,image:e.icon,id:e.id,type:e.type})}));var o={title:R.get("Application"),count:i.length,hits:t.count,results:i,image:L.getWebappsAssetUrl("SNSearchUX","images/APPICON.png"),category:n};this._updateCategory(c,o),s&&s.addClassName("withApps"),e.is(r)&&!0===r&&s&&s.addClassName("full")}}.bind(this));let l={id:e.is(t.id)?t.id:"categoryDropdown",container:s,dropdown:this,count:o,srcRessource:this._srcRessource,webInwin:this.webInwin,eventManager:this.eventManager,query:i,noresult:a||(()=>{n._isContainerEmpty(s)?n.elements.instantSearchEmptyView&&n.elements.instantSearchEmptyView.show():n.elements.instantSearchEmptyView&&n.elements.instantSearchEmptyView.hide()})};w.buildcategoryContent(l)}.bind(this),1e3)}},onFocus:function(){if(this.elements.dropdownContainer.className.contains("autocomplete-hidden")){this.elements.dropdownContainer.addClassName("new-search-mode"),this.elements.dropdownContainer.removeClassName("autocomplete-hidden"),"desktop"===l.getDeviceType()&&!0===this._smartMode&&(!this._inContextMode||this._inContextMode&&this._inContextOptions&&"furtive"!==this._inContextOptions.inContextOptions.mode)?this.elements.dropdownContainer.addClassName("enable-guided-mode"):(this.elements.dropdownContainer.removeClassName("enable-guided-mode"),this.elements.searchTabContainer.removeClassName("guided-mode"),this.elements.searchTabContainer.removeClassName("nlq-mode"));let e={dropdown:this,srcRessource:this._srcRessource,webInwin:this.webInwin,eventManager:this.eventManager,inputValue:this.getInputValue(),placeHolderValue:this.getPlaceHolderValue()};"true"===this._Isx2aIncontext&&d.getOption("search_web_in_win")?(this.elements.rightContentContainer.style.pointerEvents="none",this.elements.rightContentContainer.style.filter="grayscale(100%)",this.elements.rightContentContainer.style.opacity="0.5"):d.getOption("search_web_in_win")&&(this.elements.rightContentContainer.style.pointerEvents="",this.elements.rightContentContainer.style.filter="",this.elements.rightContentContainer.style.opacity=""),w.buildFullDropDown(e),this._createInstantSearchEmpty()}},_onBuilderModeFocus:function(){this.elements.dropdownContainer.removeClassName("autocomplete-hidden"),this.elements.dropdownContainer.addClassName("enable-guided-mode")},_createInstantSearchEmpty:function(){if(!this.instantSearchNoResultText){let e=this._srcRessource&&this._srcRessource.getActiveTenant();this.instantSearchNoResultText=w.buildInstantSearchNoResultMessage(e),this.instantSearchEmptyView||(this.instantSearchEmptyView=this._createInstantSearchemptyView(this.elements.instantSearchEmptyView,this.instantSearchNoResultText))}},loadStdSearch:function(){let e=this.getInputValue();this.refreshHistoryList(),e.length>2&&!0!==this._inContextMode?this.switchActiveTabinstantSearchTab(e):(this.refreshMyContent(),this.activateSearchTab(this.elements.searchTab),this.setPlaceHolderValue(B.get("search")))},disableTopBarField:function(){this.setFieldValue(""),this.elements.input.addClassName("disable-input");let e=document.getElementsByClassName("right_search")[0];e&&e.addClassName("disable-input")},enableTopBarField:function(){this.elements.input.value||(this.elements.input.value=""),this.elements.input.removeClassName("disable-input"),this.elements.input.removeAttribute("disabled");let e=document.getElementsByClassName("right_search")[0];e&&e.removeClassName("disable-input")},onBlur:function(t,n){"iphone"!==l.getDeviceCategory()&&(e.is(n)&&!0===n&&(this.noBlur=!1),e.is(t)&&e.is(t.relatedTarget)&&this.elements.dropdownContainer.contains(t.relatedTarget)&&(!e.is(n)||!1===n)||(!0===this.noBlur||!0===this._helpssettings?this.noBlur=!1:(this.elements.dropdownContainer.addClassName("autocomplete-hidden"),w._SmartQueryController&&w._SmartQueryController.clearSugDropDownItems(),this._smartMode&&this.enableTopBarField(),!0===this.webInwin&&this.eventManager&&this.eventManager.dispatchEvent("Searchfieldenable",!0))))},onClick:function(e){this.getPlaceHolderValue()!==B.search&&this.setPlaceHolderValue(B.search),this.elements.input&&(this.elements.input.readOnly=!1,this._changeIcon("search"))},_changeIcon:function(t){let n=e.extendElement(document.body).getElement(".run_btn_search");if(e.is(n))switch(n.removeClassName("fonticon-search"),n.removeClassName("fonticon-search-cog"),n.removeClassName("fonticon-favorite-on"),n.removeClassName("fonticon-user"),t){case"search":n.addClassName("fonticon-search");break;case"cog":n.addClassName("fonticon-search-cog");break;case"on":n.addClassName("fonticon-favorite-on");break;case"user":n.addClassName("fonticon-user")}},onKeyUp:function(t){let n=this,i=t.srcElement.value.trim();if(13===t.keyCode&&(n.onBlur(),n._lastMoveIndex=-1,this.elements.input.disabled=!0,this.elements.input.disabled=!1,setTimeout((function(){A.dispatch("onViewSearch")}),0)),38===t.keyCode||40===t.keyCode)return n._lastMoveIndex<=-1?n._lastMoveIndex=-1:n._lastMoveIndex,38===t.keyCode?n._lastMoveIndex--:n._lastMoveIndex++,void(n._lastMoveIndex>=0?n._mouveOnIndex():(n._mouveOnIndex(),n.setInputValue(""),n.hideClearSearchButton()));if(16!==t.keyCode){if(e.is(this.elements.input)&&"?"===this.getInputValue())return this.switchActiveTab(this.elements.predefinedQueriesTabContainer,this.elements.predefinedQueriesTab),void(e.is(this._SearchDropDownPQs)&&(this.showSettingPQs(),this._SearchDropDownPQs.elements.specialCharactersExpander.getContent().dispatchEvent(new Event("collapse")),this._SearchDropDownPQs.elements.typeShortcutsExpander.getContent().dispatchEvent(new Event("expand")),this._SearchDropDownPQs.createPredefinedQueriesComponent()));this._setInternalCriteria(null),i.length>0?this.showClearSearchButton():this.hideClearSearchButton(),i.length>2&&!0!==this._inContextMode?(this.switchActiveTabinstantSearchTab(i),this._lastMoveIndex=-1):!1===this._helpssettings?(this.switchActiveTab(this.elements.searchTabContent,this.elements.searchTab),this.refreshMyContent(),this._lastMoveIndex=-1):this.hideSettingPQs(),this.refreshHistoryList()}},_mouveOnIndex:function(){let t,n=this;t=n.elements.instantSearchTabContainer.isHidden()?n.elements.historyContentContainer.querySelectorAll(".search-history-container"):n.elements.suggestions.querySelectorAll(".search-history-container");let i=t.length;if(n._lastMoveIndex>=i)n._lastMoveIndex=i-1;else{for(const e of t)e.removeClassName("hover");if(n._lastMoveIndex<i){let i=t[n._lastMoveIndex];e.is(i)&&(n.setInputValue(i.title),n.showClearSearchButton(),i.addClassName("hover"))}}},onKeyDown:function(e){"ctrl+a"===UWA.Event.whichKey(e)&&e.stopPropagation()},_onClickObject:function(t){if(!e.is(t))return;let n={model:t.currentTarget.model,text:t.target.getText(),webInwin:this.webInwin,eventManager:this.eventManager};w.onClickObject(n)},_onClickApp:function(t){if(!e.is(t)||!e.is(t.currentTarget.id))return;let n={appTitle:t.currentTarget.title,appId:t.currentTarget.id,webInwin:this.webInwin,eventManager:this.eventManager};w.onClickApp(n)},isDropDownVisible:function(){return!this.elements.dropdownContainer.className.contains("autocomplete-hidden")},addSuggestList:function(t,n){let i=0;this.clearHistory(n),t.forEach(function(t){i+=this.addSuggest({text:t.text,container:n,icon:t.icon,filter:t.filter,action:t.action,isTitle:t.isTitle,mouseupCB:t.mouseupCB,type:e.is(t.type)?t.type:void 0,nbTitle:i})}.bind(this))},addSuggest:function(n){if(!e.is(n.text)||!e.is(n.container))return;var i;let s=0;if(e.is(n.isTitle)&&!1!==n.isTitle?(s++,i=t.create("div",{class:"search-dropdown-suggestion-title"}).inject(n.container),n.nbTitle>0&&i.addClassName("separator")):(i=t.create("div",{class:"search-history-container",title:n.text,type:e.is(n.type)?n.type:""}).inject(n.container)).addEvent("mouseup",function(t){let i,s=t.currentTarget.getText();if(this._smartMode&&"nlqSearch"===w._currentSearchMode){w._SmartQueryController.setInputValue(s);let e=u.getItem("NLQUserQuery")||[];for(let t=0;t<e.length;t++)if(e[t].queryString.toLowerCase()==s.toLowerCase()){i=e[t].uqlSearchQuery;break}return A.dispatch("onViewSearch",{displayString:"NLQ Search",query:i,fromsmartSearch:!0}),this.onBlur(null,!0),w._SmartQueryController.nlqLRU(s,i),t}if(e.is(n.mouseupCB))return n.mouseupCB.call(this,t.target&&t.target.getText()),t;!0!==this.noSearchLaunch?("iphone"===l.getDeviceCategory()?this.elements.dropdownContainer.addClassName("autocomplete-hidden"):this.onBlur(),this.setFieldValue(s),A.dispatch("onViewSearch"),!0===this.webInwin&&this.eventManager&&this.eventManager.dispatchEvent("onViewSearch",{displayString:s,query:s})):this.noSearchLaunch=!1}.bind(this)),e.is(n.icon))if(l.iconURL_check(n.icon)){var o=t.create("span",{class:"fonticon  search-history-icon"}).inject(i);t.create("img",{src:n.icon,width:"17px",height:"auto"}).inject(o)}else{n.icon.startsWith("fonticon-")&&(n.icon=n.icon.replace(/fonticon-/g,""));o=t.create("span",{class:"fonticon fonticon-"+n.icon+" search-history-icon"}).inject(i)}if(e.is(n.filter,"string")&&n.filter.length>0&&n.text.toLowerCase().indexOf(n.filter.toLowerCase())>=0){var a=n.text.toLowerCase().indexOf(n.filter.toLowerCase()),r=n.text.substr(0,a),c=n.text.substr(a,n.filter.length),d=n.text.substr(a+n.filter.length,n.text.length);t.create("div",{class:"search-history-text",text:r}).inject(i),t.create("div",{class:"search-history-text-filtered",text:c}).inject(i),t.create("div",{class:"search-history-text",text:d}).inject(i)}else t.create("div",{class:e.is(n.isTitle)&&!0===n.isTitle?"search-dropdown-suggestion-title-text":"search-history-text",text:n.text}).inject(i);if(e.is(n.action)&&"clear"===n.action){var h=t.create("span",{class:"search-history-delete fonticon fonticon-clear",title:R.get("search.history.clear")+" '"+n.text+"'"}).inject(i);h.addEvent("mousedown",function(e){this.noBlur=!0,this.noSearchLaunch=!0,e.stopPropagation()}.bind(this)),h.addEvent("mouseup",function(e){if(this._nlqMode&&"nlqSearch"===w._currentSearchMode){let t=e.currentTarget.getParent(),n=t.getText();w._SmartQueryController.nlqLRU(n,void 0,"clear"),t.remove()}else this.removeHistoryElement(e.currentTarget);this.setFocus(),e.stopPropagation()}.bind(this))}else if(e.is(n.action)&&"delete"===n.action){t.create("span",{id:"clearHistoryDropdown",class:"search-dropdown-clear-history-icon fonticon fonticon-trash",title:R.get("search.history.clear")+" "+R.get("search.history")}).inject(i).addEvent("mousedown",function(e){this.displayClearHistoryModal(e),"nlqSearch"!==w._currentSearchMode&&(this.noBlur=!0),e.stopPropagation()}.bind(this))}return s},refreshHistoryList:function(t){let n=this.elements.historyContentContainer;if(e.is(t)&&(n=t),!e.is(n))return;let i=[];this.getHistoryListFromLocalStorage().length>0&&i.push({text:R.get("search.history"),action:"delete",isTitle:!0,icon:"clock"}),this.getHistoryListFromLocalStorage().slice(0,this.maxSuggests).forEach(function(e){e.indexOf(this.getInputValue())>=0&&i.push({text:e,action:"clear",filter:this.getInputValue()})}.bind(this)),i.length<=1?(i.pop(),this.createSuggestionEmptyView(this.elements.historyContainer)):this.destroySuggestionEmptyView(this.elements.historyContainer),this.addSuggestList(i,n)},clearHistory:function(t){if(e.is(t)){var n=t.getChildren();n.length>0&&n.forEach((function(e){e.remove()}))}},removeHistoryElement:function(e,t){w.removeHistoryElement(e,t),this.refreshHistoryList()},createSuggestionEmptyView:function(e){this.destroySuggestionEmptyView(e);let n=t.create("div",{class:"suggestion-container-empty"}).inject(e);X=(X=X.replace("###searchhistory###",l.escapeHtml(R.get("search.history")))).replace("###nohistory###",l.escapeHtml(R.get("search.noHistory"))),n.innerHTML=X},destroySuggestionEmptyView:function(e){e.getChildren().forEach(function(e){e.className.contains("suggestion-container-empty")&&e.destroy()}.bind(this))},getHistoryListFromLocalStorage:function(){return w.getHistoryListFromLocalStorage()},removeHistoryFromLocalStorage:function(e){w.removeHistoryFromLocalStorage(e)},clearHistoryFromLocalStorage:function(){w.clearHistoryFromLocalStorage(),this.refreshHistoryList()},displayClearHistoryModal:function(e){new T({renderTo:document.body,className:"search-history-clear-warning",okButtonText:R.get("search.history.delete.confirm")}).confirm(R.get("search.history.delete.message"),R.get("search.history.delete.title"),function(e){let t=!1;if(!0===e){if(this._nlqMode&&"nlqSearch"===w._currentSearchMode)return w._SmartQueryController.nlqLRU(void 0,void 0,"deleteAll"),this.elements.dropdownContainer.removeClassName("autocomplete-hidden"),void this.disableTopBarField();this.clearHistoryFromLocalStorage(),t=!0}else this.noBlur=!1,this.modalClosed=!0,this.setFocus();!0===this.webInwin&&this.eventManager.dispatchEvent("clearHistory",t)}.bind(this)),!0===this.webInwin&&this.eventManager.dispatchEvent("displayClearHistory")},switchActiveTab:function(t,n,i){this.tabContainerList.forEach((function(e){e===t?e.show():e.hide()})),e.is(n)&&this.tabList.forEach(function(e){e===n?(e.addClassName("tab-selected"),!0===this.webInwin&&this.eventManager.dispatchEvent("tabSelected",{value:e.className})):e.removeClassName("tab-selected")}.bind(this)),!0!==i&&this.setFocus()},activateSearchTab:function(e){this.refreshHistoryList();let t=!1;this.getInputValue().length>=3&&(t=!0),!0===this._inContextMode&&(t=!1),!0===t?this.switchActiveTab(this.elements.instantSearchTabContainer,e):this.switchActiveTab(this.elements.searchTabContent,e),!t&&this.refreshMyContent()},_getPlaceHolderTextDependingOnActiveTenant:function(t){if(!e.is(t,"string")||0===t.length)throw new Error("ERROR - INVALID ARGUMENT: need a key !");var n=B.get(t);return this._srcRessource.getAvailableTenants().length>1&&(e.is(B[t+"_in_active"])?n=B.replace(B.get(t+"_in_active"),{tenant:this._srcRessource.getTenantDisplayName(this._srcRessource.active_tenant)}):n+=" "+this._srcRessource.getTenantDisplayName(this._srcRessource.active_tenant)),n},setInContextMode:function(t,n){if(this._inContextMode=t,this._inContextOptions=n,!0===t)e.is(this.elements.predefinedQueriesTab)&&this.elements.predefinedQueriesTab.hide(),e.is(this.elements.settingsTab)&&this.elements.settingsTab.hide(),n&&"furtive"===n.inContextOptions.mode?e.is(this.elements.buttonContainer)&&this.elements.buttonContainer.getElement("#myFavoriteDropdown").hide():e.is(this.elements.buttonContainer)&&this.elements.buttonContainer.getElement("#myFavoriteDropdown").show(),e.is(this.elements.expertSearchButton)&&this.elements.expertSearchButton.hide(),e.is(this.elements.deactivateFUN136528)&&this.elements.deactivateFUN136528.hide(),this.elements.contentContainer.addClassName("search-global-content-container-in-context"),this.switchActiveTab(this.elements.searchTabContent,this.elements.searchTab,!0),this.eventManager.dispatchEvent("set_title_only_search",{is_title_only:!1});else{e.is(this.elements.predefinedQueriesTab)&&this.elements.predefinedQueriesTab.show(),e.is(this.elements.settingsTab)&&this.elements.settingsTab.show(),e.is(this.elements.buttonContainer)&&this.elements.buttonContainer.getElement("#myFavoriteDropdown").show(),e.is(this.elements.expertSearchButton)&&this.elements.expertSearchButton.show(),e.is(this.elements.deactivateFUN136528)&&this.elements.deactivateFUN136528.show(),this.elements.contentContainer.removeClassName("search-global-content-container-in-context");let t=u.getItem("titleOnly");this.eventManager.dispatchEvent("set_title_only_search",{is_title_only:t})}w.setInContextMode(this._inContextMode,n)},getInContextMode:function(){return!!e.is(this._inContextMode)&&this._inContextMode},switchActiveTabinstantSearchTab:function(t,n){if(this.elements.dropdownContainer.className.contains("autocomplete-hidden"))return;this.switchActiveTab(this.elements.instantSearchTabContainer,null,n);var i=this.elements;clearTimeout(this._backToConfidenceTimeout),this._backToConfidenceTimeout=setTimeout(function(){this._toggleWarningMessageTab(t,i)}.bind(this),500);let s=[];this.getHistoryListFromLocalStorage().length>0&&s.push({text:R.get("search.history"),action:"delete",isTitle:!0,icon:"clock"}),this.getHistoryListFromLocalStorage().slice(0,this.maxSuggests).forEach(function(n){e.is(t)&&n.toLowerCase().indexOf(t.toLowerCase())>=0&&s.push({text:n,action:"clear",filter:t})}.bind(this)),this.addSuggestList(s,this.elements.suggestions),e.is(t)&&this.getServerSuggestions(t),e.is(t)&&this._getCategoriesSuggestions({query:t,instantSearchContainer:this.elements.instantSearchContainer})},showSettingPQs:function(){let t=this,n=t.getContent();if(e.is(n)){let i=n.querySelector(".nv-autocomplete-container");e.is(i)&&i.removeClassName("helps-settings"),e.is(i)&&i.addClassName("helps-settings"),t._helpssettings=!0,t.elements.input&&t.elements.input.removeClassName("enabled"),t.elements.input&&t.elements.input.setAttribute("disabled",""),t.elements.input&&t.elements.input.addClassName("disabled");let s=document.querySelector(".run_btn_search.fonticon.fonticon-search");e.is(s)&&e.is(s.removeClassName,"function")&&(s.removeClassName("enabled"),s.addClassName("disabled")),s=document.querySelector(".run_ctn_search.ctn_search"),e.is(s)&&e.is(s.removeClassName,"function")&&(s.removeClassName("enabled"),s.addClassName("disabled")),!0===t.webInwin&&t.eventManager&&t.eventManager.dispatchEvent("Searchfieldenable",!1)}},hideSettingPQs:function(){let t=this,n=t.getContent();if(e.is(n)){let t=n.querySelector(".nv-autocomplete-container");e.is(t)&&t.removeClassName("helps-settings")}t.isDropDownVisible()&&(this._smartMode?w.switchActiveTab():t.activateSearchTab(t.elements.searchTab)),t._helpssettings=!1,t.elements.input&&t.elements.input.removeAttribute("disabled"),t.elements.input&&t.elements.input.removeClassName("disabled"),t.elements.input&&t.elements.input.addClassName("enabled");let i=document.querySelector(".run_btn_search.fonticon.fonticon-search");e.is(i)&&e.is(i.removeClassName,"function")&&(i.removeClassName("disabled"),i.addClassName("enabled")),i=document.querySelector(".run_ctn_search.ctn_search"),e.is(i)&&e.is(i.removeClassName,"function")&&(i.removeClassName("disabled"),i.addClassName("enabled")),!0===t.webInwin&&t.eventManager&&t.eventManager.dispatchEvent("Searchfieldenable",!0)},_onClickbody:function(e){let t=this,n=e;if(n.currentTarget.querySelector&&n.currentTarget.querySelector(".nlqFeedbackForm"))return;let i=t.isDropDownVisible();if(this.modalClosed)this.modalClosed=!1;else if(!0===i&&(!0===t._helpssettings||this.isSmartMode())){let e,i=n.target,s=t.elements.dropdownContainer&&t.elements.dropdownContainer.contains(i);e=!!["wux-controls-combobox","wux-layouts-treeview","btn-primary","sn-search-field","nv-autocomplete-input","nv-autocomplete-searchbox","clear_btn_search","btn-default"].some((e=>i.className.includes(e)))||(i.closest(".dropdown-menu-wrap")||i.closest(".wux-controls-datepicker-popup")||i.closest(".wux-controls-popup")),e&&(s=!0),!1===s&&(!0===t._helpssettings&&t.hideSettingPQs(),this.onBlur(null,!0),t._smartMode&&t.enableTopBarField())}},isSmartMode:function(){return this._smartMode},isGuidedMode:function(){return this._guidedMode},_buildWarningMessageNotification:function(e){let t=this;l.buildNotification(e,(function(e){w.modalVisibility(!1,e),t.eventManager&&t.eventManager.dispatchEvent("advancedSearch",{value:l.SearchTypeEnum.ADVANCED_SEARCH,adv_search:!0})}),this.collection)},_toggleWarningMessageTab:function(t,n){if(d.getOption("FUN141960")){let i=n&&n.instantSearchWarningMessage?n.instantSearchWarningMessage:e.extendElement(w._modalBody.querySelector(".instant-search-warning-message.search-warning-message")),s=n?void 0:e.extendElement(w._modalBody.querySelector(".instant-search-container")),o=this._srcRessource&&this._srcRessource.getActiveTenant()?this._srcRessource.getActiveTenant():void 0,a=m.getAvailableSources(o);a=a.map((e=>e.name)),q.getSearchInfo({query:t,label:"FUN141960-BackToConfidence-Dropdown",source:a}).then((e=>{this.limitReachedFUN141960=e.estimated,this.limitReachedFUN141960?(i&&i.show(),n?(n.instantSearchTabContainer.addClassName("limitReached"),n.rightContentContainer.addClassName("limitReached")):s&&s.addClassName("limitReached")):(i&&i.hide(),n?(n.instantSearchTabContainer.removeClassName("limitReached"),n.rightContentContainer.removeClassName("limitReached")):s&&s.removeClassName("limitReached"))})).catch((e=>{console.error(e)}))}},_createInstantSearchemptyView:function(t,n){let i=this,s=W.createApp({template:'\n      <div :class="nlqBricksContainerClass"></div>\n      <div class="instant-empty-view">\n        <div :class="searchIconClass"></div>\n        <div :class="emptyTextClass">{{noResultText}}</div>\n        <div :class="emptySubtextClass">{{emptyViewSubtext}}</div>\n        <div :class="emptySubtextClass">\n          <a :class="widerSearchClickClass" ref="buttonContainer" @click="onWiderSearchClick">{{widerSearchClick}}</a>\n          <span>{{endText}}</span>\n        </div>\n        <div :class="emptysubTextGuided">{{guidedEmptySubText}}</div>\n      </div>\n      \n      ',data:()=>({nlqBricksContainerClass:"nlq-bricks-container",searchIconClass:"instant-search-empty-view-image fonticon fonticon-search",emptyTextClass:"instant-search-empty-view-text",emptySubtextClass:"instant-search-empty-subtext",widerSearchClickClass:"wider-search-link",noResultText:R.get("search.instantSearch.noResults"),emptyViewSubtext:n,widerSearchClick:R.get("instantnoresultclick.text"),endText:R.get("instantnoresultend.text"),emptysubTextGuided:"instant-search-empty-subtext-guided",guidedEmptySubText:R.get("search.instantSearch.noResults.subtext"),toShowComponent:!0}),methods:{onWiderSearchClick(){i.onBlur(),A.dispatch("onViewSearch"),!0===d.getOption("search_web_in_win")&&window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("OnwiderSearchClick")}}});return s.config.compilerOptions={runtimeGlobalName:"require('DS/vue-3.4.15/vue')"},s.mount(t)},_buildNoHistoryIconAndPlaceholder:function(e){this.NoHistoryVue&&this.NoHistoryVue.unmount();this.NoHistoryVue=W.createApp({template:'\n        <div class="suggestion-container-empty-nohistories">\n          <div class="suggestion-container-empty-icon fonticon fonticon-clock"></div>\n          <div class="suggestion-container-empty-text">{{noHistoryPlaceholder}}</div>\n        </div>\n      ',data:()=>({noHistoryPlaceholder:l.escapeHtml(R.get("search.noHistory"))})}),this.NoHistoryVue.config.compilerOptions={runtimeGlobalName:"require('DS/vue-3.4.15/vue')"},this.NoHistoryVue.mount(e)}})})),define("DS/SNSearchUX/SearchView",["text!DS/SNSearchUX/assets/templates/SearchView.html","DS/Handlebars/Handlebars4","UWA/Core","UWA/Event","UWA/Class/View","UWA/Class/Debug","DS/SNInfraUX/SearchUtils","DS/SNSearchUX/SearchHistoric","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchPreferences","DS/SNSearchUX/SearchDropDown","DS/SNSearchUX/SearchDropDown2","DS/SNSearchUX/SearchSecondaryMenu","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/PubSub/PubSub","DS/MessageBus/MessageBus","DS/SNSearchUX/utils/SearchViewEvents","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json"],(function(e,t,n,i,s,o,a,r,c,l,d,u,h,p,g,_,m,S,f,C,y){"use strict";return s.extend(o,{name:"DS/SNSearchUX/SearchView",uwaClassName:"SearchView",id:"global_ctn_search",className:"global_ctn_search topbar-search",domEvents:{"click div.run_ctn_search":"_onSearch","click div.clear_btn_search":"_onClearSearch","keyup input.input_search":"_onSearchInputKeyUp","keydown input.input_search":"_onSearchInputKeyDown"},template:t.compile(e),autocomplete:void 0,socket:void 0,selectedSource:void 0,searchTabId:void 0,lastSearch:void 0,secondaryOptionToHide:[],betaProgramState:void 0,currentTenant:void 0,setup:function(e){var t=this;if("3DSwym"===a.identifyClientInfo().identifier&&(y.search_current_tab=y.search_current_page),n.is(e)&&n.is(e.model)&&n.is(e.model.previousAttributes,"function")){let t=e.model.previousAttributes();n.is(t.addinMode)&&(this.addinMode=t.addinMode,n.is(this.addinMode,"object")&&(this.addinMode=this.addinMode.value))}n.is(e)&&n.is(e.searchMenu)&&n.is(e.searchMenu.hideTenantMenu)&&(this.hideTenantMenu=!0),!0===l.getOption("forceSearchTransientAndNoTab")&&(u.setItem("search_tabbed_ui",!1),u.commit({})),this.searchViewEventsManager=new C({searchView:this}),n.is(window.notifs)||(window.notifs=_,m.setNotificationManager(window.notifs)),S.add("search:closeTransient",(function(){t.socket.dispatchEvent("hideAdvancedSearch"),t.autocomplete.setFieldValue(""),f.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"datagrid_preference_force_close"}),t.socket.dispatchEvent("clearfilterbyclosesidepanel"),n.is(t.topBarMenu)&&(t.topBarMenu._setSecondaryHiddenOptions(),t.topBarMenu._inAppContext?t.topBarMenu.restoreAppContext(localOptions):t.topBarMenu.setSearchMode({noFocus:!0}),t.topBarMenu._switchSearchMode(),t.topBarMenu._clickOnSearch())})),S.add("search:setCriteria",(function(e){t.autocomplete._setInternalCriteria(e),t.autocomplete.setFieldValue(e)}));require(["DS/TopBar/TopBar"],(function(e){void 0===e.attributes&&(e.attributes={}),e.addEvent({events:{mobileSearchAction:function(e){if("enable"===e.action)n.is(t.autocomplete)&&t.autocomplete.elements.input.focus()}}})})),f.subscribe({channel:"searchView",topic:"deactivateInContextSearch",callback:function(e){n.is(t.topBarMenu)&&t.topBarMenu.restoreAppContext(e),n.is(t.autocomplete)&&t.autocomplete.setInContextMode(!1),n.is(t.topBarMenu)&&t.topBarMenu._clickOnSearch()}}),this.socket=c.createSocket({socket_id:"searchview_socket_id"}),this.socket.addListener("onViewSearch",(function(){t._onSearch()})),this.socket.addListener("onSetSources",(function(e){t._setSource(e)})),this.socket.addListener("onSetFindInApp",(function(e){t.autocomplete.setFindInApp(e)})),this.socket.addListener("onSetBackSearchOrFindInTab",(function(e){n.is(t.topBarMenu)&&t.topBarMenu.setSearchMode(e)})),this.socket.addListener("onSetInAppContext",(function(e){n.is(t.topBarMenu)&&t.topBarMenu.setInAppContext(e)})),this.socket.addListener("openTagger",(function(e){t.socket.dispatchEvent("openTagger",e)})),this.socket.addListener("setTaggerMode",(function(e){t.socket.dispatchEvent("setTaggerMode",e)})),this.socket.addListener("closeTagger",(function(e){t.socket.dispatchEvent("closeTagger",e)})),this.socket.addListener("onSetFocusInSearchField",(function(){setTimeout((function(){n.is(t.topBarMenu)&&n.is(t.topBarMenu._secondaryMenu)&&!1===t.topBarMenu._secondaryMenu.isVisible&&t.topBarMenu._secondaryMenu.toggle(),n.is(t.autocomplete)&&!t.autocomplete.isDropDownVisible()&&t.autocomplete.elements.input.focus()}),100)})),this.socket.addListener("onSelectTenant",(function(e){})),this.socket.addListener("onSelectTenantAfterTabActivation",(function(e){n.is(t.topBarMenu)?(t.topBarMenu.selectTenantOnTabActivation(e),t.topBarMenu._clickOnSearch()):n.is(t.autocomplete.selectTenantOnTabActivation,"function")&&t.autocomplete.selectTenantOnTabActivation(e)})),this.socket.addListener("onRefreshSearchField",(function(e){if(!n.is(e))throw new Error("Invalid localOptions in onRefreshSearchField");e.searchStringToDisplayInSearchField===y.get("myContent_searchFav")&&e.internalSearchCriteria!==y.get("myContent_searchFav")?n.is(t.topBarMenu)&&t.topBarMenu._clickOnSearch({focus:!1}):e.internalSearchCriteria===a.SearchTypeEnum.MY_CONTENT?n.is(t.topBarMenu)&&t.topBarMenu._clickOnMyContent({focus:!1}):e.internalSearchCriteria===a.SearchTypeEnum.FAVORITE_SEARCH?n.is(t.topBarMenu)&&t.topBarMenu._clickOnFavoriteSearches({focus:!1}):e.internalSearchCriteria!==a.SearchTypeEnum.ADVANCED_SEARCH&&e.originalSearchCriteria!==a.SearchTypeEnum.ADVANCED_SEARCH||n.is(t.topBarMenu)&&t.topBarMenu._clickOnAdvancedSearch({focus:!1}),n.is(t.topBarMenu)&&n.is(e)&&n.is(e.isPinnedWidgetMaximized)&&!0===e.isPinnedWidgetMaximized&&t.topBarMenu._toggleDropDownMenuItem(y.search_current_tab,"show"),n.is(e,"string")?(e.length>0&&n.is(t.topBarMenu)&&t.topBarMenu._clickOnSearch(),t.autocomplete.setFieldValue(e)):n.is(e,"object")&&n.is(e.searchStringToDisplayInSearchField,"string")&&n.is(e.internalSearchCriteria,"string")&&(e.searchStringToDisplayInSearchField.length>0&&n.is(t.topBarMenu)&&t.topBarMenu.currentMode!==y.search_current_tab&&t.topBarMenu._clickOnSearch({focus:!1}),e.searchStringToDisplayInSearchField.length>=3?(t.autocomplete.setFieldValue(e.searchStringToDisplayInSearchField),t.autocomplete.switchActiveTabinstantSearchTab(e.searchStringToDisplayInSearchField,!0),t.autocomplete._changeIcon("search")):t.autocomplete.resetSearchField(e.searchStringToDisplayInSearchField,!0),t.autocomplete._setInternalCriteria(e.internalSearchCriteria))})),this.socket.addListener("onSwitchMode",(function(e){t._onSwitchMode(e)})),this._filterInProgress=!1,this.socket.addListener("clickOnChoiceSearch",(function(e){n.is(t.topBarMenu)&&t.topBarMenu._clickOnSearch(e)})),this.socket.addListener("clickOnChoiceMyContent",(function(e){n.is(t.topBarMenu)&&t.topBarMenu._clickOnMyContent(e),n.is(e)&&e.searchStringToDisplayInSearchField&&(t.autocomplete.resetSearchField("",!0),t.autocomplete.setPlaceHolderValue(e.searchStringToDisplayInSearchField),t.autocomplete._changeIcon("user"))})),this.socket.addListener("clickOnChoiceAdvancedSearch",(function(e){n.is(t.topBarMenu)&&t.topBarMenu._clickOnAdvancedSearch(e),n.is(e)&&e.searchStringToDisplayInSearchField&&(t.autocomplete.resetSearchField("",!0),t.autocomplete.setPlaceHolderValue(e.searchStringToDisplayInSearchField),t.autocomplete._changeIcon("cog"))})),this.socket.addListener("clickOnChoiceFavoriteSearch",(function(e){n.is(t.topBarMenu)&&t.topBarMenu._clickOnFavoriteSearches(e),n.is(e)&&e.searchStringToDisplayInSearchField&&(t.autocomplete.resetSearchField("",!0),t.autocomplete.setPlaceHolderValue(e.searchStringToDisplayInSearchField),t.autocomplete._changeIcon("on"));t.socket.dispatchEvent("favoriteSearches",{adv_search:!1,value:"#favoriteSearches"})})),this.socket.addListener("onSetFindInTab",(function(e){n.is(t.topBarMenu)&&t.topBarMenu._clickOnSearchInCurrentTab()})),this.socket.addListener("onSwitchToFindInTab",(function(e){n.is(t.topBarMenu)&&t.topBarMenu._clickOnSearchInCurrentTab()})),this.socket.addListener("onSwitchToFindInApp",(function(e){t.autocomplete.onSwitchToFindInApp(e)})),this.socket.addListener("hideSearchInThisTab",(function(e){n.is(t.topBarMenu)&&t.topBarMenu._toggleDropDownMenuItem(y.search_current_tab,"hide")})),this.socket.addListener("showSearchInThisTab",(function(e){n.is(t.topBarMenu)&&t.topBarMenu._toggleDropDownMenuItem(y.search_current_tab,"show")})),this.socket.addListener("onPQPrefixSelect",(function(e){n.is(t.topBarMenu)&&t.topBarMenu.setSelectedPQPrefix(e)})),this.socket.addListener("onInContextSearch",(function(e){n.is(t.topBarMenu)&&!t.topBarMenu._inAppContext?(t._prevTenant=t.topBarMenu.getCurrentTenant(),t.topBarMenu._setSecondaryHiddenOptions("inContext"),"furtive"!==e.inContextOptions.mode&&n.is(e.inContextOptions.app_socket_id,"string")&&"socket_id_#saved_search_edit#"===e.inContextOptions.app_socket_id||(t.topBarMenu.setInAppContext({isInAppContext:!0}),t.topBarMenu.setFindInContext(e.inContextOptions,e.placeholder)),n.is(e.inContextOptions.advanced_search)&&n.is(e.inContextOptions.advanced_search.showByDefault)&&!0===e.inContextOptions.advanced_search.showByDefault?t.topBarMenu._clickOnAdvancedSearch({focus:!1}):t.topBarMenu._clickOnSearch({focus:!1})):t.autocomplete._inAppContext||("furtive"===e.inContextOptions.mode||"socket_id_#saved_search_edit#"!==e.inContextOptions.app_socket_id?n.is(t.topBarMenu)&&t.topBarMenu._setSecondaryHiddenOptions("inContext"):n.is(e.inContextOptions.advanced_search)),n.is(t.autocomplete)&&t.autocomplete.setInContextMode(!0,e)})),this.socket.addListener("onCloseTransient",(function(e){t._onCloseTransient(e)})),this.socket.addListener("onCloseTransientTopBar",(function(e){t._onCloseTransient(e)})),this.socket.addListener("onInContextSearchDeactivated",(function(e){t.socket.dispatchEvent("onCloseTransient"),n.is(t.topBarMenu)&&n.is(t.topBarMenu.restoreAppContext)&&t.topBarMenu.restoreAppContext(e),n.is(t.restoreAppContext,"function")&&t.restoreAppContext(e)&&(t.restoreAppContext=null),n.is(t.autocomplete)&&n.is(t.autocomplete.setInAppContext)&&t.autocomplete.setInAppContext({isInAppContext:!1})})),this.socket.addListener("Last_Tag_Filter",(function(e){var i=t.autocomplete._inContextOptions;!n.is(i)&&n.is(t.topBarMenu)&&(i=t.topBarMenu._inContextOptions),i&&"socket_id_#saved_search_edit#"===i.app_socket_id||(t.last_tag_filter=e)})),this.socket.addListener("clearSearch",(function(e){(t.autocomplete&&t.autocomplete.elements.input.placeholder===t.autocomplete._getPlaceHolderTextDependingOnActiveTenant("searchNew")||t.autocomplete.elements.input.placeholder===y.search_current_tab)&&t._onClearSearch(e)}))},_setSource:function(e){var t=this;l.getTenantSettings(e.sources.active_tenant).then((function(){let i=l.getOption("deactivate_FUN108944");if(["iphone","ipad","android"].indexOf(a.getDeviceCategory()),!0!==i){let i=l.getOption("activate_instant_search",{tenant:e.sources.active_tenant});u.setItem("InstantSearchSCC",i),u.commit(),!0===i&&"catiav5"!==t.addinMode&&"solidworks"!==t.addinMode?(t.betaProgramState=u.getItem("InstantSearchSCC"),n.is(t.betaProgramState)||(t.betaProgramState=!0)):t.betaProgramState=!1,t.render()}n.is(t.topBarMenu)&&t.topBarMenu.initTenantOnSecondaryMenu(e)})),require(["DS/SNSearchUX/SearchUX_TopBar"],(function(i){var s=i.getAddinMode();n.is(s,"string")&&(e.searchParams=e.searchParams||{},e.searchParams.enable_search_in_this_tab=!1),n.is(t.autocomplete)&&n.is(t.autocomplete._buildSearchChoice,"function")?(n.is(e.searchParams)&&n.is(t.topBarMenu)&&(t.topBarMenu._manageSecondaryMenuOptions(e.searchParams),n.is(s,"string")&&"true"===s&&t.topBarMenu._setSecondaryHiddenOptionsPermanent([y.LastSearchResults,y.PredefinedQuery])),e.betaProgramState=t.betaProgramState,t.autocomplete._buildSearchChoice(e)):n.is(t.autocomplete)&&n.is(t.autocomplete.initSources,"function")&&t.autocomplete.initSources(i._resourcesMgt)}))},destroy:function(){this.stopListening(this.model),this._parent(),this.container=null},_onSearch:function(e){var t=this;n.is(e)&&"click"==e.type&&f.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"ClickOnLens",persDim:{pd1:this.autocomplete?this.autocomplete.getInputValue():""}}}),"3DSwym"===a.identifyClientInfo().identifier&&a.isMobile()&&t.container.parentElement.parentElement.toggleClassName("search-active");var i=this.autocomplete.getInputValue();i=i.trim();var s=l.getOption("minTopBarInput");if(this.autocomplete.elements.input.placeholder===y.get("search_current_tab")&&(s=l.getOption("minTopBarInputSiCT")),n.is(i,"string")&&i.length<=s&&i.length>0&&n.is(this.autocomplete)&&!this.autocomplete.getInContextMode()){var o={level:"info",title:y.get("search-query-too-short:title"),message:y.replace(y.get("search-query-too-short:message"),{count:l.getOption("minTopBarInput")}),sticky:!0,poNotifId:"search-query-short"};_.addNotif(o)}else{n.is(this.autocomplete.showLastSearch,"function")&&u.getItem("searchMode")!==y.search_current_tab&&this.autocomplete.showLastSearch(),n.is(this.topBarMenu)&&!this.topBarMenu._inAppContext&&this.topBarMenu.currentMode!==y.search_current_tab&&this.topBarMenu.showLastSearch(),a.setsearchType(a.SearchTypeEnum.SEARCH);var c=e&&void 0!==e.adv_search_status?e.adv_search_status:this.autocomplete._adv_Search_activated,d=this.autocomplete._inContextOptions;!n.is(d)&&n.is(this.topBarMenu)&&(d=this.topBarMenu._inContextOptions),n.is(i,"string")&&i.length>l.getOption("minTopBarInput")&&u.getItem("searchMode")!==y.search_current_tab&&(d&&"socket_id_#saved_search_edit#"===d.app_socket_id||(this.reSearch=!0,this.reSearchQuery={value:i,searchStringToDisplayInSearchField:this.autocomplete.getInputValue()}));if(n.is(this.topBarMenu)&&u.getItem("searchMode")===y.search_current_tab)"3DSwym"===a.identifyClientInfo().identifier?this.model.dispatchEvent("search",{value:i,searchMode:a.SearchTypeEnum.SEARCH_IN}):this.topBarMenu._searchInCurrentTab(i,this.topBarMenu.searchTabId),n.is(i)&&""!==i&&r.storeValueInDataBase(i);else if(!0===this.autocomplete._myRecentContentIsActive&&""===i&&!0!==this.reSearch)a.setsearchType(a.SearchTypeEnum.MY_RECENT_CONTENT),this.socket.dispatchEvent("myRecentContent",{value:a.SearchTypeEnum.MY_RECENT_CONTENT,adv_search:!1,sFilter:"*"});else if(""===i)this.autocomplete._inAppContext&&!1===this.autocomplete._temporarilyOutOfContext&&null!==d?h():this.autocomplete.elements.input.placeholder===this.autocomplete._getPlaceHolderTextDependingOnActiveTenant("mycontent")?(a.setsearchType(a.SearchTypeEnum.MY_CONTENT),this.socket.dispatchEvent("myContent",{value:a.SearchTypeEnum.MY_CONTENT,adv_search:!1})):this.autocomplete.elements.input.placeholder===this.autocomplete._getPlaceHolderTextDependingOnActiveTenant("MySavedSearches")?(a.setsearchType(a.SearchTypeEnum.FAVORITE_SEARCH),this.socket.dispatchEvent("myContent",{value:a.SearchTypeEnum.FAVORITE_SEARCH,adv_search:!1})):this.autocomplete.elements.input.placeholder===this.autocomplete._getPlaceHolderTextDependingOnActiveTenant("searchNew")&&this.reSearch?(this.socket.dispatchEvent("search",{value:this.reSearchQuery.value,adv_search:c,refine:this.last_tag_filter,source:[],reSearch:!0,internalSearchCriteria:this.autocomplete._internalSearchCriteria,searchStringToDisplayInSearchField:this.reSearchQuery.searchStringToDisplayInSearchField,fromEmptyString:!0}),t.autocomplete.setFieldValue(this.reSearchQuery.searchStringToDisplayInSearchField)):this.autocomplete.elements.input.placeholder===this.autocomplete._getPlaceHolderTextDependingOnActiveTenant("adv_search")?(a.setsearchType(a.SearchTypeEnum.ADVANCED_SEARCH),this.socket.dispatchEvent("advancedSearch",{value:a.SearchTypeEnum.ADVANCED_SEARCH,adv_search:!0,source:[],adv_search_field:e}),t.autocomplete._AdvancedSearchField=null):(this._filterInProgress=!1,this.autocomplete.hideClearSearchButton(),this.socket.dispatchEvent("clearSearch"),n.is(this.autocomplete.hideLastSearch,"function")&&this.autocomplete.hideLastSearch(),n.is(this.autocomplete)&&n.is(this.autocomplete.elements)&&n.is(this.autocomplete.elements.input)&&this.autocomplete.elements.input.placeholder===this.autocomplete._findInTabNLS&&this.model.hasEvent("search")&&(a.setsearchType(a.SearchTypeEnum.SEARCH_IN),this.model.dispatchEvent("search",{value:i,searchMode:a.SearchTypeEnum.SEARCH_IN})));else if(this._filterInProgress=!0,this.topBarMenu&&this.topBarMenu._inAppContext&&!1===this.topBarMenu._temporarilyOutOfContext&&null!==d)n.is(t.autocomplete.getInputValue())&&r.storeValueInDataBase(t.autocomplete.getInputValue()),h();else if(n.is(this.autocomplete)&&n.is(this.autocomplete.elements)&&n.is(this.autocomplete.elements.input)&&this.autocomplete.elements.input.placeholder===this.autocomplete._findInTabNLS)this.model.hasEvent("search")&&(a.setsearchType(a.SearchTypeEnum.SEARCH_IN),this.model.dispatchEvent("search",{value:this.autocomplete.getInputValue(),searchMode:a.SearchTypeEnum.SEARCH_IN}));else{!0===this.autocomplete._myRecentContentIsActive&&n.is(this.topBarMenu)&&this.topBarMenu._clickOnSearch(),i===t.autocomplete.getInputValue()&&r.storeValueInDataBase(i),a.executeWithPQ({wait:function(){if(i.indexOf(":")>0)return t.socket.dispatchEvent("fetchPQsFromServer"),!0},run:function(){require(["DS/SNInfraUX/utils/WildcardMgr"],(function(e){a.setsearchType(a.SearchTypeEnum.SEARCH),n.is(t.topBarMenu)&&!t.topBarMenu._inAppContext&&t.topBarMenu._setSecondaryHiddenOptions(y.searchNew),i=e.manageWildcardAddtion(i),i=a.replacePQsWithCVPrefixes(i),n.is(t.reSearchQuery)&&(t.reSearchQuery.value=i),n.is(t.autocomplete.resetSearchField,"function")&&t.autocomplete.resetSearchField(t.autocomplete.getInputValue(),!0),t.socket.dispatchEvent("search",{value:i,adv_search:c,internalSearchCriteria:n.is(t.autocomplete)?t.autocomplete._internalSearchCriteria:null,searchStringToDisplayInSearchField:n.is(t.autocomplete)?t.autocomplete.getInputValue():null})}))}})}}function h(){a.executeWithPQ({wait:function(){if(t.autocomplete.getInputValue().indexOf(":")>0)return t.socket.dispatchEvent("fetchPQsFromServer"),!0},run:function(){require(["DS/SNInfraUX/utils/WildcardMgr"],(function(e){var i={inCtx_widget_id:d.widget_id},s=t.autocomplete.getInputValue();s=e.manageWildcardAddtion(s,{addWildCard_inCtx:d.addWildCard}),i.value=a.replacePQsWithCVPrefixes(s),i.searchStringToDisplayInSearchField=t.autocomplete.getInputValue(),n.is(d.precond)&&d.precond.trim().length>0&&(n.is(i.value)&&i.value.trim().length>0&&"*"!==i.value?(i.internalSearchCriteria="("+i.value+") AND ("+d.precond+")",i.value="("+i.value+") AND ("+d.precond+")"):(i.internalSearchCriteria=d.precond,i.value=d.precond),i.displayValue=t.autocomplete.getInputValue()),i.adv_search=c,i.source=d.source,n.is(i.source)||(i.source=[]),t.socket.dispatchEvent("search",i)}))}})}},_onClearSearch:function(e){this.autocomplete._setInternalCriteria(null);var t=!(!n.is(e)||!n.is(e.noFocus))||null;n.is(this.autocomplete.resetSearchField)?this.autocomplete.resetSearchField("",t):this.autocomplete.setFieldValue(""),this.reSearch=!1,!0===this.betaProgramState&&n.is(this.autocomplete._clearDropDown,"function")&&this.autocomplete._clearDropDown(),n.is(this.autocomplete)&&n.is(this.autocomplete.elements)&&n.is(this.autocomplete.elements.input)&&this.autocomplete.elements.input.placeholder===this.autocomplete._findInTabNLS?this.model.hasEvent("clearSearch")&&this.model.dispatchEvent("clearSearch"):n.is(this.topBarMenu)&&u.getItem("searchMode")===y.search_current_tab&&("3DSwym"===a.identifyClientInfo().identifier?this.model.dispatchEvent("clearSearch"):(S.dispatch("SearchQuery",[""]),S.dispatch("Search:updateSearchCriteria",[""]))),this.reSearch=!0},_onCloseTransient:function(e){n.is(this.topBarMenu)&&(this._prevTenant&&this._prevTenant.tenantId&&this.topBarMenu.setCurrentTenant(this._prevTenant.tenantId),this.topBarMenu._switchSearchMode(),this.topBarMenu._clickOnSearch(),this.topBarMenu._inAppContext?this.topBarMenu.restoreAppContext(e):this.topBarMenu.setSearchMode({noFocus:!0}),this.topBarMenu._setSecondaryHiddenOptions()),n.is(this.autocomplete.resetSearchField,"function")?this.autocomplete.resetSearchField("",!0):(this.autocomplete.setFieldValue(""),this.autocomplete.elements.input.readOnly=!1)},_onSwitchMode:function(e){if(e&&a.SearchTypeEnum.MY_RECENT_CONTENT===e.new_mode)if(n.is(this.topBarMenu))this.topBarMenu._clickOnMyRecentContent(e);else{var t="*";if(!e||"*"===e.paramsFilter||this.autocomplete.getPlaceHolderValue()!==y.searchNew&&this.autocomplete.getPlaceHolderValue()!==y.get("myrecentcontent")||(t=this.autocomplete.getInputValue()?this.autocomplete.getInputValue():e.paramsFilter,this.autocomplete.setFieldValue(t)),this.autocomplete._setInternalCriteria(null),!n.is(e,"object")||!n.is(e.focus)||!1!==e.focus){var i={value:a.SearchTypeEnum.MY_RECENT_CONTENT,adv_search:!1,sFilter:n.is(t,"string")?t:"*"};n.is(e)&&n.is(e.widgetId)&&n.is(e.widgetId,"string")&&0<e.widgetId.length&&(i.widgetId=e.widgetId),this.socket.dispatchEvent("myRecentContent",i)}}},_onSearchInputKeyUp:function(e){this.autocomplete.getInputValue()?this.autocomplete.showClearSearchButton():this._filterInProgress||this.autocomplete.hideClearSearchButton(),i.stopPropagation(e)},_onSearchInputKeyDown:function(e){"return"===i.whichKey(e)&&this._onSearch(),i.stopPropagation(e)},_storeValueInLocalStorage:function(e){if(!n.is(e,"string"))throw new Error("null value given to SearchView._storeValueInLocalStorage!");if(!(e.trim().length<=0)){var t=[];if(n.is(localStorage.SNSearchBoxStore))if(-1===(t=JSON.parse(localStorage.SNSearchBoxStore)).indexOf(e))t.length>=100&&t.shift(),t.push(e),localStorage.SNSearchBoxStore=JSON.stringify(t);else{var i=t.indexOf(e),s=t[i];t.splice(i,1),t.push(s),localStorage.SNSearchBoxStore=JSON.stringify(t)}else t.push(e),localStorage.SNSearchBoxStore=JSON.stringify(t)}},_setTopbarTooltips:function(){this.container.getElement(".clear_ctn_search").title=y.get("clear.tooltip"),this.container.getElement(".run_ctn_search").title=y.get("search.tooltip");var e=this.container.getElement(".option_ctn_search");n.is(e)&&(e.title=y.get("secondaryMenu.tooltip"))},render:function(){var e,t=this;e=this.template(this.model.toJSON()),this.container.setContent(e);var i=this.container.getElement("#input_search_div");i.addClassName("searchProto");var s=this.container.getElement(".right_search"),o=n.createElement("div",{class:"option_ctn_search ctn_search"}).inject(s),c=u.getItem("BETA-FUN136528");a.isInternalProduction();if(!1!==l.getOption("FUN124298")&&!1!==c)n.is(this.autocomplete)&&this.autocomplete.clean(),this.autocomplete=new p({eventManager:t.socket}).inject(i);else{this.autocomplete=new h({suggestUrl:"tempo_deactivated?query={text}",placeholder:y.searchNew,typeDelay:500,minLength:1,suggestFormat:"{label}",dataParser:function(e){return e.suggest},className:"sn-search-field uwa-autocomplete nv-autocomplete",isBetaOn:t.betaProgramState,events:{openTagger:function(){t.socket.dispatchEvent("openTagger")},setSourceDashboard:function(){t.socket.dispatchEvent("setSelectedSource",{value:"3DDashboard"}),t.selectedSource="3DDashboard"},setSourceCStorage:function(e){t.socket.dispatchEvent("setSelectedSource",{value:e}),t.selectedSource=e,t.betaProgramState,u.setItem("defaultTenantId",e),u.commit()},onSelect:function(e,i){"LastSearch"!==i&&t.socket.dispatchEvent("topBar-LastSearch-clearLocalFilter"),n.is(t.autocomplete._isTypeListMode)&&!0===t.autocomplete._isTypeListMode&&(t.autocomplete._isTypeValue=e);var s=!1;if(n.is(arguments[2])&&"AdvSearch"===arguments[2]&&(s=!0),t.autocomplete._searchStringToDisplayInSearchField=e,n.is(t.autocomplete.elements)&&n.is(t.autocomplete.elements.input)&&n.is(t.autocomplete.getInputValue())&&t.autocomplete.getInputValue()!==e&&(t.autocomplete._searchStringToDisplayInSearchField=null,t.autocomplete._setInternalCriteria(null)),null!==t.autocomplete.getInputValue()&&!0!==s||(t.autocomplete._AdvancedSearchField=e),!1===s){if(n.is(t.topBarMenu)&&t.topBarMenu.currentMode!==y.search_current_tab){var o={hiddenOptions:[y.search_current_tab]};t.topBarMenu._clickOnSearch(o),t.topBarMenu._clickOnSearch()}t._onSearch(t.autocomplete._AdvancedSearchField)}n.is(this._value)&&this._value.length>l.getOption("minTopBarInput")&&(t.autocomplete.elements.input.value=e),t.socket.dispatchEvent("onHideSuggests"),n.is(this._value)&&this._value.length>l.getOption("minTopBarInput")&&(!n.is(i,"object")||!0===i.storeSearch)&&r.storeValueInDataBase(e)},onSearch:function(e){t._onSearch(),n.is(t.autocomplete._isTypeListMode)&&!0===t.autocomplete._isTypeListMode&&r.storeValueInDataBase(e)},myContent:function(){t.socket.dispatchEvent("myContent",{value:a.SearchTypeEnum.MY_CONTENT,adv_search:!1})},favoriteSearches:function(){t.socket.dispatchEvent("favoriteSearches",{value:a.SearchTypeEnum.FAVORITE_SEARCH,adv_search:!1})},myRecentContent:function(e){var i={value:a.SearchTypeEnum.MY_RECENT_CONTENT,adv_search:!1};n.is(e)&&n.is(e.sFilter,"string")&&0<e.sFilter.length?i.sFilter=e.sFilter:i.sFilter="*",n.is(e)&&n.is(e.widgetId,"string")&&0<e.widgetId.length&&(i.widgetId=e.widgetId),t.socket.dispatchEvent("myRecentContent",i)},hideAdvancedSearch:function(){t.socket.dispatchEvent("hideAdvancedSearch",{})},showAdvancedSearch:function(){t.socket.dispatchEvent("showAdvancedSearch",{})},advancedSearch:function(e){t.socket.dispatchEvent("advancedSearch",{value:a.SearchTypeEnum.ADVANCED_SEARCH,adv_search:!0,adv_search_field:e}),t.socket.dispatchEvent("showAdvancedSearch",{adv_search_field:e},["searchtopbar_socket_id"])},storeSuggestion:function(e){r.storeValueInDataBase(e)},showPQListUX:function(){t.socket.dispatchEvent("onShowPQListUX")}}}).inject(i);var d=n.createElement("div",{class:"option_btn_search fonticon fonticon-down-open",id:"searchFieldDropdown","data-rec-id":"option_ctn_search"}).inject(o);this.topBarMenu=new g({target:d,autocomplete:this.autocomplete,socket:this.socket,secondaryMenuOptions:_})}var _={hideTenantMenu:this.hideTenantMenu};return this._setTopbarTooltips(),a.setSearchViewRendered(),this}})}));