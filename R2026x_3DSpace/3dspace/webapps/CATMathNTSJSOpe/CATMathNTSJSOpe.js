define("DS/CATMathNTSJSOpe/CATMathRghLifting",["UWA/Core","DS/MathematicsES/MathsDef"],(function(e,t){"use strict";var r=e.Class.extend({init:function(){return this._nbPoints=0,this._detectCorners=!0,this._isLinearFiltered=!1,this._isInserted=0,this._epsZero=Math.pow(10,-15),this._epsLength=Math.pow(10,-6),this._epsPressure=1,this._epsVelocity=1,this._minStep=this._epsLength,this._hasRun=!1,this},setListOfPoints:function(e){this._points=e,this._isInserted=1,this._isLinearFiltered=!1,this._nbPoints=this._points.length},setListOfNormals:function(e){this._normals=e},setListOfPressures:function(e){this._pressures=e},setListOfVelocities:function(e){this._velocities=e},setMinimalStep:function(e){this._minStep=e},setEpsPressure:function(e){var t=this;t._epsPressure=e<=0?.1:e>=1?1:e},setEpsVelocity:function(e){var t=this;t._epsVelocity=e<=0?.1:e>=1?1:e},getNbPoints:function(){var e=this;return!1===e._hasRun&&e.runLifting(),e._nbPoints=e._points.length,e._nbPoints},getListOfPoints:function(){var e=this;return!1===e._hasRun&&e.runLifting(),e._points},getListOfNormals:function(){var e=this;return!1===e._hasRun&&e.runLifting(),e._normals},getPressures:function(){var e=this;return!1===e._hasRun&&e.runLifting(),e._pressures},getVelocities:function(){var e=this;return!1===e._hasRun&&e.runLifting(),e._velocities},isPointToBeKept:function(e,t,r){var o=!0,i=0;if((i=Math.abs(e.x-t.x))>r)return o;var s=i;if((i=Math.abs(e.y-t.y))>r)return o;var n=i;if((i=Math.abs(e.z-t.z))>r)return o;return(i=s*s+n*n+i*i)>r*r?o:o=!1},runLifting:function(){var e=this;if(void 0!==e._points){var t=e._nbPoints=e._points.length;if(e._hasRun=!0,!(t<=2)){if(!e._isLinearFiltered){var r=[],o=[],i=[],s=[],n=0,a=e._normals,c=e._points,p=e._pressures,h=e._velocities,u=e._minStep,_=c[0],v=c[1];for(r.push(_),void 0!==a&&o.push(a[0]),void 0!==p&&i.push(p[0]),void 0!==h&&s.push(h[0]),n=1;n<t-2;n++){var l=n;v=c[l],e.isPointToBeKept(_,v,u)&&(r.push(v),void 0!==a&&o.push(a[l]),void 0!==p&&i.push(p[l]),void 0!==h&&s.push(h[l]),_=v)}v=c[t-2];var d=e.isPointToBeKept(_,v,u);_=c[t-1];var f=e.isPointToBeKept(_,v,u);d&&f&&(r.push(v),void 0!==a&&o.push(a[t-2]),void 0!==p&&i.push(p[t-2]),void 0!==h&&s.push(h[t-2])),r.push(_),void 0!==a&&o.push(a[t-1]),void 0!==p&&i.push(p[t-1]),void 0!==h&&s.push(h[t-1])}e._isLinearFiltered=!0,e._points=r,e._nbPoints=e._points.length,void 0!==a&&(e._normals=o),void 0!==p&&(e._pressures=i),void 0!==h&&(e._velocities=s)}}}});return e.namespace("DS/CATMathNTSJSOpe/CATMathRghLifting",r)})),define("DS/CATMathNTSJSOpe/CATMathRghImprove",["UWA/Core","DS/MathematicsES/MathsDef"],(function(e,t){"use strict";var r=e.Class.extend({init:function(){return this._nbPoints=0,this._params=[],this._epsZero=Math.pow(10,-15),this._epsParam=Math.pow(10,-15),this._epsClosed=Math.pow(10,-6),this._toClose=-1,this._checkEndClosed=!1,this._checkEndNormals=!1,this._statusClosed=-100,this._isReady=!1,this._ALPHA=.5,this._PtDeb=new t.Vector3D(0,0,0),this._PtFin=new t.Vector3D(0,0,0),this._NrDeb=new t.Vector3D(0,0,0),this._NrFin=new t.Vector3D(0,0,0),this._pressDeb=1,this._pressFin=1,this._veloDeb=1,this._veloFin=1,this._controlPoints=[],this},setListOfPoints:function(e){var t=this;t._points=e,t._nbPoints=t._points.length,t._checkEndClosed=!1,t._checkEndNormals=!1},setListOfNormals:function(e){this._normals=e,this._checkEndNormals=!1},setListOfPressure:function(e){this._pressures=e},setListOfVelocity:function(e){this._velocities=e},SetClose:function(e,t){var r=this;e<=-1?r._toClose=-1:0===e?r._toClose=0:e>=1&&(r._toClose=1),t>=0?r._epsClosed=t:r.epsClosed=Math.pow(10,-6)},getStatusClosed:function(){return this._statusClosed},getNbArcs:function(){return this._nbPoints<2?0:this._nbPoints-1},getNbCtrlPPArc:function(){return 4},getControlPoints:function(){var e=this,r=this._controlPoints;if(void 0===e._points||e._nbPoints<2)return r;if(!0===e.isComputedParams()){var o=0,i=e._points,s=e._nbPoints,n=e._ALPHA;for(o=0;o<s-1;o++){var a=o,c=new t.Vector3D(0,0,0),p=new t.Vector3D(0,0,0),h=new t.Vector3D(0,0,0),u=new t.Vector3D(0,0,0);a>0?c.copy(i[a-1]):c.copy(e._PtDeb),p.copy(i[a]),h.copy(i[a+1]),a<s-2?u.copy(i[a+2]):u.copy(e._PtFin);var _=new t.Vector3D(0,0,0),v=new t.Vector3D(0,0,0),l=new t.Vector3D(0,0,0),d=new t.Vector3D(0,0,0);(l=t.Vector3D.sub(h,c)).multiplyScalar(n),l.divideScalar(3),(d=t.Vector3D.sub(p,u)).multiplyScalar(n),V30.divideScalar(3),_=t.Vector3D.add(p,l),v=t.Vector3D.add(h,d),r.push(p),r.push(_),r.push(v),r.push(h)}}return r},evalPoint:function(e){var t=this;if(void 0!==t._points)return t.evalAtParam(e,t._points,t._PtDeb,t._PtFin)},evalNrmal:function(e){var t=this;if(void 0!==t._normals)return t.evalAtParam(e,t._normals,t._NrDeb,t._NrFin)},evalPress:function(e){var t=this;if(void 0!==t._pressures)return t.evalPVAtParam(e,t._pressures,t._pressDeb,t._pressFin)},evalVelo:function(e){var t=this;if(void 0!==t._velocities)return t.evalPVAtParam(e,t._velocities,t._veloDeb,t._veloFin)},evalAtParam:function(e,r,o,i){var s=this;if(void 0===r||r.length<2)return n;var n=new t.Vector3D(0,0,0),a=r.length;e<0&&(e=0),e>a-1&&(e=a-1);var c=Math.floor(e),p=Math.max(e-c,0);if(p<=s._epsParam)return n.copy(r[c]),n;var h=new t.Vector3D(0,0,0),u=new t.Vector3D(0,0,0),_=new t.Vector3D(0,0,0),v=new t.Vector3D(0,0,0);if(!0===s.isComputedParams()){var l=(s._M1im2+(s._M2im2+s._M3im2*p)*p)*p,d=s._M0im1+(s._M2im1+s._M3im1*p)*p*p,f=(s._M1i+(s._M2i+s._M3i*p)*p)*p,D=(s._M2ip1+s._M3ip1*p)*p*p;c>0?h.copy(r[c-1]):h.copy(o),u.copy(r[c]),_.copy(r[c+1]),c<nbPts-2?v.copy(r[c+2]):v.copy(i),h.multiplyScalar(l),u.multiplyScalar(d),_.multiplyScalar(f),v.multiplyScalar(D);var m=new t.Vector3D(0,0,0),y=new t.Vector3D(0,0,0);m=t.Vector3D.add(h,u),y=t.Vector3D.add(_,v),n=t.Vector3D.add(m,y)}return n},evalPVAtParam:function(e,t,r,o){var i=this;if(void 0===t||n!==a||a<2)return s;var s=1,n=t.length,a=i._points.length;e<0&&(e=0),e>n-1&&(e=n-1);var c=Math.floor(e),p=Math.max(e-c,0);if(p<=i._epsParam)return(s=t[c])<0&&(s=0),s>1&&(s=1),s;if(!0===i.isComputedParams()){var h=(i._M1im2+(i._M2im2+i._M3im2*p)*p)*p,u=i._M0im1+(i._M2im1+i._M3im1*p)*p*p,_=(i._M1i+(i._M2i+i._M3i*p)*p)*p,v=(i._M2ip1+i._M3ip1*p)*p*p;return(s=h*(c>0?t[c-1]:r)+u*t[c]+_*t[c+1]+v*(c<a-2?t[c+2]:o))<0&&(s=0),s>1&&(s=1),s}},isComputedParams:function(){var e=this;if(!e._isReady){e._M0im1=1,e._M1im2=e._M3im2=e._M2ip1=-e._ALPHA,e._M2im2=2*e._ALPHA,e._M2im1=e._ALPHA-3,e._M3im1=2-e._ALPHA,e._M2i=3-2*e._ALPHA,e._M3i=e._ALPHA-2,e._M1i=e._M3ip1=e._ALPHA;var t=e._points,r=e._points.length;if(void 0===t||r<2)return e._isReady;e._isReady=!0;var o=e._normal,i=o.length,s=e._pressures,n=s.length,a=e._velocities,c=a.length,p=e._PtDeb,h=e._PtFin,u=e._NrDeb,_=e._NrFin;e._toClose>=1&&r>2?(e.closeEndG0(),p.copy(t[r-2]),h.copy(t[1]),void 0!==o&&i===r&&(u.copy(o[r-2]),_.copy(o[1])),void 0!==s&&n===r&&(e._pressDeb=s[r-2],e._pressFin=s[1]),void 0!==a&&c===r&&(e._veloDeb=a[r-2],e._veloFin=a[1]),e._statusClosed=1):(e.closeEndG0(),p.copy(e.computeDebG0(t,r)),h.copy(e.computeFinG0(t,r)),void 0!==o&&i===r&&(u.copy(e.computeDebG0(o,r)),_.copy(e.computeFinG0(o,r))),void 0!==s&&n===r&&(r>2?(e._pressDeb=s[0]+s[1]-s[2],e._pressFin=s[r-1]+s[r-2]-s[r-3]):(e._pressDeb=2*s[0]-s[1],e._pressFin=2*s[1]-s[0])),void 0!==a&&c===r&&(r>2?(e._veloDeb=a[0]+a[1]-a[2],e._veloFin=a[r-1]+a[r-2]-a[r-3]):(e._veloDeb=2*a[0]-a[1],e._veloFin=2*a[1]-a[0])));var v=0;for(v=0;v<=r+1;v++)e._params.push(v)}return e._isReady},computeDebG0:function(e,r){var o=new t.Vector3D(0,0,0),i=new t.Vector3D(0,0,0),s=new t.Vector3D(0,0,0);if(i.copy(e[0]),s.copy(e[1]),r>2){var n=new t.Vector3D(0,0,0);n.copy(e[2]);var a=new t.Vector3D(0,0,0),c=new t.Vector3D(0,0,0);a=t.Vector3D.sub(s,i),c=t.Vector3D.sub(n,s);var p=a.squareNorm(),h=a.dot(c),u=new t.Vector3D(0,0,0);p>this._epsZero&&(a.multiplyScalar(2*h/p),u=t.Vector3D.sub(a,c)),o=t.Vector3D.sub(i,u)}else o=t.Vector3D.sub(i.multiplyScalar(2),s);return o},computeFinG0:function(e,r){var o=new t.Vector3D(0,0,0),i=new t.Vector3D(0,0,0),s=new t.Vector3D(0,0,0);if(i.copy(e[r-2]),s.copy(e[r-1]),r>2){var n=new t.Vector3D(0,0,0);n.copy(e[r-3]);var a=new t.Vector3D(0,0,0),c=new t.Vector3D(0,0,0);a=t.Vector3D.sub(i,s),c=t.Vector3D.sub(n,i);var p=a.squareNorm(),h=a.dot(c),u=new t.Vector3D(0,0,0);p>this._epsZero&&(a.multiplyScalar(-2*h/p),u=t.Vector3D.add(a,c)),o=t.Vector3D.add(s,u)}else o=t.Vector3D.sub(s.multiplyScalar(2),i);return o},closeEndG0:function(){var e=this;if(e._checkEndClosed)return e._checkEndClosed;var r=e._points,o=e._points.length;if(e._toClose>=0&&o>3&&void 0!==r){var i=new t.Vector3D(0,0,0),s=new t.Vector3D(0,0,0);new t.Vector3D(0,0,0);if(i.copy(r[0]),s.copy(r[o-1]),t.Vector3D.sub(s,i).squareNorm()<=e._epsClosed*e._epsClosed){var n=(i.x+s.x)/2,a=(i.y+s.y)/2,c=(i.z+s.z)/2;r[0].set(n,a,c),r[o-1].set(n,a,c),e._statusClosed=0,e.closeEndNormals()}}return e._checkEndClosed=!0,e._checkEndClosed},closeEndNormals:function(){var e=this;if(e._checkEndNormals)return e._checkEndNormals;if(e._statusClosed>=0){var r=e._normals,o=e._points.length;if(e._toClose>=1&&o>3&&void 0!==r&&o===r.length){var i=new t.Vector3D(0,0,0),s=new t.Vector3D(0,0,0);i.copy(r[0]),s.copy(r[o-1]);var n=(i.x+s.x)/2,a=(i.y+s.y)/2,c=(i.z+s.z)/2;r[0].set(n,a,c),r[o-1].set(n,a,c)}}return e._checkEndNormals=!0,e._checkEndNormals}});return e.namespace("DS/CATMathNTSJSOpe/CATMathRghImprove",r)})),define("DS/CATMathNTSJSOpe/CATMathRghLiftingDPR",["UWA/Core","DS/MathematicsES/MathsDef","DS/CATMathNTSJSOpe/CATMathRghLifting"].concat(window.dependencies),(function(e,t,r){"use strict";var o=r.extend({init:function(){return this._parent(),this._detectCorners=!0,this._maxError=this._epsLength,this},setMaximumError:function(e){this._maxError=e},setCornerDetection:function(e){this._detectCorners=e},computeMax:function(e,r,o,i,s){if(this.IMax=0,this.DMax2=0,o!==r+1){var n=0,a=0,c=!1,p=new t.Vector3D(0,0,0),h=new t.Vector3D(0,0,0),u=(new t.Vector3D(0,0,0),new t.Vector3D(0,0,0)),_=new t.Vector3D(0,0,0),v=new t.Vector3D(0,0,0);p.copy(e[r]),h.copy(e[o]);var l=(u=t.Vector3D.sub(h,p)).squareNorm();for((l<=s||l<=i*i/10)&&(c=!0),n=r+1;n<o;n++){var d=n;if(_=t.Vector3D.sub(e[d],p),c)a=_.squareNorm();else{var f=u.dot(_)/l;v.copy(u),v.multiplyScalar(f),v.add(p),v.sub(e[d]),a=v.squareNorm()}a>this.DMax2&&(this.DMax2=a,this.IMax=d)}}},filterPorV:function(e,t){var r=e.length;if(r===this._points.length){for(var o=0,i=r-1,s=o+1;s<r&&0===t[s];)s++;for(i=s;o<i;){var n=(e[i]-e[o])/(i-o),a=(i*e[o]-o*e[i])/(i-o),c=0,p=0,h=o+1;for(h=o+1;h<i;h++){var u=h,_=Math.abs(e[u]-n*u-a);_>c&&(c=_,p=u)}if(c>this._epsVelocity)t[p]=1,i=p;else{for(s=(o=i)+1;s<r&&0===t[s];)s++;i=s}}}},runLifting:function(){var e=this;if(e._hasRun=!0,!(e._nbPoints<=2)){!1===e._isLinearFiltered&&e._parent();var r=e._points;if(void 0!==r){var o=e._nbPoints=e._points.length,i=[],s=0;for(s=0;s<o;s++)i.push(0);var n=0,a=o-1;i[n]=1,i[a]=1;for(var c=e._epsZero,p=e._minStep,h=e._maxError,u=0,_=0;n<a;){e.computeMax(r,n,a,p,c),_=e.IMax;if((u=e.DMax2)>h*h)i[_]=1,a=_;else if(0===n&&a===o-1&&u>h*h/100&&_>1&&_<o-2)i[_]=1,a=_;else for(s=(n=a)+1;s<o;s++)if(i[s]){a=s;break}}if(!0===e._detectCorners){var v=new t.Vector3D(0,0,0),l=new t.Vector3D(0,0,0),d=new t.Vector3D(0,0,0),f=new t.Vector3D(0,0,0),D=0,m=0,y=-.33,V=0,P=0;for(s=1,d.copy(r[0]);s<o&&0===i[s];)s++;for(V=s,f.copy(r[V]),D=(v=t.Vector3D.sub(d,f)).norm(),s++;s<o;){if(0!==i[s]){if(d.copy(r[s]),m=(l=t.Vector3D.sub(d,f)).norm(),V-P>3&&s-V>3){var M=v.dot(l);D>=c&&m>=c&&M>=y*D*m&&(i[V]=2)}P=V,V=s,v.copy(l),v.negate(),f.copy(r[V])}s++}for(P=0,V=0,s=1;s<o;){if(0!==i[s]){var b=Math.max(s-3,1),w=Math.min(s+3,o-2);for(P=V=b;P<s;P++)if(0!==i[P]){b=P+1;break}for(P=V=w;P>s;P--)if(0!==i[P]){w=P-1;break}if(w-b<=2){s++;continue}var g=-1.33,S=b,C=w;v.set(0,0,0),l.set(0,0,0),D=0,m=0,d.copy(r[s]);var A=b,N=w;for(A=b;A<s;A++)for(v=t.Vector3D.sub(r[A-1],d),N=w;N>s;N--){l=t.Vector3D.sub(r[N+1],d);M=v.dot(l);D=v.norm(),m=l.norm(),D<c||m<c||g<(M=M/D/m)&&(g=M,S=A,C=N)}if(g<y&&2!==i[s]){s++;continue}0===i[S]&&0,i[S]=1,0===i[C]&&0,i[C]=1,s=C}s++}}void 0!==R&&1!==e._epsPressure&&e.filterPorV(R,i),void 0!==T&&1!==e._epsVelocity&&e.filterPorV(T,i);var L=e._normals,R=e._pressures,T=e._velocities,F=[],O=[],E=[],x=[];for(s=0;s<o;s++)0!==i[s]&&(F.push(r[s]),void 0!==L&&O.push(L[s]),void 0!==R&&E.push(R[s]),void 0!==T&&x.push(T[s]));e.setListOfPoints(F),o=e._nbPoints=e._points.length,void 0!==L&&e.setListOfNormals(O),void 0!==R&&e.setListOfPressures(E),void 0!==T&&e.setListOfVelocities(x)}}}});return e.namespace("DS/CATMathNTSJSOpe/CATMathRghLiftingDPR",o)})),define("DS/CATMathNTSJSOpe/CATMathRghImproveCR",["UWA/Core","DS/MathematicsES/MathsDef","DS/CATMathNTSJSOpe/CATMathRghImprove"].concat(window.dependencies),(function(e,t,r){"use strict";var o=r.extend({init:function(){return this._parent(),this},evalAtParam:function(e,r,o,i){function s(e,r,o,i,s,n){var a=new t.Vector3D(0,0,0);if(i-o>n){var c=new t.Vector3D(0,0,0),p=new t.Vector3D(0,0,0);c.copy(e),p.copy(r),c.multiplyScalar(i-s),p.multiplyScalar(s-o),(a=t.Vector3D.add(c,p)).divideScalar(i-o)}return a}var n=this;if(void 0===r||r.length<2)return p;var a=n._nbPoints,c=n._params,p=new t.Vector3D(0,0,0),h=r.length;e<0&&(e=0),e>h-1&&(e=h-1);var u=Math.floor(e),_=Math.max(e-u,0);if(_<=n._epsParam)return p.copy(r[u]),p;var v=new t.Vector3D(0,0,0),l=new t.Vector3D(0,0,0),d=new t.Vector3D(0,0,0),f=new t.Vector3D(0,0,0);if(!0===n.isComputedParams()){var D=c[u],m=c[u+1],y=c[u+2],V=c[u+3],P=_*y+(1-_)*m;u>0?v.copy(r[u-1]):v.copy(o),l.copy(r[u]),d.copy(r[u+1]),u<a-2?f.copy(r[u+2]):f.copy(i);var M=n._epsParam,b=s(v,l,D,m,P,M),w=s(l,d,m,y,P,M),g=s(d,f,y,V,P,M),S=s(b,w,D,y,P,M),C=s(w,g,m,V,P,M),A=s(S,C,m,y,P,M);p.copy(A)}return p},evalPVAtParam:function(e,t,r,o){function i(e,t,r,o,i,s){var n=0;return o-r>s&&(n=(e*(o-i)+t*(i-r))/(o-r)),n}var s=this,n=0,a=0;if(void 0!==s._points&&(a=s._points.length),void 0!==t&&(n=t.length),void 0===t||n!==a||a<2)return c;var c=1;e<0&&(e=0),e>n-1&&(e=n-1);var p=Math.floor(e),h=Math.max(e-p,0);if(h<=s._epsParam)return(c=t[p])<0&&(c=0),c>1&&(c=1),c;var u=0,_=0,v=0,l=0;if(!0===s.isComputedParams()){var d=params[p],f=params[p+1],D=params[p+2],m=params[p+3],y=h*D+(1-h)*f;u=p>0?t[p-1]:r,_=t[p],v=t[p+1],l=p<a-2?t[p+2]:o;var V=s._epsParam,P=i(u,_,d,f,y,V),M=i(_,v,f,D,y,V),b=i(v,l,D,m,y,V),w=i(P,M,d,D,y,V),g=i(M,b,f,m,y,V);c=i(w,g,f,D,y,V)}return c<0&&(c=0),c>1&&(c=1),c},getControlPoints:function(){function e(e,r,o,i,s,n,a){var c=s-i,p=n-s;c<a&&(c=0),p<a&&(p=0);var h=new t.Vector3D,u=new t.Vector3D,_=new t.Vector3D;h.copy(e),u.copy(r),_.copy(o),_.multiplyScalar(c*c),h.multiplyScalar(p*p),u.multiplyScalar(2*c*c+3*c*p+p*p);var v=new t.Vector3D(0,0,0);(v=t.Vector3D.sub(_,h)).add(u);var l=1/(3*c*(c+p));return v.multiplyScalar(l),v}var r=this,o=r._controlPoints;if(void 0===r._points||s<2)return o;if(!0===r.isComputedParams()){var i=r._points,s=r._nbPoints=r._points.length,n=r._params,a=r._epsParam,c=0;for(c=0;c<s-1;c++){var p=c,h=new t.Vector3D(0,0,0),u=new t.Vector3D(0,0,0);p>0?h.copy(i[p-1]):h.copy(r._PtDeb),p<s-2?u.copy(i[p+2]):u.copy(r._PtFin);var _=e(h,i[p],i[p+1],n[p],n[p+1],n[p+2],a),v=e(u,i[p+1],i[p],-n[p+3],-n[p+2],-n[p+1],a);o.push(i[p]),o.push(_),o.push(v),o.push(i[p+1])}}return o},isComputedParams:function(){var e=this;if(!e._isReady){var r=e._points,o=e._points.length;if(void 0===r||o<2)return e._isReady;e._isReady=!0;var i=e._normals,s=e._pressures,n=e._velocities,a=e._params,c=0,p=0,h=0;void 0!==i&&(c=i.length),void 0!==s&&(p=s.length),void 0!==n&&(h=n.length);var u=e._PtDeb,_=e._PtFin,v=e._NrDeb,l=e._NrFin;e.toClose>=1&&o>2?(e.closeEndG0(),u.copy(r[o-2]),_.copy(r[1]),void 0!==i&&c===o&&(v.copy(i[o-2]),l.copy(i[1])),void 0!==s&&p===o&&(e._pressDeb=s[o-2],e._pressFin=s[1]),void 0!==n&&h===o&&(e._veloDeb=n[o-2],e._veloFin=n[1]),e._statusClosed=1):(e.closeEndG0(),u.copy(e.computeDebG0(r,o)),_.copy(e.computeFinG0(r,o)),void 0!==i&&c===o&&(v.copy(e.computeDebG0(i,o)),l.copy(e.computeFinG0(i,o))),void 0!==s&&p===o&&(o>2?(e._pressDeb=s[0]+s[1]-s[2],e._pressFin=s[o-1]+s[o-2]-s[o-3]):(e._pressDeb=2*s[0]-s[1],e._pressFin=2*s[1]-s[0])),void 0!==n&&h===o&&(o>2?(e._veloDeb=n[0]+n[1]-n[2],e._veloFin=n[o-1]+n[o-2]-n[o-3]):(e._veloDeb=2*n[0]-n[1],e._veloFin=2*n[1]-n[0])));var d=0;if(a.push(0),e._ALPHA<=0){for(d=1;d<=o+1;d++){var f=d;a.push(f)}return e._isReady}var D=0;for(d=1;d<=o+1;d++){f=d;var m=new t.Vector3D(0,0,0),y=new t.Vector3D(0,0,0);1===f?m.copy(u):m.copy(r[f-2]),f===o+1?y.copy(_):y.copy(r[f-1]);new t.Vector3D(0,0,0);var V=t.Vector3D.sub(y,m).norm();1===e._ALPHA?(a.push(D+V),D+=V):.5===e._ALPHA?(V=Math.sqrt(V),a.push(D+V),D+=V):(V=e._ALPHA*Math.log(V),V=Math.exp(V),a.push(D+V),D+=V)}}return e._isReady}});return e.namespace("DS/CATMathNTSJSOpe/CATMathRghImproveCR",o)})),define("DS/CATMathNTSJSOpe/CATMathRghDiscretize",["UWA/Core","DS/MathematicsES/MathsDef","DS/CATMathNTSJSOpe/CATMathRghImprove","DS/CATMathNTSJSOpe/CATMathRghImproveCR"],(function(e,t,r,o){"use strict";var i=e.Class.extend({init:function(){return this._mathRghImprove=null,this._discretizationType=0,this._discretizationStep=4,this._epsNorm=Math.pow(10,-6),this._minPtDist=this._epsNorm,this._params=[],this._nbPoints=0,this._hasRun=!1,this},setFunctionToDiscretize:function(e){this._mathRghImprove=e,this._hasRun=!1},setDiscretizationType:function(e,t){var r=this;r._discretizationType=e,r._discretizationStep=t,r._hasRun=!1},setMinLineLength:function(e){var t=this;e<t._epsNorm?t._minPtDist=t._epsNorm:t._minPtDist=e,t._hasRun=!1},getNbPoints:function(){var e=this;return void 0===e._points?e._nbPoints=0:(!1===e._hasRun&&e.run(),e._nbPoints=e._points.length),e._nbPoints},getListOfPoints:function(){var e=this;return!1===e._hasRun&&e.run(),e._points},getListOfNormals:function(){var e=this;return!1===e._hasRun&&e.run(),e._normals},getListOfPressures:function(){var e=this;return!1===e._hasRun&&e.run(),e._pressures},getListOfVelocities:function(){var e=this;return!1===e._hasRun&&e.run(),e._velocities},run:function(){var e=this;if(!0===e._hasRun)return e;e._hasRun=!0;var r=e._mathRghImprove;if(void 0===r)return e;var o=r.getNbCtrlPPArc();if(4===o){var i=r.getNbArcs(),s=[],n=[],a=[],c=[],p=e._params,h=s.length,u=e._discretizationStep;if(1!==e._discretizationType){u<=2&&(u=2);var _=0,v=u-2,l=1/(v+1),d=(v+1)/(v+2);for(_=0;_<=i-1;_++){var f=0;for(f=0;f<d;f+=l){var D=_+f;s.push(r.evalPoint(D)),p.push(D)}}s.push(r.evalPoint(i)),p.push(i),h=s.length}else{u<=0&&(u=10);var m=r.getControlPoints();if(m.length!==i*o)return e;_=0;for(_=1;_<=i;_++){var y=_;e.discretizeSmoothlyThisArc(m,y,s)}}(new t.Vector3D).copy(s[0]);var V=2*e._epsNorm*u/180;V*=V;for(var P,M,b,w,g=0;g<s.length-2;){y=0;P=s,M=g,b=p,w=V,y=t.Vector3D.sub(P[M],P[M+1]).squareNorm()<w?(P.splice(g,M),b.splice(g,M),M):M+1,g=y}if((h=s.length)>2)t.Vector3D.sub(s[h-1],s[h-2]).squareNorm()<V&&(s.splice(h-2,1),p.splice(h-2,1));for((h=s.length)>0&&(e._points=s,e._nbPoints=h),g=0;g<h;g++){D=p[g];var S=r.evalNrmal(D);if(void 0===S)break;n.push(S)}for(n.length>0&&(e._normals=n),g=0;g<h;g++){D=p[g];var C=r.evalPress(D);if(void 0===C)break;a.push(C)}for(a.length>0&&(e._pressures=a),g=0;g<h;g++){D=p[g];var A=r.evalVelo(D);if(void 0===A)break;c.push(A)}c.length>0&&(e._velocities=c)}},discretizeSmoothlyThisArc:function(e,r,o){var i=this,s=i._mathRghImprove,n=o,a=i._params,c=[];c.push(0),c.push(1);var p=[],h=new t.Vector3D(0,0,0),u=new t.Vector3D(0,0,0),_=new t.Vector3D(0,0,0),v=new t.Vector3D(0,0,0);h.copy(e[4*r-4]),u.copy(e[4*r-3]),_.copy(e[4*r-2]),v.copy(e[4*r-1]),p.push(h),p.push(u),p.push(_),p.push(v);var l=1,d=1,f=[];f.push(l);for(var D=[],m=!0;m;){if((l=f[d-1])<4){m=!0;var y=0;d=y=i.subdivideLastArc(p,d,c,f)}else D.push(p[4*d-4]),D.push(p[4*d-3]),D.push(p[4*d-2]),D.push(p[4*d-1]),p.splice(4*d-4,4),f.splice(d-1,1),d-=1;0===d&&(m=!1)}function V(e,r,o){var i=new t.Vector3D(0,0,0),s=new t.Vector3D(0,0,0),n=new t.Vector3D(0,0,0),a=new t.Vector3D(0,0,0);i.copy(e[4*r-4]),s.copy(e[4*r-3]),n.copy(e[4*r-2]),a.copy(e[4*r-1]),e[4*r-4].copy(e[4*o-4]),e[4*r-3].copy(e[4*o-3]),e[4*r-2].copy(e[4*o-2]),e[4*r-1].copy(e[4*o-1]),e[4*o-4].copy(i),e[4*o-3].copy(s),e[4*o-2].copy(n),e[4*o-1].copy(a)}var P=c.length-1,M=1;for(M=1;M<=P/2;M++){V(D,y=M,P-y+1)}var b=[],w=[],g=i._discretizationStep*Math.PI/180,S=1,C=P,A=r-1,N=A+1,L=0,R=0,T=g/2,F=T,O=0,E=.1,x=!1,z=A,k=N,I=t.Vector3D.sub(e[4*r-3],e[4*r-4]);I.normalize();var G=t.Vector3D.sub(e[4*r-2],e[4*r-1]);G.normalize();var J=(new t.Vector3D).copy(e[4*r-4]);for(n.push(J),a.push(A);!0!==x;){var H=new t.Vector3D,q=new t.Vector3D;H.copy(s.evalPoint(z)),q.copy(s.evalPoint(k));h=new t.Vector3D(0,0,0),u=new t.Vector3D(0,0,0),_=new t.Vector3D(0,0,0),v=new t.Vector3D(0,0,0);h.copy(s.evalPoint(A)),v.copy(s.evalPoint(N));var U=0,W=0;U=r-1+c[S],u.copy(s.evalPoint(U)),U>=N&&(U=N,u.copy(v)),W=r-1+c[C-1],_.copy(s.evalPoint(W)),W<=A&&(W=A,_.copy(h));var Z=t.Vector3D.sub(u,H);Z.normalize();var B=Math.acos(I.dot(Z)),K=t.Vector3D.sub(_,q);K.normalize();var j=Math.acos(G.dot(K));L+B>=T&&R+j<F?(B>0&&(O=E*T,U=i.refineParam(U,B,T-L,I,H,z,h,O)),U>=W&&(W=U=(U+W)/2,x=!0),U>A?(u.copy(s.evalPoint(U)),n.push(u),a.push(U),T=g,(I=t.Vector3D.sub(u,h)).normalize(),A=U,L=0,z=U):++S>P&&(x=!0),G.copy(K),R+=j,k=W,(--C<1||U>=N)&&(x=!0)):L+B<T&&R+j>=F?(j>0&&(O=E*F,W=i.refineParam(W,j,F-R,G,q,k,v,O)),W<=U&&(U=W=(U+W)/2,x=!0),W<N?(_.copy(s.evalPoint(W)),b.push(_),w.push(W),F=g,(G=t.Vector3D.sub(_,v)).normalize(),N=W,R=0,k=W):--C<1&&(x=!0),I.copy(Z),L+=B,z=U,(++S>P||W<=A)&&(x=!0)):L+B<T&&R+j<F?U>=W?(W=U=(U+W)/2,x=!0,u.copy(s.evalPoint(U)),n.push(u),a.push(U),A=U,N=W):(I.copy(Z),G.copy(K),z=U,k=W,L+=B,R+=j,C--,(++S>P||C<1||U>=N||W<=A)&&(x=!0)):L+B>=T&&R+j>=F?(B>0&&(O=E*T,U=i.refineParam(U,B,T-L,I,H,z,h,O)),j>0&&(O=E*F,W=i.refineParam(W,j,F-R,G,q,k,v,O)),U>=W?(W=U=(U+W)/2,x=!0,u.copy(s.evalPoint(U)),n.push(u),a.push(U),A=U,N=W):(U>A?(u.copy(s.evalPoint(U)),n.push(u),a.push(U),T=g,(I=t.Vector3D.sub(u,h)).normalize(),A=U,L=0):++S>P&&(x=!0),W<N?(_.copy(s.evalPoint(W)),b.push(_),w.push(W),F=g,(G=t.Vector3D.sub(_,v)).normalize(),N=W,R=0):--C<1&&(x=!0),z=U,k=W,(U>=N||W<=A)&&(x=!0))):x=!0}for(M=b.length-1;M>=0;M--){y=M,v=(new t.Vector3D).copy(b[y]),W=w[y];n.push(v),a.push(W)}if(r===s.getNbArcs()){v=(new t.Vector3D).copy(e[4*r-1]);n.push(v);W=r;a.push(W)}},subdivideLastArc:function(e,r,o,i){new t.Vector3D(0,0,0);var s=(new t.Vector3D).copy(e[4*r-4]),n=(new t.Vector3D).copy(e[4*r-3]),a=(new t.Vector3D).copy(e[4*r-2]),c=(new t.Vector3D).copy(e[4*r-1]),p=t.Vector3D.add(s,n),h=t.Vector3D.add(s,a),u=t.Vector3D.add(s,c),_=t.Vector3D.add(n,a);p.divideScalar(2),h.divideScalar(4);var v=n.clone();v.divideScalar(2),h.add(v),u.divideScalar(8),_.divideScalar(8),_.multiplyScalar(3);var l=t.Vector3D.add(u,_);u.copy(p),v.copy(h),_.copy(l),e[4*r-3].copy(u),e[4*r-2].copy(v),e[4*r-1].copy(_);var d=new t.Vector3D(0,0,0),f=new t.Vector3D(0,0,0);(p=t.Vector3D.add(n,c)).divideScalar(4),d.copy(a),d.divideScalar(2),p.add(d),(h=t.Vector3D.add(a,c)).divideScalar(2),d.copy(p),f.copy(h),e.push(_),e.push(d),e.push(f),e.push(c);var D=(o[r]+o[r-1])/2;o.splice(r,0,D);var m=i[r-1];return i[r-1]=2*m,i.splice(r,0,2*m),e.length/4},refineParam:function(e,r,o,i,s,n,a,c){var p=1,h=e,u=h,_=this._mathRghImprove;if(void 0===_)return u;var v=new t.Vector3D;v.copy(_.evalPoint(h));var l=t.Vector3D.sub(v,a),d=this._minPtDist,f=l.norm();if(f<=d)return u;var D=o/r*(h-n)+n;v.copy(_.evalPoint(D)),f=(l=t.Vector3D.sub(v,a)).norm();var m=t.Vector3D.sub(v,s);m.normalize();var y=Math.acos(i.dot(m));for(f>d&&y>0&&(u=D);Math.abs(o-y)>=c&&p<1&&f>d&&y>0;)u=D,D=o/r*((h=D)-n)+n,v.copy(_.evalPoint(D)),tPPrec=t.Vector3D.sub(v,a),f=tPPrec.norm(),(m=t.Vector3D.sub(P3,s)).normalize(),y=Mayth.acos(i.dot(m)),p++;return u}});return e.namespace("DS/CATMathNTSJSOpe/CATMathRghDiscretize",i)}));