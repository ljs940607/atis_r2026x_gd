var Uint16HalfFloatToFloat,byteArrayReader=function(e){this.buffer=e,this.currentPosition=0,this.readAt=function(e){return this.buffer[e]},this.length=function(){return buffer.length},this.getCurrentPosition=function(){return this.currentPosition},this.setPosition=function(e){this.currentPosition=e},this.read=function(){return this.buffer[this.currentPosition++]},this.readDouble=function(e,t){return new DataView(buffer.buffer).getFloat64(e,!0)},this.readUcompressedInt=function(e){return e?(this.read()<<24|this.read()<<16|this.read()<<8|this.read())>>>0:(this.read()|this.read()<<8|this.read()<<16|this.read()<<24)>>>0},this.readInt=function(e){return e?this.read()<<24|this.read()<<16|this.read()<<8|this.read():this.read()|this.read()<<8|this.read()<<16|this.read()<<24},this.clone=function(){return new byteArrayReader(this.buffer)},this.getDataViews=function(e,t){return views=[],views.push({dataView:new DataView(this.buffer.buffer,e,t),buffer:this.buffer,offset:e}),views}};{var mantissatable=new Array(2048),exponenttable=new Array(64),offsettable=new Array(64);function convertMantissa(e){for(var t=e<<13,r=0;!(8388608&t);)r-=8388608,t<<=1;return(t&=-8388609)|(r+=947912704)}mantissatable[0]=0;for(var i=1;i<1024;i++)mantissatable[i]=convertMantissa(i);for(i=1024;i<2048;i++)mantissatable[i]=939524096+(i-1024<<13);exponenttable[0]=0;for(i=1;i<31;i++)exponenttable[i]=i<<23;exponenttable[31]=1199570944,exponenttable[32]=2147483648;for(i=33;i<63;i++)exponenttable[i]=i-32+2147483648<<23;exponenttable[63]=3347054592,offsettable[0]=0,offsettable[32]=0;for(i=1;i<64;i++)32!==i&&(offsettable[i]=1024);var uint32Array=new Uint32Array(1),float32Array=new Float32Array(uint32Array.buffer);Uint16HalfFloatToFloat=function(e){return uint32Array[0]=mantissatable[offsettable[e>>10]+(1023&e)]+exponenttable[e>>10],float32Array[0]}}var one_over_65535=1/65535,Uint16PositionsToFloats=function(e,t,r,i,n){for(var s=r.length/3,a=[Math.max(n.x-i.x,1e-6)*one_over_65535,Math.max(n.y-i.y,1e-6)*one_over_65535,Math.max(n.z-i.z,1e-6)*one_over_65535],o=[Math.floor(i.x/a[0]),Math.floor(i.y/a[1]),Math.floor(i.z/a[2])],p=e;p<s+e;p++){var h=r[3*p],u=r[3*p+1],f=r[3*p+2];t[3*p]=(o[0]+h)*a[0],t[3*p+1]=(o[1]+u)*a[1],t[3*p+2]=(o[2]+f)*a[2]}},setOctohedralToFloatArray=function(e,t,r,i){var n=2*t-1,s=2*r-1,a=1-Math.abs(n)-Math.abs(s);if(a<=0){var o=(1-Math.abs(s))*(n>=0?1:-1),p=(1-Math.abs(n))*(s>=0?1:-1);n=o,s=p}var h=Math.sqrt(n*n+s*s+a*a);e[3*i]=n/h,e[3*i+1]=s/h,e[3*i+2]=a/h},Oct24NormalsToFloats=function(e,t,r){for(var i=r.length/3,n=e;n<i+e;n++){var s=r[3*n],a=r[3*n+1],o=r[3*n+2],p=(16*s+Math.floor(a/16))/4095;setOctohedralToFloatArray(t,p,(a%16*256+o)/4095,n)}},Oct16NormalsToFloats=function(e,t,r){for(var i=r.length/2,n=e;n<i+e;n++){var s=r[2*n]/255,a=r[2*n+1]/255;setOctohedralToFloatArray(t,s,a,n)}};let CGRFile_preqs=["DS/Mesh/Mesh","DS/Mesh/ThreeJS_Base"];this.GAUSSIAN_SPLATTING_PARSING_INCLUDE&&CGRFile_preqs.push("DS/Mesh/GaussianSplattingParsing"),define("DS/Formats/CGRFile",CGRFile_preqs,(function(e,t,r){"use strict";let n=!1;const s=210042850;let a=new Float32Array(100),o=new Int16Array(100),p=new Uint16Array(100),h=new Uint8Array(100);const u=210042800,f=206,d=177,c=178,l=155,m=255,v=80,y=81,g=82,x=83,B=84,A=85,I=86,b=87,C=88,S=89,w=119,P=156,M=157,R=160,T=1,U=2;let F=0,G=!1,O=0,N=0;new Map([["segoeuiz.ttf",{fontName:"Segoe UI",italic:!0,bold:!0}],["segoeui.ttf",{fontName:"Segoe UI",italic:!1,bold:!1}],["segoeuib.ttf",{fontName:"Segoe UI ",italic:!1,bold:!0}],["segoeuii.ttf",{fontName:"Segoe UI ",italic:!0,bold:!1}],["seguisb.ttf",{fontName:"Segoe UI Semibold",italic:!1,bold:!1}],["DSISO1.otf",{fontName:"DS ISO 1",italic:!1,bold:!1}],["DSISO1I.otf",{fontName:"DS ISO 1",italic:!0,bold:!1}],["DSISO1BI.otf",{fontName:"DS ISO 1",italic:!0,bold:!0}],["DSISO1B.otf",{fontName:"DS ISO 1",italic:!1,bold:!0}],["DroidSerif-Bold.ttf",{fontName:"Droid Serif",italic:!1,bold:!0}],["DroidSerif.ttf",{fontName:"Droid Serif",italic:!1,bold:!1}],["DroidSerif-Italic.ttf",{fontName:"Droid Serif",italic:!0,bold:!1}],["3ds Bold Italic.ttf",{fontName:"3ds",italic:!0,bold:!0}],["3ds Bold.ttf",{fontName:"3ds",italic:!1,bold:!0}],["3ds Italic.ttf",{fontName:"3ds",italic:!0,bold:!1}],["3ds Regular.ttf",{fontName:"3ds",italic:!1,bold:!1}]]);const E=["PLANAR","CYLINDRICAL","INFINITE_CYLINDRICAL","SPHERICAL","CUBIC","INFINITE_CYLINDRICAL_NORM_ANGLE_PRES"];let D=new Uint32Array(1),L=new Uint8Array(D.buffer),k=new BigUint64Array(1),V=new Uint8Array(k.buffer);const _=0,z=1,j=2,W=3,H=4,X=5,Y=6,q=7,Q=8,Z={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5},J=1,K=2,$=3,ee=5,te=6,re=65535,ie={LAYER_MAX_64:BigInt("0xFFFFFFFFFFFFFFFF"),LAYER_MAX_MINUS_ONE_64:BigInt("0xFFFFFFFFFFFFFFFE"),LAYER_MAX:4294967295,LAYER_MAX_MINUS_ONE:4294967294,STREAM_NONE:0,STREAM_MATERIAL:1,STREAM_INHERIT_INT:2,STREAM_INHERIT_UINT:4,STREAM_INHERIT_ULONG:8,STREAM_LAYER_INT:16,STREAM_LAYER_UINT:32,STREAM_LAYER_ULONG:64,STREAM_UVTRANSFO:128,STREAM_MAPPING_INFO:256,STREAM_LIGHTMAP:512,STREAM_DECAL:1024,STREAM_ALL_INT:915,STREAM_ALL_UINT:933,STREAM_ALL_ULONG:969},ne=1,se=0,ae=1,oe=3,pe=4,he=5,ue=6,fe=7,de=new Map;var ce=function(e,t,r,i){this.material=t||null,this.inheritanceMaterial=null!=r?r:1,this.layer=null!=i?i:e?ie.LAYER_MAX_64:ie.LAYER_MAX,this.ilayer64=e||!1,this.mapping=null,this.decal=null,this.stream=function(){return{material:this.material,layer:this.layer,ilayer64:this.ilayer64,mapping:this.mapping,decal:this.decal}},this.readLayer=function(e,t){if(e.version>=210042800)if(t&ie.STREAM_LAYER_INT){var r=e.readUncompressedInt();this.layer=BigInt(r)+(BigInt(4294967295)<<32n)}else if(t&ie.STREAM_LAYER_UINT){r=e.readCompressedUInt();this.layer=BigInt(r)+(BigInt(4294967295)<<32n)}else t&ie.STREAM_LAYER_ULONG&&(this.layer=e.readUInt64FromBytes());else t&ie.STREAM_LAYER_INT?this.layer=e.readUncompressedInt():t&ie.STREAM_LAYER_UINT?this.layer=e.readCompressedUInt():t&ie.STREAM_LAYER_ULONG&&(this.layer=e.readUncompressedUInt())},this.readInheritance=function(e,t){e.version>=1100500?t&ie.STREAM_INHERIT_INT||t&ie.STREAM_INHERIT_UINT?this.inheritanceMaterial=e.readCompressedInt():t&ie.STREAM_INHERIT_ULONG&&(this.inheritanceMaterial=e.readUncompressedInt()):t&(ie.STREAM_INHERIT_INT|ie.STREAM_INHERIT_UINT|ie.STREAM_INHERIT_ULONG)&&(this.inheritanceMaterial=1)},this.readMaterial=function(e,t){t&ie.STREAM_MATERIAL&&(this.material=e.unstreamMaterial())},this.setMapping=function(e){this.mapping=e},this.getMapping=function(){return this.mapping},this.setDecal=function(e){this.decal=e},this.copy=function(e){this.material=e.material,this.inheritanceMaterial=e.inheritanceMaterial,this.layer=e.layer,this.ilayer64=e.ilayer64,this.mapping=e.mapping,this.decal=e.decal},this.forceMaterial=function(){this.layer=e?BigInt(0):0},this.getLayerMaxMinusOne=function(){return e?ie.LAYER_MAX_MINUS_ONE_64:ie.LAYER_MAX_MINUS_ONE},this.getLayerMax=function(){return e?ie.LAYER_MAX_64:ie.LAYER_MAX}},le=function(){var e=[];return e[_]=new ds,e[j]=new ds,e[Y]=new ds,e[W]=new ds,e[q]=new ds,e[H]=new ds,e[X]=new ds,e[z]=new ds,e[Q]=new ds,e},me=function(e,t,r,i,n,s){this.lineWeight=e,this.lineType=t,this.lineTypeScale=r,this.color=void 0!==n?n:null,this.transparency=void 0!==s?s:0,this.inheritanceMode=i,this.forceLineWeight=192&i,this.forceColor=48&i,this.forceLineType=12&i,this.forceTransparency=3&i,this.stream=function(){return{lineWeight:this.lineWeight,lineType:this.lineType,lineTypeScale:this.lineTypeScale}},this.updateFromGasAndLayer=function(e,t,r){r.length>t&&(this.isLineWeightByLayer()&&e.setLineThickness(r[t].lineWeight),this.isColorByLayer()&&e.setRGBAColorRGBChannel(r[t].color.r,r[t].color.g,r[t].color.b),this.isLineTypeByLayer()&&e.setLineType(r[t].lineTypeIndex),this.isTransparencyByLayer()&&e.setRGBAColorAlphaChannel(r[t].transparency))},this.updateFromGas=function(e){this.forceColor&&(this.color=e.getRGBAColor()),forceTransparency&&(this.transparency=e.getRGBAColor()[3])},this.clone=function(){return new me(this.lineWeight,this.lineType,this.lineTypeScale,this.inheritanceMode,this.color,this.transparency)},this.isForceInheritance=function(){return this.forceLineWeight||this.forceColor||this.forceLineType||this.forceTransparency},this.updateFromParent=function(e){return e.forceLineType&&(this.lineType=e.lineType),e.forceLineWeight&&(this.lineWeight=e.lineWeight),e.forceColor||e.forceTransparency},this.isLineWeightByLayer=function(){return 128&this.inheritanceMode},this.isLineWeightByBlock=function(){return 64&this.inheritanceMode},this.isColorByLayer=function(){return 32&this.inheritanceMode},this.isColorByBlock=function(){return 16&this.inheritanceMode},this.isLineTypeByLayer=function(){return 8&this.inheritanceMode},this.isLineTypeByBlock=function(){return 4&this.inheritanceMode},this.isTransparencyByLayer=function(){return 2&this.inheritanceMode},this.isTransparencyByBlock=function(){return 1&this.inheritanceMode}},ve=function(e,t,r,i,n,s){this.color=e,this.frozen=t,this.transparency=r,this.lineScale=i,this.lineTypeIndex=n,this.lineWeight=s},ye=function(r,i){this.name=i,this.conversion=!1,this.version=0,this.bitBoolean=0,this.bitPacking=0,this.intPacking=0,this.gasPacking=0,this.global_gas=[],this.cullingData={tab:[]},this.ssbBoxPosition={tab:[]},this.advancedPriority=!1;var n=!0,s=[];this.isInherit=!1,this.idOrder=0,this.semanticType=0,this.multiRefReps=[],this.multiRefCount=0,this.textures=new ds,this.materials=new ds,this.batches=new ds,this.compressedArrayInfo={tab:[],index:0},this.sgOrderStructs=[new Map],this.reps=[le()],this.compoundSaveReps=null,this.currentAttr=[null],this.mergeDGs=[[]],this.currentDGs=[[]],this.filterSceneGraphOrder=4278190216,this.infiniteGeometries=new ds,this.advancedInheritanceArray=[],this.curvedPipes=new ds,this.sgReps={nbRep:0,tab:[]},this.sgRep=[],this.nbRep=0,this.decorations=new multiTabDecorations,this.texts=new ds,this.layerTables=[],this.currentMatrix=[],this.flexibleMatrices=[],this.flexibleMatrixMode=!1,this.staticMode=[],this.fixedSizeMode=!1,this.multiRefNode=new Map,this.fakeMultiRep=[new Set],this.buffer=r,this.numberOfVertices=0,this.cgrContainer=null,this.bitContainer=0,this.bitsRemaining=0,this.nbBitsPerVertex=0,this.currentLayerNumber=[];var f=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215,33554431,67108863,134217727,268435455,536870911,1073741823,2147483647],d=0,c=[0,0,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9];this.isLightScenegraph=function(){return false},this.setSemanticType=function(e){this.semanticType=e},this.getSemanticType=function(){return this.semanticType},this.getCullingBuffer=function(){return this.cullingData},this.setAdvancedPriority=function(e){this.advancedPriority=e},this.createMatApp=function(){return new ce(this.version>=210042800)},this.getAdvancedPriority=function(){return this.advancedPriority},this.getSsbBoxPosition=function(){var e=this.ssbBoxPosition;return this.ssbBoxPosition={tab:[]},e.tab},this.createMatrix3=function(e){return[e[0],e[1],0,e[2],e[3],0,e[4],e[5],1]},this.pushFakeMultiRepSet=function(){this.version<210042720&&this.fakeMultiRep.push(new Set)},this.popFakeMultiRepSet=function(){this.version<210042720&&this.fakeMultiRep.pop()},this.hasFakeMultiRepIndice=function(e){for(var t=0;t<this.fakeMultiRep.length;t++)if(this.fakeMultiRep[t].has(e))return!0;return!1},this.setFakeMultiRepIndice=function(e){this.fakeMultiRep[this.fakeMultiRep.length-1].add(e)},this.pushReps=function(){this.reps.push(le())},this.popReps=function(){return this.reps.pop()},this.addCurrentLayerNumber=function(e){$n.flexibleBatching&&this.version>=u&&(e!=re&&0!=e?this.currentLayerNumber.push(e):this.currentLayerNumber.push(this.currentLayerNumber[this.currentLayerNumber.length-1]))},this.getCurrentLayerNumber=function(){return this.currentLayerNumber.length?this.currentLayerNumber[this.currentLayerNumber.length-1]:re},this.updateAdvancedInheritance=function(e){var t=this.getCurrentAdvancedInheritance();t&&t.updateFromGas(e),this.ACADInheritance=!1},this.setAdvancedInheritance=function(e){if($n.flexibleBatching&&this.version>=u){var t=this.getCurrentAdvancedInheritance();if(t&&t.isForceInheritance()){var r=e.clone();this.ACADInheritance=r.updateFromParent(t),this.advancedInheritanceArray.push(AdvInh)}}else this.advancedInheritanceArray.push(e)},this.pushLayerTable=function(e){this.layerTables.push(e)},this.popLayerTable=function(){return this.layerTables.pop()},this.getCurrentLayerTable=function(){return this.layerTables.length?this.layerTables[this.layerTables.length-1]:null},this.getAdvancedInheritance=function(){return this.advancedInheritanceArray.length?this.advancedInheritanceArray[this.advancedInheritanceArray.length-1]:null},this.getCurrentAdvancedInheritance=function(){return this.advancedInheritanceArray.length?this.advancedInheritanceArray[this.advancedInheritanceArray.length-1].stream():null},this.mergeWithPreviousReps=function(){for(var e=this.reps.pop(),t=this.getCurrentReps(),r=0;r<e.length;r++)for(var i=e[r].getArray(),n=0;n<i.length;n++)t[r].add(i[n])},this.getCurrentSgOrderStructs=function(){return this.sgOrderStructs[this.sgOrderStructs.length-1]},this.pushSceneGraphOrderParameters=function(){this.sgOrderStructs.push(new Map)},this.popSceneGraphOrderParameters=function(){this.sgOrderStructs.pop()},this.getAllReps=function(){var e=[],t=[];this.reps.length&&(t=this.reps[this.reps.length-1]);for(var r=0;r<t.length;r++)for(var i=t[r].getArray(),n=0;n<i.length;n++)e.push(i[n]);return e},this.addCompressedInfo=function(e,t,r){let i=e.clone(),n=t.clone();if(r){let e=r.decompose()[1];i.applyQuaternion(e),n.applyMatrix4(r)}this.compressedArrayInfo.tab.push(i.x),this.compressedArrayInfo.tab.push(i.y),this.compressedArrayInfo.tab.push(i.z),this.compressedArrayInfo.tab.push(n.x),this.compressedArrayInfo.tab.push(n.y),this.compressedArrayInfo.tab.push(n.z),r||(r={elements:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]});for(var s=0;s<12;s+=4)this.compressedArrayInfo.tab.push(r.elements[s]),this.compressedArrayInfo.tab.push(r.elements[s+1]),this.compressedArrayInfo.tab.push(r.elements[s+2])},this.materialApplicationUnstream=function(e){var t=this.createMatApp();if(t.readMaterial(this,e),t.readInheritance(this,e),t.readLayer(this,e),e&ie.STREAM_UVTRANSFO){if(this.version>=210041900){var r=[0,0,0,1];if(this.readBoolean()){var i=!0,n=this.readFloat(),s=this.readFloat(),a=this.readFloat(),o=this.readFloat();n!=r[0]&&(r[0]=n,i=!1),s!=r[1]&&(r[1]=s,i=!1),a!=r[2]&&(r[2]=a,i=!1),o!=r[3]&&(r[3]=o,i=!1),i||t.setMapping({type:0,ObjectTransformation:null,UvTransformation:null,UvTransfoInfos:r,transformSemantic:1})}}}if(e&ie.STREAM_MAPPING_INFO&&(this.version>=210042100&&!this.readBoolean())){var p=this.readStringWithLength();p=(p=JSON.parse(p)).mappings[p.uvSlots.Default];var h=t.getMapping();if(h||(h={type:0,ObjectTransformation:null,UvTransformation:null,UvTransfoInfos:null,transformSemantic:1}),t.setMapping(h),p.uvTrfSemantic&&(h.transformSemantic=p.uvTrfSemantic+1),p.uvTransform&&(h.UvTransformation=this.createMatrix3(p.uvTransform)),p.operator&&(h.type=p.operator.type,p.operator.transform)){var u=p.operator.transform;h.ObjectTransformation=u}}if(e&ie.STREAM_LIGHTMAP&&(this.version>=210042320&&1==this.readCompressedInt()))this.readStringWithLength(),this.readCompressedInt(),this.readUncompressedULong();if(e&ie.STREAM_DECAL&&(this.version>=210042710&&this.readBoolean())){var f=this.readBoolean(),d=this.readBoolean(),c=this.readCompressedInt();if(this.multiRefNode.has(c)){if(y=this.multiRefNode.get(c)){var l={decal:y,decalApplied:f,decalAttached:d};t.setDecal(l)}}else{var m=[];this.readDoubles(m,16);var v=E[this.readCompressedInt()];v||(v="NONE");var y={decalIndex:c,decalMatrix:m,decalProjector:v,decalBoundingGeometry:this.readCompressedInt(),decalMode:this.readCompressedInt(),decalImplicitScaleU:this.readFloat(),decalImplicitScaleV:this.readFloat()};this.multiRefNode.set(c,y)}if(y){l={decal:y,decalApplied:f,decalAttached:d};t.setDecal(l)}}return t},this.unstreamMaterial=function(){var e,t={id:-1},r=0,i=this.readUnsignedChar(),n=0,s=null;if(i){if(2==i){this.readStringWithLength();return r=this.readCompressedInt(),t.id=this.materials.add({external3DXid:r}),t}if(n=this.readCompressedInt(),this.materials.isValidMultiRefIndexWithName(n,this.name))return t={id:u=this.materials.getIndexWithName(n,this.name)}}if(this.version>=210021320){var a=this.readCompressedInt();s=1===a?new Ke:4===a?new He:9===a&&this.version>=210042100?new qe:new We}else s=new We;e=s.unstream(this);var o=this.getCurrentPosition(),p=this.getBytesRemain();p>32&&(p=32);var h=this.readString(p);(this.setCurrentPosition(o),-1!==h.indexOf('{\n"Version" : '))&&(new He).skip(this);if(1===a)var u=e;else{u=this.materials.add(e);e._MaterialPropertiesActivate}return t={id:u},i&&this.materials.addMultiRefIndexWithName(n,u,this.name),t},this.processedMergeDGs=function(){var e=this.getCurrentSgOrderStructs(),t=[];if(e)for(const a of e.values()){for(var r=a.mergeDgs,i=a.currentDgs,n=0;n<r.length;n++){(s=r[n]).geometry.noZDgIndex.push(t.length),t.push(s)}i.sort((function(e,t){if(e.glType<t.glType)return-1;if(e.glType>t.glType)return 1;if(null==e.material&&null!=t.material)return-1;if(null!=e.material&&null==t.material)return 1;if(null!=e.material&&null!=t.material){if(e.material.id<t.material.id)return-1;if(e.material.id>t.material.id)return 1}if(null==e.gas&&null!=t.gas)return-1;if(null!=e.gas&&null==t.gas)return-1;if(null!=e.gas&&null!=t.gas){if(e.gas.set<t.gas.set)return 1;if(t.gas.set<e.gas.set)return-1;if(e.gas.rgba<t.gas.rgba)return 1;if(t.gas.rgba<e.gas.rgba)return-1;if(e.gas.webOverride<t.gas.webOverride)return 1;if(t.gas.webOverride<e.gas.webOverride)return-1}if(e._geomType&&t._geomType){if(e._geomType<t._geomType)return-1;if(e._geomType>t._geomType)return 1}return 0}));for(n=0;n<i.length;n++){var s;(s=i[n]).geometry.noZDgIndex.push(t.length),t.push(s)}}return t},this.setDGs=function(e,t){var r=this.getCurrentSgOrderStructs(),i=e.drawingGroups,n=null,s=null;r||(r=new Map);for(var a=0;a<i.length;a++){var o=i[a];if(1===$n.sceneGraphOrder||!o||!o.gas||o.gas.isNoZ()){var p=o.gas.getPriority();t&&(o.gas.setSceneGraphOrder(1),p=4),r.has(p)?s=r.get(p):(s={currentDgs:[],mergeDgs:[]},r.set(p,s)),s.currentDgs.length&&(n=s.currentDgs[s.currentDgs.length-1]),o.geometry=e;var h=s.currentDgs;if(h.length){var u=n.material,f=n.gas;if((null==u&&null==o.material||null!=u&&null!=o.material&&u.id==o.material.id)&&(o.gas.set&this.filterSceneGraphOrder)==(f.set&this.filterSceneGraphOrder)&&o.gas.rgba==f.rgba)h.push(o),n=o;else{h.sort((function(e,t){if(e.glType<t.glType)return-1;if(e.glType>t.glType)return 1;if(null==e.material&&null!=t.material)return-1;if(null!=e.material&&null==t.material)return 1;if(null!=e.material&&null!=t.material){if(e.material.id<t.material.id)return-1;if(e.material.id>t.material.id)return 1}if(null==e.gas&&null!=t.gas)return-1;if(null!=e.gas&&null==t.gas)return-1;if(null!=e.gas&&null!=t.gas){if(e.gas.set<t.gas.set)return 1;if(t.gas.set<e.gas.set)return-1;if(e.gas.rgba<t.gas.rgba)return 1;if(t.gas.rgba<e.gas.rgba)return-1}if(e._geomType&&t._geomType){if(e._geomType<t._geomType)return-1;if(e._geomType>t._geomType)return 1}return 0}));for(var d=0;d<h.length;d++)s.mergeDgs.push(h[d]);s.currentDgs=[o],n=o}}else h.push(o),n=o}}},this.addReps=function(e,t,r,i,n){var s=(i?1:0)<<1|(t?1:0);return n&&(s=8),this.expandCGR&&(s=0),(1==$n.sceneGraphOrder||$n.sceneGraphOrderPriority)&&this.setDGs(e,1==$n.sceneGraphOrder),{renderType:s,indice:this.getCurrentReps()[s].add(e)}},this.getCurrentReps=function(){return this.reps[this.reps.length-1]},this.getReps=function(e,t){return Jn&&this.compoundSaveReps?this.compoundSaveReps[t].get(e):this.getCurrentReps()[t].get(e)},this.getBytesRemain=function(){return this.buffer.getBytesRemain()},this.getUInt32FromBytes=function(e,t,r,i){return L[0]=e,L[1]=t,L[2]=r,L[3]=i,D[0]},this.readUInt64FromBytes=function(){return this.getUInt64FromBytes(this.buffer.read(),this.buffer.read(),this.buffer.read(),this.buffer.read(),this.buffer.read(),this.buffer.read(),this.buffer.read(),this.buffer.read())},this.getUInt64FromBytes=function(e,t,r,i,n,s,a,o){return V[0]=n,V[1]=s,V[2]=a,V[3]=o,V[4]=e,V[5]=t,V[6]=r,V[7]=i,k[0]},this.readString=function(e){for(var t=new String,r=0;r<e;r++){t+=String.fromCharCode(this.buffer.read())}return t},this.readStringWithLength=function(e){for(var t=new String,r=(e=this.readCompressedInt(),0);r<e;r++){t+=String.fromCharCode(this.buffer.read())}return t},this.readUnicodeString=function(e){for(var t=new String,r=0;r<e-1;r++){var i=this.readUnsignedShort();t+=String.fromCharCode(i)}return this.readUnsignedShort(),t},this.setCurrentPosition=function(e){if(this.buffer.buffer&&e>this.buffer.buffer.length)throw"setCurrentPosition out of range";return this.buffer.setPosition(e),!0},this.getCurrentPosition=function(){return this.buffer.getCurrentPosition()},this.readRepSize=function(e){if(this.version>=210042730)return this.readUncompressedInt();if(!e)return 0;var t=this.readCompressedInt();switch(e){case 1:break;case 2:t=-t-2;break;case 3:t-=1}return t},this.skip=function(e){this.buffer.setPosition(this.buffer.getCurrentPosition()+e)},this.readClassName=function(){return this.readUnsignedChar()},this.getUnstreamer=function(e){switch(e){case 97:return new Pt;case 98:return new Vi;case 99:return new bt;case 100:return new ut;case 101:return new gt;case 102:return new Wi;case 103:return new vt;case 104:return new Rt;case 112:return new Xi;case 113:return new ft;case 114:return new xt;case 115:return new wt;case 116:return new Bt;case 120:return new yt;case 137:return new Hi;case 145:case 146:case 150:case 188:case 206:return new wi;case 147:return new sn;case 148:return new lt;case 149:return new mt;case 152:return new on;case 153:return new Mt;case 154:return new pn;case 158:return new At;case 159:return new It;case 161:return new Tt;case 163:return new nn;case 170:return new St;case 171:return new Ct;case 172:return new Ut;case 173:return new Ft;case 174:return new Ot;case 175:return new Nt;case 176:return new Gt;case 179:return new ln;case 181:return new Si;case 182:return new xn;case 183:return new mn;case 184:return new un;case 185:return new _i;case 186:return new zi;case 189:return new ji;case 192:return new Sn;case 193:return new Pn;case 194:return new Rn;case 195:return new Un;case 196:return new Gn;case 197:return new Nn;case 198:return new Dn;case 199:return new kn;case 201:return new _n;case 202:return new hn;case 203:return new yn;case 204:return new an;case 205:return new cn;case 207:return new dn;case 208:return new fn;case 209:return new jn;case 255:return new Ci;default:return this.error="file is corrupted.  unknown className..."+e,null}},this.readGraphicAttributeSet=function(){var t=null;return $n.depthMode2D?(t=new e.GraphicAttributeSetForDepth(this.readUncompressedInt(),this.readUncompressedInt())).isNoZ()&&t.setDepthMode(!0):t=new e.GraphicAttributeSet(this.readUncompressedInt(),this.readUncompressedInt()),this.getAdvancedPriority()&&t.isNoZ(),t},this.readMatrix=function(){var e=[],r=0;if(this.version>=210021610){var i=this.readCompressedInt(),n=this.readUnsignedChar(),s=[];this.readDoubles(s,n);var a=0;for(r=0,a=0;r<16;r++)switch((i&3<<2*r)>>2*r){case 0:e[r]=s[a++];break;case 1:case-1:e[r]=0;break;case-2:case 2:e[r]=1;break;case 3:case-3:e[r]=-1}}else for(r=0;r<16;++r)e.push(this.readFloat());var o=new t.Matrix4;return o.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),o},this.read2DMatrix=function(){var e=[],r=0;for(r=0;r<16;++r)e.push(this.readFloat());var i=new t.Matrix4;return i.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),i},this.readFloatArray=function(e,t,r){this.buffer.readFloatArray(e,t,r,this.conversion)},this.readFloatArrayBuffer=function(e,t){this.buffer.readFloatArrayBuffer(e,t,this.conversion)},this.readUnsignedShortArrayWithIndex=function(e,t,r,i){for(var n=e;n<t;n+=4)this.buffer.readUnsignedShortArray(e,3,r,!0),r[e+3]=i},this.readUnsignedShortArray=function(e,t,r){this.buffer.readUnsignedShortArray(e,t,r,!0)},this.readUnsignedShortArrayBuffer=function(e,t){this.buffer.readUnsignedShortArrayBuffer(e,t,this.conversion)},this.readDouble=function(){return this.buffer.readDouble(this.conversion)},this.readDoubles=function(e,t){for(var r=0;r<t;++r)e.push(this.readDouble())},this.getNumberOfVertices=function(){return this.numberOfVertices},this.setNumberOfVertices=function(e){if(this.numberOfVertices=e,this.bitPacking){if(e<500)return void(d=c[this.numberOfVertices]);d=0;var t=e;do{++d}while(t>>=1)}},this.setContainer=function(e){this.cgrContainer=e},this.getContainer=function(){return this.cgrContainer},this.readBitIteration=function(e){if(this.version<210042725)return this.readBits(e);for(var t=0,r=0;r<e;r++){t|=(1&this.readBit())<<r}return t},this.readBits=function(e){var t;if(e<=this.bitsRemaining)t=this.bitContainer&f[e],this.bitContainer>>=e,this.bitsRemaining-=e;else if(e<=32){t=0;var r=e;t|=this.bitContainer&f[this.bitsRemaining],r-=this.bitsRemaining,this.bitContainer=this.readUncompressedInt(),t|=(this.bitContainer&f[r])<<this.bitsRemaining,this.bitContainer>>=r,this.bitsRemaining=32-r}else{var i=0;r=e;do{for(;this.bitsRemaining&&r;)t|=(1&this.bitContainer)<<i++,bitContainer>>=1,this.bitsRemaining--,r--;r&&(this.bitContainer=this.readUncompressedInt(),this.bitsRemaining=32)}while(r)}return t},this.readBit=function(){var e=0;return this.version>=210042725?this.readUnsignedChar():this.bitsRemaining?(e=1&this.bitContainer,this.bitContainer>>=1,this.bitsRemaining--,e):(this.bitContainer=this.readUncompressedInt(),e=1&this.bitContainer,this.bitContainer>>=1,this.bitsRemaining=31,e)},this.readBoolean=function(){return this.bitBoolean?this.readBit():this.readUnsignedChar()},this.readPositions=function(e,t,r){var i=3*e;if(this.readBoolean())this.readFloatArray(i,3*t,r);else{var n=Math.ceil(t/4),s=null;Jn?(s=new Uint8Array(n),this.readBytes(n,s)):s=this.buffer.getByteView(n,h);var o=this.readCompressedInt();o>a.length&&(a=new Float32Array(o)),this.readFloatArrayBuffer(o,a);for(var p=0,u=0,f=0,d=0,c=0,l=0,m=0,v=0;v<t;v++){0==u&&(m=3&s[p]),1==u&&(m=(12&s[p])>>2),2==u&&(m=(48&s[p])>>4),3==u&&(m=(192&s[p])>>6,u=-1,p++),u++;0==m?(r[i++]=a[f],r[i++]=a[f+1],r[i++]=a[f+2],d=a[f],c=a[f+1],l=a[f+2],f+=3):2==m?(r[i++]=d,r[i++]=c,r[i++]=a[f],l=a[f],f++):3==m?(r[i++]=d,r[i++]=a[f],r[i++]=a[f+1],c=a[f],l=a[f+1],f+=2):(r[i++]=d,r[i++]=c,r[i++]=l)}}},this.readQuantPositions=function(e,t){var r=0;if(this.readBoolean())this.readUnsignedShortArray(0,3*e,t);else{var i=Math.ceil(e/2),n=null;Jn?(n=new Uint8Array(i),this.readBytes(i,n)):n=this.buffer.getByteView(i,h);var s=this.readCompressedInt();s>p.length&&(p=new Uint16Array(s)),this.readUnsignedShortArrayBuffer(s,p);for(var a=0,o=0,u=0,f=0,d=0,c=0,l=0,m=0;m<e;m++){0==o&&(l=3&n[a]),1==o&&(l=(12&n[a])>>2),2==o&&(l=(48&n[a])>>4),3==o&&(l=(192&n[a])>>6,o=-1,a++),o++;0==l?(t[r++]=p[u],t[r++]=p[u+1],t[r++]=p[u+2],f=p[u],d=p[u+1],c=p[u+2],u+=3):2==l?(t[r++]=f,t[r++]=d,t[r++]=p[u],c=p[u],u++):3==l?(t[r++]=f,t[r++]=p[u],t[r++]=p[u+1],d=p[u],c=p[u+1],u+=2):(t[r++]=f,t[r++]=d,t[r++]=c)}}},this.readOldPositionsArrayBuffer=function(e,t,r){if(this.readBoolean())for(var i=0;i<e;++i)t[r++]=this.readFloat();else{var n=Math.ceil(e/12),s=new Uint8Array(n);this.readBytes(n,s);var a=this.readCompressedUInt(),o=new Float32Array(a);for(i=0;i<a;++i)o[i]=this.readFloat();var p=0,h=0,u=0,f=0,d=0,c=0;for(i=0;i<e/3;i++){0==h&&(flagvalue=3&s[p]),1==h&&(flagvalue=(12&s[p])>>2),2==h&&(flagvalue=(48&s[p])>>4),3==h&&(flagvalue=(192&s[p])>>6,h=-1,p++),h++;var l=3*i;0==flagvalue?(t[3*r+l]=o[u],t[3*r+l+1]=o[u+1],t[3*r+l+2]=o[u+2],f=o[u],d=o[u+1],c=o[u+2],u+=3):2==flagvalue?(t[3*r+l]=f,t[3*r+l+1]=d,t[3*r+l+2]=o[u],c=o[u],u++):3==flagvalue?(t[3*r+l]=f,t[3*r+l+1]=o[u],t[3*r+l+2]=o[u+1],d=o[u],c=o[u+1],u+=2):(t[3*r+l]=f,t[3*r+l+1]=d,t[3*r+l+2]=c)}}},this.readPositionsArrayBuffer=function(e,t,r){if(this.readBoolean())for(var i=0;i<3*e;++i)t[3*r+i]=this.readFloat();else{var n=Math.ceil(e/4),s=new Uint8Array(n);this.readBytes(n,s);var a=this.readCompressedInt(),o=new Float32Array(a);for(i=0;i<a;++i)o[i]=this.readFloat();var p=0,h=0,u=0,f=0,d=0,c=0,l=0;for(i=0;i<e;i++){0==h&&(l=3&s[p]),1==h&&(l=(12&s[p])>>2),2==h&&(l=(48&s[p])>>4),3==h&&(l=(192&s[p])>>6,h=-1,p++),h++;var m=3*i;0==l?(t[3*r+m]=o[u],t[3*r+m+1]=o[u+1],t[3*r+m+2]=o[u+2],f=o[u],d=o[u+1],c=o[u+2],u+=3):2==l?(t[3*r+m]=f,t[3*r+m+1]=d,t[3*r+m+2]=o[u],c=o[u],u++):3==l?(t[3*r+m]=f,t[3*r+m+1]=o[u],t[3*r+m+2]=o[u+1],d=o[u],c=o[u+1],u+=2):(t[3*r+m]=f,t[3*r+m+1]=d,t[3*r+m+2]=c)}}},this.readNormalsArrayBuffer=function(e,t,r){if(0!=e){var i=1/32767;if(this.version>1101220){var n=this.readCompressedInt();n>o.length&&(o=new Int16Array(n)),this.buffer.readShortArrayBuffer(n,o,this.conversion),(y=Math.ceil(e/2))>h.length&&(h=new Uint8Array(y));var s=null;Jn?(s=new Uint8Array(y),this.readBytes(y,s)):s=this.buffer.getByteView(y,h);for(var a=-1,p=0,u=0,f=0,d=3*e,c=3*r,l=0;l<d;l++){switch(l%2?(240&s[a])>>4:15&s[++a]){case 0:u=t[c+1]=o[p++]*i,f=t[c+2]=o[p++]*i,t[c]=Math.sqrt(1-(u*u+f*f));break;case 1:u=t[c+1]=o[p++]*i,f=t[c+2]=o[p++]*i,t[c]=-Math.sqrt(1-(u*u+f*f));break;case 2:u=t[c]=o[p++]*i,f=t[c+2]=o[p++]*i,t[c+1]=Math.sqrt(1-(u*u+f*f));break;case 3:u=t[c]=o[p++]*i,f=t[c+2]=o[p++]*i,t[c+1]=-Math.sqrt(1-(u*u+f*f));break;case 4:u=t[c]=o[p++]*i,f=t[c+1]=o[p++]*i,t[c+2]=Math.sqrt(1-(u*u+f*f));break;case 5:u=t[c]=o[p++]*i,f=t[c+1]=o[p++]*i,t[c+2]=-Math.sqrt(1-(u*u+f*f));break;case 6:t[c]=1,t[c+1]=0,t[c+2]=0;break;case 7:t[c]=-1,t[c+1]=0,t[c+2]=0;break;case 8:t[c]=0,t[c+1]=1,t[c+2]=0;break;case 9:t[c]=0,t[c+1]=-1,t[c+2]=0;break;case 10:t[c]=0,t[c+1]=0,t[c+2]=1;break;case 11:t[c]=0,t[c+1]=0,t[c+2]=-1}c+=3}}else{var m=[],v=(i=1/32767,e/3);this.readShortArray(2*v,m);var y=Math.ceil(v/8);s=new Uint8Array(y);Jn?this.readBytes(y,s):s=this.buffer.getByteView(y,h);var g,x,B=0,A=(a=-1,0);for(p=0,l=0;A<e;A+=3,p+=2,l++){var I;if(t[A]=m[p]*i,t[A+1]=m[p+1]*i,0==(B=l%8)&&a++,(x=1-(t[A]*t[A]+t[A+1]*t[A+1]))<=0)g=0;else for(u=x<=.03?.05:.25+x*(.25+1/(1+x));;){if((I=u-(g=.5*(u+x/u)))<i&&I>-i){u=g;break}u=g}t[A+2]=s[a]&1<<B?-g:g}}}},this.readNormals=function(e,t,r){var i=3*e;if(0!=t){var n=1/32767;if(this.version>1101220){var s=this.readCompressedInt();s>o.length&&(o=new Int16Array(s)),this.buffer.readShortArrayBuffer(s,o,this.conversion);var a=Math.ceil(t/2);a>h.length&&(h=new Uint8Array(a));var p=null;Jn?(p=new Uint8Array(a),this.readBytes(a,p)):p=this.buffer.getByteView(a,h);for(var u=-1,f=0,d=0,c=0,l=3*t,m=0;m<l/3;m++){switch(m%2?(240&p[u])>>4:15&p[++u]){case 0:d=o[f++]*n,c=o[f++]*n,r[i++]=Math.sqrt(1-(d*d+c*c)),r[i++]=d,r[i++]=c;break;case 1:d=o[f++]*n,c=o[f++]*n,r[i++]=-Math.sqrt(1-(d*d+c*c)),r[i++]=d,r[i++]=c;break;case 2:d=o[f++]*n,c=o[f++]*n,r[i++]=d,r[i++]=Math.sqrt(1-(d*d+c*c)),r[i++]=c;break;case 3:d=o[f++]*n,c=o[f++]*n,r[i++]=d,r[i++]=-Math.sqrt(1-(d*d+c*c)),r[i++]=c;break;case 4:d=o[f++]*n,c=o[f++]*n,r[i++]=d,r[i++]=c,r[i++]=Math.sqrt(1-(d*d+c*c));break;case 5:d=o[f++]*n,c=o[f++]*n,r[i++]=d,r[i++]=c,r[i++]=-Math.sqrt(1-(d*d+c*c));break;case 6:r[i++]=1,r[i++]=0,r[i++]=0;break;case 7:r[i++]=-1,r[i++]=0,r[i++]=0;break;case 8:r[i++]=0,r[i++]=1,r[i++]=0;break;case 9:r[i++]=0,r[i++]=-1,r[i++]=0;break;case 10:r[i++]=0,r[i++]=0,r[i++]=1;break;case 11:r[i++]=0,r[i++]=0,r[i++]=-1}3}}}},this.readOctNormals=function(e,t){if(0!=e&&this.version>1101220){var r=this.readUncompressedULong();this.readBytes(r,t)}},this.readTextures=function(e,t,r,i){var n=r*t;if(3!=r){var s=0,a=0,o=new Float32Array(n);if(this.readFloatArray(0,n,o),1==r)for(s=0;s<n;s++)i[3*e+a++]=o[s],i[3*e+a++]=0,i[3*e+a++]=0;else if(2==r)for(s=0;s<n;s+=2)i[3*e+a++]=o[s],i[3*e+a++]=o[s+1],i[3*e+a++]=0}else this.readFloatArray(3*e,n,i)},this.unpackcArray=function(e,t,r){if(this.bitPacking)for(var i=0;i<e;++i)t[i+r]=this.readBits(d);else if(this.version>=1100600&&this.numberOfVertices<256)this.buffer.readBytes(r,e,t);else if(this.numberOfVertices<65536)this.buffer.readUnsignedShortArray(r,e,t,!1);else if(this.numberOfVertices<16777216)this.buffer.unpackc24(r,e,t);else for(i=0;i<e;++i)t[i+r]=this.readCompressedInt()},this.unpackc=function(){return this.bitPacking?this.readBits(d):this.version>=1100600&&this.numberOfVertices<256?this.readUnsignedChar():this.numberOfVertices<65536?this.readUnsignedChar()<<8&65280|255&this.readUnsignedChar():this.numberOfVertices<16777216?this.readUnsignedChar()<<16&16711680|this.readUnsignedChar()<<8&65280|255&this.readUnsignedChar():this.readCompressedInt()},this.getFixedMode=function(){return this.fixedSizeMode},this.setFixedMode=function(e){this.fixedSizeMode=e},this.getStaticMode=function(){if(this.staticMode.length){var e=this.staticMode[this.staticMode.length-1];if(e)return e}return null},this.pushStaticMode=function(e){null==e?this.staticMode.push(new t.Matrix4):this.staticMode.push(e)},this.popStaticMode=function(){this.staticMode.pop()},this.isASMColor=function(){return!!this.global_gas.length&&this.global_gas[this.global_gas.length-1].asmColor},this.getGAS=function(t,r){if(this.global_gas.length){var i=this.global_gas[this.global_gas.length-1].inherited,n=this.global_gas[this.global_gas.length-1].asmColor;if(n&&t==e.ConnectivityTypeEnum.TRIANGLES&&(i.setRGBAColorRGBChannel(n[0],n[1],n[2]),i.setRGBAColorAlphaChannel(n[3])),this.version>u&&this.getCurrentLayerTable()&&this.getAdvancedInheritance()){var s=this.getAdvancedInheritance(),a=getCurrentLayerTable(),o=r;0!=o&&o!=re||(o=this.getCurrentLayerNumber()),s.updateFromGasAndLayer(i,o,a)}return i}},this.pushGAS=function(e,t){var r,i=0,n=null;if(this.global_gas.length){var s=this.global_gas[this.global_gas.length-1];if(i=s.inh_mode,r=s.inherited,n=s.asmColor,4&i){e.setColor(r.getColor());var a=r.getRGBAColor();e.setRGBAColorRGBChannel(a[0],a[1],a[2])}if(4096&i){a=r.getRGBAColor();e.setRGBAColorAlphaChannel(a[3])}16&i&&e.setLineThickness(r.getThickness()),64&i&&e.setLineType(r.getLineType());var o=r.isHidden();o&&e.setNoShow(o);var p=r.isNopick();p&&e.setNoPick(p),$n.depthMode2D&&e.setDepthPriority(r.getDepthPriority()+e.getPriority()-4)}return this.ACADInheritance&&this.updateAdvancedInheritance(e),1024&t&&(n=e.getDisplayedColor()),this.global_gas.push({inh_mode:i|t,inherited:e,asmColor:n}),e},this.popGAS=function(){return this.global_gas.pop()},this.popMatId=function(){if(s.length>0){var e=s.pop();return e.inherit&&(this.isInherit=!1),e}return{id:-1}},this.popRepAttribute=function(){this.popGAS(),this.popMatId(),this.version>=u&&this.currentLayerNumber.pop()},this.pushMatId=function(e,t){var r=e.getLayerMax(),i=null;s.length>0&&(r=(a=s[s.length-1]).layer,i=a.rep);if(e.layer!==r)if(e.layer<r&&0!==e.inheritanceMaterial){var n=!0;1==this.isInherit&&(n=!1),this.isInherit=!0,s.push({id:e.material.id,inherit:n,layer:e.layer,rep:t})}else{if(s.length>0)(a=s[s.length-1])&&s.push({id:a.id,inherit:!1,layer:a.layer,rep:a.rep})}else if(e.layer==e.getLayerMaxMinusOne()||i===t)if(2==e.inheritanceMaterial||1==e.inheritanceMaterial&&!this.isInherit){n=!0;1==this.isInherit&&(n=!1),this.isInherit=!0,s.push({id:e.material.id,inherit:n,layer:e.layer,rep:t})}else if(this.isInherit||0!=e.inheritanceMaterial){if(s.length>0)(a=s[s.length-1])&&s.push({id:a.id,inherit:!1,layer:a.layer,rep:a.rep})}else s.push({id:-1,inherit:!1,layer:e.layer,rep:t});else if(0!==e.inheritanceMaterial){n=!0;1==this.isInherit&&(n=!1),this.isInherit=!0,s.push({id:e.material.id,inherit:n,layer:e.layer,rep:t})}else{var a;if(s.length>0)(a=s[s.length-1])&&s.push({id:a.id,inherit:!1,layer:a.layer,rep:a.rep})}},this.check=function(){0!=s.length&&console.warn("material stack length = "+s.length),0!=this.global_gas.length&&console.warn("GAS stack length = "+this.global_gas.length),0!=this.currentMatrix.length&&console.warn("currentMatrix stack length = "+this.currentMatrix.length)},this.flexibleMatrices=[],this.batch=function(e,r){this.batches.getCurrentIndex();var i=e.length?e[0]:e,n=[];if((1==$n.sceneGraphOrder||$n.sceneGraphOrderPriority)&&(n=this.processedMergeDGs()),!i.alreadyprocessed||Jn){i.alreadyprocessed=!0;var s=Kn.processAllReps(r,this.materials.getArray(),n,this.sgReps,!0).meshes;if(s){var a=this.batches.add(s);i.node.addBatchInfo(t._InfiniteGeomertryType.TESSELATION,a)}}},this.pushFlexibleBatchingContext=function(e){var t=this.getCurrentMatrix();e.externalPath||(e.node.externalMatrix=t,e.externalPath=!0),this.pushReps(),this.pushSceneGraphOrderParameters(),this.pushFlexibleMatrix(null)},this.popFlexibleBatchingContext=function(e){var t=this.popReps();e&&this.batch(e,t),this.popSceneGraphOrderParameters()},this.pushFlexibleMatrix=function(e){this.popMatrix(),this.currentMatrix.push(null)},this.popFlexibleMatrix=function(){return this.popMatrix()},this.pushMatrix=function(e){var r=this.currentMatrix;this.flexibleMatrixMode&&this.flexibleMatrices.length&&(r=this.flexibleMatrices[this.flexibleMatrices.length-1]);var i,n=r[r.length-1];return null==n?i=e:(i=new t.Matrix4).multiplyMatrices(n,e),r.push(i),i},this.popMatrix=function(){var e=this.currentMatrix;return this.flexibleMatrixMode&&this.flexibleMatrices.length&&(e=this.flexibleMatrices[this.flexibleMatrices.length-1]),e.pop()},this.getLightDataStreaming=function(){return n},this.setLightDataStreaming=function(e){n=e},this.copyStreamerInheritance=function(e){e.cullingData=this.cullingData,e.ssbBoxPosition=this.ssbBoxPosition,e.setLightDataStreaming(this.getLightDataStreaming()),e.conversion=this.conversion,e.version=this.version,e.global_gas=this.global_gas,e.textures=this.textures,e.materials=this.materials,e.decorations=this.decorations,e.additionalReps=this.additionalReps,e.useAdditionalReps=this.useAdditionalReps,e.advancedInheritanceArray=this.advancedInheritanceArray,e.sgReps=this.sgReps,e.currentDGs=this.currentDGs,e.mergeDGs=this.mergeDGs,e.compressedArrayInfo=this.compressedArrayInfo,e.currentAttr=this.currentAttr,e.advancedPriority=this.advancedPriority,e.sgOrderStructs=this.sgOrderStructs,e.layerTables=this.layerTables,Jn&&(e.currentMatId=this.getMatIdTab(),e.idOrder=this.idOrder,e.semanticType=this.semanticType,e.multiRefReps=this.multiRefReps,e.multiRefCount=this.multiRefCount,e.batches=this.batches,e.reps=this.reps,e.infiniteGeometries=this.infiniteGeometries,e.curvedPipes=this.curvedPipes,e.sgRep=this.sgRep,e.nbRep=this.nbRep,e.texts=this.texts,e.currentMatrix=this.currentMatrix,e.flexibleMatrices=this.flexibleMatrices,e.flexibleMatrixMode=this.flexibleMatrixMode,e.staticMode=this.staticMode,e.fixedSizeMode=this.fixedSizeMode,e.multiRefNode=this.multiRefNode,e.fakeMultiRep=this.fakeMultiRep)},this.getCurrentFlexibleMatrix=function(){if(this.flexibleMatrixMode&&this.flexibleMatrices.length){var e=this.flexibleMatrices[this.flexibleMatrices.length-1];if(0!=e.length)return e[e.length-1]}return null},this.getCurrentMatrix=function(){return 0!=this.currentMatrix.length?this.currentMatrix[this.currentMatrix.length-1]:null},this.getCurrentMatId=function(){var e=s[s.length-1];return e?{id:e.id}:null},this.getMatIdTab=function(){return s}};ye.prototype.readFloat=function(){return this.buffer.readFloat(this.conversion)},ye.prototype.readUnsignedChar=function(){return this.buffer.read()},ye.prototype.readBytes=function(e,t){for(var r=0;r<e;r++)t[r]=this.buffer.read()},ye.prototype.optimizedReadBytes=function(e,t){this.buffer.readBytes(0,e,t)},ye.prototype.readShortArray=function(e,t){this.buffer.readShortArray(0,e,t,this.conversion)},ye.prototype.readUnsignedShort=function(){return this.conversion?this.buffer.read()<<8|this.buffer.read():this.buffer.read()|this.buffer.read()<<8},ye.prototype.readShort=function(){var e=this.buffer.read(),t=this.buffer.read();if(this.conversion){var r=(127&e)<<8|t;return r-=(128&e)<<8}r=(127&t)<<8|e;return r-=(128&t)<<8},ye.prototype.readUncompressedULong=function(){return this.buffer.readUncompressedULong(this.conversion)},ye.prototype.readUncompressedUInt=function(){return this.buffer.readUncompressedInt(this.conversion)},ye.prototype.readUncompressedInt=function(){return this.buffer.readInt(this.conversion)},ye.prototype.readUncompressedIntArray=function(e,t){for(var r=0;r<e;r++)t[r]=this.readUncompressedInt()},ye.prototype.readCompressedUInt=function(){if(this.intPacking)return this.readCompressedInt();if(this.version>=1101410){var e=this.readUnsignedChar();return 255==e?this.buffer.readUncompressedULong(this.conversion):e}return this.buffer.readInt(this.conversion)},ye.prototype.readCompressedInt=function(){if(this.version>=1100600){var e=this.buffer.read();return e<255?e:this.buffer.readInt(this.conversion)}return this.buffer.readInt(this.conversion)};var ge=function(e){e.readUncompressedInt(!1),e.readUncompressedInt(!1);e.readUncompressedInt(!1);e.readUncompressedInt(!1);if((4294967295&e.readUncompressedInt(!1))<<32,Yn){e.readUncompressedInt(!1);(4294967295&e.readUncompressedInt(!1))<<32;e.readUncompressedInt(!1);(4294967295&e.readUncompressedInt(!1))<<32;e.readUncompressedInt(!1),e.readUncompressedInt(!1),e.readUncompressedInt(!1),e.readUncompressedInt(!1),e.readUncompressedInt(!1);var t=new Uint8Array(8);e.readBytes(8,t),e.readUncompressedInt(!1),e.readUncompressedInt(!1)}},xe=function(e){this.offset=e.readUncompressedInt(!1),this.length=e.readUncompressedInt(!1);e.readUncompressedInt(!1);this.beginPos=e.readUncompressedInt(!1);e.readUncompressedInt(!1)},Be=function(e,t){e.readUncompressedInt(!1);this.id=e.readUncompressedInt(!1);e.readUnsignedShort(!1),new ge(e);var r=e.readUncompressedInt(!1);this.blocs=[];var i=[];if(r>0)for(var n=0;n<r;++n)this.blocs.push(new xe(e));if(1024==(1024&es.CATCurrentMode)){e.readUnsignedChar();var s=e.readUncompressedInt(!1);s>0&&e.skip(s)}if(t>0){e.readUncompressedInt(!1),e.readUncompressedInt(!1),32768==(32768&es.CATCurrentMode)&&e.readUncompressedInt(!1);for(n=0;n<t;++n)i.push(new Wn(e))}this.getRootTocEntry=function(){for(var e=0;e<i.length;++e){i[e].fatherId;if(0==i[e].fatherId)return i[e]}},this.getChildEntryByFatherId=function(e,t){for(var r=0;r<i.length;++r)if(i[r].fatherId==e&&i[r].name==t)return i[r]},this.getChildEntry=function(e,t){return this.getChildEntryByFatherId(e.getId(),t)}},Ae=0,Ie=1,be=-1159921408,Ce=-86375937,Se=122298,we=-16655622,Pe=-86376192,Me=121594,Re=-86376177,Te=251779834,Ue=6,Fe=7,Ge=8,Oe=9,Ne=1,Ee=2,De=3,Le=4,ke=function(e,t,r){this._xSize=e,this._ySize=t,this._format=r,this.unstream=function(e,t){var r,i,n,s,a=1,o=1;e.conversion;s=e.readCompressedInt();var p=J;if(s==be||s==Se||s==Ce||s==we?r=e.readCompressedInt():s==Pe||s==Me||s==Re||s==Te||(r=s),s!=Pe&&s!=Me&&s!=Re&&s!=Te){i=e.readCompressedInt(),C=e.readCompressedInt(),n=e.readCompressedInt();e.readCompressedInt();if(a=e.readFloat(),o=e.readFloat(),0==n)return null;w=new Uint8Array(C),e.readBytes(C,w)}else{switch(e.readCompressedInt()){case Ne:return r=e.readCompressedInt(),i=e.readCompressedInt(),C=e.readCompressedInt(),n=e.readCompressedInt(),e.readCompressedInt(),a=e.readFloat(),o=e.readFloat(),-1;case Ee:if(r=e.readCompressedInt(),i=e.readCompressedInt(),C=e.readCompressedInt(),n=e.readCompressedInt(),e.readCompressedInt(),a=e.readFloat(),o=e.readFloat(),4!=n)return null;n=0,w=new Uint8Array(r*i);for(var h=[0,1,2,3,new Map([[7,2],[8,3],[11,4],[12,5],[14,6],[15,7]]),new Map([[19,8],[20,9],[7,10],[8,11],[27,64],[18,128]]),new Map([[24,1664],[23,192],[8,12],[3,13],[52,14],[53,15],[42,16],[43,17],[7,1]]),new Map([[39,18],[12,19],[8,20],[23,21],[3,22],[4,23],[40,24],[43,25],[19,26],[36,27],[24,28],[55,256]]),new Map([[53,0],[2,29],[3,30],[26,31],[27,32],[18,33],[19,34],[20,35],[21,36],[22,37],[23,38],[40,39],[41,40],[42,41],[43,42],[44,43],[45,44],[4,45],[5,46],[10,47],[11,48],[82,49],[83,50],[84,51],[85,52],[36,53],[37,54],[88,55],[89,56],[90,57],[91,58],[74,59],[75,60],[50,61],[51,62],[52,63],[54,320],[55,384],[100,448],[101,512],[104,576],[103,640]]),new Map([[204,704],[205,768],[210,832],[211,896],[212,960],[213,1024],[214,1088],[215,1152],[216,1216],[217,1280],[218,1344],[219,1408],[152,1472],[153,1536],[154,1600],[155,1728]]),new Map([[15,64],[55,0],[23,16],[24,17],[8,18]]),new Map([[8,1792],[12,1856],[13,1920]]),new Map([[18,1984],[19,2048],[20,2112],[21,2176],[22,2240],[23,2304],[28,2368],[29,2432],[30,2496],[31,2560]])],u=[0,1,new Map([[3,2],[2,3]]),new Map([[3,4],[2,1]]),new Map([[3,5],[2,6]]),new Map([[3,7]]),new Map([[5,8],[4,9]]),new Map([[4,10],[5,11],[7,12]]),new Map([[4,13],[7,14]]),new Map([[24,15]]),new Map([[15,64],[23,16],[24,17],[8,18],[55,0]]),new Map([[8,1792],[12,1856],[13,1920],[103,19],[104,20],[108,21],[55,22],[40,23],[23,24],[24,25]]),new Map([[18,1984],[19,2048],[20,2112],[21,2176],[22,2240],[23,2304],[28,2368],[29,2432],[30,2496],[31,2560],[202,26],[203,27],[204,28],[205,29],[104,30],[105,31],[106,32],[107,33],[210,34],[211,35],[212,36],[213,37],[214,38],[215,39],[108,40],[109,41],[218,42],[219,43],[84,44],[85,45],[86,46],[87,47],[100,48],[101,49],[82,50],[83,51],[36,52],[55,53],[56,54],[39,55],[40,56],[88,57],[89,58],[43,59],[44,60],[90,61],[102,62],[103,63],[200,128],[201,192],[91,256],[51,320],[52,384],[53,448]]),new Map([[108,512],[109,576],[74,640],[75,704],[76,768],[77,832],[114,896],[115,960],[116,1024],[117,1088],[118,1152],[119,1216],[82,1280],[83,1344],[84,1408],[85,1472],[90,1536],[91,1600],[100,1664],[101,1728]])],f=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191],d=[4096,6144,7168,7680,7936,8064,8128,8160,8176,8184,8188,8190,8191],c=function(e,t,r){var i,n=0,s=0,a=Math.floor(r/8),o=r%8;if(t.length<a)return null;i=t[a],t.length>a+1&&(n=t[a+1]),t.length>a+2&&(s=t[a+2]);var p=e?h:u,c=e?4:2,l=0,m=0;if(o>3){m=((i&f[8-o])<<5+o)+(v=n<<o-3)+(s>>11-o)}else{var v=n;o<3&&(v=n>>3-o),m=((i&f[8-o])<<5+o)+v}for(;c<14;){var y=(m&d[c-1])>>13-c;if(null!=(l=p[c].get(y)))break;c++}return c<14?{runLength:l,codeLength:c}:null},l=0;l<i;l++){var m=!0,v=e.readCompressedInt();if(!(v>0))return null;var y=new Uint8Array(v);e.optimizedReadBytes(v,y);for(var g=0,x=0,B=0;g<r;){var A=c(m,y,x);if(!A)return null;if(B+=A.runLength,x+=A.codeLength,!(A.runLength>63)){for(var I=m?255:0,b=0;b<B;b++)w[l*r+g+b]=I;m=!m,g+=B,B=0}}}break;case De:var C;if(r=e.readCompressedInt(),i=e.readCompressedInt(),C=e.readCompressedInt(),n=e.readCompressedInt(),e.readCompressedInt(),a=e.readFloat(),o=e.readFloat(),!(s!=Re&&s!=Te||n!=Ue&&n!=Fe&&n!=Ge&&n!=Oe))e.readCompressedInt();w=new Uint8Array(C),e.readBytes(C,w);break;case Le:p=$,r=e.readCompressedInt(),i=e.readCompressedInt();var S=e.readCompressedInt();n=e.readCompressedInt(),e.readCompressedInt(),a=e.readFloat(),o=e.readFloat();var w=new Uint8Array(S);if(!S)return null;e.optimizedReadBytes(S,w)}}return{img:w,width:r,height:i,format:n,url:t,xPixelSize:a,yPixelSize:o,imgType:p}}},Ve=function(e,t,r){ke.call(this,e,t,r)};(Ve.prototype=Object.create(ke.prototype)).constructor=ke;var _e=function(){this.createTexture=function(e,t){var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1,url:t,imgType:K};if(0==e.readCompressedInt()){e.readCompressedInt();if(r.mipmapCount=e.readCompressedUInt(),r.width=e.readCompressedUInt(),r.height=e.readCompressedUInt(),r.format=e.readCompressedInt(),0==r.mipmapCount)return!1;for(var i=r.width,n=r.height,s=1;s<=r.mipmapCount;s++){var a=(new ke).unstream(e,t);if(3==r.format)return a;if(3==a.imgType)return a;r.mipmaps.push({data:a.img,width:a.width,height:a.height}),(n/=2)<1&&(n=1),(i/=2)<1&&(i=1)}}return r}},ze=function(){this.unstream=function(e,t){var r=(new ke).unstream(e,t);if(null===r)return null;var i=e.readStringWithLength().split("\\");t=i[i.length-1];return r.url=t,r}},je=function(){this.unstream=function(e,t){var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1,url:t,imgType:K};if(0==e.readCompressedInt()){var i=e.readCompressedInt();r.mipmapCount=e.readCompressedUInt(),r.width=e.readCompressedUInt(),r.height=e.readCompressedUInt(),r.format=e.readCompressedInt(),r.streamCmpFormat=i,0==r.mipmapCount&&0;for(var n=r.width,s=r.height,a=1;a<=r.mipmapCount;a++){var o=(new ke).unstream(e,t);if(3==r.format)return o;r.mipmaps.push({data:o.img,width:o.width,height:o.height}),(s/=2)<1&&(s=1),(n/=2)<1&&(n=1)}}else 0;return r}},We=function(){this.unstream=function(t){var r=new e.Material;r._MaterialPropertiesActivate=t.readCompressedInt();var i=t.readFloat(),n=t.readFloat(),s=t.readFloat();r.colorAmbient[0]=i,r.colorAmbient[1]=n,r.colorAmbient[2]=s;var a=t.readFloat(),o=t.readFloat(),p=t.readFloat();r.colorDiffuse[0]=a,r.colorDiffuse[1]=o,r.colorDiffuse[2]=p;var h=t.readFloat(),u=t.readFloat(),f=t.readFloat();if(r.colorSpecular[0]=h,r.colorSpecular[1]=u,r.colorSpecular[2]=f,r.shininess=t.readFloat(),r.shininess*=255,r.ambientCoef=t.readFloat(),r.diffuseCoef=t.readFloat(),r.specularCoef=t.readFloat(),r.transparent=t.readFloat(),r.reflectivityCoef=t.readFloat(),t.version>=210042310)t.readBoolean();var d=t.version<2100190&&t.version>=21e5||t.version<1102110;if(t.readUnsignedChar())if(d){if(t.readUnsignedChar()){var c;if(c=t.readCompressedInt(),t.textures.isValidMultiRefIndex(c)){var l=t.textures.getIndex(c);r.textureId=l}else{var m=(new ze).unstream(t),v=t.textures.add(m);t.textures.addMultiRefIndex(c,v),r.textureId=v}}else{m=(new ze).unstream(t),v=t.textures.add(m);r.textureId=v}}else{var y,g=t.getContainer();if(g&&(y=g.getResourceCGRContainer()),y){v=y.getResource(t);r.textureId=v}}switch(r.textureImageNumberComposante=t.readCompressedInt(),r.textureBlending=t.readCompressedInt(),r.magFilter=t.readCompressedInt(),r.minFilter=t.readCompressedInt(),t.readCompressedInt()){case 0:r.mappingFunction="USER_MAPPING";break;case 3:r.mappingFunction="SPHERICAL_ENV_MAP"}if((r.textureWrapS=t.readCompressedInt(),r.textureWrapT=t.readCompressedInt(),r.addedComposantInTexEnv=t.readCompressedInt(),t.skip(76),!d)&&t.readUnsignedChar()){r.textureId=-1;var x=7==t.readCompressedInt(),B=new Ze;B.unstream(t),B&&(r.shaderMaterial={name:B.name,param:B.parameters,PDSFX:x})}return r}},He=function(){this.skip=function(e){this.unstream(e,!0)},this.unstreamTexture=function(e){var t=1,r=0,i=0;if(e.version>=210041930&&(i=e.readCompressedInt(),e.textures.isValidMultiRefIndex(i)&&(r=e.textures.getIndex(i),t=0)),t){var n=(new ke).unstream(e);null!=n&&(r=e.textures.add(n)),n&&e.version>=210041930&&e.textures.addMultiRefIndex(i,r)}return r},this.unstream=function(e,t){var r=-1,i={};(i._MaterialPropertiesActivate=!0,t)||(i=(new We).unstream(e));var n=e.readStringWithLength();i.physicalMaterial=JSON.parse(n);var s=e.readCompressedUInt(),a=e.readCompressedUInt(),o=i.physicalMaterial.Version,p=0;if(i.physicalMaterial&&i.physicalMaterial.PhysicalMaterial&&i.physicalMaterial.PhysicalMaterial.MappingOperator&&i.physicalMaterial.PhysicalMaterial.MappingOperator.UvTransformation){var h=i.physicalMaterial.PhysicalMaterial.MappingOperator.UvTransformation;i.physicalMaterial.PhysicalMaterial.MappingOperator.UvTransformation=[h[0],h[1],h[2],h[4],h[5],h[6],h[8],h[9],h[10]]}o&&o>=3&&(p=e.readCompressedUInt());var u=e.readBoolean(),f=!1;o&&o>=.2&&(f=e.readBoolean());for(var d=0;d<s;d++){var c=!1;r=-1;var l=e.readStringWithLength();if(o>0&&(c=e.readBoolean()),(r=c?this.unstreamTexture(e):Qe(e))>=0)i.physicalMaterial.PhysicalMaterial.FloatParameter[l].Texture=r}for(d=s;d<a+s;d++){c=!1;r=-1;l=e.readStringWithLength();if(o>0&&(c=e.readBoolean()),(r=c?this.unstreamTexture(e):Qe(e))>=0)i.physicalMaterial.PhysicalMaterial.Float3Parameter[l].Texture=r}r=-1;var m=null;for(i.physicalMaterial.PhysicalMaterial&&i.physicalMaterial.PhysicalMaterial.MapParameter&&(m=i.physicalMaterial.PhysicalMaterial.MapParameter.normalMap),u&&(r=Qe(e))>=0&&(m?m.Texture=r:i.physicalMaterial.PhysicalMaterial.NormalMap.Texture=r),f&&Qe(e),d=0;d<p;d++){c=!1;r=-1;l=e.readStringWithLength();var v=i.physicalMaterial.PhysicalMaterial.MapParameter[l];o>0&&(c=e.readBoolean()),(r=c?this.unstreamTexture(e):Qe(e))>=0&&v&&(v.Texture=r)}return i}};const Xe=new Uint8Array([171,75,84,88,32,50,48,187,13,10,26,10]),Ye=t.TextureBlendOperations;var qe=function(){this.unstream=function(e){var r={};r._MaterialPropertiesActivate=!0;var i;if(i=e.readCompressedInt(),e.materials.isValidMultiRefIndexWithName(i,e.name))return null!==(w=e.materials.getIndexWithName(i,e.name))&&(r=e.materials.get(w)),r;var n=e.readStringWithLength(),s=JSON.parse(n);if(s.images&&s.textures){var a,o=e.getContainer();o&&(a=o.getResourceCGRContainer());var p=[];if(a)for(var h=0;h<s.images.length;h++){var u=a.getImage(e,s.images[h].byteOffset,s.images[h].byteOffset+s.images[h].byteLength);p.push(u)}var f=[];if(s.images&&s.images.length)for(h=0;h<s.images.length;h++)f.push(!1);var d=[];for(h=0;h<s.textures.length;h++){var c=!1,l=s.textures[h];if(f[l.image]&&(c=!0),f[l.image]=!0,(u=p[l.image]).imgType===ee){for(var m=new Uint8Array(u.img.buffer),v=!0,y=0;y<Xe.length;y++)if(m[y]!==Xe[y]){v=!1;break}v&&(u.imgType=te)}var g={noTransferable:c,mipmaps:u.mipmaps,format:u.format,height:u.height,width:u.width,img:u.img,imgType:u.imgType,wrap:[t.CGR_WRAPPING[l.uWrap],t.CGR_WRAPPING[l.uWrap]],filter:[1,1]};if(l.uWrap&&t.CGR_WRAPPING[l.uWrap]&&(g.wrap[0]=t.CGR_WRAPPING[l.uWrap]),l.vWrap&&t.CGR_WRAPPING[l.vWrap]&&(g.wrap[1]=t.CGR_WRAPPING[l.vWrap]),l.magFilter&&(g.filter[1]=Z[l.magFilter]),l.minFilter&&(g.filter[0]=Z[l.minFilter]),l.borderColor&&(g.borderColor=l.borderColor),l.uvTransform){var x=l.uvTransform;1==x[0]&&0==x[1]&&0==x[2]&&1==x[3]&&0==x[4]&&0==x[5]||(g.uvTransform=l.uvTransform)}var B=e.textures.add(g);d.push(B)}}var A=s.materials[0],I=r;if("Visu.Basic"==A.type){if(r.colorDiffuse=A.DiffuseColor,r.diffuseCoef=A.DiffuseCoeff,r.colorAmbient=A.AmbientColor,r.ambientCoef=A.AmbientCoeff,r.colorSpecular=A.SpecularColor,r.specularCoef=A.SpecularCoeff,r.reflectivityCoef=A.ReflectionCoeff,r.textureId=A.Texture?d[A.Texture.texture]:void 0,null!=r.textureId){var b=e.textures.get(r.textureId);r.minFilter=b.filter[0],r.magFilter=b.filter[1],r.textureWrapS=b.wrap[0],r.textureWrapT=b.wrap[1]}switch(A.TextureFunction){case 0:r.textureBlending=Ye.MODULATE;break;case 1:r.textureBlending=Ye.BLEND;break;case 2:r.textureBlending=Ye.DECAL;break;case 3:r.textureBlending=Ye.REPLACE;break;default:r.textureBlending=Ye.KEEP_DEFAULT}r.textureMapping=A.TextureMapping,r.shininess=255*A.ShininessCoeff,r.transparency=A.TransparencyCoeff,r.alphaTest=.5*A.IsAlphaTestEnabled}else if("Visu.SpecularGlossiness"==A.type||"Visu.SpecularGlossiness@17x"==A.type||"Visu.SpecularGlossiness@21x"==A.type||"Visu.EVisuPBR"==A.type||"Visu.DSPBR@21x"==A.type||"Visu.DSPBR@22x"==A.type||"Visu.DSPBR@25x"==A.type){for(var C in A){void 0!==(S=A[C]).texture&&(S.texture=d[S.texture])}r.physicalMaterial={},(r=r.physicalMaterial).PhysicalMaterial=A,r.PhysicalMaterial.isVisDescription=!0}else if("Visu.ShaderOverride"==A.type){for(var C in A){var S;void 0!==(S=A[C]).texture&&(S.imgId=d[S.texture])}r.shaderMaterial={name:A.shaderName,param:A,PDSFX:!0}}var w=e.materials.add(I);return e.materials.addMultiRefIndexWithName(i,w,e.name),I}},Qe=function(e){var t,r=-1,i=e.getContainer();i&&(t=i.getResourceCGRContainer());return t&&(r=t.getResource(e)),r},Ze=function(){this.parameters={},this.name="",this.unstream=function(e){this.parametersUnstream(e);var t,r=e.getContainer();if(r&&(t=r.getResourceCGRContainer()),t)var i=t.getResourceShader(e);if(null===i)return null;i&&(this.name=i.name)},this.parametersUnstream=function(e){for(var t=e.readCompressedInt(),r=[],i=0;i<t;++i)r[i]=e.readStringWithLength();var n=e.readCompressedInt();for(i=0;i<n;++i){switch(e.readCompressedInt()){case 0:e.readCompressedInt();break;case 1:e.readCompressedInt();var s=e.readFloat(),a=r[i];this.parameters[a]=s;break;case 2:e.readCompressedInt();var o=[];e.readFloatArray(0,4,o);a=r[i];this.parameters[a]=o;break;case 4:e.readCompressedInt();var p,h=e.getContainer();h&&(p=h.getResourceCGRContainer());var u="";if(p){var f=p.getResource(e);Xn[f]&&Xn[f].url&&(u=Xn[f].url)}a=r[i];this.parameters[a]={imgId:f,url:u};break;case 5:e.readCompressedInt(),o=[];e.readFloatArray(0,4,o);a=r[i];this.parameters[a]=o;break;case 6:e.readCompressedInt(),o=[];e.readFloatArray(0,4,o);a=r[i];this.parameters[a]=o}}}},Je=function(){this.name="",this.unstream=function(e){var t=e.readStringWithLength(),r=t.lastIndexOf("\\");-1!==r&&(t=t.substring(r+1,t.length)),-1!==(r=t.lastIndexOf("."))&&(t=t.substring(0,r));var i=e.readCompressedInt();e.skip(i),this.name=t}},Ke=function(){this.unstream=function(e){for(var t=[],r=0;r<2;r++){if(e.readUnsignedChar()){var i=0;if(e.readUnsignedChar())if(i=e.readCompressedInt(),e.materials.isValidMultiRefIndexWithName(i,e.name))t[r]=e.materials.getIndexWithName(i,e.name);else{var n=(1===(a=e.readCompressedInt())?new Ke:new We).unstream(e);if(1===a)s=n;else var s=e.materials.add(n);e.materials.addMultiRefIndexWithName(i,s,e.name),t[r]=s}else{var a;n=(1===(a=e.readCompressedInt())?new Ke:new We).unstream(e);s=1===a?n:e.materials.add(n),t[r]=s}}}return t[0]}},$e=function(){this.posBuffer=[],this.normalBuffer=[],this.textureBuffer=[],this.uvsBuffer=[],this.binormalsBuffer=[],this.tangentsBuffer=[],this.numberOfVertices=0};$e.prototype.getNumberOfVertices=function(){return this.numberOfVertices},$e.prototype.unstream=function(e){var t;this.numberOfVertices=e.readCompressedInt(),t=e.readCompressedInt(),this.hasTextures=e.readUnsignedChar(),this.hasUVs=e.readUnsignedChar(),this.hasTangentsBinormals=e.readUnsignedChar();var r=0;if(this.hasTextures&&(r=e.readUnsignedChar(),e.readTextures(0,this.numberOfVertices,r,this.textureBuffer)),this.numberOfVertices&&e.readPositions(0,this.numberOfVertices,this.posBuffer,0),t&&e.readNormals(0,t,this.normalBuffer,0),this.hasUVs&&this.numberOfVertices)if($n.defaultTCSetActivation)e.readTextures(0,this.numberOfVertices,2,this.textureBuffer);else{var i=new Float32Array(2*this.numberOfVertices);e.readFloatArray(0,2*this.numberOfVertices,i)}if((this.hasTangentsBinormals&&(e.readFloatArray(0,3*this.numberOfVertices,this.tangentsBuffer),e.readFloatArray(0,3*this.numberOfVertices,this.binormalsBuffer)),e.version>=210041920)&&e.readUnsignedChar()){var n=e.readCompressedInt();if(n>0)for(var s=0;s<n;++s){var a=e.readUnsignedChar();e.readStringWithLength();e.skip(4*a*this.numberOfVertices)}}},$e.prototype.allocateBuffers=function(){this.posBuffer=new Array(3*this.numberOfVertices),this.totalNumberOfNormals&&(this.normalBuffer=new Array(3*this.totalNumberOfNormals)),this.hasTextures&&(this.textureBuffer=new Array(3*this.numberOfVertices)),this.hasUVs&&(this.uvsBuffer=new Array(2*this.numberOfVertices)),this.hasTangentsBinormals&&(this.tangentsBuffer=new Array(3*this.numberOfVertices),this.binormalsBuffer=new Array(3*this.numberOfVertices))};var et=function(){$e.call(this),this.totalNumberOfNormals=0,this.nbTexCoords=0,this.hasTextures=!1,this.hasUVs=!1,this.hasTangentsBinormals=!1,this.compressedIndex=0,this.positionQuantization=0,this.normalsQuantization=0,this.compressedInfo=null};(et.prototype=new $e).constructor=et,et.prototype.partUnStreamHeader=function(e){this.numberOfVertices=e.readCompressedInt(),this.totalNumberOfNormals=e.readCompressedInt();var t=e.readUnsignedChar();if(this.hasTextures=1&t,this.hasUVs=2&t,this.hasTangentsBinormals=4&t,this.hasExtraTextures=16&t,this.hasTextures&&(this.nbTexCoords=e.readUnsignedChar()),this.hasExtraTextures){this.nbExtraTextureSet=e.readCompressedInt(),this.extraTextureSet=[];for(var r=0;r<this.nbExtraTextureSet;++r){var i=e.readUnsignedChar(),n=e.readStringWithLength();this.extraTextureSet.push({dimension:i,identifier:n})}}this.allocateBuffers()},et.prototype.partUnStream=function(r,i,n,s,a){if(this.positionQuantization=G?O:0,this.normalsQuantization=G?N:0,s)switch(this.positionQuantization){case 0:r.readPositions(i,s,this.posBuffer);break;case e.CATSGPlayRepDataOptions.PositionBoxCompression:if($n.keepCompression){var o=r.getCurrentMatrix(),p=new t.Vector3(dt.x,dt.y,dt.z),h=new t.Vector3(ct.x,ct.y,ct.z),u=new t.Vector3(Math.max(h.x-p.x,1e-6),Math.max(h.y-p.y,1e-6),Math.max(h.z-p.z,1e-6));u.multiplyScalar(1/65535);var f=new t.Vector3(p.x,p.y,p.z);f.x/=u.x,f.y/=u.y,f.z/=u.z,f.x=Math.floor(f.x),f.y=Math.floor(f.y),f.z=Math.floor(f.z),this.compressedInfo={quantizedVector:u,offsetVector:f,currentMatrix:o},r.readQuantPositions(s,this.posBuffer)}else{var d=new Array(3*s);r.readQuantPositions(s,d),Uint16PositionsToFloats(i,this.posBuffer,d,dt,ct)}break;default:throw"Uknown position quantization"}if(this.totalNumberOfNormals)switch(this.normalsQuantization){case 0:r.readNormals(n,a,this.normalBuffer);break;case e.CATSGPlayRepDataOptions.NormalOct16Compression:if($n.keepCompression)r.readOctNormals(a,this.normalBuffer);else{var c=new Array(2*a);r.readOctNormals(a,c),Oct16NormalsToFloats(n,this.normalBuffer,c)}break;case e.CATSGPlayRepDataOptions.NormalOct24Compression:if($n.keepCompression)r.readOctNormals(a,this.normalBuffer);else{c=new Array(3*a);r.readOctNormals(a,c),Oct24NormalsToFloats(n,this.normalBuffer,c)}break;default:throw"Uknown normals quantization"}if(this.hasTextures&&r.readTextures(i,s,this.nbTexCoords,this.textureBuffer),this.hasUVs&&this.numberOfVertices&&r.readFloatArray(2*i,2*s,this.uvsBuffer),this.hasTangentsBinormals&&(r.readFloatArray(3*i,3*s,this.tangentsBuffer),r.readFloatArray(3*i,3*s,this.binormalsBuffer)),this.nbExtraTextureSet>0&&r.version>=210041920)for(var l=0;l<this.nbExtraTextureSet;++l){var m=this.extraTextureSet[l].dimension;r.skip(4*m*s)}};var tt=function(){this.geomType=0,this.nbPrimitives=0,this.primitives=[],this.attribute=null,this.material={id:-1},this.skip=!1};tt.prototype.unstreamPrimSet=function(e){var t=e.readCompressedInt();this.geomType=Mi[t],this.nbPrimitives=e.readCompressedInt(),12==t?this.skip=!0:this.primitives=new Array(this.nbPrimitives);for(var r=0;r<this.nbPrimitives;++r){var i=null;switch(e.readUnsignedChar()){case 1:i=new Ti;break;case 2:i=new Ni;break;case 3:i=new Di;break;case 4:default:console.log("primitive type not handled..");break;case 5:i=new Li;break;case 6:i=new ki}i&&(this.skip?i.skip(e):(i.unstream(e),this.primitives[r]=i))}};var rt=function(){tt.call(this)};(rt.prototype=Object.create(tt.prototype)).constructor=rt,rt.prototype.unstream=function(t,r){if(this.unstreamPrimSet(t),this.skip)t.skip(8*this.nbPrimitives);else for(var i=0;i<this.primitives.length;++i){var n=t.readGraphicAttributeSet();t.pushGAS(n,0);var s=t.getGAS(this.primitives[i].connectivity,r);s.setConnectivity(this.primitives[i].connectivity),"WIRE_EDGE"!==this.geomType&&(s.setLineThickness(1),s.setLineType(e.LinePatternEnum.SOLID)),"BOUNDARY_EDGE"!=this.geomType&&"SHARP_EDGE"!=this.geomType&&"SMOOTH_EDGE"!=this.geomType&&"EDGE"!=this.geomType||s.setRGBAColorAlphaChannel(255),this.primitives[i].symbol&&s.setSymbol(this.primitives[i].symbol),this.primitives[i].gas=s,t.popGAS()}};var it=function(){tt.call(this)};(it.prototype=Object.create(tt.prototype)).constructor=it,it.prototype.unstream=function(t,r){this.unstreamPrimSet(t);var i=t.readGraphicAttributeSet();t.pushGAS(i,0);var n=t.getGAS(null,r);"BOUNDARY_EDGE"!=this.geomType&&"SHARP_EDGE"!=this.geomType&&"SMOOTH_EDGE"!=this.geomType&&"EDGE"!=this.geomType||n.setRGBAColorAlphaChannel(255),"WIRE_EDGE"!==this.geomType&&(n.setLineThickness(1),n.setLineType(e.LinePatternEnum.SOLID));for(var s=0;s<this.primitives.length;++s){var a=n.clone();a.setConnectivity(this.primitives[s].connectivity),this.primitives[s].symbol&&a.setSymbol(this.primitives[s].symbol),this.primitives[s].gas=a}t.popGAS()};var nt=function(){tt.call(this)};(nt.prototype=Object.create(tt.prototype)).constructor=nt,nt.prototype.unstream=function(e,t){rt.prototype.unstream.call(this,e,t);for(var r=0,i=[],n=this.primitives.length,s=0;s<n;s++)i[s]=[];if(e.version>=210041800&&(r=e.readCompressedUInt()),r>0){if(e.readUnsignedChar()){for(s=0;s<r;s++){if(e.readUnsignedChar()){for(var a=e.createMatApp(),o=(e.readStringWithLength(),e.readCompressedUInt()),p=0;p<o;p++){i[e.readCompressedUInt()].push(a)}if((l=e.readCompressedUInt())>0)for(p=0;p<l;p++){var h=e.materialApplicationUnstream(ie.STREAM_ALL_UINT);if(p==l-1){if(h.mapping){var u=e.materials.get([h.material.id]);u&&(u.mapping=h.mapping)}a.copy(h),a.material.primWithMaterials=!0}}}}for(s=0;s<n;s++){var f=this.primitives[s],d=i[s];for(p=0;p<d.length;p++)d[p].material&&e.pushMatId(d[p],this);f.material=e.getCurrentMatId(),f.material&&(f.material.primWithMaterials=!0);for(p=0;p<d.length;p++)d[p].material&&e.popMatId()}e.version;var c=e.readCompressedUInt();for(s=0;s<c;++s){var l;e.readUncompressedInt();if((l=e.readCompressedUInt())>0)for(p=0;p<l;++p){h=e.materialApplicationUnstream(ie.streamSettings);0==l&&(e.pushMatId(h,this),m=e.getCurrentMatId(),e.popMatId())}}}}else for(s=0;s<this.nbPrimitives;s++){if(e.readUnsignedChar()){var m=(h=e.materialApplicationUnstream(ie.STREAM_MATERIAL)).material;m.primWithMaterials=!0,this.skip||(this.primitives[s].material=m)}}};var st=function(){this.sizeComputationMethod=1,this.skippable=!0};st.prototype.readRepSize=function(e){return e.readRepSize(this.sizeComputationMethod)},st.prototype.skip=function(e){var t=e.readRepSize(this.sizeComputationMethod);e.skip(t-4)},st.prototype.isUUIDToSkip=function(t,r){if($n.linkableBagRepUUID){var i=t.getCurrentPosition();t.skip(r-4-16);for(var n=t.readUncompressedInt(),s=t.readUncompressedInt(),a=t.readUncompressedInt(),o=t.readUncompressedInt(),p=(new e.UUID).setFromUint32(n,s,a,o),h=0;h<$n.linkableBagRepUUID.length;h++){var u=$n.linkableBagRepUUID[h];if(p.isEqual(u))return!1}return t.setCurrentPosition(i),!0}return!1},st.prototype.isSkippable=function(e){return!!this.skippable||0==this.sizeComputationMethod&&e.version>=210042720};var at=function(){st.call(this),this.skippable=!1};(at.prototype=Object.create(st.prototype)).constructor=at,at.prototype.unstream=function(e){var t={};this.readRepSize(e),t.timestamp=e.readUncompressedULong();let r=e.readCompressedInt();if(r&&(t.comment=e.readStringWithLength(r)),t.sagmode3D=e.readCompressedInt(),e.version>210041930?t.sag3D=e.readDouble():t.sag3D=e.readFloat(),e.version>1101210&&(e.version>210041930?(t.curveSag3D=e.readDouble(),t.sag2DMode=e.readCompressedInt(),t.sag2D=e.readDouble()):(t.curveSag3D=e.readFloat(),t.sag2DMode=e.readCompressedInt(),t.sag2D=e.readFloat()),t.sensitiveMode=e.readCompressedInt(),t.v4Text3D=e.readCompressedInt()),e.version>=210041730&&(t.regularizationSettingForTessellation=e.readUnsignedChar(),t.maxTriangleThresholdForTessellation=e.readUncompressedULong()),e.version>=210042850){e.readShort();if(0!=e.readCompressedInt()){e.readCompressedInt()}}let i=e.readUnsignedChar();if(i&&(t.minpointx=e.readFloat(),t.minpointy=e.readFloat(),t.minpointz=e.readFloat(),t.maxpointx=e.readFloat(),t.maxpointy=e.readFloat(),t.maxpointz=e.readFloat()),e.version>=1101330&&(t.wireGaps=e.readCompressedInt(),t.edgeSmoothness=e.readCompressedInt()),i=e.readUnsignedChar(),i){(new pt).skip(e)}t.nbLightSources=e.readCompressedInt(),t.nbLightSources>0&&(t.lightSources=[]);for(let r=t.nbLightSources-1;r>=0;r--){(new ht).skip(e)}return e.version>=21e5&&(t.nbLODContainers=e.readCompressedInt(),t.nbLODContainers>0&&(t.LODSags=new Float32Array(t.nbLODContainers),e.readFloatArray(0,t.nbLODContainers,t.LODSags))),(e.version>=1101800&&e.version<21e5||e.version>=2100090)&&(t.toleranceSCale=e.readFloat()),e.version>=210042310?(t.cgrType=e.readUnsignedChar(),t.adaptiveQualityTessellationVersion=e.readUnsignedChar()):e.version,t};var ot=function(){st.call(this),this.skippable=!1};(ot.prototype=Object.create(st.prototype)).constructor=ot,ot.prototype.isNoShowToSkip=function(e){return this.rep.node.noShow&&e.version>=210042720&&!$n.withSceneGraph&&!$n.forceNoShowCGR},ot.prototype.unstreamBagRep=function(e){var t=0;(this.rep.unstream(e),e.version>=1000800)&&(e.readUnsignedChar()&&(this.rep.node.matrix=this.readMatrix(e)));e.pushMatrix(this.rep.node.matrix),this.skipToReadStaticMode(e),$n.flexibleBatching&&(this.rep.toBatch||this.rep.filterBagRep)&&e.pushFlexibleBatchingContext(this.rep);for(var r=e.readCompressedInt(),i=0;i<r;++i){t=0;var n=e.readUnsignedChar();if(1==n){$n.flexibleBatching&&e.multiRefCount++;var s=null;$n.flexibleBatching&&Zn&&!this.rep.toBatch&&!this.rep.filterBagRep&&(this.rep.toBatch=!0,e.pushFlexibleBatchingContext(this.rep));var a=e.readCompressedInt();if(e.multiRefNode.has(a)){if(m=e.multiRefNode.get(a)){if(!($n.flexibleBatching&&Zn||this.rep.node.noShow)){var o=m.clone();this.addMeshClone(o,!1,e),this.rep.children.push(o),$n.flexibleBatching&&e.multiRefCount--;continue}this.rep.children.push(m)}}else{e.version>=210042720&&a!==e.getCurrentPosition()&&(t=e.getCurrentPosition(),e.setCurrentPosition(a));var p=e.readClassName(),h=e.getUnstreamer(p);if($n.flexibleBatching&&Zn&&e.pushFlexibleBatchingContext(this.rep),e.error)return!1;if(s=m=h.unstream(e,this.isNoShowToSkip(e)),e.error)return!1;if(e.multiRefNode.set(a,m),m)if(m.length)for(var u=0;u<m.length;u++)this.rep.children.push(m[u]);else this.rep.children.push(m);e.version>=210042720&&t&&e.setCurrentPosition(t)}$n.flexibleBatching&&Zn&&e.popFlexibleBatchingContext(s),$n.flexibleBatching&&e.multiRefCount--}else if(3==n){var f=es,d=e.readCompressedUInt(),c=ts.get(d),l=c.streamer;if(e.copyStreamerInheritance(l),es=c.rootContext,e.pushFlexibleBatchingContext(this.rep),c.multiRef){var m;o=(m=c.rep).clone();l.compoundSaveReps=c.saveReps,this.addMeshClone(o,!1,l),this.rep.children.push(o)}else{p=l.readClassName(),h=l.getUnstreamer(p);if(l.error)return!1;var v=h.unstream(l,this.isNoShowToSkip(e));if(c.rep=v,c.multiRef=!0,c.saveReps=l.getCurrentReps(),l.error)return!1;if(v)if(v.length)for(u=0;u<v.length;u++)this.rep.children.push(v[u]);else this.rep.children.push(v)}e.popFlexibleBatchingContext(this.rep),es=f,l.compoundSaveReps=null}else{p=e.readClassName(),h=e.getUnstreamer(p);if(e.error)return!1;v=h.unstream(e,this.isNoShowToSkip(e));if(e.error)return!1;if(v)if(v.length)for(u=0;u<v.length;u++)this.rep.children.push(v[u]);else this.rep.children.push(v)}}return this.readUUID(e),$n.flexibleBatching&&this.rep.toBatch&&!this.rep.filterBagRep&&e.popFlexibleBatchingContext(this.rep),e.popRepAttribute(),e.popMatrix(),this.readStaticMode(e),this.rep},ot.prototype.skipBagRep=function(e){(this.rep.unstream(e),e.version>=1000800)&&(e.readUnsignedChar()&&(this.rep.node.matrix=this.readMatrix(e)));return e.pushMatrix(this.rep.node.matrix),this.skipChildren(e),this.readUUID(e),e.popRepAttribute(),e.popMatrix(),this.readStaticMode(e),this.rep},ot.prototype.isMultiInstance=function(e,t){return(!(e.version>=210042720)||t===e.getCurrentPosition()&&!e.multiRefNode.has(t))&&!(e.version<210042720&&(e.hasFakeMultiRepIndice(t)||e.multiRefNode.has(t)))},ot.prototype.skipChildren=function(e){for(var t=e.readCompressedInt(),r=0;r<t;++r){0;var i=e.readUnsignedChar();if(1==i){var n=e.readCompressedInt();if(this.isMultiInstance(e,n)){e.version<210042720&&e.setFakeMultiRepIndice(n);var s=e.readClassName();(a=e.getUnstreamer(s)).isSkippable(e)?a.skip(e):a.unstream(e,!0)}}else if(3==i)e.readCompressedUInt();else{var a;s=e.readClassName();(a=e.getUnstreamer(s)).isSkippable(e)?a.skip(e):a.unstream(e,!0)}}},ot.prototype.addMeshClone=function(e,t,r){var i=!t;if(e){if(e.node.noShow)return;if($n.flexibleBatching&&e.toBatch&&r.pushFlexibleBatchingContext(e),i&&(r.pushGAS(e.repGAS,e.repInheritanceMode),r.pushMatrix(e.node.matrix),r.pushMatId(new ce(r.version>=210042800,e.material,e.materialInheritance,e.layer),e)),e instanceof ai||e instanceof ii){var n=null;if(-1!==e.multirefRepId&&r.multiRefCount)n=(p=r.multiRefReps[e.multirefRepId]).clone();else if(-1!==e.repIndice){(p=r.getReps(e.repIndice,e.renderType)).positionCompression&&$n.keepCompression?(e.getCompressInfo(r,p,r.getCurrentMatrix()),n=p.cloneCompressedCGR(r.compressedArrayInfo.index++)):n=p.clone()}if(n){if(2==$n.sceneGraphOrder&&(r.idOrder++,n.vertexPositionArray))for(var s=2;s<n.vertexPositionArray.length;s+=3)n.vertexPositionArray[s]=r.idOrder;n.rep=e;for(s=0;s<n.drawingGroups.length;++s){var a=n.drawingGroups;a[s].material&&a[s].material.primWithMaterials||(a[s].material=r.getCurrentMatId()),r.pushGAS(a[s].gas,0);var o=r.getGAS(null,e.layerNumber);a[s].gas=o,r.popGAS(a.gas,0)}}if(!$n.flexibleBatching){if(e.axisSystems){var p,h=(p=r.axisSystems.get(e.axisSystems)).axis;(n={axis:{origin:[h.origin[0],h.origin[1],h.origin[2]],xAxis:[h.xAxis[0],h.xAxis[1],h.xAxis[2]],yAxis:[h.yAxis[0],h.yAxis[1],h.yAxis[2]],zAxis:[h.zAxis[0],h.zAxis[1],h.zAxis[2]],color:h.color},globalMatrix:r.getCurrentMatrix()}).rep=e}if(e.curvedPipe>-1){var u=r.curvedPipes.get(e.curvedPipe);(n={curveVertices:u.curveVertices,startNormal:u.startNormal,endNormal:u.endNormal,radius:u.radius,startSideVector:u.startSideVector,matId:u.matId,gas:u.gas,globalMatrix:r.getCurrentMatrix()}).rep=e}if(e.canonical){var f=r.canonical.get(e.canonical);(n={type:f.type,vectors:f.vectors,floats:f.floats,matId:f.matId,gas:f.gas,globalMatrix:r.getCurrentMatrix()}).rep=e}}return null==n?($n.flexibleBatching&&e.toBatch&&r.popFlexibleBatchingContext(e),r.popMatrix(),r.popRepAttribute(),null):(e.resolvedInheritance(r,n),$n.flexibleBatching&&e.toBatch&&r.popFlexibleBatchingContext(e),void(i&&(r.popRepAttribute(),r.popMatrix())))}var d=e.children.length;for(s=0;s<d;s++)this.addMeshClone(e.children[s],!1,r);$n.flexibleBatching&&e.toBatch&&r.popFlexibleBatchingContext(e),i&&(r.popRepAttribute(),r.popMatrix())}};var pt=function(){st.call(this)};pt.prototype=Object.create(st.prototype),pt.prototype.constructor=pt;var ht=function(){st.call(this)};ht.prototype=Object.create(st.prototype),ht.prototype.constructor=ht;var ut=function(){st.call(this),this.sizeComputationMethod=2};ut.prototype=Object.create(st.prototype),ut.prototype.constructor=ut,ut.prototype.unstream=function(e,t){var r=new pi;this.readRepSize(e),r.rep.unstream(e),e.setNumberOfVertices(16777216);var i,n=e.readCompressedInt();if(n<=0)return e.popRepAttribute(),null;for(var s=0;s<n;s++){switch(i=null,e.readUnsignedChar()){case v:case y:i=new Lt;break;case g:case x:i=new Lr;break;case B:i=new Xt;break;case A:i=new Yt;break;case I:i=new qt;break;case b:i=new Wt;break;case C:i=new Ht;break;case S:i=new Zt;break;case w:i=new Jt;break;case P:i=new Kt;break;case M:i=new $t;break;case R:i=new er;break;case m:break;default:return}if(null!==i){i.unstream(e);var a=e.readGraphicAttributeSet();e.pushGAS(a,0);var o=e.getGAS(null,r.rep.layerNumber);i.primitive&&i.primitive.symbol&&o.setSymbol(i.primitive.symbol),i.primitive&&o.setConnectivity(i.primitive.connectivity),r.addGP(i,o,e,t),e.popGAS()}else e.readGraphicAttributeSet()}r.checkGP(e,t);var p=r.addMesh(e);return r.imageRep.length?(r.imageRep.unshift(r.rep),r.imageRep):p?r.rep:null};var ft=function(){st.call(this),this.sizeComputationMethod=2};ft.prototype=Object.create(st.prototype),ft.prototype.constructor=ft,ft.prototype.unstream=function(t){var r=new rn;this.readRepSize(t),r.rep.unstream(t);var i=t.readCompressedInt(),n=new e.PrimitiveGroup;n.fillAttr=new e.FillAttributes,n.lineAttr=new e.LineAttributes,n.pointAttr=new e.PointAttributes;for(var s,a=0;a<i;++a){var o=t.readUnsignedChar();switch(2==$n.sceneGraphOrder&&t.idOrder++,s=null,o){case 121:s=new Or;break;case 128:s=new Dr;break;case 129:s=new Nr;break;case 130:s=new Er;break;case 131:s=new Gr;break;case 132:s=new Ir;break;case 135:s=new br;break;case 136:s=new Cr;break;case 164:s=new Pr;break;case 165:s=new wr;break;case 166:s=new Sr;break;case 167:s=new Mr;break;case 168:s=new Rr;break;case 169:s=new Tr;break;case 105:s=new Ur}if(s){var p=s.unstream(t),h=t.readGraphicAttributeSet();t.pushGAS(h,0);var u=t.getGAS(s.primitive.connectivity,r.rep.layerNumber);if(s.primitive&&s.primitive.symbol&&u.setSymbol(s.primitive.symbol),u.setBasic(!0),u.setConnectivity(s.primitive.connectivity),3==p&&h.getBlankingRep(1),4==p&&h.getBlankingRep(2),$n.mode2D&&u.set2DMode(),s.isGeometricText&&$n.processText&&s.text){var f=u.getDisplayedColor(),d=-1/0,c=-1/0;d=-1;u.isNoZ()&&(d=u.getPriority()),u.depthMode&&(c=u.getDepthPriority()),s.text._noZPriority=d,s.text.depthPriority=c;var l=new e.Color(f[0]/255,f[1]/255,f[2]/255,f[3]/255);s.text.color=l,r.texts.push(s.text)}p&&r.addGP(s,u,t),t.popGAS()}else t.readGraphicAttributeSet()}if(r.texts.length){var m=t.texts.add(r.texts);r.rep.node.textIndice=m+1}var v=r.addMesh(t);return r.imageRep.length?(r.imageRep.push(r.rep),r.imageRep):v||r.texts.length?r.rep:null};var dt={x:0,y:0,z:0},ct={x:0,y:0,z:0},lt=function(){st.call(this),this.sizeComputationMethod=3};lt.prototype=Object.create(st.prototype),lt.prototype.constructor=lt,lt.prototype.unstream=function(e){var t=this.readRepSize(e);e.skip(t-4)},lt.prototype.unstreamRep=function(e,t){t||(t=new hi),this.readRepSize(e);if(t.rep.unstream(e),e.version>=21e5&&!n){var r=0;(v=e.readUnsignedChar())&&(t.vertexBuffer=new et,t.vertexBuffer.partUnStreamHeader(e),r=t.vertexBuffer.getNumberOfVertices());t.nbLODFaces=e.readUnsignedChar();var i=0;if(t.nbLODFaces){i=new Float32Array(t.nbLODFaces+1);e.readFloatArray(0,t.nbLODFaces+1,i)}else i=e.version>210041930?e.readDouble():e.readFloat();if($n.withSAG&&(t.rep.node.sag=i),e.version>=210021620)e.readDouble();e.setNumberOfVertices(r);var s=0;t.posInNextStreamer=e.readCompressedInt();for(var a=0,o=0;s<=Pi.LSG;)if(0!=t.nbLODFaces||s!=Pi.LOD1&&s!=Pi.LOD2&&s!=Pi.LOD3&&s!=Pi.FACES){if(0==t.nbLODFaces&&s==Pi.LOD0){if(!(f=e.getContainer()))return e.error=" container not found",!1;var p=f.getStreamerByName("LOD0");if(e.copyStreamerInheritance(p),p){if(p.setCurrentPosition(t.posInNextStreamer),t.posInNextStreamer=p.readCompressedInt(),v){var h=p.readCompressedInt(),u=p.readCompressedInt();t.vertexBuffer.partUnStream(p,a,o,h,u),p.setNumberOfVertices(t.vertexBuffer.getNumberOfVertices())}t.unStreamFaces(p)}}else if(s==Pi.LOD0){if(!(f=e.getContainer()))return e.error=" container not found",!1;p=f.getStreamerByName("LOD0");if(e.copyStreamerInheritance(p),p&&(p.setCurrentPosition(t.posInNextStreamer),t.posInNextStreamer=p.readCompressedInt(),v)){h=p.readCompressedInt(),u=p.readCompressedInt();t.vertexBuffer.partUnStream(p,a,o,h,u),a+=h,o+=u}}if(s==Pi.LOD1){if(!(f=e.getContainer()))return e.error=" container not found",!1;p=f.getStreamerByName("LOD1");if(e.copyStreamerInheritance(p),p&&(p.setCurrentPosition(t.posInNextStreamer),t.posInNextStreamer=p.readCompressedInt(),v)){h=p.readCompressedInt(),u=p.readCompressedInt();t.vertexBuffer.partUnStream(p,a,o,h,u),a+=h,o+=u}}if(s==Pi.LOD2){if(!(f=e.getContainer()))return e.error=" container not found",!1;p=f.getStreamerByName("LOD2");if(e.copyStreamerInheritance(p),p&&(p.setCurrentPosition(t.posInNextStreamer),t.posInNextStreamer=p.readCompressedInt(),v)){h=p.readCompressedInt(),u=p.readCompressedInt();t.vertexBuffer.partUnStream(p,a,o,h,u),a+=h,o+=u}}if(s==Pi.LOD3){if(!(f=e.getContainer()))return e.error=" container not found",!1;p=f.getStreamerByName("LOD3");if(e.copyStreamerInheritance(p),p&&(p.setCurrentPosition(t.posInNextStreamer),t.posInNextStreamer=p.readCompressedInt(),v)){h=p.readCompressedInt(),u=p.readCompressedInt();t.vertexBuffer.partUnStream(p,a,o,h,u),a+=h,o+=u}}if(s==Pi.FACES){if(!(f=e.getContainer()))return e.error=" container not found",!1;p=f.getStreamerByName("FACES");if(e.copyStreamerInheritance(p),p){if(p.setCurrentPosition(t.posInNextStreamer),t.posInNextStreamer=p.readCompressedInt(),v){h=p.readCompressedInt(),u=p.readCompressedInt();p.setNumberOfVertices(a+h),t.vertexBuffer.partUnStream(p,a,o,h,u),a+=h,o+=u}else p.setNumberOfVertices(0);t.unStreamFaces(p)}}if(s==Pi.LSG){var f;if(!(f=e.getContainer()))return e.error=" container not found",!1;var d=f.getStreamerByName("LSG");if(d){e.copyStreamerInheritance(d),d.setNumberOfVertices(r),v?d.setNumberOfVertices(r):d.setNumberOfVertices(0),d.setCurrentPosition(t.posInNextStreamer),t.posInNextStreamer=d.readCompressedInt();var c=t.sets.length,l=d.readUnsignedChar();t.nbSets=l+c;for(var m=0;m<l;++m){switch(d.readUnsignedChar()){case 1:t.sets[m+c]=new it;break;case 2:t.sets[m+c]=new rt;break;default:return void(t.sets[m+c]=null)}t.sets[m+c]&&t.sets[m+c].unstream(d,t.rep.layerNumber)}}}s++}else s++}else{var v;(v=e.readUnsignedChar())&&(t.vertexBuffer=new et,t.vertexBuffer.unstream(e),e.setNumberOfVertices(t.vertexBuffer.getNumberOfVertices()));i=0;i=e.version>210041930?e.readDouble():e.readFloat(),t.nbLODFaces=e.readUnsignedChar(),$n.withSAG&&(t.rep.node.sag=i);for(m=0;m<t.nbLODFaces;++m){var y;switch(e.readUnsignedChar()){case 1:y=new Ti;break;case 4:y=new Oi}y&&[].push(y.unstream(e)),e.readFloat(),e.readUncompressedInt();e.readUncompressedInt()}t.nbSets=e.readUnsignedChar();for(m=0;m<t.nbSets;++m){switch(e.readUnsignedChar()){case 1:t.sets[m]=new it;break;case 2:t.sets[m]=new rt;break;default:return void(t.sets[m]=null)}t.sets[m]&&t.sets[m].unstream(e)}}return t};var mt=function(){lt.call(this),this.repPosInStreamer=0,this.skippable=!1};mt.prototype=Object.create(lt.prototype),mt.prototype.constructor=mt,mt.prototype.unstream=function(e,t){var r=new hi,i=this.unstreamRep(e,r);if($n.keepCompression&&r.vertexBuffer&&r.vertexBuffer.positionQuantization){var s=e.compressedArrayInfo.index,a=r.vertexBuffer.posBuffer;if(a){r.vertexBuffer.posBuffer=new Array(a.length/3*4);for(var o=0;o<a.length/3;o++)r.vertexBuffer.posBuffer[4*o]=a[3*o],r.vertexBuffer.posBuffer[4*o+1]=a[3*o+1],r.vertexBuffer.posBuffer[4*o+2]=a[3*o+2],r.vertexBuffer.posBuffer[4*o+3]=s}}if(r.posInNextStreamer||(r.posInNextStreamer=0),e.version<21e5&&(r.posInNextStreamer=e.readCompressedInt()),!n){if(!i)return!1;var p=e.getContainer(),h=p?p.getStreamerByName("SurfacicReps"):e;p&&h.setCurrentPosition(r.posInNextStreamer),e.copyStreamerInheritance(h);var u=new vt;if(h)u.unstreamRep(h,r);else{if(h.cgrContainer)return;u.unstream(h,r)}}return!!i&&(t?(e.popRepAttribute(),null):r.addMesh(e)?r.rep:null)};var vt=function(){st.call(this),this.sizeComputationMethod=3};vt.prototype=Object.create(st.prototype),vt.prototype.constructor=vt,vt.prototype.unStreamEdgeIndex=function(e){e.readCompressedInt(),e.readCompressedInt()},vt.prototype.unstream=function(e){var t=this.readRepSize(e);e.skip(t-4)},vt.prototype.unstream=function(e){var t=new ui;return t.vertexBuffer=new $e,this.unstreamRep(e,t),t.addMesh(e),t.rep},vt.prototype.unstreamRep=function(e,t){if(!(e.version<1101410)&&t){e.setLightDataStreaming(!1),this.readRepSize(e);e.readFloat(),e.readFloat();if(e.version>=210041720)128&e.readUnsignedChar()&&e.skip(4);if(e.version>=210042320)e.readUnsignedChar();var r=t.getSet("FACE"),i=t.getSet("EDGE"),n=r.length,s=i.length,a=t.nbLODFaces,o=e.readCompressedInt(),p=new Lt;if(n)for(var h=0;h<n;h++){var u=r[h];p.unstream(e),u.cgmId=p.node.cgmId,u.decoration=p.decoration,u.boundingSphere=p.boundingSphere}for(h=0;h<a;h++)p.unstream(e);var f=new _t;if(s&&i)for(h=0;h<s;h++){var d=i[h];f.unstream(e),d.cgmId=f.node.cgmId,d.decoration=f.decoration,this.unStreamEdgeIndex(e)}for(h=0;h<o;h++){var c=e.readCompressedInt();e.readUncompressedInt(),e.readUncompressedInt();if(e.version>=1101710&&e.version<210042440&&e.setLightDataStreaming(!0),c)for(var l=new Lr,m=0;m<c;m++)l.skip(e);e.version>=1101710&&e.version<210042440&&e.setLightDataStreaming(!1)}for(var v=t.nbSets,y=new _t,g=new jt,x=new Xt,B=0;B<v;++B){var A=t.sets[B],I=A.primitives;for(m=0;m<I.length;m++){var b=I[m];if("FACE"!=A.geomType&&"EDGE"!=A.geomType&&"ISOPAR"!=A.geomType){var C=null,S=e.readUnsignedChar();switch(S){case 80:case 81:C=new Lt;break;case 82:C=new Lr;break;case 84:C=x;break;case 96:C=y;break;case 200:C=g;break;case 162:C=new zt;break;case 134:C=new kr;break;case 86:C=new qt;break;case 187:C=new Vt;break;default:return}C&&(C.unstream(e),b.cgmId=C.node.cgmId,b.decoration=C.decoration,b.boundingSphere=C.boundingSphere),96!=S&&200!=S&&162!=S||this.unStreamEdgeIndex(e)}}}e.setLightDataStreaming(!0)}};var yt=function(){st.call(this),this.sizeComputationMethod=2};yt.prototype=Object.create(st.prototype),yt.prototype.constructor=yt,yt.prototype.unstream=function(t){var r=new bi;this.readRepSize(t),r.nbIndicesTotal=0,r.vertexBuffer=new $e;var i=null,n=null;r.rep.unstream(t);var s=t.readFloat();$n.withSAG&&(r.rep.node.sag=s);t.readFloat(),t.readFloat();t.version>=210041740&&(128&t.readUnsignedChar()&&t.skip(8));if(t.version>=210042320)t.readUnsignedChar();if(r.nbElEdge=t.readCompressedInt(),r.nbElEdge)for(var a=r.nbElEdge-1;a>=0;a--){(i=new Lr).primitive.indices=r.indexBuffer,i.vertexBuffer=r.vertexBuffer,i.unstream(t),i.primitive.cgmId=i.node.cgmId,i.decoration&&(i.primitive.decoration=i.decoration),r.nbIndicesTotal+=i.primitive.count;var o=t.readGraphicAttributeSet();t.pushGAS(o,0),(d=t.getGAS(e.ConnectivityTypeEnum.LINES,r.rep.layerNumber)).setConnectivity(e.ConnectivityTypeEnum.LINES),t.popGAS(),i.primitive.attr=d;for(var p=r.edgePrimitivesSets.length,h=0;h<p;h++){var u=r.edgePrimitivesSets[h];if(u.attr.set==i.primitive.attr.set&&u.attr.rgba==i.primitive.attr.rgba){u.set.push(i.primitive),u.nbIndices+=i.primitive.count;break}}if(h==r.edgePrimitivesSets.length)(c={}).attr=i.primitive.attr,c.nbIndices=i.primitive.count,c.set=[],c.set.push(i.primitive),r.edgePrimitivesSets.push(c)}if(r.nbElPoints=t.readCompressedInt(),r.nbElPoints){for(a=r.nbElPoints-1;a>=0;a--){(n=new Xt).vertexBuffer=r.vertexBuffer,n.primitive.indices=r.indexBuffer,n.unstream(t),n.primitive.cgmId=n.node.cgmId,n.decoration&&(n.primitive.decoration=n.decoration),r.nbIndicesTotal+=n.primitive.count;p=r.pointPrimimitivesSets.length;for(h=0;h<p;h++){var f=r.pointPrimimitivesSets[h];if(f.symbol==n.primitive.symbol){f.set.push(n.primitive),f.nbIndices+=n.primitive.count;break}}if(h==r.pointPrimimitivesSets.length)(c={}).symbol=n.primitive.symbol,c.nbIndices=n.primitive.count,c.set=[],c.set.push(n.primitive),r.pointPrimimitivesSets.push(c)}var d;o=t.readGraphicAttributeSet();t.pushGAS(o,0),(d=t.getGAS(e.ConnectivityTypeEnum.POINTS,r.rep.layerNumber)).setConnectivity(e.ConnectivityTypeEnum.POINTS),t.popGAS();for(a=0;a<r.pointPrimimitivesSets.length;a++){var c;(c=r.pointPrimimitivesSets[a]).attr=d.clone(),c.attr.setSymbol(c.symbol)}}return r.addMesh(t)?r.rep:null};var gt=function(){st.call(this),this.sizeComputationMethod=2};gt.prototype=Object.create(st.prototype),gt.prototype.constructor=gt,gt.prototype.unstream=function(e){var t=new Ai;this.readRepSize(e);var r=!0;if(t.rep.unstream(e),t.vertexBuffer=new $e,t.nbLODFaces=e.readCompressedInt(),t.nbLODFaces>0){for(var i=[],n=1;n<=t.nbLODFaces;++n)i.push(e.readFloat());var s=new Wt;r=s.unstream(e,t.vertexBuffer),t.sets.push(s);for(n=1;n<=t.nbLODFaces-2;n++){(new Wt).skip(e)}(new Lr).skip(e)}return r?t.addMesh(e)?t.rep:null:(e.popRepAttribute(),null)};var xt=function(){st.call(this)};xt.prototype=Object.create(st.prototype),xt.prototype.constructor=xt,xt.prototype.unstream=function(e){var t=new ci;if(this.readRepSize(e),t.rep.unstream(e),t.vertexBuffer=new $e,t.nbLODFaces=e.readCompressedInt(),t.nbLODFaces>0){for(var r=[],i=0;i<t.nbLODFaces;++i)r.push(e.readFloat());for(i=0;i<t.nbLODFaces;++i)(new Lr).unstream(e)}return t.addMesh(e)?t.rep:null};var Bt=function(){st.call(this)};Bt.prototype=Object.create(st.prototype),Bt.prototype.constructor=Bt,Bt.prototype.unstream=function(e){var t=new xi;this.readRepSize(e),t.rep.unstream(e);var r=new qt;r.unstream(e);var i=e.getGAS(null,t.rep.layerNumber),n=i.getDisplayedColor(),s=r.primitive;return t.refPlane.push({rep:t.rep,origin:s.origin,xAxis:s.direction1,yAxis:s.direction2,noShow:i.isHidden(),color:n,lengthX:s.length,lengthY:s.length,mode:s.mode,type:"CAT3DPlanRep"}),t.addMesh(e)?t.rep:null};var At=function(){st.call(this)};At.prototype=Object.create(st.prototype),At.prototype.constructor=At,At.prototype.unstream=function(e){var t=new di;if(this.readRepSize(e),t.rep.unstream(e),e.readUnsignedChar())(new Kt).unstream(e);return t.addMesh(e)?t.rep:null};var It=function(){st.call(this)};It.prototype=Object.create(st.prototype),It.prototype.constructor=It,It.prototype.unstream=function(e){var t=new li;if(this.readRepSize(e),t.rep.unstream(e),e.readUnsignedChar())(new Kt).unstream(e);return t.addMesh(e)?t.rep:null};var bt=function(){st.call(this),this.sizeComputationMethod=2};bt.prototype=Object.create(st.prototype),bt.prototype.constructor=bt,bt.prototype.unstream=function(e){var t=new Ii;if(this.readRepSize(e),t.rep.unstream(e),t.vertexBuffer=new $e,t.nbLODFaces=e.readCompressedInt(),t.nbLODFaces>0){for(var r=[],i=1;i<=t.nbLODFaces;++i)r.push(e.readFloat());var n=new Ht;t.isGPUInstanciable=n.unstream(e,t.vertexBuffer),t.sets.push(n);for(i=1;i<=t.nbLODFaces-2;i++){(new Ht).skip(e)}(new Lr).skip(e)}return t.addMesh(e)?t.rep:null};var Ct=function(){st.call(this)};Ct.prototype=Object.create(st.prototype),Ct.prototype.constructor=Ct,Ct.prototype.unstream=function(e){2==$n.sceneGraphOrder&&e.idOrder++;var t=new Yi;if(this.readRepSize(e),t.rep.unstream(e),t.vertexBuffer=new $e,e.readUnsignedChar()>0){var r=new Or;r.unstream(e),t.gp=r}return t.addMesh(e)?t.rep:null};var St=function(){st.call(this)};St.prototype=Object.create(st.prototype),St.prototype.constructor=St,St.prototype.unstream=function(e){2==$n.sceneGraphOrder&&e.idOrder++;var t=new qi;this.readRepSize(e),t.rep.unstream(e),t.vertexBuffer=new $e;var r=new Nr;return r.unstream(e),t.gp=r,t.addMesh(e)?t.rep:null};var wt=function(){st.call(this)};wt.prototype=Object.create(st.prototype),wt.prototype.constructor=wt,wt.prototype.unstream=function(e){var t=new vi;if(this.readRepSize(e),t.rep.unstream(e),t.vertexBuffer=new $e,1==e.readUnsignedChar()){var r=new Xt;r.unstream(e),t.gp=r}return t.addMesh(e)?t.rep:null};var Pt=function(){st.call(this)};Pt.prototype=Object.create(st.prototype),Pt.prototype.constructor=Pt,Pt.prototype.unstream=function(e){var t=new mi;this.readRepSize(e),t.rep.unstream(e);(new Yt).unstream(e),(new Yt).unstream(e),(new Yt).unstream(e);return t.addMesh(e)?t.rep:null};var Mt=function(){st.call(this)};Mt.prototype=Object.create(st.prototype),Mt.prototype.constructor=Mt,Mt.prototype.unstream=function(e){2==$n.sceneGraphOrder&&e.idOrder++;var t=new fi;if(this.readRepSize(e),t.rep.unstream(e),t.vertexBuffer=new $e,1==e.readUnsignedChar()){var r=new Er;r.unstream(e),t.gp=r}return t.addMesh(e)?t.rep:null};var Rt=function(){st.call(this)};Rt.prototype=Object.create(st.prototype),Rt.prototype.constructor=Rt,Rt.prototype.unstream=function(e){var t=new yi;this.readRepSize(e),t.rep.unstream(e),t.vertexBuffer=new $e;var r=new Lr;return r.unstream(e),t.gp=r,t.addMesh(e)?t.rep:null};var Tt=function(){st.call(this)};Tt.prototype=Object.create(st.prototype),Tt.prototype.constructor=Tt,Tt.prototype.getAxisSystemInfo=function(e){var t,r=e.getCurrentPosition();(new ut).skip(e);var i=0;e.version>=210042110?(t=e.readFloat(),i=e.readCompressedInt()):t=e.readCompressedInt();var n=e.readCompressedInt();return e.setCurrentPosition(r),{isMonoPlane:n,mode:i,axisLength:t}},Tt.prototype.unstream=function(e){this.readRepSize(e);var t=this.getAxisSystemInfo(e),r=ut.prototype.unstream.call(this,e,t);if(e.version>=210042110){e.readFloat();e.readCompressedInt()}else e.readCompressedInt();e.readCompressedInt();return r};var Ut=function(){st.call(this)};Ut.prototype=Object.create(st.prototype),Ut.prototype.constructor=Ut,Ut.prototype.unstream=function(e){2==$n.sceneGraphOrder&&e.idOrder++;var t=new Qi;if(this.readRepSize(e),t.rep.unstream(e),t.vertexBuffer=new $e,e.readUnsignedChar()>0){var r=new Dr;r.unstream(e),t.gp=r}return t.addMesh(e)?t.rep:null};var Ft=function(){st.call(this)};Ft.prototype=Object.create(st.prototype),Ft.prototype.constructor=Ft,Ft.prototype.unstream=function(e){2==$n.sceneGraphOrder&&e.idOrder++;var t=new Ki;this.readRepSize(e),t.rep.unstream(e),t.vertexBuffer=new $e;var r=new br;return r.unstream(e),t.gp=r,t.addMesh(e)?t.rep:null};var Gt=function(){st.call(this)};Gt.prototype=Object.create(st.prototype),Gt.prototype.constructor=Gt,Gt.prototype.unstream=function(e){2==$n.sceneGraphOrder&&e.idOrder++;var t=new Ji;this.readRepSize(e),t.rep.unstream(e),t.vertexBuffer=new $e,t.unstreamPerforatedPolygon(e);for(var r=e.readCompressedInt(),i=0;i<r;i++){var n=new Gr;n.unstream(e),t.gp.push(n)}return t.gp.length?t.addMesh(e)?t.rep:null:(e.popRepAttribute(),null)};var Ot=function(){st.call(this)};Ot.prototype=Object.create(st.prototype),Ot.prototype.constructor=Ot,Ot.prototype.unstream=function(e){2==$n.sceneGraphOrder&&e.idOrder++;var t=new tn;this.readRepSize(e),t.rep.unstream(e),t.vertexBuffer=new $e;var r=new Gr,i=r.unstream(e);return t.gp=r,i&&t.addMesh(e)?t.rep:null};var Nt=function(){st.call(this)};Nt.prototype=Object.create(st.prototype),Nt.prototype.constructor=Nt,Nt.prototype.unstream=function(e){2==$n.sceneGraphOrder&&e.idOrder++;var r=new en;this.readRepSize(e),r.rep.unstream(e),r.vertexBuffer=new $e;var i=new Sr,n=i.unstream(e);if(r.gp=i,n&&i){if(void 0!==i.zoomQuality&&0===i.zoomQuality&&e.setFixedMode(!0),i.point&&(e.pushStaticMode(e.getCurrentMatrix()),e.currentMatrix.push(new t.Matrix4)),i.primitive.material){var s=new ce(e.version>=210042800,i.primitive.material);s.forceMaterial(),e.pushMatId(s,r.rep)}r.gp=i;var a=r.addMesh(e);return e.setFixedMode(!1),i.primitive.material&&e.popMatId(),i.point&&(e.currentMatrix.pop(),e.popStaticMode()),a?r.rep:null}return null};var Et=function(){this.node=new e.SGPrimitive,this.vertexBuffer=null,this.primitive=null,this.decoration=0};(Et.prototype=Object.create(Et.prototype)).constructor=Et,Et.prototype.unstreamPrimitive=function(e){if(this.node.cgmId=0,this.decoration=0,e.version>=1100700?this.node.cgmId=e.readUncompressedULong():e.version>=1100200&&(this.node.cgmId=e.readCompressedInt()),e.version>=1100800){var t=e.readUnsignedShort();if(t>0){var r=e.decorations,i=[];if(1==t){i.push(0);e.readUnsignedChar()}else if(65535==t)i.push(0);else{i.push(t);for(var n=0;n<t;n++)i.push(e.readUnsignedChar())}this.decoration=r.addDecoration(i)}}},Et.prototype.create2DArcCircleGP=function(t,r,i,n,s,a,o,p,h,u){r.start=0,o<a&&(o+=2*Math.PI);var f=t.posBuffer.length/3;if(h){r.connectivity=e.ConnectivityTypeEnum.TRIANGLES,r.count+=3*(p-2);for(var d=0;d<p;++d){var c=a+(o-a)*d/(p-1);t.posBuffer.push(i+s*Math.cos(c)),t.posBuffer.push(n+s*Math.sin(c)),t.posBuffer.push(u.idOrder),t.normalBuffer.push(0),t.normalBuffer.push(0),t.normalBuffer.push(1)}for(d=1;d<p-1;d++)r.indices.push(0),r.indices.push(d),r.indices.push(d+1)}else{r.connectivity=e.ConnectivityTypeEnum.LINES,r.count+=2+2*(p-2);c=a;t.posBuffer.push(i+s*Math.cos(c)),t.posBuffer.push(n+s*Math.sin(c)),t.posBuffer.push(u.idOrder);for(d=1;d<p;++d)c=a+(o-a)*d/(p-1),r.indices.push(f++),t.posBuffer.push(i+s*Math.cos(c)),t.posBuffer.push(n+s*Math.sin(c)),t.posBuffer.push(u.idOrder),r.indices.push(f)}},Et.prototype.createPolylineGP=function(t,r,i,n){switch(r.start=0,r.connectivity=e.ConnectivityTypeEnum.LINES,n){case 0:r.count+=i;for(var s=0;s<i;++s)r.indices.push(t++);break;case 1:r.count+=2+2*(i-2);for(s=1;s<i;++s)r.indices.push(t++),r.indices.push(t);break;case 2:r.count+=4+2*(i-2);var a=t;for(s=0;s<i-1;++s)r.indices.push(t++),r.indices.push(t);r.indices.push(t),r.indices.push(a);break;default:return null}},Et.prototype.createPolygonGP=function(t,r,i,n,s,a){if(r.start=0,a){r.connectivity=e.ConnectivityTypeEnum.TRIANGLES;switch(s){case 0:case 4:r.count+=n;for(var o=0;o<n;++o)r.indices.push(i[t++]);break;case 1:case 5:r.count+=3*(n-2);var p=0;for(o=0;o<n-2;o++)r.indices.push(i[t]),r.indices.push(i[t+1+p]),r.indices.push(i[t+2-p]),t++,p=1-p;t+=2;break;case 2:case 6:r.count+=3*(n-2);var h=i[t];for(o=0;o<n-2;o++)r.indices.push(h),r.indices.push(i[t+2]),r.indices.push(i[t+1]),t++;t+=2;break;default:return null}}else{r.connectivity=e.ConnectivityTypeEnum.LINES,r.count=2+2*(n-1);for(var u=t,f=1;f<n;++f)r.indices.push(t++),r.indices.push(t);r.indices.push(t),r.indices.push(u)}return t};var Dt=function(){Et.call(this),this.boundingBoxCenter=new Float32Array(3),this.boundingBoxDim=new Float32Array(3),this.boundingSphere=null};(Dt.prototype=Object.create(Et.prototype)).constructor=Dt,Dt.prototype.unstreamBBox=function(t){switch(this.unstreamPrimitive(t),G?F:0){case 0:for(var r=0;r<3;r++)this.boundingBoxCenter[r]=t.readFloat();for(r=0;r<3;r++)this.boundingBoxDim[r]=t.readFloat();var i=new Array(3);for(r=0;r<3;r++)i[r]=t.readFloat();var n=t.readFloat();$n.withPrimBoundingElement&&(this.boundingSphere={center:i,radius:n});break;case e.CATSGPlayRepDataOptions.QuantBBoxPerGP:var s=(ct.x-dt.x)*one_over_65535,a=(ct.y-dt.y)*one_over_65535,o=(ct.z-dt.z)*one_over_65535,p={x:t.readUnsignedShort()*s+dt.x,y:t.readUnsignedShort()*a+dt.y,z:t.readUnsignedShort()*o+dt.z},h={x:t.readUnsignedShort()*s+dt.x,y:t.readUnsignedShort()*a+dt.y,z:t.readUnsignedShort()*o+dt.z};this.boundingBoxCenter[0]=.5*(h.x+p.x),this.boundingBoxCenter[1]=.5*(h.y+p.y),this.boundingBoxCenter[2]=.5*(h.z+p.z),this.boundingBoxDim[0]=h.x-p.x,this.boundingBoxDim[1]=h.y-p.y,this.boundingBoxDim[2]=h.z-p.z;for(i=new Array(3),r=0;r<3;r++)i[r]=this.boundingBoxCenter[r];n=Math.max(Math.max(this.boundingBoxDim[0],this.boundingBoxDim[1]),this.boundingBoxDim[2])*Math.sqrt(2)*.5;$n.withPrimBoundingElement&&(this.boundingSphere={center:i,radius:n});break;case e.CATSGPlayRepDataOptions.BBoxPerRep:this.boundingBoxCenter[0]=.5*(ct.x+dt.x),this.boundingBoxCenter[1]=.5*(ct.y+dt.y),this.boundingBoxCenter[2]=.5*(ct.z+dt.z),this.boundingBoxDim[0]=ct.x-dt.x,this.boundingBoxDim[1]=ct.y-dt.y,this.boundingBoxDim[2]=ct.z-dt.z;for(i=new Array(3),r=0;r<3;r++)i[r]=this.boundingBoxCenter[r];n=Math.max(Math.max(this.boundingBoxDim[0],this.boundingBoxDim[1]),this.boundingBoxDim[2])*Math.sqrt(2)*.5;$n.withPrimBoundingElement&&(this.boundingSphere={center:i,radius:n})}};var Lt=function(){Dt.call(this)};Lt.prototype=Object.create(Dt.prototype),Lt.prototype.constructor=Lt,Lt.prototype.unstream=function(e){if(e.version>=1101410){this.unstreamBBox(e),e.getLightDataStreaming()&&(this.primitive=new Ti,this.primitive.unstream(e),e.readUnsignedChar()&&(this.vertexBuffer=new $e,this.vertexBuffer.unstream(e))),e.version>=1101430?e.readUnsignedChar():0}else{this.unstreamBBox(e);var t=e.readCompressedInt(),r=e.readCompressedInt(),i=e.readCompressedInt(),n=e.readCompressedInt(),s=e.readCompressedInt();this.primitive=new Ti,e.version>=1100700&&e.readUnsignedChar();var a,o=1&(a=e.readUnsignedChar())||2&a,p=4&a||8&a;if(this.vertexBuffer||(this.vertexBuffer=new $e),o)e.readFloatArray(0,t,this.vertexBuffer.posBuffer),e.readUnsignedChar()&&e.readFloatArray(0,t,this.vertexBuffer.uvBuffer),e.version>1100820&&(multiple_texture=e.readUnsignedChar());if(p)if(e.version>1000800){e.readShortArray(r,this.vertexBuffer.normalBuffer);for(var h=0;h<r;h++)this.vertexBuffer.normalBuffer[h]*=3051850947599719e-20}else e.readFloatArray(0,r,this.vertexBuffer.normalBuffer);i&&(e.version>=1100600||e.version>1000500?e.unpackcArray(3*i,this.primitive.indices,0):this.primitive.indices=e.readUncompressedIntArray(3*i,this.primitive.indices));var u=[],f=this.primitive.indices.length;if(n){var d=[];for(e.version>1000500?e.unpackcArray(n,d,0):e.readUncompressedIntArray(n,d),h=n-1;h>=0;h--){var c=d[h];e.version>=1100600||e.version>1000500?e.unpackcArray(c,u,0):e.readUncompressedIntArray(c,u);for(var l=2;l<c;++l)l%2?(this.primitive.indices[f++]=u[l],this.primitive.indices[f++]=u[l-1],this.primitive.indices[f++]=u[l-2]):(this.primitive.indices[f++]=u[l-1],this.primitive.indices[f++]=u[l],this.primitive.indices[f++]=u[l-2])}}if(s){var m=[];for(e.version>1000500?e.unpackcArray(s,m,0):e.readUncompressedIntArray(s,m),h=s-1;h>=0;h--){var v=m[h];e.version>=1100600||e.version>1000500?e.unpackcArray(v,u,0):e.readUncompressedIntArray(v,u);for(l=2;l<v;++l)this.primitive.indices[f++]=u[0],this.primitive.indices[f++]=u[l-1],this.primitive.indices[f++]=u[l]}}e.readUnsignedChar()&&e.readFloatArray(0,2*t/3,this.vertexBuffer.uvBuffer),t||3!=r?t&&3==r&&(this.planarNormals=this.vertexBuffer.normalBuffer):this.planarNormals=this.vertexBuffer.normalBuffer}};var kt=function(){Lt.call(this)};(kt.prototype=Object.create(Lt.prototype)).constructor=kt;var Vt=function(){Et.call(this)};Vt.prototype=Object.create(Et.prototype),Vt.prototype.constructor=Vt,Vt.prototype.unstream=function(e){if(e.version>=210021710){this.unstreamPrimitive(e);e.readCompressedUInt()}};var _t=function(){Et.call(this),this.fref1=null,this.fref2=null,this.vizEdge=null};_t.prototype=Object.create(Et.prototype),_t.prototype.constructor=_t,_t.prototype.unstream=function(e){if(e.version>=1101410)return this.unstreamPrimitive(e),void(e.getLightDataStreaming()&&(this.vizEdge=new Ni,this.vizEdge.unstream(e),this.vertexBuffer=new $e,this.vertexBuffer.posBuffer=vizEdge.linePos))};var zt=function(){_t.call(this)};zt.prototype=Object.create(_t.prototype),zt.prototype.constructor=zt,zt.prototype.unstream=function(e){if(_t.prototype.unstream.call(this,e),e.readBoolean()){var t=e.readCompressedUInt();t&&e.skip(3*t*4)}};var jt=function(){_t.call(this)};jt.prototype=Object.create(_t.prototype),jt.prototype.constructor=jt,jt.prototype.unstream=function(e){if(_t.prototype.unstream.call(this,e),e.version>=210042830)e.readUnsignedChar()};var Wt=function(){Dt.call(this),this.toSkip=!1};Wt.prototype=Object.create(Dt.prototype),Wt.prototype.constructor=Wt,Wt.prototype.unstream=function(e,r){this.unstreamBBox(e);var i=e.readCompressedInt();if(0==i){var n=e.readCompressedInt();return e.skip(12),e.skip(12*i),e.skip(24),e.skip(12*n),this.toSkip=!0,!1}n=e.readCompressedInt();var s=new Float32Array(3);s[0]=e.readFloat(),s[1]=e.readFloat(),s[2]=e.readFloat();var a=1/Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]),o=new Float32Array(3);o[0]=a*s[0],o[1]=a*s[1],o[2]=a*s[2];for(var p=!0,h=!0,u=new Float32Array(12*i),f=new Float32Array(12*i),d=new Uint32Array(12*(i-1)),c=0,l=0,m=0,v=0;v<i;v++)u[c++]=e.readFloat(),u[c++]=e.readFloat(),u[c++]=e.readFloat();var y=1/i,g=[0,0,0];for(v=0;v<i;v++)g[0]+=y*u[3*v],g[1]+=y*u[3*v+1],g[2]+=y*u[3*v+2];var x=new Float32Array(3);for(v=0;v<3;v++)x[v]=e.readFloat();var B=new Float32Array(3);for(v=0;v<3;v++)B[v]=e.readFloat();if(i>=3){var A=new t.Vector3(x[0],x[1],x[2]),I=new t.Vector3(B[0],B[1],B[2]);A.cross(I);var b=new t.Vector3(u[3]-u[0],u[4]-u[1],u[5]-u[2]),C=new t.Vector3(u[6]-u[0],u[7]-u[1],u[8]-u[2]);if(i>4){var S=Math.trunc(i/4);C=new t.Vector3(u[3*S]-u[0],u[3*S+1]-u[1],u[3*S+2]-u[2])}b.cross(C);var w=b.dot(A);w<0&&(p=!1),C.set(s[0],s[1],s[2]),(w=C.dot(A))<0&&(h=!1)}var P=!(p^h),M=2*Math.PI/i;if(p)for(v=0;v<i;v++){var R=Math.cos(v*M),T=Math.sin(v*M);f[l++]=R*x[0]+T*B[0],f[l++]=R*x[1]+T*B[1],f[l++]=R*x[2]+T*B[2]}else for(v=i;v>0;v--){R=Math.cos(v*M),T=Math.sin(v*M);f[l++]=R*x[0]+T*B[0],f[l++]=R*x[1]+T*B[1],f[l++]=R*x[2]+T*B[2]}for(v=0;v<i;v++)u[c++]=u[3*v]+s[0],u[c++]=u[3*v+1]+s[1],u[c++]=u[3*v+2]+s[2],f[l++]=f[3*v],f[l++]=f[3*v+1],f[l++]=f[3*v+2];if(P){for(v=0;v<i-1;v++)d[m++]=v,d[m++]=v+1,d[m++]=v+i,d[m++]=v+i,d[m++]=v+1,d[m++]=v+1+i;d[m++]=0,d[m++]=i,d[m++]=i-1,d[m++]=2*i-1,d[m++]=i-1,d[m++]=i}else{for(v=0;v<i-1;v++)d[m++]=v+i,d[m++]=v+1+i,d[m++]=v,d[m++]=v,d[m++]=v+1+i,d[m++]=v+1;d[m++]=i,d[m++]=0,d[m++]=2*i-1,d[m++]=i-1,d[m++]=2*i-1,d[m++]=0}var U=c/3;for(v=0;v<i;v++)f[l++]=-o[0],f[l++]=-o[1],f[l++]=-o[2],u[c++]=u[3*v],u[c++]=u[3*v+1],u[c++]=u[3*v+2];if(P)for(v=0;v<i-2;v++)d[m++]=U,d[m++]=U+i-1-v,d[m++]=U+i-2-v;else for(v=0;v<i-2;v++)d[m++]=U,d[m++]=U+i-2-v,d[m++]=U+i-1-v;for(U=c/3,v=0;v<i;v++)f[l++]=o[0],f[l++]=o[1],f[l++]=o[2],u[c++]=u[3*(v+i)],u[c++]=u[3*(v+i)+1],u[c++]=u[3*(v+i)+2];if(P)for(v=0;v<i-2;v++)d[m++]=U,d[m++]=U+i-2-v,d[m++]=U+i-1-v;else for(v=0;v<i-2;v++)d[m++]=U,d[m++]=U+i-1-v,d[m++]=U+i-2-v;return n>0&&e.skip(3*n*4),r?(r.posBuffer=u,r.normalBuffer=f,this.indices=d):(this.vertexBuffer=new $e,this.vertexBuffer.posBuffer=u,this.vertexBuffer.normalBuffer=f,this.primitive=new Ri,this.primitive.indices=d),!0},Wt.prototype.skip=function(e){this.unstreamBBox(e);var t=e.readCompressedInt(),r=e.readCompressedInt();e.skip(12),e.skip(12*t),e.skip(24),e.skip(12*r)};var Ht=function(){Dt.call(this)};Ht.prototype=Object.create(Dt.prototype),Ht.prototype.constructor=Ht,Ht.prototype.unstream=function(e,t){this.unstreamBBox(e);for(var r=e.readCompressedInt(),i=new Float32Array(3*r),n=0;n<3*r;n++)i[n]=e.readFloat();var s=e.readCompressedInt(),a=s*(r+2),o=new Float32Array(3*a);for(n=0;n<s*r*3;n++)o[n]=e.readFloat();var p=new Float32Array(3);for(n=0;n<3;n++)p[n]=e.readFloat();var h=new Float32Array(3);for(n=0;n<3;n++)h[n]=e.readFloat();var u=e.readFloat(),f=s*r*3,d=s*(r+1)*3,c=new Float32Array(3),l=3*s*(r-1);c[0]=u*(o[l]-i[3*(r-1)]),c[1]=u*(o[l+1]-i[3*(r-1)+1]),c[2]=u*(o[l+2]-i[3*(r-1)+2]),c[0],c[0],c[1],c[1],c[2],c[2];n=0;for(var m=3*s-3;n<3*s;n+=3,m-=3)o[f+n]=o[n],o[f+n+1]=o[n+1],o[f+n+2]=o[n+2],o[d+n]=o[f-3*s+m],o[d+n+1]=o[f-3*s+m+1],o[d+n+2]=o[f-3*s+m+2];for(var v,y,g,x=new Float32Array(3*a),B=(n=0,m=s-1,0);n<s*r;n++,m--)v=(o[3*n]-i[3*B])*u,y=(o[3*n+1]-i[3*B+1])*u,g=(o[3*n+2]-i[3*B+2])*u,0==v&&0==y&&0==g?0==B?(x[3*n]=p[0],x[3*n+1]=p[1],x[3*n+2]=p[2]):(x[3*n]=h[0],x[3*n+1]=h[1],x[3*n+2]=h[2]):(x[3*n]=v,x[3*n+1]=y,x[3*n+2]=g),0==m&&(m=s,B++);for(n=0;n<3*s;n+=3)x[f+n]=p[0],x[f+n+1]=p[1],x[f+n+2]=p[2],x[d+n]=h[0],x[d+n+1]=h[1],x[d+n+2]=h[2];var A=0,I=new Uint32Array(6*(r-1)*s+6*(s-2));for(n=1;n<r;n++){for(m=0;m<s-1;m++)I[A++]=m+1+(n-1)*s,I[A++]=m+(n-1)*s,I[A++]=m+n*s,I[A++]=m+1+(n-1)*s,I[A++]=m+n*s,I[A++]=m+1+n*s;I[A++]=n*s,I[A++]=(n-1)*s,I[A++]=n*s-1,I[A++]=n*s-1,I[A++]=(1+n)*s-1,I[A++]=n*s}var b=s*r;for(n=0;n<s-2;n++)I[A++]=b,I[A++]=b+s-2-n,I[A++]=b+s-1-n;b=s*(r+1);for(n=0;n<s-2;n++)I[A++]=b,I[A++]=b+s-2-n,I[A++]=b+s-1-n;var C=e.readCompressedInt();return e.skip(3*C*4),t?(t.posBuffer=o,t.normalBuffer=x,this.indices=I):(this.vertexBuffer=new $e,this.vertexBuffer.posBuffer=o,this.vertexBuffer.normalBuffer=x,this.primitive=new Ri,this.primitive.indices=I),!1},Ht.prototype.skip=function(e){this.unstreamBBox(e);var t=e.readCompressedInt();e.skip(3*t*4);var r=e.readCompressedInt();e.skip(3*r*t*4),e.skip(12),e.skip(12),e.skip(4);var i=e.readCompressedInt();e.skip(3*i*4)};var Xt=function(){Et.call(this),this.noRender=!0,this.primitive=new Ri,this.vertexBuffer=null};Xt.prototype=Object.create(Et.prototype),Xt.prototype.constructor=Xt,Xt.prototype.unstream=function(t){if(this.unstreamPrimitive(t),t.getLightDataStreaming()){this.vertexBuffer||(this.vertexBuffer=new $e),this.primitive.symbol=t.readCompressedInt();var r=this.vertexBuffer.posBuffer.length/3;this.primitive.start=this.primitive.indices.length,this.primitive.connectivity=e.ConnectivityTypeEnum.POINTS;var i=t.readCompressedInt();this.primitive.count=i;for(var n=0;n<i;n++)this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat()),this.primitive.indices.push(r++)}};var Yt=function(){Et.call(this),this.noRender=!0};Yt.prototype=Object.create(Et.prototype),Yt.prototype.constructor=Yt,Yt.prototype.unstream=function(e){this.unstreamPrimitive(e);var t,r=e.readFloat(),i=e.readFloat(),n=e.readFloat(),s=e.readFloat(),a=e.readFloat(),o=e.readFloat(),p=e.readCompressedInt();e.readCompressedInt();if(e.version<210042210){if((t=e.readCompressedInt())>0)e.readStringWithLength()}else(t=e.readUncompressedULong())>0&&e.skip(2*t);this.primitive={origin:[r,i,n],direction:[s,a,o],length:p}};var qt=function(){Et.call(this),this.noRender=!0};qt.prototype=Object.create(Et.prototype),qt.prototype.constructor=qt,qt.prototype.unstream=function(e){if(this.unstreamPrimitive(e),e.getLightDataStreaming()){var t=e.readFloat(),r=e.readFloat(),i=e.readFloat(),n=e.readFloat(),s=e.readFloat(),a=e.readFloat(),o=e.readFloat(),p=e.readFloat(),h=e.readFloat(),u=e.readFloat(),f=0;e.version>=1100910&&(f=e.readUnsignedChar()),this.primitive={origin:[t,r,i],direction1:[n,s,a],direction2:[o,p,h],length:u,mode:f}}};var Qt=function(){Et.call(this),this.noRender=!0};(Qt.prototype=Object.create(Et.prototype)).constructor=Qt,Qt.prototype.unMarshalRP=function(e){var r={},i=e[0];return 0==i>>3&&(r._wireframeMode=!!(4&i),r._labelVisibility=!!(2&i),r._orientationVisibility=!!(1&i),r._frontColor=new t.Color(e[1]/255,e[2]/255,e[3]/255),r._backColor=new t.Color(e[4]/255,e[5]/255,e[6]/255),r._opacity=e[7]),r},Qt.prototype.unstream=function(e){if(this.unstreamPrimitive(e),e.getLightDataStreaming()){var t=!1,r=!1,i=1;1==e.readUnsignedChar()&&(r=!0);var n=e.readFloat(),s=e.readFloat(),a=e.readFloat(),o=e.readFloat(),p=e.readFloat(),h=e.readFloat(),u=e.readFloat(),f=e.readFloat(),d=e.readFloat(),c=e.readFloat(),l=e.readFloat(),m=e.readUncompressedUInt(),v="";if(m){for(var y=[],g=0;g<m;g++)y.push(String.fromCharCode(e.readUnsignedShort()));v=y.join("")}var x=null;if(e.version>=210042460){var B=e.readCompressedUInt(),A=[];if(B&&(e.readBytes(B,A),x=this.unMarshalRP(A)),e.version>=210042725){var I=e.readUnsignedChar();t=1&I,i=(14&I)>>1}else e.version>=210042510&&(t=e.readBit()),e.version>=210042610&&(i=e.readBitIteration(3))}this.primitive={label:v,origin:[n,s,a],direction1:[o,p,h],direction2:[f,d,c],lengthX:u,lengthY:l,refPlaneData:x,mode:r,rangeScale:i,autoSize:t}}};var Zt=function(){Et.call(this),this.noRender=!0};Zt.prototype=Object.create(Et.prototype),Zt.prototype.constructor=Zt,Zt.prototype.unstream=function(e){this.unstreamPrimitive(e);e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readCompressedInt(),e.readCompressedInt();var t=e.readCompressedInt();if(t)e.readString(t)};var Jt=function(){Et.call(this),this.noRender=!0};Jt.prototype=Object.create(Et.prototype),Jt.prototype.constructor=Jt,Jt.prototype.unstream=function(e){this.unstreamPrimitive(e);var t=e.readFloat(),r=e.readFloat(),i=e.readFloat(),n=e.readFloat(),s=e.readFloat(),a=e.readFloat(),o=(e.readCompressedInt(),e.readCompressedInt());if(e.readCompressedInt())e.readStringWithLength();this.primitive={origin:[t,r,i],direction:[n,s,a],length:o}};var Kt=function(){Et.call(this),this.noRender=!0};Kt.prototype=Object.create(Et.prototype),Kt.prototype.constructor=Kt,Kt.prototype.unstream=function(e){this.unstreamPrimitive(e),e.skip(16),e.readCompressedInt(),e.skip(36)};var $t=function(){Et.call(this),this.noRender=!0};$t.prototype=Object.create(Et.prototype),$t.prototype.constructor=$t,$t.prototype.unstream=function(e){this.unstreamPrimitive(e),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readCompressedInt(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat()};var er=function(){Et.call(this),this.vertexBuffer=null,this.primitive=new Ri,this.point=[],this.zoomQuality=0,this.imageGP=!0,this.noRender=!0};er.prototype=Object.create(Et.prototype),er.prototype.constructor=er,er.prototype.unstream=function(t){this.unstreamPrimitive(t);if(t.readUnsignedChar()){var r=(new ke).unstream(t);this.point.push(t.readFloat()),this.point.push(t.readFloat()),this.point.push(t.readFloat());t.readCompressedInt(),t.readCompressedInt(),t.readCompressedInt();if(null==r)return!1;var i=t.textures.add(r),n=r.width,s=r.height;this.vertexBuffer||(this.vertexBuffer=new $e),this.primitive.start=this.primitive.indices.length;var a=this.vertexBuffer.posBuffer.length/3;this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1),this.vertexBuffer.posBuffer.push(n),this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1),this.vertexBuffer.posBuffer.push(n),this.vertexBuffer.posBuffer.push(s),this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1),this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.posBuffer.push(s),this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1),this.primitive.connectivity=e.ConnectivityTypeEnum.TRIANGLES,this.primitive.count=6,this.primitive.indices.push(a),this.primitive.indices.push(a+1),this.primitive.indices.push(a+2),this.primitive.indices.push(a+2),this.primitive.indices.push(a+3),this.primitive.indices.push(a+0),this.vertexBuffer.hasTextures=!0,this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(0);var o={textureId:i,shading:"Basic",primWithMaterials:!0,useAsGas:!0},p={id:t.materials.add(o)};return this.primitive.material=p,!0}return!1};var tr=1,rr=2,ir=14,nr=15,sr=16,ar=17,or=18,pr=19,hr=20,ur=21,fr=22,dr=23,cr=24,lr=25,mr=26,vr=27,yr=28,gr=29,xr=30,Br=31,Ar=32,Ir=function(){Et.call(this),this.vertexBuffer=null,this.primitive=new Ri};Ir.prototype=Object.create(Et.prototype),Ir.prototype.constructor=Ir,Ir.prototype.lineType=null,Ir.prototype.unstream=function(t){this.unstreamPrimitive(t);var r=t.readUnsignedChar(),i=[];t.readFloatArray(0,4,i),this.vertexBuffer||(this.vertexBuffer=new $e),this.primitive.start=this.primitive.indices.length;var n=this.vertexBuffer.posBuffer.length/3;return this.vertexBuffer.posBuffer.push(i[0]),this.vertexBuffer.posBuffer.push(i[1]),this.vertexBuffer.posBuffer.push(t.idOrder),this.vertexBuffer.posBuffer.push(i[2]),this.vertexBuffer.posBuffer.push(i[1]),this.vertexBuffer.posBuffer.push(t.idOrder),this.vertexBuffer.posBuffer.push(i[2]),this.vertexBuffer.posBuffer.push(i[3]),this.vertexBuffer.posBuffer.push(t.idOrder),this.vertexBuffer.posBuffer.push(i[0]),this.vertexBuffer.posBuffer.push(i[3]),this.vertexBuffer.posBuffer.push(t.idOrder),r?(this.primitive.connectivity=e.ConnectivityTypeEnum.TRIANGLES,this.primitive.count=6,this.primitive.indices.push(n),this.primitive.indices.push(n+1),this.primitive.indices.push(n+2),this.primitive.indices.push(n+2),this.primitive.indices.push(n+3),this.primitive.indices.push(n+0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1)):(this.primitive.connectivity=e.ConnectivityTypeEnum.LINES,this.primitive.count=8,this.primitive.indices.push(n),this.primitive.indices.push(n+1),this.primitive.indices.push(n+1),this.primitive.indices.push(n+2),this.primitive.indices.push(n+2),this.primitive.indices.push(n+3),this.primitive.indices.push(n+3),this.primitive.indices.push(n+0)),!0};var br=function(){Et.call(this),this.vertexBuffer=null,this.primitive=new Ri,this.primitives=[]};br.prototype=Object.create(Et.prototype),br.prototype.constructor=br,br.prototype.lineType=null,br.prototype.unstream=function(e){if(this.unstreamPrimitive(e),e.version>1101410){e.readCompressedInt();var r=[];e.readFloatArray(0,2,r);var i=e.readFloat(),n=e.readCompressedInt()}var s=[];e.readFloatArray(0,2,s);var a=new t.Vector2(s[0],s[1]);a.normalize();var o=e.readFloat(),p=i*Math.tan(o);this.vertexBuffer||(this.vertexBuffer=new $e);var h=this.vertexBuffer.posBuffer.length/3;switch(n!==Br&&(this.vertexBuffer.posBuffer.push(r[0]-a.x*i+a.y*p),this.vertexBuffer.posBuffer.push(r[1]-a.y*i-a.x*p),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]),this.vertexBuffer.posBuffer.push(r[1]),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]-a.x*i-a.y*p),this.vertexBuffer.posBuffer.push(r[1]-a.y*i+a.x*p),this.vertexBuffer.posBuffer.push(e.idOrder)),n){case ir:var u=new Ri;this.createPolylineGP(h,u,3,1),this.primitive=u;break;case nr:(u=new Ri).count=0;var f=[0,1,2];this.createPolygonGP(0,u,f,f.length,0,!1),this.primitive=u;break;case sr:case ar:(u=new Ri).count=0;f=[0,1,2];this.createPolygonGP(0,u,f,f.length,0,!0),this.primitive=u;break;case xr:u=new Ri;this.createPolylineGP(h,u,3,1);h=this.vertexBuffer.posBuffer.length/3;this.vertexBuffer.posBuffer.push(r[0]-i*a.x-a.x*i+a.y*p),this.vertexBuffer.posBuffer.push(r[1]-i*a.y-a.y*i-a.x*p),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]-i*a.x),this.vertexBuffer.posBuffer.push(r[1]-i*a.y),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]-i*a.x-a.x*i-a.y*p),this.vertexBuffer.posBuffer.push(r[1]-i*a.y-a.y*i+a.x*p),this.vertexBuffer.posBuffer.push(e.idOrder),this.createPolylineGP(h,u,3,1),this.primitive=u;break;case Ar:(u=new Ri).count=0;f=[0,1,2];this.createPolygonGP(0,u,f,f.length,0,!0);h=this.vertexBuffer.posBuffer.length/3;this.vertexBuffer.posBuffer.push(r[0]-i*a.x-a.x*i+a.y*p),this.vertexBuffer.posBuffer.push(r[1]-i*a.y-a.y*i-a.x*p),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]-i*a.x),this.vertexBuffer.posBuffer.push(r[1]-i*a.y),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]-i*a.x-a.x*i-a.y*p),this.vertexBuffer.posBuffer.push(r[1]-i*a.y-a.y*i+a.x*p),this.vertexBuffer.posBuffer.push(e.idOrder);f=[3,5,4];this.createPolygonGP(0,u,f,f.length,0,!0),this.primitive=u;break;case Br:o=Math.acos(-a.y);o=Math.asin(a.x)<0?-o:o;var d=.5*i,c=17;if($n.sag2D){var l=$n.sag2D,m=Math.PI,v=400;if(d*Math.PI*2<$n.sag2D);else{l>d&&(l=d);var y=Math.acos(1-l/d);v=0==y?400:Math.PI/y+.5}c=Math.floor(m*v*(1/(2*Math.PI))+2.5)}var g=r[0]+d*a.y,x=r[1]-d*a.x,B=new Ri;this.create2DArcCircleGP(this.vertexBuffer,B,g,x,d,o,o+Math.PI,c,!1,e);g=r[0]-d*a.y,x=r[1]+d*a.x;this.create2DArcCircleGP(this.vertexBuffer,B,g,x,d,o+Math.PI,o,c,!1,e),this.primitive=B;break;default:B=new Ri;this.create2DArcCircleGP(this.vertexBuffer,B,r[0],r[1],i/2,0,2*Math.PI,17,!0,e),this.primitive=B}return!0};var Cr=function(){Et.call(this),this.vertexBuffer=null,this.primitive=new Ri,this.primitives=[]};Cr.prototype=Object.create(Et.prototype),Cr.prototype.constructor=Cr,Cr.prototype.lineType=null,Cr.prototype.unstream=function(e){this.unstreamPrimitive(e);e.readCompressedInt();var t=[];e.readFloatArray(0,2,t);var r=e.readFloat(),i=17;if($n.sag2D){var n=r/2,s=$n.sag2D,a=2*Math.PI,o=400;if(n*Math.PI*2<$n.sag2D);else{s>n&&(s=n);var p=Math.acos(1-s/n);o=0==p?400:Math.PI/p+.5}i=Math.floor(a*o*(1/(2*Math.PI))+2.5)}var h=e.readCompressedInt();this.vertexBuffer||(this.vertexBuffer=new $e);var u=this.vertexBuffer.posBuffer.length/3;switch(h){case or:var f=new Ri;this.create2DArcCircleGP(this.vertexBuffer,f,t[0],t[1],r/2,0,2*Math.PI,i,!1,e),this.primitive=f;break;case pr:case yr:f=new Ri;this.create2DArcCircleGP(this.vertexBuffer,f,t[0],t[1],r/2,0,2*Math.PI,i,!1,e),this.primitive=f;break;case hr:f=new Ri;this.create2DArcCircleGP(this.vertexBuffer,f,t[0],t[1],r/2,0,2*Math.PI,i,!0,e),this.primitive=f;break;case ur:f=new Ri;this.create2DArcCircleGP(this.vertexBuffer,f,t[0],t[1],r/2,0,2*Math.PI,i,!0,e);var d=e.materials.add({backgoundColor:!0});f.material={id:d},this.primitives.push(f);var c=new Ri;this.create2DArcCircleGP(this.vertexBuffer,c,t[0],t[1],r/2,0,2*Math.PI,i,!1,e);var l=(g=r/2)*Math.cos(Math.PI/4),m=g*Math.sin(Math.PI/4),v=g*Math.cos(5*Math.PI/4),y=g*Math.sin(5*Math.PI/4);u=this.vertexBuffer.posBuffer.length/3;this.vertexBuffer.posBuffer.push(t[0]+l),this.vertexBuffer.posBuffer.push(t[1]+m),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]+v),this.vertexBuffer.posBuffer.push(t[1]+y),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]-l),this.vertexBuffer.posBuffer.push(t[1]-y),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]-v),this.vertexBuffer.posBuffer.push(t[1]-m),this.vertexBuffer.posBuffer.push(e.idOrder),this.createPolylineGP(u,c,4,0),this.primitives.push(c);break;case fr:case dr:case mr:case vr:var g=r/2;this.vertexBuffer.posBuffer.push(t[0]-g),this.vertexBuffer.posBuffer.push(t[1]-g),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]-g),this.vertexBuffer.posBuffer.push(t[1]+g),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]+g),this.vertexBuffer.posBuffer.push(t[1]+g),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]+g),this.vertexBuffer.posBuffer.push(t[1]-g),this.vertexBuffer.posBuffer.push(e.idOrder);var x=new Ri;x.count=0;var B=[0,1,2,0,2,3];this.createPolygonGP(0,x,B,B.length,0,!0),this.primitive=x;break;case cr:case lr:case gr:g=r/2;this.vertexBuffer.posBuffer.push(t[0]),this.vertexBuffer.posBuffer.push(t[1]+g),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]-g),this.vertexBuffer.posBuffer.push(t[1]-g),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]+g),this.vertexBuffer.posBuffer.push(t[1]-g),this.vertexBuffer.posBuffer.push(e.idOrder);var A=new Ri;A.count=0;B=[0,1,2];this.createPolygonGP(0,A,B,B.length,0,!0),this.primitive=A;break;case tr:case rr:var I=.5*r,b=1,C=0;h==tr&&(C=-(b=Math.PI/4)),b*=I,C*=I,this.vertexBuffer.posBuffer.push(t[0]+b),this.vertexBuffer.posBuffer.push(t[1]+C),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]-b),this.vertexBuffer.posBuffer.push(t[1]-C),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]-C),this.vertexBuffer.posBuffer.push(t[1]+b),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]+C),this.vertexBuffer.posBuffer.push(t[1]-b),this.vertexBuffer.posBuffer.push(e.idOrder);var S=new Ri;this.createPolylineGP(u,S,4,0),this.primitive=S;break;default:f=new Ri;this.create2DArcCircleGP(this.vertexBuffer,f,t[0],t[1],r/2,0,2*Math.PI,i,!0,e),this.primitive=f}return!0};var Sr=function(){Et.call(this),this.vertexBuffer=null,this.primitive=new Ri,this.point=[],this.zoomQuality=2,this.imageGP=!0};Sr.prototype=Object.create(Et.prototype),Sr.prototype.constructor=Sr,Sr.prototype.lineType=null,Sr.prototype.unstream=function(t){this.unstreamPrimitive(t),t.readFloatArray(0,2,this.point),this.point.push(0);t.readCompressedInt(),t.readCompressedInt(),t.readCompressedInt(),t.readCompressedInt();this.zoomQuality=t.readCompressedInt();var r=null;t.readBoolean()&&(r=(new ke).unstream(t));if(null==r)return!1;var i=t.textures.add(r),n=r.width*r.xPixelSize,s=r.height*r.yPixelSize;0==this.zoomQuality&&(n=r.width,s=r.height),this.vertexBuffer||(this.vertexBuffer=new $e),this.primitive.start=this.primitive.indices.length;var a=this.vertexBuffer.posBuffer.length/3;this.vertexBuffer.posBuffer.push(this.point[0]),this.vertexBuffer.posBuffer.push(this.point[1]),this.vertexBuffer.posBuffer.push(t.idOrder),this.vertexBuffer.posBuffer.push(this.point[0]+n),this.vertexBuffer.posBuffer.push(this.point[1]),this.vertexBuffer.posBuffer.push(t.idOrder),this.vertexBuffer.posBuffer.push(this.point[0]+n),this.vertexBuffer.posBuffer.push(this.point[1]+s),this.vertexBuffer.posBuffer.push(t.idOrder),this.vertexBuffer.posBuffer.push(this.point[0]),this.vertexBuffer.posBuffer.push(this.point[1]+s),this.vertexBuffer.posBuffer.push(t.idOrder),this.primitive.connectivity=e.ConnectivityTypeEnum.TRIANGLES,this.primitive.count=6,this.primitive.indices.push(a),this.primitive.indices.push(a+1),this.primitive.indices.push(a+2),this.primitive.indices.push(a+2),this.primitive.indices.push(a+3),this.primitive.indices.push(a+0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(0);var o={textureId:i,shading:"Basic",primWithMaterials:!0,useAsGas:!0},p={id:t.materials.add(o)};return this.primitive.material=p,!0};var wr=function(){Et.call(this),this.vertexBuffer=null,this.primitives=[],this.primitive=new Ri};wr.prototype=Object.create(Et.prototype),wr.prototype.constructor=wr,wr.prototype.lineType=null,wr.prototype.unstream=function(e){return this.skip(e),!1},wr.prototype.skip=function(e){this.unstreamPrimitive(e);e.readFloatArray(0,2,[]),e.readFloatArray(0,2,[]);e.readFloat(),e.readFloat(),e.readFloat(),e.readCompressedInt();e.readFloatArray(0,10,[]),e.readFloatArray(0,2,[]);e.readStringWithLength()};var Pr=function(){Et.call(this),this.vertexBuffer=null,this.primitive=new Ri,this.text=null};Pr.prototype=Object.create(Et.prototype),Pr.prototype.constructor=Pr,Pr.prototype.lineType=null,Pr.prototype.unstream=function(e){this.unstreamPrimitive(e);var t=[];e.readFloatArray(0,2,t);var r=e.readFloat();e.readCompressedInt(),e.readCompressedInt();e.readBoolean()&&e.readGraphicAttributeSet(),e.readBoolean()&&e.readGraphicAttributeSet();var i=e.readCompressedInt();if(i>0){var n="",s=[];e.readShortArray(i,s);for(var a=0;a<i;a++)n+=String.fromCharCode(s[a])}return this.text={text:n,anchor:{x:t[0],y:t[1]},height:r},!1};var Mr=function(){Et.call(this),this.vertexBuffer=null,this.primitive=new Ri,this.nodes=[]};Mr.prototype=Object.create(Et.prototype),Mr.prototype.constructor=Mr,Mr.prototype.lineType=null,Mr.prototype.unstream=function(t){this.unstreamPrimitive(t);var r=t.readCompressedInt(),i=t.readCompressedInt(),n=t.readCompressedInt(),s=t.readCompressedInt(),a=t.readCompressedInt(),o=t.readFloat(),p=t.readFloat(),h=t.readFloat(),u=[];if(r>0&&i>0){var f=[],d=[];t.readFloatArray(0,2*i,f),t.readFloatArray(0,r,this.nodes),t.readFloatArray(0,i,d)}if(n>0){t.readFloatArray(0,2*n,[])}this.vertexBuffer||(this.vertexBuffer=new $e),this.primitive.start=this.primitive.indices.length;var c=this.vertexBuffer.posBuffer.length/3;if(this.primitive.connectivity=e.ConnectivityTypeEnum.LINES,s){t.readFloatArray(0,2*s,u);for(var l=0;l<s;l++)this.primitive.indices.push(c++),this.vertexBuffer.posBuffer.push(u[2*l]),this.vertexBuffer.posBuffer.push(u[2*l+1]),this.vertexBuffer.posBuffer.push(t.idOrder),this.primitive.indices.push(c);return this.primitive.count=2*s-2,!0}var m=p-o;if(0==m)return!1;var v=Math.PI/Math.acos(1-.01/h)*.5+.5;v>100&&(v=100);var y,g,x,B=v+1,A=m/v;x=o;for(var I=!0,b=0;b<v+1;b++){var C,S,w,P;C=0,S=0,w=0,P=0;var M=0;for(l=0;l<i;l++)C+=(P=Math.abs(x-p)<=1e-5&&l==i-1?1:this.computeBSplineBase(l,a,x,1))*f[M]*d[l],S+=P*f[M+1]*d[l],w+=P*d[l],M+=2;w<=1e-15?B--:(y=C/w,g=S/w,this.vertexBuffer.posBuffer.push(y),this.vertexBuffer.posBuffer.push(g),this.vertexBuffer.posBuffer.push(t.idOrder),I||(this.primitive.indices.push(c++),this.primitive.indices.push(c)),I=!1),x=o+(b+1)*A}return B>0&&(this.primitive.count=2*B-2,!0)},Mr.prototype.computeBSplineBase=function(e,t,r,i){var n=0;if(1==t)n=r>=this.nodes[e]&&r<this.nodes[e+1]?1:0;else if(r<this.nodes[e]||r>=this.nodes[e+t])n=0;else{var s=this.computeBSplineBase(e,t-1,r,i),a=this.computeBSplineBase(e+1,t-1,r,i),o=1e-6*i;n=(Math.abs(this.nodes[e]-this.nodes[e+t-1])<=o?0:(r-this.nodes[e])/(this.nodes[e+t-1]-this.nodes[e]))*s+(Math.abs(this.nodes[e+1]-this.nodes[e+t])<=o?0:(this.nodes[e+t]-r)/(this.nodes[e+t]-this.nodes[e+1]))*a}return n};var Rr=function(){Et.call(this),this.vertexBuffer=null,this.primitive=new Ri};Rr.prototype=Object.create(Et.prototype),Rr.prototype.constructor=Rr,Rr.prototype.lineType=null,Rr.prototype.unstream=function(t){this.unstreamPrimitive(t);var r=t.readCompressedInt(),i=[];if(r>0){t.readFloatArray(0,2*r,i),this.vertexBuffer||(this.vertexBuffer=new $e),this.primitive.start=this.primitive.indices.length;var n=this.vertexBuffer.posBuffer.length/3;if(this.primitive.connectivity=e.ConnectivityTypeEnum.LINES,r<4)return!1;var s,a,o,p,h,u,f,d,c,l,m,v,y,g,x=(r-1)%3,B=r-x,A=0;s=i[0],a=i[1];for(var I=2,b=0;b<B-1;b+=3){c=(f=i[I+4])-s+3*(o=i[I])-3*(h=i[I+2]),l=(d=i[I+5])-a+3*(p=i[I+1])-3*(u=i[I+3]),m=3*(h-2*o+s),v=3*(u-2*p+a),y=3*(o-s),g=3*(p-a);var C=Math.sqrt((s-f)*(s-f)+(a-d)*(a-d))/2;A=.01;var S=0;if(C>0&&A>=0&&A<=2*C){var w=Math.acos(1-A/C);w>0&&(S=Math.floor(Math.PI/w*.5+.5))}S<=0&&(S=1),S>100&&(S=100);var P,M,R,T=S+1,U=1/S;P=s,M=a,this.vertexBuffer.posBuffer.push(P),this.vertexBuffer.posBuffer.push(M),this.vertexBuffer.posBuffer.push(t.idOrder),R=U;for(var F=0;F<S;F++)P=c*Math.pow(R,3)+m*Math.pow(R,2)+y*R+s,M=l*Math.pow(R,3)+v*Math.pow(R,2)+g*R+a,this.vertexBuffer.posBuffer.push(P),this.vertexBuffer.posBuffer.push(M),this.vertexBuffer.posBuffer.push(t.idOrder),this.primitive.indices.push(n++),this.primitive.indices.push(n),R+=U;this.primitive.count=2*T-2,s=f,a=d,I+=6}if(x>0)for(b=0;b<x+1;b++)this.vertexBuffer.posBuffer.push(i[2*(B-1+b)]),this.vertexBuffer.posBuffer.push(i[2*(B-1+b)+1]),this.primitive.indices.push(n++),this.primitive.indices.push(n);return this.primitive.count+=2*(x+1),!0}return!1};var Tr=function(){Et.call(this),this.vertexBuffer=null,this.primitive=new Ri,this.primitives=[]};Tr.prototype=Object.create(Et.prototype),Tr.prototype.constructor=Tr,Tr.prototype.lineType=null,Tr.prototype.unstream=function(t){this.unstreamPrimitive(t);var r=t.readCompressedInt(),i=[],n=0;t.readUncompressedIntArray(r,i);for(var s=0;s<r;++s)n+=i[s];var a=0;a=t.version<1101840||t.version>=21e5&&t.version<2100130?n:t.readCompressedInt();var o=[];t.readFloatArray(0,2*a,o),this.vertexBuffer||(this.vertexBuffer=new $e);var p=this.vertexBuffer.posBuffer.length/3;for(s=0;s<a;s++)this.vertexBuffer.posBuffer.push(o[2*s]),this.vertexBuffer.posBuffer.push(o[2*s+1]),this.vertexBuffer.posBuffer.push(t.idOrder);if(t.readCompressedInt()){var h=new Ri;h.cgmId=this.primitive.cgmId,h.start=h.indices.length,h.connectivity=e.ConnectivityTypeEnum.TRIANGLES;var u=t.readCompressedInt(),f=[],d=[],c=0,l=[];t.readUncompressedIntArray(u,f),t.readUncompressedIntArray(u,d);for(s=0;s<u;++s)c+=f[s];t.readUncompressedIntArray(c,l),h.count=0;var m=0;for(s=0;s<u;++s)switch(d[s]){case 0:case 4:h.count+=f[s];for(var v=0;v<f[s];++v)h.indices.push(l[m++]-1);break;case 1:case 5:h.count+=3*(f[s]-2);var y=0;for(v=0;v<f[s]-2;v++)h.indices.push(l[m]-1),h.indices.push(l[m+1+y]-1),h.indices.push(l[m+2-y]-1),m++,y=1-y;m+=2;break;case 2:case 6:h.count+=3*(f[s]-2);var g=l[m]-1;for(v=0;v<f[s]-2;v++)h.indices.push(g),h.indices.push(l[m+2]-1),h.indices.push(l[m+1]-1),m++;m+=2;break;default:return null}return this.primitives.push(h),!0}var x=new Ri;x.cgmId=this.primitive.cgmId,x.start=x.indices.length,x.connectivity=e.ConnectivityTypeEnum.LINES,x.count=2*a-2;for(g=p,s=1;s<a;s++)x.indices.push(p++),x.indices.push(p);return x.indices.push(p),x.indices.push(g),this.primitives.push(x),!0};var Ur=function(){Et.call(this),this.vertexBuffer=null,this.primitive=new Ri,this.text=null,this.noRender=!0,this.isGeometricText=!0};Ur.prototype=Object.create(Et.prototype),Ur.prototype.constructor=Ur,Ur.prototype.lineType=null,Ur.prototype.unstream=function(t){var r=t.readCompressedInt(),i=[];t.readBytes(r,i);for(var n="",s=0;s<i.length;s++)n+=String.fromCharCode(i[s]);var a=n.substring(n.length-5,n.length),o=!0;".font"!==a&&".FONT"!==a||(o=!1);var p=t.readCompressedInt(),h="";for(s=0;s<p;s++)h+=String.fromCharCode(t.readUnsignedShort());t.readUnsignedShort();t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat();var u=t.readShort();t.readFloatArray(0,4,[]);var f=t.readFloat(),d=t.readShort();t.readShort();t.readFloatArray(0,2,[]);t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat();var c=t.readShort();if(t.version>=2100020||t.version>=1101600&&t.version<21e5)t.readCompressedInt();if(t.version>=2100070||t.version>=1101730&&t.version<21e5)t.readCompressedInt();t.readCompressedInt(),t.readCompressedInt();var l=[t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat()];if(t.version>=1101330)t.readFloat();var m=[];if((t.readFloatArray(0,22,m),o&&(t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat()),t.version>=210042530)&&t.readBit()){if(this.vertexBuffer||(this.vertexBuffer=new $e),t.readBit()){var v=0,y=[];(v=t.readCompressedInt())>0&&t.readFloatArray(0,2*v,y);for(s=0;s<v;++s)this.vertexBuffer.posBuffer.push(y[2*s]),this.vertexBuffer.posBuffer.push(y[2*s+1]),this.vertexBuffer.posBuffer.push(0);var g=t.readCompressedInt(),x=[];g>0&&t.readUncompressedIntArray(g,x);for(s=0;s<g;++s)x[s]-=1;var B=[],A=[],I=0;(w=t.readCompressedInt())>0&&(t.readUncompressedIntArray(w,B),t.readUncompressedIntArray(w,A));for(s=0;s<w;s++)switch(this.primitive.connectivity=e.ConnectivityTypeEnum.TRIANGLES,A[s]){case 0:case 4:this.primitive.count+=B[s];for(var b=0;b<B[s];++b)this.primitive.indices.push(x[I++]);break;case 1:case 5:this.primitive.count+=3*(B[s]-2);var C=0;for(b=0;b<B[s]-2;b++)this.primitive.indices.push(x[I]),this.primitive.indices.push(x[I+1+C]),this.primitive.indices.push(x[I+2-C]),I++,C=1-C;I+=2;break;case 2:case 6:this.primitive.count+=3*(B[s]-2);var S=x[I];for(b=0;b<B[s]-2;b++)this.primitive.indices.push(S),this.primitive.indices.push(x[I+2]),this.primitive.indices.push(x[I+1]),I++;I+=2;break;default:return null}}else{v=0,y=[];(v=t.readCompressedInt())>0&&t.readFloatArray(0,2*v,y);for(s=0;s<v;++s)this.vertexBuffer.posBuffer.push(y[2*s]),this.vertexBuffer.posBuffer.push(y[2*s+1]),this.vertexBuffer.posBuffer.push(0);B=[];var w,P=0;(w=t.readCompressedInt())>0&&t.readUncompressedIntArray(w,B);for(s=0;s<w;s++){this.primitive.connectivity=e.ConnectivityTypeEnum.LINES,this.primitive.count+=B[s];for(b=1;b<B[s];++b)this.primitive.indices.push(P++),this.primitive.indices.push(P);P++}}return!0}if($n.processText&&p){var M=t.getStaticMode(),R=t.getCurrentMatrix();this.text={text:h,attachedPoint:M,bbox:l,horJustif:u,verJustification:c,matrix:R,fontName:n,color:null,stroke:!1,path:d,bold:!1,italic:!1,width:m[21],orientationAngle:f}}};var Fr=function(){Et.call(this),this.vertexBuffer=null,this.primitive=new Ri};(Fr.prototype=Object.create(Et.prototype)).constructor=Fr,Fr.prototype.lineType=null,Fr.prototype.unstream=function(e){var t=Gr.prototype.unstream.call(this,e),r=e.readCompressedInt();if(r>0){e.readUncompressedIntArray(r,[])}return t};var Gr=function(){Et.call(this),this.vertexBuffer=null,this.primitive=new Ri};Gr.prototype=Object.create(Et.prototype),Gr.prototype.constructor=Gr,Gr.prototype.lineType=null,Gr.prototype.unstream=function(t){this.unstreamPrimitive(t);var r=t.readUnsignedChar();if(t.version>=1101900&&t.version<21e5||t.version>=2100170){if(0==t.readCompressedInt())return t.readCompressedInt(),t.readCompressedInt(),!1;var i=[];if((c=t.readCompressedInt())>0){var n=[];t.readFloatArray(0,2*c,i)}var s=t.readCompressedInt();this.vertexBuffer||(this.vertexBuffer=new $e),this.primitive.start=this.primitive.indices.length;for(var a=this.vertexBuffer.posBuffer.length/3,o=0;o<c;++o)this.vertexBuffer.posBuffer.push(i[2*o]),this.vertexBuffer.posBuffer.push(i[2*o+1]),this.vertexBuffer.posBuffer.push(t.idOrder);if(s>0){if(4!=r&&3!=r||!$n.withBlankingRep)for(o=0;o<c;++o)this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1);else for(var o=0;o<c;++o)this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0);var p=[],h=[];for(o=0;o<s;++o)p[o]=t.readUncompressedInt();for(o=0;o<s;++o)h[o]=t.readUncompressedInt();var u=0;for(o=0;o<s;o++)u+=h[o];var f=[];for(o=0;o<u;++o)f[o]=t.readUncompressedInt()-1;this.primitive.count=0;var d=a;for(o=0;o<s;++o)d=this.createPolygonGP(d,this.primitive,f,h[o],p[o],!0)}else this.createPolygonGP(a,this.primitive,void 0,c,void 0,!1);return 4!=r&&3!=r||!!$n.withBlankingRep&&r}this.vertexBuffer||(this.vertexBuffer=new $e),this.primitive.connectivity=e.ConnectivityTypeEnum.TRIANGLES,this.primitive.start=this.primitive.indices.length;var c;a=this.vertexBuffer.posBuffer.length/3;if((c=t.readCompressedInt())>0){n=[];t.readFloatArray(0,2*c,n)}if(1==r){if((s=t.readCompressedInt())>0){for(p=[],h=[],o=0;o<s;++o)p[o]=t.readUncompressedInt();for(o=0;o<s;++o)h[o]=t.readUncompressedInt(),0!==p[o]&&4!==p[o]||h[o]/3,1!==p[o]&&5!==p[o]||h[o]-2,2!==p[o]&&6!==p[o]||h[o]-2;var l=0;for(o=0;o<s;o++)l+=h[o];var m=[];for(o=0;o<l;++o)m[o]=t.readUncompressedInt();var v=0;for(o=0;o<s;++o){if(0===p[o]||4===p[o]){l=h[o];for(var y=0;y<l;++y)this.primitive.indices.push(m[v++]-1+a)}if(1===p[o]||5===p[o]){var g=h[o];for(y=2;y<g;++y)y%2?(this.primitive.indices.push(m[v+y]-1+a),this.primitive.indices.push(m[v+y-1]-1+a),this.primitive.indices.push(m[v+y-2]-1+a)):(this.primitive.indices.push(m[v+y-1]-1+a),this.primitive.indices.push(m[v+y]-1+a),this.primitive.indices.push(m[v+y-2]-1+a));v+=g}if(2===p[o]||6===p[o]){var x=h[o];for(y=2;y<x;++y)this.primitive.indices.push(m[v]-1+a),this.primitive.indices.push(m[v+y-1]-1+a),this.primitive.indices.push(m[v+y]-1+a);v+=x}}this.primitive.count=this.primitive.indices.length}for(o=0;o<c;++o)this.vertexBuffer.posBuffer.push(n[2*o]),this.vertexBuffer.posBuffer.push(n[2*o+1]),this.vertexBuffer.posBuffer.push(t.idOrder)}if($n.withBlankingRep&&(4==r||3==r)&&4==c){for(o=0;o<c;++o)this.vertexBuffer.posBuffer.push(n[2*o]),this.vertexBuffer.posBuffer.push(n[2*o+1]),this.vertexBuffer.posBuffer.push(t.idOrder);for(o=0;o<c;++o)this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0);this.primitive.indices.push(0),this.primitive.indices.push(1),this.primitive.indices.push(3),this.primitive.indices.push(3),this.primitive.indices.push(1),this.primitive.indices.push(2),this.primitive.count=6}return 4!=r&&3!=r||!!$n.withBlankingRep&&r};var Or=function(){Et.call(this),this.primitive=new Ri};Or.prototype=Object.create(Et.prototype),Or.prototype.constructor=Or,Or.prototype.lineType=null,Or.prototype.unstream=function(e){this.unstreamPrimitive(e);var t=e.readDouble(),r=e.readDouble(),i=e.readDouble(),n=e.readDouble(),s=e.readDouble(),a=e.readUnsignedChar(),o=e.readCompressedInt(),p=(e.readDouble(),e.readDouble(),17);if($n.sag2D){var h=$n.sag2D,u=s-n,f=400;if(0==o)if(i*Math.PI*2<$n.sag2D);else{h>i&&(h=i);var d=Math.acos(1-h/i);f=0==d?400:Math.PI/d+.5}p=Math.floor(u*f*(1/(2*Math.PI))+2.5)}return this.vertexBuffer||(this.vertexBuffer=new $e),this.create2DArcCircleGP(this.vertexBuffer,this.primitive,t,r,i,n,s,p,a,e),!0};var Nr=function(){Et.call(this),this.vertexBuffer=null,this.primitive=new Ri};Nr.prototype=Object.create(Et.prototype),Nr.prototype.constructor=Nr,Nr.prototype.lineType=null,Nr.prototype.unstream=function(t){this.unstreamPrimitive(t),this.primitive.connectivity=e.ConnectivityTypeEnum.LINES,this.vertexBuffer||(this.vertexBuffer=new $e);var r=this.vertexBuffer.posBuffer.length/3,i=t.readCompressedInt(),n=t.readUnsignedChar(),s=!1;0==n&&1&i&&(i--,s=!0);for(var a=0;a<i;++a)this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.idOrder);if(s&&(t.readFloat(),t.readFloat()),this.createPolylineGP(r,this.primitive,i,n),t.version>=1101850&&t.version<21e5||t.version>=2100170)t.readUnsignedChar();else if(2==i){var o=this.vertexBuffer.posBuffer.length-6;this.vertexBuffer.posBuffer[o],this.vertexBuffer.posBuffer[o+3],this.vertexBuffer.posBuffer[o],this.vertexBuffer.posBuffer[o+3];(this.vertexBuffer.posBuffer[o+1]-this.vertexBuffer.posBuffer[o+4])*(this.vertexBuffer.posBuffer[o+1]-this.vertexBuffer.posBuffer[o+4])}return!0};var Er=function(){Et.call(this),this.vertexBuffer=null,this.primitive=new Ri};Er.prototype=Object.create(Et.prototype),Er.prototype.constructor=Er,Er.prototype.lineType=null,Er.prototype.unstream=function(t){this.unstreamPrimitive(t),this.vertexBuffer||(this.vertexBuffer=new $e),this.primitive.symbol=t.readCompressedInt();var r=this.vertexBuffer.posBuffer.length/3;this.primitive.start=this.primitive.indices.length,this.primitive.connectivity=e.ConnectivityTypeEnum.POINTS;var i=t.readCompressedInt();this.primitive.count=i;for(var n=0;n<i;n++)this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.idOrder),this.primitive.indices.push(r++);return!0};var Dr=function(){Et.call(this),this.vertexBuffer=null,this.primitive=new Ri};Dr.prototype=Object.create(Et.prototype),Dr.prototype.constructor=Dr,Dr.prototype.lineType=null,Dr.prototype.unstream=function(r){this.unstreamPrimitive(r);var i=r.readDouble(),n=r.readDouble(),s=r.readDouble(),a=r.readDouble(),o=r.readDouble(),p=r.readDouble(),h=r.readDouble(),u=r.readUnsignedChar(),f=r.readCompressedInt(),d=r.readDouble(),c=r.readDouble(),l=s>a?s:a;p<o&&(p+=2*Math.PI),o<0&&(o+=2*Math.PI,p+=2*Math.PI);var m=p-o,v=17;if($n.sag2D){var y=$n.sag2D,g=(m=p-o,400);if(0==f)if(l*Math.PI*2<$n.sag2D);else y>l&&(y=l),g=0==(A=Math.acos(1-y/l))?400:Math.PI/A+.5;v=Math.floor(m*g*(1/(2*Math.PI))+2.5)}var x=m/(v-1),B=[];B[0]=d*s,B[1]=c*a,B[2]=r.idOrder;var A=a/s,I=Math.cos(x),b=Math.sin(x),C=0,S=3;for(C=1;C<v;C++)B[S]=I*B[S-3]-b*B[S-2]/A,B[S+1]=b*B[S-3]*A+I*B[S-2],B[S+2]=r.idOrder,S+=3;var w=new t.Matrix4;w.makeRotationZ(h),w.setPosition({x:i,y:n,z:0}),S=0;var P=new t.Vector4;for(C=0;C<v;C++)P.set(B[S],B[S+1],0,1),P.applyMatrix4(w),B[S]=P.x,B[S+1]=P.y,B[S+2]=r.idOrder,S+=3;this.vertexBuffer||(this.vertexBuffer=new $e),this.primitive.start=this.primitive.indices.length;var M=this.vertexBuffer.posBuffer.length/3;if(u){this.primitive.connectivity=e.ConnectivityTypeEnum.TRIANGLES,this.primitive.count=3*(v-2),this.vertexBuffer.posBuffer=B;for(C=1;C<v-1;C++)this.primitive.indices.push(0),this.primitive.indices.push(C),this.primitive.indices.push(C+1)}else{this.primitive.connectivity=e.ConnectivityTypeEnum.LINES,this.primitive.count=2+2*(v-2),this.vertexBuffer.posBuffer=B;for(C=1;C<v;++C)this.primitive.indices.push(M++),this.primitive.indices.push(M)}return!0};var Lr=function(){Et.call(this),this.vertexBuffer=null,this.primitive=new Ri,this.noRender=!0};Lr.prototype=Object.create(Et.prototype),Lr.prototype.constructor=Lr,Lr.prototype.lineType=null,Lr.prototype.unstream=function(t){if(this.unstreamPrimitive(t),t.getLightDataStreaming()){this.primitive.connectivity=e.ConnectivityTypeEnum.LINES,this.vertexBuffer||(this.vertexBuffer=new $e);var r=this.vertexBuffer.posBuffer.length/3;this.primitive.start=this.primitive.indices.length;var i=t.readCompressedInt(),n=t.readCompressedInt();switch(this.primitive.count=i,n){case 0:this.primitive.count=i;for(var s=0;s<i;++s)this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat()),this.primitive.indices.push(r++);break;case 1:this.primitive.count=2+2*(i-2),this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat());for(s=1;s<i;++s)this.primitive.indices.push(r++),this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat()),this.primitive.indices.push(r);break;case 2:this.primitive.count=4+2*(i-2);var a=t.readFloat(),o=t.readFloat(),p=t.readFloat();this.vertexBuffer.posBuffer.push(a),this.vertexBuffer.posBuffer.push(o),this.vertexBuffer.posBuffer.push(p);for(s=1;s<i;++s)this.primitive.indices.push(r++),this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat()),this.primitive.indices.push(r);this.vertexBuffer.posBuffer.push(a),this.vertexBuffer.posBuffer.push(o),this.vertexBuffer.posBuffer.push(p),this.primitive.indices.push(r++),this.primitive.indices.push(r);break;default:return null}if(2==i){var h=this.vertexBuffer.posBuffer.length-6,u=this.vertexBuffer.posBuffer,f=(u[h]-u[h+3])*(u[h]-u[h+3]);f+=(u[h+1]-u[h+4])*(u[h+1]-u[h+4]),(f+=(u[h+2]-u[h+5])*(u[h+2]-u[h+5]))>=1e12&&(this.primitive.noRender=!0)}}},Lr.prototype.skip=function(e){if(this.unstreamPrimitive(e),e.getLightDataStreaming()){var t=e.readCompressedInt();e.readCompressedInt();t>0&&e.skip(3*t*4)}};var kr=function(){Lr.call(this)};kr.prototype=Object.create(Lr.prototype),kr.prototype.constructor=kr;var Vr=0,_r=1,zr=2,jr=1,Wr=2,Hr=4,Xr=8,Yr=16,qr=[],Qr=null,Zr=function(e,t,r){this.newIdx=e,this.normal=t,this.next=r},Jr=function(e,t,r){if(Qr){var i=Qr;return Qr=Qr.next,i.newIdx=e,i.normal=t,i.next=r,i}return new Zr(e,t,r)},Kr=function(e){for(var t=e;t;){var r=t.next;t.next=Qr,Qr=t,t=r}},$r=function(){};$r.prototype.isCulled=function(e,r){var i=r.getCurrentMatrix(),n=new t.Vector3,s=new t.Vector3(1,1,1);if(i&&s.getScaleFromMatrix(i),!e.AABB)return!1;var a=e.AABB.min,o=e.AABB.max;return n.x=(o[0]-a[0])*s.x,n.y=(o[1]-a[1])*s.y,n.z=(o[2]-a[2])*s.z,e._radius=.5*n.length(),r.cullingData.tab.push(e._radius),e._radius<$n.OOCSmartStaticInfo.radius&&($n.OOCSmartStaticInfo.showBBox&&(r.ssbBoxPosition.tab.push(a[0]),r.ssbBoxPosition.tab.push(a[1]),r.ssbBoxPosition.tab.push(a[2]),r.ssbBoxPosition.tab.push(o[0]),r.ssbBoxPosition.tab.push(o[1]),r.ssbBoxPosition.tab.push(o[2])),!0)},$r.prototype.buildRep=function(r,i,n,s,a){var o=$n.keepCompression?a:0,p=$n.keepCompression?s:0,h=r?r.posBuffer:null,u=r?r.uvsBuffer:null,f=r?r.binormalsBuffer:null,d=r?r.tangentsBuffer:null,c=r?r.normalBuffer:null,l=r?r.textureBuffer:null,m=h?h.length/3:0;p&&(m=h?h.length/4:0);var v=c?c.length/3:0;o==e.CATSGPlayRepDataOptions.NormalOct16Compression&&(v=c?c.length/2:0);for(var y=qr.length;y<m;++y)qr[y]=null;var g=new e.Mesh,x=m,B=0,A=i.length,I=0;for(y=0;y<A;y++)I+=i[y].nbIndices;var b=new Uint32Array(I),C=0;for(y=0;y<A;y++){var S=0,w=i[y],P=null==w.material?n.getCurrentMatId():w.material;switch(w.connectivity){case e.ConnectivityTypeEnum.TRIANGLES:S=new e.DrawingGroup(w.gas,P,4,C,w.nbIndices,void 0,void 0,t.GeomTypeEnum[w.geomType]);break;case e.ConnectivityTypeEnum.LINES:S=new e.DrawingGroup(w.gas,P,1,C,w.nbIndices,void 0,void 0,t.GeomTypeEnum[w.geomType]);break;case e.ConnectivityTypeEnum.POINTS:S=new e.DrawingGroup(w.gas,P,0,C,w.nbIndices,void 0,void 0,t.GeomTypeEnum[w.geomType])}B=w.set.length;var M=w.set;if(S._primitives=new Array(B),$n.useGPUPlanarRendering){let e=0;for(let t=0;t<B;t++){const r=M[t];r.planarNormals&&r.planarNormals.length&&(e++,S.numPlanarIndices+=r.indices?r.indices.length:0)}e>0&&e<B&&M.sort(((e,t)=>{const r=e.planarNormals&&e.planarNormals.length>0;return r===(t.planarNormals&&t.planarNormals.length>0)?0:r?1:-1}))}for(var R=0;R<B;R++){var T=C,U=M[R],F=U.indices?U.indices.length:0,G=U.planarNormals;o&&G&&(G=e.compressNormals(G,o));var O=U.planarNormals?U.planarNormals.length:0,N=U.indices;if($n.useGPUPlanarRendering||0===O)F&&(b.set(N,C),C+=F);else{var E=G[0],D=G[1],L=0;o!==e.CATSGPlayRepDataOptions.NormalOct16Compression&&(L=G[2]);for(var k=0;k<F;k++){var V=N[k],_=!1,z=0;if(V<v)if(o==e.CATSGPlayRepDataOptions.NormalOct16Compression){var j=2*V;if(c[j]===E&&c[j+1]===D){b[C++]=V;continue}}else{var W=3*V;if(c[W]===E&&c[W+1]===D&&c[W+2]===L){b[C++]=V;continue}}else if(null===qr[V]){qr[V]=Jr(V,G,null),b[C++]=V;continue}for(var H=qr[V];null!==H;){var X=H.normal;if(o==e.CATSGPlayRepDataOptions.NormalOct16Compression){if(X[0]===E&&X[1]===D){_=!0,z=H.newIdx;break}}else if(X[0]===E&&X[1]===D&&X[2]===L){_=!0,z=H.newIdx;break}H=H.next}_?b[C++]=z:(qr[V]=Jr(x,G,qr[V]),b[C++]=x++)}}var Y=new e.MeshPrimitive(U.cgmId,S,T,F);U.decoration&&(Y.decoration=U.decoration),U.boundingSphere&&(Y.boundingSphere=U.boundingSphere),S._primitives[R]=Y}g.drawingGroups.push(S)}var q=null,Q=null;q=p?new Uint16Array(4*x):new Float32Array(3*x),Q=o==e.CATSGPlayRepDataOptions.NormalOct16Compression?new Float32Array(2*x):new Float32Array(3*x);var Z=null,J=!!r&&r.hasUVs,K=!!r&&r.hasTangentsBinormals,$=!!r&&r.hasTextures;J&&(Z=new Float32Array(3*x));var ee=null;K&&(ee=new Float32Array(3*x));var te=null;K&&(te=new Float32Array(3*x));var re=null;$&&(re=new Float32Array(3*x));var ie=c?c.length:0,ne=h?h.length:0;for(y=0;y<ie;++y)Q[y]=c[y];for(y=0;y<ne;++y)q[y]=h[y];if(J)for(y=0;y<ne;++y)Z[y]=u[y];if(K)for(y=0;y<ne;++y)ee[y]=f[y],te[y]=d[y];if($)for(y=0;y<ne;++y)re[y]=l[y];for(y=0;y<m;++y)for(H=qr[y];null!==H;){var se=3*y,ae=3*H.newIdx;if(p){var oe=4*y,pe=4*H.newIdx;q[pe]=h[oe],q[pe+1]=h[oe+1],q[pe+2]=h[oe+2],q[pe+3]=h[oe+3]}else q[ae]=h[se],q[ae+1]=h[se+1],q[ae+2]=h[se+2];if(o==e.CATSGPlayRepDataOptions.NormalOct16Compression){var he=2*H.newIdx;Q[he]=H.normal[0],Q[he+1]=H.normal[1]}else Q[ae]=H.normal[0],Q[ae+1]=H.normal[1],Q[ae+2]=H.normal[2];J&&(Z[ae]=u[se],Z[ae+1]=u[se+1],Z[ae+2]=u[se+2]),K&&(ee[ae]=f[se],ee[ae+1]=f[se+1],ee[ae+2]=f[se+2],te[ae]=d[se],te[ae+1]=d[se+1],te[ae+2]=d[se+2]),$&&(re[ae]=l[se],re[ae+1]=l[se+1],re[ae+2]=l[se+2]),H=H.next}g.vertexIndexArray=b,g.vertexPositionArray=q,g.vertexNormalArray=Q,g.vertexUvArray=re,g.vertexTangentArray=te,g.vertexBinormalArray=ee,g.vertexCompressedBBox=ee,g.positionCompression=p,g.normalCompression=o;var ue=new t.Color,fe=new t.Color,de=this.rep.repGas,ce=de>>24&255,le=de>>16&255,me=de>>8&255,ve=255&de;ue.setRGB(ce,le,me),fe.setRGB(ce,le,me),g.gas.fill={color:ue,opacity:ve},g.gas.line={color:fe,opacity:ve,lineWidth:1};var ye=[0,0,0],ge=[0,0,0],xe=q;if(this.rep.bbox)g.AABB={min:this.rep.bbox.min,max:this.rep.bbox.max};else{if(ne>=3){var Be,Ae,Ie,be,Ce,Se;Be=Ae=xe[0],Ie=be=xe[1],Ce=Se=xe[2];for(var we=3;we<ne;we+=3){var Pe=xe[we],Me=xe[we+1],Re=xe[we+2];Pe<Be?Be=Pe:Pe>Ae&&(Ae=Pe),Me<Ie?Ie=Me:Me>be&&(be=Me),Re<Ce?Ce=Re:Re>Se&&(Se=Re)}ye=[Be,Ie,Ce],ge=[Ae,be,Se]}g.AABB={min:ye,max:ge}}for(y=0;y<m;y++)Kr(qr[y]),qr[y]=null;return g},$r.prototype.getCompressInfo=function(e,t,r){var i=e.compressedArrayInfo.tab;if(t.vertexPositionArray&&t.vertexPositionArray.length&&t.vertexPositionArray.length>=3){var n=18*t.vertexPositionArray[3],s={x:i[n++],y:i[n++],z:i[n++]},a={x:i[n++],y:i[n++],z:i[n++]};e.addCompressedInfo(s,a,r)}},$r.prototype.compressedBuffers=function(r,i){$n.keepCompression&&this.vertexBuffer&&this.vertexBuffer.positionQuantization&&this.vertexBuffer.compressedInfo&&(r.addCompressedInfo(this.vertexBuffer.compressedInfo.quantizedVector,this.vertexBuffer.compressedInfo.offsetVector,this.vertexBuffer.compressedInfo.currentMatrix),r.compressedArrayInfo.index++);var n=r.getCurrentMatrix();if(!i.positionCompression&&$n.keepCompression&&i.AABB){var s=i.AABB,a=new t.Vector3(s.min[0],s.min[1],s.min[2]),o=new t.Vector3(s.max[0],s.max[1],s.max[2]),p=r.compressedArrayInfo.index++,h=e.compressVertices(i.vertexPositionArray,a,o,p);r.addCompressedInfo(h.quantizedVector,h.offsetVector,n),i.vertexPositionArray=h.buffer,i.positionCompression=e.CATSGPlayRepDataOptions.PositionBoxCompression}i.vertexNormalArray&&!i.normalCompression&&$n.keepCompression&&(i.vertexNormalArray=e.compressNormals(i.vertexNormalArray,e.CATSGPlayRepDataOptions.NormalOct16Compression),i.normalCompression=e.CATSGPlayRepDataOptions.NormalOct16Compression)},$r.prototype.resolvedInheritance=function(r,i){if(i.globalMatrix=r.getCurrentMatrix(),i.axis){i.type=t._InfiniteGeomertryType.AXIS_SYSTEM;var n=r.infiniteGeometries.add(i);return this.node.addBatchInfo(t._InfiniteGeomertryType.AXIS_SYSTEM,n),r.popRepAttribute(),this}if(i.curveVertices){n=r.curvedPipes.add(i);return this.node.addBatchInfo(t._InfiniteGeomertryType.CURVED_PIPE,n),r.popRepAttribute(),this}if(null!=i.canonicalType){i.type=t._InfiniteGeomertryType.CANONICAL;n=r.infiniteGeometries.add(i);return this.node.addBatchInfo(t._InfiniteGeomertryType.CANONICAL,n),r.popRepAttribute(),this}if(i.refPlanes){i.type=t._InfiniteGeomertryType.REF_PLANE;n=r.infiniteGeometries.add(i);return this.node.addBatchInfo(t._InfiniteGeomertryType.REF_PLANE,n),this}if(i.arrows){i.type=t._InfiniteGeomertryType.ARROWS;n=r.infiniteGeometries.add(i);return this.node.addBatchInfo(t._InfiniteGeomertryType.ARROWS,n),this}if(i.voxelRep){i.type=t._InfiniteGeomertryType.VOXEL_REP;n=r.infiniteGeometries.add(i);return this.node.addBatchInfo(t._InfiniteGeomertryType.VOXEL_REP,n),this}if(void 0!==i.splatBuffer){i.type=t._InfiniteGeomertryType.GAUSSIAN_SPLAT_REP;n=r.infiniteGeometries.add(i);return this.node.addBatchInfo(t._InfiniteGeomertryType.GAUSSIAN_SPLAT_REP,n),this}var s=r.getFixedMode(),a=r.getGAS(null,i.rep.layerNumber),o=(a.getType(),a.isHidden()),p=a.isSolid(),h=r.getStaticMode();i.gas=a,this.node.solid=p,$n.withRepBoundingElement&&i.rep instanceof e.SGRep&&(i.rep.boundingSphere=this.boundingSphere),o&&(i.noShow=!0),h&&(i.attachedPoint=h),i._advancedInheritance=r.getCurrentAdvancedInheritance();var u=r.addReps(i,h,a.isNoZ(),this.excludeFromBounding,s);if(u&&(this.renderType=u.renderType,this.repIndice=u.indice,r.multiRefCount>0&&-1==this.multirefRepId)){var f=r.multiRefReps.length;r.multiRefReps.push(i.clone()),this.multirefRepId=f}},$r.prototype.addMesh=function(e){var t=this.build(e);return null==t||$n.OOCSmartStaticInfo&&this.isCulled(t,e)?(e.popRepAttribute(),null):(this.compressedBuffers(e,t),t.rep=this.rep,this.rep.resolvedInheritance(e,t),e.popRepAttribute(),this)};var ei=function(){$r.call(this),this.rep=new ai};(ei.prototype=Object.create($r.prototype)).constructor=ei;var ti=function(){$r.call(this),this.rep=new ii};(ti.prototype=Object.create($r.prototype)).constructor=ti;var ri=function(e){e=e||{},this.repInheritanceMode=void 0!==e.repInheritanceMode?e.repInheritanceMode:0,this.repGAS=void 0!==e.repGAS?e.repGAS:0,this.materialInheritance=void 0!==e.materialInheritance?e.materialInheritance:0,this.material=void 0!==e.material?e.material:{id:-1},this.node=void 0!==e.node?e.node:null,this.boundingSphere=null};ri.prototype.getCompressInfo=function(e,t,r){var i=e.compressedArrayInfo.tab;if(t.vertexPositionArray&&t.vertexPositionArray.length&&t.vertexPositionArray.length>=3){var n=18*t.vertexPositionArray[3],s={x:i[n++],y:i[n++],z:i[n++]},a={x:i[n++],y:i[n++],z:i[n++]};e.addCompressedInfo(s,a,r)}},ri.prototype.resolvedInheritance=function(r,i){if(i.globalMatrix=r.getCurrentMatrix(),i.axis){i.type=t._InfiniteGeomertryType.AXIS_SYSTEM;var n=r.infiniteGeometries.add(i);return this.node.addBatchInfo(t._InfiniteGeomertryType.AXIS_SYSTEM,n),r.popRepAttribute(),this}if(i.curveVertices){n=r.curvedPipes.add(i);return this.node.addBatchInfo(t._InfiniteGeomertryType.CURVED_PIPE,n),r.popRepAttribute(),this}if(null!=i.canonicalType){i.type=t._InfiniteGeomertryType.CANONICAL;n=r.infiniteGeometries.add(i);return this.node.addBatchInfo(t._InfiniteGeomertryType.CANONICAL,n),r.popRepAttribute(),this}if(i.refPlanes){i.type=t._InfiniteGeomertryType.REF_PLANE;n=r.infiniteGeometries.add(i);return this.node.addBatchInfo(t._InfiniteGeomertryType.REF_PLANE,n),this}if(i.arrows){i.type=t._InfiniteGeomertryType.ARROWS;n=r.infiniteGeometries.add(i);return this.node.addBatchInfo(t._InfiniteGeomertryType.ARROWS,n),this}if(i.voxelRep){i.type=t._InfiniteGeomertryType.VOXEL_REP;n=r.infiniteGeometries.add(i);return this.node.addBatchInfo(t._InfiniteGeomertryType.VOXEL_REP,n),this}if(void 0!==i.splatBuffer){i.type=t._InfiniteGeomertryType.GAUSSIAN_SPLAT_REP;n=r.infiniteGeometries.add(i);return this.node.addBatchInfo(t._InfiniteGeomertryType.GAUSSIAN_SPLAT_REP,n),this}var s=r.getFixedMode(),a=r.getGAS(null,i.rep.layerNumber),o=(a.getType(),a.isHidden()),p=a.isSolid(),h=r.getStaticMode();i.gas=a,this.node.solid=p,$n.withRepBoundingElement&&i.rep instanceof e.SGRep&&(i.rep.boundingSphere=this.boundingSphere),o&&(i.noShow=!0),h&&(i.attachedPoint=h),i._advancedInheritance=r.getCurrentAdvancedInheritance();var u=r.addReps(i,h,a.isNoZ(),this.excludeFromBounding,s);if(u&&(this.renderType=u.renderType,this.repIndice=u.indice,r.multiRefCount>0&&-1==this.multirefRepId)){var f=r.multiRefReps.length;r.multiRefReps.push(i.clone()),this.multirefRepId=f}},ri.prototype.unstream=function(e){this.namingContext=0,this.repInheritanceMode=e.readCompressedInt(),e.version>=210042750&&(this.repInheritanceMode=this.repInheritanceMode>>9),this.repGAS=e.readGraphicAttributeSet(),this.repGAS.isHidden()&&(this.node.noShow=!0),e.pushGAS(this.repGAS,this.repInheritanceMode),this.material={id:-1},this.materialInheritance=0;e.readCompressedInt(),e.readCompressedInt();var r=e.readFloat(),i=e.readFloat(),n=e.readFloat(),s=e.readFloat(),a=(i-r)*(i-r)+(s-n)*(s-n);if(a=.5*Math.sqrt(a),this.boundingSphere={radius:a,center:[.5*(i+r),.5*(s+n),0]},e.version>=1101303)e.readFloat();if(e.version>=210042500&&(this.layerNumber=e.readUnsignedShort(),e.addCurrentLayerNumber(this.layerNumber)),e.version>=210042700){var o=e.readUnsignedChar(),p=(248&o)>>3,h=(4&o)>>2,u=3&o;if(this.namingContext=u,this.node.namingContext=this.namingContext,0!=p){var f=t._FilterType.VIEWMODE;this.node.attributes.push({attribute:{viewMode:p,viewModeSensitivity:h},typeAttribute:f}),this.toBatch=!0}}},ri.prototype.childClone=function(){var e=new Array;for(var t in this.children)e[t]="object"==typeof this.children[t]?this.children[t].clone():this.children[t];return e};var ii=function(t){ri.call(this,t=t||{}),this.node=void 0!==t.node?t.node:new e.SGRep,this.repIndice=void 0!==t.repIndice?t.repIndice:-1,this.multirefRepId=void 0!==t.multirefRepId?t.multirefRepId:-1,this.renderType=void 0!==t.renderType?t.renderType:0,this.toBatch=void 0!==t.toBatch&&t.toBatch};ii.prototype=Object.create(ri.prototype),ii.prototype.constructor=ii,ii.prototype.clone=function(){return new ii({advancedInheritance:this.advancedInheritance,layerTable:this.layerTable,layerNumber:this.layerNumber,toBatch:this.toBatch,multirefRepId:this.multirefRepId,repIndice:this.repIndice,renderType:this.renderType,node:this.node,namingContext:this.namingContext,materialInheritance:this.materialInheritance,currentMatId:this.currentMatId,material:this.material,repGAS:this.repGAS,repInheritanceMode:this.repInheritanceMode})};var ni=function(t){ri.call(this,t=t||{}),this.node=void 0!==t.node?t.node:new e.SGBag,this.children=void 0!==t.children?this.childClone(t.children):[]};(ni.prototype=Object.create(ri.prototype)).constructor=ni,ni.prototype.clone=function(){return new ni({advancedInheritance:this.advancedInheritance,layerTable:this.layerTable,layerNumber:this.layerNumber,toBatch:this.toBatch,children:this.childClone(),node:this.node.clone(),materialInheritance:this.materialInheritance,currentMatId:this.currentMatId,material:this.material,repGAS:this.repGAS,repInheritanceMode:this.repInheritanceMode})};var si=function(e){e=e||{},this.repInheritanceMode=void 0!==e.repInheritanceMode?e.repInheritanceMode:0,this.repGAS=void 0!==e.repGAS?e.repGAS:0,this.materialInheritance=void 0!==e.materialInheritance?e.materialInheritance:0,this.material=void 0!==e.material?e.material:{id:-1},this.layer=void 0!==e.layer?e.layer:ie.LAYER_MAX,this.layerNumber=void 0!==e.layerNumber?e.layerNumber:re,this.layerTable=void 0!==e.layerTable?e.layerTable:null,this.node=void 0!==e.node?e.node:null,this.boundingSphere=void 0!==e.boundingSphere?e.boundingSphere:null,this.externalPath=!1,this.toBatch=void 0!==e.toBatch&&e.toBatch,this.bbox=null};si.prototype.getCompressInfo=function(e,t,r){var i=e.compressedArrayInfo.tab;if(t.vertexPositionArray&&t.vertexPositionArray.length&&t.vertexPositionArray.length>=3){var n=18*t.vertexPositionArray[3],s={x:i[n++],y:i[n++],z:i[n++]},a={x:i[n++],y:i[n++],z:i[n++]};e.addCompressedInfo(s,a,r)}},si.prototype.resolvedInheritance=function(r,i){if(i.globalMatrix=r.getCurrentMatrix(),i.axis){i.type=t._InfiniteGeomertryType.AXIS_SYSTEM;var n=r.infiniteGeometries.add(i);return this.node.addBatchInfo(t._InfiniteGeomertryType.AXIS_SYSTEM,n),r.popRepAttribute(),this}if(i.curveVertices){n=r.curvedPipes.add(i);return this.node.addBatchInfo(t._InfiniteGeomertryType.CURVED_PIPE,n),r.popRepAttribute(),this}if(null!=i.canonicalType){i.type=t._InfiniteGeomertryType.CANONICAL;n=r.infiniteGeometries.add(i);return this.node.addBatchInfo(t._InfiniteGeomertryType.CANONICAL,n),r.popRepAttribute(),this}if(i.refPlanes){i.type=t._InfiniteGeomertryType.REF_PLANE;n=r.infiniteGeometries.add(i);return this.node.addBatchInfo(t._InfiniteGeomertryType.REF_PLANE,n),this}if(i.arrows){i.type=t._InfiniteGeomertryType.ARROWS;n=r.infiniteGeometries.add(i);return this.node.addBatchInfo(t._InfiniteGeomertryType.ARROWS,n),this}if(i.voxelRep){i.type=t._InfiniteGeomertryType.VOXEL_REP;n=r.infiniteGeometries.add(i);return this.node.addBatchInfo(t._InfiniteGeomertryType.VOXEL_REP,n),this}if(void 0!==i.splatBuffer){i.type=t._InfiniteGeomertryType.GAUSSIAN_SPLAT_REP;n=r.infiniteGeometries.add(i);return this.node.addBatchInfo(t._InfiniteGeomertryType.GAUSSIAN_SPLAT_REP,n),this}var s=r.getFixedMode(),a=r.getGAS(null,i.rep.layerNumber),o=(a.getType(),a.isHidden()),p=a.isSolid(),h=r.getStaticMode();i.gas=a,this.node.solid=p,$n.withRepBoundingElement&&i.rep instanceof e.SGRep&&(i.rep.boundingSphere=this.boundingSphere),o&&(i.noShow=!0),h&&(i.attachedPoint=h),i._advancedInheritance=r.getCurrentAdvancedInheritance();var u=r.addReps(i,h,a.isNoZ(),this.excludeFromBounding,s);if(u&&(this.renderType=u.renderType,this.repIndice=u.indice,r.multiRefCount>0&&-1==this.multirefRepId)){var f=r.multiRefReps.length;r.multiRefReps.push(i.clone()),this.multirefRepId=f}},si.prototype.unstream=function(r){this.namingContext=0,this.repInheritanceMode=r.readCompressedUInt(),r.version>=210042750&&(this.repInheritanceMode=this.repInheritanceMode>>9),this.repGAS=r.readGraphicAttributeSet(),this.repGAS.isHidden()&&(this.node.noShow=!0),r.pushGAS(this.repGAS,this.repInheritanceMode),this.material={id:-1},this.materialInheritance=0,2==r.readCompressedInt()&&(this.excludeFromBounding=!0);r.readCompressedInt();var i=r.readFloat(),n=(r.readFloat(),r.readFloat()),s=r.readFloat(),a=r.readFloat();(this.boundingSphere={radius:i,center:[n,s,a]},r.version>=210042410)&&(G=r.readBit(),(F===e.CATSGPlayRepDataOptions.QuantBBoxPerGP||F===e.CATSGPlayRepDataOptions.BBoxPerRep||r.version>=210042415&&O==e.CATSGPlayRepDataOptions.PositionBoxCompression)&&G&&(dt.x=r.readFloat(),dt.y=r.readFloat(),dt.z=r.readFloat(),ct.x=r.readFloat(),ct.y=r.readFloat(),ct.z=r.readFloat(),this.bbox={min:[dt.x,dt.y,dt.z],max:[ct.x,ct.y,ct.z]}));if(r.version>1100800)if(this.node.cgmId=r.readUncompressedULong(),this.layerNumber=r.readUnsignedShort(),r.addCurrentLayerNumber(this.layerNumber),r.version>=210042600){var o=r.readUnsignedChar(),p=(248&o)>>3,h=(4&o)>>2,u=3&o;if(this.namingContext=u,this.node.namingContext=this.namingContext,0!=p){var f=t._FilterType.VIEWMODE;this.node.attributes.push({attribute:{viewMode:p,viewModeSensitivity:h},typeAttribute:f}),this.toBatch=!0}}else r.version>1101020&&(this.namingContext=r.readUnsignedChar(),this.node.namingContext=this.namingContext);if(r.readUnsignedChar()){var d=r.materialApplicationUnstream(ie.STREAM_MATERIAL|ie.STREAM_INHERIT_INT);this.material=d.material,this.materialInheritance=d.inheritanceMaterial}if(r.version>=210041800){var c=r.readUnsignedChar();if(c>0){if((d=r.materialApplicationUnstream(ie.STREAM_LAYER_ULONG|ie.STREAM_UVTRANSFO|ie.STREAM_MAPPING_INFO|ie.STREAM_LIGHTMAP)).mapping)(y=r.materials.get([this.material.id]))&&(y.mapping=d.mapping);this.layer=d.layer;var l=r.readCompressedUInt();if(l>0)for(var m=0;m<l;++m){var v=0;2==c&&(v=r.readUnsignedChar());var y,g=ie.STREAM_ALL_ULONG;if(1!=v&&2!=v||(g|=ie.STREAM_DECAL,2==v&&(g&=~ie.STREAM_MATERIAL)),(d=r.materialApplicationUnstream(g)).mapping)(y=r.materials.get([d.material.id]))&&(y.mapping=d.mapping);d.decal?$n.flexibleBatching&&(this.node.attributes.push({typeAttribute:t._FilterType.DECALS,attribute:d.stream()}),this.toBatch=!0):(d.layer<this.layer||d.layer==this.layer&&d.inheritanceMaterial>=this.materialInheritance)&&(this.layer=d.layer,this.material=d.material,this.materialInheritance=d.inheritanceMaterial)}}}if((r.pushMatId(new ce(r.version>=210042800,this.material,this.materialInheritance,this.layer),this),r.version>=210041910)&&r.readUnsignedChar()){let e=[];r.readBytes(6,e)}},si.prototype.childClone=function(){var e=new Array;for(var t in this.children)e[t]="object"==typeof this.children[t]?this.children[t].clone():this.children[t];return e};var ai=function(t){si.call(this,t=t||{}),this.node=void 0!==t.node?t.node:new e.SGRep,this.namingContext=void 0!==t.namingContext?t.namingContext:0,this.repIndice=void 0!==t.repIndice?t.repIndice:-1,this.renderType=void 0!==t.renderType?t.renderType:0,this.multirefRepId=void 0!==t.multirefRepId?t.multirefRepId:-1,this.curvedPipe=void 0!==t.curvedPipe?t.curvedPipe:-1};ai.prototype=Object.create(si.prototype),ai.prototype.constructor=ai,ai.prototype.clone=function(){return new ai({layerTable:this.layerTable,layerNumber:this.layerNumber,toBatch:this.toBatch,multirefRepId:this.multirefRepId,boundingSphere:this.boundingSphere,curvedPipe:this.curvedPipe,renderType:this.renderType,repIndice:this.repIndice,node:this.node,namingContext:this.namingContext,materialInheritance:this.materialInheritance,currentMatId:this.currentMatId,material:this.material,repGAS:this.repGAS.clone(),repInheritanceMode:this.repInheritanceMode})};var oi=function(t){si.call(this,t=t||{}),this.node=void 0!==t.node?t.node:new e.SGBag,this.children=void 0!==t.children?t.children:[]};(oi.prototype=Object.create(si.prototype)).constructor=oi,oi.prototype.clone=function(){return new oi({toBatch:this.toBatch,boundingSphere:this.boundingSphere,children:this.childClone(),node:this.node.clone(),materialInheritance:this.materialInheritance,currentMatId:this.currentMatId,material:this.material,repGAS:this.repGAS.clone(),repInheritanceMode:this.repInheritanceMode})};var pi=function(){ei.call(this),this.primitiveSets=[],this.vertexBuffer=null,this.primitiveAxis=[],this.axisSystems=[],this.refPlane=[],this.arrows=[],this.useTexture=!1,this.hasTangentsBinormals=!1,this.gpList=[],this.imageRep=[]};pi.prototype=Object.create(ei.prototype),pi.prototype.constructor=pi,pi.prototype.checkGP=function(e,t){for(var r=0;r<this.gpList.length;r++)this.mergeGP(this.gpList[r].gp,this.gpList[r].att,e);if(this.primitiveAxis.length){var i=this.primitiveAxis[0].gp.primitive;this.primitiveAxis[0].att.getDisplayedColor();var n=this.primitiveAxis[0].att.getDisplayedColor();this.primitiveAxis[0].gp instanceof qt&&(this.refPlane.push({rep:this.rep.node,origin:i.origin,xAxis:i.direction1,yAxis:i.direction2,noShow:this.primitiveAxis[0].att.isHidden(),color:n,lengthX:i.length,lengthY:i.length,mode:i.mode,zoomable:!!t&&t.mode===ne,type:"CAT3DCustomRep"}),this.primitiveAxis=[]);for(r=0;r<this.primitiveAxis.length;r++){if(this.primitiveAxis[r].gp instanceof Xt||this.primitiveAxis[r].gp instanceof Lr){this.primitiveAxis[r].gp.noRender=!1;var s=this.primitiveAxis[r].gp.vertexBuffer;s&&(this.useTexture=!!s.hasTextures&&s.hasTextures,this.hasTangentsBinormals=!!s.hasTangentsBinormals&&s.hasTangentsBinormals),this.mergeGP(this.primitiveAxis[r].gp,this.primitiveAxis[r].att,e)}if(this.primitiveAxis[r].gp instanceof Yt){i=this.primitiveAxis[r].gp.primitive,n=this.primitiveAxis[r].att.getDisplayedColor();this.arrows.push({infiniteFace:3==e.getSemanticType(),rep:this.rep.node,origin:i.origin,direction:i.direction,noShow:this.primitiveAxis[r].att.isHidden(),color:n,length:i.length,type:"CAT3DCustomRep"})}}}},pi.prototype.addImage=function(e,r,i,n){var s=new $i,a=i.getCurrentMatrix();if(s.rep.repInheritanceMode=n.repInheritanceMode,s.rep.repGAS=n.repGAS,s.rep.materialInheritance=n.materialInheritance,s.rep.repInheritanceMode=n.repInheritanceMode,s.rep.node.noShow=n.node.noShow,s.vertexBuffer=new $e,s.gp=e,e&&e.primitive){if(void 0!==e.zoomQuality&&0===e.zoomQuality&&i.setFixedMode(!0),e.point){var o,p=(new t.Matrix4).setPosition({x:e.point[0],y:e.point[1],z:e.point[2]});o=a?(new t.Matrix4).multiplyMatrices(a,p):p,i.pushStaticMode(o),i.currentMatrix.push(new t.Matrix4)}if(e.primitive.material){var h=new ce(i.version>=210042800,e.primitive.material);h.forceMaterial(),i.pushMatId(h,s.rep)}var u=s.build(i);s.rep.resolvedInheritance(i,u),u.rep=s.rep,i.popStaticMode(),e.point&&(i.currentMatrix.pop(),i.popStaticMode()),e.primitive.material&&i.popMatId(),i.setFixedMode(!1)}return s.rep},pi.prototype.addGP=function(e,t,r,i){if(!e.toSkip)if(e.noRender){if(e.imageGP)return void this.imageRep.push(this.addImage(e,t,r,this.rep));if(this.primitiveAxis.push({gp:e,att:t}),(2==this.rep.namingContext||i)&&7==this.primitiveAxis.length&&this.primitiveAxis[0].gp instanceof Xt&&this.primitiveAxis[1].gp instanceof Yt&&this.primitiveAxis[2].gp instanceof Yt&&this.primitiveAxis[3].gp instanceof Yt&&this.primitiveAxis[4].gp instanceof qt&&this.primitiveAxis[5].gp instanceof qt&&this.primitiveAxis[6].gp instanceof qt){var n=this.primitiveAxis[0].att.getDisplayedColor(),s=[(a=this.primitiveAxis[0].gp.vertexBuffer.posBuffer)[(o=this.primitiveAxis[0].gp.primitive.indices)[0]],a[o[0]+1],a[o[0]+2]];this.axisSystems.push({rep:this.rep.node,origin:s,xAxis:this.primitiveAxis[1].gp.primitive.direction,yAxis:this.primitiveAxis[2].gp.primitive.direction,zAxis:this.primitiveAxis[3].gp.primitive.direction,refPlanes:[this.primitiveAxis[4].gp.primitive,this.primitiveAxis[5].gp.primitive,this.primitiveAxis[6].gp.primitive],color:n,zoomable:!1}),this.primitiveAxis=[]}if((2==this.rep.namingContext||i)&&7==this.primitiveAxis.length&&this.primitiveAxis[0].gp instanceof Xt&&this.primitiveAxis[1].gp instanceof Jt&&this.primitiveAxis[2].gp instanceof Jt&&this.primitiveAxis[3].gp instanceof Jt&&this.primitiveAxis[4].gp instanceof Lr&&this.primitiveAxis[5].gp instanceof Lr&&this.primitiveAxis[6].gp instanceof Lr){var a,o;n=this.primitiveAxis[0].att.getDisplayedColor(),s=[(a=this.primitiveAxis[0].gp.vertexBuffer.posBuffer)[(o=this.primitiveAxis[0].gp.primitive.indices)[0]],a[o[0]+1],a[o[0]+2]];this.axisSystems.push({rep:this.rep.node,origin:s,xAxis:this.primitiveAxis[1].gp.primitive.direction,yAxis:this.primitiveAxis[2].gp.primitive.direction,zAxis:this.primitiveAxis[3].gp.primitive.direction,refPlanes:[this.primitiveAxis[4].gp.vertexBuffer.posBuffer,this.primitiveAxis[5].gp.vertexBuffer.posBuffer,this.primitiveAxis[6].gp.vertexBuffer.posBuffer],color:n,zoomable:!0,length:i.axisLength}),this.primitiveAxis=[]}}else{var p=e.vertexBuffer;p&&(this.useTexture=!!p.hasTextures&&p.hasTextures,this.hasTangentsBinormals=!!p.hasTangentsBinormals&&p.hasTangentsBinormals),this.gpList.push({gp:e,att:t})}},pi.prototype.mergeGP=function(e,t,r){var i=e.primitive,n=void 0;2==this.rep.namingContext&&e instanceof Xt&&(n="FREE_POINT"),e instanceof Lr&&3==r.getSemanticType()&&(n="AXIS_SYSTEM");for(var s=this.primitiveSets.length,a=0;a<s;a++){var o=this.primitiveSets[a];if(o.connectivity==i.connectivity&&o.gas.isEqual(t)&&(null==o.material&&null==i.material||o.material.id==i.material.id&&(void 0===n||o.geomType===n))){o.set.push(i),o.nbIndices+=i.indices.length;break}}if(a==this.primitiveSets.length){var p={};p.connectivity=i.connectivity,p.gas=t,p.material=i.material,p.nbIndices=i.indices.length,p.more_indices=0,p.set=[],n&&(p.geomType=n),p.set.push(i),this.primitiveSets.push(p)}null==this.vertexBuffer&&(this.vertexBuffer=new $e,this.vertexBuffer.hasTextures=this.useTexture,this.vertexBuffer.hasUVs=!1,this.vertexBuffer.hasTangentsBinormals=this.hasTangentsBinormals);for(var h=e.vertexBuffer,u=i.indices,f=this.vertexBuffer.posBuffer.length/3,d=0;d<u.length;d++)u[d]=u[d]+f;for(d=0;d<h.posBuffer.length;d++)this.vertexBuffer.posBuffer.push(h.posBuffer[d]),h.normalBuffer.length?this.vertexBuffer.normalBuffer.push(h.normalBuffer[d]):this.vertexBuffer.normalBuffer.push(0),this.useTexture&&(h.textureBuffer.length?this.vertexBuffer.textureBuffer.push(h.textureBuffer[d]):this.vertexBuffer.textureBuffer.push(0)),this.hasTangentsBinormals&&(h.tangentsBuffer.length?this.vertexBuffer.tangentsBuffer.push(h.tangentsBuffer[d]):this.vertexBuffer.tangentsBuffer.push(0),h.binormalsBuffer.length?this.vertexBuffer.binormalsBuffer.push(h.binormalsBuffer[d]):this.vertexBuffer.binormalsBuffer.push(0))},pi.prototype.build=function(e){if(this.axisSystems.length>0)return{axis:this.axisSystems[0]};if(0==this.primitiveSets.length)return this.arrows&&this.arrows.length>0?{arrows:this.arrows}:this.refPlane&&this.refPlane.length>0?{refPlanes:this.refPlane}:null;var t=this.buildRep(this.vertexBuffer,this.primitiveSets,e);return this.refPlane.length>0&&(t.refPlanes=this.refPlane),this.arrows&&this.arrows.length>0&&(t.arrows=this.arrows),t};var hi=function(){ei.call(this),this.vertexBuffer=null,this.nbLODFaces=0,this.lods=[],this.lodsAttributes=[],this.sag=0,this.sags=[],this.nbSets=0,this.sets=[],this.posInNextStreamer=0};hi.prototype=Object.create(ei.prototype),hi.prototype.constructor=hi,hi.prototype.getSet=function(e){for(var t=[],r=0;r<this.sets.length;r++)if(this.sets[r].geomType==e)for(var i=this.sets[r].primitives,n=0;n<i.length;n++)t.push(i[n]);return t},hi.prototype.unStreamFaces=function(e){if(e.readUnsignedChar()){if(e.version>=2100180)switch(e.readUnsignedChar()){case 2:this.sets[0]=new rt;break;case 3:this.sets[0]=new nt;break;default:this.sets[0]=null}else this.sets[0]=new rt;this.sets[0]&&this.sets[0].unstream(e,this.rep.layerNumber)}},hi.prototype.build=function(t){var r,i,n,s,a,o=null!==this.vertexBuffer,p=(this.rep.repGAS.getType(),[]);if(0==this.nbSets)return null;for(r=0;r<this.nbSets;r++)for(this.sets[r].primitive?(s=1,a=[this.sets[r].primitive]):(s=this.sets[r].primitives.length,a=this.sets[r].primitives),i=0;i<s;i++)if((n=a[i])&&(!n.posBuffer||!$n.keepCompression)){if(n.posBuffer){this.vertexBuffer||(this.vertexBuffer=new $e);for(var h=n.indices,u=this.vertexBuffer.posBuffer.length/3,f=0;f<h.length;f++)h[f]=h[f]+u;for(f=0;f<n.posBuffer.length;f++)this.vertexBuffer.posBuffer.push(n.posBuffer[f]),n.normalBuffer&&n.normalBuffer.length?this.vertexBuffer.normalBuffer.push(n.normalBuffer[f]):this.vertexBuffer.normalBuffer.push(0);this.vertexBuffer.hasTangentsBinormals&&(this.vertexBuffer.tangentsBuffer.push(0),this.vertexBuffer.binormalsBuffer.push(0)),this.vertexBuffer.hasTextures&&this.vertexBuffer.textureBuffer.push(0)}else if(!o)continue;n.indices.length,n.planarNormals&&n.planarNormals.length>0&&n.indices.length;var d=p.length;for(f=0;f<d;f++){var c=p[f];if(c.connectivity==n.connectivity&&c.geomType==this.sets[r].geomType&&c.gas.isEqual(n.gas)&&e.isEqualMaterial(c.material,n.material)){c.set.push(n),c.nbIndices+=n.indices.length;break}}if(f==p.length){var l={};l.connectivity=n.connectivity,l.gas=n.gas,l.geomType=this.sets[r].geomType,l.material=n.material,l.nbIndices=n.indices.length,l.more_indices=0,l.set=[],l.set.push(n),p.push(l)}}return this.vertexBuffer?this.buildRep(this.vertexBuffer,p,t,this.vertexBuffer.positionQuantization,this.vertexBuffer.normalsQuantization):null};var ui=function(){hi.call(this)};ui.prototype=Object.create(hi.prototype),ui.prototype.constructor=ui,ui.prototype.build=function(e){};var fi=function(){ti.call(this),this.gp=[]};fi.prototype=Object.create(ei.prototype),fi.prototype.constructor=fi,fi.prototype.build=function(t){var r=new e.Mesh,i=t.getCurrentMatId(),n=t.getGAS(this.gp.primitive.connectivity,this.rep.layerNumber);this.gp.primitive.symbol&&n.setSymbol(this.gp.primitive.symbol),n.setConnectivity(this.gp.primitive.connectivity);var s=new e.DrawingGroup(n,i,0,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,s,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),s._primitives.push(a),r.drawingGroups.push(s),r.vertexIndexArray=this.gp.primitive.indices,r.vertexPositionArray=this.gp.vertexBuffer.posBuffer,r.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,r.gas=n;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],r.vertexPositionArray.length);if(h>=3){o=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]],p=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]];for(var u=0;u<h;u+=3)r.vertexPositionArray[u]<o[0]&&(o[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]<o[1]&&(o[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]<o[2]&&(o[2]=r.vertexPositionArray[u+2]),r.vertexPositionArray[u]>p[0]&&(p[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]>p[1]&&(p[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]>p[2]&&(p[2]=r.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,r.AABB={min:o,max:p},r};var di=function(){ei.call(this),this.gp=[]};di.prototype=Object.create(ei.prototype),di.prototype.constructor=di,di.prototype.build=function(e){return null};var ci=function(){ei.call(this),this.gp=[]};ci.prototype=Object.create(ei.prototype),ci.prototype.constructor=ci,ci.prototype.build=function(e){return null};var li=function(){ei.call(this),this.gp=[]};li.prototype=Object.create(ei.prototype),li.prototype.constructor=li,li.prototype.build=function(e){return null};var mi=function(){ei.call(this),this.gp=[]};mi.prototype=Object.create(ei.prototype),mi.prototype.constructor=mi,mi.prototype.build=function(e){return null};var vi=function(){ei.call(this),this.gp=[]};vi.prototype=Object.create(ei.prototype),vi.prototype.constructor=vi,vi.prototype.build=function(r){var i=new e.Mesh,n=r.getCurrentMatId(),s=r.getGAS(null,this.rep.layerNumber);this.gp.primitive.symbol&&s.setSymbol(this.gp.primitive.symbol),s.setConnectivity(this.gp.primitive.connectivity);var a=0;3==r.getSemanticType()&&(a=t.GeomTypeEnum.AXIS_SYSTEM);var o=new e.DrawingGroup(s,n,0,0,this.gp.primitive.indices.length,[],null,a),p=new e.MeshPrimitive(this.gp.node.cgmId,o,0,this.gp.primitive.indices.length);this.gp.decoration&&(p.decoration=this.gp.decoration),this.gp.boundingSphere&&(p.boundingSphere=this.gp.boundingSphere),o._primitives.push(p),i.drawingGroups.push(o),i.vertexIndexArray=this.gp.primitive.indices,i.vertexPositionArray=this.gp.vertexBuffer.posBuffer,i.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,i.gas=s;var h=[0,0,0],u=[0,0,0],f=(h=[0,0,0],u=[0,0,0],i.vertexPositionArray.length);if(f>=3){h=[i.vertexPositionArray[0],i.vertexPositionArray[1],i.vertexPositionArray[2]],u=[i.vertexPositionArray[0],i.vertexPositionArray[1],i.vertexPositionArray[2]];for(var d=0;d<f;d+=3)i.vertexPositionArray[d]<h[0]&&(h[0]=i.vertexPositionArray[d]),i.vertexPositionArray[d+1]<h[1]&&(h[1]=i.vertexPositionArray[d+1]),i.vertexPositionArray[d+2]<h[2]&&(h[2]=i.vertexPositionArray[d+2]),i.vertexPositionArray[d]>u[0]&&(u[0]=i.vertexPositionArray[d]),i.vertexPositionArray[d+1]>u[1]&&(u[1]=i.vertexPositionArray[d+1]),i.vertexPositionArray[d+2]>u[2]&&(u[2]=i.vertexPositionArray[d+2])}return h[2]=-.01,u[2]=.01,i.AABB={min:h,max:u},i};var yi=function(){ei.call(this),this.gp=[]};yi.prototype=Object.create(ei.prototype),yi.prototype.constructor=yi,yi.prototype.build=function(t){var r=new e.Mesh,i=t.getCurrentMatId(),n=t.getGAS(this.gp.primitive.connectivity,this.rep.layerNumber);n.setConnectivity(this.gp.primitive.connectivity);var s=new e.DrawingGroup(n,i,this.gp.primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,s,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),s._primitives.push(a),r.drawingGroups.push(s),r.vertexIndexArray=this.gp.primitive.indices,r.vertexPositionArray=this.gp.vertexBuffer.posBuffer,r.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,r.gas=n;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],r.vertexPositionArray.length);if(h>=3){o=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]],p=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]];for(var u=0;u<h;u+=3)r.vertexPositionArray[u]<o[0]&&(o[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]<o[1]&&(o[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]<o[2]&&(o[2]=r.vertexPositionArray[u+2]),r.vertexPositionArray[u]>p[0]&&(p[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]>p[1]&&(p[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]>p[2]&&(p[2]=r.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,r.AABB={min:o,max:p},r};var gi=function(){ei.call(this),this.gp=[]};(gi.prototype=Object.create(ei.prototype)).constructor=gi,gi.prototype.build=function(t){var r=new e.Mesh,i=t.getCurrentMatId(),n=t.getGAS(this.gp.primitive.connectivity,this.rep.layerNumber);n.setConnectivity(this.gp.primitive.connectivity);var s=new e.DrawingGroup(n,i,this.gp.primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,s,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),s._primitives.push(a),r.drawingGroups.push(s),r.vertexIndexArray=this.gp.primitive.indices,r.vertexPositionArray=this.gp.vertexBuffer.posBuffer,r.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,r.gas=n;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],r.vertexPositionArray.length);if(h>=3){o=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]],p=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]];for(var u=0;u<h;u+=3)r.vertexPositionArray[u]<o[0]&&(o[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]<o[1]&&(o[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]<o[2]&&(o[2]=r.vertexPositionArray[u+2]),r.vertexPositionArray[u]>p[0]&&(p[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]>p[1]&&(p[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]>p[2]&&(p[2]=r.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,r.AABB={min:o,max:p},r};var xi=function(){ei.call(this),this.refPlane=[]};xi.prototype=Object.create(ei.prototype),xi.prototype.constructor=xi,xi.prototype.build=function(e){if(this.refPlane)return{refPlanes:this.refPlane}};var Bi=function(){ei.call(this),this.refPlane=[]};(Bi.prototype=Object.create(ei.prototype)).constructor=Bi,Bi.prototype.build=function(e){if(this.refPlane)return{refPlanes:this.refPlane}};var Ai=function(){ei.call(this),this.vertexBuffer=null,this.sets=[]};Ai.prototype=Object.create(ei.prototype),Ai.prototype.constructor=Ai,Ai.prototype.build=function(r){var i=new e.Mesh,n=r.getCurrentMatId(),s=r.getGAS(e.ConnectivityTypeEnum.TRIANGLES,this.rep.layerNumber);s.setConnectivity(e.ConnectivityTypeEnum.TRIANGLES);var a=s.getDisplayedColor();(new t.Color).setRGB(a[0]/255,a[1]/255,a[2]/255);var o=new e.DrawingGroup(s,n,4,0,this.sets[0].indices.length),p=new e.MeshPrimitive(this.sets[0].node.cgmId,o,0,this.sets[0].indices.length);this.sets[0].decoration&&(p.decoration=this.sets[0].decoration),this.sets[0].boundingSphere&&(p.boundingSphere=this.sets[0].boundingSphere),o._primitives.push(p),i.drawingGroups.push(o),i.vertexIndexArray=this.sets[0].indices,i.vertexPositionArray=this.vertexBuffer.posBuffer,i.vertexNormalArray=this.vertexBuffer.normalBuffer,i.gas=s;var h=this.sets[0].boundingBoxCenter,u=this.sets[0].boundingBoxDim,f=[h[0]-u[0],h[1]-u[1],h[2]-u[2]],d=[h[0]+u[0],h[1]+u[1],h[2]+u[2]];if(i.AABB={min:f,max:d},$n.keepCompression){f=[0,0,0],d=[0,0,0];var c=i.vertexPositionArray.length;if(c>=3){f=[i.vertexPositionArray[0],i.vertexPositionArray[1],i.vertexPositionArray[2]],d=[i.vertexPositionArray[0],i.vertexPositionArray[1],i.vertexPositionArray[2]];for(var l=0;l<c;l+=3)i.vertexPositionArray[l]<f[0]&&(f[0]=i.vertexPositionArray[l]),i.vertexPositionArray[l+1]<f[1]&&(f[1]=i.vertexPositionArray[l+1]),i.vertexPositionArray[l+2]<f[2]&&(f[2]=i.vertexPositionArray[l+2]),i.vertexPositionArray[l]>d[0]&&(d[0]=i.vertexPositionArray[l]),i.vertexPositionArray[l+1]>d[1]&&(d[1]=i.vertexPositionArray[l+1]),i.vertexPositionArray[l+2]>d[2]&&(d[2]=i.vertexPositionArray[l+2])}i.AABB={min:f,max:d}}return i};var Ii=function(){ei.call(this),this.sets=[],this.isGPUInstanciable=!0};Ii.prototype=Object.create(ei.prototype),Ii.prototype.constructor=Ii,Ii.prototype.build=function(r){var i=new e.Mesh,n=r.getCurrentMatId(),s=r.getGAS(e.ConnectivityTypeEnum.TRIANGLES,this.rep.layerNumber);s.setConnectivity(e.ConnectivityTypeEnum.TRIANGLES);var a=s.getDisplayedColor();(new t.Color).setRGB(a[0]/255,a[1]/255,a[2]/255);var o=new e.DrawingGroup(s,n,4,0,this.sets[0].indices.length),p=new e.MeshPrimitive(this.sets[0].node.cgmId,o,0,this.sets[0].indices.length);this.sets[0].decoration&&(p.decoration=this.sets[0].decoration),this.sets[0].boundingSphere&&(p.boundingSphere=this.sets[0].boundingSphere),o._primitives.push(p),i.drawingGroups.push(o),i.vertexIndexArray=this.sets[0].indices,i.vertexPositionArray=this.vertexBuffer.posBuffer,i.vertexNormalArray=this.vertexBuffer.normalBuffer,i.gas=s;var h=this.sets[0].boundingBoxCenter,u=this.sets[0].boundingBoxDim,f=[h[0]-u[0],h[1]-u[1],h[2]-u[2]],d=[h[0]+u[0],h[1]+u[1],h[2]+u[2]];if(i.AABB={min:f,max:d},$n.keepCompression){f=[0,0,0],d=[0,0,0];var c=i.vertexPositionArray.length;if(c>=3){f=[i.vertexPositionArray[0],i.vertexPositionArray[1],i.vertexPositionArray[2]],d=[i.vertexPositionArray[0],i.vertexPositionArray[1],i.vertexPositionArray[2]];for(var l=0;l<c;l+=3)i.vertexPositionArray[l]<f[0]&&(f[0]=i.vertexPositionArray[l]),i.vertexPositionArray[l+1]<f[1]&&(f[1]=i.vertexPositionArray[l+1]),i.vertexPositionArray[l+2]<f[2]&&(f[2]=i.vertexPositionArray[l+2]),i.vertexPositionArray[l]>d[0]&&(d[0]=i.vertexPositionArray[l]),i.vertexPositionArray[l+1]>d[1]&&(d[1]=i.vertexPositionArray[l+1]),i.vertexPositionArray[l+2]>d[2]&&(d[2]=i.vertexPositionArray[l+2])}i.AABB={min:f,max:d}}return i};var bi=function(){ei.call(this),this.pointPrimimitivesSets=[],this.edgePrimitivesSets=[],this.vertexBuffer=null,this.indexBuffer=[],this.nbElEdge=0,this.nbElPoints=0,this.nbIndicesTotal=0};bi.prototype=Object.create(ei.prototype),bi.prototype.constructor=bi,bi.prototype.build=function(r){var i=[0,0,0],n=[0,0,0],s=r.getCurrentMatId();if(this.pointPrimimitivesSets.length||this.edgePrimitivesSets.length){var a=new e.Mesh,o=this.vertexBuffer.posBuffer.length;if(o>=3){i=[this.vertexBuffer.posBuffer[0],this.vertexBuffer.posBuffer[1],this.vertexBuffer.posBuffer[2]],n=[this.vertexBuffer.posBuffer[0],this.vertexBuffer.posBuffer[1],this.vertexBuffer.posBuffer[2]],a.vertexPositionArray=new Float32Array(o);for(var p=0;p<o;p+=3)a.vertexPositionArray[p]=this.vertexBuffer.posBuffer[p],a.vertexPositionArray[p+1]=this.vertexBuffer.posBuffer[p+1],a.vertexPositionArray[p+2]=this.vertexBuffer.posBuffer[p+2],a.vertexPositionArray[p]<i[0]&&(i[0]=a.vertexPositionArray[p]),a.vertexPositionArray[p+1]<i[1]&&(i[1]=a.vertexPositionArray[p+1]),a.vertexPositionArray[p+2]<i[2]&&(i[2]=a.vertexPositionArray[p+2]),a.vertexPositionArray[p]>n[0]&&(n[0]=a.vertexPositionArray[p]),a.vertexPositionArray[p+1]>n[1]&&(n[1]=a.vertexPositionArray[p+1]),a.vertexPositionArray[p+2]>n[2]&&(n[2]=a.vertexPositionArray[p+2])}a.AABB={min:i,max:n},a.vertexNormalArray=new Float32Array(o);for(p=0;p<o;p++)a.vertexNormalArray[p]=0;a.vertexIndexArray=new Uint32Array(this.nbIndicesTotal);var h=0;if(this.nbElEdge>0)for(p=0;p<this.edgePrimitivesSets.length;p++){var u=this.edgePrimitivesSets[p],f=new e.DrawingGroup(u.attr,s,1,h,u.nbIndices,void 0,void 0,t.GeomTypeEnum.WIRE_EDGE);a.drawingGroups.push(f);for(var d=u.set,c=0;c<d.length;c++){var l=d[c];f._primitives.push(l);for(var m=0;m<l.count;m++)a.vertexIndexArray[h++]=this.indexBuffer[l.start+m]}}if(this.nbElPoints)for(p=0;p<this.pointPrimimitivesSets.length;p++){u=this.pointPrimimitivesSets[p],f=new e.DrawingGroup(u.attr,s,0,h,u.nbIndices,void 0,void 0,t.GeomTypeEnum.BOUNDARY_POINT);a.drawingGroups.push(f);for(d=u.set,c=0;c<d.length;c++){(l=d[c]).attr=u.attr,f._primitives.push(l);for(m=0;m<l.count;m++)a.vertexIndexArray[h++]=this.indexBuffer[l.start+m]}}return a}return null};var Ci=function(){};Ci.prototype.unstream=function(e){return null};var Si=function(){st.call(this)};Si.prototype=Object.create(st.prototype),Si.prototype.constructor=Si,Si.prototype.unstream=function(e){var t=this.readRepSize(e);e.skip(t-4)};var wi=function(){st.call(this)};wi.prototype=Object.create(st.prototype),wi.prototype.constructor=wi,wi.prototype.unstream=function(e){var t=this.readRepSize(e);t<0&&(t=-t-2),e.skip(t-4)};var Pi={LOD0:0,LOD1:1,LOD2:2,LOD3:3,FACES:4,LSG:5},Mi=["BOUNDARY_EDGE","SHARP_EDGE","SMOOTH_EDGE","BOUNDARY_POINT","SHARP_POINT","SMOOTH_POINT","SURFACIC_POINT","FREE_POINT","WIRE_EDGE","INFINITE_FACE","FACE","EDGE","ISOPAR","UNKNOWN"],Ri=function(){this.indices=[],this.cgmId=-1,this.count=0,this.start=0,this.material=null,this.connectivity=e.ConnectivityTypeEnum.TRIANGLES,this.gas=null,this.decoration=0,this.boundingSphere=null};Ri.prototype.constructor=Ri;var Ti=function(){Ri.call(this),this.planarNormals=null};Ti.prototype=Object.create(Ri.prototype),Ti.prototype.constructor=Ti;var Ui=[],Fi=[],Gi=[];Ti.prototype.unstream=function(e){var t=e.readUnsignedChar(),r=1&t,i=2&t,n=4&t,s=8&t,a=(e.isLightScenegraph(),0);r&&(a=e.readCompressedInt());var o=0;i&&(o=e.readCompressedInt());var p=0;n&&(p=e.readCompressedInt());e.readCompressedInt();s&&(this.planarNormals=new Array(3),e.readFloatArray(0,3,this.planarNormals));var h=a,u=0,f=0;if(e.version>=2100170||e.version>=1101910&&e.version<21e5){for(var d=0;d<o;++d){var c=e.readCompressedInt();Ui[d]=c,f+=c,h+=c-2}for(d=0;d<p;++d){var l=e.readCompressedInt();Fi[d]=l,u+=l,h+=l-2}}else{for(d=0;d<o;++d){c=e.unpackc();Ui[d]=c,f+=c,h+=c-2}for(d=0;d<p;++d){l=e.unpackc();Fi[d]=l,u+=l,h+=l-2}}if(!(h<=0)){this.indices=new Array(3*h);var m=3*a;e.unpackcArray(m,this.indices,0),e.unpackcArray(f+u,Gi,0);var v=0;for(d=0;d<o;++d){c=Ui[d];v+=2;for(var y=2;y<c;++y)y%2?(this.indices[m++]=Gi[v],this.indices[m++]=Gi[v-1],this.indices[m++]=Gi[v-2]):(this.indices[m++]=Gi[v-1],this.indices[m++]=Gi[v],this.indices[m++]=Gi[v-2]),v++}for(d=0;d<p;++d){var g=v;l=Fi[d];v+=2;for(y=2;y<l;++y)this.indices[m++]=Gi[g],this.indices[m++]=Gi[v-1],this.indices[m++]=Gi[v],v++}}};var Oi=function(){};Oi.prototype.unstream=function(e){var t=e.getNumberOfVertices(),r=e.unpackc();e.setNumberOfVertices(r);var i=(new Ti).unstream(e);return e.setNumberOfVertices(t),i};var Ni=function(){Ri.call(this),this.connectivity=e.ConnectivityTypeEnum.LINES};Ni.prototype=Object.create(Ri.prototype),Ni.prototype.constructor=Ni;var Ei=[];Ni.prototype.unstream=function(e){var t=e.readCompressedInt();if(t>0){e.unpackcArray(t,Ei,0);var r=1;if(t>1){this.indices=new Array(2*(t-1));this.indices[0]=Ei[0];for(var i=2;i<t;++i){var n=Ei[i-1];this.indices[r++]=n,this.indices[r++]=n}this.indices[r++]=Ei[t-1]}else this.indices=[]}e.version>=210021300&&e.readBoolean()},Ni.prototype.skip=function(e){var t=e.readCompressedInt();t>0&&e.unpackcArray(t,Ei,0),e.version>=210021300&&e.readBoolean()};var Di=function(){Ri.call(this),this.connectivity=e.ConnectivityTypeEnum.LINES,this.posBuffer=[]};Di.prototype=Object.create(Ri.prototype),Di.prototype.constructor=Di,Di.prototype.unstream=function(e){var t=e.readCompressedInt(),r=e.readCompressedInt(),i=0;if(t)switch(r){case 0:for(var n=0;n<t;++n)this.indices.push(i++),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat());break;case 1:if(t>0){this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat());for(n=1;n<t;++n)this.indices.push(i++),this.indices.push(i),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat())}break;case 2:if(t>0){this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat());for(n=1;n<t;++n)this.indices.push(i++),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat()),this.indices.push(i);this.indices.push(i),this.indices.push(0)}}},Di.prototype.skip=function(e){var t=e.readCompressedInt();e.readCompressedInt();t&&e.skip(4*t*3)};var Li=function(){Ri.call(this),this.connectivity=e.ConnectivityTypeEnum.POINTS,this.posBuffer=null,this.symbol=0};Li.prototype=Object.create(Ri.prototype),Li.prototype.constructor=Li,Li.prototype.skip=function(e){e.readCompressedInt();var t=e.readCompressedInt();e.skip(3*t*4)},Li.prototype.unstream=function(t){this.symbol=t.readCompressedInt(),this.start=this.indices.length,this.connectivity=e.ConnectivityTypeEnum.POINTS;var r=t.readCompressedInt();this.posBuffer=new Array(3*r),t.readFloatArray(0,3*r,this.posBuffer);for(var i=0;i<r;++i)this.indices.push(i)};var ki=function(){Ri.call(this),this.connectivity=e.ConnectivityTypeEnum.TRIANGLES,this.posBuffer=[]};ki.prototype=Object.create(Ri.prototype),ki.prototype.constructor=ki,ki.prototype.unstream=function(e){e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readUnsignedChar()},ki.prototype.skip=function(e){e.skip(40),e.readUnsignedChar()};var Vi=function(e){ot.call(this),this.rep=new oi(e),this.skippable=!1};Vi.prototype=Object.create(ot.prototype),Vi.prototype.constructor=Vi,Vi.prototype.unstream=function(e,t){return t?this.skipBagRep(e):this.unstreamBagRep(e)},Vi.prototype.readMatrix=function(e){return e.readMatrix()},Vi.prototype.readStaticMode=function(e){return null},Vi.prototype.skipToReadStaticMode=function(e){return null},Vi.prototype.readUUID=function(e){e.version>=210021330&&(e.readUnsignedChar()&&($n.withBagUUID?(this.rep.node.uuid_1=e.readUncompressedInt(),this.rep.node.uuid_2=e.readUncompressedInt(),this.rep.node.uuid_3=e.readUncompressedInt(),this.rep.node.uuid_4=e.readUncompressedInt()):e.skip(16)))};var _i=function(e){Vi.call(this),this.sizeComputationMethod=0};_i.prototype=Object.create(Vi.prototype),_i.prototype.constructor=_i,_i.prototype.unstream=function(e,r){this.readRepSize(e);var i=new t.Vector3;if(e.pushReps(),e.setFixedMode(!0),Vi.prototype.unstream.call(this,e,r),e.version<210021340)e.readFloat();else e.readFloat(),e.readFloat();var n=e.readUnsignedChar();1==n&&(i.x=e.readFloat(),i.y=e.readFloat(),i.z=e.readFloat()),e.setFixedMode(!1);var s=e.getAllReps();if(e.mergeWithPreviousReps(),1==n)for(var a=0;a<s.length;a++)s[a].globalMatrix||(s[a].globalMatrix=new t.Matrix4),s[a].globalMatrix.translate(i);return this.rep};var zi=function(e){Vi.call(this),this.sizeComputationMethod=0};zi.prototype=Object.create(Vi.prototype),zi.prototype.constructor=Wi,zi.prototype.unstream=function(e,t){this.readRepSize(e),Vi.prototype.unstream.call(this,e,t);var r=e.readCompressedInt();if(r>0){e.pushReps(),e.pushSceneGraphOrderParameters();for(var i=0;i<r;i++){e.readFloat();var n=e.readClassName(),s=e.getUnstreamer(n).unstream(e,this.rep.node.noShow);if(e.error)return!1;s&&this.rep.children.push(s)}e.popReps(),e.popSceneGraphOrderParameters()}return this.rep};var ji=function(e){st.call(this),this.sizeComputationMethod=0};ji.prototype=Object.create(st.prototype),ji.prototype.constructor=ji,ji.prototype.unstream=function(e,t){var r=new Bi;if(this.readRepSize(e),r.rep.unstream(e),e.readBoolean()){var i=new Qt;i.unstream(e)}var n=e.getGAS(null,r.rep.layerNumber),s=n.getDisplayedColor(),a=i.primitive;return r.refPlane.push({rep:r.rep.node,origin:a.origin,xAxis:a.direction1,yAxis:a.direction2,label:a.label,noShow:n.isHidden(),refPlaneData:a.refPlaneData,color:s,lengthX:a.lengthX,lengthY:a.lengthY,mode:a.mode,zoomable:a.mode===ne,type:"CAT3DReferencePlaneRep"}),t?(e.popRepAttribute(),null):(r.addMesh(e),null)};var Wi=function(e){st.call(this),this.sizeComputationMethod=0,this.rep=new oi(e)};Wi.prototype=Object.create(st.prototype),Wi.prototype.constructor=Wi,Wi.prototype.unstream=function(e,t){this.readRepSize(e),this.rep.unstream(e);var r=e.getLightDataStreaming();e.setLightDataStreaming(!1);var n=e.readCompressedInt();if(n>0){var s=e.readClassName(),a=e.getUnstreamer(s).unstream(e,t);if(e.error)return!1;a&&this.rep.children.push(a);e.readFloat()}if(n>1){for(e.pushReps(),e.pushSceneGraphOrderParameters(),i=1;i<n;i++){s=e.readClassName(),a=e.getUnstreamer(s).unstream(e,t);if(e.error)return!1;a&&this.rep.children.push(a);e.readFloat()}e.popReps(),e.popSceneGraphOrderParameters()}return e.popRepAttribute(),e.setLightDataStreaming(r),this.rep};var Hi=function(e){ot.call(this),this.rep=new oi(e)};Hi.prototype=Object.create(ot.prototype),Hi.prototype.constructor=Hi,Hi.prototype.skipToReadStaticMode=function(e){var t=e.getCurrentPosition();e.pushFakeMultiRepSet(),this.skipChildren(e),this.readStaticMode(e,!0),e.popFakeMultiRepSet(),e.setCurrentPosition(t)},Hi.prototype.unstream=function(e,t){return t?this.skipBagRep(e):this.unstreamBagRep(e)},Hi.prototype.readStaticMode=function(e,r){var i=e.readCompressedInt();if(e.readFloatArray(0,3,[]),1==i&&(r?(e.pushStaticMode(e.popMatrix()),e.currentMatrix.push(new t.Matrix4)):e.popStaticMode()),e.version>=1101500)e.readCompressedInt(),e.readCompressedInt(),e.readCompressedInt()},Hi.prototype.readMatrix=function(e){return e.readMatrix()},Hi.prototype.readUUID=function(e){return null};var Xi=function(e){ot.call(this),this.rep=new ni(e),this.skippable=!1};Xi.prototype=Object.create(ot.prototype),Xi.prototype.constructor=Xi,Xi.prototype.unstream=function(e,t){return t?this.skipBagRep(e):this.unstreamBagRep(e)},Xi.prototype.readStaticMode=function(e){return null},Xi.prototype.skipToReadStaticMode=function(e){return null},Xi.prototype.readMatrix=function(e){return e.read2DMatrix()},Xi.prototype.readUUID=function(e){return null};var Yi=function(){ti.call(this),this.gp=[]};Yi.prototype=Object.create(ti.prototype),Yi.prototype.constructor=Yi,Yi.prototype.build=function(t){var r=new e.Mesh,i=t.getCurrentMatId(),n=t.getGAS(this.gp.primitive.connectivity,this.rep.layerNumber);n.setBasic(!0),n.setConnectivity(this.gp.primitive.connectivity);var s=new e.DrawingGroup(n,i,this.gp.primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,s,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),s._primitives.push(a),r.drawingGroups.push(s),r.vertexIndexArray=this.gp.primitive.indices,r.vertexPositionArray=this.gp.vertexBuffer.posBuffer,r.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,r.gas=n;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],r.vertexPositionArray.length);if(h>=3){o=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]],p=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]];for(var u=0;u<h;u+=3)r.vertexPositionArray[u]<o[0]&&(o[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]<o[1]&&(o[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]<o[2]&&(o[2]=r.vertexPositionArray[u+2]),r.vertexPositionArray[u]>p[0]&&(p[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]>p[1]&&(p[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]>p[2]&&(p[2]=r.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,r.AABB={min:o,max:p},r};var qi=function(){ti.call(this),this.gp=[]};qi.prototype=Object.create(ti.prototype),qi.prototype.constructor=qi,qi.prototype.build=function(t){var r=new e.Mesh,i=t.getCurrentMatId(),n=t.getGAS(this.gp.primitive.connectivity,this.rep.layerNumber);n.setConnectivity(this.gp.primitive.connectivity);var s=new e.DrawingGroup(n,i,this.gp.primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,s,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),s._primitives.push(a),r.drawingGroups.push(s),r.vertexIndexArray=this.gp.primitive.indices,r.vertexPositionArray=this.gp.vertexBuffer.posBuffer,r.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,r.gas=n;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],r.vertexPositionArray.length);if(h>=3){o=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]],p=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]];for(var u=0;u<h;u+=3)r.vertexPositionArray[u]<o[0]&&(o[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]<o[1]&&(o[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]<o[2]&&(o[2]=r.vertexPositionArray[u+2]),r.vertexPositionArray[u]>p[0]&&(p[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]>p[1]&&(p[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]>p[2]&&(p[2]=r.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,r.AABB={min:o,max:p},r};var Qi=function(){ti.call(this),this.gp=[]};Qi.prototype=Object.create(ti.prototype),Qi.prototype.constructor=Qi,Qi.prototype.build=function(t){var r=new e.Mesh,i=t.getCurrentMatId(),n=t.getGAS(this.gp.primitive.connectivity,this.rep.layerNumber);n.setBasic(!0),n.setConnectivity(this.gp.primitive.connectivity);var s=new e.DrawingGroup(n,i,this.gp.primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,s,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),s._primitives.push(a),r.drawingGroups.push(s),r.vertexIndexArray=this.gp.primitive.indices,r.vertexPositionArray=this.gp.vertexBuffer.posBuffer,r.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,r.gas=n;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],r.vertexPositionArray.length);if(h>=3){o=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]],p=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]];for(var u=0;u<h;u+=3)r.vertexPositionArray[u]<o[0]&&(o[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]<o[1]&&(o[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]<o[2]&&(o[2]=r.vertexPositionArray[u+2]),r.vertexPositionArray[u]>p[0]&&(p[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]>p[1]&&(p[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]>p[2]&&(p[2]=r.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,r.AABB={min:o,max:p},r};var Zi=function(){ti.call(this),this.gp=null,this.mat=!1};(Zi.prototype=Object.create(ti.prototype)).constructor=Zi,Zi.prototype.unstream=function(e){if(e.readBoolean()){var t=null;(e.version>=1101860&&e.version<21e5||e.version>=2100170?(t=new Fr).unstream(e):(t=new Gr).unstream(e))&&(this.gp=t)}if(e.readBoolean()){var r=(new We).unstream(e),i=e.materials.add(r);r._MaterialPropertiesActivate;var n=new ce(e.version>=210042800,{id:i});if(n.forceMaterial(),e.pushMatId(n,this.rep),this.mat=!0,r&&void 0!==r.textureId&&this.gp&&this.gp.primitive&&6==this.gp.primitive.count){var s=this.gp.vertexBuffer.textureBuffer;s.push(0),s.push(0),s.push(0),s.push(1),s.push(0),s.push(0),s.push(1),s.push(1),s.push(0),s.push(0),s.push(1),s.push(0)}}};var Ji=function(){ti.call(this),this.gp=[],this.mat=!1};Ji.prototype=Object.create(ti.prototype),Ji.prototype.constructor=Ji,Ji.prototype.unstreamPerforatedPolygon=function(e){if(e.readBoolean()){var t=new Zi;t.unstream(e),t.gp&&(this.gp.push(t.gp),this.mat=t.mat)}},Ji.prototype.build=function(t){var r=new e.Mesh,i=t.getCurrentMatId();this.mat&&t.popMatId();var n=t.getGAS(this.gp[0].primitive.connectivity,this.rep.layerNumber);n.isNoZ()&&n.setBasic(!0),n.setConnectivity(this.gp[0].primitive.connectivity);var s=new e.DrawingGroup(n,i,this.gp[0].primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp[0].primitive.indices.length),a=new e.MeshPrimitive(this.gp[0].node.cgmId,s,0,this.gp[0].primitive.indices.length);this.gp[0].decoration&&(a.decoration=this.gp.decoration),this.gp[0].boundingSphere&&(a.boundingSphere=this.gp[0].boundingSphere),s._primitives.push(a),r.drawingGroups.push(s),r.vertexIndexArray=this.gp[0].primitive.indices,r.vertexPositionArray=this.gp[0].vertexBuffer.posBuffer,r.vertexNormalArray=this.gp[0].vertexBuffer.normalBuffer,r.vertexUvArray=this.gp[0].vertexBuffer.textureBuffer,r.gas=n;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],r.vertexPositionArray.length);if(h>=3){o=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]],p=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]];for(var u=0;u<h;u+=3)r.vertexPositionArray[u]<o[0]&&(o[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]<o[1]&&(o[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]<o[2]&&(o[2]=r.vertexPositionArray[u+2]),r.vertexPositionArray[u]>p[0]&&(p[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]>p[1]&&(p[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]>p[2]&&(p[2]=r.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,r.AABB={min:o,max:p},r};var Ki=function(){ti.call(this),this.gp=[]};Ki.prototype=Object.create(ti.prototype),Ki.prototype.constructor=Ki,Ki.prototype.build=function(t){var r=new e.Mesh,i=t.getCurrentMatId(),n=t.getGAS(this.gp.primitive.connectivity,this.rep.layerNumber);n.setConnectivity(this.gp.primitive.connectivity);var s=new e.DrawingGroup(n,i,this.gp.primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,s,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),s._primitives.push(a),r.drawingGroups.push(s),r.vertexIndexArray=this.gp.primitive.indices,r.vertexPositionArray=this.gp.vertexBuffer.posBuffer,r.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,r.gas=n;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],r.vertexPositionArray.length);if(h>=3){o=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]],p=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]];for(var u=0;u<h;u+=3)r.vertexPositionArray[u]<o[0]&&(o[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]<o[1]&&(o[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]<o[2]&&(o[2]=r.vertexPositionArray[u+2]),r.vertexPositionArray[u]>p[0]&&(p[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]>p[1]&&(p[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]>p[2]&&(p[2]=r.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,r.AABB={min:o,max:p},r};var $i=function(){ei.call(this),this.gp=[]};$i.prototype=Object.create(ei.prototype),$i.prototype.constructor=$i,$i.prototype.build=function(t){var r=new e.Mesh,i=t.getGAS(e.ConnectivityTypeEnum.TRIANGLES,this.rep.layerNumber),n=t.getCurrentMatId();i.setConnectivity(0);var s=new e.DrawingGroup(i,n,4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,s,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),s._primitives.push(a),r.drawingGroups.push(s),r.vertexIndexArray=this.gp.primitive.indices,r.vertexPositionArray=this.gp.vertexBuffer.posBuffer,r.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,r.vertexUvArray=this.gp.vertexBuffer.textureBuffer,r.gas=i;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],r.vertexPositionArray.length);if(h>=3){o=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]],p=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]];for(var u=0;u<h;u+=3)r.vertexPositionArray[u]<o[0]&&(o[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]<o[1]&&(o[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]<o[2]&&(o[2]=r.vertexPositionArray[u+2]),r.vertexPositionArray[u]>p[0]&&(p[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]>p[1]&&(p[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]>p[2]&&(p[2]=r.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,r.AABB={min:o,max:p},r};var en=function(){ti.call(this),this.gp=[]};en.prototype=Object.create(ti.prototype),en.prototype.constructor=en,en.prototype.build=function(t){var r=new e.Mesh,i=t.getGAS(this.gp.primitive.connectivity,this.rep.layerNumber);i.setConnectivity(this.gp.primitive.connectivity);var n=t.getCurrentMatId(),s=new e.DrawingGroup(i,n,4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,s,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),s._primitives.push(a),r.drawingGroups.push(s),r.vertexIndexArray=this.gp.primitive.indices,r.vertexPositionArray=this.gp.vertexBuffer.posBuffer,r.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,r.vertexUvArray=this.gp.vertexBuffer.textureBuffer,r.gas=i;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],r.vertexPositionArray.length);if(h>=3){o=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]],p=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]];for(var u=0;u<h;u+=3)r.vertexPositionArray[u]<o[0]&&(o[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]<o[1]&&(o[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]<o[2]&&(o[2]=r.vertexPositionArray[u+2]),r.vertexPositionArray[u]>p[0]&&(p[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]>p[1]&&(p[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]>p[2]&&(p[2]=r.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,r.AABB={min:o,max:p},r};var tn=function(){ti.call(this),this.gp=[]};tn.prototype=Object.create(ti.prototype),tn.prototype.constructor=tn,tn.prototype.build=function(t){var r=new e.Mesh,i=t.getCurrentMatId(),n=t.getGAS(this.gp.primitive.connectivity,this.rep.layerNumber);n.setBasic(!0),n.setConnectivity(this.gp.primitive.connectivity);var s=new e.DrawingGroup(n,i,this.gp.primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,s,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),s._primitives.push(a),r.drawingGroups.push(s),r.vertexIndexArray=this.gp.primitive.indices,r.vertexPositionArray=this.gp.vertexBuffer.posBuffer,r.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,r.gas=n;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],r.vertexPositionArray.length);if(h>=3){o=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]],p=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]];for(var u=0;u<h;u+=3)r.vertexPositionArray[u]<o[0]&&(o[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]<o[1]&&(o[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]<o[2]&&(o[2]=r.vertexPositionArray[u+2]),r.vertexPositionArray[u]>p[0]&&(p[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]>p[1]&&(p[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]>p[2]&&(p[2]=r.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,r.AABB={min:o,max:p},r};var rn=function(){ti.call(this),this.primitiveSets=[],this.vertexBuffer=null,this.imageRep=[],this.texts=[]};rn.prototype=Object.create(ti.prototype),rn.prototype.constructor=rn,rn.prototype.addGP=function(t,r,i){if(t.imageGP)this.imageRep.push(this.addImage(t,r,i,this.rep));else{null==this.vertexBuffer&&(this.vertexBuffer=new $e);for(var n=this.vertexBuffer.posBuffer.length/3,s=t.vertexBuffer,a=0;a<s.posBuffer.length;a++)this.vertexBuffer.posBuffer.push(s.posBuffer[a]),s.normalBuffer.length?this.vertexBuffer.normalBuffer.push(s.normalBuffer[a]):this.vertexBuffer.normalBuffer.push(void 0);var o=[];if(t.primitives&&t.primitives.length?o=t.primitives:o.push(t.primitive),1==$n.sceneGraphOrder||$n.sceneGraphOrderPriority)for(a=0;a<o.length;a++){var p=o[a];(f={}).connectivity=p.connectivity,f.gas=r,f.material=p.material,f.nbIndices=p.indices.length,f.more_indices=0,f.set=[],f.set.push(p),this.primitiveSets.push(f);for(var h=p.indices,u=0;u<h.length;u++)h[u]=h[u]+n}else for(a=0;a<o.length;a++){p=o[a];var f,d=this.primitiveSets.length;for(u=0;u<d;u++){var c=this.primitiveSets[u];if(c.connectivity==p.connectivity&&c.gas.isEqual(r)&&e.isEqualMaterial(c.material,p.material)){c.set.push(p),c.nbIndices+=p.indices.length;break}}if(u==this.primitiveSets.length)(f={}).connectivity=p.connectivity,f.gas=r,f.material=p.material,f.nbIndices=p.indices.length,f.more_indices=0,f.set=[],f.set.push(p),this.primitiveSets.push(f);for(h=p.indices,u=0;u<h.length;u++)h[u]=h[u]+n}}},rn.prototype.addImage=function(e,r,i,n){var s=new en,a=i.getCurrentMatrix();if(s.rep.repInheritanceMode=n.repInheritanceMode,s.rep.repGAS=n.repGAS,s.rep.materialInheritance=n.materialInheritance,s.rep.repInheritanceMode=n.repInheritanceMode,s.rep.node.noShow=n.node.noShow,s.vertexBuffer=new $e,s.gp=e,e&&e.primitive){if(void 0!==e.zoomQuality&&0===e.zoomQuality&&i.setFixedMode(!0),e.point){var o,p=(new t.Matrix4).setPosition({x:e.point[0],y:e.point[1],z:e.point[2]});o=a?(new t.Matrix4).multiplyMatrices(a,p):p,i.pushStaticMode(o),i.currentMatrix.push(new t.Matrix4)}if(e.primitive.material){var h=new ce(i.version>=210042800,e.primitive.material);h.forceMaterial(),i.pushMatId(h,s.rep)}var u=s.build(i);s.rep.resolvedInheritance(i,u),u.rep=s.rep,i.popStaticMode(),e.point&&(i.currentMatrix.pop(),i.popStaticMode()),e.primitive.material&&i.popMatId(),i.setFixedMode(!1)}return s.rep},rn.prototype.build=function(e){return 0==this.primitiveSets.length?null:this.buildRep(this.vertexBuffer,this.primitiveSets,e)};var nn=function(){Vi.call(this),this.skippable=!0};nn.prototype=Object.create(Vi.prototype),nn.prototype.constructor=nn,nn.prototype.unstream=function(e){this.readRepSize(e);var t=Vi.prototype.unstream.call(this,e);e.readFloat();return t};var sn=function(){Vi.call(this),this.skippable=!0};sn.prototype=Object.create(Vi.prototype),sn.prototype.constructor=sn,sn.prototype.unstream=function(e){var t=e.getCurrentPosition(),r=t+this.readRepSize(e);e.setCurrentPosition(r);var i=e.readUnsignedChar();e.setSemanticType(i),e.setCurrentPosition(t),this.readRepSize(e);var n=Vi.prototype.unstream.call(this,e);e.readUnsignedChar();return n};var an=function(e){Xi.call(this),this.sizeComputationMethod=0};an.prototype=Object.create(Xi.prototype),an.prototype.constructor=an,an.prototype.unstream=function(e,r){this.readRepSize(e),e.pushReps(),e.setFixedMode(!0),Xi.prototype.unstream.call(this,e,r);e.readFloat();var i=e.readUnsignedChar(),n=new t.Vector3;1==i&&(n.x=e.readFloat(),n.y=e.readFloat()),e.setFixedMode(!1);var s=e.getAllReps();if(e.mergeWithPreviousReps(),1==i)for(var a=0;a<s.length;a++)s[a].globalMatrix||(s[a].globalMatrix=new t.Matrix4),s[a].globalMatrix.translate(n);return this.rep};var on=function(){Xi.call(this),this.skippable=!0};on.prototype=Object.create(Xi.prototype),on.prototype.constructor=on,on.prototype.unstream=function(e,t){this.readRepSize(e);var r=Xi.prototype.unstream.call(this,e,t),i=(e.readCompressedInt(),e.readCompressedInt());return(i=Math.abs(i))>0&&e.skip(4*(2*i+1)),r};var pn=function(){Vi.call(this),this.skippable=!0};pn.prototype=Object.create(Vi.prototype),pn.prototype.constructor=pn,pn.prototype.unstream=function(e){var r=this.readRepSize(e),i=[],n=e.getCurrentPosition()+r-4,s=0,a=(e.getCurrentMatrix(),null);$n.flexibleBatching&&(this.rep.filterBagRep=!0),e.version<210042735&&(a=Vi.prototype.unstream.call(this,e));for(var o=e.readCompressedInt(),p=0;p<o;p++){switch(e.readUnsignedChar()){case f:if(e.version>=210042600){var h=[r=e.readUncompressedULong()];for(e.readCompressedInt(),p=0;p<r;++p){var m=e.readCompressedInt(),v=m>>24&15,y=m>>16&15,g=m>>8&15,x=new t.Color;x.setRGB(v/255,y/255,g/255);var B=m>>7&7,A=1&m,I=e.readFloat(),b=e.readUnsignedShort(),C=e.readUnsignedChar();h[p]=new ve(x,B,A,I,b,C)}e.version>=u&&(e.pushLayerTable(h),this.rep.layerTables=h,s++)}break;case d:var S=e.readCompressedInt();if(S>0){var w=[],P=[],M=[];e.readFloatArray(0,3*S,P),e.readFloatArray(0,3*S,M),e.readUncompressedIntArray(S,w);var R={flags:w,points:P,normals:M},T=t._FilterType.CLIPPINGFILTER;i.push({attribute:R,typeAttribute:T}),!0}break;case c:if(e.readBoolean())e.readGraphicAttributeSet();if(e.readBoolean())e.readMatrix();var U=[];if(e.version>=210021610){var F=e.readCompressedInt();if(F>0)e.readFloatArray(0,F,U);else{var G=e.readCompressedInt();G>0&&(e.readFloatArray(1,F,U),U[1]<0?U[0]=-1:U[0]=1,U[1]=G)}}T=t._FilterType.SCISSORFILTER;U.length&&(i.push({attribute:U,typeAttribute:T}),!0);break;case l:e.readBytes(1024,[]);e.readCompressedInt()}}if(s)for(var O=0;O<s;O++)e.popLayerTable();return e.version>=210042735&&(a=Vi.prototype.unstream.call(this,e)),i.length&&(a.node.attributes=i),e.setCurrentPosition(n),$n.flexibleBatching&&e.popFlexibleBatchingContext(a),a};var hn=function(){Xi.call(this)};hn.prototype=Object.create(Xi.prototype),hn.prototype.constructor=hn,hn.prototype.unstream=function(e,r){$n.flexibleBatching&&(this.rep.filterBagRep=!0);var i=0,n=null,s=[];e.version<210042735&&(n=Xi.prototype.unstream.call(this,e,r));for(var a=e.readCompressedInt(),o=0;o<a;o++){switch(e.readUnsignedChar()){case f:if(e.version>=210042600){var p=e.readUncompressedULong(),h=[p];for(e.readCompressedInt(),o=0;o<p;++o){var m=e.readCompressedInt(),v=m>>24&15,y=m>>16&15,g=m>>8&15,x=new t.Color;x.setRGB(v/255,y/255,g/255);var B=m>>7&7,A=1&m,I=e.readFloat(),b=e.readUnsignedShort(),C=e.readUnsignedChar();h[o]=new ve(x,B,A,I,b,C)}e.version>=u&&(e.pushLayerTable(h),this.rep.layerTables=h,i++)}break;case d:var S=e.readCompressedInt();if(S>0){var w=[],P=[],M=[];e.readFloatArray(0,S,P),e.readFloatArray(0,S,M),e.readUncompressedIntArray(S,w);var R={flags:w,points:P,normals:M},T=2;s.push({attribute:R,typeAttribute:T}),!0}break;case c:if(e.readBoolean())e.readGraphicAttributeSet();if(e.readBoolean())e.readMatrix();var U=[];if(e.version>=210021610){var F=e.readCompressedInt();if(F>0)e.readFloatArray(0,F,U);else{var G=e.readCompressedInt();G>0&&(e.readFloatArray(1,F,U),U[1]<0?U[0]=-1:U[0]=1,U[1]=G)}}T=1;U.length&&(s.push({attribute:U,typeAttribute:T}),!0);break;case l:e.readBytes(1024,[]);e.readCompressedInt()}}if(i)for(var O=0;O<i;O++)e.popLayerTable();return e.version>=210042735&&(n=Xi.prototype.unstream.call(this,e,r)),s&&(n.node.attributes=s),!r&&$n.flexibleBatching&&e.popFlexibleBatchingContext(n),n};var un=function(){Vi.call(this),this.sizeComputationMethod=0};un.prototype=Object.create(Vi.prototype),un.prototype.constructor=un,un.prototype.unstream=function(e,t){this.readRepSize(e);var r=Vi.prototype.unstream.call(this,e,t);e.readUnsignedChar();e.version>=210042740&&(e.readFloat(),e.readFloat(),e.readFloat());return r};var fn=function(){dn.call(this)};fn.prototype=Object.create(Xi.prototype),fn.prototype.constructor=dn,fn.prototype.readLayerTables=function(e){var r=e.getCurrentPosition();dn.prototype.unstream.call(this,e,!0);if(1==e.readUnsignedChar()&&e.version>=210042600){for(var i=[],n=e.readUncompressedULong(),s=(i=[n],0);s<n;++s){var a=e.readCompressedInt(),o=a>>24&15,p=a>>16&15,h=a>>8&15,f=new t.Color;f.setRGB(o/255,p/255,h/255);var d=a>>7&7,c=1&a,l=e.readFloat(),m=e.readUnsignedShort(),v=e.readUnsignedChar();i[s]=new ve(f,d,c,l,m,v)}e.version>=u&&(e.pushLayerTable(i),this.rep.layerTables=i)}e.setCurrentPosition(r)},fn.prototype.unstream=function(e,t){this.rep.toBatch=!0,this.readLayerTables(e);var r=dn.prototype.unstream.call(this,e,t);if(1==e.readUnsignedChar()&&e.version>=210042600){for(var i=e.readUncompressedULong(),n=0;n<i;++n)e.readCompressedInt(),e.readFloat(),e.readUnsignedShort(),e.readUnsignedChar();i&&e.popLayerTable()}return r};var dn=function(){Xi.call(this),this.sizeComputationMethod=0};dn.prototype=Object.create(Xi.prototype),dn.prototype.constructor=dn,dn.prototype.unstream=function(e,t){var r=this.readRepSize(e),i=t;i||(i=this.isUUIDToSkip(e,r));var n=Xi.prototype.unstream.call(this,e,i);return e.readBytes(16,[]),n};var cn=function(){Xi.call(this)};cn.prototype=Object.create(Xi.prototype),cn.prototype.constructor=cn,cn.prototype.skipToReadAdvancedInheritance=function(e,t){var r=e.getCurrentPosition(),i=(Xi.prototype.unstream.call(this,e,!0),e.readUnsignedChar(),e.readUnsignedChar()),n=e.readUnsignedShort(),s=e.readFloat();return e.setCurrentPosition(r),new me(i,n,s)},cn.prototype.unstream=function(e,t){t||(this.rep.advancedInheritance=this.skipToReadAdvancedInheritance(e),e.setAdvancedInheritance(this.rep.advancedInheritance));var r=Xi.prototype.unstream.call(this,e,t);e.readUnsignedChar(),e.readUnsignedChar(),e.readUnsignedShort(),e.readFloat();return t||e.advancedInheritanceArray.pop(),r};var ln=function(){pn.call(this)};ln.prototype=Object.create(pn.prototype),ln.prototype.constructor=ln,ln.prototype.unstream=function(e){e.getCurrentPosition();this.readRepSize(e);var t=pn.prototype.unstream.call(this,e);return e.readFloat(),t};var mn=function(){Vi.call(this),this.sizeComputationMethod=0};mn.prototype=Object.create(Vi.prototype),mn.prototype.constructor=mn,mn.prototype.applyTextureMatrix=function(r,i,n){if(i.node instanceof e.SGBag)for(o=0;o<i.children.length;o++)this.applyTextureMatrix(r,i.children[o],n);else{var s=r.getReps(i.repIndice,i.renderType).vertexUvArray,a=s?s.length/3:0;if(a>0)for(var o=0,p=0,h=new t.Vector4,o=0;o<a;o++,p+=3)h.set(s[p],s[p+1],s[p+2],1),h.applyMatrix4(n),s[p]=h.x/h.w,s[p+1]=h.y/h.w,s[p+2]=h.z/h.w}},mn.prototype.applyTextureMatrixFlexible=function(e,r,i){if(r.alreadyprocessed&&null!=r.node.batchInfo){for(var n=[],s=0;s<r.node.batchInfo.length;s++)n.push(e.batches.get(r.node.batchInfo[s].batchIndex));for(var a=0;a<n.length;a++){var o=n[a];for(s=0;s<o.length;s++)for(var p=o[s],h=0;h<p.length;h++){var u=p[h].vertexUvArray,f=u?u.length/3:0;if(f>0){s=0,h=0;var d=new t.Vector4;for(s=0;s<f;s++,h+=3)d.set(u[h],u[h+1],u[h+2],1),d.applyMatrix4(i),u[h]=d.x/d.w,u[h+1]=d.y/d.w,u[h+2]=d.z/d.w}}}}if(r.children)for(s=0;s<r.children.length;s++)this.applyTextureMatrixFlexible(e,r.children[s],i)},mn.prototype.unstream=function(e,t){this.readRepSize(e);Vi.prototype.unstream.call(this,e,t);if(e.readBoolean()){var r=An.prototype.unstream.call(this,e);void 0!==r.textureMatrix&&(this.rep.alreadyprocessed?this.applyTextureMatrixFlexible(e,this.rep,r.textureMatrix):this.applyTextureMatrix(e,this.rep,r.textureMatrix))}return this.rep};class vn{constructor(){this.rep=null}convertConnectivity(t){switch(t){case 0:return e.ConnectivityTypeEnum.POINTS;case 1:return e.ConnectivityTypeEnum.LINES;case 2:return e.ConnectivityTypeEnum.LINE_STRIP;case 3:return e.ConnectivityTypeEnum.LINE_LOOP;case 4:default:return e.ConnectivityTypeEnum.TRIANGLES;case 5:return e.ConnectivityTypeEnum.TRIANGLE_STRIP;case 6:return e.ConnectivityTypeEnum.TRIANGLE_FAN}}getByteSize(t){switch(t){case e.DataTypeEnum.CHAR:case e.DataTypeEnum.UCHAR:return 1;case e.DataTypeEnum.SHORT:case e.DataTypeEnum.USHORT:return 2;case e.DataTypeEnum.INT:case e.DataTypeEnum.UINT:case e.DataTypeEnum.FLOAT:return 4;case e.DataTypeEnum.DOUBLE:return 8;default:return 1}}addSet(){}startPrimitiveGroupUnstream(e){let t=e.readCompressedUInt();for(let r=0;r<t;++r){const t=e.readUnsignedChar();let r=e.readCompressedUInt();if(1!=t){let t=this.unstreamRawBuffer(e);de.set(r,t)}}}unstreamRawBuffer(e){e.readUnsignedChar();let t=e.readCompressedInt(),r=new Uint8Array(t);return e.readBytes(t,r),r}startSharedBufferUnstream(t){let r=new e.Buffer;r.indexBuffer=t.readBoolean();let i=t.readCompressedUInt();r.format=t.readUnsignedChar(),r.dimension=t.readUnsignedChar(),r.size=i*r.dimension;let n,s=t.readCompressedUInt(),a=de.get(s),o=t.readCompressedUInt();switch(r.format){case e.DataTypeEnum.FLOAT:n=new Float32Array(a.buffer),r.data=n.subarray(o/4,o/4+r.size);break;case e.DataTypeEnum.INT:n=new Int32Array(a.buffer),r.data=n.subarray(o/4,o/4+r.size);break;case e.DataTypeEnum.UINT:n=new Uint32Array(a.buffer),r.data=n.subarray(o/4,o/4+r.size);break;default:r.data=a.subarray(o,o+r.size)}return r}startBufferUnstream(t){let r=new e.Buffer,i=0;r.indexBuffer=t.readBoolean(),i=t.readCompressedInt(),r.format=t.readUnsignedChar(),r.dimension=t.readUnsignedChar(),r.size=i*r.dimension;switch(t.readBoolean()){case _r:r.data=new Float32Array(r.size),t.readPositionsArrayBuffer(i,r.data,0);break;case zr:r.data=new Float32Array(r.size),t.readNormalsArrayBuffer(i,r.data,0);break;case Vr:switch(r.format){case e.DataTypeEnum.FLOAT:r.data=new Float32Array(r.size),t.readFloatArray(0,r.size,r.data);break;case e.DataTypeEnum.INT:r.data=new Int32Array(r.size),t.readUncompressedIntArray(r.size,r.data);break;case e.DataTypeEnum.UINT:r.data=new Uint32Array(r.size),t.readUncompressedIntArray(r.size,r.data);break;default:r.data=new Uint8Array(r.size),t.readBytes(r.size,r.data)}}return r}unstream(t,r){let i;t.setNumberOfVertices(16777216);let n=[],s=new e.PrimitiveGroup;s.fillAttr=new e.FillAttributes,s.lineAttr=new e.LineAttributes,t.version>=210042840&&this.startPrimitiveGroupUnstream(t);const a=t.readCompressedInt();if(a<=0)return null;for(var o=0;o<a;o++){let e;e=t.version>=210042840?this.startSharedBufferUnstream(t):this.startBufferUnstream(t),s.addBuffer(o,e)}const p=t.readCompressedInt();if(p<=0&&a<=0)return this.rep&&this.rep.unstream(t),null;let h,u,f;for(let r=0;r<p;r++){let r=new e.Primitive;r.nbIndices=t.readCompressedInt(),r.connectivity=this.convertConnectivity(t.readUnsignedChar());const a=t.readCompressedInt();for(let n=0;n<a;n++){let n=new e.VertexComponent;n.component=t.readUnsignedChar(),n.cardinality=t.readUnsignedChar(),n.bufferId=t.readCompressedInt(),n.offset=t.readCompressedInt(),n.indices=null,t.version>=210042715&&(n.nbValuesPerVertex=t.readCompressedInt(),n.stride=t.readCompressedInt(),n.stride>0&&(i="mono"));let a=s.getBufferFromId(n.bufferId);if(null!==a||null!==h){let t;if(n.stride||null===a){h&&u===n.bufferId||(h=a,u=n.bufferId,f=n.bufferId,s.removeBuffer(f)),t=this.getByteSize(h.format),n.stride/=t,n.offset/=t;let r,i=h.size/h.dimension,o=new e.Buffer;if(o.indexBuffer=0,n.component===e.VertexComponentEnum.POSITION||n.component===e.VertexComponentEnum.TEX_COORD_0||n.component===e.VertexComponentEnum.TEX_COORD_1||n.component===e.VertexComponentEnum.TEX_COORD_2||n.component===e.VertexComponentEnum.TEX_COORD_3){r=new Float32Array(3*i);for(let e=0;e<i;e++)for(let t=0;t<n.nbValuesPerVertex;t++)r[3*e+t]=h.data[n.offset+n.stride*e+t];o.size=3*i,o.dimension=3,o.oldDimension=n.nbValuesPerVertex,n.nbValuesPerVertex=3}else{r=new Float32Array(i*n.nbValuesPerVertex);for(let e=0;e<i;e++)for(let t=0;t<n.nbValuesPerVertex;t++)r[3*e+t]=h.data[n.offset+n.stride*e+t];o.size=i*n.nbValuesPerVertex,o.dimension=n.nbValuesPerVertex}o.data=r,o.component=n.component,o.format=h.format,s.addBuffer(f,o),n.bufferId=f,f=s.nbBuffers,n.format=o.format}else{if(t=this.getByteSize(a.format),a.oldDimension?n.offset/=t*a.oldDimension:n.offset/=t*a.dimension,a.component=n.component,(a.component===e.VertexComponentEnum.POSITION||a.component===e.VertexComponentEnum.TEX_COORD_0||a.component===e.VertexComponentEnum.TEX_COORD_1||a.component===e.VertexComponentEnum.TEX_COORD_2||a.component===e.VertexComponentEnum.TEX_COORD_3)&&a.dimension<3){const e=a.size/a.dimension;let t=new Float32Array(3*e);for(let r=0;r<e;r++)t[3*r]=a.data[a.dimension*r],a.dimension>1?t[3*r+1]=a.data[2*r+1]:t[3*r+1]=0,t[3*r+2]=0;a.data=t,a.size=3*e,a.oldDimension=a.dimension,a.dimension=3}n.nbValuesPerVertex=a.dimension,n.format=a.format}}if(t.readBoolean()&&(n.indices=new e.IndexArray,n.indices.bufferId=t.readCompressedInt(),n.indices.offset=t.readCompressedInt(),a=s.getBufferFromId(n.indices.bufferId),null!==a)){const e=this.getByteSize(a.format);n.indices.offset/=e,n.indices.format=a.format}r.addVertexComponent(n)}let o=null,p=null;t.readBoolean()&&(p=An.prototype.unstream.call(this,t),p.gas&&(o=p.gas));let d=!1;if(r){r._usedVertexColor()&&(d=!0)}n.push({prim:r,gas:o,pointSize:p.size?p.size:1,symbol:p.symbol?p.symbol:0,usedVertexColor:d})}if(this.rep.unstream(t),r)return t.popRepAttribute(),null;for(let r=0;r<n.length;r++){if(n[r].gas){t.pushGAS(n[r].gas,0);let e=t.getGAS(n[r].prim.connectivity,this.rep.layerNumber);e.setConnectivity(n[r].prim.connectivity),n[r].prim.attr=e,t.popGAS()}else{let e=t.getGAS(n[r].prim.connectivity,this.rep.layerNumber);e.setConnectivity(n[r].prim.connectivity),n[r].prim.attr=e}n[r].pointSize&&n[r].prim.attr.setPointSize(n.pointSize),n[r].symbol&&n[r].prim.attr.setSymbol(n[r].symbol),n[r].usedVertexColor&&n[r].prim.connectivity==e.ConnectivityTypeEnum.POINTS&&(n[r].prim.attr.setVertexColor(),n[r].prim.attr.setColor(8),n[r].symbol&&n[r].prim.attr.setSymbol(0),n[r].pointSize||n[r].prim.attr.setLineThickness(1)),s.addPrimitive(n[r].prim)}s.material=t.getCurrentMatId(),"mono"!==i&&(i="auto");let d=e.convertToGeometry3js(s,void 0,void 0,void 0,i,!0);return d.rep=this.rep,this.rep.resolvedInheritance(t,d),t.popRepAttribute(),this.rep}}var yn=function(e){st.call(this),this.sizeComputationMethod=0,this.skippable=!1};yn.prototype=Object.create(st.prototype),yn.prototype.constructor=yn,yn.prototype.unstream=function(e,t){return this.readRepSize(e),(new gn).unstream(e,t)};class gn extends vn{constructor(e){super(),this.rep=new ii(e)}}var xn=function(e){st.call(this),this.sizeComputationMethod=0,this.skippable=!1};xn.prototype=Object.create(st.prototype),xn.prototype.constructor=xn,xn.prototype.unstream=function(e,t){return this.readRepSize(e),(new Bn).unstream(e,t)};class Bn extends vn{constructor(e){super(),this.rep=new ai(e)}}var An=function(){};An.prototype.constructor=An,An.prototype.getNbAttributes=function(e){for(var t=0;e;)1&e&&t++,e>>=1;return t},An.prototype.getAttributeType=function(e,t){for(var r=1,i=0;i<t+1;i++){for(;!(1&e);)e>>=1,r<<=1;e>>=1,i!==t&&(r<<=1)}return r},An.prototype.unstream=function(e){for(var r={},i=e.readCompressedInt(),n=e.getCurrentPosition(),s=e.readCompressedInt(),a=An.prototype.getNbAttributes(i),o=0;o<a;o++){switch(An.prototype.getAttributeType(i,o)){case jr:r.gas=e.readGraphicAttributeSet();break;case Wr:var p=[];if(e.version>=210021610){var h=e.readCompressedUInt(),u=e.readUnsignedChar(),f=[];e.readDoubles(f,u);var d=0;for(o=0,d=0;o<16;o++){switch((h&3<<2*o)>>>2*o){case 0:p.push(f[d++]);break;case 1:p.push(0);break;case 2:p.push(1);break;case 3:p.push(-1)}}}else p=new Float32Array(16),e.readFloatArray(0,16,p);var c=new t.Matrix4;c.set(p[0],p[4],p[8],p[12],p[1],p[5],p[9],p[13],p[2],p[6],p[10],p[14],p[3],p[7],p[11],p[15]),r.textureMatrix=c;break;case Hr:e.readCompressedInt();break;case Xr:r.symbol=e.readCompressedInt();break;case Yr:r.size=e.readCompressedInt()}}return e.setCurrentPosition(n+s),r};var In=function(){return Qn?{sag:Qn.sag3D,sagMode:Qn.sagmode3D}:{sag:.2,sagMode:1}},bn=function(){return!!Qn&&3==Qn.cgrType},Cn=function(e){switch(e){case"Cuboid":case"Sphere":case"PartialSphere":case"Cone":case"Cylinder":case"PartialTorus":case"Torus":case"CurvedPipe":return!0;default:console.error("wrong type : "+e)}},Sn=function(){st.call(this),this.sizeComputationMethod=0};Sn.prototype=Object.create(st.prototype),Sn.prototype.constructor=Sn,Sn.prototype.unstream=function(e,t){this.readRepSize(e);var r=new wn;return r.rep.unstream(e),r.infos={bottomCenter:[e.readFloat(),e.readFloat(),e.readFloat()],topCenter:[e.readFloat(),e.readFloat(),e.readFloat()],bottomRadius:e.readFloat(),topRadius:e.readFloat()},t?(e.popRepAttribute(),null):r.addMesh(e)?r.rep:null};var wn=function(){ei.call(this),this.infos=null};wn.prototype=Object.create(ei.prototype),wn.prototype.constructor=wn,wn.prototype.build=function(t){var r,i=t.getCurrentMatId(),n=t.getGAS(e.ConnectivityTypeEnum.TRIANGLES,this.rep.layerNumber);r=t.isASMColor()?t.getGAS(null,this.rep.layerNumber):n.clone();var s=this.infos;return!Cn("Cone")?{gas:n,matId:i,canonicalType:se,vectors:[s.bottomCenter[0],s.bottomCenter[1],s.bottomCenter[2],s.topCenter[0],s.topCenter[1],s.topCenter[2]],floats:[s.bottomRadius,s.topRadius]}:e._createCustomCylindricalMesh(s.bottomCenter,s.topCenter,s.bottomRadius,s.topRadius,n,i,In(),!0,t.decorations,r,bn())};var Pn=function(){st.call(this),this.sizeComputationMethod=0};Pn.prototype=Object.create(st.prototype),Pn.prototype.constructor=Pn,Pn.prototype.unstream=function(e,t){this.readRepSize(e);var r=new Mn;return r.rep.unstream(e),r.infos={corner:[e.readFloat(),e.readFloat(),e.readFloat()],firstAxis:[e.readFloat(),e.readFloat(),e.readFloat()],secondAxis:[e.readFloat(),e.readFloat(),e.readFloat()],thirdlength:e.readFloat()},t?(e.popRepAttribute(),null):r.addMesh(e)?r.rep:null};var Mn=function(){ei.call(this)};Mn.prototype=Object.create(ei.prototype),Mn.prototype.constructor=Mn,Mn.prototype.build=function(t){var r,i=t.getCurrentMatId(),n=t.getGAS(e.ConnectivityTypeEnum.TRIANGLES,this.rep.layerNumber);r=t.isASMColor()?t.getGAS(null,this.rep.layerNumber):n.clone();var s=this.infos;return!Cn("Cuboid")?{gas:n,matId:i,canonicalType:oe,vectors:[s.corner[0],s.corner[1],s.corner[2],s.firstAxis[0],s.firstAxis[1],s.firstAxis[2],s.secondAxis[0],s.secondAxis[1],s.secondAxis[2]],floats:[s.thirdlength]}:e._createCuboidMesh(s.corner,s.firstAxis,s.secondAxis,s.thirdlength,n,i,!0,null,r,bn())};var Rn=function(){st.call(this),this.sizeComputationMethod=0};Rn.prototype=Object.create(st.prototype),Rn.prototype.constructor=Rn,Rn.prototype.unstream=function(e,t){this.readRepSize(e);var r=new Tn;r.rep.unstream(e);for(var i=e.readCompressedUInt(),n=[],s=0;s<3*i;s++)n.push(e.readFloat());return r.infos={centers:n,startN:[e.readFloat(),e.readFloat(),e.readFloat()],endN:[e.readFloat(),e.readFloat(),e.readFloat()],radius:e.readFloat()},t?(e.popRepAttribute(),null):r.addMesh(e)?r.rep:null};var Tn=function(){ei.call(this)};Tn.prototype=Object.create(ei.prototype),Tn.prototype.constructor=Tn,Tn.prototype.build=function(r){var i,n=r.getCurrentMatId(),s=r.getGAS(e.ConnectivityTypeEnum.TRIANGLES,this.rep.layerNumber);i=r.isASMColor()?r.getGAS(null,this.rep.layerNumber):s.clone();var a=this.infos;if(!Cn("CurvedPipe")){var o=[-a.startN[2],a.startN[0],-a.startN[1]],p=(a.endN[2],a.endN[0],a.endN[1],[a.startN[1]*o[2]-a.startN[2]*o[1],a.startN[2]*o[0]-a.startN[0]*o[2],a.startN[0]*o[1]-a.startN[1]*o[0]]),h=s.getDisplayedColor(),u=new t.Color;return u.setRGB(h[0]/255,h[1]/255,h[2]/255),{gas:{color:u,opacity:h[3]/255},matId:n,curveVertices:a.centers,startNormal:a.startN,endNormal:a.endN,radius:a.radius,startSideVector:p}}for(var f=[],d=[],c=0,l=0;l<a.centers.length/3;l++)d.push(a.radius),f.push(new t.Vector3(a.centers[c++],a.centers[c++],a.centers[c++]));var m=new t.Vector3(a.startN[0],a.startN[1],a.startN[2]),v=new t.Vector3(a.endN[0],a.endN[1],a.endN[2]);return e._createCurvedPipeMesh(f,d,m,v,!0,s,n,In(),!0,null,null,i,bn())};var Un=function(){st.call(this),this.sizeComputationMethod=0};Un.prototype=Object.create(st.prototype),Un.prototype.constructor=Un,Un.prototype.unstream=function(e,t){this.readRepSize(e);var r=new Fn;return r.rep.unstream(e),r.infos={bottomCenter:[e.readFloat(),e.readFloat(),e.readFloat()],topCenter:[e.readFloat(),e.readFloat(),e.readFloat()],radius:e.readFloat()},t?(e.popRepAttribute(),null):r.addMesh(e)?r.rep:null};var Fn=function(){ei.call(this)};Fn.prototype=Object.create(ei.prototype),Fn.prototype.constructor=Fn,Fn.prototype.build=function(t){var r,i=t.getCurrentMatId(),n=t.getGAS(e.ConnectivityTypeEnum.TRIANGLES,this.rep.layerNumber);r=t.isASMColor()?t.getGAS(null,this.rep.layerNumber):n.clone();var s=this.infos,a=[s.topCenter[0]-s.bottomCenter[0],s.topCenter[1]-s.bottomCenter[1],s.topCenter[2]-s.bottomCenter[2]],o=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);a[0]/=o,a[1]/=o,a[2]/=o;var p=[-a[2],a[0],-a[1]];a[1],a[2],a[2],a[0],a[0],a[1];return!Cn("Cylinder")?{gas:n,matId:0,canonicalType:ae,vectors:[s.bottomCenter[0],s.bottomCenter[1],s.bottomCenter[2],s.topCenter[0],s.topCenter[1],s.topCenter[2]],floats:[s.radius]}:e._createCustomCylindricalMesh(s.bottomCenter,s.topCenter,s.radius,s.radius,n,i,In(),!0,t.decorations,r,bn())};var Gn=function(){st.call(this),this.sizeComputationMethod=0};Gn.prototype=Object.create(st.prototype),Gn.prototype.constructor=Gn,Gn.prototype.unstream=function(e,t){this.readRepSize(e);var r=new On;return r.rep.unstream(e),r.infos={center:[e.readFloat(),e.readFloat(),e.readFloat()],firstAxis:[e.readFloat(),e.readFloat(),e.readFloat()],secondAxis:[e.readFloat(),e.readFloat(),e.readFloat()],meridianStartAngle:e.readFloat(),meridianEndAngle:e.readFloat(),parallelStartAngle:e.readFloat(),parallelEndAngle:e.readFloat()},t?(e.popRepAttribute(),null):r.addMesh(e)?r.rep:null};var On=function(){ei.call(this)};On.prototype=Object.create(ei.prototype),On.prototype.constructor=On,On.prototype.build=function(t){var r=t.getCurrentMatId(),i=t.getGAS(null,this.rep.layerNumber),n=this.infos;return!Cn("PartialSphere")?{gas:i,matId:r,canonicalType:he,vectors:[n.center[0],n.center[1],n.center[2],n.firstAxis[0],n.firstAxis[1],n.firstAxis[2],n.secondAxis[0],n.secondAxis[1],n.secondAxis[2]],floats:[n.meridianStartAngle,n.meridianEndAngle,n.parallelStartAngle,n.parallelEndAngle]}:e._createCustomSphereMesh(n.parallelStartAngle,n.parallelEndAngle,n.meridianStartAngle,n.meridianEndAngle,n.center,n.firstAxis,n.secondAxis,i,r,In(),!0,t.decorations)};var Nn=function(){st.call(this),this.sizeComputationMethod=0};Nn.prototype=Object.create(st.prototype),Nn.prototype.constructor=Nn,Nn.prototype.unstream=function(e,t){this.readRepSize(e);var r=new En;return r.rep.unstream(e),r.infos={center:[e.readFloat(),e.readFloat(),e.readFloat()],firstAxis:[e.readFloat(),e.readFloat(),e.readFloat()],secondAxis:[e.readFloat(),e.readFloat(),e.readFloat()],minorRadius:e.readFloat(),majorAngle:e.readFloat()},t?(e.popRepAttribute(),null):r.addMesh(e)?r.rep:null};var En=function(){ei.call(this)};En.prototype=Object.create(ei.prototype),En.prototype.constructor=En,En.prototype.build=function(r){var i,n=r.getCurrentMatId(),s=r.getGAS(e.ConnectivityTypeEnum.TRIANGLES,this.rep.layerNumber);i=r.isASMColor()?r.getGAS(null,this.rep.layerNumber):s.clone();var a=this.infos,o=!Cn("PartialTorus"),p=e._buildCurvedPipeDataFromTorus(new t.Vector3(a.center[0],a.center[1],a.center[2]),new t.Vector3(a.firstAxis[0],a.firstAxis[1],a.firstAxis[2]),new t.Vector3(a.secondAxis[0],a.secondAxis[1],a.secondAxis[2]),a.majorAngle,In(),a.minorRadius);if(o)return{gas:s,matId:n,canonicalType:fe,vectors:[a.center[0],a.center[1],a.center[2],a.firstAxis[0],a.firstAxis[1],a.firstAxis[2],a.secondAxis[0],a.secondAxis[1],a.secondAxis[2]],floats:[a.minorRadius,a.majorAngle]};for(var h=[],u=[],f=0,d=0;d<p.centers.length/3;d++)u.push(a.minorRadius),h.push(new t.Vector3(p.centers[f++],p.centers[f++],p.centers[f++]));var c=new t.Vector3(p.startNormal[0],p.startNormal[1],p.startNormal[2]),l=new t.Vector3(p.endNormal[0],p.endNormal[1],p.endNormal[2]);return e._createCurvedPipeMesh(h,u,c,l,!0,s,n,In(),!0,r.decorations,a,i,bn())};var Dn=function(){st.call(this),this.sizeComputationMethod=0};Dn.prototype=Object.create(st.prototype),Dn.prototype.constructor=Dn,Dn.prototype.unstream=function(e,t){this.readRepSize(e);var r=new Ln;return r.rep.unstream(e),r.infos={center:[e.readFloat(),e.readFloat(),e.readFloat()],radius:e.readFloat()},t?(e.popRepAttribute(),null):r.addMesh(e)?r.rep:null};var Ln=function(){ei.call(this)};Ln.prototype=Object.create(ei.prototype),Ln.prototype.constructor=Ln,Ln.prototype.build=function(t){var r=t.getCurrentMatId(),i=t.getGAS(null,this.rep.layerNumber),n=this.infos;return!Cn("Sphere")?{gas:i,matId:r,canonicalType:pe,vectors:n.center,floats:[n.radius]}:e._createCustomSphereMesh(-Math.PI/2,Math.PI/2,0,2*Math.PI,n.center,[n.radius,0,0],[0,1,0],i,r,In(),!0,t.decorations)};var kn=function(){st.call(this),this.sizeComputationMethod=0};kn.prototype=Object.create(st.prototype),kn.prototype.constructor=kn,kn.prototype.unstream=function(e,t){this.readRepSize(e);var r=new Vn;return r.rep.unstream(e),r.infos={center:[e.readFloat(),e.readFloat(),e.readFloat()],planeNormal:[e.readFloat(),e.readFloat(),e.readFloat()],minorRadius:e.readFloat()},t?(e.popRepAttribute(),null):r.addMesh(e)?r.rep:null};var Vn=function(){ei.call(this)};Vn.prototype=Object.create(ei.prototype),Vn.prototype.constructor=Vn,Vn.prototype.build=function(r){var i=r.getCurrentMatId(),n=r.getGAS(null,this.rep.layerNumber),s=this.infos,a=new t.Vector3(s.planeNormal[0],s.planeNormal[1],s.planeNormal[2]),o=a.length();a.normalize();var p=new t.Vector3(-s.planeNormal[2],s.planeNormal[0],-s.planeNormal[1]),h=new t.Vector3;h.crossVectors(a,p),h.normalize();var u=new t.Vector3;u.crossVectors(a,h),u.normalize(),h.multiplyScalar(o),u.multiplyScalar(o);var f=e._buildCurvedPipeDataFromTorus(new t.Vector3(s.center[0],s.center[1],s.center[2]),h,u,2*Math.PI,In(),s.minorRadius);if(!Cn("Torus"))return{gas:n,matId:i,canonicalType:ue,vectors:[s.center[0],s.center[1],s.center[2],s.planeNormal[0],s.planeNormal[1],s.planeNormal[2]],floats:[s.minorRadius]};for(var d=[],c=[],l=0,m=0;m<f.centers.length/3;m++)c.push(s.minorRadius),d.push(new t.Vector3(f.centers[l++],f.centers[l++],f.centers[l++]));var v=new t.Vector3(f.startNormal[0],f.startNormal[1],f.startNormal[2]);new t.Vector3(f.endNormal[0],f.endNormal[1],f.endNormal[2]);return e._createTorusMesh(new t.Vector3(s.center[0],s.center[1],s.center[2]),d,c,v,n,i,In(),!0,r.decorations)};var _n=function(){st.call(this),this.sizeComputationMethod=0};_n.prototype=Object.create(st.prototype),_n.prototype.constructor=_n,_n.prototype.unstream=function(e,t){this.readRepSize(e);var r=new zn;if(r.rep.unstream(e),r.infos={width:e.readCompressedInt(),height:e.readCompressedInt(),depth:e.readCompressedInt(),format:e.readCompressedUInt(),encoding:e.readCompressedUInt(),bufferSize:e.readCompressedUInt(),bufferData:null},r.infos.bufferSize>0){var i=new Uint8Array(r.infos.bufferSize);e.readBytes(r.infos.bufferSize,i),r.infos.bufferData=i}return t?(e.popRepAttribute(),null):r.addMesh(e)?r.rep:null};var zn=function(){ei.call(this),this.infos=null};zn.prototype=Object.create(ei.prototype),zn.prototype.constructor=zn,zn.prototype.build=function(e){return{voxelRep:this.infos}};var jn=function(){ei.call(this),this.infos=null,this.currentMatrix=null};jn.prototype=Object.create(ei.prototype),jn.prototype.constructor=jn,jn.prototype.unstream=function(e){if(this.rep.unstream(e),this.infos={version:e.readUnsignedShort(),type:e.readUnsignedChar(),bufferSize:e.readCompressedUInt(),bufferData:null},this.currentMatrix=e.getCurrentMatrix(),this.infos.bufferSize>0){var t=new Uint8Array(this.infos.bufferSize);e.readBytes(this.infos.bufferSize,t),this.infos.bufferData=t}return this.addMesh(e)?this.rep:null},jn.prototype.build=function(e){let t=null;return self.GAUSSIAN_SPLATTING_PARSING_INCLUDE?(t=r.createSplatBufferFromCGR(this.infos),null==t&&console.error("CGR Parsing failed for Gaussian Splat rep")):console.error("Trying to parse a Gaussian Splat rep but GaussianSplattingParsing.js is not included !"),{splatBuffer:t,splatMatrix:this.currentMatrix}};var Wn=function(e){this.fatherId=e.readUncompressedInt(!1);new ge(e);var t=e.readUncompressedInt(!1);this.name=e.readUnicodeString(t/2),this.blocReader=new Be(e,0),this.getId=function(){return this.blocReader.id},this.getsubArrayBuffer=function(){if(1==this.blocReader.blocs.length){var e=this.blocReader.blocs[0].length,t=this.blocReader.blocs[0].offset;return es.fileBuffer.buffer.subarray(t,t+e)}}},Hn=function(e,t){this.tocEntry=t;var r=e;this.name=t.name;var i=[],n=[];this.header=null,this.getChild=function(e){},this.getSubArrayByName=function(e){return es.blocReader.getChildEntry(this.tocEntry,e).getsubArrayBuffer()},this.getStreamerByName=function(e,t){for(var i=0;i<n.length;++i)if(n[i].name==e){var s=n[i];return t&&s.setCurrentPosition(0),s}return null!=(s=r.getStreamer(this.tocEntry,e))&&(null!=this.header&&(s.version=this.header.version,s.conversion=this.header.conversion),s.setContainer(this),n.push(s)),s},this.getStreamer=function(){return this.getStreamerByName(this.name)},this.getChildContainer=function(t){for(var r=0;r<i.length;++r)if(i[r].name==t)return i[r];var n=e.getChildContainer(this.tocEntry,t);return n&&i.push(n),n},this.unstreamHeaderCGR=function(e){if(!this.header){this.header=e?this.getStreamerByName(e):this.getStreamer();var t=this.header.readUnsignedChar();if(this.header.conversion=!t,this.header.version=this.header.readUncompressedInt(),this.header.version>s)return console.log("warning cgr version not supported "+this.header.version+">"+s),{error:"warning cgr version not supported"};this.header.version>=1101310&&this.header.readUncompressedInt()}},this.unstreamHeaderUVR=function(e){this.header=e;var t=this.header.readUnsignedChar();if(this.header.conversion=!t,this.header.version=this.header.readUncompressedInt(),this.header.version>s)return console.log("warning ugr version not supported"),{error:"warning ugr version not supported"}},this.getResourceCGRContainer=function(){var e=r.getRootContainer();return e?e.getChildContainer("Resources"):null},this.getResource=function(e){var t,r=null,i=e.readUnsignedChar(),n=e.readCompressedInt();if(e.textures.isValidMultiRefIndex(n))return t=e.textures.getIndex(n);var s=this.getStreamerByName("MainCGRResourceStreamer");s.setCurrentPosition(n),e.copyStreamerInheritance(s);var a=null;if(s.readUnsignedChar()){var o=s.readStringWithLength(),p=s.readStringWithLength();console.log(" providerName = "+o+"resourceUUID = "+p+"not loaded")}else if(i){r=(a=new ze).unstream(s)}else{switch(s.readUnsignedChar()){case Ae:break;case Ie:a=new je}var h=s.readStringWithLength().split("\\"),u=h[h.length-1];null!=a&&(r=a.unstream(s,u))}return null!=r?(t=e.textures.add(r),e.textures.addMultiRefIndex(n,t),t):null},this.getImage=function(e,t,r){var i=null,n=this.getStreamerByName("MainCGRResourceStreamer");e.copyStreamerInheritance(n),n.setCurrentPosition(t);var s=n.readUnsignedChar();if(2==s)i=(new _e).createTexture(n);else if(1==s){i=(new ke).unstream(n)}else if(3==s||4==s||5==s||6==s){var a=0;i=null;5!=s&&6!=s||(a=n.readCompressedUInt());var o=n.readCompressedUInt();if(o>0)return i=new Uint8Array(o),n.readBytes(o,i),{img:i,imgType:s,format:a}}return i},this.getResourceShader=function(e){var t=0;e.readUnsignedChar()&&(t=e.readCompressedInt());var r=this.getStreamerByName("MainCGRResourceStreamer");if(r.conversion=e.conversion,r.setCurrentPosition(t),r.version=e.version,!r.readUnsignedChar()){var i=new Je;i.unstream(r)}return i}},Xn=[],Yn=1,qn=!1,Qn=null,Zn=!1,Jn=!1,Kn=null,$n=null,es=null,ts=null,rs=function(e){this.multiPartReader=e,this.currentPositionInView=0,this.position=0,this.offsetsInStream=[],this.dataViews=[],this.currentView=null,this.currentBuffer=null,this.offsetInBuffer=0,this.currentViewIndex=0,this.intMaxOffset=0,this.shortMaxOffset=0,this.doubleMaxOffset=0};rs.prototype.addBloc=function(e){var t=this.multiPartReader.getDataViews(e.offset,e.length),r=this.dataViews.length;this.offsetsInStream.length&&this.offsetsInStream[this.offsetsInStream.length-1];this.dataViews=this.dataViews.concat(t);for(var i=r;i<this.dataViews.length;++i)0==i?this.offsetsInStream.push(0):this.offsetsInStream.push(this.offsetsInStream[i-1]+this.dataViews[i-1].dataView.byteLength);null===this.currentView&&(this.currentView=this.dataViews[0].dataView,this.currentBuffer=this.dataViews[0].buffer,this.offsetInBuffer=this.dataViews[0].offset,this.currentPositionInView=0,this.intMaxOffset=this.currentView.byteLength-4,this.shortMaxOffset=this.currentView.byteLength-2,this.doubleMaxOffset=this.currentView.byteLength-8)},rs.prototype.setFromBuffer=function(e){this.dataViews.push({dataView:new DataView(e.buffer,0,e.length),buffer:e,offset:0}),this.offsetsInStream.push(0),this.currentView=this.dataViews[0].dataView,this.currentBuffer=this.dataViews[0].buffer,this.offsetInBuffer=this.dataViews[0].offset,this.currentPositionInView=0,this.intMaxOffset=this.currentView.byteLength-4,this.shortMaxOffset=this.currentView.byteLength-2,this.doubleMaxOffset=this.currentView.byteLength-8},rs.prototype.getBytesRemain=function(){for(var e=this.currentView.byteLength-this.currentPositionInView,t=this.currentViewIndex+1;t<this.dataViews.length;t++){if(this.dataViews[t])e+=this.dataViews[t].dataView.byteLength}return e},rs.prototype.optimizedRead=function(e){return this.currentPositionInView<this.currentView.byteLength||(this.currentViewIndex++,this.currentView=this.dataViews[this.currentViewIndex].dataView,this.currentBuffer=this.dataViews[this.currentViewIndex].buffer,this.offsetInBuffer=this.dataViews[this.currentViewIndex].offset,this.currentPositionInView=0,this.intMaxOffset=this.currentView.byteLength-4,this.shortMaxOffset=this.currentView.byteLength-2,this.doubleMaxOffset=this.currentView.byteLength-8),this.currentBuffer[this.offsetInBuffer+this.currentPositionInView++]},rs.prototype.read=function(){return this.currentPositionInView<this.currentView.byteLength||(this.currentViewIndex++,this.currentView=this.dataViews[this.currentViewIndex].dataView,this.currentBuffer=this.dataViews[this.currentViewIndex].buffer,this.offsetInBuffer=this.dataViews[this.currentViewIndex].offset,this.currentPositionInView=0,this.intMaxOffset=this.currentView.byteLength-4,this.shortMaxOffset=this.currentView.byteLength-2,this.doubleMaxOffset=this.currentView.byteLength-8),this.currentBuffer[this.offsetInBuffer+this.currentPositionInView++]},rs.prototype.getCurrentPosition=function(){return this.offsetsInStream[this.currentViewIndex]+this.currentPositionInView},rs.prototype.setPosition=function(e){for(var t=0,r=0;e>t+this.dataViews[r].dataView.byteLength;)t+=this.dataViews[r].dataView.byteLength,r++;this.currentViewIndex=r,this.currentView=this.dataViews[this.currentViewIndex].dataView,this.currentBuffer=this.dataViews[this.currentViewIndex].buffer,this.offsetInBuffer=this.dataViews[this.currentViewIndex].offset,this.currentPositionInView=e-t,this.intMaxOffset=this.currentView.byteLength-4,this.shortMaxOffset=this.currentView.byteLength-2,this.doubleMaxOffset=this.currentView.byteLength-8};var is=new Uint8Array(8),ns=new Int32Array(is.buffer),ss=new Uint32Array(is.buffer),as=new Int16Array(is.buffer),os=new Uint16Array(is.buffer),ps=new Float32Array(is.buffer),hs=new Float64Array(is.buffer);rs.prototype.readDouble=function(e){return e?(is[7]=this.read(),is[6]=this.read(),is[5]=this.read(),is[4]=this.read(),is[3]=this.read(),is[2]=this.read(),is[1]=this.read(),is[0]=this.read()):(is[0]=this.read(),is[1]=this.read(),is[2]=this.read(),is[3]=this.read(),is[4]=this.read(),is[5]=this.read(),is[6]=this.read(),is[7]=this.read()),hs[0]},rs.prototype.readFloatBorder=function(e){return e?(is[3]=this.read(),is[2]=this.read(),is[1]=this.read(),is[0]=this.read()):(is[0]=this.read(),is[1]=this.read(),is[2]=this.read(),is[3]=this.read()),ps[0]};var us=new Float32Array(1),fs=new Uint8Array(us.buffer);rs.prototype.readFloat=function(e){if(this.currentPositionInView<this.intMaxOffset){var t=this.offsetInBuffer+this.currentPositionInView;return this.currentPositionInView+=4,e?(fs[3]=this.currentBuffer[t],fs[2]=this.currentBuffer[t+1],fs[1]=this.currentBuffer[t+2],fs[0]=this.currentBuffer[t+3]):(fs[0]=this.currentBuffer[t],fs[1]=this.currentBuffer[t+1],fs[2]=this.currentBuffer[t+2],fs[3]=this.currentBuffer[t+3]),us[0]}return this.readFloatBorder(e)},rs.prototype.readIntBorder=function(e){return e?(is[3]=this.read(),is[2]=this.read(),is[1]=this.read(),is[0]=this.read()):(is[0]=this.read(),is[1]=this.read(),is[2]=this.read(),is[3]=this.read()),ns[0]},rs.prototype.readUIntBorder=function(e){return e?(is[3]=this.read(),is[2]=this.read(),is[1]=this.read(),is[0]=this.read()):(is[0]=this.read(),is[1]=this.read(),is[2]=this.read(),is[3]=this.read()),ss[0]},rs.prototype.readInt=function(e){if(this.currentPositionInView<this.intMaxOffset){var t=this.offsetInBuffer+this.currentPositionInView;this.currentPositionInView+=4;var r=this.currentBuffer[t],i=this.currentBuffer[t+1],n=this.currentBuffer[t+2],s=this.currentBuffer[t+3];return e?(r<<24)+(i<<16)+(n<<8)+s:(s<<24)+(n<<16)+(i<<8)+r}return this.readIntBorder(e)},rs.prototype.readUncompressedULong=function(e){if(this.currentPositionInView<this.intMaxOffset&!Jn){var t=this.currentView.getUint32(this.currentPositionInView,!e);return this.currentPositionInView+=4,t}return this.readUIntBorder(e)},rs.prototype.readUncompressedInt=function(e){if(this.currentPositionInView<this.intMaxOffset&!Jn){var t=this.currentView.getUint32(this.currentPositionInView,!e);return this.currentPositionInView+=4,t}return this.readUIntBorder(e)},rs.prototype.readUnsignedShortBorder=function(e){return e?(is[0]=this.read(),is[1]=this.read()):(is[1]=this.read(),is[0]=this.read()),os[0]},rs.prototype.readShortBorder=function(e){return e?(is[0]=this.read(),is[1]=this.read()):(is[1]=this.read(),is[0]=this.read()),as[0]},rs.prototype.readUnsignedShort=function(e){if(this.currentPositionInView<this.shortMaxOffset){var t=this.offsetInBuffer+this.currentPositionInView;return this.currentPositionInView+=2,this.currentBuffer[t]<<8&65280|255&this.currentBuffer[t+1]}return this.readUnsignedShortBorder(e)},rs.prototype.readShort=function(e){if(this.currentPositionInView<this.shortMaxOffset){var t=this.offsetInBuffer+this.currentPositionInView;this.currentPositionInView+=2;var r=this.currentBuffer[t],i=this.currentBuffer[t+1];if(e){var n=(127&r)<<8|i;return n-=(128&r)<<8}n=(127&i)<<8|r;return n-=(128&i)<<8}return this.readShortBorder(e)},rs.prototype.readShortArrayBuffer=function(e,t,r){var i=2*e;if(this.currentPositionInView+2*e<this.currentView.byteLength){var n=new Uint8Array(t.buffer),s=this.offsetInBuffer+this.currentPositionInView;if(r)for(var a=0;a<e;++a)n[2*a+1]=this.currentBuffer[s+2*a],n[2*a]=this.currentBuffer[s+2*a+1];else for(a=0;a<i;++a)n[a]=this.currentBuffer[s+a];this.currentPositionInView+=i}else for(a=0;a<e;++a)t[a]=this.readShort(r)},rs.prototype.unpackc24=function(e,t,r){if(this.currentPositionInView+3*t<this.currentView.byteLength){for(var i=0;i<t;++i){var n=this.offsetInBuffer+this.currentPositionInView;r[i+e]=this.currentBuffer[n+3*i]<<16&16711680|this.currentBuffer[n+3*i+1]<<8&65280|255&this.currentBuffer[n+3*i+2]}this.currentPositionInView+=3*t}else for(i=0;i<t;++i)r[i+e]=this.read()<<16&16711680|this.read()<<8&65280|255&this.read()},rs.prototype.readShortArray=function(e,t,r,i){if(this.currentPositionInView+2*t<this.currentView.byteLength){if(this.conversion)for(var n=0;n<t;++n){var s=(127&(a=this.currentBuffer[2*n]))<<8|this.currentBuffer[2*n+1];r[e+n]=s-((128&a)<<8)}else for(n=0;n<t;++n){var a;s=(127&(a=this.currentBuffer[2*n]))<<8|this.currentBuffer[2*n+1];r[e+n]=s-((128&a)<<8)}this.currentPositionInView+=2*t}else for(n=0;n<t;++n)r[e+n]=this.readShort(i)},rs.prototype.readBytesArrayBuffer=function(e,t,r){if(this.currentPositionInView+t<this.currentView.byteLength){for(var i=this.offsetInBuffer+this.currentPositionInView,n=0;n<t;++n)r[e+n]=this.currentBuffer[i+n];this.currentPositionInView+=t}else for(n=0;n<t;++n)r[e+n]=this.read()},rs.prototype.readBytes=function(e,t,r){if(this.currentPositionInView+t<this.currentView.byteLength){for(var i=this.offsetInBuffer+this.currentPositionInView,n=0;n<t;++n)r[e+n]=this.currentBuffer[i+n];this.currentPositionInView+=t}else for(n=0;n<t;++n)r[e+n]=this.read()},rs.prototype.getByteView=function(e,t){if(this.currentPositionInView+e<this.currentView.byteLength){var r=new Uint8Array(this.currentBuffer.buffer,this.offsetInBuffer+this.currentPositionInView,e);return this.currentPositionInView+=e,r}for(var i=0;i<e;++i)t[i]=this.read();return t},rs.prototype.readUnsignedShortArray=function(e,t,r,i){if(this.currentPositionInView+2*t<this.currentView.byteLength){var n=this.offsetInBuffer+this.currentPositionInView;if(i)for(s=0;s<t;++s)is[0]=this.currentBuffer[n+2*s],is[1]=this.currentBuffer[n+2*s+1],r[e+s]=os[0];else for(var s=0;s<t;++s)is[1]=this.currentBuffer[n+2*s],is[0]=this.currentBuffer[n+2*s+1],r[e+s]=os[0];this.currentPositionInView+=2*t}else for(s=0;s<t;++s)r[e+s]=this.readUnsignedShort(i)},rs.prototype.readUnsignedShortArrayBuffer=function(e,t,r){if(this.currentPositionInView+2*e<this.currentView.byteLength){var i=new Uint8Array(t.buffer),n=2*e,s=this.offsetInBuffer+this.currentPositionInView;if(r){for(var a=0;a<e;++a)i[2*a+1]=this.currentBuffer[s+2*a],i[2*a]=this.currentBuffer[s+2*a+1];this.currentPositionInView+=4*e}else{for(a=0;a<n;++a)i[a]=this.currentBuffer[s+a];this.currentPositionInView+=n}}else for(a=0;a<e;++a)t[a]=this.readUnsignedShort(r)},rs.prototype.readFloatArrayBuffer=function(e,t,r){if(this.currentPositionInView+4*e<this.currentView.byteLength){var i=new Uint8Array(t.buffer),n=4*e,s=this.offsetInBuffer+this.currentPositionInView;if(r){for(var a=0;a<e;++a)i[4*a+3]=this.currentBuffer[s+4*a],i[4*a+2]=this.currentBuffer[s+4*a+1],i[4*a+1]=this.currentBuffer[s+4*a+2],i[4*a]=this.currentBuffer[s+4*a+3];this.currentPositionInView+=4*e}else{for(a=0;a<n;++a)i[a]=this.currentBuffer[s+a];this.currentPositionInView+=n}}else for(a=0;a<e;++a)t[a]=this.readFloat(r)},rs.prototype.readFloatArray=function(e,t,r,i){if(this.currentPositionInView+4*t<this.currentView.byteLength)for(var n=this.currentPositionInView+4*t,s=e;this.currentPositionInView<n;)r[s++]=this.readFloat(i);else for(var a=0;a<t;++a)r[e+a]=this.readFloat(i)};var ds=function(){var e=[],t=[];this.getCurrentIndex=function(){return e.length},this.remove=function(t){e.splice(t,1)},this.add=function(t){var r=e.length;return e[r]=t,r},this.addAt=function(t,r){e[r]=t},this.isValidIndex=function(t){return t<e.length},this.get=function(t){return e[t]},this.getArray=function(){return e},this.isValidMultiRefIndex=function(e){return void 0!==t[e]},this.isValidMultiRefIndexWithName=function(e,r){if(void 0!==t[e]){for(var i=0;i<t[e].length;i++)if(t[e][i].streamerName===r)return!0;return!1}return!1},this.addMultiRefIndex=function(e,r){t[e]=r},this.addMultiRefIndexWithName=function(e,r,i){void 0!==t[e]?t[e].push({index:r,streamerName:i}):t[e]=[{index:r,streamerName:i}]},this.getIndex=function(e){return t[e]},this.getIndexWithName=function(e,r){for(var i=t[e],n=0;n<i.length;n++)if(i[n].streamerName===r)return i[n].index;return null}};return function(r,i,s,a,o,p,h,u,f,d,c,l,m,v,y,g,x,B,A,I,b,C,S){es={streamer:null,fileBuffer:null,version:null,blocReader:null,rootContainer:null,CATCurrentMode:0},ts=new Map,Jn=!1;this.isV5=!0,this.FTA=!1,$n=!r||r instanceof byteArrayReader?i||{processText:u||!1,withPrimBoundingElement:s||!1,withRepBoundingElement:c||!1,smartStaticBatching:p||!1,mode2D:!!x&&!!x,sceneGraphOrder:y||!1,sceneGraphOrderPriority:C||!1,withSceneGraph:a||!1,flexibleBatching:I||!1,depthMode2D:b||!1,withBagUUID:d||!1,sag2D:f&&f.sag2D?f.sag2D:0,sag3D:f&&f.sag3D?f.sag3D:0,withSAG:h||!1,defaultTCSetActivation:v||!1,withBlankingRep:m||!1,OOCSmartStaticInfo:B||null,linkableBagRepUUID:S||null,keepCompression:A||!1,uint32Index:o||!1,useGPUPlanarRendering:g||!1}:i||{processText:!!r.processText&&r.processText,withPrimBoundingElement:!!r.withPrimBE&&r.withPrimBE,withRepBoundingElement:!!r.withRepBE&&r.withRepBE,smartStaticBatching:!!r.computeSSB&&r.computeSSB,mode2D:!!r.mode2D&&!!r.mode2D,sceneGraphOrder:!!r.sceneGraphOrderMode&&r.sceneGraphOrderMode,sceneGraphOrderPriority:!!r.sceneGraphOrderPriority&&r.sceneGraphOrderPriority,withSceneGraph:!!r.withSG&&r.withSG,flexibleBatching:!!r.udlMode&&r.udlMode,depthMode2D:!!r.depthMode2D&&r.depthMode2D,withBagUUID:!!r.bagUUID&&r.bagUUID,sag2D:r.sagInfo&&r.sagInfo.sag2D?r.sagInfo.sag2D:0,sag3D:r.sagInfo&&r.sagInfo.sag3D?r.sagInfo.sag3D:0,withSAG:!!r.sag&&r.sag,defaultTCSetActivation:!!r.useDefaultTCSet&&r.useDefaultTCSet,withBlankingRep:!!r.withBlanking&&r.withBlanking,OOCSmartStaticInfo:r.OOCSmartStaticInfo?r.OOCSmartStaticInfo:null,linkableBagRepUUID:r.linkableBagRepUUID?r.linkableBagRepUUID:null,keepCompression:!!r.keepCompression&&r.keepCompression,forceNoShowCGR:!!r.forceNoShowCGR&&r.forceNoShowCGR,uint32Index:!!r.i32Idx&&r.i32Idx,useGPUPlanarRendering:!!r.useGPUPlanar&&r.useGPUPlanar},es.fileBuffer=r,this.setFileBuffer=function(e){es.fileBuffer=new byteArrayReader(e),{id:-1},null,Xn=[],Yn=1,!1,this.isV5=!0,es.streamer=null,es.version=null,es.blocReader=null,es.rootContainer=null};this.addChild=function(e){var t=e.node;if(e.children)for(var r=e.children.length,i=0;i<r;i++){0;var n=e.children[i].node;t.children.push(n),n.type&&(n.parent=t,this.addChild(e.children[i]))}};this.compressedChildren=function(e,t){var r,i=e.node;t.offset>t.size&&(t.size*=2,r=new ArrayBuffer(t.size),t.result.push(r),t.view32F=new Float32Array(r),t.view32UInt=new Uint32Array(r),t.view8UInt=new Uint8Array(r));if(t.view32UInt[t.offset++]=i.cgmId,t.view8UInt[4*t.offset]=i.type,t.view8UInt[4*t.offset+1]=i.solid,t.offset++,e.children){var n,s=e.children.length;for(t.view32UInt[t.offset++]=s,a=0;a<s;a++)n=e.children[a].node,i.children.push(n),n.parent=i,this.compressedChildren(e.children[a],t)}if(i.primitives){var a,o,p,h,u;s=i.primitives.length;for(t.view32UInt[t.offset++]=s,a=0;a<s;a++){if(h=!!(o=i.primitives[a]).boundingSphere,u=!!o.decoration&&o.decoration[0],t.view32UInt[t.offset++]=o.cgmId,t.view8UInt[4*t.offset]=o.type,t.view8UInt[4*t.offset+1]=h,t.view8UInt[4*t.offset+2]=u,t.offset++,t.view32UInt[t.offset++]=o.count,t.view32UInt[t.offset++]=o.start,o.group.primitives instanceof Array?(p=t.idGroup++,o.group.primitives=p):p=o.group.primitives,t.view32UInt[t.offset++]=p,u){var f,d=o.decoration.length,c=4*t.offset;for(f=0;f<d;f++)t.view8UInt[c+f]=o.decoration[f];t.offset+=1+(d/4>>0)}h&&(t.view32F[t.offset++]=o.boundingSphere.center[0],t.view32F[t.offset++]=o.boundingSphere.center[1],t.view32F[t.offset++]=o.boundingSphere.center[2],t.view32F[t.offset++]=o.boundingSphere.radius)}}},this.applyGlobalMatrix=function(r,i,n,s){for(var a=0;a<r.length;a++){r[a].rep=this.getCompressedRep(r[a].rep,s);var o=r[a].globalMatrix;if(!!o&&!o.isIdentity()){var p=new t.Matrix4;if(p.extractRotation(o),r[a].positionCompression||e.applyMat(r[a],o,i,p),p.isIdentity()||r[a].positionCompression){var h=new t.Vector3(r[a].AABB.min[0],r[a].AABB.min[1],r[a].AABB.min[2]).applyMatrix4(o),u=new t.Vector3(r[a].AABB.max[0],r[a].AABB.max[1],r[a].AABB.max[2]).applyMatrix4(o);r[a].AABB.min[0]=h.x,r[a].AABB.min[1]=h.y,r[a].AABB.min[2]=h.z,r[a].AABB.max[0]=u.x,r[a].AABB.max[1]=u.y,r[a].AABB.max[2]=u.z}else e.computeBB(r[a])}}},this.getCompressedRep=function(e,t){if(e.node.type){var r=t.tab,i=t.nbRep++;return r.push(e.node.cgmId+1),r.push(e.node.solid),r.push(e.node.namingContext),$n.withSAG&&r.push(e.node.sag),$n.withRepBoundingElement&&(r.push(e.boundingSphere.radius),r.push(e.boundingSphere.center[0]),r.push(e.boundingSphere.center[1]),r.push(e.boundingSphere.center[2])),$n.flexibleBatching||Jn?(r.push(e.type),r.push(e.indice)):e.node=i,i}return e.node},this.applyGlobalMatrixStatic=function(r,i,n,s){for(var a=0;a<r.length;a++){r[a].rep=this.getCompressedRep(r[a].rep,s);var o=r[a].globalMatrix;if(!!o&&!o.isIdentity()){var p=new t.Matrix4;if(p.extractRotation(o),e.applyMat(r[a],o,i,p),p.isIdentity()){var h=new t.Vector3(r[a].AABB.min[0],r[a].AABB.min[1],r[a].AABB.min[2]).applyMatrix4(o),u=new t.Vector3(r[a].AABB.max[0],r[a].AABB.max[1],r[a].AABB.max[2]).applyMatrix4(o);r[a].AABB.min[0]=h.x,r[a].AABB.min[1]=h.y,r[a].AABB.min[2]=h.z,r[a].AABB.max[0]=u.x,r[a].AABB.max[1]=u.y,r[a].AABB.max[2]=u.z}else e.computeBB(r[a])}}},this.applyGlobalInfiniteGeomMatrix=function(e,r,i){for(var n=null,s=new t.Matrix4,a=new t.Vector3,o=new t.Vector3,p=new t.Vector3,h=new t.Vector3,u=new t.Vector3,f=null,d=0;d<e.length;d++){var c=e[d];c.rep=this.getCompressedRep(c.rep,i);var l=!!(f=c.globalMatrix)&&!f.isIdentity();switch(c.type){case t._InfiniteGeomertryType.AXIS_SYSTEM:(n=c.axis).rep=c.rep,f=c.globalMatrix,l&&(a.set(n.origin[0],n.origin[1],n.origin[2]),o.set(n.xAxis[0],n.xAxis[1],n.xAxis[2]),p.set(n.yAxis[0],n.yAxis[1],n.yAxis[2]),h.set(n.zAxis[0],n.zAxis[1],n.zAxis[2]),s.makeBasis(o,p,h),s.setPosition(a),s.multiply(f),n.origin=[s.elements[12],s.elements[13],s.elements[14]],n.xAxis=[s.elements[0],s.elements[1],s.elements[2]],n.yAxis=[s.elements[4],s.elements[5],s.elements[6]],n.zAxis=[s.elements[8],s.elements[9],s.elements[10]]),e[d]={params:n,type:t._InfiniteGeomertryType.AXIS_SYSTEM};break;case t._InfiniteGeomertryType.REF_PLANE:for(var m=[],v=c.refPlanes,y=0;y<v.length;y++){var g=v[y];g.rep=c.rep,l&&(a.set(g.origin[0],g.origin[1],g.origin[2]),o.set(g.xAxis[0],g.xAxis[1],g.xAxis[2]),p.set(g.yAxis[0],g.yAxis[1],g.yAxis[2]),h.crossVectors(o,p),s.makeBasis(o,p,h),s.setPosition(a),s.multiply(f),g.origin=[s.elements[12],s.elements[13],s.elements[14]],g.xAxis=[s.elements[0],s.elements[1],s.elements[2]],g.yAxis=[s.elements[4],s.elements[5],s.elements[6]]),m.push(g)}e[d]={params:m,type:t._InfiniteGeomertryType.REF_PLANE};break;case t._InfiniteGeomertryType.ARROWS:var x=c.arrows,B=[];for(y=0;y<x.length;y++){var A=x[y];A.rep=c.rep,l&&(a.set(A.origin[0],A.origin[1],A.origin[2]),u.set(A.direction[0],A.direction[1],A.direction[2]),a.applyMatrix4(f),u.applyRotation(f),A.origin=[a.x,a.y,a.z],A.direction=[u.x,u.y,u.z]),B.push(A)}e[d]={params:B,type:t._InfiniteGeomertryType.ARROWS};break;case t._InfiniteGeomertryType.VOXEL_REP:e[d]={params:{voxelRep:c.voxelRep},type:t._InfiniteGeomertryType.VOXEL_REP};break;case t._InfiniteGeomertryType.GAUSSIAN_SPLAT_REP:e[d]={params:{splatBuffer:c.splatBuffer,splatMatrix:c.splatMatrix},type:t._InfiniteGeomertryType.GAUSSIAN_SPLAT_REP}}}},this.applyGlobalMatrixAxis=function(e,r){for(var i=null,n=new t.Matrix4,s=new t.Vector3,a=new t.Vector3,o=new t.Vector3,p=new t.Vector3,h=0;h<e.length;h++){i=e[h].axis;var u=e[h].globalMatrix;!!u&&!u.isIdentity()&&(s.set(i.origin[0],i.origin[1],i.origin[2]),a.set(i.xAxis[0],i.xAxis[1],i.xAxis[2]),o.set(i.yAxis[0],i.yAxis[1],i.yAxis[2]),p.set(i.zAxis[0],i.zAxis[1],i.zAxis[2]),n.makeBasis(a,o,p),n.setPosition(s),n.multiply(u),i.origin=[n.elements[12],n.elements[13],n.elements[14]],i.xAxis=[n.elements[0],n.elements[1],n.elements[2]],i.yAxis=[n.elements[4],n.elements[5],n.elements[6]],i.zAxis=[n.elements[8],n.elements[9],n.elements[10]]),e[h]=i}},this.applyGlobalMatrixArrows=function(e,r){new t.Matrix4;for(var i=new t.Vector3,n=new t.Vector3,s=0;s<e.length;s++){for(var a=[],o=e[s].arrows,p=0;p<o.length;p++){var h=o[p],u=e[s].globalMatrix;!!u&&!u.isIdentity()&&(i.set(h.origin[0],h.origin[1],h.origin[2]),n.set(h.direction[0],h.direction[1],h.direction[2]),i.applyMatrix4(u),n.applyRotation(u),h.origin=[i.x,i.y,i.z],h.direction=[n.x,n.y,n.z]),a.push(h)}e[s]=a}},this.applyGlobalMatrixRefPlanes=function(e,r){for(var i=new t.Matrix4,n=new t.Vector3,s=new t.Vector3,a=new t.Vector3,o=new t.Vector3,p=0;p<e.length;p++){for(var h=[],u=e[p].refPlanes,f=0;f<u.length;f++){var d=u[f],c=e[p].globalMatrix;!!c&&!c.isIdentity()&&(n.set(d.origin[0],d.origin[1],d.origin[2]),s.set(d.xAxis[0],d.xAxis[1],d.xAxis[2]),a.set(d.yAxis[0],d.yAxis[1],d.yAxis[2]),o.crossVectors(s,a),i.makeBasis(s,a,o),i.setPosition(n),i.multiply(c),d.origin=[i.elements[12],i.elements[13],i.elements[14]],d.xAxis=[i.elements[0],i.elements[1],i.elements[2]],d.yAxis=[i.elements[4],i.elements[5],i.elements[6]]),h.push(d)}e[p]=h}},this.computePrimBS=function(e){if($n.withPrimBoundingElement)for(var t=0;t<e.length;t++)for(var r=e[t],i=r.vertexPositionArray,n=r.vertexIndexArray,s=0;s<r.drawingGroups.length;s++){var a=r.drawingGroups[s];if(0!==a.glType)for(var o=0;o<a._primitives.length;o++){var p=a._primitives[o];if(!p.boundingSphere){for(var h=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],u=[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE],f=p.start;f<p.start+p.count;f++){var d=n[f];i[3*d]<h[0]&&(h[0]=i[3*d]),i[3*d+1]<h[1]&&(h[1]=i[3*d+1]),i[3*d+2]<h[2]&&(h[2]=i[3*d+2]),i[3*d]>u[0]&&(u[0]=i[3*d]),i[3*d+1]>u[1]&&(u[1]=i[3*d+1]),i[3*d+2]>u[2]&&(u[2]=i[3*d+2])}var c=(h[0]-u[0])*(h[0]-u[0]);c+=(h[1]-u[1])*(h[1]-u[1]),c+=(h[2]-u[2])*(h[2]-u[2]),c=.5*Math.sqrt(c);var l={center:[.5*(h[0]+u[0]),.5*(h[1]+u[1]),.5*(h[2]+u[2])],radius:c};p.boundingSphere=l}}}},this.createSSBBoxPosition=function(t){for(var r=[],i=[],n=0,s=0;s<t.length;s+=6,n+=8){var a=t[2*s],o=t[2*s+1],p=t[2*s+2],h=t[2*s+3],u=t[2*s+4],f=t[2*s+5];r.push(a),r.push(o),r.push(p),r.push(a),r.push(o),r.push(f),r.push(h),r.push(o),r.push(f),r.push(h),r.push(u),r.push(f),r.push(a),r.push(u),r.push(f),r.push(a),r.push(u),r.push(p),r.push(h),r.push(u),r.push(p),r.push(h),r.push(o),r.push(p),i.push(n),i.push(n+1),i.push(n+7),i.push(n+1),i.push(n+2),i.push(n+7),i.push(n+4),i.push(n+0),i.push(n+5),i.push(n+4),i.push(n+1),i.push(n),i.push(n+4),i.push(n+3),i.push(n+1),i.push(n+3),i.push(n+2),i.push(n+1),i.push(n+2),i.push(n+3),i.push(n+6),i.push(n+2),i.push(n+6),i.push(n+7),i.push(n),i.push(n+7),i.push(n+6),i.push(n),i.push(n+6),i.push(n+5),i.push(n+3),i.push(n+4),i.push(n+5),i.push(n+3),i.push(n+5),i.push(n+6)}var d=new e.Mesh,c=new e.GraphicAttributeSet(251658274,-1);c.setBasic(),c.setRGBAColorAlphaChannel(50);var l=new e.DrawingGroup(c,null,4,0,i.length/3),m=new e.MeshPrimitive(0,l,0,n);l._primitives.push(m),d.drawingGroups.push(l),d.vertexIndexArray=i,d.vertexPositionArray=r,d.gas=c;return d.AABB={min:[100,100,100],max:[100,100,100]},d},this.processAllReps=function(e,r,i,n,s,a,o){var p=[],h=e.length,u=new t.Vector3,f=!0,d=3;$n.withRepBoundingElement&&(d+=4),$n.withSAG&&(d+=1);for(var c=0;c<h;c++){var l=[],m=e[c].getArray();if(m.length&&(f=!1),1&c||8&c)this.computePrimBS(m),this.applyGlobalMatrixStatic(m,r,s,n),this.batch_static(m,l,r,i);else{this.computePrimBS(m),this.applyGlobalMatrix(m,r,s,n);for(var v=0;v<m.length;v++){var y=m[v],g=y.AABB.min,x=y.AABB.max;u.x=x[0]-g[0],u.y=x[1]-g[1],u.z=x[2]-g[2],$n.withRepBoundingElement&&(n.tab[d*y.rep+d-4]=.5*u.length(),n.tab[d*y.rep+d-3]=.5*g[0]+.5*x[0],n.tab[d*y.rep+d-2]=.5*g[1]+.5*x[1],n.tab[d*y.rep+d-1]=.5*g[2]+.5*x[2]),$n.smartStaticBatching&&(m[v]._radius=.5*u.length())}o&&o.length&&m.push(this.createSSBBoxPosition(o)),this.batch(m,l,r,i)}p.push(l)}return f&&($n.flexibleBatching||Jn)?{meshes:null,cullingData:a}:(a&&a.tab.sort((function(e,t){return t-e})),{meshes:p,cullingData:a})},this.batch=function(t,r,i,n){var s=function(e,t){e.min[0]>t.min[0]&&(e.min[0]=t.min[0]),e.min[1]>t.min[1]&&(e.min[1]=t.min[1]),e.min[2]>t.min[2]&&(e.min[2]=t.min[2]),e.max[0]<t.max[0]&&(e.max[0]=t.max[0]),e.max[1]<t.max[1]&&(e.max[1]=t.max[1]),e.max[2]<t.max[2]&&(e.max[2]=t.max[2])},a={withSceneGraphOrder:1==$n.sceneGraphOrder,containNoShow:!1,withSAG:$n.withSAG,withBoundingElement:$n.withPrimBoundingElement},o=[],p=null,h=0,u=65535;$n.uint32Index&&(u=524287),a.withSceneGraphOrder&&(u=4294967295);for(var f=0;f<t.length;f++)if(!t[f].disable&&!t[f].positionCompression&&!t[f].normalCompression&&t[f].vertexPositionArray&&(this.FTA||$n.forceNoShowCGR||!t[f].noShow)){if(p?s(p,t[f].AABB):p=t[f].AABB,h+t[f].vertexPositionArray.length/3>=u){if(0==h){for(var d=e.divideRep(t[f],!0,a),c=0;c<d.length;c++)r.push(d[c]);p=null;continue}(v=e.processRepsCGR(o,!0,$n.smartStaticBatching,a,i,n)).AABB={min:p.min,max:p.max},p=null,r.push(v),h=0,o=[]}if(t[f].vertexPositionArray.length/3>=u){for(d=e.divideRep(t[f],!0,a),c=0;c<d.length;c++)r.push(d[c]);p=null}else o.push(t[f]),h+=t[f].vertexPositionArray.length/3}for(f=0;f<t.length;f++)if(!t[f].disable&&!t[f].positionCompression&&!t[f].normalCompression&&t[f].vertexPositionArray&&!this.FTA&&!$n.forceNoShowCGR&&t[f].noShow&&$n.withSceneGraph){if(a.containNoShow=!0,h+t[f].vertexPositionArray.length/3>=u){if(0==h){for(d=e.divideRep(t[f],!0,a,n),c=0;c<d.length;c++)r.push(d[c]);p=null;continue}p||(p={min:[0,0,0],max:[0,0,0]}),(v=e.processRepsCGR(o,!0,$n.smartStaticBatching,a,i,n)).AABB={min:p.min,max:p.max},p=null,r.push(v),h=0,o=[]}if(t[f].vertexPositionArray.length/3>=u){for(d=e.divideRep(t[f],!0,a),c=0;c<d.length;c++)r.push(d[c]);p=null}else o.push(t[f]),h+=t[f].vertexPositionArray.length/3}o.length>0&&(p||(p={min:[0,0,0],max:[0,0,0]}),(v=e.processRepsCGR(o,!0,$n.smartStaticBatching,a,i,n)).AABB={min:p.min,max:p.max},v.AABB.min[0]==v.AABB.max[0]&&v.AABB.min[1]==v.AABB.max[1]&&v.AABB.min[2]==v.AABB.max[2]&&(v.AABB.min[0]-=.1,v.AABB.min[1]-=.1,v.AABB.max[0]+=.1,v.AABB.max[1]+=.1),r.push(v));o=[],p=null,h=0;var l=0,m=0;for(f=0;f<t.length;f++)if(!t[f].disable&&(t[f].positionCompression||t[f].normalCompression)&&(m=t[f].normalCompression,l=t[f].positionCompression,t[f].vertexPositionArray&&(this.FTA||!t[f].noShow))){if(p?s(p,t[f].AABB):p=t[f].AABB,h+t[f].vertexPositionArray.length/4>=u){if(0==h){for(d=e.divideRep(t[f],!0,a),c=0;c<d.length;c++)r.push(d[c]);p=null;continue}var v;(v=e.processRepsCGR(o,!0,$n.smartStaticBatching,a,i,n,l,m)).AABB={min:p.min,max:p.max},p=null,r.push(v),h=0,o=[]}if(t[f].vertexPositionArray.length/4>=u){for(d=e.divideRep(t[f],!0,a),c=0;c<d.length;c++)r.push(d[c]);p=null}else o.push(t[f]),h+=t[f].vertexPositionArray.length/4}o.length>0&&(p||(p={min:[0,0,0],max:[0,0,0]}),(v=e.processRepsCGR(o,!0,$n.smartStaticBatching,a,i,n,l,m)).AABB={min:p.min,max:p.max},v.AABB.min[0]==v.AABB.max[0]&&v.AABB.min[1]==v.AABB.max[1]&&v.AABB.min[2]==v.AABB.max[2]&&(v.AABB.min[0]-=.1,v.AABB.min[1]-=.1,v.AABB.max[0]+=.1,v.AABB.max[1]+=.1),r.push(v))},this.batch_static=function(t,r,i){for(var n=function(e,t){if(!e||!t)return!e&&!t;for(var r=0;r<16;r++)if(e.elements[r]!=t.elements[r])return!1;return!0},s=[],a=0;a<t.length;a++){for(var o=!1,p=t[a],h=0;h<s.length;h++)if(n(p.attachedPoint,s[h].attachedPoint)){s[h].reps.push(p),o=!0;break}if(!o){var u=[p];s.push({attachedPoint:p.attachedPoint,reps:u})}}for(a=0;a<s.length;a++){var f=e.processRepsCGR(s[a].reps,!1,!1,{containNoShow:!1,withSAG:$n.withSAG,withBoundingElement:$n.withPrimBoundingElement},i),d=[];f.AABB.min[0]==f.AABB.max[0]&&f.AABB.min[1]==f.AABB.max[1]&&f.AABB.min[2]==f.AABB.max[2]&&(f.AABB.min[0]-=.1,f.AABB.min[1]-=.1,f.AABB.max[0]+=.1,f.AABB.max[1]+=.1),d.push(f),r.push({tab:d,globalMatrix:s[a].attachedPoint})}},this.addChildHybrid=function(e){var t=e.node;if(e.children){e.externalPath&&(t.externalPath=!0);for(var r=e.children.length,i=0;i<r;i++){var n=e.children[i].node;t.children.push(n),n.added||(n.added=!0,n.type&&(n.parent=t,this.addChildHybrid(e.children[i])))}}},this.buildSceneGraph=function(e){e.axisSystems,e.refPlanes,e.arrows;var t=e.texts;this.applyGlobalInfiniteGeomMatrix(e.infiniteGeometries,$n.flexibleBatching,e.sgRep);var r=this.processAllReps(e.reps,e.materials,e.dgs,e.sgRep,!1,e.cullingData,e.ssbBoxPosition),i=r.meshes,n=r.cullingData,s=null,a=-1,o=[i];if($n.flexibleBatching||Jn){if(i)a={indice:e.batches.add(i)};e.rep&&(this.addChildHybrid(e.rep),s=e.rep.node),o=e.batches.getArray()}else $n.withSceneGraph&&e.rep&&(this.addChild(e.rep),s=e.rep.node);return{reps:o,sceneGraph:s,resource:e.resource,material:e.materials,sgRep:e.sgRep.tab,rootBatch:a,decorations:e.decorations,curvedPipes:e.curvedPipes,infiniteGeometries:e.infiniteGeometries,sag:e.sag,texts:t,cullingData:n,compressedArray:e.compressedArray,compound:Jn}},this.init=function(e){var t=null;t=e||new ye(es.fileBuffer.clone()),es.streamer=t;var r=t.readString(6),i=t.readString(2);if(es.version=i[0],5==es.version&&(Jn=!0,es.CATCurrentMode=33792),"V5_CFV"!=r)return this.isV5=!1,{mesh:[],resource:[],material:[],excludeReps:[]};Yn=3==es.version?0:1,t.conversion=!0;var n=t.readUncompressedInt(!0),s=t.readUncompressedInt(!0);t.skip(8),t.skip(32);t.readUncompressedInt(!0);if(t.skip(4),Yn&&!t.setCurrentPosition(n))return{error:"file corrupted"};i=t.readString(16),t.readUnsignedChar(),t.readUnsignedShort(!0),t.readUnsignedShort(!0),t.readUnsignedShort(!0);var a=t.readUnsignedChar(),o=t.readUnsignedChar(),p=(t.readUnsignedChar(),t.readUnsignedChar(),t.readUncompressedInt(!0),t.readUncompressedInt(!0),t.readUncompressedInt(!0),t.readUncompressedInt(!0),t.readUnsignedChar()),h=t.readUnsignedChar(),u=(t.readUnsignedShort(!0),t.getUInt32FromBytes(o,a,h,p));if(t.skip(17),Yn)es.blocReader=new Be(t,u);else{var f=new Uint8Array(384+s);t.readBytes(384,f);var d=new Uint8Array(s);t.setCurrentPosition(n),t.readBytes(s,d),f.set(d,384);var c=new ye(new byteArrayReader(f));c.conversion=!0,es.blocReader=new Be(c,u)}return t.conversion=!1,!0},this.getApplicativeContainer=function(e,t){var r=0,i=0,n={},s=!1;if(t){if((a=this.getRootContainer()).unstreamHeaderCGR(),a.header.version>=210042400&&(s=!0),Yn){if(s)r=a.header.version,i=a.header.conversion;else r=(o=a.getChildContainer("SceneGraph")).header.version,i=o.header.conversion}else{if(!(d=a.getChildContainer("MAIN")).header){c=this.getEntryStreamer(d.tocEntry);if(d.unstreamHeaderUVR(c))return null}r=d.header.version,i=d.header.conversion}}else{this.init();var a;(new Date).getTime();if((a=this.getRootContainer()).unstreamHeaderCGR(),a.header.version>=210042400&&(s=!0),Yn){var o;if(s)r=a.header.version,i=a.header.conversion;else(o=a.getChildContainer("SceneGraph")).unstreamHeaderCGR(),r=o.header.version,i=o.header.conversion}else{for(var p=this.getEntryStreamer(a.tocEntry),h=(p.readUncompressedInt(!1),p.readUncompressedInt(!1),p.readUncompressedInt(!1)),u=0;u<h;u++){p.readUncompressedInt(!1),p.readUncompressedInt(!1),p.readUnsignedShort(!1);var f=p.readUncompressedInt(!1);this.name=p.readUnicodeString(f/2)}var d=a.getChildContainer("MAIN"),c=this.getEntryStreamer(d.tocEntry);d.unstreamHeaderUVR(c),r=d.header.version,i=d.header.conversion}}var l=a.getChildContainer("Applicative Containers");if(!l)return null;var m=l.getChildContainer(e);if(!m)return null;var v=m.getChildContainer("MainDataStream");if(!v)return null;var y=this.getBufferFromEntry(v.tocEntry);if(0==y.length)return null;if("V4V5_FDT"===e){var g=this.getEntryStreamer(v.tocEntry);Yn||(g.bitBoolean=1,g.bitPacking=1,g.gasPacking=1),g.version=r,g.conversion=i;var x=g.readCompressedInt(),B=g.readCompressedInt();if(n.oldSize=x,n.compressed=B,n.offset=g.getCurrentPosition(),g.skip(B),g.getBytesRemain()){g.readCompressedInt();n.oldSize=g.readCompressedInt(),n.compressed=g.readCompressedInt(),n.offset=g.getCurrentPosition()}}(new Date).getTime();return{buffer:y,options:n}},this.open=function(t,r,i){Kn=this;var s=this.init();if(s&&s.error)return s;if(t&&(Yn=0),!this.isV5&&!r)return console.log("warning cgr version not supported or corrupted file"),{error:"cgr version not supported or corrupted file"};n=!1;(new Date).getTime();var a=this.getRootContainer();if(a.unstreamHeaderCGR(),F=0,O=0,N=0,G=!1,dt={x:0,y:0,z:0},ct={x:0,y:0,z:0},qn=!1,a.header.version>=210042400){qn=!0;a.header.readUncompressedInt(),a.header.readUncompressedInt();var o=a.header.readUncompressedInt();if(a.header.skip(o),a.header.version>=210042410){if(a.header.readBoolean())switch(a.header.readUnsignedChar()){case T:break;case U:var p=a.header.readUnsignedChar();p&e.CATSGPlayRepDataOptions.QuantBBoxPerGP&&(F=e.CATSGPlayRepDataOptions.QuantBBoxPerGP),p&e.CATSGPlayRepDataOptions.BBoxPerRep&&(F=e.CATSGPlayRepDataOptions.BBoxPerRep),a.header.version>=210042415&&(p&e.CATSGPlayRepDataOptions.PositionBoxCompression&&(O=e.CATSGPlayRepDataOptions.PositionBoxCompression),p&e.CATSGPlayRepDataOptions.NormalOct16Compression&&(N=e.CATSGPlayRepDataOptions.NormalOct16Compression),p&e.CATSGPlayRepDataOptions.NormalOct24Compression&&(N=e.CATSGPlayRepDataOptions.NormalOct24Compression))}Qn=(new at).unstream(a.header)}}var h=a.getChildContainer("Skeleton"),u=null,f=null;if(!Yn&&h){var d=this.getEntryStreamer(a.tocEntry);d.conversion=!0;d.readUncompressedInt(!1),d.readUncompressedInt(!1);for(var c=d.readUncompressedInt(!1),l=0;l<c;l++){d.readUncompressedInt(!1),d.readUncompressedInt(!1),d.readUnsignedShort(!1);var m=d.readUncompressedInt(!1);this.name=d.readUnicodeString(m/2)}d.conversion=!1;var v=a.getChildContainer("MAIN"),y=this.getEntryStreamer(v.tocEntry);if(D=v.unstreamHeaderUVR(y))return D;var g=a.getChildContainer("Options"),x=this.getEntryStreamer(g.tocEntry);if(x.setContainer(a),x.readUnsignedChar()>=5)x.readUnsignedChar();if(!h)return null;(f=this.getEntryStreamer(h.tocEntry)).setContainer(a),f.version=v.header.version,f.conversion=v.header.conversion,f.bitBoolean=1,f.bitPacking=1,f.gasPacking=1;var B=f.readClassName();u=f.getUnstreamer(B).unstream(f)}else{if(a.header.version>=210042630){var A=a.getChildContainer("COMPOUND");if(A){var I=A.getStreamerByName("COMPOUND");if(I){var b=es;I.skip(9);var C=I.readUncompressedULong();if(C>0){for(var S=0;S<C;++S){es=b;var w=I.readUncompressedULong(),P=I.readUncompressedULong(),M=I.readUncompressedULong(),R=I.readUncompressedULong();R&&I.readBytes(R,[]);var E=A.getSubArrayByName("COMPOUND_"+w);if(E){es={streamer:null,fileBuffer:new byteArrayReader(E),version:null,blocReader:null,rootContainer:null,CATCurrentMode:0};f=this.open(t,!0);ts.set(w,{subCGROffset:P,subCGRSize:M,streamer:f,rootContext:es})}}es=b}}}}var D,L=a,k="SceneGraph";if(qn||(L=a.getChildContainer("SceneGraph"),k="MainDataStream"),!L)return{error:"scene graph container missing "};if(D=L.unstreamHeaderCGR("SceneGraph"))return D;f=L.getStreamerByName(k,qn);if(r)return f;B=f.readClassName();u=f.getUnstreamer(B).unstream(f)}f.check();var V=[];return(1==$n.sceneGraphOrder||$n.sceneGraphOrderPriority)&&(V=f.processedMergeDGs(),f.popSceneGraphOrderParameters()),this.buildSceneGraph({curvedPipes:f.curvedPipes.getArray(),infiniteGeometries:f.infiniteGeometries.getArray(),texts:f.texts.getArray(),resource:f.textures.getArray(),materials:f.materials.getArray(),sgRep:f.sgReps,decorations:f.decorations.getConcatenatedBlocks(),reps:f.popReps(),batches:f.batches,rep:u,compressedArray:f.compressedArrayInfo.tab,dgs:V,sag:Qn?Qn.sag3D:0,cullingData:f.getCullingBuffer(),ssbBoxPosition:f.getSsbBoxPosition()})},this.unstreamCompositeRing=function(e){let t=e.readUncompressedUInt(),r=[];for(let i=0;i<t;++i){let t={tableid:-1,externalIdx:-1};t.tableid=e.readShort(),t.externalIdx=e.readCompressedUInt(),r.push(t)}return r},this.skipChannel=function(e,t){let r=e.getCurrentPosition();r+=t,e.setCurrentPosition(r)},this.unstreamHyperlinks=function(e){let t=new Map,r=e.readUncompressedUInt();for(let i=0;i<r;i++){let r,i=e.readUncompressedUInt(),n="";for(;"\0"!==r;)r=e.readUnsignedChar(),n+=r;t.set(i,n)}return t},this.unstreamSGComposites=function(e){e.readUncompressedUInt(),e.readUncompressedUInt(),e.readUncompressedUInt();let t=e.readUnsignedShort(),r=[];for(let i=0;i<t;++i){let t={};t.id=e.readUnsignedShort(),t.gui=[],t.gui[0]=e.readUncompressedInt(),t.gui[1]=e.readUnsignedShort(),t.gui[2]=e.readUnsignedShort(),t.gui[3]=[],e.readBytes(8,t.gui[3]),t.version=e.readUnsignedShort(),r.push(t)}let i=e.readUnsignedShort(),n=[];for(let t=0;t<i;++t){let t={};t.mainid=e.readUnsignedShort(),t.otherid=e.readUnsignedShort(),n.push(t)}for(let t=0;t<i;++t){let r=n[t],i=e.readUncompressedUInt();switch(t){case 0:if(r.composites=this.unstreamHyperlinks(e,i),!r.composites||0===r.composites.length)return[];break;case 1:case 2:default:this.skipChannel(e,i);break;case 3:r.composites=this.unstreamCompositeRing(e)}}return this.buildCompositeRings(n)},this.buildCompositeRings=function(e){let t=e[0],r=[];for(let i=0;i<t.length;++i){let n={composite:null};for(let r=0;t[i].length;++r){let s=t[i][r].tableid,a=t[i][r].externalIdx;n.composite=e[s].composites[a]}r.push(n)}return r},this.openSceneGraph=function(e,t,r){this.FTA=!0,n=!0,r&&(r.processText&&($n.processText=!0),r.withBlankingRep&&($n.withBlankingRep=!0));var i=new rs;i.setFromBuffer(e);var s=new ye(i);s.version=1101410;s.readBytes(12,[]);var a=s.readUnsignedChar();s.conversion=!a,s.version=s.readCompressedInt();var o=s.readClassName(),p=s.getUnstreamer(o).unstream(s);if(s.error&&t)return t(s.error),{reps:[],sceneGraph:null,resource:[],material:[],infiniteGeometries:[],texts:[]};s.check();var h=this.buildSceneGraph({curvedPipes:s.curvedPipes.getArray(),infiniteGeometries:s.infiniteGeometries.getArray(),texts:s.texts.getArray(),resource:s.textures.getArray(),materials:s.materials.getArray(),sgRep:s.sgReps,decorations:s.decorations.getConcatenatedBlocks(),reps:s.popReps(),batches:s.batches,compressedArray:s.compressedArrayInfo.tab,rep:p,cullingData:s.getCullingBuffer(),ssbBoxPosition:s.getSsbBoxPosition()});return p.node.noShow&&$n.withSceneGraph&&(h.sceneGraph.noShow=!0),$n.withSceneGraph?h:{mesh:h.reps[0],resource:h.resource,material:h.material,curvedPipes:h.curvedPipes,infiniteGeometries:h.infiniteGeometries,texts:h.texts,excludeReps:h.reps[2]}},this.setThicknessTable=function(t){e.ThicknessTable=t},this.getBufferFromEntry=function(e){for(var t=0,r=e.blocReader.blocs,i=0;i<r.length;++i)t+=r[i].length;var n=new Uint8Array(t),s=0;for(i=0;i<r.length;++i)for(var a=r[i],o=0;o<a.length;++o)n[s]=es.fileBuffer.buffer[a.offset+o],s++;return n},this.getRootContainer=function(){return es.rootContainer||(es.rootContainer=new Hn(this,es.blocReader.getRootTocEntry()),es.rootContainer.name="MAIN"),es.rootContainer},this.getStreamer=function(e,t){var r=es.blocReader.getChildEntry(e,t);if(null==r)return null;for(var i=new rs(es.fileBuffer.clone()),n=0;n<r.blocReader.blocs.length;++n)i.addBloc(r.blocReader.blocs[n]);var s=new ye(i);return s.name=t,s},this.getEntryStreamer=function(e){for(var t=new rs(es.fileBuffer.clone()),r=0;r<e.blocReader.blocs.length;++r)t.addBloc(e.blocReader.blocs[r]);return new ye(t)},this.getChildContainer=function(e,t){var r=es.blocReader.getChildEntry(e,t);if(r)return new Hn(this,r)}}})),define("Formats/CGRFile",["DS/Formats/CGRFile","DS/DSMigration/DSMigration"],(function(e,t){return t.deprecateModule("Formats/CGRFile"),e}));