define("DS/DMU3DReviewController/DMU3DReviewController",["UWA/Class","DS/DMUControls/EXPNotify","DS/DMUReadPersistence/DMULoadMarkupServices","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPManagerSet","DS/CATWebUXComponents/DMUCommandsManager","DS/PADUtils/views/PADProgressBar","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Selection/PSOManager","DS/CoreEvents/ModelEvents","DS/DMUBaseUIControllers/DMU2DSheetManager","DS/DMUBaseUIControllers/DMUCommentsController","DS/DMUPlaySlide/controllers/DMUSlideShowController","DS/DMUBaseUIControllers/DMUApplicativeContextManager","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/DMUReadPersistence/DMUWebServicesUtils","DS/DMUBaseUIServices/DMUSlidePreferences","DS/DMUPersistence/DMUSaveServices","DS/DMUPersistence/DMUDOSThumbnailServices","DS/DMUControls/DMUInfoModalDiv","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/CATWebUXComponents/CATWebUXUtils","DS/DMUBaseExperience/EXPUtils","DS/DMUReadPersistence/DMULoadingContextController","DS/DMUPlayMarker/DMUMarkerFactory","DS/DMUPlayMarker/DMUMarkerServices","DS/DMUBaseExperience/DMUToolsClipping","DS/DMUBaseExperience/EXPToolsVisualization","DS/CATWebUXSelectionManager/CATWebUXSelectionManager","DS/DMUBaseUIControllers/DMUSceneDisplayController","DS/PADServices/utils/GlobalModelEvents","DS/CATWebUXSlideDrop/CATWebUXSlideDropServices","DS/DMUControls/DMUToolsSave","DS/DMUBaseUIControllers/DMUReqCompareController","DS/DMUBaseExperience/EXPToolsContext","i18n!DS/DMU3DReviewController/assets/nls/DMU3DReviewController","i18n!DS/CATWebUXTIC/assets/nls/CATWebUXTICCmdAdapt"].concat(["i18n!DS/DMUBaseUIComponents/assets/nls/DMUBaseUIComponents"]),(function(e,t,n,o,r,i,a,s,l,c,d,u,g,p,m,f,C,D,v,h,M,S,R,P,b,y,U,x,I,A,w,T,V,E,O,k,L,_,F,W,H,B){"use strict";var j=e.extend({init:function(j){let X;this._parent(j);var N,q,G,z=!1,Q=(j||{}).ctxViewer,J=this,Y=new u,K={},Z=null,$={},ee={};let te=null;var ne,oe,re,ie,ae,se,le,ce,de,ue,ge,pe,me,fe,Ce,De,ve,he,Me,Se=!1,Re=!0,Pe=!1,be=!1;let ye,Ue,xe,Ie,Ae,we=!1,Te=0,Ve=!1,Ee=!0;const Oe=["SIMItfSimulation","PLMPIMMetricReference","Document","Specification Report","DIFLayout","DIFSheet","DIFAnnotationSet","Requirement","Requirement Specification","DesignSight","DELLmiWorkPlanSystemReference","DELLmiHeaderWorkPlanReference","FailureModesEffectsAnalysis"];function ke(e,n){X&&(X.destroy(),X=null),X=new t({body:Q.getFrameWindow().getUIFrame(),type:e,message:n})}function Le(){for(var e,t=[],n=l.get(),r=!1,i=null,a=!1,c=0;c<n.length;c++){for(e=n[c].pathElement.clone();e&&e.internalPath.length;)e=e.getParentPath();if(e.getLastElement(!0).getAnnotationClassType||e.getLastElement(!0).getDMUType)return Q.getExecutionContext?{WAfrCtxBarRow1:void 0}:{cmdList:[]};(i=s.getLastReference(e))&&s.isReference(i.getLastElement(!0))?r=!0:i=null}var d=n[n.length-1],u=function(e,t){return e.x>=t.x-3&&e.x<=t.x+3&&e.y>=t.y-3&&e.y<=t.y+3};if(Re&&n.length&&ne&&!ne.isADocumentDisplayed()){d&&d.event&&d.event.lastPosition&&d.event.startPosition&&u(d.event.startPosition,d.event.lastPosition)&&d.pathElement.externalPath.length>2&&d.pathElement.externalPath[0]===Q.getRootBagPath().getLastElement(!0)&&(a=!0);var g=o.getReviewContext({context:Q}),p=g?g.getCurrentSessionMarkup():null;let e="3D"===oe||"ITF"===oe;if(p&&p.getActiveFlag()&&!p.isReadOnly()&&p.isVisible()&&p.getCurrentSlide()){if(r&&e&&t.push({name:"DMUHideShowOverloadStr",line:1,hdr_list:["DMUHideShowOverloadHdr"],type:"handler",identifier:"DMUHideShowOverloadHdr"}),i&&i.externalPath&&i.externalPath.length&&e){var m=E.getDMUSceneDisplayController({context:Q});m&&!m.getCurrentComparedObjectIDPaths()&&t.push({name:"DMUColorOpacityOverloadStr",line:1,hdr_list:["DMUColorOpacityOverloadHdr"],type:"handler",identifier:"DMUColorOpacityOverloadHdr"}),t.push({name:"DMUPositionOverloadStr",line:1,hdr_list:["DMUPositionOverloadHdr"],type:"handler",identifier:"DMUPositionOverloadHdr"})}}else r&&e&&t.push({name:"HideShowStr",line:1,hdr_list:["HideShowHdr"],type:"handler",identifier:"ENO3DHideShowCmd"});a&&e?t.push({name:"DMULevelSelectorStr",line:1,hdr_list:["DMULevelSelectorHdr"],type:"handler",identifier:"DMULevelSelectorHdr"}):1===n.length&&d&&d.pathElement&&d.pathElement.getParentPath().isEqual(Q.getRootBagPath())&&e&&t.push({name:"RemoveRootStr",line:1,hdr_list:["RemoveRootHdr"],type:"handler",identifier:"ENO3DRemoveRootCmd"})}return"DIFLayout"!==fe&&"DIFSheet"!==fe||d&&d.event&&d.event.lastPosition&&d.event.startPosition&&u(d.event.startPosition,d.event.lastPosition)&&d.pathElement.externalPath.length>2&&d.pathElement.externalPath[0]===Q.getRootBagPath().getLastElement(!0)&&t.push({name:"DMULevelSelectorStr",line:1,hdr_list:["DMULevelSelectorHdr"],type:"handler",identifier:"DMULevelSelectorHdr"}),Q.getExecutionContext?{WAfrCtxBarRow1:{model:t}}:{cmdList:t}}function _e(e,t){var n=[],i=[],a=[],c=Boolean(Q.getExecutionContext);if(ie&&ie.getActiveState())return c?n:{cmdList:n};var u=o.getReviewContext({context:Q}),g=l.get(),p=!ne||ne&&!ne.isADocumentDisplayed(),m=r.getManager({name:"DMUUserExperienceManager",context:Q.getFrameWindow()}),f=t?{x:t.XmousePositionWithDevPxRatio,y:t.YmousePositionWithDevPxRatio}:{x:e.XmousePositionWithDevPxRatio,y:e.YmousePositionWithDevPxRatio};if(0===(m?m.pick(f,"mesh"):Q.getViewer().pick({xPix:f.x,yPix:f.y},"mesh",!0).path).length){var C=d.get(),D=C&&C[0]&&C[0].pathElement?C[0].pathElement.getLastElement(!0):null,v=D&&D.getDMUType?D.getDMUType():"";if("DMUSlide"===v||"DMUFormat"===v||"DMUComment"===v)return c?n:{cmdList:n};c?a.push({category:B.ctxMenuDisplayTitle,hdrs:!y.isMobile()&&p?["VisuQMCommand","ENO3DToggleStatusBarCmd"]:["ENO3DToggleStatusBarCmd"]},{category:B.ctxMenuAmbienceTitle,hdrs:["VisuPureWhiteOCACmd","VisuWhiteMirrorOCACmd","VisuWhiteReviewOCACmd","VisuWhiteExperienceOCACmd","VisuStudioOCACmd","VisuDarkMirrorOCACmd","VisuDarkReviewOCACmd","VisuWhiteDesignOCACmd","VisuBlueDesignOCACmd","VisuDarkDesignOCACmd","VisuIndoorOCACmd","VisuCityOCACmd","VisuRoadOCACmd","VisuOutdoorOCACmd","VisuBasicOCACmd"]}):n=[{line:1,name:"DMU3DReviewDisplaySubMenu",resourceFile:"DMUBaseCommands/3DPlayPro",hdr_list:!y.isMobile()&&p?["VisuQMCommand","PAD3DToggleStatusBarHdr"]:["PAD3DToggleStatusBarHdr"]},{line:1,name:"DMU3DReviewAmbiencesSubMenu",resourceFile:"DMUBaseCommands/3DPlayPro",hdr_list:["VisuPureWhiteOCACmd","VisuWhiteMirrorOCACmd","VisuWhiteReviewOCACmd","VisuWhiteExperienceOCACmd","VisuStudioOCACmd","VisuDarkMirrorOCACmd","VisuDarkReviewOCACmd","VisuWhiteDesignOCACmd","VisuBlueDesignOCACmd","VisuDarkDesignOCACmd","VisuIndoorOCACmd","VisuCityOCACmd","VisuRoadOCACmd","VisuOutdoorOCACmd","VisuBasicOCACmd"]}];let e=w.getContextaulMenuforClipping(Q,c,Me);e&&(c&&e.hdrs&&e.hdrs.length?a.push(e):n=n.concat(e))}else if(g.length){var h=u?u.getCurrentSessionMarkup():null,M=!1,S=!1,R=!1,P=h&&!h.isReadOnly()&&h.isVisible();for(let e=0;e<g.length;e++){if(h&&!h.isReadOnly()&&h.isVisible()){var b=h.getOrCreateOccurrenceOverloader(g[e]);if(!M)if(b&&b.isOverloadedInCurrentSlide())M=!0;else{let t=g[e].pathElement.clone();t.getParentPath()&&s.isInstance(t.getParentPath().getLastElement(!0))&&(b=h.getOrCreateOccurrenceOverloader({pathElement:t.getParentPath()}))&&b.isOverloadedInCurrentSlide()&&(M=!0)}}for(var U=!0,x=0;x<g[e].pathElement.externalPath.length;x++)g[e].pathElement.externalPath[x].getDMUType&&(S=!0,U=!1);U&&(R=!0)}var I=!1;if(m&&(I=m.areOccurenceOverloadsCopied()),M&&(c?i.push("DMURemoveOverloadHdr","DMUCopyHdr","DMUCutHdr"):n=n.concat([{line:1,name:"DMURemoveOverloadStr",hdr_list:["DMURemoveOverloadHdr"]},{line:1,name:"DMUCopyStr",hdr_list:["DMUCopyHdr"]},{line:1,name:"DMUCutStr",hdr_list:["DMUCutHdr"]}])),R&&I&&(c?i.push("DMUPasteHdr","DMUPasteSpecialHdr"):n=n.concat([{line:1,name:"DMUPasteStr",hdr_list:["DMUPasteHdr"]},{line:1,name:"DMUPasteSpecialStr",hdr_list:["DMUPasteSpecialHdr"]}])),!S){p?c?i.push("ENO3DFocusOnCmd"):n.push({line:1,name:"FocusOn",hdr_list:["FocusOnHdr"]}):-1!==re.indexOf("Document")&&-1!==re.indexOf("Specification Report")||(c?i.push("DMUFocusOnRepresentationHdr"):n.push({line:1,name:"FocusOn",hdr_list:["DMUFocusOnRepresentationHdr"]})),"Requirement"===re||"Requirement Specification"===re?c?i.push("WebDocumentReframeOnHdr"):n.push({line:1,name:"ReframeOn",hdr_list:["WebDocumentReframeOnHdr"]}):"Drawing"===re||"DIFLayout"===re||"DIFSheet"===re?c?i.push("DMUReframeOnRepresentationHdr"):n.push({line:1,name:"ReframeOn",hdr_list:["DMUReframeOnRepresentationHdr"]}):c?i.push("ENO3DReframeOnCmd"):n.push({line:1,name:"ReframeOn",hdr_list:["ReframeOnHdr"]});let e=!Q.getController().isRootSupported||g.length>=1&&g[0].pathElement.externalPath.length>=2&&Q.getController().isRootSupported(s.getNodeID(g[0].pathElement.externalPath[1]));if(P&&p&&e){let e,t,o=!1;for(let n=0;n<g.length;n++){for(e=g[n].pathElement.clone();e&&e.internalPath.length;)e=e.getParentPath();if(t=s.getLastReference(e),t&&s.isReference(t.getLastElement(!0))){o=!0;break}}t&&t.externalPath.length<=2&&(o=!1),o&&(c?i.push("DMUHideShowOverloadHdr"):n.push({line:1,name:"DMUHideShowOverloadStr",hdr_list:["DMUHideShowOverloadHdr"]}))}if(1===g.length&&"Drawing"!==re&&Q.getRootBagPath().isAParentOf(g[0].pathElement)&&(c?i.push("DMUNavOnImplementationLinksHdr"):n.push({name:"DMUNavOnImplementationLinksStr",line:1,hdr_list:["DMUNavOnImplementationLinksHdr"]})),c?i.push("ActionBar_Attributes"):n.push({line:1,name:"EditPropertiesCmd",hdr_list:["ActionBar_Attributes"]}),p&&e&&(c?a.push({category:B.ctxMenuQualityTitle,hdrs:["OptimizedQualityCmd","HighQualityCmd"]}):n.push({line:1,name:"PAD3DViewerToggleGeometrySection",resourceFile:"ENOPAD3DViewer/ENOPAD3DViewer",hdr_list:["PAD3DToggleSimplifiedHdr","PAD3DToggleAccurateHdr"]})),!c){let e=w.getContextaulMenuforClipping(Q,!1,Me);e&&(n=n.concat(e))}}}if(c){for(let e=0;e<i.length;e++)"ENO3DToggleStatusBarCmd"===i[e]?n.push({type:"WAfrCheckHandlerItem",handlerId:i[e]}):n.push({type:"WAfrDefaultHandlerItem",handlerId:i[e]});return a.forEach((e=>{let t={type:"PushItem",title:e.category,submenu:[]};for(let n=0;n<e.hdrs.length;n++)"ENO3DToggleStatusBarCmd"===e.hdrs[n]?t.submenu.push({type:"WAfrCheckHandlerItem",handlerId:e.hdrs[n]}):"SeparatorItem"===e.hdrs[n]?t.submenu.push({type:e.hdrs[n]}):t.submenu.push({type:"WAfrDefaultHandlerItem",handlerId:e.hdrs[n]});n.push(t)})),n}return{cmdList:n}}function Fe(e){setTimeout((function(){if(!Q)return;var t,n,a,l=o.getReviewContext({context:Q}),c=function(){for(var e=0;e<n.length;e++)(t=i.getCommand(n[e],Q.getCommandContext()))||(t=i.getCommandCheckHeader(n[e],Q.getCommandContext())),t&&(a?t.enable():t.disable())};if(Q.getExecutionContext){["Marker","Measure","Markup","Slide","Check","Highlight","Section"].forEach((e=>{o.setAuthoringFeatureTypes(e)}))}n=["DMU2DCompareCmdHdr"],a=z&&0!==Q.getViewer().getVisibleSpace()&&s.getRoots(Q).length&&(!l||l&&!l.isReadOnly())&&("Drawing"===re||"DIFSheet"===re||"DIFLayout"===re),c(),n=["DMUReqCompareCmdHdr"],a=z&&0!==Q.getViewer().getVisibleSpace()&&s.getRoots(Q).length&&(!l||l&&!l.isReadOnly())&&("Requirement"===re||"Requirement Specification"===re),c(),n=["DMUMarkupHdr","3DcompareCmdHdr","measure2DCmdHdr","measureCmdHdr","thicknessCmdHdr","DMUMeasureStackCmdHdr","DMUMeasureChainCmdHdr","DMUMeasureStack2DCmdHdr","DMUMeasureChain2DCmdHdr","DMUMeasureStackPPCmdHdr","DMUMeasureChainPPCmdHdr","DMUMeasureCoordinatesCmdHdr","DMUMeasureLengthCmdHdr","DMUMeasureDistanceCmdHdr","DMUMeasureAngleCmdHdr","DMUMeasureAreaCmdHdr","DMUMeasureVolumeCmdHdr","DMUMeasureDiameterRadiusCmdHdr","DMUMeasureCoordinates2DCmdHdr","DMUMeasureLength2DCmdHdr","DMUMeasureDistance2DCmdHdr","DMUMeasureAngle2DCmdHdr","DMUMeasureDiameterRadius2DCmdHdr","sectionCmdHdr","LockUnlockSectionHdr"],a=z&&0!==Q.getViewer().getVisibleSpace()&&s.getRoots(Q).length&&(!l||l&&!l.isReadOnly()),c(),a=(a||!s.getRoots(Q).length)&&l&&!l.isReadOnly()&&l.getCurrentSessionMarkup()&&!l.getCurrentSessionMarkup().isReadOnly(),n=["DMUEditFormatsHdr","slideCmdHdr","DMUExportReviewAsPdfHdr"],c(),a=a&&l&&!l.isReadOnly()&&l.getCurrentSessionMarkup()&&l.getCurrentSessionMarkup().getActiveFlag()&&l.getCurrentSessionMarkup().isVisible()&&l.getCurrentSessionMarkup().getCurrentSlide()&&!l.getCurrentSessionMarkup().isReadOnly(),n=["DMUSnapCmdHdr","CATWebUXSlideShowHdr","markerTextCmdHdr","markerPictureCmdHdr","marker2DTextCmdHdr","marker2DPictureCmdHdr","markerCircleCmdHdr","DMUMarkerCloudCreateHdr","DMU3DRectangleCmdHdr","DMUFreehandCmdHdr","DMUCommentCmdHdr","markerArrowCmdHdr","DMUExportMarkupAsPdfHdr","DMUExportMarkupAsImageHdr"],c(),n=["CATWebUXGenerateIssueHdr"],a=z&&0!==Q.getViewer().getVisibleSpace()&&s.getRoots(Q).length&&l&&l.getCurrentSessionMarkup()&&!we,c(),n=["CATWebUXGenerateIssueTemplateHdr","CATWebUXGenerateCAHdr","CATWebUXGenerateTaskHdr"],a=z&&0!==Q.getViewer().getVisibleSpace()&&s.getRoots(Q).length&&l&&l.getCurrentSessionMarkup(),c(),a=z&&0!==Q.getViewer().getVisibleSpace()&&s.getRoots(Q).length&&l&&l.getCurrentSessionMarkup()&&l.getCurrentSessionMarkup().getSlides().length>0||z&&s.getRoots(Q).length&&("Document"===oe||"Specification Report"===re||"Requirement"===re||"Requirement Specification"===re),n=["CATWebUXSlideShowHdr","DMUPrintHdr"],c(),a=z&&(!l||!l.isReadOnly())&&("Document"===oe||"Specification Report"===re||"Requirement"===re||"Requirement Specification"===re)&&ne&&ne.documentHasBookmarks(),n=["WebDocumentBookmarksPanelCmdHdr"],c(),a=z&&("Document"===oe||"Specification Report"===re||"Requirement"===re||"Requirement Specification"===re)&&ne&&ne.documentHasMultipleElements(),n=["WebDocumentPreviousPageCmdHdr","WebDocumentNextPageCmdHdr"],c(),a=z&&("Document"===oe||"Specification Report"===re||"Requirement"===re||"Requirement Specification"===re)&&ne&&"Document"===ne.getDocumentType(),n=["WebDocumentRotatePagesLeftCmdHdr","WebDocumentRotatePagesRightCmdHdr"],c(),a=z&&("Document"===oe||"Specification Report"===oe||"Drawing"===re)&&ne&&("Document"===ne.getDocumentType()||"Specification Report"===ne||"Drawing"===ne.getDocumentType()),n=["DMUPrintHdr"],a&&c();const d=p.giveDMUCommentsController({context:Q.getFrameWindow()});a=z&&("Document"===oe||"Specification Report"===re||"Requirement"===re||"Requirement Specification"===re)&&d&&d.hasComments(),n=["DMUPreviousCommentCmdHdr","DMUNextCommentCmdHdr"],c();var u=r.getManager({name:"DMUUserExperienceManager",context:Q.getFrameWindow()});let g;if(u&&u.refreshCommandsAvailability(),e&&e.removeRoot&&(g=!0),a=!0,"Specification Report"===oe&&!g){a=!1;let e=i.getCommandCheckHeader("RootPanel",Q.getCommandContext());e&&e.getState()&&e.setState(!1)}n=["RootPanel"],c()}))}function We(e){z&&(oe!==e&&(le&&oe&&le.removeApplicativeContainer(oe),oe=e,o.setCurrentReviewContext(oe),"Workplan"===e?(Fe(),le&&Q.getExecutionContext&&le.initApplicativeContainer(oe,{authoring:!0})):J.publish("onReviewContextModified",{type:oe,onABReady:function(){Fe(),le&&Q.getExecutionContext&&le.initApplicativeContainer(oe,{authoring:!0})}}),le&&!Q.getExecutionContext&&le.initApplicativeContainer(oe,{authoring:!0})),Fe())}function He(e,t){for(var n=[],o=s.getRoots(Q),r=0;r<o.length;r++)if(!e||s.getNodeType(o[r])===e){var i=s.getNodeID(o[r]);i!==t&&n.push(i)}Q.removeRoots({pids:n})}async function Be(e){try{let t=await v.getParentTypes(e);return[e].concat(t)}catch{return[e]}}function je(){const e=s.getRoots(Q);let t=!1;for(let n=0;n<e.length;n++){let o=s.getNodeType(e[n]),r=0,i=F.getParentType(o);if("VPMReference"===i||"VPMReference"===o||r===e.length-1)return"VPMReference"!==i&&"VPMReference"!==o||(t=!0),t;r++}}function Xe(){const e=s.getRoots(Q);let t=!1;for(let n=0;n<e.length;n++){let o=s.getNodeType(e[n]),r=0,i=F.getParentType(o);if("R2V_Activity"===i||"R2V_Activity"===o||r===e.length-1)return"R2V_Activity"!==i&&"R2V_Activity"!==o||(t=!0),t;r++}}async function Ne(e){if(!z||!e)return;var t,n,r;let i=_.giveReqCompareController({context:Q}),l=!!i&&i.isRequirementCompareActive(),c=!!i&&i.isLoading();if(c||(Me=void 0),e.path?(t=s.getNodeID(e.path.getLastElement(!0)),e.path.getLastElement(!0).userData&&(r=e.path.getLastElement(!0).userData.i3dx?e.path.getLastElement(!0).userData.i3dx:void 0),n=Q.getController().getRootStats(t)&&"r2vsurvey"===Q.getController().getRootStats(t).serviceId?"R2V_Activity":s.getNodeType(e.path.getLastElement(!0))):e.docData&&(t=e.docData.objectId,n=e.docData.objectType),!t||!n)return;c||(Me=n),ae&&ae.getLoadedID()===t||Pe&&ne&&(ne.updateDocumentControllers(),ne.isADocumentDisplayed()&&ne.getDocumentLoadedID()===t?(ae&&ae.setLoadedID(t),ne.initializeDMUEvents()):e.isCompareActive||l||ne.clean2DDocument()),se=null;var d=function(){We("ITF")};var u=function(){if("DIFLayout"===n||"DIFSheet"===n)We("2DFL"),fe=n;else if("Drawing"===n){Te++,Te>1&&!be&&Te===Q.getRootBagPath().getChildrenPathes().length&&ke("warning",W.multidropdrawing),We("2D"),fe=n,be||He(null,t);var e=setInterval((function(){var o,r,i,s;(1===Q.getRootBagPath().getChildrenPathes().length||be&&2===Q.getRootBagPath().getChildrenPathes().length)&&(clearInterval(e),o=t,r=n,i=Q.getRootBagPath().getChildrenPathes()[Q.getRootBagPath().getChildrenPathes().length-1].getLastElement(!0),ne.load2DDocument({phyID:o,dataType:r,serverUrl:C.get3DSpaceUrl(),securityContext:D.getSetting("pad_security_ctx"),parentNode:i,is2DCompareActive:be,onLoadingStarted:function(){a.on(),s=1},onComplete:function(){s&&(a.off(),s=0)},onFailure:function(){Q.removeRoots({pids:[o]}),Q.displayNotification({msg:W.fileWithNoSVG,eventID:"error"}),s&&(a.off(),s=0)}}))}),100)}},g=function(){!ae||"DXF"!==ae.getLoadMarkupCtxType()&&"DWG"!==ae.getLoadMarkupCtxType()?l||(We(n),fe=n):(We("2D"),fe=n,He(null,t)),se=t};if("Drawing"===n||"DIFLayout"===n||"DIFSheet"===n&&e.path.getParentPath().isEqual(Q.getRootBagPath()))u(),re=n,se=t;else if("Document"===n||"Specification Report"===n||"Requirement"===n||"Requirement Specification"===n||c&&("Chapter"===n||"Comment"===n)){g();const e=p.giveDMUCommentsController({context:Q.getFrameWindow()});i&&!i.isLoading()&&e&&e.setVisibleFlag(!0),re=n}else if(Q.getApplicativeData().getLoadedItfData&&Q.getApplicativeData().getLoadedItfData().data.length>0)d(),re="SIMItfSimulation";else if("DesignSight"===n)We("MSR"),fe=n,re="MSR";else if("R2V_Activity"===n)fe&&(He(fe,t),fe=void 0),je()?We("R2V3D"):We("R2V"),ae.load({data:{serviceId:"r2vsurvey",objectParentType:"R2V_Activity",objectType:"R2V_Activity",objectId:t,strURI:r}});else{let r=await Be(n);r&&r.length&&-1!==r.indexOf("Drawing")&&e.path.getParentPath().isEqual(Q.getRootBagPath())?(n=re="Drawing",u()):r&&r.length&&-1!==r.indexOf("SIMItfSimulation")&&e.path.getParentPath().isEqual(Q.getRootBagPath())?(n=re="SIMItfSimulation",d()):r&&r.length&&(-1!==r.indexOf("Requirement")||-1!==r.indexOf("Requirement Specification"))?(n=-1!==r.indexOf("Requirement Specification")?"Requirement Specification":"Requirement",re="Requirement",g()):r&&r.length&&(-1!==r.indexOf("Document")||-1!==r.indexOf("Specification Report"))?(n=re=-1!==r.indexOf("Document")?"Document":"Specification Report",g()):he?Q.removeRoots({pids:[t]}):function(){fe&&(He(fe,t),fe=void 0);let e=!0;const n=o.getReviewContext({context:Q}),r=n?n.getCurrentSessionMarkup():null;if(r){const t=r.getApplicativeContext();t&&t.PIM&&(e=!1)}e&&(Xe()?We("R2V3D"):We("3D"))}()}Fe()}let qe=null;function Ge(){var e=o.getReviewContext({context:Q}),t=!0,n=e?e.getCurrentSessionMarkup():null;if(z&&!me&&n&&e.getReviewCtxInformation()&&n&&!n.isReadOnly()&&n.isDirty()&&!n.isImporting()){if(M.isProcessing())return qe&&(clearTimeout(qe),qe=null),void(qe=setTimeout(Ge,1e3));if(!Q||!z||me||!o.getReviewContext({context:Q}))return;var r=null,i=null,a=null,s=null,l=null;if(!ae||"Document"!==re&&"Specification Report"!==re||(s=ae.getDocumentVersionInfos(),a=re,l=ae.getLoadMarkupCtxType()),Q.getApplicativeData&&(Q.getApplicativeData(),Q.getApplicativeData().getLoadedItfData)){let e=Q.getApplicativeData().getLoadedItfData();e.data.length&&(e.data[0].metricID&&(r=e.data[0].metricID),void 0!==e.loadMode&&(i=e.loadMode),a="SIMItfSimulation")}t=!1,L.tryToSaveData({frameWindow:Q.getFrameWindow(),saveFunction:()=>M.saveCurrent3DMarkup({newFile:Se,frmWindow:Q.getFrameWindow(),superType:a,documentType:l,listData:r,loadingInfos:i,documentVersionInfos:s})}).then((()=>{if(Q){var e=o.giveEventsController({viewer:Q.getViewer()});e&&e.fireEvent("on3DMarkupSaved")}})).catch((()=>{if(Q){var e=o.giveEventsController({viewer:Q.getViewer()});e&&e.fireEvent("on3DMarkupSaveFailed")}})),Se=!1}if(t){var c=o.giveEventsController({viewer:Q.getViewer()});c&&c.fireEvent("on3DMarkupSaveNotNeeded")}}function ze(){Ge(),Fe()}function Qe(e){if(z)if(Ve=!1,me=!1,(ae=x.getLoadingContextController({context:Q}))&&ae.getLoadedWorkplanInformations())Q.removeRoots({pids:[e.id]});else{var t=E.giveDMUSceneDisplayController({context:Q});if((!t||!t.getCurrentComparedObjectIDPaths()&&ie&&ie.getActiveState())&&ie.setActiveState(!1),e.id===sessionStorage.getItem("DMU2DCompareTempRoot"))Q.removeRoots({pids:[sessionStorage.getItem("DMU2DCompareTempRoot")]}),sessionStorage.removeItem("DMU2DCompareTempRoot");else if(e.path)Ne({path:e.path});else{var n=Q.getRootBagPath().externalPath[0].path.getChildrenPathes().length;if(n)Ne({path:Q.getRootBagPath().externalPath[0].path.getChildrenPathes()[n-1]})}}}function Je(e){if(!z||Ve)return;!Q.getRootBagPath().getChildrenPathes().length&&ie&&ie.getActiveState()&&ie.setActiveState(!1);let t=_.giveReqCompareController({context:Q}),n=!!t&&(t.isLoading()||t.isRequirementCompareActive()),r=!1;if(n){let n=t.getCurrentComparedObjectIDPaths();r=n&&n.rootObject===e.id}if(!n||r?ne&&(e&&e.id?ne.clean2DDocument(e):ne.clean2DDocument()):ne&&ne.cleanDocumentData(e),ae&&(ae.clean(),e&&e.id&&ae.updateLoadedR2VInformations(e.id,"remove"),e&&e.id&&ae.updateLoadedWorkplanInformations(e.id,"remove"),e&&e.id&&ae.setLoadedFMEAInformations(void 0,"remove")),Me&&"R2V_Activity"===Me&&Q.toggleSOITimelinesUsability(!0),Q.getRootBagPath().getChildrenPathes().length){var i=Q.getRootBagPath().externalPath[0].path.getChildrenPathes().length;let e;if(i&&(e=Q.getRootBagPath().externalPath[0].path.getChildrenPathes()[i-1]),(Me=s.getNodeType(e.getLastElement(!0)))&&"FailureModesEffectsAnalysis"===Me&&i){let e=Q.getRootBagPath().externalPath[0].path.getChildrenPathes()[i-1].externalPath.find((e=>"RootBag"===e.name));e&&(e.removeChildren(),e.remove())}if(Me&&Q.getApplicativeData()&&Q.getApplicativeData().getLoadedItfData()&&Q.getApplicativeData().getLoadedItfData().data&&0===Q.getApplicativeData().getLoadedItfData().data.length){const e=Xe(),t=je();let n=null;e&&t?n="R2V3D":e?n="R2V":t&&(n="3D"),n&&We(n)}}else me=!0,o.setReviewContext({context:Q});Fe({removeRoot:!0}),se=null,Te=0}function Ye(){Q.unsubscribe(K.onRootRemoved),K.onRootRemoved=-1}function Ke(){K.onRootRemoved=Q.subscribe({event:"onRootRemoved"},Je)}var Ze;function $e(e){Ze=T.getNearPositionFrom2DCoordinates({x:e.clientX,y:e.clientY},Q.getViewer())}function et(e){z&&J&&e&&C.multiTenantMgt([e],s.getRoots(Q),(function(t){if(!t.isMultiTenant){var n=o.getReviewContext({context:Q}),r=n?n.getCurrentSessionMarkup():null;if(!r||r.isReadOnly()||!r.getCurrentSlide())return;A.getDataFromRelatedId({type:"DMUMarker3DPicture",objectId:e.objectId,onComplete:function(t){var n=I.create3DMarker({viewer:Q.getViewer(),frameWindow:Q.getFrameWindow(),parent:r,date:Date.now(),objectId:e.objectId,shape:{type:"picture",pointingPoint:Ze,data:t}});n&&(r.getCurrentSlide().addDMUObject(n),n.fireEvent("onDMUObjectInitialized",{dmuObject:n}))}})}}))}function tt(e){z&&J&&e&&Ee&&C.multiTenantMgt([e],s.getRoots(Q),(function(t){t.isMultiTenant||J.loadMarkupContext(e)}))}this.setActiveState=async function(e){const t=()=>C.get3DSpaceUrl(),i=()=>C.getPlatformId(),a=()=>D.getSetting("pad_security_ctx");let d,u,v,M;if(v={_Markup:function(e){z&&J&&e&&C.multiTenantMgt([e],s.getRoots(Q),(function(t){t.isMultiTenant||J.loadReview(e)}))},_DMUMarkupRepReference:function(e){z&&J&&e&&C.multiTenantMgt([e],s.getRoots(Q),(function(t){t.isMultiTenant||J.loadReview(e)}))},...k.getDelegation(Q,(function(){N.fireEvent("onApplyingSlideView")}))},e!==z){if(z=e){var R=["DS/PIMwebViewController/PIMwebItfCtrl"];await new Promise((e=>{require(R,(function(t){var n=t.getLoaderForMarkup({context:Q});n.subscribe("onDMUCtxtLoadingSuccess",(function(){We("ITF")})),n.subscribe("onDMUCtxtRemoved",(function(){o.getReviewContext({context:Q})&&o.removeReviewContext({context:Q}),Q.getExecutionContext||We("3D")})),e()}))})),ae||(ae=x.getLoadingContextController({context:Q}));let e=function(e){return new Promise(((n,o)=>{let r=t()+"/resources/dictionary/getTypeInfo?tenant="+i(),s=encodeURIComponent(a());require("DS/WAFData/WAFData").authenticatedRequest(r+"&SecurityContext="+s,{method:"POST",type:"json",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:s},data:JSON.stringify(e),onComplete:function(e){n(e)},onFailure:function(e){o(e)},onTimeout:function(e){o(e)}})}))};try{let t=await e(Oe);Object.keys(t).forEach((e=>{v["_"+e]=tt})),Q.setLoadingDelegations(v)}catch{Oe.forEach((e=>{v["_"+e]=tt})),Q.setLoadingDelegations(v)}if((ve=V.getSelectionManager({context:Q})).setActiveState(!0),Ce={activated:Q.getViewer().picking.activated,trapSelection:Q.getViewer().picking.trapSelection,trapGPU:Q.getViewer().picking.trapGPU},De={activated:Q.getViewer().pPicking.activated},Q.getViewer().setPicking({activated:!0,trapSelection:!0,trapGPU:!0}),Q.getViewer().setPrePicking({activated:!0}),N=o.getEventsController({viewer:Q.getViewer()}),O.subscribe({event:"ENXViews/WelcomePanel/openContent"},(async e=>{let t=e.unserializedData?e.unserializedData.data.items:null;if(t&&t.length>1)for(const e of t){const t=await Be(e.objectType);if(!t.includes("VPMReference")&&!t.includes("R2V_Activity")){Ee=!1,ke("warning",W.dropMultiNoAutorized);break}}else Ee=!0})),$.onDMUMarkupApplicativeContextLoaded=N.addEvent("onDMUMarkupApplicativeContextLoaded",(function(e){e.markupHasApplicativeContext&&J.publish("onReviewContextModified",{type:"ITF",onABReady:Fe})})),$.onMarkupMaturityModificationRequested=N.addEvent("onMarkupMaturityModificationRequested",(function(e){!function(e){var t;const n=()=>C.get3DSpaceUrl(),r=()=>C.getPlatformId();var i=o.getReviewContext({context:Q});const a=i&&i.getReviewCtxInformation();var s=i.getCurrentSessionMarkup(),l={data:[{physicalid:a.reviewId,name:s.getAttribute("sName"),fromstate:e.fromState,tostate:e.toState,type:"DMUMarkupRepReference"}]};t=n()+"/resources/lifecycle/maturity/promote?tenant="+r(),require("DS/WAFData/WAFData").authenticatedRequest(t,{method:"POST",type:"json",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:D.getSetting("pad_security_ctx")},timeout:36e5,data:JSON.stringify(l),onComplete:function(t){t&&t.results&&t.results.length&&t.results[0].current?(s.setMaturityState(t.results[0].current),N&&N.fireEvent("onMarkupObjectAttributesModified",{object:s,attr:[{currentState:t.results[0].current}]})):N&&N.fireEvent("onMarkupObjectAttributesModified",{object:s,attr:[{currentState:e.fromState}]})},onFailure:function(){N&&N.fireEvent("onMarkupObjectAttributesModified",{object:s,attr:[{currentState:e.fromState}]})},onTimeout:function(){N&&N.fireEvent("onMarkupObjectAttributesModified",{object:s,attr:[{currentState:e.fromState}]})}})}(e)})),$.onDMUMarkupApplicativeContextCleaned=N.addEvent("onDMUMarkupApplicativeContextCleaned",(function(){J.publish("onReviewContextModified",{type:"3D",onABReady:Fe})})),$.onDMUApplicativeContextClean=N.addEvent("onDMUApplicativeContextClean",(function(e){R=["DS/PIMwebViewController/PIMwebItfCtrl"],require(R,(function(t){t.cleanApplicativeContext(e.applicativeContext,Q)}))})),$.onDMUObjectDeleted=N.addEvent("onDMUObjectDeleted",(function(e){e&&e.dmuObject&&e.dmuObject.getParent()&&e.dmuObject.getParent().getType&&"DMUTemporaryBag"!==e.dmuObject.getParent().getType()&&ze(),e&&e.dmuObject&&("DMUCompare3D"===e.dmuObject.getType()||"DMUCompare2D"===e.dmuObject.getType())&&Fe()})),$.onReviewRemoved=N.addEvent("onReviewRemoved",(function(){Q.elements.container.removeEventListener("drop",$e),Q.setLoadingDelegations(v)})),$.onDMUObjectInitialized=N.addEvent("onDMUObjectInitialized",(function(e){if(e&&e.dmuObject&&(e.dmuObject.getParent()&&e.dmuObject.getParent().getType&&"DMUTemporaryBag"!==e.dmuObject.getParent().getType()&&ze(),"DMUMarkup"===e.dmuObject.getType()))if(Q.elements.container.removeEventListener("drop",$e),"2DFL"===oe){Q.elements.container.addEventListener("drop",$e);var t={_EleLogicalRelay:et,_EleLogicalContact:et,_EleLogicalOperatingDevice:et,_EleLogicalSingleConnector:et,_EleLogicalInlineConnector:et,_EleLogicalShellConnector:et,_EleLogicalSplice:et,_EleLogicalTerminalBoard:et,_EleLogicalBusbar:et,_EleLogicalHarness:et,_EleLogicalNet:et,_EleLogicalNetGroup:et,_EleLogicalWire:et,_EleLogicalWireShield:et,_EleLogicalCable:et,_EleLogicalCableShielded:et,_EleLogicalCableTwisted:et,_EleLogicalCableTwistedShielded:et,_EleLogicalOverShield:et,_EleLogicalPowerCable:et,_EleLogicalCoaxCable:et,_EleLogicalCableGroup:et,_EnsLogicalEquipment:et,_EnsInCLoop:et,_EnsInCLogicalRoute:et,_EnsInCLogicalBranch:et,_EnsInCLogicalComponent:et,_Piping_Logical_Miscellaneous:et,_Piping_Logical_Branch:et,_Piping_Logical_Instrument:et,_Piping_Logical_Reducer:et,_Piping_Logical_Valve:et,_Piping_Logical_Pipe:et,_Piping_Line:et,_ICLoop_Line:et,_HVAC_Logical_Miscellaneous:et,_HVAC_Logical_Branch:et,_HVAC_Logical_Instrument:et,_HVAC_Logical_Reducer:et,_HVAC_Logical_Damper:et,_HVAC_Logical_Duct:et,_HVAC_Line:et};Q.setLoadingDelegations(Object.assign({},t,v))}else Q.setLoadingDelegations(v)})),$.onDMUMarkupCreationSucceeded=N.addEvent("onDMUMarkupCreationSucceeded",(function(){Se=!0,ze()})),$.onSlideApplicativeContextModified=N.addEvent("onSlideApplicativeContextModified",(function(e){e&&e.dmuObject&&("DMUSlide"===e.dmuObject.getType()||"DMUFormat"===e.dmuObject.getType())&&ze()})),$.onDMUOccOverloadRemoved=N.addEvent("onDMUOccOverloadRemoved",ze),$.onDMUSlideSessionInfoChanged=N.addEvent("onDMUSlideSessionInfoChanged",(function(e){e&&e.dmuObject&&("DMUSlide"===e.dmuObject.getType()||"DMUFormat"===e.dmuObject.getType())&&Ge()})),$.onDMUSlideNameChanged=N.addEvent("onDMUSlideNameChanged",Ge),$.onSaveRequested=N.addEvent("onSaveRequested",Ge),$.onDMUCurrentSlideChanged=N.addEvent("onDMUCurrentSlideChanged",Fe),$.onComparisonStarted=N.addEvent("onComparisonStarted",(function(e){e&&e.is2DCompare&&(be=!0),Fe()})),$.onComparisonEnded=N.addEvent("onComparisonEnded",(function(){be=!1,Fe()})),$.onFormatsEditionModeStarted=N.addEvent("onFormatsEditionModeStarted",(function(){J.publish("onReviewContextModified",{type:oe+"Formats",onABReady:Fe})})),$.onFormatsEditionModeEnded=N.addEvent("onFormatsEditionModeEnded",(function(){J.publish("onReviewContextModified",{type:"RefreshAB",onABReady:Fe})})),$.onWorkplanLoadingStarted=N.addEvent("onWorkplanLoadingStarted",(function(e){J.publish("onReviewContextModified",{type:"Workplan",onABReady:function(){Fe(),e.onComplete()}})})),$.onReviewCtxInformationChanged=N.addEvent("onReviewCtxInformationChanged",(function(e){e&&e.reviewId&&Q&&Q.getWidget()&&Q.getWidget().dispatchEvent("onDMUMarkupLoaded",{reviewID:e.reviewId,reviewType:e.reviewType})})),$.getParentType=N.addEvent("getParentType",(async function(e){const t=await Be(e.type);e.onComplete(t)})),$.onDMUObjectReadOnlyFlagChanged=N.addEvent("onDMUObjectReadOnlyFlagChanged",(function(e){"Markup"===e.dmuObject.getAttribute("sType")&&Fe()})),$.onDMUObjectActiveFlagChanged=N.addEvent("onDMUObjectActiveFlagChanged",Fe),$.onDMUObjectVisibleFlagChanged=N.addEvent("onDMUObjectVisibleFlagChanged",Fe),$.onApplicativeContextCommandsRequired=N.addEvent("onApplicativeContextCommandsRequired",(function(e){J.publish("onReviewContextModified",{type:"Data",data:e,onABReady:e.cb})})),$.on2DDocumentLoadSuccess=N.addEvent("on2DDocumentLoadSuccess",(function(){Fe(),he=!1})),$.onDXFLoadSuccess=N.addEvent("onDXFLoadSuccess",(function(){We("2D")})),$.onWorkplanLoadSuccess=N.addEvent("onWorkplanLoadSuccess",(function(){We("Workplan")})),$.onFMEALoadSuccess=N.addEvent("onFMEALoadSuccess",(function(){We("FMEA")})),$.onR2VMarkupCreationSuccess=N.addEvent("onRootDataRemoved",(function(e){Je(e)})),$.onR2VMarkupCreationSuccess=N.addEvent("onR2VMarkupCreationSuccess",(function(){We("R2V")})),$.onPreviewThumbnailUpdateRequested=N.addEvent("onPreviewThumbnailUpdateRequested",(function(e){u=o.getReviewContext({context:Q});const t=u&&u.getReviewCtxInformation();t&&(e.thumbnailData?S.saveObjectThumbnail("markup2dthumbnail",e.thumbnailData,t.reviewId):S.deleteMarkupThumbnail("markup2dthumbnail",t.reviewId))})),q=n.getLoadMarkupServices({context:Q}),G=Q.getExecutionContext?Fe():Q.getFrameWindow().getActionBar().onActionBarReady(Fe),(ne=r.getManager({name:"DMU2DSheetManager",context:Q.getFrameWindow()}))||(ne=new g({ctxViewer:Q}),r.addManager({name:"DMU2DSheetManager",context:Q.getFrameWindow(),manager:ne})),ie||(ie=new m({context:Q})),K.onBeginFilterApplied=Q.subscribe({event:"onBeginFilterApplied"},Ye),K.onFilterApplied=Q.subscribe({event:"onFilterApplied"},Ke),K.onLoadingFailure=Q.subscribe({event:"onLoadingFailure"},Ke),K.onBeginFilterRemoved=Q.subscribe({event:"onBeginFilterRemoved"},Ye),K.onFilterRemoved=Q.subscribe({event:"onFilterRemoved"},Ke),K.onRootAdded=Q.subscribe({event:"onRootAdded"},Qe),K.onRootRemoved=Q.subscribe({event:"onRootRemoved"},Je),K.onRootAttached=Q.subscribe({event:"onRootAttached"},Qe),K.onRootDetached=Q.subscribe({event:"onRootDetached"},Je),K.onRefreshBegin=Q.subscribe({event:"onRefreshBegin"},(()=>{if(me=!0,!Ve){const e=p.giveDMUCommentsController({context:Q.getFrameWindow()});e&&e.cleanCommentsPanel(),!ne||"Drawing"!==re&&"DIFSheet"!==re&&"DIFLayout"!==re||ne.clean2DDocument(),Ve=!0}})),K.onRefreshCompleted=Q.subscribe({event:"onRefreshCompleted"},(function(){me=!1,Ve=!1})),K.onRealAssetLoaded=Q.subscribe({event:"onRealAssetLoaded"},(e=>{je()?We("R2V3D"):We("R2V");let t=setInterval((()=>{if(Q.getExecutionContext){const n=Q.getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent);n&&n.hasCheckHandler("ENO3DTogglePhoto360ModeChk")&&(clearInterval(t),e.callback&&e.callback())}}),500)})),Z=Q.getViewer().onSwapVisibleSpace(Fe),le=f.getDMUApplicativeContextManager({context:Q}),u=o.getReviewContext({context:Q}),u&&u.getCurrentSessionMarkup()){var y=!1,U=u.getReviewCtxInformation();if(U&&U.contextId){var I=Q.getRootBagPath().getChildrenPathes(),A=null;for(Q.getApplicativeData().getLoadedItfData&&Q.getApplicativeData().getLoadedItfData().data.length>0&&(A=Q.getApplicativeData().getLoadedItfData().data[0].isrID),d=0;d<I.length;d++){var w=s.getNodeID(I[d].getLastElement(!0));if(Q.getController().isFiltered(w).filterId&&(w=Q.getController().isFiltered(w).filterId),w===U.contextId||A===U.contextId){u.getCurrentSessionMarkup().setActiveFlag(!0),!1!==U.modifiable&&u.setReadOnly(!1),y=!0;break}}y||u.setCurrentSessionMarkup(null)}}pe=Q.getViewer().sectionCappingEnabled,Q.getViewer().setSectionCapping(!0),(ge=Q.isRobotVisible())&&Q.setRobotVisibility(!1),Q.getFrameWindow().getContextualUIManager().registerUnshift({subscriberId:"3DReviewWebAppCtxElements",workbenchName:"DMU3DReviewController",context:Q.getCommandContext(),module:"DMU3DReviewController",cmdPrefix:"",directory:"assets/afr/",merge:!0,onContextualBarReady:Le,onContextualMenuReady:_e}),(ce=Q.isDefaultContextualBarVisible())&&Q.setDefaultContextualBarVisibility(!1),(de=Q.isDefaultContextualMenuVisible())&&Q.setDefaultContextualMenuVisibility(!1),(ue=Q.isOpenWithMenuAvailable())||Q.setOpenWithMenuAvailability(!0),h.setSlidePreferences({context:Q.getFrameWindow(),preferences:{displayNominal:!0}}),await async function(){var e=P.getPreferenceManager({context:Q.getFrameWindow()});if(e){if(e.setUnitsPreferencesDisplayFlag(!0),e.setDisplayPreferencesDisplayFlag(!0),e.set3DSelectionPreferencesDisplayFlag(!0),e.set2DSelectionPreferencesDisplayFlag(!0),e.setExportPreferencesDisplayFlag(!0),e.setMeasurePreferencesDisplayFlag(!0),e.setClippingPreferencesDisplayFlag(!0),e.addPreferences([{nls:W.preferences.markupSectionTitle,id:"MarkupPreferences",type:"section",preferences:[{nls:W.preferences.QuickCreationLbl,id:"DisplayMarkupCreationDialog",type:"checkbox",getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_DisplayMarkupCreationDialog")},getDefaultValue:function(){return!0},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_DisplayMarkupCreationDialog"))&&localStorage.setItem("CATWebUXMePreferences_DisplayMarkupCreationDialog",e?"true":"false")}},{nls:W.preferences.automaticallyCreateFirstSlide,id:"CreateFirstSlide",type:"checkbox",getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_CreateFirstSlide")},getDefaultValue:function(){return!0},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_CreateFirstSlide"))&&localStorage.setItem("CATWebUXMePreferences_CreateFirstSlide",e?"true":"false")}}]},{nls:W.preferences.slideSectionTitle,id:"SlidePreferences",type:"section",preferences:[{nls:W.preferences.slideNameFromFeature,id:"SlideNameFromFeature",type:"checkbox",getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_SlideNameFromFeature")},getDefaultValue:function(){return!0},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_SlideNameFromFeature"))&&localStorage.setItem("CATWebUXMePreferences_SlideNameFromFeature",e?"true":"false")}},{nls:W.preferences.slideTitleDisplayLbl,id:"DisplaySlideTitle",type:"checkbox",getValue:function(){return"true"===localStorage.getItem("CATWebUXMePreferences_DisplaySlideTitle")},getDefaultValue:function(){return!1},setValue:function(e){e!==("true"===localStorage.getItem("CATWebUXMePreferences_DisplaySlideTitle"))&&localStorage.setItem("CATWebUXMePreferences_DisplaySlideTitle",e?"true":"false")}},{nls:W.preferences.slideCaptureSpecLayers,id:"CaptureSpecLayers",type:"checkbox",getValue:function(){return"true"===localStorage.getItem("CATWebUXMePreferences_CaptureSpecLayers")},getDefaultValue:function(){return!1},setValue:function(e){e!==("true"===localStorage.getItem("CATWebUXMePreferences_CaptureSpecLayers"))&&localStorage.setItem("CATWebUXMePreferences_CaptureSpecLayers",e?"true":"false")}},{nls:W.preferences.slideEnableDrag,id:"SlideDragAndDropOperation",type:"radio",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_SlideDragAndDropOperation")||"SlideReorder"},getDefaultValue:function(){return"SlideReorder"},setValue:function(e){e!==localStorage.getItem("CATWebUXMePreferences_SlideDragAndDropOperation")&&localStorage.setItem("CATWebUXMePreferences_SlideDragAndDropOperation",e)},options:[{id:"SlideReorder",nls:W.preferences.enableReorder},{id:"TransferView",nls:W.preferences.enableDragContent}]}]},{nls:W.preferences.handlesSectionTitle,id:"HandlesPreferences",type:"section",preferences:[{prefixnls:W.preferences.gridSpacingPrefix,suffixnls:W.preferences.gridSpacingSuffix,id:"SnapHandlesToGrid",type:"checkbox+spinbox",disableSpinboxAtUncheck:!0,getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_SnapHandlesToGrid")},getSpinBoxValues:function(){var e=parseFloat(localStorage.getItem("CATWebUXMePreferences_SnapHandlesGridValue"));e=isNaN(e)?.001:e;var t=localStorage.getItem("CATWebUXMePreferences_Length")||"Millimeter";return{value:e="Inch"===(t="Foot"===t?"Inch":"Centimeter"===t||"Meter"===t||"Kilometer"===t?"Millimeter":t)||"Millimeter"===t?b.convert(e,"Length","Meter",t):e,units:t,minValue:"Millimeter"===t?1:.01,stepValue:"Millimeter"===t?1:.01}},getDefaultValue:function(){return!0},getSpinBoxDefaultValues:function(){return{value:1,units:"Millimeter",minValue:1,stepValue:1}},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_SnapHandlesToGrid"))&&localStorage.setItem("CATWebUXMePreferences_SnapHandlesToGrid",e?"true":"false")},setSpinBoxValue:function(e){var t=parseFloat(localStorage.getItem("CATWebUXMePreferences_SnapHandlesGridValue"));e!==(t=isNaN(t)?1:t)&&localStorage.setItem("CATWebUXMePreferences_SnapHandlesGridValue",e)}},{prefixnls:W.preferences.rotSnappingPrefix,suffixnls:"("+W.preferences.rotSnappingSuffix+")",id:"SnapRotationToggle",type:"checkbox+spinbox",disableSpinboxAtUncheck:!1,getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_SnapRotationToggle")},getSpinBoxValues:function(){var e=parseFloat(localStorage.getItem("CATWebUXMePreferences_SnapRotationAngle"));e=isNaN(e)?1.5708:e;var t=localStorage.getItem("CATWebUXMePreferences_Angle")||"Degree";return{value:e="Degree"===t?Math.round(b.convert(e,"Angle","Radian",t)):e,units:t,minValue:"Degree"===t?1:.01,stepValue:"Degree"===t?1:.01}},getDefaultValue:function(){return!0},getSpinBoxDefaultValues:function(){return{value:90,units:"Degree",minValue:1,maxValue:360,stepValue:1}},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_SnapRotationToggle"))&&localStorage.setItem("CATWebUXMePreferences_SnapRotationToggle",e?"true":"false")},setSpinBoxValue:function(e){var t=parseFloat(localStorage.getItem("CATWebUXMePreferences_SnapRotationAngle"));e!==(t=isNaN(t)?90:t)&&localStorage.setItem("CATWebUXMePreferences_SnapRotationAngle",e)}}]},{nls:W.preferences.compareSectionTitle,id:"ComparePreferences",type:"section",preferences:[{nls:W.preferences.firstProductColor,id:"CompareFirstColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_CompareFirstColor")?localStorage.getItem("CATWebUXMePreferences_CompareFirstColor"):"#CC092F"},getDefaultValue:function(){return"#CC092F"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_CompareFirstColor",e)}},{nls:W.preferences.secondProductColor,id:"CompareSecondColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_CompareSecondColor")?localStorage.getItem("CATWebUXMePreferences_CompareSecondColor"):"#6FBC4B"},getDefaultValue:function(){return"#6FBC4B"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_CompareSecondColor",e)}},{nls:W.preferences.compare3DCommonColor,id:"Compare3DCommonColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_Compare3DCommonColor")?localStorage.getItem("CATWebUXMePreferences_Compare3DCommonColor"):"#D3D3D3"},getDefaultValue:function(){return"#D3D3D3"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_Compare3DCommonColor",e)}},{nls:W.preferences.compare2DCommonColor,id:"Compare2DCommonColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_Compare2DCommonColor")?localStorage.getItem("CATWebUXMePreferences_Compare2DCommonColor"):"#000000"},getDefaultValue:function(){return"#000000"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_Compare2DCommonColor",e)}}]},{nls:H.ticSection,id:"TICSection",type:"section",preferences:[{nls:H.ticTemplateIssue,type:"checkbox",id:"TICTemplateIssue",setValue:function(e){localStorage.setItem("TICTemplateIssue",e)},getValue:function(){return"true"===localStorage.getItem("TICTemplateIssue")},getDefaultValue:function(){return!1}}]}]),e.setPreferredPreferenceContainersOrder(["MarkupPreferences","SlidePreferences","HandlesPreferences","TICSection","MeasurePreferences","PIMwebPrefLoad","PIMwebPrefDisplay","SectionPreferences","ComparePreferences"]),Q.getViewer().get2DMode()){try{Ie="true"===(await b.readPreferences([{Repository:"SelectionRepository",PreferenceNames:["Select2DGeometry"]}])).repositories[0].preferences[0].value}catch(e){Ie=!1,window.console.warn("Could not get server value, default value set instead.",e)}ve&&ve.setPicking(Ie?0:1)}else{try{let e=(await b.readPreferences([{Repository:"VisualizationRepository",PreferenceNames:["Gravity"]},{Repository:"FrameGeneral",PreferenceNames:["ProjectionType"]},{Repository:"SelectionRepository",PreferenceNames:["Select3DGeometry","SelectParentReferenceOr3DShape"]},{Repository:"TICSection",PreferenceNames:["TICTemplateIssue"]}])).repositories;for(let t=0;t<e.length;t++)if("VisualizationRepository"===e[t].name)ye="true"===e[t].preferences[0].value;else if("FrameGeneral"===e[t].name)Ue=e[t].preferences[0].value;else if("SelectionRepository"===e[t].name){let n=e[t].preferences;for(let e=0;e<n.length;e++)"Select3DGeometry"===n[e].name?xe="true"===n[e].value:"SelectParentReferenceOr3DShape"===n[e].name&&(Ae=n[e].value)}else"TICSection"===e[t].name&&(we="true"===e[t].preferences[0].value)}catch(e){ye=!1,we=!1,Ue="Perspective",xe=!1,Ae="selectParentReference",window.console.warn("Could not get server value, default value set instead.",e)}"boolean"==typeof ye&&(Q.getViewer().currentViewpoint.getControl().setRotationRolling(!ye),Q.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!ye)),"Perspective"!==Ue&&"Parallel"!==Ue||Q.getViewer().currentViewpoint.setProjectionType("Perspective"===Ue?0:1),ve&&ve.setPicking(xe?0:1),ve&&ve.selectParentReference("select3DShape"!==Ae)}te=e.subscribe("com.ds.mep:onPrefUpdate",(function(e){let t=JSON.parse(e[1].preferences);for(let e=0;e<t.repositories.length;e++)for(let n=0;n<t.repositories[e].preferences.length;n++)"SelectParentReferenceOr3DShape"===t.repositories[e].preferences[n].name?(Ae=t.repositories[e].preferences[n].value,ve&&ve.selectParentReference("select3DShape"!==Ae)):"Select3DGeometry"===t.repositories[e].preferences[n].name?(xe="true"===t.repositories[e].preferences[n].value,ve&&ve.setPicking(xe?0:1)):"Select2DGeometry"===t.repositories[e].preferences[n].name?(Ie="true"===t.repositories[e].preferences[n].value,ve&&Q.getViewer().get2DMode()&&ve.setPicking(Ie?0:1)):"ProjectionType"===t.repositories[e].preferences[n].name?(Ue=t.repositories[e].preferences[n].value,Q&&Q.getViewer()&&Q.getViewer().currentViewpoint&&Q.getViewer().currentViewpoint.setProjectionType("Perspective"===Ue?0:1)):"Gravity"===t.repositories[e].preferences[n].name?(ye="true"===t.repositories[e].preferences[n].value,Q&&Q.getViewer()&&Q.getViewer().currentViewpoint&&Q.getViewer().currentViewpoint.control&&(Q.getViewer().currentViewpoint.getControl().setRotationRolling(!ye),Q.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!ye))):"TICTemplateIssue"===t.repositories[e].preferences[n].name&&(we="true"===t.repositories[e].preferences[n].value,Fe())}))}}(),Q.getRootBagPath()&&Q.getRootBagPath().getChildrenPathes().length&&(Ne({path:Q.getRootBagPath().getChildrenPathes()[0]}),Q.getRootBagPath().getChildrenPathes().forEach(((e,t)=>{0!==t&&"R2V_Activity"===e.getLastElement(!0).getUserData().type&&Ne({path:e})})))}else{var T;if(V.unreferenceSelectionManager({context:Q}),ve=null,L.clean(),qe&&(clearTimeout(qe),qe=null),Ce&&Q.getViewer().setPicking(Ce),De&&Q.getViewer().setPrePicking(De),De=null,De=null,Q.elements.container.removeEventListener("drop",$e),M=P.givePreferenceManager({context:Q.getFrameWindow()}),M){for(T=Object.keys(ee),d=0;d<T.length;d++)M.unsubscribe(ee[T[d]]);te&&(M.unsubscribe(te),te=null),ee={},M.removePreferences(["MarkupPreferences","HandlesPreferences"])}if(P.unreferencePreferenceManager({context:Q.getFrameWindow()}),Q.setLoadingDelegations({}),Q.getExecutionContext||Q.getFrameWindow().getActionBar().removeCallback(G),Q.getFrameWindow().getContextualUIManager().unregister("3DReviewWebAppCtxElements"),void 0!==ce&&Q.setDefaultContextualBarVisibility(ce),ce=void 0,void 0!==de&&Q.setDefaultContextualMenuVisibility(de),de=void 0,void 0!==ue&&Q.setOpenWithMenuAvailability(ue),ue=void 0,void 0!==ge&&Q.setRobotVisibility(ge),ge=void 0,void 0!==pe&&Q.getViewer().setSectionCapping(pe),pe=void 0,f.unreferenceDMUApplicativeContextManager({context:Q}),le=null,u=o.getReviewContext({context:Q}),ne.isADocumentDisplayed())if(Pe)u&&u.getCurrentSessionMarkup()?u.setReadOnly(!0):ne.removeDMUEvents();else{ne.clean2DDocument();const e=p.giveDMUCommentsController({context:Q.getFrameWindow()});e&&e.cleanCommentsPanel();for(var E=[],_=s.getRoots(Q),F=0;F<_.length;F++)E.push(s.getNodeID(_[F]));Q.removeRoots({pids:E})}else u&&u.getCurrentSessionMarkup()&&(Pe?u.setReadOnly(!0):u.getCurrentSessionMarkup().setActiveFlag(!1));for(l.empty(),c.empty(),T=Object.keys(K),d=0;d<T.length;d++)Q.unsubscribe(K[T[d]]);if(K={},N){for(T=Object.keys($),d=0;d<T.length;d++)N.removeEvent($[T[d]]);o.unreferenceEventsController({viewer:Q.getViewer()}),N=null}$={},ie&&(ie.clean(),ie=null),Pe||(r.removeManager({name:"DMU2DSheetManager",context:Q.getFrameWindow()}),ne=null),ae&&(x.unreferenceLoadingContextController({context:Q}),ae=null),Z&&(Q.getViewer().unsubscribe(Z),Z=null),n.unreferenceLoadMarkupServices({context:Q}),q=null}Fe()}},this.disableDMUContextualBar=function(){Re=!1,Q.getExecutionContext||Q.getFrameWindow().getContextualUIManager().getContextualBar().hide()},this.enableDMUContextualBar=function(){Re=!0},this.subscribe=function(e,t){if(e&&t&&Y)return Y.subscribe({event:e},t)},this.unsubscribe=function(e){Y&&e&&Y.unsubscribe(e)},this.getActiveState=function(){return z},this.clearController=function(){J.setActiveState(!1),Q=J=Y=K=ne=he=null},this.loadReview=function(e){var t=!1,n=o.getReviewContext({context:Q});let r;n&&(r=n.getReviewCtxInformation(),t=r&&r.reviewId===e.objectId),(void 0===(n&&r)||e.objectId&&!1===t&&q)&&q.load(e)},this.loadMarkupContext=async function(e){var t=!1,n=o.getReviewContext({context:Q});if(n){var r=n.getReviewCtxInformation();t=r&&r.contextId===e.objectId}const i=await Be(e.objectType);if(e.objectId&&!t&&ne||i&&i.length&&-1!==i.indexOf("SIMItfSimulation")){if(se===e.objectId)return void Q.displayNotification({msg:W.documentAlreadyLoaded,eventID:"info"});var a;i&&i.length&&["SIMItfSimulation","PLMPIMMetricReference","Document","Specification Report","DIFLayout","DIFSheet","DIFAnnotationSet","Requirement","Requirement Specification","DesignSight","DELLmiWorkPlanSystemReference","DELLmiPPRHeaderProcessReferenceAbstract","FailureModesEffectsAnalysis"].some((function(e){if(-1!==i.indexOf(e))return a=e,!0}))?(e.objectParentType=a||e.objectType,ae.load({data:e}),-1===i.indexOf("Document")&&-1===i.indexOf("Specification Report")||(he=!0)):Ne({docData:e})}},this.loadValidation=function(e){var t=!1,n=o.getReviewContext({context:Q});n&&(t=n.checkCurrentReviewInSession(e)),e&&!1===t&&q&&q.loadValidation(e)};var nt,ot,rt=(nt=["VPMReference","Drawing","ENOStrRefinementSpecification"].concat(Oe),ot={},async function(e,t){if(nt.indexOf(e)>-1)return t(e);if(void 0!==ot[e])return t(ot[e]?ot[e]:void 0);const n=await Be(e);ot[e]=null,nt.some((function(t){if((n||[]).indexOf(t)>-1)return ot[e]=t,!0})),t(ot[e]?ot[e]:void 0)});function it(e,t){return e.reduce((function(e,n){return e.then((function(e){return new Promise((function(o){rt(n.type,(function(r){t.indexOf(r)>=0&&e.push(n),o(e)}))}))}))}),Promise.resolve([]))}this.appInitFromTransition=function(t){var n;return new e.Promise((function(e,r){var a,l,c,d,u,g,p=t.x3dContent,m=s.getRoots(Q);if(t.issues&&1===t.issues.length)p=null,a=t.issues[0].physicalid,c=require("DS/PADUtils/PADUtilsServices").getPlatformId(),d=t.issues[0].title,u=t.issues[0].description,g=t.issues[0].attachments;else if(p&&p.data&&p.data.items&&!m.length)for(l=0;l<p.data.items.length;++l)if("Issue"===p.data.items[l].objectType){if(a){a=null;break}a=p.data.items[l].objectId,c=p.data.items[l].envId,d=p.data.items[0].displayName}a?((n=new R).display({modal:!0,frmWindow:Q.getFrameWindow(),type:"load",message:d}),require(["DS/IssueServices/services/PlatformServices","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices"].concat([]),(function(t,l,m,f){m.add("widget",window.widget),t.getSecurityContext=function(){return require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx").replace("ctx::","")},t.getTenant=function(){return c},t.initPlatformServices().then((function(){U._sendUsageProbe("loadFromIssue",p?"x3dContent":"transition"),(g?new Promise((function(e){e({attachments:g})})):l.getDocumentsFrom(a)).then((function(t){var g=0,m=0,C=0;if(t&&t.attachments&&t.attachments.length&&t.attachments.forEach((function(e){!e||"Markup"!==e.type&&"DMUMarkupRepReference"!==e.type||(m++,g=e.id,C=e.type)})),m>1)return U._sendUsageProbe("loadFromIssue",(p?"x3dContent":"transition")+"_Markup"+m),void e();if(1===m&&g){var D=o.getReviewContext({context:Q}),v=D?D.getReviewCtxInformation():{};if(v&&v.reviewId===g)v.fromIssue=a,e(!0);else if(N){var h=N.addEvent("onDMUMarkupLoaded",(function(){N.removeEvent(h);var t=o.getReviewContext({context:Q}).getReviewCtxInformation();t&&(t.fromIssue=a),U._sendUsageProbe("loadFromIssue",(p?"x3dContent":"transition")+"_Markup"),e(!0)}));p?(p.data.items=[{objectId:g,objectType:C,envId:c,serviceId:p.data.items[0].serviceId,contextId:p.data.items[0].contextId}],Q.addRootNodesFromContent({json3DXContent:p})):q&&q.loadIfContextLoaded({objectId:g,objectType:C}).then((function(t){t||(N.removeEvent(h),U._sendUsageProbe("loadFromIssue","transition_Markup_ContextNotLoaded"),e(!0))}))}}else new Promise((function(e){p?f.issues.retrieve({data:{objects:[{physicalId:a}]}}).then((function(t){(t=t.results)&&1===t.length&&t[0]&&t[0].body&&(t[0].body.reportedAgainst.length||t[0].body.contexts.length)?(d=t[0].body.title,u=t[0].body.description,it(t[0].body.reportedAgainst,["Drawing"].concat(Oe)).then((function(e){return e.length?(e.length=1,e):it(t[0].body.contexts,["VPMReference","ENOStrRefinementSpecification"]).then((function(e){return e.length?e:it(t[0].body.reportedAgainst,["VPMReference"])}))})).then((function(t){if(0!==t.length){var n=[];"Drawing"===t[0].type?N&&(n.push(N.addEvent("on2DDocumentLoadSuccess",(function(){n.forEach(N.removeEvent,N),e(!0)}))),n.push(N.addEvent("on2DDocumentLoadFailure",(function(){n.forEach(N.removeEvent,N),e(!1)})))):(n.push(Q.subscribe({event:"onLoadingComplete"},(function(){n.forEach(Q.unsubscribe,Q),e(!0)}))),n.push(Q.subscribe({event:"onLoadingFailure"},(function(){n.forEach(Q.unsubscribe,Q),e(!1)}))));var o=p.data.items[0];p.data.items=t.map((function(e){return{objectId:e.physicalid||e.physicalId,objectType:e.type,envId:c,serviceId:o.serviceId,contextId:o.contextId}})),Q.addRootNodesFromContent({json3DXContent:p})}else e(!1)}))):e(!1)})):e(!0)})).then((function(t){if(t)if(s.getRoots(Q).length)if(N){var r=[],c=function(){r.forEach(N.removeEvent,N)};r.push(N.addEvent("onDMUMarkupCreationCancelled",(function(){c(),e(!0)}))),r.push(N.addEvent("onDMUMarkupCreationFailed",(function(){c(),e(!0)}))),r.push(N.addEvent("onDMUMarkupCreationSucceeded",(function(){c(),U._sendUsageProbe("command","CreateMarkupFromIssue");var t=o.getReviewContext({context:Q}).getReviewCtxInformation();l.connectDocumentToParent(t.reviewId,a).then((function(){t.fromIssue=a,Q.displayNotification({msg:W.markupAttachedToIssue,eventID:"success"}),e(!0)})).catch((function(){Q.displayNotification({msg:W.markupNotAttachedToIssue,eventID:"warning"}),e(!0)}))}))),r.push(N.addEvent("onDMUMarkupCreationPanelDisplayed",(function(){n&&n.destroy()}))),new Promise((function(e){var t=i.getCommand("DMUMarkupCreationForTransitionHdr");t?e(t):require(["DS/DMUPersistence/DMUCreateMarkupCmd"],(function(t){e(new t({ID:"DMUMarkupCreationForTransitionHdr",frameWindow:Q.getFrameWindow()}))}))})).then((function(e){e.setDefaultInfo({title:d,description:u}),e.begin()}))}else e(!0);else e(!0);else e(!1)})).catch(r)})).catch(r)})).catch(r)}),r)):e()})).then((function(e){e||t.onNoActionDone()})).catch(t.onNoActionDone).finally((function(){n&&n.destroy()}))},this.refreshContext=function(){var e=o.getReviewContext({context:Q});e&&(e.refreshNode(),Q.getViewer().render())},this.publish=function(e,t){z&&setTimeout((function(){Y&&Y.publish({event:e,data:t,context:J})}))},this.setappTransition=function(e){Pe=e}}}),X=[];return e.singleton({init:function(){},give3DReviewController:function(e){if(e&&e.context)for(var t=0;t<X.length;t++)if(X[t].context===e.context)return X[t].controller},get3DReviewController:function(e){var t;if(e&&e.context&&!(t=this.give3DReviewController(e))){var n=new j({ctxViewer:e.context});t=Object.freeze({setActiveState:async function(e){n&&await n.setActiveState(e)},getActiveState:function(){if(n)return n.getActiveState()},subscribe:function(e,t){if(n)return n.subscribe(e,t)},unsubscribe:function(e){n&&n.unsubscribe(e)},clearController:function(){n&&(n.clearController(),n=null)},loadReview:function(e){n&&n.loadReview(e)},appInitFromTransition:function(e){return n?n.appInitFromTransition(e):Promise.resolve()},loadValidation:function(e){n&&n.loadValidation(e)},refreshContext:function(){n&&n.refreshContext()},disableDMUContextualBar:function(){n&&n.disableDMUContextualBar()},enableDMUContextualBar:function(){n&&n.enableDMUContextualBar()},publish:function(e,t){n&&n.publish(e,t)},setappTransition:function(e){n&&n.setappTransition(e)}}),X.push({context:e.context,controller:t})}return t},unreference3DReviewController:function(e){if(e&&e.context)for(var t=0;t<X.length;t++)if(X[t].context===e.context){e.options&&e.options.appInfo&&"X3DPLAW_AP"===e.options.appInfo&&X[t].controller.setappTransition(!0),X[t].controller.clearController(),X.splice(t,1);break}}})}));