define("DS/MPFMarketplaceAdmin/couponManagement/CouponLine",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/MPFCouponModel/CouponCreationModel","DS/MPFPersonModel/PersonModel","i18n!DS/MPFMarketplaceAdmin/assets/nls/CouponManagement"],(function(e,t,s,i,r,a,n){"use strict";const o=Object.freeze({REMOVE_COUPON_LINE:"removeCouponLine"}),l=Object.freeze({YSC:"YSC",QSC:"QSC",MSC:"MSC"}),c=e.extend({className:"mpf-coupon-line",tagName:"div",setup(e){this.me=e.me,this.discount=e.discount,this.product=e.product,this.refProduct=e.refProduct,this.name=e.name,this.trigram=e.trigram,this.listPrice=e.listPrice,this.unitPrice=e.unitPrice,this.netPrice=e.netPrice,this.groupId=e.groupId,this.isTrigram=e.isTrigram,this.currency=e.currency,this.couponCreationModel=e.couponCreationModel,this.campaign=e.campaign,this.isActiveOrInactive=this.campaign.getStatus()===r.States.ACTIVE||this.campaign.getStatus()===r.States.INACTIVE,this.isCouponNotEditable=this._isCouponLineNotEditable(),this.index=e.index,this.subscription="QRC"===e.subscription?"QSC":e.subscription,this.nameColumn=this._createTextColumn("mpf-coupon-line-name",this.name),this.trigramColumn=this._createTextColumn("mpf-coupon-line-trigram",this.trigram),this.subscriptions=this._getSubscriptions(),this.subscriptionInput=this._createSusbcriptionInput(this.subscriptions),this.listPriceColumn=this._createTextColumn("mpf-coupon-line-list-price",this.listPrice),this.unitPriceColumn=this._createTextColumn("mpf-coupon-line-unit-price",this.unitPrice),this.netPriceColumn=this._createTextColumn("mpf-coupon-line-net-price",this.netPrice),this.removeBtnColumn=this._createRemoveButton(),this.subscription&&this._setPricesColumn()},render(){return this.container.setContent([this.nameColumn,this.trigramColumn,this.subscriptionInput,this.listPriceColumn,this.unitPriceColumn,this.netPriceColumn,this.removeBtnColumn]),this},destroy(){this.discount=null,this.product=null,this.refProduct=null,this.name=null,this.trigram=null,this.listPrice=null,this.unitPrice=null,this.netPrice=null,this.groupId=null,this.isTrigram=null,this.currency=null,this.nameColumn=null,this.trigramColumn=null,this.subscriptionInput=null,this.listPriceColumn=null,this.unitPriceColumn=null,this.netPriceColumn=null,this.removeBtnColumn=null,this.subscription=null,this.id=null,this._parent(),this.container=null},_createTextColumn(e,s){let i=s;return i||(i=""),t.createElement("div",{class:e,text:i})},_createSelectField(e,s,r,a){let n;return this.subscription?(this._setId(),n=new i({className:e,placeholder:s,required:r,options:a,value:this.subscription})):n=new i({className:e,placeholder:s,required:r,options:a}),n.addEvent("onChange",this._subscriptionSelected.bind(this,n)),this.isCouponNotEditable&&n.disable(),t.createElement("div",{class:"mpf-coupon-line-subscription",html:[n]})},_createRemoveButton(){return this.removeBtn=new s({value:n.get("remove"),className:"error mpf-remove-button",icon:"fonticon fonticon-trash ",disabled:this.isCouponNotEditable,events:{onClick:this._removeButtonClicked.bind(this)}}),t.createElement("div",{class:"mpf-coupon-line-remove-btn",html:[this.removeBtn]})},_isCouponLineNotEditable(){return this.isActiveOrInactive||this.campaign.getStatus()===r.States.SUBMITTED&&this.me.hasRole(a.Roles.OFFER_ADMIN)||this.campaign.getStatus()===r.States.APPROVED||this.campaign.getStatus()===r.States.REJECTED&&this.me.hasRole(a.Roles.PRICER)},_removeButtonClicked(){this.isTrigram?this.campaign.deleteSkuId(this.id):this.campaign.deleteOffer(this.id),this.dispatchEvent(o.REMOVE_COUPON_LINE,this.index)},_createSusbcriptionInput(e){return this._createSelectField("mpf-coupon-line-subscription-input",n.get("selectPlan"),!0,e)},_getSubscriptions(){let e=[];if(this.isTrigram)for(const[t,s]of Object.entries(l))this.product.getPortfolioWithLicensingScheme(s)&&e.push({value:t,label:t});else Object.keys(this.product.pricelist).forEach((t=>{let s=t;e.push({value:s,label:s})}));return e},_getOfferPricelist(e){const t=this.product.pricelist[e].findIndex((e=>e.currency===this.currency));return this.product.pricelist[e][t]},_subscriptionSelected(e){this.subscription=e.getValue()[0],this.subscription?(this._setId(),this._deleteIdFromCampaign(),this.isTrigram?this.campaign.addProductSkuId(this.id):this.campaign.addOfferPid(this.id)):(this.listPrice="",this.unitPrice="",this.netPrice=""),this._setPricesColumn(),this.removeBtn.enable(),this.render()},_setId(){if(this.isTrigram){const e=this.product.getPortfolioWithLicensingScheme(this.subscription);this.id=e.id?e.id:e.getSkuId()}else{const e=this._getOfferPricelist(this.subscription);this.id=e.id}},_deleteIdFromCampaign(){this.id&&(this.isTrigram?this.campaign.deleteSkuId(this.id):this.campaign.deleteOffer(this.id))},_setPricesColumn(){if(this.isTrigram){const e=this.product.getPortfolioWithLicensingScheme(this.subscription);this.listPrice=e.getListedPrice()?e.getListedPrice():e.getPriceList()[0].price,this.unitPrice=this.listPrice}else{const e=this._getOfferPricelist(this.subscription);this.listPrice=e.fullPrice,this.unitPrice=e.price}this.listPriceColumn.setText(this.listPrice),this.unitPriceColumn.setText(this.unitPrice),this.netPriceColumn.setText(this._computeDiscount())},_computeDiscount(){let e;return e=this.discount?this.unitPrice*(1-this.discount/100):this.unitPrice,e||(e=""),this._formatNumber(e)},_formatNumber:e=>new Intl.NumberFormat("fr-FR",{maximumFractionDigits:2,minimumFractionDigits:2}).format(e),setDiscount(e){this.discount=e;const t=this._computeDiscount();this.netPriceColumn.setText(t)},validate(){return!!this.subscription}});return c.Events=o,c.SubscriptionEnum=l,c})),define("DS/MPFMarketplaceAdmin/orderCancellation/InfoMessageComponent",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartCollection","i18n!DS/MPFMarketplaceAdmin/assets/nls/InfoMessageComponent"],(function(e,t,s,i){"use strict";const r=Object.freeze({}),a=Object.freeze({HIDDEN:"hidden",NO_RESULTS:"noResults",INITIAL:"noSearchStarted"}),n=e.extend({className:"mpf-info-message-component",setup({items:e,name:t}){this.items=e,this.name=t,this.state=a.INITIAL,this.listenTo(this.items,"onSync",this._refresh.bind(this))},render(){if(this.state===a.HIDDEN)this.container.setContent([]);else{let e,t;switch(this.state){case a.INITIAL:e=i.get("setFilterToStartSearch",{items:this.name}),t="search-filter";break;case a.NO_RESULTS:e=i.get("noResultMessage",{items:this.name}),t="docs-delete"}this.container.setContent([{tag:"div",class:`mpf-icon fonticon fonticon-${t}`},{tag:"div",class:"mpf-info-message",text:e}])}return this},destroy(){this.stopListening(),this.items=null,this._parent(),this.container=null},_refresh(){0===this.items.size()?this.state=a.NO_RESULTS:this.state=a.HIDDEN,this.render()}});return n.Events=r,n.States=a,n})),define("DS/MPFMarketplaceAdmin/couponManagement/EndDateLine",["UWA/Class/View","UWA/Core"],(function(e,t){"use strict";const s=Object.freeze({}),i=e.extend({className:"mpf-end-date-line",tagName:"div",setup(e){this.changeRequest=e.changeRequest,this.endDate=this.changeRequest.getValueNew(),this.status=this.changeRequest.getStatus(),this.approvedDate=this.changeRequest.getValidationDate(),this.endDateColumn=this._createTextColumn("mpf-end-date-line-date",this.endDate),this.statusColumn=this._createTextColumn("mpf-end-date-line-status",this.status),this.approvedDateColumn=this._createTextColumn("mpf-end-date-line-approved-date",this.approvedDate)},render(){return this.container.setContent([this.endDateColumn,this.statusColumn,this.approvedDateColumn]),this},destroy(){this.endDate=null,this.status=null,this.approvedDate=null,this.endDateColumn=null,this.statusColumn=null,this.approvedDateColumn=null,this._parent(),this.container=null},_createTextColumn(e,s){let i=s;return i||(i=""),t.createElement("div",{class:e,text:i})}});return i.Events=s,i})),define("DS/MPFMarketplaceAdmin/platformCreation/AddRoleLine",["UWA/Class/View","DS/UIKIT/Input/Select","DS/UIKIT/Input/Number","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService"],(function(e,t,s,i,r){"use strict";const a=Object.freeze({REMOVE:"remove",PRODUCT_CHANGE:"productChange"}),n=e.extend({className:"mpf-add-role-line",setup({product:e}={}){this.product=e,this.quantity=1},render({products:e}){return this.container.setContent([new t({className:"mpf-select-role",options:[this.product,...e],value:this.product,required:!0,events:{onChange:e=>{const t=e.target.value;this.product!==t&&(this.product=t,this.dispatchEvent(a.PRODUCT_CHANGE))}}}),new s({className:"mpf-number-role",min:1,max:99999,step:1,value:this.quantity,events:{onChange:e=>{this.quantity=e.target.value}}}),new i({className:"error",icon:"close",events:{onClick:()=>{this.dispatchEvent(a.REMOVE,this.product)}}})]),this},getSelectedProduct(){return this.product},getSelectedQuantity(){return this.quantity},destroy(){this._parent(),this.container=null}});return n.Events=a,n})),define("DS/MPFMarketplaceAdmin/orderCancellation/OrderCancellationFilterCommands",["UWA/Core","UWA/Class/View","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldSelectInputV2","DS/MPFCartModel/CartCollectionFilterModel","DS/MPFServices/MarketplaceServices","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation"],((e,t,s,i,r,a,n)=>{"use strict";const o=Object.freeze({COMPANY:"Company",MAKER:"Maker",STUDENT:"Student"}),l=Object.freeze({DELIVERED:"Delivered",SUBMITTED:"Submitted",REJECTED:"Rejected"}),c=Object.freeze({UK:"3DS Store Ltd",AUSTRALIA:"DS Australia Pty Ltd",USA:"Dassault Systemes USA",JAPAN:"DS K.K.",INDIA:"DS India Private Ltd"}),h=Object.freeze({REFRESH:"refresh"}),d=t.extend({domEvents:{keyup:"_onKeyUp"},className:"mpf-order-cancellation-filter-commands",setup(e){this.cartFilters=e.cartFilters,this.transactionEntry=this._createTransactionEntry(),this.customerNameEntry=this._createCustomerNameEntry(),this.siteIdEntry=this._createSiteIdEntry(),this.customerSegmentEntry=this._createCustomerSegmentEntry(),this.statusEntry=this._createStatusEntry(),this.dsSellerEntry=this._createDsSellerEntry(),this.serviceEntry=this._createServiceEntry()},render(){return this.container.setContent([this.transactionEntry,this.customerNameEntry,this.siteIdEntry,this.customerSegmentEntry,this.statusEntry,this.dsSellerEntry,this.serviceEntry]),this},destroy(){this._parent()},_onKeyUp(e){e&&"Enter"===e.key&&e.target&&"INPUT"===e.target.tagName&&this.dispatchEvent(h.REFRESH)},_createEntry:t=>e.createElement("div",{class:"mpf-order-cancellation-filter",html:[t.render()]}),_createTextField(e,t,i){return new s({model:this.cartFilters,fieldName:e,fieldLabel:t,placeholder:i,dynamicValidation:!0,silent:!1})},_createSelectField(e,t,s,r){return new i({model:this.cartFilters,fieldName:e,fieldLabel:t,placeholder:s,selectableOptions:r,dynamicValidation:!0,silent:!1,multipleOptionsSelectable:!1})},_createTransactionEntry(){const e=this._createTextField(r.Fields.FILTER_BY_TRANSACTION,n.get("transaction"),n.get("selectTransaction"));return this._createEntry(e)},_createCustomerNameEntry(){const e=this._createTextField(r.Fields.FILTER_BY_CUSTOMER_NAME,n.get("customerName"),n.get("enterCustomerName"));return this._createEntry(e)},_createSiteIdEntry(){const e=this._createTextField(r.Fields.FILTER_BY_CUSTOMER_ID,n.get("siteId"),n.get("selectSiteId"));return this._createEntry(e)},_createCustomerSegmentEntry(){const e=this._createSelectField(r.Fields.FILTER_BY_CUSTOMER_SEGMENT,n.get("customerSegment"),n.get("selectCustomerSegment"),[{value:o.COMPANY,label:n.get("company")},{value:o.MAKER,label:n.get("maker")},{value:o.STUDENT,label:n.get("student")}]);return this._createEntry(e)},_createStatusEntry(){const e=this._createSelectField(r.Fields.FILTER_BY_STATE,n.get("status"),n.get("selectStatus"),[{value:l.SUBMITTED,label:n.get("submitted")},{value:l.DELIVERED,label:n.get("delivered")},{value:l.REJECTED,label:n.get("rejected")}]);return this._createEntry(e)},_createDsSellerEntry(){const e=this._createSelectField(r.Fields.FILTER_BY_SELLER,n.get("dsSeller"),n.get("selectDsSeller"),[{value:c.UK,label:c.UK},{value:c.USA,label:c.USA},{value:c.AUSTRALIA,label:c.AUSTRALIA},{value:c.INDIA,label:c.INDIA},{value:c.JAPAN,label:c.JAPAN}]);return this._createEntry(e)},_createServiceEntry(){const e=this._createSelectField(r.Fields.FILTER_BY_REQUESTED_SERVICE,n.get("service"),n.get("selectService"),[{value:a.CLICK_AND_BUY,label:"Click & Buy"},{value:a.IFWELOOP,label:"IfweLoop"}]);return this._createEntry(e)}});return d.Events=h,d})),define("DS/MPFMarketplaceAdmin/offerManagement/OfferCreationFooterForm",["UWA/Class/View","UWA/Core","UWA/String","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Text","DS/MPFView/ValidationResultBuilder","DS/MPFOfferModel/OfferCreationModel","DS/MPFServices/ObjectService","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],(function(e,t,s,i,r,a,n,o,l,c){"use strict";const h=Object.freeze({SEARCH_BY_TRIGRAM:"SearchByTrigram",TYPE_CHANGED:"TypeChanged"}),d=Object.freeze({PERCENTAGE:"percentage",NET_PRICE:"netPrice"}),u=e.extend({className:"mpf-offer-creation-footer-form",setup(e={}){this.offerCreationModel=e.offerCreationModel,this.disableField=this.offerCreationModel.getState()===o.States.ACTIVE||this.offerCreationModel.getState()===o.States.INACTIVE||this.offerCreationModel.getState()===o.States.APPROVED,this.trigramField=this._createTrigramField(),this.trigram=this._createTrigramEntry(),this.type=this._createTypeEntry()},render(){return this.container.setContent([this.trigram,this.type]),this},destroy(){this.stopListening(),this.trigramField=null,this.trigram=null,this.type=null,this.checkboxes=null,this._parent(),this.container=null},_createTypeEntry(){const e=this._createToggleField(d.PERCENTAGE,c.get("percentage")),t=this._createToggleField(d.NET_PRICE,c.get("netPrice"));return this.checkboxes=[e,t],e.addEvent("onChange",this._typeChanged.bind(this,d.PERCENTAGE)),t.addEvent("onChange",this._typeChanged.bind(this,d.NET_PRICE)),this._createToggleEntry(c.get("type"),this.checkboxes,"mpf-type")},_typeChanged(e){this.removeErrorMessage(this.type),this.offerCreationModel.setDiscountType(e);const t=this.hidePricelistCheck(e);this.dispatchEvent(h.TYPE_CHANGED,t)},hidePricelistCheck(e){let t=!1;return t=e===d.PERCENTAGE,t},_createTrigramEntry(){const e=this._createRequired(),s=new i({value:c.get("add"),className:"primary mpf-add-button",icon:"plus",disabled:this.disableField,events:{onClick:this._addButtonClicked.bind(this)}});return t.createElement("div",{class:"mpf-offer-trigram",html:[t.createElement("div",{class:"mpf-label",html:[c.get("trigram"),"&nbsp;",e]}),this.trigramField,s]})},_addButtonClicked(){this.removeErrorMessage(this.trigram),this.dispatchEvent(h.SEARCH_BY_TRIGRAM,this.trigramField)},_createToggleField(e,t){const s=new r({className:"mpf-toggle primary",fieldName:e,name:"discountType",label:t,type:"radio",disabled:this.disableField});return this.offerCreationModel.getDiscountType()===e&&s.setCheck(!0),s},_createRequired:()=>t.createElement("em",{class:"mpf-required",text:"*"}),_createToggleEntry(e,s,i){const r=this._createRequired();return t.createElement("div",{class:"mpf-offer-toggle "+i,html:[t.createElement("div",{class:"mpf-label",html:[e,"&nbsp;",r]}),s]})},_createTrigramField(){return new a({className:"mpf-trigram-input-text",placeholder:c.get("enterTrigram"),disabled:this.disableField})},validateType(){const e=new n;this.removeErrorMessage(this.type);this.checkboxes.find((e=>e.isChecked()))||e.addError(c.get("type"),s.format(c.get("requiredField"),c.get("type")));const t=e.build();return t.isValid||this.displayErrorMessage(t,this.type),t},displayErrorMessage(e,s){const i=e.errors[0];s.addClassName("mpf-invalid"),t.createElement("p",{class:"mpf-error",text:t.is(i.message)?i.message:""}).inject(s)},removeErrorMessage(e){e.removeClassName("mpf-invalid");const s=e.getElement("p");t.is(s)&&e.removeChild(s)}});return u.Events=h,u.DiscountType=d,u})),define("DS/MPFMarketplaceAdmin/orderCancellation/CommentsTile",["UWA/Class/View","DS/UIKIT/Spinner","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFPersonModel/PersonModel","DS/MPFCartModel/CartNotesFactory","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartNotesModel","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation"],(function(e,t,s,i,r,a,n,o,l,c,h){"use strict";const d=Object.freeze({}),u=Object.freeze({INITIAL:"initial",DISPLAY:"display",EDIT:"edit"}),p=e.extend({className:"mpf-comments-tile",setup({me:e,cart:t,cartNotesFactory:s,state:i}={}){a.requiredOfPrototype(e,n,"options.me must be a PersonModel"),a.requiredOfPrototype(t,l,"options.cart must be a CartModel"),a.requiredOfPrototype(s,o,"options.cartNotesFactory must be a CartNotesFactory"),this.me=e,this.cart=t,this.cartNotesFactory=s,this.state=i||u.INITIAL,this.cartNotes=this.cartNotesFactory.createModel(o.Types.CART_NOTES),this.spinner=this._createSpinner(),this.input=this._createInput()},render(){let e;if(this.state===u.INITIAL)e=this.spinner,this._fetchCartNotes();else if(this.state===u.DISPLAY){const t=this.cartNotes.getNotes();e=[{tag:"div",class:"mpf-comment",...t?{text:t}:{html:[{tag:"i",text:h.get("noCommentsAdded")}]}}];this.me.hasRole(n.Roles.PRICER)&&e.push({tag:"span",class:"mpf-icon fonticon fonticon-pencil",events:{click:()=>{this.state=u.EDIT,this.render()}}})}else this.state===u.EDIT&&(this.input.setValue(this.cartNotes.getNotes()||""),e=[{tag:"div",class:"mpf-comment",html:this.input},{tag:"div",class:"mpf-buttons",html:[new s({className:"primary",value:h.get("save"),events:{onClick:()=>this._saveNotes()}}),new s({value:h.get("cancel"),events:{onClick:()=>{this.state=u.DISPLAY,this.render()}}})]}]);return this.container.setContent(e),this},reset(){this.state===u.EDIT&&(this.state=u.DISPLAY)},destroy(){this.me=null,this.cart=null,this.cartNotes=null,this.cartNotesFactory=null,this._parent(),this.container=null},async _fetchCartNotes(){const e=this.cart.get(l.Fields.CART_NOTES_ID);e?(this.cartNotes.set("id",e),await this.cartNotes.fetchPromise()):this.cartNotes.setCartId(this.cart.get("id")),this.state=u.DISPLAY,this.render()},async _saveNotes(){this.cartNotes.setNotes(this.input.getValue()),r.mask(this.container),this.cartNotes.isNew()?(this.cartNotes.setCartId(this.cart.get("id")),await this.cartNotes.savePromise()):await this.cartNotes.savePromise(this.cartNotes.pick(c.Fields.PRIVATE_NOTES),{patch:!0}),r.unmask(this.container),this.state=u.DISPLAY,this.render()},_createInput:()=>new i({multiline:!0,rows:4}),_createSpinner:()=>new t({visible:!0})});return p.States=u,p.Events=d,p})),define("DS/MPFMarketplaceAdmin/sellerRoles/SellerRolesContent",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Toggle","DS/UIKIT/Alert","DS/UIKIT/Spinner","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFServices/MarketplaceServices","DS/MPFPersonRolesModel/PersonRolesFactory","DS/MPFPersonRolesModel/PersonRolesModel","i18n!DS/MPFMarketplaceAdmin/assets/nls/SellerRoles","css!DS/MPFMarketplaceAdmin/MPFMarketplaceAdmin.css"],((e,t,s,i,r,a,n,o,l,c,h)=>{"use strict";const d=Object.freeze({INITIAL:"initial",LOADING:"loading",LOADED:"loaded",NO_USER_FOUND:"noUserFound"}),u=[o.MAKE,o.ENGINEERING,o.INNOVATE,o.PART_SUPPLY],p=new Map;p.set(o.MAKE,h.get("makeSeller")),p.set(o.ENGINEERING,h.get("engineeringSeller")),p.set(o.INNOVATE,h.get("innovateSeller")),p.set(o.PART_SUPPLY,h.get("partSupplySeller"));return e.extend({className:"mpf-user-roles",setup({personRolesFactory:e}){n.requiredOfPrototype(e,l,"options.personRolesFactory must be a PersonRolesFactory"),this.personRolesFactory=e,this.state=d.INITIAL,this.spinner=new r,this.alert=new i({visible:!1,autoHide:!0,hideDelay:5e3})},async load({user:e}){this.personRolesModel=this.personRolesFactory.createModel(l.Types.USER),this.state=d.LOADING,this.render();try{await this.personRolesModel.fetchPromise({user:e}),this.state=d.LOADED,this.render()}catch(e){console.error(e),e&&e.response&&"Error.ResourceDoesNotExist"===e.response.errorCode?(this.state=d.NO_USER_FOUND,this.render()):(this.state=d.INITIAL,this.render(),this.alert.add({className:"error",text:h.get("userSearchFailed")}).show())}},render(){let e;return this.state===d.INITIAL?e=[this.alert,{tag:"div",class:"mpf-info-message",text:h.get("noUserSelected")}]:this.state===d.LOADING?e=[this.alert,this.spinner.show()]:this.state===d.NO_USER_FOUND?e=[this.alert,{tag:"div",class:"mpf-error-message",text:h.get("noUserFound")}]:this.state===d.LOADED&&(e=[this.alert,...this._renderLoadedState()]),this.container.setContent(e),this},destroy(){this.personRolesFactory=null,this.personRolesModel=null,this._parent()},async _toggleRole({service:e}){if(this.personRolesModel){a.mask(this.container);try{let t;if(this.personRolesModel.hasSellerRoleForService(e))t=await this.personRolesModel.removeRoles([c.SellerRoles[e]]);else{const s=[c.SellerRoles[e]];if(this.personRolesModel.hasBuyerRoleForService(e)||s.push(c.BuyerRoles[e]),t=await this.personRolesModel.addRoles(s),t&&1===t.code)throw new Error("unable to save role")}await this.personRolesModel.fetchPromise({user:this.personRolesModel.get("id")}),a.unmask(this.container),this.render()}catch(e){this.render(),a.unmask(this.container),console.error(e),this.alert.add({className:"error",text:h.get("unableToSaveRoleModification")}).show()}}},_renderLoadedState(){return[{tag:"h4",text:h.get("userRoles")},this._createRolesResults(),{tag:"p",text:h.get("rolesGranted")},u.map((e=>this._createToogle({service:e}))),{tag:"hr"}]},_createRolesResults(){return t.createElement("div",{class:"mpf-user-roles-results",html:[{tag:"div",html:[{tag:"span",class:"mpf-bold",text:"Email: "},{tag:"span",class:"mpf-email",text:this.personRolesModel.getEmail()}]},{tag:"div",html:[{tag:"span",class:"mpf-bold",text:"Login: "},{tag:"span",class:"mpf-login",text:this.personRolesModel.get("id")}]}]})},_createToogle({service:e}){return new s({type:"switch",checked:this.personRolesModel.hasSellerRoleForService(e),className:"primary",value:e,label:p.get(e),events:{onChange:()=>{this._toggleRole({service:e})}}})}})})),define("DS/MPFMarketplaceAdmin/orderCancellation/CartStateTile",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel"],(function(e,t,s,i){"use strict";const r=Object.freeze({DOWNLOAD_FILE:"downloadFile"}),a=[[i.States.CANCELLED],[i.States.SUBMITTED],[i.States.PENDING_PAYMENT],[i.States.PAYMENT_INITIATED,i.States.PAYMENT_ACCEPTED],[i.States.PAYMENT_COMPLETE],[i.States.PROCESSING],[i.States.FINISHED,i.States.SHIPPED],[i.States.DELIVERED]],n=[["REJECTED","BLOCKED","REFUND_FAILED"],["SUBMITTED"],["CONFIRMED"],["PROCESSING"],["DELIVERED"]],o=t.extend({className:"mpf-cart-state-tile",setup(e={}){s.requiredOfPrototype(e.cart,i,"options.cart must be a CartModel"),this.cart=e.cart},render(){const e=[{tag:"span",class:"mpf-cart-state-icon mpf-icon"+this._getStateIconClass()},{tag:"span",class:"mpf-cart-state",text:this.cart.getState()},{tag:"span",class:"mpf-download-icon mpf-icon fonticon fonticon-download",events:{click:this.dispatchEvent.bind(this,r.DOWNLOAD_FILE)}}];return this.container.setContent([{tag:"div",class:"mpf-first-line",html:e},{tag:"div",class:"mpf-progress-bar",html:[{tag:"span",class:"mpf-grey-bar"},{tag:"span",class:"mpf-green-bar",styles:{width:this._getGreenBarWidth()}}]}]),this},_getStateIconClass(){return this.cart.getState()===i.States.DELIVERED?" fonticon fonticon-status-ok":""},_getGreenBarWidth(){const e=this.cart.getState(),t=this.cart.isCancellation()?n:a;return t.findIndex((t=>t.indexOf(e)>-1))/(t.length-1)*100+"%"},destroy(){this._parent(),this.container=null}});return o.Events=r,o})),define("DS/MPFMarketplaceAdmin/platformCreation/PlatformCreationForm",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Alert","DS/MPFBusinessExperienceDevPlatform/BusinessExperienceDevPlatformModel","DS/MPFView/FieldTextInputV2","i18n!DS/MPFMarketplaceAdmin/assets/nls/PlatformCreation","css!DS/MPFMarketplaceAdmin/MPFMarketplaceAdmin.css"],((e,t,s,i,r,a,n)=>{"use strict";const o=Object.freeze({BACK:"back"}),l=t.extend({className:"mpf-platform-creation-form",setup(e){this.beDevPlatform=e.beDevPlatform,this.alert=this._createAlert(),this.backButton=this._createBackButton(),this.adminPlatformField=this._createAdminPlatformField(),this.createPlatformButton=this._createCreatePlatformButton()},render(){return this.container.setContent([this.backButton,this.alert,this.adminPlatformField.render(),this.createPlatformButton]),this},destroy(){this._parent()},_createAlert:()=>new i({fullWidth:!0}),_createBackButton(){return e.createElement("div",{class:"mpf-back-button fonticon fonticon-chevron-left",events:{click:this._onBack.bind(this)}})},_createAdminPlatformField(){return new a({model:this.beDevPlatform,fieldName:r.Fields.PLATFORM_ADMIN,fieldLabel:n.get("devPlatformAdmin"),required:!0,dynamicValidation:!0})},_createCreatePlatformButton(){return new s({value:n.get("createPlatform"),className:"primary",events:{onClick:this._onCreatePlatform.bind(this)}})},_onCreatePlatform(){this.createPlatformButton.load(!0,n.get("sendingRequest")),this.beDevPlatform.savePromise(void 0,{retry:0}).then((()=>{this.dispatchEvent(o.BACK)})).catch((()=>{this.alert.show(),this.alert.add({className:"error",message:n.get("unableToRequestPlatformCreation")})})).finally((()=>{this.createPlatformButton.load(!1)}))},_onBack(){this.dispatchEvent(o.BACK)}});return l.Events=o,l})),define("DS/MPFMarketplaceAdmin/couponManagement/CouponManagementFilterCommands",["UWA/Core","UWA/Class/View","DS/MPFCouponModel/CouponCollectionFilterModel","DS/MPFCouponModel/CouponCreationModel","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldSelectInputV2","DS/MPFView/DropdownFieldDateInput","DS/UIKIT/Input/Button","DS/MPFView/FieldToggleInput","DS/MPFPersonModel/PersonModel","i18n!DS/MPFMarketplaceAdmin/assets/nls/CouponManagement"],(function(e,t,s,i,r,a,n,o,l,c,h){"use strict";const d=Object.freeze({NEW_REQUEST_COUPON:"newRequestCoupon",REFRESH:"refresh"}),u=t.extend({className:"mpf-coupon-management-filter-commands",setup(e){this.me=e.me,this.couponFilters=e.couponFilters,this.me.hasRole(c.Roles.OFFER_ADMIN)&&(this.couponRequestButton=this._createCouponRequestBouton()),this.codeEntry=this._createCodeEntry(),this.nameEntry=this._createNameEntry(),this.statusEntry=this._createStatusEntry(),this.categoryEntry=this._createCategoryEntry(),this.pendingRequestEntry=this._createPendingRequestEntry(),this.startDateEntry=this._createStartDateEntry(),this.endDateEntry=this._createEndDateEntry()},render(){return this.container.setContent([this.couponRequestButton,this.codeEntry,this.nameEntry,this.categoryEntry,this.statusEntry,this.pendingRequestEntry,this.startDateEntry,this.endDateEntry]),this},destroy(){this.stopListening(),this.me=null,this.couponFilters=null,this.couponRequestButton&&this.couponRequestButton.destroy(),this.codeEntry=null,this.nameEntry=null,this.statusEntry=null,this.categoryEntry=null,this.pendingRequestEntry=null,this.startDateEntry=null,this.endDateEntry=null,this._parent(),this.container=null},_createEntry:(t,s)=>e.createElement("div",{class:s,html:[t.render()]}),_createTextField(e,t,s){const i=new r({model:this.couponFilters,fieldName:e,fieldLabel:t,placeholder:s,dynamicValidation:!0,silent:!1});return this.listenTo(i,r.Events.UPDATE,this.dispatchEvent.bind(this,d.REFRESH)),i},_createSelectField(e,t,s,i){const r=new a({model:this.couponFilters,fieldName:e,fieldLabel:t,placeholder:s,selectableOptions:i,dynamicValidation:!0,silent:!1,multipleOptionsSelectable:!1});return this.listenTo(r,a.Events.UPDATE,this.dispatchEvent.bind(this,d.REFRESH)),r},_createDatePicker(e,t,s){const i=new n({model:this.couponFilters,fieldName:e,fieldLabel:t,placeholder:s,useIsoFormat:!0,renderDatePickerInside:!0});return this.listenTo(i,n.Events.UPDATE,this.dispatchEvent.bind(this,d.REFRESH)),i},_createToggleField(e,t){const s=new l({model:this.couponFilters,fieldName:e,fieldLabel:t,dynamicValidation:!1});return this.listenTo(s,l.Events.UPDATE,this.dispatchEvent.bind(this,d.REFRESH)),s},_createToggleEntry:(t,s,i)=>e.createElement("div",{class:t,html:[e.createElement("div",{class:"mpf-label",text:s}),i.render()]}),_createCouponRequestBouton(){return new o({value:h.get("requestCoupon"),className:"primary mpf-coupon-button",icon:"plus",events:{onClick:this.dispatchEvent.bind(this,d.NEW_REQUEST_COUPON)}})},_createCodeEntry(){const e=this._createTextField(s.Fields.FILTER_BY_COMMERCIAL_NAME,h.get("code"),h.get("enterValue"));return this._createEntry(e,"mpf-coupon-filter-text mpf-code")},_createNameEntry(){const e=this._createTextField(s.Fields.FILTER_BY_INTERNAL_NAME,h.get("name"),h.get("enterValue"));return this._createEntry(e,"mpf-coupon-filter-text mpf-name")},_createStatusEntry(){const e=this._createSelectField(s.Fields.FILTER_BY_STATUS,h.get("status"),h.get("selectStatus"),[{value:i.States.DRAFT,label:h.get("draft")},{value:i.States.SUBMITTED,label:h.get("submitted")},{value:i.States.APPROVED,label:h.get("approved")},{value:i.States.REJECTED,label:h.get("rejected")},{value:i.States.ACTIVE,label:h.get("active")},{value:i.States.INACTIVE,label:h.get("inactive")}]);return this._createEntry(e,"mpf-coupon-filter-select mpf-status")},_createCategoryEntry(){const e=this._createSelectField(s.Fields.FILTER_BY_CATEGORY,h.get("category"),h.get("selectCategory"),[{value:i.Categories.SPECIAL_EVENT,label:h.get("specialEvent")},{value:i.Categories.INFLUENCER,label:h.get("influencer")},{value:i.Categories.SINGLE_USE,label:h.get("singleUse")},{value:i.Categories.PARTNER,label:h.get("partner")},{value:i.Categories.OTHER,label:h.get("other")}]);return this._createEntry(e,"mpf-coupon-filter-select mpf-category")},_createPendingRequestEntry(){const e=this._createToggleField(s.Fields.FILTER_BY_PENDING_REQUEST,"");return this._createToggleEntry("mpf-coupon-filter-toggle mpf-pending",h.get("pendingRequest"),e)},_createStartDateEntry(){const e=this._createDatePicker(s.Fields.FILTER_BY_START_DATE,h.get("startDate"),h.get("enterDate"));return this._createEntry(e,"mpf-coupon-filter-date mpf-start-date")},_createEndDateEntry(){const e=this._createDatePicker(s.Fields.FILTER_BY_END_DATE,h.get("endDate"),h.get("enterDate"));return this._createEntry(e,"mpf-coupon-filter-date mpf-end-date")}});return u.Events=d,u})),define("DS/MPFMarketplaceAdmin/orderCancellation/CardProductList",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation"],(function(e,t,s,i){"use strict";const r=Object.freeze({}),a=Object.freeze({COLLAPSED:"collapsed",EXPANDED:"expanded"}),n=e.extend({className:"mpf-cart-product-list",setup({cart:e,locale:i,state:r}={}){t.requiredOfPrototype(e,s,"options.cart must be a CartModel"),this.cart=e,this.locale=i,this.state=r||a.COLLAPSED},render(){const e=this.cart.getItems(),t=this.state===a.EXPANDED?e.map((e=>this._renderBodyCells(e))):[this._renderBodyCells(this.cart.getItems()[0])];return this.container.setContent([{tag:"div",class:"mpf-table",html:[{tag:"div",class:"mpf-table-header",html:this._renderHeaderCells()},{tag:"div",class:"mpf-table-body",html:t}]},e.length>1&&this._renderShowMoreContainer()]),this},_renderHeaderCells:()=>[i.get("products"),i.get("subscription"),i.get("quantity"),i.get("unitPrice"),i.get("totalPrice")].map((e=>({tag:"div",class:"mpf-th-cell",text:e}))),destroy(){this.cart=null,this._parent(),this.container=null},_renderBodyCells(e){if(!e)return;const t=parseInt(e.getQuantity()),s=e.getUnitNetAmount();let r=e.getLicensingScheme();"QRC"===r&&(r="QSC");const a=[{tag:"div",class:"mpf-product-title-cell",html:[{tag:"div",class:"mpf-cart-item-name",text:e.getProductDisplayName()},{tag:"div",class:"mpf-product-number-container",html:[{tag:"span",class:"mpf-label",text:i.get("productNumber")},{tag:"span",class:"mpf-value",text:e.getProductNumber()}]}]}];return[r,t,this._renderPrice(s),this._renderPrice(s*t)].forEach((e=>{a.push({tag:"td",text:e})})),a},_renderShowMoreContainer(){return{tag:"div",class:"mpf-show-more-container",html:[{tag:"a",text:this.state===a.EXPANDED?i.get("showLess"):i.get("showMore"),events:{click:()=>{this.state=this.state===a.EXPANDED?a.COLLAPSED:a.EXPANDED,this.render()}}}]}},_renderPrice(e){return parseFloat(e).toLocaleString(this.locale,{style:"currency",currency:this.cart.getCurrency()})}});return n.Events=r,n})),define("DS/MPFMarketplaceAdmin/couponManagement/NumberOfUseLine",["UWA/Class/View","UWA/Core"],(function(e,t){"use strict";const s=Object.freeze({}),i=e.extend({className:"mpf-number-of-use-line",tagName:"div",setup(e){this.changeRequest=e.changeRequest,this.nbOfUse=this.changeRequest.getValueNew(),this.status=this.changeRequest.getStatus(),this.approvedDate=this.changeRequest.getValidationDate(),this.nbOfUseColumn=this._createTextColumn("mpf-number-of-use-line-nb-of-use",this.nbOfUse),this.statusColumn=this._createTextColumn("mpf-number-of-use-line-status",this.status),this.approvedDateColumn=this._createTextColumn("mpf-number-of-use-line-approved-date",this.approvedDate),this.usageColumn=this._createTextColumn("mpf-number-of-use-line-usage",this.usage)},render(){return this.container.setContent([this.nbOfUseColumn,this.statusColumn,this.approvedDateColumn,this.usageColumn]),this},destroy(){this.nbOfUse=null,this.status=null,this.approvedDate=null,this.nbOfUseColumn=null,this.statusColumn=null,this.approvedDateColumn=null,this.usageColumn=null,this._parent(),this.container=null},_createTextColumn(e,s){let i=s;return i||(i=""),t.createElement("div",{class:e,text:i})},setUsage(e){this.usage=e,this.usageColumn&&(this.usageColumn=null,this.usageColumn=this._createTextColumn("mpf-number-of-use-line-usage","/"+this.usage))},getUsage(){return this.usage}});return i.Events=s,i})),define("DS/MPFMarketplaceAdmin/sellerRoles/SellerRolesUserSearch",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","i18n!DS/MPFMarketplaceAdmin/assets/nls/SellerRoles","css!DS/MPFMarketplaceAdmin/MPFMarketplaceAdmin.css"],((e,t,s,i,r)=>{"use strict";const a=Object.freeze({SEARCH_USER:"searchUser"}),n=e.extend({className:"mpf-user-search",setup(){this.input=this._createLoginEmailInput(),this.button=this._createSearchButton()},render(){return this.container.setContent([{tag:"h4",text:r.get("userSearch")},{tag:"label",text:r.get("loginEmail")},{tag:"div",class:"mpf-user-search",html:[{tag:"div",class:"mpf-user-search-container",html:[this.input,this.button]},{tag:"hr"}]}]),this},destroy(){this.SellerRolesUserSearch=null,this._parent()},_searchUser(){const e=this.input.getValue();this.dispatchEvent(a.SEARCH_USER,{user:e})},_createLoginEmailInput:()=>new i({placeholder:r.get("enterEmailOrLogin"),attributes:{type:"email",id:"email"}}),_createSearchButton(){return new s({className:"primary",value:"Search",events:{onClick:this._searchUser.bind(this)}})}});return n.Events=a,n})),define("DS/MPFMarketplaceAdmin/AccessForbiddenPage",["UWA/Class/View","i18n!DS/MPFMarketplaceAdmin/assets/nls/AccessForbiddenPage","css!DS/MPFMarketplaceAdmin/MPFMarketplaceAdmin.css"],(function(e,t){"use strict";const s=Object.freeze({}),i=e.extend({className:"mpf-access-forbidden-page",setup(){},render(){return this.container.setContent([{tag:"div",class:"fonticon fonticon-block"},{tag:"div",class:"mpf-title",text:t.get("accessForbidden")}]),this},destroy(){this._parent(),this.container=null}});return i.Events=s,i})),define("DS/MPFMarketplaceAdmin/orderCancellation/CancellationModalFileInput",["UWA/Core","UWA/Class/View","DS/MPFView/DropZone","DS/MPFView/ControlsTag","DS/MPFServices/ObjectService","DS/MPFDocumentModel/DocumentFactory","DS/MPFDocumentModel/DocumentModel","DS/MPFCartModel/CartCancellationModel"],(function(e,t,s,i,r,a,n,o){"use strict";const l=Object.freeze({}),c=t.extend({className:"mpf-cancellation-modal-file-input",setup({documentFactory:e}={}){r.requiredOfPrototype(e,a,"options.documentFactory must be a DocumentFactory"),this.documentFactory=e,this.hiddenInput=this._createHiddenInput(),this.dropZone=this._createDropZone(),this.files=[]},render(){return this.container.setContent([this.hiddenInput,this.dropZone.render(),this._createFileList()]),this},reset(){return this.files=[],this},save({cartCancellation:e}={}){return r.requiredOfPrototype(e,o,"options.cart must be a CartCancellationModel"),Promise.all(this.files.map((t=>this.documentFactory.createModel(a.Types.DOCUMENT,{[n.Fields.CART_ID]:e.get("id"),[n.Fields.TYPE]:n.Types.CART_CANCELLATION}).saveDocument({file:t}))))},destroy(){this.stopListening(),this.dropZone.destroy(),this._parent(),this.container=null},_addFiles({files:e}){this.files=this.files.concat(e),this.render()},_deleteFile(e){this.files.splice(e,1),this.render()},_createFileList(){return e.createElement("div",{class:"mpf-file-list",html:this.files.map(this._createFileItem.bind(this))})},_createFileItem(e,t){const s=new i({value:e.name,isReadOnly:!0});return this.listenTo(s,i.Events.DELETE,this._deleteFile.bind(this,t)),s.render()},_createHiddenInput(){const t=this;return e.createElement("input",{attributes:{multiple:!0,name:"documents",type:"file"},events:{change:function(){t._addFiles({files:[...this.files]}),this.value=""}}})},_createDropZone(){const e="draggable"in document.createElement("span")?"":"mpf-mobile",t=new s({acceptedFileTypes:["application/pdf","image/png","image/jpeg","image/bmp","image/gif"],additionalClassName:e});return this.listenTo(t,s.Events.ON_CLICK,(()=>{this.hiddenInput.click()})),this.listenTo(t,s.Events.ON_DROP,this._addFiles.bind(this)),t}});return c.Events=l,c})),define("DS/MPFMarketplaceAdmin/offerManagement/SubscriptionPlanProductLine",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Button","DS/UIKIT/Input/Number","DS/MPFOfferModel/OfferCreationModel","DS/MPFServices/ObjectService","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],(function(e,t,s,i,r,a,n,o){"use strict";const l=Object.freeze({REMOVE_PRODUCT:"RemoveProduct",COMPUTE_NET_PRICE:"ComputeNetPrice",ADJUST_CHANGED:"AdjustChanged"}),c=Object.freeze({MAX_KEY_VALUE:100,MIN_KEY_VALUE:0}),h=e.extend({className:"mpf-subscription-plan-product-line",tagName:"tr",setup(e={}){this.offerCreationModel=e.offerCreationModel,this.portfolioPackCollection=e.portfolioPackCollection,this.name=e.name,this.trigram=e.trigram,this.listPrice=e.listPrice,this.mainComponent=e.mainComponent,this.disableField=this.offerCreationModel.getState()===a.States.ACTIVE||this.offerCreationModel.getState()===a.States.INACTIVE||this.offerCreationModel.getState()===a.States.APPROVED,this.productName=this._createTextColumn("name",this.name),this.productTrigram=this._createTextColumn("trigram",this.trigram),this.productListPrice=this._createTextColumn("listPrice",this._formatNumber(this.listPrice)),this.productPercentage=this._createColumn("",""),this.productPercentageOfferPrice=this._createTextColumn("percentage-price",this._formatNumber(this.listPrice)),this.productAdjust=this._createAdjustInput(),this.productKey=this._createKeyInput(),this.netPriceOfferPrice=this._createTextColumn("net-offer-price",this._formatNumber(this.listPrice)),this.removeButton=this._createRemoveButton(),this.mainComponent||this.disableElements()},render(){return this.container.setContent([this.productName,this.productTrigram,this.productListPrice,this.productPercentage,this.productPercentageOfferPrice,this.productAdjust,this.productKey,this.netPriceOfferPrice,this.removeButton]),this},destroy(){this.stopListening(),this.offerCreationModel=null,this.portfolioPackCollection=null,this.name=null,this.trigram=null,this.listPrice=null,this.productName=null,this.productTrigram=null,this.productListPrice=null,this.productPercentage=null,this.productPercentageOfferPrice=null,this.productAdjust=null,this.adjust&&this.adjust.destroy(),this.productKey=null,this.key&&this.key.destroy(),this.netPriceOfferPrice=null,this.removeButton=null,this._parent(),this.container=null},disableElements(){this.adjust.disable(),this.key.disable(),this.removeButton.hide()},_createTextColumn:(e,s)=>t.createElement("td",{class:"mpf-subscription-plan-product-line-"+e,text:s}),_createColumn:(e,s)=>t.createElement("td",{class:"mpf-subscription-plan-product-line-"+e,html:[s]}),_createAdjustInput(){return this.adjust=new s({className:"mpf-toggle primary",type:"checkbox",fieldName:"adjust",disabled:this.disableField,label:" ",events:{onChange:this.dispatchEvent.bind(this,l.ADJUST_CHANGED,this.trigram)}}),this.listPrice||this.adjust.disable(),this._createColumn("adjust-input",this.adjust)},_createKeyInput(){return this.key=new r({fieldName:o.get("key"),min:0,max:100,step:.01,disabled:!0,events:{onChange:this.dispatchEvent.bind(this,l.COMPUTE_NET_PRICE)}}),this._createColumn("key-input",this.key)},disableKeyInput(){this.disableField&&this.key.disable()},_createRemoveButton(){const e=new i({value:o.get("remove"),className:"error mpf-remove-button",icon:"fonticon fonticon-trash ",disabled:this.disableField,events:{onClick:this.removeButtonClicked.bind(this)}});return t.createElement("td",{class:"mpf-subscription-plan-product-line-remove",html:[e]})},removeButtonClicked(){const e=this.offerCreationModel.getProducts();if(e.find((e=>e===this.trigram))){const t=e.indexOf(this.trigram);e.splice(t,1)}this.dispatchEvent(l.REMOVE_PRODUCT,this.trigram)},getListPrice(){return this._unformatNumber(this.productListPrice.getText())},setNetPrice(e){this.netPriceOfferPrice.setText(this._formatNumber(e))},getNetPrice(){return this._unformatNumber(this.netPriceOfferPrice.getText())},setPercentage(e){this.productPercentageOfferPrice.setText(this._formatNumber(e))},getPercentage(){return this._unformatNumber(this.productPercentageOfferPrice.getText())},_formatNumber:e=>new Intl.NumberFormat("fr-FR",{maximumFractionDigits:2,minimumFractionDigits:2}).format(e),_unformatNumber:e=>e.toString().replace(/\s+/g,"").replace(",",".")});return h.Events=l,h.KeyValues=c,h})),define("DS/MPFMarketplaceAdmin/orderCancellation/AttachmentsTile",["UWA/Class/View","DS/UIKIT/Spinner","DS/UIKIT/Mask","DS/UIKIT/Input/File","DS/MPFServices/ObjectService","DS/MPFPersonModel/PersonModel","DS/MPFCartModel/CartModel","DS/MPFDocumentModel/DocumentModel","DS/MPFDocumentModel/DocumentFactory","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation"],(function(e,t,s,i,r,a,n,o,l,c){"use strict";const h=Object.freeze({}),d=Object.freeze({INITIAL:"initial",LOADED:"loaded"}),u=e.extend({className:"mpf-attachments-tile",setup({me:e,cart:t,documentFactory:s,state:i=d.INITIAL}={}){r.requiredOfPrototype(e,a,"options.me must be a PersonModel"),r.requiredOfPrototype(t,n,"options.cart must be a CartModel"),r.requiredOfPrototype(s,l,"options.documentFactory must be a DocumentFactory"),this.cart=t,this.documentFactory=s,this.state=i,this.documents=this._createDocCollection(),this.spinner=this._createSpinner();e.hasRole(a.Roles.PRICER)&&(this.fileInput=this._createFileInput())},render(){let e;return this.state===d.INITIAL?(e=[this.spinner],this._fetchFiles()):e=[{tag:"div",class:"mpf-doc-lines",html:[this._renderDocLines()]},this.fileInput],this.container.setContent(e),this},destroy(){this.cart=null,this.documentFactory=null,this._parent(),this.container=null},async _fetchFiles(){s.mask(this.container),await Promise.all(this.documents.map((e=>e.fetchPromise()))),s.unmask(this.container),this.state=d.LOADED,this.render()},async _uploadFile(e){const t=e.target.files[0],i=this.documentFactory.createModel(l.Types.DOCUMENT,{[o.Fields.CART_ID]:this.cart.get("id"),[o.Fields.TYPE]:o.Types.CART_CANCELLATION});s.mask(this.container),await i.saveDocument({file:t}),s.unmask(this.container),this.documents.push(i),this.render()},_createDocCollection(){const e=this.cart.get(n.Fields.DOCUMENT_IDS),t=e?e.map((e=>({id:e}))):[];return this.documentFactory.createCollection(l.Types.DOCUMENT,t)},_renderDocLines(){return this.documents.size()>0?this.documents.map((e=>this._renderDocLine(e))):{tag:"div",class:"mpf-no-doc-comment",text:c.get("noDocumentUploaded")}},_renderDocLine:e=>({tag:"div",class:"mpf-doc-line",html:[{tag:"span",class:"mpf-doc-name",text:e.get(o.Fields.NAME)},{tag:"span",class:"mpf-icon fonticon fonticon-download",events:{click:()=>{window.open(e.get(o.Fields.URL))}}}]}),_createFileInput(){return new i({input:!1,buttonText:c.get("attachFile"),events:{onChange:this._uploadFile.bind(this)}})},_createSpinner:()=>new t({visible:!0})});return u.Events=h,u})),define("DS/MPFMarketplaceAdmin/StateProgressTile",["UWA/Class/View","UWA/Core","DS/MPFServices/ObjectService","DS/MPFOfferModel/OfferCreationModel","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],(function(e,t,s,i,r){"use strict";const a=Object.freeze({DRAFT:"DRAFT",SUBMITTED:"SUBMITTED",APPROVED:"APPROVED",REJECTED:"REJECTED",ACTIVE:"ACTIVE",INACTIVE:"INACTIVE"}),n=e.extend({className:"mpf-state-progress",setup(e={}){this.model=e.model,this.state=e.state,"TERMINATED"===this.state&&(this.state=a.INACTIVE)},render(){return this.container.setContent([this._getProgressBarContainer(),this._getStatusContainer()]),this},destroy(){this._parent(),this.container=null},_computeStepWidth(e){const t=Object.keys(a).length;return a[e]/t},_getProgressBarContainer(){return t.createElement("div",{class:"mpf-progress-bar",html:[{tag:"span",class:"mpf-grey-bar"},{tag:"span",class:"mpf-green-bar",styles:{width:this._createGreenBar()}}]})},_createGreenBar(){const e=Object.values(a);return(e.findIndex((e=>e===this.state))+1)/e.length*100+"%"},_getStatusContainer(){return t.createElement("div",{class:"mpf-state",html:[t.createElement("span",{class:"mpf-state-label",text:r.get(this.state.toLowerCase())})]})}});return n.States=a,n})),define("DS/MPFMarketplaceAdmin/offerManagement/AutocompleteInput",["UWA/Core","UWA/String","UWA/Class/View","DS/UIKIT/Autocomplete","DS/MPFServices/ObjectService","DS/MPFView/ValidationResultBuilder","DS/MPFOfferModel/OfferCreationModel","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],(function(e,t,s,i,r,a,n,o){"use strict";const l=Object.freeze({UPDATE:"update",OUTSIDE_CLICK:"outsideClick"}),c=s.extend({className:"mpf-entry-autocomplete-input",setup(e={}){this.fieldName=e.fieldName,this.fieldLabel=e.fieldLabel,this.readOnly=!0===e.readOnly,this.required=!0===e.required,this.offersList=e.offersList,this.saveOnChange=!0===e.saveOnChange,this.model=e.model,this.autocomplete=this._createAutocomplete(),this.entry=this._createEntry(this.fieldLabel)},render(){return this.container.setContent(this.entry),this},destroy(){this.entry.destroy(),this.entry=null,this.autocomplete&&this.autocomplete.destroy(),this.offersList=null,this._parent(),this.container=null},_onSelect(){const e={[this.fieldName]:this.getValue()};this.getValue()!==o.get("sameOfferConditions")&&this.model.get(this.fieldName)!==this.getValue()&&this.validate()&&this.model.set(e,{silent:this.silent}),this.dispatchEvent(l.UPDATE,this.getValue())},_onUnSelect(){const e={[this.fieldName]:""};this.model.set(e,{silent:this.silent}),this.dispatchEvent(l.UPDATE,this.getValue())},_onClickOutside(){this.dispatchEvent(l.OUTSIDE_CLICK,this.model)},disable(){this.autocomplete.disable()},getValue(){return this.autocomplete.getValue()},setValue(e){this.autocomplete.onSelect(e)},getItemByLabel(e){return this.autocomplete.getItemByLabel(e)},_createDataSetConfig(){return{dataParser:(e,t)=>this._createItems(t)}},validate(){const e=new a;this._removeErrorMessage();const s=""===this.getValue();this.required&&s&&e.addError(this.fieldName,t.format(o.get("requiredField"),this.fieldLabel));const i=e.build();return i.isValid||this._displayErrorMessage(i),i},_displayErrorMessage(t){const s=t.errors[0];this.container.addClassName("mpf-invalid"),e.createElement("p",{class:"mpf-error",text:e.is(s.message)?s.message:""}).inject(this.container)},_removeErrorMessage(){this.container.removeClassName("mpf-invalid");const t=this.container.getElement("p");e.is(t)&&this.container.removeChild(t)},_createItems(e){const t=e.map((e=>({value:e.getName(),label:e.getName(),subLabel:e.getTitle()})));return this.fieldName===n.Fields.RENEW_WITH&&t.unshift({value:"Same offer conditions",label:o.get("sameOfferConditions")}),t},_createAutocomplete(){const e=new i({showSuggestsOnFocus:!0,disabled:this.readOnly,datasets:[{configuration:this._createDataSetConfig(),items:this._createItems(this.offersList)}],events:{onSelect:this._onSelect.bind(this),onUnselect:this._onUnSelect.bind(this),onClickOutside:this._onClickOutside.bind(this)}});if(this.model.get(this.fieldName)){const t=this.model.get(this.fieldName)||"",s=e.getItemByLabel(t);s&&e.onSelect(s)}else{const t=e.getItemByLabel(o.get("sameOfferConditions"));t&&e.onSelect(t)}return e},_onShowSuggests(){this.autocomplete.onShowSuggests()},_createEntry(t){const s=[];s.push(t),this.required&&""!==t&&s.push('&nbsp;<em class="mpf-required">*</em>');const i=[];return i.push(e.createElement("span",{class:"mpf-label",html:s})),i.push(this.autocomplete),e.createElement("label",{html:i})}});return c.Events=l,c})),define("DS/MPFMarketplaceAdmin/couponManagement/AutocompleteInput",["UWA/Class/View","UWA/Core","UWA/String","DS/UIKIT/Autocomplete","DS/MPFView/ValidationResultBuilder","i18n!DS/MPFMarketplaceAdmin/assets/nls/CouponManagement"],(function(e,t,s,i,r,a){"use strict";const n=Object.freeze({UPDATE:"update"}),o=Object.freeze({PARTNER:"Partner",COMPANY:"Company",MAKER:"Makers",STUDENT:"Student"}),l=e.extend({className:"mpf-entry-autocomplete-input",setup(e={}){this.fieldName=e.fieldName,this.fieldLabel=e.fieldLabel,this.readOnly=!0===e.readOnly,this.required=!0===e.required,this.offersList=e.offersList,this.saveOnChange=!0===e.saveOnChange,this.autocomplete=this._createAutocomplete(),this.entry=this._createEntry(this.fieldLabel)},render(){return this.container.setContent(this.entry),this},destroy(){this.entry.destroy(),this.autocomplete=null,this.offersList=null,this._parent(),this.container=null},_onSelect(){const e={[this.fieldName]:this.getValue()};this.model.get(this.fieldName)!==this.getValue()&&this.validate()&&this.model.set(e,{silent:this.silent}),this.dispatchEvent(n.UPDATE,this.getValue())},_onUnSelect(){const e={[this.fieldName]:""};this.model.set(e,{silent:this.silent}),this.dispatchEvent(n.UPDATE,this.getValue())},getValue(){return this.autocomplete.getValue()},setValue(e){this.autocomplete.onSelect(e)},getItemByLabel(e){return this.autocomplete.getItemByLabel(e)},_createDataSetConfig(){return{dataParser:(e,t)=>this._createItems(t)}},validate(){const e=new r;this._removeErrorMessage();const t=""===this.getValue();this.required&&t&&e.addError(this.fieldName,s.format(a.get("requiredField"),this.fieldLabel));const i=e.build();return i.isValid||this._displayErrorMessage(i),i},_displayErrorMessage(e){const s=e.errors[0];this.container.addClassName("mpf-invalid"),t.createElement("p",{class:"mpf-error",text:t.is(s.message)?s.message:""}).inject(this.container)},_removeErrorMessage(){this.container.removeClassName("mpf-invalid");const e=this.container.getElement("p");t.is(e)&&this.container.removeChild(e)},_createItems:e=>e.map((e=>({value:e.getName(),label:e.getName()}))),_createItemsByCustomerProfile(e){let t=[];return Object.values(o).forEach((s=>{let i=[];e.forEach((e=>{if(e.customerProfile===s){let t={value:e.name};i.push(t)}}));const r={label:a.get(s),items:i};t.push(r)})),t},_createAutocomplete(){return new i({showSuggestsOnFocus:!0,disabled:this.readOnly,datasets:[{configuration:this._createDataSetConfig(),items:this._createItemsByCustomerProfile(this.offersList)}]})},_onShowSuggests(){this.autocomplete.onShowSuggests()},_createEntry(e){const s=[];s.push(e),this.required&&""!==e&&s.push('&nbsp;<em class="mpf-required">*</em>');const i=[];return i.push(t.createElement("span",{class:"mpf-label",html:s})),i.push(this.autocomplete),t.createElement("label",{html:i})}});return l.Events=n,l.CustomerProfileEnum=o,l})),define("DS/MPFMarketplaceAdmin/platformCreation/AddRolesModal",["UWA/Class/View","UWA/Core","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/MPFBusinessExperienceDevPlatform/BusinessExperienceDevPlatformModel","DS/MPFBusinessExperienceDevPlatform/BusinessExperienceDevPlatformFactory","DS/MPFMarketplaceAdmin/platformCreation/AddRoleLine","i18n!DS/MPFMarketplaceAdmin/assets/nls/PlatformCreation","css!DS/MPFMarketplaceAdmin/MPFMarketplaceAdmin.css"],((e,t,s,i,r,a,n,o,l,c)=>{"use strict";const h=Object.freeze({ON_SAVED:"onSaved",LINES_UPDATED:"linesUpdated"}),d=e.extend({className:"mpf-add-roles-modal",setup({beDevPlatformFactory:e}={}){this.beDevPlatformFactory=e,this.addedRolesLines=[],this.alert=this._createAlert(),this.saveButton=this._createSaveButton(),this.modal=this._createModal(),this.addedRolesContainer=this._createAddedRolesContainer()},render(){return this.container.setContent(this.modal),this},show({tenantProductList:e,order:t}){this.tenantProductList=e,this.order=t,this.modal.setHeader(this._createModalHeader()),this.modal.setBody(this._createModalBody()),this.modal.show()},hide(){this.modal.hide()},destroy(){this.stopListening(),this.modal.destroy(),this.addedRolesLines.forEach((e=>e.destroy())),this.addedRolesLines=null,this.tenantProductList=null,this.order=null,this.beDevPlatformFactory=null,this._parent(),this.container=null},_createModalHeader(){return t.createElement("h4",{class:"mpf-header",text:c.get("onlineInstanceId")+" "+this.tenantProductList.getTenant()})},_createModal(){return new s({className:"mpf-add-roles-modal",visible:!1,closable:!0,footer:[this.saveButton]})},_createAlert:()=>new r({visible:!1,autoHide:!0,hideDelay:5e3}),_createModalBody(){const e=t.createElement("div",{class:"mpf-roles",text:c.get("roles")});this.addedRolesLines=[],this.addedRolesContainer.setContent(this.addedRolesLines),this._addRoleLine();const s=new a({className:"mpf-add-role default",value:c.get("addRole"),events:{onClick:this._addRoleLine.bind(this)}});return[this.alert,e,this.addedRolesContainer,s]},_addRoleLine(){let e=this._getSelectableProducts();if(e.length>0){const t=new l({product:e[0]});this.listenTo(t,l.Events.REMOVE,(e=>{const[t]=this.addedRolesLines.splice(this.addedRolesLines.findIndex((t=>t.getSelectedProduct()===e)),1);t.destroy(),this.onProductChangedOrRemoved()})),this.listenTo(t,l.Events.PRODUCT_CHANGE,(()=>this.onProductChangedOrRemoved())),this.addedRolesLines.push(t),e=this._getSelectableProducts(),this.addedRolesContainer.setContent(this.addedRolesLines.map((t=>t.render({products:e}))))}},_getSelectableProducts(){const e=[...this.tenantProductList.getProducts()];return this.addedRolesLines.forEach((t=>{const s=t.getSelectedProduct();e.splice(e.indexOf(s),1)})),e},onProductChangedOrRemoved(){const e=this._getSelectableProducts();this.addedRolesLines.forEach((t=>t.render({products:e}))),this.dispatchEvent(h.LINES_UPDATED)},_createAddedRolesContainer(){return t.createElement("div",{class:"mpf-added-roles",html:this.addedRolesLines})},_createSaveButton(){return new a({className:"mpf-confirm primary",value:c.get("confirm"),events:{onClick:this._save.bind(this)}})},async _save(){const e={};this.addedRolesLines.forEach((t=>{e[t.getSelectedProduct()]=t.getSelectedQuantity()}));const t=this.beDevPlatformFactory.createModel(o.Types.BUSINESS_EXP_DEV_PLATFORM,{[n.Fields.PLATFORM_ID]:this.tenantProductList.getTenant()});i.mask(this.modal.getBody()),this.saveButton.load(!0);try{await t.savePromise({[n.Fields.ADDED_PRODUCTS]:[e]},{patch:!0}),this.hide(),this.dispatchEvent(h.ON_SAVED)}catch(e){console.error(e),this.alert.add({className:"error",message:c.get("unableToAddRolesToPlatform")}).show()}i.unmask(this.modal.getBody()),this.saveButton.load(!1)}});return d.Events=h,d})),define("DS/MPFMarketplaceAdmin/orderCancellation/CompactCardHeader",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFMarketplaceAdmin/orderCancellation/CartStateTile","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation"],(function(e,t,s,i,r,a){"use strict";const n=Object.freeze({ON_CLICK:"onClick",DOWNLOAD_FILE:"downloadFile"}),o=t.extend({className:"mpf-compact-card-header",domEvents:{click:"_onClick"},setup({cart:e,locale:t}={}){this.cart=e,this.locale=t,this.cartStateTile=this._createCartStateTile()},render(){return this.container.setContent([{tag:"div",class:"mpf-order-name",text:this.cart.getName()},{tag:"div",class:"mpf-header-line",html:[{tag:"span",class:"mpf-label",text:a.get("owner")},{tag:"span",class:"mpf-value",text:this.cart.get("Owner")}]},this.cartStateTile.render()]),this},destroy(){this.stopListening(),this.cartStateTile.destroy(),this.cart=null,this._parent(),this.container=null},_onClick(){this.dispatchEvent(n.ON_CLICK)},_createCartStateTile(){const e=new r({cart:this.cart});return this.listenTo(e,r.Events.DOWNLOAD_FILE,this.dispatchEvent.bind(this,n.DOWNLOAD_FILE)),e}});return o.Events=n,o})),define("DS/MPFMarketplaceAdmin/offerManagement/OfferCreationFormLeftComponent",["UWA/Core","UWA/String","UWA/Class/View","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldSelectInputV2","DS/UIKIT/Input/Toggle","DS/MPFOfferModel/OfferCreationModel","DS/MPFView/FieldDateInput","DS/MPFMarketplaceAdmin/offerManagement/AutocompleteInput","DS/UIKIT/Tooltip","DS/UIKIT/Input/Button","DS/MPFView/ValidationResultBuilder","DS/MPFServices/ObjectService","DS/MPFUrl/UrlUtils","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],(function(e,t,s,i,r,a,n,o,l,c,h,d,u,p,m){"use strict";const f=Object.freeze({SUBSCRIPTION_PLAN_CHANGED:"SubscriptionPlanChanged"}),g=Object.freeze({TOGGLE_CHANGED:"ToggleChanged"}),C=Object.freeze({SAME_OFFER_CONDITIONS:"sameOfferConditions"}),E=s.extend({className:"mpf-offer-creation-form-left-component",setup(e){this.offerCreationModel=e.offerCreationModel,this.activeOffers=e.activeOffers,this.disableField=this.offerCreationModel.getState()===n.States.ACTIVE||this.offerCreationModel.getState()===n.States.INACTIVE||this.offerCreationModel.getState()===n.States.APPROVED,this.customerProfile=this._createCustomerProfileEntry(),this.subscriptionPlan=this._createSubscriptionPlanEntry(),this.renewal=this._createRenewalEntry(),this.renewWith=this._createRenewWithEntry(this.offerCreationModel.isRenewal()),this.url=this._createUrlEntry(),this.startDate=this._createStartDateEntry(),this.endDate=this._createEndDateEntry(),this._setEntryRequired(this.subscriptionPlan)},render(){return this.container.setContent([this.customerProfile,this.subscriptionPlan,this.renewal,this.renewWith,this.url,this.startDate,this.endDate]),this},destroy(){this.stopListening(),this.offerCreationModel=null,this.activeOffers=null,this.customerProfile&&this.customerProfile.destroy(),this.subscriptionPlan=null,this.renewal=null,this.renewWith&&this.renewWith.destroy(),this.renewWithInput&&this.renewWithInput.destroy(),this.url&&this.url.destroy(),this.startDate&&this.startDate.destroy(),this.startDateInput&&this.startDateInput.destroy(),this.endDate&&this.endDate.destroy(),this.endDateInput&&this.endDateInput.destroy(),this.urlInput&&this.urlInput.destroy(),this._parent(),this.container=null},_createEntry:(t,s)=>e.createElement("div",{class:s,html:[t.render()]}),_createToggleEntry:(t,s,i)=>e.createElement("div",{class:"mpf-offer-toggle "+i,html:[e.createElement("div",{class:"mpf-label",text:t}),s]}),_createSelectField(e,t,s,i,a,n){const o=new r({model:this.offerCreationModel,fieldName:e,fieldLabel:t,placeholder:s,readOnly:i,selectableOptions:a,dynamicValidation:!0,silent:!1,required:n,multipleOptionsSelectable:!1});return this.offerCreationModel.get(e)&&o.setValue(this.offerCreationModel.get(e)),o},_createTextField(e,t,s,r){return new i({model:this.offerCreationModel,fieldName:e,fieldLabel:t,placeholder:s,dynamicValidation:!0,silent:!1,required:r})},_createToggleField(e,t,s){const i=new a({className:"mpf-toggle primary",name:e,label:t,disabled:s,type:"checkbox"});return e===n.Fields.RENEWAL?i.setCheck(this.offerCreationModel.get(e)):this.offerCreationModel.get("prices")[e].check&&i.setCheck(this.offerCreationModel.get("prices")[e].check),i},_createAutocompleteInput(e,t,s,i){return new l({fieldName:e,fieldLabel:t,model:this.offerCreationModel,required:i,offersList:s})},async _subscriptionPlanToggleChanged(e,t){this._removeErrorMessage(this.subscriptionPlan),this._renewWithInputRender(),this.dispatchEvent(g.TOGGLE_CHANGED),this.offerCreationModel.setPricesByLicensingScheme(t,{check:e.isChecked()}),this.dispatchEvent(f.SUBSCRIPTION_PLAN_CHANGED)},_createFilteredActiveOffers(){let e=[];const t=this._getCheckedSubscriptionPlan();if(0!==t.length&&this.customerProfileInput.getValue()){const s=this._activeOffersFilteredByCustomerProfile(),i=this._activeOffersFilteredByPeriodicites(t);e=s.filter((e=>i.includes(e)))}else e=0!==t.length?this._activeOffersFilteredByPeriodicites(t):this.customerProfileInput.getValue()?this._activeOffersFilteredByCustomerProfile():this.activeOffers;return e},_activeOffersFilteredByPeriodicites(e){const t=[];return this.activeOffers.forEach((s=>{const i=s.getCheckedSubscriptionPlan();e.some((e=>i.includes(e)))&&t.push(s)})),t},_activeOffersFilteredByCustomerProfile(){return this.activeOffers.filter((e=>this.customerProfileInput.getValue()===e.getCustomerProfile()))},_getCheckedSubscriptionPlan(){const e=[];return this.checkboxes.forEach((t=>{t.isChecked()&&e.push(t.getName())})),e},_createDatePicker(e,t,s,i){return new o({model:this.offerCreationModel,fieldName:e,fieldLabel:t,placeholder:s,required:i})},_createCustomerProfileEntry(){return this.customerProfileInput=this._createSelectField(n.Fields.CUSTOMER_PROFILE,m.get("customerProfile"),m.get("selectProfile"),this.disableField,[{value:n.CustomerProfileEnum.PARTNER,label:m.get("partner")},{value:n.CustomerProfileEnum.COMPANY,label:m.get("company")},{value:n.CustomerProfileEnum.MAKER,label:m.get("makers")},{value:n.CustomerProfileEnum.STUDENT,label:m.get("student")}],!0),this.customerProfileInput.addEvent(r.Events.UPDATE,this._renewWithInputRender.bind(this)),this._createEntry(this.customerProfileInput,"mpf-offer-select-field mpf-customer-profile")},_createSubscriptionPlanEntry(){const e=this._createToggleField(m.get("yearly"),m.get("yearly"),this.disableField),t=this._createToggleField(m.get("quarterly"),m.get("quarterly"),this.disableField),s=this._createToggleField(m.get("monthly"),m.get("monthly"),this.disableField);return this.checkboxes=[e,t,s],e.addEvent("onChange",this._subscriptionPlanToggleChanged.bind(this,e,m.get("yearly"))),t.addEvent("onChange",this._subscriptionPlanToggleChanged.bind(this,t,m.get("quarterly"))),s.addEvent("onChange",this._subscriptionPlanToggleChanged.bind(this,s,m.get("monthly"))),this._createToggleEntry(m.get("subscriptionPlan"),this.checkboxes,"mpf-subscription-plan",!0)},_renewToggleChanged(e){this.offerCreationModel.setRenewal(e.isChecked()),this._renewWithInputRender()},_createRenewalEntry(){return this.renewalCheckbox=this._createToggleField(n.Fields.RENEWAL," ",this.disableField),this.renewalCheckbox.addEvent("onChange",this._renewToggleChanged.bind(this,this.renewalCheckbox)),this._createToggleEntry(m.get("renewal"),[this.renewalCheckbox],"mpf-renewal-entry")},_createRenewWithEntry(e){return this.renewWithInput=this._createAutocompleteInput(n.Fields.RENEW_WITH,m.get("renewWith"),this._createFilteredActiveOffers(),e),this.disableField||this.renewalCheckbox.isChecked()||(this.renewWithInput.disable(),this.renewWithInput.setValue(this.renewWithInput.getItemByLabel(m.get("sameOfferConditions"))),this.offerCreationModel.setRenewWith("")),this.disableField&&this.renewWithInput.disable(),this.listenTo(this.renewWithInput,l.Events.OUTSIDE_CLICK,(e=>{""!==e.getRenewWith()||this.renewWithInput.getValue()||this.renewWithInput.setValue(this.renewWithInput.getItemByLabel(m.get("sameOfferConditions")))})),this._createEntry(this.renewWithInput,"mpf-offer-autocomplete-field mpf-renew-with")},_createUrlTextField(){return this.urlInput=new i({model:this.offerCreationModel,fieldName:n.Fields.NAME,fieldLabel:m.get("url"),placeholder:m.get("enterUrl"),readOnly:this.disableField,dynamicValidation:!0,silent:!1,required:!0}),this.urlInput.addEvent(i.Events.UPDATE,this._setCorrectUrl.bind(this,this.urlInput)),this.urlInput},_setCorrectUrl(e){if(e.getValue().includes(" ")){const t=e.getValue().replace(" ","_");e.setValue(t)}this.validateUrl()},validateUrl(){this._removeErrorMessage(this.url);const e=new d;this.urlInput.getValue().includes("-")&&e.addError(m.get("url"),t.format(m.get("invalidCharacter"),m.get("url")));const s=e.build();return s.isValid||this._displayErrorMessage(s,this.url),s.isValid},_createUrlEntry(){this.urlInput=this._createUrlTextField();const t=new h({className:"default mpf-url-button",icon:"fonticon fonticon-topbar-info ",disabled:!0}),s=this.offerCreationModel.getState();s!==n.States.APPROVED&&s!==n.States.INACTIVE&&s!==n.States.ACTIVE||t.enable();const i=this._createBaseUrl(this.offerCreationModel.getName()),r=[];for(const[e,t]of Object.entries(this.offerCreationModel.getPrices()))if(!0===t.check){const t=i+"?licencingScheme="+e;r.push(this._createTooltipMessageLine(m.get("cartUrl",{licensingScheme:e,offerUrl:t})))}new c({body:[this._createTooltipMessageLine(m.get("offerUrl",{offerUrl:i})),r],target:t.getContent(),trigger:"click",position:"bottom"});const a=e.createElement("div",{class:"mpf-url-tooltip-button",html:t});return this.urlInput.addContentInEntry(a),this._createEntry(this.urlInput,"mpf-offer-text mpf-url")},_createTooltipMessageLine:t=>e.createElement("div",{text:t}),_createUrlTooltipButtonEntry:(t,s)=>e.createElement("div",{class:s,html:t.render()}),_createBaseUrl(e){const t=window.location.host.toString();let s="";s=p.isProduction()?"my.3dexperience.3ds.com":t.includes("r1132100503382")?window.location.host.toString().replace("mpdatamgt","my3dexperience"):window.location.host.toString().replace("mpdatamgt","3dprint");return window.location.protocol+"//"+s+"/cnb/offers/"+e},_createStartDateEntry(){return this.startDateInput=this._createDatePicker(n.Fields.START_DATE,m.get("startDate"),m.get("enterDate"),!0),this.listenTo(this.startDateInput,o.Events.UPDATE,this._updateMinMaxDate.bind(this,"startDateUpdated")),this._createEntry(this.startDateInput,"mpf-offer-date mpf-start-date")},_createEndDateEntry(){return this.endDateInput=this._createDatePicker(n.Fields.END_DATE,m.get("endDate"),m.get("enterDate"),!0),this.listenTo(this.endDateInput,o.Events.UPDATE,this._updateMinMaxDate.bind(this,"endDateUpdated")),this._createEntry(this.endDateInput,"mpf-offer-date mpf-end-date")},_updateMinMaxDate(e){switch(e){case"startDateUpdated":this.endDateInput.setMinDate(new Date(this.offerCreationModel.getStartDate()));break;case"endDateUpdated":this.startDateInput.setMaxDate(new Date(this.offerCreationModel.getEndDate()))}},validateSubscriptionPlan(){const e=new d;this._removeErrorMessage(this.subscriptionPlan);this.checkboxes.find((e=>e.isChecked()))||e.addError(m.get("subscriptionPlan"),t.format(m.get("requiredField"),m.get("subscriptionPlan")));const s=e.build();return s.isValid||this._displayErrorMessage(s,this.subscriptionPlan),s.isValid},_displayErrorMessage(t,s){const i=t.errors[0];s.addClassName("mpf-invalid"),e.createElement("p",{class:"mpf-error",text:e.is(i.message)?i.message:""}).inject(s)},_removeErrorMessage(t){if(t.hasClassName("mpf-invalid")){t.removeClassName("mpf-invalid");const s=t.getElement("p");e.is(s)&&t.removeChild(s)}},_setEntryRequired(t){const s=e.createElement("em",{class:"mpf-required",text:"*"});t.getElement(".mpf-label").addContent("&nbsp;"),t.getElement(".mpf-label").addContent(s)},checkAllRequiredFields(){const e=[this.customerProfileInput,this.urlInput,this.startDateInput,this.endDateInput];this.renewalCheckbox.isChecked()&&e.push(this.renewWithInput);let t=!0;return e.forEach((e=>{!e.validate().isValid&&t&&(t=!1)})),!this.validateSubscriptionPlan()&&t&&(t=!1),!this.validateUrl()&&t&&(t=!1),t},_renewWithInputRender(){this.renewWithInput&&(this.renewWithInput&&this.renewWithInput.destroy(),this.renewWith.destroy(),this.renewWith=null,this.renewWith=this._createRenewWithEntry(this.renewalCheckbox.isChecked()),this.render())}});return E.SubscriptionPlanEvent=f,E.RenewWithEnum=C,E.Events=g,E})),define("DS/MPFMarketplaceAdmin/orderCancellation/CardHeader",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFCountryModel/CountryCollection","DS/MPFMarketplaceAdmin/orderCancellation/CartStateTile","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation"],(function(e,t,s,i,r,a,n){"use strict";const o=Object.freeze({SHOW_COMMENTS:"showComments",SHOW_ATTACHEMENTS:"showAttachements",DOWNLOAD_FILE:"downloadFile"}),l=new Map;l.set(s.PaymentMethods.BANK_CARD,"creditCard"),l.set(s.PaymentMethods.DEFERRED_BANK_TRANSFER,"bankTransfer");const c=e.extend({className:"mpf-card-header",setup(e={}){t.requiredOfPrototype(e.cart,s,"options.cart must be a CartModel"),t.requiredOfPrototype(e.countries,r,"options.countries must be a CountryCollection"),this.cart=e.cart,this.countries=e.countries,this.cartStateTile=this._createCartStateTile()},render(){const e=this.cart.getOwnerData(),t=this.cart.getItems()[0],i=this.cart.get(s.Fields.COUNTRY),r=[this._createNameTile()];return r.push(this._createTile([e&&this._createLine(n.get("customerName"),this._createFullName(e.FirstName,e.LastName)),this._createLine(n.get("siteId"),this.cart.getSiteId()),i&&this._createLine(n.get("country"),this.countries.getCountryWithIso2(i).getName())])),r.push(this._createTile([e&&this._createLine(n.get("buyerName"),this._createFullName(e.FirstName,e.LastName)),e&&this._createLine(n.get("buyerEmail"),e.email),(this.cart.isOrder()||this.cart.isRenewal())&&this._createLine(n.get("paymentMethod"),n.get(l.get(this.cart.getPaymentMethod())))])),r.push(this._createDateTile(t)),r.push(this.cartStateTile.render()),this.container.setContent(r),this},_createFullName(e,t){let s="";return e&&(s+=e),e&&t&&(s+=" "),t&&(s+=t),s},_createLine(e,t){if(t)return{tag:"div",class:"mpf-header-line",html:[{tag:"span",class:"mpf-label",text:e},{tag:"span",class:"mpf-value",text:t}]}},_createTile(e){if(e.find((e=>!!e)))return{tag:"div",class:"mpf-header-tile",html:e}},_createNameTile(){const e=[{tag:"div",class:"mpf-order-name",text:this.cart.getName()}];return this._createTile(e)},_createDateTile(e){const t=this.cart.get(s.Fields.CONFIRMATION_DATE);return this.cart.isOrder()||this.cart.isRenewal()?this._createTile([this._createLine(n.get("startDate"),e.get(i.Fields.START_DATE)),this._createLine(n.get("endDate"),e.get(i.Fields.END_DATE)),t&&this._createLine(n.get("confirmationDate"),t)]):this.cart.isCancellation()?this._createTile([this._createLine(n.get("effectiveDate"),this.cart.get(s.Fields.REQUEST_DATE)),this._createLine(n.get("approvedDate"),this.cart.get(s.Fields.APPROVAL_DATE)),t&&this._createLine(n.get("confirmationDate"),t),this._createLine(n.get("reason"),this.cart.get(s.Fields.REASON))]):void 0},_createCartStateTile(){const e=new a({cart:this.cart});return this.listenTo(e,a.Events.DOWNLOAD_FILE,this.dispatchEvent.bind(this,o.DOWNLOAD_FILE)),e},destroy(){this.cart=null,this._parent(),this.container=null}});return c.Events=o,c})),define("DS/MPFMarketplaceAdmin/offerManagement/CardHeader",["UWA/Class/View","DS/MPFMarketplaceAdmin/StateProgressTile","DS/MPFServices/ObjectService","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],(function(e,t,s,i){"use strict";const r=Object.freeze({EDIT_OFFER:"editOffer"}),a=e.extend({className:"mpf-offer-card-header",domEvents:{click:"cardClicked"},setup(e={}){this.offer=e.offer,this.offerStateTile=this._createOfferStateTile()},render(){const e=this.offer.getTitle(),t=this.offer.getName(),s=this.offer.getCustomerProfile(),r=this.offer.getCheckedSubscriptionPlan(),a=this.offer.isRenewal(),n=this.offer.getStartDate(),o=this.offer.getEndDate(),l=this.offer.getDiscountType(),c=[];return c.push(this._createTile("mpf-card-name",[this._createLine(i.get("name"),e),this._createLine(i.get("url"),t),this._createLine(i.get("profile"),s)])),c.push(this._createTile("mpf-card-subscription-plan",[this._createLine(i.get("plan"),r),this._createLine(i.get("renewal"),a.toString())])),c.push(this._createTile("mpf-card-date",[this._createLine(i.get("startDate"),n),this._createLine(i.get("endDate"),o),this._createLine(i.get("type"),i.get(l))])),c.push(this.offerStateTile.render()),this.container.setContent(c),this},destroy(){this._parent(),this.offerStateTile&&this.offerStateTile.destroy(),this.container=null},_createTile(e,t){if(t.find((e=>!!e)))return{tag:"div",class:"mpf-header-tile "+e,html:t}},_createLine:(e,t)=>(t||(t=""),{tag:"div",class:"mpf-header-line",html:[{tag:"span",class:"mpf-label",text:e},{tag:"span",class:"mpf-value",text:t}]}),_createOfferStateTile(){return new t({model:this.offer,state:this.offer.getState()})},cardClicked(){this.dispatchEvent(r.EDIT_OFFER,this.offer)}});return a.Events=r,a})),define("DS/MPFMarketplaceAdmin/offerManagement/SubscriptionPlanTable",["UWA/Class/View","UWA/Core","DS/MPFServices/ObjectService","DS/UIKIT/Input/Number","DS/UIKIT/Input/Toggle","DS/MPFMarketplaceAdmin/offerManagement/SubscriptionPlanProductLine","DS/MPFOfferModel/OfferCreationModel","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],(function(e,t,s,i,r,a,n,o){"use strict";const l=Object.freeze({REMOVE_PRODUCT:"RemoveProduct",COMPUTE_PERCENTAGE:"ComputePercentage",COMPUTE_NET_PRICE:"ComputeNetPrice",ADJUST_CHANGED:"AdjustChanged"}),c=e.extend({className:"mpf-subscription-plan-table",setup(e={}){this.offerCreationModel=e.offerCreationModel,this.portfolioPackCollection=e.portfolioPackCollection,this.licensingScheme=e.licensingScheme,this.priceList=e.priceList,this.country=e.country,this.mainComponent=e.mainComponent,this.disableField=this.offerCreationModel.getState()===n.States.ACTIVE||this.offerCreationModel.getState()===n.States.INACTIVE||this.offerCreationModel.getState()===n.States.APPROVED,this.table=this._createTable(),this.percentage=0,this.products={}},render(){return this.container.setContent([this.table]),this},destroy(){this.stopListening(),this.table=null,this.percentage=null,this._destroyProducts(),this.products=null,this.pricelistCheck=null,this.listPriceValue=null,this.offerPercentagePrice=null,this.keyValue=null,this.percentageInput=null,this.netPriceInput=null,this.priceList=null,this.country=null,this._parent(),this.container=null},_destroyProducts(){Object.values(this.products).forEach((e=>{e&&e.destroy()}))},displayNonMainTable(){this.percentageInput.disable(),this.products&&Object.values(this.products).forEach((e=>{e.disableElements()}))},_createTable(){return t.createElement("table",{class:"table table-condensed",html:[this._createTableHeader(),this._createTableFirstLine()]})},addProduct(e){const t=new a({offerCreationModel:this.offerCreationModel,portfolioPackCollection:this.portfolioPackCollection,name:e.name,trigram:e.trigram,listPrice:e.listPrice,mainComponent:this.mainComponent});this.listenTo(t,a.Events.REMOVE_PRODUCT,(e=>{this.dispatchEvent(l.REMOVE_PRODUCT,e)})),this.listenTo(t,a.Events.COMPUTE_NET_PRICE,(()=>{this.setAdjustKey(),this.dispatchEvent(l.COMPUTE_NET_PRICE,{licensingScheme:this.licensingScheme,keys:this._getAllKeys()})})),this.listenTo(t,a.Events.ADJUST_CHANGED,(e=>{const t=this._findAdjustProduct(e);t?(t.key.setValue(a.KeyValues.MIN_KEY_VALUE),t.adjust.uncheck(),this.offerCreationModel.removeAdjustedProduct(a.KeyValues.MIN_KEY_VALUE,this.licensingScheme),this.offerCreationModel.setAdjustedProduct(e,a.KeyValues.MAX_KEY_VALUE,this.licensingScheme),0!==Number(this.netPriceInput.getValue())?(this.updateAdjustKey(e),this.setAdjustKey()):this._updateAdjust(e),this.dispatchEvent(l.ADJUST_CHANGED,{licensingScheme:this.licensingScheme,trigram:e})):this.products[e].adjust.check()})),this.products[e.trigram]=t,this.table.addContent(t.render()),Object.keys(this.products).length&&t.listPrice&&this.setAdjust(t),this._setKey(t),this._updateKeys(),0!==Number(this.netPriceInput.getValue())&&this.setAdjustKey()},_getAllKeys(){const e={};for(const[t,s]of Object.entries(this.products))e[t]=s.key.getValue();return e},setAllKeysValue(e){for(const[t,s]of Object.entries(this.products)){const i=e[t];s.key.setValue(i),0!==this.netPriceInput.getValue()&&s.setNetPrice(this._computeProductNetPriceOffer(i))}},_setKey(e){this.mainComponent&&(!e.listPrice||e.adjust.isChecked()?e.key.disable():e.key.enable())},_updateKeys(){Object.values(this.products).forEach((e=>{0!==Number(this.netPriceInput.getValue())&&e.listPrice&&(e.adjust.isChecked()?this.updateAdjustKey(e.trigram):e.key.enable())}))},setAdjust(e){const t=Object.values(this.products).find((e=>e.adjust.isChecked()));t&&e.listPrice&&(t.adjust.uncheck(),t.key.setValue(a.KeyValues.MIN_KEY_VALUE)),e.adjust.check(),e.key.setValue(a.KeyValues.MAX_KEY_VALUE)},updateAdjustKey(e){Object.values(this.products).forEach((t=>{t.listPrice&&(t.trigram!==e?(t.adjust.uncheck(),t.key.setValue(a.KeyValues.MIN_KEY_VALUE),this.mainComponent&&t.key.enable()):(t.adjust.check(),t.key.setValue(a.KeyValues.MAX_KEY_VALUE),t.key.disable()))}))},_updateAdjust(e){Object.values(this.products).forEach((t=>{t.trigram!==e?(t.adjust.uncheck(),t.key.setValue(a.KeyValues.MIN_KEY_VALUE)):(t.adjust.check(),t.key.setValue(a.KeyValues.MAX_KEY_VALUE))}))},_setKeysValue(e,t){e.trigram!==t?e.key.setValue(a.KeyValues.MIN_KEY_VALUE):(e.adjust.check(),e.key.setValue(a.KeyValues.MAX_KEY_VALUE))},removeProduct(e){e.removeButtonClicked()},_createTableHeader:()=>t.createElement("thead",{class:"mpf-subscription-plan-table-header",html:t.createElement("tr",{html:[{tag:"th",text:o.get("name"),class:"mpf-subscription-plan-table-header-name"},{tag:"th",text:o.get("trigram"),class:"mpf-subscription-plan-table-header-trigram"},{tag:"th",text:o.get("listPrice"),class:"mpf-subscription-plan-table-header-list-price"},{tag:"th",text:o.get("percentage"),class:"mpf-subscription-plan-table-header-percentage"},{tag:"th",text:o.get("offerPrice"),class:"mpf-subscription-plan-table-header-offer-price"},{tag:"th",text:o.get("adjust"),class:"mpf-subscription-plan-table-header-adjust"},{tag:"th",text:o.get("key"),class:"mpf-subscription-plan-table-header-key"},{tag:"th",text:o.get("offerPrice"),class:"mpf-subscription-plan-table-header-offer-price"},{tag:"th",text:"",class:"mpf-subscription-plan-table-header-remove"}]})}),_createTableColumn:(e,s)=>t.createElement("td",{class:"mpf-subscription-plan-table-first-line-"+e,html:[s]}),_createPercentageInput(){const e=new i({className:"mpf-net-price-input-text",min:a.KeyValues.MIN_KEY_VALUE,max:a.KeyValues.MAX_KEY_VALUE,step:.01,value:0});return e.addEvent("onChange",(()=>{this.updatePercentage(e)})),e},_createNetPriceInput(){const e=new i({className:"mpf-net-price-input-text",min:0,max:this.listPriceValue,value:0});return e.intMaxLength=8,e.addEvent("onChange",this.computeValidNetPrice.bind(this,e)),e},_createPriceListCheckToggle(){return this.pricelistToggle=new r({className:"mpf-toggle primary",type:"checkbox",label:"",disabled:this.disableField}),this.pricelistToggle.addEvent("onChange",this._priceListToggleChanged.bind(this,this.pricelistToggle)),t.createElement("td",{class:"mpf-subscription-plan-table-first-line-price-list-check",html:[this.pricelistToggle,o.get(this.priceList)]})},_priceListToggleChanged(e){e.isChecked()?(this.netPriceInput.enable(),this.offerCreationModel.addNetDiscount(this.licensingScheme,{[this.country]:Number(this.netPriceInput.getValue())})):(this.netPriceInput.setValue(0),this.netPriceInput.disable(),this.offerCreationModel.removeNetDiscount(this.licensingScheme,this.country))},computeValidNetPrice(e){const t=Number(this._unformatNumber(this.listPriceValue.getHTML())),s=Number(e.getValue());s>t||s<0?e.setValue(t):(this._enableKeys(),this.offerCreationModel.addNetDiscount(this.licensingScheme,{[this.country]:Number(s)}))},_enableKeys(){this.products&&Object.keys(this.products).length&&(Object.values(this.products).forEach((e=>{this._setKey(e)})),this.dispatchEvent(l.COMPUTE_NET_PRICE))},setAdjustKey(){if(Object.keys(this.products).length){Object.values(this.products).forEach((e=>{if(e.listPrice&&!e.adjust.isChecked()){const t=Number(e.key.getValue());Number(t)!==Number(e.key.getValue())&&e.key.setValue(t);const s=this._computeProductNetPriceOffer(t);e.setNetPrice(s),this._checkValidProductNetPriceOffer(e);let i=e.trigram;void 0===this.offerCreationModel.getPrices()[this.licensingScheme][i]&&(i=n.AdjustedProduct.ADJUSTED_INDICATOR+i),this.offerCreationModel.setPricesByLicensingScheme(this.licensingScheme,{[i]:Number(e.key.getValue())})}}));const e=this.offerCreationModel.getAdjustedProductsByPeriodicity()[this.licensingScheme],t=e.slice(1,e.length),s=this.products[t],i=Number(this._computeAdjustedProductKey());i!==Number(s.key.getValue())&&(s.key.setValue(i),this.offerCreationModel.setPricesByLicensingScheme(this.licensingScheme,{[e]:Number(s.key.getValue())}));const r=this._computeProductNetPriceOffer(i);s.setNetPrice(r),this._checkValidProductNetPriceOffer(s)}},_checkValidProductNetPriceOffer(e){e.getNetPrice()>e.listPrice?this._displayErrorText(e.netPriceOfferPrice):this._removeErrorText(e.netPriceOfferPrice)},_computeAdjustedProductKey(){const e=Number(this.netPriceInput.getValue());let t=0;if(0!==e){t=100*(e-Object.values(this.products).map((e=>e.adjust.isChecked()?0:Number(e.getNetPrice()))).reduce(((e,t)=>e+t),0))/e}else t=100;return t.toFixed(5)},_findAdjustProduct(e){const t=Object.values(this.products);for(let s=0;s<t.length;s++)if(t[s].adjust.isChecked()&&t[s].trigram!==e)return t[s]},_computeProductNetPriceOffer(e){const t=Number(this.netPriceInput.getValue());return Number(e)*t/100},_sumKeysWithoutAdjustKey(){return Object.values(this.products).map((e=>e.adjust.isChecked()?0:Number(e.key.getValue()))).reduce(((e,t)=>e+t),0)},_sumAllKeys(){return Object.values(this.products).map((e=>Number(e.key.getValue()))).reduce(((e,t)=>e+t),0)},_sumKeysExcept(e){return Object.values(this.products).map((t=>t.trigram!==e?Number(t.key.getValue()):0)).reduce(((e,t)=>e+t),0)},disableInput(e){e===this.percentageInput&&this.disableField?e.disable():e!==this.netPriceInput||this.mainComponent&&!this.disableField||e.disable()},_createTableFirstLine(){const e=this._formatNumber(0);return this.mainComponent?this.priceListCheck=this._createTableColumn("currency",o.get(this.priceList)):this.priceListCheck=this._createPriceListCheckToggle(),this.listPriceValue=this._createTableColumn("list-price-value",e),this.offerPercentagePrice=this._createTableColumn("offer-price-value",e),this.keyValue=this._createTableColumn("key-value",""),this.percentageInput=this._createPercentageInput(),this.netPriceInput=this._createNetPriceInput(),0===this.offerCreationModel.getPrices()[this.licensingScheme].netDiscount[this.priceList]&&this.offerCreationModel.addNetDiscount(this.licensingScheme,{[this.country]:Number(this.netPriceInput.getValue())}),this.netPriceInput.addEvent("change",this._setMaxNetPriceInput.bind(this)),t.createElement("tr",{class:"mpf-subscription-plan-table-first-line",html:[this.priceListCheck,this._createTableColumn("total",o.get("total")),this.listPriceValue,this._createTableColumn("percentage-input",this.percentageInput),this.offerPercentagePrice,this._createTableColumn("adjust",""),this.keyValue,this._createTableColumn("net-price-input",this.netPriceInput),this._createTableColumn("","")]})},_setMaxNetPriceInput(){this.netPriceInput&&(this.netPriceInput.destroy(),this.netPriceInput=this._createNetPriceInput())},computeListPrice(){let e=0;Object.values(this.products).forEach((t=>{e+=Number(t.getListPrice())})),this.listPriceValue.setText(this._formatNumber(e))},_formatNumber:e=>new Intl.NumberFormat("fr-FR",{maximumFractionDigits:2,minimumFractionDigits:2}).format(e),_unformatNumber:e=>e.toString().replace(/\s+/g,"").replace(",","."),computePercentageOfferPrice(){this.computeListPrice();const e=Number(this._unformatNumber(this.listPriceValue.getHTML()))*(1-this.percentage/100);this.offerPercentagePrice.setText(this._formatNumber(e)),Object.values(this.products).forEach((e=>{const t=e.getListPrice()*(1-this.percentage/100);e.setPercentage(t)}))},updatePercentage(e){this.percentage=Number(e.getValue()),this.computePercentageOfferPrice(),this.dispatchEvent(l.COMPUTE_PERCENTAGE,{percentage:this.percentage,licensingScheme:this.licensingScheme})},addClassName(e){this.container.addClassName(e)},_displayErrorText(e){e.addClassName("mpf-invalid")},_removeErrorText(e){e.removeClassName("mpf-invalid");const s=e.getElement("p");t.is(s)&&e.removeChild(s)},checkValidPricesOfProduct(){const e=Object.values(this.products);for(let t=0;t<e.length;t++){const s=e[t];if(s.listPrice<Number(s.getNetPrice()))return!1}return!0},hidePriceListCheck(e){this.mainComponent||(e?this.pricelistToggle.getContent().setStyle("visibility","hidden"):this.pricelistToggle.getContent().setStyle("visibility","visible"))}});return c.Events=l,c})),define("DS/MPFMarketplaceAdmin/offerManagement/OfferCreationFormRightComponent",["UWA/Class/View","UWA/Core","DS/MPFOfferModel/OfferCreationModel","DS/MPFView/FieldTextInputV2","DS/MPFMarketplaceAdmin/offerManagement/AutocompleteInput","DS/MPFServices/ObjectService","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],(function(e,t,s,i,r,a,n){"use strict";const o=Object.freeze({}),l=e.extend({className:"mpf-offer-creation-form-right-component",setup(e){this.offerCreationModel=e.offerCreationModel,this.copyTextOffers=e.copyTextOffers,this.disableField=this.offerCreationModel.getState()===s.States.ACTIVE||this.offerCreationModel.getState()===s.States.INACTIVE||this.offerCreationModel.getState()===s.States.APPROVED,this.offerName=this._createOfferNameEntry(),this.tcReference=this._createTCReferenceEntry(),this.copyOffer=this._createCopyOfferEntry(),this.eligibilityBlueBox=this._createEligibilityBlueBox(),this.eligibilityTooltip=this._createEligibilityTooltip(),this.description=this._createDescription(),this.offerDetails=this._createOfferDetails(),this.eligibilitySection=this._createEligibilitySection(),this.moreInfo=this._createMoreInfo(),this.copyOfferInput.getValue()&&this._setDisabledCopyTextOffersInputs(!0)},render(){return this.container.setContent([this.offerName,this.tcReference,this.copyOffer,this.eligibilityBlueBox,this.eligibilityTooltip,this.description,this.offerDetails,this.eligibilitySection,this.moreInfo]),this},destroy(){this.stopListening(),this.offerName&&this.offerName.destroy(),this.tcReference&&this.tcReference.destroy(),this.copyOffer&&this.copyOffer.destroy(),this.eligibilityBlueBox&&this.eligibilityBlueBox.destroy(),this.eligibilityTooltip&&this.eligibilityTooltip.destroy(),this.description&&this.description.destroy(),this.offerDetails&&this.offerDetails.destroy(),this.eligibilitySection&&this.eligibilitySection.destroy(),this.moreInfo&&this.moreInfo.destroy(),this.offerNameInput&&this.offerNameInput.destroy(),this.eligibilityBlueBoxInput&&this.eligibilityBlueBoxInput.destroy(),this.eligibilityTooltipInput&&this.eligibilityTooltipInput.destroy(),this.descriptionInput&&this.descriptionInput.destroy(),this.offerDetailsInput&&this.offerDetailsInput.destroy(),this.eligibilitySectionInput&&this.eligibilitySectionInput.destroy(),this.moreInfoInput&&this.moreInfoInput.destroy(),this._parent(),this.container=null},_createEntry:(e,s)=>t.createElement("div",{class:s,html:[e.render()]}),_createTextField(e,t,s,r,a,n,o){return new i({model:this.offerCreationModel,fieldName:e,fieldLabel:t,placeholder:s,dynamicValidation:!0,silent:!1,readOnly:r,required:a,multiline:n,multilineRows:o})},_createAutocompleteInput(e,t,s,i,a){return new r({fieldName:e,fieldLabel:t,model:this.offerCreationModel,readOnly:i,required:a,offersList:s})},_createOfferNameEntry(){return this.offerNameInput=this._createTextField(s.Fields.TITLE,n.get("offerName"),n.get("enterText"),this.disableField,!0,!1),this._createEntry(this.offerNameInput,"mpf-offer-text mpf-offer-name")},_createTCReferenceEntry(){const e=this._createTextField(s.Fields.EXTERNAL_OFFER_ID,n.get("tcReference"),n.get("enterText"),this.disableField,!1,!1);return this._createEntry(e,"mpf-offer-text mpf-tc-reference")},_createCopyOfferEntry(){return this.copyOfferInput=this._createAutocompleteInput(s.Fields.COPY_FROM,n.get("copyOfferTexts"),this.copyTextOffers,this.disableField),this.listenTo(this.copyOfferInput,r.Events.UPDATE,(e=>{if(this._clearCopyTextOffersInputs(),e){const t=this._getCopyTextOffer(e);this._setCopyTextOffersInputs(t)}})),this._createEntry(this.copyOfferInput,"mpf-offer-autocomplete-field mpf-copy-offer")},_getCopyTextOffer(e){const t=this.copyTextOffers.toArray();for(let s=0;s<t.length;s++){if(t[s].getName()===e)return t[s]}},_clearCopyTextOffersInputs(){this.eligibilityBlueBoxInput.resetValue({silent:!1}),this.eligibilityTooltipInput.resetValue({silent:!1}),this.descriptionInput.resetValue({silent:!1}),this.offerDetailsInput.resetValue({silent:!1}),this.eligibilitySectionInput.resetValue({silent:!1}),this.moreInfoInput.resetValue({silent:!1}),this._setDisabledCopyTextOffersInputs(!1),this._clearCopyOfferTextOffersInputsModelValues()},_clearCopyOfferTextOffersInputsModelValues(){this.offerCreationModel.setEligibilityBlueBox(""),this.offerCreationModel.setEligibilityTooltip(""),this.offerCreationModel.setDescription(""),this.offerCreationModel.setDetails(""),this.offerCreationModel.setEligibility(""),this.offerCreationModel.setMoreInfo("")},_setCopyTextOffersInputs(e){this.eligibilityBlueBoxInput.setValue(e.getEligibilityBlueBox()),this.eligibilityTooltipInput.setValue(e.getEligibilityTooltip()),this.descriptionInput.setValue(e.getDescription()),this.offerDetailsInput.setValue(e.getDetails()),this.eligibilitySectionInput.setValue(e.getEligibility()),this.moreInfoInput.setValue(e.getMoreInfo()),this._setDisabledCopyTextOffersInputs(!0)},_setDisabledCopyTextOffersInputs(e){this.eligibilityBlueBoxInput.setDisabled(e),this.eligibilityTooltipInput.setDisabled(e),this.descriptionInput.setDisabled(e),this.offerDetailsInput.setDisabled(e),this.eligibilitySectionInput.setDisabled(e),this.moreInfoInput.setDisabled(e)},_createEligibilityBlueBox(){return this.eligibilityBlueBoxInput=this._createTextField(s.Fields.ELIGIBILITY_BLUE_BOX,n.get("eligibilityBlueBox"),n.get("enterText"),this.disableField,!0,!1),this._createEntry(this.eligibilityBlueBoxInput,"mpf-offer-text mpf-eligibility-blue-box")},_createEligibilityTooltip(){return this.eligibilityTooltipInput=this._createTextField(s.Fields.ELIGIBILITY_TOOLTIP,n.get("eligibilityTooltip"),n.get("enterText"),this.disableField,!0,!0,2),this._createEntry(this.eligibilityTooltipInput,"mpf-offer-text mpf-eligibility-tooltip")},_createDescription(){return this.descriptionInput=this._createTextField(s.Fields.DESCRIPTION,n.get("description"),n.get("enterText"),this.disableField,!0,!1),this._createEntry(this.descriptionInput,"mpf-offer-text mpf-description")},_createOfferDetails(){return this.offerDetailsInput=this._createTextField(s.Fields.DETAILS,n.get("offerDetails"),n.get("enterText"),this.disableField,!0,!0,3),this._createEntry(this.offerDetailsInput,"mpf-offer-text mpf-details")},_createEligibilitySection(){return this.eligibilitySectionInput=this._createTextField(s.Fields.ELIGIBILITY,n.get("eligibilitySection"),n.get("enterText"),this.disableField,!0,!0,2),this._createEntry(this.eligibilitySectionInput,"mpf-offer-text mpf-eligibility-section")},_createMoreInfo(){return this.moreInfoInput=this._createTextField(s.Fields.MORE_INFO,n.get("moreInfo"),n.get("enterText"),this.disableField,!0,!1),this._createEntry(this.moreInfoInput,"mpf-offer-text mpf-more-info")},checkAllRequiredFields(){const e=[this.offerNameInput,this.eligibilityBlueBoxInput,this.eligibilityTooltipInput,this.descriptionInput,this.offerDetailsInput,this.eligibilitySectionInput,this.moreInfoInput];let t=!0;return e.forEach((e=>{!e.validate().isValid&&t&&(t=!1)})),t}});return l.Events=o,l})),define("DS/MPFMarketplaceAdmin/orderCancellation/CommentsAttachmentsSection",["UWA/Class/View","DS/Controls/TabBar","DS/MPFServices/ObjectService","DS/MPFMarketplaceAdmin/orderCancellation/CommentsTile","DS/MPFMarketplaceAdmin/orderCancellation/AttachmentsTile","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation"],(function(e,t,s,i,r,a){"use strict";const n=Object.freeze({}),o=Object.freeze({COLLAPSED:"collapsed",COMMENTS:"comments",ATTACHMENTS:"attachments"}),l=e.extend({className:"mpf-comments-attachements-section",setup({me:e,cart:t,cartNotesFactory:s,documentFactory:i,state:r}={}){this.me=e,this.cart=t,this.cartNotesFactory=s,this.documentFactory=i,this.state=r||o.COLLAPSED,this.commentsTile=this._createCommentsTile(),this.attachmentsTile=this._createAttachmentsTile()},render(){const e=[{tag:"div",class:"mpf-tabs",html:[this._renderTab("comment",a.get("comments"),o.COMMENTS),this._renderTab("attach",a.get("attachments"),o.ATTACHMENTS)]}];return this.state===o.COMMENTS?e.push(this.commentsTile.render()):this.state===o.ATTACHMENTS&&e.push(this.attachmentsTile.render()),this.container.setContent(e),this},destroy(){this.me=null,this.cart=null,this.cartNotesFactory=null,this.documentFactory=null,this._parent(),this.container=null},_renderTab(e,t,s){return{tag:"span",class:"mpf-tab"+(this.state===s?" mpf-selected":""),html:[{tag:"span",class:"fonticon fonticon-"+e},{tag:"span",class:"mpf-tab-label",text:t}],events:{click:()=>{this.state===s?this.state=o.COLLAPSED:this.state=s,this.commentsTile.reset(),this.render()}}}},_createCommentsTile(){return new i({me:this.me,cart:this.cart,cartNotesFactory:this.cartNotesFactory})},_createAttachmentsTile(){return new r({me:this.me,cart:this.cart,documentFactory:this.documentFactory})}});return l.Events=n,l})),define("DS/MPFMarketplaceAdmin/orderCancellation/TransactionCard",["UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFPersonModel/PersonModel","DS/MPFCountryModel/CountryCollection","DS/MPFCartModel/CartNotesFactory","DS/MPFDocumentModel/DocumentFactory","DS/MPFMarketplaceAdmin/orderCancellation/CardHeader","DS/MPFMarketplaceAdmin/orderCancellation/CardProductList","DS/MPFMarketplaceAdmin/orderCancellation/CommentsAttachmentsSection","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation"],(function(e,t,s,i,r,a,n,o,l,c,h,d){"use strict";const u=Object.freeze({DOWNLOAD_FILE:"downloadFile",CANCEL:"cancel",APPROVE:"approveCancellation",REFUSE:"refuseCancellation"}),p=e.extend({className:"mpf-transaction-card",setup(e={}){s.requiredOfPrototype(e.me,r,"options.me must be a PersonModel"),s.requiredOfPrototype(e.cart,i,"options.cart must be a CartModel"),s.requiredOfPrototype(e.cartNotesFactory,n,"options.cartNotesFactory must be a CartNotesFactory"),s.requiredOfPrototype(e.documentFactory,o,"options.documentFactory must be a DocumentFactory"),s.requiredOfPrototype(e.countries,a,"options.countries must be a CountryCollection"),this.me=e.me,this.cart=e.cart,this.countries=e.countries,this.cartNotesFactory=e.cartNotesFactory,this.documentFactory=e.documentFactory,this.locale=e.locale||"fr-FR",this.cardHeader=this._createCardHeader(),this.productList=this._createProductList(),this.cart.isCancellation()&&(this.commentsAttachementsSection=this._createCommentsAttachmentsSection())},render(){const e=this.cart.getNetAmountTotal();return this.container.setContent([this.cardHeader.render(),{tag:"div",class:"mpf-card-body",html:[this.productList.render()]},{tag:"div",class:"mpf-card-footer",html:[{tag:"div",class:"mpf-total-price-container",html:[{tag:"span",class:"mpf-total-price-label",text:d.get("totalPriceExclTax")},{tag:"span",class:"mpf-total-price",text:e&&e.toLocaleString(this.locale,{style:"currency",currency:this.cart.getCurrency()})}]},...this._createButtons()]},this.commentsAttachementsSection&&this.commentsAttachementsSection.render()]),this},destroy(){this.stopListening(),this.cardHeader.destroy(),this.productList.destroy(),this.me=null,this.cart=null,this.countries=null,this.cartNotesFactory=null,this.documentFactory=null,this._parent(),this.container=null},_createCardHeader(){const e=new l({cart:this.cart,countries:this.countries});return this.listenTo(e,l.Events.DOWNLOAD_FILE,this.dispatchEvent.bind(this,u.DOWNLOAD_FILE,{cart:this.cart})),e},_createProductList(){return new c({cart:this.cart,locale:this.locale})},_createCommentsAttachmentsSection(){return new h({me:this.me,cart:this.cart,documentFactory:this.documentFactory,cartNotesFactory:this.cartNotesFactory})},_createButtons(){const e=[],t=this.me.hasRole(r.Roles.PRICER);return(t||this.me.hasRole(r.Roles.SALES_ADMIN))&&parseFloat(this.cart.getNetAmountTotal())>0&&(this.cart.isCancellation()?this.cart.getState()===i.States.SUBMITTED&&t?(e.push(this._createButton(d.get("approve"),u.APPROVE)),e.push(this._createButton(d.get("reject"),u.REFUSE))):this.cart.getState()===i.States.REFUND_FAILED&&e.push(this._createButton(d.get("retry"),u.APPROVE)):this.me.hasRole(r.Roles.SALES_ADMIN)&&e.push(this._createButton(d.get("cancel"),u.CANCEL))),e},_createButton(e,s){return new t({className:"primary",value:e,events:{onClick:()=>{this.dispatchEvent(s,{cart:this.cart})}}})}});return p.Events=u,p})),define("DS/MPFMarketplaceAdmin/offerManagement/SubscriptionPlanTablesComponent",["UWA/Class/View","DS/MPFMarketplaceAdmin/offerManagement/SubscriptionPlanTable","DS/MPFOfferModel/OfferCreationModel","DS/MPFMarketplaceAdmin/offerManagement/SubscriptionPlanProductLine","DS/MPFServices/ObjectService"],(function(e,t,s,i,r){"use strict";const a=Object.freeze({REMOVE_PRODUCT:"RemoveProduct",COMPUTE_NET_PRICE:"ComputeNetPrice",COMPUTE_PERCENTAGE:"ComputePercentage",ADJUST_CHANGED:"AdjustChanged"}),n=Object.freeze({LOADED:"Loaded",LOADING:"Loading"}),o=e.extend({className:"mpf-subscription-plan-tables-component",setup(e){this.offerCreationModel=e.offerCreationModel,this.portfolioPackCollection=e.portfolioPackCollection,this.mainComponent=e.mainComponent,this.country=e.country,this.priceList=e.priceList,this.disableField=this.offerCreationModel.getState()===s.States.ACTIVE||this.offerCreationModel.getState()===s.States.INACTIVE||this.offerCreationModel.getState()===s.States.APPROVED,this.tables=this._createTables(),this._checkMainComponent(),this.state=n.LOADED},render(){const e=[];return Object.values(this.tables).forEach((t=>{e.push(t.render())})),this.container.setContent(e),this},destroy(){this._parent(),this.tables=null,this.container=null},_destroyTables(){Object.values(this.tables).forEach((e=>{e&&e.destroy()}))},_createTables(){const e={YSC:"",QSC:"",MSC:""};return Object.keys(e).forEach((s=>{const i=new t({offerCreationModel:this.offerCreationModel,portfolioPackCollection:this.portfolioPackCollection,licensingScheme:s,priceList:this.priceList,country:this.country,mainComponent:this.mainComponent});i.addClassName(s),this.listenTo(i,t.Events.COMPUTE_PERCENTAGE,(e=>{i.offerCreationModel.getPrices().percentageDiscount!==e.percentage&&this.offerCreationModel.setPricesByLicensingScheme(e.licensingScheme,{percentageDiscount:e.percentage}),this.dispatchEvent(a.COMPUTE_PERCENTAGE,e)})),this.listenTo(i,t.Events.COMPUTE_NET_PRICE,(e=>{i.setAdjustKey(),this.dispatchEvent(a.COMPUTE_NET_PRICE,e)})),this.listenTo(i,t.Events.REMOVE_PRODUCT,(e=>{this.dispatchEvent(a.REMOVE_PRODUCT,e)})),this.listenTo(i,t.Events.ADJUST_CHANGED,(e=>{this.dispatchEvent(a.ADJUST_CHANGED,e)})),e[s]=i})),e.QSC.hide(),e.MSC.hide(),e},deleteProductInTables(e){Object.values(this.tables).forEach((t=>{e in t.products&&(t.products[e].destroy(),delete t.products[e]);const i=Object.values(t.products),r=i.reverse().find((e=>e.listPrice));if(r){delete this.offerCreationModel.getPrices()[t.licensingScheme][s.AdjustedProduct.ADJUSTED_INDICATOR+e],!r.adjust.isChecked()&&i.length>0&&(this.offerCreationModel.deleteAdjustedProduct(t.licensingScheme),this.offerCreationModel.setAdjustedProduct(r.trigram,r.key.getValue(),t.licensingScheme),t.setAdjust(r)),t.updateAdjustKey(r.trigram),t.setAdjustKey()}})),this._updateComputedPercentageValues(),this._updateComputedNetPriceValues()},async loadData(e){return this.portfolioPackCollection.productTrigram=e,await this.portfolioPackCollection.fetchPromise({country:this.country})},addProductInPeriodicityTable(e,t){this.tables[e].addProduct(t)},setAdjustedProduct(e){Object.values(this.tables).forEach((t=>{if(Object.keys(t.products).length){let s=e[t.licensingScheme];s=s.slice(1,s.length),s&&t.setAdjust(t.products[s])}}))},_checkMainComponent(){this.mainComponent||Object.values(this.tables).forEach((e=>{e.displayNonMainTable()}))},addPoductToSubscriptionPlan(e){const t=this.offerCreationModel.getAdjustedProductsByPeriodicity();for(const[s,r]of Object.entries(this.tables)){const a=this.offerCreationModel.getPrices(),n=t[s];a[s][n]&&this.offerCreationModel.removeAdjustedProduct(i.KeyValues.MIN_KEY_VALUE,s),r.products[e]&&this.offerCreationModel.setAdjustedProduct(e,Number(r.products[e].key.getValue()),s)}this._updateSubscriptionPlanProductsKeys(),this._updateComputedPercentageValues()},_updateSubscriptionPlanProductsKeys(){for(const[e,t]of Object.entries(this.tables))Object.keys(this.offerCreationModel.getPrices()[e]).forEach((s=>{const i=this.offerCreationModel.getProducts().find((e=>e===s));i&&(this.offerCreationModel.getPrices()[e][s]=Number(t.products[i].key.getValue()))}))},_updateComputedPercentageValues(){Object.values(this.tables).forEach((e=>{e.computeListPrice(),e.computePercentageOfferPrice(e.percentage)}))},_updateComputedNetPriceValues(){Object.values(this.tables).forEach((e=>{0!==Number(e.netPriceInput.getValue())&&e.netPriceInput.setValue(e.listPriceValue.getHTML())}))},async fillTables(){const e=this.offerCreationModel.getProducts();for(const t of e){this.portfolioPackCollection.productTrigram=t,await this.portfolioPackCollection.fetchPromise({country:this.country});const e=this.offerCreationModel.getPrices(),i=this.portfolioPackCollection.getStandardOffer(),r={};Object.keys(e).forEach((e=>{r[e]=i.getOffers().getPortfolioWithLicensingScheme(e)}));for(const e in r)if(r[e]){const a=r[e].getPriceList()[0].price;r[e]=a,this.addProductInPeriodicityTable(e,{name:i.getDisplayName(),trigram:t,listPrice:r[e]});let n=this.offerCreationModel.getPrices()[e][t];void 0===n&&(n=this.offerCreationModel.getPrices()[e][s.AdjustedProduct.ADJUSTED_INDICATOR+t]),this.tables[e].products[t].key.setValue(n),this.tables[e].computePercentageOfferPrice()}}this.setState(n.LOADED)},computePrices(){for(const[e,t]of Object.entries(this.tables)){t.computeListPrice();const s=this.offerCreationModel.getPrices()[e].percentageDiscount;t.percentage=s,t.percentageInput.setValue(s),t.disableInput(t.percentageInput);for(let[s,i]of Object.entries(t.products)){const t=this.offerCreationModel.getAdjustedProductsByPeriodicity()[e];t.slice(1,t.length)===s&&(s=t),i.key.setValue(this.offerCreationModel.getPrices()[e][s]),i.disableKeyInput()}const i=this.offerCreationModel.getPrices()[e].netDiscount[t.country];i>=0&&(t.mainComponent||t.pricelistToggle.check(),this.disableField||t.netPriceInput.enable(),t.netPriceInput.setValue(i),t.disableInput(t.netPriceInput),Object.values(t.products).forEach((e=>{e.disableKeyInput()})))}},setState(e){this.state=e,this.dispatchEvent(e),this.render()},setTablesPercentage(e){const t=this.tables[e.licensingScheme];t.percentage!==e.percentage&&(t.percentageInput.setValue(e.percentage),t.updatePercentage(t.percentageInput),t.computePercentageOfferPrice())},checkValidSubscriptionPlanTables(){const e=Object.values(this.tables);for(let t=0;t<e.length;t++)if(!e[t].checkValidPricesOfProduct())return!1;return!0},hidePricelistCheck(e){Object.values(this.tables).forEach((t=>{t.hidePriceListCheck(e)}))}});return o.Events=a,o.States=n,o})),define("DS/MPFMarketplaceAdmin/offerManagement/OfferCreationForm",["UWA/Class/View","DS/MPFMarketplaceAdmin/offerManagement/OfferCreationFormLeftComponent","DS/MPFMarketplaceAdmin/offerManagement/OfferCreationFormRightComponent","DS/MPFServices/ObjectService"],(function(e,t,s,i){"use strict";const r=Object.freeze({SUBSCRIPTION_PLAN_CHANGED:"SubscriptionPlanChanged"}),a=e.extend({className:"mpf-offer-creation-form",setup(e){this.offerCreationModel=e.offerCreationModel,this.activeOffers=e.activeOffers,this.leftComponent=this._createLeftComponent(),this.rightComponent=this._createRighComponent()},render(){return this.container.setContent([this.leftComponent.render(),this.rightComponent.render()]),this},destroy(){this.stopListening(),this.leftComponent&&this.leftComponent.destroy(),this.rightComponent&&this.rightComponent.destroy(),this._parent(),this.container=null},_createLeftComponent(){const e=new t({offerCreationModel:this.offerCreationModel,activeOffers:this.activeOffers});return this.listenTo(e,t.SubscriptionPlanEvent.SUBSCRIPTION_PLAN_CHANGED,this.dispatchEvent.bind(this,r.SUBSCRIPTION_PLAN_CHANGED)),e},_createRighComponent(){return new s({offerCreationModel:this.offerCreationModel,copyTextOffers:this.activeOffers})}});return a.Events=r,a})),define("DS/MPFMarketplaceAdmin/offerManagement/OfferManagementFilterCommands",["UWA/Core","UWA/Class/View","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldSelectInputV2","DS/UIKIT/Input/Button","DS/MPFView/FieldToggleInput","DS/MPFView/DropdownFieldDateInput","DS/MPFMarketplaceAdmin/offerManagement/AutocompleteInput","DS/MPFServices/ObjectService","DS/MPFOfferModel/OfferCollectionFilterModel","DS/MPFOfferModel/OfferCreationModel","DS/MPFPersonModel/PersonModel","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],(function(e,t,s,i,r,a,n,o,l,c,h,d,u){"use strict";const p=Object.freeze({NEW_REQUEST_OFFER:"newRequestOffer",REFRESH:"refresh"}),m=Object.freeze({DRAFT:"Draft",SUBMITTED:"Submitted",APPROVED:"Approved",REJECTED:"Rejected",ACTIVE:"Active",INACTIVE:"Inactive"}),f=Object.freeze({YEARLY:"YSC",QUARTERLY:"QSC",MONTHLY:"MSC"}),g=t.extend({className:"mpf-offer-management-filter-commands",setup(e){this.me=e.me,this.offerFilters=e.offerFilters,this.renewWithOffers=e.renewWithOffers,this.nameEntry=this._createNameEntry(),this.urlEntry=this._createUrlEntry(),this.statusEntry=this._createStatusEntry(),this.subscriptionPlanEntry=this._createSubscriptionPlanEntry(),this.customerProfileEntry=this._createCustomerProfileEntry(),this.startDateEntry=this._createStartDateEntry(),this.endDateEntry=this._createEndDateEntry(),this.renewalEntry=this._createRenewalEntry(),this.renewWithEntry=this._createRenewWithEntry(),this.offerRequestButton=this._createRequestOfferButton()},render(){const e=[];return this.me.hasRole(d.Roles.OFFER_ADMIN)&&e.push(this.offerRequestButton),e.push([this.nameEntry,this.urlEntry,this.statusEntry,this.subscriptionPlanEntry,this.customerProfileEntry,this.startDateEntry,this.endDateEntry,this.renewalEntry,this.renewWithEntry]),this.container.setContent([e]),this},destroy(){this.stopListening(),this._parent(),this.offerRequestButton=null,this.nameEntry=null,this.urlEntry=null,this.statusEntry=null,this.subscriptionPlanEntry=null,this.customerProfileEntry=null,this.startDateEntry=null,this.endDateEntry=null,this.renewalEntry=null,this.renewWithEntry=null},_createEntry:(t,s)=>e.createElement("div",{class:s,html:[t.render()]}),_createToggleEntry:(t,s,i)=>e.createElement("div",{class:t,html:[e.createElement("div",{class:"mpf-label",text:s}),i.render()]}),_createTextField(e,t,i){const r=new s({model:this.offerFilters,fieldName:e,fieldLabel:t,placeholder:i,dynamicValidation:!0,silent:!1});return this.listenTo(r,s.Events.UPDATE,this.dispatchEvent.bind(this,p.REFRESH)),r},_createAutocompleteInput(e,t){const s=new o({model:this.offerFilters,fieldName:e,fieldLabel:t,saveOnChange:!0,offersList:this.renewWithOffers,fetchOptions:{getRenewWith:!0,YSC:!0,QSC:!0,MSC:!0}});return this.listenTo(s,o.Events.UPDATE,this.dispatchEvent.bind(this,p.REFRESH)),s},_createSelectField(e,t,s,r){const a=new i({model:this.offerFilters,fieldName:e,fieldLabel:t,placeholder:s,selectableOptions:r,dynamicValidation:!0,silent:!1,multipleOptionsSelectable:!1});return this.listenTo(a,i.Events.UPDATE,this.dispatchEvent.bind(this,p.REFRESH)),a},_createToggleField(e,t){const s=new a({model:this.offerFilters,fieldName:e,fieldLabel:t,dynamicValidation:!1});return this.listenTo(s,a.Events.UPDATE,this.dispatchEvent.bind(this,p.REFRESH)),s},_createDatePicker(e,t,s){const i=new n({model:this.offerFilters,fieldName:e,fieldLabel:t,placeholder:s,renderDatePickerInside:!0});return this.listenTo(i,n.Events.UPDATE,this.dispatchEvent.bind(this,p.REFRESH)),i},_createNameEntry(){const e=this._createTextField(c.Fields.FILTER_BY_NAME,u.get("name"),u.get("enterValue"));return this._createEntry(e,"mpf-offer-filter-text mpf-name")},_createUrlEntry(){const e=this._createTextField(c.Fields.FILTER_BY_URL,u.get("url"),u.get("enterValue"));return this._createEntry(e,"mpf-offer-filter-text mpf-url")},_createStatusEntry(){const e=this._createSelectField(c.Fields.FILTER_BY_STATUS,u.get("status"),u.get("selectStatus"),[{value:m.DRAFT,label:u.get("draft")},{value:m.SUBMITTED,label:u.get("submitted")},{value:m.APPROVED,label:u.get("approved")},{value:m.REJECTED,label:u.get("rejected")},{value:m.ACTIVE,label:u.get("active")},{value:m.INACTIVE,label:u.get("inactive")}]);return this._createEntry(e,"mpf-offer-filter-select mpf-status")},_createSubscriptionPlanEntry(){const e=this._createSelectField(c.Fields.FILTER_BY_SUBSCRIPTION_PLAN,u.get("subscriptionPlan"),u.get("selectSubscriptionPlan"),[{value:f.YEARLY,label:u.get("yearly")},{value:f.QUARTERLY,label:u.get("quarterly")},{value:f.MONTHLY,label:u.get("monthly")}]);return this._createEntry(e,"mpf-offer-filter-select mpf-subscription-plan")},_createCustomerProfileEntry(){const e=this._createSelectField(c.Fields.FILTER_BY_CUSTOMER_PROFILE,u.get("customerProfile"),u.get("selectProfile"),[{value:h.CustomerProfileEnum.PARTNER,label:u.get("partner")},{value:h.CustomerProfileEnum.COMPANY,label:u.get("company")},{value:h.CustomerProfileEnum.MAKER,label:u.get("maker")},{value:h.CustomerProfileEnum.STUDENT,label:u.get("student")}]);return this._createEntry(e,"mpf-offer-filter-select mpf-customer-profile")},_createStartDateEntry(){const e=this._createDatePicker(c.Fields.FILTER_BY_START_DATE,u.get("startDate"),u.get("enterDate"));return this._createEntry(e,"mpf-offer-filter-date mpf-start-date")},_createEndDateEntry(){const e=this._createDatePicker(c.Fields.FILTER_BY_END_DATE,u.get("endDate"),u.get("enterDate"));return this._createEntry(e,"mpf-offer-filter-date mpf-end-date")},_createRenewalEntry(){const e=this._createToggleField(c.Fields.FILTER_BY_RENEWAL,"");return this._createToggleEntry("mpf-offer-filter-toggle mpf-renewal",u.get("renewal"),e)},_createRenewWithEntry(){const e=this._createAutocompleteInput(c.Fields.FILTER_BY_RENEW_WITH,u.get("renewWith"));return this._createEntry(e,"mpf-offer-filter-autocomplete mpf-renew-with")},_createRequestOfferButton(){return new r({value:u.get("requestOffer"),className:"primary mpf-offer-button",icon:"plus",events:{onClick:this._newOfferRequest.bind(this)}})},_newOfferRequest(){this.dispatchEvent(p.NEW_REQUEST_OFFER)}});return g.Events=p,g})),define("DS/MPFMarketplaceAdmin/offerManagement/OfferList",["UWA/Class/View","DS/MPFMarketplaceAdmin/offerManagement/CardHeader","DS/UIKIT/Spinner","DS/UIKIT/Mask","DS/MPFMarketplaceAdmin/orderCancellation/InfoMessageComponent","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],(function(e,t,s,i,r,a){"use strict";const n=Object.freeze({EDIT_OFFER:"editOffer"}),o=e.extend({className:"mpf-offer-list",setup(e={}){this.offers=e.offers,this.spinnerContainer=this._createSpinnerContainer(),this.infoMessageComponent=this._createInfoMessageComponent()},render(){let e=[];return this.isLoading?e=[this.spinnerContainer]:(this._clearCards(),this.offers.size()>0?(this.cards=this.offers.map((e=>this._createCard(e))),e=this.cards.map((e=>e.render()))):e=this.infoMessageComponent.render()),this.container.setContent(e),this},destroy(){this.stopListening(),this._parent(),this.container=null,this._clearCards()},_createCard(e){const s=new t({offer:e});return this.listenTo(s,t.Events.EDIT_OFFER,this.dispatchEvent.bind(this,n.EDIT_OFFER)),s},_clearCards(){Array.isArray(this.cards)&&this.cards.forEach((e=>{this.stopListening(e),e.destroy()})),this.cards=[]},_createSpinnerContainer:()=>({tag:"div",class:"mpf-spinner-container",html:(new s).show()}),_createInfoMessageComponent(){return new r({items:this.offers,name:a.get("offers")})},setLoading(e=!0){this.isLoading=e,this.render()}});return o.Events=n,o})),define("DS/MPFMarketplaceAdmin/orderCancellation/RelatedCartCard",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFPersonModel/PersonModel","DS/MPFCountryModel/CountryCollection","DS/MPFCartModel/CartNotesFactory","DS/MPFDocumentModel/DocumentFactory","DS/MPFMarketplaceAdmin/orderCancellation/CompactCardHeader","DS/MPFMarketplaceAdmin/orderCancellation/TransactionCard"],(function(e,t,s,i,r,a,n,o,l){"use strict";const c=Object.freeze({CANCEL:"cancel",APPROVE:"approveCancellation",REFUSE:"refuseCancellation",EDIT:"editCancellation",DOWNLOAD_FILE:"downloadFile"}),h=Object.freeze({COLLAPSED:"collapsed",EXPANDED:"expanded"}),d=e.extend({className:"mpf-related-cart-card",setup({cart:e,me:o,countries:l,cartNotesFactory:c,documentFactory:d,locale:u,state:p}={}){t.requiredOfPrototype(e,s,"options.cart must be a CartModel"),t.requiredOfPrototype(o,i,"options.me must be a PersonModel"),t.requiredOfPrototype(c,a,"options.cartNotesFactory must be a CartNotesFactory"),t.requiredOfPrototype(d,n,"options.documentFactory must be a DocumentFactory"),t.requiredOfPrototype(l,r,"options.countries must be a CountryCollection"),this.cart=e,this.me=o,this.countries=l,this.cartNotesFactory=c,this.documentFactory=d,this.locale=u,this.state=p||h.COLLAPSED,this.compactHeader=this._createCompactCardHeader(),this.transactionCard=this._createTransactionCard()},render(){const e=[];return this.state===h.COLLAPSED?(e.push(this.compactHeader.render()),this.container.removeClassName("mpf-expanded")):(e.push(this._renderToggleIcon()),e.push(this.transactionCard.render()),this.container.addClassName("mpf-expanded")),this.container.setContent(e),this},destroy(){this.stopListening(),this.compactHeader.destroy(),this.transactionCard.destroy(),this.cart=null,this.countries=null,this._parent(),this.container=null},_renderToggleIcon(){return{tag:"div",class:"mpf-toggle-icon fonticon fonticon-expand-down",events:{click:this._expandCollapse.bind(this)}}},_createCompactCardHeader(){const e=new o({cart:this.cart,locale:this.locale});return this.listenTo(e,o.Events.ON_CLICK,this._expandCollapse.bind(this)),this.listenTo(e,o.Events.DOWNLOAD_FILE,this.dispatchEvent.bind(this,c.DOWNLOAD_FILE,{cart:this.cart})),e},_createTransactionCard(){const e=new l({cart:this.cart,me:this.me,countries:this.countries,cartNotesFactory:this.cartNotesFactory,documentFactory:this.documentFactory,locale:this.locale});return this.listenTo(e,l.Events.CANCEL,this.dispatchEvent.bind(this,c.CANCEL)),this.listenTo(e,l.Events.APPROVE,this.dispatchEvent.bind(this,c.APPROVE)),this.listenTo(e,l.Events.REFUSE,this.dispatchEvent.bind(this,c.REFUSE)),this.listenTo(e,l.Events.DOWNLOAD_FILE,this.dispatchEvent.bind(this,c.DOWNLOAD_FILE)),e},_expandCollapse(){this.state=this.state===h.EXPANDED?h.COLLAPSED:h.EXPANDED,this.render()}});return d.Events=c,d})),define("DS/MPFMarketplaceAdmin/offerManagement/OfferCreationFooter",["UWA/Class/View","UWA/Core","DS/UIKIT/Toggler","DS/MPFMarketplaceAdmin/offerManagement/OfferCreationFooterForm","DS/MPFServices/ObjectService","DS/MPFMarketplaceAdmin/offerManagement/SubscriptionPlanTablesComponent","DS/UIKIT/Alert","DS/MPFView/ValidationResultBuilder","DS/UIKIT/Mask","DS/MPFOfferModel/OfferCreationModel","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],(function(e,t,s,i,r,a,n,o,l,c,h){"use strict";const d=Object.freeze({SEARCH_BY_TRIGRAM:"SearchByTrigram"}),u=Object.freeze({HIDE_CURRENCIES:"HideCurrencies",SHOW_CURRENCIES:"ShowCurrencies"}),p=Object.freeze({LOADED:"Loaded",LOADING:"Loading"}),m=e.extend({className:"mpf-offer-creation-footer",setup(e={}){this.countryByPriceList={FRA:"EuroZone Price List/EUR",USA:"USA Price List/USD",JPN:"Japan Price List/JPY",AUS:"Australia Price List/AUD",CAN:"Canada Price List/CAD",GBR:"UK Price List/GBP",NOR:"Norway Price List/NOK",SWE:"Sweden Price List/SEK",IND:"India Price List/INR",POL:"CEMA Price List/EUR (PLN)"},this.offerCreationModel=e.offerCreationModel,this.portfolioPackCollection=e.portfolioPackCollection,this.footerForm=this._createFooterForm(),this.tabs=this._createTabs(),this.tables=this._createTables(),this.navTab=this._createNavTab(),this.alert=this._createAlert(),this.showCurrencies=this._createLabelCurrencies("mpf-label mpf-footer-show-currencies",h.get("showCurrencies"),u.SHOW_CURRENCIES),this.hideCurrencies=this._createLabelCurrencies("mpf-label mpf-footer-hide-currencies",h.get("hideCurrencies"),u.HIDE_CURRENCIES),this.state=u.HIDE_CURRENCIES,this.dataState=p.LOADED,this.loadedTables=Object.keys(this.countryByPriceList).length,this.subscriptionPlanChanged(),this._setOfferType(),this.offerCreationModel.getProducts().length>0&&this._loadData()},render(){const e=[this.footerForm.render(),this.alert,this.navTab];if(this.state===u.HIDE_CURRENCIES)e.push(this.tables.FRA.render(),this.showCurrencies);else{const t=[];Object.values(this.tables).forEach((e=>{t.push(e.render())})),e.push(t),e.push(this.hideCurrencies)}return this.container.setContent(e),this.dataState===p.LOADED?(l.unmask(this.container),this.dispatchEvent(p.LOADED)):(l.mask(this.container),this.dispatchEvent(p.LOADING)),this},destroy(){this.stopListening(),this.footerForm&&this.footerForm.destroy(),this._destroyTables(),this.navTab=null,this.tabs=null,this._parent(),this.alert=null,this.showCurrencies=null,this.hideCurrencies=null,this.state=null,this.dataState=null,this.loadedTables=null,this.toggler&&this.toggler.destroy(),this.container=null},_destroyTables(){Object.values(this.tables).forEach((e=>{e&&e.destroy()}))},subscriptionPlanChanged(){const e=this.offerCreationModel.getPrices();let t=!1;for(const[s,i]of Object.entries(e))this.tabs[s].hasClassName("active")&&!0!==i.check&&(this.tabs[s].removeClassName("active"),t=!1),this.tabs[s].hasClassName("active")&&(t=!0),!0===i.check?this.tabs[s].removeClassName("disabled"):this.tabs[s].addClassName("disabled");t||this._setActiveTab(Object.values(this.tabs))},_createSubscriptionPlanTab:e=>t.createElement("div",{class:"tab-item mpf-subscription-plan-component-tab-"+e+" disabled",html:[{tag:"span",text:e}]}),_setActiveTab(e){for(let t=0;t<e.length&&!e[t].hasClassName("active");t++)if(!e[t].hasClassName("active")&&!e[t].hasClassName("disabled")){e[t].addClassName("active"),this._displayTable(e[t],t,!0);break}},_createTabs(){return{YSC:this._createSubscriptionPlanTab(h.get("yearly")),QSC:this._createSubscriptionPlanTab(h.get("quarterly")),MSC:this._createSubscriptionPlanTab(h.get("monthly"))}},_createNavTab(){const e=t.createElement("nav",{class:"tab tab-pills mpf-subscription-plan-component-tab",html:Object.values(this.tabs)});return this.toggler=new s({container:e,events:{onToggle:this._displayTable.bind(this)}}),e},_createAlert:()=>new n({autoHide:!0,closable:!0,visible:!1}),_showError(e){this.alert.add({className:"error",message:e}).show(),this._setAllTablesState(a.States.LOADED)},_displayTable(e,t,s){Object.values(this.tables).forEach((e=>{switch(t){case 0:this._showTable(s,e.tables.YSC),this._showTable(!s,e.tables.QSC),this._showTable(!s,e.tables.MSC);break;case 1:this._showTable(s,e.tables.QSC),this._showTable(!s,e.tables.YSC),this._showTable(!s,e.tables.MSC);break;case 2:this._showTable(s,e.tables.MSC),this._showTable(!s,e.tables.YSC),this._showTable(!s,e.tables.QSC)}}))},_showTable(e,t){e?t.show():t.hide()},_createTables(){const e={};for(const[t,s]of Object.entries(this.countryByPriceList)){let i=!1;"FRA"===t&&(i=!0);const r=new a({offerCreationModel:this.offerCreationModel,portfolioPackCollection:this.portfolioPackCollection,priceList:s,country:t,mainComponent:i});this.listenTo(r,a.Events.REMOVE_PRODUCT,(e=>{Object.values(this.tables).forEach((t=>{t.deleteProductInTables(e)}));Object.keys(this.tables.FRA.tables).forEach((t=>delete this.offerCreationModel.getPrices()[t][e]))})),this.listenTo(r,a.Events.COMPUTE_NET_PRICE,(e=>{Object.values(this.tables).forEach((t=>{if(e){t.tables[e.licensingScheme].setAllKeysValue(e.keys)}}))})),this.listenTo(r,a.Events.COMPUTE_PERCENTAGE,(e=>{Object.values(this.tables).forEach((t=>{t.setTablesPercentage(e)}))})),this.listenTo(r,a.Events.ADJUST_CHANGED,(e=>{Object.values(this.tables).forEach((t=>{t.tables[e.licensingScheme].setAdjust(t.tables[e.licensingScheme].products[e.trigram])}))})),this.listenTo(r,a.States.LOADING,this._setDataState.bind(this,-1)),this.listenTo(r,a.States.LOADED,this._setDataState.bind(this,1)),e[t]=r}return e},_setDataState(e){this.loadedTables=this.loadedTables+e,this.loadedTables<Object.keys(this.countryByPriceList).length?this.dataState=p.LOADING:this.dataState=p.LOADED,this.render()},_createFooterForm(){const e=new i({offerCreationModel:this.offerCreationModel});return this.listenTo(e,i.Events.SEARCH_BY_TRIGRAM,(e=>{this._searchProductByTrigram(e.getValue())})),this.listenTo(e,i.Events.TYPE_CHANGED,(e=>{this._typeChanged(e)})),e},_createLabelCurrencies(e,s,i){const r=t.createElement("a",{class:e,text:s});return r.addEvent("click",this._setState.bind(this,i)),r},_setState(e){this.state=e,this.render()},_getUnavailablePeriodicity(e,t){if(0===Object.values(e).length)return["YSC","QSC","MSC"];const s=[];for(const[i,r]of Object.entries(t))!e[i]&&r.check&&s.push(i);return s},async _searchProductByTrigram(e){try{if(!this._getPeriodicities())return void this._showError(h.get("subscriptionPlanNotChecked",{trigram:e}));if(this.offerCreationModel.getProducts().find((t=>t===e)))return void this._showError(h.get("productAlreadyAddedError"));const t={},s={};this._setAllTablesState(a.States.LOADING);for await(const[i,r]of Object.entries(this.tables))t[i]=await r.loadData(e),s[i]=t[i].getStandardOffer();const i=this.offerCreationModel.getPrices(),r={},n=Object.keys(i);Object.keys(this.tables).forEach((e=>{const t={};n.forEach((i=>{t[i]=s[e].getOffers().getPortfolioWithLicensingScheme(i)})),r[e]=t}));const o=this._getUnavailablePeriodicity(r.FRA,i);if(o.length)return void this._showError(h.get("productNotAvailableError",{subscriptionPlan:o}));for(const[t,i]of Object.entries(r))for(const r in i)if(i[r]){const a=i[r].getPriceList()[0].price;i[r]=a,this.tables[t].addProductInPeriodicityTable(r,{name:s[t].getDisplayName(),trigram:e,listPrice:i[r]})}this.offerCreationModel.addProduct(e),Object.values(this.tables).forEach((t=>{t.addPoductToSubscriptionPlan(e),t.computePrices(),t.setState(a.States.LOADED)}))}catch(e){console.error(e),this._showError(h.get("productNameError"))}},_typeChanged(e){Object.values(this.tables).forEach((t=>{t.hidePricelistCheck(e)}))},_getPeriodicities(){const e=this.offerCreationModel.getPrices();let t=0;return Object.values(e).forEach((e=>{e.check&&t++})),t},checkAllRequiredFields(){const e=[this.footerForm.validateType(),this._checkEmptyTables()];let t=!0;return e.forEach((e=>{!e.isValid&&t&&(t=!1)})),t},checkValidSubscriptionPlanTablesComponent(){const e=Object.values(this.tables);for(let t=0;t<e.length;t++)if(!e[t].checkValidSubscriptionPlanTables())return!1;return!0},_checkEmptyTables(){this.footerForm.removeErrorMessage(this.footerForm.trigram);const e=new o;for(const[t,s]of Object.entries(this.tables.FRA.tables))this.tabs[t].hasClassName("disabled")||0===Object.keys(s.products).length&&e.addError(h.get("tableEmptyError"),h.get("tableEmptyError"));const t=e.build();return t.isValid||this.footerForm.displayErrorMessage(t,this.footerForm.trigram),t},_setAllTablesState(e){Object.values(this.tables).forEach((t=>{t.setState(e)}))},async _loadData(){this._setAllTablesState(a.States.LOADING);const e=Object.values(this.tables);for(let t=0;t<e.length;t++)await e[t].fillTables();this._setAdjustedProduct(),e.forEach((e=>{e.computePrices()}))},_setAdjustedProduct(){const e=this.offerCreationModel.getAdjustedProductsByPeriodicity();Object.values(this.tables).forEach((t=>{t.setAdjustedProduct(e)}))},_setOfferType(){const e=this.footerForm.hidePricelistCheck(this.offerCreationModel.getDiscountType());this._typeChanged(e)}});return m.Events=d,m.States=u,m.dataStates=p,m})),define("DS/MPFMarketplaceAdmin/orderCancellation/CancellationModal",["UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/MPFView/CollapsibleModal","DS/MPFView/FieldDateInput","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldSelectInputV2","DS/MPFServices/ObjectService","DS/MPFCartModel/CartCancellationFactory","DS/MPFDocumentModel/DocumentFactory","DS/MPFCartModel/CartCancellationModel","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFCartModel/CartNotesModel","DS/MPFMarketplaceAdmin/orderCancellation/CancellationModalFileInput","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation"],(function(e,t,s,i,r,a,n,o,l,c,h,d,u,p,m,f,g){"use strict";const C=Object.freeze({ON_CART_UPDATE:"onCartUpdate"}),E=Object.freeze({CREATE:"create",APPROVE:"approve",REFUSE:"refuse"}),P=e.extend({className:"mpf-cancellation-modal",setup({cartCancellationFactory:e,documentFactory:t}={}){l.requiredOfPrototype(e,c,"options.cartCancellationFactory must be a CartCancellationFactory"),l.requiredOfPrototype(t,h,"options.documentFactory must be a DocumentFactory"),this.cartCancellationFactory=e,this.documentFactory=t,this.confirmationButton=this._createConfirmationButton(),this.cancelButton=this._createCancelButton(),this.modal=this._createModal(this.confirmationButton,this.cancelButton),this.alert=this._createAlert(),this.fileInput=this._createFileInput()},render(){return this.container.setContent(this.modal),this},show({state:e,cart:t,cartNotes:s,dates:i}={}){let r;l.requiredOfType(e,"string","options.state must be a string"),l.requiredOfPrototype(t,u,"options.cart must be a CartModel"),e===E.CREATE&&l.requiredOfPrototype(s,m,"options.cartNotes must be a CartNotesModel"),this.confirmationButton.setDisabled(!1),e===E.CREATE?(this.confirmationButton.setDisabled(!0),r=this.cartCancellationFactory.createModel(c.Types.CART_CANCELLATION,{[d.Fields.ORIGIN_TRANSACTION]:t.pick("id")},{parentResourceId:t.get("id")})):e===E.APPROVE&&(r=this.cartCancellationFactory.createModel(c.Types.CART_CANCELLATION,{id:t.get("id")})),this.modal.setHeader(this._renderHeader({state:e,cart:t})),this.modal.setBody(this._renderBody({state:e,cart:t,cartNotes:s,cartCancellation:r,dates:i})),this.confirmationButton.setValue(this._getButtonLabel({state:e})),this.confirmationButton.removeEvent("onClick"),this.confirmationButton.addEvent("onClick",(()=>this._save({state:e,cart:t,cartNotes:s,cartCancellation:r}))),this.modal.show()},hide(){this.modal.hide()},destroy(){this.modal.destroy(),this.modal=null,this._parent(),this.container=null},setLoading(e=!0,s){e?(t.mask(this.modal.getBody(),s),this.confirmationButton.disable()):(t.unmask(this.modal.getBody()),this.confirmationButton.enable())},async _save({state:e,cart:t,cartNotes:s,cartCancellation:i}){try{e===E.CREATE?(this.setLoading(!0,g.get("creatingCancellation")),await i.savePromise(),s.setCartId(i.get("id")),await Promise.all([i.savePromise({[d.Fields.STATE]:d.States.SUBMITTED},{patch:!0}),s.savePromise(),this.fileInput.save({cartCancellation:i})])):e===E.APPROVE?(this.setLoading(!0,g.get("approvingCancellation")),await i.savePromise({[d.Fields.STATE]:d.States.APPROVED,[d.Fields.REQUEST_DATE]:i.getRequestDate()},{patch:!0})):e===E.REFUSE&&(this.setLoading(!0,g.get("refusingCancellation")),i=this.cartCancellationFactory.createModel(c.Types.CART_CANCELLATION,{id:t.get("id")}),await i.savePromise({[d.Fields.STATE]:d.States.REFUSED},{patch:!0}))}catch(e){console.error(e),this.setLoading(!1);const t=e.response,s=t&&t.errorCode;let i;return i="ALREADY_CANCELLED"===s||"400"===s?g.get("orderAlreadyCancelled"):"ALREADY_RENEWED"===s?g.get("orderAlreadyRenewed"):g.get("failedToSaveModification"),void this.alert.add({className:"error",message:i}).show()}this.setLoading(!1),this.hide(),this.dispatchEvent(C.ON_CART_UPDATE,{state:e,cartCancellation:i})},_renderHeader({state:e,cart:t}){const s=t.getName();let i;switch(e){case E.CREATE:i=g.get("createCancellationFor",{cartName:s});break;case E.APPROVE:i=g.get("approveCancellationWithName",{cartName:s});break;case E.REFUSE:i=g.get("rejectCancellationWithName",{cartName:s});break;case E.EDIT:i=g.get("editCancellationWithName",{cartName:s})}return{tag:"h4",text:i}},_renderBody({state:e,cart:t,cartNotes:s,cartCancellation:i,dates:r}){return{tag:"div",html:[this.alert,{tag:"div",class:"mpf-info-text",text:this._createInfoText(e,t)},this._createCommentInput(e,s),this._createFileInputContainer(e),this._createEffectiveDateContainer(e,t,i,r),this._createReasonContainer(e,i)]}},_getButtonLabel({state:e}){let t;switch(e){case E.APPROVE:case E.REFUSE:case E.CREATE:t=g.get("confirm");break;case E.EDIT:t=g.get("save")}return t},_createInfoText(e,t){const s=t.getName();return e===E.REFUSE?g.get("confirmRejectionText",{cartName:s}):""},_createCommentInput(e,t){if(e===E.CREATE)return new n({model:t,fieldName:m.Fields.PRIVATE_NOTES,fieldLabel:g.get("comments"),multiline:!0,multilineRows:3,dynamicValidation:!0}).render()},_createFileInputContainer(e){if(e===E.CREATE)return{tag:"div",class:"mpf-document-input",html:[{tag:"div",class:"mpf-label",text:g.get("attachments")},this.fileInput.reset().render()]}},_createEffectiveDateContainer(e,t,s,i){if(e===E.CREATE||e===E.APPROVE)return{tag:"div",class:"mpf-effective-date",html:[{tag:"div",class:"mpf-effective-date-input",html:this._createEffectiveDateInput(e,t,s,i)},{tag:"div",class:"mpf-effective-date-description",text:e===E.CREATE?g.get("createEffectiveDate"):g.get("approveEffectiveDate")}]}},_createReasonContainer(e,t){if(e===E.CREATE){const e=[{value:d.Reasons.DEPLOYMENT,label:g.get("deployment")},{value:d.Reasons.ORDERING,label:g.get("ordering")},{value:d.Reasons.PAYMENT,label:g.get("payment")},{value:d.Reasons.STORE_TO_FRANCE,label:g.get("storeToFrance")},{value:d.Reasons.PRODUCT_USE,label:g.get("productUse")},{value:d.Reasons.UNSATISFIED,label:g.get("unsatisfied")},{value:d.Reasons.WRONG_PRODUCT,label:g.get("wrongProduct")}],s=new o({model:t,required:!0,dynamicValidation:!0,fieldName:d.Fields.REASON,fieldLabel:g.get("reason"),selectableOptions:e,placeholder:g.get("selectReason")});return this.listenTo(s,o.Events.UPDATE,(()=>{s.isValid()&&t.getReason()?this.confirmationButton.setDisabled(!1):this.confirmationButton.setDisabled(!0)})),{tag:"div",class:"mpf-reason-input",html:s.render()}}},_createEffectiveDateInput(e,t,s,i){const r=new a({model:s,dynamicValidation:!0,fieldName:d.Fields.REQUEST_DATE,fieldLabel:g.get("effectiveDate"),placeholder:g.get("enterDate"),renderDatePickerInside:!1,min:i.start&&new Date(i.start),max:i.end&&new Date(i.end)});return e===E.APPROVE&&t.getRequestDate()&&(r.setValue(t.getRequestDate()),s.set(d.Fields.REQUEST_DATE,t.getRequestDate())),r.render()},_createFileInput(){return new f({documentFactory:this.documentFactory})},_createConfirmationButton:()=>new i({className:"primary"}),_createCancelButton(){return new i({value:g.get("cancel"),events:{onClick:this.hide.bind(this)}})},_createModal(e,t){return new r({footer:[e,t],events:{onHide:()=>{this.alert.getMessages().forEach((e=>this.alert.remove(e)))}}})},_createAlert:()=>new s({autoHide:!1,visible:!1})});return P.Events=C,P.States=E,P})),define("DS/MPFMarketplaceAdmin/offerManagement/OfferListViewPage",["UWA/Class/View","DS/MPFMarketplaceAdmin/offerManagement/OfferManagementFilterCommands","DS/MPFMarketplaceAdmin/offerManagement/OfferList","DS/MPFServices/ObjectService"],(function(e,t,s,i){"use strict";const r=Object.freeze({NEW_REQUEST_OFFER:"newRequestOffer",EDIT_OFFER:"editOffer"}),a=e.extend({className:"mpf-offer-list-view",setup(e){this.me=e.me,this.offerFilters=e.offerFilters,this.offers=e.offers,this.offerModel=e.offerModel,this.renewWithOffers=e.renewWithOffers,this.offerFilterCommands=this._createOfferFilterCommands(),this.offerList=this._createOfferList(),this.listenTo(this.offerFilterCommands,t.Events.REFRESH,this._onFilterUpdate.bind(this))},render(){return this.container.setContent([this.offerFilterCommands.render(),this.offerList.render()]),this},destroy(){this.stopListening(),this._parent(),this.offerFilterCommands&&this.offerFilterCommands.destroy(),this.offerList&&this.offerList.destroy(),this.container=null},_createOfferFilterCommands(){const e=new t({me:this.me,offerFilters:this.offerFilters,renewWithOffers:this.renewWithOffers});return this.listenTo(e,t.Events.NEW_REQUEST_OFFER,this._newOfferRequest.bind(this)),e},_createOfferList(){const e=new s({offers:this.offers});return this.listenTo(e,s.Events.EDIT_OFFER,this.dispatchEvent.bind(this,r.EDIT_OFFER)),e},_newOfferRequest(){this.dispatchEvent(r.NEW_REQUEST_OFFER)},_onFilterUpdate(){this.isUpdating||(this.isUpdating=!0,this.offerList.setLoading(!0),this.offerFilters.isEmpty()||(this._onOfferUpdate(),this._updateOffers().then((()=>{this.isUpdating=!1,this.offerList.setLoading(!1)}))),this.isUpdating=!1)},async _updateOffers(){return await this.offers.fetchPromise(this.offerFilters.toJSON())},async _onOfferUpdate(){try{await this._updateOffers()}catch(e){console.log(e)}this.render()}});return a.Events=r,a})),define("DS/MPFMarketplaceAdmin/orderCancellation/OrderCancellationCard",["UWA/Class/View","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFPersonModel/PersonModel","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartCollection","DS/MPFCountryModel/CountryCollection","DS/MPFCartQuoteModel/CartQuoteFactory","DS/MPFInvoiceModel/InvoiceFactory","DS/MPFCartModel/CartNotesFactory","DS/MPFDocumentModel/DocumentFactory","DS/MPFMarketplaceAdmin/orderCancellation/TransactionCard","DS/MPFMarketplaceAdmin/orderCancellation/RelatedCartCard","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation"],(function(e,t,s,i,r,a,n,o,l,c,h,d,u,p){"use strict";const m=Object.freeze({DOWNLOAD_FILE:"downloadFile",CANCEL:"cancel",APPROVE:"approveCancellation",REFUSE:"refuseCancellation",EDIT:"editCancellation"}),f=e.extend({className:"mpf-order-cancellation-card",setup(e={}){s.requiredOfPrototype(e.me,i,"options.me must be a PersonModel"),s.requiredOfPrototype(e.cart,r,"options.cart must be a CartModel"),s.requiredOfPrototype(e.relatedCarts,a,"options.relatedCarts must be a CartCollection"),s.requiredOfPrototype(e.cartNotesFactory,c,"options.cartNotesFactory must be a CartNotesFactory"),s.requiredOfPrototype(e.documentFactory,h,"options.documentFactory must be a DocumentFactory"),s.requiredOfPrototype(e.countries,n,"options.countries must be a CountryCollection"),this.me=e.me,this.cart=e.cart,this.relatedCarts=e.relatedCarts,this.countries=e.countries,this.cartQuoteFactory=e.cartQuoteFactory,this.invoiceFactory=e.invoiceFactory,this.cartNotesFactory=e.cartNotesFactory,this.documentFactory=e.documentFactory,this.locale=e.locale||"fr-FR",this.alertContainer=this._createAlertContainer(),this.transactionCard=this._createTransactionCard(),this.relatedCartCards=this._createRelatedCartCards()},render(){return this.container.setContent([this.alertContainer,this.transactionCard.render(),{tag:"div",class:"mpf-related-carts-container",html:this.relatedCartCards.map((e=>e.render()))}]),this},destroy(){this.stopListening(),this.transactionCard.destroy(),this.relatedCartCards.map((e=>e.destroy())),this.transactionCard=null,this.relatedCartCards=null,this.cart=null,this.me=null,this.countries=null,this._parent(),this.container=null},_createAlertContainer:()=>new t({visible:!1}),_createTransactionCard(){const e=new d({cart:this.cart,me:this.me,locale:this.locale,countries:this.countries,cartNotesFactory:this.cartNotesFactory,documentFactory:this.documentFactory});return this.listenTo(e,d.Events.CANCEL,this.dispatchEvent.bind(this,m.CANCEL)),this.listenTo(e,d.Events.APPROVE,this.dispatchEvent.bind(this,m.APPROVE)),this.listenTo(e,d.Events.REFUSE,this.dispatchEvent.bind(this,m.REFUSE)),this.listenTo(e,d.Events.DOWNLOAD_FILE,this._downloadDocuments.bind(this)),e},_createRelatedCartCards(){return this.relatedCarts.map((e=>{const t=new u({cart:e,me:this.me,locale:this.locale,countries:this.countries,cartNotesFactory:this.cartNotesFactory,documentFactory:this.documentFactory});return this.listenTo(t,u.Events.CANCEL,this.dispatchEvent.bind(this,m.CANCEL)),this.listenTo(t,u.Events.APPROVE,this.dispatchEvent.bind(this,m.APPROVE)),this.listenTo(t,u.Events.REFUSE,this.dispatchEvent.bind(this,m.REFUSE)),this.listenTo(t,u.Events.DOWNLOAD_FILE,this._downloadDocuments.bind(this)),t}))},async _downloadQuote({cart:e}={}){const t=this.cartQuoteFactory.createModel(o.Types.CART_QUOTE);t.setParentResourceId(e.get("id"));try{await t.fetchPromise();const e=t.getUrl();if(!e)throw new Error("No quoteUrl attribute on quote");window.open(e,"_blank")}catch(e){console.warn(e),this.alertContainer.add({className:"warning",message:p.get("noQuoteFound")}).show()}},async _downloadInvoices({cart:e}={}){const t=this.invoiceFactory.createCollection(l.Types.CART_INVOICE);t.setParentResourceId(e.get("id"));try{if(await t.fetchPromise(),t.isEmpty())throw new Error("No invoices found");t.forEach((e=>{window.open(e.getInvoice(),"_blank")}))}catch(e){console.warn(e),this.alertContainer.add({className:"warning",message:p.get("noInvoicesFound")}).show()}},_downloadDocuments({cart:e}){e.isCancellation()||this._downloadQuote({cart:e}),this._downloadInvoices({cart:e})}});return f.Events=m,f})),define("DS/MPFMarketplaceAdmin/platformCreation/ProductListCard",["DS/MPFMarketplaceAdmin/orderCancellation/CardProductList"],(e=>e)),define("DS/MPFMarketplaceAdmin/offerManagement/OfferCreationHeader",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/MPFMarketplaceAdmin/StateProgressTile","DS/MPFServices/ObjectService","DS/MPFPersonModel/PersonModel","DS/MPFOfferModel/OfferCreationModel","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],(function(e,t,s,i,r,a,n,o){"use strict";const l=Object.freeze({SUBMIT_FOR_APPROVAL:"submitForApproval",SAVE:"save",CANCEL:"cancel",APPROVE:"approve",REJECT:"reject",ACTIVATE:"activate",DEACTIVATE:"deactivate"}),c=e.extend({className:"mpf-offer-creation-header",setup(e){this.me=e.me,this.offerCreationModel=e.offerCreationModel,this.stateTileContainer=this._creatStateTileContainer(),this.buttonsContainer=this._createButtonsContainer()},render(){if(this.offerCreationModel.getState()){const e=new i({model:this.offerCreationModel,state:this.offerCreationModel.getState()});this.stateTileContainer.addContent({html:[e.render()]})}return this.container.setContent([this.stateTileContainer,this.buttonsContainer]),this},destroy(){this.stopListening(),this._parent(),this.stateTileContainer=null,this.container=null},_creatStateTileContainer:()=>t.createElement("div",{class:"mpf-sate-tile"}),_createButtonsContainer(){this.buttons=[];const e=this.offerCreationModel.getState();if(this.me.hasRole(a.Roles.OFFER_ADMIN))if(this.offerCreationModel.isNew()||e===n.States.DRAFT||e===n.States.REJECTED){const e=this._createButton(o.get("submitForApproval"),"primary mpf-offer-button mpf-submit-for-approval",this.dispatchEvent.bind(this,l.SUBMIT_FOR_APPROVAL,n.States.SUBMITTED)),t=this._createButton(o.get("save"),"primary mpf-offer-button mpf-save",this.dispatchEvent.bind(this,l.SAVE,n.States.DRAFT));this.buttons.push(e,t)}else if(e===n.States.APPROVED){const e=this._createButton(o.get("activate"),"primary mpf-offer-button mpf-activate",this.dispatchEvent.bind(this,l.ACTIVATE,n.States.ACTIVE)),t=this._createButton(o.get("save"),"primary mpf-offer-button mpf-save",this.dispatchEvent.bind(this,l.SAVE,n.States.DRAFT));this.buttons.push(e,t)}else if(e===n.States.INACTIVE){const e=this._createButton(o.get("activate"),"primary mpf-offer-button mpf-activate",this.dispatchEvent.bind(this,l.ACTIVATE,n.States.ACTIVE)),t=this._createButton(o.get("save"),"primary mpf-offer-button mpf-save",this.dispatchEvent.bind(this,l.SAVE,n.States.INACTIVE));this.buttons.push(e,t)}else if(e===n.States.ACTIVE){const e=this._createButton(o.get("deactivate"),"primary mpf-offer-button mpf-deactivate",this.dispatchEvent.bind(this,l.DEACTIVATE,n.States.INACTIVE)),t=this._createButton(o.get("save"),"primary mpf-offer-button mpf-save",this.dispatchEvent.bind(this,l.ACTIVATE,n.States.ACTIVE));this.buttons.push(e,t)}if(this.me.hasRole(a.Roles.PRICER)&&e===n.States.SUBMITTED){const e=this._createButton(o.get("approve"),"primary mpf-offer-button mpf-approve",this.dispatchEvent.bind(this,l.APPROVE,n.States.APPROVED)),t=this._createButton(o.get("reject"),"primary mpf-offer-button mpf-reject",this.dispatchEvent.bind(this,l.REJECT,n.States.REJECTED)),s=this._createButton(o.get("save"),"primary mpf-offer-button mpf-save",this.dispatchEvent.bind(this,l.SAVE,this.offerCreationModel.getState()));this.buttons.push(e,t,s)}const s=this._createButton(o.get("cancel"),"primary mpf-offer-button mpf-cancel",this.dispatchEvent.bind(this,l.CANCEL));return this.buttons.push(s),t.createElement("div",{class:"mpf-buttons",html:this.buttons})},enableButtonsContainer(e){e.forEach((e=>{e.enable()}))},disableButtonsContainer(e){e.forEach((e=>{e.getValue()!==o.get("cancel")&&e.disable()}))},_createButton:(e,t,i)=>new s({value:e,className:t,events:{onClick:i}})});return c.Events=l,c})),define("DS/MPFMarketplaceAdmin/couponManagement/CardHeader",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFMarketplaceAdmin/StateProgressTile","i18n!DS/MPFMarketplaceAdmin/assets/nls/CouponManagement"],(function(e,t,s,i){"use strict";const r=Object.freeze({EDIT_COUPON:"editCoupon"}),a=e.extend({className:"mpf-coupon-card-header",domEvents:{click:"cardClicked"},setup(e={}){this.coupon=e.coupon,this.couponStateTile=this._createCouponStateTile()},render(){const e=this.coupon.getCommercialName(),t=this.coupon.getInternalName(),s=this.coupon.getCategory(),r=this.coupon.getPercentage(),a=this.coupon.getQuantity();let n=this.coupon.getStartDate(),o=this.coupon.getEndDate();if(n){const e=new Date(this.coupon.getStartDate());n=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()}if(o){const e=new Date(this.coupon.getEndDate());o=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()}const l=[];return l.push(this._createTile("mpf-card-name",[this._createLine(i.get("code"),e),this._createLine(i.get("name"),t),this._createLine(i.get("category"),s)])),l.push(this._createTile("mpf-card-discount",[this._createLine(i.get("discount"),r),this._createLine(i.get("numberOfUse"),a)])),l.push(this._createTile("mpf-card-date",[this._createLine(i.get("startDate"),n),this._createLine(i.get("endDate"),o)])),l.push(this.couponStateTile.render()),this.container.setContent(l),this},destroy(){this._parent(),this.couponStateTile&&this.couponStateTile.destroy(),this.container=null},_createTile(e,t){if(t.find((e=>!!e)))return{tag:"div",class:"mpf-header-tile "+e,html:t}},_createLine:(e,t)=>(t||(t=""),{tag:"div",class:"mpf-header-line",html:[{tag:"span",class:"mpf-label",text:e},{tag:"span",class:"mpf-value",text:t}]}),_createCouponStateTile(){return new s({model:this.coupon,state:this.coupon.getStatus()})},cardClicked(){this.dispatchEvent(r.EDIT_COUPON,this.coupon)}});return a.Events=r,a})),define("DS/MPFMarketplaceAdmin/orderCancellation/OrderCancellationList",["UWA/Class/View","DS/UIKIT/Spinner","DS/MPFServices/ObjectService","DS/MPFPersonModel/PersonModel","DS/MPFCartModel/CartCollection","DS/MPFCountryModel/CountryCollection","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartNotesFactory","DS/MPFDocumentModel/DocumentFactory","DS/MPFMarketplaceAdmin/orderCancellation/OrderCancellationCard","DS/MPFMarketplaceAdmin/orderCancellation/InfoMessageComponent","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation"],((e,t,s,i,r,a,n,o,l,c,h,d)=>{"use strict";const u=Object.freeze({CANCEL:"cancelCart",APPROVE:"approveCancellation",REFUSE:"refuseCancellation",EDIT:"editCancellation"}),p=e.extend({className:"mpf-order-cancellation-list",setup:function(e={}){s.requiredOfPrototype(e.carts,r,"options.carts must be a CartCollection"),s.requiredOfPrototype(e.me,i,"options.me must be a PersonModel"),s.requiredOfPrototype(e.cartFactory,n,"options.cartFactory must be a CartFactory"),s.requiredOfPrototype(e.cartNotesFactory,o,"options.cartNotesFactory must be a CartNotesFactory"),s.requiredOfPrototype(e.documentFactory,l,"options.documentFactory must be a DocumentFactory"),s.requiredOfPrototype(e.countries,a,"options.countries must be a CountryCollection"),this.carts=e.carts,this.me=e.me,this.countries=e.countries,this.cartFactory=e.cartFactory,this.invoiceFactory=e.invoiceFactory,this.cartQuoteFactory=e.cartQuoteFactory,this.cartNotesFactory=e.cartNotesFactory,this.documentFactory=e.documentFactory,this.locale=e.locale,this.spinnerContainer=this._createSpinnerContainer(),this.infoMessageComponent=this._createInfoMessageComponent()},render:function(){let e;return this.isLoading?e=[this.spinnerContainer]:(this._clearCards(),this.carts.size()>0?(this.cards=this.carts.map((e=>this._createCard(e))),e=this.cards.map((e=>e.render()))):e=this.infoMessageComponent.render()),this.container.setContent(e),this},destroy:function(){this.stopListening(),this._clearCards(),this.me=null,this.carts=null,this.countries=null,this.cartFactory=null,this._parent()},setLoading(e=!0){this.isLoading=e,this.render()},_clearCards(){Array.isArray(this.cards)&&this.cards.forEach((e=>{this.stopListening(e),e.destroy()})),this.cards=[]},_createCard(e){const t=this.cartFactory.createCollection(n.Types.CART_TRANSACTIONS,e.getRelatedCarts(),{parse:!0}),s=e.isCancellation()?e.getRelatedCarts()[0].items[0]:e.getItems()[0],i={start:s.getStartDate(),end:s.getEndDate()},r=new c({me:this.me,locale:this.locale,cart:e,relatedCarts:t,countries:this.countries,cartQuoteFactory:this.cartQuoteFactory,invoiceFactory:this.invoiceFactory,cartNotesFactory:this.cartNotesFactory,documentFactory:this.documentFactory});return this.listenTo(r,c.Events.CANCEL,(({cart:e})=>{this.dispatchEvent(u.CANCEL,{cart:e,dates:i})})),this.listenTo(r,c.Events.APPROVE,(({cart:e})=>{this.dispatchEvent(u.APPROVE,{cart:e,dates:i})})),this.listenTo(r,c.Events.REFUSE,this.dispatchEvent.bind(this,u.REFUSE)),r},_createInfoMessageComponent(){return new h({items:this.carts,name:d.get("carts")})},_createSpinnerContainer:()=>({tag:"div",class:"mpf-spinner-container",html:(new t).show()})});return p.Events=u,p})),define("DS/MPFMarketplaceAdmin/couponManagement/CouponList",["UWA/Class/View","DS/UIKIT/Spinner","DS/MPFMarketplaceAdmin/orderCancellation/InfoMessageComponent","DS/MPFMarketplaceAdmin/couponManagement/CardHeader","DS/MPFServices/ObjectService","i18n!DS/MPFMarketplaceAdmin/assets/nls/CouponManagement"],(function(e,t,s,i,r,a){"use strict";const n=Object.freeze({EDIT_COUPON:"editCoupon"}),o=e.extend({className:"mpf-coupon-list",setup(e){this.coupons=e.coupons,this.spinnerContainer=this._createSpinnerContainer(),this.infoMessageComponent=this._createInfoMessageComponent()},render(){let e=[];return this.isLoading?e=[this.spinnerContainer]:(this._clearCards(),this.coupons.size()>0?(this.cards=this.coupons.map((e=>this._createCard(e))),e=this.cards.map((e=>e.render()))):e=this.infoMessageComponent.render()),this.container.setContent(e),this},destroy(){this.stopListening(),this._parent(),this.container=null,this.spinnerContainer=null,this.infoMessageComponent=null,this._clearCards()},_clearCards(){Array.isArray(this.cards)&&this.cards.forEach((e=>{this.stopListening(e),e.destroy()})),this.cards=[]},_createSpinnerContainer:()=>({tag:"div",class:"mpf-spinner-container",html:(new t).show()}),_createInfoMessageComponent(){return new s({items:this.coupons,name:a.get("coupons")})},_createCard(e){const t=new i({coupon:e.getCampaign()});return this.listenTo(t,i.Events.EDIT_COUPON,this.dispatchEvent.bind(this,n.EDIT_COUPON)),t},setLoading(e=!0){this.isLoading=e,this.render()}});return o.Events=n,o})),define("DS/MPFMarketplaceAdmin/orderCancellation/OrderCancellationPage",["UWA/Class/View","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFPersonModel/PersonModel","DS/MPFCartModel/CartCollection","DS/MPFCartModel/CartCollectionFilterModel","DS/MPFCountryModel/CountryCollection","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartCancellationFactory","DS/MPFCartModel/CartNotesFactory","DS/MPFDocumentModel/DocumentFactory","DS/MPFModel/CollectionFetchOptions","DS/MPFMarketplaceAdmin/orderCancellation/OrderCancellationFilterCommands","DS/MPFMarketplaceAdmin/orderCancellation/OrderCancellationList","DS/MPFMarketplaceAdmin/orderCancellation/CancellationModal","DS/MPFPaginationComponent/PaginationComponent","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation","css!DS/MPFMarketplaceAdmin/MPFMarketplaceAdmin.css"],((e,t,s,i,r,a,n,o,l,c,h,d,u,p,m,f,g,C)=>{"use strict";return e.extend({className:"mpf-order-cancellation-page",setup(e={}){i.requiredOfPrototype(e.me,r,"options.me must be a PersonModel"),i.requiredOfPrototype(e.carts,a,"options.carts must be a CartCollection"),i.requiredOfPrototype(e.cartFilters,n,"options.cartFilters must be a CartCollectionFilterModel"),i.requiredOfPrototype(e.cartFactory,l,"options.cartFactory must be a CartFactory"),i.requiredOfPrototype(e.cartCancellationFactory,c,"options.orderCancellationFactory must be a CartCancellationFactory"),i.requiredOfPrototype(e.cartNotesFactory,h,"options.cartNotesFactory must be a CartNotesFactory"),i.requiredOfPrototype(e.documentFactory,d,"options.options.documentFactory must be a DocumentFactory"),i.requiredOfPrototype(e.countries,o,"options.countries must be a CountryCollection"),this.me=e.me,this.carts=e.carts,this.countries=e.countries,this.cartFilters=e.cartFilters,this.cartFactory=e.cartFactory,this.cartQuoteFactory=e.cartQuoteFactory,this.cartCancellationFactory=e.cartCancellationFactory,this.invoiceFactory=e.invoiceFactory,this.cartNotesFactory=e.cartNotesFactory,this.documentFactory=e.documentFactory,this.filterCommands=this._createFilterCommands(),this.orderList=this._createOrderList(),this.paginationComponent=this._createPaginationComponent(),this.cancellationModal=this._createCancellationModal(),this.alert=this._createAlert(),this.listenTo(this.cartFilters,"onChange",this._onFilterUpdate.bind(this)),this.listenTo(this.filterCommands,p.Events.REFRESH,this._onFilterUpdate.bind(this))},render(){return this.container.setContent([this.filterCommands.render(),this.alert,this.cancellationModal.render(),this.orderList.render(),this.paginationComponent.render()]),this},destroy(){this.stopListening(),this.filterCommands.destroy(),this.orderList.destroy(),this.me=null,this.carts=null,this.countries=null,this.cartFilters=null,this.cartFactory=null,this._parent(),this.container=null},_onFilterUpdate(){this.isUpdating||(this.isUpdating=!0,this.orderList.setLoading(!0),this._updateCarts().then((()=>{this.isUpdating=!1,this.orderList.setLoading(!1),this.paginationComponent.onCollectionUpdate()})))},_updateCarts(){return this.carts.fetchPromise(this.cartFilters.toJSON())},async _refreshList(){s.mask(this.container,C.get("refreshingList"));try{await this._updateCarts()}catch(e){return console.error(e),s.unmask(this.container),void this.alert.add({className:"error",message:C.get("failedToRefreshOrderList")}).show()}s.unmask(this.container)},_showCancellationModal({state:e,cart:t,cartNotes:s,dates:i}){e===f.States.CREATE&&(s=this.cartNotesFactory.createModel(h.Types.CART_NOTES)),this.cancellationModal.show({state:e,cart:t,cartNotes:s,dates:i})},async _onCartUpdate({state:e,cartCancellation:t}){let s;await this._refreshList(),this.render(),e===f.States.CREATE?s=C.get("createdOrderCancellationWithId",{id:t.get("id")}):e===f.States.APPROVE?s=C.get("approvedCancellationWithId",{id:t.get("id")}):e===f.States.REFUSE?s=C.get("refusedCancellationWithId",{id:t.get("id")}):e===f.States.EDIT&&(s=C.get("updatedCancellationWithId",{id:t.get("id")})),this.alert.add({className:"success",message:s}).show()},_createFilterCommands(){return new p({cartFilters:this.cartFilters})},_createOrderList(){const e=new m({carts:this.carts,me:this.me,countries:this.countries,cartFactory:this.cartFactory,cartQuoteFactory:this.cartQuoteFactory,invoiceFactory:this.invoiceFactory,cartNotesFactory:this.cartNotesFactory,documentFactory:this.documentFactory});return this.listenTo(e,m.Events.CANCEL,(({cart:e,dates:t})=>this._showCancellationModal({state:f.States.CREATE,cart:e,dates:t}))),this.listenTo(e,m.Events.APPROVE,(({cart:e,dates:t})=>this._showCancellationModal({state:f.States.APPROVE,cart:e,dates:t}))),this.listenTo(e,m.Events.REFUSE,(({cart:e})=>this._showCancellationModal({state:f.States.REFUSE,cart:e}))),e},_createPaginationComponent(){const e=new g({collection:this.carts,pageSize:this.cartFilters.get(u.SIZE),page:this.cartFilters.get(u.START)});return this.listenTo(e,g.Events.CHANGE_PAGE,(({page:e})=>{this.cartFilters.set(u.START,e)})),e},_createCancellationModal(){const e=new f({cartCancellationFactory:this.cartCancellationFactory,documentFactory:this.documentFactory});return this.listenTo(e,f.Events.ON_CART_UPDATE,this._onCartUpdate.bind(this)),e},_createAlert:()=>new t({visible:!1,closable:!0,autoHide:!0,hideDelay:4e3})})})),define("DS/MPFMarketplaceAdmin/orderCancellation/OrderCancellationPageFactory",["DS/MPFModelFactory/MPFFactoriesV2","DS/MPFDataProxy/NoDataProxy","DS/MPFCartModel/CartFactory","DS/MPFCountryModel/CountryFactory","DS/MPFCartModel/CartCollectionFilterModel","DS/MPFModel/CollectionFetchOptions","DS/MPFMarketplaceAdmin/orderCancellation/OrderCancellationPage"],((e,t,s,i,r,a,n)=>{"use strict";return Object.freeze({async create({factories:o,me:l,page:c=1,pageSize:h=10}={}){const[d,u,p,m,f,g,C]=await o.getFactories([e.Types.CART,e.Types.CART_CANCELLATION,e.Types.CART_QUOTE,e.Types.INVOICE,e.Types.CART_NOTES,e.Types.DOCUMENT,e.Types.COUNTRY]),[E,P]=await Promise.all([d.createCollection(s.Types.CART_TRANSACTIONS),C.createCollection(i.Types.BUYER).fetchPromise()]),_=new r({[a.SIZE]:h,[a.START]:c},{dataProxy:t.getInstance()});return new n({cartFilters:_,carts:E,me:l,countries:P,cartFactory:d,cartCancellationFactory:u,cartQuoteFactory:p,invoiceFactory:m,cartNotesFactory:f,documentFactory:g})}})})),define("DS/MPFMarketplaceAdmin/offerManagement/OfferCreationPage",["UWA/Class/View","UWA/Core","DS/MPFMarketplaceAdmin/offerManagement/OfferCreationHeader","DS/MPFMarketplaceAdmin/offerManagement/OfferCreationForm","DS/MPFMarketplaceAdmin/offerManagement/OfferCreationFooter","DS/MPFOfferModel/OfferCreationModel","DS/UIKIT/Alert","DS/MPFServices/ObjectService","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],(function(e,t,s,i,r,a,n,o,l){"use strict";const c=Object.freeze({CANCEL:"cancel"}),h=e.extend({className:"mpf-offer-creation-page",setup(e){this.me=e.me,this.offerCreationModel=e.offerCreationModel,this.portfolioPackCollection=e.portfolioPackCollection,this.activeOffers=e.activeOffers,this.header=this._createHeader(),this.form=this._createForm(),this.footer=this._createFooter()},render(){return this.container.setContent([this.header.render(),this.form.render(),this.footer.render(),this.saveAlert]),this},destroy(){this.stopListening(),this.header&&this.header.destroy(),this.form&&this.form.destroy(),this.footer&&this.footer.destroy(),this._parent(),this.container=null},_createHeader(){const e=new s({me:this.me,offerCreationModel:this.offerCreationModel});return this.listenTo(e,s.Events.CANCEL,this._cancelButtonClicked.bind(this)),this.listenTo(e,s.Events.SAVE,(e=>{this._buttonClicked(e)})),this.listenTo(e,s.Events.SUBMIT_FOR_APPROVAL,(e=>{this._buttonClicked(e)})),this.listenTo(e,s.Events.APPROVE,(e=>{this._buttonClicked(e)})),this.listenTo(e,s.Events.REJECT,(e=>{this._buttonClicked(e)})),this.listenTo(e,s.Events.ACTIVATE,(e=>{this._buttonClicked(e)})),this.listenTo(e,s.Events.DEACTIVATE,(e=>{this._buttonClicked(e)})),e},_cancelButtonClicked(){this.dispatchEvent(c.CANCEL)},_isUrlEmpty(){return!this.form.leftComponent.urlInput.getValue()&&(this._displayAlert(l.get("urlEmptyBeforeSaveError")),!0)},async _buttonClicked(e){if(!this._isUrlEmpty())try{if(e===a.States.SUBMITTED){const e=this.form.leftComponent.checkAllRequiredFields(),t=this.form.rightComponent.checkAllRequiredFields(),s=this.footer.checkAllRequiredFields();if(!e||!t||!s)return}if(e===a.States.DRAFT||e===a.States.SUBMITTED){if(!this.form.leftComponent.validateSubscriptionPlan()||!this.form.leftComponent.validateUrl())return;if(!this.footer.checkValidSubscriptionPlanTablesComponent())return void this._displayAlert(l.get("repartitionKeysError"))}const t=this.offerCreationModel.getState();e!==t&&this.offerCreationModel.setState(e),this.offerCreationModel.isNew()?await this.offerCreationModel.savePromise():this.offerCreationModel.savePromise({...this.offerCreationModel.getPendingChanges(),[a.Fields.PRODUCTS]:this.offerCreationModel.getProducts(),[a.Fields.PRICES]:this.offerCreationModel.getPrices()},{patch:!0}),t!==this.offerCreationModel.getState()&&this.header&&(this.header.destroy(),this.header=null,this.header=this._createHeader(),this.offerCreationModel.getState()===a.States.APPROVED&&(this.form.destroy(),this.form=this._createForm()),this.render())}catch(e){console.error(e)}},_createForm(){const e=new i({offerCreationModel:this.offerCreationModel,activeOffers:this.activeOffers});return this.listenTo(e,i.Events.SUBSCRIPTION_PLAN_CHANGED,this.subscriptionPlanChanged.bind(this)),e},subscriptionPlanChanged(){this.footer.subscriptionPlanChanged()},_createFooter(){const e=new r({offerCreationModel:this.offerCreationModel,portfolioPackCollection:this.portfolioPackCollection});return this.listenTo(e,r.dataStates.LOADED,this.header.enableButtonsContainer.bind(this,this.header.buttons)),this.listenTo(e,r.dataStates.LOADING,this.header.disableButtonsContainer.bind(this,this.header.buttons)),e},_displayAlert(e){new n({closable:!0,visible:!0,autoHide:!0}).inject(this.container,"top").add({className:"error",message:e})}});return h.Events=c,h})),define("DS/MPFMarketplaceAdmin/couponManagement/CouponListViewPage",["UWA/Class/View","DS/MPFMarketplaceAdmin/couponManagement/CouponManagementFilterCommands","DS/MPFMarketplaceAdmin/couponManagement/CouponList"],(function(e,t,s){"use strict";const i=Object.freeze({NEW_REQUEST_COUPON:"newRequestCoupon",EDIT_COUPON:"editCoupon"}),r=e.extend({className:"mpf-coupon-list-view",setup(e){this.me=e.me,this.coupons=e.coupons,this.couponFilters=e.couponFilters,this.changeRequestFactory=e.changeRequestFactory,this.couponFilterCommands=this._createCouponFilterCommands(),this.couponList=this._createCouponList()},render(){return this.container.setContent([this.couponFilterCommands.render(),this.couponList.render()]),this},destroy(){this.stopListening(),this._parent(),this.couponFilterCommands&&this.couponFilterCommands.destroy(),this.couponList&&this.couponList.destroy(),this.container=null},_createCouponFilterCommands(){const e=new t({me:this.me,couponFilters:this.couponFilters});return this.listenTo(e,t.Events.NEW_REQUEST_COUPON,this.dispatchEvent.bind(this,i.NEW_REQUEST_COUPON)),this.listenTo(e,t.Events.REFRESH,this._onFilterUpdate.bind(this)),e},_createCouponList(){const e=new s({coupons:this.coupons});return this.listenTo(e,s.Events.EDIT_COUPON,this.dispatchEvent.bind(this,i.EDIT_COUPON)),e},_newCouponRequest(){this.dispatchEvent(i.NEW_REQUEST_COUPON)},_onFilterUpdate(){this.isUpdating||(this.isUpdating=!0,this.couponList.setLoading(!0),this.couponFilters.isEmpty()||(this._onCouponUpdate(),this._updateCoupons().then((()=>{this.isUpdating=!1,this.couponList.setLoading(!1)}))),this.isUpdating=!1)},async _updateCoupons(){return await this.coupons.fetchPromise(Object.assign({changeRequestFactory:this.changeRequestFactory},this.couponFilters.toJSON()))},async _onCouponUpdate(){try{await this._updateCoupons()}catch(e){console.log(e)}this.render()}});return r.Events=i,r})),define("DS/MPFMarketplaceAdmin/couponManagement/CouponCreationPageFooter",["UWA/Class/View","UWA/Core","DS/UIKIT/Toggler","DS/MPFMarketplaceAdmin/couponManagement/CouponLine","DS/MPFChangeRequestModel/ChangeRequestModel","DS/MPFMarketplaceAdmin/couponManagement/EndDateLine","DS/MPFMarketplaceAdmin/couponManagement/NumberOfUseLine","DS/MPFPortfolioModel/PortfolioFactory","DS/MPFPersonModel/PersonModel","DS/UIKIT/Input/Date","DS/UIKIT/Input/Button","DS/UIKIT/Input/Number","DS/MPFChangeRequestModel/ChangeRequestFactory","i18n!DS/MPFMarketplaceAdmin/assets/nls/CouponManagement"],(function(e,t,s,i,r,a,n,o,l,c,h,d,u,p){"use strict";const m=Object.freeze({EDIT_COUPON:"editCoupon"}),f=e.extend({className:"mpf-coupon-creation-page-footer",setup(e){this.me=e.me,this.couponCreationModel=e.couponCreationModel,this.campaign=e.campaign,this.changeRequests=e.changeRequests,this.discount=e.discount,this.pricelist=e.pricelist,this.isActiveOrInactive=e.isActiveOrInactive,this.uniqueOffers=e.uniqueOffers,this.offer=e.offer,this.portfolioPackCollectionOffer=e.portfolioPackCollectionOffer,this.portfolioFactoryCnB=e.portfolioFactoryCnB,this.skuIdCollection=e.skuIdCollection,this.changeRequestFactory=e.changeRequestFactory,this.tabs=this._createTabs(),this.endDateLines=[],this.changeRequests&&this.isActiveOrInactive&&this._createEndDateLines(),this.nbOfUseLines=[],this.changeRequests&&this.isActiveOrInactive&&this._createNbOfUseLines(),this.couponLines=[],this.isActiveOrInactive?(this.offers=this._getChangeRequestsValueNew(r.Alias.COUPON_OFFER_ID),this.products=this._getChangeRequestsValueNew(r.Alias.COUPON_SKU_ID)):(this.offers=this.campaign.getOfferPids(),this.products=this.campaign.getProductSkuIds()),this.offers&&this._createOfferLines(),this.products&&this._createTrigramLines()},render(){return this.tables=this._createTables(),this.navTab||(this.navTab=this._createNavTab()),this._displayTable(this.toggler.getActiveElements()),this.container.setContent([this.navTab,this.tables.coupon,this.tables.endDate,this.tables.numberOfUse]),this},destroy(){this.couponLines.forEach((e=>e.destroy())),this.toggler.destroy(),this.toggler=null,this.couponLines=null,this.tabs=null,this.navTab=null,this.tables=null,this._parent(),this.container=null},_getChangeRequestsValueNew(e){let t=[];return this.changeRequests.forEach((s=>{s.getAlias()===e&&t.push(s.getValueNew())})),t},_getChangeRequests(e){let t=[];return this.changeRequests.forEach((s=>{s.getAlias()===e&&t.push(s)})),t},_createTab:(e,s)=>t.createElement("div",{class:"tab-item mpf-footer-tab-"+e,html:[{tag:"span",text:s}]}),_createTabs(){const e=this._createTab("coupon",p.get("coupon")),t=this._createTab("end-date",p.get("endDate")),s=this._createTab("number-of-use",p.get("numberOfUse"));this.isActiveOrInactive||(t.addClassName("disabled"),s.addClassName("disabled"));return{coupon:e,endDate:t,numberOfUse:s}},_createNavTab(){const e=t.createElement("nav",{class:"tab tab-pills mpf-coupon-creation-page-footer-tab",html:Object.values(this.tabs)});return this.toggler=new s({container:e,events:{onToggle:this._displayTable.bind(this)}}),e},_displayTable(e){e.hasClassName("mpf-footer-tab-coupon")?(this.tables.numberOfUse.hide(),this.tables.endDate.hide(),this.tables.coupon.show()):e.hasClassName("mpf-footer-tab-number-of-use")?(this.tables.coupon.hide(),this.tables.endDate.hide(),this.tables.numberOfUse.show()):e.hasClassName("mpf-footer-tab-end-date")&&(this.tables.coupon.hide(),this.tables.numberOfUse.hide(),this.tables.endDate.show())},_createTables(){return this.couponTable=this._createCouponTable(),this.endDateTable=this._createEndDateTable(),this.numberOfUseTable=this._createNumberOfUseTable(),{coupon:this.couponTable,endDate:this.endDateTable,numberOfUse:this.numberOfUseTable}},_createCouponTable(){return t.createElement("div",{class:"mpf-coupon-table",html:[t.createElement("div",{class:"mpf-coupon-table-header",html:[{tag:"div",text:p.get("name"),class:"mpf-coupon-table-name"},{tag:"div",text:p.get("trigram"),class:"mpf-coupon-table-trigram"},{tag:"div",text:p.get("subscription"),class:"mpf-coupon-table-subscription"},{tag:"div",text:p.get("listPrice"),class:"mpf-coupon-table-list-price"},{tag:"div",text:p.get("unitPrice"),class:"mpf-coupon-table-unit-price"},{tag:"div",text:p.get("netPrice"),class:"mpf-coupon-table-net-price"},{tag:"div",text:this.pricelist,class:"mpf-coupon-table-pricelist"}]}),this.couponLines.map((e=>e.render()))]})},_createEndDateTable(){const e=t.createElement("div",{class:"mpf-end-date-table",html:[t.createElement("div",{class:"mpf-end-date-table-header",html:[{tag:"div",text:p.get("endDate"),class:"mpf-end-date-table-end-date"},{tag:"div",text:p.get("status"),class:"mpf-end-date-table-status"},{tag:"div",text:p.get("approvedDate"),class:"mpf-end-date-table-approved-date"}]}),this.endDateLines.map((e=>e.render()))]});if(this.me.hasRole(l.Roles.OFFER_ADMIN)){const s=new c({className:"mpf-end-date-last-line mpf-date"}),i=new h({value:p.get("submitForApproval"),className:"primary mpf-end-date-last-line mpf-button",events:{onClick:this._submitEndDateChangeRequest.bind(this,s)}}),r=t.createElement("div",{class:"mpf-end-date-last-line",html:[s,{tag:"div",text:"",class:"mpf-end-date-table-status"},{tag:"div",text:"",class:"mpf-end-date-table-approved-date"},i]});e.addContent(r)}return e},async _submitEndDateChangeRequest(e){const t=e.getDate();if(t){const e=("0"+t.getDate()).slice(-2),s=("0"+(t.getMonth()+1)).slice(-2);let i=t.getFullYear()+"-"+s+"-"+e+"T00:00:00Z";const a=this.changeRequestFactory.createModel(u.Types.CHANGE_REQUEST,null);a.setAlias(r.Alias.COUPON_END_DATE),a.setValueNew(i),a.setBoPid(this.campaign.getId()),await a.savePromise({boPid:this.campaign.getId(),changeRequest:{alias:r.Alias.COUPON_END_DATE,valueNew:t}})}},_createEndDateLines(){this._getChangeRequests(r.Alias.COUPON_END_DATE).forEach((e=>{this._addEndDateLine(e)}))},_addEndDateLine(e){const t=new a({changeRequest:e});this.endDateLines.push(t)},_createNumberOfUseTable(){const e=t.createElement("div",{class:"mpf-number-of-use-table",html:[t.createElement("div",{class:"mpf-number-of-use-table-header",html:[{tag:"div",text:p.get("numberOfUse"),class:"mpf-number-of-use-table-number-of-use"},{tag:"div",text:p.get("status"),class:"mpf-number-of-use-table-status"},{tag:"div",text:p.get("approvedDate"),class:"mpf-number-of-use-table-approved-date"},{tag:"div",text:p.get("usageFollowUp"),class:"mpf-number-of-use-table-list-action"}]}),this.nbOfUseLines.map((e=>e.render()))]});if(this.me.hasRole(l.Roles.OFFER_ADMIN)){const t=this._createAddNbOfUseLine();e.addContent(t)}return e},_createAddNbOfUseLine(){const e=new d({max:1e4}),s=new h({value:"..."});s.addEvent("onClick",this._infiniteBtnClicked.bind(this,s,e));const i=t.createElement("div",{class:"mpf-number-of-use-last-line- mpf-number-input",html:[e,s]}),r=new h({value:p.get("Activate"),className:"primary mpf-number-of-use-last-line mpf-button",events:{onClick:this._submitNumberOfUseChangeRequest.bind(this,e)}});return t.createElement("div",{class:"mpf-number-of-use-last-line",html:[i,{tag:"div",text:"",class:"mpf-number-of-use-table-status"},{tag:"div",text:"",class:"mpf-number-of-use-table-approved-date"},r]})},_infiniteBtnClicked(e,t){const s=!e.isActive();e.setActive(s),t.setDisabled(s)},async _submitNumberOfUseChangeRequest(e){const t=this.changeRequestFactory.createModel(u.Types.CHANGE_REQUEST,null);t.setAlias(r.Alias.COUPON_QUANTITY),t.setValueNew(e.getValue()),t.setBoPid(this.campaign.getId()),await t.savePromise({boPid:this.campaign.getId(),changeRequest:{alias:r.Alias.COUPON_QUANTITY,valueNew:e.getValue()}}),this._addNewNbOfUseLine(t)},_addNewNbOfUseLine(e){this.nbOfUseLines.pop().destroy(),this._addNbOfUseLine(e),this._updateUsage(e.getValueNew()),this.render()},_createNbOfUseLines(){const e=this._getChangeRequests(r.Alias.COUPON_QUANTITY),t=e.reduce(((e,t)=>Number(e)+Number(t.getValueNew())),0);e.forEach((e=>{this._addNbOfUseLine(e)})),this.nbOfUseLines[0].setUsage(t)},_updateUsage(e){const t=this.nbOfUseLines[0];t.setUsage(Number(t.getUsage())+Number(e))},_addNbOfUseLine(e){const t=new n({changeRequest:e});this.nbOfUseLines.push(t)},addCouponTableTrigramLine(e,t){let s,r;t?(s=e,r=e.getPortofolioByIndex(0)):(s=e.getStandardOffer().getOffers(),r=s.getPortfolioWithLicensingScheme("YSC"));const a=r.getProductDisplayName()?r.getProductDisplayName():r.getProductName(),n=new i({me:this.me,campaign:this.campaign,discount:this.discount,product:s,refProduct:r,name:a,trigram:r.getProductTrigram(),listPrice:r.listPrice,unitPrice:r.unitPrice,netPrice:r.netPrice,isTrigram:!0,index:this.couponLines.length,subscription:t});this.listenTo(n,i.Events.REMOVE_COUPON_LINE,(e=>{this._removeCouponLine(e)})),this.couponLines.push(n)},addCouponTableOfferLine(e,t,s){const r=new i({me:this.me,campaign:this.campaign,discount:this.discount,product:e,name:e.displayName,isTrigram:!1,currency:t,index:this.couponLines.length,subscription:s});this.listenTo(r,i.Events.REMOVE_COUPON_LINE,(e=>{this._removeCouponLine(e)})),this.couponLines.push(r)},_removeCouponLine(e){this.couponLines[e].destroy(),this.couponLines.splice(e,1),this._updateCouponLinesIndex()},_updateCouponLinesIndex(){for(let e=0;e<this.couponLines.length;e++)this.couponLines[e].index=e},setDiscount(e){this.discount=e,this.couponLines.forEach((t=>{t.setDiscount(e)}))},validate(){for(let e=0;e<this.couponLines.length;e++)if(!this.couponLines[e].validate())return!1;return!0},async _createOfferLines(){this.offers.forEach((async e=>{this.offer.id=e,await this.offer.fetchPromise();const t=this.uniqueOffers.find((e=>e.name===this.offer.getName().substring(0,this.offer.getName().length-4)));this.dispatchEvent(m.EDIT_COUPON,{offer:t,subscription:this.offer.getLicensingScheme()})}))},_createTrigramLines(){Promise.all(this.products.map((async e=>{this.skuIdCollection=this.portfolioFactoryCnB.createCollection(o.Types.BY_SKUID),this.skuIdCollection.skuId=e;const t=await this.skuIdCollection.fetchPromise({country:"FRA"});this.addCouponTableTrigramLine(t,t.getPortofolioByIndex(0).getLicensingScheme()),this.render()})))}});return f.Events=m,f})),define("DS/MPFMarketplaceAdmin/sellerRoles/SellerRolesPage",["UWA/Class/View","UWA/Core","DS/MPFMarketplaceAdmin/sellerRoles/SellerRolesUserSearch","DS/MPFMarketplaceAdmin/sellerRoles/SellerRolesContent","i18n!DS/MPFMarketplaceAdmin/assets/nls/SellerRoles","css!DS/MPFMarketplaceAdmin/MPFMarketplaceAdmin.css"],((e,t,s,i,r)=>{"use strict";return e.extend({className:"mpf-seller-roles-page",setup({personRolesFactory:e}){this.SellerRolesUserSearch=new s,this.SellerRolesContent=new i({personRolesFactory:e}),this.listenTo(this.SellerRolesUserSearch,s.Events.SEARCH_USER,(({user:e})=>{this.SellerRolesContent.load({user:e})}))},render(){return this.container.setContent([this._createTitle(),this.SellerRolesUserSearch.render(),this.SellerRolesContent.render()]),this},destroy(){this.stopListening(),this.SellerRolesContent.destroy(),this.SellerRolesUserSearch.destroy(),this.SellerRolesUserSearch=null,this.SellerRolesContent=null,this._parent(),this.container=null},_createTitle:()=>t.createElement("div",{class:"mpf-title",html:[{tag:"h3",html:r.get("marketPlaceRoles",{rolesText:t.createElement("span",{text:"seller roles",styles:{textTransform:"capitalize"}}).outerHTML})},{tag:"hr"}]})})})),define("DS/MPFMarketplaceAdmin/couponManagement/CouponCreationPage",["UWA/Class/View","UWA/Core","DS/MPFCouponModel/CouponCreationModel","DS/MPFPersonModel/PersonModel","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldNumberInputV2","DS/MPFView/FieldDateInput","DS/MPFView/FieldSelectInputV2","DS/UIKIT/Input/Button","DS/MPFMarketplaceAdmin/StateProgressTile","DS/UIKIT/Input/Text","DS/MPFMarketplaceAdmin/couponManagement/CouponCreationPageFooter","DS/MPFMarketplaceAdmin/couponManagement/AutocompleteInput","DS/MPFMarketplaceAdmin/couponManagement/CouponLine","DS/UIKIT/Alert","DS/MPFPortfolioModel/PortfolioFactory","i18n!DS/MPFMarketplaceAdmin/assets/nls/CouponManagement"],(function(e,t,s,i,r,a,n,o,l,c,h,d,u,p,m,f,g){"use strict";const C=Object.freeze({CANCEL:"cancel"}),E=e.extend({className:"mpf-coupon-creation-page",setup(e){this.me=e.me,this.couponCreationModel=e.couponCreationModel,this.campaign=this.couponCreationModel.getCampaign(),this.changeRequests=this.couponCreationModel.getChangeRequests(),this.portfolioPackCollectionTrigram=e.portfolioPackCollectionTrigram,this.portfolioPackCollectionOffer=e.portfolioPackCollectionOffer,this.offers=e.offers,this.offer=e.offer,this.portfolioFactoryCnB=e.portfolioFactoryCnB,this.skuIdCollection=e.skuIdCollection,this.changeRequestFactory=e.changeRequestFactory,this.countryByPriceList={FRA:"EuroZone Price List/EUR",USA:"USA Price List/USD",JPN:"Japan Price List/JPY",AUS:"Australia Price List/AUD",CAN:"Canada Price List/CAD",GBR:"UK Price List/GBP",NOR:"Norway Price List/NOK",SWE:"Sweden Price List/SEK",IND:"India Price List/INR",POL:"CEMA Price List/EUR (PLN)"},this.isActiveOrInactive=this.campaign.getStatus()===s.States.ACTIVE||this.campaign.getStatus()===s.States.TERMINATED,this.disableField=this.options.disableField,this.uniqueOffers=this._createUniqueOffers(),this.stateTileContainer=this._creatStateTileContainer(),this.header=this._createHeader(),this.valueEntry=this._createValueEntry(),this.numberOfUseEntry=this._createNumberOfUseEntry(),this.startDateEntry=this._createStartDateEntry(),this.endDateEntry=this._createEndDateEntry(),this.leftForm=this._createLeftForm(),this.idEntry=this._createIdEntry(),this.codeEntry=this._createCodeEntry(),this.nameEntry=this._createNameEntry(),this.descriptionEntry=this._createDescriptionEntry(),this.categoryEntry=this._createCategoryEntry(),this.rightForm=this._createRightForm(),this.form=this._createForm(),this.trigramEntry=this._createTrigramEntry(),this.offerEntry=this._createOfferEntry(),this.searchContainer=this._createSearchContainer(),this.footer=this._createFooter()},render(){return this.container.setContent([this.header,this.form,this.searchContainer,this.footer.render()]),this},destroy(){this.buttonsContainer=this._destroyButtons(),this.stateContainer=null,this.header=null,this.valueEntry=null,this.valueInput&&this.valueInput.destroy(),this.numberOfUseEntry=null,this.startDateInput&&this.startDateInput.destroy(),this.startDateEntry=null,this.endDateInput&&this.endDateInput.destroy(),this.endDateEntry=null,this.leftForm=null,this.idEntry=null,this.codeEntry=null,this.nameEntry=null,this.descriptionEntry=null,this.categoryEntry=null,this.rightForm=null,this.form=null,this.trigramEntry=null,this.offerEntry=null,this.searchContainer=null,this.footer=null,this._parent(),this.container=null},_destroyButtons(){this.buttons.forEach((e=>{e&&e.destroy()}))},_isFieldReadOnly(e){const t=this.campaign.getStatus();if(t===s.States.DRAFT||this.campaign.isNew())return!1;if(t===s.States.SUBMITTED)return!this.me.hasRole(i.Roles.PRICER);if(t===s.States.REJECTED)return!this.me.hasRole(i.Roles.OFFER_ADMIN);if(t===s.States.APPROVED||t===s.States.ACTIVE||t===s.States.INACTIVE){if(this.me.hasRole(i.Roles.PRICER))return!0;if(this.me.hasRole(i.Roles.OFFER_ADMIN))return[s.Fields.PERCENTAGE,s.Fields.QUANTITY,s.Fields.END_DATE].includes(e)}},_createEntry:(e,s)=>t.createElement("div",{class:s,html:[e.render()]}),_createTextField(e,t,s,i,a=!1){return new r({model:this.campaign,fieldName:e,fieldLabel:t,placeholder:s,dynamicValidation:!0,silent:!1,required:i,readOnly:a})},_createDatePicker(e,t,s,i,r=!1){return new n({model:this.campaign,fieldName:e,fieldLabel:t,placeholder:s,required:i,readOnly:r})},_createNumberField(e,t,s,i,r,n){return new a({model:this.campaign,fieldName:e,fieldLabel:t,placeholder:s,max:i,required:r,readOnly:n,useStringValues:!1})},_updateMinMaxDate(e){switch(e){case"startDateUpdated":this._startDateUpdated();break;case"endDateUpdated":this._endDateUpdated()}},_startDateUpdated(){const e=new Date(this.campaign.getStartDate());this.endDateInput.setMinDate(e);const t=e.toLocaleString("en-US").replace(",","");this.campaign.setStartDate(t)},_endDateUpdated(){const e=new Date(this.campaign.getEndDate());this.startDateInput.setMaxDate(e);const t=e.toLocaleString("en-US").replace(",","");this.campaign.setEndDate(t)},_createSelectField(e,t,s,i,r,a){return new o({model:this.campaign,fieldName:e,fieldLabel:t,placeholder:s,selectableOptions:i,dynamicValidation:!0,silent:!1,required:r,multipleOptionsSelectable:!1,readOnly:a})},_createAutocompleteInput:(e,t,s,i,r)=>new u({fieldName:e,fieldLabel:t,required:i,offersList:s,readOnly:r}),_createButton(e,t,s){return new l({value:e,className:t,events:{onClick:this._buttonClicked.bind(this,s)}})},_createCancelButton(e,t){return new l({value:e,className:t,events:{onClick:this.dispatchEvent.bind(this,C.CANCEL)}})},async _buttonClicked(e){try{const t=this.campaign.getStatus();if(e===s.States.SUBMITTED&&!this._validateAllFields())return;e!==t&&this.campaign.setStatus(e),this.campaign.isNew()?await this.campaign.savePromise():this.campaign.savePromise({...this.campaign.getPendingChanges(),[s.Fields.OFFER_PIDS]:this.campaign.getOfferPids(),[s.Fields.PRODUCT_SKU_IDS]:this.campaign.getProductSkuIds()},{patch:!0}),t!==this.campaign.getStatus()&&this.header&&(this._destroyButtons(),this.header.destroy(),this.header=null,this.header=this._createHeader(),this.render(),this.idInput.setValue(this.campaign.getId()))}catch(e){console.error(e)}},_validateAllFields(){const e=[this.valueInput,this.numberOfUseInput,this.startDateInput,this.endDateInput,this.codeInput,this.nameInput,this.descriptionInput,this.categoryInput];let t=!0;return e.forEach((e=>{!e.validate().isValid&&t&&(t=!1)})),this.footer.validate()||(t=!1,this._displayAlert(g.get("subscriptionPlanAlert"))),t},_displayAlert(e){new m({closable:!0,visible:!0,autoHide:!0}).inject(this.container,"top").add({className:"error",message:e})},_createButtonsContainer(){this.buttons=[];const e=this.campaign.getStatus();if(this.me.hasRole(i.Roles.OFFER_ADMIN))if(this.campaign.isNew()||e===s.States.DRAFT||e===s.States.REJECTED){const e=this._createButton(g.get("submitForApproval"),"primary mpf-coupon-button mpf-submit-for-approval",s.States.SUBMITTED),t=this._createButton(g.get("save"),"primary mpf-coupon-button mpf-save",s.States.DRAFT);this.buttons.push(e,t)}else if(e===s.States.APPROVED){const e=this._createButton(g.get("activate"),"primary mpf-coupon-button mpf-activate",s.States.ACTIVE),t=this._createButton(g.get("save"),"primary mpf-coupon-button mpf-save",s.States.DRAFT);this.buttons.push(e,t)}else if(e===s.States.INACTIVE){const e=this._createButton(g.get("activate"),"primary mpf-coupon-button mpf-activate",s.States.ACTIVE),t=this._createButton(g.get("save"),"primary mpf-coupon-button mpf-save",s.States.INACTIVE);this.buttons.push(e,t)}else if(e===s.States.ACTIVE){const e=this._createButton(g.get("deactivate"),"primary mpf-coupon-button mpf-deactivate",s.States.TERMINATED),t=this._createButton(g.get("save"),"primary mpf-coupon-button mpf-save",s.States.ACTIVE);this.buttons.push(e,t)}if(this.me.hasRole(i.Roles.PRICER)&&e===s.States.SUBMITTED){const e=this._createButton(g.get("approve"),"primary mpf-coupon-button mpf-approve",s.States.APPROVED),t=this._createButton(g.get("reject"),"primary mpf-coupon-button mpf-reject",s.States.REJECTED),i=this._createButton(g.get("save"),"primary mpf-coupon-button mpf-save",this.campaign.getStatus());this.buttons.push(e,t,i)}const r=this._createCancelButton(g.get("cancel"),"primary mpf-coupon-button mpf-cancel");return this.buttons.push(r),t.createElement("div",{class:"mpf-buttons",html:this.buttons})},_creatStateTileContainer:()=>t.createElement("div",{class:"mpf-sate-tile"}),_createHeader(){if(this.buttonsContainer=this._createButtonsContainer(),this.campaign.getStatus()){const e=new c({model:this.campaign,state:this.campaign.getStatus()});this.stateTileContainer.addContent({html:[e.render()]})}return t.createElement("div",{class:"mpf-coupon-creation-page-header",html:[this.stateTileContainer,this.buttonsContainer]})},_createValueEntry(){this.valueInput=this._createNumberField(s.Fields.PERCENTAGE,g.get("value"),g.get("enterText"),100,!0,this._isFieldReadOnly(s.Fields.PERCENTAGE)),this.listenTo(this.valueInput,a.Events.UPDATE,this._valueChanged.bind(this));return this._createEntry(this.valueInput,"mpf-coupon-number mpf-coupon-value")},_valueChanged(){this.footer.setDiscount(this.valueInput.getValue())},_createNumberOfUseEntry(){this.campaign.isQuantityChangeAllowed();this.numberOfUseInput=this._createNumberField(s.Fields.QUANTITY,g.get("numberOfUse"),g.get("enterText"),1e4,!0,
/*!isEditable ||*/this._isFieldReadOnly(s.Fields.QUANTITY));const e=this.numberOfUseInput.render();return t.createElement("div",{class:"mpf-coupon-text mpf-coupon-number-of-use",html:[t.createElement("label",{html:[t.createElement("span",{class:"mpf-label",html:[e]})]})]})},_infiniteBtnClicked(e,t){if(e.isActive()){e.setActive(!1),t.setDisabled(!1);const i=t.getValue()||0;t.setValue(i),this.campaign.set(s.Fields.QUANTITY,parseInt(i))}else this.campaign.set(s.Fields.QUANTITY,-1),e.setActive(!0),t.setDisabled(!0)},_createStartDateEntry(){return this.startDateInput=this._createDatePicker(s.Fields.START_DATE,g.get("startDate"),g.get("enterDate"),!0,this._isFieldReadOnly()),this.listenTo(this.startDateInput,n.Events.UPDATE,this._updateMinMaxDate.bind(this,"startDateUpdated")),this._createEntry(this.startDateInput,"mpf-coupon-date mpf-coupon-start-date")},_createEndDateEntry(){return this.endDateInput=this._createDatePicker(s.Fields.END_DATE,g.get("endDate"),g.get("enterDate"),!0,this._isFieldReadOnly(s.Fields.END_DATE)),this.listenTo(this.endDateInput,n.Events.UPDATE,this._updateMinMaxDate.bind(this,"endDateUpdated")),this._createEntry(this.endDateInput,"mpf-coupon-date mpf-coupon-end-date")},_createIdEntry(){return this.idInput=this._createTextField(s.Fields.ID,g.get("id"),"",!1,!0),this._createEntry(this.idInput,"mpf-coupon-text mpf-coupon-code")},_createCodeEntry(){return this.codeInput=new r({model:this.campaign,fieldName:s.Fields.COMMERCIAL_NAME,fieldLabel:g.get("code"),placeholder:g.get("enterText"),dynamicValidation:!0,silent:!1,required:!0,readOnly:this._isFieldReadOnly()}),this.listenTo(this.codeInput,r.Events.UPDATE,(()=>{const e=this.codeInput.getValue().toUpperCase().replace(/[^A-Z0-9]+/g,"");this.codeInput.getValue()!==e&&this.codeInput.setValue(e)})),this._createEntry(this.codeInput,"mpf-coupon-text mpf-coupon-code")},_createNameEntry(){return this.nameInput=this._createTextField(s.Fields.INTERNAL_NAME,g.get("name"),g.get("enterText"),!0,this._isFieldReadOnly()),this._createEntry(this.nameInput,"mpf-coupon-text mpf-coupon-name")},_createDescriptionEntry(){return this.descriptionInput=this._createTextField(s.Fields.COMMENT,g.get("description"),g.get("enterTextEligibility"),!0,this._isFieldReadOnly()),this._createEntry(this.descriptionInput,"mpf-coupon-text mpf-coupon-description")},_createCategoryEntry(){return this.categoryInput=this._createSelectField(s.Fields.CATEGORY,g.get("category"),g.get("selectCategory"),[{value:s.Categories.SPECIAL_EVENT,label:g.get("specialEvent")},{value:s.Categories.INFLUENCER,label:g.get("influencer")},{value:s.Categories.SINGLE_USE,label:g.get("singleUse")},{value:s.Categories.PARTNER,label:g.get("partner")},{value:s.Categories.OTHER,label:g.get("other")}],!0,this._isFieldReadOnly()),this._createEntry(this.categoryInput,"mpf-coupon-select mpf-category")},_createLeftForm(){return t.createElement("div",{class:"mpf-coupon-creation-page-left-form",html:[this.valueEntry,this.numberOfUseEntry,this.startDateEntry,this.endDateEntry]})},_createRightForm(){return t.createElement("div",{class:"mpf-coupon-creation-page-right-form",html:[this.idEntry,this.codeEntry,this.nameEntry,this.descriptionEntry,this.categoryEntry]})},_createForm(){return t.createElement("div",{class:"mpf-coupon-creation-page-form",html:[this.leftForm,this.rightForm]})},_createRequired:()=>t.createElement("em",{class:"mpf-required",text:"*"}),_createTrigramEntry(){const e=this._createRequired(),s=new h({className:"mpf-trigram-input-text",placeholder:g.get("enterTrigram"),disabled:this._isFieldReadOnly()}),i=new l({value:g.get("add"),className:"primary mpf-add-button",icon:"plus",disabled:this._isFieldReadOnly(),events:{onClick:this._addTrigramLine.bind(this,s)}});return t.createElement("div",{class:"mpf-trigram-search",html:[t.createElement("div",{class:"mpf-label",html:[g.get("role"),"&nbsp;",e]}),s,i]})},async _addTrigramLine(e){const t=e.getValue();if(t){this.portfolioPackCollectionTrigram.productTrigram=t;const e=await this.portfolioPackCollectionTrigram.fetchPromise({country:"FRA"});this.footer.addCouponTableTrigramLine(e),this.footer.render()}},_getLicensingScheme(e){let t=e.getLicensingScheme();return"QRC"===t&&(t="QSC"),t},_createUniqueOffers(){let e=[];return this.offers.forEach((t=>{const s=t.getName().substring(0,t.getName().length-4),i=e.findIndex((e=>e.name===s)),r=this._getLicensingScheme(t);if(-1===i){const i={name:s,groupId:t.getGroupId(),customerProfile:t.getCustomerProfile(),pricelist:{[r]:[]}};e.push(i)}else e[i].pricelist[r]=[]})),e},_createOfferEntry(){const e=this._createAutocompleteInput(g.get("offer"),g.get("offer"),this.uniqueOffers,!0,this._isFieldReadOnly()),s=new l({value:g.get("add"),className:"primary mpf-add-button",icon:"plus",disabled:this._isFieldReadOnly(),events:{onClick:this._addOfferLine.bind(this,e)}});return t.createElement("div",{class:"mpf-offer-search",html:[e.render(),s]})},async _addOfferLine(e){let t,s;if(e.offer&&(t=e.offer.name,s=e.offer.groupId),t||s||(t=e.getValue(),s=this._getOfferGroupId(t)),t){this.portfolioPackCollectionOffer=this.portfolioFactoryCnB.createPackCollection(f.Types.BY_NAME),this.portfolioPackCollectionOffer.searchName=t;const i=(await this.portfolioPackCollectionOffer.fetchPromise({country:"FRA"})).getOfferByGroupId(s);this._addPriceDisplayNameAndId(i,s),this.footer.addCouponTableOfferLine(this._getUniqueOfferByGroupId(s),"EUR",e.subscription),this.footer.render()}},_addPriceDisplayNameAndId(e,t){const s=this.uniqueOffers.findIndex((e=>e.groupId===t)),i=this.uniqueOffers[s];i.displayName=e.getDisplayName();const r=e.getOffers();Object.values(p.SubscriptionEnum).forEach((e=>{"QSC"===e&&(e="QRC");const t=r.getPortfolioWithLicensingScheme(e);if(t){const e=this._getLicensingScheme(t),s=t.getPriceList()[0];s.id=t.id,i.pricelist[e].push(s);const r=t.getPricelistCurrency(),a=i.pricelist[e].findIndex((e=>e.currency===r));i.pricelist[e][a].fullPrice=t.getFullPrice()}}))},_getUniqueOfferByGroupId(e){const t=this.uniqueOffers.findIndex((t=>t.groupId===e));return this.uniqueOffers[t]},_createSearchContainer(){return t.createElement("div",{class:"mpf-coupon-creation-page-search",html:[this.trigramEntry,this.offerEntry]})},_createFooter(){const e=new d({me:this.me,campaign:this.campaign,changeRequests:this.changeRequests,discount:this.valueInput.getValue(),country:"FRA",pricelist:this.countryByPriceList.FRA,isActiveOrInactive:this.isActiveOrInactive,uniqueOffers:this.uniqueOffers,offer:this.offer,portfolioPackCollectionOffer:this.portfolioPackCollectionOffer,skuIdCollection:this.skuIdCollection,portfolioFactoryCnB:this.portfolioFactoryCnB,changeRequestFactory:this.changeRequestFactory});return this.listenTo(e,d.Events.EDIT_COUPON,this._addOfferLine.bind(this)),e},_getOfferGroupId(e){return this.uniqueOffers.find((t=>t.name===e)).groupId}});return E.Events=C,E})),define("DS/MPFMarketplaceAdmin/sellerRoles/SellerRolesPageFactory",["DS/MPFConnector/MarketplaceAdminConnector","DS/MPFServices/MarketplaceServices","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCartModel/CartFactory","DS/MPFMarketplaceAdmin/sellerRoles/SellerRolesPage"],((e,t,s,i,r)=>{"use strict";return Object.freeze({async create({connector:e}){const t=s.getInstance(e),i=await t.getFactory(s.Types.PERSON_ROLES);return new r({personRolesFactory:i})}})})),define("DS/MPFMarketplaceAdmin/offerManagement/OfferManagementPage",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFOfferModel/OfferCollectionFilterModel","DS/MPFMarketplaceAdmin/offerManagement/OfferCreationPage","DS/MPFOfferModel/OfferCreationFactory","DS/MPFMarketplaceAdmin/offerManagement/OfferListViewPage","DS/MPFPortfolioModel/PortfolioFactory","DS/UIKIT/Mask","DS/MPFOfferModel/OfferCreationModel"],(function(e,t,s,i,r,a,n,o,l){"use strict";const c=Object.freeze({OFFER_LIST_VIEW:"offerListView",NEW_REQUEST_OFFER:"newRequestOffer",OFFER_UPDATE:"offerUpdate"}),h=e.extend({className:"mpf-offer-management-page",setup(e={}){t.requiredOfPrototype(e.offerFilters,s,"options.offerFilters must be a OfferCollectionFilterModel"),t.requiredOfPrototype(e.offerCreationFactory,r,"options.offerCreationFactory must be a OfferCreationFactory"),this.me=e.me,this.offers=e.offers,this.offerFilters=e.offerFilters,this.activeOffers=e.activeOffers,this.renewWithOffers=e.renewWithOffers,this.offerCreationFactory=e.offerCreationFactory,this.portfolioFactory=e.portfolioFactory,this.offerFactory=e.offerFactory,this.state=c.OFFER_LIST_VIEW,this.offerListViewPage=null,this.offerCreationPage=null},render(){let e=[];return this.state===c.OFFER_LIST_VIEW?(this.offerListViewPage=this._createOfferListView(),e=[this.offerListViewPage.render()]):this.state!==c.NEW_REQUEST_OFFER&&this.state!==c.OFFER_UPDATE||(e=[this.offerCreationPage.render()]),this.container.setContent(e),this},destroy(){this.stopListening(),this.offerListViewPage&&this.offerListViewPage.destroy(),this.offerCreationPage&&this.offerCreationPage.destroy(),this.offerListViewPage=null,this.offerCreationPage=null,this.offers=null,this.offerFilters=null,this.offerCreationFactory=null,this._parent(),this.container=null},_createOfferListView(){const e=new a({me:this.me,offerFilters:this.offerFilters,offers:this.offers,renewWithOffers:this.renewWithOffers});return this.listenTo(e,a.Events.NEW_REQUEST_OFFER,this._requestOfferButtonClicked.bind(this)),this.listenTo(e,a.Events.EDIT_OFFER,this._cardClicked.bind(this)),e},async _requestOfferButtonClicked(){this.state=c.NEW_REQUEST_OFFER,this.offerListViewPage&&(this.stopListening(this.offerListView),this.offerListViewPage.destroy(),this.offerListViewPage=null),o.mask(this.container),await this._createNewOfferRequest(),o.unmask(this.container),this.render()},async _cardClicked(e){await this._loadOffer(e.get("groupId")),await this._editOffer(),this.render()},async _loadOffer(e){try{return this.offer=this.offerCreationFactory.createModel(r.Types.OFFER,{id:e},{trackNestedAttibutes:!0}),await this.offer.fetchPromise()}catch(e){console.log(e)}},async _editOffer(){this.state=c.OFFER_UPDATE,this.offerCreationPage&&(this.stopListening(this.offerCreationPage),this.offerCreationPage.destroy(),this.offerCreationPage=null),o.mask(this.container),this.offerCreationPage=await this._createOfferCreationPage(this.offer),o.unmask(this.container),this.listenTo(this.offerCreationPage,i.Events.CANCEL,this._cancelButtonClicked.bind(this))},async _createOfferCreationPage(e){const t=this.portfolioFactory.createPackCollection(n.Types.BY_TRIGRAM_V2,this.offerCreationModel);return await this.activeOffers.fetchPromise({status:l.States.ACTIVE}),new i({me:this.me,offerCreationModel:e,portfolioPackCollection:t,activeOffers:this.activeOffers})},async _createNewOfferRequest(){const e=this.offerCreationFactory.createModel(r.Types.OFFER,null,{trackNestedAttibutes:!0});this.offerCreationPage=await this._createOfferCreationPage(e),this.listenTo(this.offerCreationPage,i.Events.CANCEL,this._cancelButtonClicked.bind(this))},_cancelButtonClicked(){this.state=c.OFFER_LIST_VIEW,this.offerCreationPage&&(this.stopListening(this.offerCreationPage),this.offerCreationPage.destroy(),this.offerCreationPage=null),this.render()}});return h.States=c,h})),define("DS/MPFMarketplaceAdmin/couponManagement/CouponManagementPage",["UWA/Class/View","DS/MPFMarketplaceAdmin/couponManagement/CouponListViewPage","DS/MPFMarketplaceAdmin/couponManagement/CouponCreationPage","DS/MPFCouponModel/CouponCreationFactory","DS/MPFPortfolioModel/PortfolioFactory","DS/MPFOfferModel/OfferModel"],(function(e,t,s,i,r,a){"use strict";const n=Object.freeze({COUPON_LIST_VIEW:"couponListView",NEW_REQUEST_COUPON:"newRequestCoupon",COUPON_UPDATE:"couponUpdate"}),o=e.extend({className:"mpf-coupon-management-page",setup(e){this.me=e.me,this.coupons=e.coupons,this.couponFilters=e.couponFilters,this.portfolioFactory=e.portfolioFactory,this.portfolioFactoryCnB=e.portfolioFactoryCnB,this.couponCreationFactory=e.couponCreationFactory,this.couponCreation=e.couponCreation,this.offers=e.offers,this.offer=e.offer,this.changeRequestFactory=e.changeRequestFactory,this.products=e.products,this.state=n.COUPON_LIST_VIEW,this.couponListViewPage=null,this.couponCreationPage=null},render(){let e=[];return this.state===n.COUPON_LIST_VIEW?(this.couponListViewPage=this._createCouponListView(),e=[this.couponListViewPage.render()]):this.state!==n.NEW_REQUEST_COUPON&&this.state!==n.COUPON_UPDATE||(e=[this.couponCreationPage.render()]),this.container.setContent(e),this},destroy(){this.stopListening(),this.couponListViewPage&&this.couponListViewPage.destroy(),this.couponCreationPage&&this.couponCreationPage.destroy(),this.couponListViewPage=null,this.couponCreationPage=null,this.coupons=null,this.couponFilters=null,this.couponCreationFactory=null,this._parent(),this.container=null},_createCouponListView(){const e=new t({me:this.me,couponFilters:this.couponFilters,coupons:this.coupons,changeRequestFactory:this.changeRequestFactory});return this.listenTo(e,t.Events.NEW_REQUEST_COUPON,this._requestCouponButtonClicked.bind(this)),this.listenTo(e,t.Events.EDIT_COUPON,this._cardClicked.bind(this)),e},async _cardClicked(e){await this._loadCoupon(e.getId()),await this._editCoupon(),this.render()},async _loadCoupon(e){try{return this.coupon=this.couponCreationFactory.createPackModel(i.Types.COUPON_CREATION,{id:e},{changeRequestFactory:this.changeRequestFactory}),await this.coupon.fetchPromise()}catch(e){console.log(e)}},async _editCoupon(){this.state=n.COUPON_UPDATE,this.couponCreationPage&&(this.stopListening(this.couponCreationPage),this.couponCreationPage.destroy(),this.couponCreationPage=null),this.couponCreationPage=await this._createCouponCreationPage(this.coupon),this.listenTo(this.couponCreationPage,s.Events.CANCEL,this._cancelButtonClicked.bind(this))},async _requestCouponButtonClicked(){this.state=n.NEW_REQUEST_COUPON,this.couponListViewPage&&(this.stopListening(this.couponListViewPage),this.couponListViewPage.destroy(),this.couponListViewPage=null),await this._createNewCouponRequest(),this.render()},async _createNewCouponRequest(){const e=this.couponCreationFactory.createPackModel(i.Types.COUPON_CREATION,null,{changeRequestFactory:this.changeRequestFactory});this.couponCreationPage=await this._createCouponCreationPage(e),this.listenTo(this.couponCreationPage,s.Events.CANCEL,this._cancelButtonClicked.bind(this))},_cancelButtonClicked(){this.state=n.COUPON_LIST_VIEW,this.couponCreationPage&&(this.stopListening(this.couponCreationPage),this.couponCreationPage.destroy(),this.couponCreationPage=null),this.render()},async _createCouponCreationPage(e){const t=this.portfolioFactory.createPackCollection(r.Types.BY_TRIGRAM_V2),i=this.portfolioFactoryCnB.createPackCollection(r.Types.BY_NAME),n=this.portfolioFactoryCnB.createCollection(r.Types.BY_SKUID),o=await this.offers.fetchPromise({state:a.States.ACTIVE});return new s({me:this.me,couponCreationModel:e,portfolioPackCollectionTrigram:t,portfolioPackCollectionOffer:i,offers:o,offer:this.offer,portfolioFactoryCnB:this.portfolioFactoryCnB,skuIdCollection:n,changeRequestFactory:this.changeRequestFactory})}});return o.States=n,o})),define("DS/MPFMarketplaceAdmin/offerManagement/OfferManagementPageFactory",["DS/MPFModelFactory/MPFFactoriesV2","DS/MPFDataProxy/NoDataProxy","DS/MPFOfferModel/OfferCreationFactory","DS/MPFOfferModel/OfferFactory","DS/MPFOfferModel/OfferCollectionFilterModel","DS/MPFModel/CollectionFetchOptions","DS/MPFConnector/MarketplaceAdminConnector","DS/MPFServices/MarketplaceServices","DS/MPFMarketplaceAdmin/offerManagement/OfferManagementPage","DS/MPFOfferModel/OfferCreationModel"],((e,t,s,i,r,a,n,o,l,c)=>{"use strict";return Object.freeze({async create({factories:i,me:h,page:d=1,pageSize:u=10}={}){const p=n.fromMpDataMgtUrl(window.location.href,{service:o.ADMINISTRATION}),m=e.getInstance(p),[f,g,C]=await m.getFactories([e.Types.PORTFOLIO,e.Types.OFFER_CREATION,e.Types.OFFER]),[E,P,_]=await Promise.all([g.createCollection(s.Types.OFFER),g.createCollection(s.Types.OFFER).fetchPromise({status:c.States.ACTIVE}),g.createCollection(s.Types.OFFER)]),y=new r({[a.SIZE]:u,[a.START]:d},{dataProxy:t.getInstance()});return new l({me:h,offers:E,offerFilters:y,renewWithOffers:P,activeOffers:_,offerCreationFactory:g,portfolioFactory:f,offerFactory:C})}})})),define("DS/MPFMarketplaceAdmin/couponManagement/CouponManagementPageFactory",["DS/MPFModelFactory/MPFFactoriesV2","DS/MPFDataProxy/NoDataProxy","DS/MPFCouponModel/CouponCreationFactory","DS/MPFModel/CollectionFetchOptions","DS/MPFConnector/MarketplaceAdminConnector","DS/MPFServices/MarketplaceServices","DS/MPFCouponModel/CouponCollectionFilterModel","DS/MPFMarketplaceAdmin/couponManagement/CouponManagementPage","DS/MPFOfferModel/OfferFactory"],((e,t,s,i,r,a,n,o,l)=>{"use strict";return Object.freeze({async create({me:c,page:h=1,pageSize:d=10}={}){const u=r.fromMpDataMgtUrl(window.location.href,{service:a.ADMINISTRATION}),p=e.getInstance(u),m=r.fromMpDataMgtUrl(window.location.href,{service:a.CLICK_AND_BUY}),f=e.getInstance(m),[g,C,E,P]=await p.getFactories([e.Types.PORTFOLIO,e.Types.COUPON_CREATION,e.Types.OFFER,e.Types.CHANGE_REQUEST]),[_]=await f.getFactories([e.Types.PORTFOLIO]),[y,S,M,F]=await Promise.all([C.createPackCollection(s.Types.COUPON_CREATION),C.createCollection(s.Types.COUPON_CREATION),E.createCollection(l.Types.SOFTWARE_OFFER),E.createModel(l.Types.SOFTWARE_OFFER)]),b=new n({[i.SIZE]:d,[i.START]:h},{dataProxy:t.getInstance()});return new o({me:c,coupons:y,couponFilters:b,portfolioFactory:g,portfolioFactoryCnB:_,couponCreationFactory:C,couponCreation:S,offers:M,offer:F,changeRequestFactory:P})}})})),define("DS/MPFMarketplaceAdmin/platformCreation/PlatformOrderCardHeader",["UWA/Class/View","DS/MPFCartModel/CartModel","DS/MPFMarketplaceAdmin/orderCancellation/CartStateTile","i18n!DS/MPFMarketplaceAdmin/assets/nls/PlatformCreation","css!DS/MPFMarketplaceAdmin/MPFMarketplaceAdmin.css"],((e,t,s,i)=>{"use strict";return e.extend({className:"mpf-platform-order-card-header",setup(e){this.order=e.order,this.infoTile=this._createInfoTile(),this.stateTile=this._createStateTile()},render(){return this.container.setContent([{tag:"div",class:"mpf-header-tile mpf-order-name",text:this.order.getName()},this.infoTile,this.stateTile.render()]),this},destroy(){this._parent()},_createTile(e){if(e.find((e=>!!e)))return{tag:"div",class:"mpf-header-tile",html:e}},_createLine(e,t){if(t)return{tag:"div",class:"mpf-header-line",html:[{tag:"span",class:"mpf-label",text:e},{tag:"span",class:"mpf-value",text:t}]}},_createInfoTile(){const e=this.order.getItems().find((e=>e.getOnlineInstance())),t=e&&e.getOnlineInstance();return this._createTile([this._createLine(i.get("platformId"),t),this._createLine(i.get("platformAdmin"),this.order.getPlatformAdmin())])},_createStateTile(){return new s({cart:this.order})}})})),define("DS/MPFMarketplaceAdmin/platformCreation/PlatformOrderCard",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFMarketplaceAdmin/platformCreation/PlatformOrderCardHeader","DS/MPFMarketplaceAdmin/platformCreation/ProductListCard","i18n!DS/MPFMarketplaceAdmin/assets/nls/PlatformCreation"],((e,t,s,i,r,a,n,o)=>{"use strict";const l=Object.freeze({ADD_ROLES:"addRoles"}),c=t.extend({className:"mpf-platform-order-card",setup({order:e}={}){i.requiredOfPrototype(e,r,"options.order must a CartModel"),this.order=e,this.header=this._createHeader(),this.productList=this._createProductList(),this.footer=this._createFooter()},render(){return this.container.setContent([this.header.render(),e.createElement("div",{class:"mpf-card-body",html:this.productList.render()}),this.footer]),this},destroy(){this._parent()},_createHeader(){return new a({order:this.order})},_createProductList(){return new n({cart:this.order})},_createFooter(){const t=this.order.getNetAmountTotal(),i=this.order.getState()===r.States.DELIVERED;return e.createElement("div",{class:"mpf-card-footer",html:[{tag:"div",class:"mpf-total-price-container",html:[{tag:"span",class:"mpf-total-price-label",text:o.get("totalPriceExclTax")},{tag:"span",class:"mpf-total-price",text:t&&t.toLocaleString(this.locale,{style:"currency",currency:this.order.getCurrency()})}]},i&&new s({value:o.get("addRoles"),icon:"plus",events:{onClick:this.dispatchEvent.bind(this,l.ADD_ROLES)}})]})}});return c.Events=l,c})),define("DS/MPFMarketplaceAdmin/platformCreation/PlatformCreationPage",["UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFProductModel/TenantProductListModel","DS/MPFProductModel/TenantProductListFactory","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/MPFBusinessExperienceDevPlatform/BusinessExperienceDevPlatformFactory","DS/MPFMarketplaceAdmin/platformCreation/PlatformOrderCard","DS/MPFMarketplaceAdmin/platformCreation/PlatformCreationForm","DS/MPFPaginationComponent/PaginationComponent","DS/MPFMarketplaceAdmin/platformCreation/AddRolesModal","i18n!DS/MPFMarketplaceAdmin/assets/nls/PlatformCreation","css!DS/MPFMarketplaceAdmin/MPFMarketplaceAdmin.css"],((e,t,s,i,r,a,n,o,l,c,h,d,u,p)=>{"use strict";const m=Object.freeze({LIST:"list",CREATE:"create"}),f=e.extend({className:"mpf-platform-creation-page",setup({orders:e,beDevPlatformFactory:t,tenantProductListFactory:s}){r.requiredOfPrototype(s,n,"options.tenantProductListFactory must be a TenantProductListFactory"),this.beDevPlatformFactory=t,this.orders=e,this.tenantProductListFactory=s,this.stateMachine=this._createStatMachine(),this.alert=this._createAlert(),this.platformCreationButton=this._createPlatformCreationButton(),this.addRolesModal=this._createAddRolesModal(),this.pagination=this._createPagination(),this.platformCreationForm=null,this.fetchOptions={start:1,size:5},this.listenTo(this.pagination,d.Events.CHANGE_PAGE,this._onChangePage.bind(this))},render(){let e;return this.stateMachine.getState()===m.CREATE?e=[this.alert,this.platformCreationForm.render()]:(this._destroyCards(),this.orderCards=this._createOrderCards(),e=[this.addRolesModal.render(),this.alert,this.platformCreationButton,...this.orderCards.map((e=>e.render())),this.pagination.render()]),this.container.setContent(e),this},destroy(){this.stopListening(),this._destroyCards(),this.pagination.destroy(),this.pagination=null,this.orderCards=null,this.stateMachine=null,this.orders=null,this._parent()},_destroyCards(){this.orderCards&&this.orderCards.forEach((e=>{this.stopListening(e),e.destroy()}))},_createAlert:()=>new i({visible:!1,autoHide:!0,hideDelay:5e3}),_createPlatformCreationButton(){return new t({value:p.get("createPlatform"),className:"primary",icon:"plus",events:{onClick:this._onAddPlatformButtonClicked.bind(this)}})},_createOrderCards(){return this.orders.map((e=>{const t=new c({order:e});return this.listenTo(t,c.Events.ADD_ROLES,this._onAddRolesClicked.bind(this,{order:e})),t}))},_createPagination(){return new d({collection:this.orders,pageSize:5})},async _onChangePage(e={}){const t=e.page||1;this.fetchOptions.start=1+5*(t-1),s.mask(this.container),await this.orders.fetchPromise(Object.assign({},this.fetchOptions)),s.unmask(this.container),this.render()},_onAddPlatformButtonClicked(){this.stateMachine.changeState(m.CREATE),this.platformCreationForm&&(this.stopListening(this.platformCreationForm),this.platformCreationForm.destroy(),this.platformCreationForm=null),this._onCreateView()},async _onAddRolesClicked({order:e}){const t=this.tenantProductListFactory.createModel(n.Types.INTERNAL_PLATFORM,{[a.Fields.TENANT]:e.getOnlineInstance()});s.mask(this.container);try{await t.fetchPromise(),s.unmask(this.container),this.addRolesModal.show({tenantProductList:t,order:e})}catch(e){s.unmask(this.container),console.error(e),this.alert.add({className:"error",message:p.get("unableToFetchAvailableRoles")})}},_onCreateView(){const e=this.beDevPlatformFactory.createModel(l.Types.BUSINESS_EXP_DEV_PLATFORM);this.platformCreationForm=new h({beDevPlatform:e}),this.listenTo(this.platformCreationForm,h.Events.BACK,this._backToListView.bind(this)),this.render()},async _backToListView(){this.stateMachine.changeState(m.LIST),s.mask(this.container),await this.orders.fetchPromise(Object.assign({},this.fetchOptions)),this.pagination.onCollectionUpdate(),s.unmask(this.container),this.render()},_createAddRolesModal(){const e=new u({beDevPlatformFactory:this.beDevPlatformFactory});return this.listenTo(e,u.Events.ON_SAVED,(async()=>{s.mask(this.container),await this.orders.fetchPromise({start:1,size:this.fetchOptions.size}),await this.orders.fetchPromise(Object.assign({},this.fetchOptions)),this.pagination.onCollectionUpdate(),s.unmask(this.container),this.render()})),e},_createStatMachine:()=>new o({state:m.LIST,states:[m.LIST,m.CREATE],transitions:[{from:m.CREATE,to:m.LIST},{from:m.LIST,to:m.CREATE}]})});return f.ORDERS_PER_PAGE=5,f})),define("DS/MPFMarketplaceAdmin/platformCreation/PlatformCreationPageFactory",["DS/MPFConnector/MarketplaceAdminConnector","DS/MPFServices/MarketplaceServices","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCartModel/CartFactory","DS/MPFMarketplaceAdmin/platformCreation/PlatformCreationPage"],((e,t,s,i,r)=>{"use strict";return Object.freeze({async create(){const a=e.fromMpDataMgtUrl(window.location.href,{service:t.INNOVATE}),n=s.getInstance(a),[o,l,c]=await n.getFactories([s.Types.BUSINESS_EXP_DEV_PLATFORM,s.Types.CART,s.Types.TENANT_PRODUCT_LIST]),h=l.createCollection(i.Types.CART_BUSINESS_EXP_DEV_PLATFORM);return await h.fetchPromise({start:1,size:r.ORDERS_PER_PAGE}),new r({beDevPlatformFactory:o,tenantProductListFactory:c,orders:h})}})})),define("DS/MPFMarketplaceAdmin/PageMenu",["UWA/Core","UWA/Class/View","DS/MPFMarketplaceAdmin/orderCancellation/OrderCancellationPageFactory","DS/MPFMarketplaceAdmin/platformCreation/PlatformCreationPageFactory","DS/MPFMarketplaceAdmin/offerManagement/OfferManagementPageFactory","DS/MPFMarketplaceAdmin/sellerRoles/SellerRolesPageFactory","DS/MPFMarketplaceAdmin/couponManagement/CouponManagementPageFactory","DS/MPFPersonModel/PersonModel","DS/UIKIT/Input/Button","DS/UIKIT/Spinner","DS/MPFConnector/MarketplaceAdminConnector","i18n!DS/MPFMarketplaceAdmin/assets/nls/MarketplaceAdmin"],((e,t,s,i,r,a,n,o,l,c,h,d)=>{"use strict";const u=Object.freeze({OrderCancellation:"orderCancellation",PlatformCreation:"platformCreation",OfferManagement:"offerManagement",SellerRoles:"sellerRoles",CouponManagement:"couponManagement"}),p={[u.OrderCancellation]:Object.freeze({id:`mpf-nav-${u.OrderCancellation}`,name:d.get(u.OrderCancellation),factory:s,authorizedRoles:[o.Roles.SALES_ADMIN,o.Roles.PRICER,o.Roles.ADMIN_VIEWER]}),[u.PlatformCreation]:Object.freeze({id:`mpf-nav-${u.PlatformCreation}`,name:d.get(u.PlatformCreation),factory:i,authorizedRoles:[o.Roles.DEV_PARTNERS_ADMIN]}),[u.SellerRoles]:Object.freeze({id:`mpf-nav-${u.SellerRoles}`,name:d.get(u.SellerRoles),factory:a,authorizedRoles:[o.Roles.OPERATOR]}),[u.OfferManagement]:Object.freeze({id:`mpf-nav-${u.OfferManagement}`,name:d.get(u.OfferManagement),factory:r,authorizedRoles:[o.Roles.SALES_ADMIN,o.Roles.PRICER,o.Roles.ADMIN_VIEWER,o.Roles.OFFER_ADMIN]}),[u.CouponManagement]:Object.freeze({id:`mpf-nav-${u.CouponManagement}`,name:d.get(u.CouponManagement),factory:n,authorizedRoles:[o.Roles.SALES_ADMIN,o.Roles.PRICER,o.Roles.OFFER_ADMIN,o.Roles.ADMIN_VIEWER]})};return t.extend({className:"mpf-page-menu",setup(e){this.connector=e.connector,this.factories=e.factories,this.me=e.me,this.authorizedPagesConfig=this._filterAuthorizedPage(),this.page=null,this.activePage=null,this.menu=this._createMenu(),this.spinnerContainer=this._createSpinnerContainer()},load(){return this.changePage(Object.keys(this.authorizedPagesConfig).shift())},render(){let e=[this.menu];return this.isLoading?e.push(this.spinnerContainer):this.page&&e.push(this.page.render()),this.container.setContent(e),this},destroy(){this._parent()},async changePage(e){if(!Object.values(u).includes(e))throw new Error(`Page does not exists : ${e}`);if(e!==this.activePage){this.isLoading=!0,this.render(),this.activePage=e,this._updateActiveItem();const t=this.authorizedPagesConfig[e].factory;this.page&&this.page.destroy(),this.page=await t.create({connector:this.connector,factories:this.factories,me:this.me}),this.isLoading=!1,this.render()}},_updateActiveItem(){Object.entries(this.authorizedPagesConfig).forEach((([e,t])=>{const s=this.menu.getElement(`#${t.id}`);e===this.activePage?s.addClassName("mpf-active"):s.removeClassName("mpf-active")}))},_setLoading(e=!0){this.isLoading=e,this.render()},_createSpinnerContainer:()=>({tag:"div",class:"mpf-spinner-container",html:(new c).show()}),_isPageAuthorized([e,t]){return!!t.authorizedRoles.find((e=>this.me.hasRole(e)))},_filterAuthorizedPage(){return Object.fromEntries(Object.entries(p).filter(this._isPageAuthorized,this))},_createMenu(){const t=Object.values(this.authorizedPagesConfig).map((e=>this._createMenuItem(e))),s=e.createElement("ul",{class:"mpf-menu",html:t}),i=new l({className:"primary",value:d.get("logout"),events:{onClick:this._logout.bind(this)}});return e.createElement("nav",{class:"mpf-nav",html:[s,i]})},_createMenuItem(t){return e.createElement("li",{id:t.id,class:"mpf-menu-item",text:t.name,events:{click:this._onMenuItemClicked.bind(this)}})},_onMenuItemClicked(e){const t=e.target.id,s=Object.keys(this.authorizedPagesConfig).find((e=>this.authorizedPagesConfig[e].id===t));s&&this.changePage(s)},async _logout(){const e=await h.get3DPassportUrl(this.connector.platformId),t=window.location.origin+window.location.pathname+window.location.hash;window.location.href=e.replace(":443","")+"/logout?service="+encodeURIComponent(t)}})})),define("DS/MPFMarketplaceAdmin/MarketplaceAdmin",["DS/UIKIT/Mask","DS/MPFConnector/MarketplaceAdminConnector","DS/MPFServices/MarketplaceServices","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFPersonModel/PersonFactory","DS/MPFPersonModel/PersonModel","DS/MPFMarketplaceAdmin/AccessForbiddenPage","DS/MPFMarketplaceAdmin/orderCancellation/OrderCancellationPageFactory","DS/MPFMarketplaceAdmin/PageMenu","css!DS/MPFMarketplaceAdmin/MPFMarketplaceAdmin"],((e,t,s,i,r,a,n,o,l)=>{"use strict";const c=[a.Roles.OPERATOR,a.Roles.SALES_ADMIN,a.Roles.PRICER,a.Roles.DEV_PARTNERS_ADMIN,a.Roles.ADMIN_VIEWER,a.Roles.OFFER_ADMIN];return{async run({container:a}={}){e.mask(a);try{const o=t.fromMpDataMgtUrl(window.location.href,{service:s.IFWELOOP}),h=i.getInstance(o),d=await h.getFactory(i.Types.PERSON),u=await d.createModel(r.Types.ME).fetchPromise();let p;!!c.find((e=>u.hasRole(e)))?(p=new l({connector:o,factories:h,me:u}),await p.load()):p=new n,e.unmask(a),p.render().inject(a)}catch(t){e.unmask(a),console.error(t)}}}}));