define("DS/ENODODisplay/views/DOParametersDialog",["DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/Controls/ModalContainer","DS/Controls/Button","i18n!DS/ENODODisplay/assets/nls/ENODisplayDO.json"],(function(e,t,i,o,n,s,a,r,l){"use strict";var d=function(e,t){if(null==t)throw new Error(l.error.invalidFrame);if(!(e&&e.length>0))throw new Error(l.error.emptyParameter);this._parameters=e,this._parentContainer=t,this._dialog=void 0,this._parametersTable=void 0,this._modal=void 0,this.createDialog()};return d.prototype.constructor=d,d.prototype.getDialog=function(){return this._dialog},d.prototype.getParameters=function(){return this._parametersTable},d.prototype.createDialog=function(){this._immersiveFrame=new t({identifier:"PSEDerivedOutputs_ImmersiveFrame"}),this._immersiveFrame.getContent().addClassName("sidePanelDO_param_frame");var i=this.createParameters();this.okButton=new r({label:"OK",disabled:!1,allowUnsafeHTMLLabel:!1}),this.okButton.addEventListener("buttonclick",this.onClose.bind(this),!1);var o=this._parentContainer.getSize().width;o=o>50?o-30:o,this._dialog=new e({immersiveFrame:this._immersiveFrame,title:l.columns.parameter,content:i,activeFlag:!1,resizableFlag:!0,width:o,height:this._parentContainer.getSize().height/2,buttons:{Ok:this.okButton}}),this._dialog.addEventListener("close",this.onClose.bind(this),!1),this._modal=a.createModal(this._parentContainer,this._immersiveFrame.getContent())},d.prototype.onClose=function(){this._dialog.destroy(),this._dialog=null,delete this._immersiveFrame,this._immersiveFrame=null,a.removeModal(this._parentContainer)},d.prototype.createParameters=function(){var e=UWA.createElement("div",{class:"doparameterview_content"}),t=new i,a=[],r=0;for(r=0;r<this._parameters.length;r++){var d=this._parameters[r];if(!d.hasOwnProperty("name")||!d.hasOwnProperty("value"))throw new Error(l.error.invalidParameter);var u={name:d.hasOwnProperty("displayName")?d.displayName:d.name,value:d.hasOwnProperty("displayValue")?d.displayValue:d.value};a.push(u)}t.prepareUpdate(),a.forEach((function(e){var i=new o({label:e.Text,grid:e});t.addRoot(i)})),t.pushUpdate();var c=[{text:l.columns.parameterName,dataIndex:"name",editableFlag:!1},{text:l.columns.parameterValue,dataIndex:"value",editableFlag:!1}];return this._parametersTable=new n({treeDocument:t,columns:c,rowSelection:"none",cellSelection:"none",showSelectionCheckBoxesFlag:"false",layout:new s({cellHeight:26,columnHeaderHeight:38,rowsHeader:!1})}),this._parametersTable.inject(e),e},d})),define("DS/ENODODisplay/model/SelectedObjectInfo",["UWA/Core","UWA/Controls/Abstract","UWA/Class"],(function(e,t,i){"use strict";return i.extend({_cadOrigin:null,_kind:null,_owner:null,_phid:null,_title:null,_type:null,_extension:null,init:function(e){if(null===e)throw Error("object should have a physical Id");this._phid=e},getCAD:function(){return this._cadOrigin},getDOGenerationFilter:function(){var e={};return-1===["3DShape","Drawing","3DPart"].indexOf(this._kind)&&-1===["3DShape","Drawing","Document"].indexOf(this._type)||(this._extension?e.CADMaster=this._extension:e.CADMaster=this._cadOrigin,"Document"===this._type?e.Type=this._type:"VPMReference"===this.type||"3DShape"===this.type?e.type="Part":"Drawing"===this.type&&(e.type="Drawing")),e},getKind:function(){return this._kind},getOwner:function(){return this._owner},getPhid:function(){return this._phid},getTitle:function(){return this._title},getType:function(){return this._type},getExtension:function(){return this._extension},isRefreshViewAvailable:function(){var e=!1,t=this._type;return("3DShape"===t||"VPMReference"===t&&"3DPart"===this._kind||"Drawing"===t)&&(e=!0),e},setCAD:function(e){this._cadOrigin=e},setKind:function(e){this._kind=e},setOwner:function(e){this._owner=e},setTitle:function(e){this._title=e},setType:function(e){this._type=e},setExtension:function(e){this._extension=e}})})),define("DS/ENODODisplay/views/DOPreview",["DS/ENODOUtilsServices/DOServices","DS/3DPlayHelper/3DPlayHelper","DS/WebappsUtils/WebappsUtils","DS/Handlebars/Handlebars","text!DS/ENODODisplay/assets/templates/previewTopbar.html","i18n!DS/ENODODisplay/assets/nls/ENODisplayDO.json"],(function(e,t,i,o,n,s){"use strict";return{destroyPreviewComponents:function(e){e.previewContainer.destroy()},setupTopBar:function(e,t){var i={iconPDF:"doc-text",icon:"close",label:s.preview.close,title:t.Title?t.Title:t.Filename},a=o.compile(n);if(e.setHTML(a(i)),i){var r="wux-ui-3ds-"+i.icon,l=e.getElementsByClassName(r)[0];l.style.cursor="pointer",l&&l.addEventListener("click",this.destroyPreviewComponents.bind(null,this))}},buildPlayer:function(e,t){var o=i.getProxifiedWebappsBaseUrl();o||(o=i.getWebappsBaseUrl());var n=this;n._3dPlayID="DerivedOutput-iframe",n.previewContainer=UWA.createElement("div",{id:"DerivedOutput-Preview-3DPlay"}),n.previewContainer.inject(widget.body),n.setupTopBar(n.previewContainer,t);var s=document.getElementsByClassName("DOPreview-MainContent")?document.getElementsByClassName("DOPreview-MainContent")[0]:null,a=UWA.createElement("iframe").inject(s);a.classList.add("derived-output-iframe"),a.id=n._3dPlayID,a.allowFullScreen=a.mozAllowFullScreen=a.webkitAllowFullScreen=!0,a.setAttribute("allowFullScreen",""),a.src=o+"/3DPlayHelper/3DPlaySyndication.html?params="+encodeURIComponent(JSON.stringify(e))},openDOForPreview:function(t,i,o){var n={input:{asset:{contextId:widget.xPref_CREDENTIAL,type:"DerivedOutput",dtype:"DerivedOutput",physicalid:i.ObjectID,mimetype:"pdf",provider:"3DSPACE",doticketurl:t,serverurl:o._3dspaceUrlForContextualMenu,tenant:e.getPlatformId()}},options:{loading:"autoplay"}};this.buildPlayer(n,i)},buildContextualMenu:function(t,i){var o=this,n=[],a=i.nodeModel.options.grid;return widget&&"ENOWSES_AP"!=widget.data.appId&&["txt","jpg","bmp","jpeg","png","gif","svg","pdf"].includes(a.Format.toLowerCase())&&"visualization"!=a.OutputStreamId.toLowerCase()&&("OK"==a.Status||"UPDATE"==a.Status)&&1==a.Download?(localStorage.setItem("3DPlay.3DSpaceDerivedOutputSupport","true"),n=[{type:"PushItem",title:s.preview.openWith,icon:{iconName:"open-menu-dot wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS},submenu:[{type:"PushItem",title:"3DPlay",icon:{iconPath:t._iconUrlForContextualMenu},action:{callback:function(){e.getDownloadTicket(i.nodeModel.options.grid).then((function(e){o.openDOForPreview(e,a,t)})).catch((function(e){console.error("Error fetching download URL:",e)}))}}}]}]):n}}})),define("DS/ENODODisplay/views/DODeleteDialog",["DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/ModalContainer","DS/Controls/Button","i18n!DS/ENODODisplay/assets/nls/ENODisplayDO.json"],(function(e,t,i,o,n){"use strict";var s=function(e,t,i){if(null==t)throw new Error(n.error.invalidFrame);if(void 0===i.onYesCallback||void 0===i.onNoCallback)throw new Error(n.error.missingCallback);this._selectionInfo=e,this._parentContainer=t,this._dialog=void 0,this._modal=void 0,this._callbacks=i,this._selectionInfo=e,this.createDialog()};return s.prototype.constructor=s,s.prototype.getDialog=function(){return this._dialog},s.prototype.createDialog=function(){this._immersiveFrame=new t({identifier:"PSEDerivedOutputs_ImmersiveFrame"}),this._immersiveFrame.getContent().addClassName("sidePanelDO_delete_frame");var s=this.createContent();this.yesButton=new o({label:n.popup.yesButton,disabled:!1,allowUnsafeHTMLLabel:!1}),this.yesButton.addEventListener("buttonclick",this.onYesCallback.bind(this),!1),this.noButton=new o({label:n.popup.noButton,disabled:!1,allowUnsafeHTMLLabel:!1}),this.noButton.addEventListener("buttonclick",this.onNoCallback.bind(this),!1),this.cancelButton=new o({label:n.popup.cancelButton,disabled:!1,allowUnsafeHTMLLabel:!1}),this.cancelButton.addEventListener("buttonclick",this.onClose.bind(this),!1);var a=this._parentContainer.getSize().width;a=a>50?a-30:a,this._dialog=new e({immersiveFrame:this._immersiveFrame,title:n.columns.delete,content:s,activeFlag:!1,resizableFlag:!0,width:a,height:this._parentContainer.getSize().height/2,buttons:{Yes:this.yesButton,No:this.noButton,Cancel:this.cancelButton}}),this._dialog.addEventListener("close",this.onClose.bind(this),!1),this._modal=i.createModal(this._parentContainer,this._immersiveFrame.getContent())},s.prototype.onClose=function(){this._dialog.destroy(),this._dialog=null,delete this._immersiveFrame,this._immersiveFrame=null,i.removeModal(this._parentContainer)},s.prototype.onYesCallback=function(){this._dialog.destroy(),this._dialog=null,delete this._immersiveFrame,this._immersiveFrame=null,i.removeModal(this._parentContainer),this._callbacks.onYesCallback(this._selectionInfo)},s.prototype.onNoCallback=function(){this._dialog.destroy(),this._dialog=null,delete this._immersiveFrame,this._immersiveFrame=null,i.removeModal(this._parentContainer),this._callbacks.onNoCallback(this._selectionInfo)},s.prototype.createContent=function(){return UWA.createElement("div",{class:"doparameterview_content",html:n.popup.delete})},s})),define("DS/ENODODisplay/views/DODetailsDialog",["DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/Controls/ModalContainer","DS/Controls/Button","DS/Controls/Accordeon","i18n!DS/ENODODisplay/assets/nls/ENODisplayDO.json"],(function(e,t,i,o,n,s,a,r,l,d){"use strict";var u=function(e,t){if(null==t)throw new Error(d.error.invalidFrame);if(!(e&&Object.keys(e).length>0))throw new Error(d.error.emptyParameter);e.parameters&&e.parameters.length>0&&(this._parameters=e.parameters),this._representedDO=e,this._parentContainer=t,this._dialog=void 0,this._parametersTable=void 0,this._modal=void 0,this.createDialog()};return u.prototype.constructor=u,u.prototype.getDialog=function(){return this._dialog},u.prototype.createDialog=function(){var i=this._representedDO.isSnapshot;this._immersiveFrame=new t({identifier:"PSEDerivedOutputs_ImmersiveFrame"}),this._immersiveFrame.getContent().addClassName("sidePanelDO_param_frame");var o=this.createView();this.okButton=new r({label:d.buttons.close,disabled:!1,allowUnsafeHTMLLabel:!1}),this.okButton.addEventListener("buttonclick",this.onClose.bind(this),!1);var n=this._parentContainer.getSize().width;n=n>50?n-30:n,this._dialog=new e({immersiveFrame:this._immersiveFrame,title:i?d.labels.snapshotDetails:d.labels.doDetails,content:o,activeFlag:!1,resizableFlag:!0,height:-1,buttons:{Ok:this.okButton}}),this._dialog.addEventListener("close",this.onClose.bind(this),!1),this._modal=a.createModal(this._parentContainer,this._immersiveFrame.getContent())},u.prototype.onClose=function(){this._dialog.destroy(),this._dialog=null,delete this._immersiveFrame,this._immersiveFrame=null,a.removeModal(this._parentContainer)},u.prototype.createView=function(){var e=UWA.createElement("div",{class:"doinformationview_layout"}),t=[],i=new UWA.Element("div",{class:"dodetailsview_accordeoncontent",id:"doattributesview_content"}),o=[];if(void 0!==this._representedDO.format&&this._representedDO.format.length>0&&o.push({name:d.labels.format,value:this._representedDO.format}),void 0!==this._representedDO.outputStreamId&&this._representedDO.outputStreamId.length>0&&o.push({name:d.labels.alias,value:this._representedDO.outputStreamId}),this._representedDO.title&&this._representedDO.title.length>0?o.push({name:d.labels.title,value:this._representedDO.title}):void 0!==this._representedDO.name&&this._representedDO.name.length>0&&o.push({name:d.labels.title,value:this._representedDO.name}),void 0!==this._representedDO.isSync&&!0!==this._representedDO.isSnapshot){var n=this._representedDO.isSync;if(o.push({name:d.labels.uptodateDO,value:!0===n?d.labels.yes:d.labels.no}),!1===n&&void 0!==this._representedDO.jobs&&this._representedDO.jobs.length>0){var s=d.jobStatus?d.jobStatus[this._representedDO.status]:this._representedDO.status;o.push({name:d.labels.jobStatus,value:s})}}if(this._representedDO.converter&&o.push({name:d.labels.converter,value:this._representedDO.converter}),void 0!==this._representedDO.isExternal&&!0!==this._representedDO.isSnapshot&&o.push({name:d.labels.external,value:!0===this._representedDO.isExternal?d.labels.yes:d.labels.no}),void 0!==this._representedDO.isSnapshot&&1==this._representedDO.isSnapshot&&o.push({name:d.labels.snapshot,value:!0===this._representedDO.isSnapshot?d.labels.true:d.labels.false}),void 0!==this._representedDO.creationDate&&o.push({name:d.labels.creationDate,value:this._representedDO.creationDate}),this.generateParamTable(o).inject(i),t.push({header:this._representedDO.isSnapshot?d.labels.snapshotAttributes:d.labels.doattributes,content:i,expandedFlag:!0}),null!==this._parameters&&void 0!==this._parameters){var a=this.createParameters();t.push({header:d.labels.parameters,content:a,expandedFlag:!0})}new l({class:"dodetailsview_accordeonhandler",items:t,style:"simple",exclusive:!1}).inject(e);return e},u.prototype.generateParamTable=function(e){for(var t=new UWA.Element("table",{class:"doattributeview_table",styles:{width:"100%",height:"100%",cursor:"default"}}),i=new UWA.Element("tbody",{class:"doattributeview_tbody"}).inject(t),o=0;o<e.length;o++){var n=e[o].name,s=e[o].value,a=new UWA.Element("tr",{class:"doattributeview_tr"}).inject(i);new UWA.Element("td",{class:"doattributeview_td_parametername",text:n}).inject(a),new UWA.Element("td",{class:"doattributeview_td_parametervalue",text:s}).inject(a)}return t},u.prototype.createParameters=function(){var e=UWA.createElement("div",{class:"dodetailsview_accordeoncontent",id:"doparameterview_content"}),t=[],i=0;for(i=0;i<this._parameters.length;i++){var o=this._parameters[i];if(!o.hasOwnProperty("name")||!o.hasOwnProperty("value"))throw new Error(d.error.invalidParameter);if("streamId"!=o.name){var n=o.hasOwnProperty("displayName")?o.displayName:o.name,s=o.hasOwnProperty("displayValue")?o.displayValue:o.value;t.push({name:n,value:s})}}return this.generateParamTable(t).inject(e),e},u})),define("DS/ENODODisplay/views/DOBulkDownloadDialog",["DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/ModalContainer","DS/Controls/ComboBox","DS/Controls/Toggle","DS/Controls/Button","i18n!DS/ENODODisplay/assets/nls/ENODisplayDO.json","DS/Controls/LineEditor","DS/Notifications/NotificationsManagerUXMessages"],(function(e,t,i,o,n,s,a,r,l){"use strict";var d="",u=function(e,t,i,o){if(null==t)throw new Error(a.error.invalidFrame);if(null==o||"function"!=typeof o)throw new Error(a.error.missingCallback);this._callback=o,null!==e&&(e.hasOwnProperty("partFormats")&&e.partFormats.length>0||e.hasOwnProperty("drawingFormats")&&e.drawingFormats.length>0)&&(this._formatList=e,this._parentContainer=t,this._dialog=void 0,this._modal=void 0,this.slelectedItem=i,this._uiComponents={partFormatCombo:null,drawingFormatCombo:null,pointingDrawingCheckbox:null,titleInputBox:null,checkBox:null},this.createDialog())};return u.prototype.constructor=u,u.prototype.getDialog=function(){return this._dialog},u.prototype.createDialog=function(){this._immersiveFrame=new t({identifier:"PSEDerivedOutputs_ImmersiveFrame"}),this._immersiveFrame.getContent().addClassName("sidePanelDO_param_frame");var o=this.createView();this.cancelButton=new s({label:a.buttons.cancel,disabled:!1,allowUnsafeHTMLLabel:!1}),this.cancelButton.addEventListener("buttonclick",this.onClose.bind(this),!1),this.okButton=new s({label:a.buttons.bulkdownload.title,disabled:!0,allowUnsafeHTMLLabel:!1}),this.okButton.addEventListener("buttonclick",this.onDownload.bind(this),!1);var n=this._parentContainer.getSize().width;n=n>50?n-30:n;var r=a.labels.doDownload,l=this.slelectedItem;this._dialog=new e({immersiveFrame:this._immersiveFrame,title:r+" "+l,content:o,activeFlag:!1,resizableFlag:!0,height:-1,buttons:{Cancel:this.cancelButton,Ok:this.okButton}}),this._dialog.getContent().addClassName("dobulkDownlaod_wuxdailog"),this._dialog.addEventListener("close",this.onClose.bind(this),!1),this._modal=i.createModal(this._parentContainer,this._immersiveFrame.getContent())},u.prototype.onClose=function(){this._dialog.destroy(),this._dialog=null,delete this._immersiveFrame,this._immersiveFrame=null,i.removeModal(this._parentContainer)},u.prototype.onDownload=function(){var e={level:"info",message:a.buttons.bulkdownload.downloadNotfication};if(l.addNotif(e),null!=d)var t=this._uiComponents.titleInputBox.value.replaceAll(/[\\\/:*?\"<>|\s]/gm,"_");var i=null!=this._uiComponents.partFormatCombo.value?[this._uiComponents.partFormatCombo.value]:[],o=null!=this._uiComponents.drawingFormatCombo.value?[this._uiComponents.drawingFormatCombo.value]:[],n=!!this._uiComponents.checkBox&&this._uiComponents.checkBox.checkFlag,s=!!this._uiComponents.pointingDrawingCheckbox&&this._uiComponents.pointingDrawingCheckbox.checkFlag;localStorage.setItem("DO_BulkDownload_SyncOnly",n),this._callback(i,o,t,n,s),this.onClose()},u.prototype.onFormatClicked=function(e){var t=this.slelectedItem,i=null!=this._uiComponents.partFormatCombo.value?[this._uiComponents.partFormatCombo.value]:[],o=null!=this._uiComponents.drawingFormatCombo.value?[this._uiComponents.drawingFormatCombo.value]:[];o.length>0&&(this._uiComponents.pointingDrawingCheckbox.disabled=!1,this._uiComponents.pointingDrawingCheckbox.checkFlag=!0),this.okButton.disabled=!1,i.length>0&&o.length>0?d=t+"-"+i+"-"+o:i.length>0?d=t+"-"+i+"(3D)":o.length>0&&(d=t+"-"+o+"(2D)"),d=d.replaceAll(/[\\\/:*?\"<>|\s]/gm,"_"),this._uiComponents.titleInputBox.value=d},u.prototype.createView=function(){var e=UWA.createElement("div",{class:"doinformationview_layout"}),t=new UWA.Element("table",{class:"doattributeview_table",styles:{width:"100%",height:"100%",cursor:"default"}}).inject(e),i=new UWA.Element("tbody",{class:"doattributeview_tbody"}).inject(t),s=new UWA.Element("tr",{class:"doattributeview_tr"}).inject(i),l=(new UWA.Element("td",{class:"dobulkdownloadview_label",text:a.labels.threeDFormat}).inject(s),new UWA.Element("td",{class:"dobulkdownloadview_combo"}).inject(s)),d=new o({elementsList:this._formatList.partFormats,placeholder:a.labels.select3DFormat});d.inject(l),d.addEventListener("change",this.onFormatClicked.bind(this,d),!1),this._uiComponents.partFormatCombo=d,s=new UWA.Element("tr",{class:"doattributeview_tr"}).inject(i),new UWA.Element("td",{class:"dobulkdownloadview_label",text:a.labels.twoDFormat}).inject(s),l=new UWA.Element("td",{class:"dobulkdownloadview_combo"}).inject(s);var u=new o({elementsList:this._formatList.drawingFormats,placeholder:a.labels.select2DFormat});u.inject(l),u.addEventListener("change",this.onFormatClicked.bind(this,u),!1),this._uiComponents.drawingFormatCombo=u;s=new UWA.Element("tr",{class:"doattributeview_tr"}).inject(i),new UWA.Element("td",{class:"dobulkdownloadview_label"}).inject(s);var c=new UWA.Element("td",{class:"dobulkdownloadview_combo"}).inject(s),p=new n({type:"checkbox",label:a.labels.pointingDrawing,class:"pointingDrawingcheckBoxID"});this._uiComponents.pointingDrawingCheckbox=p,this._uiComponents.pointingDrawingCheckbox.disabled=!0,p.inject(c);var h=!1;localStorage.getItem("DO_BulkDownload_SyncOnly")&&(h="true"===localStorage.getItem("DO_BulkDownload_SyncOnly")||!0===localStorage.getItem("DO_BulkDownload_SyncOnly"));var m=new n({type:"checkbox",label:a.labels.restrictionbulkdownload,checkFlag:h});m.elements.checkSign.addClassName("download-uptodate-check"),m.inject(e),this._uiComponents.checkBox=m;s=new UWA.Element("tr",{class:"doattributeview_tr"}).inject(i),new UWA.Element("td",{class:"dobulkdownloadview_label",text:a.labels.title}).inject(s),l=new UWA.Element("td",{class:"dobulkdownloadview_combo"}).inject(s);var v=new r({sizeInCharNumber:23}).inject(l);return this._uiComponents.titleInputBox=v,e},u})),define("DS/ENODODisplay/views/DerivedOutputList",["UWA/Controls/Abstract","UWA/Core","UWA/Element","DS/TreeModel/TreeDocument","DS/TreeModel/DataModelSet","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","i18n!DS/ENODODisplay/assets/nls/ENODisplayDO.json","DS/ENODOUtilsServices/DOServices","DS/Utilities/UUID","text!DS/ENODOUtilsServices/assets/enodo_webservices.json","DS/ENODODisplay/views/DODetailsDialog","DS/ENODODisplay/views/DODeleteDialog","DS/ENODODisplay/model/SelectedObjectInfo","DS/ENODODisplay/views/DOPreview","css!DS/ENODODisplay/ENODODisplay"],(function(e,t,i,o,n,s,a,r,l,d,u,c,p,h,m,v,D){"use strict";var g=JSON.parse(c);const _="OK",w="SUBMITTED",f="RUNNING",b="FAILED",O="UPDATE",y="SNAPSHOT",S="REPRESENTATION";function C(e,t,i,o){t=t.toLowerCase(),i=i.toLowerCase(),o=o.toLowerCase();for(var n=-1,s=0;s<e.length;s++)if(e[s].target.toLowerCase()===t&&e[s].category.toLowerCase()===o){var a=e[s].source;if(!("CATPart"!==a&&"SLDPRT"!==a&&"PRT"!==a&&"IPT"!==a||"3dshape"!==i&&"vpmreference"!==i)){n=s;break}if(("DWG"===a||"SLDDRW"===a||"CATDrawing"===a)&&"drawing"===i){n=s;break}}return n}function I(){return new Promise((function(e,t){var i={data:{ruleType:"ONDEMAND"},webService:{url:g.retrieveFormats.url,verb:g.retrieveFormats.verb},callback:{onComplete:function(t){var i=UWA.is(t,"string")?JSON.parse(t):t;UWA.is(i.derivedOutputRules)&&0!==i.derivedOutputRules.length?e(i.derivedOutputRules):e([])},onFailure:function(e){t(e)}}};d.SendServerRequest(i)}))}return e.extend({_treelistview:null,_model:null,_informationBox:null,_actionAuthorized:!1,_formatList:[],_role:null,_isDeleteAllowed:!1,_isDownloadAllowed:null,_isFormatInitialized:!1,_iconUrlForContextualMenu:null,_3dspaceUrlForContextualMenu:null,_3dPlayID:null,_latestRequestID:0,physicalid:"",init:function(e){var t=this;this._parent(e),this._actionAuthorized=!(!UWA.is(this.options)||!UWA.is(this.options.activateActions))&&this.options.activateActions,this.elements.container=UWA.createElement("div",{class:"derivedoutputs_container"}),this._displayedParameters=void 0,this._deleteWindow=void 0,d.GetCurrentRole().then((function(e){switch(t._role=e,t._role){case"VPLMProjectLeader":case"VPLMAdmin":t._isDeleteAllowed=!0}}),(function(e){console.error("Error getting the context : "+e),t._isDeleteAllowed=!1})),d.isAccessforDownloadDO().then((function(e){console.log(e),1==e.Status?t._isDownloadAllowed=e.Status:t._isDownloadAllowed=!1})).catch((function(e){console.log(e),t._isDownloadAllowed=!1})),d.getCompassURL().then((function(e){t._iconUrlForContextualMenu=e.iconURL,t._3dspaceUrlForContextualMenu=e.spaceURL})),I().then((function(e){t._isFormatInitialized=!0,t._formatList=e})),t._initializeUI(t)},_initializeUI:function(e){var t=new n;e._model=new o({dataModelSet:t});var i=!0===this._actionAuthorized?"15%":"20%",s=[{text:l.columns.status,dataIndex:"Status",alwaysVisibleFlag:!0,width:i,sortableFlag:!1,resizableFlag:!0,editableFlag:!1,getCellTypeRepresentation:function(e){if(e.nodeModel)switch(e.nodeModel.options.grid.Status){case _:return"statusCheck";case f:return"statusJobRunning";case w:return"statusJobSubmitted";case b:return"statusJobFailed";case O:return"statusRefresh";case y:return"snapshotExists";case S:return"url"}},getCellValue:function(t){if(t.nodeModel&&t.nodeModel&&t.nodeModel.options.grid.RepIcon)return{icon:{iconPath:e._3dspaceUrlForContextualMenu+"/"+t.nodeModel.options.grid.RepIcon}}},getCellClassName:function(e){if(e.nodeModel&&e.nodeModel.options.grid.RepIcon)return"do-repnodeicon-class"},getCellSemantics:function(t){var i=!0;if(t.nodeModel){var o=t.nodeModel.options.grid.Status;(o===w||o===f||o===b||o===O&&!0===e._actionAuthorized&&!0===t.nodeModel.options.grid.IsUpdatable&&!1===t.nodeModel.options.grid.isExternal)&&(i=!1)}return{disabled:i}}},{text:l.labels.alias,dataIndex:"OutputStreamId",width:"40%",sortableFlag:!1,getCellClassName:function(e){if(e.nodeModel&&e.nodeModel.options.grid.isRepNode)return"do-repnode-class"}},{text:l.columns.details,dataIndex:"Parameters",alwaysVisibleFlag:!0,width:i,sortableFlag:!1,resizableFlag:!0,editableFlag:!1,getCellTypeRepresentation:function(e){return e.nodeModel?"seeParameters":"string"},getCellSemantics:function(e){if(e.nodeModel)return{disabled:!1,allowUnsafeHTMLLabel:!1}}},{text:l.columns.download,dataIndex:"Download",alwaysVisibleFlag:!0,width:i,sortableFlag:!1,resizableFlag:!0,editableFlag:!1,getCellTypeRepresentation:function(e){return e.nodeModel&&void 0!==e.nodeModel.options.grid.Download&&!0===e.nodeModel.options.grid.Download?"actionDownload":"actionBlock"},getCellSemantics:function(t){if(t.nodeModel&&void 0===t.nodeModel.options.grid.Download||!1===t.nodeModel.options.grid.Download||!1===e._isDownloadAllowed)return{disabled:!0,allowUnsafeHTMLLabel:!1}}}];!0===this._actionAuthorized&&s.push({text:l.columns.delete,dataIndex:"Delete",alwaysVisibleFlag:!0,width:i,sortableFlag:!1,resizableFlag:!0,editableFlag:!1,getCellTypeRepresentation:function(t){return t.nodeModel&&void 0!==t.nodeModel.options.grid.Delete&&!0===t.nodeModel.options.grid.Delete&&!0===e._actionAuthorized?"deleteAction":"actionBlock"},getCellSemantics:function(t){if(t.nodeModel&&void 0===t.nodeModel.options.grid.Delete||!1===t.nodeModel.options.grid.Delete||!1===e._isDeleteAllowed&&!0!==t.nodeModel.options.grid.ObjectOwner)return{disabled:!0,allowUnsafeHTMLLabel:!1}}});var d=e._treelistview=new a({identifier:"dofacet_gridviewcomponent",treeDocument:e._model,rowSelection:"single",cellSelection:"none",selectionBehavior:{toggle:!0,unselectAllOnEmptyArea:!0},layout:new r({cellHeight:26,columnHeaderHeight:38,rowsHeader:!1}),columns:s,defaultColumnDef:{width:"auto"},onContextualEvent:function(t){return v.buildContextualMenu(e,t.cellInfos)},getCellTooltip:function(t){if(!t.nodeModel||0!==t.nodeModel.getParents().length)return this.getCellDefaultTooltip(t);switch(this.layout.getDataIndexFromColumnIndex(t.columnID)){case"Status":var i="",o=t.nodeModel.options.grid.Jobs,n="";if(o.length>0){var s=o[o.length-1];n=s.hasOwnProperty("name")?s.name:""}switch(t.nodeModel.options.grid.Status){case _:i=l.buttons.uptodate.shortHelp;break;case O:i=l.buttons.refresh.shortHelp,!0===e._actionAuthorized&&(!1===t.nodeModel.options.grid.isExternal?!0===t.nodeModel.options.grid.IsUpdatable&&(i+=l.buttons.refresh.clickupdate):i+=l.buttons.refresh.external);break;case w:i=l.replace(l.buttons.jobs.shortHelpSubmitted,{oJobName:n})+" "+l.buttons.jobs.actionClick;break;case f:i=l.replace(l.buttons.jobs.shortHelpRunning,{oJobName:n})+" "+l.buttons.jobs.actionClick;break;case b:i=l.replace(l.buttons.jobs.shortHelpFailed,{oJobName:n})+" "+l.buttons.jobs.actionClick;break;case y:i=l.buttons.snapshot.isSnapshot}return{shortHelp:i,updateModel:!1};case"Parameters":if(!t.nodeModel.options.grid.isRepNode)return{shortHelp:l.buttons.details.shortHelp,updateModel:!1};break;case"Download":if(!0===t.nodeModel.options.grid.Download&&!0===e._isDownloadAllowed)return{shortHelp:l.buttons.download.shortHelp,updateModel:!1};if(!0===t.nodeModel.options.grid.Download&&!1===e._isDownloadAllowed)return{shortHelp:l.buttons.download.accessRight,updateModel:!1};if("undefined"!==t.nodeModel.options.grid.Download&&!1===t.nodeModel.options.grid.Download)return{shortHelp:l.buttons.download.notDownloadable,updateModel:!1};break;case"Delete":return!0===e._actionAuthorized&&!0===t.nodeModel.options.grid.Delete?!0===e._isDeleteAllowed||!0===t.nodeModel.options.grid.ObjectOwner?t.nodeModel.options.grid.Jobs.length>0?""===t.nodeModel.options.grid.Filename?{shortHelp:l.buttons.delete.deleteJob,updateModel:!1}:{shortHelp:l.buttons.delete.deleteJobsAndDo,updateModel:!1}:{shortHelp:l.buttons.delete.shortHelp,updateModel:!1}:{shortHelp:l.buttons.delete.accessRight,updateModel:!1}:t.nodeModel.options.grid.isRepNode?void 0:!1===t.nodeModel.options.grid.Delete?{shortHelp:l.buttons.delete.accessRight,updateModel:!1}:{shortHelp:l.buttons.delete.notAllowed,updateModel:!1};default:return this.getCellDefaultTooltip(t)}}}).inject(this.elements.container);this.elements.container.getChildren()[0].id="dofacet_gridviewcomponent";var u={actionDownload:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"download",fontIconFamily:WUXManagedFontIcons.Font3DS}}},actionBlock:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"block",fontIconFamily:WUXManagedFontIcons.Font3DS}}},statusCheck:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"status-ok",fontIconFamily:WUXManagedFontIcons.Font3DS}}},statusRefresh:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"update",fontIconFamily:WUXManagedFontIcons.Font3DS}}},statusJobRunning:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"clock",fontIconFamily:WUXManagedFontIcons.Font3DS}}},statusJobSubmitted:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"hourglass",fontIconFamily:WUXManagedFontIcons.Font3DS}}},statusJobFailed:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"attention",fontIconFamily:WUXManagedFontIcons.Font3DS}}},snapshotExists:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"camera",fontIconFamily:WUXManagedFontIcons.Font3DS}}},deleteAction:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"trash",fontIconFamily:WUXManagedFontIcons.Font3DS}}},seeParameters:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"eye",fontIconFamily:WUXManagedFontIcons.Font3DS}}}};d.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(u)),d.getContent().addClassName("do-datagridview"),d.onReady((function(){d.addEventListener("click",e._cellClicked.bind(e))})),e._informationBox=UWA.createElement("div",{class:"enoderivedoutputs_information"}),UWA.createElement("span",{class:"enoderivedoutputs_information_icon wux-ui-3ds wux-ui-3ds-5x wux-ui-3ds-docs"}).inject(e._informationBox),e._messageInformationBox=UWA.createElement("h2",{class:"enoderivedoutputs_information_msg"}).inject(this._informationBox),e._informationBox.hide(),e._informationBox.inject(e.elements.container)},_openJobInfo:function(e){if(e.length>0){var t=e[e.length-1];if(t.hasOwnProperty("physicalId")||t.hasOwnProperty("objectId")){var i=t.hasOwnProperty("objectId")?t.objectId:t.hasOwnProperty("physicalId")?t.physicalId:null;d.retrievePlatformUrl().then((function(e){var t=d.get3DSpaceUrl(e);window.open(t+g.openJobLink.url+i,"_blank")}))}}},_cellClicked:function(e,t){var i=this;if(t&&t.nodeModel&&t.nodeModel.options.grid)switch(this._treelistview.layout.getDataIndexFromColumnIndex(t.columnID)){case"Status":var o=t.nodeModel.options.grid.Status;!0===this._actionAuthorized&&o===O&&!1===t.nodeModel.options.grid.isExternal&&!0===t.nodeModel.options.grid.IsUpdatable&&this._updateDerivedOutput(t.nodeModel.options.grid,t),o!==w&&o!==f&&o!==b||void 0!==t.nodeModel.options.grid.Jobs&&t.nodeModel.options.grid.Jobs.length>0&&this._openJobInfo(t.nodeModel.options.grid.Jobs);break;case"Parameters":t.nodeModel.options.grid.isRepNode||(this._displayedParameters=new p({name:t.nodeModel.options.grid.Filename,title:t.nodeModel.options.grid.Title,format:t.nodeModel.options.grid.Format,isSync:t.nodeModel.options.grid.isSync,status:t.nodeModel.options.grid.Status,isSnapshot:t.nodeModel.options.grid.isSnapshot,creationDate:t.nodeModel.options.grid.creationDate,jobs:t.nodeModel.options.grid.Jobs,isExternal:t.nodeModel.options.grid.isExternal,converter:t.nodeModel.options.grid.Converter,outputStreamId:t.nodeModel.options.grid.OutputStreamId,parameters:t.nodeModel.options.grid.Parameters},this.elements.container));break;case"Download":void 0!==t.nodeModel.options.grid.Download&&!0===t.nodeModel.options.grid.Download&&!0===i._isDownloadAllowed&&this._downloadDerivedOutput(t.nodeModel.options.grid);break;case"Delete":if(void 0!==t.nodeModel.options.grid.Delete&&!0===t.nodeModel.options.grid.Delete&&(!0===this._isDeleteAllowed||!0===t.nodeModel.options.grid.ObjectOwner)&&!0===this._actionAuthorized)if(void 0!==t.nodeModel.options.grid.Jobs&&t.nodeModel.options.grid.Jobs.length>0)if(""===t.nodeModel.options.grid.Filename)this._deleteDerivedOutputJobs(t.nodeModel.options.grid,!0);else{var n={onYesCallback:function(){i._deleteDerivedOutputAndJobs(t.nodeModel.options.grid)},onNoCallback:function(){i._deleteDerivedOutput(t.nodeModel.options.grid,!0)}};this._deleteWindow=new h(t.nodeModel.options.grid,this.elements.container,n)}else this._deleteDerivedOutput(t.nodeModel.options.grid,!0)}},getTreeListView:function(){return this._treelistview},_updateDerivedOutputCall:function(e,t){for(var i=this,o=[],n=0;n<e.Parameters.length;n++){var s=e.Parameters[n];if(s.hasOwnProperty("name")&&s.hasOwnProperty("value")){var a=s.name,r=s.value,c={};c[a]=r,o.push(c)}}var p=[],h="DFUpdate"+u.v4(),m=e.Format,v=e.OutputStreamId,D={model_identifier:{type:"VPMReference",id:e.ObjectID},target:m,unifiedFormat:v,title:h,batch_parameters:{version:"2.0",convinputs:o,inputs:[]}};p.push(D);var _={data:{DoJobs:p},webService:{url:g.generateJob.url,verb:g.generateJob.verb},callback:{onComplete:function(e){d._displayNotification("info",l.info.title,l.info.updateOK),t.disabled=!0,i.selectionModified([i.physicalid])},onFailure:function(e){d._displayNotification("error",l.error.title,l.replace(l.error.updateFailed,{oMsg:e}))}}};d.SendServerRequest(_)},_deleteDerivedOutputAndJobs:function(e){this._deleteDerivedOutputJobs(e,!1),this._deleteDerivedOutput(e,!0)},_deleteDerivedOutputJobs:function(e,t){for(var i=this,o=[],n=e.Jobs,s=0;s<n.length;s++){var a=n[s];a.hasOwnProperty("physicalId")&&o.push(a.physicalId)}var r={data:{ids:o},webService:{url:g.deleteJobs.url,verb:g.deleteJobs.verb},callback:{onComplete:function(e){e.hasOwnProperty("countOfJobs")&&e.countOfJobs>0&&(d._displayNotification("info",l.info.title,l.info.deleteJobOk),!0===t&&i.selectionModified([i.physicalid]))},onFailure:function(e){d._displayNotification("error",l.error.title,l.replace(l.error.deleteFailed,{oMsg:e}))}}};d.SendServerRequest(r)},_deleteDerivedOutput:function(e,t){var i=this,o={data:{reps:[{id:e.ObjectID,keys:[{filename:e.Filename,format:e.Format,DO_ID:e.DOID,DOF_ID:e.DOFID}]}]},webService:{url:g.deleteDerivedFormat.url,verb:g.deleteDerivedFormat.verb},callback:{onComplete:function(e){d._displayNotification("info",l.info.title,l.info.deleteOK),!0===t&&i.selectionModified([i.physicalid])},onFailure:function(e){d._displayNotification("error",l.error.title,l.replace(l.error.deleteFailed,{oMsg:e}))}}};d.SendServerRequest(o)},_retrieveSelectionInfoOnRep:function(e){var t=this;return new Promise((function(i,o){var n={data:{physicalid:e,label:"FetchObjectInfo_DOSP",select_predicate:["physicalid","ds6w:cadMaster","ds6w:type","owner"]},webService:{url:g.fetch.url,verb:g.fetch.verb},callback:{onComplete:function(e){var o=UWA.is(e,"string")?JSON.parse(e):e;i(t._parseAttributeResults(o))},onFailure:function(e){o(e||new Error("Issue retrieving selection informations"))}}};d.SendServerRequest(n)}))},_parseAttributeResults:function(e){var t=[];if(null!==e&&e.hasOwnProperty("results"))for(var i=0;i<e.results.length;i++){var o=e.results[i];if(o.hasOwnProperty("attributes")){for(var n,s,a,r,l=0;l<o.attributes.length;l++){var d=o.attributes[l];if(d.hasOwnProperty("name"))switch(d.name){case"ds6w:type":n=d.hasOwnProperty("value")?d.value:null;break;case"ds6w:cadMaster":s=d.hasOwnProperty("value")?d.value:null;break;case"owner":a=d.hasOwnProperty("value")?d.value:null;break;case"physicalid":r=d.hasOwnProperty("value")?d.value:null}}var u;(u=new m(r)).setType(n),u.setCAD(s),u.setOwner(a),t.push(u)}}else(u=new m(this.physicalid)).setType("unknown"),u.setCAD("unknown"),u.setOwner("unknown"),t.push(u);return t},_updateDerivedOutput:function(e,t){this._updateDerivedOutputCall(e,t)},_downloadDerivedOutput:function(e){if(!UWA.is(e))throw new Error("## DerivedOutputList._downloadDerivedOutput: Invalid inputs");var t=e.Filename,i=e.Format,o=e.ObjectID,n=e.DOID,s=e.DOFID,a=e.Title?e.Title:t,r=(!!e.isSnapshot&&e.isSnapshot,{data:{reps:[{id:o,keys:[{format:i,filename:t,DO_ID:n,DOF_ID:s,title:a}]}]},webService:{url:g.downloadTicket.url,verb:g.downloadTicket.verb},callback:{onComplete:function(e){if(void 0!==(e=UWA.is(e,"string")?JSON.parse(e):e).ticketURL&&void 0!==e.ticket){var i=e.ticketURL+"?__fcs__jobTicket="+encodeURIComponent(e.ticket);if(e.hasOwnProperty("displayfilenames")){var o=e.displayfilenames;o.length>0&&(t=Array.isArray(o)?o[0]:o)}d.DownloadURL(i,t)}},onFailure:function(e){e&&console.error(e)}}});d.SendServerRequest(r)},clickHandler:function(e){},_displayInformationBox:function(e){"noselection"===e?this._messageInformationBox.setText(l.derivedOutputsNoSelection):"multiselection"===e?this._messageInformationBox.setText(l.derivedOutputsMultiSelection):"noderivedoutputs"===e&&this._messageInformationBox.setText(l.noderivedoutputs),this._treelistview.getContent().hide(),this._informationBox.show()},_getDerivedOutputs:function(e){var t=this;if(this.nodeId=e.ids,!UWA.is(e)||!UWA.is(e.ids))throw new Error("## DerivedOutputList.getDerivedOutputs: Invalid inputs");const i=++this._latestRequestID;var o={data:{ids:e.ids,attributes:e.attributes},webService:{url:g.doInformation.url,verb:g.doInformation.verb},callback:{onComplete:function(o){if(i===t._latestRequestID){var n=UWA.is(o,"string")?JSON.parse(o):o;e.onComplete(n)}},onFailure:function(t){e.onFailure(t)}}};d.SendServerRequest(o)},_generateNodesFromResults:function(e,t){e=UWA.is(e,"string")?JSON.parse(e):e;for(var i=[],o=0;o<e.ids.length;o++){var n=e.ids[o],a=n.id,r=n.hasOwnProperty("repId")?n.repId:a,l=d.GetCurrentUser(),u="",c="",p="";if(null!==t)for(var h=0;h<t.length;h++)if(t[h].getPhid()===r||t[h].getPhid()===a){var m=t[h].getOwner();u=t[h].getType(),c=t[h].getCAD(),p=!!l&&m===l.login}if(n.repTitle&&null!==n.repTitle&&n.streams.length>0){var v={OutputStreamId:n.repTitle,Jobs:[],Status:S,RepIcon:n.repIcon,isRepNode:!0};i.push(v)}if(n.streams)for(var D=0;D<n.streams.length;D++){var g=n.streams[D];if(g.hasOwnProperty("filename")&&g.hasOwnProperty("format")&&g.hasOwnProperty("downloadable")){var I=!!g.hasOwnProperty("isSync")&&("true"===g.isSync||!0===g.isSync);if(g.hasOwnProperty("snapshot")&&1==g.hasOwnProperty("snapshot"))var F=y;else F=1==I?_:O;var M=!!g.hasOwnProperty("snapshot")&&g.hasOwnProperty("snapshot");if(g.hasOwnProperty("creationDate")){var k=g.creationDate.replace(" ","T")+"Z",E=new Date(k);if(isNaN(E))console.error("Invalid Date");else var x=E.toLocaleString()}var P=g.filename,A=g.format,N=g.hasOwnProperty("streamId")&&""!==g.streamId?g.streamId:g.format,U="true"===g.downloadable||!0===g.downloadable,T=g.hasOwnProperty("isExternal")&&("true"===g.isExternal||!0===g.isExternal),L=g.hasOwnProperty("visible")&&"true"===g.visible||!0===g.visible,j=g.hasOwnProperty("converter")?g.converter:null,W=U,B=g.hasOwnProperty("DO_ID")?g.DO_ID:null,R=g.hasOwnProperty("DOF_ID")?g.DOF_ID:null;let e=g.hasOwnProperty("title")?g.title:P;"visualization"==N?W=!0:g.hasOwnProperty("deletable")&&(W=("true"===g.deletable||!0===g.deletable)&&!0===U);var J=[];if(F!=_&&g.hasOwnProperty("jobs")&&g.jobs.length>0){var H=(J=g.jobs)[J.length-1];"Running"===H.status?F=f:"Submitted"===H.status||"Created"===H.status?F=w:"Failed"===H.status?F=b:J=[],J.length>0&&""===P&&(W=!0)}"ExactGeometry"==A&&(N=N+" ("+A+")");var V=!1;this._formatList&&A&&u&&c&&(V=C(this._formatList,A,u,c)>-1);var z=[];if(g.hasOwnProperty("parameters")&&(z=g.parameters),L&&"print"!=N){var G={ObjectID:r,IsUpdatable:V,Objectowner:p,isSync:I,Status:F,Jobs:J,Format:A,Filename:P,Download:U,Parameters:z,isExternal:T,Delete:W,OutputStreamId:N,Converter:j,DOID:B,DOFID:R,Title:e,isSnapshot:M,creationDate:x};G.isSnapshot?i.unshift(G):i.push(G)}}}}this._model.prepareUpdate(),this._model.empty(),console.log("nodeStruct:",i);for(var X=0;X<i.length;X++){var q=i[X],K=s.createTreeNodeDataModel(this._model.options.dataModelSet,{label:q.text,grid:q});this._model.addChild(K)}this._model.expandAll(),this._model.pushUpdate()},_extractRepIdList:function(e){e=UWA.is(e,"string")?JSON.parse(e):e;for(var t=[],i=0;i<e.ids.length;i++){var o=e.ids[i],n=o.id,s=o.hasOwnProperty("repId")?o.repId:n;t.push(s)}return t},_hasStreams:function(e){if(e.hasOwnProperty("ids"))for(var t=0;t<e.ids.length;t++)if(e.ids[t].hasOwnProperty("streams")&&e.ids[t].streams.length>0)return!0;return!1},selectionModified:function(e,t){var i=this;if(void 0!==this._displayedParameters&&null!==this._displayedParameters.getDialog()&&(this._displayedParameters.onClose(),this._displayedParameters=void 0),void 0!==this._deleteWindow&&null!==this._deleteWindow.getDialog()&&(this._deleteWindow.onClose(),this._deleteWindow=void 0),this._treelistview&&this._treelistview.getContent().show(),this._informationBox&&this._informationBox.hide(),i._model.empty(),UWA.is(e)&&0!==e.length)if(1===e.length){var o=UWA.is(e[0].getID,"function")?e[0].getID():e[0];this._getDerivedOutputs({ids:[o],attributes:["filename","format","isSync","downloadable","visible","parameters","isExternal","deletable","title"],onComplete:function(e){var n;if((n=UWA.is(e,"string")?JSON.parse(e):e)&&n.ids&&n.ids[0]&&!1!==i._hasStreams(n)){var s=i._extractRepIdList(e);i.physicalid===o?i._generateNodesFromResults(n,i._selectionInfoList):(i.physicalid=o,null==t||0==t.lenth?i._retrieveSelectionInfoOnRep(s).then((function(e){i._selectionInfoList=e,!0!==i._isFormatInitialized?I().then((function(t){i._isFormatInitialized=!0,i._formatList=t,i._generateNodesFromResults(n,e)})):i._generateNodesFromResults(n,e)})):(i._selectionInfoList=t,!0!==i._isFormatInitialized?I().then((function(e){i._isFormatInitialized=!0,i._formatList=e,i._generateNodesFromResults(n,t)})):i._generateNodesFromResults(n,t)))}else i._displayInformationBox("noderivedoutputs")},onFailure:function(){i.physicalid=o,i._displayInformationBox("noderivedoutputs")}})}else this._displayInformationBox("multiselection");else this._displayInformationBox("noselection")}})})),define("DS/ENODODisplay/commands/facets/DerivedOutputFacet",["css!DS/ENODODisplay/ENODODisplay","UWA/Core","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","UWA/Class","i18n!DS/ENODODisplay/assets/nls/ENODisplayDO.json","DS/ENODODisplay/views/DerivedOutputList","DS/ENODOUtilsServices/DOServices","DS/ENODODisplay/views/DOBulkDownloadDialog","DS/ENODODisplay/model/SelectedObjectInfo","text!DS/ENODOUtilsServices/assets/enodo_webservices.json"],(function(e,t,i,o,n,s,a,r,l,d,u){"use strict";var c=JSON.parse(u);return n.extend(i,o,{_derivedOutputList:null,_actionAuthorized:!1,_currentSelectionId:null,_selectionInfo:null,_infoPromise:null,_multiselectionInfoBox:null,init:function(e){this._parent(e),this._actionAuthorized=this.getActionAuthorized(this.options),this._initUI(),this.multiSelectionMessage()},_initUI:function(){null===this._derivedOutputList&&(this.elements.container=t.createElement("div",{class:"do-evolution"}),this._derivedOutputList=new a({activateActions:this._actionAuthorized}),this._derivedOutputList.elements.container.inject(this.elements.container))},getActionAuthorized:function(e){if(widget&&widget.data)return"ENOSC2D_AP"!=widget.data.appId},updateFacet:function(){var e=this;document.getElementsByClassName("dobulkDownlaod_wuxdailog").length&&e._downloadDialog.onClose();let i=e.getModel();t.is(i)&&t.is(i.get("objectId"))&&(i.get("objectId").indexOf(".")>0?(this.elements.container.getChildren()[0].hide(),this._multiselectionInfoBox.show()):(this._multiselectionInfoBox.hide(),this.elements.container.getChildren()[0].show()));this._retrieveSelectionAndInfo((function(t,i){null!==i&&i.length>0?(e._currentSelectionId=i,e._selectionInfo=t,e._derivedOutputList.selectionModified([e._currentSelectionId],[t])):(e._currentSelectionId="",e._selectionInfo=null,e._derivedOutputList.selectionModified([],null))}))},destroyComponent:function(){},onResize:function(){},onRefresh:function(){this.updateFacet()},show:function(){return this.updateFacet(),this.__callMethodOnUI("show")},isActionAvailable:function(e){let i=this.getModel();if("generateDeriveOutput"==e){if(t.is(i)&&t.is(i.get("objectId"))){var o=i.get("objectId");return!(this.getModel()&&this.getModel().get("type")&&this.getModel().get("type").dbValues&&"Document"==this.getModel().get("type").dbValues.value&&"OnPremise"===this.options.tenant||o.indexOf(".")>0)&&(!("ENXWDOC_AP"==widget.data.appId&&this.getModel()&&this.getModel().get("type")&&this.getModel().get("type").dbValues)||"Technical Document"!=this.getModel().get("type").dbValues.value&&"Quality System Document"!=this.getModel().get("type").dbValues.value)}}else if("refreshDOView"===e){if(t.is(i)&&t.is(i.get("objectId")))return!((o=i.get("objectId")).indexOf(".")>0)}else{if("bulkDownloadDO"!==e||"ENXWDOC_AP"==widget.getValue("appId"))return!1;if(t.is(i)&&t.is(i.get("objectId"))){o=i.get("objectId");return!(this.getModel()&&this.getModel().get("type")&&this.getModel().get("type").dbValues&&"Document"==this.getModel().get("type").dbValues.value||o.indexOf(".")>0)}}},onAction:function(e){if("generateDeriveOutput"===e){var t=this,i={};null!=this._selectionInfo&&(i=this._selectionInfo.getDOGenerationFilter()),require(["DS/ENODOManagementCmdsLight/commands/GenericDOGenerationCmd"],(function(e){if("ENOWSES_AP"==widget.data.appId)var o=t._retrieveSelectionAndFilters([t._currentSelectionId]);else o=t._retrieveSelectionAndFilters(t._currentSelectionId);new e({command_id:t.options.ID,data:{selections:o.selections,context:widget.data.appId,filter:i}})}))}else"refreshDOView"===e?null!==this._currentSelectionId&&this._derivedOutputList.selectionModified([this._currentSelectionId],[this._selectionInfo]):"bulkDownloadDO"===e&&(this._derivedOutputList._isDownloadAllowed?this._retrieveAvailableRules():r._displayNotification("error",s.error.title,s.buttons.download.BulkDOaccessRight))},multiSelectionMessage:function(){this._multiselectionInfoBox=t.createElement("div",{class:"enoderivedoutputs_information1"});var e=t.createElement("div",{class:"content_box"}).inject(this._multiselectionInfoBox);t.createElement("span",{class:"enoderivedoutputs_information_icon wux-ui-3ds wux-ui-3ds-5x wux-ui-3ds-docs"}).inject(e);var i=t.createElement("h2",{class:"enoderivedoutputs_multiselection_information_msg"}).inject(e);this._multiselectionInfoBox.setStyle("position","relative"),this._multiselectionInfoBox.setStyle("height","100%"),this._multiselectionInfoBox.setStyle("vertical-align","top"),e.setStyle("position","absolute"),e.setStyle("top","calc(50% - 100px)"),e.setStyle("text-align","left"),e.setStyle("color","#303030"),e.setStyle("opacity",".2"),i.setText(s.multiselectionDisabledMSg),this._multiselectionInfoBox.inject(this.elements.container)},_retrieveAvailableRules:function(){var e=this,i={webService:{url:c.retrieveConversionFormats.url+"?downloadableOnly=true",verb:c.retrieveConversionFormats.verb},callback:{onComplete:function(i){var o=t.is(i,"string")?JSON.parse(i):i;if(t.is(o.derivedOutputFormats)&&0!==o.derivedOutputFormats.length){for(var n=[],a=[],d=0;d<o.derivedOutputFormats.length;d++){var u=o.derivedOutputFormats[d];if(u.hasOwnProperty("outputStreamId")&&u.hasOwnProperty("appliesOn")){var c=u.outputStreamId;"3D"===u.appliesOn?n.push(c):"2D"===u.appliesOn&&a.push(c)}}var p={partFormats:n,drawingFormats:a},h=e._selectionInfo.getTitle();e._downloadDialog=new l(p,e.elements.container,h,e._executeDownload.bind(e))}else 0===o.derivedOutputFormats.length&&r._displayNotification("error",s.error.title,s.warning.noFormat)},onFailure:function(e){r._displayNotification("error",s.error.title,s.replace(s.error.jobFailed,{oMsg:e}))}}};r.SendServerRequest(i)},_executeDownload:function(e,t,i,o,n){this._selectionInfo.getTitle();var a=i,l=this._retrieveFilteOnSelection(),d=l.hasOwnProperty("filter")?l.filter:{},u={data:{selections:[{paths:[l.paths],filter:d}],format3D:e,format2D:t,downloadOnlyUpToDate:o,zippedFolderName:a,Pointingdrawings:n},webService:{url:c.bulkDownloadTicket.url,verb:c.bulkDownloadTicket.verb,accept:c.bulkDownloadTicket.accept,type:c.bulkDownloadTicket.type},callback:{onComplete:function(e){r.DownloadBinary(e,a)},onFailure:function(e){if(-1!==e.message.indexOf("ResponseCode"))var t=e.message.substring(e.message.indexOf("ResponseCode")).split('"')[1];t&&"413"==t?r._displayNotification("error",s.buttons.bulkdownload.largeData,e):r._displayNotification("error",s.buttons.bulkdownload.downloadFailed,e)}}};r.SendServerRequest(u)},_retrieveFilteOnSelection:function(){return console.log("classe Light"),{paths:[this._currentSelectionId],filter:{}}},_retrieveSelectionAndFilters:function(e){var t={selections:[]};if(e){var i=[],o={paths:[e]};i.push(e),o.selectId=i,t.selections.push(o)}return t},_retrieveSelectionAndInfo:function(e){var t=this.getModel();if(t){var i=t.get("objectId"),o=t.get("metatype");if(i!==this._currentSelectionId&&"relationship"!==o){r.retrieveSelectionInfo(i,["physicalid","ds6w:cadMaster","ds6w:type","owner","ds6w:label","ds6w:kind","bo.XCADExposedDataExtension.V_FromCADOrigin"],this._parseSelectionInfo.bind(this,i)).then((function(t){e(t,i)}))}else i!==this._currentSelectionId&&e(this._selectionInfo,this._currentSelectionId)}else e(null,null)},_parseSelectionInfo:function(e,t){var i=new d(e);if(null!==t&&t.hasOwnProperty("results"))for(var o=0;o<t.results.length;o++){var n=t.results[o];if(n.hasOwnProperty("attributes"))for(var s=0;s<n.attributes.length;s++){var a=n.attributes[s];if(a.hasOwnProperty("name"))switch(a.name){case"ds6w:type":i.setType(a.value);break;case"ds6w:cadMaster":i.setCAD(a.value);break;case"owner":i.setOwner(a.value);break;case"ds6w:label":i.setTitle(a.value);break;case"ds6w:kind":i.setKind(a.value);break;case"bo.XCADExposedDataExtension.V_FromCADOrigin":i.setExtension(a.value)}}}return i}})}));