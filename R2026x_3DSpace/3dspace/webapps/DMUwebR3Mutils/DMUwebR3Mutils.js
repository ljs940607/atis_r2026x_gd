/*!  Copyright 2021 Dassault Systemes. All rights reserved. */
define("DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils",["DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","DS/Usage/TrackerAPI","i18n!DS/DMUwebR3Mutils/assets/nls/DMUwebR3Mutils.json"].concat([]),(function(e,t,i,n){"use strict";var o,r,a,s,u,l,c,d=[];function f(){return o&&o.lang||"en"}function p(){if(!o)throw new Error("App init not done");return a||(a=o.getValue("x3dPlatformId")),a}function m(){if(!o)throw new Error("App init not done");return s||(s=o.getValue("xPref_CREDENTIAL")),"ctx::"+s}function v(e){var t,i=p();if(!Array.isArray(r))throw new Error("Platform services not initialize yet");return r.some((function(n){if(n&&n.platformId===i)return t=n[e]})),t}function g(){return v("3DSpace")}function _(t){let i=g();if(!i)return void t.onCompleted(!1);let n=new Promise((function(e){require(["DS/ENOXWidgetPreferences/js/ENOXWidgetPreferences"].concat([]),(function(t){t.addCredentialPreferenceToWidget({usePreferredCredentials:!0},2).then((function(){m();let t=o.getPreferences(),i=[];t.length>1&&"xPref_CREDENTIAL"===t[0].name&&(i.push(t[1]),i.push(t[0]),o.setPreferences(i)),e(!0)}))}),e.bind(null,!1))})),r=new Promise((function(t){i+="/resources/modeler/pno/person?current=true&select=preferredcredentials",e.authenticatedRequest(i,{method:"GET",type:"json",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":f()},onComplete:function(e){e&&e.preferredcredentials?(u=e.preferredcredentials.organization,t(Boolean(u))):t(!1)},onFailure:function(){t(!1)}})}));Promise.all([n,r]).then((function(e){t.onCompleted(e[0]&&e[1])}))}return Object.freeze({init:function(e){return o?Promise.resolve():new Promise((function(t){o=e.widget,c=e.widget.data,l=o.id+"_R3M_",p(),m(),o.setPreferences([]),require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],(function(i){i.getPlatformServices({onComplete:function(s){i.getAppInfo({appId:o.getValue("x3dAppId"),onComplete:function(i){if(r=s,i.tenantAware){r=[];for(var u=0;u<i.platforms.length;++u)for(var l=0;l<s.length;++l)if(s[l].platformId===i.platforms[u].id){r.push(s[l]);break}}if(r&&r.length){var c=p();r.some((function(e){return e.platformId===c}))||(a=c="",r.length&&(o.setValue("x3dPlatformId",r[0].platformId),c=p())),c&&r.length>1&&o.addPreference({name:"x3dPlatformId",type:"list",label:n.x3dPlatformId,options:r.map((function(e){return{label:e.displayName,value:e.platformId}})),defaultValue:c}),e.onCompletedPlatformServices({success:Boolean(c)||"tenant"}),_({onCompleted:()=>{e.onCompletedSecurityContext(),t()}})}else e.onCompletedPlatformServices({success:"platformServices"})},onFailure:function(){e.onCompletedPlatformServices({success:"getAppInfo"}),t()}})},onFailure:function(){e.onCompletedPlatformServices({success:"getPlatformServices"}),t()}})})),o.addEvent("endEdit",(()=>{let e=o.getValue("x3dPlatformId"),t=e!==a;if(a=e,s=o.getValue("xPref_CREDENTIAL"),t){let e=new Promise((e=>{setTimeout((()=>_({onCompleted:e})),0)}));d.forEach((t=>t(e)))}}))}))},getWidget:function(){return o},getWidgetId:function(){return o.id},getWidgetAppId:function(){return o.getValue("x3dAppId")},getLang:f,getUserLogin:function(){var e=t.getUser();return e?e.login:""},getUserOrganizationName:function(){return u?u.name:""},getPlatformId:p,getPlatformIdServices:function(){return JSON.parse(JSON.stringify(r.filter((e=>e.platformId===a))))},get3DSpaceUrl:g,get3DSearchUrl:function(){return v("3DSearch")},getDOSUrl:function(){return v("dfsobjectstorage")},get3DSwymUrl:function(){return v("3DSwym")},getR2VPlatformUrl:function(){return v("r2vsurvey")},getSecurityContext:m,getDatafromContent:function(){if(!o)throw new Error("App init not done");var e={},t=[];if(void 0===o.data.X3DContentId)return e;var i=JSON.parse(o.data.X3DContentId);return i.data&&i.data.items&&i.data.items.forEach((function(e){t.push({objectId:e.objectId,objectType:e.objectType,serviceId:e.serviceId,displayName:e.displayName})})),e.obj=t,e},getWidgetData:function(){return c},onTenantModified:function(e){d.push(e)},perfoMark:function(e){window.top.performance.mark(l+e)},perfoMeasure:function(e,t){window.top.performance.measure(l+(t||e),l+e)},sendUsageProbe:function(e){var t=e.eventValue&&Number.isInteger(e.eventValue)?e.eventValue:void 0,n=e.eventValue&&!Number.isInteger(e.eventValue)?e.eventValue:void 0,r={eventCategory:"usage",eventAction:e.eventAction?e.eventAction:void 0,eventLabel:e.eventLabel?e.eventLabel:void 0,appID:o.data.appId,tenant:p()};if(r.eventCategory&&r.eventAction){void 0!==t&&(r.eventValue=t),void 0!==n&&(r.persDim={pd1:n});try{i.trackPageEvent(r)}catch(e){UWA.log("Analytics request failed : "+e)}}}})})),define("DS/DMUwebR3Mutils/DMUwebR3McancelablePromise",[],(function(){"use strict";return function(e){let t=!1,i=()=>{t=!0};const n=new Promise(((n,o)=>{i=()=>{t||n("Promise cancelled")},t?i():e(n,o)}));return n.then((e=>(t=!0,e))),n.catch((e=>(t=!0,e))),{promise:n,cancel:i}}})),define("DS/DMUwebR3Mutils/DMUwebR3MserverRequests",["DS/WAFData/WAFData","DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/DMUwebR3Mutils/DMUwebR3McancelablePromise","UWA/Core","i18n!DS/DMUwebR3Mutils/assets/nls/DMUwebR3Mutils.json"].concat([]),(function(e,t,i,n,o,r){"use strict";let a,s,u,l,c,d=["ds6w:label","ds6w:identifier","ds6w:type","ds6w:status","ds6wg:dmuvalidationvalidation.v_validationstate","ds6wg:dmuvalidationvalidation.V_Validation_RestrictedEdition","bo.SIMItfSimulation.V_ValidationState","ds6wg:simitfsimulation.v_itf_executionstatus","ds6w:description","ds6w:responsible","ds6w:responsibleuid","ds6w:originator","originator","ds6w:organizationResponsible","ds6w:modified","ds6w:created","ds6w:project"],f=["ds6w:label","ds6w:identifier","ds6w:type","ds6w:status","ds6wg:dmuvalidationcheck.v_validation_checkstate","bo.SIMItfSimulation.V_ValidationState","ds6w:description","ds6w:responsible","ds6w:responsibleuid","ds6w:originator","originator","ds6w:organizationResponsible","ds6w:modified","ds6w:created","ds6w:project","ds6w:priority","ds6wg:DMUValidationUser.V_ValidationUser_Contribution"],p=["icon","thumbnail_2d","preview_url"],m=200,v={"ds6w:label":"title","ds6w:identifier":"name","ds6w:type":"type","ds6w:status":"maturity","ds6wg:dmuvalidationvalidation.v_validationstate":"validState","ds6wg:dmuvalidationvalidation.V_Validation_RestrictedEdition":"validState","ds6wg:dmuvalidationcheck.v_validation_checkstate":"validState","bo.SIMItfSimulation.V_ValidationState":"validState","ds6wg:simitfsimulation.v_itf_executionstatus":"executionstate","ds6w:description":"description","ds6w:responsible":"owner","ds6w:responsibleuid":"ownerid","ds6w:originator":"originator",originator:"originatorid","ds6w:organizationResponsible":"organization","ds6w:modified":"dateModif","ds6w:created":"dateCreat","ds6w:project":"collabSpace",type_icon_url:"icon",preview_url:"thumbnail_image",resourceid:"id",physicalid:"id","ds6w:priority":"r3mIssuePriority","ds6wg:DMUValidationUser.V_ValidationUser_Contribution":"contribution"},g=1,_=0,h=[];function y(e){return e+"-"+t.getUserLogin()+"-"+Date.now()}function S(e){return new Promise((function(n){i.getNlsOfPropertiesValues(JSON.stringify(e),{tenantId:t.getPlatformId(),lang:t.getLang(),apiVersion:"R2019x",onComplete:function(t){Object.keys(t).forEach((function(e){s[e]=Object.assign(s[e]||{},t[e])})),Object.keys(e).forEach((function(t){e[t].forEach((e=>{s[t][e]||(s[t][e]=e)}))})),e["ds6w:status"]&&Object.keys(s["ds6w:status"]).forEach((e=>{e.search(".DEFAULT")>-1&&(s["ds6w:status"][e]="")})),n()},onFailure:function(){n()}})}))}function b(e){if(e){if(l.hasOwnProperty(e))return l[e];var i=t.get3DSwymUrl();return l[e]=i?i+"/api/user/getpicture/login/"+e+"/format/mini":""}}function w(e,t,i){var n={};return Object.keys(e).forEach((function(o){var r=v[o];n[r]=e[o],"ds6w:identifier"===o&&"issue"===i&&(n.r3mIssueName=e[o]),s[o]&&(s[o].hasOwnProperty([e[o]])?n[r+"Disp"]=s[o][e[o]]:(t[o]||(t[o]={values:[],objects:[]}),-1===t[o].values.indexOf(e[o])&&t[o].values.push(e[o]),t[o].objects.push(n)))})),"issue"===i&&(n.r3mIssueResolvedBy=n.r3mIssueApprovals="running"),"task"===i&&(n.r3mTaskCandiAssignment=n.r3mTaskEstiFinDate=n.r3mTaskEstiDuration="running"),n.ownerImg=b(n.ownerid),n.originatorImg=b(n.originatorid),n}function M(e,t,i){return e.map((function(e){return w(e,t,i)}))}function P(e,t){if(t)return t.validState="2"===e?"Passed":"3"===e?"Failed":"InProgress",t.validStateDisp=r["validState"+t.validState],t}function I(i){var n={Accept:"application/json","Content-Type":"application/json"};return i.securityContext&&(n.SecurityContext=i.securityContext),e.authenticatedRequest(i.url+"?tenant="+t.getPlatformId()+(i.securityContext?"&SecurityContext="+i.securityContext:"")+(i.outputFormat?"&output_format="+i.outputFormat:""),{method:i.method,type:"json",headers:i.headers?i.headers:n,data:JSON.stringify(i.data),timeout:i.timeout,onComplete:i.onComplete,onFailure:i.onFailure,onTimeout:i.onTimeout||i.onFailure})}function D(i){if(!i)return;var n=o.clone(i.config,!1);n.onComplete=i.onSuccess,n.onFailure=i.onFailure,n.method=n.verb,n.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},i.doNotSetSecurityContextInUrl||(n.headers.SecurityContext=t.getSecurityContext()),"object"==typeof n.data&&(n.data=JSON.stringify(n.data));let r=t.get3DSpaceUrl();"r2vsurvey"===i.serviceId&&(r=t.getR2VPlatformUrl());var a=[];a.push("securityContext"),a.push(t.getSecurityContext()),a.push("tenant"),a.push(t.getPlatformId()),e.authenticatedRequest(r+"/"+i.url,n)}function C(e){var i="(";return i+='flattenedtaxonomies:"types/DMUValidationValidation"',i+=")",e.released||(i=i.concat(" AND NOT ([ds6w:status]:VPLM_SMB_Evaluation.RELEASED OR [ds6w:status]:VPLM_SMB_Evaluation_MajorRev.RELEASED)")),e.obsolete||(i=i.concat(" AND NOT ([ds6w:status]:VPLM_SMB_Evaluation.OBSOLETE OR [ds6w:status]:VPLM_SMB_Evaluation_MajorRev.OBSOLETE)")),i+=' AND [ds6w:organizationResponsible]:"'+t.getUserOrganizationName()+'"'}function R(e){var i="(";return i+=e.mkp?'flattenedtaxonomies:"types/Markup"':"",e.mkp&&i.length>1&&(i+=" OR "),i+=e.mkp?'flattenedtaxonomies:"types/DMUMarkupRepReference"':"",e.isr&&i.length>1&&(i+=" OR "),i+=e.isr?'flattenedtaxonomies:"types/SIMItfSimulation"':"",e.rvw&&i.length>1&&(i+=" OR "),i+=e.rvw?'flattenedtaxonomies:"types/DMUValidationValidation"':"",e.msr&&i.length>1&&(i+=" OR "),i+=e.msr?'flattenedtaxonomies:"types/DesignSight"':"",i+=")",e.released||(i=i.concat(" AND NOT ([ds6w:status]:VPLM_SMB_Evaluation.RELEASED OR [ds6w:status]:VPLM_SMB_Evaluation_MajorRev.RELEASED)")),e.obsolete||(i=i.concat(" AND NOT ([ds6w:status]:VPLM_SMB_Evaluation.OBSOLETE OR [ds6w:status]:VPLM_SMB_Evaluation_MajorRev.OBSOLETE)")),0===e.owner?i+=' AND [ds6w:responsibleuid]:"'+t.getUserLogin()+'"':1===e.owner&&(i+=' AND [ds6w:organizationResponsible]:"'+t.getUserOrganizationName()+'"'),i}function x(e){return{input_physical_ids:e,label:y("R3MwebIsr"),primitives:[{navigate_to_rel:{id:1,filter:{bo_type:["dsc_Model_Category_Ref"]}}},{navigate_to_rel:{id:2}},{navigate_to_sr:{id:3,filter:{semantics:["5"],role:["79"]},mode:"last"}},{navigate_to_sr:{id:4,filter:{semantics:["4"],role:["170"]},mode:"last"}},{navigate_from_rel:{id:5,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}},{navigate_from_rel:{id:7,filter:{rel_type:["Reference Document"],bo_type:["Task"]}}}],patterns:{prd:[{id:1},{id:2},{id:3}],context:[{id:1},{id:2},{id:4}],issue:[{id:5}],task:[{id:7}]},fileAttributes:p,attributes:f,version:3}}function E(e){return{input_physical_ids:e,label:y("R3MwebMsr"),primitives:[{navigate_to_rel:{id:1,filter:{bo_type:["dsc_Model_Category_Ref"]}}},{navigate_to_rel:{id:2}},{navigate_to_sr:{id:3,filter:{semantics:["5"],role:["79"]},mode:"last"}},{navigate_to_sr:{id:4,filter:{semantics:["4"],role:["170"]},mode:"last"}},{navigate_from_rel:{id:5,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}},{navigate_from_rel:{id:6,filter:{rel_type:["Reference Document"],bo_type:["Task"]}}}],patterns:{prd:[{id:1},{id:2},{id:3}],context:[{id:1},{id:2},{id:4}],issue:[{id:5}],task:[{id:6}]},fileAttributes:p,attributes:f,version:3}}function O(e){return{input_physical_ids:e,label:y("R3MwebMkp"),primitives:[{navigate_from_rel:{id:1,filter:{rel_type:["Markup"]}}},{navigate_from_rel:{id:2,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}},{navigate_from_rel:{id:3,filter:{rel_type:["Reference Document"],bo_type:["Task"]}}}],patterns:{context:[{id:1}],issue:[{id:2}],task:[{id:3}]},fileAttributes:p,attributes:f,version:3}}function V(e){return{input_physical_ids:e,label:y("R3MwebValidTo"),primitives:[{navigate_to_rel:{id:1}}],patterns:{ref:[{id:1}]},fileAttributes:p,attributes:f,version:3}}function T(e){return{input_physical_ids:e,label:y("R3MwebTic"),primitives:[{navigate_from_rel:{id:1,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}},{navigate_from_rel:{id:2,filter:{rel_type:["Reference Document"],bo_type:["Task"]}}}],patterns:{issue:[{id:1}],task:[{id:2}]},fileAttributes:p,attributes:f,version:3}}function U(e){return new Promise((function(i){I({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",data:e,onComplete:function(e){i(e)},onFailure:function(){i({})}})}))}function A(e){let i=Object.keys(e);return i.length?new Promise((e=>{I({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",data:T(i),onComplete:e,onFailure:function(){e()}})})):Promise.resolve()}const k=e=>new Promise((t=>{"DMUValidationValidation"===e.input_object["ds6w:type"]||"Markup"===e.input_object["ds6w:type"]?D({url:"resources/validation/service/getAll",config:{verb:"POST",data:{sValidationId:e.input_object.physicalid}},onSuccess:function(e){var i=JSON.parse(e);let n;i&&i.children&&i.children.forEach((e=>{"DMUValidationContext"===e.type&&e.contextURI&&(n=e.contextURI)})),function(e,t){return t?(i={contextURI:t},new Promise(((e,t)=>{D({url:"enovia/resources/r2v/modeler/v2/i3dx/fetch",serviceId:"r2vsurvey",doNotSetSecurityContextInUrl:!0,config:{verb:"POST",data:{data:[{"ds6w:i3dx":i.contextURI}]}},onSuccess:function(i){try{const n=JSON.parse(i);if(n?.error?.[0]?.error?.message)return void t(n.error[0].error.message);e(n)}catch(e){t(e)}},onFailure:t,onTimeout:t})}))).then((t=>(e.children.forEach((e=>{"DMUValidationContext"===e.type&&(e.serviceID=t.data[0]["ds6w:dataSource"],e.contextId=t.data[0].resourceid)})),e))):Promise.resolve(e);var i}(i,n).then((e=>{t(e)}))},onFailure:function(){t()}}):"DMUMarkupRepReference"===e.input_object["ds6w:type"]?D({url:"resources/markup/service/getMarkup",config:{verb:"POST",data:{sMarkupId:e.input_object.physicalid}},onSuccess:function(i){var n=JSON.parse(i);D({url:"/cvservlet/fetch/v2",config:{verb:"POST",data:{physicalid:n.MarkupContext.contextId?n.MarkupContext.contextId:n.MarkupContext.contextIds,label:"M3DFetchForWelcomePanel"+Date.now(),select_predicate:d,select_file:p}},onSuccess:function(i){var o=JSON.parse(i),r=[],a={physicalid:n.MarkupContext.contextId};o.results[0].attributes.forEach((function(e){a[e.name]=e.value})),r.push(a),e.outputs.context=r,t(e)},onFailure:function(){t()}})},onFailure:function(){t()}}):t()}));function j(e){return new Promise((function(i){I({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",data:e,onComplete:function(e){var t={},n={},o=[],r=[],a=[],u={};e.result.forEach((function(e){var i=e.input_object.physicalid;t[i]={},["context","highlight","check","issue","ca","task","coordinators","assignees","contributors","informeduser","contribution"].forEach((function(o){e.outputs[o]&&(t[i][o]=M(e.outputs[o],n,o))})),(t[i].highlight||[]).forEach((e=>{u[e.id]=e})),(t[i].check||[]).forEach((e=>P(e.validState,e))),(e.outputs.checked||[]).forEach((function(e){let o=e.owner.physicalid;(t[i].check||[]).some((t=>{if(!t.children)return t.id===o?(t.children=M(e.elements,n),!0):void 0}))})),t[i].assignees&&t[i].assignees.length>0||t[i].coordinators&&t[i].coordinators.length>0||t[i].contributors&&t[i].contributors.length>0||t[i].informeduser&&t[i].informeduser.length>0?(t[i].members=[],function(e,t){var i={};["owner","coordinators","assignees","contributors","informeduser"].forEach((function(n){var o=[];if("owner"===n){if(e&&e.input_object){var r={},a=e.input_object;a["ds6w:responsibleuid"]&&(r.user=a["ds6w:responsibleuid"]),a["ds6w:responsible"]&&(r.fullName=a["ds6w:responsible"]),o.push(r)}}else(t[n]||[]).forEach((function(e){var i={};Object.keys(e).forEach((function(n){"name"===n&&(i.contribution=function(e,t){for(var i="",n=0;n<e.length;n++)if(e[n].title===t&&e[n].contribution){i="Undefined"===e[n].contribution?"":e[n].contribution;break}return i}(t.contribution,e[n]),i.user=e[n]),"title"===n&&(i.fullName=e[n]),"type"===n&&(i.type=e[n]),"id"===n&&(i.id=e[n])})),o.push(i)}));i[n]=o,"owner"!==n&&delete t[n]})),t.members.push(i)}(e,t[i]),delete t[i].contribution):(delete t[i].assignees,delete t[i].coordinators,delete t[i].contributors,delete t[i].informeduser,delete t[i].contribution),e.outputs.validatedPath&&(t[i].validatedPath=[],e.outputs.validatedPath.forEach((function(e){if(!e.elements.length)return;let n=e.elements[0]["ds6w:type"],a="VPMInstance"===n||"VPMRepInstance"===n;t[i].validatedPath[e.app_index||e.sr_id]=e.elements.map((function(e,t){return a&&(0===t&&-1===o.indexOf(e.physicalid)&&o.push(e.physicalid),-1===r.indexOf(e.physicalid)&&r.push(e.physicalid)),e.pid=e.physicalid,e.type=e["ds6w:type"],e})),t[i].validatedPath[e.app_index||e.sr_id].instancePath=a})),t[i].validatedPath=t[i].validatedPath.filter((function(e){return e&&e.length})),t[i].validatedPath.length&&a.push(t[i])),e.outputs.prd&&(t[i].context=(t[i].context||[]).concat(M(e.outputs.prd,n)))}));const l=[];e.result.map((e=>{void 0===e.outputs.context&&l.push(k(e))}));const c=[];e.result.map((e=>{void 0===e.outputs.context&&"DMUMarkupRepReference"===e.input_object["ds6w:type"]&&c.push(k(e))})),Promise.all([0===c.length?Promise.resolve():Promise.all(c)]).then((function(e){var c;e[0]&&e[0].forEach((function(e){t[e.input_object.physicalid].context=M(e.outputs.context,n)})),Promise.all([o.length?U((c=o,{input_physical_ids:c,label:y("R3MwebValidFrom"),primitives:[{navigate_from_rel:{id:1}}],patterns:{root:[{id:1}]},fileAttributes:p,attributes:f,version:3})):Promise.resolve(),r.length?U(V(r)):Promise.resolve(),A(u),0===l.length?Promise.resolve():Promise.all(l)]).then((function(e){var i={},o={},r={};(e[0]&&e[0].result||[]).forEach((function(e){i[e.input_object.physicalid]={pid:e.outputs.root[0].physicalid,type:e.outputs.root[0]["ds6w:type"]},r[e.outputs.root[0].physicalid]||(r[e.outputs.root[0].physicalid]=e.outputs.root[0])})),(e[1]&&e[1].result||[]).forEach((function(e){o[e.input_object.physicalid]={pid:e.outputs.ref[0].physicalid,type:e.outputs.ref[0]["ds6w:type"]},r[e.outputs.ref[0].physicalid]||(r[e.outputs.ref[0].physicalid]=e.outputs.ref[0])})),a.forEach((function(e){e.validated=[],e.validatedPath.forEach((function(t,a){let s;if(t.instancePath){s=w(r[o[t[t.length-1].pid].pid],n);var u=[i[t[0].pid]];t.forEach((function(e){u.push(e),u.push(o[e.pid])})),s.validatedPath=u}else s=w(t[t.length-1],n),s.validatedPath=t;e.validated[a]=s,s.pid=s.id,s.id=String(g++)})),delete e.validatedPath})),(e[2]&&e[2].result||[]).forEach((e=>{let t=e.input_object.physicalid;["issue","ca","task"].forEach((i=>{e.outputs[i]&&(u[t][i]=M(e.outputs[i],n))}))})),(e[3]||[]).forEach((e=>{void 0!==e&&void 0!==e.children&&e.children.forEach((i=>{i&&"DMUValidationContext"===i.type&&void 0===t[e.id].context&&(t[e.id].context=[{id:i.contextId,serviceId:i.serviceID}],t[e.id].validated=[{id:i.contextId,serviceId:i.serviceID}],"r2vsurvey"===i.serviceID&&(t[e.id].context[0].i3dx=t[e.id].validated[0].i3dx=i.contextURI,t[e.id].validated[0].type=t[e.id].context[0].type="R2V_Activity"))}))}))})).then((function(){Object.keys(n).length?new Promise((function(){var e={};Object.keys(n).forEach((function(t){e[t]=n[t].values})),S(e).then((function(){Object.keys(n).forEach((function(e){n[e].objects.forEach((function(t){var i=v[e];t[i+"Disp"]=s[e][t[i]]}))})),i(t)}))})):i(t)}))}))},onFailure:function(){i({})}})}))}var F,L,N,B,W=(F=[],L=0,N=function(e,t){L--,W(),t(e)},B=function(e){var i,n,r=o.clone(e,!1);r.onComplete=function(t){N(t,e.onComplete)},r.onFailure=function(t){N(t,e.onFailure)},r.onTimeout=function(t){N(t,e.onTimeout||e.onFailure)},i=r,I({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",timeout:6e4,data:(n=i.ctxIDs,{input_physical_ids:n,label:y("R3MPIMwebItfCtx"),primitives:[{navigate_to_sr:{id:1,filter:{semantics:["6"],role:["198"]},mode:"last"}},{navigate_to_rel:{id:2}}],patterns:{ms:[{id:1}]},attributes:["ds6w:type","bo.PLMPIMMetricReference.V_Itf_Type","bo.PLMPIMMetricReference.V_Itf_Analysis","bo.SIMItfContextOfInterference.V_Context_Validity_Status"],fileAttributes:[],version:3}),onProgress:i.onProgress,onComplete:i.onComplete,onFailure:i.onFailure})},function(e){e&&F.push(e),F.length&&L<5&&(L++,B(F.shift()))});function J(e){return{input_physical_ids:e,label:y("R3MPIMwebIsr"),primitives:[{navigate_to_rel:{id:1,filter:{bo_type:["dsc_Result_Category_Ref"]}}},{navigate_to_rel:{id:2}}],patterns:{itfCtxt:[{id:1},{id:2}]},fileAttributes:[],attributes:["ds6wg:simitfsimulation.v_itf_executionstatus"],version:3}}function q(e,i){var n={simPid:e,nbOK:0,nbKO:0};I({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",timeout:6e4,data:J(e),onComplete:function(e){let t=e.result[0];if(!t||0===Object.keys(t.outputs).length)return void i({status:"KO",issues:{},tasks:{}});let o=(t.outputs.itfCtxt||[]).map((function(e){return e.physicalid})),r=[];if(0!==o.length){n.nbTotalItf=o.length;for(var a=Math.floor((o.length-1)/500)+1,s=0,u=[];s<a;)W({ctxIDs:o.slice(500*s,500*(s+1)),type:"MetricIssue",onComplete:function(e){var t=[];e.result.forEach((function(e){if(e.outputs&&e.outputs.ms&&1===e.outputs.ms.length){if(r.indexOf(e.outputs.ms[0].physicalid)>-1)return;r.push(e.outputs.ms[0].physicalid)}t.push(e.input_object.physicalid)})),l({itfIDs:t})},onFailure:function(){}}),s++}else i({status:"KO",issues:{},tasks:{}});function l(e){var t,n,a;u.push.apply(u,e.itfIDs),t=r,n=i,a=u.length/o.length,j(x(t)).then((function(e){let t={},i={};Object.keys(e).forEach((function(n){-1!==Object.keys(e[n]).indexOf("issue")&&e[n].issue.forEach((function(e){t[e.id]=e})),-1!==Object.keys(e[n]).indexOf("task")&&e[n].task.forEach((function(e){i[e.id]=e}))})),n({status:"OK",issues:t,tasks:i,completed:parseInt(100*a)})}))}},onFailure:function(){}})}function z(e){return new Promise((function(i){I({url:t.get3DSpaceUrl()+"/resources/dictionary/getTypeInfo",method:"POST",data:[e],onComplete:function(t){Object.keys(t).forEach((function(t){-1===u[e].indexOf(t)&&u[e].push(t)})),i()},onFailure:i})}))}function K(){return c?Promise.resolve():(l={},a={},s={"ds6w:type":{},"ds6w:status":{},"ds6wg:dmuvalidationvalidation.v_validationstate":{},"ds6w:priority":{}},u={DMUValidationValidation:["DMUValidationValidation"],SIMItfSimulation:["SIMItfSimulation"],Markup:["Markup"],DMUMarkupRepReference:["DMUMarkupRepReference"],DesignSight:["DesignSight"]},Promise.all([z("DMUValidationValidation"),z("SIMItfSimulation"),new Promise((function(e){i.getResourcesInfo(d.join(","),{tenantId:t.getPlatformId(),lang:t.getLang(),apiVersion:"R2019x",onComplete:function(t){(t||[]).forEach((function(e){a[v[e.curi]]=e.label})),a.validState=r.validState,a.analysisState=r.analysisState,a.r3mIssueName=r.r3mIssueName,a.r3mIssueApprovals=r.r3mIssueApprovals,a.r3mIssuePriority=r.r3mIssuePriority,a.r3mIssueResolvedBy=r.r3mIssueResolvedBy,a.r3mReviewMemberContribution=r.r3mReviewMemberContribution,a.r3mTaskCandiAssignment=r.r3mTaskCandiAssignment,a.r3mTaskFinDate=r.r3mTaskFinDate,a.r3mTaskDuration=r.r3mTaskDuration,a.r3mAssignees=r.r3mAssignees,e(a)},onFailure:function(){d.forEach((function(e){a[v[e]]=e})),e(a)}})})),S({"ds6w:type":["SIMItfSimulation","DMUValidationValidation","Markup","DMUMarkupRepReference","VPMReference","Requirement","DMUValidationExposedPresentation","Member List","Drawing","ENOStrRefinementSpecification","DMUValidationCheck"],"ds6w:organizationResponsible":["MyCompany","My Company","Company Name"],"ds6w:status":["VPLM_SMB_Evaluation.PRIVATE","VPLM_SMB_Evaluation.IN_WORK","VPLM_SMB_Evaluation.FROZEN","VPLM_SMB_Evaluation.RELEASED","VPLM_SMB_Evaluation.OBSOLETE","VPLM_SMB_Definition.PRIVATE","VPLM_SMB_Definition.IN_WORK","VPLM_SMB_Definition.FROZEN","VPLM_SMB_Definition.RELEASED","VPLM_SMB_Definition.OBSOLETE","VPLM_SMB_Evaluation_MajorRev.PRIVATE","VPLM_SMB_Evaluation_MajorRev.IN_WORK","VPLM_SMB_Evaluation_MajorRev.FROZEN","VPLM_SMB_Evaluation_MajorRev.RELEASED","VPLM_SMB_Evaluation_MajorRev.OBSOLETE","VPLM_SMB_Definition_MajorRev.PRIVATE","VPLM_SMB_Definition_MajorRev.IN_WORK","VPLM_SMB_Definition_MajorRev.FROZEN","VPLM_SMB_Definition_MajorRev.RELEASED","VPLM_SMB_Definition_MajorRev.OBSOLETE"],"ds6w:priority":["Low","Medium","High","Urgent"]})]).then((function(){c=!0})))}t.onTenantModified((()=>{c=!1,K().then((()=>h.forEach((e=>e()))))}));var X=Object.create({}),G=Object.getPrototypeOf(X);return Object.defineProperty(G,"_NB_SEARCH_RESULTS",{get:()=>m,set:e=>{m=e}}),G.getColumnsNls=function(){return K().then((function(){return a}))},G.getRvwTypes=function(){return[].concat(u.DMUValidationValidation)},G.getIsrTypes=function(){return[].concat(u.SIMItfSimulation)},G.getMkpTypes=function(){return[].concat(u.Markup)},G.getNewMkpTypes=function(){return[].concat(u.DMUMarkupRepReference)},G.getMsrTypes=function(){return[].concat(u.DesignSight)},G.getMaturityNlsValue=e=>s["ds6w:status"][e]||"",G.getValidStateNlsValue=e=>r["validState"+e],G.getAnalysisStateNlsValue=e=>r["analysisState"+e],G.updateCheckStateValue=P,G.search=function(e,i,o){let a=[],u=new n((function(n){if(_++,!(e.rvw||e.isr||e.mkp||e.msr||e.isOnlyRvw))return i({},0),void n();!function u(l,c,f){var g={query:e.isOnlyRvw?C(l):R(l),locale:t.getLang(),tenant:t.getPlatformId(),nresults:m,label:y("R3MwebSearch_"+_),select_predicate:d,select_file:p,with_synthesis:!1,with_synthesis_attribute:!1,with_nls:!0,login:{"3dspace":{SecurityContext:t.getSecurityContext()}},source:["3dspace"]};g[0===c?"start":"next_start"]=c,a.push(I({url:t.get3DSearchUrl()+"/search",method:"POST",data:g,onComplete:function(t){var o={};(t.results||[]).forEach((function(e){if(e&&e.attributes){var t={};e.attributes.forEach((function(e){var i=(e.name||"bug").split("/"),n=i[i.length-1];if(v[n])if("ds6w:type"===n)t.type=e.value,t.typeDisp=e.dispValue;else if("ds6w:status"===n){t.maturity=e.value;var o=s["ds6w:status"][e.dispValue||e.value];t.maturityDisp=o||(e.dispValue||e.value)}else"ds6wg:dmuvalidationvalidation.v_validationstate"===n?(t.validState=e.value,t.validStateDisp=r["validState"+e.value]):"ds6wg:dmuvalidationvalidation.V_Validation_RestrictedEdition"===n?(t.restrictedEdition=e.value,t.restrictedEditionDisp=e.dispValue||e.value):"bo.SIMItfSimulation.V_ValidationState"===n?(t.validState=e.value,t.validStateDisp=r["validState"+e.value]):"ds6wg:simitfsimulation.v_itf_executionstatus"===n?t.executionState=e.value:"ds6w:organizationResponsible"===n?(t.organization=e.value,t.organizationDisp=s["ds6w:organizationResponsible"][e.dispValue||e.value],t.organizationDisp=t.organizationDisp?t.organizationDisp:e.dispValue||e.value):t[v[n]]=e.dispValue||e.value})),t.analysisState="unknown",t.analysisStateDisp="",t.analysisStateNbKO=0,t.analysisStateProgress=0,t.r3massignees="",t.ownerImg=b(t.ownerid),t.originatorImg=b(t.originatorid),t.id&&(o[t.id]=t)}})),i(o,f),t.infos.nresults?u(e,t.infos.next_start,++f):n()},onFailure:function(){o(),n()}}))}(e,0,0)}));return u.promise.then((e=>(e&&a.forEach((e=>e.cancel())),e))),u},G.getDOSDownloadUrl=function(e,i){var n={method:"POST",headers:{Accept:"*/*","Content-Type":"application/json"}};n.data=JSON.stringify([e]),n.onComplete=function(e){i(JSON.parse(e)[0].url)},n.onFailure=function(){i(null)},require("DS/WAFData/WAFData").authenticatedRequest(t.getDOSUrl()+"/webservices/batch/fileurls",n)},G.getUserInfo=function(e){return new Promise((function(i){I({url:t.get3DSpaceUrl()+"/resources/modeler/pno/person/"+e,method:"GET",securityContext:t.getSecurityContext(),onComplete:function(e){i(e)},onFailure:function(){i(null)}})}))},G.fetchContext=function(e,t,i){return new Promise((n=>{if(0===e.ids.length&&0===e.uris.length)return t(),n();function o(){if(0===e.uris.length)return n();D({url:"enovia/resources/r2v/modeler/v2/i3dx/fetch",serviceId:"r2vsurvey",doNotSetSecurityContextInUrl:!0,config:{verb:"POST",data:{data:[{"ds6w:i3dx":e.uris[0]}]}},onSuccess:function(e){t(JSON.stringify({...JSON.parse(e),serviceId:"r2vsurvey"})),n()},onFailure:function(){i(),n()}})}e.ids.length>=1?D({url:"cvservlet/fetch/v2",config:{verb:"POST",data:{physicalid:e.ids,label:"M3DFetchForCreated"+Date.now(),select_predicate:d,select_file:p}},onSuccess:function(e){t(e),o()},onFailure:function(){i(),n()}}):o()}))},G.getReviewInfo=k,G.getValuesNls=function(e,t){return s[e]?s[e][t]:""},G.getUserImage=b,G.getReviewAttributes=function(e){return new Promise((function(i){I({url:t.get3DSpaceUrl()+"/resources/v1/collabServices/attributes/op/read",method:"POST",securityContext:t.getSecurityContext(),data:{lIds:e,relIDs:[],busIDs:[],plmparameters:"false",attributes:"true",navigateToMain:"false",readonly:"true"},onComplete:function(e){i(e)},onFailure:function(){i(null)}})}))},G.evalAnalysisStatus=function(e,i,n){!function(e,i,n){var o={simPid:e,nbTotalItf:0,nbOK:0,nbKO:0,nbPrev:0};I({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",timeout:6e4,data:J(e),onComplete:function(t){let r=t.result[0];if(!r||0===Object.keys(r.outputs).length)return r.input_object["ds6wg:simitfsimulation.v_itf_executionstatus"]&&(o.ExecStatus=r.input_object["ds6wg:simitfsimulation.v_itf_executionstatus"]),void i({status:"success",output:[o]});let a=(r.outputs.itfCtxt||[]).map((function(e){return e.physicalid})),s=[];o.ExecStatus=r.input_object["ds6wg:simitfsimulation.v_itf_executionstatus"],0===a.length&&i({status:"success",output:[o]}),o.nbTotalItf=a.length;for(var u=Math.floor((a.length-1)/500)+1,l=0,c=[],d=!1;l<u&&!d;)W({ctxIDs:a.slice(500*l,500*(l+1)),onComplete:function(t){var r,u=[];t.result.forEach((function(e){if(u.push(e.input_object.physicalid),e.input_object&&"1"!==e.input_object["bo.SIMItfContextOfInterference.V_Context_Validity_Status"])o.nbTotalItf--;else if(e.outputs&&e.outputs.ms&&1===e.outputs.ms.length){if(s.indexOf(e.outputs.ms[0].physicalid)>-1)return void o.nbTotalItf--;s.push(e.outputs.ms[0].physicalid);let t=e.outputs.ms[0];"5"===t["bo.PLMPIMMetricReference.V_Itf_Type"]||"6"===t["bo.PLMPIMMetricReference.V_Itf_Type"]?o.nbTotalItf--:"1"===t["bo.PLMPIMMetricReference.V_Itf_Analysis"]?o.nbOK++:"2"===t["bo.PLMPIMMetricReference.V_Itf_Analysis"]?o.nbKO++:"5"===t["bo.PLMPIMMetricReference.V_Itf_Analysis"]&&o.nbPrev++}})),r={itfIDs:u},d&&i({status:"failure",simIds:[e]}),c.push.apply(c,r.itfIDs),c.length===a.length?i({status:"success",output:[o]}):n(e,a.length,c.length)},onFailure:function(){i({status:"failure",simIds:[e]}),d=!0}}),l++},onFailure:function(){i({status:"failure",simIds:[e]})}})}(e.id,i,n)},G.getRvwFromValidatedObject=function(e){return new Promise((function(i){var n;(n=function(e){return{input_physical_ids:e,label:y("R3MwebRvwFromVal"),primitives:[{navigate_from_sr:{id:1,filter:{semantics:["5"],role:["110"]},mode:"ends"}},{navigate_from_rel:{id:2,filter:{rel_type:["VPLMrel/PLMConnection/V_Owner"],bo_type:["DMUValidationValidation"]}}}],patterns:{review:[{id:1},{id:2}]},fileAttributes:p,attributes:f,version:3}}(e),new Promise((function(e){I({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",data:n,onComplete:function(t){e(t)},onFailure:function(){e({})}})}))).then((e=>{i(e)}))}))},G.evalMetricIssueCells=function(e,t){q(e,t)},G.evalIssueCells=function(e,i){for(var n=[],o=0;o<e.length;o++)n.push({id:o,method:"GET",url:"resources/issues/"+e[o]});I({url:t.get3DSpaceUrl()+"/resources/issues/batch",securityContext:t.getSecurityContext(),method:"POST",data:{requests:n},onComplete:function(t){t.results.forEach((function(e){e.body.assignees.forEach((function(e){b(e.user)}))})),i(t,l,e)},onFailure:function(){i({results:[]},e)}})},G.evalTaskCells=function(e,i){I({url:t.get3DSpaceUrl()+"/resources/v1/modeler/tasks/",securityContext:t.getSecurityContext(),method:"GET",onComplete:function(t){var n={};t&&void 0!==t.data&&t.data.length>0&&t.data.some((function(t){t.id===e[0]&&(n=t)})),i(n,l,e)},onFailure:function(){i({results:[]},e)}})},G.getIndexingTimestamp=function(){return new Promise((function(e){I({url:t.get3DSpaceUrl()+"/cvservlet/indexingdate",securityContext:t.getSecurityContext(),method:"POST",data:{select_service:["FTS","EXPAND"]},onComplete:function(t){e(t)},onFailure:function(){e({})}})}))},G.getR2VActivityInfo=function(i){return new Promise((function(n){(function(i){return new Promise(((n,o)=>{e.authenticatedRequest(t.getR2VPlatformUrl(i.serviceId)+"/enovia/resources/r2v/modeler/v2/activity/"+i.objectId,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},timeout:6e4,onComplete:function(e){let t=JSON.parse(e);n(t)},onFailure:o,onTimeout:o})}))})(i).then((e=>{n(e)}))}))},G.getR3MRootStats=function(e){return new Promise((function(i){var n,o,r,a,s;(o=e,r=[{physical_id_path:[o.rootPhID]}],a={descending_condition:{uql:"availability:2"},descending_condition_object:{uql:'[ds6w:globaltype]:"ds6w:Document" OR [ds6w:globaltype]:"ds6w:Part"'},descending_condition_relation:{uql:"NOT (flattenedtaxonomies:'reltypes/XCADBaseDependency')"}},s=[{truncate:{max_distance_from_prefix:0,prefix_filter:{prefix_path:r}}}],n={batch:{expands:[{label:y("R3MwebGetRootStats_ProgressiveExpand_Synthesis"),root:{physical_id:o.rootPhID},filter:{all:1},graph:a,aggregation_processors:[{synthesis:{name:"ProgressiveExpand_LeafSynthesis",mode:"tree_leaf",synthesis_only:1}}]},{label:y("R3MwebGetRootStats_ProgressiveExpand_Expand0"),root:{physical_id:o.rootPhID},filter:{prefix_filter:{prefix_path:r}},graph:a,aggregation_processors:s}]},outputs:{select_object:["physicalid","ds6w:type","ds6w:globalType","ds6w:label"],synthesis:["ProgressiveExpand_LeafSynthesis"]}},new Promise((function(e){I({url:t.get3DSpaceUrl()+"/cvservlet/progressiveexpand/v2",securityContext:t.getSecurityContext(),outputFormat:"cvjson",method:"POST",data:n,onComplete:function(t){e(t)},onFailure:function(){e({})}})}))).then((e=>{i(e)}))}))},G.navigateFromIsrToContext=function(e){return new Promise((function(i){var n;(n=e,new Promise((function(e){I({url:t.get3DSpaceUrl()+"/resources/pimauthoring/service/readItfSimulationContent",securityContext:t.getSecurityContext(),method:"POST",data:Array.isArray(n.isrID)?n.isrID:[n.isrID],onComplete:function(t){e(t)},onFailure:function(){e({})}})}))).then((e=>{i(e)}))}))},G.onTenantModified=function(e){h.push(e)},G.navigate=function(e){var t,i=[e.rvwIds.length?j((t=e.rvwIds,{input_physical_ids:t,label:y("R3MwebRvw"),primitives:[{navigate_to_rel:{id:1,filter:{rel_type:["VPLMrel/PLMConnection/V_Owner"]}}},{navigate_to_sr:{id:2,filter:{semantics:["1"],role:["78"]}}},{navigate_to_sr:{id:3,filter:{semantics:["5"],role:["110"]},mode:"path"}},{navigate_to_sr:{id:4,filter:{semantics:["5"],role:["151"]},mode:"path"}},{navigate_to_rel:{id:5,filter:{rel_type:["VPLMrel/PLMConnection/V_Owner"],bo_type:["DMUValidationCheck"]}}},{navigate_to_rel:{id:6,filter:{rel_type:["VPLMrel/PLMPort/V_Owner"],bo_type:["DMUValidationExposedPresentation"]}}},{navigate_from_rel:{id:7,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}},{navigate_to_rel:{id:8,filter:{rel_type:["VPLMrel/PLMConnection/V_Owner"],bo_type:["DMUValidationUser"]}}},{navigate_to_sr:{id:9,filter:{semantics:["1"],role:["621"]}}},{navigate_to_sr:{id:10,filter:{semantics:["1"],role:["622"]}}},{navigate_to_sr:{id:11,filter:{semantics:["1"],role:["623"]}}},{navigate_to_sr:{id:12,filter:{semantics:["1"],role:["624"]}}},{navigate_from_rel:{id:13,filter:{rel_type:["Reference Document"],bo_type:["Task"]}}}],patterns:{context:[{id:1},{id:2}],validatedPath:[{id:1},{id:3}],check:[{id:5}],checked:[{id:1},{id:4}],highlight:[{id:6}],issue:[{id:7}],contribution:[{id:8}],coordinators:[{id:8},{id:9}],assignees:[{id:8},{id:10}],contributors:[{id:8},{id:11}],informeduser:[{id:8},{id:12}],task:[{id:13}]},fileAttributes:p,attributes:f,version:3})):Promise.resolve({}),e.isrIds.length?j(x(e.isrIds)):Promise.resolve({}),e.mkpIds.length?j(O(e.mkpIds)):Promise.resolve({}),e.newMkpIds.length?j(O(e.newMkpIds)):Promise.resolve({}),e.msrIds.length?j(E(e.msrIds)):Promise.resolve({})];return Promise.all(i)},X})),define("DS/DMUwebR3Mutils/DMUwebR3MCsiServices",["UWA/Core","DS/WAFData/WAFData","DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils"].concat([]),(function(e,t,i){"use strict";let n=()=>i.get3DSpaceUrl(),o=()=>i.getPlatformId(),r=()=>i.getSecurityContext();function a(e){return t.authenticatedRequest(e.url,{method:e.method,headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:e.securityContext},data:JSON.stringify(e.data),timeout:e.timeout,onComplete:e.onComplete,onFailure:e.onFailure,onTimeout:e.onTimeout||e.onFailure})}function s(t){var i=e.Promise.deferred();return require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"].concat([]),(function(n){new Promise((function(e){n.getGrantedRoles((function(t){e(t.some((function(e){return"ICS"===e.id||1===window.top.__PIM_ICSRoleBypass})))}))})).then((function(n){n?function(t,i){var n=e.Promise.deferred();return require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"].concat([]),(function(e){e.getServiceUrl({serviceName:t,platformId:i,onComplete:function(e){n.resolve(e)},onFailure:function(e){n.reject(new Error(e))}})})),n.promise}("djc",t).then((function(e){var t=e+"/api";i.resolve(t)})):i.resolve("undefined")}))})),i.promise}function u(t,i,n,r){var a=e.Promise.deferred();let u=o(),l=Object.assign({},t);return l.method=i,s(u).then((function(e){l.url=e+n,r&&(l.data=r),a.resolve(l)})),a.promise}return{_computeIsr:function(e){u({onFailure:e.onFailure,onComplete:function(t){var i=JSON.parse("string"==typeof t?t:null);if(!i||!i.jobID||0!==i.status||"OK"!==i.message)return e.onFailure();e.onComplete(i)}},"POST","/v1/job/submit/interference",e.data).then((function(e){return a(e)}))},_getComputeIsrJobStatus:function(e){u({onFailure:e.onFailure,onComplete:function(t){var i=JSON.parse("string"==typeof t?t:null);if(!i||!i.jobID||0!==i.status||"OK"!==i.message)return e.onFailure();e.onComplete(i)}},"GET","/v1/job/status/"+e.data.jobID,null).then((function(e){return a(e)}))},_isUpdateSimulationAllowed:function(){var t=e.Promise.deferred();return s(o()).then((function(e){var i,n="";window&&window.widget&&(i=window.widget,e.contains("undefined")?t.resolve(!1):(i.data&&i.data.appId&&(n=i.data.appId),"ENOR3M_AP"!==n&&"ENOI3S_AP"!==n||t.resolve(!0))),t.resolve(!1)})),t.promise},_getIsrJobsList:function(e){u({onFailure:e.onFailure,onComplete:function(t){var i=JSON.parse("string"==typeof t?t:null);if(!i||0!==i.status)return e.onFailure();e.onComplete(i)}},"GET","/v1/job/list",null).then((function(e){return a(e)}))},_getIsrJobsListByPage:function(e){u({onFailure:e.onFailure,onComplete:function(t){var i=JSON.parse("string"==typeof t?t:null);if(!i||0!==i.status)return e.onFailure();e.onComplete(i)}},"POST","/v1/job/list",e.data).then((function(e){return a(e)}))},_getMaxTokensForIsrCompute:function(e){u({onFailure:e.onFailure,onComplete:function(t){var i=JSON.parse("string"==typeof t?t:null);if(!i||0!==i.status||"OK"!==i.message)return e.onFailure();e.onComplete(i)}},"GET","/v1/job/tokenscount/interference",null).then((function(e){return a(e)}))},_get3DSpaceUrlAndLoginTicket:function(i){var a=e.Promise.deferred(),s=i&&i.platformId?i.platformId:o();let u=n(s),l=r();return function(i,n,o){var r=e.Promise.deferred(),a=i+"/ticket/get?runasctx="+encodeURIComponent(n).trim();return o&&(a+="&tenant="+o),t.authenticatedRequest(a,{headers:{Accept:"application/json"},method:"GET",type:"json",onComplete:function(e){r.resolve(e.ticket)},onFailure:function(e){r.reject(new Error(e))}}),r.promise}(u,l,s).then((function(e){a.resolve({url:u,loginTicket:e})})),a.promise},_readComputeIsrPrefs:function(){return new Promise((function(e){let t=[{Repository:"PIMwebPref",PreferenceNames:["IDLinksAutomaticReroot","IDTrackPreviousAnalysisStatus"]}];require(["DS/CATWebUXPreferences/CATWebUXPreferencesUtils"].concat([]),(function(i){try{i.readPreferences(t).then((function(t){e(t)}))}catch(t){window.console.warn("Error Preferences ",t),e()}}))}))}}}));