define("DS/ViewPanel/ViewPanelController",["DS/VisuTools/SettingManager","DS/Visualization/ThreeJS_R57","DS/QualityManager/QMController"],(function(e,i,t){"use strict";return class{constructor(a,s){this._baseSettings={materialMode:!1,visuShadingFaceMode:"Shaded",visuShadingEdgeMode:"WithEdges",visuShadingMode:"ShadingEdges",visuEnv:"Basic",visuAppearanceMode:"BASIC",axisState:!1,linesState:!0,planesState:!1,pointsState:!1,smallCurvatureState:!0,verticesState:!0,visuOutlineMode:!1,projectionMode:0},a._useQM&&!i.AutomatedTests()&&(this._baseSettings.visuEnv="WhiteExperience",t.unknownOrVeryLowGPU||(this._baseSettings.visuAppearanceMode="GASLOOK")),(s=s||{}).defaultSettings=s.defaultSettings||{},s.uiConfig=s.uiConfig||{},this.viewer=a,this.defaultSettings={},Object.assign(this.defaultSettings,this._baseSettings),Object.assign(this.defaultSettings,s.defaultSettings),this._settingsManagerParams={useLocalStorage:void 0!==s.useLocalStorage&&s.useLocalStorage,useWidget:void 0===s.useWidget||s.useWidget,name:"VisuViewSettings",familyName:a._familyName,importFromOldLocalStorage:void 0!==s.importFromOldLocalStorage&&s.importFromOldLocalStorage};var n=s.uiConfig;this._viewModePanelUIParams={useShadingIllustration:void 0!==n.useShadingIllustration&&n.useShadingIllustration,useOutline:void 0===n.useOutline||n.useOutline},this._keyWriter=e.Write(this._settingsManagerParams),this._eventListeners=[]}_getWidgetSettings(){var i={};const t=this.defaultSettings;Object.assign(i,t),Object.assign(i,e.Struct(this._settingsManagerParams));const a=e.isEmptySettings(this._settingsManagerParams);if(this._settingsManagerParams.importFromOldLocalStorage&&a){var s=localStorage.getItem("visuEnv");s&&s.includes("OCA")&&(s=s.replace("OCA",""),i.visuEnv=s);var n=localStorage.getItem("projectionMode");n&&(i.projectionMode=parseInt(n,10));var o=localStorage.getItem("visuShadingMode");o&&(i.visuShadingMode=o);var d=localStorage.getItem("axisState");d&&(i.axisState="true"===d,i.planesState=i.axisState);var u=localStorage.getItem("linesState");u&&(i.linesState="true"===u,i.verticesState=i.linesState);var r=localStorage.getItem("pointsState");r&&(i.pointsState="true"===r)}const g=this._viewModePanelUIParams;return g.useShadingIllustration||(i.visuShadingFaceMode&&i.visuShadingFaceMode.includes("Illustration")&&(t.visuShadingFaceMode&&t.visuShadingFaceMode.includes("Illustration")?i.visuShadingFaceMode=this._baseSettings.visuShadingFaceMode:i.visuShadingFaceMode=t.visuShadingFaceMode),i.visuShadingMode&&i.visuShadingMode.includes("ShadingIllustration")&&(t.visuShadingMode&&t.visuShadingMode.includes("ShadingIllustration")?i.visuShadingMode=this._baseSettings.visuShadingMode:i.visuShadingMode=t.visuShadingMode)),g.useOutline||(i.visuOutlineMode=!1),this._keyWriter._fresh=void 0,i}init(e){var i,t=this.viewer,a=this._keyWriter,s=this._getWidgetSettings(),n=this.defaultSettings,o=this._eventListeners,d=this;i=t.onPreRenderFrame((function(){t.unsubscribe(i),o.push(t.onMaterialModeChange((function(){a.materialMode=t.getMaterialMode()!==!!n.materialMode?t.getMaterialMode():void 0}))),o.push(t.onVisuShadingFaceModeChange((function(){a.visuShadingFaceMode=t.getVisuShadingFaceMode()!==n.visuShadingFaceMode?t.getVisuShadingFaceMode():void 0}))),o.push(t.onVisuShadingEdgeModeChange((function(){a.visuShadingEdgeMode=t.getVisuShadingEdgeMode()!==n.visuShadingEdgeMode?t.getVisuShadingEdgeMode():void 0}))),o.push(t.onVisuShadingModeChange((function(){a.visuShadingMode=t.getVisuShadingMode()!==n.visuShadingMode?t.getVisuShadingMode():void 0}))),o.push(t.onVisuEnvChange((function(){var e=t.getVisuEnv();e.includes("OCA")&&(e=e.replace("OCA",""),a.visuEnv=e!==n.visuEnv?e:void 0)}))),o.push(t.onVisuAppearanceModeChange((function(){a.visuAppearanceMode=t.getVisuAppearanceMode()!==n.visuAppearanceMode?t.getVisuAppearanceMode():void 0}))),o.push(t.onAxisFilterChange((function(){a.axisState=t.getAxisFilter()!==!!n.axisState?t.getAxisFilter():void 0}))),o.push(t.onPlanesFilterChange((function(){a.planesState=t.getPlanesFilter()!==!!n.planesState?t.getPlanesFilter():void 0}))),o.push(t.onLinesFilterChange((function(){t.currentViewpoint._2DMode||(a.linesState=t.getLinesFilter()!==!!n.linesState?t.getLinesFilter():void 0)}))),o.push(t.onVerticesFilterChange((function(){t.currentViewpoint._2DMode||(a.verticesState=t.getVerticesFilter()!==!!n.verticesState?t.getVerticesFilter():void 0)}))),o.push(t.onSmallCurvatureEdgesFilterChange((function(){a.smallCurvatureState=t.getSmallCurvatureEdgesFilter()!==!!n.smallCurvatureState?t.getSmallCurvatureEdgesFilter():void 0}))),o.push(t.onPointsFilterChange((function(){t.currentViewpoint._2DMode||(a.pointsState=t.getPointsFilter()!==!!n.pointsState?t.getPointsFilter():void 0)}))),o.push(t._onVisuOutlineModeChange((function(){d._viewModePanelUIParams.useOutline&&(a.visuOutlineMode=t._getVisuOutlineMode()!==!!n.visuOutlineMode?t._getVisuOutlineMode():void 0)}))),o.push(t.onProjectionTypeChange((function(){t.currentViewpoint._2DMode||(a.projectionMode=t.currentViewpoint.getProjectionType()!==n.projectionMode?t.currentViewpoint.getProjectionType():void 0)}))),d._apply(s),e()}))}_apply(e){if(e){var t=this.viewer;if(void 0!==e.visuEnv){var a=e.visuEnv;a.includes("OCA")&&(a=a.replace("OCA",""));var s=t.getVisuEnv();s.includes("OCA")&&(s=s.replace("OCA","")),s!==a&&t.setVisuEnvOCA(a)}void 0!==e.materialMode&&t.setMaterialMode(e.materialMode),void 0!==e.visuShadingFaceMode&&t.setVisuShadingFaceMode(e.visuShadingFaceMode),void 0!==e.visuShadingEdgeMode&&t.setVisuShadingEdgeMode(e.visuShadingEdgeMode),void 0!==e.visuShadingMode&&t.setVisuShadingMode(e.visuShadingMode),void 0!==e.visuAppearanceMode&&t.setVisuAppearanceMode(i.DefaultAppearanceMode[e.visuAppearanceMode]),void 0!==e.pointsState&&t.setPointsFilter(e.pointsState),void 0!==e.axisState&&t.setAxisOnlyFilter(e.axisState),void 0!==e.planesState&&t.setPlanesFilter(e.planesState),void 0!==e.linesState&&t.setLinesFilter(e.linesState),void 0!==e.verticesState&&t.setVerticesFilter(e.verticesState),void 0!==e.smallCurvatureState&&t.getSmallCurvatureEdgesFilter(e.smallCurvatureState),void 0!==e.visuOutlineMode&&t._setVisuOutlineMode(e.visuOutlineMode),void 0!==e.projectionMode&&t.currentViewpoint.setProjectionType(e.projectionMode)}}apply(e){var i={};Object.assign(i,e||{}),this._apply(i)}static dumpSettings(e){return{materialMode:e.getMaterialMode(),visuShadingFaceMode:e.getVisuShadingFaceMode(),visuShadingEdgeMode:e.getVisuShadingEdgeMode(),visuShadingMode:e.getVisuShadingMode(),visuEnv:e.getVisuEnv(),visuAppearanceMode:e.getVisuAppearanceMode(),pointsState:e.getPointsFilter(),axisState:e.getAxisFilter(),planesState:e.getPlanesFilter(),linesState:e.getLinesFilter(),verticesState:e.getVerticesFilter(),smallCurvatureState:e.getSmallCurvatureEdgesFilter(),visuOutlineMode:e._getVisuOutlineMode(),projectionMode:e.currentViewpoint.getProjectionType()}}_updateViewPanelUIConfiguration(e){void 0!==e.useShadingIllustration&&(this._viewModePanelUIParams.useShadingIllustration=e.useShadingIllustration),void 0!==e.useOutline&&(this._viewModePanelUIParams.useOutline=e.useOutline);const i=this.viewer;this._viewModePanelUIParams.useOutline||i._setVisuOutlineMode(!1);const t=this.defaultSettings;this._viewModePanelUIParams.useShadingIllustration||(i.getVisuShadingMode()&&i.getVisuShadingMode().includes("ShadingIllustration")&&(t.visuShadingMode&&t.visuShadingMode.includes("ShadingIllustration")?i.setVisuShadingMode(this._baseSettings.visuShadingMode):i.setVisuShadingMode(t.visuShadingMode)),i.getVisuShadingFaceMode()&&i.getVisuShadingFaceMode().includes("Illustration")&&(t.visuShadingFaceMode&&t.visuShadingFaceMode.includes("Illustration")?i.setVisuShadingFaceMode(this._baseSettings.visuShadingFaceMode):i.setVisuShadingFaceMode(t.visuShadingFaceMode)))}restore(){this.apply(this._getWidgetSettings())}dispose(){for(var e=0;e<this._eventListeners.length;e++)this.viewer.unsubscribe(this._eventListeners[e]);this._eventListeners=[]}}}));var toto=function(){};toto();