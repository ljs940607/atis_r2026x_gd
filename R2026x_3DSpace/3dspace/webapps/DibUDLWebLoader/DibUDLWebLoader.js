define("DS/DibUDLWebLoader/DIFDecoratorClipping3D",[],(function(){"use strict";return class{constructor(e){this._description=e}getType(){return"clipping3D"}getDefinition(){return this._description}}})),define("DS/DibUDLWebLoader/DifSupplementalGeometryUDLWebLoader",["DS/Visualization/Node3D"],(function(e){"use strict";var t=function(t){var n="get_SupGeoRef_ObjectInternal",o=t.iRef;o||t.onFailure(n+" no iRef");var i=t.ioMap_ID_Node;i||t.onFailure(n+" no ioMap_ID_Node");var r=t.ioMap_ID_Obj;r||t.onFailure(n+" no ioMap_ID_Obj");var a=r.get(o.iD);a&&t.onSuccess(a);var s=i.get(o.Dif3DShapeInst.Dif3DShapeRepRef.iD);s||t.onFailure(n+" no ShapeNode");var l=i.get(o.Dif3DShapeInst.iD);l||(l=new e,i.set(o.Dif3DShapeInst.iD,l),l.addChild(s));var c=i.get(o.iD);c||(c=new e,i.set(o.iD,c),c.addChild(l));(a={}).iD=o.iD,a.Name=o.Name,a.Type="SupplementalGeometry";var d={};d.node3D=c,a.visuinfo=d,r.set(a.iD,a),t.onSuccess(a)},n=function(n){var o="get_SupGeoInstance_ObjectInternal",i=n.iInstance;i||n.onFailure(o+" no iInstance");var r=n.ioMap_ID_Node;r||n.onFailure(o+" no ioMap_ID_Node");var a=n.ioMap_ID_Obj;a||n.onFailure(o+" no ioMap_ID_Obj");var s=a.get(i.iD);s&&n.onSuccess(s);var l=r.get(i.iD);l||(l=new e,r.set(i.iD,l));(s={}).iD=i.iD,s.Name=i.Name,s.Type="SupplementalGeometryInstance",s.Childs=[];var c={};c.node3D=l,s.visuinfo=c;var d={iRef:i.SupGeoRef,ioMap_ID_Node:r,ioMap_ID_Obj:a,onSuccess:function(e){s.Name||(s.Name=e.Name),s.Childs.push(e),s.visuinfo.node3D?s.visuinfo.node3D.addChild(e.visuinfo.node3D):n.onFailure(o+" no node3D")},onFailure:function(e){console.log(e),n.onFailure(o)}};t(d),a.set(s.iD,s),n.onSuccess(s)};return{get_SupGeoRef_Object:function(e){return t(e)},get_SupGeoInstance_Object:function(e){return n(e)},Manage_SupGeo_Object:function(e){return function(e){var t="Manage_SupGeo_ObjectInternal",o=e.iFather;o||e.onFailure(t+" no iFather");var i=e.ioMap_ID_Node;i||e.onFailure(t+" no ioMap_ID_Node");var r=e.ioMap_ID_Obj;r||e.onFailure(t+" no ioMap_ID_Obj");var a=e.iObj_Father;a||e.onFailure(t+" no iObj_Father"),o.SupGeos&&o.SupGeos.forEach((function(o){n({iInstance:o,ioMap_ID_Node:i,ioMap_ID_Obj:r,onSuccess:function(n){a.Childs.push(n),a.visuinfo.node3D?a.visuinfo.node3D.addChild(n.visuinfo.node3D):e.onFailure(t+" no node3D")},onFailure:function(n){console.log(n),e.onFailure(t)}})})),e.onSuccess()}(e)}}})),define("DS/DibUDLWebLoader/UDLconsole",[],(function(){"use strict";return{logprint:function(e,...t){if("true"===sessionStorage.getItem("UDL_TRACES")){var n=(new Error).stack.split("\n")[3].trim().match(/at\s([^\s]+)\s/),o=n?n[1]:"";if(0===t.length)void 0!==e?console.groupCollapsed(`%c${o}`,e):console.groupCollapsed(`%c${o}`,"color: #000000; background-color: #7f827e; padding: 2px; border-radius: 3px;");else{var i=t[0];"string"==typeof i?(t.shift(),0===t.length?console.groupCollapsed(`%c${o} - %c${i}`,"color: #000000; background-color: #7f827e; padding: 2px; border-radius: 3px;",e):console.groupCollapsed(`%c${o} - %c${i}`,"color: #000000; background-color: #7f827e; padding: 2px; border-radius: 3px;",e,...t)):console.groupCollapsed(`%c${o}`,"color: #000000; background-color: #7f827e; padding: 2px; border-radius: 3px;",...t)}console.trace(),console.groupEnd()}},log:function(...e){this.logprint("color: #FFFFFF; background-color: #007BFF; padding: 2px; border-radius: 3px;",...e)},warn:function(...e){this.logprint("color: #FFFFFF; background-color: #E65405; padding: 2px; border-radius: 3px;",...e)},error:function(...e){this.logprint("color: #FFFFFF; background-color: #FF0000; padding: 2px; border-radius: 3px;",...e)},method:function(e){void 0!==e?this.logprint("color:  #FFFFFF; background-color: #"+e+"; padding: 2px; border-radius: 3px;"):this.logprint()}}})),define("DS/DibUDLWebLoader/UDLCache",["DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/DibWebUtils/DibQueryToolbox"],(function(e,t,n,o){"use strict";var i;return new class{constructor(){return i||(this._serverUrl=void 0,this._securityContext=void 0,this._map_ID_Obj=new Map,this._contextViewer,i=this)}setServerUrl(e){this._serverUrl=e}getServerUrl(){return this._serverUrl}setContextViewer(e){this._contextViewer=e}getContextViewer(){return this._contextViewer}setSecurityContext(e){this._securityContext=e}getSecurityContext(){return this._securityContext}setUDLComponent(e,t){this._map_ID_Obj.set(e,t)}getUDLComponent(e){return this._map_ID_Obj.get(e)}clearUDLSessionCache(){this._serverUrl=void 0,this._securityContext=void 0,this._map_ID_Obj.clear()}}})),define("DS/DibUDLWebLoader/UDLTools",["DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/DibWebUtils/DibQueryToolbox","DS/DibUDLWebLoader/UDLCache","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o,i,r){"use strict";var a={};a.DifType=function(e){const t={};for(const n of e)t[n]=n;return Object.freeze(t)}(["DIFLayout","DIFAnnotationSet","DIFSheet","DIFSheetInstance","DIFView","DIFViewInstance","DIFViewStream","DIFViewStreamInstance","DIFBackgroundViewRep","DIFBackgroundViewRepInstance","MBDView","MBDViewInstance","DIFCapture","DIFCaptureInstance","DIFSupplementalGeometry","DIFSupplementalGeometryInstance","DIF3DShape","DIF3DShapeInstance"]);var s=function(e){let t;return t="object"==typeof e&&null!==e&&e.type?e.type:e,t};return a.isDIFLayout=function(e){return s(e)===a.DifType.DIFLayout},a.isDIFAnnotationSet=function(e){return s(e)===a.DifType.DIFAnnotationSet},a.isDIFSheetInstance=function(e){return s(e)===a.DifType.DIFSheetInstance},a.isDIFSheet=function(e){return s(e)===a.DifType.DIFSheet},a.isDIFView=function(e){return s(e)===a.DifType.DIFView},a.isDIFViewInstance=function(e){return s(e)===a.DifType.DIFViewInstance},a.isDIFViewStream=function(e){return s(e)===a.DifType.DIFViewStream},a.isDIFViewStreamInstance=function(e){return s(e)===a.DifType.DIFViewStreamInstance},a.isDIFBackgroundViewRepInstance=function(e){return s(e)===a.DifType.DIFBackgroundViewRepInstance},a.isDIFBackgroundViewRep=function(e){return s(e)===a.DifType.DIFBackgroundViewRep},a.isMBDView=function(e){return s(e)===a.DifType.MBDView},a.isMBDViewInstance=function(e){return s(e)===a.DifType.MBDViewInstance},a.isDIFCapture=function(e){return s(e)===a.DifType.DIFCapture},a.isDIFCaptureInstance=function(e){return s(e)===a.DifType.DIFCaptureInstance},a.isDIFSupplementalGeometry=function(e){return s(e)===a.DifType.DIFSupplementalGeometry},a.isDIFSupplementalGeometryInstance=function(e){return s(e)===a.DifType.DIFSupplementalGeometryInstance},a.isDIF3DShape=function(e){return s(e)===a.DifType.DIF3DShape},a.isDIF3DShapeInstance=function(e){return s(e)===a.DifType.DIF3DShapeInstance},a._serverUrl,a._securityContext,a._map_ID_Obj,a.assignFetchedUDL=function(e){if(e.results)for(const t of e.results)if(Array.isArray(t.attributes)){let e="";for(const n of t.attributes)if("resourceid"===n.name&&(e=n.value),"udl"===n.name){let t=i.getUDLComponent(e);void 0!==t&&t.setUDL(n.value),r.log(t,n.value)}}},a.fetchUDLData=async function(e){return r.log(e),new Promise(((t,n)=>{const a={objectPhysicalid:e,serverUrl:i.getServerUrl(),securityContext:i.getSecurityContext(),onComplete:function(e){r.log("fetchUDLData onComplete",e),t(e)},onFailure:function(){r.log("fetchUDLData onFailure"),n()}};o.getUDLData(a)}))},a})),define("DS/DibUDLWebLoader/UDLComponent",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o,i,r){"use strict";return class{constructor(e){this.definition=e,this.type=e["ds6w:type"],this.ID=e.resourceid,this.father=null,this._node=null}instanceOf(){return this.type}setUDL(e){return 1===this.udl?0:(this.udl=1,this.udlurl=e,1)}addChild(e){return e||r.error("invalid argument"),!1}addFather(e){return e||r.error("invalid argument"),!1}getIdUDLtoFetch(e){let t=!0;if(0===this.udl){var n=this.ID;e.includes(n)||e.push(n)}return t=this.getChildrenIdUDLtoFetch(e),t}getChildrenIdUDLtoFetch(e){return!0}getIdCGRtoFetch(e,t,n){this._checkOnSuccessAndOnFailureFunction(t,n),n()}async createNode(e){r.warn("NOT IMPL")}getID(){return this.ID?this.ID:null}gettype(){return this.type?this.type:null}getfather(){return this.father?this.father:null}}})),define("DS/DibUDLWebLoader/Annotation_UDLWebLoader",["DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/PADServices/utils/GlobalUtils","DS/DibWebUtils/DibQueryToolbox","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o,i,r){"use strict";let a=()=>require("DS/PADUtils/PADUtilsServices").getPlatformId();var s=function(o){var i="loadAnnWithLinkInternal",r=o.textWithLink;r||o.onFailure(i+" no textWithLink");var a=o.ioMapDifObjStreamToLoadedNode;a||o.onFailure(i+" no ioMapDifObjStreamToLoadedNode");var s=o.ioMapAttName;s||o.onFailure(i+" no ioMapAttName");var l=o.ioMapResultString;l||o.onFailure(i+"no ioMapResultString");var d=o.ioAllSymbolInfos;if(d||o.onFailure(i+"no ioAllSymbolInfos"),"AnnWithLink"===r.Type&&""!==r.AttributeName){var u=s.get(r.AttributeName);u||(u=r.AttributeName);var D,h,f=new e;if(r.PLM_ref_ID){if(S=l.get(r.PLM_ref_ID)){var p=0,g=S.tabExpand.AttributeName;for(let e=0;e<g.length;e++)if(u===g[e]){D=S.tabExpand.ResultString[e],h=S.tabExpand.Modified[e],p=1;break}if(0===p&&S.tabEA.AttributeName){var b=S.tabEA.AttributeName;for(let e=0;e<b.length;e++)if(u===b[e]){D=S.tabEA.ResultString[e],h=S.tabEA.Modified[e],p=1;break}}if(0===p&&S.tabGA.AttributeName){var L=S.tabGA.AttributeName;for(let e=0;e<L.length;e++)if(u===L[e]){D=S.tabGA.ResultString[e],h=S.tabGA.Modified[e],p=1;break}}}}else if(r.Relation_ID){var S;(S=l.get(r.Relation_ID))&&(D=S.ResultString[0],h=S.Modified[0])}var I=r.FontName;if(r.FamilyFontName&&(I=r.FamilyFontName),"TRUE"===h){var m={text:D,hotspot:{x:0,y:0},font:I,color:(new t.Color).setRGB(r.Red/255,r.Green/255,r.Blue/255),fontSize:r.FontSize,bold:r.bold},v=n.createTextNode(m);f.addChild(v),c(f,12),a.set(r.ID,f)}else d.push([r,f])}o.onSuccess()},l=function(e){var t=o.getLang(),n=new Date(e);if(!isNaN(n.getTime()))return n=n.toLocaleDateString(t);var i=e.replace("@"," ").replace(":GMT"," GMT");return n=new Date(i),isNaN(n.getTime())?(console.error("Invalid date format:",e),null):n=n.toLocaleDateString(t)};function c(e,t){e.mesh3js?e.mesh3js.geometry.forEach((function(e){e&&e.drawingGroups&&e.drawingGroups.forEach((function(e){e&&(e._noZPriority=t)}))})):e.children.forEach((function(e){c(e,t)}))}var d=function(e){var t=e.data;t||e.onFailure(errText+" no data");var n=e.ioMapResultString;n||e.onFailure(errText+" no ioMapResultString");var i=0;t.forEach((function(r){var s,c,d=r.resourceid,u=r.mapPhysicalID;if(r.matches&&(u=r.matches[0].sr_id),d){var D=n.get(u);if(D){var h={},f=D.tabExpand.AttributeName,p=D.tabEA.AttributeName,g=D.tabGA.AttributeName,b=D.tabExpand.ResultString,L=D.tabEA.ResultString,S=D.tabGA.ResultString;if(0!==b.length)for(let e=0;e<b.length;e++){var I=f[e];r[I]&&(h[I]=[],h[I].push(r[I]))}if(0!==L.length)for(let e=0;e<L.length;e++){var m=p[e];r[m]&&(h[m]=[],h[m].push(r[m]))}if(0!==S.length){for(let e=0;e<S.length;e++){var v=S[e],w=g[e];if(r[w]){var F=r[w];F&&v!=F&&(D.tabGA.Modified[e]="TRUE",D.tabGA.ResultString[e]=F)}}n.set(u,D),++i===t.length&&e.onSuccess()}(s=h,c={},new Promise((function(e){require(["DS/FedDictionaryAccess/FedDictionaryAccessAPI"],(function(t){t.getNlsOfPropertiesValues(JSON.stringify(s),{tenantId:a(),lang:o.getLang(),onComplete:function(t){e(c=t)},onFailure:function(){e(c)}})}))}))).then((function(o){if(o&&0!=o.length){var r=0;for(let e=0;e<b.length;e++){var a=f[e],s=b[e],c=h[a];if(c)if(s!=(g=o[a][c]))if(r=1,D.tabExpand.Modified[e]="TRUE","modified"===a||"originated"===a){var d=l(g);D.tabExpand.ResultString[e]=d}else D.tabExpand.ResultString[e]=g}for(let e=0;e<L.length;e++){var g,S=p[e],I=(s=L[e],h[S]);if(I)s!=(g=o[S][I])&&(r=1,D.tabEA.Modified[e]="TRUE",D.tabEA.ResultString[e]=g)}1===r&&n.set(u,D),++i===t.length&&e.onSuccess()}}))}}else i++})),i===t.length&&e.onSuccess()};return{manageAnnWithLink:function(e){return function(e){var t="manageAnnWithLinkInternal";r.log(t+" -------------------\x3e");var n=e.textWithLink;n||e.onFailure(t+" no textWithLink");var o=e.ioTextsSrIds;o||e.onFailure(t+" no ioTextsSrIds");var i=e.ioTextsPointedIds;i||e.onFailure(t+" no ioTextsPointedIds");var a=e.ioMapAttName;a||e.onFailure(t+" no ioMapAttName");var s=e.ioMapResultString;if(s||e.onFailure(t+"no ioMapResultString"),"AnnWithLink"===n.Type&&""!==n.AttributeName){var l=a.get(n.AttributeName);l||(l=n.AttributeName);var c=n.ResultString;if(n.PLM_ref_ID){var d=n.PLM_ref_ID,u=n.PLM_ref_Type,D="FALSE";"ContextualLink"===d?D="TRUE":"ContextualLinkEA"===d?(D="TRUE",c=" ",u="ContextualLinkEA"):"GlobalAttribut"===d&&(D="TRUE"),"ContextualLinkEA"!=u&&"GlobalAttribut"!=u&&(u="ExpandQuery");var h=i.includes(d);h||i.push(d);var f=s.get(d);if(f)f&&((h=f.tabExpand.AttributeName.includes(l))||"ExpandQuery"!==u||(f.tabExpand.AttributeName.push(l),f.tabExpand.ResultString.push(c),f.tabExpand.Modified.push(D),f.tabExpand.IndexInTable.push(n.IndexInTable)),(h=f.tabEA.AttributeName.includes(l))||"ContextualLinkEA"!==u||(f.tabEA.AttributeName.push(l),f.tabEA.ResultString.push(c),f.tabEA.Modified.push(D),f.tabEA.IndexInTable.push(n.IndexInTable)),(h=f.tabGA.AttributeName.includes(l))||"GlobalAttribut"!==u||(f.tabGA.AttributeName.push(l),f.tabGA.ResultString.push(c),f.tabGA.Modified.push("TRUE"),f.tabGA.IndexInTable.push(n.IndexInTable)));else{var p={tabExpand:{AttributeName:[],ResultString:[],Modified:[],IndexInTable:[]},tabEA:{AttributeName:[],ResultString:[],Modified:[],IndexInTable:[]},tabGA:{AttributeName:[],ResultString:[],Modified:[],IndexInTable:[]}};"ContextualLinkEA"===u?(p.tabEA.AttributeName.push(l),p.tabEA.ResultString.push(c),p.tabEA.Modified.push(D),p.tabEA.IndexInTable.push(n.IndexInTable)):"GlobalAttribut"===u?(p.tabGA.AttributeName.push(l),p.tabGA.ResultString.push(c),p.tabGA.Modified.push("TRUE"),p.tabGA.IndexInTable.push(n.IndexInTable)):(p.tabExpand.AttributeName.push(l),p.tabExpand.ResultString.push(c),p.tabExpand.Modified.push(D),p.tabExpand.IndexInTable.push(n.IndexInTable)),f=p,s.set(d,f)}}else n.Relation_ID&&(o.push(n.Relation_ID),(p={AttributeName:[],ResultString:[],Modified:[],IndexInTable:[]}).AttributeName.push(l),p.ResultString.push(n.ResultString),p.Modified.push("FALSE"),p.IndexInTable.push(n.IndexInTable),s.set(n.Relation_ID,p))}r.log(t+" <-------------------"),e.onSuccess()}(e)},loadAnnWithLink:function(e){return s(e)},extractEAInfos:function(e){return function(e){var t="extractEAInfosInternal",n=e.queryPhysicalID;n||e.onFailure(t+" no queryPhysicalID");var o=e.mapPhysicalID;o||e.onFailure(t+" no mapPhysicalID");var i=e.data;i||e.onFailure(t+" no data");var r=e.ioPointedObj;if(r.resourceid=n,r.mapPhysicalID=o,r.ea_createdby=i.ea_createdby,i.ea_createdby_name&&(r.ea_createdby_name=i.ea_createdby_name),i.ea_createdby_mail&&(r.ea_createdby_mail=i.ea_createdby_mail),i.ea_releaseddate){var a=l(i.ea_releaseddate);a&&(r.ea_releaseddate=a)}if(i.ea_released){var s=0;i.ea_released.forEach((function(e){if(e){s++,r["ea_releasedby."+s]=e.ea_releasedby;var t="ea_releaseddate."+s,n=l(i.ea_releaseddate);n&&(r[t]=n),r["ea_releasedtask."+s]=e.ea_releasedtask,e.ea_releasedby_name&&(r["ea_releasedby_name."+s]=e.ea_releasedby_name),e.ea_releasedby_mail&&(r["ea_releasedby_mail."+s]=e.ea_releasedby_mail)}}))}if(i.ea_changestatusdate){var c=l(i.ea_changestatusdate);c&&(r.ea_changestatusdate=c)}if(i.ea_changestatusaction&&(r.ea_changestatusaction=i.ea_changestatusaction),i.ea_changestatus){var d=0;i.ea_changestatus.forEach((function(e){if(e){d++,r["ea_changestatusby."+d]=e.ea_changestatusby;var t="ea_changestatusdate."+d,n=l(i.ea_changestatusdate);n&&(r[t]=n),r["ea_changestatustask."+d]=e.ea_changestatustask,e.ea_changestatusby_name&&(r["ea_changestatusby_name."+d]=e.ea_changestatusby_name),e.ea_changestatusby_mail&&(r["ea_changestatusby_mail."+d]=e.ea_changestatusby_mail)}}))}i.ea_lastmodifiedby&&(r.ea_lastmodifiedby=i.ea_lastmodifiedby),i.ea_lastmodifiedby_name&&(r.ea_lastmodifiedby_name=i.ea_lastmodifiedby_name),i.ea_lastmodifiedby_mail&&(r.ea_lastmodifiedby_mail=i.ea_lastmodifiedby_mail),i.ea_lastmodifieddate&&(r.ea_lastmodifieddate=i.ea_lastmodifieddate),e.onSuccess()}(e)},extractGAInfos:function(e){return function(e){var t=e.ioPointedObj,n=o.getLang(),i=new Date;i||e.onFailure(errText+" no Date"),t.user=localStorage.getItem("lastUser"),t.time=i.toLocaleTimeString(n),t.date=i.toLocaleDateString(n),t.day=i.toLocaleDateString(n,{day:"2-digit",month:"2-digit"}),t.month=i.toLocaleDateString(n,{month:"2-digit",year:"numeric"}),t.year=i.getFullYear(),t.mapPhysicalID="GlobalAttribut",t.resourceid="GlobalAttribut",e.onSuccess()}(e)},extractInfos:function(e){return function(e){var t="extractInfosInternal",n=e.queryPhysicalID;n||e.onFailure(t+" no queryPhysicalID");var o=e.mapPhysicalID;o||e.onFailure(t+" no mapPhysicalID");var i=e.data;i||e.onFailure(t+" no data");var r=e.ioPointedObj;i.results&&i.results.forEach((function(e){var t=e.resourceid;if(t&&t===n)for(var o in e)r[o]=e[o]})),r.mapPhysicalID=o,e.onSuccess()}(e)},exploitText:function(e){return d(e)},queryWithSRId:function(e){return function(e){var t=e.difViewStreamID,n=e.textsSrIds,o=e.ioMapResultString,a="queryTextToDisplayWithSRId: ";t||(r.error(a+" Please provide view stream ID"),e.onFailure()),n||(r.error(a+" Please provide text relation ID"),e.onFailure()),o||(r.error(a+" Please provide text relation ID"),e.onFailure());var s=n.length;let l=[];for(var c=0;s--;){var d=n[s];if("undefined"!=d){var u=o.get(d);if(u){var D={difViewStreamId:t,textsSRId:d,textsAttr:u.AttributeName[0],serverUrl:e.serverUrl,securityContext:e.securityContext,onComplete:function(t){l.push(t),l.length+c===n.length&&(c=0,e.onSuccess(l))},onFailure:function(t){r.error(t+a+"Failed to retrieve query from SR ID"),c++,l.length+c===n.length&&(c=0,e.onSuccess(l))}};i.getPointedObjects(D)}}else c++,l.length+c===n.length&&(c=0,e.onSuccess(l))}}(e)},queryWithPointedId:function(e){return queryWithPointedIdInternal(e)},parseDate:function(e){return l(e)}}})),define("DS/DibUDLWebLoader/UDLObjectManager_Adapter",["DS/DibUDLWebLoader/UDLComponent","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n){"use strict";return class{constructor(e){this.UDLObjectMap=e.UDLObjectMap}instanceOf(){return"UDLObjectManager_Adapter"}createUDLObject(e){n.warn("NOT IMPLEMENTED")}async handleAllVisu(){n.warn("NOT IMPLEMENTED")}}})),define("DS/DibUDLWebLoader/UDLObject",["DS/Visualization/Node3D","DS/DibUDLWebLoader/UDLComponent","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o){"use strict";return class{constructor(t){this.type=t?.Type,this.cgrID=t?.cgr,this.cgrNode=new e,this.cgrTextID=t?.cgr_texts,this.cgrTextNode=null,this.cgrTextID&&(this.cgrTextNode=new e),this.node=null,this.objectInfo=null}instanceOf(){return"UDLObject"}getCGRToLoad(){return this.cgrID}handleVisu(){}}})),define("DS/DibUDLWebLoader/UDLObject_Annotation",["DS/Visualization/Node3D","DS/DibUDLWebLoader/UDLObject","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o){"use strict";return class extends t{constructor(e){super(e),this.planeID=e.Plane,this.ID=e?.ID}instanceOf(){return"UDLObject_Annotation"}handleVisu(){if(this.cgrNode&&this.cgrTextNode)this.node=new e,this.node.addchild(this.cgrNode),this.node.addchild(this.cgrTextNode);else if(this.cgrNode)this.node=this.cgrNode;else{if(!this.cgrTextNode)return o.error("no node to handle"),!1;this.node=this.cgrTextNode}}}})),define("DS/DibUDLWebLoader/UDLObject_TPSAnnotation",["DS/Visualization/Node3D","DS/DibUDLWebLoader/UDLObject","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o){"use strict";return class extends t{constructor(e){super(e),this.planeID=e.Plane,this.ID=e?.ID}instanceOf(){return"UDLObject_TPSAnnotation"}handleVisu(){if(this.cgrNode&&this.cgrTextNode)this.node=new e,this.node.addChild(this.cgrNode),this.node.addChild(this.cgrTextNode);else if(this.cgrNode)this.node=this.cgrNode;else{if(!this.cgrTextNode)return o.error("no node to handle"),!1;this.node=this.cgrTextNode}}}})),define("DS/DibUDLWebLoader/MBDViewUDLWebLoader",["DS/Visualization/Node3D","DS/DibUDLWebLoader/DifSupplementalGeometryUDLWebLoader"],(function(e,t){"use strict";var n=function(n){var o="get_MBDViewRef_ObjectInternal",i=n.iRef;i||n.onFailure(o+" no iRef");var r=n.ioMap_ID_Node;r||n.onFailure(o+" no ioMap_ID_Node");var a=n.ioMap_ID_Obj;a||n.onFailure(o+" no ioMap_ID_Obj");var s=a.get(i.iD);s&&n.onSuccess(s);i.viewStreamInstance.viewStream;var l=r.get(i.iD);if(!l){var c=new e;l=c,r.set(i.iD,l)}(s={}).ID=i.iD,s.Name=i.Name,s.Type="MBDView",s.Childs=[];var d={};d.node3D=l,s.visuinfo=d,i.tpsTexts&&i.tpsTexts.forEach((function(t){var n=r.get(t.iD);if(n){var o=r.get(t.plane);if(!o){o=new e;var i=t.plane;r.set(i,o),r.set(i+"A",o),l.addChild(o)}o.addChild(n)}}));var u={iFather:i,iObj_Father:s,ioMap_ID_Node:r,ioMap_ID_Obj:a,onSuccess:function(){console.log("Manage_SupGeo_Object Ok")},onFailure:function(e){console.log(e),n.onFailure(o)}};t.Manage_SupGeo_Object(u),a.set(s.ID,s),n.onSuccess(s)},o=function(t){var o="get_MBDViewInstance_ObjectInternal",i=t.iInstance;i||t.onFailure(o+" no iInstance");var r=t.ioMap_ID_Node;r||t.onFailure(o+" no ioMap_ID_Node");var a=t.ioMap_ID_Obj;a||t.onFailure(o+" no ioMap_ID_Obj");var s=a.get(i.iD);s&&t.onSuccess(s);var l=r.get(i.iD);l||(l=new e,r.set(i.iD,l));(s={}).ID=i.iD,s.Name=i.Name,s.Type="MBDViewInstance",s.Childs=[];var c={};c.node3D=l,s.visuinfo=c;var d={iRef:i.view,ioMap_ID_Node:r,ioMap_ID_Obj:a,onSuccess:function(e){s.Name||(s.Name=e.Name),s.Childs.push(e),s.visuinfo.node3D?s.visuinfo.node3D.addChild(e.visuinfo.node3D):t.onFailure(o+" no node3D")},onFailure:function(e){console.log(e),t.onFailure(o)}};n(d),a.set(s.ID,s),t.onSuccess(s)};return{get_MBDViewRef_Object:function(e){return n(e)},get_MBDViewInstance_Object:function(e){return o(e)},Manage_MBDView_Object:function(e){return function(e){var t="Manage_MBDView_ObjectInternal",n=e.iFather;n||e.onFailure(t+" no iFather");var i=e.ioMap_ID_Node;i||e.onFailure(t+" no ioMap_ID_Node");var r=e.ioMap_ID_Obj;r||e.onFailure(t+" no ioMap_ID_Obj");var a=e.iObj_Father;a||e.onFailure(t+" no iObj_Father"),n.MBDViews&&n.MBDViews.forEach((function(n){o({iInstance:n,ioMap_ID_Node:i,ioMap_ID_Obj:r,onSuccess:function(n){a.Childs.push(n),a.visuinfo.node3D?a.visuinfo.node3D.addChild(n.visuinfo.node3D):e.onFailure(t+" no node3D")},onFailure:function(n){console.log(n),e.onFailure(t)}})})),e.onSuccess()}(e)}}})),define("DS/DibUDLWebLoader/UDLCaptureInstance",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/DibUDLWebLoader/UDLComponent","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole","DS/DibUDLWebLoader/UDLCache"],(function(e,t,n,o,i,r,a,s,l){"use strict";return class extends r{constructor(e){super(e),this.view=null,this.scale=parseFloat(e["ro.DIFAbstractViewInstance.V_DIFScale"]),this.x=parseFloat(e["ro.DIFAbstractViewInstance.V_DIFPosX"]),this.y=parseFloat(e["ro.DIFAbstractViewInstance.V_DIFPosY"]),this.angle=parseFloat(e["ro.DIFAbstractViewInstance.V_DIFAngle"]),this.captureInstanceInfo={},this.captureInstanceInfo.ID=this.ID,this.captureInstanceInfo.Type="CaptureInstance",this.captureInstanceInfo.visuinfo={}}addFather(e){return e?a.isDIFSheet(e)||a.isDIFAnnotationSet(e)?(this.father=e,!0):(s.error(" obj not good type"),!1):(s.error("invalid argument"),!1)}addChild(e){return e?a.isDIFCapture(e)?(this.view=e,this.captureInstanceInfo.Name=e.definition["bo.PLMEntity.V_Name"],!0):(s.log(e.type+" obj child not supported"),!1):(s.error("invalid argument"),!1)}getChildrenIdUDLtoFetch(e){let t=!0;return this.view&&(t=this.view.getIdUDLtoFetch(e)),t}getCaptureInfo(){return this.captureInstanceInfo}async createNode(e,t){try{let s,d=new o,u=await this.view.createNode(d,t);d.addChild(u),s="OnReference"===this.view.scaleStatus?this.view.scale:this.scale;var n=new i.Matrix4;n.setPosition(new i.Vector3(this.x,this.y,0));var r=[Math.cos(this.angle)*s,Math.sin(this.angle)*s,0,-Math.sin(this.angle)*s,Math.cos(this.angle)*s,0,0,0,1];n.setRotation(r),d.setMatrix(n);var a=l.getContextViewer();if(null==a)e.addChild(d);else{var c=a.getController().getNode({id:this.view.ID});c?c.addChild(d):e.addChild(d)}let D=this.view.getCaptureInfo();return this.captureInstanceInfo.Childs=[],this.captureInstanceInfo.Childs.push(D),this.captureInstanceInfo.Name=D.Name,this.captureInstanceInfo.decorators=D.decorators,void(this.captureInstanceInfo.visuinfo.node3D=d)}catch(e){return void s.error(e.message)}}}})),define("DS/DibUDLWebLoader/UDLMBDViewInstance",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/DibUDLWebLoader/UDLComponent","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o,i,r,a){"use strict";return class extends i{constructor(e){super(e),this.view=null,this.scale=parseFloat(e["ro.DIFAbstractViewInstance.V_DIFScale"]),this.x=parseFloat(e["ro.DIFAbstractViewInstance.V_DIFPosX"]),this.y=parseFloat(e["ro.DIFAbstractViewInstance.V_DIFPosY"]),this.angle=parseFloat(e["ro.DIFAbstractViewInstance.V_DIFAngle"]),this.MBDViewInstanceInfo={},this.MBDViewInstanceInfo.ID=this.ID,this.MBDViewInstanceInfo.Type="MBDViewInstance"}addFather(e){return e?r.isDIFCapture(e)||r.isDIFAnnotationSet(e)?(this.father=e,!0):(a.error(" obj not good type"),!1):(a.error("invalid argument"),!1)}addChild(e){return e?r.isMBDView(e)?(this.view=e,this.MBDViewInstanceInfo.Name=e.definition["bo.PLMEntity.V_Name"],!0):(a.error("obj child not supported"),!1):(a.error("invalid argument"),!1)}getChildrenIdUDLtoFetch(e){let t=!0;return this.view&&(t=this.view.getIdUDLtoFetch(e)),t}async LoadMBD(){return this.view?this.view.LoadMBD():null}getAnnotatedProductNode(){return this.view?this.view.getAnnotatedProductNode():null}getFlatPartNode(){return this.view?this.view.getFlatPartNode():null}getSupportPlaneNode(e){return this.view?this.view.getSupportPlaneNode(e):null}getViewInfo(){return this.MBDViewInstanceInfo}}})),define("DS/DibUDLWebLoader/DraftingUDLWebLoader",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/Visualization/ModelLoader","DS/Visualization/MaterialManager","DS/Visualization/ThreeJS_DS","DS/DibWebUtils/DibQueryToolbox","DS/Visualization/RenderStyle","DS/Visualization/PathElement","DS/Visualization/SceneGraphFactory","DS/DibUDLWebLoader/UDLconsole","DS/DibUDLWebLoader/Annotation_UDLWebLoader"],(function(e,t,n,o,i,r,a,s,l,c,d,u,D){"use strict";return t.extend({init:function(){var e,t,d,h,f,p,g=new Map,b=new Map,L=[],S=[],I=0,m=-1,v=0,w=0,F=0,U=new Map,y=new Map,_=new Map,C=new Map,M="toto",A=new Map,V=new Map;_.set("current","ds6w:status"),_.set("policy","ds6w:policy"),_.set("project","ds6w:project"),_.set("responsible","ds6w:responsible"),_.set("reservedby","ds6w:reservedby"),_.set("reserved","ds6w:reserved"),_.set("revision","ds6wg:majorrevision"),_.set("V_Name","bo.PLMEntity.V_Name"),_.set("PLM_ExternalID","bo.PLMEntity.PLM_ExternalID"),_.set("V_description","bo.PLMEntity.V_description"),_.set("V_versionComment","bo.PLMReference.V_versionComment"),_.set("ea_releasedby","ea_releasedby.1");var T=function(e,t,n){var o="manageAnnotation",i=0,r=t.Views.length;0===r&&n(),t.Views.forEach((function(t){var a=C.get(t.ID).viewNode,s=0,l=[],c=[],d=M,h={AnnToLoad:[],TextLoaded:[],TableLoaded:[]};t.ObjectList&&(s=0,t.ObjectList.forEach((function(e){if("AnnWithLink"===e.Type){s++,h.AnnToLoad.push(e.ID);var t={textWithLink:e,ioTextsSrIds:l,ioTextsPointedIds:c,ioMapAttName:_,ioMapResultString:y,onSuccess:function(){u.log(o+" ManageAnnWithLink Ok")},onFailure:function(e){u.log(e),onFailure()}};D.manageAnnWithLink(t)}else"AnnTableWithLink"===e.Type&&(s++,h.AnnToLoad.push(e.ID),e.ObjectList.forEach((function(t){if("AnnWithLink"===t.Type){s++,h.AnnToLoad.push(e.ID);var n={textWithLink:t,ioTextsSrIds:l,ioTextsPointedIds:c,ioMapAttName:_,ioMapResultString:y,onSuccess:function(){u.log(o+" ManageAnnWithLink Ok")},onFailure:function(e){u.log(e),onFailure()}};D.manageAnnWithLink(n)}})))}))),h.AnnToLoad.length&&V.set(t.ID,h),s>0?R(e,t,d,s,l,c,(function(){P(t,a,(function(){u.log(o+"texts loaded OK"),++i===r&&n()}))}),(function(){u.log(o+" view loaded / failed loadViewTexts "),++i===r&&n()})):(u.log(o+" No annotation to load"),++i===r&&n())}))},x=function(n,i,r,a){u.method();let s=[];U.clear(),C.clear(),A.clear(),V.clear(),y.clear();var l={viewToLoad:[],viewLoaded:[]},c=t[n];c.Views.forEach((function(e){var t=new o;s.push([e,t]);var n={viewNode:t,isLoaded:0};C.set(e.ID,n),l.viewToLoad.push(e.ID)})),l.viewToLoad.length&&A.set(c.ID,l),T(e,c,(function(){u.log("Annotation Loaded!!");var t=0;k(e,s,c.ID,i,(function(){++t>=s.length&&r()}))}))},P=function(e,t,n){e.ObjectList&&e.ObjectList.forEach((function(e){var n=new a.Matrix4;n.setPosition(new a.Vector3(e.SymbolCompToViewMatrix[4],e.SymbolCompToViewMatrix[5],0));var o=e.SymbolCompToViewMatrix[0],i=e.SymbolCompToViewMatrix[1],r=e.SymbolCompToViewMatrix[2],s=e.SymbolCompToViewMatrix[3];0===o&&0===r&&0===i&&0===s&&(o=1,s=1);var l=[o,r,0,i,s,0,0,0,1];n.setRotation(l);var c=U.get(e.ID);c&&(c.setMatrix(n),t.addChild(c))})),n()},N=async function(e,t,n){u.method();t.length;for(let o of t){await G(e,o[0],o[1]);o[2]?(U.set(o[0].ID,o[2]),o[2].addChild(o[1])):U.set(o[0].ID,o[1]),n()}},O=function(e,t,n){let o=Math.ceil(t.length/10);u.log("nbSymbol : "+t.length+" nbSymbByThread : "+o);for(let r=0;r<10;r++){var i=t.slice(o*r,o*(r+1));N(e,i,n)}},W=function(e,t,n,o){u.method();var i="extractInfosFromQuery",r={},a={queryPhysicalID:t,mapPhysicalID:n,data:e,ioPointedObj:r,onSuccess:function(){u.log(i+" ExtractInfos Ok"),o(r)},onFailure:function(e){u.log(e+i+"Failed to ExtractInfos")}};D.extractInfos(a)},j=function(e,t,n,o){u.method();var i="extractInfosFromQueryEA",r={},a={queryPhysicalID:t,mapPhysicalID:n,data:e,ioPointedObj:r,onSuccess:function(){u.log(i+" ExtractEAInfos Ok"),o(r)},onFailure:function(e){u.log(e+i+"Failed to ExtractEAInfos")}};D.extractEAInfos(a)},E=function(e,t,n,o,i){u.method();var r="manageTextToDisplay";if(t.length>0&&e){var a={difViewStreamID:e,textsSrIds:t,ioMapResultString:y,serverUrl:f,securityContext:p,onSuccess:function(e){u.log(r+" Failed to retrieve query with SR ID"),o(e)},onFailure:function(){u.log(message+r+"Failed to queryWithSRId"),i()}};D.queryWithSRId(a)}else n.length>0?function(e,t,n){u.method();var o="queryTextToDisplayWithPointedID";e||(u.log(o+"Please provide text relation ID"),n());var i=e.length,r=0;let a=[];for(var l=0;i--;)("ContextualLink"===(d=c=e[i])||"ContextualLinkEA"===d)&&(d=M),void 0!==d&&((h=y.get(c))?(0!=h.tabExpand.AttributeName.length&&l++,0!=h.tabEA.AttributeName.length&&l++,0!=h.tabGA.AttributeName.length&&l++):l++);for(i=e.length;i--;){var c,d;if(("ContextualLink"===(d=c=e[i])||"ContextualLinkEA"===d)&&(d=M),void 0!==d){var h,g=0,b=0,L=0;if((h=y.get(c))&&(0!=h.tabExpand.AttributeName.length&&(b=1),0!=h.tabEA.AttributeName.length&&(g=1),0!=h.tabGA.AttributeName.length&&(L=1)),h&&b){var S={objectPhysicalid:d,textsAttr:h.tabExpand.AttributeName,serverUrl:f,mappingPLMRefId:c,securityContext:p,onComplete:function(e,n,o){W(e,n,o,(function(e){a.push(e)})),a.length+r===l&&(r=0,t(a))},onFailure:function(e){u.log(e+o+" Failed to retrieve query with pointed ID"),r++,a.length+r===l&&(r=0,t(a))}};s.expandPointedObject(S)}if(h&&g&&(S={objectPhysicalid:d,serverUrl:f,mappingPLMRefId:c,securityContext:p,onComplete:function(e,n,o){j(e,n,o,(function(e){a.push(e)})),a.length+r===l&&(r=0,t(a))},onFailure:function(e){u.log(e+o+" Failed to retrieve query with pointed ID"),r++,a.length+r===l&&(r=0,t(a))}},s.getExtendedAttributes(S)),h&&L){var I={},m={ioPointedObj:I,onSuccess:function(){u.log("SUCCEEDED extractGAInfos Ok"),a.push(I),t(a)},onFailure:function(e){u.log(e+"Failed to extractGAInfos")}};D.extractGAInfos(m)}h||(u.log(o+"no tabResult"),r++,a.length+r===l&&t(a))}else r++,a.length+r===l&&t(a)}}(n,(function(e){o(e)}),(function(){u.log(r+" Failed to retrieve query with pointed ID"),i()})):(u.log(" Neither SR ID nor pointed ID to do the query"),i())},R=function(e,t,n,i,r,s,l,c){u.method();var d="loadViewTexts ";E(n,r,s,(function(n){!function(e,t,n){u.method(),e||(u.log("No data to exploit"),n());var o="exploitTextToDisplay",i={data:e,ioMapResultString:y,onSuccess:function(){u.log(o+" exploitTextToDisplay Ok"),t()},onFailure:function(e){u.log(e+o+"Failed to exploitTextToDisplay"),n()}};D.exploitText(i)}(n,(function(){!function(e,t,n){u.method();let i=[];var r="loadTextToDisplay";t.ObjectList&&t.ObjectList.forEach((function(e){if("AnnWithLink"===e.Type){var n={textWithLink:e,ioMapDifObjStreamToLoadedNode:U,ioMapAttName:_,ioMapResultString:y,ioAllSymbolInfos:i,onSuccess:function(){var n=V.get(t.ID);n&&n.TextLoaded.push(e.ID),u.log(r+" loadAnnWithLink Ok")},onFailure:function(e){u.log(e)}};D.loadAnnWithLink(n)}else if("AnnTableWithLink"===e.Type){e.ObjectList.forEach((function(e){if("AnnWithLink"===e.Type){var n={textWithLink:e,ioMapDifObjStreamToLoadedNode:U,ioMapAttName:_,ioMapResultString:y,ioAllSymbolInfos:i,onSuccess:function(){var n=V.get(t.ID);n&&n.TextLoaded.push(e.ID),u.log(r+" loadAnnWithLink Ok")},onFailure:function(e){u.log(e)}};D.loadAnnWithLink(n)}}));var a=new o;i.push([e,a]);var s=V.get(t.ID);s&&s.TableLoaded.push(e.ID)}})),0===i.length&&n(),O(e,i,n)}(e,t,(function(){var e=V.get(t.ID);let n=U.size;var o=0;e&&(o=e.TableLoaded.length,e.TextLoaded.length+o),o?i===n?function(e,t,n){u.method(),t.ObjectList&&(t.ObjectList.forEach((function(e){if("AnnTableWithLink"===e.Type){var t=U.get(e.ID);t&&(e.ObjectList.forEach((function(e){var n=U.get(e.ID);if(n){var o=new a.Matrix4;o.setPosition(new a.Vector3(e.XposInTable,e.YposInTable,0)),n.setMatrix(o),t.addChild(n)}})),n())}})),0===V.get(t.ID).TableLoaded.length&&n())}(0,t,l):i<n&&l():i<=n&&l()}))}),(function e(){u.log(d+"Failed in exploitTextToDisplay"),e()}))}),(function(){u.log(d+"Failed in manageTextToDisplay"),c()}))},k=async function(e,t,n,o,i){u.log("number of view "+t.length);for(let u of t){await G(e,u[0],u[1]);var r=u[0].ViewToSheetMatrix,s=new a.Matrix4;s.setPosition(new a.Vector3(r[4],r[5],0));var l=[r[0],r[2],0,r[1],r[3],0,0,0,1];s.setRotation(l),u[1].setMatrix(s),o.addChild(u[1]);var c=A.get(n),d=C.get(u[0].ID);d&&0===d.isLoaded&&(d.isLoaded=1,c.viewLoaded.push(u[0].ID)),i()}},G=function(e,t,n){return u.log(t.ID+" "+t.Name),new Promise((o=>{if(t.cgr){var s=t.cgr,l=e.find(s),c=new zip.BlobWriter,d=new a.Matrix4;d.setPosition(new a.Vector3(0,0,0));d.setRotation([1,0,0,0,1,0,0,0,1]),n.setMatrix(d);var D=new i,f=new r;D.setFileType("cgr"),D.setUDLMode(!0),D.set2DAccuracy(w),D.set3DAccuracy(F),D.setCGRWithBlanking(!0),f.displayBlankingPolygon(!0),1==I&&D.setSceneGraphOrderMode(1),1==m&&D.setLineTypes(h),D.setOnLoadedCallback((function(){u.log(t.ID+" "+t.Name),o()})),l.getData(c,(function(e){var t=new FileReader;t.onload=function(){let e={mode2D:!0};D.loadModelFromBuffer(this.result,n,e)},t.readAsArrayBuffer(e)}));var p=t.cgr_texts;if(""!==p&&void 0!==p){var g=e.find(p),b=new zip.BlobWriter;g.getData(b,(function(e){var t=new FileReader;t.onload=function(){let e={mode2D:!0};D.loadModelFromBuffer(this.result,n,e)},t.readAsArrayBuffer(e)}))}}else o()}))};this.getNumberOfSheets=function(){return u.method(),t.length},this.getSheetName=function(e){return u.method(),n=g.get(e),t[n].Name;var n},this.getLoadedSheetsId=function(){return u.method(),L},this.getSheetBackgroundColor=function(e){return u.method(),n=g.get(e),t[n].IsDetail?(o=d.SheetColorDetail[0],i=d.SheetColorDetail[1],r=d.SheetColorDetail[2]):(o=d.SheetColorView[0],i=d.SheetColorView[1],r=d.SheetColorView[2]),(new a.Color).setRGB(o/255,i/255,r/255);var n,o,i,r},this.loadSheetInViewer=function(e){u.method(),function(e,n,i,r){if(u.method(),null===d)return u.log("No drawing loaded"),void r();if(e<0||e>=t.length)return u.log("Sheet number out of range"),void r();var a=b.get(e);if(a)return n.addNode(a),void i();var s=new o,D=s.createOverrideSetManager(),h=D.createSceneGraphOverrideSet();D.pushSceneGraphOverrideSet(h);var f=h.createOverride(new c([s])),p=new l({combineRenderMode:"IGNORE"});p.setFaceMode("MATERIAL"),f.setRenderStyle(p,!0),n.addNode(s),x(e,s,(function(){i()})),b.size>=v&&(b.delete(S[0]),S.splice(0,1)),S.push(e),b.set(e,s),i()}(g.get(e.sheetID),e.viewer,e.onComplete,e.onFailure)},this.getSheet3DNode=function(e){u.method(),function(e,n,i,r){if(u.method(),null===d)return u.log("No drawing loaded"),void r();if(e<0||e>=t.length)return u.log("Sheet number out of range"),void r();var a=b.get(e);if(a)return n(a),void i();var s=t[e].Views.length,D=new o,h=D.createOverrideSetManager(),f=h.createSceneGraphOverrideSet();h.pushSceneGraphOverrideSet(f);var p=f.createOverride(new c([D])),g=new l({combineRenderMode:"IGNORE"});g.setFaceMode("MATERIAL"),p.setRenderStyle(g,!0),n(D);var L=!1;x(e,D,(function(){var n=A.get(t[e].ID);n&&(s!==n.viewLoaded.length||L||(L=!0,i()))})),b.size>=v&&(b.delete(S[0]),S.splice(0,1)),S.push(e),b.set(e,D)}(g.get(e.sheetID),e.onSheetNodeCreated,e.onSheetLoaded,e.onFailure)},this.getSheetSize=function(e){return u.method(),{height:t[g.get(e)].Height,width:t[g.get(e)].Width}},this.setMaxSheetInCache=function(e){u.method(),v=e},this.isDetailSheet=function(e){return u.method(),t[g.get(e)].IsDetail},this.is3DObject=function(){return u.method(),!1},this.getSheetThumbnail=function(n){return u.method(),function(n,o,i){if(u.method(),null===d)return u.log("No drawing loaded"),void i();if(n<0||n>=t.length)return u.log("Sheet number out of range"),void i();if(!t[n].Thumbnail)return u.log("No sheet thumbnail available"),void i();var r=t[n].Thumbnail;if(r){var a=e.find(r);a?a.getBlob("image/PNG",(function(e){var t=window.URL.createObjectURL(e);o(t)})):i()}else i()}(g.get(n.sheetID),n.onComplete,n.onFailure)},this.setSheetPickingByView=function(e){u.method();var t=b.get(g.get(e.sheetID));null!==t&&t.children.forEach((function(t){t.traverse((function(n){t!=n&&n.setPickParent(e.pickingByView)}),{},!1)}))},this.set2DAccuracy=function(e){u.method(),w=e},this.set3DAccuracy=function(e){u.method(),F=e},this.clearLoader=function(){u.method(),e&&(e.closeZipReader(),e=null),null,t=null,g=null,b=null,L=null,S=null,null,d=null,I=null,h=null,m=null,v=null,w=null,F=null,f=null,p=null},this.loadModel=function(o){u.method(),f=o.serverUrl,p=o.securityContext,M=o.objectPhysicalid,(e=new n.fs.FS).importHttpContent(o.UDLObjURL,!1,(function(){var n=e.find("DrwStructure.json");null!==n?n.getText((function(n){var i=JSON.parse(n.target.result);i.Drawing&&i.Drawing.Sheets&&i.Drawing.Sheets.forEach((function(e){if(e.Views){const t=[];for(const n of e.Views){let e=n.ID,o=!1;for(const n of t)if(n==e){o=!0;break}if(o){let e="";n.cgr&&(e=n.cgr.substring(0,n.cgr.length-4)),n.ID=e+"_"+n.Name}t.push(n.ID)}}})),I=i.DrawOrderMode,d=i.Drawing,function(t,n){if(-1==m){var o=d.LineTypeFile;if(o){var i=e.find(o);i?i.getText((function(e){h=JSON.parse(e.target.result),m=1,t()})):(m=0,t())}else m=0,t()}}((function(){t=d.Sheets,L=[],g.clear(),b.clear(),function(){var e=[],n=[],o=0;return t.forEach((function(t){t.IsDetail?n.push(o):e.push(o),o++})),n.forEach((function(t){e.push(t)})),e}().forEach((function(e){var n=t[e].ID;g.set(n,e),L.push(n)}));var e={currentSheetID:t[d.CurrentSheetIndex-1].ID,sheetIDList:L};o.onComplete(e)}))})):o.onFailure()}),(function(){u.error("UDL - ZIP open fails"),o.onFailure()}))}}})})),define("DS/DibUDLWebLoader/UDLObjectManager_Annotation",["DS/DibUDLWebLoader/UDLObjectManager_Adapter","DS/DibUDLWebLoader/UDLObject_TPSAnnotation","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o){"use strict";return class extends e{constructor(e){super(e),this.ObjectList=[]}instanceOf(){return"UDLObjectManager_Annotation"}createUDLObject(e){e=new t(e);return this.ObjectList.push(e),e}async handleAllVisu(){for(const t of this.ObjectList)if(t.handleVisu){t.handleVisu();var e=this.UDLObjectMap.get(t.planeID);e&&e.node?e.node.addChild?e.node.addChild(t.node):o.warn("Plane node is not valid, cannot add child",e.node):o.warn("Plane object is not valid, cannot add child",e)}}}})),define("DS/DibUDLWebLoader/UDLObject_Symbol",["DS/DibUDLWebLoader/UDLObject","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D"],(function(e,t,n,o,i){"use strict";return class extends e{constructor(e){super(e),this.ID=e?.ID,this.matrix=new o.Matrix4,this.matrix.setPosition(new o.Vector3(e.SymbolCompToViewMatrix[4],e.SymbolCompToViewMatrix[5],0));var t=e.SymbolCompToViewMatrix[0],n=e.SymbolCompToViewMatrix[1],i=e.SymbolCompToViewMatrix[2],r=e.SymbolCompToViewMatrix[3];0===t&&0===i&&0===n&&0===r&&(t=1,r=1);var a=[t,i,0,n,r,0,0,0,1];this.matrix.setRotation(a)}instanceOf(){return"UDLObject_Symbol"}handleVisu(){this.cgrNode&&(this.node=new i,this.node.setMatrix(this.matrix),this.node.addChild(this.cgrNode))}}})),define("DS/DibUDLWebLoader/UDLAnnotationSet",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/Visualization/PathElement","DS/Visualization/RenderStyle","DS/Visualization/Node3D","DS/DibUDLWebLoader/UDLComponent","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLCache","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o,i,r,a,s,l,c){"use strict";return class extends a{constructor(e){super(e),this.captureInstances=new Map,this.mbdviewInstances=new Map,this._annsetnode=void 0}addChild(e){if(!e)return c.error("invalid argument"),!1;if(s.isDIFCaptureInstance(e))this.captureInstances.has(e.getID())||this.captureInstances.set(e.getID(),e);else{if(!s.isMBDViewInstance(e))return c.error(" obj child not supported"),!1;this.mbdviewInstances.has(e.getID())||this.mbdviewInstances.set(e.getID(),e)}return!0}getChildrenIdUDLtoFetch(e){let t=!0;for(let n of this.mbdviewInstances.values())t=t&&n.getIdUDLtoFetch(e);for(let n of this.captureInstances.values())t=t&&n.getIdUDLtoFetch(e);return t}getCaptureInfo(e){for(let t of this.captureInstances.values())e.push(t.getCaptureInfo())}getMBDViewInfo(e){for(let t of this.mbdviewInstances.values())e.push(t.getViewInfo())}async createAnnotationSetContentVisu(e){let t=[];if(this.getIdUDLtoFetch(t),0!==t.length){const e=await s.fetchUDLData(t);s.assignFetchedUDL(e)}const n=[];for(const e of this.captureInstances.values())n.push(e.createNode(this._annsetnode,!1));await Promise.all(n)}getNode(e,t){if(void 0===this._annsetnode){var n=l.getContextViewer();this._annsetnode=null==n?new r:n.getController().getNode({id:this.ID});var a=this._annsetnode.createOverrideSetManager(),s=a.createSceneGraphOverrideSet();a.pushSceneGraphOverrideSet(s);var c=s.createOverride(new o([this._annsetnode])),d=new i;d.setRenderMode("@Edge",!0),d.setHalfVisibleSmoothEdges(!0),c.setRenderStyle(d,!0),e(this._annsetnode),this.createAnnotationSetContentVisu(this._annsetnode).then((e=>{t()}))}else e(this._annsetnode),t()}}})),define("DS/DibUDLWebLoader/UDLObjectManager_TPSAnnotation",["DS/DibUDLWebLoader/UDLObjectManager_Adapter","DS/DibUDLWebLoader/UDLObject_TPSAnnotation","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o){"use strict";return class extends e{constructor(e){super(e),this.ObjectList=[]}instanceOf(){return"UDLObjectManager_TPSAnnotation"}createUDLObject(e){e=new t(e);return this.ObjectList.push(e),e}async handleAllVisu(){for(const t of this.ObjectList)if(t.handleVisu){t.handleVisu();var e=this.UDLObjectMap.get(t.planeID);e&&e.node?e.node.addChild?e.node.addChild(t.node):o.warn("Plane node is not valid, cannot add child",e.node):o.warn("Plane object is not valid, cannot add child",e)}}}})),define("DS/DibUDLWebLoader/UDLSupplementalGeometry",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/DibUDLWebLoader/UDLComponent","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o,i,r,a){"use strict";return class extends i{constructor(e){super(e),this.udlurl=null,this.udl=0,this.shape=null}addFather(e){return e?r.isDIFSupplementalGeometryInstance(e)?(this.father=e,!0):(a.error(" obj not good type"),!1):(a.error("invalid argument"),!1)}addChild(e){return e?r.isDIF3DShapeInstance(e)?(this.shape=e,!0):(a.log(e.type+" obj child not supported"),!1):(a.error("invalid argument"),!1)}getChildrenIdUDLtoFetch(e){let t=!0;return this.shape&&(t=t&&this.shape.getIdUDLtoFetch(e)),t}async createNode(e,t){return this.shape?this.shape.createNode(e,t):void 0}}})),define("DS/DibUDLWebLoader/UDLDifViewInstance",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/DibUDLWebLoader/UDLComponent","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole","DS/DibUDLWebLoader/UDLCache"],(function(e,t,n,o,i,r,a,s,l){"use strict";return class extends r{constructor(e){super(e),this.view=null,this.scale=parseFloat(e["ro.DIFAbstractViewInstance.V_DIFScale"]),this.x=parseFloat(e["ro.DIFAbstractViewInstance.V_DIFPosX"]),this.y=parseFloat(e["ro.DIFAbstractViewInstance.V_DIFPosY"]),this.angle=parseFloat(e["ro.DIFAbstractViewInstance.V_DIFAngle"])}addFather(e){return e?a.isDIFSheet(e)?(this.father=e,!0):(s.error(" obj not good type"),!1):(s.error("invalid argument"),!1)}addChild(e){return e?a.isDIFView(e)?(this.view=e,!0):(s.error("obj child not supported"),!1):(s.error("invalid argument"),!1)}getChildrenIdUDLtoFetch(e){let t=!0;return this.view&&(t=this.view.getIdUDLtoFetch(e)),t}async createNode(e){try{let a,s=await this.view.createNode();a="OnReference"===this.view.scaleStatus?this.view.scale:this.scale;var t=new i.Matrix4;t.setPosition(new i.Vector3(this.x,this.y,0));var n=[Math.cos(this.angle)*a,Math.sin(this.angle)*a,0,-Math.sin(this.angle)*a,Math.cos(this.angle)*a,0,0,0,1];t.setRotation(n),s.setMatrix(t);var o=l.getContextViewer();if(null==o)e.addChild(s);else{var r=o.getController().getNode({id:this.view.ID});r?r.addChild(s):e.addChild(s)}return}catch(e){return void s.error(e.message)}}}})),define("DS/DibUDLWebLoader/UDLObjectManager_Symbol",["DS/DibUDLWebLoader/UDLObjectManager_Adapter","DS/DibUDLWebLoader/UDLObject_Symbol","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o){"use strict";return class extends e{constructor(e){super(e),this.ObjectList=[]}instanceOf(){return"UDLObjectManager_Symbol"}createUDLObject(e){e=new t(e);return this.ObjectList.push(e),e}async handleAllVisu(){for(const e of this.ObjectList)e.handleVisu&&e.handleVisu()}}})),define("DS/DibUDLWebLoader/CGR_UDLWebLoader",["DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/Visualization/ModelLoader","DS/Visualization/ThreeJS_DS","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o,i){"use strict";return{loadCGRs:function(t){return i.log(t.cgrName),function(t){var i=t.CGRNode,r=t.cgrName;r||t.onFailure();var a=t.zipUDL.find(r);a||t.onFailure();var s=new e.BlobWriter,l=new o.Matrix4;l.setPosition(new o.Vector3(0,0,0)),l.setRotation([1,0,0,0,1,0,0,0,1]),i.setMatrix(l);var c=new n;c.setFileType("cgr"),c.set2DAccuracy(t.Accuracy2D),c.set3DAccuracy(t.Accuracy3D),1==t.DrawOrderMode&&c.setSceneGraphOrderMode(1),c.setOnLoadedCallback((function(){t.onSuccess(i)})),a.getData(s,(function(e){var t=new FileReader;t.onload=function(){c.loadModelFromBuffer(this.result,i)},t.readAsArrayBuffer(e)}));var d=t.cgrNameText;if(void 0!==d&&""!==d){var u=t.zipUDL.find(d),D=new e.BlobWriter;u.getData(D,(function(e){var t=new FileReader;t.onload=function(){c.loadModelFromBuffer(this.result,i)},t.readAsArrayBuffer(e)}))}}(t)}}})),define("DS/DibUDLWebLoader/UDL3DShapeInstance",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/DibUDLWebLoader/UDLComponent","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o,i,r,a){"use strict";return class extends i{constructor(e){super(e),this.repreference=null}addFather(e){return e?r.isDIFSupplementalGeometry(e)?(this.father=e,!0):(a.error(" obj not good type"),!1):(a.error("invalid argument"),!1)}addChild(e){return e?r.isDIF3DShape(e)?(this.repreference=e,!0):(a.error(" obj not good type"),!1):(a.error("invalid argument"),!1)}getChildrenIdUDLtoFetch(e){let t=!0;return this.repreference&&(t=t&&this.repreference.getIdUDLtoFetch(e)),t}async createNode(e,t){return this.repreference.createNode(e,t)}}})),define("DS/DibUDLWebLoader/UDLSupplementalGeometryInstance",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/DibUDLWebLoader/UDLComponent","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o,i,r,a){"use strict";return class extends i{constructor(e){super(e),this.reference=null}addFather(e){return e?r.isDIFView(e)||r.isDIFSheet(e)||r.isDIFCapture(e)||r.isMBDView(e)?(this.father=e,!0):(a.error(" obj not good type"),!1):(a.error("invalid argument"),!1)}addChild(e){return e?r.isDIFSupplementalGeometry(e)?(this.reference=e,!0):(a.error(" obj not good type"),!1):(a.error("invalid argument"),!1)}getChildrenIdUDLtoFetch(e){let t=!0;return this.reference&&(t=t&&this.reference.getIdUDLtoFetch(e)),t}async createNode(e,t){return this.reference.createNode(e,t)}}})),define("DS/DibUDLWebLoader/UDLObject_SupportPlane",["DS/DibUDLWebLoader/UDLObject","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n){"use strict";return class extends e{constructor(e){super(e),this.ID=e?.PLM_ID}instanceOf(){return"UDLObject_SupportPlane"}handleVisu(){this.cgrNode&&(this.node=this.cgrNode)}}})),define("DS/DibUDLWebLoader/DifCaptureUDLWebLoader",["DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/Visualization/ModelLoader","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphUtils","DS/Visualization/PathElement","DS/Visualization/SceneGraphFactory","DS/DibUDLWebLoader/DifSupplementalGeometryUDLWebLoader","DS/DibUDLWebLoader/UDLconsole","DS/DibUDLWebLoader/DIFDecoratorClipping3D","DS/MathematicsES/MathsDef"],(function(e,t,n,o,i,r,a,s,l,c,d){"use strict";var u=function(e){var i="get_CaptureRef_ObjectInternal",r=e.iRef;r||e.onFailure(i+" no iRef");var a=e.ioMap_ID_Node;a||e.onFailure(i+" no ioMap_ID_Node");var u=e.ioMap_ID_Obj;u||e.onFailure(i+" no ioMap_ID_Obj");var D=u.get(r.iD);D&&e.onSuccess(D);var h=r.viewStreamInstance.viewStream,f=a.get(r.iD);if(!f){var p=new t;f=p,a.set(r.iD,f)}var g=a.get(h.iD);g&&f.addChild(g);(D={}).ID=r.iD,D.Name=r.Name,D.Type="Capture",D.Childs=[];var b={};b.node3D=f,D.visuinfo=b;var L=r.Matrix,S=new o.Vector3(L[3],L[4],L[5]),I=new o.Vector3(L[6],L[7],L[8]),m=new o.Vector3(L[9],L[10],L[11]);if(b.plane=new o.Plane,b.plane.setFromNormalAndCoplanarPoint(I,m),b.up=S,D.decorators=[],l.error("Capture:",r),r.udljson&&r.udljson.Section){var v={};v.plane=new o.Plane;var w=new o.Vector3(-L[6],-L[7],-L[8]);v.plane.setFromNormalAndCoplanarPoint(w,m),D.decorators.push(new c(v))}var F={};if(void 0!==r.udljson?.Clipping){let e=r.udljson.Clipping.Points,t=r.udljson.Clipping.Normal,n=new o.Vector3(t[0],t[1],t[2]).normalize(),i=new o.Vector3(e[0],e[1],e[2]),a=new o.Vector3(1,0,0);Math.abs(n.dot(a))>.99&&a.set(0,0,1);let s=(new o.Vector3).crossVectors(n,new o.Vector3(1,0,0)).normalize();s.length()<.001&&(s=(new o.Vector3).crossVectors(n,new o.Vector3(0,1,0)).normalize());let u=(new o.Vector3).crossVectors(n,s).normalize();if("circular"===r.udljson.Clipping.Type){l.error("U . V (before transformation):",s.dot(u)),l.error("U . v_normal (before transformation):",s.dot(n)),l.error("V . v_normal (before transformation):",u.dot(n));var U=r.Matrix,y=new d.Transformation;y.setFromArray(U),y.inverse(),U=y.getArray();var _=new o.Matrix4;_.set(L[0],L[3],L[6],L[9],L[1],L[4],L[7],L[10],L[2],L[5],L[8],L[11],0,0,0,1);var C={};C.center=i.clone();var M=Math.sqrt((e[3]-e[0])**2+(e[4]-e[1])**2+(e[5]-e[2])**2);C.axisU=s.clone().multiplyScalar(M),C.axisV=u.clone().multiplyScalar(M),C.clipOutside=!0,C.center.applyMatrix4(_);var A=n.clone().applyMatrix4(_);A.set(1,0,0);let t=new o.Vector3(1,0,0);Math.abs(A.dot(t))>.99&&t.set(0,0,1);let a=(new o.Vector3).crossVectors(A,new o.Vector3(1,0,0)).normalize();a.length()<.001&&(a=(new o.Vector3).crossVectors(A,new o.Vector3(0,1,0)).normalize());let h=(new o.Vector3).crossVectors(A,a).normalize();a.set(0,1,0),h.set(0,0,1),C.axisU=a.clone().multiplyScalar(M),C.axisV=h.clone().multiplyScalar(M),F.cylinder=C,F.type="cylinder",D.decorators.push(new c(F))}}r.presentedAnnotations?r.presentedAnnotations.forEach((function(e){var t={};(t=e.PlaneID?a.get(e.PlaneID):a.get(e.iD))&&f.addChild(t)})):r.MBDViews&&r.MBDViews.forEach((function(e){var t=a.get(e.view.viewStreamInstance.viewStream.iD);t&&f.addChild(t)}));var V={iFather:r,iObj_Father:D,ioMap_ID_Node:a,ioMap_ID_Obj:u,onSuccess:function(){l.log("Manage_SupGeo_Object Ok")},onFailure:function(t){l.log(t),e.onFailure(i)}};s.Manage_SupGeo_Object(V),u.set(D.ID,D);var T=null;if(void 0!==r.udljson?.DressUp){T=new t;var x=new t;T.addChild(x),f.addChild(T);var P=new n;P.setFileType("cgr"),P.setOnLoadedCallback((function(e){e&&(void 0!==r.udljson?.Clipping&&"circular"===r.udljson.Clipping.Type&&null!==T&&T.setClippingCylinder(F.cylinder,!0),l.log("DressUp loaded for Capture",r))}));let e=r.udljson.DressUp,o=r.udlzip.find(e);if(!o)return void l.error(`CGR file ${e} not found in zip.`);let i=new zip.BlobWriter;o.getData(i,(function(e){var t=new FileReader;t.onload=function(){P.loadModelFromBuffer(this.result,x)},t.readAsArrayBuffer(e)}),void 0,(function(t){l.log(`CGR ${e} did not load...`),l.log(t)}))}e.onSuccess(D)},D=function(e){var n="get_CaptureInstance_ObjectInternal",o=e.iInstance;o||e.onFailure(n+" no iInstance");var i=e.ioMap_ID_Node;i||e.onFailure(n+" no ioMap_ID_Node");var r=e.ioMap_ID_Obj;r||e.onFailure(n+" no ioMap_ID_Obj");var a=r.get(o.iD);a&&e.onSuccess(a);var s=i.get(o.iD);s||(s=new t,i.set(o.iD,s));(a={}).ID=o.iD,a.Name=o.Name,a.Type="CaptureInstance",a.Childs=[];var c={};c.node3D=s,a.visuinfo=c;var d={iRef:o.capture,ioMap_ID_Node:i,ioMap_ID_Obj:r,onSuccess:function(t){a.Name||(a.Name=t.Name),a.decorators=t.decorators,a.Childs.push(t),a.visuinfo.node3D?a.visuinfo.node3D.addChild(t.visuinfo.node3D):e.onFailure(n+" no node3D")},onFailure:function(t){l.log(t),e.onFailure(n)}};u(d),r.set(a.ID,a),e.onSuccess(a)};return{get_CaptureRef_Object:function(e){return u(e)},get_CaptureInstance_Object:function(e){return D(e)},Manage_Capture_Object:function(e){return function(e){var t="Manage_Capture_ObjectInternal",n=e.iFather;n||e.onFailure(t+" no iFather");var o=e.ioMap_ID_Node;o||e.onFailure(t+" no ioMap_ID_Node");var i=e.ioMap_ID_Obj;i||e.onFailure(t+" no ioMap_ID_Obj");var r=e.iObj_Father;r||e.onFailure(t+" no iObj_Father"),n.Captures&&n.Captures.forEach((function(n){D({iInstance:n,ioMap_ID_Node:o,ioMap_ID_Obj:i,onSuccess:function(n){r.Childs.push(n),r.visuinfo.node3D?r.visuinfo.node3D.addChild(n.visuinfo.node3D):e.onFailure(t+" no node3D")},onFailure:function(n){l.log(n),e.onFailure(t)}})})),e.onSuccess()}(e)}}})),define("DS/DibUDLWebLoader/UDLSheetInstance",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/DibUDLWebLoader/UDLComponent","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o,i,r,a){"use strict";return class extends i{constructor(e){super(e),this.sheet=null,this.name=e["bo.PLMEntity.V_Name"],this.height=parseFloat(e["bo.DIFAbstractSheet.V_DIFFormatHeight"]),this.width=parseFloat(e["bo.DIFAbstractSheet.V_DIFFormatWidth"])}addFather(e){return e?r.isDIFLayout(e)?(this.father=e,!0):(a.error(" obj not good type"),!1):(a.error("invalid argument"),!1)}addChild(e){return e?r.isDIFSheet(e)?(this.sheet=e,!0):(a.error(" obj child not supported"),!1):(a.error("invalid argument"),!1)}getChildrenIdUDLtoFetch(e){let t=!0;return this.sheet&&(t=this.sheet.getIdUDLtoFetch(e)),t}}})),define("DS/DibUDLWebLoader/UDLObject_TPSCG",["DS/DibUDLWebLoader/UDLObject","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n){"use strict";return class extends e{constructor(e){super(e),this.ID=e?.ID}instanceOf(){return"UDLObject_TPSCG"}handleVisu(){this.cgrNode&&(this.node=this.cgrNode)}}})),define("DS/DibUDLWebLoader/UDLObjectManager_SupportPlane",["DS/DibUDLWebLoader/UDLObjectManager_Adapter","DS/DibUDLWebLoader/UDLObject_SupportPlane","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o){"use strict";return class extends e{constructor(e){super(e),this.ObjectList=[]}instanceOf(){return"UDLObjectManager_SupportPlane"}createUDLObject(e){e=new t(e);return this.ObjectList.push(e),e}async handleAllVisu(){for(const e of this.ObjectList)e.handleVisu&&e.handleVisu()}}})),define("DS/DibUDLWebLoader/UDLObjectManager_TPSModelManager",["DS/DibUDLWebLoader/UDLObjectManager_Adapter","DS/DibUDLWebLoader/UDLObject_TPSCG","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o){"use strict";return class extends e{constructor(e){super(e),this.ObjectList=[]}instanceOf(){return"UDLObjectManager_TPSModelManager"}createUDLObject(e){e=new t(e);return this.ObjectList.push(e),e}async handleAllVisu(){for(const e of this.ObjectList)e.handleVisu&&e.handleVisu()}}})),define("DS/DibUDLWebLoader/UDLObjectManager",["DS/DibUDLWebLoader/UDLObjectManager_TPSAnnotation","DS/DibUDLWebLoader/UDLObjectManager_TPSModelManager","DS/DibUDLWebLoader/UDLObjectManager_SupportPlane","DS/DibUDLWebLoader/UDLObjectManager_Symbol","DS/DibUDLWebLoader/UDLObjectManager_Annotation","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole","DS/Visualization/Node3D","DS/Visualization/ModelLoader","DS/Visualization/ThreeJS_DS","DS/ZipJS/zip-fs"],(function(e,t,n,o,i,r,a,s,l,c,d){"use strict";return class{constructor(e){this.ZIPEntries=e.ZIPEntries,this.annotationManager=null,this.symbolManager=null,this.TPSAnnotationManager=null,this.TPSModelManager=null,this.supportPlaneManager=null,this.UDLObjectMap=e.UDLObjectMap,this.params={},this.params.UDLObjectMap=this.UDLObjectMap}instanceOf(){return"UDLObjectManager"}initUDLObjects(r){if(Array.isArray(r))for(const s of r){let r=null;"SupportPlane"===s.Type?(this.supportPlaneManager||(this.supportPlaneManager=new n(this.params)),r=this.supportPlaneManager.createUDLObject(s)):"TPS"===s.Type||"TPSTest"===s.Type?(this.TPSAnnotationManager||(this.TPSAnnotationManager=new e(this.params)),r=this.TPSAnnotationManager.createUDLObject(s)):"TPSCG"===s.Type?(this.TPSModelManager||(this.TPSModelManager=new t(this.params)),r=this.TPSModelManager.createUDLObject(s)):"AnnWithLink"===s.Type||"AnnWithoutLink"===s.Type?(this.annotationManager||(this.annotationManager=new i(this.params)),r=this.annotationManager.createUDLObject(s)):"Symbol"===s.Type||"Route"===s.Type?(this.symbolManager||(this.symbolManager=new o(this.params)),r=this.symbolManager.createUDLObject(s)):a.warn("Unknown UDL Object type: "+s.Type),r&&r.ID&&this.UDLObjectMap.set(r.ID,r)}}async LoadAllCGRs(){return this.loadingPromise||(this.loadingPromise=new Promise((async(e,t)=>{try{var n=new l;n.setFileType("cgr"),n.setOnLoadedCallback((t=>{t&&(a.log("Object list UDL loaded: "),e())}));let t=!1;for(const e of this.UDLObjectMap.values())e&&e.cgrNode&&(e.cgrID&&(t=!0,this.LoadCGR(n,this.ZIPEntries,e.cgrID,e.cgrNode)),e.cgrTextID&&e.cgrTextNode&&(t=!0,this.LoadCGR(n,this.ZIPEntries,e.cgrTextID,e.cgrTextNode)));return void(t||(a.log("No CGR to load..."),e()))}catch(e){a.error("Error while loading CGRs:",e),t(e)}}))),this.loadingPromise}async HandleAllVisu(){const e=[];this.supportPlaneManager&&e.push(this.supportPlaneManager.handleAllVisu()),this.annotationManager&&e.push(this.annotationManager.handleAllVisu()),this.symbolManager&&e.push(this.symbolManager.handleAllVisu()),this.TPSAnnotationManager&&e.push(this.TPSAnnotationManager.handleAllVisu()),this.TPSModelManager&&e.push(this.TPSModelManager.handleAllVisu());await Promise.all(e)}LoadCGR(e,t,n,o){if(null==o)return void a.error("node3D is null or undefined");const i=t.find(n);if(i){var r=new d.BlobWriter;i.getData(r,(function(t){var n=new FileReader;n.onload=function(){e.loadModelFromBuffer(this.result,o,{forceNoShowCGR:!0})},n.readAsArrayBuffer(t)}),void 0,(function(e){a.error("CGR"+n+" did not load..."),a.error(e)}))}else a.error("Failed to find cgr zipEntries : "+n)}}})),define("DS/DibUDLWebLoader/UDLCapture",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/Visualization/ModelLoader","DS/DibUDLWebLoader/UDLComponent","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS","DS/DibUDLWebLoader/UDLCache","DS/MathematicsES/MathsDef","DS/DibUDLWebLoader/DIFDecoratorClipping3D","DS/Visualization/PathElement","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/SceneGraphNodes/PolyLineSectionUtils"],(function(e,t,n,o,i,r,a,s,l,c,d,u,D,h,f,p){"use strict";return class extends r{constructor(e){super(e),this.fathers=new Map,this.streamInstance=null,this.mbdViewInstance=null,this.supplementalGeometry=null,this.scale=parseFloat(e["bo.DIFAbstractView.V_DIFScale"]),this.scaleStatus=e["bo.DIFAbstractView.V_DIFScaleStatus"];var t=e["bo.DIFAbstractView.V_DIF3DMatrix"];this.captureInfo={},this.captureInfo.ID=this.ID,this.captureInfo.Name=this.definition["bo.PLMEntity.V_Name"],this.captureInfo.visuinfo={},this.captureInfo.decorators=[],this.captureInfo.Type="Capture",this.matrix=[],"string"==typeof t&&(t=t.split(",").map(Number)),Array.isArray(t)&&12===t.length?this.matrix=t:console.error("Invalid matrix data",t)}addFather(e){return e?a.isDIFCaptureInstance(e)?(this.fathers.has(e.getID())||this.fathers.set(e.getID(),e),!0):(s.log(e.type+" obj not good type"),!1):(s.error("invalid argument"),!1)}addChild(e){if(!e)return s.error("invalid argument"),!1;if(a.isDIFViewStreamInstance(e))this.streamInstance=e;else if(a.isMBDViewInstance(e))this.mbdViewInstance=e;else{if(!a.isDIFSupplementalGeometryInstance(e))return s.log(e.type+" obj child not supported"),!1;this.supplementalGeometry=e}return!0}getChildrenIdUDLtoFetch(e){let t=!0;return this.streamInstance&&(t=this.streamInstance.getIdUDLtoFetch(e)),this.mbdViewInstance&&(t=this.mbdViewInstance.getIdUDLtoFetch(e)),this.supplementalGeometry&&(t=this.supplementalGeometry.getIdUDLtoFetch(e)),t}getCaptureInfo(){return this.captureInfo}async createNode(e,t){if(s.method(),null!==this._node)return this._node;this._node=new o,null!==this.mbdViewInstance&&await this.mbdViewInstance.LoadMBD(),null!==this.supplementalGeometry&&await this.supplementalGeometry.createNode(this._node);const r=new n.fs.FS,a={provider:"FILE",filename:this.streamInstance.stream.udlurl,serverurl:"",proxyurl:"none",requiredAuth:null};try{return await new Promise(((e,n)=>{r.importHttpContent(a,!1,function(){const a=r.find("DrwStructure.json");null!=a?a.getText(function(a){try{const n=JSON.parse(a.target.result);this.captureInfo.Childs=[],this.captureInfo.visuinfo.node3D=this._node,void 0!==n.View?.Name&&(this.captureInfo.Name=n.View?.Name+" {"+this.captureInfo.Name+"}");var l=this.matrix,d=new c.Vector3(l[3],l[4],l[5]),h=new c.Vector3(l[6],l[7],l[8]),g=new c.Vector3(l[9],l[10],l[11]);this.captureInfo.visuinfo.plane=new c.Plane,this.captureInfo.visuinfo.plane.setFromNormalAndCoplanarPoint(h,g),this.captureInfo.visuinfo.up=d;var b=void 0;if(!0===t){var L=new u.Transformation;L.setFromArray(l),L.inverse(),l=L.getArray()}var S=new c.Matrix4;S.set(l[0],l[3],l[6],l[9],l[1],l[4],l[7],l[10],l[2],l[5],l[8],l[11],0,0,0,1);var I=null,m=null;if("Note_View"!==n.View?.CaptureType&&!0===t)I=new o,m=new o,null!==this.mbdViewInstance&&(!1===n.View?.isFolded?m.addChild(this.mbdViewInstance.getFlatPartNode()):m.addChild(this.mbdViewInstance.getAnnotatedProductNode())),m.setMatrix(S);else if(!1===n.View?.isFolded||"Note_View"===n.View?.CaptureType){var v=this.mbdViewInstance.getFlatPartNode();null!==v&&this._node.addChild(v),void 0===b&&(b={}),b.cylinder={},b.cylinder.center=new c.Vector3(0,0,0);var w=.01;b.cylinder.axisU=new c.Vector3(1,0,0),b.cylinder.axisV=new c.Vector3(0,1,0),b.cylinder.clipOutside=!0}var F=!1;if(void 0!==n.View?.Section){F=!0;let e=n.View.Section.Plane;if(void 0!==e){if(void 0===b&&(b={}),n.View.Section?.Points?.length>3){(V={}).planeOrigin=new c.Vector3(e[9],e[10],e[11]),V.planeU=new c.Vector3(e[0],e[1],e[2]),V.planeV=new c.Vector3(e[3],e[4],e[5]);const t=n.View.Section?.Points,o=[],i=V.planeU.clone().normalize(),r=V.planeV.clone().normalize();var U=[];for(let e=0;e<t.length;e+=3){const n=new c.Vector3(t[e],t[e+1],t[e+2]);U.push(n);const a=n.clone().sub(V.planeOrigin),s=a.dot(i),l=a.dot(r);o.push(new c.Vector2(s,l))}V.polyLinePoints=o;var y=new c.Sphere(new c.Vector3(0,0,0),1e3);b.clippingProfile=p.makeClosedPolyLine(V,y)}else{var _=new c.Plane,C=new c.Vector3(-e[6],-e[7],-e[8]);g=new c.Vector3(e[9],e[10],e[11]);_.setFromNormalAndCoplanarPoint(C,g),b.plane=_}!0===t&&b.plane.applyMatrix4(S),null!==m&&m.enableClippingPlane(b.plane,!0)}}var M=null,A=void 0,V=void 0,T=new i;if(T.setFileType("cgr"),1===this._drawOrderMode&&T.setSceneGraphOrderMode(1),T.setOnLoadedCallback(function(t){t&&(null!==M&&!0===F&&(void 0!==A&&M.setClippingCylinder(A,!0),void 0!==V&&M.setClippingProfile(V)),e())}.bind(this)),void 0!==n.View?.DressUp){M=new o;var x=new o;!0===t&&x.setMatrix(S),M.addChild(x),this._node.addChild(M);let e=n.View.DressUp,i=r.find(e),a=new zip.BlobWriter,l=function(e){var t=new FileReader;t.onload=function(){T.loadModelFromBuffer(this.result,x)},t.readAsArrayBuffer(e)};i.getData(a,l,void 0,(function(e){s.error("CGR"+obj+" did not load..."),s.error(e)}))}if(void 0!==n.View?.Clipping){let e=n.View.Clipping.Points,o=n.View.Clipping.Normal,i=new c.Vector3(o[0],o[1],o[2]).normalize(),r=new c.Vector3(e[0],e[1],e[2]),a=new c.Vector3(1,0,0);Math.abs(i.dot(a))>.99&&a.set(0,0,1);let s=null,d=null;if(!1===t?(s=(new c.Vector3).crossVectors(i,new c.Vector3(1,0,0)).normalize(),s.length()<.001&&(s=(new c.Vector3).crossVectors(i,new c.Vector3(0,1,0)).normalize()),d=(new c.Vector3).crossVectors(i,s).normalize()):(s=new c.Vector3(1,0,0),d=new c.Vector3(0,1,0)),void 0===b&&(b={}),"circular"===n.View.Clipping.Type){(A={}).center=r.clone();w=Math.sqrt((e[3]-e[0])**2+(e[4]-e[1])**2+(e[5]-e[2])**2);A.axisU=s.clone().multiplyScalar(w),A.axisV=d.clone().multiplyScalar(w),A.clipOutside=!0,!1===t&&A.center.applyMatrix4(S),b.cylinder=A,null!==I&&I.setClippingCylinder(A,!0)}else if("polygonal"===n.View.Clipping.Type){(V={}).planeOrigin=new c.Vector3(l[9],l[10],l[11]),V.planeU=new c.Vector3(l[0],l[1],l[2]),V.planeV=new c.Vector3(l[3],l[4],l[5]);const e=n.View.Clipping.Points,t=[];for(let n=0;n<e.length;n+=3){const o=e[n],i=e[n+1];t.push(new c.Vector2(o,i))}V.polyLinePoints=t,null!==I&&I.setClippingProfile(V),b.clippingProfile=V}}if(null!==I&&(null!==m&&I.addChild(m),this._node.addChild(I)),void 0!==b&&this.captureInfo.decorators.push(new D(b)),null!==this.mbdViewInstance){var P=this._node.createOverrideSetManager(),N=P.createSceneGraphOverrideSet({mode:f.forceShow});P.pushSceneGraphOverrideSet(N);const e=Array.isArray(n?.View?.ObjectList)?n.View.ObjectList:[];for(const n of e)if("PresentedAnnotations"===n.Type){let e=this.mbdViewInstance.getSupportPlaneNode(n.Plane);!0===t&&e.setMatrix(S),this._node.addChild(e)}}{let e=new o;!1===t&&e.setMatrix(S),this._node.addChild(e);let i=n.View.cgr,a=r.find(i),l=new zip.BlobWriter,c=function(t){var n=new FileReader;n.onload=function(){T.loadModelFromBuffer(this.result,e)},n.readAsArrayBuffer(t)};a.getData(l,c,void 0,(function(e){s.error("CGR"+obj+" did not load..."),s.log(e)}))}}catch(e){n(e)}}.bind(this)):n(new Error("failed zipEntries"))}.bind(this),function(){n(new Error("importHttpContent failed!"))}.bind(this))})),this._node}catch(e){throw s.error("Error creating node:",e),e}}}})),define("DS/DibUDLWebLoader/UDLMBDView",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/Visualization/ModelLoader","DS/Visualization/ThreeJS_DS","DS/DibUDLWebLoader/UDLComponent","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole","DS/DibUDLWebLoader/UDLObjectManager"],(function(e,t,n,o,i,r,a,s,l,c){"use strict";return class extends a{constructor(e){super(e),this.fathers=new Map,this.streamInstance=null,this.scale=parseFloat(e["bo.DIFAbstractView.V_DIFScale"]),this.scaleStatus=e["bo.DIFAbstractView.V_DIFScaleStatus"],this.isUDLLoaded=!1,this.annotatedProductNode=null,this.flatPartNode=null,this.UDLObjectMap=new Map}addFather(e){return e?s.isMBDViewInstance(e)?(this.fathers.has(e.getID())||this.fathers.set(e.getID(),e),!0):(l.error(" obj not good type"),!1):(l.error("invalid argument"),!1)}addChild(e){return e?s.isDIFViewStreamInstance(e)?(this.streamInstance=e,!0):(l.error(" obj child not supported"),!1):(l.error("invalid argument"),!1)}getChildrenIdUDLtoFetch(e){let t=!0;return this.streamInstance&&(t=this.streamInstance.getIdUDLtoFetch(e)),t}getAnnotatedProductNode(){return this.annotatedProductNode}getFlatPartNode(){return this.flatPartNode}getSupportPlaneNode(e){return this.UDLObjectMap.get(String(e))?.node}async LoadMBD(){if(!this.isUDLLoaded)return this.loadingPromise||(this.loadingPromise=this._doLoadMBD()),this.loadingPromise}async _doLoadMBD(){try{l.method(),this.annotatedProductNode=new o;const e=new n.fs.FS,t={provider:"FILE",filename:this.streamInstance.stream.udlurl,serverurl:"",proxyurl:"none",requiredAuth:null};await new Promise(((n,r)=>{e.importHttpContent(t,!1,function(){const t=e.find("DrwStructure.json");t?t.getText(async function(t){try{const r=JSON.parse(t.target.result);this.annotatedProductNode=new o;const s=r?.View?.AnnotatedProduct||"";this.flatPartNode=new o;const d=r?.View?.FlatPart||"";var a=null;const u=""!==s||""!==d;if(u){const t=new i;t.setFileType("cgr"),a=new Promise((e=>{t.setOnLoadedCallback((t=>{t&&(this.isUDLLoaded=!0,l.log("MBD UDL loaded: "+this.ID),e())}))})),""!==s&&this.LoadCGR(t,e,s,this.annotatedProductNode),""!==d&&this.LoadCGR(t,e,d,this.flatPartNode)}const D={ZIPEntries:e,UDLObjectMap:this.UDLObjectMap},h=new c(D);h.initUDLObjects(r?.View?.ObjectList),await h.LoadAllCGRs(),await h.HandleAllVisu(),u&&await a,n()}catch(e){r(e)}}.bind(this)):r(new Error("Failed to find zip entry"))}.bind(this),function(){r(new Error("importHttpContent failed!"))}.bind(this))}))}catch(e){throw l.error("Error in LoadMBD:",e),e}}LoadCGR(e,t,o,i){if(null==i)return void l.error("node3D is null or undefined");const r=t.find(o);if(r){var a=new n.BlobWriter;r.getData(a,(function(t){var n=new FileReader;n.onload=function(){e.loadModelFromBuffer(this.result,i)},n.readAsArrayBuffer(t)}),void 0,(function(e){l.error("CGR"+o+" did not load..."),l.error(e)}))}else l.error("Failed to find cgr zipEntries : "+o)}}})),define("DS/DibUDLWebLoader/UDLStream",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/Visualization/ModelLoader","DS/Visualization/ThreeJS_DS","DS/DibUDLWebLoader/Annotation_UDLWebLoader","DS/DibUDLWebLoader/UDLComponent","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLCache","DS/DibUDLWebLoader/UDLconsole","DS/DibWebUtils/DibQueryToolbox","DS/DibUDLWebLoader/UDLObjectManager"],(function(e,t,n,o,i,r,a,s,l,c,d,u,D){"use strict";return class extends s{constructor(e){super(e),this.udlurl=null,this.udl=0,this.UDLObjectMap=null,this._node=null}addFather(e){return e?l.isDIFViewStreamInstance(e)||l.isDIFBackgroundViewRepInstance(e)?(this.father=e,!0):(d.error(" obj not good type"),!1):(d.error("invalid argument"),!1)}async loadStream(e){this.UDLObjectMap=e;try{d.method();const e=new n.fs.FS,t={provider:"FILE",filename:this.udlurl,serverurl:"",proxyurl:"none",requiredAuth:null};await new Promise(((n,r)=>{e.importHttpContent(t,!1,function(){const t=e.find("DrwStructure.json");t?t.getText(async function(t){try{const r=JSON.parse(t.target.result),s=new i;s.setFileType("cgr"),s.setUDLMode(!0);const l=new Promise((e=>{s.setOnLoadedCallback((t=>{t&&(this.isUDLLoaded=!0,d.log("MBD UDL loaded: "+this.ID),e())}))}));this._node=new o;const c=r?.View?.cgr;var a=r?.View?.cgr_texts;""!==a&&void 0!==a&&this.LoadCGR(s,e,a,this._node),this.LoadCGR(s,e,c,this._node);const u=r?.View?.ObjectList;if(Array.isArray(u)&&u.length>0){const t={ZIPEntries:e,UDLObjectMap:this.UDLObjectMap},n=new D(t);n.initUDLObjects(u),await n.LoadAllCGRs(),await n.HandleAllVisu();for(const e of this.UDLObjectMap.values())e?.node&&this._node.addChild(e.node)}else d.warn("No ObjectList found or it's not an array");await l,n()}catch(e){r(e)}}.bind(this)):r(new Error("Failed to find zip entry"))}.bind(this),function(){r(new Error("importHttpContent failed!"))}.bind(this))}))}catch(e){throw d.error("Error in LoadMBD:",e),e}}LoadCGR(e,t,o,i){if(null==i)return void d.error("node3D is null or undefined");const r=t.find(o);if(r){var a=new n.BlobWriter;r.getData(a,(function(t){var n=new FileReader;n.onload=function(){e.loadModelFromBuffer(this.result,i)},n.readAsArrayBuffer(t)}),void 0,(function(e){d.error("CGR"+o+" did not load..."),d.error(e)}))}else d.error("Failed to find cgr zipEntries : "+o)}}})),define("DS/DibUDLWebLoader/LinkUDLWebLoader",["DS/Visualization/Node3D","DS/DibUDLWebLoader/UDLconsole"],(function(e,t){"use strict";return{create_Link_FromJson:function(e){return function(e){var t="create_Link_FromJson_Internal",n=e.iJson;n||e.onFailure(t+" no iJson"),e.iomap_ID_Node||e.onFailure(t+" no iomap_ID_Node"),e.iomap_ID_Obj||e.onFailure(t+" no iomap_ID_Obj");var o=e.iObj_Father;o||e.onFailure(t+" no iObj_Father");var i,r=n.Type;"Link"!==r&&e.onFailure(t+"object not of good type"),(i={}).type=r,o.links||(o.links=[]);o.links.push(i),i.father=o,n.Link_ID&&(i.Link_ID=n.Link_ID),n.RepInst_ID&&(i.repInst_ID=n.RepInst_ID),n.POFI_ID&&(i.pofi=[],n.POFI_ID.forEach((function(e){i.pofi.push(e)})));n.Target&&(i.target={},n.Target.CGM_ID&&(i.target.cgmid=n.Target.CGM_ID),n.Target.Target_ID&&(i.target.targetid=n.Target.Target_ID),n.Target.Diezele&&(i.target.diezele=n.Target.Diezele));e.onSuccess()}(e)}}})),define("DS/DibUDLWebLoader/UDLStreamInstance",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/DibUDLWebLoader/UDLComponent","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o,i,r,a){"use strict";return class extends i{constructor(e){super(e),this.stream=null}addFather(e){return e?r.isDIFView(e)||r.isDIFSheet(e)||r.isDIFCapture(e)||r.isMBDView(e)?(this.father=e,!0):(a.error(" obj not good type"),!1):(a.error("invalid argument"),!1)}addChild(e){if(!e)return a.error("invalid argument"),!1;if(r.isDIFViewStream(e))this.stream=e;else{if(!r.isDIFBackgroundViewRep(e))return a.error(" obj not good type"),!1;this.background=e}return!0}getChildrenIdUDLtoFetch(e){let t=!0;return this.stream&&(t=t&&this.stream.getIdUDLtoFetch(e)),this.background&&(t=t&&this.background.getIdUDLtoFetch(e)),t}}})),define("DS/DibUDLWebLoader/UDLDifView",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/Visualization/ModelLoader","DS/Visualization/ThreeJS_DS","DS/DibUDLWebLoader/Annotation_UDLWebLoader","DS/DibUDLWebLoader/UDLComponent","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLCache","DS/DibUDLWebLoader/UDLconsole","DS/DibWebUtils/DibQueryToolbox","DS/DibUDLWebLoader/UDLObjectManager"],(function(e,t,n,o,i,r,a,s,l,c,d,u,D){"use strict";return class extends s{constructor(e){super(e),this.fathers=new Map,this.streamInstance=null,this.scale=parseFloat(e["bo.DIFAbstractView.V_DIFScale"]),this.scaleStatus=e["bo.DIFAbstractView.V_DIFScaleStatus"],this._drawOrderMode=0,this._MapResultString=new Map,this._MapAttributeName=new Map,this._MapIDFromSymbolPathSR=new Map,this._MapIDFromSymbolRelation=new Map,this._MapDifObjStreamToLoadedNode=new Map,this.UDLObjectMap=new Map}addFather(e){return d.method(),e?l.isDIFViewInstance(e)?(this.fathers.has(e.getID())||this.fathers.set(e.getID(),e),!0):(d.error(" obj not good type"),!1):(d.error("invalid argument"),!1)}addChild(e){return d.method(),e?l.isDIFViewStreamInstance(e)?(this.streamInstance=e,!0):(d.error(" obj child not supported"),!1):(d.error("invalid argument"),!1)}getIdUDLtoFetch(e){d.method();let t=!0;return this.streamInstance&&(t=this.streamInstance.getIdUDLtoFetch(e)),t}async createNode(e){return d.method(),null!==this._node||(await this.streamInstance.stream.loadStream(this.UDLObjectMap),this._node=this.streamInstance.stream._node),this._node}}})),define("DS/DibUDLWebLoader/Filter2DLUDLWebLoader",["DS/Visualization/Node3D","DS/DibUDLWebLoader/LinkUDLWebLoader","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n){"use strict";return{create_Filter2DL_FromJson:function(e){return function(e){var o="create_Filter2DL_FromJson_Internal",i=e.iJson;i||e.onFailure(o+" no iJson");var r=e.iomap_ID_Node;r||e.onFailure(o+" no iomap_ID_Node");var a=e.iomap_ID_Obj;a||e.onFailure(o+" no iomap_ID_Obj");var s=e.iObj_Father;s||e.onFailure(o+" no iObj_Father");var l=i.Type;"Filter2DL"!==l&&e.onFailure(o+"object not of good type");var c,d=i.PLM_ID,u=a.get(d);u&&e.onFailure(o+"object already created "+d),(u={}).iD=d,u.type=l,a.set(d,u),n.log(o+"created "+d),s.filter2DLs||(s.filter2DLs=[]);s.filter2DLs.push(u),u.father=s,u.filterMode=i.FilterMode,i.LINKS?c=i.LINKS:i.Links&&(c=i.Links);var D=i.FilterInfos;D&&(u.infos=[],D.forEach((function(e){var t={};t.activateModeColor=e.ActivateModeColor,t.red=e.Red,t.green=e.Green,t.blue=e.Blue,t.visible=e.Visible,t.pick=e.Pick,t.normalintensity=e.Normal_Intensity,t.activateModeTransparency=e.ActivateModeTransparency,t.transparency=e.Transparency,u.infos.push(t)}))),c&&c.forEach((function(i){var s={iJson:i,iObj_Father:u,iomap_ID_Node:r,iomap_ID_Obj:a,onSuccess:function(){n.log(o+" Ok")},onFailure:function(t){n.log(t),e.onFailure()}};t.create_Link_FromJson(s)})),e.onSuccess()}(e)}}})),define("DS/DibUDLWebLoader/UDLSheet",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/ModelLoader","DS/Visualization/SceneGraphFactory","DS/DibUDLWebLoader/Annotation_UDLWebLoader","DS/Visualization/RenderStyle","DS/Visualization/PathElement","DS/DibUDLWebLoader/UDLComponent","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole","DS/DibUDLWebLoader/UDLCache","DS/DibWebUtils/DibQueryToolbox"],(function(e,t,n,o,i,r,a,s,l,c,d,u,D,h,f){"use strict";return class extends d{constructor(e){super(e),this.backgroundInstance=null,this.viewInstances=new Map,this.fathers=new Map,this._sheetnode=void 0,this._node=null,this._enopad_node=null,this.name=e["bo.PLMEntity.V_Name"],this.orientation=e["bo.DIFAbstractSheet.V_DIFOrientation"],this.height=parseFloat(e["bo.DIFAbstractSheet.V_DIFFormatHeight"]),this.width=parseFloat(e["bo.DIFAbstractSheet.V_DIFFormatWidth"]),2===this.orientation&&(this.width=parseFloat(e["bo.DIFAbstractSheet.V_DIFFormatHeight"]),this.height=parseFloat(e["bo.DIFAbstractSheet.V_DIFFormatWidth"])),this._drawOrderMode=0,this._MapResultString=new Map,this._MapAttributeName=new Map,this._MapIDFromSymbolPathSR=new Map,this._MapIDFromSymbolRelation=new Map,this._MapDifObjStreamToLoadedNode=new Map,this.UDLObjectMap=new Map}getSheetName(){return this.name}getSheetBackgroundColor(){return(new o.Color).setRGB(1,1,1)}addFather(e){return e?u.isDIFSheetInstance(e)?(this.fathers.has(e.getID())||this.fathers.set(e.getID(),e),!0):(D.error(" obj not good type"),!1):(D.error("invalid argument"),!1)}addChild(e){if(!e)return D.error("invalid argument"),!1;if(u.isDIFBackgroundViewRepInstance(e))this.backgroundInstance=e;else{if(!u.isDIFViewInstance(e)&&!u.isDIFCaptureInstance(e))return D.error(e.type+"child type not supported"),!1;this.viewInstances.has(e.getID())||this.viewInstances.set(e.getID(),e)}return!0}getChildrenIdUDLtoFetch(e){let t=!0;this.backgroundInstance&&(t=t&&this.backgroundInstance.getIdUDLtoFetch(e));for(let n of this.viewInstances.values())n&&(t=t&&n.getIdUDLtoFetch(e));return t}async createSheetContentVisu(e){let t=[];if(this.getIdUDLtoFetch(t),0!==t.length){const e=await u.fetchUDLData(t);u.assignFetchedUDL(e)}const n=[];n.push(this.createBackgroundViewNode(this._sheetnode));for(const e of this.viewInstances.values())n.push(e.createNode(this._sheetnode,!0));await Promise.all(n)}getNode(e,t){if(void 0===this._sheetnode){var n=h.getContextViewer();this._sheetnode=null==n?new i:n.getController().getNode({id:this.ID});var o=this._sheetnode.createOverrideSetManager(),r=o.createSceneGraphOverrideSet();o.pushSceneGraphOverrideSet(r);var a=r.createOverride(new c([this._sheetnode])),s=new l;s.setFaceMode("ZONLY"),s.setRenderMode("@Edge",!0),s.setRenderMode("Outline",!0),s.setHalfVisibleSmoothEdges(!0),a.setRenderStyle(s,!0),e(this._sheetnode),this.createSheetContentVisu(this._sheetnode).then((e=>{t()}))}else e(this._sheetnode),t()}async createBackgroundViewNode(e){return D.method(),null!==this._node||null===this.backgroundInstance||(await this.backgroundInstance.background.loadStream(this.UDLObjectMap),this._node=this.backgroundInstance.background._node,e.addChild(this._node)),this._node}}})),define("DS/DibUDLWebLoader/DifAnnotationSetUDLWebLoader",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/Visualization/ModelLoader","DS/Visualization/ThreeJS_DS","DS/DibWebUtils/DibQueryToolbox","DS/DibUDLWebLoader/DifCaptureUDLWebLoader","DS/DibUDLWebLoader/MBDViewUDLWebLoader","DS/DibUDLWebLoader/Filter2DLUDLWebLoader","DS/DibUDLWebLoader/UDLconsole","DS/DibUDLWebLoader/CGR_UDLWebLoader"],(function(e,t,n,o,i,r,a,s,l,c,d,u){"use strict";return t.extend({init:function(){var t="05b373";d.method(t);var D,h,f,p,g,b,L=[],S=new Map,I=new Map,m=new Map,v=new Map,w=new Map,F=new Map,U=[],y=0,_=0,C=0,M=[],A=[],V=0,T=function(n,a,s){d.method(t),n.results||(d.log("DifAnnotationSetUDLWebLoader : No UDL retrieved"),s());var l=n.results.length,c=0,u=!1;n.results.forEach((function(n){if(e.is(n.attributes,"array")){var s,D=!1;if(n.attributes.forEach((function(e){if("resourceid"===e.name&&(s=e.value),"cgr"===e.name){u=!0,D=!0;var n={Type:"SG"};n.iD=s;var h=new o;n.Node=h,function(e,n,o){d.method(t);var a=new r.Matrix4;a.setPosition(new r.Vector3(0,0,0)),a.setRotation([1,0,0,0,1,0,0,0,1]),n.setMatrix(a);var s=new i;s.setFileType("cgr"),s.set2DAccuracy(y),s.set3DAccuracy(_),1===C&&s.setSceneGraphOrderMode(1),s.setOnLoadedCallback((function(){o(n)}));var l={provider:"FILE",filename:e,serverurl:"",proxyurl:"none",requiredAuth:null};s.loadModel(l,n)}(e.value,h,(function(e){m.set(n.iD,h),++c===l&&a()}))}})),!D){var h={Type:"SG"};h.iD=s;var f=new o;h.Node=f,m.set(h.iD,f)}}})),u||(d.log("CGR - No CGR for input model"),a(),s())},x=function(e,n,o){d.method(t),e||(d.log("Please provide AnnSet ID"),o());var i=S.get(e);i||(d.log("AnnSet not found"),o());var r=[];i.SupGeos.forEach((function(e){if(e.SupGeoRef&&e.SupGeoRef.Dif3DShapeInst.Dif3DShapeRepRef){var t=e.SupGeoRef.Dif3DShapeInst.Dif3DShapeRepRef.iD;r.includes(t)||0!==e.SupGeoRef.Dif3DShapeInst.Dif3DShapeRepRef.other||r.push(t)}})),i.MBDViews.forEach((function(e){e.view.SupGeos.forEach((function(e){if(e.SupGeoRef&&e.SupGeoRef.Dif3DShapeInst.Dif3DShapeRepRef){var t=e.SupGeoRef.Dif3DShapeInst.Dif3DShapeRepRef.iD;r.includes(t)||0!==e.SupGeoRef.Dif3DShapeInst.Dif3DShapeRepRef.other||r.push(t)}}))})),i.Captures.forEach((function(e){e.capture.SupGeos.forEach((function(e){if(e.SupGeoRef&&e.SupGeoRef.Dif3DShapeInst.Dif3DShapeRepRef){var t=e.SupGeoRef.Dif3DShapeInst.Dif3DShapeRepRef.iD;r.includes(t)||0!==e.SupGeoRef.Dif3DShapeInst.Dif3DShapeRepRef.other||r.push(t)}}))})),r.length>0?function(e,n,o){d.method(t);var i={objectPhysicalid:e,serverUrl:D,securityContext:h,onComplete:n,onFailure:o};a.getSupplementalGeometryData(i)}(r,(function(e){T(e,(function(){n()}),(function(){d.log("exploitfetchCGR Fail"),o()}))}),(function(){d.log("fetchCGR Fail"),o()})):n()},P=function(e,n,o){d.method(t);var i=" getIdUDLToFetch_ForViewStreamInstance";e||(d.log(i+"Please provide good ID"),o());var r=v.get(e);(r||(d.log(i+"obj not found"),o()),r.viewStream)&&function(e,n,o){d.method(t);var i=" getIdUDLToFetch_ForViewStream";e||(d.log(i+"Please provide good ID"),o());var r=v.get(e);if(r||(d.log(i+"obj not found"),o()),0===r.udl){var a=r.iD;n.includes(a)||n.push(a)}}(r.viewStream.iD,n,o)},N=function(e,n,o){d.method(t);var i=" getIdUDLToFetch_ForMBDViewInstance";e||(d.log(i+"Please provide good ID"),o());var r=v.get(e);(r||(d.log(i+"obj not found"),o()),r.view)&&function(e,n,o){d.method(t);var i=" getIdUDLToFetch_ForMBDView";e||(d.log(i+"Please provide good ID"),o());var r=v.get(e);if(r||(d.log(i+"obj not found"),o()),r.viewStreamInstance){var a=r.viewStreamInstance.iD;P(a,n,o)}}(r.view.iD,n,o)},O=function(e,n,o){d.method(t);var i=" getIdUDLToFetch_ForCaptureInstance";e||(d.log(i+"Please provide good ID"),o());var r=v.get(e);(r||(d.log(i+"obj not found"),o()),r.capture)&&function(e,n,o){d.method(t);var i=" getIdUDLToFetch_ForCapture";e||(d.log(i+"Please provide good ID"),o());var r=v.get(e);if(r||(d.log(i+"obj not found"),o()),r.viewStreamInstance){var a=r.viewStreamInstance.iD;P(a,n,o)}}(r.capture.iD,n,o)},W=function(e,n,o){d.method(t);var i=" getIdUDLToFetch";e||(d.log(i+"Please provide AnnSet ID"),o()),S.get(e)||(d.log(i+"AnnSet not found"),o());var r=[];!function(e,n,o){d.method(t);var i=" getIdUDLToFetch_ForAnnotationSet";e||(d.log(i+"Please provide good ID"),o());var r=v.get(e);r||(d.log(i+"obj not found"),o()),r.MBDViews&&r.MBDViews.forEach((function(e){var t=e.iD;N(t,n,o)})),r.Captures&&r.Captures.forEach((function(e){var t=e.iD;O(t,n,o)}))}(e,r,o),n(r)},j=function(o,i,r){d.method(t);o||(d.log(" loadUDLJsonPlease provide AnnSet ID"),r()),W(o,(function(o){!function(e,n,o){d.method(t);var i={objectPhysicalid:e,serverUrl:D,securityContext:h,onComplete:n,onFailure:o};a.getUDLData(i)}(o,(function(o){!function(o,i,r){d.method(t),o.results||(d.log("DifAnnotationSetUDLWebLoader : No UDL retrieved"),r());var a=o.results.length,s=0,l=!1;o.results.forEach((function(t){var o;e.is(t.attributes,"array")&&(t.attributes.forEach((function(e){if("resourceid"===e.name&&(o=e.value),"udl"===e.name){l=!0;var t=new n.fs.FS,c={provider:"FILE",filename:e.value,serverurl:"",proxyurl:"none",requiredAuth:null};t.importHttpContent(c,!1,(function(){var e=t.find("DrwStructure.json");null!==e?e.getText((function(e){var n=JSON.parse(e.target.result);C=n.DrawOrderMode;var r=v.get(o);if(r){r.udl=1;var l=r.father.father;l.flagjson=1,l.udljson=n.View,l.udlzip=t}s++,a===s&&i()})):r()}),(function(){d.log("UDL - ZIP open fails"),r()}))}})),l||(d.log("UDL - No UDL for input model"),r()))}))}(o,(function(){i()}),(function(){d.log("exploitFetchedUDL Fail"),r()}))}),(function(){d.log("fetchUDLFromListOfId Fail"),r()}))}),(function(){d.log("getIdUDLToFetch_ Fail"),r()}))},E=function(e,n,o){d.method(t);var i=" getIdUDLToFetch_ForMBDViewInstance";e||(d.log(i+"Please provide good ID"),o());var r=v.get(e);(r||(d.log(i+"obj not found"),o()),r.view)&&function(e,n,o){d.method(t);var i=" getIdUDLToFetch_ForMBDView";e||(d.log(i+"Please provide good ID"),o());var r=v.get(e);if(r||(d.log(i+"obj not found"),o()),1===r.flagjson){var a=r.iD;n.includes(a)||n.push(a)}}(r.view.iD,n,o)},R=function(e,n,o){d.method(t);var i=" getIdUDLToFetch_ForCaptureInstance";e||(d.log(i+"Please provide good ID"),o());var r=v.get(e);(r||(d.log(i+"obj not found"),o()),r.capture)&&function(e,n,o){d.method(t);var i=" getIdUDLToFetch_ForCapture";e||(d.log(i+"Please provide good ID"),o());var r=v.get(e);if(r||(d.log(i+"obj not found"),o()),1===r.flagjson){var a=r.iD;n.includes(a)||n.push(a)}}(r.capture.iD,n,o)},k=function(e,n,o){d.method(t);var i=" getIdUDLJson";e||(d.log(i+"Please provide AnnSet ID"),o()),S.get(e)||(d.log(i+"AnnSet not found"),o());var r=[];!function(e,n,o){d.method(t);var i=" getIdUDLJson_ForAnnotationSet";e||(d.log(i+"Please provide good ID"),o());var r=v.get(e);r||(d.log(i+"obj not found"),o()),r.MBDViews&&r.MBDViews.forEach((function(e){var t=e.iD;E(t,n,o)})),r.Captures&&r.Captures.forEach((function(e){var t=e.iD;R(t,n,o)}))}(e,r,o),n(r)},G=function(e,n,o,i){d.method(t);var r=" addCgrInfos";if(e||(d.log(r+"no json"),i()),n||(d.log(r+"no object"),i()),o||(d.log(r+"no zip"),i()),e.cgr){var a={flagcgr:0};a.udlzip=o,n.infocgr=a,n.infocgr.cgr=e.cgr,e.cgr_texts&&(n.infocgr.cgr_texts=e.cgr_texts),e.cgr_textsGP&&(n.infocgr.cgr_textsGP=e.cgr_textsGP)}},B=function(e,n,o){d.method(t);var i=" createObjectFromJson : ";n||(d.log(i+"father not here"),o());var r=e.Type;if("SupportPlane"===r)!function(e,n,o){d.method(t);var i=" create_SupportPlane_FromJson         : ";n||(d.log(i+"father not here"),o());var r=e.Type;"SupportPlane"!==r&&(d.log(i+"object not of good type"),o());var a=e.PLM_ID,s=v.get(a);s&&(d.log(i+"object already created "+a),o()),(s={}).iD=a,s.type=r,v.set(a,s),d.log(i+"created "+a),n.supportPlanes||(n.supportPlanes=[]);n.supportPlanes.push(s),e.Plane&&(s.plane=e.Plane)}(e,n,o);else if("TPSTest"===r||"TPS"===r)!function(e,n,o){d.method(t);var i=" create_TPSTest_FromJson              : ";n||(d.log(i+"father not here"),o());var r=e.Type;"TPSTest"!==r&&"TPS"!==r&&(d.log(i+"object not of good type"),o());var a=e.ID,s=v.get(a);s&&(d.log(i+"object already created "+a),o()),(s={}).iD=a,s.type=r,s.father=n,v.set(a,s),d.log(i+"created "+a),n.tpsTexts||(n.tpsTexts=[]);n.tpsTexts.push(s),e.Plane&&(s.plane=e.Plane),G(e,s,n.udlzip,o)}(e,n,o);else if("PresentedAnnotations"===r)!function(e,n,o){d.method(t);var i=" create_PresentedAnnotations_FromJson : ";n||(d.log(i+"father not here"),o());var r,a=e.Type;"PresentedAnnotations"!==a&&(d.log(i+"object not of good type"),o()),r=e.Plane?e.PLM_ID:e.PLM_ID+"A";var s=v.get(r);s&&(d.log(i+"object already created "+r),o()),(s={}).iD=r,s.type=a,v.set(r,s),d.log(i+"created "+r),n.presentedAnnotations||(n.presentedAnnotations=[]);n.presentedAnnotations.push(s),e.Plane?s.PlaneID=e.Plane:s.PlaneID=e.ID}(e,n,o);else if("Filter2DL"===r){var a={iJson:e,iObj_Father:n,iomap_ID_Node:m,iomap_ID_Obj:v,onSuccess:function(){d.log(i+" 2DLFilters Ok")},onFailure:function(e){d.log(e),o()}};c.create_Filter2DL_FromJson(a)}},z=function(e,n,o){d.method(t);var i=0;e.forEach((function(e){!function(e,n,o){d.method(t);var i=v.get(e);if(i||(d.log(" createObjectFromUDLJson : object not found"),o()),1===i.flagjson){var r=i.udljson;r.ObjectList&&r.ObjectList.forEach((function(e){B(e,i,o)})),i.flagjson=2,i.viewStreamInstance&&i.viewStreamInstance.viewStream&&G(r,i.viewStreamInstance.viewStream,i.udlzip,o)}n()}(e,(function(){i++}),(function(){i++,d.log(" createListObjectFromUDLJson : createObjectFromUDLJson KO "+i),o()}))})),n()},J=function(e,n,o){d.method(t);var i=" getIdCgrToLoad_ForMBDView";e||(d.log(i+"Please provide good ID"),o());var r=v.get(e);if(r||(d.log(i+"obj view not found"),o()),r.viewStreamInstance||(d.log(i+"obj viewStreamInstance not found"),o()),r.viewStreamInstance.viewStream||(d.log(i+"obj viewStream not found"),o()),r.viewStreamInstance.viewStream.infocgr&&void 0!==r.viewStreamInstance.viewStream.infocgr.flagcgr&&0===r.viewStreamInstance.viewStream.infocgr.flagcgr){var a=r.viewStreamInstance.viewStream.iD;n.includes(a)||n.push(a)}r.tpsTexts&&r.tpsTexts.forEach((function(e){!function(e,n,o){d.method(t);var i=" getIdCgrToLoad_ForTpsText";e||(d.log(i+"Please provide good ID"),o());var r=v.get(e);if(r||(d.log(i+"obj not found"),o()),0===r.infocgr.flagcgr){var a=r.iD;n.includes(a)||n.push(a)}}(e.iD,n,o)}))},q=function(e,n,o){d.method(t);var i=" getIdCgrToLoad_ForCaptureInstance";e||(d.log(i+"Please provide good ID"),o());var r=v.get(e);(r||(d.log(i+"obj not found"),o()),r.capture)&&function(e,n,o){d.method(t);var i=" getIdCgrToLoad_ForCapture";e||(d.log(i+"Please provide good ID"),o());var r=v.get(e);if(r||(d.log(i+"obj not found"),o()),r.viewStreamInstance||(d.log(i+"obj viewStreamInstance not found"),o()),r.viewStreamInstance.viewStream||(d.log(i+"obj viewStream not found"),o()),r.viewStreamInstance.viewStream.infocgr&&void 0!==r.viewStreamInstance.viewStream.infocgr.flagcgr&&0===r.viewStreamInstance.viewStream.infocgr.flagcgr){var a=r.viewStreamInstance.viewStream.iD;n.includes(a)||n.push(a)}}(r.capture.iD,n,o)},Z=function(e,n,o){d.method(t);var i=" getIdCgrToLoad_ForAnnotationSet";e||(d.log(i+"Please provide good ID"),o());var r=v.get(e);r||(d.log(i+"obj not found"),o()),r.MBDViews&&r.MBDViews.forEach((function(e){!function(e,n,o){d.method(t);var i=" getIdCgrToLoad_ForMBDViewInstance";e||(d.log(i+"Please provide good ID"),o());var r=v.get(e);if(r||(d.log(i+"obj not found"),o()),r.view){var a=r.view.iD;J(a,n,o)}}(e.iD,n,o)})),r.Captures&&r.Captures.forEach((function(e){var t=e.iD;q(t,n,o)}))},H=function(e,n){return d.method(t),new Promise((t=>{var i=" getIdCgrToLoad";e||(d.log(i+"object cgr missing"),n()),0!==e.flagcgr&&(d.log(i+"cgr already loaded"),n());var r=new o;e.cgrNode=r;var a={zipUDL:e.udlzip,cgrName:e.cgr,cgrNameText:e.cgr_texts,CGRNode:r,Accuracy2D:y,Accuracy3D:_,DrawOrderMode:C,onSuccess:t,onFailure:n};u.loadCGRs(a)}))},Q=async function(e,n,o){d.method(t);for(let t of e)await H(t.infocgr,o).then((()=>{var e=t.iD,o=t.infocgr.cgrNode;m.set(e,o),t.infocgr.flagcgr=1,n()}))},Y=function(e,n,o){d.method(t);var i=" loadListOfCgr";e||(d.log(i+"Please provide an list"),o());var r=e.length,a=0;0===r&&n();var s=[];e.forEach((function(e){var t=v.get(e);t||(d.log(i+"object not found"),o()),s.push(t)})),function(e,n,o){d.method(t);let i=Math.ceil(e.length/10);for(let t=0;t<10;t++){var r=e.slice(i*t,i*(t+1));Q(r,n,o)}}(s,(function(){++a===r&&n()}),(function(){d.log(i+"loadUdlCgr Fail"),o()}))},X=function(e,n,o){d.method(t);var i=" loadCgrForID";e||(d.log(i+" Please provide an ID"),o()),v.get(e)||(d.log(i+" object not found"),o()),function(e,n,o){d.method(t);var i=" getIdCgrToLoad";e||(d.log(i+"Please provide an ID"),o()),v.get(e)||(d.log(i+"object not found"),o());var r=[];Z(e,r,o),n(r)}(e,(function(e){Y(e,(function(){d.log(i+" loadListOfCgr Ok"),n()}),(function(){d.log(i+" loadListOfCgr Fail"),o()}))}),(function(){d.log(i+" getIdCgrToLoad Fail"),o()}))},$=function(e,n,o){d.method(t);var i=" getAllFiltersAnnSetID ";e||(d.log(i+"Please provide AnnSet ID"),o());var r=S.get(e);r||(d.log(i+" AnnSet not found"),o());var s=[];r.Captures.forEach((function(e){var t=e.capture;t&&t.filter2DLs&&t.filter2DLs.forEach((function(e){e&&e.links&&e.links.forEach((function(e){if(e.Link_ID){var n={};n.father=t,n.fatherID=t.viewStreamInstance.viewStream.iD,n.sR_ID=e.Link_ID,n.link=e,s.push(n)}}))}))}));var l=s.length,c=0;l>0?s.forEach((function(e){!function(e,n,o){d.method(t);var i=" getLinkPathFromId";e||(d.log(i+" no link info"),o());var r=e.father;r||(d.log(i+" no father"),o());var s=e.fatherID;s||(d.log(i+" no father id"),o());var l=e.sR_ID;l||(d.log(i+" no SR ID"),o());var c=r.resolvefilter2DLs;c||(r.resolvefilter2DLs=[],c=r.resolvefilter2DLs);var u={fatherID:s,role:"271",sR_ID:l,serverUrl:D,securityContext:h,onComplete:function(t){var o={};o.path=t,o.info=e.link,c.push(o),n()},onFailure:function(){d.log(i+"querry fail"),o()}};a.getPointedObjectsFromLink(u)}(e,(function(){++c===l&&n()}),(function(){d.log(i+" getLinkPathFromId Fail"),o()}))})):n()},K=function(e,n,i,r){d.method(t);var a=" getAnnSet3DNodeFromIDInternal";e||(d.log(a+"Please provide AnnSet ID"),r());var c=I.get(e);if(c)return n(c),void i();var u=S.get(e);u||(d.log(a+"AnnSet not found"),r()),n(f=new o),I.size>=V&&I.delete(e),I.set(e,f),j(e,(function(){!function(e,n,o){d.method(t);var i=" exploitUDLJson";e||(d.log(i+"Please provide AnnSet ID"),o()),k(e,(function(e){z(e,(function(){n()}),(function(){d.log(i+"createObjectFromUDLJson : KO"),o()}))}),(function(){d.log(i+"getIdUDLToFetch Fail"),o()}))}(e,(function(){X(e,(function(){x(e,(function(){$(e,(function(){!function(e,n,o,i){d.method(t);var r=new Map,a={};a.iD=e.iD,a.Name=e.Name,a.Type="AnnotationSet",a.Childs=[];var c={};c.node3D=n,a.visuinfo=c;var u={iFather:e,iObj_Father:a,ioMap_ID_Node:m,ioMap_ID_Obj:r,onSuccess:function(){d.log(" LoadAnnSetInNodeManage_Capture_Object Ok")},onFailure:function(e){d.log(e),i()}};l.Manage_MBDView_Object(u);var D={iFather:e,iObj_Father:a,ioMap_ID_Node:m,ioMap_ID_Obj:r,onSuccess:function(){d.log("Manage_Capture_Object Ok")},onFailure:function(e){d.log(e),i()}};s.Manage_Capture_Object(D),a.Childs.forEach((function(e){"CaptureInstance"===e.Type?A.push(e):"MBDViewInstance"===e.Type&&M.push(e)})),o()}(u,f,i,r)}),(function(){d.log(a+"getCGRFromAnnSetID Fail"),r()}))}),(function(){d.log(a+"getCGRFromAnnSetID Fail"),r()}))}),(function(){d.log(a+"loadCgrForID Fail"),r()}))}),(function(){d.log(a+"exploitUDLJson Fail"),r()}))}),(function(){d.log(a+"loadUDLJson Fail"),r()}))};this.getNumberOfSheets=function(){return d.method(t),L.length},this.getSheetName=function(e){return d.method(t),function(e){return d.method(t),S.get(e).Name}(e)},this.getLoadedSheetsId=function(){return d.method(t),U},this.getSheetBackgroundColor=function(e){return d.method(t),(new r.Color).setRGB(1,1,1)},this.getSheet3DNode=function(e){d.method(t),K(e.sheetID,e.onSheetNodeCreated,e.onSheetLoaded,e.onFailure)},this.getSheetSize=function(e){d.method(t);return{height:100,width:100}},this.setMaxSheetInCache=function(e){d.method(t),V=e},this.isDetailSheet=function(e){return d.method(t),!1},this.is3DObject=function(){return d.method(t),!0},this.getSheetThumbnail=function(e){d.method(t),e.onFailure()},this.setSheetPickingByView=function(e){d.method(t);var n=I.get(e.sheetID);null!==n&&n.children.forEach((function(t){t.traverse((function(n){t!=n&&n.setPickParent(e.pickingByView)}),{},!1)}))},this.set2DAccuracy=function(e){d.method(t),y=e},this.set3DAccuracy=function(e){d.method(t),_=e},this.loadModel=function(e){if(d.method(t),e||(d.log("DifAnnotationSetUDLWebLoader: Bad parameters"),e.onFailure()),e.serverUrl)if(e.securityContext){e.data||(d.log("DifAnnotationSetUDLWebLoader: Bad parameters"),e.onFailure()),e.data.physicalid||(d.log("DifAnnotationSetUDLWebLoader: Bad parameters"),e.onFailure()),e.data.dataType||(d.log("DifAnnotationSetUDLWebLoader: Bad parameters"),e.onFailure()),D=e.serverUrl,h=e.securityContext;var n={objectPhysicalid:e.data.physicalid,serverUrl:D,securityContext:h,onComplete:function(n){!function(e){d.method(t);var n,o=new Map,i=new Map;e.results.forEach((function(e){if("resourceid"in e){var t={};for(var r in e)"bo.DIFAbstractView.V_DIF3DMatrix"===r&&"string"==typeof e[r]?t[r]=e[r].split(",").map(Number):t[r]=e[r];i.set(e.resourceid,t)}else if(e.Path){var a,s,l,c,d,u,D,h,f;e.Path.forEach((function(e){var t=e.toString(),r=i.get(t);if(r){var S=r["ds6w:type"],I=o.get(t);if("DIFAnnotationSet"===S){if(!I){var m={MBDViews:[],Captures:[],SupGeos:[]};m.Name=r["bo.PLMEntity.V_Name"],(I=m).iD=r.resourceid,I.sID=t,I.type=S,o.set(t,I),v.set(I.iD,I),L.push(I)}n=I}if("DIFCaptureInstance"===S){if(!I){var U={};U.Scale=parseFloat(r["ro.DIFAbstractViewInstance.V_DIFScale"]),U.X=parseFloat(r["ro.DIFAbstractViewInstance.V_DIFPosX"]),U.Y=parseFloat(r["ro.DIFAbstractViewInstance.V_DIFPosY"]),U.Angle=parseFloat(r["ro.DIFAbstractViewInstance.V_DIFAngle"]),(I=U).iD=r.resourceid,I.sID=t,I.type=S,o.set(t,I),v.set(I.iD,I)}c=I,F.get(t)||(n.Captures.push(I),F.set(t,I))}if(function(e){return"DIFCapture"===e}(S)){if(!I){var y={MBDViews:[],SupGeos:[]};y.Name=r["bo.PLMEntity.V_Name"],y.Scale=parseFloat(r["bo.DIFAbstractView.V_DIFScale"]),y.ScaleStatus=r["bo.DIFAbstractView.V_DIFScaleStatus"],y.viewtype=r["bo.DIFCapture.V_ViewType"];var _=r["bo.DIFAbstractView.V_DIF3DMatrix"],C=[];12===_.length&&_.forEach((function(e){C.push(parseFloat(e))})),y.Matrix=C,(I=y).iD=r.resourceid,I.sID=t,I.type=S,I.flagjson=0,o.set(t,I),v.set(I.iD,I)}d=I,c.capture=d}if(function(e){return"MBDViewInstance"===e}(S)){if(!I){var M={};M.Scale=parseFloat(r["ro.DIFAbstractViewInstance.V_DIFScale"]),M.X=parseFloat(r["ro.DIFAbstractViewInstance.V_DIFPosX"]),M.Y=parseFloat(r["ro.DIFAbstractViewInstance.V_DIFPosY"]),M.Angle=parseFloat(r["ro.DIFAbstractViewInstance.V_DIFAngle"]),(I=M).iD=r.resourceid,I.sID=t,I.type=S,o.set(t,I),v.set(I.iD,I)}a=I,d?d.MBDViews.push(I):w.get(t)||(n.MBDViews.push(I),w.set(t,I))}if(function(e){return"MBDView"===e}(S)){if(!I){var A={SupGeos:[]};A.Name=r["bo.PLMEntity.V_Name"],A.Scale=parseFloat(r["bo.DIFAbstractView.V_DIFScale"]),A.ScaleStatus=r["bo.DIFAbstractView.V_DIFScaleStatus"],(I=A).iD=r.resourceid,I.sID=t,I.type=S,I.flagjson=0,o.set(t,I),v.set(I.iD,I)}s=I,a.view=s}if(function(e){return"DIFViewStreamInstance"===e}(S)&&(I||((I={}).iD=r.resourceid,I.sID=t,I.type=S,o.set(t,I),v.set(I.iD,I)),l=I,s?(I.father=s,s.viewStreamInstance=I):d&&(I.father=d,d.viewStreamInstance=I)),function(e){return"DIFViewStream"===e}(S)&&(I||((I={}).iD=r.resourceid,I.sID=t,I.type=S,I.udl=0,o.set(t,I),v.set(I.iD,I)),I.father=l,l.viewStream=I),function(e){return"DIFSupplementalGeometryInstance"===e}(S)&&(I||((I={}).iD=r.resourceid,I.sID=t,I.type=S,o.set(t,I),v.set(I.iD,I)),u=I,d?d.SupGeos.push(I):s?s.SupGeos.push(I):n.SupGeos.push(I)),function(e){return"DIFSupplementalGeometry"===e}(S)){if(!I){var V={};V.Name=r["bo.PLMEntity.V_Name"],(I=V).iD=r.resourceid,I.sID=t,I.type=S,o.set(t,I),v.set(I.iD,I)}D=I,u&&(u.SupGeoRef=D)}if(function(e){return"DIF3DShapeInstance"===e}(S)&&(I||((I={}).iD=r.resourceid,I.sID=t,I.type=S,o.set(t,I),v.set(I.iD,I)),h=I,D&&(I.father=D,D.Dif3DShapeInst=h)),function(e){return"DIF3DShape"===e}(S)&&(I||((I={}).iD=r.resourceid,I.sID=t,I.type=S,I.other=0,o.set(t,I),v.set(I.iD,I)),f=I,h&&(I.father=h,h.Dif3DShapeRepRef=f)),function(e){return"DIFStandardRep"===e}(S)&&(p||(p={}),p.iD=r.resourceid,g&&(g.Ref=p)),function(e){return"DIFStandardRepInstance"===e}(S)&&(g||(g={}),g.iD=r.resourceid),function(e){return"DIFAnnotatedProduct"===e}(S)){var T={};T.iD=r.resourceid,b=T}}})),a=null,s=null,c=null,d=null,l=null,u=null,D=null,h=null,f=null}}))}(n),U=[],L.forEach((function(e){var t=e.iD;S.set(t,e),U.push(t)}));var o={sheetIDList:U};U.length>0&&(o.currentSheetID=U[0]),e.onComplete(o)},onFailure:function(){d.log("DifAnnotationSetUDLWebLoader: Failed to get the AnnotationSet UDL"),e.onFailure()}};a.expandDifComponent(n)}else d.log("DifAnnotationSetUDLWebLoader: Bad argurment");else d.log("DifAnnotationSetUDLWebLoader: Bad argurment")},this.getAnnotationSetMBDCaptures=function(e){d.method(t);var n;n=A,e.onSuccess(n)},this.getAnnotationSetMBDViews=function(e){d.method(t);var n;n=M,e.onSuccess(n)},this.getAnnotationSet3DNode=function(e){d.method(t),f?e.onSuccess(f):e.onFailure()},this.clearLoader=function(){d.method(t),L&&(L=null),S&&(S=null),I&&(I=null),v&&(v=null),w&&(w=null),F&&(F=null),U&&(U=null),D&&(D=null),h&&(h=null),y&&(y=null),C&&(C=null),_&&(_=null),M&&(M=null),A&&(A=null),f&&(f=null),p&&(p=null),g&&(g=null),b&&(b=null),V&&(V=null)}}})})),define("DS/DibUDLWebLoader/UDL3DShape",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/Visualization/ModelLoader","DS/DibUDLWebLoader/UDLComponent","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLCache","DS/DibUDLWebLoader/UDLconsole","DS/DibWebUtils/DibQueryToolbox","DS/DibUDLWebLoader/UDLObjectManager"],(function(e,t,n,o,i,r,a,s,l,c,d){"use strict";return class extends r{constructor(e){super(e),this.udlurl=null,this.udl=0,this._node=null,this.UDLObjectMap=new Map}addFather(e){return e?a.isDIF3DShapeInstance(e)?(this.father=e,!0):(l.error(" obj not good type"),!1):(l.error("invalid argument"),!1)}async createNode(t,r){if(!t)return void l.error("invalid argument");if(null!==this._node)return t.addChild(this._node),this._node;this._node=new o;const a=this._node,u=t;try{if(null===this.udlurl)await new Promise(((t,n)=>{var o={objectPhysicalid:[this.ID],serverUrl:s.getServerUrl(),securityContext:s.getSecurityContext(),onComplete:o=>{var r=o.results[0];if(!r)return l.error("fetchCGR: no result"),n("No result from fetchCGR"),void t();e.is(r.attributes,"array")&&r.attributes.forEach((e=>{if("cgr"===e.name){var n=new i;n.setFileType("cgr"),1===this._drawOrderMode&&n.setSceneGraphOrderMode(1),n.setOnLoadedCallback((e=>{e&&(l.log(a),u.addChild(a),t())})),l.log(e.value);let o={provider:"FILE",filename:e.value,serverurl:"",proxyurl:"none",requiredAuth:null};l.log(a),n.loadModel(o,a)}}))},onFailure:()=>{l.log("fetchCGR Fail"),n("CGR fetch failed")}};c.getSupplementalGeometryData(o)}));else{const e=new n.fs.FS,t={provider:"FILE",filename:this.udlurl,serverurl:"",proxyurl:"none",requiredAuth:null};try{await new Promise(((n,o)=>{e.importHttpContent(t,!1,function(){const t=e.find("DrwStructure.json");t?t.getText(async function(t){try{const o=JSON.parse(t.target.result);l.error("shape_json",o);const r=new i;r.setFileType("cgr"),1===this._drawOrderMode&&r.setSceneGraphOrderMode(1);const s=new Promise((e=>{r.setOnLoadedCallback((function(t){t&&(u.addChild(a),e())}))})),c=o.cgr,D=e.find(c);if(!D)return l.error("Missing CGR entry:",c),void n();const h=new zip.BlobWriter;D.getData(h,(function(e){const t=new FileReader;t.onload=function(){r.loadModelFromBuffer(this.result,a)},t.readAsArrayBuffer(e)}),void 0,(function(e){l.error("Failed to load CGR:",e)}));const f=o?.ObjectList;if(f&&Array.isArray(f)){const t={ZIPEntries:e,UDLObjectMap:this.UDLObjectMap??new Map},n=new d(t);n.initUDLObjects(f),await n.LoadAllCGRs(),await n.HandleAllVisu();for(const e of n.UDLObjectMap.values())e?.node&&a.addChild(e.node)}await s,n()}catch(e){o(e)}}.bind(this)):o(new Error("Failed to find DrwStructure.json in ZIP"))}.bind(this),function(){o(new Error("importHttpContent failed!"))}.bind(this))}))}catch(e){throw l.error("Error loading node from ZIP:",e),e}}}catch(e){throw l.error("Error in creating node:",e),e}}}})),define("DS/DibUDLWebLoader/UDLLayout",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/Visualization/Node3D","DS/DibUDLWebLoader/UDLComponent","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o,i,r,a){"use strict";return class extends i{constructor(e){super(e),this.sheetInstances=new Map}addChild(e){return e?r.isDIFSheetInstance(e)?(this.sheetInstances.has(e.getID())||this.sheetInstances.set(e.getID(),e),!0):(a.error(" obj child not supported"),!1):(a.error("invalid argument"),!1)}getChildrenIdUDLtoFetch(e){let t=!0;for(let n of this.sheetInstances.values())t=t&&n.getIdUDLtoFetch(e);return t}}})),define("DS/DibUDLWebLoader/UDLComponentFactory",["UWA/Core","UWA/Class","DS/DibUDLWebLoader/UDLStreamInstance","DS/DibUDLWebLoader/UDLStream","DS/DibUDLWebLoader/UDLCaptureInstance","DS/DibUDLWebLoader/UDLCapture","DS/DibUDLWebLoader/UDLMBDViewInstance","DS/DibUDLWebLoader/UDLMBDView","DS/DibUDLWebLoader/UDLDifViewInstance","DS/DibUDLWebLoader/UDLDifView","DS/DibUDLWebLoader/UDLSheetInstance","DS/DibUDLWebLoader/UDLSheet","DS/DibUDLWebLoader/UDLLayout","DS/DibUDLWebLoader/UDLSupplementalGeometry","DS/DibUDLWebLoader/UDLSupplementalGeometryInstance","DS/DibUDLWebLoader/UDL3DShape","DS/DibUDLWebLoader/UDL3DShapeInstance","DS/DibUDLWebLoader/UDLAnnotationSet","DS/DibUDLWebLoader/UDLComponent","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o,i,r,a,s,l,c,d,u,D,h,f,p,g,b,L,S,I){"use strict";return class{constructor(){}instanceOf(){return"UDLComponentFactory"}createUDLWebObject(e,t){var L=null;if(S.isDIFSheetInstance(e))L=new d(t);else if(S.isDIFSheet(e))L=new u(t);else if(S.isMBDViewInstance(e))L=new a(t);else if(S.isMBDView(e))L=new s(t);else if(S.isDIFViewInstance(e))L=new l(t);else if(S.isDIFView(e))L=new c(t);else if(S.isDIFCaptureInstance(e))L=new i(t);else if(S.isDIFCapture(e))L=new r(t);else if(S.isDIFBackgroundViewRepInstance(e))L=new n(t);else if(S.isDIFBackgroundViewRep(e))L=new o(t);else if(S.isDIFViewStreamInstance(e))L=new n(t);else if(S.isDIFViewStream(e))L=new o(t);else if(S.isDIFSupplementalGeometryInstance(e))L=new f(t);else if(S.isDIFSupplementalGeometry(e))L=new h(t);else if(S.isDIF3DShape(e))L=new p(t);else if(S.isDIF3DShapeInstance(e))L=new g(t);else if(S.isDIFLayout(e))L=new D(t);else{if(!S.isDIFAnnotationSet(e))return I.error("unknown type : ",e),null;L=new b(t)}return L}}})),define("DS/DibUDLWebLoader/CommonUDLWebLoader",["DS/DibWebUtils/DibQueryToolbox","DS/DibUDLWebLoader/UDLconsole","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLCache","DS/DibUDLWebLoader/UDLComponentFactory"],(function(e,t,n,o,i){"use strict";return class{constructor(e){t.log("UDL common loader constructor"),this._2DAccuracy=.001,this._3DAccuracy=.001,this._contextViewer=void 0,this._sheetIDList=[],this._IDs=[]}getNumberOfSheets(){t.warn("NOT IMPLEMENTED")}getSheetName(e){return t.method(),o.getUDLComponent(e).getSheetName()}getLoadedSheetsId(){t.warn("NOT IMPLEMENTED")}getSheetBackgroundColor(e){return t.method(),o.getUDLComponent(e).getSheetBackgroundColor()}getSheet3DNode(e){if(t.method(),!e.sheetID)return t.error("Please provide sheet ID"),void onFailure();let i=o.getUDLComponent(e.sheetID);if(!(i instanceof Object)||i.gettype()!==n.DifType.DIFSheet)return t.error("Please provide correct sheet ID"),void onFailure();i.getNode(e.onSheetNodeCreated,e.onSheetLoaded)}setDisplaySheet(e){if(t.method(),!e.sheetID)return t.error("Please provide sheet ID"),void onFailure();let i=o.getUDLComponent(e.sheetID);if(!(i instanceof Object)||i.gettype()!==n.DifType.DIFSheet)return t.error("Please provide correct sheet ID"),void onFailure();this._contextViewer&&this._IDs.length>0&&this._contextViewer.getController().lockNodes({ids:this._IDs}),i.getNode(e.onSheetNodeCreated,e.onSheetLoaded)}getSheetSize(e){t.warn("NOT IMPLEMENTED")}setMaxSheetInCache(e){t.warn("NOT IMPLEMENTED")}isDetailSheet(e){t.warn("NOT IMPLEMENTED")}getSheetThumbnail(e){t.method(),e.onFailure()}setSheetPickingByView(e){t.warn("NOT IMPLEMENTED")}set2DAccuracy(e){t.method(),this._2DAccuracy=e}set3DAccuracy(e){t.method(),this._3DAccuracy=e}getAnnotationSetMBDViews(e){t.warn("NOT IMPLEMENTED")}getAnnotationSetMBDCaptures(e){t.warn("NOT IMPLEMENTED")}loadModel(r){if(t.method(),!r)return t.error("DifUDLWebLoader: Bad parameters"),void r.onFailure();if(!(r.serverUrl&&r.securityContext&&r.data&&r.data.physicalid&&r.data.dataType))return t.error("DifUDLWebLoader: Bad parameters"),void r.onFailure();o.setServerUrl(r.serverUrl),o.setSecurityContext(r.securityContext),o.setContextViewer(r.contextViewer),this._contextViewer=r.contextViewer;var a={objectPhysicalid:r.data.physicalid,serverUrl:o.getServerUrl(),securityContext:o.getSecurityContext(),onComplete:function(e){t.log(e);let a=new i;for(const i of e.results)if("resourceid"in i){var s={};for(var l in i)s[l]=i[l];if(s.resourceid){var c=a.createUDLWebObject(s["ds6w:type"],s);c instanceof Object?(o.setUDLComponent(s.resourceid,c),c.gettype()===n.DifType.DIFSheet&&this._sheetIDList.push(c.getID())):t.warn("unknown object : ",s)}}else if(i.Path){let e;for(const t of i.Path){let n=o.getUDLComponent(t);n&&(void 0!==e&&(e.addChild(n),n.addFather(e)),e=n)}}if(t.log(o._map_ID_Obj),this._contextViewer){var d={};d.ID=e.results[0].resourceid,d.Type=e.results[0]["ds6w:type"],d.label="",e.results[0]&&(d.label=e.results[0]["ds6w:label"]);var u={max:[-1,-1,-1],min:[1,1,1]},D={resourceid:d.ID,"ds6w:type":d.Type,"ds6w:globaltype":"ds6w:Part",boundingbox:u,"ds6w:label":d.label},h={encoding:"UTF-8",kind:"InstRef",version:"1.1"},f={infos:h,results:[D,{synthesis:{name:"ProgressiveExpand_FlatSynthesis",value:3}},{synthesis:{name:"ProgressiveExpand_OccSynthesis",value:3}},{synthesis:{name:"ProgressiveExpand_LeafSynthesis",value:1}}]},p=[];if(p.push(D),"DIFLayout"===d.Type){let e=o.getUDLComponent(d.ID);if(e.sheetInstances){for(const t of e.sheetInstances.values()){var g={resourceid:t.sheet.ID,"ds6w:type":"DIFSheet","ds6w:globaltype":"ds6w:Part",boundingbox:u};p.push(g)}for(const t of e.sheetInstances.values())if(t.sheet.viewInstances)for(const e of t.sheet.viewInstances.values()){var b={resourceid:e.view.ID,"ds6w:type":"DIFView","ds6w:globaltype":"ds6w:Part",boundingbox:u};p.push(b),this._IDs.push(e.view.ID)}}}let t=o.getUDLComponent(d.ID);if(t.viewInstances)for(const e of t.viewInstances.values()){b={resourceid:e.view.ID,"ds6w:type":"DIFView","ds6w:globaltype":"ds6w:Part",boundingbox:u};p.push(b),this._IDs.push(e.view.ID)}if("DIFLayout"===d.Type){let e=o.getUDLComponent(d.ID);if(e.sheetInstances){for(const t of e.sheetInstances){var L={resourceid:t[1].ID,"ds6w:type":"DIFSheetInstance",from:d.ID,to:t[1].sheet.ID};p.push(L)}for(const t of e.sheetInstances)if(t[1].sheet.viewInstances)for(const e of t[1].sheet.viewInstances.values()){var S={resourceid:e.ID,"ds6w:type":"DIFViewInstance",from:t[1].sheet.ID,to:e.view.ID};p.push(S)}}}var I={rootStats:f,infos:h,results:p};this._contextViewer.subscribe({event:"onRootAdded"},(function(){r.onComplete(m)})),this._contextViewer.loadJSON({data:[{rootID:d.ID,validForServerCall:!0,structure:I}]})}var m={sheetIDList:this._sheetIDList};this._sheetIDList.length>0&&(m.currentSheetID=this._sheetIDList[0]),null!==this._contextViewer&&void 0!==this._contextViewer||r.onComplete(m)}.bind(this),onFailure:function(){t.error("DifUDLWebLoader: Failed expandDifComponent"),r.onFailure()}};e.expandDifComponent(a)}is3DObject(){t.warn("NOT IMPLEMENTED")}clearLoader(){t.warn("NOT IMPLEMENTED")}ExtractSheetsFromQuerry(e){t.warn("NOT IMPLEMENTED")}}})),define("DS/DibUDLWebLoader/AnnotationSetUDLLoader",["DS/Visualization/ThreeJS_DS","DS/DibWebUtils/DibQueryToolbox","DS/DibUDLWebLoader/UDLComponentFactory","DS/DibUDLWebLoader/UDLTools","DS/DibUDLWebLoader/UDLCache","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o,i,r){"use strict";return class{constructor(){this.traces_color="05b373",r.method(this.traces_color),this.rootAnnotationSet=null,this._AnnSets=[],this._MapAnnSetIDToAnnSetIndexModel=new Map,this._MapAnnSetNodes=new Map,this._map_ID_Node=new Map,this._map_ID_Obj=new Map,this._MapIdToViewInAnn=new Map,this._MapIdToCapInAnn=new Map,this._AnnSetIDList=[],this._2DAccuracy=0,this._3DAccuracy=0,this._DrawOrderMode=0,this._LViewInfos=[],this._Node3D=null,this._standard=null,this._standardInstance=null,this._annotatedProduct=null,this._MaxAnnSetInCache=0}getNumberOfSheets(){return r.method(this.traces_color),this._AnnSets.length}getSheetName(e){return r.method(this.traces_color),this.getAnnSetNameFromIDInternal(e)}getLoadedSheetsId(){return r.method(this.traces_color),this._AnnSetIDList}getSheetBackgroundColor(t){return r.method(this.traces_color),(new e.Color).setRGB(1,1,1)}getSheet3DNode(e){if(r.method(this.traces_color),!e.sheetID)return r.error("Please provide sheet ID"),void onFailure();let t=i.getUDLComponent(e.sheetID);if(!(t instanceof Object)||t.gettype()!==o.DifType.DIFAnnotationSet)return r.error("Please provide correct sheet ID"),void onFailure();t.getNode(e.onSheetNodeCreated,e.onSheetLoaded),this._Node3D=t._annsetnode}getSheetSize(e){return r.method(this.traces_color),{height:100,width:100}}setMaxSheetInCache(e){r.method(this.traces_color),this._MaxAnnSetInCache=e}isDetailSheet(e){return r.method(this.traces_color),!1}is3DObject(){return r.method(this.traces_color),!0}getSheetThumbnail(e){r.method(this.traces_color),e.onFailure()}setSheetPickingByView(e){r.method(this.traces_color);let t=this._MapAnnSetNodes.get(e.sheetID);t&&t.children.forEach((t=>{t.traverse((n=>{t!==n&&n.setPickParent(e.pickingByView)}),{},!1)}))}set2DAccuracy(e){r.method(this.traces_color),this._2DAccuracy=e}set3DAccuracy(e){r.method(this.traces_color),this._3DAccuracy=e}loadModel(e){if(r.method(this.traces_color),!(e&&e.serverUrl&&e.securityContext&&e.data&&e.data.physicalid&&e.data.dataType))return r.log("AnnotationSetUDLLoader: Bad parameters"),void e.onFailure();i.setServerUrl(e.serverUrl),i.setSecurityContext(e.securityContext),i.setContextViewer(e.contextViewer);let a={objectPhysicalid:e.data.physicalid,serverUrl:i.getServerUrl(),securityContext:i.getSecurityContext(),onComplete:function(t){r.log(t);let a=new n;for(const e of t.results)if("resourceid"in e){var s={};for(var l in e)s[l]=e[l];if(s.resourceid){var c=a.createUDLWebObject(s["ds6w:type"],s);c instanceof Object?(i.setUDLComponent(s.resourceid,c),c.gettype()===o.DifType.DIFAnnotationSet&&(this._AnnSetIDList.push(c.getID()),this.rootAnnotationSet=c)):r.warn("unknown object : ",s)}}else if(e.Path){let t;for(const n of e.Path){let e=i.getUDLComponent(n);e&&(void 0!==t&&(t.addChild(e),e.addFather(t)),t=e)}}r.log(i._map_ID_Obj);let d={sheetIDList:this._AnnSetIDList};this._AnnSetIDList.length>0&&(d.currentSheetID=this._AnnSetIDList[0]),e.onComplete(d)}.bind(this),onFailure:()=>{r.log("AnnotationSetUDLLoader: Failed to get the AnnotationSet UDL"),e.onFailure()}};t.expandDifComponent(a)}getAnnotationSetMBDCaptures(e){r.method(this.traces_color);var t=[];this.rootAnnotationSet&&this.rootAnnotationSet.getCaptureInfo(t),r.log(t),e.onSuccess(t)}getAnnotationSetMBDViews(e){r.method(this.traces_color);var t=[];this.rootAnnotationSet&&this.rootAnnotationSet.getMBDViewInfo(t),r.log(t),e.onSuccess(t)}getAnnotationSet3DNode(e){r.method(this.traces_color),this._Node3D?e.onSuccess(this._Node3D):e.onFailure()}}})),define("DS/DibUDLWebLoader/CATDibUDLWebLoaderForAnnotationSet",["UWA/Class","DS/DibUDLWebLoader/DifAnnotationSetUDLWebLoader","DS/DibUDLWebLoader/AnnotationSetUDLLoader","DS/DibWebUtils/DibQueryToolbox","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o,i){"use strict";return e.extend({init:function(){var e,r="054db3";i.method(r),this.getAnnotationSetIDAssociatedToProductIDInternal=function(e){if(i.method(r),e)if(e.serverUrl)if(e.securityContext)if(e.physicalid){var t=[],n={objectPhysicalid:e.physicalid,serverUrl:e.serverUrl,securityContext:e.securityContext,onComplete:function(n){Array.isArray(n)?n.forEach((function(e){t.push(e.physicalid)})):n?t.push(n.physicalid):console.log("CATDibUDLWebLoaderForAnnotationSet: No AnnotationSet"),e.onComplete(t)},onFailure:function(){e.onFailure()}};o.getDIFAnnotatedProduct(n)}else console.log("CATDibUDLWebLoaderForAnnotationSet: Missing physicalid argument");else console.log("CATDibUDLWebLoaderForAnnotationSet: Missing securityContext argument");else console.log("CATDibUDLWebLoaderForAnnotationSet: Missing serverUrl argument");else console.log("CATDibUDLWebLoaderForAnnotationSet: Missing argument")},this.getProductIDAssociatedToAnnotationSetInternal=function(e){if(i.method(r),e)if(e.serverUrl)if(e.securityContext)if(e.physicalid){var t={objectPhysicalid:e.physicalid,serverUrl:e.serverUrl,securityContext:e.securityContext,onComplete:function(t){var n;if(Array.isArray(t)){var o=t[0];o?n=o.physicalid:console.log("CATDibUDLWebLoaderForAnnotationSet: No Product")}else t?n=t.physicalid:console.log("CATDibUDLWebLoaderForAnnotationSet: No Product");e.onComplete(n)},onFailure:function(){e.onFailure()}};o.getProductFromDifAnnotationSet(t)}else console.log("CATDibUDLWebLoaderForAnnotationSet: Missing physicalid argument");else console.log("CATDibUDLWebLoaderForAnnotationSet: Missing securityContext argument");else console.log("CATDibUDLWebLoaderForAnnotationSet: Missing serverUrl argument");else console.log("CATDibUDLWebLoaderForAnnotationSet: Missing argument")},this.loadModelInternal=function(o){if(i.method(r),o)if(o.serverUrl)if(o.securityContext)if(o.data)if(o.data.physicalid)if(o.data.dataType){if("DIFAnnotationSet"===o.data.dataType){e="true"===sessionStorage.getItem("UDL_Old_Loader")?new t:new n;var a={data:o.data,serverUrl:o.serverUrl,securityContext:o.securityContext,onComplete:function(t){var n={sheetID:t.currentSheetID,onSheetNodeCreated:function(e){e||(console.log("No sheet node"),o.onFailure())},onSheetLoaded:function(){o.onComplete(t)},onFailure:function(){console.log("Failed getting All AnnotationSet nodes")}};e.getSheet3DNode(n)},onFailure:function(){console.log("CATDibUDLWebLoaderForAnnotationSet: load Failed"),o.onFailure()}};e.loadModel(a)}e||(console.log("CATDibUDLWebLoaderForAnnotationSet: Input Data type not supported"),o.onFailure())}else console.log("CATDibUDLWebLoaderForAnnotationSet: Bad argurment");else console.log("CATDibUDLWebLoaderForAnnotationSet: Bad argurment");else console.log("CATDibUDLWebLoaderForAnnotationSet: Bad argurment");else console.log("CATDibUDLWebLoaderForAnnotationSet: Bad argurment");else console.log("CATDibUDLWebLoaderForAnnotationSet: Bad argurment");else console.log("CATDibUDLWebLoaderForAnnotationSet: Bad argurment")},this.getAnnotationSetIDAssociatedToProductID=function(e){i.method(r),this.getAnnotationSetIDAssociatedToProductIDInternal(e)},this.getProductIDAssociatedToAnnotationSet=function(e){i.method(r),this.getProductIDAssociatedToAnnotationSetInternal(e)},this.getAnnotationSet3DNode=function(t){i.method(r),e?e.getAnnotationSet3DNode(t):t.onFailure()},this.getAnnotationSetMBDCaptures=function(t){i.method(r),e?e.getAnnotationSetMBDCaptures(t):t.onFailure()},this.getAnnotationSetMBDViews=function(t){i.method(r),e?e.getAnnotationSetMBDViews(t):t.onFailure()},this.loadModel=function(e){i.method(r),this.loadModelInternal(e)}}})})),define("DS/DibUDLWebLoader/DifUDLWebLoader",["UWA/Core","UWA/Class","DS/ZipJS/zip-fs","DS/DibUDLWebLoader/CommonUDLWebLoader","DS/Visualization/Node3D","DS/Visualization/ModelLoader","DS/Visualization/ThreeJS_DS","DS/DibWebUtils/DibQueryToolbox","DS/Visualization/RenderStyle","DS/Visualization/PathElement","DS/DibUDLWebLoader/UDLconsole","DS/DibUDLWebLoader/Annotation_UDLWebLoader"],(function(e,t,n,o,i,r,a,s,l,c,d,u){"use strict";return t.extend({init:function(){var t,D,h,f,p,g=null,b=[],L=new Map,S=new Map,I=new Map,m=new Map,v=new Map,w=[],F=0,U=0,y=0,_={},C=0,M=[],A=[],V=[],T=50,x=new Map,P=new Map,N=new Map,O=new Map;O.set("current","ds6w:status"),O.set("policy","ds6w:policy"),O.set("project","ds6w:project"),O.set("responsible","ds6w:responsible"),O.set("reservedby","ds6w:reservedby"),O.set("reserved","ds6w:reserved"),O.set("revision","ds6wg:majorrevision"),O.set("V_Name","bo.PLMEntity.V_Name"),O.set("PLM_ExternalID","bo.PLMEntity.PLM_ExternalID"),O.set("V_description","bo.PLMEntity.V_description"),O.set("V_versionComment","bo.PLMReference.V_versionComment"),O.set("ea_releasedby","ea_releasedby.1");var W=function(e){return"DIFLayout"===e},j=function(e){return"DIFSheet"===e},E=function(e){return"DIFView"===e},R=function(e){return"DIFViewInstance"===e},k=function(e){return"DIFViewStreamInstance"===e||"DIFBackgroundViewRepInstance"===e},G=function(e){return"DIFViewStream"===e||"DIFBackgroundViewRep"===e},B=function(e,t){if(d.method(),g)return g.loadSheetInEnopadNode(e,t);h&&M.length>0&&h.getController().lockNodes({ids:M}),p&&f&&f.removeChild(p),V.forEach((function(e){e.removeChildren()})),V.splice(0,V.length);var n,o=m.get(e.BackgroundViewInstance.viewStream.ID);p=o,h&&(n=h.getController().getNode({id:e.ID})),n&&(f=n,n.addChild(o),S.set(e.ID,n)),e.views.forEach((function(e){var t,n=e.Angle;t="OnReference"===e.view.ScaleStatus?e.view.Scale:e.Scale;var o=new a.Matrix4;o.setPosition(new a.Vector3(e.X,e.Y,0));var i=[Math.cos(n)*t,Math.sin(n)*t,0,-Math.sin(n)*t,Math.cos(n)*t,0,0,0,1];o.setRotation(i);var r,s=m.get(e.view.viewStreamInstance.viewStream.ID);h&&(r=h.getController().getNode({id:e.view.ID})),r&&(V.push(r),r.addChild(s)),s.setMatrix(o)})),t(n)},z=function(e,t,n){if(d.method(),g)return g.loadSheetInNode(e,t,n);var o=m.get(e.BackgroundViewInstance.viewStream.ID);t.addChild(o),e.views.forEach((function(e){var n,o=e.Angle;n="OnReference"===e.view.ScaleStatus?e.view.Scale:e.Scale;var i=new a.Matrix4;i.setPosition(new a.Vector3(e.X,e.Y,0));var r=[Math.cos(o)*n,Math.sin(o)*n,0,-Math.sin(o)*n,Math.cos(o)*n,0,0,0,1];i.setRotation(r);var s=m.get(e.view.viewStreamInstance.viewStream.ID);void 0!==s&&(s.setMatrix(i),t.addChild(s))})),n()},J=function(e,t,n,o){if(d.method(),g)return g.loadCGRs(e,t,n,o);var i=n.cgr,r=t.find(i),s=new zip.BlobWriter,l=new a.Matrix4;l.setPosition(new a.Vector3(0,0,0));l.setRotation([1,0,0,0,1,0,0,0,1]),o.setMatrix(l),r.getData(s,(function(t){var n=new FileReader;n.onload=function(){e.loadModelFromBuffer(this.result,o)},n.readAsArrayBuffer(t)}),void 0,(function(e){d.log("CGR"+n+" did not load..."),d.log(e)}));var c=n.cgr_texts;if(""!==c&&void 0!==c){var u=t.find(c),D=new zip.BlobWriter;u.getData(D,(function(t){var n=new FileReader;n.onload=function(){e.loadModelFromBuffer(this.result,o)},n.readAsArrayBuffer(t)}))}},q=function(e,t,n){if(d.method(),g)return g.loadSymbolCGRs(e,t,n);if(n.ObjectList){let o=[];if(n.ObjectList.forEach((function(e){if("Symbol"===e.Type){var t=new i,n=P.get(e.Relation_ID);if(t._dibInfo={id:n,type:e.PLM_Type},t.getDibInfo=function(){return this._dibInfo},e.PLM_ref_ID&&e.PLM_ref_Type){var r=new i,a=N.get(e.Relation_ID);r._dibInfo={id:a,type:e.PLM_ref_Type},r.getDibInfo=function(){return this._dibInfo},o.push([e,r,t])}else o.push([e,t])}if("Route"===e.Type){var s=new i,l=P.get(e.Relation_ID);if(s._dibInfo={id:l,type:e.PLM_Type},s.getDibInfo=function(){return this._dibInfo},e.PLM_ref_ID&&e.PLM_ref_Type){var c=new i,d=N.get(e.Relation_ID);c._dibInfo={id:d,type:e.PLM_ref_Type},c.getDibInfo=function(){return this._dibInfo},o.push([e,c,s])}else o.push([e,s])}e.ObjectList&&e.ObjectList.forEach((function(e){var t=new i,n=P.get(e.Relation_ID);if(t._dibInfo={id:n,type:e.PLM_Type},t.getDibInfo=function(){return this._dibInfo},e.PLM_ref_ID&&e.PLM_ref_Type){var r=new i,a=N.get(e.Relation_ID);r._dibInfo={id:a,type:e.PLM_ref_Type},r.getDibInfo=function(){return this._dibInfo},o.push([e,r,t])}else o.push([e,t])}))})),o)for(let n of o)n[2]?(m.set(n[0].ID,n[2]),n[2].addChild(n[1])):m.set(n[0].ID,n[1]),J(e,t,n[0],n[1])}},Z=async function(e,n,o,i,r){return d.method(),g?g.loadViewSymbols(e,n,o,i,r):new Promise((a=>{e.setOnLoadedCallback((function(e){e&&a()}));!function(e,n,o,i){if(d.method(),g)return g.getSymbolRealPlmId(e,n,o,i);var r="getSymbolRealPlmId: ";e||(d.log(r+"Please provide view stream ID"),i()),n||(d.log(r+"Please provide symbols relation ID"),i());var a={difViewStreamId:e,symbolsInViewRelIds:n,serverUrl:t,securityContext:D,onComplete:function(e,t){o(e,t)},onFailure:function(){d.error(r+"Failed getRepObjPlmIdAssociatedToSymbol"),i()}};s.getRepObjPlmIdAssociatedToSymbol(a)}(i,r,(function(t,i){P.clear();for(const e of t??[])P.set(e.matches[0].sr_id,e.physicalid);N.clear();for(const e of i??[])N.set(e.matches[0].sr_id,e.to.physicalid);q(e,n,o),a()}),(function(){d.error("loadViewSymbols: Failed getSymbolRealPlmId"),q(e,n,o),a()}))}))},H=function(e,t,n,o){if(d.method(),g)return g.extractInfosFromQuery(e,t,n,o);var i="extractInfosFromQuery",r={},a={queryPhysicalID:t,mapPhysicalID:n,data:e,ioPointedObj:r,onSuccess:function(){d.log(i+" ExtractInfos Ok"),o(r)},onFailure:function(e){d.log(e+i+"Failed to ExtractInfos")}};u.extractEAInfos(a)},Q=function(e,t,n,o){if(d.method(),g)return g.extractInfosFromQueryEA(e,t,n,o);var i="ExtractInfosFromQueryEA",r={},a={queryPhysicalID:t,mapPhysicalID:n,data:e,ioPointedObj:r,onSuccess:function(){d.log(i+" ExtractEAInfos Ok"),o(r)},onFailure:function(e){d.log(e+i+"Failed to ExtractEAInfos")}};u.extractEAInfos(a)},Y=function(e,n,o,i,r){if(d.method(),g)return g.manageTextToDisplay(e,n,o,i,r);var a="manageTextToDisplay ";if(n.length>0&&e){var l={difViewStreamID:e,ioMapResultString:v,textsSrIds:n,serverUrl:t,securityContext:D,onSuccess:function(e){d.log(a+" Failed to retrieve query with SR ID"),i(e)},onFailure:function(){d.log(message+a+"Failed to queryWithSRId"),r()}};u.queryWithSRId(l)}else o.length>0?function(e,n,o){if(d.method(),g)return g.queryTextToDisplayWithPointedID(e,n,o);var i="queryTextToDisplayWithPointedID: ";e||(d.log(i+"Please provide text relation ID"),o());var r=e.length,a=0;let l=[];for(var c=0;r--;)("ContextualLink"===(f=h=e[r])||"ContextualLinkEA"===f)&&(f=_.ID),void 0!==f&&((p=v.get(h))?(0!=p.tabExpand.AttributeName.length&&c++,0!=p.tabEA.AttributeName.length&&c++,0!=p.tabGA.AttributeName.length&&c++):c++);for(r=e.length;r--;){var h,f;if(("ContextualLink"===(f=h=e[r])||"ContextualLinkEA"===f)&&(f=_.ID),void 0!==f){var p,b=0,L=0,S=0;if((p=v.get(h))&&(0!=p.tabExpand.AttributeName.length&&(L=1),0!=p.tabEA.AttributeName.length&&(b=1),0!=p.tabGA.AttributeName.length&&(S=1)),p&&L){var I={objectPhysicalid:f,textsAttr:p.tabExpand.AttributeName,serverUrl:t,mappingPLMRefId:h,securityContext:D,onComplete:function(e,t,o){H(e,t,o,(function(e){l.push(e)})),l.length+a===c&&(a=0,n(l))},onFailure:function(e){d.log(e+i+" Failed to retrieve query with pointed ID"),a++,l.length+a===c&&(a=0,n(l))}};s.expandPointedObject(I)}if(p&&b&&(I={objectPhysicalid:f,serverUrl:t,mappingPLMRefId:h,securityContext:D,onComplete:function(e,t,o){Q(e,t,o,(function(e){l.push(e)})),l.length+a===c&&(a=0,n(l))},onFailure:function(e){d.log(e+i+" Failed to retrieve query with pointed ID"),a++,l.length+a===c&&(a=0,n(l))}},s.getExtendedAttributes(I)),p&&S){var m={},w={ioPointedObj:m,onSuccess:function(){d.log("SUCCEEDED extractGAInfos Ok"),l.push(m),n(l)},onFailure:function(e){d.log(e+"Failed to extractGAInfos")}};u.extractGAInfos(w)}p||(d.log(i+"no tabResult"),a++,l.length+a===c&&n(l))}else a++,l.length+a===c&&n(l)}}(o,(function(e){i(e)}),(function(){d.log(a+" Failed to retrieve query with pointed ID"),r()})):(d.log(" Neither SR ID nor pointed ID to do the query"),r())},X=async function(e,t,n,o,r,a,s){return d.method(),g?g.loadViewTexts(e,t,n,o,r,a,s):new Promise((r=>{e.setOnLoadedCallback((function(e){e&&r()}));var l="loadViewTexts ";0,0,Y(o,a,s,(function(o){!function(e,t,n){if(d.method(),g)return g.exploitTextToDisplay(e,t,n);e||(d.log("No data to exploit"),n());var o="exploitTextToDisplay",i={data:e,ioMapResultString:v,onSuccess:function(){d.log(o+" exploitTextToDisplay Ok"),t()},onFailure:function(e){d.log(e+o+"Failed to exploitTextToDisplay"),n()}};u.exploitText(i)}(o,(function(){!function(e,t,n){if(d.method(),g)return g.loadTextToDisplay(e,t,n);let o=[];var r="loadTextToDisplay";if(n.ObjectList&&n.ObjectList.forEach((function(e){if("AnnWithLink"===e.Type){var t={textWithLink:e,ioMapDifObjStreamToLoadedNode:m,ioMapAttName:O,ioMapResultString:v,ioAllSymbolInfos:o,onSuccess:function(){d.log(r+" loadAnnWithLink Ok")},onFailure:function(e){d.log(e)}};u.loadAnnWithLink(t)}else if("AnnTableWithLink"===e.Type){e.ObjectList.forEach((function(e){if("AnnWithLink"===e.Type){var t={textWithLink:e,ioMapDifObjStreamToLoadedNode:m,ioMapAttName:O,ioMapResultString:v,ioAllSymbolInfos:o,onSuccess:function(){d.log(r+" loadAnnWithLink Ok")},onFailure:function(e){d.log(e)}};u.loadAnnWithLink(t)}}));var n=new i;o.push([e,n])}})),0!==o.length)for(let n of o)n[2]?(m.set(n[0].ID,n[2]),n[2].addChild(n[1])):m.set(n[0].ID,n[1]),J(e,t,n[0],n[1])}(e,t,n)}),(function(){d.error(l+"Failed exploitTextToDisplay")}))}),(function(){d.error(l+"Failed manageTextToDisplay")}))}))},$=async function(e,t,n,o,s){var l="loadViewCGRs ";if(g)return g.loadViewCGRs(e,t,n,o,s);var c=x.get(n);if(c)return d.log("View "+n+" is in cache"),void o(c);var D=new i;x.set(n,D);var h=0,f=[],p=0,b=[],L=[];t.ObjectList&&(h=t.ObjectList.length,v.clear(),t.ObjectList.forEach((function(e){if("AnnWithLink"===e.Type){p++,h--;var t={textWithLink:e,ioTextsSrIds:b,ioTextsPointedIds:L,ioMapAttName:O,ioMapResultString:v,onSuccess:function(){d.log(l+" ManageAnnWithLink Ok")},onFailure:function(e){d.log(e),s()}};u.manageAnnWithLink(t)}else"AnnTableWithLink"===e.Type?(p++,h--,e.ObjectList.forEach((function(e){if("AnnWithLink"===e.Type){p++;var t={textWithLink:e,ioTextsSrIds:b,ioTextsPointedIds:L,ioMapAttName:O,ioMapResultString:v,onSuccess:function(){d.log(l+" ManageAnnWithLink Ok")},onFailure:function(e){d.log(e),s()}};u.manageAnnWithLink(t)}}))):(f.push(e.Relation_ID),e.ObjectList&&e.ObjectList.forEach((function(e){-1===f.indexOf(e.Relation_ID)&&(f.push(e.Relation_ID),h++)})))})));var S=new r;S.setFileType("cgr"),S.set2DAccuracy(F),S.set3DAccuracy(U),S.setUDLMode(!0),1===y&&S.setSceneGraphOrderMode(1),p>0&&await X(S,e,t,n,p,b,L),h>0&&await Z(S,e,t,n,f),(p>0||h>0)&&function(e,t){if(d.method(),g)return g.loadViewInNode(e,t);if(e.ObjectList)for(const d of e.ObjectList){var n=new a.Matrix4;n.setPosition(new a.Vector3(d.SymbolCompToViewMatrix[4],d.SymbolCompToViewMatrix[5],0));var o=d.SymbolCompToViewMatrix[0],i=d.SymbolCompToViewMatrix[1],r=d.SymbolCompToViewMatrix[2],s=d.SymbolCompToViewMatrix[3];0===o&&0===r&&0===i&&0===s&&(o=1,s=1);var l=[o,r,0,i,s,0,0,0,1];n.setRotation(l);var c=m.get(d.ID);c&&(c.setMatrix(n),t.addChild(c)),d.ObjectList&&d.ObjectList.forEach((function(e){var n=new a.Matrix4;n.setPosition(new a.Vector3(e.SymbolCompToViewMatrix[4],e.SymbolCompToViewMatrix[5],0));var o=[e.SymbolCompToViewMatrix[0],e.SymbolCompToViewMatrix[2],0,e.SymbolCompToViewMatrix[1],e.SymbolCompToViewMatrix[3],0,0,0,1];n.setRotation(o);var i=m.get(e.ID);i.setMatrix(n),t.addChild(i)}))}}(t,D),S.setOnLoadedCallback((function(e){e&&o(D)})),J(S,e,t,D)};this.getNumberOfSheets=function(){return g?g.getNumberOfSheets():b.length},this.getSheetName=function(e){return g?g.getSheetName(e):function(e){return d.method(),g?g.getSheetNameFromIDInternal(e):L.get(e).Name}(e)},this.getLoadedSheetsId=function(){return g?g.getLoadedSheetsId():w},this.getSheetBackgroundColor=function(e){return g?g.getSheetBackgroundColor(e):function(e){return d.method(),g?g.getSheetBackgroundColorFromIDInternal(e):(new a.Color).setRGB(1,1,1)}(e)},this.getSheet3DNode=function(o){if(g)return g.getSheet3DNode(o);!function(o,r,a,u){if(d.method(),g)return g.getSheet3DNodeFromIDInternal(o,r,a,u);var h="getSheet3DNodeFromIDInternal : ";o||(d.log(h+"Please provide sheet ID"),u());var f=S.get(o);if(f)return r(f),void a();var p=L.get(o);p||(d.log(h+"Sheet not found"),u());var b=[];p.BackgroundViewInstance&&p.BackgroundViewInstance.viewStream&&b.push(p.BackgroundViewInstance.viewStream.ID),p.views.forEach((function(e){e.view&&e.view.viewStreamInstance.viewStream&&b.push(e.view.viewStreamInstance.viewStream.ID)}));var I=new i,v=I.createOverrideSetManager(),w=v.createSceneGraphOverrideSet();v.pushSceneGraphOverrideSet(w);var F=w.createOverride(new c([I])),U=new l({combineRenderMode:"IGNORE"});U.setFaceMode("MATERIAL"),F.setRenderStyle(U,!0),r(I),S.size===C&&S.clear(),S.set(o,I);var _={objectPhysicalid:b,serverUrl:t,securityContext:D,onComplete:function(t){t.results||(d.log(h+"getUDLData : No data retrieved"),u());var o=t.results.length;d.log("View To Load : "+o);var i=0;t.results.forEach((function(t){if(d.warn(t),e.is(t.attributes,"array")){var r,s=!1;if(t.attributes.forEach((function(e){if("resourceid"===e.name&&(r=e.value,d.log("View : "+r)),"udl"===e.name){d.log("UDL FOUND"),s=!0;var t=new n.fs.FS,l={provider:"FILE",filename:e.value,serverurl:"",proxyurl:"none",requiredAuth:null};t.importHttpContent(l,!1,(function(){var e=t.find("DrwStructure.json");null==e&&(d.log(h+"failed zipEntries"),u()),e.getText((function(e){var n=JSON.parse(e.target.result);y=n.DrawOrderMode,$(t,n.View,r,(function(e){m.set(r,e),i++,I.addChild(e),o!==i||z(p,I,(function(){a(),m.clear()}))}),(function(){d.log(h+"failed loadViewCGRs"),u()}))}))}),(function(){d.log(h+"failed importHttpContent"),u()}))}})),!s&&(d.error(h+"UDL - No UDL for view : "+r),i++,o===i))return void z(p,I,(function(){a(),m.clear()}))}}))},onFailure:function(){d.log(h+"Failed getUDLData query"),u()}};s.getUDLData(_)}(o.sheetID,o.onSheetNodeCreated,o.onSheetLoaded,o.onFailure)},this.setDisplaySheet=function(o){if(g)return g.setDisplaySheet(o);!function(o,r,a,l){if(d.method(),g)return g.setDisplaySheetInternal(o,r,a,l);var c="setDisplaySheetInternal : ";o||(d.log(c+"Please provide sheet ID"),l());var u=L.get(o);u||(d.log(c+"Sheet not found"),l());var h=[];u.BackgroundViewInstance&&u.BackgroundViewInstance.viewStream&&h.push(u.BackgroundViewInstance.viewStream.ID),u.views.forEach((function(e){e.view&&e.view.viewStreamInstance.viewStream&&h.push(e.view.viewStreamInstance.viewStream.ID)})),u.views.length+1>T-x.size&&x.clear();var f={objectPhysicalid:h,serverUrl:t,securityContext:D,onComplete:function(t){t.results||(d.log(c+"no results in data"),l());var o=t.results.length;d.log("View To Load : "+o);var s=0,D=!1;t.results.forEach((function(t){if(d.log(t),e.is(t.attributes,"array")){var h,f=!1;if(t.attributes.forEach((function(e){if("resourceid"===e.name&&(h=e.value,d.log("View : "+h)),"udl"===e.name){d.log("UDL FOUND"),D=!0,f=!0;var t=new n.fs.FS,i={provider:"FILE",filename:e.value,serverurl:"",proxyurl:"none",requiredAuth:null};t.importHttpContent(i,!1,(function(){var e=t.find("DrwStructure.json");null==e&&(d.log(c+"failed zipEntries"),l()),e.getText((function(e){var n=JSON.parse(e.target.result);$(t,n.View,h,(function(e){m.set(h,e),s++,o!==s||B(u,(function(e){r(e),a(),m.clear()}))}),(function(){d.log(c+"failed loadViewCGRs"),l()}))}))}),(function(){d.log(c+"failed importHttpContent"),l()}))}})),!f){d.error(c+"UDL - No UDL for view : "+h);var p=new i;if(m.set(h,p),s++,o===s)return void B(u,(function(e){r(e),a(),m.clear()}))}D||(d.error(c+"UDL - No UDL for input model"),l())}}))},onFailure:function(){d.log(c+"Failed getUDLData query"),l()}};s.getUDLData(f)}(o.sheetID,o.onSheetNodeCreated,o.onSheetLoaded,o.onFailure)},this.getSheetSize=function(e){return g?g.getSheetSize(e):{height:L.get(e).Height,width:L.get(e).Width}},this.setMaxSheetInCache=function(e){if(g)return g.setMaxSheetInCache(e);C=e},this.isDetailSheet=function(e){return!1},this.is3DObject=function(){return!1},this.getSheetThumbnail=function(e){e.onFailure()},this.setSheetPickingByView=function(e){if(g)return g.setSheetPickingByView(e);var t=S.get(e.sheetID);null!=t&&t.children.forEach((function(t){t.userData&&"DIFViewInstance"===t.userData.type?V.forEach((function(t){t.children.forEach((function(t){t.children.forEach((function(t){"CGR"===t.name&&t.setPickParent(e.pickingByView),t.children.forEach((function(t){"CGR"===t.name&&t.setPickParent(e.pickingByView),t.children.forEach((function(t){"CGR"===t.name&&t.setPickParent(e.pickingByView)}))}))}))}))})):t.children.forEach((function(t){"CGR"===t.name&&t.setPickParent(e.pickingByView),t.children.forEach((function(t){"CGR"===t.name&&t.setPickParent(e.pickingByView),t.children.forEach((function(t){"CGR"===t.name&&t.setPickParent(e.pickingByView)}))}))}))}))},this.set2DAccuracy=function(e){F=e},this.set3DAccuracy=function(e){U=e},this.clearLoader=function(){b&&(b=null),L&&(L=null),S&&(S=null),I&&(I=null),m&&(m=null),w&&(w=null),t&&(t=null),D&&(D=null),F&&(F=null),U&&(U=null),y&&(y=null),_&&(_=null),C&&(C=null),h&&(h=null),M&&(M=null),A&&(A=null),f&&(f=null),p&&(p=null),V&&(V=null),T&&(T=null),x&&(x=null),P&&(P=null),N&&(N=null),g&&g.clearLoader(),g=null},this.loadModel=function(e){if(e||(d.error("DifUDLWebLoader: Bad parameters"),e.onFailure()),e.serverUrl)if(e.securityContext){e.data||(d.error("DifUDLWebLoader: Bad parameters"),e.onFailure()),e.data.physicalid||(d.error("DifUDLWebLoader: Bad parameters"),e.onFailure()),e.data.dataType||(d.error("DifUDLWebLoader: Bad parameters"),e.onFailure()),t=e.serverUrl,D=e.securityContext,h=e.contextViewer;var n={objectPhysicalid:e.data.physicalid,serverUrl:t,securityContext:D,onComplete:function(t){_.ID=e.data.physicalid,_.Type=e.data.dataType,_.label="",t.results[0]&&(_.label=t.results[0]["ds6w:label"]);var n=function(e){if(d.method(),g)return g.ExtractSheetsFromQuery(e);var t,n;for(var o of e.results)if("resourceid"in o){var i={};for(var r in o)i[r]=o[r];i.resourceid&&I.set(i.resourceid,i)}else if(o.Path){var a,s,l;for(var c of o.Path){var u=c.toString(),D=I.get(u);if("ds6w:type"in D){if(!("DIFSheetInstance"!==D["ds6w:type"]||n&&n.ID===D.resourceid)){var h={};h.ID=D.resourceid,n=h,A.push(n)}if(j(D["ds6w:type"])&&(!t||t.ID!==D.resourceid)){var f={views:[]};f.ID=D.resourceid,f.Name=D["bo.PLMEntity.V_Name"],f.Height=parseFloat(D["bo.DIFAbstractSheet.V_DIFFormatHeight"]),f.Width=parseFloat(D["bo.DIFAbstractSheet.V_DIFFormatWidth"]),t=f,b.push(t),n&&(n.sheetID=f.ID)}if(R(D["ds6w:type"])){var p={};p.ID=D.resourceid,p.Scale=parseFloat(D["ro.DIFAbstractViewInstance.V_DIFScale"]),p.X=parseFloat(D["ro.DIFAbstractViewInstance.V_DIFPosX"]),p.Y=parseFloat(D["ro.DIFAbstractViewInstance.V_DIFPosY"]),p.Angle=parseFloat(D["ro.DIFAbstractViewInstance.V_DIFAngle"]),a=p,t.views.push(a)}if(E(D["ds6w:type"])){var L={};L.ID=D.resourceid,L.Scale=parseFloat(D["bo.DIFAbstractView.V_DIFScale"]),L.ScaleStatus=D["bo.DIFAbstractView.V_DIFScaleStatus"],s=L,a.view=s}if(k(D["ds6w:type"])){var S={};S.ID=D.resourceid,l=S,s?s.viewStreamInstance=S:t.BackgroundViewInstance=S}if(G(D["ds6w:type"])){var m={};m.ID=D.resourceid,l.viewStream=m}if("DIFCapture"===D["ds6w:type"])return!0}}a=null,s=null,l=null}}(t);if(n)return(g=new o).set2DAccuracy(F),g.set3DAccuracy(U),g.loadModel(e);if(w=[],b.forEach((function(e){var t=e.ID;L.set(t,e),w.push(t)})),h){var i={max:[-1,-1,-1],min:[1,1,1]},r={resourceid:_.ID,"ds6w:type":_.Type,"ds6w:globaltype":"ds6w:Part",boundingbox:i,"ds6w:label":_.label},a={encoding:"UTF-8",kind:"InstRef",version:"1.1"},s={infos:a,results:[r,{synthesis:{name:"ProgressiveExpand_FlatSynthesis",value:3}},{synthesis:{name:"ProgressiveExpand_OccSynthesis",value:3}},{synthesis:{name:"ProgressiveExpand_LeafSynthesis",value:1}}]},l=[];l.push(r),W(_.Type)&&b.forEach((function(e){var t={resourceid:e.ID,"ds6w:type":"DIFSheet","ds6w:globaltype":"ds6w:Part",boundingbox:i};l.push(t)})),b.forEach((function(e){e.views&&e.views.forEach((function(e){if(e.view){var t={resourceid:e.view.ID,"ds6w:type":"DIFView","ds6w:globaltype":"ds6w:Part",boundingbox:i};l.push(t),M.push(e.view.ID)}}))})),W(_.Type)&&A.forEach((function(e){var t={resourceid:e.ID,"ds6w:type":"DIFSheetInstance",from:_.ID,to:e.sheetID};l.push(t)})),b.forEach((function(e){e.views&&e.views.forEach((function(t){if(t.view){var n={resourceid:t.ID,"ds6w:type":"DIFViewInstance",from:e.ID,to:t.view.ID};l.push(n)}}))}));var c={rootStats:s,infos:a,results:l};h.loadJSON({data:[{rootID:_.ID,validForServerCall:!0,structure:c}]})}var u={sheetIDList:w};w.length>0&&(u.currentSheetID=w[0]),e.onComplete(u)},onFailure:function(){d.error("DifUDLWebLoader: Failed expandDifComponent"),e.onFailure()}};s.expandDifComponent(n)}else d.error("DifUDLWebLoader: Bad argurment");else d.error("DifUDLWebLoader: Bad argurment")}}})})),define("DS/DibUDLWebLoader/CATDibUDLWebLoader",["UWA/Core","UWA/Class","DS/DibUDLWebLoader/DraftingUDLWebLoader","DS/DibUDLWebLoader/DifUDLWebLoader","DS/DibUDLWebLoader/CommonUDLWebLoader","DS/DibWebUtils/DibQueryToolbox","DS/DibUDLWebLoader/UDLconsole"],(function(e,t,n,o,i,r,a){"use strict";var s="0000FF";return class{constructor(){a.method(s),this._maxSheetInCache=1,this._internalUDLLoader,this._2DAccuracy=.001,this._3DAccuracy=.001}loadDrawingModel(e){a.method(s),this._internalUDLLoader&&(this._internalUDLLoader.clearLoader(),this._internalUDLLoader=null),this._internalUDLLoader=new n,this._internalUDLLoader.set2DAccuracy(this._2DAccuracy),this._internalUDLLoader.set3DAccuracy(this._3DAccuracy);var t={objectPhysicalid:[e.data.physicalid],serverUrl:e.serverUrl,securityContext:e.securityContext,onComplete:function(t){var n;t.results[0].attributes.forEach((function(e){"udl"===e.name&&(n=e.value)}));var o={UDLObjURL:{provider:"FILE",filename:n,serverurl:"",proxyurl:"none",requiredAuth:null},serverUrl:e.serverUrl,securityContext:e.securityContext,objectPhysicalid:e.data.physicalid,onComplete:e.onComplete,onFailure:e.onFailure};this._internalUDLLoader.loadModel(o)}.bind(this),onFailure:function(){console.log("CATDibUDLWebLoader: Failed to fetch UDL"),e.onFailure()}};r.getUDLData(t)}loadDifSheetModel(e){a.method(s),"true"===sessionStorage.getItem("UDL_Common_Loader")?this._internalUDLLoader=new i:this._internalUDLLoader=new o,this._internalUDLLoader.set2DAccuracy(this._2DAccuracy),this._internalUDLLoader.set3DAccuracy(this._3DAccuracy);let t={data:e.data,serverUrl:e.serverUrl,contextViewer:e.contextViewer,securityContext:e.securityContext,onComplete:e.onComplete,onFailure:e.onFailure};this._internalUDLLoader.loadModel(t)}getNumberOfSheets(){return a.method(s),this._internalUDLLoader.getNumberOfSheets()}getSheetName(e){return a.method(s),this._internalUDLLoader.getSheetName(e)}getLoadedSheetsId(){return a.method(s),this._internalUDLLoader.getLoadedSheetsId()}getSheetBackgroundColor(e){return a.method(s),this._internalUDLLoader.getSheetBackgroundColor(e)}getSheet3DNode(e){a.method(s),this._internalUDLLoader.getSheet3DNode(e)}setDisplaySheet(e){a.method(s),this._internalUDLLoader.setDisplaySheet(e)}getSheetSize(e){return a.method(s),this._internalUDLLoader.getSheetSize(e)}setMaxSheetInCache(e){a.method(s),this._maxSheetInCache=e,this._internalUDLLoader&&this._internalUDLLoader.setMaxSheetInCache(e)}isDetailSheet(e){return a.method(s),this._internalUDLLoader.isDetailSheet(e)}getSheetThumbnail(e){return a.method(s),this._internalUDLLoader.getSheetThumbnail(e)}setSheetPickingByView(e){return a.method(s),this._internalUDLLoader.setSheetPickingByView(e)}set2DAccuracy(e){a.method(s),this._2DAccuracy=e}get2DAccuracy(){return a.method(s),this._2DAccuracy}set3DAccuracy(e){a.method(s),this._3DAccuracy=e}get3DAccuracy(){return a.method(s),this._3DAccuracy}loadModel(e){return a.method(s),e&&e.serverUrl&&e.securityContext&&e.data&&e.data.physicalid&&e.data.dataType?(a.error("Please provide symbols relation ID"),"Drawing"===e.data.dataType?this.loadDrawingModel(e):"DIFSheet"!==e.data.dataType&&"DIFLayout"!==e.data.dataType&&"DIFView"!==e.data.dataType||this.loadDifSheetModel(e),this._internalUDLLoader||(a.error("CATDibUDLWebLoader: Input Data type not supported"),e.onFailure()),void this._internalUDLLoader.setMaxSheetInCache(this._maxSheetInCache)):(a.error("DifUDLWebLoader: Bad parameters"),void e.onFailure())}clearLoader(){this._maxSheetInCache=null,this._internalUDLLoader&&(this._internalUDLLoader.clearLoader(),this._internalUDLLoader=null),this._2DAccuracy=.001,this._3DAccuracy=.001}}}));