define("DS/DELWKOWorkInstructionsModule/DataCollect/DELWKODataCollectMgmtUI",["UWA/Core","text!DS/DELWKOWorkInstructionsModule/assets/json/DataCollectTLVOptions.json"],(function(e,t){"use strict";return function(a,n,l,o,i,r,u){var c,s,d,f,v,D,g,C,V,m,I,b=n.getComponent("Element"),N=n.getComponent("WUXFrameWindowsManager"),h=null,p=null,L=[],M=null,w=null,y=null,R=null,S=null,A=null;return t=e.Json.decode(t),c=function(t,a){var n,l,o=a.get("V_Name"),i=a.get("PID"),u=!0;e.is(y)&&y.visibleFlag&&(h===t?(s(),u=!1):y.close()),p=i,n="DataCollectMgmtUI."+(h=t)+".Panel.Title",l=r.getNLSValue(n,{dcTitle:o}),u?(f(l),v(),y.show()):y.title=l},s=function(){i.emptyNodeModel(),L.forEach((function(e){l.removeReference(e.get("PID"),{silent:!0})})),h=null,p=null,L=[]},d=function(){y=null,R=null,S=null,A=null,i.removeEventListener(M),i.removeEventListener(w)},f=function(t){var l=N.getFrameWindow(a.getAppContext()).getImmersiveFrame();R=new b("div",{class:"DataCollectPlan-Panel-Container"}),(y=n.create("Panel",{domId:"DataCollectMgmtUI-Dialog-Identifier",title:e.is(t)?t:r.getNLSValue("DataCollectMgmtUI.Panel.DefaultTitle"),identifier:"DataCollectMgmtUI-Dialog-Identifier",immersiveFrame:l,content:R,width:600,height:315,position:{my:"center",at:"center"},resizableFlag:!0,closeButtonFlag:!0,useBordersFlag:!0,visibleFlag:!1,collapsibleFlag:!0,verticallyStretchableFlag:!0})).close=function(){y.hide(),s(),d()}},v=function(){var a=t[h];a=a||{},(S=new b("div",{class:"DataCollectPlan-Toolbar-Container"})).inject(R),(A=new b("div",{class:"DataCollectPlan-TLV-Container",id:"DataCollectDGView"})).inject(R),a=e.extend(a,{treeDocument:i.getWUXNodeModel(),treeListViewContainer:A,toolbarContainer:S,dataGridViewOptions:{toolbarOptions:{actionHandler:C}}},!0),o.createTreeListView(a)},I=function(e){var t=u.getNodeOptions(e);t.dataCollectPID=p,i.addNodeModel(t)},D=function(){i.emptyNodeModel(),i.prepareUpdate(),L.forEach((function(e){I(e)})),g(),i.pushUpdate(),M=i.addEventListener("select",V),w=i.addEventListener("unselect",V)},g=function(){var e=i.getTreeDocument(),t=i.getRootNodes();i.prepareUpdate(),t.sort((function(e,t){return e.getAttributeValue("V_TreeOrder")-t.getAttributeValue("V_TreeOrder")})).forEach((function(t,a){e.addRoot(t,a)})),i.pushUpdate()},C=function(e){var t;switch(e){case"DCPAddRow":a.notify("createDataCollectRow",p);break;case"DCPEditRow":t=i.getSelectedNodes()[0].getReferencePID(),a.notify("editDataCollectRow",l.getReferenceModel(t));break;case"DCPDeleteRow":m()}},V=function(){var e=i.getSelectedNodes(),t=["DCPAddRow"];1===e.length?t=t.concat(["DCPEditRow","DCPDeleteRow"]):e.length>1&&t.push("DCPDeleteRow"),o.enableToolBarItems(t)},m=function(){var t=i.getSelectedNodes();e.is(t)&&t.forEach((function(t){u.deleteDataCollectRow(p,t.getReferencePID(),{onComplete:function(n){e.is(n)&&n===t.getReferencePID()?(i.removeNode(t),a.info(r.getNLSValue("DataCollectMgmtUI.DCRowDelete.Success"))):a.warn(r.getNLSValue("DataCollectMgmtUI.DCRowDelete.Failure"))},onFailure:function(){a.warn(r.getNLSValue("DataCollectMgmtUI.DCRowDelete.Failure"))}})}))},{init:function(t){var n,l=t.get("type"),o=t.get("PID");e.is(l)&&e.is(l)?(u.isDataCollectCheckList(l)?n="DELWkiDataCollectChecklistReference":u.isDataCollectPlan(l)&&(n="DELWkiDataCollectPlanReference"),e.is(n)?u.fetchDataCollectAttrInfos((function(){c(n,t),u.getDataCollectRows(o,{onComplete:function(e){L=e,D()},onFailure:function(){a.warn(r.getNLSValue("DataCollectMgmtUI.CouldntFetchRows"))}})})):a.warn(r.getNLSValue("DataCollectMgmtUI.NotDataCollectType"))):a.warn(r.getNLSValue("DataCollectMgmtUI.InvalidModel"))},isActive:function(){return e.is(y)&&y.visibleFlag},addDataCollectRow:function(e){I(e)},deleteDataCollectRow:function(){m()},onUpdateDataCollectRow:function(e){var t,a=e.get("type"),n=e.get("PID");"PLMSpecifyHowToCollectDataCnx"===a&&e.hasChanged()&&(t=u.getNodeOptions(e),i.updateNodeOptions(n,t),e.hasChanged("V_TreeOrder")&&g())},onUpdateDataCollect:function(e){var t,a;e.get("PID")===p&&e.hasChanged("V_Name")&&(t="DataCollectMgmtUI."+h+".Panel.Title",a=r.getNLSValue(t,{dcTitle:e.get("V_Name")}),y.title=a)},getDataCollectPID:function(){return p},destroy:function(e){y.close()}}}})),define("DS/DELWKOWorkInstructionsModule/DataCollect/DELWKODataCollectDialogUI",["UWA/Core"],(function(e,t){"use strict";return function(t,a,n,l,o,i){var r,u,c,s,d,f,v,D,g,C,V,m,I,b,N,h,p,L,M,w,y,R,S,A=a.getComponent("Button"),_="PLMSpecifyHowToCollectDataCnx_Custo",E="V_DCMagnitude",U="DELExtTargetValues",P=["V_MinValue","V_MinControlValue","V_MaxValue","V_MaxControlValue"];return b=function(t,a){var n,l,i,r=[],u=[],c=a,s=function(t,a){var l,o="";return"Real"===c?l=t+n.Name:e.is(c)&&(l=t+c),e.is(l)&&V&&(o=d.get(l+"."+a)),o};return i=o.getObjectAndAttributeInfos(t),V&&(c=d.get("V_DCType")),i.forEach((function(a,i){var v,D,g,C=e.clone(a),m=!0;switch(V&&(C.objectToBeModified=d),e.is(t[i].displayType)&&(C.displayType=t[i].displayType),C.dataIndex){case"V_DCType":V?C.readOnly=!0:C.value=c,C.attributeInfo.onChange=p.bind(null,C.attributeInfo);break;case"V_DCMagnitude":C.attributeInfo.AuthorizedValues=o.getDimensions(),C.attributeInfo.HasRangeDefined="Yes",D=C.attributeInfo.AuthorizedValues,g=V?d.get("V_DCMagnitude"):"LENGTH","Real"===c?(n=D.find((function(e){return e.Name===g})),e.is(n)&&(r=n.Units,l=V?r.find((function(e){return e.Name===d.get("V_DCUnit")})):r[0])):l="",n&&(C.value=n.NLS),V&&(C.readOnly=!0),C.attributeInfo.onChange=L;break;case"V_PossibleValues":V&&(C.value=d.get(U+c+"."+C.dataIndex)),"Boolean"===c?(C.attributeInfo.HasRangeDefined="Yes",V&&(C.value=d.get(U+"Text."+C.dataIndex),C.value=Array.isArray(C.value)?C.value.join(","):C.value)):C.value=e.is(C.value)&&"NULL"!==C.value?C.value:[];break;case"V_DCUnit":e.is(l)&&(C.value=l.NLSName,f=l.Name),C.attributeInfo.onChange=N,C.attributeInfo.AuthorizedValues=r.map((function(t){var a=e.clone(t);return a.NLS=a.NLSName,a}));break;case"V_Value":"Real"===c&&e.is(l)&&(C.attributeInfo.Magnitude=n.Name,C.attributeInfo.ManipulationUnit=l.Name,C.attributeInfo.pattern="^[-+]?([1-9][0-9]*)|(0)$"),C.value=s(U,C.dataIndex);break;case"V_MinValue":case"V_MaxValue":C.attributeInfo.unit=e.is(l)?l.NLSName:"",C.attributeInfo.Type="Real"===c?"Double":"Integer",V&&(C.value={value:s(U,C.dataIndex),inclusive:d.get(C.dataIndex+"_Inclusive")});break;case"V_MinControlValue":case"V_MaxControlValue":C.attributeInfo.unit=e.is(l)?l.NLSName:"",C.attributeInfo.Type="Real"===c?"Double":"Integer",V&&(C.value={value:s("DELExtControlLimits",C.dataIndex),inclusive:d.get(C.dataIndex+"_Inclusive")});break;case"V_DCFormula":V?"Computed"===d.get("V_DCMode")&&(v=o.getNodeOptions(C.objectToBeModified),C.value=v.grid[C.dataIndex]):m=!1}m&&u.push(C)})),u},N=function(t,a){var n,l,i,r,u,c,s=[],d={};v.forEach((function(e){var a,o=e.dataIndex,c=e.attributeInfo.FullName;i=t[c],"V_DCMagnitude"===o&&(r=e.attributeInfo.AuthorizedValues[i.selectedIndex].Name,u=e.attributeInfo.AuthorizedValues[i.selectedIndex].Units),"V_DCUnit"===o&&(n=f,f=e.attributeInfo.AuthorizedValues[i.selectedIndex].Name,l=e.attributeInfo.AuthorizedValues[i.selectedIndex].label),"V_MinValue"!==o&&"V_MaxValue"!==o&&"V_MinControlValue"!==o&&"V_MaxControlValue"!==o&&"V_Value"!==o||((a="inclusiveLineEditor"===i.fieldType?i.getInputValue():i.value)&&s.push({fullName:c,value:a}),i.setUnit(l))})),c=-1,Array.isArray(u)&&e.is(n)&&(c=u.findIndex((function(e){return e.Name===n}))),c>-1&&f!==n&&(d={dimension:r,fromUnit:n,toUnit:f,valuesToConvert:s.map((function(e){return e.value}))},o.convertValuesBetweenUnits(d).then((function(e){var a=e.ConvertValue.split(";");s.forEach((function(e,n){var l=t[e.fullName],o=a[n];"inclusiveLineEditor"===l.fieldType?l.setValue(o):l.value=o}))})))},L=function(t,a){var n,l,o,i,r,u=_+".V_DCUnit",c=t[_+"."+E];for(l=0;l<v.length;l++)if("V_DCUnit"===(n=v[l]).attributeName?(o=e.clone(n),r=l):n.attributeName===E&&(i=n.attributeInfo.AuthorizedValues[c.selectedIndex].Units),e.is(o)&&e.is(i)){o.attributeInfo.AuthorizedValues=i.map((function(t){var a=e.clone(t);return a.NLS=a.NLSName,a})),s.updateAuthorizedList(o.attributeInfo,u),v[r]=o;break}N(t,a)},I=function(t){var n={},l={};n.attribute=v,e.is(t)&&e.is(t.formStyle)&&(l.formStyle=t.formStyle),l.section=n,c=a.createElement("div",{class:"section-container"}),s=a.create("FormUI",{sections:l,renderTo:c,headerAccordean:!1})},y=function(){var t,a,n,l=M();e.is(l)?(a=w(),t=D,n=g,r.close(),o.updateDataCollectRow(t,n,a)):r.buttons.Ok.disabled=!1},m=function(t,n){t=t||{},u=a.createElement("div",{class:"DataCollectRow-Dialog"}),(r=a.create("Dialog",{title:t.title,domId:"DataCollectRow-Dialog",content:u,resizableFlag:!0,modalFlag:!0,width:560,minWidth:290,buttons:{Cancel:new A({onClick:function(){r.close()}}),Ok:new A({disabled:!1,emphasize:"primary",onClick:n})}})).close=function(){this.destroy(),f=null,d=null,v=null,D=null,g=null,e.is(s)&&s.destroy(),e.is(u)&&u.destroy(),r=null}},M=function(){var t,a,n=s.validate(),l=function(e,t,a,n){var l=[],o={valid:!0,values:null,message:""};if(0===t.value.length)return o;if(Number.isNaN(Number(t.value)))return o.valid=!1,o.message=i.getNLSValue("DCRow.InvalidValue.Error",{attr:n}),o;if(Array.isArray(e)||"string"==typeof e)e&&(l=Array.isArray(e)?e:[e]);else if("NotSet"!==e.inclusive&&String(e.value).length>0){if(l=Number(e.value),Number.isNaN(l))return o.message=i.getNLSValue("DCRow.InvalidValue.Error",{attr:a}),o.valid=!1,o;l=[l]}return l.length>0&&(o.values=[],o.valid=l.every((function(e,t){return(e=String(e).trim()).length>0&&isNaN(e)?(o.values=null,o.message=i.getNLSValue("DCRow.InvalidValue.Error",{attr:a}),!1):(o.values.push(Number(e)),!0)}))),o},o=function(a,n){var o,r=i.getNLSValue(_+"."+a),u=i.getNLSValue(_+"."+n),c=e.clone(t[_+"."+a]),s=e.clone(t[_+"."+n]),d={valid:!0};if("NotSet"!==s.inclusive&&e.is(s.value)&&(s.value=String(s.value).trim(),d=l(c,s,r,u),s.value=Number(s.value),d.valid&&Array.isArray(d.values)))for(var f=0;f<d.values.length;f++)if(o=d.values[f],"Included"===s.inclusive&&o<s.value||"Included"!==s.inclusive&&o<=s.value){d.valid=!1,d.message=i.getNLSValue("DCRow.OutOfBound.Error",{toCompare:r,camparingWith:u});break}return d},u=function(a,n){var o,r=i.getNLSValue(_+"."+a),u=i.getNLSValue(_+"."+n),c=e.clone(t[_+"."+a]),s=e.clone(t[_+"."+n]),d={valid:!0};if("NotSet"!==s.inclusive&&e.is(s.value)&&(s.value=String(s.value).trim(),d=l(c,s,r,u),s.value=Number(s.value),d.valid&&Array.isArray(d.values)))for(var f=0;f<d.values.length;f++)if(o=d.values[f],"Included"===s.inclusive&&o>s.value||"Included"!==s.inclusive&&o>=s.value){d.valid=!1,d.message=i.getNLSValue("DCRow.OutOfBound.Error",{toCompare:r,camparingWith:u});break}return d},c=function(e){var t={valid:!0};return(t=o(e,"V_MinControlValue")).valid&&(t=o(e,"V_MinValue")),t.valid&&(t=u(e,"V_MaxControlValue")),t.valid&&(t=u(e,"V_MaxValue")),t};return n.result&&(t=s.getValues(),a=t[_+".V_DCType"],n.result=v.every((function(e){var t=e.attributeInfo.Name,l={valid:!0};switch(t){case"V_MinControlValue":l=o(t,"V_MinValue");break;case"V_Value":l=c(t);break;case"V_PossibleValues":"Integer"===a&&(l=c(t));break;case"V_MaxControlValue":l=u(t,"V_MaxValue")}return l.valid||(n.message=l.message),l.valid}))),!n.result&&n.message&&r.error(n.message),n.result},w=function(){var t,a={};return t=s.getValues(),v.forEach((function(n){var l,o,i,r=n.attributeInfo.Name,u=n.attributeInfo.FullName;e.is(t[u])&&(o=t[u],P.includes(r)?(""!==o.value&&(a[r]=String(o.value)),a[r+"_Inclusive"]=o.inclusive):"V_DCUnit"!==r&&"V_DCMagnitude"!==r||!e.is(o)?"V_PossibleValues"===r?o&&(a[r]=Array.isArray(o)?o:o.split(","),a[r]=a[r].map((function(e){return String(e)}))):a[r]="V_Value"===r&&o?String(o):Array.isArray(o)?o:String(o):(i=v.find((function(e){return e.dataIndex===r})),i&&(l=i.attributeInfo.AuthorizedValues.find((function(e){return e.NLSName===o||e.NLS===o})),e.is(l)&&(a[r]=l.Name))))})),a},h=function(t){var a,r={};e.is(t)&&(V=!0,d=t,a=l.getNodeModel(d.get("PID"),!0),D=a.options.dataCollectPID,g=d.get("PID"),r.onComplete=function(){var e,a=n.getReferenceModel(D),l={title:i.getNLSValue("DataCollectMgmtDialog.EditDialog")};e=a.get("type")+t.get("V_DCType"),v=b(C[e].Attribute),I({formStyle:C[e].formStyle}),m(l,y),c.inject(u)},o.fetchDataCollectRow(D,g,r))},R=function(t){var a,l,r={title:i.getNLSValue("DataCollectMgmtDialog.AddDialog")};l=n.getReferenceModel(D),o.isDataCollectPlan(l)?a="DELWkiDataCollectPlanReferenceReal":o.isDataCollectCheckList(l)&&(a="DELWkiDataCollectChecklistReferenceBoolean"),e.is(a)&&(v=b(C[a].Attribute,t),I({formStyle:C[a].formStyle}),m(r,S),c.inject(u))},p=function(t,a,n){var l,i=n.dsModel.value,r="DELWkiDataCollectPlanReference";e.is(c)&&(c.remove(),c=null),e.is(t)&&(l=o.getAuthorizedValueIndex(t,null,i))>-1&&(i=o.getAuthorizedValueDB(t,l)),v=b(C[r+=i].Attribute,i),I({formStyle:C[r].formStyle}),c.inject(u)},S=function(){var e,t;M()?(t=w(),e=D,r.close(),o.createDataCollectRow(e,t)):r.buttons.Ok.disabled=!1},{init:function(t){var a=e.is(t)?t:{};e.is(a.editFormConfig)&&(C=a.editFormConfig)},editDataCollectRow:function(e){h(e)},createDataCollectRow:function(t,a){e.is(t)&&(V=!1,D=t,R(a))}}}})),define("DS/DELWKOWorkInstructionsModule/DELWKOWorkInstructionsModule",["UWA/Core","DS/DELWKOWorkInstructionsModule/DataCollect/DELWKODataCollectMgmtUI","DS/DELWKOWorkInstructionsModule/DataCollect/DELWKODataCollectDialogUI"],(function(e,t,a){"use strict";return{behaviors:["UXFactoryBehavior","ModelBehavior","TreeListViewBehavior","WUXNodeModelBehavior","ResourceBehavior","DataCollectWKIBehavior","EditAttributeBehavior","LinkBehavior"],creator:function(n,l,o,i,r,u,c,s,d){var f,v,D,g,C,V,m,I,b,N=new t(n,l,o,i,r,u,c),h=new a(n,l,o,r,c,u);return v=function(t){(t=e.is(t,"array")?t:[t]).forEach((function(e){N.isActive()&&(c.isDataCollectRow(e)?N.onUpdateDataCollectRow(e):(c.isDataCollectPlan(e)||c.isDataCollectCheckList(e))&&N.onUpdateDataCollect(e))}))},D=function(t){var a={};e.is(t)&&(c.isDataCollectPlan(t)||c.isDataCollectCheckList(t)?(N.init(t),a.editFormConfig=f,h.init(a)):t.isWorkInstruction()&&s.editConfiguredAttributes(t))},g=function(t){e.is(t)&&h.editDataCollectRow(t)},C=function(){N.deleteDataCollectRow()},V=function(){N.isActive()&&N.destroy()},m=function(e){var t;e=Array.isArray(e)?e:[e],N.isActive()&&(t=N.getDataCollectPID(),e.some((function(e){return t===e.get("PID")}))&&N.destroy())},I=function(t){var a,n;e.is(t)&&(n=o.getReferenceModel(t),a=c.isDataCollectPlan(n)?"Real":"Boolean",h.createDataCollectRow(t,a))},b=function(t){t=e.is(t,"array")?t:[t],r.withTransactionUpdate((function(){t.forEach((function(t){var a;a=t,e.is(a)&&c.isDataCollectRow(a)&&N.isActive()&&N.addDataCollectRow(a)}))}))},{listenTo:function(){return{editWorkInstruction:D,createDataCollectRow:I,editDataCollectRow:g,deleteDataCollectRow:C,changeReference:v,HideAll:V,removeReference:m,addReference:b}},onStart:function(t,a){var n;e.is(t.editFormAttributesXML)&&(n=d.getXMLValues(t.editFormAttributesXML),f=n.convert("AttributesDescriptionList.Type","name")),a()},onStop:function(){}}}}}));