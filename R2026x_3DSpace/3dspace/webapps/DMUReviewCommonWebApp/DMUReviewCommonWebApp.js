define("DS/DMUReviewCommonWebApp/ENOR3CommonAppMain",["DS/DMUBaseUI/DMUReviewDnDComponent","DS/DMUReadPersistence/DMUWebServicesUtils","DS/DMUMeasurable/DMUToolsSceneGraph","DS/PADUtils/PADSettingsMgt","DS/CATWebUXComponents/DMUCommandsManager","DS/EditPropWidget/constants/ConstantsMapping","DS/CATWebUXComponents/DMUFrameWindow","DS/DMUBaseExperience/DMUModelServices","DS/DMUBaseExperience/EXPImportServices","DS/DMUBaseExperience/EXPToolsContext","DS/DMUBaseUIControllers/DMUSlidesController","DS/DMUBaseUIControllers/DMUCommentsController"],(function(e,t,i,n,a,o,r,l,s,d,c,u){"use strict";let g={widget:null,widgetLink:null,viewer:null,viewerAttachment:null};var p,m,f,v,D,h,w="3D",C=!1,S="CATCmdWorkbench";function b(){g.viewer.getContentName({callbacks:{onComplete:function(e){g.widget.setTitle(e.contentName)},onFailure:function(){}}})}async function y(e){e&&(e.subscribe("onReviewContextModified",(async function(e){if("ReviewNoContext"===e.type){var t=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),n=window.document.getElementsByClassName("DMULoadingPanel");t.length&&(t[0].dsModel.off(),t[0].dsModel.destroy(),t=null),n.length&&n[0].destroy()}if("ITF"===e.type?g.widget.setValue("mkpSession",JSON.stringify({type:e.type})):"Data"===e.type&&g.widget.deleteValue("mkpSession"),C)return;"Data"===e.type&&(!function(){const e=i.getRoots(g.viewer);let t=!1;for(let n=0;n<e.length;n++){let a=i.getNodeType(e[n]),o=0,r=d.getParentType(a);if("R2V_Activity"===r||"R2V_Activity"===a||o===e.length-1)return"R2V_Activity"!==r&&"R2V_Activity"!==a||(t=!0),t;o++}}()?e.type="3D":e.type="R2V3D"),"RefreshAB"===e.type&&(e.type=D);let o=v.getSourceApp().getId(),r=function(e){let t=v.getSourceApp().getId();return t.includes("R3R")?"2D"===e||"Drawing"===e?"ENOR3R_AP_2D":"Document"===e||"Specification Report"===e?"ENOR3R_AP_Document":"Requirement"===e||"Requirement Specification"===e?"ENOR3R_AP_Req":"ITF"===e?"ENOR3R_AP_PIM":"MSR"===e?"ENOR3R_AP_MSR":"R2V"===e?"ENOR3R_AP_R2V":"R2V3D"===e?"ENOR3R_AP_R2V3D":"FMEA"===e?"ENOR3R_AP_2DTable":"Workplan"===e?"ENOR3R_AP_Workplan":"3DFormats"===e||"ITFFormats"===e?"R3RFormat_AP_3D":"R2VFormats"===e?"R3RFormat_AP_R2V":"MSRFormats"===e?"R3RFormat_AP_MSR":"DIFSheet"===e||"DIFLayout"===e||"2DFL"===e?"ENOR3R_AP_2DFL":"2DFormats"===e||"2DFLFormats"===e?"R3RFormat_AP_2D":"WorkplanFormats"===e?"R3RFormat_AP_Workplan":t:t.includes("R3V")?"2D"===e||"Drawing"===e?"ENOR3V_AP_2D":"Document"===e||"Specification Report"===e?"ENOR3V_AP_Document":"Requirement"===e||"Requirement Specification"===e?"ENOR3V_AP_Req":"ITF"===e?"ENOR3V_AP_PIM":"MSR"===e?"ENOR3V_AP_MSR":"R2V"===e?"ENOR3V_AP_R2V":"R2V3D"===e?"ENOR3V_AP_R2V3D":"FMEA"===e?"ENOR3V_AP_2DTable":"Workplan"===e?"ENOR3V_AP_Workplan":"3DFormats"===e||"ITFFormats"===e?"R3VFormat_AP_3D":"R2VFormats"===e?"R3VFormat_AP_R2V":"MSRFormats"===e?"R3VFormat_AP_MSR":"DIFSheet"===e||"DIFLayout"===e||"2DFL"===e?"ENOR3V_AP_2DFL":"2DFormats"===e||"2DFLFormats"===e?"R3VFormat_AP_2D":"WorkplanFormats"===e?"R3VFormat_AP_Workplan":t:void 0}(e.type);if(w!==e.type&&"FMEA"!==e.type){if("3D"===w){let e=v.getComponent(WAfrStandardComponentKey.HandlerComponent);if(e.hasCheckHandler("AnnotationSwitchOnOff")&&e.isCheckExecutable("AnnotationSwitchOnOff")){let t=localStorage.getItem("CAT3DAnnotationSwitchOnOffCmd");await e.setCheckState({id:"AnnotationSwitchOnOff",state:!1}),localStorage.setItem("CAT3DAnnotationSwitchOnOffCmd",t)}}C=!0,await v.switchApp(o,r).then((()=>{C=!1,D=w,w=e.type,a.refreshCommandsManager(v),e.onABReady()}))}else D=w,w=e.type,e.onABReady()})),await e.setActiveState(!0))}var M,R=function(t){t.unsubscribe(m),m=null,b(),require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/PADUtils/PADCommandProxy"],(function(e,t){(M=e).renderDiv||M.initialize2(g.viewer.getFrameWindow().getViewerFrame(),t.appId(),g.widget.getValue("changeControlActivation")?"show":"hide","top-right",(function(){M.addEvent("onAuthoringCtxVisible",(function(e){e.showAuthoringContext&&g.widget.setValue("changeControlActivation",!0)}))}))})),require("DS/PADUtils/PADUtilsServices").isCloud()&&!window.__preventPrefPanel&&t.getViewer().displayIntroductoryControlPreferencePanel(),g.widget.getValue(S)||g.widget.addPreference({name:S,type:"hidden"});let i=async function(){if(p){var i=p.getController({context:t});await y(i),t.getLandingPageComponent().appReady(i,(function(t,i){(i.data&&i.data.items||[]).forEach((function(e){("Drawing"===e.objectType||e.objectTaxonomies&&e.objectTaxonomies.indexOf("Drawing")>-1)&&delete e.path})),i.data&&i.data.items&&i.data&&i.data.items.length&&e.callSpecReportData(t,i,!0)}))}};require([g.controller],(function(e){p=e,i()}));setTimeout((function(){"1"===g.widget.getValue("widgetForODTReplay")&&(g.widgetViewer3DReview._viewer3DReview=t),g.widget.dispatchEvent("onWidgetAndAppReady","1"===g.widget.getValue("widgetForODTReplay")?[{pad3DViewer:g.viewer}]:void 0),i()})),g.viewerAttachment&&g.viewerAttachment(f),g.viewerAttachment=null,t.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClic()};async function A(e){try{let i=await t.getParentTypes(e);return[e].concat(i)}catch{return[e]}}function P(e){e&&"string"==typeof e.reviewId&&g.widget.setValue("reviewIdInSession",JSON.stringify(e))}function V(){var e=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),t=window.document.getElementsByClassName("DMULoadingPanel");e.length&&(e[0].dsModel.off(),e[0].dsModel.destroy(),e=null),t.length&&t[0].destroy()}function U(){if(n&&n.setSetting("useNewUXGuidelinesWP",!0),!g.viewer){var t=new Promise((function(e){require(["text!DS/DMUReviewCommonWebApp/assets/DMUCommonWebApp.json"],(function(t){e([t])}))}));Promise.all([t]).then((function(t){var i=JSON.parse(t[0][0]);i.context="Default",require("DS/PADUtils/PADUtilsServices").isCloud()?(n.setSetting("mouseProfile",window.__mouseProfile),i.mouseProfile=window.__mouseProfile):(n.setSetting("mouseProfile","CATIA"),i.mouseProfile="CATIA");g.widget;var l=g.viewer=h;r.init(l,{executionContext:h.getExecutionContext()}),a.dmuSetExecutionContext(h.getExecutionContext()),a.dmuSetHandlerComponent(h.getExecutionContext()),i.mouseProfile&&l.getViewpoint().setDefaultController(!0,i.mouseProfile);var s=n.getSetting("propertiesFacet"),d=o.getMapping();d&&(d.physicssimulation.alwaysVisible=!1,s.push(d.physicssimulation)),l.setOption("propertiesFacet",s),l.subscribe({event:"onRootAdded"},b),l.subscribe({event:"onRootRemoved"},b),l.subscribe({event:"onRootAttached"},b),l.subscribe({event:"onRootDetached"},b),l.subscribe({event:"onContentNameModified"},b),e.initViewerDnd(l,A),localStorage.getItem("defaultSelectedTypeData")||localStorage.setItem("defaultSelectedTypeData","product"),n.setSetting("settypes",!0),n.setSetting("syncAutoReload",!0),"1"===g.widget.getValue("widgetForODTReplay")&&g.widget.dispatchEvent("onPAD3DViewerCreated",[{pad3DViewer:l}]),g.widgetInitDone&&g.widgetInitDone({appMainDiv:f,pad3DViewer:l}),R(l)}))}}async function I(){if(function(){var e=n.getSetting("enopad3dviewer_roles");let t=!0,i=require("DS/PADUtils/PADUtilsServices").isCloud(),a=require("DS/PADUtils/PADSession").isAuthoring();for(var o=0;o<e.length;o++)if("E19"===e[o].id&&(!e[o].platforms||e[o].platforms&&e[o].platforms.indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)){t=!1;break}n.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",t&&!i&&!a),n.setSetting("enopad3dviewer_staticMappingSupportActivated",!a)}(),g.viewer){var e=g.widget.getValue("reviewIdInSession");e=e?JSON.parse(e):void 0;var t,a,o=!1,r=!1,d=function(e){P(e);let i=g.widget.getValue("reviewIdInSession");t&&p&&p.giveController({context:g.viewer}).loadReviewAfterRefresh(JSON.parse(i))},c=i.getRoots(g.viewer),u=[];for(let e=0;e<c.length;e++)if(""!==i.getNodeID(c[e])){if(t=i.getNodeID(c[e]),a=i.getNodeType(c[e]),(u=await A(a)).includes("Document")||u.includes("Specification Report")||u.includes("Requirement")||u.includes("Requirement Specification")){o=!0;break}u.includes("FailureModesEffectsAnalysis")&&(r=!0)}var m=[],f=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:g.viewer});if(f){let e=f.getTransientReviewBag().getDMUObjects();if(e&&e.length>0)for(let t=0;t<e.length;t++){let i=await l.getObjectDefinition(e[t]);m.push(i)}}var v=async function(){if(m&&m.length>0){var e=require("DS/DMUBaseUIControllers/DMUReviewContextInitializer");if(e){await e.createReviewContext({context:g.viewer});var t=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:g.viewer});if(t){let e=t.getTransientReviewBag(),i=new s({viewer:g.viewer.get3DViewer(),experience:e});i.importDataModel({Model:m},(function(){e.refreshNode(),i.postImport()}))}}}},D=g.viewer.subscribe({event:"onRefreshCompleted"},(function(){if(g.viewer.unsubscribe(D),o)if(e)d(e);else{var i=n.getSetting("enopad3dviewer_lightNodeModel")?[{rootID:t,structure:{rootStats:{infos:{encoding:"UTF-8",kind:"InstRef",version:"1.1"},results:[{resourceid:t,"ds6w:type":a,"ds6w:globaltype":"ds6w:Part","ds6w:globalType":"ds6w:Part",boundingbox:{max:[-1,-1,-1],min:[1,1,1]}},{synthesis:{name:"ProgressiveExpand_FlatSynthesis",value:1}},{synthesis:{name:"ProgressiveExpand_OccSynthesis",value:1}},{synthesis:{name:"ProgressiveExpand_LeafSynthesis",value:1}}]},infos:{encoding:"UTF-8",kind:"InstRef",version:"1.1"},results:[{resourceid:t,"ds6w:type":a,"ds6w:globaltype":"ds6w:Part","ds6w:globalType":"ds6w:Part",nbchildren:"0"}]}}]:[{rootID:t,structure:{rootId:a,results:[{attributes:[{name:"did",value:t},{name:"physicalid",value:t},{name:"ds6w:type",value:a}]},{path:[t]}]}}];g.viewer.loadJSON({data:i}),v()}else if(u.includes("DesignSight")||u.includes("DIFSheet")||u.includes("DIFLayout"))e?d(e):(g.viewer.publish({event:"widgetReresh",data:{objectId:t,objectType:a}}),v());else if(u.includes("R2V_Activity")){if(!1===g.viewer.getSoIUsability()){g.viewer.toggleSOITimelinesUsability(!0);var r=g.viewer.subscribe({event:"onR2VLoaded"},(function(){g.viewer.getSoIUsability()&&g.viewer.toggleSOITimelinesUsability(!1),g.viewer.unsubscribe(r),r=null,e?d(e):v()}))}}else e?d(e):v()}));if(r){let i=require("DS/DMUBaseExperience/DMUContextManager");if(i){let n=i.giveEventsController({viewer:h.getViewer()}),o=h.getExecutionContext().getComponent("FMEALoaderForDesignValidation");o&&o.remove&&o.remove().then((()=>{n.fireEvent("onRootDataRemoved",{id:t}),i.removeReviewContext({viewer:h.getViewer()}),e?d(e):(g.viewer.publish({event:"widgetReresh",data:{objectId:t,objectType:a}}),v())}))}}else g.viewer.refresh()}}function x(){if(p){var e=p.giveController({context:g.viewer});e&&e.refreshContext()}}function E(){g.viewer&&(p&&p.unreferenceController({context:g.viewer}),g.viewer.destroy()),g={widget:null,viewer:null,viewerAttachment:null},p=null}function k(e){g.viewer&&g.viewer.search({searchQuery:e})}return class{constructor(e){if(g.widget=e.widget,f=e.appMainDiv,g.widgetInitDone=e.done,g.data=e.data.wkb?e.data.wkb:e.data,g.controller=e.data.controller?e.data.controller:e.controller,h=e.viewer?e.viewer:e.pad3DViewer,v=e.executionContext,e.pad3DViewer){g.viewer=e.pad3DViewer,r.init(g.viewer,{executionContext:v});var t=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:e.pad3DViewer}),i=t?t.getReviewCtxInformation():null;i&&i.reviewId&&P(i.reviewId)}else e.viewerAttachment?(g.viewerAttachment=e.viewerAttachment,U()):(g.viewerAttachment=function(e){e&&g.widget.setBody(e)},g.widget.addEvent("onLoad",U)),g.widget.addEvent("endEdit",x),g.widget.addEvent("onRefresh",I),g.widget.addEvent("onDestroy",E),g.widget.addEvent("onSearch",k),"1"===g.widget.getValue("widgetForODTReplay")&&(g.widgetViewer3DReview=this),g.widget.addEvent("onDMUReviewLoaded",P),g.widget.addEvent("onDMUValidationLoadFailed",V),g.widget.setMetas({helpPath:"DMUReviewWebApp/assets/help"});this.setUp=function(e){e.sourceApp&&e.sourceApp.getAfrAppId&&"ENX3DIR_AP"!==e.sourceApp.getAfrAppId()&&e.sourceApp.pad3DViewer!==g.viewer&&(g.viewer=e.sourceApp.pad3DViewer,r.init(g.viewer,{executionContext:v}),a.dmuSetExecutionContext(h.getExecutionContext()),a.refreshCommandsManager(h.getExecutionContext())),require("DS/ENOXInterWdgCom/LinkManager").updateLinkability({appIds:[],open:!0,uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXEnrich","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXEnrich","ENXLandingPageSync"]}),n.setSetting("activateWidgetLink",!0),n.setSetting("useNewUXGuidelinesWP",!0),g.widget.addEvent("onRefresh",I),g.widget.addEvent("onSearch",k),g.widget.addEvent("onDMUReviewLoaded",P),g.widget.setMetas({helpPath:"DMUReviewWebApp/assets/help"}),e.sourceApp&&e.sourceApp.pad3DViewer!==g.viewer&&(g.viewer=e.sourceApp.pad3DViewer),r.init(g.viewer,{executionContext:v}),a.dmuSetExecutionContext(h.getExecutionContext()),a.dmuSetHandlerComponent(h.getExecutionContext());var t=n.getSetting("propertiesFacet"),i=o.getMapping();i&&i.physicssimulation&&i.physicssimulation.facet&&(t.find((function(e){return!(!e||!e.facet||e.facet.name!==i.physicssimulation.facet.name)}))||(i.physicssimulation.alwaysVisible=!1,t.push(i.physicssimulation))),g.viewer.setOption("propertiesFacet",t),g.viewer.getBIController().toggleBetweenStandaloneAndSlaveMode("DUAL"),g.viewer.getViewer().updateViewPanelUIConfiguration&&g.viewer.getViewer().updateViewPanelUIConfiguration({useShadingIllustration:!1,useOutline:!1}),b(),require([g.controller],(function(t){var i=(p=t).getController({context:g.viewer});(async()=>{await y(i);let t=g.viewer.getLandingPageComponent();t.setViewer(g.viewer),t.appReady(),e.sourceApp&&e.sourceApp.issues&&1===e.sourceApp.issues.length&&i.appInitFromTransition({issues:e.sourceApp.issues,onNoActionDone:function(){}})})()})),n.setSetting("dynamic_authorized_types",!0);var l=n.getSetting("unsupported_root_types");l.push("Drawing"),n.setSetting("unsupported_root_types",l)},this.dispose=function(){if(n.setSetting("dynamic_authorized_types",!1),g.widget.removeEvent("onRefresh",I),g.widget.removeEvent("onSearch",k),g.widget.removeEvent("endEdit",undefined),g.widget.removeEvent("onDMUReviewLoaded",P),g.viewer){var t=n.getSetting("propertiesFacet"),i=o.getMapping();if(i){var a=t.findIndex((function(e){return!(!e||!e.facet||e.facet.name!==i.physicssimulation.facet.name)}));a>=0&&t.splice(a,1)}g.viewer.setOption("propertiesFacet",t),p&&p.unreferenceController({context:g.viewer,options:e})}p=null;let l=g.viewer&&g.viewer.getExecutionContext&&g.viewer.getExecutionContext()&&g.viewer.getExecutionContext().getTargetApp?g.viewer.getExecutionContext().getTargetApp():void 0;r.reset(l&&"ENX3DIR_AP"===l.getAfrAppId()?g.viewer:void 0)},this.onWillLeave=function(e){if(w="3D",D=void 0,g.viewer){var t=require("DS/DMUBaseExperience/DMUContextManager");if(t){const n=c.giveDMUSlidesController({context:g.viewer.getFrameWindow()});n&&n.setVisibleFlag(!1);const a=u.giveDMUCommentsController({context:g.viewer.getFrameWindow()});a&&a.setVisibleFlag(!1);var i=t.giveEventsController({viewer:g.viewer.getViewer()});i&&i.fireEvent("onLeavingReviewApp",{targetApp:e&&e.options?e.options.id:""})}}},this.onWillEnter=function(){if(g.viewer&&require("DS/DMUBaseExperience/DMUContextManager")){const e=c.giveDMUSlidesController({context:g.viewer.getFrameWindow()});e&&e.setVisibleFlag(!0);const t=u.giveDMUCommentsController({context:g.viewer.getFrameWindow()});t&&t.setVisibleFlag(!0)}}}}})),define("DS/DMUReviewCommonWebApp/DMUCommonWebAppController",["UWA/Class","DS/DMUControls/EXPNotify","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUReadPersistence/DMULoadMarkupServices","DS/DMUBaseExperience/DMUContextManager","UWA/Utils","DS/DMUBaseExperience/EXPManagerSet","DS/DMUPlaySlide/controllers/DMUSlideShowController","DS/DMUPlaySlide/DMUSlide","DS/DMUBaseUIControllers/DMUApplicativeContextManager","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/CoreEvents/ModelEvents","DS/DMUBaseUIControllers/DMU2DSheetManager","DS/DMUBaseUIControllers/DMUCommentsController","DS/PADUtils/PADUtilsServices","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","DS/DMUValidationPersistence/DMUValidationPersistenceServices","DS/DMUPersistence/DMUDOSThumbnailServices","DS/DMUBaseUIControllers/DMUReviewContextInitializer","DS/DMUReadPersistence/DMULoadingContextController","DS/CATWebUXSelectionManager/CATWebUXSelectionManager","DS/DMUReadPersistence/DMUWebServicesUtils","DS/PADUtils/PADSettingsMgt","DS/DMUControls/DMUInfoModalDiv","DS/PADUtils/views/PADProgressBar","DS/PADServices/utils/GlobalModelEvents","DS/DMUBaseUIControllers/DMUSceneDisplayController","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUPlayMarker/DMUMarkerFactory","DS/DMUPlayMarker/DMUMarkerServices","DS/DMUBaseExperience/DMUToolsClipping","DS/DMUControls/DMUWarningPanel","DS/Selection/PSOManager","DS/CATWebUXComponents/DMUCommandsManager","DS/DMUBaseUIServices/DMUSlidePreferences","DS/DMUBaseUIControllers/DMUSlidesController","DS/DMUBaseUIControllers/DMUReviewController","DS/CATWebUXComponents/CATWebUXUtils","i18n!DS/DMUBaseUI/assets/nls/DMUBaseUI","DS/CATWebUXSlideDrop/CATWebUXSlideDropServices","DS/DMUControls/DMUToolsSave","DS/DMUBaseUIControllers/DMUReqCompareController","DS/DMUBaseExperience/EXPToolsContext","DS/DMUBaseUI/DMUToolsUsers","DS/DMUBaseUIComponents/DMURichTextServices","i18n!DS/DMUReviewCommonWebApp/assets/nls/DMUReviewCommonWebApp","i18n!DS/CATWebUXTIC/assets/nls/CATWebUXTICCmdAdapt","i18n!DS/DMUBaseUIComponents/assets/nls/DMUBaseUIComponents"],(function(e,t,i,n,a,o,r,l,s,d,c,u,g,p,m,f,v,D,h,w,C,S,b,y,M,R,A,P,V,U,I,x,E,k,O,F,T,_,W,L,N,j,B,q,H,X,G,J,z,K,Q,Y){"use strict";return e.extend({init:function(Z,$){this._parent(Z);var ee,te,ie,ne,ae,oe,re=this,le=!1,se=$,de=(Z||{}).ctxViewer,ce=a.getEventsController({viewer:de.getViewer()}),ue=!1,ge=new p,pe={},me={},fe=null,ve={},De={};let he,we,Ce,Se,be=null,ye=!1;var Me,Re,Ae,Pe,Ve,Ue,Ie,xe,Ee,ke,Oe,Fe,Te,_e,We,Le,Ne,je,Be=!1,qe=!1;let He,Xe,Ge=!1,Je=!1,ze=!0;const Ke=["SIMItfSimulation","PLMPIMMetricReference","Document","Specification Report","DIFLayout","DIFSheet","DIFAnnotationSet","Requirement","Requirement Specification","DesignSight","DELLmiWorkPlanSystemReference","DELLmiHeaderWorkPlanReference","FailureModesEffectsAnalysis"];function Qe(e,i){Xe&&(Xe.destroy(),Xe=null),Xe=new t({body:de.getFrameWindow().getUIFrame(),type:e,message:i})}C.notify({notifId:"review.init"}),this.setSlideShowController=function(e){te=e},this.setValidatedObjCreationFlag=function(e){ue=e};var Ye=function(){return ie||(ie=L.giveDMUSlidesController({context:de.getFrameWindow()})),ie};function Ze(e){const t=N.giveDMUReviewController({context:de.getFrameWindow()});let i,n,o;if(de.getExecutionContext){["Marker","Measure","Markup","Slide","Check","Highlight","Section"].forEach((e=>{a.setAuthoringFeatureTypes(e)}))}if("R3V"===se?(Le&&clearTimeout(Le),Le=setTimeout((function(){if(Le=null,!de)return;var e,o=a.getReviewContext({context:de});e=["DMU2DCompareCmdHdr"],n=le&&0!==de.getViewer().getVisibleSpace()&&c.getRoots(de).length&&(!o||o&&!o.isReadOnly())&&Pe&&("Drawing"===Ae||"DIFSheet"===Ae||"DIFLayout"===Ae);let l=!0;o&&o.getCurrentSessionMarkup()&&o.getCurrentSessionMarkup().getActiveFlag()&&o.getCurrentSessionMarkup().isVisible()&&o.getCurrentSessionMarkup().getMarkupOwner()&&!o.getCurrentSessionMarkup().getMarkupOwner().isWebMarkup()&&(l=!1),re._applyFlag(e,n&&l),e=["DMUReqCompareCmdHdr"],n=le&&0!==de.getViewer().getVisibleSpace()&&c.getRoots(de).length&&(!o||o&&!o.isReadOnly())&&Pe&&("Requirement"===Ae||"Requirement Specification"===Ae),l=!0,o&&o.getCurrentSessionMarkup()&&o.getCurrentSessionMarkup().getActiveFlag()&&o.getCurrentSessionMarkup().isVisible()&&o.getCurrentSessionMarkup().getMarkupOwner()&&!o.getCurrentSessionMarkup().getMarkupOwner().isWebMarkup()&&(l=!1),re._applyFlag(e,n&&l),e=["measureCmdHdr","sectionCmdHdr","3DcompareCmdHdr","thicknessCmdHdr","LockUnlockSectionHdr"],n=le&&0!==de.getViewer().getVisibleSpace()&&c.getRoots(de).length&&(!o||o&&!o.isReadOnly()),l=!0,o&&o.getCurrentSessionMarkup()&&o.getCurrentSessionMarkup().getActiveFlag()&&o.getCurrentSessionMarkup().isVisible()&&o.getCurrentSessionMarkup().getMarkupOwner()&&!o.getCurrentSessionMarkup().getMarkupOwner().isWebMarkup()&&(l=!1),re._applyFlag(e,n&&l),n=(n||!n&&!c.getRoots(de).length)&&o&&!o.isReadOnly()&&o.getCurrentSessionMarkup()&&!o.getCurrentSessionMarkup().isReadOnly();let s=o&&o.getValidation()?o.getValidation().getCurrentMarkup():null;for(;s&&"Markup"!==s.getValType();)s=s.getParentRepRef().getParent();l=!0,s&&!1===s.isWebMarkup()&&(l=!1),t&&(i=t.getRestrictions(s));let d=!0;o&&o.getValidation()&&(!o.getValidation().getModifyAccessFlag()||"Activated"===o.getValidation().getRestrictedEditionFlag()&&i&&s&&!i.markup.canEdit)&&(d=!1),e=["DMUEditFormatsHdr","slideCmdHdr","DMUExportReviewAsPdfHdr"],re._applyFlag(e,n&&l&&d),s=o&&o.getValidation()?o.getValidation().getCurrentMarkup():null,t&&(i=t.getRestrictions(s)),d=!0,o&&o.getValidation()&&(!o.getValidation().getModifyAccessFlag()||"Activated"===o.getValidation().getRestrictedEditionFlag()&&i&&s&&("Markup"===s.getValType()&&!i.markup.canEdit||"Reply"===s.getValType()&&!i.reply.canEdit))&&(d=!1),n=n&&o&&!o.isReadOnly()&&o.getCurrentSessionMarkup()&&o.getCurrentSessionMarkup().getActiveFlag()&&o.getCurrentSessionMarkup().isVisible()&&o.getCurrentSessionMarkup().getCurrentSlide()&&o.getCurrentSessionMarkup().getCurrentSlide().isVisible()&&!o.getCurrentSessionMarkup().isReadOnly(),e=["markerTextCmdHdr","markerPictureCmdHdr","marker2DTextCmdHdr","marker2DPictureCmdHdr","markerCircleCmdHdr","DMUMarkerCloudCreateHdr","DMU3DRectangleCmdHdr","DMUFreehandCmdHdr","DMUCommentCmdHdr","DMUCreateValidatedMkrHdr","DMUCreateRejectedMkrHdr","markerArrowCmdHdr","DMUSnapCmdHdr","DMUExportMarkupAsPdfHdr","DMUExportMarkupAsImageHdr"],re._applyFlag(e,n&&d),n=le&&0!==de.getViewer().getVisibleSpace()&&o&&o.getValidation()&&!o.isReadOnly(),e=["CATWebUXGenerateIssueTemplateHdr","CATWebUXGenerateCAHdr","CATWebUXGenerateTaskHdr"],l=!0,o&&o.getValidation()&&"Activated"===o.getValidation().getRestrictedEditionFlag()&&i&&!i.highlight.canEditDef&&(l=!1),re._applyFlag(e,n&&l),n=le&&0!==de.getViewer().getVisibleSpace()&&o&&o.getValidation()&&!o.isReadOnly()&&!ye,e=["CATWebUXGenerateIssueHdr"],re._applyFlag(e,n&&l),n=n&&o&&o.getCurrentSessionMarkup()&&o.getCurrentSessionMarkup().getActiveFlag()&&o.getCurrentSessionMarkup().isVisible()&&o.getCurrentSessionMarkup().getCurrentSlide()&&o.getCurrentSessionMarkup().getCurrentSlide().isVisible(),e=["DMUAddHighlightHdr"],re._applyFlag(e,n&&l),n=le&&0!==de.getViewer().getVisibleSpace()&&o&&o.getValidation()&&!o.isReadOnly(),l=!0,(o&&o.getValidation()&&(!o.getValidation().getModifyAccessFlag()||"Activated"===o.getValidation().getRestrictedEditionFlag()&&("inProgress"!==o.getValidation().getStatus()||"IN_WORK"!==o.getValidation().getCurrentState()))||i&&!i.markup.canCreate)&&(l=!1),e=["DMUReviewMarkupHdr"],re._applyFlag(e,n&&l),l=!0,(o&&o.getValidation()&&(!o.getValidation().getModifyAccessFlag()||"Activated"===o.getValidation().getRestrictedEditionFlag()&&("inProgress"!==o.getValidation().getStatus()||"IN_WORK"!==o.getValidation().getCurrentState()))||i&&!i.reply.canCreate)&&(l=!1),e=["DMUReplyCmdHdr","DMUCreateSlideReplyHdr"],re._applyFlag(e,n&&l),l=!0,o&&o.getValidation()&&(!o.getValidation().getModifyAccessFlag()||"Activated"===o.getValidation().getRestrictedEditionFlag()&&i&&!i.check.canCreate)&&(l=!1),e=["DMUAddCheckHdr"],re._applyFlag(e,n&&l),n=le&&0!==de.getViewer().getVisibleSpace()&&c.getRoots(de).length&&o&&o.getCurrentSessionMarkup()&&o.getCurrentSessionMarkup().getSlides().length>0||c.getRoots(de).length&&("Document"===Re||"Specification Report"===Re||"Requirement"===Ae||"Requirement Specification"===Ae),e=["CATWebUXSlideShowHdr","DMUPrintHdr"],re._applyFlag(e,n),n=le&&(!o||!o.isReadOnly())&&("Document"===Re||"Specification Report"===Re||"Requirement"===Ae||"Requirement Specification"===Ae)&&Me&&Me.documentHasBookmarks(),e=["WebDocumentBookmarksPanelCmdHdr"],re._applyFlag(e,n),n=le&&("Document"===Re||"Specification Report"===Re||"Requirement"===Ae||"Requirement Specification"===Ae)&&Me&&Me.documentHasMultipleElements(),e=["WebDocumentPreviousPageCmdHdr","WebDocumentNextPageCmdHdr"],re._applyFlag(e,n),n=le&&("Document"===Re||"Specification Report"===Re||"Requirement"===Ae||"Requirement Specification"===Ae)&&Me&&"Document"===Me.getDocumentType(),e=["WebDocumentRotatePagesLeftCmdHdr","WebDocumentRotatePagesRightCmdHdr"],re._applyFlag(e,n),n=le&&("Document"===Re||"Specification Report"===Re||"Drawing"===Ae)&&Me&&("Document"===Me.getDocumentType()||"Specification Report"===Me||"Drawing"===Me.getDocumentType()),e=["DMUPrintHdr"],n&&re._applyFlag(e,n);var u=r.getManager({name:"DMUUserExperienceManager",context:de.getFrameWindow()});u&&u.refreshCommandsAvailability()}))):(Le&&clearTimeout(Le),Le=setTimeout((function(){if(Le=null,!de)return;var e,o=a.getReviewContext({context:de});e=["DMU2DCompareCmdHdr"],n=le&&0!==de.getViewer().getVisibleSpace()&&c.getRoots(de).length&&(!o||o&&!o.isReadOnly())&&("Drawing"===Ae||"DIFSheet"===Ae||"DIFLayout"===Ae);let l=!0;o&&o.getCurrentSessionMarkup()&&o.getCurrentSessionMarkup().getActiveFlag()&&o.getCurrentSessionMarkup().isVisible()&&o.getCurrentSessionMarkup().getMarkupOwner()&&!o.getCurrentSessionMarkup().getMarkupOwner().isWebMarkup()&&(l=!1),re._applyFlag(e,n&&l),e=["DMUReqCompareCmdHdr"],n=le&&0!==de.getViewer().getVisibleSpace()&&c.getRoots(de).length&&(!o||o&&!o.isReadOnly())&&("Requirement"===Ae||"Requirement Specification"===Ae),l=!0,o&&o.getCurrentSessionMarkup()&&o.getCurrentSessionMarkup().getActiveFlag()&&o.getCurrentSessionMarkup().isVisible()&&o.getCurrentSessionMarkup().getMarkupOwner()&&!o.getCurrentSessionMarkup().getMarkupOwner().isWebMarkup()&&(l=!1),re._applyFlag(e,n&&l),e=["measureCmdHdr","sectionCmdHdr","3DcompareCmdHdr","thicknessCmdHdr","LockUnlockSectionHdr"],n=le&&0!==de.getViewer().getVisibleSpace()&&c.getRoots(de).length&&(!o||o&&!o.isReadOnly()),l=!0,o&&o.getCurrentSessionMarkup()&&o.getCurrentSessionMarkup().getActiveFlag()&&o.getCurrentSessionMarkup().isVisible()&&o.getCurrentSessionMarkup().getMarkupOwner()&&!o.getCurrentSessionMarkup().getMarkupOwner().isWebMarkup()&&(l=!1),re._applyFlag(e,n&&l),n=(n||!n&&!c.getRoots(de).length)&&o&&!o.isReadOnly()&&o.getCurrentSessionMarkup()&&!o.getCurrentSessionMarkup().isReadOnly();let s=o&&o.getValidation()?o.getValidation().getCurrentMarkup():null;for(;s&&"Markup"!==s.getValType();)s=s.getParentRepRef().getParent();l=!0,s&&!1===s.isWebMarkup()&&(l=!1),t&&(i=t.getRestrictions(s));let d=!0;o&&o.getValidation()&&(!o.getValidation().getModifyAccessFlag()||"Activated"===o.getValidation().getRestrictedEditionFlag()&&i&&!i.markup.canEdit)&&(d=!1),e=["DMUEditFormatsHdr","slideCmdHdr","DMUExportReviewAsPdfHdr"],re._applyFlag(e,n&&l&&d),s=o&&o.getValidation()?o.getValidation().getCurrentMarkup():null,t&&(i=t.getRestrictions(s)),d=!0,o&&o.getValidation()&&(!o.getValidation().getModifyAccessFlag()||"Activated"===o.getValidation().getRestrictedEditionFlag()&&i&&s&&("Markup"===s.getValType()&&!i.markup.canEdit||"Reply"===s.getValType()&&!i.reply.canEdit))&&(d=!1),n=n&&o&&!o.isReadOnly()&&o.getCurrentSessionMarkup()&&o.getCurrentSessionMarkup().getActiveFlag()&&o.getCurrentSessionMarkup().isVisible()&&o.getCurrentSessionMarkup().getCurrentSlide()&&o.getCurrentSessionMarkup().getCurrentSlide().isVisible()&&!o.getCurrentSessionMarkup().isReadOnly(),e=["markerTextCmdHdr","markerPictureCmdHdr","marker2DTextCmdHdr","marker2DPictureCmdHdr","markerCircleCmdHdr","DMUMarkerCloudCreateHdr","DMU3DRectangleCmdHdr","DMUFreehandCmdHdr","DMUCommentCmdHdr","DMUCreateValidatedMkrHdr","DMUCreateRejectedMkrHdr","markerArrowCmdHdr","DMUSnapCmdHdr","DMUExportMarkupAsPdfHdr","DMUExportMarkupAsImageHdr"],re._applyFlag(e,n&&d),n=c.getRoots(de).length,e=["DMUReviewHdr"],re._applyFlag(e,n),n=le&&0!==de.getViewer().getVisibleSpace()&&o&&o.getValidation()&&!o.isReadOnly(),e=["CATWebUXGenerateIssueTemplateHdr","CATWebUXGenerateCAHdr","CATWebUXGenerateTaskHdr"],l=!0,o&&o.getValidation()&&"Activated"===o.getValidation().getRestrictedEditionFlag()&&i&&!i.highlight.canEditDef&&(l=!1),re._applyFlag(e,n&&l),n=le&&0!==de.getViewer().getVisibleSpace()&&o&&o.getValidation()&&!o.isReadOnly()&&!ye,e=["CATWebUXGenerateIssueHdr"],re._applyFlag(e,n&&l),n=le&&0!==de.getViewer().getVisibleSpace()&&o&&o.getValidation()&&!o.isReadOnly(),l=!0,o&&o.getValidation()&&(!o.getValidation().getModifyAccessFlag()||"Activated"===o.getValidation().getRestrictedEditionFlag()&&("inProgress"!==o.getValidation().getStatus()||"IN_WORK"!==o.getValidation().getCurrentState())||i&&!i.markup.canCreate)&&(l=!1),e=["DMUReviewMarkupHdr"],re._applyFlag(e,n&&l),l=!0,o&&o.getValidation()&&(!o.getValidation().getModifyAccessFlag()||"Activated"===o.getValidation().getRestrictedEditionFlag()&&("inProgress"!==o.getValidation().getStatus()||"IN_WORK"!==o.getValidation().getCurrentState())||i&&!i.reply.canCreate)&&(l=!1),e=["DMUReplyCmdHdr","DMUCreateSlideReplyHdr"],re._applyFlag(e,n&&l),n=le&&0!==de.getViewer().getVisibleSpace()&&c.getRoots(de).length&&o&&o.getCurrentSessionMarkup()&&o.getCurrentSessionMarkup().getSlides().length>0||c.getRoots(de).length&&("Document"===Re||"Specification Report"===Re||"Requirement"===Ae||"Requirement Specification"===Ae),e=["CATWebUXSlideShowHdr","DMUPrintHdr"],re._applyFlag(e,n),n=le&&(!o||!o.isReadOnly())&&("Document"===Re||"Specification Report"===Re||"Requirement"===Ae||"Requirement Specification"===Ae)&&Me&&Me.documentHasBookmarks(),e=["WebDocumentBookmarksPanelCmdHdr"],re._applyFlag(e,n),n=le&&("Document"===Re||"Specification Report"===Re||"Requirement"===Ae||"Requirement Specification"===Ae)&&Me&&Me.documentHasMultipleElements(),e=["WebDocumentPreviousPageCmdHdr","WebDocumentNextPageCmdHdr"],re._applyFlag(e,n),n=le&&("Document"===Re||"Specification Report"===Re||"Requirement"===Ae||"Requirement Specification"===Ae)&&Me&&"Document"===Me.getDocumentType(),e=["WebDocumentRotatePagesLeftCmdHdr","WebDocumentRotatePagesRightCmdHdr"],re._applyFlag(e,n),n=le&&("Document"===Re||"Specification Report"===Re||"Drawing"===Ae)&&Me&&("Document"===Me.getDocumentType()||"Specification Report"===Me||"Drawing"===Me.getDocumentType()),e=["DMUPrintHdr"],n&&re._applyFlag(e,n);var u=r.getManager({name:"DMUUserExperienceManager",context:de.getFrameWindow()});u&&u.refreshCommandsAvailability()}))),e&&e.removeRoot&&(o=!0),n="Specification Report"===Re&&!o,n){let e=_.getCommandCheckHeader("RootPanel",de.getCommandContext());e&&e.getState()&&e.setState(!1)}re._applyFlag(["RootPanel"],!n)}function $e(){ce.fireEvent("onIssueTemplateOnlySet",ye)}function et(e){Re!==e&&(Re&&Ve&&Ve.removeApplicativeContainer(Re),Re=e,a.setCurrentReviewContext(Re),"Workplan"===e?(Ze(),Ve&&de.getExecutionContext&&Ve.initApplicativeContainer(Re,{authoring:!0})):re.publish("onReviewContextModified",{type:Re,onABReady:function(){Ze(),Ve&&de.getExecutionContext&&Ve.initApplicativeContainer(Re,{authoring:!0})}}),Ve&&!de.getExecutionContext&&Ve.initApplicativeContainer(Re,{authoring:!0})),Ze()}function tt(e,t){let i=[];c.getRoots(de).forEach((n=>{const a=de.getController().getRootStats(c.getNodeID(n))&&"r2vsurvey"===de.getController().getRootStats(c.getNodeID(n)).serviceId?"R2V_Activity":c.getNodeType(n);e&&a===e||c.getNodeID(n)!==t&&("VPMReference"===e&&"R2V_Activity"===a||"R2V_Activity"===e&&"VPMReference"===a||i.push(c.getNodeID(n)))})),i.length&&de.removeRoots({pids:i})}async function it(e){try{let t=await R.getParentTypes(e);return[e].concat(t)}catch{return[e]}}function nt(){const e=c.getRoots(de);let t=!1;for(let i=0;i<e.length;i++){let n=c.getNodeType(e[i]),a=0;const o=G.getParentType(n);if("VPMReference"===o||"VPMReference"===n||a===e.length-1)return"VPMReference"!==o&&"VPMReference"!==n||(t=!0),t;a++}}function at(){const e=c.getRoots(de);let t=!1;for(let i=0;i<e.length;i++){let n=c.getNodeType(e[i]),a=0,o=G.getParentType(n);if("R2V_Activity"===o||"R2V_Activity"===n||a===e.length-1)return"R2V_Activity"!==o&&"R2V_Activity"!==n||(t=!0),t;a++}}async function ot(e){if(!le||!e)return;var t,i,n;let r=X.giveReqCompareController({context:de}),l=!!r&&r.isLoading(),d=!!r&&r.isLoading();if(d||(je=void 0),e.path?(t=c.getNodeID(e.path.getLastElement(!0)),n=e.path.getLastElement(!0).userData.i3dx?e.path.getLastElement(!0).userData.i3dx:void 0,i=de.getController().getRootStats(t)&&"r2vsurvey"===de.getController().getRootStats(t).serviceId?"R2V_Activity":c.getNodeType(e.path.getLastElement(!0))):e.docData&&(t=e.docData.objectId,i=e.docData.objectType),!t||!i)return;d||(je=i),Pe&&Pe.getLoadedID()===t||(!Me||Me.getDocumentLoadedID()===t||qe||l||Me.clean2DDocument(),Pe&&Pe.clean()),Ue=null;var u=function(){et("ITF")};var g=function(){tt("R2V_Activity",t),nt()?et("R2V3D"):et("R2V"),Pe.load({data:{serviceId:"r2vsurvey",objectParentType:"R2V_Activity",objectType:"R2V_Activity",objectId:t,strURI:n}})},p=function(){if("DIFLayout"===i||"DIFSheet"===i)et("2DFL");else if("Drawing"===i){et("2D"),qe||tt(null,t);var e=setInterval((function(){var n,a,o,r;(1===de.getRootBagPath().getChildrenPathes().length||qe&&2===de.getRootBagPath().getChildrenPathes().length)&&(clearInterval(e),n=t,a=i,o=de.getRootBagPath().getChildrenPathes()[de.getRootBagPath().getChildrenPathes().length-1].getLastElement(!0),Me.load2DDocument({phyID:n,dataType:a,serverUrl:v.get3DSpaceUrl(),securityContext:A.getSetting("pad_security_ctx"),parentNode:o,is2DCompareActive:qe,onLoadingStarted:function(){V.on(),r=1},onComplete:function(){r&&(V.off(),r=0)},onFailure:function(){de.removeRoots({pids:[n]}),de.displayNotification({msg:K.fileWithNoSVG,eventID:"error"}),r&&(V.off(),r=0),ce&&"R3V"===se&&ce.fireEvent("on2DDocumentLoadFailure")}}))}),100)}},m=function(){!Pe||"DXF"!==Pe.getLoadMarkupCtxType()&&"DWG"!==Pe.getLoadMarkupCtxType()?l||(et(i),tt(null,t)):(et("2D"),tt(null,t)),Ue=t};if("Drawing"===i||"DIFLayout"===i||"DIFSheet"===i&&e.path.getParentPath().isEqual(de.getRootBagPath()))p(),Ae=i;else if("Document"===i||"Requirement"===i||"Requirement Specification"===i||"Specification Report"===i||d&&("Comment"===i||"Chapter"===i)){m(),Ae=i;var D=a.getReviewContext({viewer:de.getViewer()});if(D){const e=D.getValidation();if(e){var h=e.getLoadedRepRefs();if(h.length>0)for(let e=0;e<h.length;e++){var w=h[e].getMarkupContent();if(w&&!w.getCurrentSlide()&&0===w.getComments().length)if(w.getSlides().length){let e=w.getSlides(),t=w.getAttribute("sCurrentSlideId");if(t){for(let i=0;i<e.length;i++)if(t===e[i].getAttribute("sID")){w.setCurrentSlide(e[i]);break}}else w.setCurrentSlide(e[0])}else{var C=new s(de,w);C.setAttributes([{name:"sID",value:w.computeNewID()},{name:"sUuid",value:o.getUUID()}]),C.updateEnvironmentOverload({target:D.getEnvironment(),state:D.getEnvironment().getEnvironmentInfo()}),w.addSlide(C),C&&w.setCurrentSlide(C)}}const t=f.giveDMUCommentsController({context:de.getFrameWindow(),commandContext:de?de.getCommandContext():null});r&&!r.isLoading()&&t&&t.setVisibleFlag(!0)}}}else if(de.getApplicativeData().getLoadedItfData&&de.getApplicativeData().getLoadedItfData().data.length>0)u(),Ae="SIMItfSimulation";else if("DesignSight"===i)et("MSR"),Ae="MSR";else if("R2V_Activity"===i)g(),Ae="R2V";else{const n=await it(i);n&&n.length&&-1!==n.indexOf("Drawing")&&e.path.getParentPath().isEqual(de.getRootBagPath())?(i=Ae="Drawing",p()):n&&n.length&&-1!==n.indexOf("SIMItfSimulation")&&e.path.getParentPath().isEqual(de.getRootBagPath())?(i=Ae="SIMItfSimulation",u()):n&&n.length&&(-1!==n.indexOf("Requirement")||-1!==n.indexOf("Requirement Specification"))?(i=-1!==n.indexOf("Requirement Specification")?"Requirement Specification":"Requirement",Ae="Requirement",m()):n&&n.length&&-1!==n.indexOf("Document")?(i=Ae="Document",m()):n&&n.length&&-1!==n.indexOf("R2V_Activity")?(g(),Ae="R2V"):Ne?de.removeRoots({pids:[t]}):n&&n.length&&-1!==n.indexOf("AecSite")?(tt("AecSite",t),et("3D")):at()?et("R2V3D"):(tt("VPMReference",t),et("3D"))}Ze()}let rt;function lt(){var e=a.getReviewContext({context:de}),t=e?e.getValidation():null;if(t){let i=t.getAllRepRefs().filter((e=>{let t=e.getMarkupContent();if(t)return t.isDirty()&&!t.isReadOnly()&&!e.isBeingRemoved()}));if(le&&!Fe&&i&&i.length){if(!de||!le||Fe||!e)return;if(w.isProcessing())return rt&&(clearTimeout(rt),rt=null),void(rt=setTimeout(lt,1e3));H.tryToSaveData({frameWindow:de.getFrameWindow(),saveFunction:()=>new Promise(((e,n)=>{let a=[],o=0;i=t.getAllRepRefs().filter((e=>{let t=e.getMarkupContent();if(t)return t.isDirty()&&!t.isReadOnly()&&!e.isBeingRemoved()})),i.forEach((e=>{return a.push((t=e.getPlmID(),new Promise(((e,i)=>{let n,a,o,r,l,s=null;!Ae||"Document"!==Ae&&"Specification Report"!==Ae||(l=Pe.getDocumentVersionInfos(),r=Ae,s=Pe.getLoadMarkupCtxType()),de.getApplicativeData&&(de.getApplicativeData(),de.getApplicativeData().getLoadedItfData&&(n=de.getApplicativeData().getLoadedItfData(),n.data.length&&(n.data[0].metricID&&(a=n.data[0].metricID),void 0!==n.loadMode&&(o=n.loadMode),r="SIMItfSimulation"))),w.saveReviewMarkup({markupRepRefId:t,frmWindow:de.getFrameWindow(),superType:r,documentType:s,listData:a,loadingInfos:o,documentVersionInfos:l,onSaveCompleted:e,onSaveFailed:i})}))));var t})),Promise.allSettled(a).then((t=>{t.forEach((e=>{"fulfilled"===e.status&&o++})),o===a.length?e():n(new Error("One or more markups failed to save"))}))}))}).then((()=>{var e=a.giveEventsController({viewer:de.getViewer()});e&&e.fireEvent("onReviewSaved")})).catch((()=>{var e=a.giveEventsController({viewer:de.getViewer()});e&&e.fireEvent("onReviewSaveFailed")}))}}}function st(){lt(),Ze()}function dt(e){if(!le)return;Fe=!1,Je=!1,Ge=!1;var t=I.giveDMUSceneDisplayController({context:de});const i=t=>{var i=a.getReviewContext({viewer:de.getViewer()});if(i&&i.getValidation()&&"R3V"===se){const a=i&&i.getValidation();if(N.giveDMUReviewController({context:de.getFrameWindow()}).getRestrictions(a).review.canAddContext){var n=i.getValidation().getContext(),o={},r={};Pe&&(r=Pe.getSubContextInformations(e.id)),o.id=de.getApplicativeData().getLoadedItfData&&de.getApplicativeData().getLoadedItfData().data.length>0?de.getApplicativeData().getLoadedItfData().data[0].isrID:e.id;const a=n=>{r&&r.id?(r.icon=n.icon,o.type=t):(o.label=n.label,o.icon=n.icon,o.type=n.type),w.updateReviewContext({ctxViewer:de,validation:i.getValidation(),mainContext:o,subContext:r,onUpdateReviewContextCompleted:function(){if("DesignSight"!==t&&"DIFLayout"!==t&&"Requirement Specification"!==t){let t=i.getValidation().getContext()&&i.getValidation().getContext().getSubContextID()?i.getValidation().getContext().getSubContextID():e.id;w.updateValidatedObjectsList({fullPathRefs:[[t]],validatedObjects:[[t]],validatedId:i.getValidation().getValidated().getPlmID()?i.getValidation().getValidated().getPlmID():null,validatedToAdd:[[t]],referenceIds:[t],instanceIds:[t],instanceNames:[],updateMode:"add",onReviewCtxUpdateOrDropValidated:!0,ctxViewer:de.getFrameWindow().getViewer(),onSaveValidatedObjectsFailed:function(){}})}},onUpdateReviewContextFailed:function(){}})};if(!n||n&&!n.getJsonContexts().length)if("R2V_Activity"===t){let e=setInterval((()=>{if(Pe&&Pe.getLoadedR2VInformations().length){clearInterval(e);let t=Pe.getLoadedR2VInformations()[0].info;a({label:t[0]["ds6w:label"],icon:t[0].icon,type:"R2V_Activity"})}}),100)}else{let e=[];r&&r.id?e.push(r.id):e.push(o.id),de.getController().getAttributes({ids:e,attributes:["ds6w:label","type_icon_url","ds6w:type"],callbacks:{onComplete:function(t){a({label:t[e[0]]["ds6w:label"],icon:t[e[0]].type_icon_url,type:t[e[0]]["ds6w:type"]})},onFailure:function(){}}})}}}};if((Pe=y.getLoadingContextController({context:de}))&&Pe.getLoadedWorkplanInformations())de.removeRoots({pids:[e.id]});else if((!t||!t.getCurrentComparedObjectIDPaths()&&te&&te.getActiveState())&&te.setActiveState(!1),e.id===sessionStorage.getItem("DMU2DCompareTempRoot"))de.removeRoots({pids:[sessionStorage.getItem("DMU2DCompareTempRoot")]}),sessionStorage.removeItem("DMU2DCompareTempRoot");else if(e.path){ot({path:e.path}),i(c.getNodeType(e.path.getLastElement(!0))),Ue=null}else{var n=de.getRootBagPath().externalPath[0].path.getChildrenPathes().length;if(n){var o=de.getRootBagPath().externalPath[0].path.getChildrenPathes()[n-1];ot({path:o}),i(c.getNodeType(o.getLastElement(!0)))}}}function ct(e){if(!le||Je)return;!de.getRootBagPath().getChildrenPathes().length&&te&&te.getActiveState()&&te.setActiveState(!1);let t=X.giveReqCompareController({context:de});if(!!t&&(t.isLoading()||t.isRequirementCompareActive())||Me&&(e&&e.id?Me.clean2DDocument(e):Me.clean2DDocument()),je&&"R2V_Activity"===je&&de.toggleSOITimelinesUsability(!0),de.getRootBagPath().getChildrenPathes().length){var i=de.getRootBagPath().externalPath[0].path.getChildrenPathes().length;let e;if(i&&(e=de.getRootBagPath().externalPath[0].path.getChildrenPathes()[i-1]),(je=c.getNodeType(e.getLastElement(!0)))&&"FailureModesEffectsAnalysis"===je&&i){let e=de.getRootBagPath().externalPath[0].path.getChildrenPathes()[i-1].externalPath.find((e=>"RootBag"===e.name));e&&(e.removeChildren(),e.remove())}if(je&&de.getApplicativeData()&&de.getApplicativeData().getLoadedItfData()&&de.getApplicativeData().getLoadedItfData().data&&0===de.getApplicativeData().getLoadedItfData().data.length){const e=at(),t=nt();let i=null;e&&t?i="R2V3D":e?i="R2V":t&&(i="3D"),i&&et(i)}}else Fe=!0,a.setReviewContext({context:de});Pe&&(Pe.clean(),e&&e.id&&Pe.updateLoadedR2VInformations(e.id,"remove"),e&&e.id&&Pe.updateLoadedWorkplanInformations(e.id,"remove"),e&&e.id&&Pe.setLoadedFMEAInformations(void 0,"remove")),Ze({removeRoot:!0})}function ut(){de.unsubscribe(pe.onRootRemoved),pe.onRootRemoved=-1}function gt(){pe.onRootRemoved=de.subscribe({event:"onRootRemoved"},ct)}var pt;function mt(e){pt=x.getNearPositionFrom2DCoordinates({x:e.clientX,y:e.clientY},de.getViewer())}function ft(e){le&&re&&e&&v.multiTenantMgt([e],c.getRoots(de),(function(t){if(!t.isMultiTenant){var i=a.getReviewContext({context:de}),n=i?i.getCurrentSessionMarkup():null;if(!n||n.isReadOnly()||!n.getCurrentSlide())return;k.getDataFromRelatedId({type:"DMUMarker3DPicture",objectId:e.objectId,onComplete:function(t){var i=E.create3DMarker({viewer:de.getViewer(),frameWindow:de.getFrameWindow(),parent:n,date:Date.now(),objectId:e.objectId,shape:{type:"picture",pointingPoint:pt,data:t}});i&&(n.getCurrentSlide().addDMUObject(i),i.fireEvent("onDMUObjectInitialized",{dmuObject:i}))}})}}))}function vt(e){le&&re&&e&&ze&&v.multiTenantMgt([e],c.getRoots(de),(function(t){t.isMultiTenant||re.loadMarkupContext(e)}))}this.loadReviewAfterRefresh=function(e){"_DMUValidationValidation"!==e.type&&"DMUValidationValidation"!==e.displayType||re.loadContext(e,le,"_DMUValidationValidation","refreshMode",!0,re),"_DMUValidationExposedPresentation"===e.type&&re.loadContext(e,le,"_DMUValidationExposedPresentation","refreshMode",!0,re)},this.loadContext=function(e,t,i,n){var o;t&&re&&e&&(ne&&ne.objectId===e.reviewId?o=ne:(o=e,e.refreshData&&(o.objectId=e.reviewId)),v.multiTenantMgt([o],c.getRoots(de),(async function(t){if(!t.isMultiTenant&&("_DMUValidationValidation"===i||"_DMUValidationExposedPresentation"===i)){var r={};r.loadMode=n||null,r.reviewId=o.objectId,r.context=de,r.displayName=o.displayName,r.displayType=o.displayType?o.displayType:"DMUValidationValidation"===o.objectType?"Review":void 0,r.type="_DMUValidationValidation"===i?"DMUValidationValidation":"DMUValidationExposedPresentation",r.readOnly=!1,r.commentId=o.commentId,r.cbRootAdded=function(){ne=o},r.cbOK=async function(t){let i=!1;t&&!0===t.sameReview&&(i=!0);var n=await b.createReviewContext({context:de}),r=Ye(),l=n.getValidation(),s="",d=l.getContext();if(d&&(s=d.getJsonContextTypes()[0]),"Document"!==s&&"Requirement"!==s&&"Requirement Specification"!==s&&"Specification Report"!==s){var c=l.getLoadedRepRefs();c.length>0&&r&&(r=L.giveDMUSlidesController({context:de.getFrameWindow()}),re.autoReframe=!1,"DMUValidationValidation"!==o.objectType&&"_DMUValidationValidation"!==o.objectType||i||c[0].getMarkupContent()&&c[0].getMarkupContent().getSlides().length&&r.setActiveSlide(c[0].getMarkupContent().getSlides()[0]))}var u,g,p=[];let m=l.getHighlights();if(m&&m.length)for(u=0;u<m.length;u++)p.push(m[u]);if(g=[],l){var v=l.getLoadedRepRefs();for(u=0;u<v.length;u++)if(v[u].getMarkupContent()){g=g.concat(v[u].getMarkupContent().getSlides());for(let e=0;e<v[u].getMarkupContent().getSlides().length;e++){var D=v[u].getMarkupContent().getSlides()[e].getDMUObjects();for(let e=0;e<D.length;e++)D[e].getDMUComments&&(g=g.concat(D[e].getDMUComments()))}}let e,t,i=a.getReviewContext({viewer:de.getFrameWindow().getViewer()}),n=l.getContext()?l.getContext().getJsonContexts():null;n&&n.length>0&&(e=n[0].id,t=n[0].type);let o=i.getReviewCtxInformation();o&&o.contextId===e&&o.reviewId===l.getPlmID()||i.setReviewCtxInformation({contextId:e,contextType:t,reviewId:l.getPlmID(),reviewName:l.getName(),reviewType:l.getValType(),owner:l.getOwner()}),a.getContextViewer({viewer:de.getFrameWindow().getViewer()}).getController().getAttributes({ids:[l.getPlmID()],attributes:["ds6w:reservedBy"],callbacks:{onComplete:function(e){if(e){var t=a.getReviewContext({context:de}),i=t?t.getValidation():null,n=i.getModifyAccessFlag(),o=e[i.getPlmID()]["ds6w:reservedBy"];!n&&o&&""!==o?Qe("info",K.reviewLocked+" "+e[i.getPlmID()]["ds6w:reservedBy"]):!1===n&&Qe("info",K.reviewNoModifyAccess)}},onFailure:function(){return null}}})}var h=function(e,t){f.giveDMUCommentsController({context:de.getFrameWindow()}).applyComment({commentId:e,markupId:t})};let w,C=function(e,t,i){if("DMUSlide"===e.getType())r&&r.setActiveSlide(e);else if("DMUComment"===e.getType()){let n=e.getAttribute("sUuid");i?h(n,t):((e,t)=>{w||(w=ce.addEvent("on2DDocumentLoadSuccess",(function(){h(e,t),ce&&w&&ce.removeEvent(w),w=null})))})(n,t)}};for(let t=0;t<g.length;t++)if(e.refreshData&&e.refreshData.slideId&&e.refreshData.mkpId){if(e.refreshData.slideId===g[t].getAttribute("sUuid")){C(g[t],e.refreshData.mkpId,!1);break}}else for(let e=0;e<p.length;e++)if(p[e].getAttribute("sPresentationSlideID")===g[t].getAttribute("sUuid")){if(p[e].getPlmID()===o.objectId){let n=p[e].getAttribute("sRepRefMarkupID");C(g[t],n,i)}i||re.highlightInitialization({highlight:p[e],slide:g[t]})}ce.addEvent("onReplyExpandRequest",(function(e){let t=a.getReviewContext({viewer:de.getFrameWindow().getViewer()}),i=t.getValidation();ce.fireEvent("onGetMarkupJsonEvt",{markup:i.getRepRef(e.data.id),onLoadingCompleted:function(e,n){i.setCurrentMarkup(n),ce.fireEvent("onImportModelEvt",{asset:e,onImportCompleted:function(){var e=t.getCurrentSessionMarkup();n.setMarkupContent(e),e.setMarkupOwner(n),r&&r.setActiveSlide(e.getSlides()[0]),e.setReadOnly(t.isReadOnly());let a=i.getHighlightsData();if(a&&a.length)for(g=e.getSlides(),u=0;u<a.length;u++)for(var o=0;o<g.length;o++)a[u].slideId===g[o]._sUuid&&re.highlightInitialization({highlight:a[u],slide:g[o]})}})}})}))},r.cbFailed=function(){de.getWidget().dispatchEvent("onDMUValidationLoadFailed")},await re.loadValidation(r),W.setSlidePreferences({context:de.getFrameWindow(),preferences:{displayNominal:!1,displayInWork:!1}})}})))},this.createSharedPreferences=function(e){e&&e.addPreferences([{nls:K.markerPrefTitle,id:"MarkerPreferences",type:"section",preferences:[{nls:K.validatedStampMarkerLabel,id:"MarkerValidatedStampLabel",type:"editor",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_MarkerValidatedStampLabel")||B.defaultValidatedStampLabel},getDefaultValue:function(){return B.defaultValidatedStampLabel},setValue:function(e){e!==localStorage.getItem("CATWebUXMePreferences_MarkerValidatedStampLabel")&&localStorage.setItem("CATWebUXMePreferences_MarkerValidatedStampLabel",e)}},{nls:K.rejectedStampMarkerLabel,id:"MarkerRejectedStampLabel",type:"editor",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_MarkerRejectedStampLabel")||B.defaultRejectedStampLabel},getDefaultValue:function(){return B.defaultRejectedStampLabel},setValue:function(e){e!==localStorage.getItem("CATWebUXMePreferences_MarkerRejectedStampLabel")&&localStorage.setItem("CATWebUXMePreferences_MarkerRejectedStampLabel",e)}}]},{nls:K.compareSectionTitle,id:"ComparePreferences",type:"section",preferences:[{nls:K.firstProductColor,id:"CompareFirstColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_CompareFirstColor")?localStorage.getItem("CATWebUXMePreferences_CompareFirstColor"):"#CC092F"},getDefaultValue:function(){return"#CC092F"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_CompareFirstColor",e)}},{nls:K.secondProductColor,id:"CompareSecondColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_CompareSecondColor")?localStorage.getItem("CATWebUXMePreferences_CompareSecondColor"):"#6FBC4B"},getDefaultValue:function(){return"#6FBC4B"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_CompareSecondColor",e)}},{nls:K.compare3DCommonColor,id:"Compare3DCommonColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_Compare3DCommonColor")?localStorage.getItem("CATWebUXMePreferences_Compare3DCommonColor"):"#D3D3D3"},getDefaultValue:function(){return"#D3D3D3"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_Compare3DCommonColor",e)}},{nls:K.compare2DCommonColor,id:"Compare2DCommonColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_Compare2DCommonColor")?localStorage.getItem("CATWebUXMePreferences_Compare2DCommonColor"):"#000000"},getDefaultValue:function(){return"#000000"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_Compare2DCommonColor",e)}}]},{nls:K.slideSectionTitle,id:"SlidePreferences",type:"section",preferences:[{nls:K.slideNameFromFeature,id:"SlideNameFromFeature",type:"checkbox",getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_SlideNameFromFeature")},getDefaultValue:function(){return!0},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_SlideNameFromFeature"))&&localStorage.setItem("CATWebUXMePreferences_SlideNameFromFeature",e?"true":"false")}},{nls:K.slideTitleDisplayLbl,id:"DisplaySlideTitle",type:"checkbox",getValue:function(){return"true"===localStorage.getItem("CATWebUXMePreferences_DisplaySlideTitle")},getDefaultValue:function(){return!1},setValue:function(e){e!==("true"===localStorage.getItem("CATWebUXMePreferences_DisplaySlideTitle"))&&localStorage.setItem("CATWebUXMePreferences_DisplaySlideTitle",e?"true":"false")}},{nls:K.preferences.slideCaptureSpecLayers,id:"CaptureSpecLayers",type:"checkbox",getValue:function(){return"true"===localStorage.getItem("CATWebUXMePreferences_CaptureSpecLayers")},getDefaultValue:function(){return!1},setValue:function(e){e!==("true"===localStorage.getItem("CATWebUXMePreferences_CaptureSpecLayers"))&&localStorage.setItem("CATWebUXMePreferences_CaptureSpecLayers",e?"true":"false")}},{nls:K.preferences.slideEnableDrag,id:"SlideDragAndDropOperation",type:"radio",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_SlideDragAndDropOperation")||"SlideReorder"},getDefaultValue:function(){return"0"},setValue:function(e){e!==localStorage.getItem("CATWebUXMePreferences_SlideDragAndDropOperation")&&localStorage.setItem("CATWebUXMePreferences_SlideDragAndDropOperation",e)},options:[{id:"SlideReorder",nls:K.preferences.enableReorder},{id:"TransferView",nls:K.preferences.enableDragContent}]}]}])},this.removeSharedPreferences=function(e){e&&e.removePreferences(["MarkerPreferences","ComparePreferences","SlidePreferences"])},this._onContextualBarReadyCB=function(){var e=[],t=u.get(),i=t[t.length-1],n=function(e,t){return e.x>=t.x-3&&e.x<=t.x+3&&e.y>=t.y-3&&e.y<=t.y+3};if(t.length){for(var o,r=!1,l=null,s=!1,d=0;d<t.length;d++){for(o=t[d].pathElement.clone();o&&o.internalPath.length;)o=o.getParentPath();if(o.getLastElement(!0).getAnnotationClassType||o.getLastElement(!0).getDMUType)return de.getExecutionContext?{WAfrCtxBarRow1:void 0}:{cmdList:[]};l=c.getLastReference(o);let e=!de.getController().isRootSupported||de.getController().isRootSupported(c.getNodeID(l.getLastElement(!0)));l&&c.isReference(l.getLastElement(!0))&&e?r=!0:l=null}i&&i.event&&i.event.lastPosition&&i.event.startPosition&&n(i.event.startPosition,i.event.lastPosition)&&i.pathElement.externalPath.length>2&&i.pathElement.externalPath[0]===de.getRootBagPath().getLastElement(!0)&&(s=!0);var g=a.getReviewContext({context:de}),p=g?g.getCurrentSessionMarkup():null;let u="3D"===a.getCurrentReviewContext()||"ITF"===a.getCurrentReviewContext();if(p&&p.getActiveFlag()&&!p.isReadOnly()&&p.isVisible()&&p.getCurrentSlide()&&!ue){if(r&&u&&e.push({name:"DMUHideShowOverloadStr",line:1,hdr_list:["DMUHideShowOverloadHdr"],type:"handler",identifier:"DMUHideShowOverloadHdr"}),l&&l.externalPath&&l.externalPath.length&&u){var m=I.getDMUSceneDisplayController({context:de});m&&!m.getCurrentComparedObjectIDPaths()&&e.push({name:"DMUColorOpacityOverloadStr",line:1,hdr_list:["DMUColorOpacityOverloadHdr"],type:"handler",identifier:"DMUColorOpacityOverloadHdr"}),e.push({name:"DMUPositionOverloadStr",line:1,hdr_list:["DMUPositionOverloadHdr"],type:"handler",identifier:"DMUPositionOverloadHdr"})}}else r&&u&&e.push({name:"HideShowStr",line:1,hdr_list:["HideShowHdr"],type:"handler",identifier:"ENO3DHideShowCmd"});s&&u?e.push({name:"DMULevelSelectorStr",line:1,hdr_list:["DMULevelSelectorHdr"],type:"handler",identifier:"DMULevelSelectorHdr"}):1===t.length&&i&&i.pathElement&&i.pathElement.getParentPath().isEqual(de.getRootBagPath())&&u&&e.push({name:"RemoveRootStr",line:1,hdr_list:["RemoveRootHdr"],type:"handler",identifier:"ENO3DRemoveRootCmd"})}return"DIFLayout"!==je&&"DIFSheet"!==je||i&&i.event&&i.event.lastPosition&&i.event.startPosition&&n(i.event.startPosition,i.event.lastPosition)&&i.pathElement.externalPath.length>2&&i.pathElement.externalPath[0]===de.getRootBagPath().getLastElement(!0)&&e.push({name:"DMULevelSelectorStr",line:1,hdr_list:["DMULevelSelectorHdr"],type:"handler",identifier:"ENO3DLevelSelectorCmd"}),de.getExecutionContext?{WAfrCtxBarRow1:{model:e}}:{cmdList:e}},this._applyFlag=function(e,t){for(var i,n=0;n<e.length;n++)(i=_.getCommand(e[n],de.getCommandContext()))||(i=_.getCommandCheckHeader(e[n],de.getCommandContext())),i&&(t?i.enable():i.disable())},this._onContextualMenuReadyCB=function(e,t){var i=[],n=[],o=[],l=Boolean(de.getExecutionContext);if(te&&te.getActiveState())return l?i:{cmdList:i};var s=a.getReviewContext({context:de}),d=u.get(),g=!de.getViewer().get2DMode(),p=r.getManager({name:"DMUUserExperienceManager",context:de.getFrameWindow()}),m=t?{x:t.XmousePositionWithDevPxRatio,y:t.YmousePositionWithDevPxRatio}:{x:e.XmousePositionWithDevPxRatio,y:e.YmousePositionWithDevPxRatio};if(0===(p?p.pick(m,"mesh"):de.getViewer().pick({xPix:m.x,yPix:m.y},"mesh",!0).path).length){var f=T.get(),v=f&&f[0]&&f[0].pathElement?f[0].pathElement.getLastElement(!0):null,D=v&&v.getDMUType?v.getDMUType():"";if("DMUSlide"===D||"DMUFormat"===D||"DMUComment"===D||"DMUMarkup"===D||"DMUValidationExposedPresentation"===D||"DMUValidationCheck"===D||"Checks"===D||"Highlights"===D)return l?i:{cmdList:i};l?o.push({category:Y.ctxMenuDisplayTitle,hdrs:!j.isMobile()&&g?["VisuQMCommand","ENO3DToggleStatusBarCmd"]:["ENO3DToggleStatusBarCmd"]},{category:Y.ctxMenuAmbienceTitle,hdrs:["VisuPureWhiteOCACmd","VisuWhiteMirrorOCACmd","VisuWhiteReviewOCACmd","VisuWhiteExperienceOCACmd","VisuStudioOCACmd","VisuDarkMirrorOCACmd","VisuDarkReviewOCACmd","VisuWhiteDesignOCACmd","VisuBlueDesignOCACmd","VisuDarkDesignOCACmd","VisuIndoorOCACmd","VisuCityOCACmd","VisuRoadOCACmd","VisuOutdoorOCACmd","VisuBasicOCACmd"]}):i=[{line:1,name:"DMU3DReviewDisplaySubMenu",resourceFile:"DMUBaseCommands/3DPlayPro",hdr_list:!j.isMobile()&&g?["VisuQMCommand","PAD3DToggleStatusBarHdr"]:["PAD3DToggleStatusBarHdr"]},{line:1,name:"DMU3DReviewAmbiencesSubMenu",resourceFile:"DMUBaseCommands/3DPlayPro",hdr_list:["VisuPureWhiteOCACmd","VisuWhiteMirrorOCACmd","VisuWhiteReviewOCACmd","VisuWhiteExperienceOCACmd","VisuStudioOCACmd","VisuDarkMirrorOCACmd","VisuDarkReviewOCACmd","VisuWhiteDesignOCACmd","VisuBlueDesignOCACmd","VisuDarkDesignOCACmd","VisuIndoorOCACmd","VisuCityOCACmd","VisuRoadOCACmd","VisuOutdoorOCACmd","VisuBasicOCACmd"]}];let e=O.getContextaulMenuforClipping(de,l,je);e&&(l&&e.hdrs&&e.hdrs.length?o.push(e):i=i.concat(e))}else if(d.length){var h=s?s.getCurrentSessionMarkup():null,w=!1,C=!1,S=!1,b=h&&!h.isReadOnly()&&h.isVisible();for(let e=0;e<d.length;e++){if(h&&!h.isReadOnly()&&h.isVisible()){var y=h.getOrCreateOccurrenceOverloader(d[e]);if(!w)if(y&&y.isOverloadedInCurrentSlide())w=!0;else{let t=d[e].pathElement.clone();t.getParentPath()&&c.isInstance(t.getParentPath().getLastElement(!0))&&(y=h.getOrCreateOccurrenceOverloader({pathElement:t.getParentPath()}))&&y.isOverloadedInCurrentSlide()&&(w=!0)}}for(var M=!0,R=0;R<d[e].pathElement.externalPath.length;R++)d[e].pathElement.externalPath[R].getDMUType&&(C=!0,M=!1);M&&(S=!0)}var A=!1;if(p&&(A=p.areOccurenceOverloadsCopied()),w&&(l?n.push("DMURemoveOverloadHdr","DMUCopyHdr","DMUCutHdr"):i=i.concat([{line:1,name:"DMURemoveOverloadStr",hdr_list:["DMURemoveOverloadHdr"]},{line:1,name:"DMUCopyStr",hdr_list:["DMUCopyHdr"]},{line:1,name:"DMUCutStr",hdr_list:["DMUCutHdr"]}])),S&&A&&(l?n.push("DMUPasteHdr","DMUPasteSpecialHdr"):i=i.concat([{line:1,name:"DMUPasteStr",hdr_list:["DMUPasteHdr"]},{line:1,name:"DMUPasteSpecialStr",hdr_list:["DMUPasteSpecialHdr"]}])),!C){g?l?n.push("ENO3DFocusOnCmd"):i.push({line:1,name:"FocusOn",hdr_list:["FocusOnHdr"]}):-1!==Ae.indexOf("Document")&&-1!==Ae.indexOf("Specification Report")||(l?n.push("DMUFocusOnRepresentationHdr"):i.push({line:1,name:"FocusOn",hdr_list:["DMUFocusOnRepresentationHdr"]})),"Requirement"===je||"Requirement Specification"===je?l?n.push("WebDocumentReframeOnHdr"):i.push({line:1,name:"ReframeOn",hdr_list:["WebDocumentReframeOnHdr"]}):"Drawing"===Ae||"DIFLayout"===Ae||"DIFSheet"===Ae?l?n.push("DMUReframeOnRepresentationHdr"):i.push({line:1,name:"ReframeOn",hdr_list:["DMUReframeOnRepresentationHdr"]}):l?n.push("ENO3DReframeOnCmd"):i.push({line:1,name:"ReframeOn",hdr_list:["ReframeOnHdr"]});let e=!de.getController().isRootSupported||d.length>=1&&d[0].pathElement.externalPath.length>=2&&de.getController().isRootSupported(c.getNodeID(d[0].pathElement.externalPath[1]));if(b&&g&&e){var P=!1;let e,t;for(let i=0;i<d.length;i++){for(e=d[i].pathElement.clone();e&&e.internalPath.length;)e=e.getParentPath();if(t=c.getLastReference(e),t&&c.isReference(t.getLastElement(!0))){P=!0;break}}t&&t.externalPath.length<=2&&(P=!1),P&&(l?n.push("DMUHideShowOverloadHdr"):i.push({line:1,name:"DMUHideShowOverloadStr",hdr_list:["DMUHideShowOverloadHdr"]}))}if(1===d.length&&"Drawing"!==Ae&&de.getRootBagPath().isAParentOf(d[0].pathElement)&&(l?n.push("DMUNavOnImplementationLinksHdr"):i.push({name:"DMUNavOnImplementationLinksStr",line:1,hdr_list:["DMUNavOnImplementationLinksHdr"]})),l?n.push("ActionBar_Attributes"):i.push({line:1,name:"EditPropertiesCmd",hdr_list:["ActionBar_Attributes"]}),g&&e&&(l?o.push({category:Y.ctxMenuQualityTitle,hdrs:["OptimizedQualityCmd","HighQualityCmd"]}):i.push({line:1,name:"PAD3DViewerToggleGeometrySection",resourceFile:"ENOPAD3DViewer/ENOPAD3DViewer",hdr_list:["PAD3DToggleSimplifiedHdr","PAD3DToggleAccurateHdr"]})),!l){let e=O.getContextaulMenuforClipping(de,!1,je);e&&(i=i.concat(e))}}}if(l){for(let e=0;e<n.length;e++)"ENO3DToggleStatusBarCmd"===n[e]?i.push({type:"WAfrCheckHandlerItem",handlerId:n[e]}):i.push({type:"WAfrDefaultHandlerItem",handlerId:n[e]});return o.forEach((e=>{let t={type:"PushItem",title:e.category,submenu:[]};for(let i=0;i<e.hdrs.length;i++)"ENO3DToggleStatusBarCmd"===e.hdrs[i]?t.submenu.push({type:"WAfrCheckHandlerItem",handlerId:e.hdrs[i]}):"SeparatorItem"===e.hdrs[i]?t.submenu.push({type:e.hdrs[i]}):t.submenu.push({type:"WAfrDefaultHandlerItem",handlerId:e.hdrs[i]});i.push(t)})),i}return{cmdList:i}},this.highlightInitialization=function(e){e&&e.slide&&e.slide.addAssociatedHighlightData&&e.highlight&&e.slide.addAssociatedHighlightData({id:e.highlight.getPlmID(),rating:e.highlight.getRating(),hasIssue:Boolean(e.highlight._lIssuesIDs.length),hasTask:Boolean(e.highlight._lTasksIDs.length),hasImpactedChecks:Boolean((e.highlight.getAssociatedCheck()||[]).length)})},this.getRequirementData=e=>R.getRequirementData(e.phyId),this._setActiveState=async function(e){const t=()=>v.get3DSpaceUrl(),o=()=>v.getPlatformId(),s=()=>A.getSetting("pad_security_ctx");let p,b,V;if(e!==le){if(le=e){Pe||(Pe=y.getLoadingContextController({context:de}));let e=function(e){return new Promise(((i,n)=>{let a=t()+"/resources/dictionary/getTypeInfo?tenant="+o(),r=encodeURIComponent(s());require("DS/WAFData/WAFData").authenticatedRequest(a+"&SecurityContext="+r,{method:"POST",type:"json",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:r},data:JSON.stringify(e),onComplete:function(e){i(e)},onFailure:function(e){n(e)},onTimeout:function(e){n(e)}})}))},g={_DMUValidationValidation:function(e){re.loadContext(e,le,"_DMUValidationValidation",!1,re)},_DMUValidationExposedPresentation:function(e){re.loadContext(e,le,"_DMUValidationExposedPresentation",!1,re)},...q.getDelegation(de,(function(){ce.fireEvent("onApplyingSlideView")}))};try{let t=await e(Ke);Object.keys(t).forEach((e=>{g["_"+e]=vt})),de.setLoadingDelegations(g)}catch{Ke.forEach((e=>{g["_"+e]=vt})),de.setLoadingDelegations(g)}if((We=M.getSelectionManager({context:de})).setActiveState(!0),Te={activated:de.getViewer().picking.activated,trapSelection:de.getViewer().picking.trapSelection,trapGPU:de.getViewer().picking.trapGPU},_e={activated:de.getViewer().pPicking.activated},de.getViewer().setPicking({activated:!0,trapSelection:!0,trapGPU:!0}),de.getViewer().setPrePicking({activated:!0}),U.subscribe({event:"ENXViews/WelcomePanel/openContent"},(async e=>{let t=e.unserializedData?e.unserializedData.data.items:null;if(t&&t.length>1)for(const e of t){const t=await it(e.objectType);if(!t.includes("VPMReference")&&!t.includes("R2V_Activity")){ze=!1,Qe("warning",K.dropMultiNoAutorized);break}}else ze=!0})),ce=a.getEventsController({viewer:de.getViewer()}),ve.onValidationObjectDeleted=ce.addEvent("onValidationObjectDeleted",(function(e){var t=function(){e&&e.dmuObject&&e.dmuObject.length&&e.dmuObject[0].getType&&"Markup"===e.dmuObject[0].getType()&&Qe("error",B.deleteMarkupFailed),e&&e.dmuObject&&e.dmuObject.length&&e.dmuObject[0].getType&&"Reply"===e.dmuObject[0].getType()&&Qe("error",B.deleteReplyFailed)};if(e&&e.dmuObject&&e.dmuObject.length&&e.dmuObject[0].getType&&("Markup"===e.dmuObject[0].getType()||"Reply"===e.dmuObject[0].getType())){let i=a.getReviewContext({context:de});i.getCurrentSessionMarkup()===e.dmuObject[0].getRepRef().getMarkupContent()&&i.setCurrentSessionMarkup(null),w.deleteObject({ctxViewer:de,objectIds:[e.dmuObject[0].getPlmID()],type:e.dmuObject[0].getValType(),onDeleteCompleted:function(){e&&e.dmuObject&&e.dmuObject.length&&e.dmuObject[0].getType&&("Markup"===e.dmuObject[0].getType()||"Reply"===e.dmuObject[0].getType())&&(e.dmuObject[0].getRepRef()&&e.dmuObject[0].getRepRef().removeMarkupContent(),Ze())},onDeleteFailed:t})}else if(e&&e.dmuObject&&e.dmuObject.length&&("DMUValidationExposedPresentation"===e.dmuObject[0].getType()||"DMUValidationCheck"===e.dmuObject[0].getType())){var i=[];for(let t=0;t<e.dmuObject.length;t++)i.push(e.dmuObject[t].getPlmID());w.deleteObject({ctxViewer:de,objectIds:i,type:"validationObject",onDeleteCompleted:function(){},onDeleteFailed:t})}})),ve.onValidationObjectAttributesModificationRequest=ce.addEvent("onValidationObjectAttributesModificationRequest",(function(e){if(e&&e.attr&&e.dmuObject&&e.dmuObject.getValType&&e.attr.key){var t=[];if("name"===e.attr.key&&"ReviewMarkup"===e.dmuObject.getValType()){var i=[];i.push({sAlias:e.attr.value}),t.push({object:e.dmuObject,attributesList:i}),e.dmuObject.getParent&&e.dmuObject.getParent()&&t.push({object:e.dmuObject.getParent(),attributesList:i})}H.tryToSaveData({frameWindow:de.getFrameWindow(),saveFunction:function(){return new Promise(((e,i)=>{w.updateAttributes({ctxViewer:de,objectsToModify:t,onAttributesSaveCompleted:e,onSaveFailed:i})}))}})}})),ve.onSetImpCheckRequested=ce.addEvent("onSetImpCheckRequested",(function(e){var t=function(e,t){var n=de.getFrameWindow(),o=null,r=t.getAssociatedCheck();for(let t=0;t<e.length;t++)for(let l=0;l<r.length;l++)if(r[l]===e[t]){(o=new i).build({type:"error",autoHide:!0,message:K.setImpactedCheck.duplicateError,body:n.getUIFrame()});let e=a.getEventsController({viewer:de.getViewer()});return o&&o.destroy(),void e.fireEvent("onImpCheckFailed")}w.setImpactedCheck({iCtxViewer:de,checks:e,highlight:t,onSetImpactedCheckComplete:function(){a.getEventsController({viewer:de.getViewer()}).fireEvent("onImpactedChecksCmdEnd")},onSetImpactedCheckFailed:function(){(o=new i).build({type:"error",autoHide:!0,message:K.setImpactedCheck.error,body:n.getUIFrame()}),a.getEventsController({viewer:de.getViewer()}).fireEvent("onImpCheckFailed")}})},n=de.getFrameWindow(),o=e.checkObject?e.checkObject:null,r=null;(r=new i).build({body:n.getUIFrame(),type:"info",notificationType:"HelpNotification",message:K.setImpactedCheck.selectCheck}),window.addEventListener("keydown",(function(){r&&r.destroy(),ee&&u.unsubscribe(ee),a.getEventsController({viewer:de.getViewer()}).fireEvent("onImpactedChecksCmdEnd")}),!0),o?t(o,e.highlightObject):ee=u.onAdd((function(){var i=u.get();if(i.length>0){var n=i[i.length-1].pathElement.getLastElement();n.getDMUType&&n.getOwner&&"DMUValidationCheck"===n.getDMUType()&&(t([n.getOwner().getAttribute("sPlmID")],e.highlightObject),u.unsubscribe(ee),r&&r.destroy())}}))})),ve.onValidationUserContributionModificationRequest=ce.addEvent("onValidationUserContributionModificationRequest",(function(e){if(e&&e.connectionId&&e.contribution){var t=[];t.push({sObjectId:e.connectionId,sListOfAttributesToModify:[{sContribution:e.contribution}]}),H.tryToSaveData({frameWindow:de.getFrameWindow(),saveOperationId:"ValidationUserContributionModification",saveFunction:function(){return new Promise(((e,i)=>{w.updateUserContribution({ctxViewer:de,objectsToModify:t,onAttributesSaveCompleted:e,onSaveFailed:i})}))}}).then((()=>{Ze();f.giveDMUCommentsController({context:de.getFrameWindow(),commandContext:de?de.getCommandContext():null}).updateHeaderCommandsAvailability(),ie&&ie.updateHeaderCommandsAvailability()}))}})),ve.onDMUObjectDeleted=ce.addEvent("onDMUObjectDeleted",(function(e){e&&e.dmuObject&&e.dmuObject.getParent()&&e.dmuObject.getParent().getType&&"DMUTemporaryBag"!==e.dmuObject.getParent().getType()&&(e.dmuObject.getValType||st())})),ve.onWorkplanLoadSuccess=ce.addEvent("onWorkplanLoadSuccess",(function(){et("Workplan")})),ve.onFMEALoadSuccess=ce.addEvent("onFMEALoadSuccess",(function(){et("FMEA")})),ve.onDMUObjectInitialized=ce.addEvent("onCreateMarkupNoSlide",(()=>{st()})),ve.onDMUObjectInitialized=ce.addEvent("onDMUObjectInitialized",(function(e){if(e&&e.dmuObject&&e.dmuObject.getParent()&&e.dmuObject.getParent().getType&&"DMUTemporaryBag"!==e.dmuObject.getParent().getType())if(!e.dmuObject.getValType||Ge)st(),Ze();else if("DMUValidationValidation"===e.dmuObject.getValType())if(Ze(),de.elements.container.removeEventListener("drop",mt),"2DFL"===Re){de.elements.container.addEventListener("drop",mt);var t={_EleLogicalRelay:ft,_EleLogicalContact:ft,_EleLogicalOperatingDevice:ft,_EleLogicalSingleConnector:ft,_EleLogicalInlineConnector:ft,_EleLogicalShellConnector:ft,_EleLogicalSplice:ft,_EleLogicalTerminalBoard:ft,_EleLogicalBusbar:ft,_EleLogicalHarness:ft,_EleLogicalNet:ft,_EleLogicalNetGroup:ft,_EleLogicalWire:ft,_EleLogicalWireShield:ft,_EleLogicalCable:ft,_EleLogicalCableShielded:ft,_EleLogicalCableTwisted:ft,_EleLogicalCableTwistedShielded:ft,_EleLogicalOverShield:ft,_EleLogicalPowerCable:ft,_EleLogicalCoaxCable:ft,_EleLogicalCableGroup:ft,_EnsLogicalEquipment:ft,_EnsInCLoop:ft,_EnsInCLogicalRoute:ft,_EnsInCLogicalBranch:ft,_EnsInCLogicalComponent:ft,_Piping_Logical_Miscellaneous:ft,_Piping_Logical_Branch:ft,_Piping_Logical_Instrument:ft,_Piping_Logical_Reducer:ft,_Piping_Logical_Valve:ft,_Piping_Logical_Pipe:ft,_Piping_Line:ft,_ICLoop_Line:ft,_HVAC_Logical_Miscellaneous:ft,_HVAC_Logical_Branch:ft,_HVAC_Logical_Instrument:ft,_HVAC_Logical_Reducer:ft,_HVAC_Logical_Damper:ft,_HVAC_Logical_Duct:ft,_HVAC_Line:ft};de.setLoadingDelegations(Object.assign({},t,g))}else de.setLoadingDelegations(g);else"DMUValidationExposedPresentation"===e.dmuObject.getValType()&&re.highlightInitialization({highlight:e.dmuObject,slide:e.slideObject})})),ve.onSlideApplicativeContextModified=ce.addEvent("onSlideApplicativeContextModified",(function(e){e&&e.dmuObject&&("DMUSlide"===e.dmuObject.getType()||"DMUFormat"===e.dmuObject.getType())&&st()})),ve.onDMUOverloadPropertiesChanged=ce.addEvent("onDMUOverloadPropertiesChanged",st),ve.onDMUOccOverloadRemoved=ce.addEvent("onDMUOccOverloadRemoved",st),ve.onDMUSlideSessionInfoChanged=ce.addEvent("onDMUSlideSessionInfoChanged",(function(e){e&&e.dmuObject&&("DMUSlide"===e.dmuObject.getType()||"DMUFormat"===e.dmuObject.getType())&&lt()})),ve.onDMUSlideNameChanged=ce.addEvent("onDMUSlideNameChanged",lt),ve.onSaveRequested=ce.addEvent("onSaveRequested",lt),ve.onDMUCurrentSlideChanged=ce.addEvent("onDMUCurrentSlideChanged",Ze),ve.onFormatsEditionModeStarted=ce.addEvent("onFormatsEditionModeStarted",(function(){re.publish("onReviewContextModified",{type:Re+"Formats",onABReady:Ze})})),ve.onWorkplanLoadingStarted=ce.addEvent("onWorkplanLoadingStarted",(function(e){re.publish("onReviewContextModified",{type:"Workplan",onABReady:function(){Ze(),e.onComplete()}})})),ve.onFormatsEditionModeEnded=ce.addEvent("onFormatsEditionModeEnded",(function(){re.publish("onReviewContextModified",{type:"RefreshAB",onABReady:Ze})})),ve.onComparisonStarted=ce.addEvent("onComparisonStarted",(function(e){e&&e.is2DCompare&&(qe=!0),Ze()})),ve.onComparisonEnded=ce.addEvent("onComparisonEnded",(function(){qe=!1,Ze()})),ve.onReviewCtxInformationChanged=ce.addEvent("onReviewCtxInformationChanged",(function(e){e&&e.reviewId&&de&&de.getWidget()&&de.getWidget().dispatchEvent("onDMUReviewLoaded",{envId:v.getPlatformId(),reviewId:"DMUValidationExposedPresentation"===e.reviewType&&e.highlightId?e.highlightId:e.reviewId,objectId:e.reviewId,objectType:"Review"===e.reviewType?"_DMUValidationValidation":"_"+e.reviewType,displayName:e.reviewName,displayType:e.reviewType,type:"Review"===e.reviewType?"_DMUValidationValidation":"_"+e.reviewType})})),ve.onDMUObjectReadOnlyFlagChanged=ce.addEvent("onDMUObjectReadOnlyFlagChanged",(function(e){if("Markup"===e.dmuObject.getAttribute("sType"))Ze();else if("DMUValidationValidation"===e.dmuObject.getType()){var t="R3V"===se&&!e.flag;ce.fireEvent("setEditionMode",{editionMode:t,readOnly:e.flag}),Ze()}})),ve.onDMUObjectActiveFlagChanged=ce.addEvent("onDMUObjectActiveFlagChanged",Ze),ve.onDMUObjectVisibleFlagChanged=ce.addEvent("onDMUObjectVisibleFlagChanged",Ze),ve.onApplicativeContextCommandsRequired=ce.addEvent("onApplicativeContextCommandsRequired",(function(e){re.publish("onReviewContextModified",{type:"Data",data:e,onABReady:e.cb})})),ve.on2DDocumentLoadSuccess=ce.addEvent("on2DDocumentLoadSuccess",(function(){Ze(),Ne=!1})),ve.onDXFLoadSuccess=ce.addEvent("onDXFLoadSuccess",(function(){et("2D")})),ve.onDXFLoadSuccess=ce.addEvent("onR2VReviewCreationSuccess",(function(){et("R2V")})),ve.reviewNoContextModeOn=ce.addEvent("reviewNoContextModeOn",(function(){et("ReviewNoContext"),Fe=!1,Ge=!0})),require(["DS/PIMwebViewController/PIMwebItfCtrl"],(function(e){He=e.getLoaderForMarkup({context:de}),me.onDMUCtxtLoadingSuccess=He.subscribe("onDMUCtxtLoadingSuccess",(function(){et("ITF")})),me.onDMUCtxtRemoved=He.subscribe("onDMUCtxtRemoved",(function(){a.getReviewContext({context:de})&&a.removeReviewContext({context:de}),et("3D")}))})),ve.onRootDataRemoved=ce.addEvent("onRootDataRemoved",(function(e){ct(e)})),ve.onValidatedCreationFlagChanged=ce.addEvent("onUpdateValidatedRequested",(function(e){re.setValidatedObjCreationFlag(e)})),ve.onValidationChangeRequested=ce.addEvent("onValidationChangeRequested",(function(){var e=de.getFrameWindow().getUIFrame().getElementsByClassName("DMUCreateReviewInfoDiv");e.length&&e[0].dsModel&&e[0].dsModel.destroy(),Ze()})),ve.onAddMembersButtonClicked=ce.addEvent("onUpdateMembersRequested",(function(e){var t=de.getFrameWindow(),i=new P;i.display({modal:!0,frmWindow:t,type:"load"}),i.getContent().addClassName("DMUCreateReviewInfoDiv"),w.updateValidationMembers({context:de,jsonMembersToModify:e,onUpdateMembersSuccessful:function(){var e=de.getFrameWindow().getUIFrame().getElementsByClassName("DMUCreateReviewInfoDiv");e.length&&e[0].dsModel&&e[0].dsModel.destroy(),Ze()},onUpdateMembersFailed:function(){var e=de.getFrameWindow().getUIFrame().getElementsByClassName("DMUCreateReviewInfoDiv");e.length&&e[0].dsModel&&e[0].dsModel.destroy()}})})),ve.onValidatedObjectDropped=ce.addEvent("onValidatedObjectDropped",(function(e){b=a.getReviewContext({context:de}),w.updateValidatedObjectsList({fullPathRefs:e.path,validatedObjects:e.path,validatedId:b.getValidation().getValidated().getPlmID()?b.getValidation().getValidated().getPlmID():null,validatedToAdd:e.pathToAdd,referenceIds:e.pathToAdd,instanceIds:e.pathToAdd,instanceNames:[],updateMode:"add",ctxViewer:de.getViewer(),onReviewCtxUpdateOrDropValidated:!0,serviceId:e.serviceId,onSaveValidatedObjectsFailed:function(){}})})),ve.onValidatedChangeActionDropped=ce.addEvent("onValidatedChangeActionUpdate",(function(e){b=a.getReviewContext({context:de});var t=b.getValidation().getValidated().getPathElements(),i="add"===e.updateType?[e.data.objectId]:void 0,n=[],o=[],r=!1,l=function(e){var t=[];if(e)if(e.length>1)for(var i=1;i<e.length-1;)t.push(e[i]),i+=2;else 1===e.length&&t.push(e[0]);return t};for(let e=0;e<t.length;e++)t.length&&t[e]&&("Change Action"===t[e].referenceType?(r=!0,i=t[e].pathElement):(o.push(t[e].instanceName?t[e].instanceName:void 0),n.push(l(t[e].pathElement))));r||"add"!==e.updateType||n.push(i),(!r&&"add"===e.updateType||r&&"remove"===e.updateType)&&w.updateValidatedObjectsList({fullPathRefs:i,validatedObjects:n,validatedId:b.getValidation().getValidated().getPlmID()?b.getValidation().getValidated().getPlmID():null,validatedToAdd:[i],referenceIds:i,instanceIds:i,instanceNames:o,updateMode:e.updateType,ctxViewer:de.getViewer(),serviceId:e.data?e.data.serviceId:void 0,onSaveValidatedObjectsFailed:function(){}})})),ve.onIssueOrCaSelected=ce.addEvent("onIssueOrCaSelected",(function(e){let t=e,i={mode:"shared",isAsynchronous:!0};require(["DS/ENOCollabSharingCmds/commands/EditPropCmd/EditPropCmdBase"],(function(e){(new e).launchProperties({options:i,getSecurityContext:function(){return{SecurityContext:A.getSetting("pad_security_ctx"),tenant:A.getSetting("x3dPlatformId")}},getSelectedNodes:function(){return[{id:t,getID:function(){return this.id},source:"3DSpace",tenant:A.getSetting("x3dPlatformId")}]}})}))})),ve.onRequirementSelected=ce.addEvent("onRequirementSelected",(function(e){var t=[[e]];ce.fireEvent("onFireCrossWidgetSelection",{paths:t})})),ve.onRequirementDropped=ce.addEvent("onRequirementDropped",(function(e){b=a.getReviewContext({context:de});let t=[];function i(e){let t;if(void 0!==e){var i=document.createElement("textarea");i.innerHTML=e;t=(new DOMParser).parseFromString(i.value,"text/html").documentElement.textContent}return t}const n=e=>{let n=e["attribute[Content Text]"]?i(e["attribute[Content Text]"]):e["Content Text"]?e["Content Text"]:i(e.content)?i(e.content):"",a=e["attribute[Title]"]?i(e["attribute[Title]"]):e.Title?e.Title:"",o=e.type.value?e.type.value:e["type.kindof"]?e["type.kindof"]:"";n&&n.length>100&&(n=n.substring(0,99)+"..."),"Requirement"===o&&t.push({sValidationId:b.getValidation().getPlmID(),sRequirementDocId:e.physicalid,sName:a,sDescription:n,iCheckState:1})};new Promise((t=>{let i=0;e.forEach((async a=>{if(["Requirement Specification","Chapter"].includes(a.objectType)){(await re.getRequirementData({phyId:a.objectId})).forEach((e=>{n(e)}))}else{let e=await(o=a.objectId,new Promise(((e,t)=>{R.getRequirementElementContent(o).then((i=>{i&&"success"===i.status&&i.results[0]?e(i):t(new Error("Requirement has no content"))})).catch((()=>{t(new Error("Requirement content Request Failed"))}))})));e.results.forEach((e=>{e.physicalid||(e.physicalid=a.objectId),n(e)}))}var o;i++,i===e.length&&t()}))})).then((()=>{let e=[],i=[],n=e=>{if(e>10){new F({title:K.warningPanelTitle,message:K.createCheckInfo,frmWindow:de.getFrameWindow(),callbacks:{onValidateCB:()=>{w.addChecks({checkList:t,iCtxViewer:de})},onCancelCB:()=>{},onCloseCB:()=>{}}})}else w.addChecks({checkList:t,iCtxViewer:de})};if(b.getValidation().getChecks().forEach((n=>{t.forEach((t=>{n.getJsonRequirements().length&&t.sRequirementDocId===n.getJsonRequirements()[0]._sPlmID&&(e.includes(t.sRequirementDocId)||(e.push(t.sRequirementDocId),i.push(t.sName)))}))})),i.length){new F({title:K.warningPanelTitle,message:K.requirementAlreadyAssociated01+" <br /> "+K.requirementAlreadyAssociated02+" <br /> "+i.toString(),frmWindow:de.getFrameWindow(),callbacks:{onValidateCB:()=>{n(t.length)},onCancelCB:()=>{},onCloseCB:()=>{}}})}else n(t.length)}))})),ve.onIssueDataRequested=ce.addEvent("onIssueDataRequested",(function(e){!function(e){new Promise((function(t,i){var n={method:"GET"};n.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:A.getSetting("pad_security_ctx")},n.onComplete=function(i){var n=JSON.parse(i).body;e.onComplete&&n&&e.onComplete({issuePriority:n.priority?n.priority:"Low",issueTitle:n.title?n.title:"Issue",issueDescription:n.description?n.description:""}),t()},n.onFailure=i;var a=v.get3DSpaceUrl()+"/resources/issues/"+e.physicalId;require("DS/WAFData/WAFData").authenticatedRequest(a,n)}))}(e)})),ve.onTaskDataRequested=ce.addEvent("onTaskDataRequested",(function(e){!function(e){new Promise((function(t,i){let n={method:"GET"};n.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:A.getSetting("pad_security_ctx")},n.onComplete=function(i){let n,a=JSON.parse(i).data;1===a.length&&a[0].dataelements&&(n=a[0].dataelements),e.onComplete&&n&&e.onComplete({taskTitle:n.title?n.title:"Task",taskDescription:n.description?n.description:""}),t()},n.onFailure=i;let a=v.get3DSpaceUrl()+"/resources/v1/modeler/tasks/"+e.physicalId;require("DS/WAFData/WAFData").authenticatedRequest(a,n)}))}(e)})),ve.onPrefTemplateIssueOnlyRequested=ce.addEvent("onPrefTemplateIssueOnlyRequested",(function(e){e.onPrefTemplateIssueOnlyRequestedCB(ye)})),ve.onDMUObjectCreation=ce.addEvent("onDMUObjectCreation",(function(e){if(e&&e.dmuObject&&("DMUComment"===e.dmuObject.getType()||"DMUSlide"===e.dmuObject.getType())&&(b=a.getReviewContext({context:de}),b)){let t=b.getValidation();if(t){let i=J.getUserLogin(),n=t.getMembers();if(n){let t=n.getAssignees(),a=n.getContributors();if(t.length>0||a.length>0){let n,o;n=t.find((e=>e.user===i));let r=n?n.contribution:null,l=n?n.id:null;if(r||(o=a.find((e=>e.user===i)),r=o?o.contribution:null,l=o?o.id:null),r&&"NotStarted"===r){let t=!1,i=!!e.dmuObject.isReply&&e.dmuObject.isReply();if((!i&&n||i&&(n||o))&&(t=!0),t){let e={connectionId:l,contribution:"OnGoing"};ce.fireEvent("onValidationUserContributionModificationRequest",e)}}}}let a=[];if("DMUSlide"===e.dmuObject.getType()){let n=e.dmuObject.getAttribute("sParentSlideID");if(n){let e=null,o=null;if(t.getAllRepRefs().forEach((t=>{let r=t.getMarkupContent();if(r){r.getSlides().forEach((t=>{let r=null;o||t.getAttribute("sUuid")!==n?t.getAttribute("sParentSlideID")===n&&(r=t.getAttribute("sOwner")):(r=t.getAttribute("sOwner"),e=t.getAttribute("sName")),r&&r!==i&&-1===a.indexOf(r)&&a.push(r)}))}})),a.length>0){let i=[];a.forEach((e=>{i.push({id:e,type:"person"})})),C.notify({validationId:t.getPlmID(),parentSlideID:n,repliedSlideName:e,notifId:"review.slide.reply.new",listUsers:i})}}}else if("DMUComment"===e.dmuObject.getType()){let n=e.dmuObject.getParentCommentId();if(n){let e=null,o=null;if(t.getAllRepRefs().forEach((t=>{let r=t.getMarkupContent();if(r){let t=r.getComments();if(t&&0===t.length){let e=r.getSlides();e&&e.forEach((e=>{t=t.concat(e.getDMUObjects("DMUComment"))}))}t&&t.forEach((t=>{let r,l=null;if(o||t.getAttribute("sUuid")!==n)t.getParentCommentId()===n&&(r=t.getAttribute("sOwner"),l=t.getAttribute("sTextContents"));else{r=t.getAttribute("sOwner");let i=t.getTextContent();e=i&&i.length>30?i.slice(0,29)+"...":i,l=t.getAttribute("sTextContents")}if(r&&r!==i&&-1===a.indexOf(r)&&a.push(r),l){let e=z.getMentionsFromContent(l);e&&e.forEach((e=>{e.id!==i&&-1===a.indexOf(e.id)&&a.push(e.id)}))}}))}})),a.length>0){let i=[];a.forEach((e=>{i.push({id:e,type:"person"})})),C.notify({validationId:t.getPlmID(),commentId:n,commentContent:e,notifId:"review.comment.reply.new",listUsers:i})}}}}}})),ve.onPreviewThumbnailUpdateRequested=ce.addEvent("onPreviewThumbnailUpdateRequested",(function(e){b=a.getReviewContext({context:de});const t=b&&b.getReviewCtxInformation();if(t&&b.getValidation()){e.thumbnailData?S.saveObjectThumbnail("review2dthumbnail",e.thumbnailData,t.reviewId):S.deleteMarkupThumbnail("review2dthumbnail",t.reviewId),w.setSlideForPreview({validation:b.getValidation(),slideForPreview:e.elementId,ctxViewer:de,onSetSlideForPreviewCompleted:()=>{},onSetSlideForPreviewFailed:()=>{}});var i=b.getValidation().getHighlights();for(let t=0;t<i.length;t++)i[t].getPresentationSlideID()===e.elementId&&S.saveObjectThumbnail("review2dthumbnail",e.thumbnailData,i[t].getPlmID())}})),ve.onPreviewThumbnailUpdateRequested=ce.addEvent("onPreviewUpdateOnHighlightRequested",(function(e){b=a.getReviewContext({context:de});b&&b.getReviewCtxInformation()&&b.getValidation()&&(e.elementId&&b.getValidation().getHighlights().forEach((t=>{t.getPresentationSlideID()===e.elementId&&e.imageData&&S.saveObjectThumbnail("review2dthumbnail",e.imageData,t.getPlmID())})))})),ve.onDMUObjectRemovedFromObject=ce.addEvent("onDMUObjectRemovedFromObject",(function(e){if("DMUComment"===e.dmuObject.getType()){b=a.getReviewContext({context:de});let t=b.getValidation().getHighlights();for(let i=0;i<t.length;i++){let n=e.dmuObject.getAssociatedHighlightData();for(let e=0;e<n.length;e++)n[e].id===t[i].getPlmID()&&(S.deleteMarkupThumbnail("review2dthumbnail",t[i].getPlmID()),ce.fireEvent("onHighlightPreviewUpdateRequested",{highlightId:t[i].getPlmID()}))}}})),ve.onPreviewThumbnailUpdateRequested=ce.addEvent("onPreviewDeleteOnHighlightRequested",(function(e){b=a.getReviewContext({context:de});b&&b.getReviewCtxInformation()&&b.getValidation()&&S.deleteMarkupThumbnail("review2dthumbnail",e.elementId)})),ve.onReviewObjectAttributesModified=ce.addEvent("onReviewObjectAttributesModified",(function(e){if(e&&e.object&&e.attr&&e.attr[0]&&(e.attr[0].currentState||e.attr[0].sValidationState)&&e.object.getRestrictedEditionFlag&&"Activated"===e.object.getRestrictedEditionFlag()){var t=de.getFrameWindow().getUIFrame().getElementsByClassName("DMUCreateReviewInfoDiv");t.length&&t[0].dsModel&&t[0].dsModel.destroy(),Ze()}})),ve.onMaturityModificationRequested=ce.addEvent("onMaturityModificationRequested",(function(e){var t;const i=()=>v.get3DSpaceUrl(),n=()=>v.getPlatformId();b=a.getReviewContext({context:de});var o=b.getValidation(),r={data:[{physicalid:o.getPlmID(),name:o.getName(),fromstate:e.fromState,tostate:e.toState,type:"DMUValidationValidation"}]};t=i()+"/resources/lifecycle/maturity/promote?tenant="+n();require("DS/WAFData/WAFData").authenticatedRequest(t,{method:"POST",type:"json",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:A.getSetting("pad_security_ctx")},timeout:36e5,data:JSON.stringify(r),onComplete:function(t){t&&t.results&&t.results.length&&t.results[0].current?(o.setCurrentState(t.results[0].current),ce&&("PRIVATE"===e.fromState&&"IN_WORK"===e.toState?C.notify({validationId:o.getPlmID(),notifId:"review.members.new",allMembers:!0}):C.notify({validationId:o.getPlmID(),notifId:"review.maturity.change"}),ce.fireEvent("onReviewObjectAttributesModified",{object:o,attr:[{currentState:t.results[0].current}]}))):ce&&ce.fireEvent("onReviewObjectAttributesModified",{object:o,attr:[{currentState:e.fromState}]})},onFailure:function(){ce&&ce.fireEvent("onReviewObjectAttributesModified",{object:o,attr:[{currentState:e.fromState}]})},onTimeout:function(){ce&&ce.fireEvent("onReviewObjectAttributesModified",{object:o,attr:[{currentState:e.fromState}]})}})})),ve.onNewCommentMentionsCreated=ce.addEvent("onNewCommentMentionsCreated",(function(e){if(e&&e.mentions){let t;b=a.getReviewContext({context:de}),b.getValidation()&&b.getValidation().getContext()&&(t=b.getValidation().getContext().getSubContextID()?b.getValidation().getContext().getSubContextID():b.getValidation().getContext().getMainContextID()),C.notify({validationId:b.getValidation().getPlmID(),contextId:t,notifId:"review.mentionned.new",listUsers:e.mentions,commentId:e.commentId})}})),ae=n.getLoadMarkupServices({context:de}),oe=de.getExecutionContext?Ze():de.getFrameWindow().getActionBar().onActionBarReady(Ze),(Me=r.getManager({name:"DMU2DSheetManager",context:de.getFrameWindow()}))||(Me=new m({ctxViewer:de}),r.addManager({name:"DMU2DSheetManager",context:de.getFrameWindow(),manager:Me})),te||(te=new l({context:de})),pe.onApplyFilterBegin=de.subscribe({event:"onBeginFilterApplied"},ut),pe.onFilterApplied=de.subscribe({event:"onFilterApplied"},gt),pe.onLoadingFailure=de.subscribe({event:"onLoadingFailure"},gt),pe.onRootAdded=de.subscribe({event:"onRootAdded"},dt),pe.onRootRemoved=de.subscribe({event:"onRootRemoved"},ct),pe.onRealAssetLoaded=de.subscribe({event:"onRealAssetLoaded"},(e=>{nt()?et("R2V3D"):et("R2V");let t=setInterval((()=>{if(de.getExecutionContext){const i=de.getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent);i&&i.hasCheckHandler("ENO3DTogglePhoto360ModeChk")&&(clearInterval(t),e.callback&&e.callback())}}),500)})),pe.onRootAttached=de.subscribe({event:"onRootAttached"},dt),pe.onRootDetached=de.subscribe({event:"onRootDetached"},ct),pe.onRefreshBegin=de.subscribe({event:"onRefreshBegin"},(()=>{Fe=!0,Je||(!Me||"Drawing"!==Ae&&"DIFSheet"!==Ae&&"DIFLayout"!==Ae||Me.clean2DDocument(),Je=!0)})),pe.onRefreshCompleted=de.subscribe({event:"onRefreshCompleted"},(function(){Fe=!1})),pe.onDMUReviewRefreshRequest=ce.addEvent("onDMUReviewRefreshRequest",(function(e){re.loadReviewAfterRefresh(e)})),fe=de.getViewer().onSwapVisibleSpace(Ze),Ve=d.getDMUApplicativeContextManager({context:de}),ve.onR3RAppTransitionRequested=ce.addEvent("onLeavingReviewApp",(function(e){if(b=a.getReviewContext({context:de}),"X3DPLAW_AP"===e.targetApp)b&&b.getValidation()&&(b.getValidation().setReadOnly(!0),Ze());else if("ENOR3V_AP"!==e.targetApp&&"ENOR3R_AP"!==e.targetApp){if(b=a.getReviewContext({context:de}),b&&b.getValidation()){N.giveDMUReviewController({context:de.getFrameWindow()}).setVisibleFlag(!1);const e=ie||Ye();e&&e.setVisibleFlag(!1)}}else"ENOR3V_AP"===e.targetApp?b&&b.getValidation()&&(b.getValidation().setReadOnly(!1),Ze()):"ENOR3R_AP"===e.targetApp&&b&&b.getValidation()&&(b.getValidation().setReadOnly(!0),Ze())})),b=a.getReviewContext({context:de}),b&&b.getCurrentSessionMarkup()){var I=!1,x=b.getReviewCtxInformation();if(x&&x.contextId||"R3R"===se){var E=de.getRootBagPath().getChildrenPathes();for(p=0;p<E.length;p++){if((de.getApplicativeData().getLoadedItfData&&de.getApplicativeData().getLoadedItfData().data.length?de.getApplicativeData().getLoadedItfData().data[0].isrID:c.getNodeID(E[p].getLastElement(!0)))===x.contextId){b.getCurrentSessionMarkup().setActiveFlag(!0),!0===x.modifiable&&b.setReadOnly(!1),I=!0;break}}I||b.setCurrentSessionMarkup(null)}}if(b&&b.getValidation()){N.giveDMUReviewController({context:de.getFrameWindow()}).setVisibleFlag(!0);const e=ie||Ye();e&&e.setVisibleFlag(!0),Be||(b.setReadOnly(!1),b.getValidation().setReadOnly(!1),ce.fireEvent("setEditionMode",{editionMode:"R3V"===se,readOnly:!1}),Ze())}else b&&b.setCurrentSessionMarkup(null);Oe=de.getViewer().sectionCappingEnabled,de.getViewer().setSectionCapping(!0),(ke=de.isRobotVisible())&&de.setRobotVisibility(!1),de.getFrameWindow().getContextualUIManager().registerUnshift({subscriberId:"R3V"===se?"3DValidationWebAppCtxElements":"3DReviewWebAppCtxElements",workbenchName:"R3V"===se?"DMUValWebAppController":"DMUReviewWebAppController",context:de.getCommandContext(),module:"R3V"===se?"DMUValWebAppController":"DMUReviewWebAppController",cmdPrefix:"",directory:"assets/afr/",merge:!0,onContextualBarReady:this._onContextualBarReadyCB,onContextualMenuReady:this._onContextualMenuReadyCB}),(Ie=de.isDefaultContextualBarVisible())&&de.setDefaultContextualBarVisibility(!1),(xe=de.isDefaultContextualMenuVisible())&&de.setDefaultContextualMenuVisibility(!1),(Ee=de.isOpenWithMenuAvailable())||de.setOpenWithMenuAvailability(!0),await async function(){var e=D.getPreferenceManager({context:de.getFrameWindow()});if(e){if(e.setUnitsPreferencesDisplayFlag(!0),e.setDisplayPreferencesDisplayFlag(!0),e.set3DSelectionPreferencesDisplayFlag(!0),e.set2DSelectionPreferencesDisplayFlag(!0),e.setExportPreferencesDisplayFlag(!0),e.setMeasurePreferencesDisplayFlag(!0),e.setClippingPreferencesDisplayFlag(!0),e.addPreferences([{nls:K.preferences.reviewSectionTitle,id:"ReviewPreferences",type:"section",preferences:[{nls:K.preferences.reviewQuickCreationLbl,id:"DisplayReviewCreationDialog",type:"checkbox",getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_DisplayReviewCreationDialog")},getDefaultValue:function(){return!0},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_DisplayReviewCreationDialog"))&&localStorage.setItem("CATWebUXMePreferences_DisplayReviewCreationDialog",e?"true":"false")}},{nls:K.preferences.markupAutomaticCreationLbl,id:"AutomaticMarkupCreationDialog",type:"checkbox",getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_AutomaticMarkupCreationDialog")},getDefaultValue:function(){return!0},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_AutomaticMarkupCreationDialog"))&&localStorage.setItem("CATWebUXMePreferences_AutomaticMarkupCreationDialog",e?"true":"false")}}]},{nls:K.preferences.markupSectionTitle,id:"MarkupPreferences",type:"section",preferences:[{nls:K.preferences.QuickCreationLbl,id:"CATWebUXMePreferences_DisplayMarkupCreationDialog",type:"checkbox",getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_DisplayMarkupCreationDialog")},getDefaultValue:function(){return!0},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_DisplayMarkupCreationDialog"))&&localStorage.setItem("CATWebUXMePreferences_DisplayMarkupCreationDialog",e?"true":"false")}},{nls:K.preferences.automaticallyCreateFirstSlide,id:"CreateFirstSlide",type:"checkbox",getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_CreateFirstSlide")},getDefaultValue:function(){return!0},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_CreateFirstSlide"))&&localStorage.setItem("CATWebUXMePreferences_CreateFirstSlide",e?"true":"false")}}]},{nls:K.preferences.handlesSectionTitle,id:"HandlesPreferences",type:"section",preferences:[{prefixnls:K.preferences.gridSpacingPrefix,suffixnls:K.preferences.gridSpacingSuffix,id:"SnapHandlesToGrid",type:"checkbox+spinbox",disableSpinboxAtUncheck:!0,getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_SnapHandlesToGrid")},getSpinBoxValues:function(){var e=parseFloat(localStorage.getItem("CATWebUXMePreferences_SnapHandlesGridValue"));e=isNaN(e)?.001:e;var t=localStorage.getItem("CATWebUXMePreferences_Length")||"Millimeter";return{value:e="Inch"===(t="Foot"===t?"Inch":"Centimeter"===t||"Meter"===t||"Kilometer"===t?"Millimeter":t)||"Millimeter"===t?h.convert(e,"Length","Meter",t):e,units:t,minValue:"Millimeter"===t?1:.01,stepValue:"Millimeter"===t?1:.01}},getDefaultValue:function(){return!0},getSpinBoxDefaultValues:function(){return{value:1,units:"Millimeter",minValue:1,stepValue:1}},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_SnapHandlesToGrid"))&&localStorage.setItem("CATWebUXMePreferences_SnapHandlesToGrid",e?"true":"false")},setSpinBoxValue:function(e){var t=parseFloat(localStorage.getItem("CATWebUXMePreferences_SnapHandlesGridValue"));e!==(t=isNaN(t)?1:t)&&localStorage.setItem("CATWebUXMePreferences_SnapHandlesGridValue",e)}},{prefixnls:K.preferences.rotSnappingPrefix,suffixnls:"("+K.preferences.rotSnappingSuffix+")",id:"SnapRotationToggle",type:"checkbox+spinbox",disableSpinboxAtUncheck:!1,getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_SnapRotationToggle")},getSpinBoxValues:function(){var e=parseFloat(localStorage.getItem("CATWebUXMePreferences_SnapRotationAngle"));e=isNaN(e)?1.5708:e;var t=localStorage.getItem("CATWebUXMePreferences_Angle")||"Degree";return{value:e="Degree"===t?Math.round(h.convert(e,"Angle","Radian",t)):e,units:t,minValue:"Degree"===t?1:.01,stepValue:"Degree"===t?1:.01}},getDefaultValue:function(){return!0},getSpinBoxDefaultValues:function(){return{value:90,units:"Degree",minValue:1,maxValue:360,stepValue:1}},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_SnapRotationToggle"))&&localStorage.setItem("CATWebUXMePreferences_SnapRotationToggle",e?"true":"false")},setSpinBoxValue:function(e){var t=parseFloat(localStorage.getItem("CATWebUXMePreferences_SnapRotationAngle"));e!==(t=isNaN(t)?90:t)&&localStorage.setItem("CATWebUXMePreferences_SnapRotationAngle",e)}}]},{nls:Q.ticSection,id:"TICSection",type:"section",preferences:[{nls:Q.ticTemplateIssue,type:"checkbox",id:"TICTemplateIssue",setValue:function(e){localStorage.setItem("TICTemplateIssue",e)},getValue:function(){return"true"===localStorage.getItem("TICTemplateIssue")},getDefaultValue:function(){return!1}}]}]),re.createSharedPreferences(e),e.setPreferredPreferenceContainersOrder(["ReviewPreferences","MarkupPreferences","SlidePreferences","HandlesPreferences","MarkerPreferences","TICSection","MeasurePreferences","SectionPreferences"]),!de.getViewer().get2DMode()){try{let e=(await h.readPreferences([{Repository:"VisualizationRepository",PreferenceNames:["Gravity"]},{Repository:"FrameGeneral",PreferenceNames:["ProjectionType"]},{Repository:"SelectionRepository",PreferenceNames:["Select3DGeometry","SelectParentReferenceOr3DShape"]},{Repository:"TICSection",PreferenceNames:["TICTemplateIssue"]}])).repositories;for(let t=0;t<e.length;t++)if("VisualizationRepository"===e[t].name)he="true"===e[t].preferences[0].value;else if("FrameGeneral"===e[t].name)we=e[t].preferences[0].value;else if("SelectionRepository"===e[t].name){let i=e[t].preferences;for(let e=0;e<i.length;e++)"Select3DGeometry"===i[e].name?Ce="true"===i[e].value:"SelectParentReferenceOr3DShape"===i[e].name&&(Se=i[e].value)}else"TICSection"===e[t].name&&(ye="true"===e[t].preferences[0].value,$e())}catch(e){he=!1,ye=!1,$e(),we="Perspective",Ce=!1,Se="selectParentReference",window.console.warn("Could not get server value, default value set instead.",e)}"boolean"==typeof he&&(de.getViewer().currentViewpoint.getControl().setRotationRolling(!he),de.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!he)),"Perspective"!==we&&"Parallel"!==we||de.getViewer().currentViewpoint.setProjectionType("Perspective"===we?0:1),We&&We.setPicking(Ce?0:1),We&&We.selectParentReference("select3DShape"!==Se)}be=e.subscribe("com.ds.mep:onPrefUpdate",(function(e){let t=JSON.parse(e[1].preferences);for(let e=0;e<t.repositories.length;e++)for(let i=0;i<t.repositories[e].preferences.length;i++)"SelectParentReferenceOr3DShape"===t.repositories[e].preferences[i].name?(Se=t.repositories[e].preferences[i].value,We&&We.selectParentReference("select3DShape"!==Se)):"Select3DGeometry"===t.repositories[e].preferences[i].name?(Ce="true"===t.repositories[e].preferences[i].value,We&&We.setPicking(Ce?0:1)):"ProjectionType"===t.repositories[e].preferences[i].name?(we=t.repositories[e].preferences[i].value,de&&de.getViewer()&&de.getViewer().currentViewpoint&&de.getViewer().currentViewpoint.setProjectionType("Perspective"===we?0:1)):"Gravity"===t.repositories[e].preferences[i].name?(he="true"===t.repositories[e].preferences[i].value,de&&de.getViewer()&&de.getViewer().currentViewpoint&&de.getViewer().currentViewpoint.control&&(de.getViewer().currentViewpoint.getControl().setRotationRolling(!he),de.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!he))):"TICTemplateIssue"===t.repositories[e].preferences[i].name&&(ye="true"===t.repositories[e].preferences[i].value,$e(),Ze())}))}}(),de.getRootBagPath()&&de.getRootBagPath().getChildrenPathes().length&&(ot({path:de.getRootBagPath().getChildrenPathes()[0]}),de.getRootBagPath().getChildrenPathes().forEach(((e,t)=>{0!==t&&"R2V_Activity"===e.getLastElement(!0).getUserData().type&&ot({path:e})})))}else{var k;if(M.unreferenceSelectionManager({context:de}),We=null,Te&&de.getViewer().setPicking(Te),_e&&de.getViewer().setPrePicking(_e),_e=null,_e=null,de.elements.container.removeEventListener("drop",mt),V=D.givePreferenceManager({context:de.getFrameWindow()}),V){for(k=Object.keys(De),p=0;p<k.length;p++)V.unsubscribe(De[k[p]]);De={},V.removePreferences("R3V"===se?["MarkupPreferences","HandlesPreferences"]:["ReviewPreferences","HandlesPreferences"]),re.removeSharedPreferences(V)}if(D.unreferencePreferenceManager({context:de.getFrameWindow()}),rt&&(clearTimeout(rt),rt=null),H.clean(),de.setLoadingDelegations({}),de.getExecutionContext||de.getFrameWindow().getActionBar().removeCallback(oe),de.getFrameWindow().getContextualUIManager().unregister("3DReviewWebAppCtxElements"),de.getFrameWindow().getContextualUIManager().unregister("3DValidationWebAppCtxElements"),void 0!==Ie&&de.setDefaultContextualBarVisibility(Ie),Ie=void 0,void 0!==xe&&de.setDefaultContextualMenuVisibility(xe),xe=void 0,void 0!==Ee&&de.setOpenWithMenuAvailability(Ee),Ee=void 0,void 0!==ke&&de.setRobotVisibility(ke),ke=void 0,void 0!==Oe&&de.getViewer().setSectionCapping(Oe),Oe=void 0,d.unreferenceDMUApplicativeContextManager({context:de}),Ve=null,Me.isADocumentDisplayed())if(Be)b=a.getReviewContext({context:de}),b&&b.getCurrentSessionMarkup()&&b.setReadOnly(!0);else{Me.clean2DDocument();const e=f.giveDMUCommentsController({context:de.getFrameWindow()});e&&e.cleanCommentsPanel();for(var O=[],T=c.getRoots(de),_=0;_<T.length;_++)O.push(c.getNodeID(T[_]));de.removeRoots({pids:O})}else b=a.getReviewContext({context:de}),b&&b.getCurrentSessionMarkup()&&(Be||b.getCurrentSessionMarkup().setActiveFlag(!1));for(u.empty(),g.empty(),k=Object.keys(pe),p=0;p<k.length;p++)de.unsubscribe(pe[k[p]]);if(pe={},ce){for(k=Object.keys(ve),p=0;p<k.length;p++)ce.removeEvent(ve[k[p]]);a.unreferenceEventsController({viewer:de.getViewer()}),ce=null}if(ve={},He){for(k=Object.keys(me),p=0;p<k.length;p++)He.unsubscribe(me[k[p]]);me={},He=null}te&&(te.clean(),te=null),fe&&(de.getViewer().unsubscribe(fe),fe=null),be&&(V.unsubscribe(be),be=null),Be||(r.removeManager({name:"DMU2DSheetManager",context:de.getFrameWindow()}),Me=null),n.unreferenceLoadMarkupServices({context:de}),ae=null}Ze()}},this.disableDMUContextualBar=function(){de.getFrameWindow().getContextualUIManager().getContextualBar().hide()},this.enableDMUContextualBar=function(){},this.subscribe=function(e,t){if(e&&t&&ge)return ge.subscribe({event:e},t)},this.unsubscribe=function(e){ge&&e&&ge.unsubscribe(e)},this.getActiveState=function(){return le},this.clearController=function(){Le&&clearTimeout(Le),re._setActiveState(!1),de=re=ge=pe=Ne=Le=null},this.loadMarkupContext=async function(e){var t=!1,i=a.getReviewContext({context:de});if(i){var n=i.getReviewCtxInformation();t=n&&n.contextId===e.objectId}const o=await it(e.objectType);if(e.objectId&&!t){if(Ue===e.objectId)return void de.displayNotification({msg:K.documentAlreadyLoaded,eventID:"info"});var r;o&&o.length&&["SIMItfSimulation","PLMPIMMetricReference","Document","Specification Report","DIFLayout","DIFSheet","DIFAnnotationSet","Requirement","Requirement Specification","DesignSight","DELLmiWorkPlanSystemReference","DELLmiPPRHeaderProcessReferenceAbstract","FailureModesEffectsAnalysis"].some((function(e){if(-1!==o.indexOf(e))return r=e,!0}))?(e.objectParentType=r||e.objectType,Pe.load({data:e}),-1===o.indexOf("Document")&&-1===o.indexOf("Specification Report")||(Ne=!0)):ot({docData:e})}},this.loadValidation=async function(e){await b.createReviewContext({context:de}),e.editionMode="R3V"===se,e&&ae&&ae.loadValidation(e)},this.appInitFromTransition=function(t){var i;return new e.Promise((function(e){e()})).then((function(e){e||t.onNoActionDone()})).catch(t.onNoActionDone).finally((function(){i}))},this.refreshContext=function(){var e=a.getReviewContext({context:de});e&&(e.refreshNode(),de.getViewer().render())},this.publish=function(e,t){le&&setTimeout((function(){ge&&ge.publish({event:e,data:t,context:re})}))},this.setappTransition=function(e){Be=e}},setControllerActiveState:async function(e){this._setActiveState&&await this._setActiveState(e)}})})),
/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
define("DS/DMUReviewCommonWebApp/DMUCommonWebAppOptions",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Utils"],(function(e,t,i,n){"use strict";return t.singleton(i,{init:function(){var t={};""!==window.location.search&&(e.extend(t,n.parseQuery(window.location.search)),t.widgetDomain&&e.extend(t,n.parseQuery(t.widgetDomain))),("debug_me"in t||window.debug)&&(t.debug=!0),("testWkb"in t||window.testWkb)&&(t.testWkb=!0),this.setOptions(t)}})})),define("DS/DMUReviewCommonWebApp/DMUCommonWebAppMain",["UWA/Core","DS/DMUControls/EXPNotify","DS/DMUReviewCommonWebApp/DMUCommonWebAppOptions","DS/DMUMeasurable/DMUToolsSceneGraph","DS/PADUtils/PADSettingsMgt","DS/DMUBaseUI/DMUReviewDnDComponent","DS/CATWebUXComponents/DMUCommandsManager","DS/PADServices/views/LandingPage","DS/PADServices/utils/GlobalModelEvents","DS/EditPropWidget/constants/ConstantsMapping","DS/CATWebUXComponents/DMUFrameWindow","DS/DMUReadPersistence/DMUWebServicesUtils","DS/DMUReadPersistence/DMULoadingContextController","i18n!DS/DMUReviewCommonWebApp/assets/nls/DMUCommonWebAppMain"],(function(e,t,i,n,a,o,r,l,s,d,c,u,g,p){"use strict";let m,f,v={widget:null,widgetLink:null,viewer:null,viewerAttachment:null};const D=[{key:"rvw",type:"DMUValidationValidation"},{key:"highlight",type:"DMUValidationExposedPresentation"},{key:"isr",type:"SIMItfSimulation"},{key:"itf",type:"PLMPIMMetricReference"},{key:"difLayout",type:"DIFLayout"},{key:"difSheet",type:"DIFSheet"},{key:"difAnnotSet",type:"DIFAnnotationSet"},{key:"doc",type:"Document"},{key:"req",type:"Requirement"},{key:"reqSpec",type:"Requirement Specification"},{key:"msr",type:"DesignSight"},{key:"pointClouds",type:"R2V_Activity"},{key:"fmea",type:"FailureModesEffectsAnalysis"}],h=["ds6w:label","ds6w:type","ds6wg:revision","ds6w:status","owner","ds6w:responsible","ds6w:modified","ds6w:project","ds6w:identifier"];function w(){var e=this.params.widget.getValue("xsceneStoredObjects");return e&&"string"==typeof e||(e='{"products":{},"filters":{}}'),JSON.parse(e)}function C(e){e&&e.length&&(e[0].id.reviewId&&(e[0]=e[0].id,e[0].type&&"_DMUValidationValidation"===e[0].type&&(e[0].type="DMUValidationValidation"),e[0].type&&"_DMUValidationExposedPresentation"===e[0].type&&(e[0].type="DMUValidationExposedPresentation")),this.showWelcomePanel(!1),this.pad3DViewer.addRootNodesFromContent({json3DXContent:{protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",data:{items:e.map((function(e){return{envId:require("DS/PADUtils/PADUtilsServices").getPlatformId(),objectId:e.reviewId?e.reviewId:e.id,objectType:"PointCloud"!==e.type?e.type:"R2V_Activity",displayName:e.displayName,serviceId:"PointCloud"!==e.type?void 0:"r2vsurvey"}}))}}}))}async function S(e){try{let t=await u.getParentTypes(e);return[e].concat(t)}catch{return[e]}}async function b(e){let i=!0;if(e.length>1)for(const t of e){let e=await S(t["ds6w:type"]);if(!e.includes("VPMReference")&&!e.includes("R2V_Activity")){i=!1;break}}var n,a,o;i?C.call(this,e.map((function(e){return{id:e.resourceid,type:e["ds6w:type_value"],displayName:e["ds6w:label"]}}))):(n="warning",a=p.dropMultiNoAutorized,o=this.pad3DViewer,f&&(f.destroy(),f=null),f=new t({body:o.getFrameWindow().getUIFrame(),type:n,message:a}))}function y(e){if(e&&e.length){s.publish({event:"ENXViews/LandingPage/addOrRefresh",data:{objects:e.map((function(e){return{resourceid:e,openWithFilter:!1,loading:!0,fromCustom:!0}}))}});var t=setInterval(function(){this.isAppReady&&this.welcomePanel&&(clearInterval(t),function(e,t){require("DS/WAFData/WAFData").authenticatedRequest(require("DS/PADUtils/PADUtilsServices").get3DSpaceUrl()+"/cvservlet/fetch/v2?tenant="+require("DS/PADUtils/PADUtilsServices").getPlatformId(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx")},data:JSON.stringify({physicalid:e,label:"M3DFetchForWelcomePanel"+Date.now(),select_predicate:h,select_file:["icon","thumbnail_2d"]}),onComplete:t,onFailure:function(){},onTimeout:function(){}})}(e,function(e){if(this.welcomePanel){var t=((e?JSON.parse(e):{}).results||[]).map(function(e){var t={},i=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),n=i.getRoots(this.pad3DViewer).map((function(e){return i.getNodeID(e)})),a=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:this.pad3DViewer}),o=a?a.getReviewCtxInformation():{};o&&o.reviewId&&n.push(o.reviewId),o&&o.highlightId&&n.push(o.highlightId),this.pad3DViewer.getApplicativeData().getLoadedItfData&&this.pad3DViewer.getApplicativeData().getLoadedItfData().data.forEach((function(e){n=n.concat(e.metricID.length?e.metricID:[e.isrID])})),e.attributes.forEach((function(e){t[e.name]=e.value}));var r={resourceid:t.resourceid,label:t["ds6w:label"],icons:[t.type_icon_url],thumbnail:t.preview_url,grid:t,subLabel:t["ds6w:responsible"]+" | "+new Date(t["ds6w:modified"]).toLocaleString(),description:t["ds6w:identifier"],openWithFilter:!1,fromCustom:!0,loading:void 0,opened:n.indexOf(t.resourceid)>-1,item2Load:{}};r.item2Load[r.resourceid]={};let l=t["ds6w:type"];return"SIMItfSimulation"!==l&&"PLMPIMMetricReference"!==l&&"DIFAnnotationSet"!==l||(r.addRemoveFromViewCtx=!0),r}.bind(this));s.publish({event:"ENXViews/LandingPage/addOrRefresh",data:{objects:t}})}}.bind(this)))}.bind(this),100)}}function M(e){this.isAppReady=!1,this.params=e,this.welcomePanel=this.pad3DViewer=this.reviewCtrl=null,this.tokensWelcomePanel=[],this.tokensPAD=[],this.tokensMkp=[],this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/LandingPage/refreshCustom"},y.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/LandingPage/openCustom"},function(e){var t=w.call(this),i=[];e.customitem2open.forEach((function(e){D.some((function(n){if(t[n.key]&&t[n.key][e])return i.push({id:e,type:n.type}),!0}))})),C.call(this,i)}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/LandingPage/removeFromView"},function(e){if(e&&e.customitem2remove&&e.customitem2remove.length){var t=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),i=t.getRoots(this.pad3DViewer).map((function(e){return t.getNodeID(e)})),n=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:this.pad3DViewer}),a=n?n.getReviewCtxInformation():{},o=a?a.reviewId:null,r=[];this.pad3DViewer.getApplicativeData().getLoadedItfData&&(r=this.pad3DViewer.getApplicativeData().getLoadedItfData().data),this.pad3DViewer.getApplicativeData().removeDIFAnnotSetKeepPrd&&e.customitem2remove.forEach((e=>{this.pad3DViewer.getApplicativeData().removeDIFAnnotSetKeepPrd(e)})),e.customitem2remove.indexOf(o)>-1&&require(["DS/DMUBaseExperience/DMUContextManager"],(function(e){e.removeReviewContext({context:v.viewer});let t=e.giveEventsController({viewer:v.viewer.getViewer()});t&&t.fireEvent("onDMURemoveSessionReview")})),r.forEach((function(t){(t.metricID.length?t.metricID:[t.isrID]).some((function(i){if(e.customitem2remove.indexOf(i)>-1)return this.pad3DViewer.getApplicativeData().removeIsrKeepContext(t.isrID),!0}),this)}),this),i.forEach((function(t){e.customitem2remove.indexOf(t)>-1&&this.pad3DViewer.removeRoots({pids:[t]})}),this)}}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/LandingPage/removeFromStore"},function(e){if(e&&e.customitem2remove&&e.customitem2remove.length){var t=w.call(this),i=[];e.customitem2remove.forEach((function(e){D.some((function(n){if(t[n.key]&&t[n.key][e]&&-1===i.indexOf(e))return i.push(e),delete t[n.key][e],!0}))})),this.params.widget.setValue("xsceneStoredObjects",JSON.stringify(t)),s.publish({event:"ENXViews/LandingPage/removeFromView",data:{customitem2remove:i}})}}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelHighlights"},function(){l.launchSearch({title:p.highlights,precondition:'flattenedtaxonomies:"types/DMUValidationExposedPresentation"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelRvw"},function(){l.launchSearch({title:p.rvw,precondition:'flattenedtaxonomies:"types/DMUValidationValidation"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelIsr"},function(){l.launchSearch({title:p.isr,precondition:'flattenedtaxonomies:"types/SIMItfSimulation"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelItf"},function(){l.launchSearch({title:p.itf,precondition:'flattenedtaxonomies:"types/PLMPIMMetricReference"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDrw"},function(){l.launchSearch({title:p.drw,precondition:'flattenedtaxonomies:"types/Drawing"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFLayout"},function(){l.launchSearch({title:p.difLayout,precondition:'flattenedtaxonomies:"types/DIFLayout"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFSheet"},function(){l.launchSearch({title:p.difSheet,precondition:'flattenedtaxonomies:"types/DIFSheet"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelFailureModesEffectsAnalysis"},function(){l.launchSearch({title:p.difSheet,precondition:'flattenedtaxonomies:"types/FailureModesEffectsAnalysis"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFAnnotationSet"},function(){l.launchSearch({title:p.difAnnotSet,precondition:'flattenedtaxonomies:"types/DIFAnnotationSet"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDocument"},function(){l.launchSearch({title:p.doc,precondition:'flattenedtaxonomies:"types/Document"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelRequirement"},function(){l.launchSearch({title:p.req,precondition:'flattenedtaxonomies:"types/Requirement"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelRequirementSpec"},function(){l.launchSearch({title:p.reqSpec,precondition:'flattenedtaxonomies:"types/Requirement Specification"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelMsr"},function(){l.launchSearch({title:p.msr,precondition:'flattenedtaxonomies:"types/DesignSight"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomPanelPrefCmd"},function(){require(["DS/CATWebUXComponents/DMUCommandsManager","DS/CATWebUXPreferences/CATWebUXPreferencesManager"],function(e,t){let i=t.givePreferenceManager({context:this.pad3DViewer.getFrameWindow()});if(i)var n=i.subscribe("onPreferencesPanelDestroyed",function(){i.unsubscribe(n),this.showWelcomePanel(!0)}.bind(this));this.showWelcomePanel(!1),e&&e.getCommand("CATWebUXPreferencesHdr",this.pad3DViewer&&this.pad3DViewer.getCommandContext?this.pad3DViewer.getCommandContext():null).begin()}.bind(this))}.bind(this))),"R3V"===m&&this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomPanelNewActivity"},function(){var e=r.getCommand("DMUReviewHdr",this.pad3DViewer.getCommandContext());this.showWelcomePanel(!1),e.begin()}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/userAssistance"},(function(){let e=require("DS/WebUAUtils/WebUAUtils");window.open(e.getHelpFullPath("R3V"===m?p.userAssistanceURL_R3V:p.userAssistanceURL_R3R))}))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/whatsNew"},(function(){let e=require("DS/WebUAUtils/WebUAUtils");window.open(e.getEmbeddedHelpFullPath("R3V"===m?p.whatsNewURL_R3V:p.whatsNewURL_R3R))})));var t=l.getDefaultActivities();t.activities[0].section.actions.splice(2,0,{id:"welcomePanelRvw",title:p.rvw,icon:"review"}),t.activities[0].section.actions.splice(3,0,{id:"welcomePanelHighlights",title:p.highlights,icon:"highlight-review"}),t.activities[0].section.actions.splice(6,0,{id:"welcomePanelDIFAnnotationSet",title:p.difAnnotSet,icon:"annotation"}),t.activities[0].section.actions.splice(7,0,{id:"welcomePanelIsr",title:p.isr,icon:"interference-simulation"}),t.activities[0].section.actions.splice(8,0,{id:"welcomePanelItf",title:p.itf,icon:"interference-metric"}),t.activities[0].section.actions.splice(9,0,{id:"welcomePanelMsr",title:p.msr,icon:"physics-simulation"}),t.activities[0].section.actions.splice(10,0,{id:"welcomePanelDrw",title:p.drw,icon:"drawing"}),t.activities[0].section.actions.splice(11,0,{id:"welcomePanelRequirementSpec",title:p.reqSpec,icon:"requirement-specification"}),t.activities[0].section.actions.splice(12,0,{id:"welcomePanelRequirement",title:p.req,icon:"requirement"}),t.activities[0].section.actions.splice(13,0,{id:"welcomePanelDIFLayout",title:p.difLayout,icon:"fl-diagrams"}),t.activities[0].section.actions.splice(14,0,{id:"welcomePanelDIFSheet",title:p.difSheet,icon:"fl-diagram"}),t.activities[0].section.actions.splice(14,0,{id:"welcomePanelFailureModesEffectsAnalysis",title:p.fmea,icon:"fmea"}),t.activities[0].section.actions.splice(15,0,{id:"welcomePanelDocument",title:p.doc,icon:"doc"}),"R3V"===m&&t.activities.push({section:{id:"NewActivitySection",title:p.startNewActivity,actions:[{id:"welcomPanelNewActivity",title:p.newReview,icon:"review"}]}}),t.activities.push({section:{id:"customizeAppSection",title:p.customApp,actions:[{id:"welcomPanelPrefCmd",title:p.prefs,icon:"cog"}]}}),t.activities.push({section:{id:"contentAndKnowledge",title:p.contentAndKnowledge,actions:[{id:"userAssistance",title:p.userAssistance,icon:"help"},{id:"whatsNew",title:p.whatsNew,icon:"megaphone"}]}}),this.welcomePanel=new l({widget:e.widget,readOnlyApp:!1,renderDiv:e.renderDiv,externalViewerMgt:!0,externalViewerMgtCB:function(e,t){!0!==t&&this.showWelcomePanel("viewer"!==e)}.bind(this),globalSearchPrecond:'flattenedtaxonomies:"types/DMUValidation" OR flattenedtaxonomies:"types/DMUValidationExposedPresentation" OR flattenedtaxonomies:"types/SIMItfSimulation" OR flattenedtaxonomies:"types/PLMPIMMetricReference" OR flattenedtaxonomies:"types/DIFLayout" OR flattenedtaxonomies:"types/DIFSheet" OR flattenedtaxonomies:"types/DIFAnnotationSet" OR flattenedtaxonomies:"types/VPMReference" OR flattenedtaxonomies:"types/VPMRepReference" OR flattenedtaxonomies:"types/ENOStrRefinementSpecification" OR (flattenedtaxonomies:"types/Document" AND [ds6w:docextension]:(pdf OR dxf OR dwg)) OR flattenedtaxonomies:"types/Requirement" OR flattenedtaxonomies:"types/Requirement Specification" OR flattenedtaxonomies:"types/FailureModesEffectsAnalysis"',defaultActionId:t.defaultActionId,activities:t.activities,onLandingPageReady:e.onLandingPageReady})}var R,A,P,V;M.prototype={constructor:M,initialize:function(){var e=this.welcomePanel.initialize();return e.then(function(){var e=w.call(this),t=Array.prototype.concat.apply([],D.map((function(t){return Object.keys(e[t.key]||[])})));y.call(this,t)}.bind(this)),e},setViewer:function(e){this.pad3DViewer=e,!this.params.initApp&&this.showWelcomePanel(!1);var t=e.render().getContent(),i=t.parentNode;t.style.position="relative",!this.params.renderDiv.parentNode&&i&&i!==this.params.renderDiv&&i.insertBefore(this.params.renderDiv,i.firstChild),this.params.renderDiv.insertBefore(t,this.params.renderDiv.firstChild),this.welcomePanel&&(this.params.renderDiv.insertBefore(this.welcomePanel.elements.mainBody,this.params.renderDiv.firstChild),this.welcomePanel.setViewer(e,!this.params.initApp)),this.tokensPAD.push(e.subscribe({event:"onRootAdded"},function(t){var i=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),n=t.id,a=e.getController().getNode({id:n}),o=i.getNodeType(a);if("R2V_Activity"===o){var r=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),l=window.document.getElementsByClassName("DMULoadingPanel");r.length&&(r[0].dsModel.off(),r[0].dsModel.destroy(),r=null),l.length&&l[0].destroy()}let s,d=g.getLoadingContextController({context:e});if(d&&(s=d.getSubContextInformations(n)),"R2V_Activity"===o||"DesignSight"===o||"DIFLayout"===o||"DIFSheet"===o||"Document"===o||"Specification Report"===o||"Requirement"===o||"Requirement Specification"===o){"DesignSight"===o?this.params.widget.setValue("mkpSession",JSON.stringify({type:"msr",plmType:o,id:n})):"Specification Report"===o?(n=s?s.id:n,o=s?s.type:o):(this.params.widget.setValue("mkpSession",JSON.stringify({type:"Document"===o||"Specification Report"===o||"Requirement"===o||"Requirement Specification"===o?o:"2D",plmType:o,id:n})),"Specification Report"===o&&(n=s?s.id:n,o=s?s.type:o));var c=w.call(this);c[o="DIFLayout"===o?"difLayout":"DIFSheet"===o?"difSheet":"Requirement"===o?"req":"Requirement Specification"===o?"reqSpec":"DesignSight"===o?"msr":"R2V_Activity"===o?"pointClouds":"VPMReference"===o?"products":"doc"]||(c[o]={}),c[o][n]={},this.params.widget.setValue("xsceneStoredObjects",JSON.stringify(c)),this.showWelcomePanel(!1),y.call(this,[n])}}.bind(this))),this.tokensPAD.push(e.subscribe({event:"onRootRemoved"},function(t){let i=g.getLoadingContextController({context:e});i&&i.removeSubContextInformations(t.id);var n=w.call(this);["difLayout","difSheet","doc","req","reqSpec","msr"].some((function(e){return n[e]&&n[e][t.id]}))&&(y.call(this,[t.id]),this.params.widget.deleteValue("mkpSession"))}.bind(this))),require(["DS/DMUBaseExperience/DMUContextManager"],function(t){var i=t.getEventsController({viewer:e.getViewer()});this.tokensMkp.push(i.addEvent("onReviewCtxInformationChanged",function(e){var t=w.call(this);t.rvw||(t.rvw={}),t.highlight||(t.highlight={}),"DMUValidationValidation"===e.reviewType?t.rvw[e.reviewId]={}:"DMUValidationExposedPresentation"===e.reviewType&&(t.highlight[e.highlightId]={}),this.params.widget.setValue("xsceneStoredObjects",JSON.stringify(t)),y.call(this,[e.reviewId])}.bind(this))),this.tokensMkp.push(i.addEvent("onReviewRemoved",function(e){var t=w.call(this);e&&t.rvw&&t.rvw[e.reviewId]&&y.call(this,[e.reviewId]),e&&e.highlightId&&t.highlight&&t.highlight[e.highlightId]&&y.call(this,[e.highlightId]),this.params.widget.deleteValue("reviewIdInSession")}.bind(this)))}.bind(this))},appReady:function(e){if(this.reviewCtrl=e,this.isAppReady=!0,this.params.initApp){let s=this.params.widget.getValue("X3DContentId"),d=this.params.widget.id.indexOf("preview")>-1,c=this;if(this.params.widget.deleteValue("X3DContentId"),s)e.appInitFromTransition({x3dContent:JSON.parse(s),onNoActionDone:function(){setTimeout((function(e){var t=JSON.parse(s);c.showWelcomePanel(!1),(t.data&&t.data.items||[]).forEach((function(e){("Drawing"===e.objectType||e.objectTaxonomies&&e.objectTaxonomies.indexOf("Drawing")>-1)&&delete e.path})),t.data&&t.data.items&&t.data&&t.data.items.length&&o.callSpecReportData(e,t,!0)}),0,this.pad3DViewer)}.bind(this)});else if(!0===this.params.widget.getValue("autoreload")||!0===this.params.widget.getValue("autoreloadPreviewApp")&&!d){var t=this.params.widget.getValue("reviewIdInSession");if(t){var i=JSON.parse(t);"_DMUValidationExposedPresentation"===i.objectType?C.call(this,[{id:JSON.parse(t),type:"DMUValidationExposedPresentation"}]):"_DMUValidationValidation"===i.objectType?C.call(this,[{id:JSON.parse(t),type:"DMUValidationValidation"}]):C.call(this,[{id:JSON.parse(t),type:"Markup"}])}else{var n=this.params.widget.getValue("mkpSession");if((n=n?JSON.parse(n):null)&&"ITF"===n.type){var a=this.params.widget.getValue("ItfSimuInSession");if((a=a?JSON.parse(a):null)&&!Array.isArray(a)&&"object"==typeof a){var r=Object.keys(a);if(1===r.length){var l=r[0];Array.isArray(a[l])&&a[l].length?C.call(this,a[l].map((function(e){return{id:e,type:"PLMPIMMetricReference"}}))):C.call(this,[{id:l,type:"SIMItfSimulation"}])}}}else n&&n.id&&("2D"===n.type||"Document"===n.type||"msr"===n.type)&&C.call(this,[{id:n.id,type:n.plmType}])}}d?this.params.widget.setValue("autoreloadPreviewApp",!0):this.params.widget.deleteValue("autoreloadPreviewApp")}var s=this.welcomePanel.appReady();return this.welcomePanel.redraw(),s},dispose:function(){if(this.showWelcomePanel(!1),this.welcomePanel){var e=require("DS/DMUBaseExperience/DMUContextManager").getEventsController({viewer:this.pad3DViewer.getViewer()});this.tokensMkp.forEach(e.removeEvent,e),this.tokensMkp=[],this.tokensPAD.forEach(this.pad3DViewer.unsubscribe,this.pad3DViewer),this.tokensPAD=[],this.pad3DViewer=this.params=null,this.tokensWelcomePanel.forEach(s.unsubscribe,s),this.tokensWelcomePanel.length=0;var t=this.welcomePanel.dispose();return this.welcomePanel=null,t}},showWelcomePanel:function(e){this.welcomePanel&&(this.welcomePanel.elements.mainBody.style.position="relative",this.welcomePanel.elements.mainBody.style.display=e?"":"none",e&&this.welcomePanel.redraw())}};var U,I="CATCmdWorkbench",x=i.getOption("testWkb");function E(){return v.widget.getValue(I)}function k(e){v.widget.setValue(I,e)}function O(){let e;var t=n.getRoots(v.viewer);let i=g.getLoadingContextController({context:v.viewer});i&&t.length&&(e=i.getSubContextInformations(t[0].getIdentificationObject())),e&&e.label?v.widget.setTitle(e.label):v.viewer.getContentName({callbacks:{onComplete:function(e){v.widget.setTitle(e.contentName)},onFailure:function(){}}})}var F=[],T=function(e){F.push(e),1===F.length&&function e(t){var i={lastCommand:[],currentCommand:null,defaultCommand:null},n=v.viewer.getCommandContext?v.viewer.getCommandContext():null;n?r._commandsState[n]=i:r._commandsState=i,r.resetDefaultCommand(n),r._isCommandEnding=!1,r._ignoreCommandBeginWhileEndingCommand=!1,["_commands","_cmdCheckHeader"].forEach((function(e){var t=n?r[e][n]:r[e];Object.keys(t).forEach((function(e){var i=t[e];i&&i._destroy&&i._destroy(),delete t[e]}))}));var a=0,o=t.viewer.getFrameWindow().getActionBar(),l=o.onActionBarReady((function(){++a<t.afr.wkb.length&&t.merge?t.viewer.loadActionBar({merge:!0,file:t.afr.wkb[a].file,module:t.afr.wkb[a].module}):(o.removeCallback(l),t.viewer.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClicAfterCSOChange(),r.setDefaultCommand({ID:"R3R"===m?"DMUReviewWebAppDefaultHdr":"DMUValidationWebAppDefaultHdr",className:"R3R"===m?"DS/DMUReviewWebApp/DMUReviewWebAppDefaultCmd":"DS/DMUValidationWebApp/DMUValidationWebAppDefaultCmd",context:n}),t.actionBarReadyCb&&t.actionBarReadyCb(),t.options&&t.options.done({appMainDiv:P,pad3DViewer:t.viewer})),t.merge&&a!==t.afr.wkb.length||(F.shift(),F.length&&e(F[0]))}));t.viewer.loadActionBar({merge:!1,file:t.afr.wkb[0].file,module:t.afr.wkb[0].module})}(F[0])};async function _(e){e&&(e.subscribe("onReviewContextModified",(function(e){if("ReviewNoContext"===e.type){var t=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),i=window.document.getElementsByClassName("DMULoadingPanel");t.length&&(t[0].dsModel.off(),t[0].dsModel.destroy(),t=null),i.length&&i[0].destroy()}var n=e.onABReady?e.onABReady:function(){},a=E();if("Specification Report"===e.type&&(e.type="Document"),"Data"===e.type){if("3D"===e.data.wkb){for(var o=!1,l=0;l<U.wkb3D.wkb.length;l++)U.wkb3D.wkb[l].file===e.data.file&&U.wkb3D.wkb[l].module===e.data.module&&(o=!0);if(o){let e=v.viewer.getCommandContext?v.viewer.getCommandContext():null;r.setDefaultCommand({ID:"R3R"===m?"DMUReviewWebAppDefaultHdr":"DMUValidationWebAppDefaultHdr",className:"R3R"===m?"DS/DMUReviewWebApp/DMUReviewWebAppDefaultCmd":"DS/DMUValidationWebApp/DMUValidationWebAppDefaultCmd",context:e})}else U.wkb3D.wkb.push({file:e.data.file,module:e.data.module}),"3D"===a&&T({merge:!0,afr:x?U.wkb3DTst:U.wkb3D,viewer:v.viewer,actionBarReadyCb:n})}}else if("RefreshAB"===e.type)T({merge:!0,afr:U["wkb"+a],viewer:v.viewer,actionBarReadyCb:n});else if("ITF"===e.type||"MSR"===e.type||"R2V"===e.type||"Document"===e.type||"Requirement"===e.type||"Requirement Specification"===e.type||U["wkb"+e.type])if(e.type!==a)T({merge:!0,afr:U["wkb"+e.type+(x&&U["wkb"+e.type+"Tst"]?"Tst":"")],viewer:v.viewer,actionBarReadyCb:n}),e.type.contains("Formats")||k(e.type);else{let e=v.viewer.getCommandContext?v.viewer.getCommandContext():null;r.setDefaultCommand({ID:"R3R"===m?"DMUReviewWebAppDefaultHdr":"DMUValidationWebAppDefaultHdr",className:"R3R"===m?"DS/DMUReviewWebApp/DMUReviewWebAppDefaultCmd":"DS/DMUValidationWebApp/DMUValidationWebAppDefaultCmd",context:e})}"ITF"===e.type?v.widget.setValue("mkpSession",JSON.stringify({type:e.type})):"Data"===e.type&&v.widget.deleteValue("mkpSession")})),await e.setActiveState(!0))}var W,L,N,j=function(){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/PADUtils/PADCommandProxy"],(function(e,t){(W=e).renderDiv||W.initialize2(v.viewer.getFrameWindow().getViewerFrame(),t.appId(),v.widget.getValue("changeControlActivation")?"show":"hide","top-right",(function(){W.addEvent("onAuthoringCtxVisible",(function(e){e.showAuthoringContext&&v.widget.setValue("changeControlActivation",!0)}))}))}))},B=function(e){require(["DS/PADUtils/PADCommandProxy","DS/PADUtils/PADSharedSettings","DS/DMUBaseExperience/DMUContextManager","i18n!DS/PADUtils/assets/nls/PADUtils"],(function(t,n,o,r){var l,s=[],d=[];N=function(){v.widget.setPreferences([]),l.destroy(),s.forEach((function(e){e.cb&&a.removeEvent(e.cb,e.padFct)})),N=function(){}},L=function(){if(s.forEach((function(e){var t=e.preference.name,i=v.widget.getValue(t),n=a.getSetting(t);(i="boolean"===e.preference.type&&"boolean"!=typeof i?"true"===i:i)!==n&&a.setSetting(t,i),e.fct&&e.fct(i)})),a.updateWidgetPreferences(),!l&&s.length){let e=o.giveEventsController({viewer:v.viewer.getViewer()});l=t.create({events:{onPreferenceModification:function(e){s.some((function(t){if(e.name===t.preference.name){if("boolean"!=typeof e.value&&"string"!=typeof e.value)throw new Error("Value must be a string or a boolean");if(a.getSetting(e.name)!==e.value){if("boolean"===t.preference.type&&"boolean"!=typeof e.value)throw new Error("Preference is a boolean type so value must be a boolean");t.debounce=!0,v.widget.setValue(e.name,e.value),a.setSetting(e.name,e.value)}return t.fct&&t.fct(e.value),!0}}))},onSelect:function(t){e&&e.fireEvent("onCrossWidgetSelection",t)}}}),v.widgetLink&&v.widgetLink.subscribe("DS/ExternalWdgtCom/Find",(t=>{e&&e.fireEvent("onCrossWidgetFind",t)})),e&&(e.addEvent("onFireCrossWidgetSelection",(e=>{l&&l.select(e)})),e.addEvent("onFireCrossWidgetFind",(e=>{e&&e.paths&&e.paths.length&&v.widgetLink&&v.widgetLink.publish("DS/ExternalWdgtCom/Find",{paths:e.paths})}))),s.forEach((function(e){e.cb&&a.addEvent(e.cb,e.padFct=function(t){e.debounce?e.debounce=!1:l.preferenceModification({name:e.preference.name,value:t})})}))}},v.widget.setPreferences([]),a.setSetting("syncAutoReload",!0),n.destroy(),n.addSharedSettings(v.widget),s.push({preference:{name:"changeControlActivation",type:"boolean",label:r.changeControlActivation_label,defaultValue:!1},fct:function(e){W&&W[e?"show":"hide"]()},cb:"onChangeControlActivation",debounce:!1}),s.push({preference:{name:"changeControlPosition",type:"list",label:r.changeControlPosition_label,defaultValue:"top-right",options:[{label:r["top-right_label"],value:"top-right"},{label:r["top-left_label"],value:"top-left"},{label:r["bottom-left_label"],value:"bottom-left"},{label:r["bottom-right_label"],value:"bottom-right"}]},fct:function(e){W&&W.setPosition(e)}}),a.setSetting("authorizeChangeControl",!0),e&&j(),i.getOption("debug")?(s.push({preference:{name:"populateTags",type:"boolean",label:r.activateFilter_label,defaultValue:!1},fct:function(e){var t=v.viewer.getBIController();t&&t.toggleBetweenStandaloneAndSlaveMode(e?"STANDALONE":"SLAVE")}}),s.push({preference:{name:"webapi_timeout",type:"text",label:"Query timeout",defaultValue:"60000"}})):d=["populateTags","webapi_timeout"],d.forEach((function(e){v.widget.deleteValue(e)})),d.length=0,s.forEach((function(e){v.widget.mergePreferences([e.preference])})),L(),require(["i18n!DS/ENOPAD3DViewer/assets/nls/PAD3DViewer"],(e=>{v.widget.addEvent("onChangeFlexibleAssembliesSupport",(function(e,t){a.setSetting(e,t)}));var t=a.getSetting("enopad3dviewer_roles");let i=!0,n=require("DS/PADUtils/PADUtilsServices").isCloud(),o=require("DS/PADUtils/PADSession").isAuthoring();for(var r=0;r<t.length;r++)if("E19"===t[r].id&&(!t[r].platforms||t[r].platforms&&t[r].platforms.indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)){i=!1;break}!i||n||o?(v.widget.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"hidden",defaultValue:!1,label:e.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:!1}),a.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",!1)):v.widget.getPreference("enopad3dviewer_flexibleAssemblySupportActivated")||(v.widget.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"boolean",defaultValue:!1,label:e.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:void 0!==v.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated")&&v.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated")}),a.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",v.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated"))),a.setSetting("enopad3dviewer_staticMappingSupportActivated",!o)})),v.widget.addEvent("endEdit",L)}))},q=function(e){e.unsubscribe(A),A=null,O(),j(),require("DS/PADUtils/PADUtilsServices").isCloud()&&!window.__preventPrefPanel&&e.getViewer().displayIntroductoryControlPreferencePanel(),v.widget.getValue(I)||v.widget.addPreference({name:I,type:"hidden"});var t=!1,i=async function(){if(t){var i=R.getController({context:e});await _(i),V.appReady(i)}else t=!0};require([v.controller],(function(e){R=e,i()})),setTimeout((function(){"1"===v.widget.getValue("widgetForODTReplay")&&(v.widgetViewer3DReview._viewer3DReview=e),v.widget.dispatchEvent("onWidgetAndAppReady","1"===v.widget.getValue("widgetForODTReplay")?[{pad3DViewer:v.viewer}]:void 0),i()})),v.viewerAttachment&&v.viewerAttachment(P),v.viewerAttachment=null,e.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClicAfterCSOChange()};function H(t){return P||(P=e.createElement("div",{class:"appMain",styles:{width:"auto",height:"100%"}})),(V=new M({widget:v.widget,readOnlyApp:!1,renderDiv:P,initApp:t&&t.initApp,onLandingPageReady:t&&t.onLandingPageReady})).initialize()}function X(e){e&&"string"==typeof e.reviewId&&v.widget.setValue("reviewIdInSession",JSON.stringify(e))}function G(){var e=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),t=window.document.getElementsByClassName("DMULoadingPanel");e.length&&(e[0].dsModel.off(),e[0].dsModel.destroy(),e=null),t.length&&t[0].destroy()}function J(){if(a&&(a.setSetting("activateWidgetLink",!0),a.setSetting("useNewUXGuidelinesWP",!0)),!v.viewer){v.widget.deleteValue("reviewIdInSession");var e=new Promise((function(e){require(["DS/PADUtils/PADSharedSettings"],(t=>{t.addSharedSettings(v.widget,["showWelcomePanel"]),H({initApp:!0,onLandingPageReady:function(){v.viewerAttachment(P),v.viewerAttachment=null}}).then(e)}))})),t=new Promise((function(e){require(["DS/ENOPAD3DViewer/PAD3DViewer","text!DS/DMUReviewCommonWebApp/assets/DMUCommonWebApp.json"],(function(t,i){e([t,i])}))})),i=new Promise((e=>{require(["DS/ENOXInterWdgCom/LinkManager"],(t=>{v.widgetLink=t,t.initializeWidgetLink(v.widget,{appIds:[],uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXEnrich","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXEnrich","ENXLandingPageSync"],open:!0}).then(e)}))}));Promise.all([e,t,i]).then((function(e){var t=JSON.parse(e[1][1]);t.context="Default",t.mouseProfile=require("DS/PADUtils/PADUtilsServices").isCloud()?window.__mouseProfile:"CATIA";var i=E();t.workbenchModule="2D"===i||"ITF"===i||"MSR"===i||"R2V"===i||"Document"===i||"2DFL"===i||"Requirement"===i||"Requirement Specification"===i||"ReviewNoContext"===i?U["wkb"+i].wkb[0].module:U.wkb3D.wkb[0].module,t.workbench="2D"===i||"ITF"===i||"MSR"===i||"R2V"===i||"Document"===i||"2DFL"===i||"Requirement"===i||"Requirement Specification"===i||"ReviewNoContext"===i?U["wkb"+i].wkb[0].file:U.wkb3D.wkb[0].file;var n={widget:v.widget,windowOptions:t,enableFiltering:!0,binaryPrimitives:!0,enableSidePanel:!0,readyCB:B,authorizedRootTypes:["MCAD Assembly","MCAD Component","VPMReference","VPMRepReference"],visuProgressiveTileModel:!0};n.windowOptions.allowDnD=!1;var r=v.viewer=new e[1][0](n);c.init(r),t.mouseProfile&&r.getViewpoint().setDefaultController(!0,t.mouseProfile),V.setViewer(r);var l=a.getSetting("propertiesFacet"),s=d.getMapping();s&&(s.physicssimulation.alwaysVisible=!1,l.push(s.physicssimulation)),r.setOption("propertiesFacet",l),r.setAuthorizedRootTypes(a.getSetting("ups_authorized_root_types")),A=r.subscribe({event:"onReady"},q),r.subscribe({event:"onRootAdded"},O),r.subscribe({event:"onRootRemoved"},O),r.subscribe({event:"onRootAttached"},O),r.subscribe({event:"onRootDetached"},O),r.subscribe({event:"onContentNameModified"},O),o.initViewerDnd(r,S),localStorage.getItem("defaultSelectedTypeData")||localStorage.setItem("defaultSelectedTypeData","product"),a.setSetting("settypes",!0),a.setSetting("syncAutoReload",!0),"1"===v.widget.getValue("widgetForODTReplay")&&v.widget.dispatchEvent("onPAD3DViewerCreated",[{pad3DViewer:r}]),v.widgetInitDone&&v.widgetInitDone({appMainDiv:P,pad3DViewer:r})}))}}async function z(){if(function(){var e=a.getSetting("enopad3dviewer_roles");let t=!0,i=require("DS/PADUtils/PADUtilsServices").isCloud(),n=require("DS/PADUtils/PADSession").isAuthoring();for(var o=0;o<e.length;o++)if("E19"===e[o].id&&(!e[o].platforms||e[o].platforms&&e[o].platforms.indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)){t=!1;break}a.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",t&&!i&&!n),a.setSetting("enopad3dviewer_staticMappingSupportActivated",!n)}(),v.viewer){var e=v.widget.getValue("reviewIdInSession");e=e?JSON.parse(e):void 0,v.viewer.refresh();var t,i,o=n.getRoots(v.viewer),r=!1,l=[];for(let e=0;e<o.length;e++)if(""!==n.getNodeID(o[e])&&(t=n.getNodeID(o[e]),i=n.getNodeType(o[e]),(l=await S(i)).includes("Document")||l.includes("Specification Report")||l.includes("Requirement")||l.includes("Requirement Specification"))){r=!0;break}var s=function(e){X(e);let i=v.widget.getValue("reviewIdInSession");t&&R&&R.giveController({context:v.viewer}).loadReviewAfterRefresh(JSON.parse(i))};if(r)var d=v.viewer.subscribe({event:"onRefreshCompleted"},(function(){v.viewer.unsubscribe(d),e&&s(e)}));else if(l.includes("DesignSight")||l.includes("DIFSheet")||l.includes("DIFLayout"))v.viewer.publish({event:"widgetReresh",data:{objectId:t,objectType:i}});else if(l.includes("R2V_Activity")){if(!1===v.viewer.getSoIUsability()){v.viewer.toggleSOITimelinesUsability(!0);var c=v.viewer.subscribe({event:"onR2VLoaded"},(function(){v.viewer.getSoIUsability()&&v.viewer.toggleSOITimelinesUsability(!1),v.viewer.unsubscribe(c),c=null}))}}else if(e)var u=v.viewer.subscribe({event:"onLoadingComplete"},(function(){v.viewer.unsubscribe(u),s(e)}))}}function K(){if(R){var e=R.giveController({context:v.viewer});e&&e.refreshContext()}}function Q(){V&&V.dispose(),V=null,v.viewer&&(R&&R.unreferenceController({context:v.viewer}),v.viewer.destroy()),v={widget:null,viewer:null,viewerAttachment:null},R=null}function Y(e){v.viewer&&v.viewer.search({searchQuery:e})}var Z=function(e){if(v.widget=e.widget,P=e.appMainDiv,v.widgetInitDone=e.done,v.data=e.data.wkb?e.data.wkb:e.data,v.controller=e.data.controller?e.data.controller:e.controller,U=e.data.wkb?e.data.wkb:e.data,m=e.data.appId?e.data.appId:e.appId,e.pad3DViewer){v.viewer=e.pad3DViewer,c.init(v.viewer);var t=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:e.pad3DViewer}),i=t?t.getReviewCtxInformation():null;i&&i.reviewId&&X(i.reviewId)}else e.viewerAttachment?(v.viewerAttachment=e.viewerAttachment,J()):(v.viewerAttachment=function(e){v.widget.setBody(e)},v.widget.addEvent("onLoad",J)),v.widget.addEvent("endEdit",K),v.widget.addEvent("onRefresh",z),v.widget.addEvent("onDestroy",Q),v.widget.addEvent("onSearch",Y),"1"===v.widget.getValue("widgetForODTReplay")&&(v.widgetViewer3DReview=this),v.widget.addEvent("onDMUReviewLoaded",X),v.widget.addEvent("onDMUValidationLoadFailed",G),v.widget.setMetas({helpPath:"DMUReviewWebApp/assets/help"})};return Z.prototype.setUp=function(e){function t(){require([v.controller],(function(t){var i=(R=t).getController({context:v.viewer});(async()=>{await _(i),H().then((function(){V.setViewer(v.viewer),V.appReady(i)})),e.sourceApp&&e.sourceApp.issues&&1===e.sourceApp.issues.length&&i.appInitFromTransition({issues:e.sourceApp.issues,onNoActionDone:function(){}})})()}))}e.sourceApp&&e.sourceApp.pad3DViewer!==v.viewer&&(v.viewer=e.sourceApp.pad3DViewer,c.init(v.viewer)),require("DS/ENOXInterWdgCom/LinkManager").updateLinkability({appIds:[],open:!0,uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXEnrich","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXEnrich","ENXLandingPageSync"]}),a.setSetting("activateWidgetLink",!0),a.setSetting("useNewUXGuidelinesWP",!0),v.widget.addEvent("onRefresh",z),v.widget.addEvent("onSearch",Y),v.widget.addEvent("onDMUReviewLoaded",X),v.widget.setMetas({helpPath:"DMUReviewWebApp/assets/help"}),e.sourceApp&&e.sourceApp.pad3DViewer!==v.viewer&&(v.viewer=e.sourceApp.pad3DViewer),c.init(v.viewer);var i=a.getSetting("propertiesFacet"),o=d.getMapping();o&&o.physicssimulation&&o.physicssimulation.facet&&(i.find((function(e){return!(!e||!e.facet||e.facet.name!==o.physicssimulation.facet.name)}))||(o.physicssimulation.alwaysVisible=!1,i.push(o.physicssimulation))),v.viewer.setOption("propertiesFacet",i),v.viewer.getBIController().toggleBetweenStandaloneAndSlaveMode("DUAL"),B(v.viewer),v.viewer.getViewer().updateViewPanelUIConfiguration&&v.viewer.getViewer().updateViewPanelUIConfiguration({useShadingIllustration:!1,useOutline:!1}),O(),"3D"===E()||n.getRoots(v.viewer).length>0?(T({options:e,merge:!1,afr:U.wkb3D,actionBarReadyCb:t,viewer:v.viewer}),"2D"!==E()&&"Document"!==E()&&v.viewer.getViewer().set2DMode(!1),k("3D")):"2DFL"===E()?(T({options:e,merge:!1,afr:U.wkb2DFL,actionBarReadyCb:t,viewer:v.viewer}),k("2DFL")):"ReviewNoContext"===E()?(T({options:e,merge:!1,afr:U.wkbReviewNoContext,actionBarReadyCb:t,viewer:v.viewer}),k("ReviewNoContext")):(T({options:e,merge:!1,afr:U.wkb2D,actionBarReadyCb:t,viewer:v.viewer}),k("2D")),a.setSetting("dynamic_authorized_types",!0);var r=a.getSetting("unsupported_root_types");r.push("Drawing"),a.setSetting("unsupported_root_types",r)},Z.prototype.dispose=function(e){if(a.setSetting("dynamic_authorized_types",!1),v.widget.removeEvent("onRefresh",z),v.widget.removeEvent("onSearch",Y),v.widget.removeEvent("endEdit",L),v.widget.removeEvent("onDMUReviewLoaded",X),N&&N(),V&&V.dispose(),V=null,v.viewer){var t=a.getSetting("propertiesFacet"),i=d.getMapping();if(i){var n=t.findIndex((function(e){return!(!e||!e.facet||e.facet.name!==i.physicssimulation.facet.name)}));n>=0&&t.splice(n,1)}v.viewer.setOption("propertiesFacet",t),R&&R.unreferenceController({context:v.viewer,options:e})}U.wkb2D.wkb.length>1&&U.wkb2D.wkb.splice(1,U.wkb2D.wkb.length),U.wkb2DFL.wkb.length>1&&U.wkb2DFL.wkb.splice(1,U.wkb2DFL.wkb.length),U.wkb3D.wkb.length>1&&U.wkb3D.wkb.splice(1,U.wkb3D.wkb.length),U.wkb2DFormats.wkb.length>1&&U.wkb2DFormats.wkb.splice(1,U.wkb2DFormats.wkb.length),U.wkb2DFLFormats.wkb.length>1&&U.wkb2DFLFormats.wkb.splice(1,U.wkb2DFLFormats.wkb.length),U.wkb3DFormats.wkb.length>1&&U.wkb3DFormats.wkb.splice(1,U.wkb3DFormats.wkb.length),R=null},Z.prototype.onWillLeave=function(e){if(v.viewer){var t=require("DS/DMUBaseExperience/DMUContextManager");if(t){var i=t.giveEventsController({viewer:v.viewer.getViewer()});i&&i.fireEvent("onLeavingReviewApp",{targetApp:e&&e.options?e.options.id:""})}}},Z}));