define("DS/DELPPWProductFlowSequenceModule_FD02/GraphPanel",["UWA/Core"],(function(e){"use strict";return function(t,n){var o,i,r,a,c,s,d=n.getComponent("WUXFrameWindowsManager").getFrameWindow(t.getAppContext()),l=n.create("Element","div",{class:"EGraphView-panel-container"}),u=d.getImmersiveFrame(),f={};return o=function(){var e,t;i=n.create("Panel",{domId:r,identifier:"panel-EGraph"+r,position:{my:"center",at:"center"},title:a,immersiveFrame:u,content:l,minWidth:290,minHeight:250,width:700,height:400,snappableFlag:!1,resizableFlag:!0,closeButtonFlag:!0,useBordersFlag:!0,visibleFlag:!1,collapsibleFlag:!0,verticallyStretchableFlag:!0}),e=(window.screen.width-i.width)/2,t=(window.screen.height-i.height)/2,i.elements.container.style.left=e+"px",i.elements.container.style.top=t+"px",i.close=function(){c?c():i.hide()}},{init:function(t){f=e.extend(f,t),r=e.is(t.identifier)?t.identifier:"",a=e.is(t.title)?t.title:"",c=e.is(t.onClose,"function")?t.onClose:null,s=e.is(t.className)?t.className:""},destroy:function(){e.is(i)&&(i.destroy(),i=void 0)},show:function(){e.is(i)&&!1===i.visibleFlag&&i.show()},hide:function(){i.hide()},getContainer:function(){return l},buildSkeleton:function(){o(),l.addClassName(s)}}}})),define("DS/DELPPWProductFlowSequenceModule_FD02/ProductFlowComponent",["UWA/Core"],(function(e){"use strict";return function(t,n){var o,i,r,a,c,s,d,l,u,f,p,g,h,m,y,P,v,I,w,N,C,E,D,S,L,T,k,A,b,x,F,R,M,V,O,G,_,B,W,j,U,z,H,Y,X=t.getComponent("EGraphCore"),Q=t.getComponent("EGraphViews"),q=t.getComponent("EGraphIact"),K=t.getComponent("EGraphUtils"),$=t.getComponent("ContextualMenuManager"),Z=t.getComponent("TooltipModel"),J="SEQUENCE",ee="HIERARCHY",te=0,ne=!1,oe={},ie=[];return r=!!e.is(n.readOnly)&&n.readOnly,s=e.is(n.nodes)?n.nodes:[],d=e.is(n.links)?n.links:[],a=e.is(n.nodeOptions)?n.nodeOptions:[],l=e.is(n.identifier)?n.identifier:"",u=e.is(n.getNodeContextMenu,"function")?n.getNodeContextMenu:null,f=e.is(n.getLinkContextMenu,"function")?n.getLinkContextMenu:null,g=e.is(n.onConnectingNodes)?n.onConnectingNodes:null,F=e.is(n.onNodeDoubleClick,"function")?n.onNodeDoubleClick:null,B=e.is(n.onNodeSelectionChange,"function")?n.onNodeSelectionChange:null,i=function(){Q.HTMLNodeView.call(this)},o=function(e){Q.SVGEdgeView.call(this,e)},function(){}.prototype.onupdate=function(e){var t,n,o,i,r;t=e.cl1.c.aleft,i=e.cl1.c.atop,o=e.cl2.c.aleft,r=e.cl2.c.atop,n=.5*(t+o),e.set("path",[X.PathCmd.M,t,i,X.PathCmd.L,n,i,X.PathCmd.L,n,r,X.PathCmd.L,o,r])},o.prototype.createTextEdgeView=function(e,t,n){var o,i="http://www.w3.org/2000/svg";(o=document.createElementNS(i,"textPath")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.display.elt.id),o.setAttribute("startOffset","10%"),""===e.mark?o.appendChild(document.createTextNode("")):e.mark.hasOwnProperty(t)&&(o.appendChild(document.createTextNode(e.mark[t])),n++),this.display.text=document.createElementNS(i,"text"),this.display.text.setAttribute("dy",-14*(n-1)+12),this.display.text.grElt=e,K.classListAdd(this.display.text,"edge-text"),this.display.text.appendChild(o),""!==o.innerHTML&&this.structure.root.appendChild(this.display.text)},o.prototype.oncreateDisplay=function(e){var t,n=this,o=0;Q.SVGEdgeView.prototype.oncreateDisplay.apply(this,arguments),this.display.elt.id=Math.random(),this.display.elt.textContent="official",t="Type",Array.isArray(t)||(t=[t]),t.forEach((function(t){n.createTextEdgeView(e,t,o),o++}))},w=function(e){return/^(auto|0)$|^[+-]?[0-9]+.?([0-9]+)?(px|em|ex|%|in|cm|mm|pt|pc|rem)$/.test(e)},x=function(){return c===J},y=function(){var t=e.createElement("div",{class:"input-node my-node"}),n=e.createElement("img",{class:"my-node-type-img"}),o=e.createElement("div",{class:"my-node-container"}),i=e.createElement("div",{class:"my-node-col left"}),r=e.createElement("div",{class:"my-node-col right"}),a=e.createElement("div",{class:"myNodeLinkEdit"}),c=e.createElement("div",{class:"my-node-text"});return t.setStyles({width:"50px",height:"50px"}),c.setStyles({top:"0px"}),r.appendChild(c),t.appendChild(n),t.appendChild(o),t.appendChild(i),t.appendChild(r),t.appendChild(a),t},v=function(t,n){var o,i=n.grElt,a=n.clientPos[0],c=n.clientPos[1];e.is(i)&&!r&&(i.type===X.Type.NODE?(e.is(i.gr.selection.first)&&i.gr.selection.first.PID!==i.PID?(h.removeFromSelection(i.gr.selection.first),h.addToSelection(i)):null===i.gr.selection.first&&h.addToSelection(i),u&&(o=u(i.model))):i.type===X.Type.EDGE&&e.is(i.mark)&&f&&(o=f(i.mark)),e.is(o)&&(o=Array.isArray(o)?o:[o],Array.isArray(o)&&$.show({nodes:o},[a,c])))},L=function(e,t,n){var o;return 40,o=new X.Connector,!0===n&&(o.views.main=new Q.SVGConnView("egraph_views_SVGConnView egraph_views_mySVGConnView")),o.multiset(["cstr","attach"],e,["cstr","offset"],40),o},T=function(t){e.is(t.connectors)||(t.connectors={}),t.connectors.in=L(X.BorderCstr.LEFT,0,!0),t.connectors.in.id="in_"+t.id,t.appendConnector(t.connectors.in),t.connectors.out=L(X.BorderCstr.RIGHT,0,!0),t.connectors.out.id="out_"+t.id,t.appendConnector(t.connectors.out),c===ee&&(t.connectors.outInstance=L(X.BorderCstr.BOTTOM,0,!1),t.appendConnector(t.connectors.outInstance))},k=function(t,n,i){var r,a;return a="-productFlow",e.is(i.linkInfo.flowType)?a="-productFlow-"+i.linkInfo.flowType:e.is(i.linkInfo.subType)&&("DELLmiTimeConstraintCnx_FinishToStart"===i.linkInfo.subType||"DELLmiTimeConstraintCnx_StartToStart"===i.linkInfo.subType||"DELLmiTimeConstraintCnx_FinishToFinish"===i.linkInfo.subType)&&(a="-timeConstraint"),(r=new X.Edge).set("geometry",new X.AutoBezierGeometry),r.views.main=new o("egraph_views_SVGEdgeView my-sec-edge-view"+a),r.mark=i,h.addEdge(t,n,r),r},W=function(t,n){var o="";a.forEach((function(i){var r=Array.isArray(i)?i:[i],a=new e.Element("div",{class:"my-node-line"});r.forEach((function(n){var i,c,s=new e.Element("span",{class:"my-node-word"}),d="";n.fontSize&&w(n.fontSize)&&(c=n.fontSize),i=n.maxWidth&&w(n.maxWidth)?n.maxWidth:100/r.length+"%",e.is(t[n.property])&&(n.displayTitle&&(d=n.title+" : "),d+=t[n.property]),s.setText(d),s.setStyles({fontWeight:n.fontWeight,color:n.color,maxWidth:i,fontSize:c}),o+=d,o+=" ",s.inject(a)})),o+="\n",a.inject(n)})),n.tooltipInfos=new Z({shortHelp:o})},I=function(t,n,o){var r=new X.Node,c=t.id;return c=c.replace(new RegExp(",","g"),"_"),r.views.main=new i,r.model=t,r.PID=t.id,r.id="node_"+c,r.multiset("left",n,"top",o,"width",250,"height",90),T(r),i.prototype.buildNodeElement=function(t){var n,o,i,r;return e.is(t)&&(o=t.model,(n=y()).addClassName("egraph_views_HTMLNodeView_Node "+o.className+" "+o.id),e.is(o.icon)&&e.is(o.icon.iconPath)&&(i=n.getElementsByClassName("my-node-type-img")[0],e.is(i)&&(i.src=o.icon.iconPath))),r=n.getElementsByClassName("my-node-container")[0],e.is(o)&&e.is(r)&&a.length>0&&W(o,r),n},r},D=function(){var t,n,o=e.extendElement(document.createElementNS("http://www.w3.org/2000/svg","svg")),i=e.extendElement(document.createElementNS("http://www.w3.org/2000/svg","defs")),r=e.extendElement(document.createElementNS("http://www.w3.org/2000/svg","marker")),a=e.extendElement(document.createElementNS("http://www.w3.org/2000/svg","path"));o.appendChild(i),i.appendChild(r),r.appendChild(a),o.setAttribute("width","0"),o.setAttribute("height","0"),o.setAttribute("style","position:absolute;"),r.setAttribute("id","arrow-edge-end-marker"),r.setAttribute("markerWidth","10"),r.setAttribute("markerHeight","8"),r.setAttribute("refX","8"),r.setAttribute("refY","4"),r.setAttribute("orient","auto"),a.setAttribute("d","M 0 0 L 10 4 L 0 8"),a.setAttribute("fill","#777"),a.setAttribute("stroke","none"),a.setAttribute("z-index","10"),(t=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-productFlowMarker"),i.appendChild(t),(n=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-timeConstraintMarker"),i.appendChild(n),(t=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-productFlowMarker-Failed"),i.appendChild(t),(t=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-productFlowMarker-Alternative"),i.appendChild(t),(t=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-productFlowMarker-Scrapped"),i.appendChild(t),(N=e.createElement("div",{class:"canvas-gv",id:"canvas-"+l})).addEvent("contextmenu",(function(t){e.Event.stop(t)})),N.appendChild(o)},U=function(e){Q.SVGEdgeView.prototype.oncreateDisplay.apply(this,arguments),this.display.elt.textContent="official",this.display.elt.setAttribute("data-link-type-nls",e.mark.linkInfo.NLS),this.display.elt.setAttribute("data-link-from",e.mark.fromNodeId),this.display.elt.setAttribute("data-link-to",e.mark.toNodeId),this.display.elt.setAttribute("data-link-category",e.mark.linkInfo.flowType||"Good"),this.display.elt.setAttribute("data-link-isProductFlow",e.mark.linkInfo.isProductFlow)},Y=function(e){var t;return(t=new q.StateMachine(e,null,null,e.views.main)).rootState&&(F&&(t.rootState.doubleClickOnNode=F),t.rootState.oncontextmenu=v),t.state.onwheel=function(e,t){if(t.inside){const n=e.graphView;if(n.zoominc){const e=N.getBoundingClientRect();n.zoominc(.5*t.wheelDelta,t.clientPos[0]-e.x,t.clientPos[1]-e.y)}}},t},P=function(){var e;return K.inherit(i,Q.HTMLNodeView),K.inherit(o,Q.SVGEdgeView),o.prototype.oncreateDisplay=U,(e=new X.EGraph).setViewOpts({addTopologicalIds:!0}),e.addView("main",new Q.HTMLGraphView(N)),e.setZoomOpts({customMgt:!0}),e.updateLock(),e},E=function(){var e,t,n;for(n=new K.BoundingRect,e=h.nodes.first;e;e=X.dftNext(h,e))n.update(e,e.actualLeft-300,e.actualLeft+e.actualWidth,e.actualTop,e.actualTop+e.actualHeight);t=K.reframeViewpoint(h.views.main.getSize(),n,{padding:15,minSize:50,horizontal:-1,vertical:-1,aliasing:0,defaultVpt:h.views.main.vpt,maxScale:1}),h.views.main.setViewpoint(t,!0)},p=function(){var t,n,o,i,a=!0;h.addChangeListener((function(c){var s,d;"edges"===c[0].path[0]&&(s=c[0].child.cl2.c,d=c[0].child.cl1.c,null!==s&&null!==d&&e.is(s.node.model)&&e.is(d.node.model)&&(e.is(c[0].child.geometry)||!g||r||g(d.node.model,s.node.model),setTimeout((function(){if(e.is(N))for(t=N.getElements("path"),n=0;n<t.length;n++)"official"!==(i=t[n]).innerHTML&&(o=window.getComputedStyle(i),"none"===o.getPropertyValue("marker-end")&&(i.parentElement.id.contains("arrow-edge-end-")||i.parentElement.removeChild(t[n])))}),500))),a||(a=c.some((function(e){return"selection"===e.path[0]})))})),h.addListener("update",(function(){var t,n,o,i,c,s=[];if(a&&!r){if(a=!1,ne)return void(ne=!1);for(c=e.clone(oe,!0),oe={},t=h.selection.first;t;t=t.nextSel)n=t.model,oe[t.PID]||(oe[t.PID]=!0),c[t.PID]||(o=n);for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&!oe[i]&&s.push(i);B&&(e.is(o)||s.length>0)&&B(o,s)}}))},A=function(e){var t,n={},o=0;for(e=Array.isArray(e)?e:[e],t=h.nodes.first;t&&(e.indexOf(t.PID)>-1&&(n[t.PID]=t,o++),o!==e.length);t=X.dftNext(h,t));return n},V=function(t){var n,o=[];for(t=Array.isArray(t)?t:[t],n=h.edges.first;n;n=n.next)e.is(n.mark)&&t.indexOf(n.mark.id)>-1&&o.push(n);return o},R=function(){d.forEach((function(e){var t,n,o=A([e.fromNodeId,e.toNodeId]);t=o[e.fromNodeId].connectors.out,n=o[e.toNodeId].connectors.in,o[e.toNodeId].model.isLoopNode&&(n=o[e.toNodeId].connectors.out),o[e.fromNodeId].model.isLoopNode&&(t=o[e.fromNodeId].connectors.in),k(t,n,e)}))},M=function(){var t,n={},o={},i=[],r=0,a={},c={},l={},u=function t(n,o){var i=o;e.is(a[n])?i=a[n]:a[n]=i,e.is(l[n])&&l[n].forEach((function(n){e.is(a[n])||(t(n,i+1),c[n]=!1)})),0===i&&(c[n]=!0)},f=function i(r,c){var d;for(t=a[r];e.is(n[t+","+te]);)te++;e.is(l[r])&&(d=l[r].find((function(e){return c.indexOf(e)>-1}))),e.is(d)&&(s.find((function(e){return e.id===r})).isLoopNode=!0,te++),n[t+","+te]=r,o[r]={horizontal:t,vertical:te},e.is(d)&&te++,e.is(l[r])&&l[r].forEach((function(t){e.is(o[t])||i(t,c.concat([t]))}))};d.forEach((function(t){e.is(l[t.fromNodeId])||(l[t.fromNodeId]=[]),l[t.fromNodeId].push(t.toNodeId)})),s.forEach((function(t){var a=t.xPos,c=t.yPos,s=t.id,d=a+","+c;e.is(a)&&e.is(c)&&(0===a&&0===c?(r++,e.is(n[d])?i.push(t):(n[d]=s,o[s]={vertical:a,horizontal:c})):(n[d]=s,o[s]={vertical:a,horizontal:c}))})),r===s.length&&(i=s,n={},o={}),i.forEach((function(e){u(e.id,0)})),(c=e.Object.keys(c).filter((function(e){return c[e]}))).forEach((function(e){f(e,[e]),te++})),s.forEach((function(e){var t,n,i;i=150*o[e.id].vertical,n=450*o[e.id].horizontal,t=I(e,n,i),h.addNode(t)}))},b=function(){return s.some((function(t){return-1===ie.indexOf(t.PPRType)&&ie.push(t.PPRType),e.is(t.parentId)}))?ee:J},C=function(){if(!e.is(h)){h=P(),m=Y(h),c=b();try{x()&&M(),R(),z()}finally{h.updateUnlock()}p(),E()}},O=function(t){var n=A([t.fromNodeId,t.toNodeId]);2===e.Object.keys(n).length&&k(n[t.fromNodeId].connectors.out,n[t.toNodeId].connectors.in,t)},G=function(e){var t;try{x()&&(h.updateLock(),t=I(e,0,150*te),te++,h.addNode(t))}finally{h.updateUnlock()}},_=function(e){var t,n=A([e]);for(t in n)n.hasOwnProperty(t)&&h.removeNode(n[t])},j=function(t,n){var o,i=A([t]);i=i[t],e.is(i)&&(i.model=e.extend(i.model,n),(o=i.view.elts.node.getElementsByClassName("my-node-container")[0]).innerHTML="",W(i.model,o))},H=function(e){var t,n=A([e]);for(t in n)Object.prototype.hasOwnProperty.call(n,t)&&(oe[t]=!0,ne=!0,h.addToSelection(n[t]))},z=function(){s.forEach((function(e){e.preSelected&&H(e.id)})),ne=!1},S=function(){var e,t,n,o=[];for(e=h.nodes.first;e;e=X.dftNext(h,e))n=Math.round(e.left/450),t=Math.round(e.top/150),o.push({instancePID:e.model.instancePID,x:t,y:n});return o},{init:function(){D()},inject:function(e){N.inject(e)},createGraphComponent:function(){C()},destroy:function(){N.remove(),N.destroy(),N=void 0},addLink:function(e){O(e)},removeLink:function(e){V(e).forEach((function(e){e.remove()}))},addNode:function(e){G(e)},removeNode:function(e){_(e)},selectNode:function(e){H(e)},unselectNode:function(e){var t,n=A([e]);for(t in n)n.hasOwnProperty(t)&&n[t].isSelected()&&oe[t]&&(oe[t]=!1,ne=!0,h.removeFromSelection(n[t]))},updateNode:function(e,t){j(e,t)},resizeTheGraph:function(){E()},getCurentTilePosition:function(){return S()},getGraphDefaultToolbar:function(t){var n;return e.is(h)&&e.is(m)&&(t=Array.isArray(t)?t:e.is(t)?[t]:[],n=m.generateToolbarModel(t)),n}}}})),define("DS/DELPPWProductFlowSequenceModule_FD02/ProductFlowSequenceModule",["UWA/Core","DS/DELPPWProductFlowSequenceModule_FD02/ProductFlowComponent","DS/DELPPWProductFlowSequenceModule_FD02/GraphPanel"],(function(e,t,n){"use strict";return{behaviors:["UXFactoryBehavior","ModelBehavior","ResourceBehavior","SelectionBehavior","EditAttributeBehavior","LinkBehavior","ProductFlowLinkBehavior","RootsBehavior"],creator:function(o,i,r,a,c,s,d,l,u){var f,p,g,h,m,y,P,v,I,w,N,C=["OPERATION","SYSTEM"],E="PPR-PERTVIEW",D=!1,S=!1,L=!1,T=i.getComponent("Breadcrumb"),k=i.getComponent("GeneratedToolbar"),A=i.getComponent("ModalContainer"),b=i.getComponent("TooltipModel"),x=i.create("WUXLoader",{showButtonFlag:!1}),F=e.createElement("div",{class:"pert-loading-cont"}),R=i.getComponent("WUXCommandsManager"),M=l.getProductFlowRelationTypes(),V=function(){var t,n=new Map,i=!0;e.is(h)&&((t=h.getCurentTilePosition()).every((function(e){var t=e.x+","+e.y;return n.has(t)?(i=!1,o.warn(a.getNLSValue("ProductFlowLinkBehavior.TilePosition.Overlap")),!1):(n.set(t,!0),!0)})),i&&l.saveTilePositions(t))},O=function(){var t,n,o,i=function(){return{id:"",dataElements:{typeRepresentation:"functionIcon",icon:{fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"2x",className:"action"},position:"far",category:"action"}}};Y(),v=e.createElement("div",{class:"egraph-toobar"}),_(m.id,m.path).inject(v),h&&((t=h.getGraphDefaultToolbar()).entries.push(function(){let e=i();return e.id="reframe",e.dataElements.tooltip=new b({title:a.getNLSValue("GraphView.FitInAll.Tooltip")}),e.dataElements.icon.iconName="zoom-fit",e.dataElements.value=h.resizeTheGraph,e}()),t.entries.push(function(){let e=i();return e.id="refresh",e.dataElements.icon.iconName="refresh",e.dataElements.tooltip=new b({title:a.getNLSValue("GraphView.Refresh.Tooltip")}),e.dataElements.value=q,e}()),w||t.entries.push(function(){let e=i();return e.id="save",e.dataElements.icon.iconName="floppy",e.dataElements.tooltip=new b({title:a.getNLSValue("GraphView.SaveTilePosition.Tooltip")}),e.dataElements.value=V,e}()),n=k.prototype.createTreeDocument(t),(o=new k({overflowManagement:"dropdown",direction:"horizontal",items:n})).elements.container.addClassName("graph-right-actions"),o.inject(v)),v.inject(I,"top")},G=function(t){var n=t.model,o={objectId:n.referencePID};e.is(N)&&(o.filterQuery=N),X(o).then((function(){m.id=e.is(n.instancePID)?n.instancePID:n.referencePID,m.path=n.occcurancePath,q()}))},_=function(t,n){var i,c,s,d,l,u=e.createElement("div",{class:"egraph-navigator"}),f=[],p=function(e,t,n){s&&f.unshift({label:s.get("V_Name"),icon:{iconPath:a.getIconURLFromKey(s.get("type")),iconSize:{width:"20px",height:"20px"}},id:t,path:n})};if(e.is(n,"string")&&(n=n.split(",")),0===n.length)p(0,(s=r.getReference(t)).get("PID"),[]);else for(l=n.length-1;l>=0;l--)d=n[l],s=r.getReferenceModel(d),p(0,d,n.slice(0,l+1)),0===l&&(c=r.getInstance(d),p(0,(s=r.getAggregatingReferenceModelFromInstance(c)).get("PID"),[]));return f.length>0&&(i=new T({value:f,mode:T.MODE.NAVIGATION})).addEventListener("selectionChange",(function(){var e;o.notify("EGraphNodeSelect",{selectedNodeIds:[m.id]}),S=!0,e=i.selectedValues[0],m=e,q()})),i.inject(u),u},B=function(t,n){var i,s,l,f,p=[],g=[],h=[],P=[];return l=function(e,t){return e.some((function(e){return e.id===t}))},f=function(e){return c.getSelectedInsts().findIndex((function(t){return t.get("isAggregatedBy")===i.get("PID")&&t.get("PID")===e}))>-1},i=r.getReferenceModel(t),((s=function(){var t,n,o;return e.is(N)?t=N:e.is(m)&&(0===m.path.length?n=m.id:(o=r.getInstance(m.path[0]),n=(o=r.getReference(o.get("isAggregatedBy"))).get("PID")),n&&(t=u.getRootFilter(n),t=e.is(t)&&e.is(t.originalFilterQuery)?t.originalFilterQuery:void 0)),t}())?r.getFilteredInstancesFromCollection(i.get("PID"),s):r.getInstancesFromCollection(i.get("PID"))).forEach((function(t){var i,c,s,d,l,u,g=0,m=0;l=t.get("PID"),u=n.concat([l]),d=r.getReferenceModelFromInstance(t),e.is(t.get("V_X2DPos"))&&e.is(t.get("V_Y2DPos"))?(g=Number(t.get("V_X2DPos")),m=Number(t.get("V_Y2DPos"))):o.debug(l+" V_X2DPos, V_Y2DPos are missing "),C.indexOf(d.get("PPRTYPE"))>-1&&(i=f(l),p.push(l),P.push({id:l}),c={id:u.toString(),PPRType:d.get("PPRTYPE"),type:d.get("type"),instancePID:l,referencePID:d.get("PID"),occcurancePath:u,className:" EGraph_obj_"+d.get("PPRTYPE"),preSelected:i,icon:{iconPath:a.getIconURLFromKey(d.get("type"))},xPos:Number(g),yPos:Number(m)},y.forEach((function(n){(Array.isArray(n)?n:[n]).forEach((function(n){s=t.get(n.property),c[n.property]="NULL"!==s&&e.is(s)?s:d.get(n.property)}))})),h.push(c))})),function(t){return r.isNavigateOnDemand()?(t.push({id:m.id,path:m.path}),d.getRelations(t)):e.Promise.resolve()}(P).then((function(){return r.getImpactedConnections(p,!1,{relationTypes:M}).forEach((function(t){var n,o,i,r;h.every((function(i){return i.id.includes(t.get("from"))?n=i.id:i.id.includes(t.get("to"))&&(o=i.id),!(e.is(n)&&e.is(o))})),r=t.get("PID"),e.is(n)&&e.is(o)&&!l(g,r)&&(i=d.getLinkInfo(t),g.push({id:r,fromNodeId:n,toNodeId:o,linkType:t.get("type"),linkInfo:i}))})),{nodes:h,links:g}}))},W=function(t){var n="DisplayProperties",i=o.getAppContext();return{icon:"url("+a.getIconURLFromKey(n)+")",label:a.getNLSValue("Cmd.DisplayProperties.Title"),sensitivity:"enabled",callback:function(){var o=R.getCommandCheckHeader(n,i),a=r.getReferenceIdFromInstance(t.instancePID);e.is(o)&&!1===o.getState()&&(o.options.node={referencePID:a,instancePID:t.instancePID,absPath:t.occcurancePath},o.toggleState())}}},j=function(e){return[{icon:"url("+a.getIconURLFromKey("GeneralDelete")+")",label:a.getNLSValue("LinksUI.DeleteLink"),sensitivity:"LinearProductFlowCnx"!==e.linkType?"enabled":"disabled",callback:function(){var t=d.getConnection(e.id);d.deleteConnection(t,{onFailure:function(){o.warn(a.getNLSValue("LinksUI.DeleteFailure"))},onComplete:function(){o.info(a.getNLSValue("LinksUI.DeleteSuccess"))},logMessage:a.getNLSValue("LinksUI.LogMessage")})}},{icon:"url("+a.getIconURLFromKey("EditAttribute")+")",label:a.getNLSValue("LinksUI.EditAttribute"),sensitivity:s.hasEditConfiguration(e.id)?"enabled":"disabled",callback:function(){s.editConfiguredAttributes(e.id)}}]},U=function(t,n){var i={allowMove:!0},a=[];t&&(i.targetInstancePID=t.instancePID,i.targetInstancePIDsArray=t.occcurancePath,i.targetReferencePID=r.getReferenceIdFromInstance(t.instancePID),i.targetRootReferencePID=r.getInstance(t.occcurancePath[0]),i.targetRootReferencePID=e.is(i.rootReferencePID)?i.rootReferencePID.get("isAggregatedBy"):null),n&&(i.instancePID=n.instancePID,i.instancePIDsArray=n.occcurancePath,i.referencePID=r.getReferenceIdFromInstance(n.instancePID),i.rootReferencePID=r.getInstance(n.occcurancePath[0]),i.rootReferencePID=e.is(i.targetRootReferencePID)?i.targetRootReferencePID.get("isAggregatedBy"):null),"OPERATION"!==t.PPRType&&"SYSTEM"!==t.PPRType||"OPERATION"!==n.PPRType&&"SYSTEM"!==n.PPRType||(i.linkType=l.getProductFlowRelationTypeByTypes(t.type,n.type),e.is(i.linkType)&&(a.push(i),o.notify("CreateLinkOrInstance",[a])))},z=function(t,n){var i={};c.getSelections()[0].indexOf(m.id)>-1&&n.push(m.id),n.length>0&&(n=n.map((function(e){var t=e.split(",");return t[t.length-1]})),S=!0),i.selectedNodeIds=n,t&&(i.changed={nodeId:r.getReferenceIdFromInstance(t.instancePID),childOccurencePath:e.is(t.occcurancePath)?t.occcurancePath:null,isSelected:!0},D=!0),o.notify("EGraphNodeSelect",i)},H=function(){e.is(h)&&(h.destroy(),h=void 0)},Y=function(){e.is(v)&&(v.destroy(),v=void 0)},X=function(t){return t=t||{},new Promise((function(n){var o,i,a={};!!e.is(f.forceFetch)&&f.forceFetch&&e.is(t.objectId)?(o=t.objectId,i=function(){e.is(I)&&(x.off(),A.removeModal(F),F.remove()),n()},e.is(I)&&(F.inject(I),A.createModal(F,x.elements.container),x.on()),e.is(f.expandLevel)&&(a.expandLevel=f.expandLevel),e.is(f.withLinks)&&(a.withLinks=f.withLinks),e.is(f.withLinksResolved)&&(a.withLinksResolved=f.withLinksResolved),e.is(f.relationTypes)&&(a.gridIDs=f.relationTypes),e.is(f.forceDBMode)&&(a.forceDBMode=f.forceDBMode),e.is(t.filterQuery)&&(a.filterQuery=t.filterQuery),r.getDescendantsFromServer([o],i,a)):n()}))},Q=function(){return B(m.id,m.path).then((function(e){p=e.nodes,g=e.links,H(),(h=new t(i,{nodes:p,links:g,readOnly:w,identifier:E,nodeOptions:y,getNodeContextMenu:W,getLinkContextMenu:j,onNodeDoubleClick:G,onConnectingNodes:U,onNodeSelectionChange:z})).init()}))},q=function(){return Q().then((function(){h.inject(I),h.createGraphComponent(),O()}))},K=function(t){var n,o,i;L||Array.isArray(t)||(p.every((function(i){var r=t.get("from"),a=t.get("to");return r=Array.isArray(r)?r.join(","):r,a=Array.isArray(a)?a.join(","):a,i.id.includes(r)?n=i.id:i.id.includes(a)&&(o=i.id),!(e.is(n)&&e.is(o))})),e.is(n)&&e.is(o)&&(i=d.getLinkInfo(t),h.addLink({fromNodeId:n,toNodeId:o,id:t.get("PID"),linkType:t.get("type"),linkInfo:i})))},$=function(e){(Array.isArray(e)?e:[e]).forEach((function(e){h.removeLink(e.get("PID"))}))},Z=function(t){var n,o,i,c=t.get("isInstanceOf"),s=t.get("PID"),d=r.getReferenceIdFromInstance(m.id);d||(d=m.id),t.get("isAggregatedBy")===d&&(r.isSystem(c)||r.isOperation(c))&&(n=r.getReference(c),i={id:(o=m.path.concat([s])).toString(),V_Name:n.get("V_Name"),PPRType:n.get("PPRTYPE"),instancePID:s,referencePID:c,occcurancePath:o,className:" EGraph_obj_"+n.get("PPRTYPE"),icon:{iconPath:a.getIconURLFromKey(n.get("type"))}},h.addNode(i),p.push(e.clone(i)))},J=function(e){(Array.isArray(e)?e:[e]).forEach((function(e){var t=m.path.concat([e.get("PID")]).toString();h.removeNode(t)}))},ee=function(t){var n=t.changed,o=n.absPath.toString();e.is(h)&&(n.isSelected?(D||h.selectNode(o),D=!1):(S||h.unselectNode(o),S=!1))},te=function(){q()},ne=function(){},oe=function(){Y(),H()},ie=function(){L=!0,H()},re=function(t){var n={};(t=Array.isArray(t)?t:[t]).forEach((function(t){y.forEach((function(e){(Array.isArray(e)?e:[e]).forEach((function(e){r.isEntityInstance(e.dicoType)||(n[e.property]=t.get(e.property))}))})),p.forEach((function(o,i){o.referencePID===t.get("PID")&&(p[i]=e.clone(e.extend(p[i],n)),h.updateNode(p[i].id,n))}))}))},ae=function(t){!e.is(m)||m.id!==t&&m.path[0]!==t||(L=!L&&L,r.getDescendantsFromServer([t],(function(){e.is(v)||O(),q()}),{expandLevel:1,forceDBMode:!0}))};return{name:"ProductFlowViewModule",listenTo:function(){return{select:ee,addConnection:K,removeConnection:$,addInstance:Z,removeInstance:J,refreshImpacted:te,Hide:ne,HideAll:oe,refreshAll:ie,addRootNode:ae,changeReference:re}},onStart:function(t,r){var s,l,u;f=t=t||{},e.is(t.displayNodeConfigXML)&&(s=d.getXMLValues(t.displayNodeConfigXML),e.is(s.Config.Preferences)&&(y=[],e.is(s.Config.Preferences.Node)&&e.is(s.Config.Preferences.Node.Lines)&&e.is(s.Config.Preferences.Node.Lines.Line)&&(y=(y=s.Config.Preferences.Node.Lines.Line).map((function(t){var n,o=t.Info;return o.displayAttributeName&&(o.displayTitle=!0,n=e.is(o.dicoType)?o.dicoType+"."+o.property:o.property,o.title=a.getNLSValue(n)),o}))))),t.showPanel&&(l=a.getNLSValue(t.titleGraph),(P=new n(o,i,a)).init({title:l,identifier:E,className:"PERTVIEW-panel-container",onClose:function(){e.is(t.toggleCmdId)?o.notify("toggleCmdCheckHeaderState",{cmdName:t.toggleCmdId,cmdState:!1}):P.hide()}}),I=P.getContainer(),u=c.getSelectionsWithPaths()[0][0],m={id:u.id,path:u.path},P.buildSkeleton(),P.show(),q()),r()},onStop:function(){e.is(h)&&(h.destroy(),h=void 0),e.is(P)&&(P.destroy(),P=void 0)},createSequence:function(e){return X(e).then((function(){var t=e.objectId;return m={id:t,path:[]},N=e.filterQuery,Q()}))},inject:function(e){I=e,h.inject(I),h.createGraphComponent(),O()},setReadOnly:function(e){w=e}}}}}));