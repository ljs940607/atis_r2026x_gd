define("DS/ViscaURLServicesJS/VisuRepServices",["DS/WAFData/WAFData"],(function(e){"use strict";var t=function(){};function r(e,t){var r="&"+t+"=",i=e.indexOf(r);if(!(i<0)){var n=e.indexOf("&",i+r.length);if(!(n<0))return e.substring(i+r.length,n)}}t.RepType=Object.freeze({AV1:"av1",RR:"rr",PR:"pr"});var i="/resources/fcsservices/fcs/mediaURL?",n="boid=",o="format=",s="filename=";t.prototype.GetFallbackUrl=function(e,t){if("string"==typeof e){var a=r(e,"id");if("string"==typeof a){var l=r(e,"f"),u=r(e,"fmt");if("object"==typeof t&&"string"==typeof t.spaceUrl&&"string"==typeof l&&"string"==typeof u)return t.spaceUrl+i+n+a+"&"+o+u+"&"+s+l;var f=r(e,"type"),c=r(e,"e");if("string"==typeof f&&!isNaN(parseInt(c))){var p="&type=";return e.replace(p+f,p+"av")}}}};var a="/file/";return t.prototype.GetStaticUrls=function(l,u,f){if("object"==typeof l&&"object"==typeof u&&Array.isArray(f)){var c={},p=[],y="string"==typeof l.viscaUrl,d=void 0,b="string"==typeof l.dosUrl,v=void 0;b||(l.dosUrl="dos",b=!0);var h="function"==typeof l.onCompleteCB,g=[],m=function(e,t){Array.isArray(c[t])||(c[t]=[]),c[t].push(e)};f.forEach((function(e){if("string"==typeof e)m(e);else if("object"==typeof e){if("string"==typeof e.currentUrl){if(y){if(void 0===d){var f=(d=l.viscaUrl.toLowerCase()).lastIndexOf(":");f>d.indexOf(":")&&(d=d.substring(0,f))}if(e.currentUrl.toLowerCase().includes(d)){var c={};if(c.boid=r(e.currentUrl,"id"),"string"==typeof c.boid){if(c.bucket=r(e.currentUrl,"b"),c.filename=r(e.currentUrl,"f"),c.format=r(e.currentUrl,"fmt"),c.version=r(e.currentUrl,"v"),"string"==typeof c.bucket)return void m(c.boid,c.bucket);if(u.type===t.RepType.AV1&&"string"==typeof l.spaceUrl&&"string"==typeof c.filename&&"string"==typeof c.format)return c.resourceId=e.resourceId,c.url=l.spaceUrl+i+n+c.boid+"&"+o+c.format+"&"+s+c.filename,void g.push(c);var h=r(e.currentUrl,"type"),C=r(e.currentUrl,"e");if(c.element=parseInt(C),"string"==typeof h&&!isNaN(c.element)){var U="&type=";return c.resourceId=e.resourceId,c.url=e.currentUrl.replace(U+h,U+u.type.substring(0,2)),void g.push(c)}}}}if(b){if(void 0===v){var k=(v=l.dosUrl.toLowerCase()).lastIndexOf(":");k>v.indexOf(":")&&(v=v.substring(0,k))}var S=e.currentUrl.toLowerCase().indexOf(v);if(S>=0){var A=e.currentUrl.lastIndexOf(a);if(A>S){var O=A+6,x=e.currentUrl.indexOf("/",O);if(x>O){var R=x+1,j=e.currentUrl.indexOf("/",R);if(j<R&&(j=e.currentUrl.length),j>R){var F=e.currentUrl.substring(O,x),w="string"==typeof e.boid?e.boid:e.resourceId;return void m(w,F)}}}}}}"string"==typeof e.resourceId?m(e.resourceId,e.bucket):"string"==typeof e.boid&&(Array.isArray(e.elements)?p.push(e):m(e.boid,e.bucket))}})),g.length>0&&h&&l.onCompleteCB(g);var C=function(){Object.keys(c).forEach((function(r){var i={async:h,timeout:l.timeout,authentication:"passport",proxy:"passport",method:"POST",data:JSON.stringify({label:"VisuRepServices-"+l.user+"-"+Date.now(),physicalid:c[r],select_predicate:["physicalid","cgrwms","3dthbwms"],select_file:[u.type==t.RepType.AV1?"cgr":"thumbnail_3d"],fcs_url_mode:"REDIRECT"}),headers:{"Content-type":"application/json",SecurityToken:l.user+"|"+l.securityCtx+"|preferred",SecurityContext:l.securityCtx},onComplete:function(e,t){if("string"==typeof e&&0!==e.length){var i=JSON.parse(e);if("object"==typeof i&&Array.isArray(i.results)){var n=[];i.results.forEach((function(e){if(Array.isArray(e.attributes)){var t={};"string"==typeof r&&"undefined"!=r&&(t.bucket=r),e.attributes.forEach((function(e){"physicalid"==e.name?(t.boid=e.value,t.resourceId=e.value):"cgr"==e.name||"thumbnail_3d"==e.name?t.url=e.value:"string"==typeof t.version||"cgrwms"!=e.name&&"3dthbwms"!=e.name||(t.version=e.value)})),"string"==typeof t.boid&&"string"==typeof t.url&&n.push(t)}})),h?l.onCompleteCB(n,l.spaceUrl):g=g.concat(n)}else l.onFailureCB()}else l.onFailureCB()},onFailure:function(){l.onFailureCB&&l.onFailureCB()},onPassportError:function(){l.onFailureCB&&l.onFailureCB()},onTimeout:function(){l.onFailureCB&&l.onFailureCB()}},n=l.spaceUrl+"/cvservlet/fetch/v2?tenant="+l.tenant;"string"==typeof r&&"undefined"!=r&&(n+="&isSupplemental=true&bucket="+r),e.authenticatedRequest(n,i)}))};if(y&&(u.type!=t.RepType.AV1||p.length>0)){var U=[];if(u.type!=t.RepType.AV1&&Object.keys(c).forEach((function(e){c[e].forEach((function(t){var r={source:u.source,boid:t,type:u.type};"string"==typeof e&&"undefined"!=e&&(r.bucket=e),U.push(r)}))})),p.forEach((function(e){U.push({source:u.source,boid:e.boid,elements:e.elements,type:u.type})})),U.length>0){var k={async:h,timeout:l.timeout,authentication:"passport",proxy:"passport",method:"POST",data:JSON.stringify({files:U}),headers:{"Content-type":"application/json",SecurityContext:l.securityCtx},onComplete:function(e,t){if("string"==typeof e&&0!==e.length){var r=JSON.parse(e);if("object"==typeof r&&Array.isArray(r.urls)){var i=[];r.urls.forEach((function(e){i.push({bucket:e.bucket,boid:e.boid,url:e.url,version:e.version})})),i.length>0?(h?l.onCompleteCB(i,l.viscaUrl):g=g.concat(i),i.forEach((function(e){var t=c[e.bucket].indexOf(e.boid);t>=0&&(c[e.bucket].splice(t,1),0==c[e.bucket].length&&delete c[e.bucket])})),Object.keys(c).length>0&&C()):C()}else C()}else C()},onFailure:function(){C()},onPassportError:function(){C()},onTimeout:function(){C()}};e.authenticatedRequest(l.viscaUrl+"/api/v1/urls",k)}else C()}else C();return h?void 0:g}l.onFailureCB&&l.onFailureCB()},t})),define("DS/ViscaURLServicesJS/ViscaURLServices",(function(){"use strict";var e="api/v1/rep?",t=function(){};function r(e){for(var t=e.split("&"),r={},i=0;i<t.length;i++){var n=t[i].split("=");"s"===n[0]?r.source=n[1]:"t"===n[0]?r.tenant=n[1]:"id"===n[0]?r.boid=n[1]:"b"===n[0]?r.bucket=n[1]:"f"===n[0]?r.filename=n[1]:"fmt"===n[0]?r.format=n[1]:"e"===n[0]?r.element=Number(n[1]):"v"===n[0]?r.version=n[1]:"ts"===n[0]?r.timestamp=n[1]:"type"===n[0]?r.type=n[1]:"sgn"===n[0]&&(r.signature=n[1])}return r}function i(e){const t="bytes=";if("Range"==e.name&&0==e.value.indexOf(t)){var r=e.value.indexOf("-");if(r>0){const t=6;var i=e.value.substring(t,r),n=e.value.substring(r+1);return Number(n)-Number(i)}}return-1}function n(e){var t=e;if("number"!=typeof t.element)return t;if(t.elements=[t.element],delete t.element,"number"!=typeof t.index)return t;if(t.indices=[t.index],delete t.index,Array.isArray(t.headers)&&1==t.headers.length){var r=i(t.headers[0]);r>=0&&(t.contentSize=r)}return t}return t.prototype.CreateURLsRequestBody=function(e,t){if(void 0!==e&&0!==e.length){for(var r={},i={files:[]},n=0;n<e.length;n++){if(void 0===e[n])return;i.files.push(e[n])}return"object"==typeof t&&"boolean"==typeof t.fallback&&t.fallback&&(i.fallback=!0),r.body=JSON.stringify(i),r}},t.prototype.IsURLFetchCompatible=function(e){return!e.toLowerCase().includes("&type=av")},t.prototype.CreateBatchURLAndBody=function(t,i){if(void 0!==t&&0!==t.length){for(var n={},o={files:[]},s=0;s<t.length;s++){if(void 0===t[s])return;var a=t[s].toLowerCase().search(e);if(-1===a)return;0===s&&(n.url=t[s].substring(0,a)+"api/v1/reps");var l=r(t[s].substring(a+11,t[s].length));o.files.push(l)}return"object"==typeof i&&"boolean"==typeof i.allowPartial&&i.allowPartial&&(o.allowPartial=!0),"object"==typeof i&&"boolean"==typeof i.fallback&&i.fallback&&(o.fallback=!0),"object"==typeof i&&"string"==typeof i.emptyFallback&&i.emptyFallback.length>0&&(o.emptyFallback=emptyFallback),"object"==typeof i&&"boolean"==typeof i.checkVersion&&i.checkVersion&&(o.checkVersion=!0),n.body=JSON.stringify(o),n}},t.prototype.MergeBatchAnswer=function(e,t){if("object"==typeof e&&Array.isArray(e.files)){for(var r="number"==typeof t?t:0,o=[],s=0;s<e.files.length;s++){var a=e.files[s];if("object"==typeof a&&"string"==typeof a.url&&(Array.isArray(o[a.url])||(o[a.url]=[]),a.index=s,o[a.url].push(a),o[a.url][0].source!=a.source||o[a.url][0].boid!=a.boid))return}var l={files:[]};for(var u in o)f(o[u]);return l}function f(e){if(!Array.isArray(e)||0==e.length)return;for(var t=n(e[0]),o=1;o<e.length;o++)if("number"!=typeof t.contentSize||0!=r&&t.contentSize>=r)l.files.push(t),t=n(e[o]);else if(Array.isArray(e[o].headers)&&1==e[o].headers.length){var s=i(e[o].headers[0]);s<0?l.files.push(e[o]):0!=r&&t.contentSize+s>r?(l.files.push(t),t=n(e[o])):(t.contentSize+=s,t.elements.push(e[o].element),t.indices.push(e[o].index),t.headers[0].value+=","+e[o].headers[0].value.substring(6))}else l.files.push(e[o]);l.files.push(t)}},t.prototype.CreateFetchURLAndBody=function(t,i,n){if(void 0!==t&&0!==t.length&&void 0!==i&&i.length===t.length){for(var o={},s={files:[]},a=0;a<t.length;a++){if(void 0===t[a])return;var l=t[a].toLowerCase().search(e);if(-1===l)return;0===a&&(o.url=t[a].substring(0,l)+"api/v1/fetch");var u=r(t[a].substring(l+11,t[a].length));u.correlationID=i[a],s.files.push(u)}return"object"==typeof n&&"number"==typeof n.splitTargetedSize&&n.splitTargetedSize>0&&(s.splitTargetedSize=n.splitTargetedSize),"object"==typeof n&&"boolean"==typeof n.allowPartial&&n.allowPartial&&(s.allowPartial=!0),"object"==typeof n&&"boolean"==typeof n.checkVersion&&n.checkVersion&&(s.checkVersion=!0),o.body=JSON.stringify(s),o}},t}));