define("DS/CfgVersionGraphUX/scripts/CfgTreeNodeModel",["DS/LifecycleDAGModel/DAGNodeModelBase"],(function(e){"use strict";var t=function(t,i,s,n,o,r,a,l,d,p,h){if(t)if(t instanceof e)for(var c in this.options={},t.options)"children"!==c&&(this.options[c]=t.options[c]);else this.options={id:t,versionType:r,name:i,label:s,children:[],revision:n,creationDate:p,grid:{range:d,revision:n,current:o,creationDate:p,description:h?h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):""},data:{frozen:l}};else this.options={isEmpty:!0};e.call(this,this.options)};return(t.prototype=Object.create(e.prototype)).constructor=t,t.prototype.isLeaf=function(){return!0===this.options.grid.__isLeaf__},t.prototype.isActive=function(){return!0===this.options.grid.__isActive__},t.prototype.clone=function(){return new t(this)},t.prototype.sortFunction=function(e,t){return!t&&(t=e=this),e.options.grid.creationDate>t.options.grid.creationDate},t.prototype.getLastLeaf=function(){for(var e=this;e.hasChildren();e=e.getLastChild());return e},t.prototype._getID=function(){return this.isEmpty()?this._id:this.options.id},t.prototype.isEmpty=function(){return!0===this.options.isEmpty},t.prototype.refreshNodeData=function(t){for(var i in(t=t||{})instanceof e&&(t=t.options.grid),this.options.grid)if(!(i.startsWith("__")&&i.endsWith("__")||"object"==typeof t[i])){if("title"===i){var s=t.title||t.label;s&&this.options.label!==s&&this.setAttribute("title",this.options.label=s)}t[i]&&t[i]!==this.options.grid[i]&&this.setAttribute(i,t[i])}},t.prototype.getAttribute=function(e){return this.options.grid[e]},t})),define("DS/CfgVersionGraphUX/scripts/CfgVersionGraphColumnManager",["DS/GraphListView/ColumnManagerBase","i18n!DS/CfgVersionGraphUX/assets/nls/CfgVersionGraphNLS"],(function(e,t){"use strict";return e.extend({init:function(e){this._parent(e),this.setDefaultColumns([{text:"",dataIndex:"bi_color",width:10,isSortable:!1,isDraggable:!1,isEditable:!1,alwaysOn:!0},{text:t.CFG_Label_Graph,dataIndex:"__GRAPH__",width:160,style:{overflow:"scroll"},isSortable:!0,isDraggable:!1,isEditable:!1,alwaysOn:!0},{text:"<span style='font-weight:bold' class='fonticon fonticon-infinity'/>",dataIndex:"range",width:35,isSortable:!1,isDraggable:!1,isEditable:!1,isHidden:!1},{text:t.CFG_Label_Title,dataIndex:"tree",width:140,isSortable:!1,isDraggable:!1,isEditable:!1,isHidden:!1},{text:t.CFG_Label_Revision,dataIndex:"revision",width:85,isSortable:!0,isDraggable:!1,isEditable:!1},{text:t.CFG_Label_State,dataIndex:"current",width:85,isSortable:!1,isDraggable:!1,isEditable:!1},{text:t.CFG_Label_CreationDate,dataIndex:"creationDate",width:"auto",isSortable:!0,isDraggable:!1,isEditable:!1},{text:t.CFG_Label_Description,dataIndex:"description",width:"auto",isSortable:!1,isDraggable:!1,isEditable:!1}],!0)}})})),define("DS/CfgVersionGraphUX/scripts/CfgVersionExplorer",["UWA/Class/View","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgData","DS/Controls/Toggle","DS/CfgBaseUX/scripts/CfgEffectivityExpressionContainer","DS/CfgBaseUX/scripts/CfgEvolutionRange","DS/CfgBaseUX/scripts/CfgXMLServices","DS/Controls/TooltipModel","DS/Controls/Button","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUX","i18n!DS/CfgVersionGraphUX/assets/nls/CfgVersionGraphNLS","DS/CoreEvents/ModelEvents","DS/EffectivityWebExternalJS/scripts/CfgVersionExplorerLoader","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],(function(e,t,i,s,n,o,r,a,l,d,p,h){"use strict";return e.extend({className:"cfg-versionexplorerview",vEObject:{},infRevisions:[],toggleClickCount:0,intentToKeep:[],getVEObject(){return this.vEObject.value},init:function(e){this._parent(e),this.toggleClickCount=0,this.ExpJson={xml:"",json:[],description:[]},this.infRevisions=[],this.frozenRevisions=[],this.intentToKeep=[],this.VEContainer=UWA.createElement("div",{id:"CfgVEContainer"}).inject(this.container),this.createExpressionViewComp(),this.options.callBackFunction=()=>this.callbacksFromVE()},render:async function(){try{let e="",i="";if("MANUFACTURINGPLAN"==this.options.mode&&(e=await this.getManufPlanRevision()),"PRODUCTS"==this.options.mode?i=this.options.modelID:"MANUFACTURINGPLAN"==this.options.mode?i=e:"XREVISION"!=this.options.mode&&"CONFIGRECORD"!=this.options.mode||(i=this.options.xRevGraphID),"XREVISION"==this.options.mode){let e=!0,i=await t.getAllowedSemantics(this.options.xRevGraphID,e);i&&i.intents&&i.intents.length>0&&(this.intentToKeep=i.intents.filter((e=>{if("CFGRECORD"!=e.id)return e.short})).map((e=>e.short)))}else if("CONFIGRECORD"==this.options.mode){let e=!0,i=await t.getAllowedSemantics(this.options.xRevGraphID,e);i&&i.intents&&i.intents.length>0&&(this.intentToKeep=i.intents.map((e=>e.short)))}return i&&await this.loadVersionGraph(i),this.container}catch(e){console.error(e)}},createExpressionViewComp:function(){if(1==this.options.isReadOnly)return;let e={effArea:"",effExpHeaderTitle:p.CFG_Expression,viewContainer:this.container,defaultExpressionContainerHeight:70,inputData:"",displayCompactMode:this.options.displayCompactMode,minimizeTooltip:p.CFG_Minimize_EBox,maximizeTooltip:p.CFG_Max_EBox};this.cfgExpressionViewObj=new n(e),this.cfgExpressionViewObj.render()},isFrozen:function(e){let t=e.getAttributeValue("current");return"Frozen"==t||"Obsolete"==t||"Release"==t||"Review"==t||"Archived"==t},filterFrozenNodes:function(){this.getVEObject().applyFilter((e=>!this.isFrozen(e)))},checkRecordIntent:function(e){return!(!e.options.ancestors||"R"!==e.options.ancestors[0].semantic)||!!e.options.ancestors&&this.checkRecordIntent(e.getParent())},filterNodesWithNonRIntent:function(){this.getVEObject().applyFilter((e=>!!this.checkRecordIntent(e)))},loadVersionGraph:async function(e){this.VEContainer.innerHTML="";let{customizeColumnHash:t,customizeColumnAttributeHash:i}=this.infColumnDef(),s={showViewIcon:!1,dataModelType:5};"FILTER"==this.options.use?"CONFIGRECORD"==this.options.mode?s={showViewIcon:!1,filterFrozenNodes:()=>this.filterNodesWithNonRIntent(),dataModelType:5,intentsToKeep:this.intentToKeep}:"XREVISION"==this.options.mode&&(s={showViewIcon:!1,dataModelType:5,intentsToKeep:this.intentToKeep}):"FILTER"!=this.options.use&&("XREVISION"==this.options.mode?s={showViewIcon:!1,filterFrozenNodes:()=>this.filterFrozenNodes(),dataModelType:5,intentsToKeep:this.intentToKeep}:(await this.getFrozenRevisions(),s={showViewIcon:!1,filterFrozenNodes:()=>this.filterFrozenNodes(),versiongraphFlags:["subsetMode=DICO_CONFIG"],versionPidsToKeep:this.frozenRevisions,dataModelType:5}),1==this.options.isReadOnly&&(s.disableSelection=!0)),await VersionExplorerLoaderFactory(e,this.options.callBackFunction,enoviaServerFilterWidget.tenant,enoviaServerFilterWidget.baseURL,enoviaServerFilterWidget.getSecurityContext(),this.VEContainer,{id:""},"Products",this.vEObject,"CONFIGRECORD"==this.options.mode?"":"multiSelect",{customizeColumnHash:t,customizeColumnAttributeHash:i,customizeToolbarHash:{}},s)},select:function(e,t){this.noInfChkAndExprUpdate=!0,this.getVEObject().select(e),t&&this.infRevisions&&!this.infRevisions.includes(e.options.grid.code)&&this.infRevisions.push(e.options.grid.code),this.noInfChkAndExprUpdate=!1},unselect:function(e){this.noInfChkAndExprUpdate=!0,this.getVEObject().unselect(e),this.removeFromInfSelList(e),this.noInfChkAndExprUpdate=!1},updateToolbar:function(){if(1==this.options.isReadOnly)return;this.infinitySelection="FILTER"!=this.options.use;let e=UWA.createElement("div",{id:"cfgToolbar"}),t=this.getVEObject().getToolbar();t.insertBefore(e,t.firstChild),t.style.display="flex";let i=UWA.createElement("span",{class:"cfgVEExprView"});if(this.exprViewBtn=new l({displayStyle:"smartIcon",type:"check",icon:{iconName:"book-open",fontIconSize:"2x",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1,tooltipInfos:new a({shortHelp:p.CFG_Expression_View})}).inject(i),this.exprViewBtn.addEventListener("buttonclick",(e=>{this.cfgExpressionViewObj&&this.cfgExpressionViewObj.hideShowExpressionContainer()})),i.inject(e),"CONFIGRECORD"!=this.options.mode){this.infinityToggle=new s({id:"cfgVEInfinityToggle",type:"switch",label:p.Infinity,checkFlag:this.infinitySelection,tooltipInfos:new a({shortHelp:p.Infinity_Tooltip})}),this.infinityToggle.addEventListener("change",(e=>{this.infinitySelection=e.dsModel.checkFlag,this.toggleClickCount++}));let t=UWA.createElement("div",{class:"cfgVEInfToggle"});this.infinityToggle.inject(t),t.inject(e)}this.divider=UWA.createElement("div",{id:"cfgVEDivider"}),this.divider.addClassName("cfgVEdivider"),this.divider.inject(e)},callbacksFromVE:function(){this.updateToolbar(),this.getVEObject().subscribeEvent("select",(e=>{if(this.noInfChkAndExprUpdate)return;let t=e.data.nodeModel;this.infinitySelection&&(this.infRevisions.includes(t.options.grid.code)||this.infRevisions.push(t.options.grid.code),t.getAllDescendants().forEach((e=>{e.isSelected()||e._isTrueRoot()||e.isEmpty()||this.select(e,!0)}))),this.getVEObject().refreshListViewColumns(),this.IsExpressionModified=!0,this.updateExpression(t)})),this.getVEObject().subscribeEvent("unselect",(e=>{if(this.noInfChkAndExprUpdate)return;let t=e.data.nodeModel;this.removeFromInfSelList(t),this.infinitySelection&&t.getAllDescendants().forEach((e=>{!e.isSelected()||e._isTrueRoot()||e.isEmpty()||this.unselect(e)})),this.getVEObject().refreshListViewColumns(),this.IsExpressionModified=!0,this.updateExpression(t)})),this.undateExistingEff()},undateExistingEff:function(){if(null!=this.options.psJson&&this.options.psJson.length>0){this.existingEffUpdate=!0;if(this.allNodes=this.getVEObject().getObjects(),null!=this.options.psJson){let e=this.options.psJson,t="",i="",s=this.options.mode,n=e=>{let i=e.getAttributeValue("name"),n=e.getAttributeValue("code");return("XREVISION"==s||"CONFIGRECORD"==s||i==t.start.name)&&n==t.start.revision},o=e=>{let t=e.getAttributeValue("name"),n=e.getAttributeValue("code");return("XREVISION"==s||"CONFIGRECORD"==s||t==i.name)&&n==i.revision};for(let s=0;s<e.length;s++){t=e[s];let r=t.start.isRoot,a=this.allNodes.filter(n)[0];if(1==r){if((!t.start.IsExcluded||t.start.IsExcluded&&"false"===t.start.IsExcluded)&&this.select(a,!0),a.getAllDescendants().forEach((e=>{this.select(e,!0)})),0!=t.end.length)for(let e=0;e<t.end.length;e++){i=t.end[e];let s=this.allNodes.filter(o)[0];this.unselect(s),s.getAllDescendants().forEach((e=>{this.unselect(e)})),"false"==i.IsExcluded||0==i.IsExcluded?this.select(s):this.unselect(s)}this.getVEObject().refreshListViewColumns()}else this.select(a),this.getVEObject().refreshListViewColumns()}}else{let e=tree.getManager().getDocument().getAllDescendants();e.length>0&&(this.select(e[e.length-1]),this.select(e[e.length-1].__LISTVIEWCOPY__))}this.existingEffUpdate=!1}null!=this.options.displayexpression&&this.options.displayexpression.length>0&&("TRUE"==this.options.displayexpression?this.options.displayexpression=d.TRUE:"FALSE"==this.options.displayexpression&&(this.options.displayexpression=d.FALSE),this.cfgExpressionViewObj&&this.cfgExpressionViewObj.updateExpression(this.options.displayexpression),this.ExpJson.xml=this.options.xmlExpression,this.ExpJson.description=this.options.xmlDesc,this.ExpJson.json=this.options.psJson,this.CfgSelectedNode=this.getVEObject().getSelectedNodes())},removeFromInfSelList:function(e){let t=this.infRevisions.findIndex((t=>t==e.options.grid.code));-1!=t&&this.infRevisions.splice(t,1)},updateExpression:function(e){this.CfgSelectedNode=this.getVEObject().getSelectedNodes(),this.ExpJson=this.GetEvolutionExpressionAndJson(),"XREVISION"===this.options.mode||"CONFIGRECORD"===this.options.mode?(this.cfgExpressionViewObj&&this.cfgExpressionViewObj.updateExpression(this.getEvolutionDisplayExpression(e.options.label,this.options.mode,this.ExpJson)),i.xRevisionEvents.publish({event:"EvolutionExpressionUpdate"})):this.cfgExpressionViewObj&&this.cfgExpressionViewObj.updateExpression(this.getEvolutionDisplayExpression(this.options.ModelLabel,this.options.mode,this.ExpJson))},infColumnDef:function(){let e={},t={};return e.__Range__={columnDefFunction:e=>{e.insertDefaultColumns([{menuText:"Infinity",icon:{iconName:"infinity",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},dataIndex:"__Range__",width:35,isShowHideable:!0,isSortable:!1,isDraggable:!1,isEditable:!1,isHidden:!1,alwaysOn:!0,onCellRequest:e=>{if(!e.isHeader){let t=UWA.createElement("div",{html:e.nodeModel.isSelected()&&this.infRevisions&&this.infRevisions.includes(e.nodeModel.options.grid.code)?"<span style='font-weight:bold;color:Black' class='fonticon fonticon-infinity'/>":"",style:{"text-align":"center",width:"100%",height:"100%"},events:{mouseenter:function(i){t.tooltipInfos=new a({shortHelp:"Infinity Row "+e.rowID,updateModel:!1})}}});t.computeContentSize=function(){return 35},t.getTweakerPadding=function(){return 2},e.cellView.setReusableContent(t)}}}])}},t.__Range__=!0,{customizeColumnHash:e,customizeColumnAttributeHash:t}},getEvolutionDisplayExpression:function(e){let i=this.options.mode,s="";-1==this.ExpJson.xml.search("TreeSeries")?"PRODUCTS"==i?s=r.buildTreeSeries("ProductState",e,this.ExpJson.xml):"MANUFACTURINGPLAN"==i?s=r.buildTreeSeries("ManufPlan",e,this.ExpJson.xml):"XREVISION"!=i&&"CONFIGRECORD"!=i||(s=r.buildXRevision(this.ExpJson.xml)):s=this.ExpJson.xml;let n="";return n="XREVISION"===i||"CONFIGRECORD"==i?r.startxRevisionXML()+s+r.endxRevisionXML():this.ExpJson.description?r.startEvolutionXML()+s+"</Expression><Description>"+this.ExpJson.description+"</Description></CfgEffectivityExpression>":r.startFilterXML()+s+r.endFilterXML(),t.getDisplayExpressionUsingXSLT(n)},GetEvolutionExpressionAndJson:function(){let e={xml:"",json:[]},t=this.getVEObject().getRoots()[0];if(t){let i=[];if(this.allNodes||(this.allNodes=this.getVEObject().getObjects()),this.selectedNodesArray=[],this.CfgSelectedNode||(this.CfgSelectedNode=this.getVEObject().getSelectedNodes()),this.CfgSelectedNode.forEach((e=>{this.selectedNodesArray.push(e.options.id)})),this.selectedNodesArray.indexOf(t.options.id)>=0&&!this.infRevisions.includes(t.options.grid.code)){let e=t.options.grid.name,s=t.options.grid.revision,n=t.options.grid.title?t.options.grid.title:t.options.grid.name,r=o.getRange(e,s,n);i.push(r)}let s=null;this.parseEffectivity(s,t,i);let n=this.buildFilterXML(i);e.xml=n.xml,e.json=i,e.description=n.descTag}return e},buildFilterXML:function(e){let t="";null==window.DescriptionCount&&(window.DescriptionCount=1);let i={iCount:window.DescriptionCount,iDescriptionTag:[]};for(let s=0;s<e.length;s++)"XREVISION"===this.options.mode||"CONFIGRECORD"===this.options.mode?t+=e[s].buildxRevisionXML(i):t+=e[s].buildXML(i),i.iCount++,window.DescriptionCount++;return{xml:t,descTag:i.iDescriptionTag}},parseEffectivity:function(e,t,i){if(!t)return;let s=this.infRevisions.includes(t.options.grid.code);if(this.selectedNodesArray.indexOf(t.options.id)>=0&&s&&null==e){let s=t.options.grid.name,n=t.options.grid.revision,r=t.options.grid.title?t.options.grid.title:t.options.grid.name;e=o.getRange(s,n,r,!0),i.push(e)}let n=t.getChildren();n||(n=[]);let r=n.length;for(let t=0;t<r;t++){let s=n[t];if(!s.options.grid.label&&1==s.options.isEmpty)continue;let r="";const a=this.infRevisions.includes(s.options.grid.code);if(this.selectedNodesArray.indexOf(s.options.grid.id)>=0&&a?r="infinity":-1==this.selectedNodesArray.indexOf(s.options.grid.id)?r="unselected":this.selectedNodesArray.indexOf(s.options.grid.id)>=0&&!a&&(r="selected"),"unselected"!=r&&"selected"!=r||null==e){if("infinity"==r&&null!=e)this.parseEffectivity(e,s,i);else if("unselected"==r&&null==e)this.parseEffectivity(null,s,i);else if("infinity"==r&&null==e)this.parseEffectivity(null,s,i);else if("selected"==r&&null==e){let e=s.options.grid.name,t=s.options.grid.revision,n=s.options.grid.title?s.options.grid.title:s.options.grid.name,r=o.getRange(e,t,n,!1);i.push(r),this.parseEffectivity(null,s,i)}}else{let t=!0;"selected"==r&&(t=!1);let n=s.options.grid.name,o=s.options.grid.revision,a=s.options.grid.title?s.options.grid.title:s.options.grid.name;e.addLeaves(n,o,a,t),this.parseEffectivity(null,s,i)}}},get:function(){return this.ExpJson},getFrozenRevisions:async function(){const e=(new DOMParser).parseFromString(this.options.xmlExpression,"text/xml").getElementsByTagName("TreeSeries");if(!e||0==e.length)return;const t=e[0].getElementsByTagName("Root"),i=e[0].getElementsByTagName("Leaf"),s=e[0].getElementsByTagName("Single");for(let e=0;e<t.length;e++)this.frozenRevisions.push({rev:t[e].getAttribute("Revision"),name:t[e].getAttribute("Name")});for(let e=0;e<i.length;e++)this.frozenRevisions.push({rev:i[e].getAttribute("Revision"),name:i[e].getAttribute("Name")});for(let e=0;e<s.length;e++)this.frozenRevisions.push({rev:s[e].getAttribute("Revision"),name:s[e].getAttribute("Name")});this.frozenRevisions=await this.getIDsFromSearch()},getIDsFromSearch:function(){return new Promise((async(e,i)=>{if(0==this.frozenRevisions.length)return void e([]);let s="Products";"MANUFACTURINGPLAN"==this.options.mode&&(s="Manufacturing Plan");try{let i=this.frozenRevisions.map((e=>`(revision: ${e.rev} AND name : ${e.name})`)).join(" OR "),n=["ds6w:label","ds6w:type","ds6w:identifier","ds6wg:marketing_Name"],o=await t.getDataUsingSearch(`(flattenedtaxonomies:"types/${s}") AND (${i})`,n);if(o&&o.results&&Array.isArray(o.results)&&o.results.length>0){let t=[];o.results.forEach((e=>{if(e.attributes){let i=e.attributes.find((e=>{if("resourceid"==e.name)return e})).value;t.push(i)}})),e(t)}else e([])}catch(e){i(e)}}))},getManufPlanRevision:async function(){let e="";try{let i=await t.getDictionaryFromServer(this.options.modelID,"manufacturingPlans",null,"");return i&&i.manufacturingPlans&&(e=Array.isArray(i.manufacturingPlans)&&i.manufacturingPlans.length>0?i.manufacturingPlans[0].id.replace("pid:",""):i.manufacturingPlans.id.replace("pid:","")),e}catch(e){}}})})),define("DS/CfgVersionGraphUX/scripts/CfgVersionGraphModelManager",["DS/CfgVersionGraphUX/scripts/CfgTreeNodeModel"],(function(e){"use strict";return UWA.Class.extend({setModel:function(e){this._treeDocument=e,this._treeDocument.empty(),this._nodeArray=this._treeDocument._nodeList},createModel:function(t,i="asc"){this._treeDocument.prepareUpdate();for(var s=0;s<t.length;s++){var n=t[s].id,o=new Date(t[s].originated);const i=t[s].description;var r=t[s].name,a=t[s].revision,l=t[s].label,d=t[s].current,p=t[s].input,h=t[s].data.frozen,c=new e(n,r,l,a,d,p,!0,h,"",o,i);0===s?this._treeDocument.addChildNode(c,0,null,void 0,void 0,!0):t[s].parentid?this._treeDocument.addChildNode(c,0,this.getTreeNodeParent(t[s].parentid),void 0,void 0,!0):this._treeDocument.addChildNode(c,0,null,void 0,void 0,!0),t[s].children&&t[s].children.length>0&&this.addChild(t[s].children)}return this._treeDocument._isLoaded=!0,"asc"===i&&this._treeDocument._nodeList.reverse(),this._treeDocument.pushUpdate(),this._treeDocument},addChild:function(t){for(var i=0;i<t.length;i++){var s=this.getTreeNodeParent(t[i].parentid),n=t[i].id,o=new Date(t[i].originated);const g=t[i].description;var r=t[i].name,a=t[i].revision,l=t[i].label,d=t[i].current,p=t[i].input,h=t[i].data.frozen,c=new e(n,r,l,a,d,p,!0,h,"",o,g);"Derivation"===c.options.versionType?this._treeDocument.addChildNode(c,1,s,void 0,void 0,!0):this._treeDocument.addChildNode(c,0,s,void 0,void 0,!0),t[i].children&&t[i].children.length>0&&this.addChild(t[i].children),this._treeDocument.prepareAddDelete(),this._treeDocument.pushAddDelete()}},getTreeNodeParent:function(e){var t=null;if(this._treeDocument.getNodeByID){var i=this._treeDocument.getNodeByID(e);i&&(t=i)}else this._nodeArray.forEach((function(i){i.options.id==e&&(t=i)}));return t}})})),define("DS/CfgVersionGraphUX/scripts/CfgVersionGraph",["UWA/Core","DS/UIKIT/Iconbar","DS/UIKIT/Spinner","DS/Tweakers/GeneratedToolbar","DS/GraphListView/GraphListView","DS/CfgVersionGraphUX/scripts/CfgVersionGraphModelManager","DS/CfgVersionGraphUX/scripts/CfgVersionGraphColumnManager","DS/CfgBaseUX/scripts/CfgToggle","DS/CfgBaseUX/scripts/CfgData","DS/CfgEvolutionUX/CfgEvolutionUtils","DS/CfgBaseUX/scripts/CfgEffectivityExpressionContainer","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUX","i18n!DS/CfgVersionGraphUX/assets/nls/CfgVersionGraphNLS","css!DS/CfgVersionGraphUX/CfgVersionGraphUX.css"],(function(e,t,i,s,n,o,r,a,l,d,p,h,c){"use strict";return n.extend({_options:void 0,listViewClickCount:0,CfgExpressionBox:!1,CfgExpressionBoxMaximized:!1,CfgSelectedNode:null,CfgSelectedModel:null,VersionGraphModelMgr:null,MainContainer:null,CfgToolbarContainer:null,VersionGraphContainer:null,ExpJson:{xml:"",json:[],iDescriptionTag:[]},IsExpressionModified:!1,getVersionGraph:function(){return this.MainContainer},get:function(){return this.ExpJson},init:function(t){var n=this;this.MainContainer=e.createElement("div",{class:"versionGraphMainContainer",styles:{width:"100%",height:"100%",display:"flex",flexDirection:"column"}}),this.VersionGraphContainer=e.createElement("div",{class:"versionGraphContainer",html:'<div class="version-subway-canvas"></div>',styles:{width:"100%",border:"1px solid #D4D4D4",height:"calc(100% - 40px)",borderRadius:"5px"}}),this.ExpJson={xml:"",json:[],description:[]},this._options=e.extend({container:n.VersionGraphContainer.getElement(".version-subway-canvas"),columnManager:new r(t),allowUnsafeHTMLContent:!0,defaultCellHeight:48,enableListSelection:!1,highlightNodesOnSelect:!0,highlightParentEdgesOnNodeSelect:!0,graphSortingColumnID:["creationDate","revision"],selection:{canMultiSelect:!0,isDraggable:!1,unselectAllOnEmptyArea:!1,nodes:!t.isReadOnly},onDragStartCell:function(e,t){"__GRAPH__"===!t.dataIndex&&"function"==typeof fn?fn(e,t):e.preventDefault()}},t),this._parent(this._options),this._options.displayCompactMode=null!=this._options.displayCompactMode&&null!=this._options.displayCompactMode&&1==this._options.displayCompactMode,this._options.isReadOnly=null!=this._options.isReadOnly&&null!=this._options.isReadOnly&&1==this._options.isReadOnly,this.highlightNodesOnSelect=!0,this.graphSpinner=new i({className:"evolutionSpinner"}).inject(this._options.container),this.graphSpinner.spin(),this.CfgToolbarContainer=e.createElement("div",{class:"graphToolbarContainer"});var o={displayCompactMode:n._options.displayCompactMode,toggleID:"cfgInfiniteToggle",toggleLabel:c.Infinity_SelectionMode,toggleTooltip:c.Infinity_Tooltip,width:"auto"};this.infiniteToggle=new a(o),this.infiniteToggleContainer=this.infiniteToggle.render(),this.expressionToolbarContainer=e.createElement("div",{class:"expressionToolbarContainer"});const d={entries:[{id:"cfgBookIcon",tooltip:c.CFG_Expression_View,dataElements:{typeRepresentation:"functionIcon",value:e=>this.bookIconCB(e)},icon:{iconName:"book-open wux-ui-3ds",fontIconFamily:1,className:"cfgBookActive"},position:"far",domId:"cfgBookIcon"}]};var h=s.prototype.createTreeDocument(d);this.expressionToolbar=new s({direction:"horizontal",items:h}),this.expressionToolbar.inject(n.expressionToolbarContainer),this.infiniteToggleContainer.inject(this.CfgToolbarContainer),this.expressionToolbarContainer.inject(this.CfgToolbarContainer),this._manager.onCellRequest((function(e){if(1==e.nodeModel._options.data.frozen?(e.view.addClassName("disablerow"),l._hasFrozenNodeInExpression=!0):e.view.removeClassName("disablerow"),"creationDate"===e.dataIndex){let t=e.nodeModel.options.grid[e.dataIndex].toLocaleString(),i=e.cellView.getContent();i.setHTML(t),i.tooltipInfos&&(i.tooltipInfos.shortHelp=t)}})),"FILTER"!=this._options.use&&this.infiniteToggle.setToggleState(!0),this.CfgExpressionBox=!0;e.createElement("div",{styles:{height:"100%"},html:[this.CfgToolbarContainer,this.VersionGraphContainer]}).inject(this.MainContainer),t={effArea:"",effExpHeaderTitle:c.CFG_Expression,viewContainer:n.MainContainer,defaultExpressionContainerHeight:70,inputData:"",displayCompactMode:this._options.displayCompactMode,minimizeTooltip:c.CFG_Minimize_EBox,maximizeTooltip:c.CFG_Max_EBox};this.cfgExpressionViewObj=new p(t),this.cfgExpressionViewObj.render(),this.applyCompactComfortableMode(),1==this._options.isReadOnly&&this.hideToolbarAndExpressionBox(),this.graphSpinner.show(),n.listViewClickCount=0},applyCompactComfortableMode:function(){1==this._options.displayCompactMode?this._manager.touchMode=!1:this._manager.touchMode=!0},render:function(e,t="asc"){this.allNodesArray=e,this.sortOrder=t;var i=this;if(this.VersionGraphModelMgr=new o,this.VersionGraphModelMgr.setModel(this.getModel()),this.VersionGraphModelMgr.createModel(e,this.sortOrder),this.activate(!0),this.VersionGraphContainer.querySelector(".wux-tree-treelistview").setAttribute("style","height:100% !important;"),this._manager.forceMultiSelection(!0),null!=i._options.psJson&&i._options.psJson.length>0){var s="<span style='font-weight:bold' class='fonticon fonticon-infinity'/>";this._manager.prepareUpdateView(),i._model.getAllDescendants().forEach((function(e){if(null!=i._options.psJson)for(var t=i._options.psJson,n=t.length,o=0;o<n;o++){var r=t[o],a=r.start.isRoot;if(e.options.name==r.start.name&&e.options.revision==r.start.revision)if(1==a){(!r.start.IsExcluded||r.start.IsExcluded&&"false"===r.start.IsExcluded)&&(e.select(),e.__LISTVIEWCOPY__.select(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:s}})),e.getAllDescendants().forEach((function(e){e.__LISTVIEWCOPY__&&(e.select(),e.__LISTVIEWCOPY__.select(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:s}}))}));if(1==e.isRoot())for(var l=i._model.getAllDescendants(),d=l.length,p=0,h=0;h<d;h++){var c=l[h];a=c.isRoot();1==p&&1==a&&(c.select(),c.__LISTVIEWCOPY__.select(),c.__LISTVIEWCOPY__.updateOptions({grid:{range:s}}),c.getAllDescendants().forEach((function(e){e.__LISTVIEWCOPY__&&(e.select(),e.__LISTVIEWCOPY__.select(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:s}}))}))),1==a&&e.options.name==c.options.name&&e.options.revision==c.options.revision&&(p=1)}if(0!=r.end.length)for(n=r.end.length,o=0;o<n;o++){var g=r.end[o];i._model.getAllDescendants().forEach((function(e){if(e.options.name==g.name&&e.options.revision==g.revision){e.unselect(),e.__LISTVIEWCOPY__.unselect(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:""}}),e.getAllDescendants().forEach((function(e){e.__LISTVIEWCOPY__&&(e.unselect(),e.__LISTVIEWCOPY__.unselect(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:""}}))}));if(1==e.isRoot())for(var t=i._model.getAllDescendants(),s=t.length,n=0,o=0;o<s;o++){var r=t[o],a=r.isRoot();1==n&&1==a&&(r.unselect(),r.__LISTVIEWCOPY__.unselect(),r.__LISTVIEWCOPY__.updateOptions({grid:{range:""}}),r.getAllDescendants().forEach((function(e){e.__LISTVIEWCOPY__&&(e.unselect(),e.__LISTVIEWCOPY__.unselect(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:""}}))}))),1==a&&e.options.name==r.options.name&&e.options.revision==r.options.revision&&(n=1)}"false"==g.IsExcluded||0==g.IsExcluded?(e.select(),e.__LISTVIEWCOPY__.select()):(e.unselect(),e.__LISTVIEWCOPY__.unselect())}}))}}else e.select(),e.__LISTVIEWCOPY__.select()}else{var f=tree.getManager().getDocument().getAllDescendants();f.length>0&&(f[f.length-1].select(),f[f.length-1].__LISTVIEWCOPY__.select())}})),i._manager.pushUpdateView(),this._updateGraphSelection()}null!=i._options.displayexpression&&i._options.displayexpression.length>0&&("TRUE"==i._options.displayexpression?i._options.displayexpression=h.TRUE:"FALSE"==i._options.displayexpression&&(i._options.displayexpression=h.FALSE),i.cfgExpressionViewObj.updateExpression(i._options.displayexpression),i.ExpJson.xml=i._options.xmlExpression,i.ExpJson.description=i._options.xmlDesc,i.ExpJson.json=i._options.psJson,i._model&&(i.CfgSelectedNode=i._model.getXSO().get())),this.graphSpinner.hide()},updateExpression:function(e){this.CfgSelectedNode=e.getTreeDocument().getXSO().get(),this.CfgSelectedModel=this._model,this.ExpJson=d.GetEvolutionExpressionAndJson(this.CfgSelectedModel,this._options.mode),"XREVISION"===this._options.mode?(this.cfgExpressionViewObj.updateExpression(d.getEvolutionDisplayExpression(e.options.label,this._options.mode,this.ExpJson)),l.xRevisionEvents.publish({event:"EvolutionExpressionUpdate"})):this.cfgExpressionViewObj.updateExpression(d.getEvolutionDisplayExpression(this._options.ModelLabel,this._options.mode,this.ExpJson))},onSelectListView:function(e){var t=e.data.nodeModel.__MASTER__;if(1!=t.__LISTVIEWCOPY__.options.data.frozen&&!this._model.getXSO().isIn(t)){var i=this;i.listViewClickCount++;var s="<span style='font-weight:bold' class='fonticon fonticon-infinity'/>";this._manager.prepareUpdateView(),t.select(),1==this.infiniteToggle.getToggleState()&&(t.__LISTVIEWCOPY__.updateOptions({grid:{range:s}}),i.graphSpinner.show(),t.getAllDescendants().forEach((function(e){i._model.getXSO().isIn(e)||e._isTrueRoot()||e.isEmpty()||0!=e.__LISTVIEWCOPY__.options.data.frozen||(e.select(),e.__LISTVIEWCOPY__&&(e.__LISTVIEWCOPY__.select(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:s}})))})),i.graphSpinner.hide()),this.IsExpressionModified=!0,this.updateExpression(t),this._manager.pushUpdateView(),this._updateGraphSelection()}},onUnselectListView:function(e){var t=e.data.nodeModel.__MASTER__;if(1!=t.__LISTVIEWCOPY__.options.data.frozen&&this._model.getXSO().isIn(t)){var i=this;i.listViewClickCount++,this._manager.prepareUpdateView(),t.unselect(),1==this.infiniteToggle.getToggleState()?(t.__LISTVIEWCOPY__.updateOptions({grid:{range:""}}),i.graphSpinner.show(),t.getAllDescendants().forEach((function(e){!i._model.getXSO().isIn(e)||e._isTrueRoot()||e.isEmpty()||0!=e.__LISTVIEWCOPY__.options.data.frozen||(e.unselect(),e.__LISTVIEWCOPY__&&(e.__LISTVIEWCOPY__.unselect(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:""}})))})),i.graphSpinner.hide()):t.__LISTVIEWCOPY__.updateOptions({grid:{range:""}}),this.IsExpressionModified=!0,this.updateExpression(t),this._manager.pushUpdateView(),this._updateGraphSelection()}},_addEventListeners:function(){this._addEvent("LISTVIEWMODEL","select",this.onSelectListView.bind(this)),this._addEvent("LISTVIEWMODEL","unselect",this.onUnselectListView.bind(this)),this._addEvent("MASTER","prepareAddDelete",this.prepareUpdateView.bind(this)),this._addEvent("MASTER","pushAddDelete",this.pushUpdateViewAndUpdateGraph.bind(this)),this._addEvent("MASTER","empty",this.empty.bind(this)),this._addEvent("MASTER","attributeChanged",this.onMasterNodeAttributeChanged.bind(this)),this._addEvent("MASTER","attributeChanged",this.onNodeAttributeChange.bind(this)),this._addEvent("LISTVIEWMANAGER","sort",this.onSort.bind(this)),this._addEvent("LISTVIEWMANAGER","dblClick",function(e){var t=e.nodeModel.__MASTER__;"function"==typeof this.options.onNodeDoubleClick&&this.options.onNodeDoubleClick(t)}.bind(this)),this._addEvent("LISTVIEWMANAGER","attributeChanged",this.onNodeAttributeChange.bind(this)),this._addEvent("LISTVIEWMANAGER","UPDATE_VIEW_COMPLETED",this.onUpdateViewComplete.bind(this)),this._isActivated=!0},onNodeAttributeChange:function(e){"__isActive__"===(e.data||e).changedAttribute&&this.onUpdateViewComplete()},onUpdateViewComplete:function(){for(var e,t=this._manager,i=0,s=this._treeDoc.getAllDescendants(),n=s.length;i<n;i+=1)t[(e=s[i]).isActive()?"addRowClass":"removeRowClass"](e._getRowID(),"version-explorer-subway-listview-active-version")},onSort:function(e){this._manager;"revision"===e.columnDataIndex||"creationDate"===e.columnDataIndex?(this.options.ascending="asc"===e.sortOrder,this._clearGraph(),this._updateGraph()):"__GRAPH__"===e.columnDataIndex&&(this.sortOrder="asc"===this.sortOrder?"desc":"asc",this.render(this.allNodesArray,this.sortOrder))},hideToolbarAndExpressionBox:function(){this.cfgExpressionViewObj.hideShowExpressionContainer(),this.CfgToolbarContainer.hide(),this.VersionGraphContainer.setStyles({height:"100%"})},bookIconCB:function(e){!1===this.CfgExpressionBox?(this.expressionToolbar.updateNodeModel("cfgBookIcon",{icon:{className:"cfgBookActive"}}),this.CfgExpressionBox=!0,this.cfgExpressionViewObj.hideShowExpressionContainer()):(this.expressionToolbar.updateNodeModel("cfgBookIcon",{icon:{className:"cfgBookInActive"}}),this.CfgExpressionBox=!1,this.cfgExpressionViewObj.hideShowExpressionContainer())}})}));