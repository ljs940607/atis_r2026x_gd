define("DS/VCXWebDressup/VCXMagnetLine/VCXMagnetLineManagerModifiable",["DS/VCXWebModifiables/VCXModifiable","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueMap"],(function(e,t,i,r,a,o,s,n){"use strict";return e.extend({init:function(e){this._Properties=[]},BuildProp:function(e,r,a){var o=new i(e,1),s=new r;s.Value=a,this._Properties[e]=new t(o,s),this.SetProperty(e,s)},Build:function(){this._parent()},SetProperty:function(e,r){var a=new i(e,0);this._Properties[e]=new t(a,r.Clone())},OnChangeProperty:function(e,t,i){if(i||(i={}),i.fromChildClass);else if(this.OnChangePropertyBegin(e,t))return!0;this.SetProperty(e,t)},OnChangePropertiesEnd:function(){this.GetObject().update&&this.GetObject().update()},GetProperty:function(e){var i=null;return void 0!==this._Properties[e]&&(i=new t(this._Properties[e].GetPropertyInfo(),this._Properties[e].GetPropertyValue().Clone())),i},GetProperties:function(e){var t=new r;for(var i in this._Properties)this._Properties.hasOwnProperty(i)&&t.AddOrModifyProperty(this.GetProperty(i));return t}})})),define("DS/VCXWebDressup/VCXIDressupModifiable",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})),define("DS/VCXWebDressup/VCXComponentDressupGrp",["UWA/Class","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],(function(e,t){"use strict";var i=e.extend({init:function(){this._parent(),this._name="Others",this._nlsName=""},GetType:function(){return this.componentType},setName:function(e){this._name=e},getName:function(){return this._name},getNLSName:function(){return this._nlsName?this._nlsName:t["TreeNode."+this.getName()]},setNLSName:function(e){this._nlsName=e},getNLSName_:function(){return t["TreeNode."+this.getName()]},descriptionDump:function(){return{name:this.getName(),type:this.componentType}}});return Object.defineProperty(i.prototype,"componentType",{enumerable:!0,get:function(){return"VCXComponentDressupGrp"}}),i}));var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXDressup_Spec",["require","exports","DS/VCXWebExperienceBase/VCXComponentOccurrenceExperience"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{constructor(){super(),this._previousAnchors=[],this._pointedObjectMoved=null,this.componentType.startsWith("VCXComponent")&&(this._name=this.componentType.slice(12)),this._dirty=!1,this._isPickerSensitive=!1,this._postUpdateShouldBeDone=!1}GetType(){return this.componentType}getWorkingRootComponent(){var e=this.QueryInterface("VCXIModelNavigable");if(e){var t=e?.getWorkingRoot();return t?t.GetObject():(console.error("No working root for modifiable ??"),null)}console.warn("Not a navigable ??")}getWorkingRootPathElement(){var e=this.getWorkingRootComponent();if(e)return e.QueryInterface("W3AISGNodeHolder").getPathElement()}setDirty(e){this._dirty=void 0===e||e;var t=this.QueryInterface("W3AISGNodeHolder");t&&t.setSGNodeDirty(this._dirty),this._dirty&&this._experienceBase.getManager("VCXDressupManager").SetDirty()}isDirty(){return this._dirty}update(e){this._postUpdateShouldBeDone=!0;var t=this.QueryInterface("W3AISGNodeHolder");t&&t.update&&t.update(e)&&this._experienceBase.getManager("VCXContextManager").renderAll()}postUpdate(e){if(this._pointedObjectMoved=null,this._postUpdateShouldBeDone){this._postUpdateShouldBeDone=!1;var t=this.QueryInterface("W3AISGNodeHolder");t&&t.postUpdate&&t.postUpdate(e),this.isDirty()&&this.setDirty(!1),this._dirtyMask=0}}preRender(e){var t=this.QueryInterface("W3AISGNodeHolder");t&&t.preRender&&t.preRender(e)}postRender(e){var t=this.QueryInterface("W3AISGNodeHolder");t&&t.postRender&&t.postRender(e)}descriptionDump(){return{name:this._name,type:this.componentType}}get IsPickerSensitive(){return this._isPickerSensitive}set IsPickerSensitive(e){this._isPickerSensitive=e}get IsDressup(){return!0}}return function(e){let t;!function(e){e[e.NoFreeze=0]="NoFreeze",e[e.Freeze=1]="Freeze",e[e.FreezeInPlay=2]="FreezeInPlay"}(t=e.EFreeze||(e.EFreeze={}))}(r||(r={})),Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXDressup_Spec"}}),r.prototype.dressupGroupName="",r.prototype.getDefaultName=function(){return"Dressup"},r})),define("DS/VCXWebDressup/VCXPartList/VCXPartListPrepareRenderToTexture",["require","exports","DS/VCXWebVisualization/VCXAPrepareRenderToTexture"],(function(e,t,i){"use strict";return class extends i{constructor(){super(),this._nRows=0,this._nColumns=0,this._tableColumns=[],this.VCX_PT2MM=.3527,this._emptyPartList=!1}async prepareRender(){}_getPixelToMMInUI(e,t){const i=this.GetObject()?._experienceBase.getManager("VCXPaperManager"),r=this.GetObject()?._experienceBase.getManager("VCXGUIManager");if(i&&r){const a=i._PaperSize.x,o=i._PaperSize.y,s=Number(t.attributes.width.value),n=Number(t.attributes.height.value);let l={x:0,y:0};const p=r.ComputePositionInUI(e);return e.x&&(l.x=i.PixelToMMX(p.x)/a*s),e.y&&(l.y=i.PixelToMMY(p.y)/o*n),l}return{x:0,y:0}}partList_Getters(e,t){switch(e){case"text":var i=[];t&&(this._nRows=t.getChildren().length);for(let e=0;e<this._nRows;e++){i[e]=[],this._tableColumns=t.getChildren()[e].getChildren(),this._nColumns=this._tableColumns.length;for(let t=0;t<this._nColumns;t++)void 0!==this._tableColumns[t].getText()&&(i[e][t]=this._tableColumns[t].getText())}return i;case"textStartCoordinates":let e=[];t&&(this._nRows=t.getChildren().length);for(let i=0;i<this._nRows;i++){e[i]=[],this._tableColumns=t.getChildren()[i].getChildren(),this._nColumns=this._tableColumns.length;for(let t=0;t<this._nColumns;t++)void 0!==this._tableColumns&&null!==this._tableColumns&&(e[i][t]={x:this._tableColumns[t].getChildren()[0].getBoundingClientRect().left,y:this._tableColumns[t].getChildren()[0].getBoundingClientRect().top})}return e;case"textEndCoordinates":let o=[];t&&(this._nRows=t.getChildren().length);for(let e=0;e<this._nRows;e++){o[e]=[],this._tableColumns=t.getChildren()[e].getChildren(),this._nColumns=this._tableColumns.length;for(let t=0;t<this._nColumns;t++)void 0!==this._tableColumns&&null!==this._tableColumns&&(o[e][t]={x:this._tableColumns[t].getChildren()[0].getBoundingClientRect().right,y:this._tableColumns[t].getChildren()[0].getBoundingClientRect().top})}return o;case"textCenterCoordinates":let s=[];t&&(this._nRows=t.getChildren().length);for(let e=0;e<this._nRows;e++){s[e]=[],this._tableColumns=t.getChildren()[e].getChildren(),this._nColumns=this._tableColumns.length;for(let t=0;t<this._nColumns;t++)void 0!==this._tableColumns&&null!==this._tableColumns&&(s[e][t]={x:(this._tableColumns[t].getChildren()[0].getBoundingClientRect().left+this._tableColumns[t].getChildren()[0].getBoundingClientRect().right)/2,y:this._tableColumns[t].getChildren()[0].getBoundingClientRect().top})}return s;case"column_width":if(t)var r=t.getChildren()[0];var a=[];for(let e=0;e<r.getChildren().length;e++)a.push(r.getChildren()[e].getBoundingClientRect().width);return a;case"row_height":if(t)return t.getChildren()[1].getBoundingClientRect().height;case"row_length":return t.getChildren().length;case"position":if(t)return[t.getBoundingClientRect().x,t.getBoundingClientRect().y];break;case"font_size":if(t)return parseFloat(t.style.fontSize);break;case"text_alignment":if(t)return t.getChildren()[0].getChildren()[0].getStyle("justify-content");break;default:console.error("Invalid parameter!")}}async postRender(e,t){if("normal"===t||"normalLPR"===t){const t=e.canvas,s=t.getContext("2d");let n=[],l=document.getElementById("partListTableContainer");if(null==l)return;let p,u,h=l.children;for(let e=0;e<h.length;e++)"divBom"==h[e].getAttribute("id")&&(p=h[e]);let d=this.GetObject()?._experienceBase.getManager("VCXPaperManager");d.updatePaper();let c=this.GetObject()?.QueryInterface("W3AISGNodeHolder");var i=c?.giveSGNode();if(!i)return;var r=i.GetOpacity(e);let C=this.GetObject()?.QueryInterface("VCXIModifiable");if(!C)return;const y=d._PaperSize.x,m=d._PaperSize.y,V=Number(t.attributes.width.value),f=Number(t.attributes.height.value);u=p.getChildren(),this._emptyPartList="divBomEmptyRow"===u[1].getAttribute("id"),n=Array.from(document.querySelectorAll(".Part_List"));for(let e=0;e<n.length;e++){const i=this.partList_Getters("position",n[e]),p=this._getPixelToMMInUI({x:i[0],y:i[1]},t),u=p.x,h=p.y,c=this.partList_Getters("column_width",n[e]),b=this.partList_Getters("row_length",n[e]),P=c.length;let g=this.partList_Getters("row_height",n[e]);const _=1,M=this.partList_Getters("text",n[e]),S=parseFloat(l.style.transform.replace(/[A-Za-z$-()]/g,""));let D=this.partList_Getters("font_size",l)*S;const G=this.partList_Getters("text_alignment",n[e]);for(let e=0;e<c.length;e++)c[e]=d.PixelToMM(c[e]),c[e]/=y,c[e]*=V;g=d.PixelToMM(g),g/=m,g*=f,D=d.PixelToMM(D),D/=m,D*=f;const x=c.reduce(((e,t)=>e+t),0);let X,v,A,I;switch(G){case"start":default:X=this.partList_Getters("textStartCoordinates",n[e]);break;case"justify":v=this.partList_Getters("textStartCoordinates",n[e]);break;case"end":A=this.partList_Getters("textEndCoordinates",n[e]);break;case"center":X=this.partList_Getters("textStartCoordinates",n[e]),I=this.partList_Getters("textCenterCoordinates",n[e])}let w=C.GetProperty("Collab.PartList.Body.ConsiderAlternateColor").GetPropertyValue().GetValue(),T=C.GetProperty("Collab.PartList.Header.Background.Color").GetPropertyValue().GetValue();T.a=C.GetProperty("Collab.PartList.Header.Background.Color.Opacity").GetPropertyValue().GetValue()*r;let N=C.GetProperty("Collab.PartList.Body.Row.Color").GetPropertyValue().GetValue();var a;if(N.a=C.GetProperty("Collab.PartList.Body.Row.Color.Opacity").GetPropertyValue().GetValue()*r,w)(a=C.GetProperty("Collab.PartList.Body.SecondRow.Color").GetPropertyValue().GetValue()).a=C.GetProperty("Collab.PartList.Body.SecondRow.Color.Opacity").GetPropertyValue().GetValue()*r;else(a=C.GetProperty("Collab.PartList.Body.Row.Color").GetPropertyValue().GetValue()).a=C.GetProperty("Collab.PartList.Body.Row.Color.Opacity").GetPropertyValue().GetValue()*r;let B=C.GetProperty("Collab.PartList.Header.Text.Color").GetPropertyValue().GetValue();B.a=C.GetProperty("Collab.PartList.Header.Text.Color.Opacity").GetPropertyValue().GetValue()*r;let E,L,O=C.GetProperty("Collab.PartList.Container.Text.Color").GetPropertyValue().GetValue();if(O.a=C.GetProperty("Collab.PartList.Container.Text.Color.Opacity").GetPropertyValue().GetValue()*r,s.strokeStyle=`rgba(0,0,0,${r})`,s.lineWidth=_,this._emptyPartList)for(let i=0;i<2;i++)for(let r=0,l=0;r<P&&(!i||!r);r++){let p;p=i?x:c[r];const d=i*g;0===i?(E=`rgb(${255*T.r},${255*T.g},${255*T.b},${T.a})`,L=`rgb(${255*B.r},${255*B.g},${255*B.b},${B.a})`):w?i%2?(E=`rgb(${255*N.r},${255*N.g},${255*N.b},${N.a})`,L=`rgb(${255*O.r},${255*O.g},${255*O.b},${O.a})`):(E=`rgb(${255*a.r},${255*a.g},${255*a.b},${a.a})`,L=`rgb(${255*O.r},${255*O.g},${255*O.b},${O.a})`):(E=`rgb(${255*N.r},${255*N.g},${255*N.b},${N.a})`,L=`rgb(${255*O.r},${255*O.g},${255*O.b},${O.a})`),s.fillStyle=E,s.fillRect(u+l,h+d,p,g);var o=C.GetProperty("Collab.Text.Font").GetPropertyValue().GetValue()[0];i?(s.fillStyle="rgb(193,198,201)",s.font=`italic ${D}px ${o._value}`):(s.fillStyle=L,s.font=`normal ${D}px ${o._value}`),s.textBaseline="middle";const y=this.partList_Getters("textStartCoordinates",n[e]);if(M[i][r]&&y[i][r]){const e=this._getPixelToMMInUI({x:y[i][r].x,y:y[i][r].y},t);s.textAlign="start",s.fillText(M[i][r],e.x,e.y??+g/2)}l+=p}else for(let e=0;e<b;e++)for(let i=0,r=0;i<P;i++){const n=c[i],l=e*g;0===e?(E=`rgb(${255*T.r},${255*T.g},${255*T.b},${T.a})`,L=`rgb(${255*B.r},${255*B.g},${255*B.b},${B.a})`):w?e%2?(E=`rgb(${255*N.r},${255*N.g},${255*N.b},${N.a})`,L=`rgb(${255*O.r},${255*O.g},${255*O.b},${O.a})`):(E=`rgb(${255*a.r},${255*a.g},${255*a.b},${a.a})`,L=`rgb(${255*O.r},${255*O.g},${255*O.b},${O.a})`):(E=`rgb(${255*N.r},${255*N.g},${255*N.b},${N.a})`,L=`rgb(${255*O.r},${255*O.g},${255*O.b},${O.a})`),s.fillStyle=E,s.fillRect(u+r,h+l,n,g);o=C.GetProperty("Collab.Text.Font").GetPropertyValue().GetValue()[0];switch(s.fillStyle=L,s.font=`normal ${D/window.devicePixelRatio}px ${o._value}`,s.textBaseline="middle",G){case"start":if(M[e][i]&&X[e][i]){s.textAlign="start";const a=this._getPixelToMMInUI({x:X[e][i].x,y:X[e][i].y},t);if("#"===M[e][i][0]&&7===M[e][i].length){let t=a.x-(u+r),o=g/100*10;s.fillStyle=M[e][i],s.fillRect(a.x,h+l+o,n-2*t,g-2*o)}else s.fillText(M[e][i],a.x,h+l+g/2)}break;case"justify":if(M[e][i]&&v[e][i]){s.textAlign="start";const a=this._getPixelToMMInUI({x:v[e][i].x,y:v[e][i].y},t);if("#"===M[e][i][0]&&7===M[e][i].length){let t=a.x-(u+r),o=g/100*20;s.fillStyle=M[e][i],s.fillRect(a.x,h+l+o,n-2*t,g-2*o)}else s.fillText(M[e][i],a.x,h+l+g/2)}break;case"end":if(M[e][i]&&A[e][i]){s.textAlign="end";const a=this._getPixelToMMInUI({x:A[e][i].x,y:A[e][i].y},t);if("#"===M[e][i][0]&&7===M[e][i].length){let t=a.x-(u+r),o=g/100*20;s.fillStyle=M[e][i],s.fillRect(a.x,h+l+o,n-2*t,g-2*o)}else s.fillText(M[e][i],a.x,h+l+g/2)}break;case"center":if(M[e][i]&&I[e][i]){let a=this._getPixelToMMInUI({x:I[e][i].x,y:I[e][i].y},t);if("#"===M[e][i][0]&&7===M[e][i].length){a=this._getPixelToMMInUI({x:X[e][i].x,y:X[e][i].y},t),s.textAlign="start";let o=a.x-(u+r),p=g/100*20;s.fillStyle=M[e][i],s.fillRect(a.x,h+l+p,n-2*o,g-2*p)}else s.textAlign="center",s.fillText(M[e][i],a.x,h+l+g/2)}break;default:if(M[e][i]&&X[e][i]){const a=this._getPixelToMMInUI({x:X[e][i].x,y:X[e][i].y},t);if(s.textAlign="start","#"===M[e][i][0]&&7===M[e][i].length){let t=a.x-(u+r),o=g/100*20;s.fillStyle=M[e][i],s.fillRect(a.x,h+l+o,n-2*t,g-2*o)}else s.fillText(M[e][i]??"",a.x,h+l+g/2)}}r+=n}for(let e=0;e<=b;e++)s.beginPath(),s.moveTo(u,h+(e*g+_/2)),s.lineTo(u+x,h+(e*g+_/2)),s.strokeStyle="#F1F1F1",s.stroke();let W=u;for(const e of c)s.beginPath(),s.moveTo(W+e-_/2,h),this._emptyPartList?s.lineTo(W+e-_/2,h+1*g):s.lineTo(W+e-_/2,h+b*g),s.strokeStyle="#F1F1F1",s.stroke(),W+=e;s.beginPath(),s.moveTo(u+_/2,h),s.lineTo(u+_/2,h+b*g),s.strokeStyle="#F1F1F1",s.stroke(),s.beginPath(),s.moveTo(u+x-_/2,h),s.lineTo(u+x-_/2,h+b*g),s.strokeStyle="#F1F1F1",s.stroke()}d.updatePaper({viewportSize:e.viewportSize})}}GetType(){return"VCXPartListPrepareRenderToTexture"}}})),define("DS/VCXWebDressup/VCXSection/VCXSectionManager",["UWA/Class","DS/Visualization/ClippingContext","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/VCXWebModifiables/VCXModelChangeListener","DS/CoreEvents/Events"],(function(e,t,i,r,a){"use strict";var o=e.extend({init:function(){},postInitialize:function(){this._clippingContext=null,this._activeSections={};var e=this;this.event_VCX_VIEWER_ADDED=a.subscribe({event:"VCX_VIEWER_ADDED"},(function(){e.Dirty=!0,e._cappingActive=null})),this.VCX_DRESSUPS_ADDED=a.subscribe({event:"VCX_DRESSUPS_ADDED"},(function(t){e.registerSections(t)})),this.VCX_DRESSUPS_PREREMOVED=a.subscribe({event:"VCX_DRESSUPS_PREREMOVED"},(function(t){e.unregisterSections(t)}))},getUpdatePriority:function(){return 3},unInitialize:function(){if(a.unsubscribe(this.VCX_DRESSUPS_ADDED),delete this.VCX_DRESSUPS_ADDED,a.unsubscribe(this.VCX_DRESSUPS_PREREMOVED),delete this.VCX_DRESSUPS_PREREMOVED,a.unsubscribe(this.event_VCX_VIEWER_ADDED),delete this.event_VCX_VIEWER_ADDED,this._overrideSet){var e=this._overrideSet;this._clippingOverride&&this._overrideSet.deleteOverride(this._clippingOverride),this._experienceBase.getManager("VCXContextManager").applyToViewers((function(t){t.getSceneGraphOverrideSetManager().removeSceneGraphOverrideSet(e)})),delete this._overrideSet}this._clippingOverride&&(this._clippingOverride.setClippingContext(null),delete this._clippingOverride),this._activeSections&&delete this._activeSections,this._clippingContext&&delete this._clippingContext,this._cutObjects&&delete this._cutObjects},update:function(e){if(this.Dirty){a.publish({event:"VCX_SECTION_LIST_CHANGED",data:this._activeSections}),this.Dirty=!1;var r=[];if(this._overrideSet){var o=this._overrideSet;this._experienceBase.getManager("VCXContextManager").applyToViewers((function(e){e.getSceneGraphOverrideSetManager().removeSceneGraphOverrideSet(o)})),this._overrideSet=null}var s=1,n=0,l=!1;for(var p in this._activeSections){var u=this._activeSections[p];r.push(u._plane);var h=u.QueryInterface("VCXIModifiable");h.GetPropertyValue("Section.SpaceBackAlpha")<h.GetPropertyValue("Section.SpaceFrontAlpha")&&(s=0,n=1),h.GetPropertyValue("Section.Capping")&&(l=!0)}if(this._cappingActive!==l&&(this._cappingActive=l,this._experienceBase.getManager("VCXContextManager").applyToViewers((function(e){l?(e.setRenderPriority(!1),e.setSectionCapping(!0)):e.setSectionCapping(!1)}))),0===r.length)return;for(var p in this._clippingContext=new t,this._clippingContext.setPlanes(r),this._clippingContext.setFrontAndBackOpacity(s,n),this._activeSections){u=this._activeSections[p];this._clippingContext.setSectionCappingMaterial(u._cappingMaterial,u._plane)}for(var p in this._cutObjects=[],this._activeSections){var d=!1,c=(u=this._activeSections[p]).QueryInterface("VCXIModifiable"),C=c.GetProperty("Actor.ListActors");if(C){var y=C.GetPropertyValue().GetValue();if(y&&y.length)for(var m=0;m<y.length;m++){var V=this._experienceBase.ComponentsMap.GetComponentFromID(y[m].GetValue());if(V&&!V.IsKindOf("VCXDressup_Spec")){var f=V.QueryInterface("W3AISGNodeHolder").getPathElement();-1===this._cutObjects.indexOf(f)&&this._cutObjects.push(f),d=!0}}}if(!d)if(c.GetPropertyValue("Section.ComposerSMG"))for(var b=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceExt"),P=0;P<b.length;++P){var g=b[P];if(g&&g.IsMesh()){f=g.QueryInterface("W3AISGNodeHolder").getPathElement();-1===this._cutObjects.indexOf(f)&&this._cutObjects.push(f)}}else{var _=this._experienceBase.getManager("VCXContextManager").getRootPathElement();this._cutObjects.push(_)}}if(!this._overrideSet){var M=this._experienceBase.getManager("VCXContextManager").getRootNode();this._overrideSet=new i(M);o=this._overrideSet;this._experienceBase.getManager("VCXContextManager").applyToViewers((function(e){e.getSceneGraphOverrideSetManager().pushSceneGraphOverrideSet(o)}))}this._clippingOverride=this._overrideSet.createOverride(this._cutObjects),this._clippingOverride.setClippingContext(this._clippingContext)}},registerSections:function(e){var t=this;e&&e.forEach((function(e){e.IsKindOf("VCXSection_Spec")&&e.isActive()&&t.registerSection(e)}))},unregisterSections:function(e){var t=this;e&&e.forEach((function(e){e.IsKindOf("VCXSection_Spec")&&t.unregisterSection(e)}))},isUnionModeActived:function(){let e=this.getActiveSections();if(e)for(let t of Object.keys(e)){if(e[t].QueryInterface("VCXIModifiable").GetPropertyValue("Section.SpaceFrontAlpha"))return!0}return!1},registerSection:function(e){this._activeSections[e.GetID()]=e,this.Dirty=!0},unregisterSection:function(e){var t=e.GetID();this._activeSections&&this._activeSections[t]&&(delete this._activeSections[t],this.Dirty=!0)},getActiveSections:function(){return this._activeSections},postUpdate:function(e){this._parent(e)},isCut:function(e,t){let i=this.isUnionModeActived(),r=[];for(let a of Object.keys(this._activeSections)){let o=this._activeSections[a],s=e?e.QueryInterface("VCXICuttableObject"):null,n=!!s&&s.isCut(e,t,o);if(r.push(n),!i&&n)return!0}return!!i&&r.every((e=>!0===e))},toggleSpaceAlphaSection:function(e,t,i=!0,r=void 0){let a=void 0!==r?r:this.isUnionModeActived(),o=e.QueryInterface("VCXIModifiable");if(o.GetPropertyValue("Section.SpaceFrontAlpha")||!1!==a){let e=o.GetNewProperty("Section.SpaceFrontAlpha",a?1:0);i?t.ChangeProperty(o,e):o.OnChangeProperty("Section.SpaceFrontAlpha",e.GetPropertyValue())}if(o.GetPropertyValue("Section.SpaceBackAlpha")||!1!=!a){let e=o.GetNewProperty("Section.SpaceBackAlpha",a?0:1);i?t.ChangeProperty(o,e):o.OnChangeProperty("Section.SpaceFrontAlpha",e.GetPropertyValue())}}});return Object.defineProperty(o.prototype,"Dirty",{enumerable:!0,get:function(){return this._Dirty},set:function(e){this._Dirty=e}}),Object.defineProperty(o.prototype,"componentType",{enumerable:!0,get:function(){return"VCXSectionManager"}}),o})),define("DS/VCXWebDressup/VCXPropertyValueHTMLFormater",["UWA/Class"],(function(e){"use strict";var t=e.extend({init:function(){}});return t.dumpDate=function(e,t){return t?"%"===t[0]?e.strftime(t):e.toLocaleDateString(t):e.toUTCString()},t.format=function(e){var i,r,a=e.GetPropertyValue(),o="left";switch(a.GetType()){case"VCXPropertyValueColor":r="border:1px solid #000;background:#"+a.GetThreeColor().getHexString()+";";break;case"VCXPropertyValueFloat":o="right",i=a.Value.toFixed(2);break;case"VCXPropertyValueDate":o="right",i=t.dumpDate(a.Value,"%d/%m/%Y");break;case"VCXPropertyValueInt":o="right",i=a.ToString();break;default:i=a.ToString()}var s="<div style='width:100%;height:100%;text-align:"+o+";";return r&&(s+=r),s+="'>",i&&(s+=i),s+="</div>"},t}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/CXPRenderingFeatureModelVCXCXPConvertor",["require","exports","DS/VCXWebEWS/VCXBaseVCXCXPConvertor","DS/VCXWebProperties/VCXPropertyValuePoint"],(function(e,t,i,r){"use strict";i=__importDefault(i),r=__importDefault(r);class a extends i.default{_computeTab(){let e=[];const t=this.QueryInterface("CATI3DExperienceObject").ListVariables();let i=["_varName","linktomaterial"];return t.forEach((t=>{if(!i.includes(t)){let i=this._getMaterialVariableType(t);e.push({variableName:t,propertyName:"Material."+t,typeProperty:i,type:i===r.default?"Vector3":void 0})}})),[...super._computeTab(),...e]}UpdateVariablesFromNeutrals(e,t){if(this.GetObject()._experienceBase.getManager("VCXContextManager").isSupported("TweakingMaterial"))return super.UpdateVariablesFromNeutrals(e,t)}}return Object.defineProperty(a.prototype,"componentType",{enumerable:!0,get:function(){return"CXPRenderingFeatureModelVCXCXPConvertor"}}),a})),define("DS/VCXWebDressup/VCXContextualContentOther",["DS/VCXWebKernel/VCXAContextualContent"],(function(e){"use strict";return e.extend({init(e){this._experienceBase=e},appendContent:function(e,t,i){this._parent(e,t,i);const r=this._experienceBase.getManager("VCXGUIManager");r&&r.isTouchActivated()&&(e.Dropdown_VCXTouchMultiSelectionCmd={type:"button",name:"touchMultiSelection",cmdId:"VCXTouchMultiSelectionCmd",index:99})}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXADressup",["require","exports","DS/VCXWebSystem/VCXMathTools","DS/VCXWebComponents/WebExtensionBaseExperience"],(function(e,t,i,r){"use strict";i=__importDefault(i),r=__importDefault(r);class a extends r.default{constructor(){super(),this._previousAnchors={}}isSelectAllAffected(){return!0}isAnchorDependent(){let e=!1;const t=this.GetObject()?.QueryInterface("VCXIModifiable");return t?.processAnchorsIDs&&t?.processAnchorsIDs(((t,i)=>(i&&i.GetValueLink().Value&&(e=!0),!e)),{no2DAnchors:!0}),e}isViewPointDependent(){return!1}hasPointedObjectMoved(e){let t=!1;const r=this.GetObject()?.QueryInterface("VCXIModifiable");return r?.processAnchorsIDs&&r?.processAnchorsIDs(((a,o)=>{let s=!1;const n=r.GetAnchorWorldMatrix(a,e);return i.default.IsMat1EqualsToMat2(this._previousAnchors[a],n)||(this._previousAnchors[a]=n,t=!0,s=!0),!s}),null),t}isDressupPropertiesChangeIndependent(){return!1}anchors(){return{min:0,max:-1}}getDefaultName(){return this.GetObject()?.getDefaultName()}}return a})),define("DS/VCXWebDressup/VCXPartList/VCXComponentPartListManager",["DS/Core/Core","DS/CoreEvents/Events","UWA/Class","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebModifiables/VCXModelChangeListener","DS/VCXWebVisu/VCXModifiablesAccess","DS/CoreEvents/Events","DS/VCXWebExperienceLoader/VCXExperienceSaverBase"],(function(e,t,i,r,a,o,s,n,l,p,u,h,d,c,C,y,m){"use strict";var V=i.extend({init:function(){},initialize:function(){this._WUXEventTokens={},this._partListManipulation=!0,this._Modifiable=null,this._bIsPartListBeingMovedOrResized=!1,this._bManipulatorsInitialized=!1,this._activateEditInPlace=!1,this._editMode=!1,this._changePropertyMode=!1,this._keyState=0,this.initialiseMoveCB=null,this.startMoveCB=null,this.stopMoveCB=null,this.initialiseSplitCB=null,this.startSplitCB=null,this.stopSplitCB=null,this.initialiseResizeCB=null,this.startResizeCB=null,this.stopResizeCB=null,this.handlePartListTableContainerClickCB=null,this.handlePartListTableContainerMouseOverCB=null,this.handlePartListTableContainerMouseOutCB=null,this.handleDefaultBehaviourCB=null,this.timeoutID=null},postInitialize:function(){this._WUXEventTokens.VCXRenameColumn=y.subscribe({event:"VCXEditColumn"},(async e=>{if(e&&e.hasOwnProperty("indexColumn")&&e.hasOwnProperty("nameProperty")){var t=this.QueryInterface("VCXIModifiable");let s,n,p=new o(e.nameProperty),d=new h,c=null;const C=this._experienceBase.getManager("VCXMetaPropertyManager");if(C&&C._computePropertyDefinition){var{computedPropertyNLS:i}=C._computePropertyDefinition(e.nameProperty,"");if(i){c=i;const t=new o;t.SetValue(C.getNLSNameForProperty(e.nameProperty)),c.SetPropertyValue(t)}}if(t){let i=new u;if(s=t.GetProperty("ColumnTreeList.ColumnList"),"Actor.PartList.ID"===s.GetPropertyValue().GetValue()[e.indexColumn-1].GetValue())return;n=s.GetPropertyValue(),n.SetValueAtIndex(e.indexColumn>=1?e.indexColumn-1:0,p),s.SetPropertyValue(n),i.AddOrModifyProperty(s),c&&i.AddOrModifyProperty(c),d.AddOrModifyPropertySet(t.GetHashing(),i)}const y=this._experienceBase.ComponentsMap.GetComponentFromType("VCXPartList_Spec");if(y&&y.length&&(t=y[0].QueryInterface("VCXIModifiable"))){let e=new u,i=t.GetProperty("Collab.PartList.ColumnList");i.SetPropertyValue(n),e.AddOrModifyProperty(i),d.AddOrModifyPropertySet(t.GetHashing(),e)}var r=new l(this._experienceBase);if(r.ChangePropertiesFromMap(d),this._experienceBase.getManager("VCXCommandManager").Push(r),"record"===this._experienceBase.odt){var a=(new m)._PropMapToJson(this._experienceBase,d);console.log(a),await this._experienceBase.getManager("VCXAPIManager").ChangeProperties(a)}clearTimeout(this.timeoutID),this.timeoutID=setTimeout((()=>{document.getElementById("divBom")?.children&&document.getElementById("divBom")?.children.length&&(this._referenceUI=document.getElementById("divBom")?.children[0],this._referenceUI.getChildren()[e.indexColumn>0?e.indexColumn-1:e.indexColumn].style.backgroundColor="#00B8DE")}),10)}}))},unInitialize(){for(var e in this._WUXEventTokens)this._WUXEventTokens.hasOwnProperty(e)&&this._WUXEventTokens[e]&&(y.unsubscribe(this._WUXEventTokens[e]),this._WUXEventTokens[e]=null);this._partListManipulation=null,this._Modifiable=null,this._bIsPartListBeingMovedOrResized=null,this._bManipulatorsInitialized=null,this._activateEditInPlace=null,this._editMode=null,this._changePropertyMode=null,this._keyState=null,this.initialiseMoveCB=null,this.startMoveCB=null,this.stopMoveCB=null,this.initialiseSplitCB=null,this.startSplitCB=null,this.stopSplitCB=null,this.initialiseResizeCB=null,this.startResizeCB=null,this.stopResizeCB=null,this.handlePartListTableContainerClickCB=null,this.handlePartListTableContainerMouseOverCB=null,this.handlePartListTableContainerMouseOutCB=null,this.handleDefaultBehaviourCB=null,this.timeoutID=null},postUpdate:function(e){this.filterHasChanged=!1,this.turnOnPartListVisibility=!1},SetPartListManipulation(e){this._partListManipulation=e},SetIsPartListBeingMovedOrResized(e){this._bIsPartListBeingMovedOrResized=e},SetManipulatorsInitialized(e){this._bManipulatorsInitialized=e},SetActivateEditInPlace(e){this._activateEditInPlace=e},SetEditMode(e){this._editMode=e},SetChangePropertyMode(e){this._changePropertyMode=e},SetKeyState(e){this._keyState=e},GetPartListManipulation(){return this._partListManipulation},GetIsPartListBeingMovedOrResized(){return this._bIsPartListBeingMovedOrResized},GetManipulatorsInitialized(){return this._bManipulatorsInitialized},GetActivateEditInPlace(){return this._activateEditInPlace},GetEditMode(){return this._editMode},GetChangePropertyMode(){return this._changePropertyMode},GetKeyState(){return this._keyState},initializeManipulators(){this.partListTableContainer=document.getElementById("partListTableContainer"),this._Modifiable=this.QueryInterface("VCXIModifiable"),this.paperManager=this.GetObject()._experienceBase.getManager("VCXPaperManager"),this._partListModifiable=this.GetObject()._experienceBase.ComponentsMap.GetComponentFromType("VCXPartList_Spec")[0].QueryInterface("VCXIModifiable"),this._divParent=this._Modifiable.GetObject()._experienceBase.getManager("VCXDressupManager").getDressupsOverViewerDiv(),this.initialiseMoveCB||(this.initialiseMoveCB=this.initialiseMove.bind(this)),this.partListTableContainer.addEventListener("mousedown",this.initialiseMoveCB),this.partListTableContainer.addEventListener("touchstart",this.initialiseMoveCB);let e=this.partListTableContainer.querySelectorAll(".partListCorner"),t=this.partListTableContainer.querySelectorAll(".partListSplitManipulator");if(!e.length){let t=this.createCornerElement("partListCorner","corner-bottom-right","nwse-resize",null,"-6px","-6px",null),i=this.createCornerElement("partListCorner","corner-top-right","nesw-resize","-6px","-6px",null,null),r=this.createCornerElement("partListCorner","corner-top-left","nwse-resize","-6px",null,null,"-6px"),a=this.createCornerElement("partListCorner","corner-bottom-left","nesw-resize",null,null,"-6px","-6px");this.partListTableContainer.appendChild(t),this.partListTableContainer.appendChild(a),this.partListTableContainer.appendChild(r),this.partListTableContainer.appendChild(i),e=this.partListTableContainer.querySelectorAll(".partListCorner");for(let t=0;t<e.length;t++)e[t].style.display="none"}if(!t.length){let e=this.createSplitManipulator("partListSplitManipulator","left-split","ew-resize","50%","null","null","-4px","translateY(-50%)","10px","30px"),i=this.createSplitManipulator("partListSplitManipulator","right-split","ew-resize","50%","-4px","null","null","translateY(-50%)","10px","30px"),r=this.createSplitManipulator("partListSplitManipulator","top-split","ns-resize","-4px","null","null","50%","translateX(-50%)","30px","10px"),a=this.createSplitManipulator("partListSplitManipulator","bottom-split","ns-resize","null","null","-4px","50%","translate(-50%)","30px","10px");this.partListTableContainer.appendChild(e),this.partListTableContainer.appendChild(i),this.partListTableContainer.appendChild(r),this.partListTableContainer.appendChild(a),t=this.partListTableContainer.querySelectorAll(".partListSplitManipulator");for(let e=0;e<t.length;e++)t[e].style.display="none"}t.length&&(this.initialiseSplitCB||(this.initialiseSplitCB=this.initialiseSplit.bind(this)),this.partListTableContainer.addEventListener("mousedown",this.initialiseSplitCB),this.partListTableContainer.addEventListener("touchstart",this.initialiseSplitCB)),e.length&&(this.initialiseResizeCB||(this.initialiseResizeCB=this.initialiseResize.bind(this)),this.partListTableContainer.addEventListener("mousedown",this.initialiseResizeCB),this.partListTableContainer.addEventListener("touchstart",this.initialiseResizeCB)),this.handlePartListTableContainerClickCB||(this.handlePartListTableContainerClickCB=this.handlePartListTableContainerClick.bind(this)),this.handlePartListTableContainerMouseOverCB||(this.handlePartListTableContainerMouseOverCB=this.handlePartListTableContainerMouseOver.bind(this)),this.handlePartListTableContainerMouseOutCB||(this.handlePartListTableContainerMouseOutCB=this.handlePartListTableContainerMouseOut.bind(this)),this.partListTableContainer.addEventListener("mousedown",this.handlePartListTableContainerClickCB),this.partListTableContainer.addEventListener("mouseover",this.handlePartListTableContainerMouseOverCB,!0),this.partListTableContainer.addEventListener("mouseout",this.handlePartListTableContainerMouseOutCB)},unInitializeManipulators(){this.SetManipulatorsInitialized(!1),this.partListTableContainer.removeEventListener("mousedown",this.initialiseMoveCB),this.partListTableContainer.removeEventListener("touchstart",this.initialiseMoveCB),this.initialiseMoveCB=null,this.partListTableContainer.removeEventListener("mousedown",this.initialiseSplitCB),this.partListTableContainer.removeEventListener("touchstart",this.initialiseSplitCB),this.initialiseSplitCB=null,this.partListTableContainer.removeEventListener("mousedown",this.initialiseResizeCB),this.partListTableContainer.removeEventListener("touchstart",this.initialiseResizeCB),this.initialiseResizeCB=null,this.partListTableContainer.removeEventListener("mousedown",this.handlePartListTableContainerClickCB),this.partListTableContainer.removeEventListener("mouseover",this.handlePartListTableContainerMouseOverCB),this.partListTableContainer.removeEventListener("mouseout",this.handlePartListTableContainerMouseOutCB),this.handlePartListTableContainerClickCB=null,this.handlePartListTableContainerMouseOverCB=null,this.handlePartListTableContainerMouseOutCB=null},createCornerElement(e,t,i,r,a,o,s){let n=document.createElement("div");return n.className=e,n.id=t,n.style.position="absolute",n.style.width="12px",n.style.height="12px",n.style.backgroundColor="#FFFFFF",n.style.borderRadius="50%",n.style.cursor=i,n.style.border="1px solid black",n.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.3)",n.style.top=r,n.style.right=a,n.style.bottom=o,n.style.left=s,n},createSplitManipulator(e,t,i,r,a,o,s,n,l,p){let u=document.createElement("div");return u.className=e,u.id=t,u.style.position="absolute",u.style.width=l,u.style.height=p,u.style.top=r,u.style.left=s,u.style.right=a,u.style.bottom=o,u.style.cursor=i,u.style.transform=n,u.style.border="1px solid black",u.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.3)",u.style.borderRadius="4px",u.style.backgroundColor="#FFFFFF",u},initialiseMove(e){if("partListCorner"!==e.target.className&&"partListSplitManipulator"!==e.target.className&&this.GetPartListManipulation()&&!this.GetActivateEditInPlace()&&!this.GetEditMode()&&(this.SetIsPartListBeingMovedOrResized(!0),"touchstart"===e.type&&e.touches.length?(this.offsetX=e.touches[0].clientX-this.partListTableContainer.getBoundingClientRect().left,this.offsetY=e.touches[0].clientY-this.partListTableContainer.getBoundingClientRect().top):(this.offsetX=e.clientX-this.partListTableContainer.getBoundingClientRect().left,this.offsetY=e.clientY-this.partListTableContainer.getBoundingClientRect().top),this.partListTableContainer.style.cursor="grabbing",this.startMoveCB||(this.startMoveCB=this.startMove.bind(this)),this.stopMoveCB||(this.stopMoveCB=this.stopMove.bind(this)),document.addEventListener("mousemove",this.startMoveCB),document.addEventListener("mouseup",this.stopMoveCB),document.addEventListener("touchmove",this.startMoveCB),document.addEventListener("touchend",this.stopMoveCB),this.SetIsPartListBeingMovedOrResized(!1),"record"===this._experienceBase.odt)){const t={e:this.createObjectWithEssentialInfo(e)};this.GetObject()._experienceBase.getManager("VCXODTManager").LogAPI("VCXPartListInitialiseMove",t)}},startMove(e){let t,i;this.SetIsPartListBeingMovedOrResized(!0),"touchmove"===e.type&&e.touches.length>0?(t=e.touches[0].clientX-this.offsetX,i=e.touches[0].clientY-this.offsetY):(t=e.clientX-this.offsetX,i=e.clientY-this.offsetY);let r=this._experienceBase.getManager("VCXContextManager").getMainViewer().div.getBoundingClientRect();if(t-=r.x,i-=r.y,"record"===this._experienceBase.odt){const t={e:this.createObjectWithEssentialInfo(e)};this.GetObject()._experienceBase.getManager("VCXODTManager").LogAPI("VCXPartListStartMove",t)}if(this.paperManager){let e=this.paperManager.PixelToMMX(parseFloat(t)),r=this.paperManager.PixelToMMY(parseFloat(i)),a=[this._partListModifiable.GetProperty("Collab.3D.Paper.Paper.Position.X"),this._partListModifiable.GetProperty("Collab.3D.Paper.Paper.Position.Y")],o=[new n(e),new n(r)];this._updatePropertyValues(a,o,this._partListModifiable)}},stopMove(e){if(this._handleOnSelectElement(e),"record"===this._experienceBase.odt){const t={e:this.createObjectWithEssentialInfo(e)};this.GetObject()._experienceBase.getManager("VCXODTManager").LogAPI("VCXPartListStopMove",t)}this.partListTableContainer.style.cursor="default",document.removeEventListener("mousemove",this.startMoveCB),document.removeEventListener("mouseup",this.stopMoveCB),document.removeEventListener("touchmove",this.startMoveCB),document.removeEventListener("touchend",this.stopMoveCB),this.startMoveCB=null,this.stopMoveCB=null},initialiseSplit(e){if(e&&"partListSplitManipulator"===e.target.className&&e.target.id&&!this.GetEditMode()&&this.GetPartListManipulation()){this.SetIsPartListBeingMovedOrResized(!0),this.startSplitCB||(this.startSplitCB=this.startSplit.bind(this)),this.stopSplitCB||(this.stopSplitCB=this.stopSplit.bind(this)),document.addEventListener("mousemove",this.startSplitCB),document.addEventListener("mouseup",this.stopSplitCB),document.addEventListener("touchmove",this.startSplitCB),document.addEventListener("touchend",this.stopSplitCB),this.clickedSplitter=e.target.id,this.scale=parseFloat(this.partListTableContainer.style.transform.replace(/[A-Za-z$-()]/g,"")),this.partListTableContainerWidth=this.partListTableContainer.offsetWidth;let t=this.partListTableContainer.querySelectorAll(".Part_List_Row"),i=t[0].clientHeight,r=t[1].clientHeight;for(let e=0;e<t.length;e++)"divBomRowHead"===t[e].id?t[e].style.height=i+"px":t[e].style.height=r+"px",t[e].style.width=t[e].offsetWidth+"px";let a=document.getElementById("divBom");a.style.height="auto",a.style.width=a.offsetWidth+"px",a.style.minWidth="auto";let o=this.partListTableContainer.querySelectorAll(".slave");for(let e=0;e<o.length;e++)o[e].style.height="auto",o[e].style.width=o[e].offsetWidth+"px",o[e].style.minWidth="auto";if("record"===this._experienceBase.odt){const t={e:this.createObjectWithEssentialInfo(e)};this.GetObject()._experienceBase.getManager("VCXODTManager").LogAPI("VCXPartListInitialiseSplit",t)}}},startSplit(e){this._divParent.style["pointer-events"]="unset";const t=this.partListTableContainer.getBoundingClientRect().bottom,i=this.partListTableContainer.getBoundingClientRect().right,r=this.partListTableContainer.getBoundingClientRect().left,a=this.partListTableContainer.getBoundingClientRect().top,o=i-r,s=t-a,n=document.getElementById("divBom");let l,p;switch(this.clickedSplitter){case"top-split":"touchmove"===e.type?(p=(s-(e.touches[0].clientY-a))/this.scale,this.partListTableContainer.style.top=`${e.touches[0].clientY}px`):(p=(s-(e.clientY-a))/this.scale,this.partListTableContainer.style.top=`${e.clientY}px`),this.partListTableContainer.style.height=`${p}px`,n.offsetHeight>this.partListTableContainer.offsetHeight&&n.children.length>1?this.removeRow():n.offsetHeight<this.partListTableContainer.offsetHeight&&this.addRow();break;case"left-split":if(l="touchmove"===e.type?(o-(e.touches[0].clientX-r))/this.scale:(o-(e.clientX-r))/this.scale,l<100)break;this.partListTableContainer.style.width=`${l}px`,this.partListTableContainer.style.height=s/this.scale+"px","touchmove"===e.type?this.partListTableContainer.style.left=`${e.touches[0].clientX}px`:this.partListTableContainer.style.left=`${e.clientX}px`,this.partListTableContainer.offsetWidth-this.partListTableContainerWidth>n.offsetWidth?this.addTable():this.partListTableContainerWidth-this.partListTableContainer.offsetWidth>n.offsetWidth&&this.removeTable();break;case"bottom-split":p="touchmove"===e.type?(e.touches[0].clientY-a)/this.scale:(e.clientY-a)/this.scale,this.partListTableContainer.style.height=`${p}px`,n.offsetHeight>this.partListTableContainer.offsetHeight&&n.children.length>1?this.removeRow():n.offsetHeight<this.partListTableContainer.offsetHeight&&this.addRow();break;case"right-split":if(l="touchmove"===e.type?(e.touches[0].clientX-r)/this.scale:(e.clientX-r)/this.scale,l<100)break;this.partListTableContainer.style.width=`${l}px`,this.partListTableContainer.style.height=s/this.scale+"px",this.partListTableContainer.offsetWidth-this.partListTableContainerWidth>n.offsetWidth?this.addTable():this.partListTableContainerWidth-this.partListTableContainer.offsetWidth>n.offsetWidth&&this.removeTable();break;default:console.error("Error with Split Manipulator")}if("record"===this._experienceBase.odt){const t={e:this.createObjectWithEssentialInfo(e)};this.GetObject()._experienceBase.getManager("VCXODTManager").LogAPI("VCXPartListStartSplit",t)}},stopSplit(){this.SetIsPartListBeingMovedOrResized(!1),this._divParent.style["pointer-events"]="none";let e=[];this.partListTableContainer.style.width="fit-content",this.partListTableContainer.style.width=this.partListTableContainer.offsetWidth+"px",this.partListTableContainer.style.height="fit-content",this.partListTableContainer.style.height=this.partListTableContainer.offsetHeight+"px";let t=this.partListTableContainer.querySelectorAll(".Part_List");document.getElementById("divBom").style.height="inherit",this.setSlaveTablesHeight();for(let i=0;i<t.length;i++)t[i].style.width="inherit",t[i].style.minWidth=0,e.push(t[i].children.length-1);let i=this.partListTableContainer.querySelectorAll(".Part_List_Row");for(let e=0;e<i.length;e++)i[e].style.height="100%",i[e].style.width="auto";document.removeEventListener("mousemove",this.startSplitCB),document.removeEventListener("mouseup",this.stopSplitCB),document.removeEventListener("touchmove",this.startSplitCB),document.removeEventListener("touchend",this.stopSplitCB),this.startSplitCB=null,this.stopSplitCB=null;let r=[],a=[],s=.3527*parseInt(document.defaultView.getComputedStyle(this.partListTableContainer).width,10),l=.3527*parseInt(document.defaultView.getComputedStyle(this.partListTableContainer).height,10),p=this._partListModifiable.GetProperty("Collab.Body.Width"),u=this._partListModifiable.GetProperty("Collab.Body.Height"),h=new n(s),d=new n(l);r.push(p),r.push(u),a.push(h),a.push(d);let c=this.paperManager.PixelToMMX(parseFloat(getComputedStyle(this.partListTableContainer).left)),C=this.paperManager.PixelToMMY(parseFloat(getComputedStyle(this.partListTableContainer).top)),y=this._partListModifiable.GetProperty("Collab.3D.Paper.Paper.Position.X"),m=this._partListModifiable.GetProperty("Collab.3D.Paper.Paper.Position.Y"),V=new n(c),f=new n(C);if(r.push(y),r.push(m),a.push(V),a.push(f),e.length>1){let t=this._partListModifiable.GetProperty("Collab.PartList.Split.HeaderCount"),i=e.join("-"),s=new o(i);r.push(t),a.push(s)}else{let e=this._partListModifiable.GetProperty("Collab.PartList.Split.HeaderCount"),t=new o("1");r.push(e),a.push(t)}"record"===this._experienceBase.odt&&this.GetObject()._experienceBase.getManager("VCXODTManager").LogAPI("VCXPartListStopSplit",{}),this._updatePropertyValues(r,a,this._partListModifiable)},removeTable(){if(document.getElementById("divBomEmptyRow"))return;let e=this.partListTableContainer.querySelectorAll(".Part_List");if(e.length<=1)return;let t=[];this.partListTableContainerWidth=this.partListTableContainer.offsetWidth;let i=e[e.length-1];for(let i=0;i<e.length;i++)for(let r=1;r<e[i].children.length;r++)t.push(e[i].children[r]);let r=0;for(;t.length;)r!==e.length-1?(e[r].appendChild(t.shift()),r++):r=0;this.partListTableContainer.removeChild(i),this.partListTableContainer.style.height="fit-content"},addTable(){if(document.getElementById("divBomEmptyRow"))return;let e,t=new UWA.Element("div",{id:"divBomSlave",class:"Part_List slave"}),i=[],r=document.getElementById("divBom");if(!(r&&r.children.length>2))return;{let a=document.getElementById("divBomRowHead");t.appendChild(a.cloneNode(!0)),t.style.height="auto",t.style.minWidth="auto",t.style.width=r.offsetWidth+"px",this.partListTableContainer.appendChild(t),this.partListTableContainerWidth=this.partListTableContainer.offsetWidth,e=this.partListTableContainer.querySelectorAll(".Part_List");for(let t=0;t<e.length;t++)if(e[t].children.length)for(let r=1;r<e[t].children.length;r++)i.push(e[t].children[r])}let a=0;for(;i.length;)a===e.length&&(a=0),e[a].appendChild(i.shift()),a++;this.partListTableContainer.style.height="fit-content"},addRow(){if(document.getElementById("divBomEmptyRow"))return;let e=this.partListTableContainer.querySelectorAll(".slave"),t=document.getElementById("divBom"),i=document.getElementById("divBomRowHead").clientHeight+2;if(e.length&&this.partListTableContainer.clientHeight>=t.clientHeight+i){let i=e[e.length-1],r=i.firstChild.nextSibling;if(r){if(e.length>1){e[0].children.length===t.children.length&&t.appendChild(r);let a=0;for(;a<e.length-1;){if(1===i.children.length){let e=i.clientWidth;return this.partListTableContainer.removeChild(this.partListTableContainer.lastChild),void(this.partListTableContainer.style.width=this.partListTableContainer.clientWidth-e+"px")}r=i.firstChild.nextSibling,e[a].appendChild(r),a++}}else t.appendChild(r);if(1===i.children.length){let e=i.clientWidth;this.partListTableContainer.removeChild(this.partListTableContainer.lastChild),this.partListTableContainer.style.width=this.partListTableContainer.clientWidth-e+"px"}}}},removeRow(){if(document.getElementById("divBomEmptyRow"))return;let e=this.partListTableContainer.querySelectorAll(".slave"),t=document.getElementById("divBom"),i=[];if(2!==t.children.length)if(e.length){i.push(t.lastChild);let r=0;for(;e[r];){if(e[r]&&e[r].children.length<t.children.length){if(e[r].children.length+i.length<=t.children.length-1){for(;i.length;)1===e[r].children.length?e[r].appendChild(i.shift()):e[r].insertBefore(i.shift(),e[r].firstChild.nextSibling);return}for(;e[r].children.length<t.children.length-1;)1===e[r].children.length?e[r].appendChild(i.shift()):e[r].insertBefore(i.shift(),e[r].firstChild.nextSibling);r++}e[r]&&e[r].children.length===t.children.length&&(i.push(e[r].lastChild),r++)}for(;i.length;){let e=this.createSlaveTable();for(let r=0;r<t.children.length-1;r++){let t=i.shift();if(!t)break;e.appendChild(t)}}}else{i.push(t.lastChild);let e=this.createSlaveTable();for(let t=0;t<i.length;t++)e.appendChild(i[t])}},isPartOfPartList(e){let t=this._experienceBase.getManager("VCXContextManager").getActivePartList(),i=e&&e.QueryInterface("VCXIModifiable");var r=i&&i.GetProperty("Actor.PartList.ID");return!(!t||t.QueryInterface("VCXIVisibility").GetVisibility()!==d.EVisState.Visible||!r)&&!!r.GetPropertyValue().Value},createSlaveTable(){let e=document.getElementById("divBom"),t=new UWA.Element("div",{id:"divBom",class:"Part_List slave"}),i=document.getElementById("divBomRowHead");return t.appendChild(i.cloneNode(!0)),this.partListTableContainer.style.width=`${this.partListTableContainer.offsetWidth+e.offsetWidth}px`,t.style.height="auto",this.partListTableContainer.appendChild(t),t},setSlaveTablesHeight(){let e=document.getElementById("partListTableContainer").querySelectorAll(".slave"),t=document.getElementById("divBom");if(!e.length&&!t)return;let i=100/t.children.length;for(let t=0;t<e.length;t++)e[t].style.height=e[t].children.length*i+"%"},initialiseResize(e){if(e&&"partListCorner"===e.target.className&&e.target.id&&!this.GetEditMode()&&this.GetPartListManipulation()&&(this.SetIsPartListBeingMovedOrResized(!0),this.startResizeCB||(this.startResizeCB=this.startResize.bind(this)),this.stopResizeCB||(this.stopResizeCB=this.stopResize.bind(this)),document.addEventListener("mousemove",this.startResizeCB),document.addEventListener("mouseup",this.stopResizeCB),document.addEventListener("touchmove",this.startResizeCB),document.addEventListener("touchend",this.stopResizeCB),this.clickedCorner=e.target.id,this.scale=parseFloat(this.partListTableContainer.style.transform.replace(/[A-Za-z$-()]/g,"")),"record"===this._experienceBase.odt)){const t={e:this.createObjectWithEssentialInfo(e)};this.GetObject()._experienceBase.getManager("VCXODTManager").LogAPI("VCXPartListInitialiseResize",t)}},startResize(e){this._divParent.style["pointer-events"]="unset";const t=this.partListTableContainer.getBoundingClientRect().bottom,i=this.partListTableContainer.getBoundingClientRect().right,r=this.partListTableContainer.getBoundingClientRect().left,a=this.partListTableContainer.getBoundingClientRect().top,o=i-r,s=t-a;this.cellHeight=document.querySelector(".Part_List_Row").clientHeight;let n,l,p,u=this._experienceBase.getManager("VCXContextManager").getMainViewer().div.getBoundingClientRect(),h=e.clientX-u.x,d=e.clientY-u.y;switch("touchmove"===e.type&&(h=e.touches[0].clientX-u.x,d=e.touches[0].clientY-u.y),this.clickedCorner){case"corner-top-left":if(n=(o-(h-r+u.x))/this.scale,l=(s-(d-a+u.y))/this.scale,p=this.cellHeight/2,n<100)break;if(p<7&&l<s/this.scale){p=7,this.partListTableContainer.style.fontSize=`${p}px`;break}this.partListTableContainer.style.width=`${n}px`,this.partListTableContainer.style.height=`${l}px`,this.partListTableContainer.style.left=`${h}px`,this.partListTableContainer.style.top=`${d}px`,this.partListTableContainer.style.fontSize=`${p}px`;break;case"corner-top-right":if(n=(h-r+u.x)/this.scale,l=(s-(d-a+u.y))/this.scale,p=this.cellHeight/2,n<100)break;if(p<7&&l<s/this.scale){p=7,this.partListTableContainer.style.fontSize=`${p}px`;break}this.partListTableContainer.style.width=`${n}px`,this.partListTableContainer.style.height=`${l}px`,this.partListTableContainer.style.top=`${d}px`,this.partListTableContainer.style.fontSize=`${p}px`;break;case"corner-bottom-left":if(n=(o-(h-r+u.x))/this.scale,l=(d-a+u.y)/this.scale,p=this.cellHeight/2,n<100)break;if(p<7&&l<s/this.scale){p=7,this.partListTableContainer.style.fontSize=`${p}px`;break}this.partListTableContainer.style.width=`${n}px`,this.partListTableContainer.style.height=`${l}px`,this.partListTableContainer.style.left=`${h}px`,this.partListTableContainer.style.fontSize=`${p}px`;break;case"corner-bottom-right":if(n=(h-r+u.x)/this.scale,l=(d-a+u.y)/this.scale,p=this.cellHeight/2,n<100)break;if(p<7&&l<s/this.scale){p=7,this.partListTableContainer.style.fontSize=`${p}px`;break}this.partListTableContainer.style.width=`${n}px`,this.partListTableContainer.style.height=`${l}px`,this.partListTableContainer.style.fontSize=`${p}px`;break;default:console.error("Error in resize")}if("record"===this._experienceBase.odt){const t={e:this.createObjectWithEssentialInfo(e)};this.GetObject()._experienceBase.getManager("VCXODTManager").LogAPI("VCXPartListStartResize",t)}},stopResize(){this.SetIsPartListBeingMovedOrResized(!1),this._divParent.style["pointer-events"]="none",document.removeEventListener("mousemove",this.startResizeCB),document.removeEventListener("mouseup",this.stopResizeCB),document.removeEventListener("touchmove",this.startResizeCB),document.removeEventListener("touchend",this.stopResizeCB),this.startResizeCB=null,this.stopResizeCB=null;let e=.3527*parseInt(document.defaultView.getComputedStyle(partListTableContainer).width,10),t=.3527*parseInt(document.defaultView.getComputedStyle(partListTableContainer).height,10),i=this._partListModifiable.GetProperty("Collab.Body.Width"),r=this._partListModifiable.GetProperty("Collab.Body.Height"),a=new n(e),o=new n(t),s=this.paperManager.PixelToMMX(parseFloat(getComputedStyle(partListTableContainer).left)),l=this.paperManager.PixelToMMY(parseFloat(getComputedStyle(partListTableContainer).top)),p=this._partListModifiable.GetProperty("Collab.3D.Paper.Paper.Position.X"),u=this._partListModifiable.GetProperty("Collab.3D.Paper.Paper.Position.Y"),h=new n(s),d=new n(l),c=this._partListModifiable.GetProperty("Collab.Text.Font");c.type="fontHeight";let C=parseFloat(this.partListTableContainer.style.fontSize),y=[i,r,p,u,c],m=[a,o,h,d,new n(C)];"record"===this._experienceBase.odt&&this.GetObject()._experienceBase.getManager("VCXODTManager").LogAPI("VCXPartListStopResize",{}),this._updatePropertyValues(y,m,this._partListModifiable)},handlePartListTableContainerClick(e){if("divBomRowHead"===e.target.id||this.GetEditMode()&&e.target.classList.contains("Part_List_Row")){if(!this.GetEditMode()&&this.GetPartListManipulation()){this._showSelection();let e=document.querySelectorAll(".partListCorner"),t=document.querySelectorAll(".partListSplitManipulator"),i=parseFloat(partListTableContainer.style.transform.replace(/[A-Za-z$-()]/g,""));for(let r=0;r<e.length;r++)e[r].style.transform=e[r].style.transform.replace(/scale\([^\)]+\)\s*/,""),t[r].style.transform=t[r].style.transform.replace(/scale\([^\)]+\)\s*/,""),e[r].style.transform+=` scale(${1/i})`,t[r].style.transform+=` scale(${1/i})`}let i=this.GetObject()._experienceBase.getManager("VCXSelectionManager"),r=new p(this.GetObject()._experienceBase);if(0===this.GetKeyState()){let e=i.GetComponentsFromSelection("CSO"),t=[];e.filter((e=>{e&&(e.IsKindOf("VCXPartList_Spec")||t.push(e))})),r.RemoveComponentsFromSelection(t)}r.AddToSelection(this._partListModifiable.GetObject()),this._addPartListToCSO(this._partListModifiable),this.GetObject()._experienceBase.getManager("VCXCommandManager").Do(r),(this.GetEditMode()&&!this.GetChangePropertyMode()||this.GetChangePropertyMode())&&(t.publish({event:"VCX_Meta_Hide_UI",data:null}),t.publish({event:"VCX_EditMode_PartList_Display_UI",data:e}))}},handlePartListTableContainerMouseOver:function(e){if(!this.GetPartListManipulation())return;this.GetObject()._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection().length||this._showSelection(!0)},handlePartListTableContainerMouseOut:function(e){if(!this.GetPartListManipulation())return;this.GetObject()._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection().length||this._hideSelection()},_addPartListToCSO:function(t){if(t){let i=t.GetObject().QueryInterface("W3AISGNodeHolder");if(i&&i.getPathElement()){let t={pathElement:i.getPathElement()};e.Selection.CSOManager.add(t)}}},_handleOnSelectElement:function(e){if(this.GetEditMode())return;let i={};i.event=e,t.publish({event:"/VCX/ContextualBar",data:i})},createObjectWithEssentialInfo:function(e){let t={};return t.clientX=e.clientX,t.clientY=e.clientY,t.target={},t.target.className=e.target.className,t.target.id=e.target.id,t.type=e.type,t},_showSelection:function(e=!1){let t=document.getElementById("partListTableContainer");if(!t)return;let i=t.querySelectorAll(".partListCorner"),r=t.querySelectorAll(".partListSplitManipulator");e?(t.style.outline="2px solid #E5E4E2",t.style.outlineOffset="-1px"):(t.style.outline="2px solid #42A2DA",t.style.outlineOffset="-2px");for(let e=0;e<i.length;e++)i[e].style.display="block";if(!e)for(let e=0;e<r.length;e++)r[e].style.display="block"},_hideSelection:function(){let e=document.getElementById("partListTableContainer");if(!e)return;let t=e.querySelectorAll(".partListCorner"),i=e.querySelectorAll(".partListSplitManipulator");e.style.outline="none";for(let e=0;e<t.length;e++)t[e].style.display="none";for(let e=0;e<i.length;e++)i[e].style.display="none"},_enableEditInPlace:function(e,t){this._hideSelection(),this.SetActivateEditInPlace(!0);let i=e.getChildren();e.getAttribute("contenteditable")||(e.setAttribute("contenteditable","true"),e.setAttribute("spellcheck","false"));for(let e=0;e<i.length;e++)i[e].classList.contains("Description")||i[e].classList.contains("ID")?t.x>=i[e].getBoundingClientRect().left&&t.x<=i[e].getBoundingClientRect().right&&t.y>=i[e].getBoundingClientRect().top&&t.y<=i[e].getBoundingClientRect().bottom&&this.selectText(i[e]):i[e].setAttribute("contenteditable","false")},selectText:function(e){e.focus();const t=window.getSelection();if(t.isCollapsed||e.innerText!==t.focusNode.innerText){const i=document.createRange();i.selectNodeContents(e.firstChild),t.removeAllRanges(),t.addRange(i)}this.container=e;const i=document.getElementById("partListTableContainer");this.handleDefaultBehaviourCB||(this.handleDefaultBehaviourCB=this.handleDefaultBehaviour.bind(this),i.addEventListener("keydown",this.handleDefaultBehaviourCB));let r=document.querySelectorAll(".Part_List_Cell.ID, .Part_List_Cell.Description");for(let t=0;t<r.length;t++)r[t]===e?r[t].classList.add("selected"):r[t].classList.contains("selected")&&r[t].classList.remove("selected")},handleDefaultBehaviour:function(e){const t=window.getSelection().getRangeAt(0);document.createRange().selectNodeContents(this.container),t.startContainer.data===t.endContainer.data?("Backspace"===e.key&&t.collapsed&&0===t.startOffset&&e.preventDefault(),"Delete"===e.key&&t.collapsed&&t.startOffset===this.container.textContent.length&&e.preventDefault()):e.preventDefault()},_disableEditInPlace:function(){let t=null,i=this.GetObject()._experienceBase;i&&(t=new p(i)),this.SetActivateEditInPlace(!1),document.getElementById("partListTableContainer").removeEventListener("keydown",this.handleDefaultBehaviourCB),this.handleDefaultBehaviourCB=null;let r=document.querySelectorAll(".Part_List_Row");for(let i=0;i<r.length;i++)if(r[i].getAttribute("contenteditable")){let a,s,n=r[i]._bomLine.itemComponents[0].QueryInterface("VCXIModifiable"),l=n.GetProperty("Actor.PartList.ID"),p=n.GetProperty("Actor.PartList.Description");r[i].removeAttribute("contenteditable"),r[i].removeAttribute("spellcheck");let u,h,d=r[i].getChildren();for(let e=0;e<d.length;e++)d[e].classList.contains("Description")||d[e].classList.contains("ID")||d[e].removeAttribute("contenteditable"),d[e].classList.contains("Description")&&(s=new o(d[e].innerText)),d[e].classList.contains("ID")&&(a=new o(d[e].innerText)),d[e].classList.contains("selected")&&d[e].classList.remove("selected");if(s?(u=[l,p],h=[a,s]):(u=[l],h=[a]),this._updatePropertyValues(u,h,n),t){t.RemoveFromSelection(r[i]._bomLine.itemComponents[0]);let a={pathElement:r[i]._bomLine.itemComponents[0].QueryInterface("W3AISGNodeHolder").getPathElement()},o=e.Selection.CSOManager;o.isIn(a)&&o.remove(a)}}i&&t&&i.getManager("VCXCommandManager").Do(t)},_updatePropertyValues:function(e,t,i=this._Modifiable){if(e&&e.length&&t&&t.length){let r=i.GetObject()._experienceBase,a=new l(r);const o=i.GetHashing(),s=new h,n=new u;for(let i=0;i<e.length;i++)e[i].type?"fontHeight"===e[i].type&&e[i].GetPropertyValue().SetHeight(t[i]):e[i].SetPropertyValue(t[i]),n.AddOrModifyProperty(e[i]);s.AddOrModifyPropertySet(o,n),a.ChangePropertiesFromMap(s),r.getManager("VCXCommandManager").Push(a)}},GetColumn:function(e){var t=this.QueryInterface("VCXIModifiable");if(t){var i=t.GetProperty("ColumnTreeList.ColumnList").GetPropertyValue();if(e>=i._value.length)return;return i.GetValueAtIndex(e)}},GetColumnsList:function(){let e=this.QueryInterface("VCXIModifiable");if(e){let t=[],i=e.GetProperty("ColumnTreeList.ColumnList").GetPropertyValue();for(let e=0;e<i.GetValue().length;e++)t.push(i.GetValueAtIndex(e).GetValue());return t}},GetColumnName:function(e){var t=this.GetColumn(e);return void 0===t?void 0:t},GetColumnNumber:function(){var e=this.QueryInterface("VCXIModifiable");return e?e.GetProperty("ColumnTreeList.ColumnList").GetPropertyValue()._value.length:0},GetBOMContent:function(e){for(var t=!1,i=[],r=this._experienceBase.getManager("VCXDressupManager").getDressupsFromGroup("Callouts"),a=0;a<r.length&&e;a++){var o=r[a];if(o){var s=o.QueryInterface("VCXIVisibility");if(s&&s.GetVisibility()!==d.EVisState.Hidden){var n=o.QueryInterface("VCXIModifiable");if(n){let e=null;var l=n.GetAttachedOccurences();if(l&&l.length>0&&(e=l[0]),!e)continue;let r=n.GetProperty("Collab.Text").GetPropertyValue().ToString(),a=C.GetLinkedParentLevelFromPropertyValue(r,e.GetObject().GetID(),this._experienceBase);if(a){var p=a.QueryInterface("VCXIVisibility");if(a.PartListEnabled&&p&&p.GetVisibility()){let e=a.PartListID;e&&(t=!0,i[e]||(i[e]={},i[e].calloutComponents=[],i[e].itemComponents=[]),i[e].calloutComponents.push(o),i[e].itemComponents.indexOf(a)<0&&i[e].itemComponents.push(a),null!==a.QueryInterface("W3AISGNodeHolder").getPathElement()&&(i[e].element=a.QueryInterface("W3AISGNodeHolder").getPathElement().getLastElement()))}}}}}}t||(e=!1);for(var u=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceComposer"),h=0;h<u.length;h++){var c=u[h];if(c)if((p=c.QueryInterface("VCXIVisibility"))&&p.GetVisibility())if(c.PartListEnabled){var y=c.PartListID;y>0&&(e||i[y]||(i[y]={},i[y].itemComponents=[]),i[y]&&i[y].itemComponents.indexOf(c)<0&&(i[y].itemComponents.push(c),null!==c.QueryInterface("W3AISGNodeHolder").getPathElement()&&(i[y].element=c.QueryInterface("W3AISGNodeHolder").getPathElement().getLastElement())))}}return i}});return Object.defineProperty(V.prototype,"filterHasChanged",{enumerable:!0,get:function(){return this._filterHasChanged},set:function(e){this._filterHasChanged=e}}),Object.defineProperty(V.prototype,"turnOnPartListVisibility",{enumerable:!0,get:function(){return this._turnOnPartListVisibility},set:function(e){this._turnOnPartListVisibility=e}}),Object.defineProperty(V.prototype,"ListHasChanged",{enumerable:!0,get:function(){var e=!1,t=this._experienceBase.getManager("VCXModelChangeListener");return t&&(e|=t.hasChanged(c.FChangeFlag.PartListID),e|=t.hasChanged(c.FChangeFlag.PartListEnabled),e|=t.hasChanged(c.FChangeFlag.PartListDescription),e|=t.hasChanged(c.FChangeFlag.DressupVisibility),e|=t.hasChanged(c.FChangeFlag.Visibility)),e|=this.filterHasChanged}}),Object.defineProperty(V.prototype,"componentType",{enumerable:!0,get:function(){return"VCXComponentPartListManager"}}),V}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXDressupModelNavigable",["require","exports","DS/WebApplicationBase/VCXAModelNavigable"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{isSelfOrganized(){return!0}}return r})),define("DS/VCXWebDressup/VCXIDressup",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})),define("DS/VCXWebDressup/VCXInternalMaterialSelectBehavior",["UWA/Class"],(function(e){"use strict";return e.extend({init:function(){},GetListForSelection:function(){return this._object._experienceBase.getManager("VCXContextManager").isSupported("TweakingMaterial")?this.GetObject().QueryInterface("VCXIMaterialCache").GetExposedTweaking():[]}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXDressupPrepareRenderToTexture",["require","exports","DS/VCXWebVisualization/VCXAPrepareRenderToTexture","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertySet"],(function(e,t,i,r,a,o,s,n){"use strict";r=__importDefault(r),a=__importDefault(a),o=__importDefault(o),s=__importDefault(s),n=__importDefault(n);return class extends i{GetType(){return"VCXDressupPrepareRenderToTexture"}constructor(){super(),this.propertyValuesCache=new Map,this.layerWrappers={},this.layerWrappers.white=this.filterWhiteLayerProperty.bind(this),this.layerWrappers.visibletop=this.filterVisibleTopLayerProperty.bind(this)}filterWhiteLayerProperty(e){return!(!e.GetPropertyInfo().GetPropertyName().endsWith(".Color")&&!e.GetPropertyInfo().GetPropertyName().endsWith(".Color.Opacity"))}filterVisibleTopLayerProperty(e){return!!e.GetPropertyInfo().GetPropertyName().endsWith(".Color.Opacity")||"Actor.IsAlwaysOnTop"===e.GetPropertyInfo().GetPropertyName()}async prepareRender(e,t){if(this.propertyValuesCache.get(t)?.size)return;const i=this.GetObject()?.QueryInterface("VCXIModifiable");let r=this.layerWrappers[t];if(r&&i){let a=new n.default;if(!i)return;i.GetProperties().onEachProperty(((e,t)=>{r(t)&&a.AddOrModifyProperty(t)}));let o={fromChildClass:!0};a.onEachProperty(((e,r)=>{let a=this.propertyValuesCache.get(t)??new Map;a.set(e,r.GetPropertyValue()),this.propertyValuesCache.set(t,a);let s=this.getValueForMask(e,t);s&&i.OnChangeProperty(e,s,o)})),i.OnChangePropertiesEnd(),this.GetObject()?.QueryInterface("W3AISGNodeHolder")?.getSGNode()?.update(e)}}async postRender(e,t){const i=this.GetObject()?.QueryInterface("VCXIModifiable");let r=this.layerWrappers[t];if(r&&i){let a=new n.default;if(!i)return;i.GetProperties().onEachProperty(((e,t)=>{r(t)&&a.AddOrModifyProperty(t)}));let o={fromChildClass:!0};a.onEachProperty(((e,r)=>{if(this.propertyValuesCache.get(t)?.get(e)){let r=this.propertyValuesCache.get(t)?.get(e);r&&i.OnChangeProperty(e,r,o)}})),i.OnChangePropertiesEnd(),this.GetObject()?.QueryInterface("W3AISGNodeHolder")?.getSGNode()?.update(e)}this.propertyValuesCache.get(t)?.clear()}getValueForMask(e,t){switch(t){case"visibletop":if("Actor.IsAlwaysOnTop"===e)return new r.default(!0);if(e.includes(".Opacity"))return new s.default(1);break;case"white":if(e.includes("Opacity")){let i=this.getModifiableValue(t,e);return void 0!==i&&i>0?new s.default(1):new s.default(0)}{let i=this.getModifiableValue(t,e+".Opacity");return void 0===i&&(i=1),new a.default((new o.default).FromRGBA(i,i,i,1))}}return null}getModifiableValue(e,t){return this.propertyValuesCache.get(e)?.get(t)?.GetValue()??this.GetObject()?.QueryInterface("VCXIModifiable")?.GetProperty(t)?.GetPropertyValue()?.GetValue()}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXCmdChangeDressup",["require","exports","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdChangeComponent","DS/VCXWebKernelCommands/VCXCmdChangeModifiable"],(function(e,t,i,r,a,o){"use strict";r=__importDefault(r),a=__importDefault(a),o=__importDefault(o);class s extends r.default{constructor(e){super(e),this._type="VCXCmdChangeDressup",this._title="Change Dressup",this._dressupsToAdd=[],this._dressupsToRemove=[],this._bLockEvents=!1}RemoveDressups(e){this._dressupsToRemove=this._dressupsToRemove.concat(e)}AddDressups(e){this._dressupsToAdd=this._dressupsToAdd.concat(e)}Do(){let e=this._experienceBase.getManager("VCXCommandManager"),t=this._experienceBase.getManager("VCXScenarioManager"),i=this._experienceBase.getManager("VCXDressupManager");var r=new a.default(this._experienceBase);r.AddComponents(this._dressupsToAdd),e.Push(r);var s=new o.default(this._experienceBase);s.SetLockEvents(this._bLockEvents),this._dressupsToAdd.map((e=>e.QueryInterface("VCXIModifiable"))).forEach((e=>{e&&s.AddModifiables(e)})),this._dressupsToRemove.map((e=>e.QueryInterface("VCXIModifiable"))).forEach((e=>{e&&s.RemoveModifiables(e)})),e.Push(s),0!==this._dressupsToAdd.length&&i.AddDressups(this._dressupsToAdd),this._removeDressup();var n=new a.default(e._experienceBase);n.RemoveComponents(this._dressupsToRemove),e.Push(n);var l=t.GetCurrentScenario(),p=t._experienceBase.ComponentsMap.GetComponentFromID(l);p&&t._experienceBase.getManager("VCXExperience")&&t._experienceBase.getManager("VCXExperience").UpdateScenarioThumbnail(p)}_removeDressup(){let e=this._experienceBase.getManager("VCXDressupManager");0!==this._dressupsToRemove.length&&e.RemoveDressups(this._dressupsToRemove),this._bLockEvents||e.RefreshVisuAfterDressupChange()}Undo(){let e=this._experienceBase.getManager("VCXDressupManager"),t=this._experienceBase.getManager("VCXScenarioManager");0!==this._dressupsToAdd.length&&e.RemoveDressups(this._dressupsToAdd),0!==this._dressupsToRemove.length&&e.AddDressups(this._dressupsToRemove),this._bLockEvents||e.RefreshVisuAfterDressupChange(),this._dressupsToAdd.forEach((e=>{t.SearchForVisibleComponent(e.QueryInterface("VCXIModifiable"),null,(e=>{e&&e.scenario&&e.scenario.GetID()!==t.GetCurrentScenario()&&e&&e.scenario&&e.scenario.SetDocDirty(!0)}))})),this._dressupsToRemove.forEach((e=>{t.SearchForVisibleComponent(e.QueryInterface("VCXIModifiable"),null,(e=>{e&&e.scenario&&e.scenario.GetID()!==t.GetCurrentScenario()&&e&&e.scenario&&e.scenario.SetDocDirty(!0)}))}));var i=t.GetCurrentScenario(),r=t._experienceBase.ComponentsMap.GetComponentFromID(i);r&&t._experienceBase.getManager("VCXExperience")&&t._experienceBase.getManager("VCXExperience").UpdateScenarioThumbnail(r)}Redo(){let e=this._experienceBase.getManager("VCXDressupManager"),t=this._experienceBase.getManager("VCXScenarioManager");0!==this._dressupsToAdd.length&&e.AddDressups(this._dressupsToAdd),0!==this._dressupsToRemove.length&&e.RemoveDressups(this._dressupsToRemove),this._bLockEvents||e.RefreshVisuAfterDressupChange(),this._dressupsToAdd.forEach((e=>{t.SearchForVisibleComponent(e.QueryInterface("VCXIModifiable"),null,(e=>{e&&e.scenario&&e.scenario.GetID()!==t.GetCurrentScenario()&&e&&e.scenario&&e.scenario.SetDocDirty(!0)}))})),this._dressupsToRemove.forEach((e=>{t.SearchForVisibleComponent(e.QueryInterface("VCXIModifiable"),null,(e=>{e&&e.scenario&&e.scenario.GetID()!==t.GetCurrentScenario()&&e&&e.scenario&&e.scenario.SetDocDirty(!0)}))}));var i=t.GetCurrentScenario(),r=t._experienceBase.ComponentsMap.GetComponentFromID(i);r&&t._experienceBase.getManager("VCXExperience")&&t._experienceBase.getManager("VCXExperience").UpdateScenarioThumbnail(r)}SetLockEvents(e){this._bLockEvents=e}}return s})),define("DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShape",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools"],(function(e,t,i){"use strict";return e.extend({init:function(e){this.sizeView=e,this.fHalfSizeX=.5*this.sizeView.x,this.fHalfSizeY=.5*this.sizeView.y,this.iCurrent=0},next:function(){return this.iCurrent++,this.iCurrent>=this.iNbPt&&(this.iCurrent=this.iNbPt-1),!1},rewind:function(){this.iCurrent=0,this.iNbPt=(Math.floor(this.sizeView.x/this.fCellSize)+1)*(Math.floor(this.sizeView.y/this.fCellSize)+1)},getPoint:function(){}})})),define("DS/VCXWebDressup/VCXPartList/VCXPartListManagerModifiable",["DS/VCXWebModifiables/VCXModifiable","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueMap"],(function(e,t,i,r,a,o,s,n){"use strict";return e.extend({init:function(e){this._Properties=[]},BuildProp:function(e,r,a){var o=new i(e,1),s=new r;s.Value=a,this._Properties[e]=new t(o,s),this.SetProperty(e,s)},BuildColumn:function(e){var t=new s;return t.SetValue(e),t},Build:function(){this._parent(),this.BuildProp("BOM.Filter",o,0),this.BuildProp("BOM.Sort.Ascendant",a,!0),this.BuildProp("BOM.Sort.PropertyName",s,"Actor.PartList.ID");var e=new n;e.SetValueAtIndex(0,this.BuildColumn("Actor.PartList.ID")),e.SetValueAtIndex(1,this.BuildColumn("Actor.PartList.Description")),e.SetValueAtIndex(2,this.BuildColumn("PartList.Quantity"));var r=new i("ColumnTreeList.ColumnList",1);this._Properties["ColumnTreeList.ColumnList"]=new t(r,e),this.SetProperty("ColumnTreeList.ColumnList",e)},SetProperty:function(e,r){var a=new i(e,0);this._Properties[e]=new t(a,r.Clone())},OnChangeProperty:function(e,t,i){if(i||(i={}),i.fromChildClass);else if(this.OnChangePropertyBegin(e,t))return!0;this.SetProperty(e,t)},OnChangePropertiesEnd:function(){this.GetObject().update&&this.GetObject().update()},GetProperty:function(e){var i=null;if(this._Properties[e]&&e)if("ColumnTreeList.ColumnList"!==e)i=new t(this._Properties[e].GetPropertyInfo(),this._Properties[e].GetPropertyValue().Clone());else{const e=this.GetObject()._experienceBase.ComponentsMap.GetComponentFromType("VCXPartList_Spec");if(e&&e.length){let t=e[0].QueryInterface("VCXIModifiable");t&&(i=t.GetProperty("Collab.PartList.ColumnList"))}}return i},GetProperties:function(e){var t=new r;for(var i in this._Properties)this._Properties.hasOwnProperty(i)&&t.AddOrModifyProperty(this.GetProperty(i));return t}})})),define("DS/VCXWebDressup/VCX3DGrid/VCX3DGridManager",["UWA/Class","DS/CoreEvents/Events","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueLink","DS/VCXWebProperties/VCXPropertyValueLocation","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebIO/VCXLogServices"],(function(e,t,i,r,a,o,s,n,l,p,u,h,d,c){"use strict";const C=e.extend({init:function(){this.patternColors=[],this._isSomethingManipulatedOn=null,this._logUUID=null},initialize:function(){this.grids={},this.tokens={}},postInitialize:function(){this.currentChosenColorIdx=-1,this.patternColors.push((new r).FromRGBA(.52,.25,.22,1)),this.patternColors.push((new r).FromRGBA(.28,.47,.22,1)),this.patternColors.push((new r).FromRGBA(0,.24,.35,1)),this.patternColors.push((new r).FromRGBA(0,0,0,1)),this.patternColors.push((new r).FromRGBA(.56,.3,0,1)),this.tokens.addDressup=t.subscribe({event:"VCX_DRESSUPS_ADDED"},(e=>this.addNewGrid(e))),this.tokens.removeDressup=t.subscribe({event:"VCX_DRESSUPS_PREREMOVED"},(e=>this.removeGrid(e))),this.tokens.unLinkGrids=t.subscribe({event:"VCX_INTERACTOR_END_MANIPULATE"},(e=>{for(let t in this.grids)if(this.grids.hasOwnProperty(t)){let i=this.grids[t];i&&this.unLinkSnappedAfterManipulation(e.viewer,i)}})),this.tokens.destroyGrids=t.subscribe({event:"VCX_END_RULERS"},(()=>{this._destroyAllRulers()}))},unInitialize:function(){for(let e in this.tokens)this.tokens.hasOwnProperty(e)&&(t.unsubscribe(this.tokens[e]),delete this.tokens.tokenID)},getCurrentColor:function(){return this.patternColors[this.currentChosenColorIdx]},addNewGrid:function(e){e&&e.forEach((e=>{if(e.IsKindOf("VCX3DGrid_Spec")){this.grids[e.GetID()]=e;let t=e.QueryInterface("VCXIModifiable");t&&(this.currentChosenColorIdx++,this.currentChosenColorIdx%=this.patternColors.length,t.OnChangeProperty("Actor.Color",new h(this.patternColors[this.currentChosenColorIdx]))),this.Dirty=!0}}))},showHideAllGrids:function(e){if(this.grids)for(let t in this.grids)if(this.grids.hasOwnProperty(t)){this.grids[t].QueryInterface("W3AISGNodeHolder").getSGNode().setVisibility(e)}},_getGridByID:function(e){const t=this.grids[e];return t||null},checkSnappingGrid:function(e){let t=this._getGridByID(e.GetID());if(t){const e=t.QueryInterface("VCXIModifiable");if(e){const t=e.GetProperty("3DGrid.Active");if(t){return t.GetPropertyValue().GetValue()}}}return!1},_logPerfo:function(e,t,i){const r=this._getGridByID(e.GetID());if(r){const e=r.QueryInterface("VCXIManipulable");if(e){const r=e.getNode();if(r){const e=r.GetGridSizeAllLines();e&&c.memoryLog("Snap on Grid",i,t,{N:e,parameterName:"cell"})}}}},_destroyAllRulers:function(){for(let e in this.grids)if(this.grids.hasOwnProperty(e)){let t=this.grids[e];if(t){const e=t.QueryInterface("VCXIManipulable");e&&e._rulers&&e._rulers.hideAllRulers()}}},linkSnappedDuringManipulation:function(e,t){if(!t||!t.component)return;const i=e.QueryInterface("VCXIModifiable").GetPropertyValue("3DGrid.Snapped.Dressups");i.filter((e=>e===t.component.GetID())).length||(i.push(t.component.GetID()),e.QueryInterface("VCXIModifiable").OnChangeProperty("3DGrid.Snapped.Dressups",new s(i)))},unLinkSnappedAfterManipulation:function(e,t){const r=t.QueryInterface("VCXIModifiable").GetPropertyValue("3DGrid.Snapped.Dressups"),n=new o;for(let o of r){let r=t.GetObject()._experienceBase.ComponentsMap.GetComponentFromID(o);if(r){let o=r.QueryInterface("VCXIModifiable"),s=new a,p=t.QueryInterface("W3AISGNodeHolder"),u=null;if(p&&(u=p.giveSGNode()),o&&u){let r=o._Anchors;for(let a in r){let n=r[a].GetValueLink();if(n){if(n.GetValue()===t.GetObject().GetID()){let t=new l;r[a].SetValueLink(t);let n=r[a].GetValueFrame(),p=(new i.Matrix4).multiplyMatrices(u.GetWorldMatrix(e),n.GetValue());n.SetValue(p),r[a].SetValueFrame(n);let h=o.GetProperty("Actor.Anchor."+a),d=h.GetPropertyValue();d.SetValueLink(t),d.SetValueFrame(n),h.SetPropertyValue(d),s.AddOrModifyProperty(h)}}}n.AddOrModifyPropertySet(o.GetHashing(),s)}}}t.QueryInterface("VCXIModifiable").OnChangeProperty("3DGrid.Snapped.Dressups",new s([]));var p=new d(t.GetObject()._experienceBase);p.ChangePropertiesFromMap(n),t.GetObject()._experienceBase.getManager("VCXCommandManager").Push(p)},manageAllGuidingLines:function(e,t){for(let i in this.grids)if(this.grids.hasOwnProperty(i)){let r=this.grids[i];const a=r.QueryInterface("VCXIManipulable");if(r&&a){const i=a.getNode();i&&(e&&r.GetID()===e?i._AddNodeForDebugSnapping(t):i._removeLinesCoordinates())}}},detectGrid:function(e,t,r,a,o){this._destroyAllRulers();let s=this._getGridByID(t.GetID());if(s){const t=s.QueryInterface("VCXIManipulable"),n=s.QueryInterface("VCXIModifiable");if(t&&n){const l=t.getNode();if(l){const t=l.GetWorldGridNodeCorners(e),p=l.GetGridUnit();if(p){const u=n.GetProperty("Actor.Position").GetPropertyValue();if(u){const n=u.GetFrame().GetValue();let h=(new i.Vector3).getPositionFromMatrix(n);const d=(new i.Vector3).subVectors(t.TopLeft,t.BottomLeft).normalize(),c=(new i.Vector3).subVectors(t.TopRight,t.TopLeft).normalize(),C=(new i.Vector3).crossVectors(c,d).normalize();let y=new i.Plane;y.setFromNormalAndCoplanarPoint(C,h);let m=new i.Vector3;r.intersectPlane(y,m);let V=new i.Vector3;y.projectPoint(m,V);let f=new i.Vector3;y.projectPoint(h,f);let b=(new i.Vector3).subVectors(V,f),P=b.dot(c),g=b.dot(d);const _=l.GetNodeDimensionsLimit(),M=this._findClosestVertexToPoint(P,g,p,_);if(M){this.manageAllGuidingLines(s.GetID(),M);const t=M.clone().applyMatrix4(l.GetWorldMatrix(e));return o.globalPosition=t,o.globalNormal=C.clone(),this.linkSnappedDuringManipulation(s,a),{point:t,globalPosition:t,globalNormal:C.clone()}}}}}}this.manageAllGuidingLines(null,null)}return null},_findClosestVertexToPoint(e,t,r,a){let o=Math.round(e/r)*r,s=Math.round(t/r)*r;return o>a.XMax||o<a.XMin||s>a.YMax||s<a.YMin?null:new i.Vector3(o,s,0)},_linkDressupToSnap:function(e,t,r){if(!(r&&r.component&&r.id))return;let a=r.component.QueryInterface("VCXIModifiable")._Anchors;if(("Actor."+r.id.substring(r.id.indexOf("Anchor"))).includes("Anchor")&&a){let r=Object.keys(a)[manipulatedInteractordata.anchor];if(null!=r&&a.hasOwnProperty(r)){let o=a[r],s=o.GetValueLink();if(s){s.GetValue();let r=new l(e.GetID());o.SetValueLink(r);let a=o.GetValueFrame(),n=(new i.Matrix4).setPosition(t);a.SetValue(n),o.SetValueFrame(a)}}}},removeGrid:function(e){e&&e.forEach((e=>{if(e.IsKindOf("VCX3DGrid_Spec")){let t=e.GetID();this.grids&&this.grids[t]&&(delete this.grids[t],this.currentChosenColorIdx--,this.Dirty=!0)}}))},update:function(e){this.Dirty&&(this.Dirty=!1)}});return Object.defineProperty(C.prototype,"Dirty",{enumerable:!0,get:function(){return this._Dirty},set:function(e){this._Dirty=e}}),Object.defineProperty(C.prototype,"componentType",{enumerable:!0,get:function(){return"VCX3DGridManager"}}),C})),define("DS/VCXWebDressup/VCXPropertyValueUnitFormater",["UWA/Class","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],(function(e,t){"use strict";var i=e.extend({init:function(){}});return i.format=function(e,i){var r,a=e.GetPropertyValue(),o=e.GetPropertyInfo();switch(a.GetType()){case"VCXPropertyValueFloat":var s=o.GetUnitType();if(s){var n=i.getManager("VCXUnitManager");if(n)return n.getString(a.Value,s)}return a.Value.toFixed(2);case"VCXPropertyValueEnum":r=a.ToString();var l=o.GetMapChoiceEnum();if(l){r=l[a.Value];var p=t[r];r=void 0===p?"":p}break;default:r=a.ToString()}return r},i}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXAmbience/AmbienceModelVCXCXPConvertor",["require","exports","DS/VCXWebEWS/VCXBaseVCXCXPConvertor"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{constructor(){super(),this._fallBackValue={},this._fallBackValue={"Ambience.Background.Rotation":"Dome Rotation Z","Ambience.Background.Exposure":"Exposure","Ambience.Lighting.Exposure":"Exposure"}}_computeTab(){return[...super._computeTab(),{variableName:"Dome Origin",propertyName:"Ambience.Background.Position",type:"Vector3"},{variableName:"Dome Radius",propertyName:"Ambience.Background.Radius"},{variableName:"Background Rotation Z",propertyName:"Ambience.Background.Rotation"},{variableName:"Background Exposure",propertyName:"Ambience.Background.Exposure"},{variableName:"Finite Dome",propertyName:"Ambience.Background.Finite"},{variableName:"Ground Glossiness",propertyName:"Ambience.Ground.Glossiness"},{variableName:"Ground Offset",propertyName:"Ambience.Ground.Offset"},{variableName:"Ground Reflectivity",propertyName:"Ambience.Ground.Reflectivity"},{variableName:"Ground Scale Ratio",propertyName:"Ambience.Ground.Scaleratio"},{variableName:"Lighting Rotation Z",propertyName:"Ambience.Lighting.Rotation"},{variableName:"Lighting Exposure",propertyName:"Ambience.Lighting.Exposure"}]}GetNeutralsFromVariables(e){let t=this.getTab(),i=this.QueryInterface("CATI3DExperienceObject").IsComputedVariable("Background Rotation Z")&&!this.QueryInterface("CATI3DExperienceObject").IsComputedVariable("Dome Rotation Z");t&&t.forEach((t=>{i&&this._fallBackValue[t.propertyName]&&(t={...t,variableName:this._fallBackValue[t.propertyName]}),this._ProcessNeutralsFromVariables(e,{...t})})),this._variablesToProperties(e)}}return Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"AmbienceModelVCXCXPConvertor"}}),r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXPathLines/VCXAssociativePathManager",["require","exports","DS/VCXWebComponents/VCXWebComponentBaseExperience","DS/CoreEvents/Events"],(function(e,t,i,r){"use strict";i=__importDefault(i);class a extends i.default{constructor(){super(),this.associativePaths={},this.tokens={}}initialize(){this.associativePaths={},this.tokens={}}postInitialize(){this.tokens.addDressup=r.subscribe({event:"VCX_DRESSUPS_ADDED"},(e=>this._addNewAssociativePath(e))),this.tokens.removeDressup=r.subscribe({event:"VCX_DRESSUPS_PREREMOVED"},(e=>this._removeAssociativePath(e)))}unInitialize(){for(let e in this.tokens)this.tokens.hasOwnProperty(e)&&(r.unsubscribe(this.tokens[e]),delete this.tokens.tokenID)}update(e){for(let t in this.associativePaths)if(this.associativePaths.hasOwnProperty(t)){const i=this.associativePaths[t].QueryInterface("W3AISGNodeHolder");if(i){const t=i.getSGNode();t&&t.Dirty&&t.update&&t.update(e)}}}_addNewAssociativePath(e){e&&e.forEach((e=>{e.IsKindOf("VCXAssociativePath_Spec")&&(this.associativePaths[e.GetID()]=e)}))}_removeAssociativePath(e){e&&e.forEach((e=>{if(e.IsKindOf("VCXAssociativePath_Spec")){let t=e.GetID();this.associativePaths&&this.associativePaths[t]&&delete this.associativePaths[t]}}))}get componentType(){return"VCXAssociativePathManager"}}return a})),define("DS/VCXWebDressup/VCXHiddenPrepareRenderToTexture",["require","exports","DS/VCXWebVisualization/VCXAPrepareRenderToTexture"],(function(e,t,i){"use strict";return class extends i{constructor(){super(),this._needToRestoreVisibility=!1}async prepareRender(){let e=this.GetObject()?.QueryInterface("W3AISGNodeHolder"),t=e?.getSGNode();t?.isVisible()&&(this._needToRestoreVisibility=!0,t.setVisibility(!1))}async postRender(){if(this._needToRestoreVisibility){let e=this.GetObject()?.QueryInterface("W3AISGNodeHolder"),t=e?.getSGNode();t&&t.setVisibility(!0),this._needToRestoreVisibility=!1}}GetType(){return"VCXHiddenPrepareRenderToTexture"}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXArrow/VCXArrowStylesHolder",["require","exports","DS/VCXWebStyles/VCXAStylesHolder","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],(function(e,t,i,r){"use strict";r=__importDefault(r);return class extends i{getStyleType(){return"VCXArrow_Spec"}getDefaultName(){return r.default["DefaultComponentName.Arrow"]}}})),define("DS/VCXWebDressup/VCXWebDressupDictionary",[],(function(){"use strict";var e={VCXDressup_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXADressup",VCXIContextualContent:"DS/VCXWebDressup/VCXContextualContentDressup_Spec",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIStylesHolder:"DS/VCXWebStyles/VCXAStylesHolder",VCXICuttableObject:"DS/VCXWebDressup/VCXACuttableObject"},CXPCameraActor_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXViewpoint/VCXCameraDressup",VCXIModifiable:"DS/VCXWebDressup/VCXViewpoint/VCXCameraModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXViewpoint/VCXCameraModifiableView",W3AISGNodeHolder:"DS/VCXWebDressup/VCXViewpoint/VCXCameraSGNodeHolder",VCXIViewpointController:"DS/VCXWebDressup/VCXViewpoint/VCXAViewpointController"},VCXViewpoint_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXViewpoint/VCXViewpointDressup",VCXIVisibility:"DS/VCXWebVisibilityImpl/VCXVisibilityShow",VCXIModifiable:"DS/VCXWebDressup/VCXViewpoint/VCXViewpointModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXViewpoint/VCXViewpointModifiableView",W3AISGNodeHolder:"DS/VCXWebDressup/VCXViewpoint/VCXViewpointSGNodeHolder",VCXIViewpointController:"DS/VCXWebDressup/VCXViewpoint/VCXAViewpointController",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXHiddenPrepareRenderToTexture"},VCXViewport_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXViewpoint/VCXViewportDressup",VCXIVisibility:"DS/VCXWebVisibilityImpl/VCXVisibilityHidden",VCXIModifiable:"DS/VCXWebDressup/VCXViewpoint/VCXViewportModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXViewpoint/VCXViewportModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXViewpoint/VCXViewportModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXViewpoint/VCXViewportSGNodeHolder",VCXIViewpointController:"DS/VCXWebDressup/VCXViewpoint/VCXAViewpointController"},AmbienceModel_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXAmbience/VCXAmbienceDressup",VCXIModifiable:"DS/VCXWebDressup/VCXAmbience/VCXAmbienceModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXAmbience/VCXAmbienceModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXAmbience/VCXAmbienceModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXAmbience/VCXAmbienceSGNodeHolder",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeAmbience",VCXIReadiness:"DS/WebApplicationBase/VCXAReadiness",VCXIVisibility:"DS/VCXWebVisibilityImpl/VCXVisibilityHidden"},VCXArrow_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXADressup",VCXICuttableObject:"DS/VCXWebDressup/VCXCuttableObjectArrowAndCircle",VCXIStylesHolder:"DS/VCXWebDressup/VCXArrow/VCXArrowStylesHolder"},VCXLinearArrow_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXArrow/VCXLinearArrowDressup",VCXIModifiable:"DS/VCXWebDressup/VCXArrow/VCXLinearArrowModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXArrow/VCXLinearArrowModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXArrow/VCXLinearArrowModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXArrow/VCXLinearArrowSGNodeHolder",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXDressupPrepareRenderToTexture"},VCXCircularArrow_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXArrow/VCXCircularArrowDressup",VCXIModifiable:"DS/VCXWebDressup/VCXArrow/VCXCircularArrowModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXArrow/VCXCircularArrowModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXArrow/VCXCircularArrowModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXArrow/VCXCircularArrowSGNodeHolder",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXDressupPrepareRenderToTexture"},VCXCornerArrow_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXArrow/VCXCornerArrowDressup",VCXIModifiable:"DS/VCXWebDressup/VCXArrow/VCXCornerArrowModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXArrow/VCXArrowModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXArrow/VCXCornerArrowModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXArrow/VCXCornerArrowSGNodeHolder",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXDressupPrepareRenderToTexture"},VCXCircle_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXCircle/VCXCircleDressup",VCXIModifiable:"DS/VCXWebDressup/VCXCircle/VCXCircleModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXCircle/VCXCircleModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXCircle/VCXCircleModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXCircle/VCXCircleSGNodeHolder",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXCircle/VCXCirclePrepareRenderToTexture",VCXICuttableObject:"DS/VCXWebDressup/VCXCuttableObjectArrowAndCircle"},VCXHotspot_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXHotspot/VCXHotspotDressup",VCXIModifiable:"DS/VCXWebDressup/VCXHotspot/VCXHotspotModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXHotspot/VCXHotspotModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXHotspot/VCXHotspotModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXHotspot/VCXHotspotSGNodeHolder",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXMarkup/VCXMarkupPrepareRenderToTexture",VCXICuttableObject:"DS/VCXWebDressup/VCXCuttableObjectArrowAndCircle",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorHotspot"},VCXRedLine_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXRedLine/VCXRedLineDressup",VCXIModifiable:"DS/VCXWebDressup/VCXRedLine/VCXRedLineModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXRedLine/VCXRedLineModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXRedLine/VCXRedLineModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXRedLine/VCXRedLineSGNodeHolder",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXDressupPrepareRenderToTexture"},VCXCompass_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXCompass/VCXCompassDressup",VCXIModifiable:"DS/VCXWebDressup/VCXCompass/VCXCompassModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXCompass/VCXCompassModifiableView",W3AISGNodeHolder:"DS/VCXWebDressup/VCXCompass/VCXCompassSGNodeHolder"},VCXPanel_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXMarkup/VCXPanelDressup",VCXIModifiable:"DS/VCXWebDressup/VCXMarkup/VCXPanelModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXMarkup/VCXPanelModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXMarkup/VCXPanelModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXMarkup/VCXPanelSGNodeHolder",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorDressupPanel",VCXIReadiness:"DS/WebApplicationBase/VCXAReadiness",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXMarkup/VCXMarkupPrepareRenderToTexture",VCXIStylesHolder:"DS/VCXWebDressup/VCXMarkup/VCXPanelStylesHolder",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodePanel"},VCXDiggerPanel_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXMarkup/VCXDiggerPanelDressup",VCXIModifiable:"DS/VCXWebDressup/VCXMarkup/VCXDiggerPanelModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXMarkup/VCXPanelModifiableView",W3AISGNodeHolder:"DS/VCXWebDressup/VCXMarkup/VCXDiggerPanelSGNodeHolder",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorDressupPanel",VCXIReadiness:"DS/WebApplicationBase/VCXAReadiness"},VCXLabel_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXMarkup/VCXLabelDressup",VCXIModifiable:"DS/VCXWebDressup/VCXMarkup/VCXLabelModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXMarkup/VCXLabelModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXMarkup/VCXLabelModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXMarkup/VCXLabelSGNodeHolder",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorDressupPanel",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXMarkup/VCXMarkupPrepareRenderToTexture"},VCXMeasurement_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXMarkup/VCXMeasurementDressup",VCXIModifiable:"DS/VCXWebDressup/VCXMarkup/VCXMeasurementModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXMarkup/VCXMeasurementModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXMarkup/VCXMeasurementModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXMarkup/VCXMeasurementSGNodeHolder",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXMarkup/VCXMeasurementPrepareRenderToTexture"},VCXCallout_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXMarkup/VCXCalloutDressup",VCXIModifiable:"DS/VCXWebDressup/VCXMarkup/VCXCalloutModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXMarkup/VCXCalloutModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXMarkup/VCXCalloutModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXMarkup/VCXCalloutSGNodeHolder",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXMarkup/VCXMarkupPrepareRenderToTexture"},VCXSection_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXSection/VCXSectionDressup",VCXIModifiable:"DS/VCXWebDressup/VCXSection/VCXSectionModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXSection/VCXSectionModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXSection/VCXSectionModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXSection/VCXSectionSGNodeHolder"},VCX3DAligner_Spec:{VCXIDressup:"DS/VCXWebDressup/VCX3DAligner/VCX3DAlignerDressup",VCXIModifiable:"DS/VCXWebDressup/VCX3DAligner/VCX3DAlignerModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCX3DAligner/VCX3DAlignerModifiableView",W3AISGNodeHolder:"DS/VCXWebDressup/VCX3DAligner/VCX3DAlignerSGNodeHolder"},VCX3DGrid_Spec:{VCXIDressup:"DS/VCXWebDressup/VCX3DGrid/VCX3DGridDressup",VCXIModifiable:"DS/VCXWebDressup/VCX3DGrid/VCX3DGridModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCX3DGrid/VCX3DGridModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCX3DGrid/VCX3DGridModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCX3DGrid/VCX3DGridSGNodeHolder",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXHiddenPrepareRenderToTexture"},VCXAssociativePath_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXPathLines/VCXAssociativePathDressup",VCXIModifiable:"DS/VCXWebDressup/VCXPathLines/VCXAssociativePathModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXPathLines/VCXAssociativePathModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXPathLines/VCXAssociativePathModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXPathLines/VCXAssociativePathSGNodeHolder",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXDressupPrepareRenderToTexture"},VCXPolyline_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXPathLines/VCXPolylineDressup",VCXIModifiable:"DS/VCXWebDressup/VCXPathLines/VCXPolylineModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXPathLines/VCXPolylineModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXPathLines/VCXPolylineModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXPathLines/VCXPolylineSGNodeHolder",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXPathLines/VCXPolylinePrepareRenderToTexture"},VCXMagnetLine_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXMagnetLine/VCXMagnetLineDressup",VCXIModifiable:"DS/VCXWebDressup/VCXMagnetLine/VCXMagnetLineModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXMagnetLine/VCXMagnetLineModifiableView",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXMagnetLine/VCXMagnetLineSGNodeHolder",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXHiddenPrepareRenderToTexture",VCXIVisibility:"DS/VCXWebDressup/VCXMagnetLine/VCXVisibilityMagnetLine"},VCXPartList_Spec:{VCXIDressup:"DS/VCXWebDressup/VCXPartList/VCXPartListDressup",VCXIModifiable:"DS/VCXWebDressup/VCXPartList/VCXPartListModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXPartList/VCXPartListModifiableView",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXPartList/VCXPartListSGNodeHolder",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXPartList/VCXPartListPrepareRenderToTexture"},VCXComponentDressupGrp:{VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressupGrp",W3AISGNodeHolder:"DS/VCXWebDressup/VCXDressupGrpSGNodeHolder",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable"},VCXDressupManager:{W3AISGNodeHolder:"DS/VCXWebDressup/VCXDressupManagerSGNodeHolder",W3AIManager:"DS/WebApplicationBase/W3AAManager",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable"},VCXSectionManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCX3DGridManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXAssociativePathManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXComponentPartListManager:{VCXIModifiable:"DS/VCXWebDressup/VCXPartList/VCXPartListManagerModifiable",W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXMagnetLineManager:{VCXIModifiable:"DS/VCXWebDressup/VCXMagnetLine/VCXMagnetLineManagerModifiable",W3AIManager:"DS/WebApplicationBase/W3AAManager"}},t={VCXIDressup:"DS/VCXWebDressup/VCXIDressup",VCXIPrepareRenderToTexture:"DS/VCXWebVisualization/VCXIPrepareRenderToTexture",VCXIStylesHolder:"DS/VCXWebStyles/VCXIStylesHolder"},i={VCXViewport_Spec:"DS/VCXWebDressup/VCXViewpoint/VCXViewport_Spec",VCXViewpoint_Spec:"DS/VCXWebDressup/VCXViewpoint/VCXViewpoint_Spec",VCXComponentViewport:"DS/VCXWebDressup/VCXViewpoint/VCXViewport_Spec",AmbienceModel_Spec:"DS/VCXWebDressup/VCXAmbience/AmbienceModel_Spec",VCXLinearArrow_Spec:"DS/VCXWebDressup/VCXArrow/VCXLinearArrow_Spec",VCXComponentArrowLinear:"DS/VCXWebDressup/VCXArrow/VCXLinearArrow_Spec",VCXCircularArrow_Spec:"DS/VCXWebDressup/VCXArrow/VCXCircularArrow_Spec",VCXComponentArrowCircular:"DS/VCXWebDressup/VCXArrow/VCXCircularArrow_Spec",VCXCornerArrow_Spec:"DS/VCXWebDressup/VCXArrow/VCXCornerArrow_Spec",VCXComponentArrowCorner:"DS/VCXWebDressup/VCXArrow/VCXCornerArrow_Spec",VCXCircle_Spec:"DS/VCXWebDressup/VCXCircle/VCXCircle_Spec",VCXComponentCircle:"DS/VCXWebDressup/VCXCircle/VCXCircle_Spec",VCXPolyline_Spec:"DS/VCXWebDressup/VCXPathLines/VCXPolyline_Spec",VCXComponentPolyline:"DS/VCXWebDressup/VCXPathLines/VCXPolyline_Spec",VCXAssociativePath_Spec:"DS/VCXWebDressup/VCXPathLines/VCXAssociativePath_Spec",VCXComponentAssociativePath:"DS/VCXWebDressup/VCXPathLines/VCXAssociativePath_Spec",VCXMagnetLine_Spec:"DS/VCXWebDressup/VCXMagnetLine/VCXMagnetLine_Spec",VCXPanel_Spec:"DS/VCXWebDressup/VCXMarkup/VCXPanel_Spec",VCXComponentPanel:"DS/VCXWebDressup/VCXMarkup/VCXPanel_Spec",VCXDiggerPanel_Spec:"DS/VCXWebDressup/VCXMarkup/VCXDiggerPanel_Spec",VCXComponentDiggerPanel:"DS/VCXWebDressup/VCXMarkup/VCXDiggerPanel_Spec",VCXLabel_Spec:"DS/VCXWebDressup/VCXMarkup/VCXLabel_Spec",VCXComponentLabel:"DS/VCXWebDressup/VCXMarkup/VCXLabel_Spec",VCXMeasurement_Spec:"DS/VCXWebDressup/VCXMarkup/VCXMeasurement_Spec",VCXComponentMeasurement:"DS/VCXWebDressup/VCXMarkup/VCXMeasurement_Spec",VCXSection_Spec:"DS/VCXWebDressup/VCXSection/VCXSection_Spec",VCXComponentSection:"DS/VCXWebDressup/VCXSection/VCXSection_Spec",VCX3DAligner_Spec:"DS/VCXWebDressup/VCX3DAligner/VCX3DAligner_Spec",VCXComponent3DAligner:"DS/VCXWebDressup/VCX3DAligner/VCX3DAligner_Spec",VCX3DGrid_Spec:"DS/VCXWebDressup/VCX3DGrid/VCX3DGrid_Spec",VCXComponent3DGrid:"DS/VCXWebDressup/VCX3DGrid/VCX3DGrid_Spec",VCXCallout_Spec:"DS/VCXWebDressup/VCXMarkup/VCXCallout_Spec",VCXComponentCallout:"DS/VCXWebDressup/VCXMarkup/VCXCallout_Spec",VCXComponentDressupGrp:"DS/VCXWebDressup/VCXComponentDressupGrp",VCXRedLine_Spec:"DS/VCXWebDressup/VCXRedLine/VCXRedLine_Spec",VCXComponentRedLine:"DS/VCXWebDressup/VCXRedLine/VCXRedLine_Spec",VCXCompass_Spec:"DS/VCXWebDressup/VCXCompass/VCXCompass_Spec",VCXComponentCompass:"DS/VCXWebDressup/VCXCompass/VCXCompass_Spec",CXPCameraActor_Spec:"DS/VCXWebDressup/VCXCamera/CXPCameraActor_Spec",VCXComponentCamera:"DS/VCXWebDressup/VCXCamera/CXPCameraActor_Spec",VCXExperience:"DS/VCXWebComposer/VCXExperience",VCXDressupManager:"DS/VCXWebDressup/VCXDressupManager",VCXSectionManager:"DS/VCXWebDressup/VCXSection/VCXSectionManager",VCXMagnetLineManager:"DS/VCXWebDressup/VCXMagnetLine/VCXMagnetLineManager",VCX3DGridManager:"DS/VCXWebDressup/VCX3DGrid/VCX3DGridManager",VCXAssociativePathManager:"DS/VCXWebDressup/VCXPathLines/VCXAssociativePathManager",VCXMagnetLineManager:"DS/VCXWebDressup/VCXMagnetLine/VCXMagnetLineManager",VCXPartList_Spec:"DS/VCXWebDressup/VCXPartList/VCXPartList_Spec",VCXComponentPartListManager:"DS/VCXWebDressup/VCXPartList/VCXComponentPartListManager",VCXComponentPartList:"DS/VCXWebDressup/VCXPartList/VCXPartList_Spec",VCXICuttableObject:"DS/VCXWebKernel/VCXICuttableObject",VCXHotspot_Spec:"DS/VCXWebDressup/VCXHotspot/VCXHotspot_Spec"};return{GetDictionary:function(){return{interfaces:t,components:i,extensions:e}}}})),define("DS/VCXWebDressup/VCXMagnetLine/VCXMagnetLineManager",["UWA/Class","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebModifiables/VCXModelChangeListener"],(function(e,t,i,r,a,o,s,n){"use strict";var l=e.extend({init:function(){},postUpdate:function(e){}});return Object.defineProperty(l.prototype,"componentType",{enumerable:!0,get:function(){return"VCXMagnetLineManager"}}),l})),define("DS/VCXWebDressup/VCXContextualContentDressup_Spec",["DS/VCXWebKernel/VCXContextualContentOccurenceExperience","DS/VCXWebKernelCommands/VCXCmdApplyTo","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables","i18n!DS/VCXWebKernel/assets/nls/VCXWebKernel"],(function(e,t,i,r){"use strict";return e.extend({appendContent:function(e,a,o){const s=this.GetObject()._experienceBase,n=s.getManager("VCXVisuManager");if((!n||!n.getNonVisibleSpaceState())&&a){let o=s.getManager("VCXStylesManager").createContentCommandsPanel(this.GetObject(),i);if(e.StylesList={type:"panel",name:"ChangeStyleSelection",cmdId:"VCXStylePanelCmd",content:o,index:30},1===a.length){if("VCXViewpoint_Spec"!==a[0].GetType()){e.Visibility={type:"button",name:"Dropdown_hide",cmdId:"VCXHideSelectionCmd",index:10},e.Duplicate={type:"button",name:"DuplicateSelection",cmdId:"VCXDuplicateCmd",index:20};var l=[];l.push({type:"PushItem",title:"Cut",state:"enabled",action:"VCXCutCmd",fonticon:{content:"wux-ui-3ds-cut wux-ui-3ds"}}),l.push({type:"PushItem",title:"Copy",state:"enabled",action:"VCXCopyCmd",fonticon:{content:"wux-ui-3ds-copy wux-ui-3ds"}}),l.push({type:"PushItem",title:"Paste",state:s&&s._componentsToCopy&&0!=s._componentsToCopy.length?"enabled":"disabled",action:"VCXPasteCmd",fonticon:{content:"wux-ui-3ds-paste wux-ui-3ds"}}),l.push({type:"PushItem",title:"Apply To",fonticon:{content:"wux-ui-3ds-propagate wux-ui-3ds"},submenu:[{type:"PushItem",title:r["Cmd.ApplyTo.All"],state:t.checkSelectionContext(s,{scenariosFilter:"all"}).state,fonticon:{content:"wux-ui-3ds-select-all-checkboxes wux-ui-3ds"},action:"VCXApplyToAllCmd"},{type:"PushItem",title:r["Cmd.ApplyTo.Selected"],state:t.checkSelectionContext(s,{scenariosFilter:"selected"}).state,fonticon:{content:"wux-ui-3ds-select-on wux-ui-3ds"},action:"VCXApplyToSelectedCmd"}]}),l.push({type:"PushItem",title:"Add to Selection Set",state:s.ComponentsMap.GetComponentFromType("VCXSelectionSet_Spec").length>0?"enabled":"disabled",action:"VCXAddToSelectionSetCmd",fonticon:{content:"wux-ui-3ds-folder-add wux-ui-3ds"}}),l.push({type:"PushItem",title:"Delete",state:"enabled",action:"VCXDeleteDressupSelectionCmd",fonticon:{content:"wux-ui-3ds-trash wux-ui-3ds"}}),l.push({type:"PushItem",title:"Restore Default",state:"enabled",action:"VCXRestoreNeutralsCmd",fonticon:{content:"wux-ui-3ds-reset wux-ui-3ds"}}),e.Menu={type:"menu",name:"Dropdown_hide",cmdId:"VCXMenuCmd",content:l,index:100}}s.getManager("VCXContextManager").isSupported("VCXCustomStylesSupport")&&(e.VCXSaveStylesToDocument={type:"button",name:"VCXSaveStylesToDocument",cmdId:"VCXSaveStylesToDocumentCmd",index:15},e.VCXLoadStylesFromDocument={type:"button",name:"VCXLoadStylesFromDocument",cmdId:"VCXLoadStylesFromDocumentCmd",index:16})}}}})})),define("DS/VCXWebDressup/VCXACuttableObject",["UWA/Class","DS/Visualization/ThreeJS_DS"],(function(e,t){"use strict";return e.extend({init:function(){console.log("init is called",this)},isCut:function(e,t,i){return!!(i._plane&&i.sectionActive&&e.GetPropertyValue("Collab.Attach.3DAttach")&&e.GetPropertyGroupVisibility("Group.Attach"))&&this.isObjectIncludeInCut(e,t,i)},isObjectIncludeInCut:function(e,i,r){var a=!1,o=r;return e.processAnchorsIDs(((r,s)=>{a=!0;if(s){var n=e.GetAnchorWorldMatrix(r,i).clone();let p=o.QueryInterface("VCXIModifiable"),u=o._plane.clone();if(p&&p.GetPropertyValue("Section.SpaceBackAlpha")<p.GetPropertyValue("Section.SpaceFrontAlpha")&&u.negate(),u.distanceToPoint((new t.Vector3).getPositionFromMatrix(n))>0)return a=!1,false;var l=s.GetValueLink();if(l&&l.Value&&!o.isInCuttedObjectList(l.Value))return a=!1,false}})),a}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXVisibilityDressup",["require","exports","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebVisibility/VCXVisibility"],(function(e,t,i,r){"use strict";i=__importDefault(i),r=__importDefault(r);class a extends r.default{constructor(){super(),this._visible=i.default.EVisState.Hidden}SetVisibility(e){let t=e;if("boolean"==typeof e)console.warn("Method SetVisibility use only a number as unique parameter"),t=e?i.default.EVisState.Visible:i.default.EVisState.Hidden;else if("number"!=typeof e)return void console.warn("Method SetVisibility use only a number as unique parameter");super.SetVisibility(t),this.GetObject().setDirty(),this.GetObject()._experienceBase.getManager("VCXDressupManager").changeDressupVisibility()}}return a})),define("DS/VCXWebDressup/VCXCoveringMaterial/VCXCoveringMaterialSelectBehavior",["UWA/Class"],(function(e){"use strict";return e.extend({init:function(){},GetSelectMode:function(){return 0},GetListForSelection:function(){let e=this._object._experienceBase.getManager("VCXContextManager").isSupported("TweakingMaterial");return this._object._experienceBase.getManager("VCXContextManager").isSupported("VCXAssemblyTreeDebug")?[this._object]:e?[this._object.QueryInterface("CATI3DExperienceObject").GetValueByName("appearance")]:[]}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXCompass/VCXCompassDressup",["require","exports","DS/VCXWebDressup/VCXADressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{isSelectAllAffected(){return!1}anchors(){return{min:2,max:2}}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXPathLines/VCXPolylinePrepareRenderToTexture",["require","exports","DS/VCXWebDressup/VCXDressupPrepareRenderToTexture","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXColor"],(function(e,t,i,r,a){"use strict";r=__importDefault(r),a=__importDefault(a);return class extends i{getValueForMask(e,t){let i=super.getValueForMask(e,t);if("white"===t&&i instanceof r.default){let e=i.GetValue().GetThreeColor();i.SetValue((new a.default).FromRGBA(.5+e.r/2,.5+e.g/2,.5+e.b/2,1))}return i}GetType(){return"VCXPolylinePrepareRenderToTexture"}}})),define("DS/VCXWebDressup/VCXCuttableObjectArrowAndCircle",["DS/VCXWebDressup/VCXACuttableObject","DS/Visualization/ThreeJS_DS"],(function(e,t){"use strict";return e.extend({isCut:function(e,t,i){return!!(i._plane&&i.sectionActive&&(e._bIsArrow||e._bIsCircle||e._bIsHotspot))&&this.isObjectIncludeInCut(e,t,i)}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCX3DAligner/VCX3DAlignerDressup",["require","exports","DS/VCXWebDressup/VCXADressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{anchors(){return{min:1,max:1}}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXCompass/VCXCompass_Spec",["require","exports","DS/VCXWebDressup/VCXDressup_Spec"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{}return r.prototype.getDefaultName=function(){return"Compass"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXCompass_Spec"}}),r.prototype.dressupGroupName="Environment",r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXPathLines/VCXAssociativePathDressup",["require","exports","DS/VCXWebDressup/VCXADressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{anchors(){return{min:2,max:2}}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXRedLine/VCXRedLine_Spec",["require","exports","DS/VCXWebDressup/VCXDressup_Spec"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{constructor(){super()}}return r.prototype.getDefaultName=function(){return"Redline"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXRedLine_Spec"}}),r.prototype.dressupGroupName="Markups",r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXSection/VCXSectionDressup",["require","exports","DS/VCXWebDressup/VCXADressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{anchors(){return{min:1,max:1}}}return r})),define("DS/VCXWebDressup/VCXContextualContentMultiSelectionMesh",["DS/VCXWebDressup/VCXContextualContentOther","DS/VCXWebKernelCommands/VCXCmdApplyTo","i18n!DS/VCXWebKernel/assets/nls/VCXWebKernel"],(function(e,t,i){"use strict";return e.extend({init(e){this._experienceBase=e},appendContent:function(e,r,a){this._parent(e,r,a);const o=this._experienceBase;var s=[];s.push({type:"PushItem",title:"Apply To",fonticon:{content:"wux-ui-3ds-propagate wux-ui-3ds"},submenu:[{type:"PushItem",title:i["Cmd.ApplyTo.All"],state:t.checkSelectionContext(o,{scenariosFilter:"all"}).state,fonticon:{content:"wux-ui-3ds-select-all-checkboxes wux-ui-3ds"},action:"VCXApplyToAllCmd"},{type:"PushItem",title:i["Cmd.ApplyTo.Selected"],state:t.checkSelectionContext(o,{scenariosFilter:"selected"}).state,fonticon:{content:"wux-ui-3ds-select-on wux-ui-3ds"},action:"VCXApplyToSelectedCmd"}]}),e.Menu={type:"menu",name:"Dropdown_hide",cmdId:"VCXMenuCmd",content:s,index:100},r.forEach((t=>{var i=t.QueryInterface("VCXIContextualContent");i&&i.appendContent(e,r,a)}))}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXArrow/VCXCircularArrowDressup",["require","exports","DS/VCXWebDressup/VCXADressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{anchors(){return{min:1,max:1}}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXArrow/VCXLinearArrowDressup",["require","exports","DS/VCXWebDressup/VCXADressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{anchors(){return{min:2,max:2}}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXPartList/VCXPartList_Spec",["require","exports","DS/VCXWebDressup/VCXDressup_Spec"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{isDirty(){return!this._dirty&&this._experienceBase.getManager("VCXComponentPartListManager")?this._experienceBase.getManager("VCXComponentPartListManager").ListHasChanged:this._dirty}}return r.prototype.getDefaultName=function(){return"PartList"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXPartList_Spec"}}),r.prototype.dressupGroupName="PartList",r})),define("DS/VCXWebDressup/VCXContextualContentMultiSelectionHybrid",["DS/VCXWebDressup/VCXContextualContentOther","DS/VCXWebKernelCommands/VCXCmdApplyTo","i18n!DS/VCXWebKernel/assets/nls/VCXWebKernel"],(function(e,t,i){"use strict";return e.extend({init(e){this._experienceBase=e},appendContent:function(e,r,a){this._parent(e,r,a),e.HideSelection={type:"button",name:"HideSelection",cmdId:"VCXHideSelectionCmd",index:10};const o=this._experienceBase;var s=[];s.push({type:"PushItem",title:"Apply To",fonticon:{content:"wux-ui-3ds-propagate wux-ui-3ds"},submenu:[{type:"PushItem",title:i["Cmd.ApplyTo.All"],state:t.checkSelectionContext(o,{scenariosFilter:"all"}).state,fonticon:{content:"wux-ui-3ds-select-all-checkboxes wux-ui-3ds"},action:"VCXApplyToAllCmd"},{type:"PushItem",title:i["Cmd.ApplyTo.Selected"],state:t.checkSelectionContext(o,{scenariosFilter:"selected"}).state,fonticon:{content:"wux-ui-3ds-select-on wux-ui-3ds"},action:"VCXApplyToSelectedCmd"}]}),s.push({type:"PushItem",title:"Deselect only all markups",state:"enabled",action:"VCXDeselectMarkupsCmd",fonticon:{content:"wux-ui-3ds-select-off wux-ui-3ds"}}),s.push({type:"PushItem",title:"Deselect only parts",state:"enabled",action:"VCXDeselectPartsCmd",fonticon:{content:"wux-ui-3ds-select-off wux-ui-3ds"}}),s.push({type:"PushItem",title:"Add to Selection Set",state:this._experienceBase.ComponentsMap.GetComponentFromType("VCXSelectionSet_Spec").length>0?"enabled":"disabled",action:"VCXAddToSelectionSetCmd",fonticon:{content:"wux-ui-3ds-folder-add wux-ui-3ds"}}),e.Menu={type:"menu",name:"Dropdown_hide",cmdId:"VCXMenuCmd",content:s,index:100}}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXPathLines/VCXPolylineDressup",["require","exports","DS/VCXWebDressup/VCXADressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{anchors(){return{min:0,max:-1,canUserAdd:!0,canUserDelete:!0}}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXSection/VCXSection_Spec",["require","exports","DS/Visualization/ThreeJS_DS","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebProperties/VCXColor","DS/VCXWebDressup/VCXDressup_Spec","DS/VCXWebModifiables/VCXPropertiesObserver"],(function(e,t,i,r,a,o,s){"use strict";r=__importDefault(r),a=__importDefault(a),o=__importDefault(o),s=__importDefault(s);class n extends o.default{constructor(){super(),this.sectionActive=!1,this.recomputeSectionManager=null,this._keyValues={},this._plane=null,this._planeClipped=!1,this._cappingMaterial=null,this._previousSectionActive=!1,this.alpha=.15}isInCuttedObjectList(e){var t=!1,i=this.QueryInterface("VCXIModifiable"),r=i?.GetProperty("Actor.ListActors");if(r){var a=r.GetPropertyValue().GetValue();if(a&&a.length)for(var o=0;o<a.length;o++){t=!0;let i=this._experienceBase.ComponentsMap.GetComponentFromID(e);for(;i;){if(a[o].GetValue()===i.GetID())return!0;const e=i.QueryInterface("VCXIModelNavigable"),t=e&&e.getParent();i=t&&t.GetObject()}}}return!t}preRender(e){if(this._plane){var t=this.QueryInterface("VCXIModifiable"),r=this.QueryInterface("W3AISGNodeHolder");if(!r||!t)return;var a=r.getWorldMatrix(e.viewer);this._plane.set(new i.Vector3(0,0,1),0).applyMatrix4(a),t.GetPropertyValue("Section.AutoFlip")&&e.viewpoint.getSightDirection().dot(this._plane.normal)<0&&this._plane.negate()}super.preRender(e)}isActive(){var e=this.QueryInterface("VCXIVisibility");if(e&&e.GetVisibility()!==r.default.EVisState.Hidden){var t=this.QueryInterface("VCXIModifiable");if(t&&t.GetPropertyValue("Section.Enable")&&t.GetPropertyValue("Actor.Visibility.Opacity")>.5)return!0}return!1}update(e){if(this.recomputeSectionManager&&(this.recomputeSectionManager.update(),this.recomputeSectionManager.isDirty()&&this._experienceBase.getManager("VCXSectionManager")&&(this._experienceBase.getManager("VCXSectionManager").Dirty=!0)),this.sectionActive=this.isActive(),this._previousSectionActive!==this.sectionActive&&(this._previousSectionActive=this.sectionActive,this.sectionActive?this._experienceBase.getManager("VCXSectionManager").registerSection(this):this._experienceBase.getManager("VCXSectionManager").unregisterSection(this)),this._plane||(this._plane=new i.Plane(new i.Vector3(0,0,-1),0)),this.sectionActive&&(this.recomputeSectionManager||(this.recomputeSectionManager=new s.default,this.recomputeSectionManager.add(this,"Section.Enable"),this.recomputeSectionManager.add(this,"Section.SpaceBackAlpha"),this.recomputeSectionManager.add(this,"Section.Capping"),this.recomputeSectionManager.add(this,"Section.Capping.ActorColor")),!this._cappingMaterial)){let e=this.QueryInterface("VCXIModifiable");if(!e)return;this._experienceBase.getManager("VCXContextManager").getMainViewer().setClippingPlaneUpVector(this._plane,new i.Vector3(0,0,1));var t=Math.cos(e.GetPropertyValue("Section.Hatching.Angle")*Math.PI/180),r=Math.sin(e.GetPropertyValue("Section.Hatching.Angle")*Math.PI/180),o=e.GetColorPropertyValue("Section.Capping");this._cappingMaterial=new i.HatchingMeshMaterial({stripesDirection:new i.Vector2(t+r,r-t),spaceWidth:10,stripesWidth:1.5,spaceColor:o.GetThreeColor(),stripesColor:(new a.default).FromRGBA(1,0,0).GetThreeColor()})}super.update(e)}postUpdate(e){super.postUpdate(e),this.sectionActive&&this.recomputeSectionManager&&this.recomputeSectionManager.reset()}Dispose(){this._experienceBase.getManager("VCXSectionManager").unregisterSection(this)}}return n.prototype.getDefaultName=function(){return"Section"},Object.defineProperty(n.prototype,"componentType",{enumerable:!0,get:function(){return"VCXSection_Spec"}}),n.prototype.dressupGroupName="Sections",n}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXArrow/VCXCornerArrowDressup",["require","exports","DS/VCXWebDressup/VCXADressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{anchors(){return{min:1,max:1}}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXAmbience/VCXAmbienceDressup",["require","exports","DS/VCXWebDressup/VCXADressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{isSelectAllAffected(){return!1}anchors(){return{min:0,max:0}}}return r})),define("DS/VCXWebDressup/VCXContextualContentBackground",["DS/VCXWebDressup/VCXContextualContentOther"],(function(e){"use strict";return e.extend({init(e){this._experienceBase=e},appendContent:function(e,t,i){if(this._parent(e,t,i),t&&0===t.length){let t=[];if(this._experienceBase.getManager("VCXVisuManager").getNonVisibleSpaceState())t.push({type:"PushItem",title:"Show visible space",state:"enabled",action:"VCXShowVisibleSpaceCmd",fonticon:{content:"wux-ui-3ds-geometries-eye wux-ui-3ds"}});else{e.ShowAll={type:"button",name:"ShowAll",cmdId:"VCXShowAllCmd",index:10},e.InvertGeometryVisibility={type:"button",name:"InvertGeometryVisibility",cmdId:"VCXInvertVisibilityCmd",index:20},e.InsertProduct={type:"button",name:"InsertProduct",cmdId:"VCXInsertProductHackCmd",index:30},e.InsertAmbience={type:"button",name:"InsertAmbience",cmdId:"VCXInsertAmbienceCmd",index:40};let i=[{name:"VisuBottomViewCmd",icon:"I_VCX_BottomView",order:15,noPreview:!0},{name:"VisuLeftViewCmd",icon:"I_VCX_LeftView",order:16,noPreview:!0},{name:"VisuRightViewCmd",icon:"I_VCX_RightView",order:17,noPreview:!0},{name:"VisuFrontViewCmd",icon:"I_VCX_FrontView",order:18,noPreview:!0},{name:"VisuBackViewCmd",icon:"I_VCX_BackView",order:19,noPreview:!0},{name:"VisuTopViewCmd",icon:"I_VCX_TopView",order:20,noPreview:!0},{name:"VisuIsoViewCmd",icon:"I_VCX_IsoView",order:21,noPreview:!0}],a=this.createContentCommandsPanel(i,"Viewpoint","VCXWebAuthoringApp");e.ViewPoint={type:"panel",name:"ViewpointList",cmdId:"VCXViewpointPanelCmd",content:a,index:50},t.push({type:"PushItem",title:"Apply ambience to all scenes",state:"enabled",action:"VCXApplyToAmbienceCmd",fonticon:{content:"wux-ui-3ds-propagate wux-ui-3ds"}}),t.push({type:"PushItem",title:"Hide all markups",state:"enabled",action:"VCXHideDressupsCmd",fonticon:{content:"wux-ui-3ds-eye-off wux-ui-3ds"}}),t.push({type:"PushItem",title:"Show non-visible space",state:"enabled",action:"VCXShowNonVisibleSpaceCmd",fonticon:{content:"wux-ui-3ds-geometries-eye-off wux-ui-3ds"}}),t.push({type:"PushItem",title:"Reset all part position",state:"enabled",action:"VCXRestoreAllNeutralPositionCmd",fonticon:{content:"wux-ui-3ds-reset wux-ui-3ds"}});var r=this._experienceBase.getManager("VCXExperience");r&&r._componentsToCopy&&r._componentsToCopy.length>=0&&t.push({type:"PushItem",title:"Paste",state:"enabled",action:"VCXPasteCmd",fonticon:{content:"wux-ui-3ds-paste wux-ui-3ds"}})}e.Menu={type:"menu",name:"Dropdown_hide",cmdId:"VCXMenuCmd",content:t,index:100}}}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXCircle/VCXCirclePrepareRenderToTexture",["require","exports","DS/VCXWebDressup/VCXDressupPrepareRenderToTexture","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueEnum"],(function(e,t,i,r,a,o){"use strict";r=__importDefault(r),a=__importDefault(a),o=__importDefault(o);return class extends i{filterWhiteLayerProperty(e){return!!super.filterWhiteLayerProperty(e)||"Circle.Background.Type"===e.GetPropertyInfo().GetPropertyName()}getValueForMask(e,t){if("Collab.Background2.Color"===e){if("white"===t)return new r.default((new a.default).FromRGBA(0,0,0,1));if("visibletop"===t){let e=this.GetObject()?.QueryInterface("VCXIModifiable")?.GetProperty("Collab.Background.Color")?.GetPropertyValue()?.GetValue();if(e)return new r.default(e)}return null}return"Circle.Background.Type"===e?new o.default(3):super.getValueForMask(e,t)}GetType(){return"VCXCirclePrepareRenderToTexture"}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXMagnetLine/VCXVisibilityMagnetLine",["require","exports","DS/VCXWebDressup/VCXVisibilityDressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{SetVisibility(e){if(0===e){var t=this.QueryInterface("W3AISGNodeHolder");if(t){var i=t.getSGNode();i&&i.Modifiable.GetObject()?.cleanModifiableAttached()}}super.SetVisibility(e)}}return r})),define("DS/VCXWebDressup/VCXContextualContentMultiSelectionDressup",["DS/VCXWebDressup/VCXContextualContentOther","DS/VCXWebKernelCommands/VCXCmdApplyTo","i18n!DS/VCXWebKernel/assets/nls/VCXWebKernel"],(function(e,t,i){"use strict";return e.extend({init(e){this._experienceBase=e},appendContent:function(e,r,a){this._parent(e,r,a);const o=this._experienceBase,s=o.getManager("VCXDressupManager");let n=r.reduce(((e,t)=>!!s&&(e&&s.CheckDressupIsAlignable(t).isAlignableValue)),!0);if(e.HideSelection={type:"button",name:"HideSelection",cmdId:"VCXHideSelectionCmd",index:10},e.Duplicate={type:"button",name:"DuplicateSelection",cmdId:"VCXDuplicateCmd",index:20},n){let t=[{name:"VCXAlignLeftCmd",icon:"I_GphAlignLeft",order:0},{name:"VCXAlignMiddleCmd",icon:"I_GphAlignHorizontalCenter",order:5},{name:"VCXAlignRightCmd",icon:"I_GphAlignRight",order:3},{name:"VCXAlignTopCmd",icon:"I_GphAlignTop",order:4},{name:"VCXAlignCenterCmd",icon:"I_GphAlignVerticalCenter",order:1},{name:"VCXAlignBottomCmd",icon:"I_GphAlignBottom",order:6}];r.length>2&&(t.push({name:"VCXDistributeSpaceHorizontallyCmd",icon:"I_GphDistributeHorizontaly",order:7}),t.push({name:"VCXDistributeSpaceVerticallyCmd",icon:"I_GphDistributeVerticaly",order:8})),t.sort(((e,t)=>e.order-t.order));let i={},a=0;for(let e of t){let t={type:"button"};t.name="AlignObject0"+a,t.cmdId=e.name,t.iconFolder="VCXWebDressupCmd",t.icon="icons/32/"+e.icon+".png",i[t.name]=t,a++}e.AlignObject={type:"button",name:"AlignObject",cmdId:"VCXAlignObjectPanelCmd1",content:i,index:30}}var l=[];l.push({type:"PushItem",title:"Cut",state:"enabled",action:"VCXCutCmd",fonticon:{content:"wux-ui-3ds-cut wux-ui-3ds"}}),l.push({type:"PushItem",title:"Copy",state:"enabled",action:"VCXCopyCmd",fonticon:{content:"wux-ui-3ds-copy wux-ui-3ds"}}),l.push({type:"PushItem",title:"Paste",state:"enabled",action:"VCXPasteCmd",fonticon:{content:"wux-ui-3ds-paste wux-ui-3ds"}}),l.push({type:"PushItem",title:"Delete",state:"enabled",action:"VCXDeleteDressupSelectionCmd",fonticon:{content:"wux-ui-3ds-trash wux-ui-3ds"}}),l.push({type:"PushItem",title:i["Cmd.ApplyTo"],fonticon:{content:"wux-ui-3ds-propagate wux-ui-3ds"},submenu:[{type:"PushItem",title:i["Cmd.ApplyTo.All"],state:t.checkSelectionContext(o,{scenariosFilter:"all"}).state,fonticon:{content:"wux-ui-3ds-select-all-checkboxes wux-ui-3ds"},action:"VCXApplyToAllCmd"},{type:"PushItem",title:i["Cmd.ApplyTo.Selected"],state:t.checkSelectionContext(o,{scenariosFilter:"selected"}).state,fonticon:{content:"wux-ui-3ds-select-on wux-ui-3ds"},action:"VCXApplyToSelectedCmd"}]}),l.push({type:"PushItem",title:"Restore Default",state:"enabled",action:"VCXRestoreNeutralsCmd",fonticon:{content:"wux-ui-3ds-reset wux-ui-3ds"}}),e.Menu={type:"menu",name:"Dropdown_hide",cmdId:"VCXMenuCmd",content:l,index:100}}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCX3DGrid/VCX3DGrid_Spec",["require","exports","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXDressup_Spec"],(function(e,t,i,r){"use strict";r=__importDefault(r);class a extends r.default{constructor(){super(),this._plane=null,this._isPickerSensitive=!0,this.alpha=.15}preRender(e){if(this._plane){var t=this.QueryInterface("VCXIModifiable"),r=this.QueryInterface("W3AISGNodeHolder");if(!r||!t)return;var a=r.getWorldMatrix(e.viewer);this._plane.set(new i.Vector3(0,100,1),0).applyMatrix4(a)}super.preRender(e)}update(e){this._plane||(this._plane=new i.Plane(new i.Vector3(0,1,-1),0)),super.update(e)}postUpdate(e){super.postUpdate(e)}Dispose(){this._plane=null}}return a.prototype.getDefaultName=function(){return"3DGrid"},Object.defineProperty(a.prototype,"componentType",{enumerable:!0,get:function(){return"VCX3DGrid_Spec"}}),a.prototype.dressupGroupName="Grids",a}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXViewpoint/VCXViewportDressup",["require","exports","DS/VCXWebDressup/VCXADressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{isSelectAllAffected(){return!1}isViewPointDependent(){return!0}anchors(){return{ids:["1","2","10"],min:3,max:3}}}return r})),define("DS/VCXWebDressup/VCXContextualContentDressupCopyStyles",["DS/VCXWebDressup/VCXContextualContentDressup_Spec"],(function(e){"use strict";return e.extend({appendContent:function(e,t,i){this._parent(e,t,i),t&&1===t.length&&(e.CopyStyle={type:"button",name:"CopyStyle",cmdId:"VCXFormatPainterCmd",index:30})}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXMagnetLine/VCXMagnetLineDressup",["require","exports","DS/VCXWebDressup/VCXADressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{anchors(){return{min:0,max:0}}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXViewpoint/VCXViewpoint_Spec",["require","exports","DS/VCXWebDressup/VCXDressup_Spec","DS/CoreEvents/Events"],(function(e,t,i,r){"use strict";i=__importDefault(i),r=__importDefault(r);class a extends i.default{constructor(){super(),this._events={},this.panelVisible=!1,this._events.VCXPANEL_VISIBILITY_CHANGED=r.default.subscribe({event:"VCXPANEL_VISIBILITY_CHANGED"},(e=>{"Camera"===e.panelName&&this.panelVisible!==e.visible&&(this.panelVisible=e.visible,this.setDirty(!0))}))}CallDispose(){super.CallDispose();for(let e in this._events)r.default.unsubscribe(this._events[e]),delete this._events[e]}}return a.prototype.getDefaultName=function(){return"ViewpointCamera"},Object.defineProperty(a.prototype,"componentType",{enumerable:!0,get:function(){return"VCXViewpoint_Spec"}}),a.prototype.dressupGroupName="ViewpointCamera",a}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXCircle/VCXCircleDressup",["require","exports","DS/VCXWebDressup/VCXADressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{anchors(){return{min:1,max:1}}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXRedLine/VCXRedLineDressup",["require","exports","DS/VCXWebDressup/VCXADressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{isSelectAllAffected(){return!1}anchors(){return{min:1,max:1}}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXPartList/VCXPartListDressup",["require","exports","DS/VCXWebDressup/VCXADressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{anchors(){return{min:0,max:0}}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCX3DGrid/VCX3DGridDressup",["require","exports","DS/VCXWebDressup/VCXADressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{anchors(){return{min:1,max:1}}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXHotspot/VCXHotspotDressup",["require","exports","DS/VCXWebDressup/VCXADressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{anchors(){return{min:1,max:1}}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXViewpoint/VCXCameraDressup",["require","exports","DS/VCXWebDressup/VCXADressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{isSelectAllAffected(){return!1}anchors(){return{ids:["1","2","10"],min:3,max:3}}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXCamera/CXPCameraActor_Spec",["require","exports","DS/VCXWebDressup/VCXDressup_Spec"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{constructor(){super(),this._tooltip=""}updatePosition(){var e=this.GetObject()._experienceBase.getManager("VCXVisuManager");let t=this.QueryInterface("VCXIViewpointController");t&&(t.resetMatrixAndDOI(),e.CameraControlsViewpoint&&this.QueryInterface("VCXIModifiable")?.GetProperty("Actor.IsActive").GetPropertyValue().Value&&t.toViewpoint());var i=this.GetObject()._experienceBase.getManager("VCXContextManager").getActiveViewport();i&&(t=i.QueryInterface("VCXIViewpointController"),t&&t.fromViewpoint())}}return r.prototype.getDefaultName=function(){return"Camera"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"CXPCameraActor_Spec"}}),r.prototype.dressupGroupName="Cameras",r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXViewpoint/VCXViewpointDressup",["require","exports","DS/VCXWebDressup/VCXADressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{isSelectAllAffected(){return!1}isViewPointDependent(){return!0}anchors(){return{ids:["1","2","10"],min:3,max:3}}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXMagnetLine/VCXMagnetLineOrientation_Spec",["require","exports","DS/VCXWebExperienceBase/VCXSceneGraphOverridesServices","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXDressup_Spec","DS/CoreEvents/Events","DS/VCXWebProperties/VCXPropertyValueFrame"],(function(e,t,i,r,a,o,s){"use strict";a=__importDefault(a);class n extends a.default{constructor(){super(...arguments),this.objectsToMove={}}lock(){this.objectsToMove={};const e=this.QueryInterface("VCXIModifiable");if(!e)return!1;let t=0;const a=e.GetProperty("Actor.ListActors");if(a){const e=a.GetPropertyValue().GetValue();if(e&&e.length)for(var o=0;o<e.length;o++){const i=this._experienceBase.ComponentsMap.GetComponentFromID(e[o].GetValue());i&&(this.objectsToMove[i.GetID()]={object:i},t++)}}if(!t){const i=e.GetAttachedOccurence(0);this.objectsToMove[i.GetID()]={object:i},t++}if(!t)return!1;this._SceneGraphOverrideSet||(this._SceneGraphOverrideSet=i.createAndPushSceneGraphOverrideSet(this._experienceBase));const s=this._experienceBase.getManager("VCXContextManager").getMainViewer();this._experienceBase.getManager("VCXSelectionManager").setOverrideStyle(s,!1,{visibleAlpha:.01});for(let t in this.objectsToMove){const a=this.objectsToMove[t];let o=a.object.QueryInterface("VCXIModelNavigable");o=o&&o.getParent();let n=!1;for(;o&&!n;){const e=o?.GetObject()?.GetID();e&&this.objectsToMove[e]&&(n=!0),o=o.getParent()}if(!n){const t=(new r.Matrix4).getInverse(e.GetAnchorWorldMatrix(0,s)),o=a.object.QueryInterface("W3AISGNodeHolder"),n=a.object?.getParentWorldPosition(),l=a.object.QueryInterface("VCXIModifiable"),p=l&&l.GetProperty("Actor.Position").GetPropertyValue();if(p){a.initialWFrameInRM=(new r.Matrix4).multiplyMatrices(t,(new r.Matrix4).multiplyMatrices(p.GetFrame().GetValue(),n)),a.initialWPivotInRM=(new r.Matrix4).multiplyMatrices(t,(new r.Matrix4).multiplyMatrices(p.GetPivot().GetValue(),n));const e=i.getSceneGraphOverride(this._SceneGraphOverrideSet,null,o.getPathElement());e.setOpacity(.5,!0),e.setPickability("IGNORED",!0)}}}const n=this.QueryInterface("W3AISGNodeHolder");if(n){n.getSGNode().switchOff2On()}return!0}move(e,t){for(let i in this.objectsToMove){const a=this.objectsToMove[i];if(a.initialWFrameInRM&&a.initialWPivotInRM){const i=a.object.QueryInterface("VCXIModifiable"),o=(new r.Matrix4).multiplyMatrices(e,a.initialWFrameInRM),n=(new r.Matrix4).multiplyMatrices(e,a.initialWPivotInRM),l=a.object.getParentWorldPosition(),p=(new r.Matrix4).getInverse(l),u=(new r.Matrix4).multiplyMatrices(p,o),h=(new r.Matrix4).multiplyMatrices(p,n),d=i.GetProperty("Actor.Position").Clone(),c=d.GetPropertyValue();c.SetFrame(new s(u)),c.SetPivot(new s(h)),d.SetPropertyValue(c),t.AddOrModifyProperty(i.GetHashing(),d)}}this._setRobot(e)}unlock(){i.removeSceneGraphOverrideSet(this._experienceBase,this._SceneGraphOverrideSet),this._SceneGraphOverrideSet=null;const e=this._experienceBase.getManager("VCXContextManager").getMainViewer();this._experienceBase.getManager("VCXSelectionManager").resetOverrideStyle(e,!1);const t=this.QueryInterface("W3AISGNodeHolder");if(t){t.getSGNode().switchOn2Off()}}_setRobot(e){if(this.objectsToMove){const t=[];for(let e in this.objectsToMove){const i=this.objectsToMove[e];t.push(i.object)}o.publish({event:"VCX_DONT_CHNG_ROBOT_POS_AT_TRANSFORM_BEGIN",data:{targets:t,matrix:e}})}}}return n.prototype.getDefaultName=function(){return"MagnetLineOrientation"},Object.defineProperty(n.prototype,"componentType",{enumerable:!0,get:function(){return"VCXMagnetLineOrientation_Spec"}}),n.prototype.dressupGroupName="MagnetLineOrientation",n}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXPathLines/VCXPolyline_Spec",["require","exports","DS/VCXWebDressup/VCXDressup_Spec"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{}return r.prototype.getDefaultName=function(){return"Polyline"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXPolyline_Spec"}}),r.prototype.dressupGroupName="Markups",r})),define("DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec",["require","exports","DS/VCXWebDressup/VCXPropertyValueUnitFormater","DS/VCXWebDressup/VCXDressup_Spec","DS/VCXWebVisualization/VCXImageManager"],(function(e,t,i,r,a){"use strict";class o extends r{constructor(){super(...arguments),this.fontHeight=12,this._imageType=a.Effect.None}isDirty(){var e=this.QueryInterface("VCXIModifiable");if(e?.GetPropertyGroupVisibility("Group.Text")){var t=e.GetComputedStringProperty("Collab.Text",i.format);if(t||(t=""),this._currentText!==t)return this._currentText=t,!0}return super.isDirty()}clearImage(){delete this.backgroundImage,delete this.imagePromise,this._imageType=a.Effect.None,this._docID=-10}getSourceName(){let e="";var t=this.QueryInterface("VCXIModifiable");if(t){const r=t.GetPropertyValue("Collab.PIP.Scenario.ID");if(r){const t=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[r];t&&(e=t.GetName())}else{let r=t.GetPropertyValue("Collab.Image.Doc.ID");var i=this._experienceBase.getManager("VCXDocManager").GetPropPath(r);e=i&&i.GetFileName().GetValue()}}return e}getImage(e){this._imageType=e;var t=this,i=this.QueryInterface("VCXIModifiable");if(i){let r;const a=i.GetPropertyValue("Collab.PIP.Scenario.ID");if(a){const e=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[a];if(e){const t=e.GetPIPDocId&&e.GetPIPDocId();this._imageTS!==t.timeStamp&&(this.clearImage(),this._imageTS=t.timeStamp),r=t.docID}}if(r=r||i.GetPropertyValue("Collab.Image.Doc.ID"),null!=r&&i.GetPropertyGroupVisibility("Group.Image")||(r=-1),this._imageType===e&&this._docID===r){if(this.imagePromise)return this.imagePromise}else this.clearImage();return this._imageType,this._docID,r>=0?this.imagePromise=this._experienceBase.getManager("VCXImageManager").GetImageFromDocID(r,e).then((e=>{var i=this.QueryInterface("VCXIModifiable");if(i&&i.GetPropertyValue("Collab.Image.Doc.PrepareRender")){var r=document.createElement("canvas"),a=r.getContext("2d");r.width=e.width,r.height=e.height;for(var o=e.getContext("2d").getImageData(0,0,e.width,e.height),s=o.data,n=0;n<s.length;n+=4)s[n]=255,s[n+1]=255,s[n+2]=255;a.putImageData(o,0,0),r._IsReadyToUse=!0,e=r}return t.backgroundImage=e,e})):(this.backgroundImage=null,this.imagePromise=Promise.resolve(null)),this.imagePromise}console.warn(new Error("Component does not implement modifiable"))}get componentType(){return"VCXMarkup_Spec"}}return function(e){let t,i,r,a,o,s,n,l,p,u,h,d,c;!function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"}(t=e.EHAlignment||(e.EHAlignment={})),function(e){e[e.Top=0]="Top",e[e.Middle=1]="Middle",e[e.Bottom=2]="Bottom"}(i=e.EVAlignment||(e.EVAlignment={})),function(e){e[e.Left=0]="Left",e[e.Centered=1]="Centered",e[e.Justified=3]="Justified",e[e.Right=2]="Right"}(r=e.EHTextAlignment||(e.EHTextAlignment={})),function(e){e[e.Top=0]="Top",e[e.Middle=1]="Middle",e[e.Bottom=2]="Bottom"}(a=e.EVTextAlignment||(e.EVTextAlignment={})),function(e){e[e.None=0]="None",e[e.Rectangle=10]="Rectangle",e[e.RoundedRectangle=1]="RoundedRectangle",e[e.Square=20]="Square",e[e.RoundedSquare=2]="RoundedSquare",e[e.Ellipse=4]="Ellipse",e[e.Circle=3]="Circle",e[e.Rhombus=5]="Rhombus",e[e.RemoveBorder=6]="RemoveBorder",e[e.User=7]="User",e[e.CircumscribedCircle=8]="CircumscribedCircle"}(o=e.EBodyShape||(e.EBodyShape={})),function(e){e[e.None=0]="None",e[e.Paper=1]="Paper"}(s=e.ESizeControlType||(e.ESizeControlType={})),function(e){e[e.None=0]="None",e[e.Spherical=2]="Spherical",e[e.AlongX_yInCamUp=4]="AlongX_yInCamUp"}(n=e.EBillboardType||(e.EBillboardType={})),function(e){e[e.Perimetric=0]="Perimetric",e[e.Circle=1]="Circle",e[e.Rectangle=2]="Rectangle",e[e.Bottom=3]="Bottom",e[e.BottomAndLeft=4]="BottomAndLeft",e[e.BottomAndRight=5]="BottomAndRight",e[e.BottomAndTop=6]="BottomAndTop",e[e.Top=7]="Top",e[e.TopAndLeft=8]="TopAndLeft",e[e.TopAndRight=9]="TopAndRight",e[e.Left=10]="Left",e[e.LeftAndRight=11]="LeftAndRight",e[e.Right=12]="Right",e[e.EndOfAutomaticPositionning=13]="EndOfAutomaticPositionning",e[e.RelativeToReferential=101]="RelativeToReferential",e[e.Free2D=1e3]="Free2D",e[e.Free3D=1001]="Free3D"}(l=e.EPositionType||(e.EPositionType={})),function(e){e[e.Front=0]="Front",e[e.Back=1]="Back",e[e.Left=2]="Left",e[e.Right=3]="Right",e[e.Top=4]="Top",e[e.Bottom=5]="Bottom",e[e.Isometric=6]="Isometric"}(p=e.EViewPosition||(e.EViewPosition={})),function(e){e[e.None=0]="None",e[e.Model=1]="Model",e[e.Vertex=2]="Vertex",e[e.GradientTooltip=3]="GradientTooltip",e[e.TooltipStyle=4]="TooltipStyle",e[e.Line=5]="Line",e[e.User=6]="User",e[e.Simple=7]="Simple",e[e.ArcTooltip=8]="ArcTooltip",e[e.Arrow=9]="Arrow",e[e.Basic=30]="Basic",e[e.Modern=100]="Modern",e[e.Custom=101]="Custom"}(u=e.EAttachType||(e.EAttachType={})),function(e){e[e.None=0]="None",e[e.Sphere=1]="Sphere",e[e.FullArrow_1=2]="FullArrow_1",e[e.FullArrow_2=3]="FullArrow_2",e[e.HalfArrow_B1=4]="HalfArrow_B1",e[e.HalfArrow_T1=5]="HalfArrow_T1",e[e.HalfArrow_T2=6]="HalfArrow_T2",e[e.HalfArrow_B2=7]="HalfArrow_B2",e[e.Dot=20]="Dot",e[e.Yellow=10]="Yellow",e[e.White=30]="White",e[e.Red=40]="Red",e[e.Line=45]="Line",e[e.SmallRed=50]="SmallRed"}(h=e.EExtremityType||(e.EExtremityType={})),function(e){e[e.None=0]="None",e[e.Middle=10]="Middle",e[e.Bent=20]="Bent",e[e.Line=30]="Line",e[e.Mustache=40]="Mustache"}(d=e.ELeadType||(e.ELeadType={})),function(e){e[e.Uniform=0]="Uniform",e[e.Custom=1]="Custom"}(c=e.EMLSpacing||(e.EMLSpacing={}))}(o||(o={})),o}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXMarkup/VCXCallout_Spec",["require","exports","DS/VCXWebModifiables/VCXModelChangeListener","DS/VCXWebVisu/VCXModifiablesAccess","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","DS/VCXWebSystem/VCXTextTools"],(function(e,t,i,r,a,o,s,n){"use strict";a=__importDefault(a),o=__importDefault(o),s=__importDefault(s),n=__importDefault(n);class l extends s.default{constructor(){super(),this._DelegatePropChangeForHTMLEditor=!0}async DelegatePropChangeForHTMLEditor(e,t){let s=!1;if(e&&t&&"Collab.Text.html"===t.GetPropertyInfo().GetPropertyName()){let l=this.QueryInterface("VCXIModifiable");if(l){let p=l.GetProperty("Collab.Text").GetPropertyValue().ToString();if(p.includes("#Actor.PartList.ID")){let u=l.GetAttachedOccurences();for(let l=0;l<u.length;l++){let h=u[l];if(!h)continue;let d=r.GetLinkedParentLevelFromPropertyValue(p,h._ID,this._experienceBase);if(d){let r=d.QueryInterface("VCXIModifiable");if(r){if(d.PartListEnabled){let i=n.default.htmlDecode(t.GetPropertyValue().Value),a=new o.default(i);await e.RequestModification([r],"Actor.PartList.ID",a)}else{let t=new a.default(!0);await e.RequestModification([r],"Actor.PartList.Enabled",t)}let l=this._experienceBase.getManager("VCXModelChangeListener");l&&(l.hasChanged(i.FChangeFlag.PartListEnabled,!0),s=!0)}}}}}}return s}isDirty(){return!(!this.QueryInterface("VCXIVisibility")?.GetVisibility()||!this.QueryInterface("VCXIModifiable")?.GetPropertyValue("Collab.Body.ContributeToEqualSize"))||this._dirty}}return l.prototype.getDefaultName=function(){return"Callout"},Object.defineProperty(l.prototype,"componentType",{enumerable:!0,get:function(){return"VCXCallout_Spec"}}),l.prototype.dressupGroupName="Callouts",l}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXMagnetLine/VCXMagnetLine_Spec",["require","exports","DS/VCXWebDressup/VCXDressup_Spec","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","DS/VCXWebProperties/VCXPropertySet","DS/Visualization/ThreeJS_DS"],(function(e,t,i,r,a,o){"use strict";i=__importDefault(i),r=__importDefault(r);class s extends i.default{constructor(){super(),this._curvature=0,this.arrayModifiableAttached=[],this.arrayModifiableAttachedIdPos=[],this.arrayModifiableRatioPos=[]}SetCurvature(e){this._curvature=e}GetCurvature(){return this._curvature}GetPropertyValue(e){let t=this.QueryInterface("VCXIModifiable");if(t){return t.GetProperty(e).GetPropertyValue().GetValue()}return null}isOnMagnetLine(e){if(0===this._curvature)return this._isPointOnSegment(e);{const t=this.GetPropertyValue("Collab.MagnetLine.Position.A.X"),i=this.GetPropertyValue("Collab.MagnetLine.Position.A.Y"),r=this.GetPropertyValue("Collab.MagnetLine.Position.B.X"),a=this.GetPropertyValue("Collab.MagnetLine.Position.B.Y"),s=new o.Vector3(t,i,0),n=new o.Vector3(r,a,0),l=new o.Vector3((n.x-s.x)/2+s.x,(n.y-s.y)/2+s.y,(n.z-s.z)/2+s.z),p=new o.Vector3(n.x-s.x,n.y-s.y,n.z-s.z),u=new o.Vector3(0,0,1);let h=(new o.Vector3).crossVectors(p,u);h.normalize();const d=this._computeCurvatureValue(this._getCurvaturePropVal()),c=(new o.Vector3).addVectors(l,h.clone().multiplyScalar(d)),C=new o.Vector2(c.x,c.y),y=c.distanceTo(s),m=C.distanceTo(e);if(Math.abs(m-y)<=4){const t=new o.Vector2(l.x,l.y),i=Math.abs(t.distanceTo(e));if(Math.abs(l.distanceTo(s))>i)return!0}return!1}}_isPointOnSegment(e){const t=this.GetPropertyValue("Collab.MagnetLine.Position.A.X"),i=this.GetPropertyValue("Collab.MagnetLine.Position.A.Y"),r=this.GetPropertyValue("Collab.MagnetLine.Position.B.X"),a=this.GetPropertyValue("Collab.MagnetLine.Position.B.Y"),s=new o.Vector2(t,i),n=new o.Vector2(r,a),l=(new o.Vector2).copy(n).sub(s),p=(new o.Vector2).copy(e).sub(s),u=l.dot(p),h=l.length(),d=p.length(),c=u/h;return c>=-1&&c<=h+1&&Math.abs(d-c)<=1}_computeCurvatureValue(e,t=1e3,i=10){if(e<-1||e>1)throw new Error("Should be in [-1;1]");let r=!1;e<0&&(r=!0,e*=-1);let a=t-t*Math.pow(e,1/i);return r&&(a*=-1),a}_getCurvaturePropVal(){return this.GetPropertyValue("MagnetLine.Curvature")}computeArcCenter(){const e=this.GetPropertyValue("Collab.MagnetLine.Position.A.X"),t=this.GetPropertyValue("Collab.MagnetLine.Position.A.Y"),i=this.GetPropertyValue("Collab.MagnetLine.Position.B.X"),r=this.GetPropertyValue("Collab.MagnetLine.Position.B.Y"),a=new o.Vector3(e,t,0),s=new o.Vector3(i,r,0),n=new o.Vector3((s.x-a.x)/2+a.x,(s.y-a.y)/2+a.y,(s.z-a.z)/2+a.z),l=new o.Vector3(s.x-a.x,s.y-a.y,s.z-a.z),p=new o.Vector3(0,0,1),u=(new o.Vector3).crossVectors(l,p);u.normalize();const h=this._computeCurvatureValue(this._getCurvaturePropVal());return(new o.Vector3).addVectors(n,u.clone().multiplyScalar(h))}computeAngleRad(e,t,i){const r=(new o.Vector3).subVectors(e,i),a=(new o.Vector3).subVectors(t,i),s=r.dot(a)/(r.length()*a.length());return Math.acos(s)}isCustomAlignment(){return this.GetPropertyValue("MagnetLine.Spacing")===r.default.EMLSpacing.Custom}AlignWith(e,t,i,r){const a=i.distanceTo(r),s=e.clone().normalize();s.multiplyScalar(a/2);const n=(new o.Vector3).addVectors(t,s);s.multiplyScalar(-1);return{extremityA:n,extremityB:(new o.Vector3).addVectors(t,s)}}GetNewExtremityAlignWith(e,t){return this.AlignWith(e,t,new o.Vector3(this.GetPropertyValue("Collab.MagnetLine.Position.A.X"),this.GetPropertyValue("Collab.MagnetLine.Position.A.Y"),0),new o.Vector3(this.GetPropertyValue("Collab.MagnetLine.Position.B.X"),this.GetPropertyValue("Collab.MagnetLine.Position.B.Y"),0))}updateAttachedPosition(){if(this.isCustomAlignment()){const e=this.GetPropertyValue("Collab.MagnetLine.Position.A.X"),t=this.GetPropertyValue("Collab.MagnetLine.Position.A.Y"),i=this.GetPropertyValue("Collab.MagnetLine.Position.B.X"),r=this.GetPropertyValue("Collab.MagnetLine.Position.B.Y"),a=new o.Vector2(e,t),s=new o.Vector2(i,r),n=(new o.Vector2).subVectors(s,a);if(0===this._curvature)for(let i=0;i<this.arrayModifiableAttached.length;i++){const r=this.arrayModifiableAttached[i],a=this.arrayModifiableRatioPos[i],s=r.QueryInterface("VCXIMagnetLine");if(s){const i=n.clone();i.multiplyScalar(a);const r=new o.Vector2(e+i.x,t+i.y);s.do2DPosition(r)}}else{const s=this.computeArcCenter(),n=new o.Vector2(s.x,s.y),l=this.computeAngleRad(new o.Vector3(e,t,0),new o.Vector3(i,r,0),s);for(let e=0;e<this.arrayModifiableAttached.length;e++){let t=l*this.arrayModifiableRatioPos[e];this._curvature>0&&(t*=-1);const i=a.clone().sub(n),r=new o.Vector2(i.x*Math.cos(t)-i.y*Math.sin(t),i.x*Math.sin(t)+i.y*Math.cos(t));r.add(n);const s=this.arrayModifiableAttached[e].QueryInterface("VCXIMagnetLine");s&&s.do2DPosition(r)}}}else for(let e=0;e<this.arrayModifiableAttached.length;e++){const t=this.arrayModifiableAttached[e].QueryInterface("VCXIMagnetLine");if(t){const i=this.getPositionIn2D(e,this.arrayModifiableAttached.length);t.do2DPosition(i)}}}updatePropMapOfAttachedMagnet(e,t,i,r,s){if(this.isCustomAlignment()){const n=(t=null===t?this.GetPropertyValue("Collab.MagnetLine.Position.A.X"):t)??0,l=(i=null===i?this.GetPropertyValue("Collab.MagnetLine.Position.A.Y"):i)??0,p=(r=null===r?this.GetPropertyValue("Collab.MagnetLine.Position.B.X"):r)??0,u=(s=null===s?this.GetPropertyValue("Collab.MagnetLine.Position.B.Y"):s)??0,h=new o.Vector2(n,l),d=new o.Vector2(p,u),c=(new o.Vector2).subVectors(d,h);for(let t=0;t<this.arrayModifiableAttached.length;t++){const i=this.arrayModifiableAttached[t],r=this.arrayModifiableRatioPos[t],s=i.QueryInterface("VCXIMagnetLine");if(s){let t=c.clone();t.multiplyScalar(r);let i=new o.Vector2(n+t.x,l+t.y);if(0!==this._curvature){const e=this.computeArcCenter(),t=new o.Vector2(e.x,e.y),r=t.distanceTo(h);let a=i.clone().sub(t);a.normalize(),a.multiplyScalar(r),i=t.clone().add(a)}const p=new a;s.set2DPosition(i,p,0);const u=s.QueryInterface("VCXIModifiable");u&&e.AddOrModifyPropertySet(u.GetHashing(),p)}}}else for(let o=0;o<this.arrayModifiableAttached.length;o++){const n=this.arrayModifiableAttached[o].QueryInterface("VCXIMagnetLine");if(n){const l=this.getPositionIn2D(o,this.arrayModifiableAttached.length,t,i,r,s),p=new a;n.set2DPosition(l,p,this.arrayModifiableAttachedIdPos[o]);const u=n.QueryInterface("VCXIModifiable");u&&e.AddOrModifyPropertySet(u.GetHashing(),p)}}}updatePropMapWithNewPosition(e,t,i){const r=new a,o=t.QueryInterface("VCXIMagnetLine");o&&(o.set2DPosition(i,r,0),e.AddOrModifyPropertySet(t.GetHashing(),r))}checkPropMap(e){var t=new Array;e&&e.GetListModifiables(t),e.Check()||console.error("Error"),console.log(" ---===== Check PropMap Begin ====-----"),t.forEach((t=>{console.log(t),console.log(e.map[t])})),console.log(" ---===== Check PropMap End ====-----")}getProportionalPosition(e){const t=this.GetPropertyValue("Collab.MagnetLine.Position.A.X"),i=this.GetPropertyValue("Collab.MagnetLine.Position.A.Y"),r=this.GetPropertyValue("Collab.MagnetLine.Position.B.X"),a=this.GetPropertyValue("Collab.MagnetLine.Position.B.Y"),s=new o.Vector2(t,i),n=new o.Vector2(r,a),l=(new o.Vector2).subVectors(n,s),p=e.QueryInterface("VCXIMagnetLine").get2DPosition()[0],u=(new o.Vector2).subVectors(p,s);if(0===this._curvature)return Math.abs(l.x)>Number.EPSILON?u.x/l.x:Math.abs(l.y)>Number.EPSILON?u.y/l.y:0;{const e=this.computeArcCenter(),t=new o.Vector2(e.x,e.y),i=(new o.Vector2).subVectors(p,t),r=l.x*i.y-l.y*i.x;if(0===r)return 0;const a=(new o.Vector2).subVectors(t,s),n=(a.x*i.y-a.y*i.x)/r,u=new o.Vector2(s.x+n*l.x,s.y+n*l.y),h=(new o.Vector2).subVectors(u,s);return Math.abs(l.x)>Number.EPSILON?h.x/l.x:Math.abs(l.y)>Number.EPSILON?h.y/l.y:0}}cleanModifiableAttached(){this.arrayModifiableAttached.splice(0,this.arrayModifiableAttached.length),this.arrayModifiableAttached=[],this.arrayModifiableAttachedIdPos.splice(0,this.arrayModifiableAttachedIdPos.length),this.arrayModifiableAttachedIdPos=[],this.arrayModifiableRatioPos.splice(0,this.arrayModifiableRatioPos.length),this.arrayModifiableRatioPos=[]}removeModifiableAttached(e){const t=this.arrayModifiableAttached.indexOf(e);-1!==t&&(this.arrayModifiableAttached.splice(t,1),this.arrayModifiableAttachedIdPos.splice(t,1),this.updateAttachedPosition());const i=this.arrayModifiableRatioPos.indexOf(e);-1!==i&&this.arrayModifiableRatioPos.splice(i,1)}getHashing(){let e="",t=this.QueryInterface("VCXIModifiable");return t&&(e=t.GetHashing()),e}addModifiableAttached(e,t=-1){if(t<0&&(t=this.arrayModifiableAttachedIdPos.length),this.arrayModifiableAttached.includes(e)){if(this.isCustomAlignment()){const t=this.getProportionalPosition(e);this.arrayModifiableRatioPos[this.arrayModifiableAttached.indexOf(e)]=t}return}if(this._experienceBase.ComponentsMap.GetComponentFromType("VCXMagnetLine_Spec").some((t=>{if(!t)return!1;const i=t.QueryInterface("VCXIVisibility");if(!i||!i.GetVisibility())return!1;const r=t.QueryInterface("VCXIModifiable");return r._hashing!==this.getHashing()&&r.GetObject().arrayModifiableAttached.includes(e)})))return;this.arrayModifiableAttached.push(e),this.arrayModifiableAttachedIdPos.push(t);const i=this.getProportionalPosition(e);this.arrayModifiableRatioPos.push(i)}getPositionIn2D(e,t,i=null,r=null,a=null,s=null){let n=null===i?this.GetPropertyValue("Collab.MagnetLine.Position.A.X"):i,l=null===r?this.GetPropertyValue("Collab.MagnetLine.Position.A.Y"):r;const p=n??0,u=l??0,h=(a=null===a?this.GetPropertyValue("Collab.MagnetLine.Position.B.X"):a)??0,d=(s=null===s?this.GetPropertyValue("Collab.MagnetLine.Position.B.Y"):s)??0,c=new o.Vector2(p,u),C=new o.Vector3(p,u,0),y=new o.Vector2(h,d),m=new o.Vector3(h,d,0),V=(new o.Vector2).subVectors(y,c),f=1/(t+1);if(0===this._curvature){const t=V.clone().multiplyScalar(f),i=n+t.x*(e+1),r=l+t.y*(e+1);return new o.Vector2(i,r)}{const t=this._curvature<0,i=this.computeArcCenter(),r=new o.Vector2(i.x,i.y),a=this.computeAngleRad(C,m,i);let s=-1*a*f*(e+1);t&&(s=a*f*(e+1));const n=(new o.Vector2).subVectors(c,r),l=Math.cos(s),p=Math.sin(s),u=new o.Vector2(n.x*l-n.y*p,n.x*p+n.y*l);return(new o.Vector2).addVectors(u,r)}}updateModifiableIndex(e,t){if(t<0||t>this.arrayModifiableAttached.length)return!1;const i=this.arrayModifiableAttached.indexOf(e);return-1!==i&&(this.arrayModifiableAttached.splice(i,1),this.arrayModifiableAttached.splice(t,0,e),this.arrayModifiableAttachedIdPos.splice(i,1),this.arrayModifiableAttachedIdPos.splice(t,0,e),!0)}getNewProposalMagnetPositionIn2D(e,t){if(0===this._curvature){if(this.isCustomAlignment())return this.getProposalPositionProjectedOnMagnetLine(t);{const i=this.arrayModifiableAttached.length;if(-1===this.arrayModifiableAttached.indexOf(e))return this.getPositionIn2D(i,i+1);{const i=this.getProposalPositionIndexOnMagnetLine(t);return this.updateModifiableIndex(e,i.index),this.updateAttachedPosition(),i.proposalPoint}}}return this.getProposalPositionOnArcMagnetLine(e,t)}getProposalPositionOnArcMagnetLine(e,t){if(this.isCustomAlignment()){const e=this.computeArcCenter(),i=new o.Vector2(e.x,e.y),r=this.GetPropertyValue("Collab.MagnetLine.Position.A.X"),a=this.GetPropertyValue("Collab.MagnetLine.Position.A.Y"),s=new o.Vector2(r,a),n=i.distanceTo(s),l=t.clone().sub(i);l.normalize(),l.multiplyScalar(n);return i.clone().add(l)}{const i=this.arrayModifiableAttached.length;if(-1===this.arrayModifiableAttached.indexOf(e))return this.getPositionIn2D(i,i+1);{const i=this.getProposalPositionIndexOnMagnetLine(t);return this.updateModifiableIndex(e,i.index),this.updateAttachedPosition(),i.proposalPoint}}}getProposalPositionProjectedOnMagnetLine(e){const t=this.GetPropertyValue("Collab.MagnetLine.Position.A.X"),i=this.GetPropertyValue("Collab.MagnetLine.Position.A.Y"),r=this.GetPropertyValue("Collab.MagnetLine.Position.B.X"),a=this.GetPropertyValue("Collab.MagnetLine.Position.B.Y"),s=new o.Vector2(t,i),n=new o.Vector2(r,a).clone().sub(s).normalize(),l=e.clone().sub(s).dot(n),p=n.clone().multiplyScalar(l);return s.clone().add(p)}getProposalPositionIndexOnMagnetLine(e){const t=this.GetPropertyValue("Collab.MagnetLine.Position.A.X"),i=this.GetPropertyValue("Collab.MagnetLine.Position.A.Y"),r=this.GetPropertyValue("Collab.MagnetLine.Position.B.X"),a=this.GetPropertyValue("Collab.MagnetLine.Position.B.Y"),s=new o.Vector2(t,i),n=new o.Vector2(r,a),l=(new o.Vector2).subVectors(n,s),p=l.clone().normalize(),u=(new o.Vector2).subVectors(e,s).dot(p),h=p.clone().multiplyScalar(u),d=s.clone().add(h),c=new o.Vector2(0,0);let C=1/0,y=-1;const m=this.arrayModifiableAttached.length;for(let e=0;e<m;e++){const r=(e+1)/(m+1),a=l.clone().multiplyScalar(r),s=t+a.x,n=i+a.y,p=new o.Vector2(s,n),u=d.distanceTo(p);u<C&&(c.set(s,n),C=u,y=e)}return{proposalPoint:c,index:y}}}return s.prototype.getDefaultName=function(){return"MagnetLine"},Object.defineProperty(s.prototype,"componentType",{enumerable:!0,get:function(){return"VCXMagnetLine_Spec"}}),s.prototype.dressupGroupName="MagnetLine",s})),define("DS/VCXWebDressup/VCXDressupNode",["DS/Visualization/Node3D","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","DS/VCXWebModifiables/VCXPropertiesObserver","DS/VCXWebModifiables/VCXModelChangeListener","DS/VCXWebExperienceBase/VCXContextManager"],(function(e,t,i,r,a){"use strict";var o=e.extend({init:function(e){return this._parent(e.name),this._globalOpacity=null,this._Modifiable=e.modifiable,this._Modifiable?this._experienceBase=this._Modifiable.ExperienceBase:this._experienceBase=e.experience,this.Dirty=!0,this.Modifiable&&(this.layerObserver=new i,this.layerObserver.add(this.Modifiable,"Actor.IsAlwaysOnTop"),this.layerObserver.add(this.Modifiable,"Collab.3D.Paper.Positioning.Type"),this.layerObserver.add(this.Modifiable,"Collab.3D.Paper.Is.Background")),this._handles={},this._varianceViewerID=null,this.setPickingPriorityId("VCXDressup"),this},dispose:function(){if(delete this._experienceBase,delete this._Modifiable,delete this.layerObserver,delete this._overrides,this._viewerVariances)for(let e of Object.keys(this._viewerVariances))this._viewerVariances[e].dispose();this._parent()},GetPropertyValue:function(e,t){return this.Modifiable.GetPropertyValue(e,t)},GetFontPropertyValue:function(e){return this.Modifiable.GetFontPropertyValue(e)},GetColorPropertyValue:function(e){return this.Modifiable.GetColorPropertyValue(e)},GetFramePropertyValue:function(e){return this.Modifiable.GetFramePropertyValue(e)},GetAnchorValue:function(e){return this.Modifiable.GetAnchorValue(e)},GetAnchorWorldMatrix:function(e,t){return this.Modifiable.GetAnchorWorldMatrix(e,t)},GetWorldMatrix:function(e,t){let i=this.GetNode(e)?.getMatrix()?.clone();if(t){const e=this.getChildByName(t);e&&(i=i.multiply(e.getMatrix()))}return i},GetPropertyGroupVisibility:function(e){return this.Modifiable.GetPropertyGroupVisibility(e)},GetOpacity:function(e){let t=this.Modifiable.GetOpacity();return t>0&&!this.ExperienceBase.getManager("VCXVisuManager").areAllAnchorsReadyAndVisible(e,this.Modifiable)&&(t=0),t},RecursiveSetRenderDepth:function(e){this.traverse((function(e,t){e.setRenderDepth&&void 0!==t?e.setRenderDepth(t):e.renderDepth=t}),e)},RecursiveSetRenderPasses:function(e){this.traverse((function(e,t){e.setRenderPasses&&(e.noAA&&t.noAA?e.setRenderPasses(t.noAA):e.setRenderPasses(t.AA))}),e)},GetVarianceNode:function(e){return new o({name:e.viewerID+"_"+this.name,modifiable:this.Modifiable,experience:this.ExperienceBase})},setVisibility:function(e){this.visible!==e?(this._parent(e),this.SetVisibilityOverrides(!0)):this.SetVisibilityOverrides()},removeChild:function(e){if(this._parent(e),e&&!e._varianceViewerID)for(const t in e._viewerVariances){(this._viewerVariances&&this._viewerVariances[t]||this).removeChild(e._viewerVariances[t])}},SetVisibilityOverrides:function(e){const t=this._baseNode||this;if(t._viewerVariances){const i=this.ExperienceBase;i&&i.getManager("VCXContextManager").applyToViewers((r=>{const o=t.GetNode(r);let s=o._varianceViewerID?o._varianceViewerID:a.MAIN_VIEWER_ID;o&&i&&i.getManager("VCXContextManager").applyToViewers((t=>{const i=t.viewerID===s,r=o&&o.getOverride(t);if(r){const t=!!i&&null;(t!==r.getVisibility()||e)&&r.setVisibility(t)}}),!0)}),!0)}},GetNode:function(e){if(e&&!this._baseNode){if(e.viewerID===a.MAIN_VIEWER_ID)return this;if(this._viewerVariances||(this._viewerVariances={}),!this._viewerVariances[e.viewerID]){const t=this.GetVarianceNode(e);t._baseNode=this,t._varianceViewerID=e.viewerID,this._viewerVariances[e.viewerID]=t;this.getParents()[0].GetNode(e).add(t),t.update({viewer:e,viewpoint:e.currentViewpoint})}return this._viewerVariances[e.viewerID]}return this},onAddChildNode:function(e,t){var i={noTreatment:!1,setFrustumCulled:!1,setShadow:!1,setMirror:!1,exludeFromBounding:!0,setPickParent:!0};if(UWA.extend(i,t,!0),!(this.isDressupGrp||e&&e.isDressupGrp||i.noTreatment)){e.traverse((function(e){e.setFrustumCulled&&e.setFrustumCulled(i.setFrustumCulled),e.setShadow&&e.setShadow(i.setShadow,i.setShadow),e.setMirror&&e.setMirror(i.setMirror),e.exludeFromBounding&&e.exludeFromBounding(i.exludeFromBounding),e.setPickParent&&e.setPickParent(i.setPickParent)}));var r=this.getParents()&&this.getParents()[0];r?(r&&r.isDressupGrp&&this.setPickParent(!1),e._varianceViewerID=this._varianceViewerID):this.setPickParent(!1)}},add:function(e,t){var i=this._parent(e);return this.onAddChildNode(e,t),i},addChild:function(e,t){var i=this._parent(e);return this.onAddChildNode(e,t),i},getOverride:function(e){this._overrides||(this._overrides={});var t=this._overrides[e.viewerID];return t||(t=this.ExperienceBase.getManager("VCXDressupManager").getDressupDressupNodeOverride(e,this),this._overrides[e.viewerID]=t),t},update:function(e){if(!this._varianceViewerID)for(const t in this._viewerVariances)this._viewerVariances[t].update(e);var t=this.GetOpacity(e);t<=0&&(this.lastAlwaysOnTop=null);var i=!1;if(this._previousOpacity!==t&&(0===this._previousOpacity||0===t)){this._experienceBase.getManager("VCXContextManager").renderAll();var a=this._experienceBase.getManager("VCXModelChangeListener");a&&(a.hasChanged(r.FChangeFlag.DressupVisibility,!0),a.hasChanged(r.FChangeFlag.Visibility,!0)),this._previousOpacity=t,i=!0}(t||i)&&this.layerObserver&&(this.layerObserver.update(),this.layerObserver.isDirty()&&(this.needToChangeLayer=!0))},postUpdate:function(e){if(!this._varianceViewerID)for(const t in this._viewerVariances)this._viewerVariances[t].postUpdate(e);this.layerObserver&&this.layerObserver.reset()},preRender:function(e){if(e&&e.viewer&&e.viewer.viewerID!==a.MAIN_VIEWER_ID&&!this._varianceViewerID){const t=this.GetNode(e.viewer,!0);return t&&t.id!==this.id&&t.preRender(e),!1}return this.viewpointVisibility=this.Modifiable.GetViewpointVisibility(e),!0},handleLayers:function(e){this.alwaysOnTop=this.GetPropertyValue("Actor.IsAlwaysOnTop");let i=this.GetPropertyValue("Collab.3D.Paper.Is.Background");void 0!==this.ExperienceBase.getManager("VCXDressupManager").getOverrideAlwaysOnTop()&&(this.alwaysOnTop=this.ExperienceBase.getManager("VCXDressupManager").getOverrideAlwaysOnTop(),i=!this.alwaysOnTop);var r=this.ExperienceBase.getManager("VCXIVManager");if(r&&r.scenario)this.RecursiveSetRenderPasses(["main"]);else{if(this.lastAlwaysOnTop!==this.alwaysOnTop||e||this.needToChangeLayer){this.needToChangeLayer=!1;var a=this.ExperienceBase.getManager("VCXVisuManager");this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=t.EPositionType.Free2D?i?this.RecursiveSetRenderPasses({AA:[a.getRenderList("VCXBackground2DDressups")]}):this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<t.EPositionType.EndOfAutomaticPositionning?this.RecursiveSetRenderPasses({AA:[a.getRenderList("VCXPre2DDressups"),a.getRenderList("VCX2DDressups")],noAA:[a.getRenderList("VCXPre2DDressups"),a.getRenderList("VCXNoAADressups")]}):this.RecursiveSetRenderPasses({AA:[a.getRenderList("VCXPre2DDressups"),a.getRenderList("VCX2DDressups2"),"PassToCheckAvailableSpace"],noAA:[a.getRenderList("VCXPre2DDressups"),a.getRenderList("VCXNoAADressups"),"PassToCheckAvailableSpace"]}):this.alwaysOnTop?this.RecursiveSetRenderPasses({AA:[a.getRenderList("VCXNOc3DDressups")],noAA:[a.getRenderList("VCXPre2DDressups"),a.getRenderList("VCXNoAADressups")]}):this.RecursiveSetRenderPasses({AA:["main"]})}this.lastAlwaysOnTop=this.alwaysOnTop}},isNodeBuilt:function(){var e=this.Modifiable.QueryInterface("W3AISGNodeHolder").giveSGNode();return Boolean(e)}});return Object.defineProperty(o.prototype,"ExperienceBase",{enumerable:!0,get:function(){return this._experienceBase?this._experienceBase:this._Modifiable?this._Modifiable.ExperienceBase:void 0}}),Object.defineProperty(o.prototype,"Modifiable",{enumerable:!0,get:function(){return this._Modifiable}}),Object.defineProperty(o.prototype,"Anchors",{enumerable:!0,get:function(){return this.Modifiable._Anchors}}),o})),define("DS/VCXWebDressup/VCXDressupSGNodeHolder",["DS/WebApplicationBase/W3AASGNodeHolder","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec"],(function(e,t,i){"use strict";return e.extend({init:function(){},buildSGNode:function(){return this._sgNode&&(this._sgNode.setVisibilityInTree(!0),this._sgNode._isDressupNode=!0),this._sgNode},getWorldMatrix:function(e,t){return this.getAnchorReferential(t)},getAnchorReferential:function(e){var r=new t.Matrix4,a=this.QueryInterface("VCXIModifiable");if(a){var o=this.GetObject()._experienceBase.getManager("VCXContextManager"),s=e;if(!s){var n=o.getMainViewer();s={viewer:n,viewpoint:n.currentViewpoint}}var l=a.getAnchorsCount();if(0===l)return this.computePointAtOptimalDistance(s);a.GetPropertyValue("Collab.3D.Paper.UsesBarycenter")||(l=1);var p=new t.Vector3;a.processAnchorsIDs((e=>{if(a.GetPropertyValue("Collab.3D.Paper.Referential.In.World")||1!==l){var n=a.GetAnchorWorldMatrix(e,s);if(!n)return null;var u=(new t.Vector3).getPositionFromMatrix(n);u.divideScalar(l),p.add(u);var h=this.GetObject().getWorkingRootPathElement();r.makeTranslation(p.x,p.y,p.z).extractRotation(h.getWorldMatrix(o.getMainViewer()))}else r=a.GetAnchorWorldMatrix(e,s);var d=a.GetPropertyValue("Collab.3D.Paper.Positioning.Type"),c=d<=i.EPositionType.Free2D,C=d===i.EPositionType.RelativeToReferential;if(a.GetProperty("Collab.Attach.Show")&&a.GetPropertyGroupVisibility("Group.Attach")&&(a.GetPropertyValue("Collab.Attach.LeadType")||a.GetPropertyValue("Collab.Measurement.Attach.Type"))||!c||C||(r=this.computePointAtOptimalDistance(s)),!a.GetPropertyValue("Collab.3D.Paper.UsesBarycenter"))return!1}),{sort:!0})}return r},getCenterSceneBoundingSphereMat:function(e,i){var r=i instanceof t.Matrix4?i:new t.Matrix4,a=this.GetObject()._experienceBase.getManager("VCXPaperManager");if(!a)return console.warn("Couldn't find the PaperManager, return input matrix"),r;var o=e.viewer.getSceneBoundingSphere().center.clone(),s=a.ModelToMM2(e,o),n=(new t.Vector3).getPositionFromMatrix(r);return a.ModelToMM2(e,n).z=s.z,n=a.MMToModel2(e,s),(new t.Matrix4).setPosition(n)},computePointAtOptimalDistance:function(e){var i=e.viewpoint.camera.fov,r=e.viewer.getSceneBoundingSphere().radius;null===!this.tanFov&&this.oldFov===i||(this.oldFov=i,this.tanFov=Math.tan(i*Math.PI/180));var a=r/this.tanFov,o=e.viewpoint.camera.position.clone();return o.add(e.viewpoint.getSightDirection().clone().multiplyScalar(a)),(new t.Matrix4).setPosition(o)},getPathElement:function(){return this._pathElement?this._pathElement:this._sgNode?(console.warn("???? Ask ITY"),this._pathElement):null},unreferenceSGNode:function(){this._sgNode&&(this._sgNode.dispose&&this._sgNode.dispose(),delete this._sgNode)},isSelfManagedPathElement:function(){return!0}})})),define("DS/VCXWebDressup/VCXSmart3DPaperNode",["require","exports","DS/VCXWebDressup/VCXDressupNode","DS/CoreEvents/Events","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec"],(function(e,t,i,r,a,o,s){"use strict";class n extends i{constructor(e){return super(e),this._Depth=0,this._VerticalToUse=n.VerticalToUseEnum.CAMERA,this._BillboardDirectionType=n.BillboardDirectionTypeEnum.CAMERA_DIRECTION,this._Position2D=new a.Vector2,this._Position=new a.Vector3,this._PositioningType=s.EPositionType.Free3D,this._PositionRadius=0,this._ScalingFactor=1,this._SizeControlType=n.SizeControlTypeEnum.NoControl,this._BillboardType=n.BillboardTypeEnum.NO_BILLBOARD,this._Opacity=1,this._ModifiableProperties=!0,this._posDirty=!0,this._zRotation=0,this._RenderInProcess=!1,this._Depth=0,this._VerticalToUse=n.VerticalToUseEnum.CAMERA,this._BillboardDirectionType=n.BillboardDirectionTypeEnum.CAMERA_DIRECTION,this._Position2D=new a.Vector2,this._Position=new a.Vector3,this._PositioningType=s.EPositionType.Free3D,this._PositionRadius=0,this._ScalingFactor=1,this._SizeControlType=0,this._BillboardType=n.BillboardTypeEnum.NO_BILLBOARD,this._Opacity=1,this._ModifiableProperties=!0,this._posDirty=!0,this}_ComputeBillboardMatrix(e,t,i){var r=(new a.Matrix4).extractRotation(this.GetReferential(e)),s=e.viewpoint.getEyePosition(),l=e.viewpoint.getSightDirection().clone();l.normalize();var p,u,h=this.ExperienceBase.getManager("VCXIVManager")&&this.ExperienceBase.getManager("VCXIVManager").scenario;if(p=this.VerticalToUse!==n.VerticalToUseEnum.CAMERA||h?new a.Vector3(0,0,1):e.viewpoint.getUpDirection(),this.BillboardDirectionType===n.BillboardDirectionTypeEnum.CAMERA_DIRECTION?u=(new a.Vector3).subVectors(t,l):this.BillboardDirectionType===n.BillboardDirectionTypeEnum.CAMERA_POSITION&&(u=s.clone()),this.BillboardType===n.BillboardTypeEnum.CYLINDRICAL);else if(this.BillboardType===n.BillboardTypeEnum.SPHERICAL)r=(new a.Matrix4).lookAt(u,t,p);else if(this.BillboardType===n.BillboardTypeEnum.PRESERVE_X_AXIS_Y_IN_CAM_PLANE||this.BillboardType===n.BillboardTypeEnum.PRESERVE_X_AXIS_Y_IN_CAM_PLANE_Y_ALWAYS_UP){var d;d=this.BillboardXAxis?this.BillboardXAxis:o.getVxFromMatrix(i).normalize();var c=e.viewpoint.getSightDirection(),C=(new a.Vector3).crossVectors(p,c).normalize();r=(new a.Matrix4).lookAt(u,t,p);var y=this.ExperienceBase.getManager("VCXPaperManager");if(y){var m=y.ModelToMM2(e,t),V=y.ModelToMM2(e,(new a.Vector3).addVectors(t,d)).sub(m).normalize(),f=y.ModelToMM2(e,(new a.Vector3).addVectors(t,C)).sub(m).normalize(),b=(new a.Vector3).crossVectors(V,f),P=new a.Quaternion(0,0,b.z,1+V.dot(f));P.normalize(),r.multiply((new a.Matrix4).makeRotationFromQuaternion(P)),this.BillboardType===n.BillboardTypeEnum.PRESERVE_X_AXIS_Y_IN_CAM_PLANE_Y_ALWAYS_UP&&f.dot(V)<.001&&r.multiply((new a.Matrix4).makeRotationZ(Math.PI))}}return r}_Build(){}is2D(){return this.PositioningType==s.EPositionType.Free2D||this.PositioningType<s.EPositionType.EndOfAutomaticPositionning}GetReferential(e){if(this._referential)return this._referential;if(this.Modifiable&&this.ExperienceBase){var t=this.Modifiable.QueryInterface("W3AISGNodeHolder"),i=e&&e.viewer||this.ExperienceBase.getManager("VCXContextManager").getMainViewer();return t.getWorldMatrix(i,e)}return new a.Matrix4}SetReferential(e){this._referential=e}_computeMatrix(e,t){const i=this.ExperienceBase.getManager("VCXPaperManager");var r=this.Position.clone();if(this.PositioningType===s.EPositionType.Free3D)r.applyMatrix4(this.GetReferential(e));else if(this.PositioningType===s.EPositionType.RelativeToReferential){var n=(new a.Vector3).getPositionFromMatrix(this.GetReferential(e));i&&(r=i.GetModelPointFromModelPointAndPaperPosition(e,n,this.Position2D,this.PositionRadius))}else if(this.PositioningType<=s.EPositionType.Free2D&&i){n=(new a.Vector3).getPositionFromMatrix(this.GetReferential(e));var l=i.ModelToMM2(e,n),p=o.clamp(l.z,-.99,.99);(m=new a.Vector3).x=this.Position2D.x,m.y=this.Position2D.y,m.z=p,r=i.MMToModel2(e,m)}var u=1;if(1===this.SizeControlType)i&&(u=i.GetPaperRatio(e,r));else if(2===this.SizeControlType){var h=e.viewpoint.getEyePosition().distanceTo(r);h||(h=1);var d=.5*e.viewer.div.clientHeight*Math.abs(1/(Math.tan(Math.PI*e.viewpoint.getAngle()/360)*h));i&&(d*=i.Zoom),(u=0!==d?1/d:1)||(u=1)}u*=this.ScalingFactor;const c=new a.Matrix4,C=new a.Matrix4,y=new a.Matrix4;if(y.makeScale(u,u,u),this.is2D()&&i&&i.shouldUsePaperReferential()){var m;(m=new a.Vector3).x=this.Position2D.x,m.y=-this.Position2D.y,m.z=0,C.setPosition(m);var V=i.getPaperReferential();c.copy(V),c.multiply(C),c.multiply((new a.Matrix4).makeRotationZ(this._zRotation))}else{C.setPosition(r);var f=this._ComputeBillboardMatrix(e,r,this.GetReferential(e));c.multiply(C),c.multiply(f),c.multiply((new a.Matrix4).makeRotationZ(this._zRotation)),c.multiply(y)}return t&&this.setMatrix(c),c}updateMatrix(e){this.setMatrix(this._computeMatrix(e,!1))}_onLinkedToSceneGraph(){super._onLinkedToSceneGraph(),this.tokenChange=r.subscribe({event:"/VISU/"},(e=>{"@onViewpointChange"===e.eventType&&e.viewpoint&&e.viewpoint.viewer&&this._hasOccurrenceInViewer(e.viewpoint.viewer)&&(this._posDirty=!0)})),this.tokenRenderStatus=r.subscribe({event:"VCX_RENDER_PROCESSING"},(e=>{this._RenderInProcess=e.status}))}_onUnlinkedToSceneGraph(){super._onUnlinkedToSceneGraph(),r.unsubscribe(this.tokenChange),r.unsubscribe(this.tokenRenderStatus)}preRender(e){if(this._posDirty&&(this._posDirty=!1,this.updateMatrix(e),this.AttachedDiv&&!this._RenderInProcess&&this.ExperienceBase.getManager("VCXContextManager").getMainViewer()===e.viewer)){var t=this.ExperienceBase.getManager("VCXPaperManager");if(t){var i=(new a.Vector3).getPositionFromMatrix(this.getMatrix()),r=t.ModelToMM2(e,i),o=t.MMToPixel2(e,r),s=t.GetMmToPxRatio();s*=.3527,this._previousRatio!==s&&(this._previousRatio=s,this.AttachedDiv.style.transform="scale("+s+")"),this._previousLeft===o.x&&this._previousTop===o.y||(this._previousLeft=o.x,this._previousTop=o.y,this.AttachedDiv.style.left=o.x+"px",this.AttachedDiv.style.top=o.y+"px")}}}update(e){if(super.update(e),!(this.GetOpacity(e)<=0)){if(this._ModifiableProperties){if(void 0!==this.GetPropertyValue("Collab.3D.Paper.Billboard.Type")&&(this.BillboardType=this.GetPropertyValue("Collab.3D.Paper.Billboard.Type")),void 0!==this.GetPropertyValue("Collab.3D.Paper.3D.Text.Position")&&(this.Position=this.GetPropertyValue("Collab.3D.Paper.3D.Text.Position")),void 0!==this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")){if(this.PositioningType=this.GetPropertyValue("Collab.3D.Paper.Positioning.Type"),this.lastPositioningType!==this.PositioningType){let e=this.PositioningType<=s.EPositionType.Free2D;this.traverse((t=>{t.exludeFromBounding&&t.exludeFromBounding(e)}))}this.lastPositioningType=this.PositioningType}void 0!==this.GetPropertyValue("Collab.3D.Paper.Size.Control.Type")&&(this.SizeControlType=this.GetPropertyValue("Collab.3D.Paper.Size.Control.Type")),void 0!==this.GetPropertyValue("Collab.3D.Paper.Scaling.Factor")&&(this.ScalingFactor=this.GetPropertyValue("Collab.3D.Paper.Scaling.Factor")),void 0!==this.GetPropertyValue("Collab.Body.Rotation")&&(this.ZRotation=this.GetPropertyValue("Collab.Body.Rotation")*Math.PI/180),void 0!==this.GetPropertyValue("Collab.3D.Paper.Paper.Position")?this.Position2D=this.GetPropertyValue("Collab.3D.Paper.Paper.Position"):(void 0!==this.GetPropertyValue("Collab.3D.Paper.Paper.Position.X")&&(this.Position2D.x=this.GetPropertyValue("Collab.3D.Paper.Paper.Position.X")),void 0!==this.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y")&&(this.Position2D.y=this.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y"))),void 0!==this.GetPropertyValue("Collab.3D.Paper.3D.Text.Radius")&&(this.PositionRadius=this.GetPropertyValue("Collab.3D.Paper.3D.Text.Radius")),this._posDirty=!0}this.handleLayers()}}get ModifiableProperties(){return this._ModifiableProperties}set ModifiableProperties(e){this._ModifiableProperties=e}get Opacity(){return this._Opacity}set Opacity(e){this._Opacity=e}get BillboardType(){return this._BillboardType}set BillboardType(e){this._BillboardType!==e&&(this._posDirty=!0,this._BillboardType=e)}get BillboardXAxis(){return this._BillboardXAxis}set BillboardXAxis(e){this._BillboardXAxis&&this._BillboardXAxis.equals(e)||(this._posDirty=!0,this._BillboardXAxis=e)}get SizeControlType(){return this._SizeControlType}set SizeControlType(e){this._SizeControlType!==e&&(this._posDirty=!0,this._SizeControlType=e)}get ScalingFactor(){return this._ScalingFactor}set ScalingFactor(e){this._ScalingFactor!==e&&(this._posDirty=!0,this._ScalingFactor=e)}get PositioningType(){return this._PositioningType}set PositioningType(e){this._PositioningType!==e&&(this._posDirty=!0,this._PositioningType=e)}get Position(){return this._Position}set Position(e){this._Position&&this._Position.equals(e)||(this._posDirty=!0,this._Position=e)}get Position2D(){return this._Position2D}set Position2D(e){this._Position2D&&this._Position2D.equals(e)||(this._posDirty=!0,this._Position2D=e)}get PositionRadius(){return this._PositionRadius}set PositionRadius(e){this._PositionRadius!==e&&(this._posDirty=!0,this._PositionRadius=e)}get Referential(){if(this._referential)return this._referential;if(this.Modifiable&&this.ExperienceBase){var e=this.Modifiable.QueryInterface("W3AISGNodeHolder"),t=this.ExperienceBase.getManager("VCXContextManager");return e.getWorldMatrix(t.getMainViewer())}return new a.Matrix4}set Referential(e){this._referential===e||this._referential&&e&&this._referential.equals(e)||(this._posDirty=!0,this._referential=e)}get Depth(){return this._Depth}set Depth(e){this._Depth!==e&&(this._posDirty=!0,this._Depth=e)}get VerticalToUse(){return this._VerticalToUse}set VerticalToUse(e){this._VerticalToUse!==e&&(this._posDirty=!0,this._VerticalToUse=e)}get BillboardDirectionType(){return this._BillboardDirectionType}set BillboardDirectionType(e){this._BillboardDirectionType!==e&&(this._posDirty=!0,this._BillboardDirectionType=e)}get ZRotation(){return this._zRotation}set ZRotation(e){this._posDirty=!0,this._zRotation=e}get AttachedDiv(){return this._AttachedDiv}set AttachedDiv(e){this._AttachedDiv=e}}return function(e){let t,i,r,a;!function(e){e[e.NO_BILLBOARD=0]="NO_BILLBOARD",e[e.CYLINDRICAL=1]="CYLINDRICAL",e[e.SPHERICAL=2]="SPHERICAL",e[e.PRESERVE_X_AXIS_Y_IN_CAM_PLANE=3]="PRESERVE_X_AXIS_Y_IN_CAM_PLANE",e[e.PRESERVE_X_AXIS_Y_IN_CAM_PLANE_Y_ALWAYS_UP=4]="PRESERVE_X_AXIS_Y_IN_CAM_PLANE_Y_ALWAYS_UP"}(t=e.BillboardTypeEnum||(e.BillboardTypeEnum={})),function(e){e[e.NoControl=0]="NoControl",e[e.InPaper=1]="InPaper",e[e.InViewer=2]="InViewer"}(i=e.SizeControlTypeEnum||(e.SizeControlTypeEnum={})),function(e){e[e.WORLD=0]="WORLD",e[e.CAMERA=1]="CAMERA"}(r=e.VerticalToUseEnum||(e.VerticalToUseEnum={})),function(e){e[e.CAMERA_DIRECTION=0]="CAMERA_DIRECTION",e[e.CAMERA_POSITION=1]="CAMERA_POSITION"}(a=e.BillboardDirectionTypeEnum||(e.BillboardDirectionTypeEnum={}))}(n||(n={})),n})),define("DS/VCXWebDressup/VCXRayTracingNode",["DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/VCXWebIO/VCXPixelImage"],(function(e,t,i,r,a,o){"use strict";return e.extend({init:function(e){return this.ExperienceBase=e,this._parent("RayTracingNode"),this.bool=void 0,this.dirty=!0,this.previousImage="",this},dispose:function(){this._Smart3DPaperNode&&(this._Smart3DPaperNode.dispose(),this._Smart3DPaperNode=null),this._parent()},_Build:function(){this._PrimitiveGroup=new i.PrimitiveGroup;var e=new i.Buffer({component:i.VertexComponentEnum.POSITION,data:new Float32Array(12)});e.dimension=3,this._PrimitiveGroup.addBuffer(0,e);var t=new i.Buffer({component:i.VertexComponentEnum.TEX_COORD_0,data:new Float32Array(16)});t.dimension=3,this._PrimitiveGroup.addBuffer(1,t);var o,s=new i.Buffer({indexBuffer:!0,data:new Uint16Array(6)});this._PrimitiveGroup.addBuffer(2,s);var n=0;(o=e.data)[n++]=0,o[n++]=0,o[n++]=0,o[n++]=1,o[n++]=0,o[n++]=0,o[n++]=1,o[n++]=-1,o[n++]=0,o[n++]=0,o[n++]=-1,o[n++]=0;n=0;(o=t.data)[n++]=0,o[n++]=1,o[n++]=0,o[n++]=1,o[n++]=1,o[n++]=0,o[n++]=1,o[n++]=0,o[n++]=0,o[n++]=0,o[n++]=0,o[n++]=0,n=0,(o=s.data)[n++]=0,o[n++]=2,o[n++]=1,o[n++]=0,o[n++]=3,o[n++]=2;var l=new i.Primitive({nbIndices:6,connectivity:i.ConnectivityTypeEnum.TRIANGLES,fillGAS:new i.FillAttributes}),p=new i.VertexComponent({nbVertices:4,bufferId:0,indices:new i.IndexArray({bufferId:2,offset:0})}),u=new i.VertexComponent({nbVertices:4,bufferId:1,indices:new i.IndexArray({bufferId:2,offset:0})});l.addVertexComponent(p),l.addVertexComponent(u),this._PrimitiveGroup.addPrimitive(l),this._MeshNode=r.createMeshNode(this._PrimitiveGroup),this.setMaterial(),this._MeshNode.setVisibilityInTree(!1);var h={name:"BackgroundSmartNode",experience:this.ExperienceBase};this._Smart3DPaperNode=new a(h),this._Smart3DPaperNode.BillboardType=2,this._Smart3DPaperNode.SizeControlType=1,this._Smart3DPaperNode.PositioningType=1e3,this._Smart3DPaperNode.Depth=0,this._Smart3DPaperNode.add(this._MeshNode),this.add(this._Smart3DPaperNode);var d=this.ExperienceBase.getManager("VCXVisuManager");d&&(this.traverse((function(e,t){return e.setRenderPasses([d.getRenderList("VCXPreRaytracing"),d.getRenderList("VCXRaytracing")]),e.setPickable(i.PICKTHROUGH),e.excludeFromHighlight(t,t),!1}),!0),this.setVisibilityFree(!0))},preRender:function(e){this._Smart3DPaperNode&&this._Smart3DPaperNode.preRender(e)},setMaterial:function(e){this._bodyMat||(this._bodyMat=new t.MeshBasicMaterial({side:t.FrontSide,forceSide:!0,color:"#ffffff",opacity:this.backgroundOpacity,force:!0,depthWrite:!1}),this._MeshNode&&this._MeshNode.setMaterial(this._bodyMat)),e?(this._bodyMat.map=e,this._bodyMat.needsUpdate=!0):(this._bodyMat.map=null,this._bodyMat.needsUpdate=!0)},downloadURI:function(e,t){var i=document.createElement("a");i.download=t,i.href=e,document.body.appendChild(i),i.click(),document.body.removeChild(i)},update:function(e){this._parent();let i=this.ExperienceBase.getManager("VCXLivePreviewRenderingManager");if(!i)return;let r=i.livePreviewWEB.visible;if(this.backgroundOpacity=1,this._Smart3DPaperNode||this._Build(),this._MeshNode){if(r===this.bool||r||(this.setVisibility(!1),this.ExperienceBase.getManager("VCXContextManager").getMainViewer().render(),this.bool=!1),i.livePreviewWEB.lastImage&&!i.livePreviewWEB.lastImage.applied&&r){i.livePreviewWEB.lastImage.applied=!0;let e=i.livePreviewWEB.lastImage,r=new o(e.data,e.width,e.height).toDataUrl("image/jpeg");t.ImageUtils.loadTexture(r,{},(e=>{this.setMaterial(e);let t=i.livePreviewWEB.visible;this.setVisibility(t),this.bool=t,i.livePreviewWEB.hideRasterHide(!0)})),this.bool=!0}this._Smart3DPaperNode&&this._bodyMat&&(this._bodyMat.opacity=this.backgroundOpacity);var a=this.ExperienceBase.getManager("VCXPaperManager");if(a){var s=a.Size;this._MeshNode.setMatrix((new t.Matrix4).makeScale(s.x,s.y,1))}}},downloadURI(e,t){var i=document.createElement("a");i.download=t,i.href=e,document.body.appendChild(i),i.click(),document.body.removeChild(i)}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXMarkup/VCXPanel_Spec",["require","exports","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{set shapeInfo(e){}get shapeInfo(){return this.QueryInterface("W3AISGNodeHolder")?.giveSGNode()?.shapeInfo}}return function(e){let t;!function(e){e[e.None=0]="None",e[e.Image=1]="Image",e[e.Text=2]="Text"}(t=e.ESubType||(e.ESubType={}))}(r||(r={})),r.prototype.getDefaultName=function(){return"Panel"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXPanel_Spec"}}),r.prototype.dressupGroupName="Panels",r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXMarkup/VCXDiggerPanel_Spec",["require","exports","DS/VCXWebDressup/VCXMarkup/VCXPanel_Spec"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{}return r.prototype.getDefaultName=function(){return"DiggerPanel"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXDiggerPanel_Spec"}}),r.prototype.dressupGroupName="Panels",r})),define("DS/VCXWebDressup/VCXMarkup/VCXPanelStylesHolder",["require","exports","DS/VCXWebStyles/VCXAStylesHolder","DS/VCXWebDressup/VCXMarkup/VCXPanel_Spec"],(function(e,t,i,r){"use strict";return class extends i{getStyleType(){const e=this.GetObject()?.GetType(),t=this.QueryInterface("VCXIModifiable")?.GetPropertyValue("Collab.Markup.SubType");return t===r.ESubType.Text?e:e+"."+t}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXMarkup/VCXMarkupDressup",["require","exports","DS/VCXWebDressup/VCXADressup","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec"],(function(e,t,i,r){"use strict";i=__importDefault(i),r=__importDefault(r);class a extends i.default{constructor(){super(...arguments),this._renderIteration=0}isDressupPropertiesChangeIndependent(){const e=this.QueryInterface("VCXIModifiable");return(e&&e.GetPropertyValue("Collab.3D.Paper.Positioning.Type"))<r.default.EPositionType.EndOfAutomaticPositionning&&(this.GetObject()?._experienceBase.getManager("VCXVisuManager").viewpointHasMoved&&(this._renderIteration=1),this._renderIteration>0)&&(this._renderIteration--,!0)}}return a}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXMarkup/VCXMeasurementDressup",["require","exports","DS/VCXWebDressup/VCXMarkup/VCXMarkupDressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{isSelectAllAffected(){return!1}anchors(){return{min:1,max:-1}}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXMarkup/VCXDiggerPanelDressup",["require","exports","DS/VCXWebDressup/VCXMarkup/VCXMarkupDressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{anchors(){return{min:1,max:1}}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXMarkup/VCXLabelDressup",["require","exports","DS/VCXWebDressup/VCXMarkup/VCXMarkupDressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{anchors(){return{min:1,max:-1,canUserAdd:!0,canUserDelete:!0}}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXMarkup/VCXCalloutDressup",["require","exports","DS/VCXWebDressup/VCXMarkup/VCXMarkupDressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{anchors(){return{min:1,max:-1,canUserAdd:!0,canUserDelete:!0}}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXMarkup/VCXPanelDressup",["require","exports","DS/VCXWebDressup/VCXMarkup/VCXMarkupDressup"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{anchors(){return{min:0,max:-1}}}return r})),define("DS/VCXWebDressup/VCXAnchorServices",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/VCXWebVisualization/VCXPickInfo","DS/VCXWebSystem/VCXMathTools","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebVisu/VCXModifiablesAccess","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec"],(function(e,t,i,r,a,o,s,n,l,p,u,h){"use strict";var d=e.extend({init:function(){}});return d.GetNewPropertyAnchorFromMatrix=function(e,t,i){var r="Actor.Anchor."+t,a=e.QueryInterface("VCXIModifiable").GetProperty(r).Clone(),o=a.GetPropertyValue(),s=o.GetValueLink(),n=e._experienceBase.ComponentsMap.GetComponentFromLink(s);n||(n=e.getWorkingRootComponent());var l=n.QueryInterface("W3AISGNodeHolder").getMatrixInLCS(e._experienceBase.getManager("VCXContextManager").getMainViewer(),i),p=a.GetPropertyValue().GetValueFrame();return p.Value=l,o.SetValueFrame(p),a.SetPropertyValue(o),a},d.GetNewPropertyValueAnchor=function(e,i){var r=new n,a=new l(e||new t.Matrix4);return r.SetValueFrame(a),r.SetValueLinkFromComponent(i),r},d.GetNewPropertyValueAnchorFromPickinfo=function(e){return d.GetNewPropertyValueAnchor(e&&e.localMatrix,e&&e.modifiable&&e.modifiable.GetObject())},d.GetComponentToAttachTo=function(e,t){if(e){var i=null;if(t){const r=u.GetModifiableFromPathElement(t,e._experienceBase),a=r&&r.GetObject();a&&(i=a)}return i||(i=e.getWorkingRootComponent()),i}},d.BuildNewPropertyValueAnchor=function(e,i,r){if(e instanceof t.Matrix4){var a=d.GetComponentToAttachTo(i,r);if(a){var o=a.QueryInterface("W3AISGNodeHolder").getMatrixInLCS(i._experienceBase.getManager("VCXContextManager").getMainViewer(),e),s=new n,p=new l;return s.SetValueFrame(p),p.Value=o,r?s.SetValueLinkFromComponent(a):s.SetValueLinkFromComponent(null),s}console.warn("Creation of Anchor Property Value aborted: No object has been found to link the anchor.")}else console.warn("BuildNewPropertyValueAnchor Usage: BuildNewPropertyValueAnchor(iAnchorFrameInWorld <THREE.Matrix4>, iAnchorHolderComponent <VCXComponentOccurrence>, iPathObjectToLink <WebVizu.PathElement>) !")},d.updateRequestedFromAnchorManipulation=function(e,i,a,s,n){if(!(e=e.QueryInterface("VCXIModifiable"))||void 0===i)return;const l=e.GetObject()._experienceBase;var p,u="Actor.Anchor."+i,c=(b=e.GetProperty(u).Clone()).GetPropertyValue().GetValueLink(),C=l.ComponentsMap.GetComponentFromLink(c);C||(C=e.GetObject().getWorkingRootComponent());var y=d.GetComponentToAttachTo(e.GetObject(),a);if(a){var m=y.QueryInterface("VCXIModifiable");if(C!==y&&(y.IsKindOf("VCXComponentOccurrenceExt")||y.IsKindOf("VCXMarkup_Spec")&&m.GetPropertyValue("Collab.3D.Paper.Positioning.Type")===h.EPositionType.Free3D&&0===m.GetPropertyValue("Collab.3D.Paper.Size.Control.Type")))p=d.BuildNewPropertyValueAnchor(s,e.GetObject(),a);else{var V=C.QueryInterface("W3AISGNodeHolder").getMatrixInLCS(l.getManager("VCXContextManager").getMainViewer(),s);(f=b.GetPropertyValue().GetValueFrame()).Value=V,(p=b.GetPropertyValue()).SetValueFrame(f)}}else if(C!==y)p=d.BuildNewPropertyValueAnchor(s,e.GetObject(),a);else{var f;V=C.QueryInterface("W3AISGNodeHolder").getMatrixInLCS(l.getManager("VCXContextManager").getMainViewer(),s);(f=b.GetPropertyValue().GetValueFrame()).Value=V,(p=b.GetPropertyValue()).SetValueFrame(f)}var b;u="Actor.Anchor."+i;if((b=e.GetProperty(u).Clone()).SetPropertyValue(p),n||(n=new o),n.AddOrModifyProperty(b),e&&e.getAnchorsCount&&e.getAnchorsCount()>1&&e.GetPropertyValue&&e.GetPropertyValue("Collab.3D.Paper.UsesBarycenter")&&e.GetPropertyValue("Collab.3D.Paper.Positioning.Type")===h.EPositionType.RelativeToReferential){const a=e.GetObject()._experienceBase.getManager("VCXContextManager").getMainViewer(),o={viewer:a,viewpoint:a.currentViewpoint},l=r.getOFromMatrix(e.GetAnchorWorldMatrix(i)),p=r.getOFromMatrix(e.QueryInterface("W3AISGNodeHolder").getAnchorReferential(o)),u=(new t.Vector3).subVectors(r.getOFromMatrix(s),l).multiplyScalar(1/e.getAnchorsCount()).add(p),h=e.GetObject()._experienceBase.getManager("VCXPaperManager"),d=h.ModelToMM2(o,p),c=h.ModelToMM2(o,u),C=e.GetPropertyValue("Collab.3D.Paper.Paper.Position.X")+d.x-c.x,y=e.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y")+d.y-c.y;n.AddOrModifyProperty(e.GetNewProperty("Collab.3D.Paper.Paper.Position.X",C)),n.AddOrModifyProperty(e.GetNewProperty("Collab.3D.Paper.Paper.Position.Y",y))}return n},d.getWorldMatrix=function(e,i,a){if(!e)return null;var o=e.GetValueFrame().Value,s=i._experienceBase.ComponentsMap.GetComponentFromLink(e.GetValueLink());if(s||(s=i.getWorkingRootComponent()),!s)return o;var n=s.QueryInterface("W3AISGNodeHolder"),l=h.EPositionType.Free3D,p=s.QueryInterface("VCXIModifiable");if(p){var u=p.GetProperty("Collab.3D.Paper.Positioning.Type");u&&(l=u.GetPropertyValue().Value)}if(!(e.is2DAnchor&&n&&n.getSGNode()&&n.getSGNode().GetShapeInfo&&a&&l===h.EPositionType.Free2D))return n&&l===h.EPositionType.Free3D?n.getPathElement()?n.getMatrixInWCS(s._experienceBase.getManager("VCXContextManager").getMainViewer(),o):null:o;if(i){var d=n.getSGNode().GetNode(a).GetShapeInfo();if(d){var c=r.getOFromMatrix(o),C=i._experienceBase.getManager("VCXPaperManager");if(C){var y=C.ModelToMM2(a,r.getOFromMatrix(d.smartNode.getMatrix(a))),m=new t.Vector3(d.smartNode.Position2D.x+d.size.x*c.x,d.smartNode.Position2D.y+d.size.y*c.y,.9999*y.z),V=C.MMToModel2(a,m);return(new t.Matrix4).setPosition(V)}}}},d.requestNewAnchor=function(e,t,n,l){const u=l&&l._map["Collab.ListAnchorsIDs"]&&l._map["Collab.ListAnchorsIDs"].GetPropertyValue().Value||e.GetPropertyValue("Collab.ListAnchorsIDs").slice();var h=null,c="Actor.Anchor."+(h="number"==typeof n||"string"==typeof n?n:e.getNewAnchorID());if(!t){const a=e.GetObject()._experienceBase,o=a.getManager("VCXContextManager").getMainViewer(),s=e.QueryInterface("W3AISGNodeHolder").getAnchorReferential&&e.QueryInterface("W3AISGNodeHolder").getAnchorReferential({viewer:o,viewpoint:o.currentViewpoint});(t=new i(o,a)).globalPosition=r.getOFromMatrix(s),t.globalNormal=r.getVzFromMatrix(s),console.log(t.globalMatrix)}var C=d.GetNewPropertyValueAnchorFromPickinfo(t);if(l||(l=new o),!u.includes(h)){u.push(h);const e=new p(u),t=new s("Collab.ListAnchorsIDs",0);l.AddOrModifyProperty(new a(t,e))}var y=new s(c,0);return l.AddOrModifyProperty(new a(y,C)),{anchorPropName:c,propertySet:l,anchorID:h}},d.deleteAnchor=function(e,t,i){var n=e.GetPropertyValue("Collab.ListAnchorsIDs").slice(0),l=null;if("number"!=typeof t&&"string"!=typeof t)return;l=t;const u=n.indexOf(l);if(u>=0){n.splice(u,1);var d=new p(n),c=new s("Collab.ListAnchorsIDs",0);if(i||(i=new o),i.AddOrModifyProperty(new a(c,d)),e.GetPropertyValue&&e.GetPropertyValue("Collab.3D.Paper.UsesBarycenter")&&e.GetPropertyValue("Collab.3D.Paper.Positioning.Type")===h.EPositionType.RelativeToReferential){var C=e.QueryInterface("VCXIModifiable");const t=C.GetObject()._experienceBase.getManager("VCXContextManager").getMainViewer(),a={viewer:t,viewpoint:t.currentViewpoint},o=r.getOFromMatrix(C.GetAnchorWorldMatrix(l)),s=r.getOFromMatrix(C.QueryInterface("W3AISGNodeHolder").getAnchorReferential(a)),n=s.clone().multiplyScalar(C.getAnchorsCount()).sub(o).multiplyScalar(1/(C.getAnchorsCount()-1)),p=C.GetObject()._experienceBase.getManager("VCXPaperManager"),u=p.ModelToMM2(a,s),h=p.ModelToMM2(a,n),d=C.GetPropertyValue("Collab.3D.Paper.Paper.Position.X")+u.x-h.x,c=C.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y")+u.y-h.y;i.AddOrModifyProperty(C.GetNewProperty("Collab.3D.Paper.Paper.Position.X",d)),i.AddOrModifyProperty(C.GetNewProperty("Collab.3D.Paper.Paper.Position.Y",c))}return{propertySet:i}}},d.dettachAnchor=function(e,t,i){const r=e.GetAnchorWorldMatrix(t);var a="Actor.Anchor."+t,s=e.GetProperty(a).Clone(),n=s.GetPropertyValue();n.SetValueLinkFromComponent(null);var l=s.GetPropertyValue().GetValueFrame();return l.Value=r,n.SetValueFrame(l),s.SetPropertyValue(n),i||(i=new o),i.AddOrModifyProperty(s),{propertySet:i}},d.attachAnchor=function(e,t,i,r){const a=e.GetAnchorWorldMatrix(t);var s="Actor.Anchor."+t,n=e.GetProperty(s).Clone(),l=n.GetPropertyValue(),p=i;p||(p=e&&e.GetObject().getWorkingRootComponent()),l.SetValueLinkFromComponent(i);var u=p.QueryInterface("W3AISGNodeHolder").getMatrixInLCS(e.GetObject()._experienceBase.getManager("VCXContextManager").getMainViewer(),a),h=n.GetPropertyValue().GetValueFrame();return h.Value=u,l.SetValueFrame(h),n.SetPropertyValue(l),r||(r=new o),r.AddOrModifyProperty(n),{propertySet:r}},d}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCX3DAligner/VCX3DAligner_Spec",["require","exports","DS/VCXWebExperienceBase/VCXSceneGraphOverridesServices","DS/VCXWebDressup/VCXAnchorServices","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXDressup_Spec","DS/CoreEvents/Events","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebSystem/VCXMathTools"],(function(e,t,i,r,a,o,s,n,l){"use strict";o=__importDefault(o),l=__importDefault(l);class p extends o.default{constructor(){super(...arguments),this.objectsToMove={}}lock(e,t){this.objectsToMove={};const o=this.QueryInterface("VCXIModifiable");if(!o)return!1;let s=0;const n=o.GetProperty("Actor.ListActors");if(n){const e=n.GetPropertyValue().GetValue();if(e&&e.length)for(var l=0;l<e.length;l++){const t=this._experienceBase.ComponentsMap.GetComponentFromID(e[l].GetValue());t&&(this.objectsToMove[t.GetID()]={object:t},s++)}}const p=o.GetAttachedOccurence(0);if(s||p&&(this.objectsToMove[p.GetID()]={object:p},s++),!s)return!1;if(e)return!0;if(!t)return!0;const u=o.GetProperty("Actor.LinkedTo").Clone();u.GetPropertyValue().SetValueFromComponent(p),t.AddOrModifyProperty(u);const h=o.GetProperty("Alignment.Locked").Clone();h.GetPropertyValue().SetValue(!0),t.AddOrModifyProperty(h),r.dettachAnchor(o,0,t),this._SceneGraphOverrideSet||(this._SceneGraphOverrideSet=i.createAndPushSceneGraphOverrideSet(this._experienceBase));const d=this._experienceBase.getManager("VCXContextManager").getMainViewer();this._experienceBase.getManager("VCXSelectionManager").setOverrideStyle(d,!1,{visibleAlpha:.01});for(let e in this.objectsToMove){const t=this.objectsToMove[e];let r=t.object.QueryInterface("VCXIModelNavigable");r=r&&r.getParent();let s=!1;for(;r&&!s;){const e=r?.GetObject()?.GetID();e&&this.objectsToMove[e]&&(s=!0),r=r.getParent()}if(!s){const e=(new a.Matrix4).getInverse(o.GetAnchorWorldMatrix(0,d)),r=t.object.QueryInterface("W3AISGNodeHolder"),s=t.object.getParentWorldPosition(),n=t.object.QueryInterface("VCXIModifiable"),l=n&&n.GetProperty("Actor.Position").GetPropertyValue();if(l){t.initialWFrameInRM=(new a.Matrix4).multiplyMatrices(e,(new a.Matrix4).multiplyMatrices(s,l.GetFrame().GetValue())),t.initialWPivotInRM=(new a.Matrix4).multiplyMatrices(e,(new a.Matrix4).multiplyMatrices(s,l.GetPivot().GetValue()));const o=i.getSceneGraphOverride(this._SceneGraphOverrideSet,null,r.getPathElement());o.setOpacity(.5,!0),o.setPickability("IGNORED",!0)}}}const c=this.QueryInterface("W3AISGNodeHolder");if(c){c.getSGNode().switchOff2On()}return this.GetObject()._experienceBase.getManager("VCXCanonicsManager").clear(),!0}reverse(e){const t=this.QueryInterface("VCXIModifiable");if(t){const a=t?.GetProperty("Actor.Anchor.0"),o=a.GetPropertyValue().GetValueFrame()?.GetValue(),s=l.default.getOFromMatrix(o),n=l.default.getVyFromMatrix(o),p=l.default.getVzFromMatrix(o),u=l.default.getMatrixFromOVyVz(s,n,p.negate());let h=t.GetAttachedOccurence(0);h||(h=this.QueryInterface("VCXIModelNavigable")?.getWorkingRoot());var i=h?.QueryInterface("W3AISGNodeHolder"),r=i.getMatrixInWCS(this.GetObject()._experienceBase.getManager("VCXContextManager").getMainViewer(),u);this.move(r,h,e)}}move(e,t,i){const r=this.QueryInterface("VCXIModifiable");if(r){const a=r?.GetProperty("Actor.Anchor.0").Clone();t||(t=this.QueryInterface("VCXIModelNavigable")?.getWorkingRoot());var o=t?.QueryInterface("W3AISGNodeHolder");const s=o.getMatrixInLCS(this.GetObject()._experienceBase.getManager("VCXContextManager").getMainViewer(),e);a.GetPropertyValue().SetValueFrame(new n(s)),a.GetPropertyValue().SetValueLinkFromComponent(t&&t.GetObject()),i.AddOrModifyProperty(r.GetHashing(),a)}for(let t in this.objectsToMove){const r=this.objectsToMove[t];if(r.initialWFrameInRM&&r.initialWPivotInRM){const t=r.object.QueryInterface("VCXIModifiable"),o=(new a.Matrix4).multiplyMatrices(e,r.initialWFrameInRM),s=(new a.Matrix4).multiplyMatrices(e,r.initialWPivotInRM),l=r.object.getParentWorldPosition(),p=(new a.Matrix4).getInverse(l),u=(new a.Matrix4).multiplyMatrices(p,o),h=(new a.Matrix4).multiplyMatrices(p,s),d=t.GetProperty("Actor.Position").Clone(),c=d.GetPropertyValue();c.SetFrame(new n(u)),c.SetPivot(new n(h)),d.SetPropertyValue(c),i.AddOrModifyProperty(t.GetHashing(),d)}}this.setRobot(e)}unlock(e){const t=this.QueryInterface("VCXIModifiable");if(!t)return;i.removeSceneGraphOverrideSet(this._experienceBase,this._SceneGraphOverrideSet),this._SceneGraphOverrideSet=null;const a=this._experienceBase.getManager("VCXContextManager").getMainViewer();this._experienceBase.getManager("VCXSelectionManager").resetOverrideStyle(a,!1);const o=this.QueryInterface("W3AISGNodeHolder");if(o){o.getSGNode().switchOn2Off()}if(!e)return;const s=t.GetProperty("Alignment.Locked").Clone();s.GetPropertyValue().SetValue(!1),e.AddOrModifyProperty(s);const n=t.GetProperty("Actor.LinkedTo").Clone(),l=this._experienceBase.ComponentsMap.GetComponentFromID(n.GetPropertyValue().Value);n.GetPropertyValue().SetValueFromComponent(l),e.AddOrModifyProperty(n),r.attachAnchor(t,0,l,e)}setRobot(e){if(this.objectsToMove){const t=[];for(let e in this.objectsToMove){const i=this.objectsToMove[e];t.push(i.object)}s.publish({event:"VCX_DONT_CHNG_ROBOT_POS_AT_TRANSFORM_BEGIN",data:{targets:t,matrix:e}})}}}return p.prototype.getDefaultName=function(){return"3DAligner"},Object.defineProperty(p.prototype,"componentType",{enumerable:!0,get:function(){return"VCX3DAligner_Spec"}}),p.prototype.dressupGroupName="3DAligner",p})),define("DS/VCXWebDressup/VCXDressupModifiable",["DS/VCXWebExperienceBase/VCXModifiableOccurrenceExperience","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXAnchorServices","DS/VCXWebVisu/VCXModifiablesAccess","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebTracks/VCXInterpolator","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyGroup","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyInfoEnum","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueLocation","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/Visualization/ThreeJS_DS","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],(function(e,t,i,r,a,o,s,n,l,p,u,h,d,c,C,y,m,V,f,b,P,g){"use strict";var _=e.extend({init:function(){this._parent(),this._Properties=[],this._PropertiesFormatPainter=[],this._PropertyGroups=[],this._Anchors={}},Build:function(){this._parent();var e=[{Name:"Actor.Color",Type:c,i18n:P,visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Actor.Color.Defined",Type:h,DefaultValue:!0,i18n:P,visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Actor.Position",Type:C,DefaultValue:(new C).GetValue(),i18n:P,visibleInPropertyGroups:!1},{Name:"Collab.HideIfOutsideAnchorFrustrum",Type:h,DefaultValue:!1},{Name:"Actor.Interpolation.Type",Type:y,DefaultValue:o.EInterpolationType.Linear,i18n:P,MapChoice:this._generateMapChoiceFromEnumAndId(o.EInterpolationType,"Interpolation",["Custom","Smooth"]),visibleInPropertyGroups:!1},{Name:"Actor.IsAlwaysOnTop",Type:h,DefaultValue:!0}];const t=this.QueryInterface("VCXIDressup");if(t){let i=t.anchors().ids;if(!i){i=[];const e=t.anchors().min;if(e>0)for(let t=0;t<e;t++)i.push(t)}i.length>0&&i.forEach((t=>{e.push({Name:"Actor.Anchor."+t,Type:f,DefaultValue:(new f).SetValueFrame((new V).SetValueFromVector(new b.Vector3(0,0,0))).GetValue(),visibleInPropertyGroups:!1})})),(i.length||t.anchors().max)&&e.push({Name:"Collab.ListAnchorsIDs",Type:m,DefaultValue:i,visibleInPropertyGroups:!1,BehaviorType:p.EBehaviorType.NotAnimable})}this._BuildPropertyValues(e)},_BuildPropertyValues:function(e){for(var t=this.QueryInterface("VCXIModifiableView"),i=t&&t.getGroupPropertiesOrders(),r=0;r<e.length;++r){var a=e[r].Name,o=this._Properties[a],s=null,h=null;if(o&&(s=o.GetPropertyInfo(),h=o.GetPropertyValue()),!s){var d=0;void 0!==e[r].BehaviorType&&(d=e[r].BehaviorType);let t=g;void 0!==e[r].i18n&&(t=e[r].i18n);var c=!0;void 0!==e[r].Persistent&&(c=e[r].Persistent),e[r].ControlsGroupAvailability?(s=new u(a,d=2,c,t)).SetMapChoiceEnum(this._generateMapChoiceFromEnumAndId(_.EAvailability,"Group.Availability")):void 0!==e[r].MapChoice?(s=new u(a,d,c,t),void 0!==e[r].MapChoice&&s.SetMapChoiceEnum(e[r].MapChoice)):s=new p(a,d,c,t)}void 0!==e[r].Bounds&&s.SetBounds(e[r].Bounds.Min,e[r].Bounds.Max,e[r].Bounds.Step,e[r].Bounds.Decimals),e[r].UnitType&&s.SetUnitType(e[r].UnitType),e[r].GroupId?s.SetGroupId(e[r].GroupId):s.GetGroupId()?e[r].GroupId=s.GetGroupId():(e[r].GroupId="Group.Essentials",s.SetGroupId(e[r].GroupId));var C=e[r].GroupId;this._PropertyGroups[C]||(this._PropertyGroups[C]=new n({groupID:C})),this._PropertyGroups[C].i18nGroup||("Group.Essentials"===C?this._PropertyGroups[C].i18nGroup=P:t&&(this._PropertyGroups[C].i18nGroup=t.getPropertyGroupsi18n()));var y=e[r].ControlsGroupAvailability||this._PropertyGroups[C].PropertyControlingGroupAvailability===a,m=e[r].ControlsGroupVisibility||this._PropertyGroups[C].PropertyControlingGroupVisibility===a;if(i&&i[C])this._PropertyGroups[C].setPropertiesOrder(i[C]);else{var V=this.ExperienceBase.getManager("VCXContextManager");V&&void 0!==V.getUrlVars().debug&&console.warn("PropertiesOrder missing for "+C+" !! (component "+this.GetObject().GetType()+")")}if(y){var f=e[r].DefaultValue;void 0!==f&&(f===_.EAvailability.AppForceAvailable?this._PropertyGroups[C].availability=!0:f===_.EAvailability.AppForceNotAvailable?this._PropertyGroups[C].availability=!1:this._PropertyGroups[C].availability=void 0),this._PropertyGroups[C].PropertyControlingGroupAvailability=a}if(m){var b=e[r].DefaultValue;void 0!==b&&void 0===this._PropertyGroups[C].availability&&(this._PropertyGroups[C].visibility=b),this._PropertyGroups[C].PropertyControlingGroupVisibility=a,s.SetControlsGroupVisibility(!0)}var M={propertyName:a,i18n:s.Geti18n()};e[r].hiddenFields&&(M.hiddenFields=e[r].hiddenFields);for(var S=Object.keys(this._PropertyGroups),D=0;D<S.length;D++){var G=S[D],x=this._PropertyGroups[G];x.isIn(a)&&(this._PropertyGroups[C].addPropertyFromPropertyGroup(x,a),x.removeProperty(a))}this._PropertyGroups[C].addProperty(M),"boolean"==typeof e[r].visibleInPropertyGroups&&this._PropertyGroups[C].setVisible(a,e[r].visibleInPropertyGroups),!h&&e[r].Type&&(h=new e[r].Type),h?(h&&void 0!==e[r].DefaultValue&&h.SetValue(e[r].DefaultValue),o||(this._Properties[a]=new l(s,h)),void 0!==e[r].DefaultValue&&this.OnChangeProperty(a,h),!o&&e[r].FormatPainter&&this._PropertiesFormatPainter.push(a)):console.warn("No propertyValue found for "+a+".")}this._PropertiesFormatPainter&&this._PropertiesFormatPainter.length&&(this._PropertiesFormatPainter.indexOf("Actor.Hyperlink")<0&&this._PropertiesFormatPainter.push("Actor.Hyperlink"),this._PropertiesFormatPainter.indexOf("Actor.Opacity")<0&&this._PropertiesFormatPainter.push("Actor.Opacity")),this.SetPropertiesInfo(),t&&t.SetPropertiesViewInfo()},SetPropertiesInfo:function(){this.SetPropertyInvisible("Actor.Interpolation.Type",!0),this.SetPropertyInvisible("Actor.Color",!0),this.SetPropertyInvisible("Actor.Color.Defined",!0),this.SetPropertyInvisible("Actor.Opacity.Defined",!0),this.SetPropertyInvisible("Actor.Visibility.Opacity",!0),this.SetPropertyInvisible("Actor.Position",!0),this.SetPropertyInvisible("Collab.HideIfOutsideAnchorFrustrum",!0)},GetPropertyValue:function(e,t){let i;if(t?i=this.GetProperty(e):(i=this._Properties[e],i||(i=this.GetProperty(e))),i){const e=i.GetPropertyValue();if(e)return e.Value}},GetNewProperty:function(e,t){var i=null;if(this._Properties[e]){var r=this._Properties[e].GetPropertyValue().Clone();void 0!==t&&r.SetValue(t),i=new l(this._Properties[e].GetPropertyInfo(),r)}return i},GetNewEnumProperty:function(e,t){if(this._Properties[e]){var i=this._Properties[e].GetPropertyInfo().GetMapChoiceEnum();let r=Object.entries(i).filter((e=>e[0]===t));if(r.length>0)return this.GetNewProperty(e,parseInt(r[0][1]));if(r=Object.entries(i).filter((e=>e[1]===t)),r.length>0)return this.GetNewProperty(e,parseInt(r[0][0]))}return null},GetAttachedOccurence:function(e){var t=this._Anchors&&this._Anchors[e],i=t&&t.GetValueLink().Value;if(i)return this.ExperienceBase.ComponentsMap.GetComponentFromID(i)},GetAttachedOccurences:function(){var e=[];return this.processAnchorsIDs((t=>{var i=this.GetAttachedOccurence(t);i&&e.push(i)})),e},GetComputedStringProperty:function(e,t){var i,a=this.GetProperty(e);if(a&&(i=a.GetPropertyValue().ToString())){var o="",s=this._Anchors[0];return s&&(o=s.GetValueLink().Value),r.ValuateLinkedProperties(i,this.ExperienceBase,o,this.GetObject().GetID(),t)}},getAnchorsCount:function(){var e=0,t=this.GetPropertyValue("Collab.ListAnchorsIDs");return t&&(e+=t.length),(t=this.GetPropertyValue("Collab.List2DAnchorsIDs"))&&(e+=t.length),e},getNewAnchorID:function(){for(var e=this.getAnchorsCount();this._Anchors[e];)++e;return e},GetAnchorValue:function(e){return this._Anchors[e]?this._Anchors[e].GetValueFrame().Value:null},GetAnchorWorldMatrix:function(e,t){var r=this._Anchors[e];return r?i.getWorldMatrix(r,this.GetObject(),t):null},GetFontPropertyValue:function(e){var t=this.GetProperty(e);if(t){var i=t.GetPropertyValue();if(i)return i.GetFont()}return null},GetColorPropertyValue:function(e){var t=this.GetPropertyValue(e+".Color"),i=this.GetPropertyValue(e+".Color.Opacity");void 0===i&&(i=this.GetPropertyValue(e+".Opacity"));var r=new s;return"object"==typeof t&&(r=t.Clone()),void 0===i&&(i=1),"number"==typeof i&&i>=0&&i<=1?r.a=i:console.warn("Opacity range [0.0,1.0]"),r},GetFramePropertyValue:function(e){var t=this.GetProperty(e);return t?t.GetPropertyValue().GetFrame().Value:null},_SetProperty:function(e,t){if(void 0===this._Properties[e]&&t){var i;if("Actor.Anchor."!==e.substring(0,13))return!1;(i=new p(e,0)).SetVisible(!1),i&&(this._Properties[e]=new l(i,t.Clone())),!0}var r=this._Properties[e];if(t){if(!t.IsEqualTo(r.GetPropertyValue()))if(void 0!==r.GetPropertyValue()&&void 0!==t){r.SetPropertyValue(t.Clone()),!0;var a=r.GetPropertyInfo().GetGroupId(),o=this._PropertyGroups[a];if(o&&e===o.PropertyControlingGroupVisibility&&void 0===this._PropertyGroups[a].availability&&(this._PropertyGroups[a].visibility=t.GetValue()),o&&e===o.PropertyControlingGroupAvailability){var s=t.GetValue();s===_.EAvailability.AppForceAvailable?this._PropertyGroups[a].availability=!0:s===_.EAvailability.AppForceNotAvailable?this._PropertyGroups[a].availability=!1:this._PropertyGroups[a].availability=void 0}}else console.warn("WTF !!!")}else!0,delete this._Properties[e];if("Actor.Anchor."===e.substring(0,13)){var n=e.substring(13,30);if(t){if(!t.IsEqualTo(this._Anchors[n])){!0;var u=null;this._Anchors[n]&&(u=this._Anchors[n].is2DAnchor),this._Anchors[n]=t.Clone(),null!==u&&(this._Anchors[n].is2DAnchor=u)}}else{!0,delete this._Anchors[n];var h=this.GetPropertyValue("Collab.ListAnchorsIDs"),d=h.indexOf(n);if(d>=0){h.splice(d,1);var c=new m(h);this.OnChangeProperty("Collab.ListAnchorsIDs",c)}}}if("Actor.Name"===e){var C=t.Value,y=this.QueryInterface("W3AISGNodeHolder");if(y){var V=y.giveSGNode();V&&V.setName(C)}}return!0},OnChangeProperty:function(e,t,i){if(i||(i={}),i.fromChildClass);else if(this.OnChangePropertyBegin(e,t))return!0;if("Collab.ListAnchorsIDs"!==e&&"Collab.List2DAnchorsIDs"!==e||(this._needToUpdateAnchors=!0),!this._SetProperty(e,t)){var r=!1;if(!r&&(i.fromChildClass=!0,r=this._parent(e,t,i))){var a=this.QueryInterface("W3AISGNodeHolder");a&&a.setSGNodeDirty(!0)}return r||console.warn("Unknown property on "+this.GetPropertyValue("Actor.Name")+" : "+e),r}return!0},OnChangePropertiesEnd:function(){this._needToUpdateAnchors&&(this.updateAnchorsType(),this._needToUpdateAnchors=!1),this._parent(),this.GetObject().setDirty&&this.GetObject().setDirty()},GetProperty:function(e){var t=null,i=this._Properties[e];if(i)t=new l(i.GetPropertyInfo(),i.GetPropertyValue().Clone());else{var r="._ComputedText";if(e.endsWith(r)){var a=e.substring(0,e.length-14),o=this.GetComputedStringProperty(a),s=new d(o),n=new p(a,1,!1);t=new l(n,s)}t||(t=this._parent(e))}return t},GetProperties:function(e){this.SetPropertiesInfo();var t=this._parent();this._Anchors&&Object.keys(this._Anchors).length>0&&this.processAnchorsIDs((e=>{t.AddOrModifyProperty(this.GetProperty("Actor.Anchor."+e))}));for(const e in this._Properties)if(this._Properties.hasOwnProperty(e)){var i=!0,r=!0,a=this._Properties[e].GetPropertyInfo(),o=a.GetGroupId();if(o){var s=this._PropertyGroups[o];if(s){var n=s.PropertyControlingGroupAvailability&&e===s.PropertyControlingGroupAvailability,l=s.PropertyControlingGroupVisibility&&e===s.PropertyControlingGroupVisibility;!1!==s.availability||n||(i=!1),i&&(l?!0===s.availability&&(r=!1):!1===s.visibility&&(r=!1))}}a.IsVisible()!==(r&&!this._Properties[e].Invisible)&&a.SetVisible(r&&!this._Properties[e].Invisible),i&&t.AddOrModifyProperty(this.GetProperty(e))}return t},getPropertiesFormatPainter:function(){return this._PropertiesFormatPainter},getPropertiesToBePasted:function(e){let t=e.Clone();if(e&&e._map){var i=this.ExperienceBase.getManager("VCXExperience");for(let a in e._map)if(e._map.hasOwnProperty(a)){let o=e.GetProperty(a);if(o){if("Actor.Name"==a)o=o.Clone(),o.GetPropertyValue().SetValue(o.GetPropertyValue().GetValue()+" - Copy ("+i._ccp_number+")");else if("Collab.3D.Paper.Paper.Position.X"==a)o.GetPropertyValue().SetValue(o.GetPropertyValue().GetValue()+5);else if("Collab.3D.Paper.Paper.Position.Y"==a)o.GetPropertyValue().SetValue(o.GetPropertyValue().GetValue()+5);else if("Collab.MagnetLine.Position.A.X"==a||"Collab.MagnetLine.Position.A.Y"==a||"Collab.MagnetLine.Position.B.X"==a||"Collab.MagnetLine.Position.B.Y"==a)o.GetPropertyValue().SetValue(o.GetPropertyValue().GetValue()+5);else if("Actor.Anchor.0"==a){var r=o.GetPropertyValue().GetValueFrame().GetValue();r.elements[12]+=10,r.elements[13]+=10}t.AddOrModifyProperty(o)}}return t}},getPropertyGroups:function(e){var t=this.QueryInterface("VCXIModifiableView");if(t)return t.getPropertyGroups(e)},GetPropertyGroupVisibility:function(e){var t=this.QueryInterface("VCXIModifiableView");return!t||t.GetPropertyGroupVisibility(e)},SetPropertyInvisible:function(e,t){var i=this.QueryInterface("VCXIModifiableView");i&&i.SetPropertyInvisible(e,t)},ChangeGroupAvailability:function(e,t){var i=this.QueryInterface("VCXIModifiableView");i&&i.ChangeGroupAvailability(e,t)},changeMapChoice:function(e,t){this._Properties[e]&&this._Properties[e].GetPropertyInfo().SetMapChoiceEnum(t)},Dispose:function(){},processAnchorsIDs:function(e,t){var i,r=[];t&&t.no3DAnchors||(i=this.GetPropertyValue("Collab.ListAnchorsIDs"))&&(r=r.concat(i));t&&t.no2DAnchors||(i=this.GetPropertyValue("Collab.List2DAnchorsIDs"))&&(r=r.concat(i));if(t&&t.sort&&r.sort(),Array.isArray(r)&&r.length>0)for(var a=0;a<r.length;++a){var o=r[a];if(!1===e(o,this._Anchors&&this._Anchors[o]))return}},updateAnchorsType:function(){var e=this.GetPropertyValue("Collab.ListAnchorsIDs");if(Array.isArray(e)&&e.length>0)for(var t=0;t<e.length;++t){var i=e[t];this._Anchors[i]?this._Anchors[i].is2DAnchor=!1:console.warn("Can't find refered anchor:"+i)}if(e=this.GetPropertyValue("Collab.List2DAnchorsIDs"),Array.isArray(e)&&e.length>0)for(t=0;t<e.length;++t){i=e[t];this._Anchors[i]?this._Anchors[i].is2DAnchor=!0:console.warn("Can't find refered anchor:"+i)}},getPositionOfFirstAnchor:function(){var e=this.GetPropertyValue("Collab.ListAnchorsIDs")[0],t=this.GetAnchorWorldMatrix(e);return(new b.Vector3).getPositionFromMatrix(t)},getPositionOfLastAnchor:function(){var e=this.GetPropertyValue("Collab.ListAnchorsIDs"),t=e[e.length-1],i=this.GetAnchorWorldMatrix(t);return(new b.Vector3).getPositionFromMatrix(i)},getLineMaterialParams:function(e,i,r,a){"number"!=typeof a&&(a=1);var o={},s=this.GetPropertyValue(e+".Type"),n=this.GetPropertyValue(e+".Width"),l=this.GetColorPropertyValue(e),p=l.GetThreeColor(),u=l.a,h=this.GetProperty(e+".2.Color");if(!i||r!==s)if(s===t.ELineType.UserDefined){var d=this.GetPropertyValue(e+".StipplingMotif");if(d){var c=d.split(" ");o.dashPattern=c.map((function(e){return 4*parseInt(e)}))}}else o.type=s;if(i&&i.lineWidth===n&&(1!==i.lineWidth||i.visible)||(o.lineWidth=n),h)i&&i.vertexColors===b.VertexColors||(o.vertexColors=b.VertexColors),i&&i.opacity===a||(o.opacity=a);else{i&&i.color.equals(p)||(o.color=p);var C=u*a;i&&i.opacity===C||(o.opacity=C)}return o},GetViewpointVisibility:function(e){if(this.GetOpacity(e)){const i=this.GetObject()._experienceBase,r=i.getManager("VCXVisuManager"),a=i.getManager("VCXIVManager");if(!r.areAllAnchorsReadyAndVisible(e,this)||!(r.isInFrustum(e,this)||a&&a.scenario))return!1;var t=i.getManager("VCXSectionManager");if(t)return!t.isCut(this,e)}return!0},GetOpacity:function(e){var t=this.GetPropertyValue("Actor.Opacity");if((t*=this.GetPropertyValue("Actor.Visibility.Opacity"))>0){var i=this.QueryInterface("VCXIVisibility");i&&i.GetVisibility()===a.EVisState.Hidden&&(t=0),e&&t>0&&!this.GetObject()._experienceBase.getManager("VCXVisuManager").areAllAnchorsReadyAndVisible(e,this)&&(t=0)}return t},getFormatPainterCompatibilityClass:function(){return this.GetObject().componentType}});return _.EAvailability={NoControl:0,AppForceAvailable:1,AppForceNotAvailable:2,AppNotVisible:3},Object.defineProperty(_.prototype,"ExperienceBase",{enumerable:!0,get:function(){return this.GetObject()._experienceBase}}),_})),define("DS/VCXWebDressup/VCXMagnetLineOrientationModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueMap","DS/VCXWebProperties/VCXPropertyValueVector"],(function(e,t,i,r,a,o,s,n){"use strict";return e.extend({init:function(){this._bIs3DAligner=!0,this._parent()},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Actor.Color",!0),this.SetPropertyInvisible("Actor.Opacity",!0),this.SetPropertyInvisible("Actor.IsAlwaysOnTop",!0)}})})),define("DS/VCXWebDressup/VCXRedLine/VCXRedLineModifiable",["DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueMap"],(function(e,t,i,r,a,o,s,n){"use strict";return t.extend({init:function(){this._parent()},Build:function(){this._parent();var e=[{Name:"Actor.Color",DefaultValue:(new i).FromRGBA(1,0,0,1),GroupId:"Group.Line",FormatPainter:!0},{Name:"Actor.Opacity",DefaultValue:1,GroupId:"Group.Line",FormatPainter:!0},{Name:"Collab.Body.Line.Width",Type:r,DefaultValue:2,GroupId:"Group.Line",FormatPainter:!0},{Name:"Collab.VertexBuffers",Type:n,BehaviorType:2,DefaultValue:new n}];this._BuildPropertyValues(e)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Actor.Color",!1),this.SetPropertyInvisible("Collab.VertexBuffers",!0),this.SetPropertyInvisible("Actor.Color",!1),this.SetPropertyInvisible("Actor.Anchor.0",!0)}})})),define("DS/VCXWebDressup/VCXMagnetLine/VCXMagnetLineModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXColor","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables"],(function(e,t,i,r,a,o,s,n,l,p,u,h){"use strict";return e.extend({init:function(){this._bIsMagnetLine=!0,this.arrayModifiableRatioPos=[],this._stopUpdate=!1,this._parent()},Build:function(){this._stopUpdate=!0,this._parent();var e=[{Name:"Actor.Color",DefaultValue:(new i).FromRGBA(0,0,0,1),Type:l,visibleInPropertyGroups:!0,FormatPainter:!0},{Name:"Actor.Opacity",DefaultValue:1,visibleInPropertyGroups:!1},{Name:"MagnetLine.Length",Type:n,DefaultValue:0,GroupId:"Group.Position"},{Name:"MagnetLine.Rotation",Type:n,DefaultValue:0,Persistent:!1,GroupId:"Group.Position"},{Name:"MagnetLine.Curvature",Type:n,DefaultValue:0,Bounds:{Min:-1,Max:1,Step:.1},GroupId:"Group.Position"},{Name:"MagnetLine.Magnetic",Type:s,DefaultValue:!0},{Name:"Collab.3D.Paper.Paper.Position.X",Type:n,DefaultValue:10,Persistent:!1},{Name:"Collab.3D.Paper.Paper.Position.Y",Type:n,DefaultValue:50,Persistent:!1},{Name:"Collab.MagnetLine.Position.A.X",Type:n,DefaultValue:0},{Name:"Collab.MagnetLine.Position.A.Y",Type:n,DefaultValue:-50},{Name:"Collab.MagnetLine.Position.B.X",Type:n,DefaultValue:0},{Name:"Collab.MagnetLine.Position.B.Y",Type:n,DefaultValue:50},{Name:"MagnetLine.Spacing",Type:p,DefaultValue:u.EMLSpacing.Uniform,MapChoice:this._generateMapChoiceFromEnumAndId(u.EMLSpacing,"MagnetLine.Spacing")}];this._BuildPropertyValues(e),this._stopUpdate=!1},SetPropertiesInfo:function(){this.SetPropertyInvisible("Collab.MagnetLine.Position.A.X",!0),this.SetPropertyInvisible("Collab.MagnetLine.Position.A.Y",!0),this.SetPropertyInvisible("Collab.MagnetLine.Position.B.X",!0),this.SetPropertyInvisible("Collab.MagnetLine.Position.B.Y",!0),this.SetPropertyInvisible("Collab.3D.Paper.Paper.Position.X",!0),this.SetPropertyInvisible("Collab.3D.Paper.Paper.Position.Y",!0),this.SetPropertyInvisible("Actor.IsAlwaysOnTop",!0),this.SetPropertyInvisible("Collab.HideIfOutsideAnchorFrustrum",!0),this.SetPropertyInvisible("Collab.MagnetLine.Position.A.X",!0),this.SetPropertyInvisible("Actor.Hyperlink",!0)},GetProperty:function(e){if("MagnetLine.Rotation"===e){var t=this.GetProperty("Collab.MagnetLine.Position.A.X").GetPropertyValue().GetValue(),i=this.GetProperty("Collab.MagnetLine.Position.A.Y").GetPropertyValue().GetValue(),s=this.GetProperty("Collab.MagnetLine.Position.B.X").GetPropertyValue().GetValue(),l=this.GetProperty("Collab.MagnetLine.Position.B.Y").GetPropertyValue().GetValue(),p=new r.Vector2(t,i),u=new r.Vector2(s,l);const a=new r.Vector2(u.x-p.x,u.y-p.y),o=new r.Vector2(1,0);var d=o.x*a.x+o.y*a.y,c=Math.sqrt(o.x*o.x+o.y*o.y),C=Math.sqrt(a.x*a.x+a.y*a.y);const n=Math.acos(d/(c*C))*(180/Math.PI);return this.GetNewProperty(e,n)}if("MagnetLine.Length"===e){t=this.GetProperty("Collab.MagnetLine.Position.A.X").GetPropertyValue().GetValue(),i=this.GetProperty("Collab.MagnetLine.Position.A.Y").GetPropertyValue().GetValue(),s=this.GetProperty("Collab.MagnetLine.Position.B.X").GetPropertyValue().GetValue(),l=this.GetProperty("Collab.MagnetLine.Position.B.Y").GetPropertyValue().GetValue(),p=new r.Vector2(t,i),u=new r.Vector2(s,l);return this.GetNewProperty(e,p.distanceTo(u))}if("MagnetLine.Curvature"===e){var y=new n;y.SetValue(this.GetObject().GetCurvature());var m=new o(e,0,!0,h);m.SetBounds(-1,1,.1),m.SetGroupId("Group.Position");new a(m,y)}return this._parent(e)},OnChangeProperty:function(e,t,i){if(this._stopUpdate)this._parent(e,t,i);else{if("MagnetLine.Magnetic"==e)t.GetValue();else if("MagnetLine.Length"==e)this.GetObject().updateAttachedPosition();else if("MagnetLine.Rotation"==e)this.GetObject().updateAttachedPosition();else if("MagnetLine.Curvature"==e)this.GetObject().SetCurvature(t.GetValue()),this.GetObject().updateAttachedPosition();else if("MagnetLine.Spacing"==e){if(t.GetValue()===u.EMLSpacing.Custom){this.arrayModifiableRatioPos.splice(0,this.arrayModifiableRatioPos.lenght),this.arrayModifiableRatioPos.lenght=0,this.arrayModifiableRatioPos=[];for(var r=0;r<this.GetObject().arrayModifiableAttached.length;r++){var a=this.GetObject().arrayModifiableAttached[r],o=this.GetObject().getProportionalPosition(a);this.arrayModifiableRatioPos.push(o)}}else this.GetObject().updateAttachedPosition()}this._parent(e,t,i)}},RequestModification:function(e,t){var i=this.GetProperty("Collab.MagnetLine.Position.A.X").GetPropertyValue().GetValue(),a=this.GetProperty("Collab.MagnetLine.Position.A.Y").GetPropertyValue().GetValue(),o=this.GetProperty("Collab.MagnetLine.Position.B.X").GetPropertyValue().GetValue(),s=this.GetProperty("Collab.MagnetLine.Position.B.Y").GetPropertyValue().GetValue(),n=new r.Vector2(i,a),l=new r.Vector2(o,s),p=new r.Vector2(o-i,s-a);if("MagnetLine.Length"===e.GetPropertyInfo().GetPropertyName()){var u=e.GetPropertyValue().GetValue();p.normalize(),p.multiplyScalar(u);var h=n.x+p.x,d=n.y+p.y;return t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.MagnetLine.Position.B.X",h)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.MagnetLine.Position.B.Y",d)),t.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,t)}if("MagnetLine.Rotation"===e.GetPropertyInfo().GetPropertyName()){var c=(l.x+n.x)/2,C=(l.y+n.y)/2,y=new r.Vector2(c,C),m=n.distanceTo(l)/2;const i=e.GetPropertyValue().GetValue()*(Math.PI/180),a=new r.Vector2(1,0),o=a.x*Math.cos(i)-a.y*Math.sin(i),s=a.x*Math.sin(i)+a.y*Math.cos(i);var V=new r.Vector2(o,s);V.normalize();var f=new r.Vector2(V.x,V.y);V.multiplyScalar(m),f.multiplyScalar(-1*m);var b=new r.Vector2(y.x,y.y);b.add(V);var P=new r.Vector2(y.x,y.y);return P.add(f),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.MagnetLine.Position.A.X",P.x)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.MagnetLine.Position.A.Y",P.y)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.MagnetLine.Position.B.X",b.x)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.MagnetLine.Position.B.Y",b.y)),t.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,t)}return this._parent(e,t)}})})),define("DS/VCXWebDressup/VCXViewpoint/VCXCameraModifiable",["DS/Visualization/ThreeJS_DS","DS/VCXWebVisualization/VCXIViewpointController","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXProperty"],(function(e,t,i,r,a,o,s,n,l,p){"use strict";return i.extend({init:function(){this._parent(),this._bIsCamera=!0},Build:function(){this._parent();var i=[{Name:"Camera.Position",Type:a,DefaultValue:new e.Matrix4,Persistent:!1,visibleInPropertyGroups:!1},{Name:"Actor.IsActive",Type:s,DefaultValue:!1,Persistent:!1,BehaviorType:1},{Name:"Camera.Angle",Type:n,DefaultValue:45,GroupId:"Group.Camera"},{Name:"Camera.Height",Type:n,DefaultValue:400,GroupId:"Group.Camera"},{Name:"Camera.Ortho",Type:s,DefaultValue:!1,GroupId:"Group.Camera"},{Name:"Camera.Arcball",Type:s,DefaultValue:!0,GroupId:"Group.Camera"},{Name:"Camera.Pitch",Type:s,DefaultValue:!0,GroupId:"Group.Camera"},{Name:"Camera.Roll",Type:s,DefaultValue:!0,GroupId:"Group.Camera"},{Name:"Camera.Roll.Angle",Type:n,DefaultValue:0,GroupId:"Group.Camera",Bounds:{Min:-180,Max:180,Step:1}},{Name:"Camera.Yaw",Type:s,DefaultValue:!0,GroupId:"Group.Camera"},{Name:"Camera.LockDistCOI",Type:s,DefaultValue:!1,GroupId:"Group.Camera"},{Name:"Camera.DistCOI",Type:n,DefaultValue:500,GroupId:"Group.Camera"},{Name:"Camera.DOF.Actif",Type:s,DefaultValue:!1,ControlsGroupVisibility:!0,Persistent:!0,GroupId:"Group.Camera.DOF"},{Name:"Camera.DOF.Type",Type:o,DefaultValue:t.EDOFType.Follow,GroupId:"Group.Camera.DOF",Persistent:!0,MapChoice:this._generateMapChoiceFromEnumAndId(t.EDOFType,"Camera.DOF.Type")},{Name:"Camera.DOF.Distance",Type:n,DefaultValue:100,GroupId:"Group.Camera.DOF",Persistent:!0},{Name:"Camera.DOF.Blur",Type:n,DefaultValue:50,GroupId:"Group.Camera.DOF",Persistent:!0,Bounds:{Min:0,Max:100,Step:1}},{Name:"Camera.DOF.FocusPlane.Visible",Type:s,DefaultValue:!0,GroupId:"Group.Camera.DOF",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.DOF.FocusPlane.Opacity",Type:n,DefaultValue:.5,GroupId:"Group.Camera.DOF",Bounds:{Min:0,Max:1,Step:.1},Persistent:!1,visibleInPropertyGroups:!1},{Name:"Collab.Gizmo.Show",Type:s,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Collab.Gizmo"},{Name:"Collab.Gizmo.Line.Color",Type:l,DefaultValue:(new r).FromRGBA(1,1,1,1),GroupId:"Group.Collab.Gizmo"},{Name:"Collab.Gizmo.Line.Color.Opacity",Type:n,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Collab.Gizmo"},{Name:"Collab.Gizmo.Line.Width",Type:n,DefaultValue:1,GroupId:"Group.Collab.Gizmo"}];this._BuildPropertyValues(i)},GetVirtualProperties:function(){var e={"Camera.Position":!0,"Camera.DOF.Distance":!0};return e},GetRequiredPropertiesForTransition:function(){var e={"Camera.Position":!0,"Actor.Anchor.1":!0,"Actor.Anchor.2":!0,"Camera.Angle":!0,"Camera.Height":!0,"Camera.Ortho":!0,"Camera.Arcball":!0,"Camera.Pitch":!0,"Camera.Roll":!0,"Camera.Roll.Angle":!0,"Camera.Yaw":!0,"Camera.LockDistCOI":!0,"Camera.DistCOI":!0,"Camera.DOF.Distance":!0,"Camera.DOF.Blur":!0,"Actor.Anchor.10":!0};return e},GetProperty:function(e){if("Actor.IsActive"===e){var t=null;if(void 0!==this._Properties[e]){var i=this._Properties[e].GetPropertyValue().Clone(),r=this.ExperienceBase.getManager("VCXContextManager").getActiveCamera();i.SetValue(r.GetID()===this.GetObject().GetID()),t=new p(this._Properties[e].GetPropertyInfo(),i)}return t}return this._parent(e)},OnChangeProperty:function(e,t,i){if(i||(i={}),i.fromChildClass);else if(this.OnChangePropertyBegin(e,t))return!0;this._parent(e,t,i);this.ExperienceBase.getManager("VCXVisuManager");"Actor.IsActive"===e&&!0===t.Value&&this.ExperienceBase.getManager("VCXContextManager").setActiveCamera(this.GetObject())},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Collab.ListAnchorsIDs",!0),this.SetPropertyInvisible("Camera.Position",!0),this.SetPropertyInvisible("Actor.Interpolation.Type",!1),this.SetPropertyInvisible("Camera.Angle",this.GetPropertyValue("Camera.Ortho")),this.SetPropertyInvisible("Camera.Height",!this.GetPropertyValue("Camera.Ortho")),this.SetPropertyInvisible("Camera.Pitch",this.GetPropertyValue("Camera.Arcball")),this.SetPropertyInvisible("Camera.Roll",this.GetPropertyValue("Camera.Arcball")),this.SetPropertyInvisible("Camera.Yaw",this.GetPropertyValue("Camera.Arcball")),this.SetPropertyInvisible("Camera.LockDistCOI",this.GetPropertyValue("Camera.Arcball")),this.SetPropertyInvisible("Camera.DistCOI",this.GetPropertyValue("Camera.Arcball")||!this.GetPropertyValue("Camera.LockDistCOI")),this.SetPropertyInvisible("Camera.Roll.Angle",this.GetPropertyValue("Camera.Arcball")||this.GetPropertyValue("Camera.Roll"))},OnChangePropertiesEnd:function(){this._parent(),this.GetObject().updatePosition()},GetInterpolator:function(e){var t=this.QueryInterface("VCXIViewpointController");if(t)return t.GetInterpolator(e)}})})),define("DS/VCXWebDressup/VCXSection/VCXSectionModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueMap","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueLocation","DS/VCXWebProperties/VCXPropertySet"],(function(e,t,i,r,a,o,s,n,l,p,u,h,d,c){"use strict";return e.extend({init:function(){this._parent(),this._bIsSection=!0},Build:function(){this._parent();var e=[{Name:"Actor.Color",DefaultValue:(new r).FromRGBA(0,.337,.525,1),GroupId:"Group.Section.Plane"},{Name:"Actor.Opacity",DefaultValue:.075,GroupId:"Group.Section.Plane"},{Name:"Actor.IsAlwaysOnTop",DefaultValue:!1,GroupId:"Group.Section.Plane"},{Name:"Section.Plane.Enable",Type:a,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Section.Plane"},{Name:"Section.Origin.Position",Type:d,DefaultValue:(new d).GetValue(),visibleInPropertyGroups:!1,GroupId:"Group.Section"},{Name:"Section.Enable",Type:a,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Section"},{Name:"Section.AutoFlip",Type:a,DefaultValue:!1,GroupId:"Group.Section"},{Name:"Section.SpaceBackAlpha",Type:s,DefaultValue:1,GroupId:"Group.Section",Bounds:{Min:0,Max:1,Step:1},visibleInPropertyGroups:!1},{Name:"Section.SpaceFrontAlpha",Type:s,DefaultValue:0,GroupId:"Group.Section",Bounds:{Min:0,Max:1,Step:1},visibleInPropertyGroups:!1},{Name:"Actor.ListActors",Type:u,GroupId:"Group.Section",visibleInPropertyGroups:!1},{Name:"Section.ComposerSMG",Type:a,DefaultValue:!1,GroupId:"Group.Section",visibleInPropertyGroups:!1},{Name:"Section.Capping",Type:a,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Section.Capping"},{Name:"Section.Capping.Color",Type:l,DefaultValue:(new r).FromRGBA(.0706,.7451,.9804,1),GroupId:"Group.Section.Capping"},{Name:"Section.Capping.ActorColor",Type:a,DefaultValue:!0,GroupId:"Group.Section.Capping"},{Name:"Section.Hatching.Color",Type:l,DefaultValue:(new r).FromRGBA(0,0,0,1),GroupId:"Group.Section.Hatching"},{Name:"Section.Hatching.Frequency",Type:o,DefaultValue:80,GroupId:"Group.Section.Hatching",Bounds:{Min:0,Max:300,Step:1}},{Name:"Section.Hatching.Angle",Type:s,DefaultValue:0,GroupId:"Group.Section.Hatching",Bounds:{Min:-90,Max:90,Step:1}}];this._BuildPropertyValues(e)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Actor.Color",!1),this.ChangeGroupAvailability("Group.Section.Hatching",this.GetPropertyValue("Section.Capping")?e.EAvailability.AppForceAvailable:e.EAvailability.AppForceNotAvailable)},getPropertiesFormatPainter:function(){console.log("Test section format painter");let e=[];return e.push("Actor.Color"),e.push("Actor.Opacity"),e.push("Actor.IsAlwaysOnTop"),e.push("Section.Capping"),e.push("Section.Capping.Color"),e.push("Section.Capping.ActorColor"),e.push("Section.Hatching.Color"),e.push("Section.Hatching.Frequency"),e.push("Section.Hatching.Angle"),e}})})),define("DS/VCXWebDressup/VCXCompass/VCXCompassModifiable",["DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertyValuePoint2D","DS/VCXWebProperties/VCXPropertyValueDocId","DS/VCXWebProperties/VCXPropertyValueFrame","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables"],(function(e,t,i,r,a,o,s,n,l,p,u,h){"use strict";return t.extend({init:function(){this._parent()},Build:function(){this._parent();var t=this.GetProperties();if(t)for(var i in t._map){var l=this.GetProperty(i);l&&l.GetPropertyInfo()&&l.GetPropertyInfo().SetVisible(!1)}var d=[{Name:"Actor.Name",Type:r,DefaultValue:"Compass",i18n:h},{Name:"Actor.Visibility.Opacity",Type:s,DefaultValue:1,i18n:h},{Name:"Compass.GeomPath",Type:p,DefaultValue:-1,GroupId:"Group.Compass.General",BehaviorType:1},{Name:"Compass.AbsoluteSize",Type:a,DefaultValue:!1,GroupId:"Group.Compass.Size",BehaviorType:1},{Name:"Compass.Size",Type:s,DefaultValue:.1,Bounds:{Min:0,Max:1,Step:.1},GroupId:"Group.Compass.Size",BehaviorType:1},{Name:"Compass.SizePixel",Type:o,DefaultValue:300,GroupId:"Group.Compass.Size",BehaviorType:1},{Name:"Compass.Translation",Type:n,DefaultValue:new e.Vector3(0,0,0),BehaviorType:1},{Name:"Compass.Alignment",Type:u,DefaultValue:new e.Matrix4,BehaviorType:1}];if(void 0!==this.GetObject()._experienceBase.odt){var c={Name:"Compass.ODT.CustomRobotState",Type:a,DefaultValue:!1,GroupId:"Group.Compass.General",BehaviorType:1},C={Name:"Compass.ODT.CustomRobotGeomNodesNumber",Type:o,DefaultValue:0,GroupId:"Group.Compass.General",BehaviorType:1};d.push(c),d.push(C)}this._BuildPropertyValues(d),this.GetProperty("Compass.Translation").GetPropertyInfo().SetVisible(!1),this.GetProperty("Compass.Alignment").GetPropertyInfo().SetVisible(!1)},GetProperty:function(e){if(void 0!==this.GetObject()._experienceBase.odt){var t=null,r=this._Properties[e],s=this.ExperienceBase.getManager("VCXContextManager").getMainViewer().getCustomReferenceAxisSystem();switch(e){case"Compass.ODT.CustomRobotState":var n=new a;n.SetValue(null!==s),t=new i(r.GetPropertyInfo(),n);break;case"Compass.ODT.CustomRobotGeomNodesNumber":var l=new o;if(l.SetValue(0),t=new i(r.GetPropertyInfo(),l),s){var p=s.node,u=p&&p.children?p.children[0]:null;l.SetValue(u&&u.children?u.children.length:0)}}if(t)return t}return this._parent(e)}})})),define("DS/VCXWebDressup/VCX3DGrid/VCX3DGridModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueLocation"],(function(e,t,i,r,a,o,s,n,l,p,u){"use strict";return e.extend({init:function(){this._parent()},Build:function(){this._parent();const e=[{Name:"3DGrid.Origin.Position",Type:u,DefaultValue:(new u).GetValue(),visibleInPropertyGroups:!0,GroupId:"3DGrid.Origin"},{Name:"3DGrid.Origin.Local.Position",Type:u,DefaultValue:(new u).GetValue(),visibleInPropertyGroups:!1,GroupId:"3DGrid.Origin"},{Name:"3DGrid.Default.Orientation",Type:n,DefaultValue:"None",visibleInPropertyGroups:!1,GroupId:"3DGrid.Origin"},{Name:"3DGrid.Origin.Show",Type:r,DefaultValue:!0,visibleInPropertyGroups:!0,GroupId:"3DGrid.Origin"},{Name:"Actor.Opacity",DefaultValue:.075},{Name:"Actor.Color",DefaultValue:(new i).FromRGBA(.2,.2,0,1)},{Name:"Actor.IsAlwaysOnTop",DefaultValue:!0},{Name:"3DGrid.Active",DefaultValue:!0,Type:r,visibleInPropertyGroups:!0},{Name:"3DGrid.CellSize",DefaultValue:1},{Name:"3DGrid.Plane.Enable",Type:r,DefaultValue:!0,visibleInPropertyGroups:!1},{Name:"3DGrid.DepthZoom",Type:o,DefaultValue:0,visibleInPropertyGroups:!1,Bounds:{Min:0,Max:30,Step:.01}},{Name:"3DGrid.Texture.RepeatFactor.X",Type:o,DefaultValue:0,visibleInPropertyGroups:!1},{Name:"3DGrid.Texture.RepeatFactor.Y",Type:o,DefaultValue:0,visibleInPropertyGroups:!1},{Name:"3DGrid.Corner.Top.Left",Type:a,DefaultValue:new t.Vector3,visibleInPropertyGroups:!1},{Name:"3DGrid.Corner.Bottom.Left",Type:a,DefaultValue:new t.Vector3,visibleInPropertyGroups:!1},{Name:"3DGrid.Corner.Top.Right",Type:a,DefaultValue:new t.Vector3,visibleInPropertyGroups:!1},{Name:"3DGrid.Corner.Bottom.Right",Type:a,DefaultValue:new t.Vector3,visibleInPropertyGroups:!1},{Name:"3DGrid.Position.Min",Type:a,DefaultValue:new t.Vector3,visibleInPropertyGroups:!1},{Name:"3DGrid.Position.Max",Type:a,DefaultValue:new t.Vector3,visibleInPropertyGroups:!1},{Name:"3DGrid.Vector.X",Type:a,DefaultValue:new t.Vector3,visibleInPropertyGroups:!1},{Name:"3DGrid.Vector.Y",Type:a,DefaultValue:new t.Vector3,visibleInPropertyGroups:!1},{Name:"3DGrid.Width",Type:o,DefaultValue:0,GroupId:"3DGrid.Group.Size",visibleInPropertyGroups:!0},{Name:"3DGrid.Height",Type:o,DefaultValue:0,GroupId:"3DGrid.Group.Size",visibleInPropertyGroups:!0},{Name:"3DGrid.Snapped.Dressups",Type:p,DefaultValue:[],visibleInPropertyGroups:!1}];this._BuildPropertyValues(e),this.SetPropertyInvisible("Actor.Position",!0)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Actor.Color",!1),this.SetPropertyInvisible("Actor.Position",!0)},getPropertiesFormatPainter:function(){console.log("Test 3DGrid format painter");let e=[];return e.push("Actor.Color"),e.push("Actor.Opacity"),e.push("Actor.IsAlwaysOnTop"),e},getPropertiesToBePasted:function(e){let t=e.Clone();if(e&&e._map){var i=this.ExperienceBase.getManager("VCXExperience");for(let r in e._map)if(e._map.hasOwnProperty(r)){let a=e.GetProperty(r);if(a){if("Actor.Name"==r)a=a.Clone(),a.GetPropertyValue().SetValue(a.GetPropertyValue().GetValue()+" - Copy ("+i._ccp_number+")");else if("Actor.Color"===r){const e=this.ExperienceBase.getManager("VCX3DGridManager");let t=a.GetPropertyValue().GetValue();e&&(t=e.getCurrentColor()),a=a.Clone(),a.GetPropertyValue().SetValue(t)}t.AddOrModifyProperty(a)}}return t}}})})),define("DS/VCXWebDressup/VCXRenderingFeatureModelModifiable",["DS/VCXWebDressup/VCXDressupModifiable"],(function(e){"use strict";return e.extend({init:function(){this._parent(),this._bIsGround=!0,this._envMapNeverLoaded=!1},Build:function(){this._parent();let e=this.QueryInterface("CATI3DExpVCXObjectConvertor").getTab();var t=[];e.forEach((e=>{let i={Name:e.propertyName,Type:e.typeProperty,GroupId:"Group.Material",FormatPainter:!0};t.push(i)})),this._BuildPropertyValues(t)},OnChangePropertiesEnd:function(){this._object.QueryInterface("CATI3DExperienceObject").GetParent().dirty=!0,this._parent()},SetPropertiesInfo:function(){this._parent(),this.ChangeGroupAvailability("Group.Actions",e.EAvailability.AppForceNotAvailable)},RequestModification:function(e,t){if(e)e.GetPropertyInfo().GetPropertyName();return this._parent(e,t)}})})),define("DS/VCXWebDressup/VCXCoveringMaterial/VCXCoveringMaterialSpecModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueLink"],(function(e,t,i){"use strict";return e.extend({init:function(){this._parent(),this._bIsGround=!0,this._envMapNeverLoaded=!1},Build:function(){this._parent();var e=[{Name:"ContextualMaterial.Activation",Type:t,DefaultValue:!1,FormatPainter:!0},{Name:"ContextualMaterial.Delegation",Type:i,FormatPainter:!0}];this._BuildPropertyValues(e)},OnChangePropertiesEnd:function(){this._object.dirty=!0,this._parent()}})})),define("DS/VCXWebDressup/VCX3DAligner/VCX3DAlignerModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueMap","DS/VCXWebProperties/VCXPropertyValueLink","DS/VCXWebProperties/VCXPropertyValueVector"],(function(e,t,i,r,a,o,s,n,l){"use strict";return e.extend({init:function(){this._bIs3DAligner=!0,this._parent(),this._requestedAlignmentLocked=null},Build:function(){this._parent();var e=[{Name:"Alignment.Enable",Type:r,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Alignment"},{Name:"Alignment.Locked",Type:r,DefaultValue:!1,GroupId:"Group.Alignment"},{Name:"Actor.LinkedTo",Type:n,DefaultValue:"",GroupId:"Group.Alignment"},{Name:"Actor.ListActors",Type:s,GroupId:"Group.Alignment",visibleInPropertyGroups:!1}];this._BuildPropertyValues(e)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Actor.Color",!0),this.SetPropertyInvisible("Actor.Opacity",!0),this.SetPropertyInvisible("Actor.IsAlwaysOnTop",!0)},RequestModification:function(e,t){if(e&&"Alignment.Locked"===e.GetPropertyInfo().GetPropertyName()){if(e.GetPropertyValue().Value){const r=new i;return this.GetObject().lock(!1,r),t.AddOrModifyPropertySet(this.GetHashing(),r),this._parent(e,t)}{const r=new i;return this.GetObject().unlock(r),t.AddOrModifyPropertySet(this.GetHashing(),r),this._parent(e,t)}}return this._parent(e,t)}})})),define("DS/VCXWebDressup/VCXDressupModifiableView",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebExperienceBase/VCXModifiableViewOccurrenceExperience","DS/VCXWebProperties/VCXPropertyGroup","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],(function(e,t,i,r,a){"use strict";var o=t.extend({init:function(){this._parent()},SetPropertiesViewInfo:function(){},getPropertyGroupsi18n:function(){return a},GetPropertyGroupVisibility:function(e){var t=this.QueryInterface("VCXIModifiable")._PropertyGroups[e];if(t){if(!1===t.availability||!1===t.visibility)return!1}else console.warn("Does the property group "+e+" exists ?");return!0},getPropertyGroups:function(e){e||(e={});var t=this.QueryInterface("VCXIModifiable");t.SetPropertiesInfo(),this._parent(e);var a=this.getGroupPropertiesOrders();for(var o in e["Group.Essentials"]||(e["Group.Essentials"]=new i({groupID:"Group.Essentials"}),e["Group.Essentials"].i18nGroup=r),e["Group.Essentials"].setPropertiesOrder(a["Group.Essentials"]),e["Group.Essentials"].priority=0,e["Group.Essentials"].addProperties([{propertyName:"Actor.Color",i18n:r}]),t._PropertyGroups)if(t._PropertyGroups.hasOwnProperty(o))if(!1!==t._PropertyGroups[o].availability)if(e.hasOwnProperty(o)){var s=t._PropertyGroups[o].PropertyControlingGroupAvailability||e[o].PropertyControlingGroupAvailability,n=t._PropertyGroups[o].PropertyControlingGroupVisibility||e[o].PropertyControlingGroupVisibility;const i=e[o]._propertiesInfos;for(const i in t._PropertyGroups[o])e[o][i]=t._PropertyGroups[o][i];for(const t in i)e[o]._propertiesInfos[t]||(e[o]._propertiesInfos[t]=i[t]);e[o].PropertyControlingGroupAvailability=s,e[o].PropertyControlingGroupVisibility=n}else e[o]=t._PropertyGroups[o];else delete e[o];var l=null;if(this._getGroupsPriorities?l=this._getGroupsPriorities():console.warn("Missing _getGroupsPriorities method for component "+this.GetObject().GetType()+" !!"),l)for(var o in e)e.hasOwnProperty(o)&&l&&"number"==typeof l[o]&&(e[o].priority=l[o]);return e},getGroupPropertiesOrders:function(){var e={"Group.Essentials":["Actor.Name","Modifiable.Style","Actor.Color","Actor.Opacity"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t},SetPropertyInvisible:function(e,t){var i=this._getPropertyGroupFromPropertyName(e);i&&i.setVisible(e,!t)},_getPropertyGroupFromPropertyName:function(e){var t=this.QueryInterface("VCXIModifiable"),r=t.GetProperty(e);if(r){var a=r.GetPropertyInfo().GetGroupId();return a||(a="Group.Essentials"),t._PropertyGroups[a]||(t._PropertyGroups[a]=new i({groupID:a})),t._PropertyGroups[a]}},ChangeGroupAvailability:function(t,r){if(Object.values(e.EAvailability).includes(r)){var a=this.QueryInterface("VCXIModifiable"),o=a._PropertyGroups[t];o||(a._PropertyGroups[t]=new i({groupID:t}),o=a._PropertyGroups[t]);var s=o.PropertyControlingGroupAvailability,n=a._Properties[s];if(n&&n.GetPropertyValue().SetValue(r),r===e.EAvailability.AppForceAvailable)o.availability=!0,o.visibility=!0;else if(r===e.EAvailability.AppForceNotAvailable)o.availability=!1,o.visibility=!1;else{o.availability=void 0;var l=o.PropertyControlingGroupVisibility,p=a._Properties[l];p&&(o.visibility=p.GetPropertyValue().GetValue())}}},getCollapsedGroupsNames:function(){return["Group.Actions"]}});return o.prototype._getGroupsPriorities=function(){return{"Group.Essentials":0}},o})),define("DS/VCXWebDressup/VCXCoveringMaterial/VCXCoveringMaterialSpecModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],(function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{}),e}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0}),i},t})),define("DS/VCXWebDressup/VCXRedLine/VCXRedLineModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],(function(e){"use strict";var t=e.extend({init:function(){this._parent()},getPropertyGroups:function(e){return e||(e={}),this._parent(e),e["Group.Essentials"].removeProperty("Actor.Color"),e["Group.Essentials"].removeProperty("Actor.Opacity"),e},getGroupPropertiesOrders:function(){var e={"Group.Line":["Actor.Color","Actor.Opacity","Collab.Body.Line.Width"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Line":10}),i},t})),define("DS/VCXWebDressup/VCXViewpoint/VCXViewpointModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","DS/VCXWebVisualization/VCXIViewpointController"],(function(e,t,i){"use strict";var r=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e={"Group.Camera":["Camera.Ortho","Camera.Height","Camera.Focal.Length","Camera.Angle","Camera.Dolly","Camera.Position.Frame","Camera.Target.Frame","Camera.Arcball","Camera.Pitch","Camera.Roll","Camera.Roll.Angle","Camera.Yaw","Camera.LockDistCOI","Camera.DistCOI"],"Group.Camera.Perspective":["Camera.Height","Camera.Focal.Length","Camera.Dolly","Camera.Ortho"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t},getAdditionalPropertySettings:function(e){let r=this._parent()||{};return r["Camera.Orientation.Preset"]={exceptionTweaker:!0,displayStyle:"FunctionButtonGroup",enumInfo:{[t.EViewPosition.Left]:{displayStyle:"lite",iconName:"view-3d-left",commandId:"VisuLeftViewCmd"},[t.EViewPosition.Right]:{displayStyle:"lite",iconName:"view-3d-right",commandId:"VisuRightViewCmd"},[t.EViewPosition.Bottom]:{displayStyle:"lite",iconName:"view-3d-bottom",commandId:"VisuBottomViewCmd"},[t.EViewPosition.Top]:{displayStyle:"lite",iconName:"view-3d-top",commandId:"VisuTopViewCmd"},[t.EViewPosition.Front]:{displayStyle:"lite",iconName:"view-3d-front",commandId:"VisuFrontViewCmd"},[t.EViewPosition.Back]:{displayStyle:"lite",iconName:"view-3d-back",commandId:"VisuBackViewCmd"},[t.EViewPosition.Isometric]:{displayStyle:"lite",iconName:"view-3d-isometric",commandId:"VisuIsoViewCmd"}}},r["Camera.DOF.Type"]={exceptionTweaker:!0,displayStyle:"FunctionButtonGroup",enumInfo:{[i.EDOFType.Follow]:{iconName:"target",commandId:{name:"VCXSetAnchorTo2DPickPointCmd",args:{anchorID:10,modifiable:this.QueryInterface("VCXIModifiable")}}}}},r}});return r.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Camera":10,"Group.Camera.Perspective":20,"Group.Camera.Focus":30,"Group.Camera.Orientation":40,"Group.Camera.Roll":50}),i},r})),define("DS/VCXWebDressup/VCXCircle/VCXCircleModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],(function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e={"Group.Circle":["Circle.Radius","Collab.Background.Color","Collab.Background.Color.Opacity","Circle.Background.Type","Circle.Thickness","Collab.3D.Paper.Billboard.Type"],"Group.CircleBorder":["Collab.Body.Line.Color","Collab.Body.Line.Color.Opacity","Collab.Body.Line.Width","Collab.Body.Line.Type"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Circle":10,"Group.CircleBorder":20,"Group.Actions":30}),i},t})),define("DS/VCXWebDressup/VCXSection/VCXSectionModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],(function(e){"use strict";var t=e.extend({init:function(){this._parent(),this._bIsSection=!0},getPropertyGroups:function(e){return e||(e={}),this._parent(e),e["Group.Essentials"].removeProperty("Actor.Color"),e["Group.Essentials"].removeProperty("Actor.Opacity"),e},getGroupPropertiesOrders:function(){var e={"Group.Section":["Section.AutoFlip","Section.SpaceBackAlpha","Section.SpaceFrontAlpha"],"Group.Section.Capping":["Section.Capping.Color","Section.Capping.ActorColor"],"Group.Section.Hatching":["Section.Hatching.Color","Section.Hatching.Frequency","Section.Hatching.Angle"],"Group.Section.Plane":["Section.Plane.Enable","Actor.Color","Actor.Opacity","Actor.IsAlwaysOnTop"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Section.Plane":10,"Group.Section":20,"Group.Section.Capping":30,"Group.Section.Hatching":40,"Group.Actions":100}),i},t})),define("DS/VCXWebDressup/VCX3DAligner/VCX3DAlignerModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],(function(e){"use strict";return e.extend({init:function(){this._parent(),this._bIs3DAligner=!0},isHiddenFromPropPanel:function(){return!0},getGroupPropertiesOrders:function(){return this._parent()||{}}})})),define("DS/VCXWebDressup/VCXViewpoint/VCXViewportModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],(function(e){"use strict";return e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e={"Group.Camera":["Camera.Ortho","Camera.Height","Camera.Focal.Length","Camera.Angle","Camera.Dolly","Camera.Position.Frame","Camera.Target.Frame","Camera.Arcball","Camera.Pitch","Camera.Roll","Camera.Roll.Angle","Camera.Yaw","Camera.LockDistCOI","Camera.DistCOI"],"Group.Paper":["Paper.Width","Paper.Height","Paper.Orientation"],"Group.Environment":["Viewport.ActiveAmbience","Viewport.ActiveCamera","Environment.Vertical"],"Group.Environment.Background":["Environment.Background.Color","Environment.Background.Color.Opacity","Environment.Background.Image","Environment.Background.Gradient","Environment.Background.Foot.Color"],"Group.Environment.Effects":["Environment.Shadow","Environment.AA","Environment.SSAO","Environment.Vignetting","Environment.Bloom","Environment.Flare","Environment.BackFaceCulling"],"Group.Render":["Render.Mode","Render.OutlineType","Render.ShowConstructions"],"Group.Render.Lighting":["Render.Lighting.Intensity","Render.Lighting.Mode"],"Group.Environment.Debug":["Environment.Debug.Availability","Environment.Debug.Show","Environment.Debug.ShadowLight","Environment.Debug.BSphere","Environment.Debug.PrimitiveBSphere","Environment.Debug.RepBBox","Environment.Debug.Picking","Environment.Debug.Normals","Environment.Debug.PickHybrid","Environment.Debug.PostProcessing","Environment.Debug.ShadowMaps","Environment.Debug.FPS","Render.PixelCulling"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t}})})),define("DS/VCXWebDressup/VCXHotspot/VCXHotspotModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],(function(e){"use strict";var t=e.extend({init:function(){this._parent()},getCollapsedGroupsNames:function(){var e=this._parent();const t=e.indexOf("Group.Actions");return t>=0&&e.splice(t,t+1),e.concat(["Group.Image","Group.Shadow"])},getGroupPropertiesOrders:function(){const e={"Group.Essentials":["Hotspot.Radius"],"Group.Hotspot.Center":["Collab.Body.Shape.Inner","Hotspot.Radius.Inner","Collab.Background.Color","Collab.Background.Color.Opacity","Hotspot.Angle.Inner"],"Group.Hotspot.Border":["Collab.Body.Shape","Collab.Body.Line.Color","Collab.Body.Line.Color.Opacity","Collab.Body.Line.Width","Collab.Body.Line.Type","Hotspot.Angle"],"Group.Image":["Collab.Image.Doc.ID","Collab.Image.DPI","Collab.Image.Transparency"],"Group.Shadow":["Collab.Body.Shadow.Opacity","Collab.Body.Shadow.Distance","Collab.Body.Shadow.Orientation","Collab.Body.Shadow.Blur"]};return this.mergePropertyGroups(e,this._parent()),e}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Hotspot.Center":10,"Group.Hotspot.Border":20,"Group.Image":25,"Group.Shadow":30,"Group.Actions":40}),i},t})),define("DS/VCXWebDressup/VCXCompass/VCXCompassModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],(function(e){"use strict";return e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e={"Group.Compass.General":["Compass.GeomPath","Compass.ODT.CustomRobotState","Compass.ODT.CustomRobotGeomNodesNumber"],"Group.Compass.Size":["Compass.AbsoluteSize","Compass.Size","Compass.SizePixel"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t}})})),define("DS/VCXWebDressup/VCX3DGrid/VCX3DGridModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],(function(e){"use strict";const t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){const e={"Group.3DGrid":[],"3DGrid.Group.Size":["3DGrid.Width","3DGrid.Height"],"3DGrid.Origin":["Actor.Position","3DGrid.Origin.Show"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"3DGrid.Group.Size":10,"3DGrid.Origin":20}),i},t})),define("DS/VCXWebDressup/VCXViewpoint/VCXCameraModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],(function(e){"use strict";return e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e={"Group.Camera":["Camera.Angle","Camera.Height","Camera.Ortho","Camera.Arcball","Camera.Pitch","Camera.Roll","Camera.Roll.Angle","Camera.Yaw","Camera.LockDistCOI","Camera.DistCOI"],"Group.Collab.Gizmo":["Collab.Gizmo.Line.Color","Collab.Gizmo.Line.Color.Opacity","Collab.Gizmo.Line.Width"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t}})})),define("DS/VCXWebDressup/VCXMagnetLine/VCXMagnetLineModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],(function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e={"Group.Essentials":["Actor.Name","Actor.Color","MagnetLine.Magnetic"],"Group.Position":["MagnetLine.Length","MagnetLine.Rotation"]},t={};for(const i in e)t[i]=e[i];return t}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Position":20}),i},t})),define("DS/VCXWebDressup/VCXRenderingFeatureModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],(function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{}),e}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0}),i},t})),define("DS/VCXWebDressup/VCXMarkup/VCXMarkupModifiable",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","DS/VCXWebDressup/VCXMarkup/VCXPanel_Spec","DS/VCXWebDressup/VCXDressupModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueFont","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueDocId","DS/VCXWebProperties/VCXPropertyValueLink","DS/VCXWebSystem/VCXTextTools","DS/VCXWebExperienceBase/VCXPathElementTools"],(function(e,t,i,r,a,o,s,n,l,p,u,h,d,c,C,y,m,V,f){"use strict";var b=r.extend({init:function(){this._bIsMarkup=!0,this._parent()},Build:function(){this._parent();var r=[{Name:"Collab.Text.Availability",Type:p,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Text"},{Name:"Collab.Text.Show",Type:n,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Text",FormatPainter:!0},{Name:"Collab.Text",Type:d,DefaultValue:""},{Name:"Collab.Text.html",Type:d,DefaultValue:"",GroupId:"Group.Text",Persistent:!1},{Name:"Collab.Text.LinkedProperty",Type:d,DefaultValue:"Actor.ToolTip",GroupId:"Group.Text",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Collab.Text.Color",Type:h,DefaultValue:(new s).FromRGBA(0,0,0,1),GroupId:"Group.Text",FormatPainter:!0},{Name:"Collab.Text.Color.Opacity",Type:l,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Text",FormatPainter:!0},{Name:"Collab.Text.Font",Type:u,GroupId:"Group.Text",FormatPainter:!0},{Name:"Collab.Text.SizeToFit",Type:n,DefaultValue:!1,GroupId:"Group.Text"},{Name:"Collab.Text.Wordwrap",Type:n,DefaultValue:!1,GroupId:"Group.Paragraph",visibleInPropertyGroups:!1},{Name:"Collab.Text.LineSpacing",Type:l,DefaultValue:1.2,GroupId:"Group.Paragraph",visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.Text.ParagraphSpacing",Type:l,DefaultValue:1.4,GroupId:"Group.Paragraph",FormatPainter:!0},{Name:"Collab.Text.HAlignment",Type:p,DefaultValue:t.EHTextAlignment.Centered,GroupId:"Group.Paragraph",MapChoice:this._generateMapChoiceFromEnumAndId(t.EHTextAlignment,"Collab.Text.HAlignment"),FormatPainter:!0},{Name:"Collab.Text.VAlignment",Type:p,DefaultValue:t.EVTextAlignment.Middle,GroupId:"Group.Paragraph",MapChoice:this._generateMapChoiceFromEnumAndId(t.EVTextAlignment,"Collab.Text.VAlignment"),FormatPainter:!0},{Name:"Collab.Body.Shape",Type:p,DefaultValue:t.EBodyShape.RoundedRectangle,GroupId:"Group.Body",MapChoice:this._generateMapChoiceFromEnumAndId(t.EBodyShape,"Collab.Body.Shape",["User","CircumscribedCircle"]),FormatPainter:!0},{Name:"Collab.Body.FitToText",Type:n,DefaultValue:!0,GroupId:"Group.Body",visibleInPropertyGroups:!1},{Name:"Collab.Body.KeepAspectRatio",Type:n,DefaultValue:!1,GroupId:"Group.Body"},{Name:"Collab.Body.Width",Type:l,DefaultValue:50,GroupId:"Group.Body"},{Name:"Collab.Body.Height",Type:l,DefaultValue:50,GroupId:"Group.Body"},{Name:"Collab.Body.InnerMargin",Type:l,DefaultValue:2,GroupId:"Group.Background",FormatPainter:!0},{Name:"Collab.Body.HAlignment",Type:p,DefaultValue:t.EHAlignment.Left,GroupId:"Group.Body",MapChoice:this._generateMapChoiceFromEnumAndId(t.EHAlignment,"Collab.Body.HAlignment"),visibleInPropertyGroups:!1},{Name:"Collab.Body.VAlignment",Type:p,DefaultValue:t.EVAlignment.Top,GroupId:"Group.Body",MapChoice:this._generateMapChoiceFromEnumAndId(t.EVAlignment,"Collab.Body.VAlignment"),visibleInPropertyGroups:!1},{Name:"Collab.Body.ContributeToEqualSize",Type:n,DefaultValue:!1,GroupId:"Group.Body",visibleInPropertyGroups:!1},{Name:"Collab.Background.Availability",Type:p,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Background",FormatPainter:!0},{Name:"Collab.Background.Show",Type:n,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Background",FormatPainter:!0},{Name:"Collab.Background.Color",Type:h,DefaultValue:(new s).FromRGBA(1,1,1,1),GroupId:"Group.Background",FormatPainter:!0},{Name:"Collab.Background.Color.Opacity",Type:l,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Background",FormatPainter:!0},{Name:"Collab.Image.Availability",Type:p,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Image",FormatPainter:!0},{Name:"Collab.Image.Show",Type:n,DefaultValue:!1,ControlsGroupVisibility:!0,GroupId:"Group.Image",FormatPainter:!0},{Name:"Collab.Image.DPI",Type:l,DefaultValue:-1,GroupId:"Group.Image",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Collab.Image.Doc.ID",Type:y,DefaultValue:-1,GroupId:"Group.Image"},{Name:"Collab.Image.Doc.PrepareRender",Type:n,DefaultValue:!1,visibleInPropertyGroups:!1,Persistent:!1},{Name:"Collab.Image.Color",Type:h,DefaultValue:(new s).FromRGBA(1,1,1,1),GroupId:"Group.Image",FormatPainter:!0},{Name:"Collab.Image.Color.Opacity",Type:l,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Image",FormatPainter:!0},{Name:"Collab.Image.Scale",Type:l,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Image",FormatPainter:!0},{Name:"Collab.Border.Availability",Type:p,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Show",Type:n,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.Width",Type:l,DefaultValue:2,GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.Color",Type:h,DefaultValue:(new s).FromRGBA(0,0,0,1),GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.Color.Opacity",Type:l,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Body.Shadow.Availability",Type:p,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Shadow",FormatPainter:!0},{Name:"Collab.Body.Shadow.Show",Type:n,DefaultValue:!1,ControlsGroupVisibility:!0,GroupId:"Group.Shadow",FormatPainter:!0},{Name:"Collab.Body.Shadow.Opacity",Type:l,DefaultValue:.55,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:1,Step:.1}},{Name:"Collab.Body.Shadow.Distance",Type:l,DefaultValue:3,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:20,Step:.1}},{Name:"Collab.Body.Shadow.Orientation",Type:l,DefaultValue:45,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:360,Step:.1}},{Name:"Collab.Body.Shadow.Blur",Type:l,DefaultValue:12,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:20,Step:.1}},{Name:"Collab.3D.Paper.Positioning.Type",Type:p,DefaultValue:t.EPositionType.Free3D,GroupId:"Group.Position",MapChoice:this._generateMapChoiceFromEnumAndId(t.EPositionType,"Positioning.Type",["EndOfAutomaticPositionning"])},{Name:"Collab.3D.Paper.3D.Text.Position",Type:c,DefaultValue:new a.Vector3,GroupId:"Group.Position"},{Name:"Collab.3D.Paper.Size.Control.Type",Type:p,DefaultValue:t.ESizeControlType.Paper,GroupId:"Group.Position",MapChoice:this._generateMapChoiceFromEnumAndId(t.ESizeControlType,"Size.Control.Type"),visibleInPropertyGroups:!1},{Name:"Collab.3D.Paper.Scaling.Factor",Type:l,DefaultValue:1,GroupId:"Group.Body",visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.3D.Paper.Paper.Position.X",Type:l,DefaultValue:0,GroupId:"Group.Position"},{Name:"Collab.3D.Paper.Paper.Position.Y",Type:l,DefaultValue:0,GroupId:"Group.Position"},{Name:"Collab.3D.Paper.Is.Background",Type:n,DefaultValue:!1,GroupId:"Group.Body",FormatPainter:!0},{Name:"Collab.3D.Paper.Depth",Type:l,DefaultValue:0,GroupId:"Group.Position",FormatPainter:!0},{Name:"Collab.3D.Paper.Billboard.Type",Type:p,DefaultValue:t.EBillboardType.Spherical,GroupId:"Group.Position",MapChoice:this._generateMapChoiceFromEnumAndId(t.EBillboardType,"Billboard.Type",["AlongX_yInCamUp"])},{Name:"Collab.3D.Paper.3D.Text.Radius",Type:l,DefaultValue:0,GroupId:"Group.Position",visibleInPropertyGroups:!1},{Name:"Collab.3D.Paper.UsesBarycenter",Type:n,DefaultValue:!1,GroupId:"Group.Position",visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.3D.Paper.Referential.In.World",Type:n,DefaultValue:!0,GroupId:"Group.Position",visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.Attach.Availability",Type:p,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Attach",FormatPainter:!0},{Name:"Collab.Attach.Show",Type:n,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Attach",FormatPainter:!0},{Name:"Collab.Attach.3DAttach",Type:n,DefaultValue:!0,GroupId:"Group.Attach",visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.Attach.Preset",Type:p,DefaultValue:t.EAttachType.Line,GroupId:"Group.Attach",MapChoice:this._generateMapChoiceFromEnumAndId(t.EAttachType,"Collab.Attach.Type"),Persistent:!1,visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.Attach.LeadType",Type:p,DefaultValue:t.ELeadType.Bent,GroupId:"Group.Attach",MapChoice:this._generateMapChoiceFromEnumAndId(t.ELeadType,"Collab.Attach.LeadType"),FormatPainter:!0},{Name:"Collab.Attach.ExtremityType",Type:p,DefaultValue:t.EExtremityType.Yellow,GroupId:"Group.Attach",FormatPainter:!0,MapChoice:this._generateMapChoiceFromEnumAndId(t.EExtremityType,"Collab.Attach.ExtremityType",["FullArrow_1","FullArrow_2","HalfArrow_B1","HalfArrow_T1","HalfArrow_T2","HalfArrow_B2"])},{Name:"Collab.Attach.ExtremityType.Additionnal",Type:p,DefaultValue:t.EExtremityType.Yellow,GroupId:"Group.Attach",visibleInPropertyGroups:!1,FormatPainter:!0,MapChoice:this._generateMapChoiceFromEnumAndId(t.EExtremityType,"Collab.Attach.ExtremityType",["FullArrow_1","FullArrow_2","HalfArrow_B1","HalfArrow_T1","HalfArrow_T2","HalfArrow_B2"])},{Name:"Collab.Attach.BentDot",Type:n,DefaultValue:!1,GroupId:"Group.Attach",FormatPainter:!0},{Name:"Collab.Attach.Background.Gradient",Type:n,DefaultValue:!1,GroupId:"Group.Attach",visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.Attach.Border.Gradient",Type:n,DefaultValue:!1,GroupId:"Group.Attach",visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.Attach.Curvature",Type:l,DefaultValue:40,Bounds:{Min:-100,Max:100,Step:.01},GroupId:"Group.Attach",visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.Attach.Origin",Type:c,DefaultValue:new a.Vector3,GroupId:"Group.Attach",visibleInPropertyGroups:!1},{Name:"Collab.Attach.CenteredOrigin",Type:n,DefaultValue:!0,GroupId:"Group.Attach",visibleInPropertyGroups:!1},{Name:"Collab.Attach.Line.Color",Type:h,DefaultValue:(new s).FromRGBA(0,0,0,1),GroupId:"Group.Attach",FormatPainter:!0},{Name:"Collab.Attach.Line.Color.Opacity",Type:l,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Attach",FormatPainter:!0},{Name:"Collab.Attach.Line.Width",Type:l,DefaultValue:2,GroupId:"Group.Attach",FormatPainter:!0},{Name:"Collab.Lead.AlwaysVisible",Type:n,DefaultValue:!1,GroupId:"Group.Attach",visibleInPropertyGroups:!1},{Name:"Collab.Attach.Line.Type",Type:p,DefaultValue:e.ELineType.Plain,GroupId:"Group.Attach",MapChoice:this._generateMapChoiceFromEnumAndId(e.ELineType,"Collab.DashType",["UserDefined","Advanced"]),FormatPainter:!0},{Name:"Collab.List2DAnchorsIDs",Type:C,DefaultValue:[],visibleInPropertyGroups:!1},{Name:"Collab.Markup.SubType",Type:p,DefaultValue:i.ESubType.None,visibleInPropertyGroups:!1,FormatPainter:!0}];const o=this.GetObject()._experienceBase.getManager("VCXContextManager");o&&o.isSupported("VCXPIPSupport")&&(r.push({Name:"Collab.PIP.Scenario.ID",Type:d,DefaultValue:"",GroupId:"Group.Image",FormatPainter:!0,visibleInPropertyGroups:!1}),r.push({Name:"Collab.PIP.Scenario",Type:p,DefaultValue:0,GroupId:"Group.Image",Persistent:!1,MapChoice:{0:"None"},visibleInPropertyGroups:!1})),this._BuildPropertyValues(r),this._Properties["Collab.Text.Font"].GetPropertyValue().SetFamily(new d("Arial")),this._Properties["Collab.Text.Font"].GetPropertyValue().SetHeight(new l(11))},SetPropertiesInfo:function(){const e=this.GetObject()._experienceBase.getManager("VCXContextManager");this._parent(),this.GetProperty("Actor.Color").GetPropertyInfo()._bPersistent=!1,this.SetPropertyInvisible("Collab.3D.Paper.UsesBarycenter",!0),this.SetPropertyInvisible("Collab.3D.Paper.Scaling.Factor",!0),this.SetPropertyInvisible("Collab.Text.html","1"!==e.getUrlVars().debug),this.SetPropertyInvisible("Collab.Text.SizeToFit",!this.GetPropertyValue("Collab.Text.Show")||this.GetPropertyValue("Collab.Body.FitToText")),this.SetPropertyInvisible("Collab.Body.KeepAspectRatio",!e.getContextFromName("PlayerMode")),this.SetPropertyInvisible("Collab.Body.Width",this.GetPropertyValue("Collab.Body.FitToText")&&this.GetPropertyValue("Collab.Text.Show")),this.SetPropertyInvisible("Collab.Body.Height",this.GetPropertyValue("Collab.Body.FitToText")&&this.GetPropertyValue("Collab.Text.Show")||this.GetPropertyValue("Collab.Body.KeepAspectRatio")&&this.GetPropertyValue("Collab.Image.Show")),this.SetPropertyInvisible("Collab.Background.Show",this.GetPropertyValue("Collab.Body.Shape")===t.EBodyShape.None),this.SetPropertyInvisible("Collab.Background.Color",!this.GetPropertyValue("Collab.Background.Show")||this.GetPropertyValue("Collab.Body.Shape")===t.EBodyShape.None),this.SetPropertyInvisible("Collab.Background.Color.Opacity",!this.GetPropertyValue("Collab.Background.Show")||this.GetPropertyValue("Collab.Body.Shape")===t.EBodyShape.None),this.SetPropertyInvisible("Actor.IsAlwaysOnTop",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=t.EPositionType.Free2D);var i=this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=t.EPositionType.Free2D||this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")===t.EPositionType.Free3D&&this.GetPropertyValue("Collab.3D.Paper.Billboard.Type")!==t.EBillboardType.Spherical;this.SetPropertyInvisible("Collab.3D.Paper.Size.Control.Type",i),this.SetPropertyInvisible("Collab.3D.Paper.3D.Text.Position",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=t.EPositionType.Free2D),this.SetPropertyInvisible("Collab.3D.Paper.Billboard.Type",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=t.EPositionType.Free2D),this.SetPropertyInvisible("Collab.3D.Paper.Referential.In.World",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=t.EPositionType.Free2D);var a=this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")!==t.EPositionType.Free2D&&this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")!==t.EPositionType.RelativeToReferential;this.SetPropertyInvisible("Collab.3D.Paper.Paper.Position.X",a),this.SetPropertyInvisible("Collab.3D.Paper.Paper.Position.Y",a),this.SetPropertyInvisible("Collab.3D.Paper.Depth",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")>t.EPositionType.Free2D),this.SetPropertyInvisible("Collab.3D.Paper.Is.Background",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")>t.EPositionType.Free2D),this.SetPropertyInvisible("Collab.Attach.CenteredOrigin",this.GetPropertyValue("Collab.Attach.LeadType")!==t.ELeadType.Mustache),this.SetPropertyInvisible("Collab.Attach.BentDot",this.GetPropertyValue("Collab.Attach.LeadType")!==t.ELeadType.Bent&&this.GetPropertyValue("Collab.Attach.LeadType")!==t.ELeadType.Line),this.SetPropertyInvisible("Collab.Attach.Origin",this.GetPropertyValue("Collab.Attach.CenteredOrigin")||this.GetPropertyValue("Collab.Attach.LeadType")===t.ELeadType.Mustache),this.SetPropertyInvisible("Collab.Attach.3DAttach",!0),this.SetPropertyInvisible("Collab.Attach.Line.Type",this.GetPropertyValue("Collab.Attach.LeadType")===t.ELeadType.Mustache),this.SetPropertyInvisible("Collab.Attach.Curvature",this.GetPropertyValue("Collab.Attach.LeadType")!==t.ELeadType.Mustache),this.SetPropertyInvisible("Collab.Attach.Background.Gradient",this.GetPropertyValue("Collab.Attach.LeadType")!==t.ELeadType.Mustache),this.SetPropertyInvisible("Collab.Attach.Border.Gradient",this.GetPropertyValue("Collab.Attach.LeadType")!==t.ELeadType.Mustache),this.SetPropertyInvisible("Collab.Body.ContributeToEqualSize",!0),this.SetPropertyInvisible("Collab.List2DAnchorsIDs",!0),this.SetPropertyInvisible("Collab.Markup.SubType",!0),this.ChangeGroupAvailability("Group.Image",r.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Paragraph",this.GetPropertyValue("Collab.Text.Show")?r.EAvailability.AppForceAvailable:r.EAvailability.AppForceNotAvailable),this.GetPropertyValue("Collab.Image.Doc.ID")>0?this.changeMapChoice("Collab.Body.Shape",this._generateMapChoiceFromEnumAndId(t.EBodyShape,"Collab.Body.Shape",["User","CircumscribedCircle"])):this.changeMapChoice("Collab.Body.Shape",this._generateMapChoiceFromEnumAndId(t.EBodyShape,"Collab.Body.Shape",["User","CircumscribedCircle","RemoveBorder"])),e.isSupported("VCXPIPSupport")&&this.changeMapChoice("Collab.PIP.Scenario",this.getScenarioEnum())},getScenarioEnum:function(e){if(e&&!e.id&&!e.idx)return{idx:0,scenario:null};const t=this.ExperienceBase.getManager("VCXScenarioManager").GetScenarios(),i={0:"None"};let r=1;for(let a in t){const o=t[a];if(e&&(e.id===a||e.idx===r))return{idx:r,scenario:o};i[r++]=o.GetName()}return e?{0:"None"}:i},GetDepthFromAttachedAnchors:function(){for(var e=0,t=this.GetAttachedOccurences(),i=0;i<t.length;i++){var r=t[i];if(r){var a=r.QueryInterface("VCXIModifiable");if(a){var o=a.GetProperty("Collab.3D.Paper.Depth");if(o){var s=o.GetPropertyValue().Value;s>e&&(e=s)}}}}return e},GetProperty:function(e){var i,r;if("Actor.Color"===e)return this.GetNewProperty(e,this.GetPropertyValue("Collab.Background.Color"));if("Collab.3D.Paper.Paper.Position.X"===e){if(this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<t.EPositionType.EndOfAutomaticPositionning&&(i=this.QueryInterface("W3AISGNodeHolder"))&&(r=i.getSGNode())&&r._Smart3DPaperNode)return this.GetNewProperty(e,r._Smart3DPaperNode.Position2D.x)}else if("Collab.3D.Paper.Paper.Position.Y"===e){if(this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<t.EPositionType.EndOfAutomaticPositionning&&(i=this.QueryInterface("W3AISGNodeHolder"))&&(r=i.getSGNode())&&r._Smart3DPaperNode)return this.GetNewProperty(e,r._Smart3DPaperNode.Position2D.y)}else{if("Collab.Image.DPI"===e){if(this.GetObject().backgroundImage){var a=25.4*this.GetObject().backgroundImage.width/this.GetPropertyValue("Collab.Body.Width"),o=25.4*this.GetObject().backgroundImage.height/this.GetPropertyValue("Collab.Body.Height");if(o>5&&a>5&&a/o>.999&&a/o<1.001)return this.GetNewProperty(e,a)}return this.GetNewProperty(e,-1)}if("Collab.PIP.Scenario"===e){const t=this.GetPropertyValue("Collab.PIP.Scenario.ID"),i=this.getScenarioEnum({id:t}).idx;return this.GetNewProperty(e,i)}if("Collab.Attach.Preset"===e){const i=Object.keys(t.EAttachType).filter((e=>Number.isNaN(+e)));for(let r=0;r<i.length;r++){const a=i[r],o=b.GetAttachPresets(t.EAttachType[a]);let n=!0;for(var s in o)if(o.hasOwnProperty(s)&&this.GetProperty(s)&&this.GetProperty(s).GetPropertyInfo().IsVisible()&&o[s]!==this.GetPropertyValue(s)){n=!1;break}if(n)return this.GetNewProperty(e,t.EAttachType[a])}}else if("Collab.3D.Paper.Depth"===e&&this.GetPropertyValue("Collab.UseDepthFromAnchor")){var n=this.GetDepthFromAttachedAnchors();return 0<n&&(n+=1),this.GetNewProperty(e,n)}}return this._parent(e)},RequestModification:function(e,i){if(e){if("Collab.Attach.Preset"===e.GetPropertyInfo().GetPropertyName()){var r=b.GetAttachPresets(e.GetPropertyValue().Value);for(var a in r)r.hasOwnProperty(a)&&i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty(a,r[a]));return this._parent(e,i)}if("Collab.Image.DPI"===e.GetPropertyInfo().GetPropertyName())return e.GetPropertyValue().Value>5?this.GetObject().backgroundImage&&(i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Body.Width",25.4*this.GetObject().backgroundImage.width/e.GetPropertyValue().Value)),i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Body.Height",25.4*this.GetObject().backgroundImage.height/e.GetPropertyValue().Value))):i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Image.DPI",-1)),i.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,i);if("Collab.Text"===e.GetPropertyInfo().GetPropertyName())return i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Text.html",V.htmlEncode(e.GetPropertyValue().Value))),i.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,i);if("Collab.Text.html"===e.GetPropertyInfo().GetPropertyName())return i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Text",V.htmlDecode(e.GetPropertyValue().Value))),i.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,i);if("Collab.PIP.Scenario"===e.GetPropertyInfo().GetPropertyName()){const t=this.getScenarioEnum({idx:e.GetPropertyValue().Value}).scenario,r=this._parent;if(i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.PIP.Scenario.ID",t?t.GetID():"")),t){const a=t.GetPIPDocId&&t.GetPIPDocId();if(a.docID>=0)return this.ExperienceBase.getManager("VCXImageManager").GetImageFromDocID(a.docID).then((t=>{var a=25.4*t.width/this.GetPropertyValue("Collab.Body.Width"),o=25.4*t.height/a;return i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Body.Height",o)),i.AddOrModifyProperty(this.GetHashing(),e),r.bind(this)(e,i)}))}return this._parent(e,i)}if("Collab.Image.Doc.ID"===e.GetPropertyInfo().GetPropertyName()){const t=this._parent;return this.ExperienceBase.getManager("VCXImageManager").GetImageFromDocID(e.GetPropertyValue().Value).then((r=>{var a=25.4*r.width/this.GetPropertyValue("Collab.Body.Width"),o=25.4*r.height/a;return i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Body.Height",o)),i.AddOrModifyProperty(this.GetHashing(),e),i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.PIP.Scenario.ID","")),t.bind(this)(e,i)}))}if("Actor.Color"===e.GetPropertyInfo().GetPropertyName()){var s=e.GetPropertyValue().Value.getAssociatedColors();return i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Background.Color",s.body)),i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Text.Color",s.text)),i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Image.Color",s.image)),i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Border.Line.Color",s.border)),i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Attach.Line.Color",s.attach)),this._parent(e,i)}if("Collab.3D.Paper.Positioning.Type"===e.GetPropertyInfo().GetPropertyName()){this.ExperienceBase.getManager("VCXDressupManager").alignmentDirty=2;var n=this.ExperienceBase.getManager("VCXContextManager").getMainViewer(),l=this.ExperienceBase.getManager("VCXPaperManager"),p=this.QueryInterface("W3AISGNodeHolder"),u={viewer:n,viewpoint:n.currentViewpoint};if(n&&l&&p){var h=p.getSGNode()&&p.getSGNode(),d=h&&h.GetShapeInfo(),c=d&&d.smartNode&&f.buildPathElement(p.getPathElement(),d.smartNode),C=c&&o.getOFromMatrix(c.getWorldMatrix(n));C||(C=o.getOFromMatrix(p.getWorldMatrix(n)));var y=l.ModelToMM2(u,C);if(e.GetPropertyValue().Value<=t.EPositionType.Free2D){if(e.GetPropertyValue().Value===t.EPositionType.RelativeToReferential){var m=o.getOFromMatrix(d.smartNode.GetReferential(u)),P=l.ModelToMM2(u,m);y.x-=P.x,y.y-=P.y,i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.3D.Paper.3D.Text.Radius",0))}i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.3D.Paper.Paper.Position.X",y.x)),i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.3D.Paper.Paper.Position.Y",y.y)),i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.3D.Paper.Billboard.Type",t.EBillboardType.Spherical)),i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.3D.Paper.Size.Control.Type",t.ESizeControlType.Paper))}else{m=o.getOFromMatrix(d.smartNode.GetReferential(u)),P=l.ModelToMM2(u,m);y.z=P.z;var g=l.MMToModel2(u,y);i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.3D.Paper.3D.Text.Position",p.getPositionInLCS(n,g)))}}return i.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,i)}}return this._parent(e,i)}});return b.GetAttachPresets=function(e){var i={};switch(e){case t.EAttachType.None:i["Collab.Attach.LeadType"]=t.ELeadType.None,i["Collab.Attach.ExtremityType"]=t.EExtremityType.None,i["Collab.Attach.Curvature"]=0,i["Collab.Attach.Background.Gradient"]=!1,i["Collab.Attach.Border.Gradient"]=!1,i["Collab.Attach.BentDot"]=!1;break;case t.EAttachType.Model:i["Collab.Attach.LeadType"]=t.ELeadType.Bent,i["Collab.Attach.ExtremityType"]=t.EExtremityType.Yellow,i["Collab.Attach.Curvature"]=0,i["Collab.Attach.Background.Gradient"]=!1,i["Collab.Attach.Border.Gradient"]=!1,i["Collab.Attach.BentDot"]=!1;break;case t.EAttachType.Vertex:i["Collab.Attach.LeadType"]=t.ELeadType.Bent,i["Collab.Attach.ExtremityType"]=t.EExtremityType.Red,i["Collab.Attach.Curvature"]=0,i["Collab.Attach.Background.Gradient"]=!1,i["Collab.Attach.Border.Gradient"]=!1,i["Collab.Attach.BentDot"]=!1;break;case t.EAttachType.GradientTooltip:i["Collab.Attach.LeadType"]=t.ELeadType.Mustache,i["Collab.Attach.ExtremityType"]=t.EExtremityType.Red,i["Collab.Attach.Curvature"]=0,i["Collab.Attach.Background.Gradient"]=!0,i["Collab.Attach.Border.Gradient"]=!0,i["Collab.Attach.BentDot"]=!1;break;case t.EAttachType.TooltipStyle:i["Collab.Attach.LeadType"]=t.ELeadType.Mustache,i["Collab.Attach.ExtremityType"]=t.EExtremityType.Red,i["Collab.Attach.Curvature"]=0,i["Collab.Attach.Background.Gradient"]=!1,i["Collab.Attach.Border.Gradient"]=!0,i["Collab.Attach.BentDot"]=!1;break;case t.EAttachType.Line:case t.EAttachType.User:i["Collab.Attach.LeadType"]=t.ELeadType.Bent,i["Collab.Attach.ExtremityType"]=t.EExtremityType.SmallRed,i["Collab.Attach.Curvature"]=0,i["Collab.Attach.Background.Gradient"]=!1,i["Collab.Attach.Border.Gradient"]=!1,i["Collab.Attach.BentDot"]=!1;break;case t.EAttachType.Simple:i["Collab.Attach.LeadType"]=t.ELeadType.Middle,i["Collab.Attach.ExtremityType"]=t.EExtremityType.SmallRed,i["Collab.Attach.Curvature"]=0,i["Collab.Attach.Background.Gradient"]=!1,i["Collab.Attach.Border.Gradient"]=!1,i["Collab.Attach.BentDot"]=!1;break;case t.EAttachType.ArcTooltip:i["Collab.Attach.LeadType"]=t.ELeadType.Mustache,i["Collab.Attach.ExtremityType"]=t.EExtremityType.Red,i["Collab.Attach.Curvature"]=40,i["Collab.Attach.Background.Gradient"]=!1,i["Collab.Attach.Border.Gradient"]=!1,i["Collab.Attach.BentDot"]=!1;break;case t.EAttachType.Arrow:i["Collab.Attach.LeadType"]=t.ELeadType.Bent,i["Collab.Attach.ExtremityType"]=t.EExtremityType.FullArrow_1,i["Collab.Attach.Curvature"]=0,i["Collab.Attach.Background.Gradient"]=!1,i["Collab.Attach.Border.Gradient"]=!1,i["Collab.Attach.BentDot"]=!1;break;case t.EAttachType.Basic:i["Collab.Attach.LeadType"]=t.ELeadType.Line,i["Collab.Attach.ExtremityType"]=t.EExtremityType.SmallRed,i["Collab.Attach.Curvature"]=0,i["Collab.Attach.Background.Gradient"]=!1,i["Collab.Attach.Border.Gradient"]=!1,i["Collab.Attach.BentDot"]=!1;break;case t.EAttachType.Modern:i["Collab.Attach.LeadType"]=t.ELeadType.Line,i["Collab.Attach.ExtremityType"]=t.EExtremityType.Line,i["Collab.Attach.Curvature"]=0,i["Collab.Attach.Background.Gradient"]=!1,i["Collab.Attach.Border.Gradient"]=!1,i["Collab.Attach.BentDot"]=!0}return i},b})),define("DS/VCXWebDressup/VCXMarkup/VCXCalloutModifiable",["DS/VCXWebDressup/VCXMarkup/VCXMarkupModifiable","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueString"],(function(e,t,i,r,a){"use strict";return e.extend({init:function(){this._bIsCallout=!0,this._parent()},Build:function(){this._parent();var e=[{Name:"Collab.Text.Availability",DefaultValue:t.EAvailability.AppForceAvailable},{Name:"Collab.Text",DefaultValue:"$(##Actor.PartList.ID)"},{Name:"Collab.Text.ComputedText",Type:a,DefaultValue:"",visibleInPropertyGroups:!1},{Name:"Collab.Text.Color",DefaultValue:(new r).FromRGBA(0,0,0,1),FormatPainter:!0},{Name:"Collab.Body.InnerMargin",DefaultValue:1.5,FormatPainter:!0},{Name:"Collab.Background.Color",DefaultValue:(new r).FromRGBA(1,1,1,1),FormatPainter:!0},{Name:"Collab.Body.Shape",DefaultValue:i.EBodyShape.Circle,FormatPainter:!0},{Name:"Collab.Body.HAlignment",DefaultValue:i.EHAlignment.Center},{Name:"Collab.Body.VAlignment",DefaultValue:i.EVAlignment.Bottom},{Name:"Collab.HideIfOutsideAnchorFrustrum",DefaultValue:!0},{Name:"Collab.Image.Availability",DefaultValue:t.EAvailability.AppForceNotAvailable},{Name:"Collab.Body.ContributeToEqualSize",DefaultValue:!0},{Name:"Collab.Body.Width",DefaultValue:5},{Name:"Collab.Body.Height",DefaultValue:5}];this._BuildPropertyValues(e),this.SetPropertyInvisible("Collab.HideIfOutsideAnchorFrustrum",!1)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Collab.3D.Paper.Is.Background",!0),this.ChangeGroupAvailability("Group.Paragraph",t.EAvailability.AppForceNotAvailable)},GetProperty:function(e){return"Collab.Text.ComputedText"===e?this.GetNewProperty(e,this.GetPropertyValue("Collab.Text._ComputedText")):this._parent(e)},RequestModification:function(e,t){return e&&"Collab.Text.ComputedText"===e.GetPropertyInfo().GetPropertyName()?(t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Text",e.GetPropertyValue().Value)),this._parent(e,t)):this._parent(e,t)}})})),define("DS/VCXWebDressup/VCXPartList/VCXPartListModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebDressup/VCXMarkup/VCXMarkupModifiable","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFont","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueMap","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],(function(e,t,i,r,a,o,s,n,l,p,u,h){"use strict";return t.extend({init:function(){this._bIsPartList=!0,this._parent()},Build:function(){this._parent();var e=[{Name:"Collab.Body.FitToText",DefaultValue:!1},{Name:"Collab.PartList.Split.HeaderCount",Type:l,DefaultValue:"1"},{Name:"Collab.PartList.ColumnList",Type:p,DefaultValue:new p},{Name:"Collab.PartList.ScenarioIDs",Type:p,BehaviorType:2,DefaultValue:new p},{Name:"Collab.PartList.SortColumn",Type:l,DefaultValue:"Actor.PartList.ID"},{Name:"Collab.PartList.SortAscending",Type:r,DefaultValue:!0},{Name:"Collab.3D.Paper.Billboard.Type",Type:a,DefaultValue:u.EBillboardType.Spherical},{Name:"Actor.Name",Type:l,DefaultValue:"Part List",GroupId:"Group.Essentials"},{Name:"Collab.3D.Paper.Paper.Position.X",Type:s,DefaultValue:10,GroupId:"Group.Essentials"},{Name:"Collab.3D.Paper.Paper.Position.Y",Type:s,DefaultValue:10,GroupId:"Group.Essentials"},{Name:"Collab.Body.Width",Type:s,DefaultValue:10,GroupId:"Group.Essentials"},{Name:"Collab.Body.Height",Type:s,DefaultValue:10,GroupId:"Group.Essentials"},{Name:"Collab.PartList.Header.Availability",Type:a,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Header",FormatPainter:!0},{Name:"Collab.PartList.Header.Show",Type:r,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Header",FormatPainter:!0},{Name:"Collab.PartList.Header.Background.Color",Type:o,DefaultValue:(new i).FromHexString("#42A2DA"),GroupId:"Group.Header",FormatPainter:!0},{Name:"Collab.PartList.Header.Background.Color.Opacity",Type:s,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Header",FormatPainter:!0},{Name:"Collab.PartList.Header.Text.Color",Type:o,DefaultValue:(new i).FromHexString("#ffffff"),GroupId:"Group.Header",FormatPainter:!0},{Name:"Collab.PartList.Header.Text.Color.Opacity",Type:s,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Header",FormatPainter:!0},{Name:"Collab.PartList.Body.Row.Color",Type:o,DefaultValue:(new i).FromHexString("#ffffff"),GroupId:"Group.Body",BehaviorType:1,i18n:h},{Name:"Collab.PartList.Body.Row.Color.Opacity",Type:s,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Body",FormatPainter:!0},{Name:"Collab.PartList.Body.ConsiderAlternateColor",Type:r,DefaultValue:!1,GroupId:"Group.Body"},{Name:"Collab.PartList.Body.SecondRow.Color",Type:o,DefaultValue:(new i).FromHexString("#ffffff"),GroupId:"Group.Body",BehaviorType:1,i18n:h},{Name:"Collab.PartList.Body.SecondRow.Color.Opacity",Type:s,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Body",FormatPainter:!0},{Name:"Collab.PartList.Container.Text.Color",Type:o,DefaultValue:(new i).FromHexString("#747474"),GroupId:"Group.Body",FormatPainter:!0},{Name:"Collab.PartList.Container.Text.Color.Opacity",Type:s,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Body",FormatPainter:!0},{Name:"Collab.Text.Font",Type:n,GroupId:"Group.Text",hiddenFields:["Italic","Bold"],FormatPainter:!0},{Name:"Collab.Text.HAlignment",DefaultValue:u.EHTextAlignment.Left,FormatPainter:!0},{Name:"Collab.Border.Availability",Type:a,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Show",Type:r,DefaultValue:!1,ControlsGroupVisibility:!0,GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.Width",Type:s,DefaultValue:2,GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.Color",Type:o,DefaultValue:(new i).FromHexString("#000000"),GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.Color.Opacity",Type:s,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Body.Shadow.Availability",Type:a,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Shadow",FormatPainter:!0},{Name:"Collab.Body.Shadow.Show",Type:r,DefaultValue:!1,ControlsGroupVisibility:!0,GroupId:"Group.Shadow",FormatPainter:!0},{Name:"Collab.Body.Shadow.Opacity",Type:s,DefaultValue:.55,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:1,Step:.1}},{Name:"Collab.Body.Shadow.Distance",Type:s,DefaultValue:3,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:20,Step:.1}},{Name:"Collab.Body.Shadow.Orientation",Type:s,DefaultValue:45,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:360,Step:.1}},{Name:"Collab.Body.Shadow.Blur",Type:s,DefaultValue:12,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:20,Step:.1}},{Name:"Collab.3D.Paper.Positioning.Type",Type:a,DefaultValue:u.EPositionType.Free2D},{Name:"Collab.PartList.FilterOnVisibleCallouts",Type:r,DefaultValue:!1,GroupId:"Group.Filter"}];this._BuildPropertyValues(e)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Collab.Text",!0),this.SetPropertyInvisible("Collab.Text.SizeToFit",!0),this.SetPropertyInvisible("Collab.Text.Color",!0),this.SetPropertyInvisible("Collab.3D.Paper.Billboard.Type",!0),this.SetPropertyInvisible("Collab.Body.FitToText",!0),this.SetPropertyInvisible("Collab.3D.Paper.Is.Background",!0),this.SetPropertyInvisible("Collab.Body.Shape",!0),this.SetPropertyInvisible("Collab.PartList.Split.HeaderCount",!0),this.SetPropertyInvisible("Collab.Text.HAlignment",!0),this.SetPropertyInvisible("Collab.PartList.ColumnList",!0),this.SetPropertyInvisible("Collab.PartList.SortColumn",!0),this.SetPropertyInvisible("Collab.PartList.SortAscending",!0),this.SetPropertyInvisible("Collab.PartList.ScenarioIDs",!0);let t=!this.GetPropertyValue("Collab.PartList.Body.ConsiderAlternateColor");this.SetPropertyInvisible("Collab.PartList.Body.SecondRow.Color",t),this.SetPropertyInvisible("ollab.PartList.Body.SecondRow.Color.Opacity",t),this.ChangeGroupAvailability("Group.Paragraph",e.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Actions",e.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Attach",e.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Background",e.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Position",e.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Animation",e.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Border",e.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Shadow",e.EAvailability.AppForceNotAvailable)},OnChangeProperty:function(e,t,i){if(i||(i={}),i.fromChildClass);else if(this.OnChangePropertyBegin(e,t))return!0;"Collab.PartList.FilterOnVisibleCallouts"===e&&(this._resquestedFilterOnVisibleCallouts=t.Value),this._parent(e,t,i)},OnChangePropertiesEnd:function(){if(this._resquestedFilterOnVisibleCallouts!==this._filterOnVisibleCallouts){var e=this.ExperienceBase.getManager("VCXComponentPartListManager");e&&(e.filterHasChanged=!0),this._filterOnVisibleCallouts=this._resquestedFilterOnVisibleCallouts}this._parent()}})})),define("DS/VCXWebDressup/VCXMarkup/VCXLabelModifiable",["DS/VCXWebDressup/VCXMarkup/VCXMarkupModifiable","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","DS/VCXWebProperties/VCXColor"],(function(e,t,i,r){"use strict";return e.extend({init:function(){this._bIsLabel=!0,this._parent()},Build:function(){this._parent();var e=[{Name:"Collab.Text.Availability",DefaultValue:t.EAvailability.AppForceAvailable},{Name:"Collab.Text",DefaultValue:"$(##Actor.Name.DisplayTitle)"},{Name:"Collab.Text.Color",DefaultValue:(new r).FromRGBA(1,1,1,1),FormatPainter:!0},{Name:"Collab.Background.Color",DefaultValue:(new r).FromRGBA(.0666666666666667,.596078431372549,.8980392156862745,1),FormatPainter:!0},{Name:"Collab.Body.Shape",DefaultValue:i.EBodyShape.RoundedRectangle,FormatPainter:!0},{Name:"Collab.HideIfOutsideAnchorFrustrum",DefaultValue:!0,visibleInPropertyGroups:!0},{Name:"Collab.Image.Availability",DefaultValue:t.EAvailability.AppForceNotAvailable},{Name:"Collab.Body.HAlignment",DefaultValue:i.EHAlignment.Center},{Name:"Collab.Body.VAlignment",DefaultValue:i.EVAlignment.Middle},{Name:"Collab.3D.Paper.Billboard.Type",visibleInPropertyGroups:!1}];this._BuildPropertyValues(e),this.SetPropertyInvisible("Collab.HideIfOutsideAnchorFrustrum",!1),this.SetPropertyInvisible("Collab.3D.Paper.Is.Background",!0)}})})),define("DS/VCXWebDressup/VCXMarkup/VCXMarkupModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],(function(e){"use strict";return e.extend({init:function(){this._parent()},SetPropertiesViewInfo:function(){this._parent()},getGroupPropertiesOrders:function(){var e={"Group.Essentials":["Actor.Name","Modifiable.Style","Actor.Color","Actor.Opacity","Collab.Text"],"Group.Text":["Collab.Text.Color","Collab.Text.Color.Opacity","Collab.Text.Font","Collab.Text.SizeToFit","Collab.Text.html"],"Group.Paragraph":["Collab.Text.ParagraphSpacing","Collab.Text.HAlignment","Collab.Text.VAlignment"],"Group.Body":["Collab.Body.Shape","Collab.Body.Width","Collab.Body.Height","Collab.3D.Paper.Is.Background","Collab.Body.HAlignment","Collab.Body.VAlignment"],"Group.Background":["Collab.Background.Color","Collab.Background.Color.Opacity","Collab.Body.InnerMargin"],"Group.Image":["Collab.PIP.Scenario","Collab.Image.Doc.ID","Collab.Image.DPI","Collab.Image.Transparency"],"Group.Position":["Collab.3D.Paper.Positioning.Type","Collab.3D.Paper.Paper.Position.X","Collab.3D.Paper.Paper.Position.Y","Collab.3D.Paper.3D.Text.Position","Collab.3D.Paper.Depth"],"Group.Border":["Collab.Border.Line.Color","Collab.Border.Line.Color.Opacity","Collab.Border.Line.Width"],"Group.Attach":["Collab.Attach.Line.Color","Collab.Attach.Line.Color.Opacity","Collab.Attach.LeadType","Collab.Attach.ExtremityType","Collab.Attach.BentDot","Collab.Attach.Line.Width","Collab.Attach.Line.Type"],"Group.Shadow":["Collab.Body.Shadow.Opacity","Collab.Body.Shadow.Distance","Collab.Body.Shadow.Orientation","Collab.Body.Shadow.Blur"],"Group.BOM":["Collab.BOM.FilterOnVisibleCallouts","Collab.BOM.Header.Text.Color","Collab.BOM.Header.Background.Color","Collab.BOM.OddRow.Background.Color","Collab.BOM.EvenRow.Background.Color"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t},getAdditionalPropertySettings:function(e){var t=this._parent()||{};return t["Collab.Text"]={displayStyle:"editorInline"},t["Collab.Image.Doc.ID"]={fileTypes:"image/*"},t}})})),define("DS/VCXWebDressup/VCXMarkup/VCXPanelModifiableView",["DS/VCXWebDressup/VCXMarkup/VCXMarkupModifiableView","DS/VCXWebDressup/VCXMarkup/VCXPanel_Spec"],(function(e,t){"use strict";var i=e.extend({init:function(){this._parent()},getCollapsedGroupsNames:function(){return this._parent().concat(["Group.Position","Group.Border","Group.Attach","Group.Shadow","Group.Effect"])}});return i.prototype._getGroupsPriorities=function(i){var r=this.QueryInterface("VCXIModifiable"),a=e.prototype._getGroupsPriorities();return r.GetPropertyValue("Collab.Markup.SubType")===t.ESubType.Image?UWA.extend(a,{"Group.Essentials":0,"Group.Image":10,"Group.Body":15,"Group.Border":20,"Group.Position":30,"Group.Shadow":40,"Group.Effect":80,"Group.Actions":100}):r.GetPropertyValue("Collab.Markup.SubType")===t.ESubType.Text?UWA.extend(a,{"Group.Essentials":0,"Group.Text":10,"Group.Paragraph":15,"Group.Background":20,"Group.Body":30,"Group.Border":40,"Group.Position":50,"Group.Shadow":60,"Group.Actions":100,"Group.Effect":110}):UWA.extend(a,{"Group.Essentials":0,"Group.Text":10,"Group.Paragraph":15,"Group.Image":18,"Group.Background":20,"Group.Body":30,"Group.Border":40,"Group.Position":50,"Group.Attach":60,"Group.Shadow":70,"Group.Actions":100,"Group.Effect":110}),a},i})),define("DS/VCXWebDressup/VCXMarkup/VCXLabelModifiableView",["DS/VCXWebDressup/VCXMarkup/VCXMarkupModifiableView"],(function(e){"use strict";var t=e.extend({init:function(){this._parent()},getCollapsedGroupsNames:function(){return this._parent().concat(["Group.Paragraph","Group.Position","Group.Border","Group.Attach","Group.Shadow","Group.Effect"])}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Text":10,"Group.Background":20,"Group.Body":25,"Group.Paragraph":30,"Group.Position":40,"Group.Border":50,"Group.Attach":60,"Group.Shadow":70,"Group.Effect":80,"Group.Actions":100}),i},t})),define("DS/VCXWebDressup/VCXMarkup/VCXMeasurementModifiableView",["DS/VCXWebDressup/VCXMarkup/VCXMarkupModifiableView"],(function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Measurement":["Collab.Measurement.DisplayValue","Collab.Measurement.Value","Collab.Measurement.PreSymbol","Collab.Measurement.PreString","Collab.Measurement.MiddleSymbol","Collab.Measurement.MiddleString","Collab.Measurement.PostSymbol","Collab.Measurement.PostString","Collab.Measurement.Length","Collab.Measurement.Length1","Collab.Measurement.Length2","Collab.Measurement.Radius","Collab.Measurement.Radius1","Collab.Measurement.Radius2","Collab.Measurement.Area","Collab.Measurement.Volume","Collab.Measurement.ShowConstructionLines","Collab.Measurement.ShowRedlines","Collab.Measurement.ShowPlanes","Collab.Measurement.ShowEndPoints","Collab.Measurement.Type"]}),e},getCollapsedGroupsNames:function(){return this._parent().concat(["Group.Position","Group.Border","Group.Attach","Group.Shadow","Group.Effect"])}});return t.prototype._getGroupsPriorities=function(){var t=e.prototype._getGroupsPriorities();return UWA.extend(t,{"Group.Essentials":0,"Group.Text":10,"Group.Background":20,"Group.Body":30,"Group.Measurement":40,"Group.Actions":50,"Group.Position":60,"Group.Border":70,"Group.Attach":80,"Group.Shadow":90}),t},t})),define("DS/VCXWebDressup/VCXMarkup/VCXCalloutModifiableView",["DS/VCXWebDressup/VCXMarkup/VCXMarkupModifiableView"],(function(e){"use strict";var t=e.extend({init:function(){this._parent()},getCollapsedGroupsNames:function(){return this._parent().concat(["Group.Position","Group.Border","Group.Attach","Group.Shadow"])}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Text":10,"Group.Background":20,"Group.Body":30,"Group.Actions":40,"Group.Position":50,"Group.Border":60,"Group.Attach":70,"Group.Shadow":80,"Group.Effect":90}),i},t})),define("DS/VCXWebDressup/VCXPartList/VCXPartListModifiableView",["DS/VCXWebDressup/VCXMarkup/VCXMarkupModifiableView"],(function(e){"use strict";var t=e.extend({init:function(){this._parent()},SetPropertiesViewInfo:function(){this._parent()},getGroupPropertiesOrders:function(){var e={"Group.Essentials":["Actor.Name","Collab.3D.Paper.Paper.Position.X","Collab.3D.Paper.Paper.Position.Y","Collab.Body.Width","Collab.Body.Height","Actor.Opacity"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t}});return t.prototype._getGroupsPriorities=function(){return{"Group.Essentials":0,"Group.Header":10,"Group.Body":20,"Group.Text":30,"Group.Border":50,"Group.Shadow":60,"Group.Filter":70}},t})),define("DS/VCXWebDressup/VCXArrow/VCXArrowSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder"],(function(e){"use strict";return e.extend({init:function(){}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXArrow/VCXArrow_Spec",["require","exports","DS/VCXWebDressup/VCXDressup_Spec"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{constructor(){super()}}return Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXArrow_Spec"}}),r.prototype.dressupGroupName="Markups",r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXArrow/VCXCornerArrow_Spec",["require","exports","DS/VCXWebDressup/VCXArrow/VCXArrow_Spec"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{constructor(){super()}}return r.prototype.getDefaultName=function(){return"CornerArrow"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXCornerArrow_Spec"}}),r.prototype.dressupGroupName="Markups",r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXArrow/VCXLinearArrow_Spec",["require","exports","DS/VCXWebDressup/VCXArrow/VCXArrow_Spec"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{}return r.prototype.getDefaultName=function(){return"Arrow"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXLinearArrow_Spec"}}),r.prototype.dressupGroupName="Markups",r})),define("DS/VCXWebDressup/VCXMarkup/VCXExtremityNode",["DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory"],(function(e,t,i,r,a,o,s){"use strict";var n=e.extend({init:function(e){return this._parent(e),this.anchorID=e.anchorID,this._Type=1,this._ArrowTail=!0,e&&"number"==typeof e.type&&(this.Type=e.type),this},_getExtremityNode:function(){var a="#00ff00",n=1;switch(this._lineWidth=null,this.Type){case void 0:case t.EExtremityType.None:return null;case t.EExtremityType.Sphere:return s.createSphereNode({radius:n});case t.EExtremityType.FullArrow_1:case t.EExtremityType.FullArrow_2:case t.EExtremityType.HalfArrow_B1:case t.EExtremityType.HalfArrow_T1:case t.EExtremityType.HalfArrow_T2:case t.EExtremityType.HalfArrow_B2:var l=new o.PrimitiveGroup;l.editable=!0,l.fillAttr=new o.FillAttributes,l.lineAttr=new o.LineAttributes(this.GetColorPropertyValue("Collab.Attach.Line").GetThreeColor(),this.GetPropertyValue("Collab.Attach.Line.Width")),l.pointAttr=new o.PointAttributes;var p=new o.Buffer;p.size=9,p.component=o.VertexComponentEnum.POSITION,p.format=o.DataTypeEnum.FLOAT,p.dimension=3,p.data=new Float32Array(p.size),p.data[0]=0,p.data[1]=0,p.data[2]=0,p.data[3]=3.5,4===this.Type||7===this.Type?p.data[4]=0:p.data[4]=-1.5,p.data[5]=0,p.data[6]=3.5,5===this.Type||6===this.Type?p.data[7]=0:p.data[7]=1.5,p.data[8]=0,l.addBuffer(0,p);var u=new o.Buffer;u.indexBuffer=!0,u.size=3,u.format=o.DataTypeEnum.UINT,u.dimension=1,u.data=new Uint16Array(u.size);var h=u.data;h[0]=0,h[1]=1,h[2]=2,l.addBuffer(1,u);var d=new o.Primitive;d.nbIndices=3,d.connectivity=o.ConnectivityTypeEnum.TRIANGLES;var c=new o.VertexComponent;if(c.component=o.VertexComponentEnum.POSITION,c.nbVertices=3,c.nbValuesPerVertex=3,c.format=o.DataTypeEnum.FLOAT,c.cardinality=0,c.bufferId=0,c.indices=new o.IndexArray,c.indices.bufferId=1,c.indices.format=o.DataTypeEnum.UINT,c.indices.offset=0,d.addVertexComponent(c),l.addPrimitive(d),(V=new e({name:"ExtremityCore"})).add(s.createMeshNode(l)),this._ArrowTail){var C={type:i.ELineType.Plain,lineWidth:this.LineWidth,color:this.GetColorPropertyValue("Collab.Attach.Line").GetThreeColor()},y=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(C),m=s.createLineNode({points:[new r.Vector3(0,0,0),new r.Vector3(7,0,0)],material:y});V.add(m)}return this.handleLayers(!0),V;case t.EExtremityType.SmallRed:case t.EExtremityType.Yellow:case t.EExtremityType.Dot:case t.EExtremityType.Red:case t.EExtremityType.White:case t.EExtremityType.Line:switch(this.Type){case t.EExtremityType.Yellow:a="#ffff00";break;case t.EExtremityType.Dot:n*=.5;break;case t.EExtremityType.Red:a="#ff0000";break;case t.EExtremityType.White:a="#ffffff";break;case t.EExtremityType.SmallRed:a="#ff0000",n*=.5;case t.EExtremityType.Line:}var V;return this._Material=new r.MeshBasicMaterial({side:r.DoubleSide,transparent:!1,opacity:1,color:a,force:!0,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:-10}),this._lineWidth=1,this._Material.line=new r.LineBasicMaterial({side:r.DoubleSide,transparent:!1,color:"#000000",opacity:1,force:!0,polygonBorderMode:!0,lineWidth:this._lineWidth,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:-20,linecap:"round"}),this.Type!==t.EExtremityType.Dot&&this.Type!==t.EExtremityType.SmallRed||(this._Material.line.visible=!1),V=s.createCircleNode({radius:.7*n,material:this._Material,fill:!0});default:console.warn("Extremity "+this.Type+" not defined")}},dispose:function(){this._Smart3DPaperNode&&(this._Smart3DPaperNode.dispose(),this._Smart3DPaperNode=null),this._parent()},_Build:function(){var e={name:"AttachExtremitySmartNode",modifiable:this.Modifiable,type:this._type};this._Smart3DPaperNode=new a(e),this._referential&&this._Smart3DPaperNode.SetReferential(this._referential),this._Smart3DPaperNode.ModifiableProperties=!1,this._Smart3DPaperNode.SizeControlType=1,this._Smart3DPaperNode.BillboardType=3,this.add(this._Smart3DPaperNode),this.handleLayers(!0)},preRender:function(e){if(this._parent(e),this.viewpointVisibility&&this.GetOpacity(e)){if(this.setVisibility(!0),this._Material&&this._Material.line){this._Material.line.handleByPrerender=!0;let e=this.ExperienceBase.getManager("VCXPaperManager").UnitValueToPixel(null!==this._lineWidth?this._lineWidth:this.LineWidth);e>=1?(this._Material.line.setLineWidth(e),this._Material.line.visible=!0):this._Material.line.visible=!1}this._Smart3DPaperNode&&this._Smart3DPaperNode.preRender(e)}else this.setVisibility(!1)},update:function(e){if(this._parent(e),this._globalOpacity!==this.GetOpacity(e)){this._globalOpacity=this.GetOpacity(e);var i=this._globalOpacity>0;i&&(this._Smart3DPaperNode||this._Build()),this.setVisibility(i)}if(!(this._globalOpacity<=0)&&(this.LineWidth=this.Modifiable.GetPropertyValue("Collab.Attach.Line.Width"),this._previousType===this.Type&&this._previousLineWidth===this.LineWidth||(this._previousType=this.Type,this._previousLineWidth=this.LineWidth,this._Node&&(this._Smart3DPaperNode.remove(this._Node),this._Material=null,this._Node=null)),!this._Node&&this._Smart3DPaperNode&&(this._Node=this._getExtremityNode(0),this._Node&&this._Smart3DPaperNode.add(this._Node)),this._Smart3DPaperNode&&this._Smart3DPaperNode.update(e),this._Node)){var a=this.GetColorPropertyValue("Collab.Attach.Line");this._Material||(this._Material=new r.MeshBasicMaterial({}),this._lineWidth=1,this._Material.line=new r.LineBasicMaterial({side:r.DoubleSide,transparent:!1,color:"#000000",opacity:1,force:!0,polygonBorderMode:!0,lineWidth:this._lineWidth,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:-20,linecap:"round"}),this._Node.setMaterial(this._Material)),this._Material.opacity=a.a*this._globalOpacity,this.Type!==t.EExtremityType.Yellow&&this.Type!==t.EExtremityType.Red&&this.Type!==t.EExtremityType.White&&this.Type!==t.EExtremityType.SmallRed&&(this._Material.color=a.GetThreeColor(),this._Material.line&&(this._Material.color=a.GetThreeColor())),this._Material.line&&(this._Material.line.opacity=this._Material.opacity),this._Material.force=!0,this.handleLayers()}},SetReferential:function(e){this._referential=e.clone(),this._Smart3DPaperNode&&(this._Smart3DPaperNode.Referential=this._referential)},GetReferential:function(e){return this._Smart3DPaperNode?this._Smart3DPaperNode.GetReferential(e):null}});return Object.defineProperty(n.prototype,"Type",{enumerable:!0,get:function(){return this._Type},set:function(e){this._Type=e}}),Object.defineProperty(n.prototype,"LineWidth",{enumerable:!0,get:function(){return this._LineWidth},set:function(e){this._LineWidth=e}}),n})),define("DS/VCXWebDressup/VCXArrow/VCXArrowModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebSystem/VCXMathTools","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueVector","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables"],(function(e,t,i,r,a,o,s,n,l,p,u){"use strict";return e.extend({init:function(){this._bIsArrow=!0,this._parent()},Build:function(){this._parent();var e=[{Name:"Collab.Is.Paper",Type:a,DefaultValue:!0,GroupId:"Group.Arrow"},{Name:"Arrow.Scale",Type:s,DefaultValue:1,GroupId:"Group.Arrow",visibleInPropertyGroups:!1},{Name:"Collab.Border.Show",Type:a,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Border",visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.Border.Line.Width",Type:s,DefaultValue:1,GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.Type",Type:o,DefaultValue:t.ELineType.Plain,GroupId:"Group.Border",MapChoice:this._generateMapChoiceFromEnumAndId(t.ELineType,"Collab.DashType",["UserDefined","Advanced"]),FormatPainter:!0},{Name:"Arrow.Body.Color",Type:n,DefaultValue:(new r).FromRGBA(.9294117647058824,.3176470588235294,.3176470588235294,1),GroupId:"Group.Arrow.Head",FormatPainter:!0},{Name:"Arrow.Body.Color.Opacity",Type:s,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Arrow.Head",FormatPainter:!0},{Name:"Arrow.Width.1",Type:s,DefaultValue:4,GroupId:"Group.Arrow.Head",FormatPainter:!0},{Name:"Arrow.Head.ShowMode",Type:a,DefaultValue:!0,GroupId:"Group.Arrow.Head",FormatPainter:!0},{Name:"Arrow.Head.Length",Type:s,DefaultValue:8,GroupId:"Group.Arrow.Head",FormatPainter:!0},{Name:"Arrow.Head.Size",Type:s,DefaultValue:3,GroupId:"Group.Arrow.Head",FormatPainter:!0},{Name:"Arrow.Head.Shape",Type:s,DefaultValue:0,GroupId:"Group.Arrow.Head",FormatPainter:!0},{Name:"Collab.Border.Line.Color",Type:n,DefaultValue:(new r).FromRGBA(.6431372549019608,.1686274509803922,.1568627450980392,1),GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.Color.Opacity",Type:s,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Border",FormatPainter:!0},{Name:"Arrow.Body.2.Color",Type:n,DefaultValue:(new r).FromRGBA(.9294117647058824,.3176470588235294,.3176470588235294,.5),GroupId:"Group.Arrow.Head.2",FormatPainter:!0},{Name:"Arrow.Body.2.Color.Opacity",Type:s,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Arrow.Head.2",FormatPainter:!0},{Name:"Arrow.Width.2",Type:s,DefaultValue:4,GroupId:"Group.Arrow.Head.2",FormatPainter:!0},{Name:"Arrow.Head.2.ShowMode",Type:a,DefaultValue:!1,GroupId:"Group.Arrow.Head.2",FormatPainter:!0},{Name:"Arrow.Head.2.Length",Type:s,DefaultValue:8,GroupId:"Group.Arrow.Head.2",FormatPainter:!0},{Name:"Arrow.Head.2.Size",Type:s,DefaultValue:3,GroupId:"Group.Arrow.Head.2",FormatPainter:!0},{Name:"Arrow.Head.2.Shape",Type:s,DefaultValue:0,GroupId:"Group.Arrow.Head.2",FormatPainter:!0},{Name:"Collab.Border.Line.2.Color",Type:n,DefaultValue:(new r).FromRGBA(.6431372549019608,.1686274509803922,.1568627450980392,1),GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.2.Color.Opacity",Type:s,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Border",FormatPainter:!0}];this._BuildPropertyValues(e)},SetPropertiesInfo:function(){this._parent(),this.GetProperty("Actor.Color").GetPropertyInfo()._bPersistent=!1,this.GetProperty("Actor.Color").GetPropertyInfo().Seti18nGroup(p),this.GetProperty("Actor.Color").GetPropertyInfo().Seti18n(u),this.SetPropertyInvisible("Actor.Color",!1),this.SetPropertyInvisible("Arrow.Head.Length",!1===this.GetPropertyValue("Arrow.Head.ShowMode")),this.SetPropertyInvisible("Arrow.Head.Size",!1===this.GetPropertyValue("Arrow.Head.ShowMode")),this.SetPropertyInvisible("Arrow.Head.Shape",!1===this.GetPropertyValue("Arrow.Head.ShowMode")),this.SetPropertyInvisible("Arrow.Head.2.Length",!1===this.GetPropertyValue("Arrow.Head.2.ShowMode")),this.SetPropertyInvisible("Arrow.Head.2.Size",!1===this.GetPropertyValue("Arrow.Head.2.ShowMode")),this.SetPropertyInvisible("Arrow.Head.2.Shape",!1===this.GetPropertyValue("Arrow.Head.2.ShowMode")),this.SetPropertyInvisible("Arrow.Head.2.Shape",!1===this.GetPropertyValue("Arrow.Head.2.ShowMode")),this.SetPropertyInvisible("Arrow.Head.2.Shape",!1===this.GetPropertyValue("Arrow.Head.2.ShowMode")),this.SetPropertyInvisible("Collab.Border.Line.Color",!1===this.GetPropertyValue("Collab.Border.Show")),this.SetPropertyInvisible("Collab.Border.Line.Color.Opacity",!1===this.GetPropertyValue("Collab.Border.Show")),this.SetPropertyInvisible("Collab.Border.Line.2.Color",!0),this.SetPropertyInvisible("Collab.Border.Line.2.Color.Opacity",!0)},GetProperty:function(e){return"Actor.Color"===e?this.GetNewProperty(e,this.GetPropertyValue("Arrow.Body.Color")):this._parent(e)},getScaledDimensions:function(e,t){var r=this.ExperienceBase.getManager("VCXPaperManager"),a=[{idx:0},{idx:this.GetPropertyValue("Arrow.Head.2.Position.Is.Paper")?0:1}];a.forEach((a=>{if(this.GetPropertyValue("Collab.Is.Paper")===e)a.scaleToApply=1;else{let o=t||i.getOFromMatrix(this.GetAnchorWorldMatrix(0)),s=r.GetPaperRatio(null,o),n=1;e?n/=s:n*=s,a.scaleToApply=n}}));var o={};return[{idx:0,propertyName:"Arrow.Length"},{idx:0,propertyName:"Arrow.Width.1"},{idx:0,propertyName:"Arrow.Head.Length"},{idx:0,propertyName:"Arrow.Head.Size"},{idx:0,propertyName:"Arrow.Head.Shape"},{idx:1,propertyName:"Arrow.Width.2"},{idx:1,propertyName:"Arrow.Head.2.Length"},{idx:1,propertyName:"Arrow.Head.2.Size"},{idx:1,propertyName:"Arrow.Head.2.Shape"}].forEach((e=>{let t=this.GetPropertyValue(e.propertyName);void 0!==t&&(t*=a[e.idx].scaleToApply,o[e.propertyName]=t)})),o},RequestModification:function(e,t){if(e){var i=e.GetPropertyInfo().GetPropertyName();if("Actor.Color"===i){var r=e.GetPropertyValue().Value.getAssociatedColors();return t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Arrow.Body.Color",r.body)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Arrow.Body.2.Color",r.body)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Border.Line.Color",r.border)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Border.Line.2.Color",r.border)),this._parent(e,t)}if(i.includes("Collab.Border.Line")&&i.includes("Color")){var a="Collab.Border.Line"+(i.includes("2")?"":".2")+".Color"+(i.includes(".Opacity")?".Opacity":"");return t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty(i,e.GetPropertyValue().Value)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty(a,e.GetPropertyValue().Value)),this._parent(e,t)}if("Collab.Is.Paper"===i){var o=this.getScaledDimensions(e.GetPropertyValue().Value);for(let e in o)t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty(e,o[e]));return t.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,t)}return this._parent(e,t)}},getFormatPainterCompatibilityClass:function(){return"VCXArrow_Spec"}})})),define("DS/VCXWebDressup/VCXArrow/VCXLinearArrowModifiable",["DS/VCXWebDressup/VCXArrow/VCXArrowModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueVector"],(function(e,t,i,r,a,o,s){"use strict";return e.extend({init:function(){this._parent()},Build:function(){this._parent();var e=[{Name:"Arrow.Fixed.Length",Type:i,DefaultValue:!1,GroupId:"Group.Arrow"},{Name:"Arrow.Length",Type:r,DefaultValue:20,GroupId:"Group.Arrow"},{Name:"Arrow.Billboarded",Type:i,DefaultValue:!0,GroupId:"Group.Arrow",FormatPainter:!0},{Name:"Arrow.ZRotation",Type:r,DefaultValue:90,Bounds:{Min:0,Max:180,Step:1},GroupId:"Group.Arrow",visibleInPropertyGroups:!1},{Name:"Collab.Border.AlwaysVisible",Type:i,DefaultValue:!1},{Name:"Arrow.Head.2.Position.Is.Paper",Type:i,DefaultValue:!1,GroupId:"Group.Arrow.Head.2",visibleInPropertyGroups:!1},{Name:"Arrow.Head.2.Position.X",Type:r,DefaultValue:0,GroupId:"Group.Arrow.Head.2",visibleInPropertyGroups:!1},{Name:"Arrow.Head.2.Position.Y",Type:r,DefaultValue:0,GroupId:"Group.Arrow.Head.2",visibleInPropertyGroups:!1}];this._BuildPropertyValues(e)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Arrow.Length",!this.GetPropertyValue("Arrow.Fixed.Length")),this.SetPropertyInvisible("Arrow.Head.2.Position.Is.Paper",!0),this.SetPropertyInvisible("Arrow.Head.2.Position.X",!0),this.SetPropertyInvisible("Arrow.Head.2.Position.Y",!0);var e=this.GetProperty("Actor.Anchor.1")&&this.GetProperty("Actor.Anchor.1").GetPropertyValue()&&this.GetProperty("Actor.Anchor.1").GetPropertyValue().GetValueLink()&&this.GetProperty("Actor.Anchor.1").GetPropertyValue().GetValueLink().Value;this.SetPropertyInvisible("Arrow.Billboarded",!e),this.SetPropertyInvisible("Arrow.ZRotation",!(e&&!this.GetPropertyValue("Arrow.Billboarded")))}})})),define("DS/VCXWebDressup/VCXArrow/VCXCornerArrowModifiable",["DS/VCXWebDressup/VCXArrow/VCXArrowModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueVector"],(function(e,t,i,r,a,o){"use strict";return e.extend({init:function(){this._parent(),this._handleAnchor=null},Build:function(){this._parent();var e=[{Name:"Arrow.Corner.Length.1",Type:i,DefaultValue:50,GroupId:"Group.Arrow"},{Name:"Arrow.Corner.Length.2",Type:i,DefaultValue:50,GroupId:"Group.Arrow"}];this._BuildPropertyValues(e)}})})),define("DS/VCXWebDressup/VCXArrow/VCXArrowNode",["DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory"],(function(e,t,i,r){"use strict";return e.extend({init:function(e){return this._parent(e),this._Node=null,this._verticesNb=null,this._trianglesIndicesNb=null,this._lineIndicesNb=null,this},_Build:function(){var a=0,o=0,s=0,n=0;this._verticesNb=2*this._step+8,this._lineIndicesNb=2*this._verticesNb;var l=2*this._step+6;this._trianglesIndicesNb=3*l,this._bkGrndPrimGrp=new i.PrimitiveGroup({editable:!0}),this._borderPrimGrp=new i.PrimitiveGroup({editable:!0});var p=new i.Buffer({component:i.VertexComponentEnum.POSITION,data:new Float32Array(3*this._verticesNb),dimension:3}),u=new i.Buffer({component:i.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(4*this._verticesNb),dimension:4}),h=new i.Buffer({indexBuffer:!0,data:new Uint16Array(this._trianglesIndicesNb)}),d=new i.Buffer({component:i.VertexComponentEnum.POSITION,data:new Float32Array(3*this._verticesNb),dimension:3}),c=new i.Buffer({component:i.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(4*this._verticesNb),dimension:4}),C=new i.Buffer({indexBuffer:!0,data:new Uint16Array(this._lineIndicesNb)});this._bkGrndPrimGrp.addBuffer(0,p),this._bkGrndPrimGrp.addBuffer(1,u),this._bkGrndPrimGrp.addBuffer(2,h),this._borderPrimGrp.addBuffer(0,d),this._borderPrimGrp.addBuffer(1,c),this._borderPrimGrp.addBuffer(2,C);var y=h.data;for(y[a++]=0,y[a++]=1,y[a++]=2,y[a++]=0,y[a++]=2,y[a++]=2*this._step+6,y[a++]=0,y[a++]=2*this._step+6,y[a++]=2*this._step+7,o=2;o<this._step+2;++o)s=o+1,n=this._verticesNb-o,y[a++]=o,y[a++]=s,y[a++]=n,y[a++]=n,y[a++]=s,y[a++]=n-1;for(y[a++]=this._step+2,y[a++]=this._step+3,y[a++]=this._step+4,y[a++]=this._step+2,y[a++]=this._step+4,y[a++]=this._step+6,y[a++]=this._step+6,y[a++]=this._step+4,y[a++]=this._step+5,y=C.data,a=0,o=0;o<this._verticesNb;o++)y[a++]=o,y[a++]=o===this._verticesNb-1?0:o+1;var m=new i.Primitive({nbIndices:this._trianglesIndicesNb,connectivity:i.ConnectivityTypeEnum.TRIANGLES}),V=new i.VertexComponent({nbVertices:this._verticesNb,bufferId:0,indices:new i.IndexArray({bufferId:2,offset:0})}),f=new i.VertexComponent({nbVertices:this._verticesNb,bufferId:1,indices:new i.IndexArray({bufferId:2,offset:0})});m.addVertexComponent(V),m.addVertexComponent(f),this._bkGrndPrimGrp.addPrimitive(m);var b=new i.Primitive({nbIndices:this._lineIndicesNb,connectivity:i.ConnectivityTypeEnum.LINES}),P=new i.VertexComponent({nbVertices:this._verticesNb,bufferId:0,indices:new i.IndexArray({bufferId:2,offset:0})}),g=new i.VertexComponent({nbVertices:this._verticesNb,bufferId:1,indices:new i.IndexArray({bufferId:2,offset:0})});b.addVertexComponent(P),b.addVertexComponent(g),this._borderPrimGrp.addPrimitive(b),this._bodyMat=new t.MeshBasicMaterial({side:t.DoubleSide,vertexColors:t.VertexColors,color:"#ffffff",transparent:!0,opacity:1,force:!0,polygonOffset:!0,polygonOffsetFactor:-1,polygonOffsetUnits:-10});var _=this.Modifiable.getLineMaterialParams("Collab.Border.Line",this._lineMat,this._lastFrontLineType);Object.keys(_).length>0&&("number"==typeof _.type&&_.type!==this._lastFrontLineType&&(this._lastFrontLineType=_.type),_.polygonBorderMode=!0,this._lineMat=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(_,this._lineMat)),this._NodeBkGrnd=r.createMeshNode(this._bkGrndPrimGrp),this._NodeBkGrnd.setMaterial(this._bodyMat),this._NodeBkGrnd.setVisibilityInTree(!1),this._NodeBorder=r.createMeshNode(this._borderPrimGrp),this._NodeBorder.setMaterial(this._lineMat),this._NodeBorder.setVisibilityInTree(!1),this._Node=new e({name:"ArrowCore"}),this._Node.setVisibilityInTree(!0),this._Node.addChild(this._NodeBkGrnd),this._Node.addChild(this._NodeBorder),this.addChild(this._Node,{exludeFromBounding:!1})},preRender:function(e){if(!this._parent(e))return!1;if(!this.viewpointVisibility||!this.GetOpacity(e))return this.setVisibility(!1),!1;if(this.setVisibility(!0),this._lineMat){this._lineMat.handleByPrerender=!0;let e=this.ExperienceBase.getManager("VCXPaperManager").UnitValueToPixel(this.Modifiable.GetPropertyValue("Collab.Border.Line.Width"));this.Modifiable.GetPropertyValue("Collab.Border.AlwaysVisible")||e>=1?(this._lineMat.setLineWidth(e),this._lineMat.visible=!0):this._lineMat.visible=!1}return this._updateNodeBuffers(e,!0),!0},update:function(e){this._parent(e),this.handleLayers()},_updateArrowMaterialsParameters:function(){if(this._Node)if(this._bodyMat&&(this._bodyMat.opacity=this._globalOpacity),this.GetPropertyGroupVisibility("Group.Border")){var e=this.Modifiable.getLineMaterialParams("Collab.Border.Line",this._lineMat,this._lastFrontLineType,this._globalOpacity);Object.keys(e).length>0&&("number"==typeof e.type&&e.type!==this._lastFrontLineType&&(this._lastFrontLineType=e.type),e.polygonBorderMode=!0,this._lineMat=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(e,this._lineMat)),(!this._NodeBorder.material||this._lineMat&&this._NodeBorder.material.id!==this._lineMat.id)&&this._NodeBorder.setMaterial(this._lineMat)}else this._lineMat.opacity=0,this._lineMat.setLineWidth(0)},_updateNodeBuffers:function(e,t){var r=this.Modifiable.GetObject().IsKindOf("VCXLinearArrow_Spec")||!0===this.Modifiable.GetPropertyValue("Collab.Is.Paper")||2===this.Modifiable.GetPropertyValue("Arrow.Circular.Flat");if((t&&r||!t&&!r)&&this._NodeBkGrnd&&this._NodeBorder){var a=this._NodeBkGrnd.getBuffer(i.VertexComponentEnum.POSITION),o=this._NodeBkGrnd.getBuffer(i.VertexComponentEnum.DIFFUSE_COLOR),s=this._NodeBorder.getBuffer(i.VertexComponentEnum.POSITION),n=this._NodeBorder.getBuffer(i.VertexComponentEnum.DIFFUSE_COLOR);if(void 0!==a&&void 0!==o&&void 0!==s&&void 0!==n){var l=this._ComputePosBuffer(e,a,o,s,n);this._NodeBkGrnd.updateBuffer(i.VertexComponentEnum.POSITION,0,l),this._NodeBkGrnd.updateBuffer(i.VertexComponentEnum.DIFFUSE_COLOR,0,l),this._NodeBkGrnd.computeBoundingElements(),this._NodeBorder.updateBuffer(i.VertexComponentEnum.POSITION,0,l),this._NodeBorder.updateBuffer(i.VertexComponentEnum.DIFFUSE_COLOR,0,l),this._NodeBorder.computeBoundingElements()}}},_updateNodePositionFromAnchor:function(e){if(this.GetAnchorWorldMatrix(1,null))console.log("This arrow has another anchor.. may be the one determining the position");else{var i=this.GetAnchorWorldMatrix(0,null);i||(console.warn("No matrix has been found for arrow's anchor.0 position..."),i=new t.Matrix4),e&&i.multiply(e),this.setMatrix(i)}},_fillColorBuffer:function(e,t){var i=0,r=0,a=this.GetColorPropertyValue("Arrow.Body"),o=this.GetColorPropertyValue("Arrow.Body.2"),s=a.GetRGBA(),n=o.GetRGBA(),l=this.GetColorPropertyValue("Collab.Border.Line"),p=this.GetColorPropertyValue("Collab.Border.Line.2"),u=l.GetRGBA(),h=p.GetRGBA(),d=0;for(r=this._verticesNb-2;3!==r;r=++r%this._verticesNb)for(i=4*r,d=0;d<4;i++,d++)e[i]=n[d],t[i]=h[d];for(r=3;r<this._step+2;++r){var c=o.Clone().Lerp(a,(r-2)/this._step),C=p.Clone().Lerp(l,(r-2)/this._step);e[(i=4*r)+0]=c.r,e[i+1]=c.g,e[i+2]=c.b,e[i+3]=c.a,t[i+0]=C.r,t[i+1]=C.g,t[i+2]=C.b,t[i+3]=C.a,e[(i=4*(this._verticesNb-r))+0]=c.r,e[i+1]=c.g,e[i+2]=c.b,e[i+3]=c.a,t[i+0]=C.r,t[i+1]=C.g,t[i+2]=C.b,t[i+3]=C.a}for(r=this._step+2;r<=this._step+6;++r)for(i=4*r,d=0;d<4;i++,d++)e[i]=s[d],t[i]=u[d]}})})),define("DS/VCXWebDressup/VCXPathLines/VCXPathLinesNode",["DS/VCXWebDressup/VCXDressupNode"],(function(e){"use strict";return e.extend({init:function(e){this._parent(e)},CreateUpdateMaterials:function(e){const t=this.ExperienceBase.getManager("VCXMaterialManager");if(!this.Modifiable.GetPropertyValue("Actor.IsAlwaysOnTop")&&this.Modifiable.GetPropertyValue("Collab.Body.Line.UseHiddenStyle")){let i=this.Modifiable.getLineMaterialParams("Collab.Body.Line.Back",this._lineBackMaterial,this._lastBackLineType,this.GetOpacity(e));Object.keys(i).length>0&&("number"==typeof i.type&&i.type!==this._lastBackLineType&&(this._lastBackLineType=i.type),this._lineBackMaterial=t.getLineMaterialFromParams(i,this._lineBackMaterial),i.backMaterial=this._lineBackMaterial)}else this._lineBackMaterial&&0!==this._lineBackMaterial.opacity&&(this._lineBackMaterial=t.getLineMaterialFromParams({opacity:0},this._lineBackMaterial));let i=this.Modifiable.getLineMaterialParams("Collab.Body.Line",this._lineMaterial,this._lastFrontLineType,this.GetOpacity(e));i&&i.type&&"number"==typeof i.type&&i.type!==this._lastFrontLineType&&(this._lastFrontLineType=i.type),Object.keys(i).length>0&&(this._lineBackMaterial&&(i.backMaterial=this._lineBackMaterial),this._lineMaterial=t.getLineMaterialFromParams(i,this._lineMaterial))},GetNode:function(e){return this},update:function(e){this._parent(e);const t=this.ExperienceBase.getManager("VCXPaperManager");if(this._lineBackMaterial){this._lineBackMaterial.handleByPrerender=!0;let e=t.UnitValueToPixel(this.Modifiable.GetPropertyValue("Collab.Body.Line.Back.Width"));if(e>=1){this._lineBackMaterial.setLineWidth(e);let t=!0;const i=this._Modifiable.GetProperty("Back.Line.Show");i&&(t=i.GetPropertyValue().GetValue()),this._lineBackMaterial.visible=t}else this._lineBackMaterial.visible=!1}if(this._lineMaterial){this._lineMaterial.handleByPrerender=!0;let e=t.UnitValueToPixel(this.Modifiable.GetPropertyValue("Collab.Body.Line.Width"));e>=1?(this._lineMaterial.setLineWidth(e),this._lineMaterial.visible=!0):this._lineMaterial.visible=!1}}})})),define("DS/VCXWebDressup/VCXPathLines/VCXPathLinesModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],(function(e){"use strict";const t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e={"Group.Essentials":["Actor.Name","Modifiable.Style","Actor.Color","Actor.Opacity","Collab.Body.Line.UseHiddenStyle"],"Group.FrontLine":["Collab.Body.Line.Color","Collab.Body.Line.Width","Collab.Body.Line.Color.Opacity","Collab.Body.Line.Type","Collab.Body.Line.StipplingMotif"],"Group.BackLine":["Collab.Body.Line.Back.Color","Collab.Body.Line.Back.Width","Collab.Body.Line.Back.Color.Opacity","Collab.Body.Line.Back.Type","Collab.Body.Line.Back.StipplingMotif"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.FrontLine":10,"Group.BackLine":20,"Group.Actions":30}),i},t})),define("DS/VCXWebDressup/VCXPathLines/VCXAssociativePathModifiableView",["DS/VCXWebDressup/VCXPathLines/VCXPathLinesModifiableView"],(function(e){"use strict";const t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){const e={"Group.Essentials":["Actor.Name","Modifiable.Style","Actor.Color","Actor.Opacity"],"Group.Construction":["Path.Construction.Direct","Path.Construction.Direct.Idx","Path.Reference.Type.Idx","Path.Axis.Type"],"Group.Path.Debug":["Path.Extremities.Visible","Path.AxisSystem.Fixed.Visible","Path.AxisSystem.Free.Visible","Path.Level.Ratio"],"Group.FrontLine":["Collab.Body.Line.Color","Collab.Body.Line.Width","Collab.Body.Line.Color.Opacity","Collab.Body.Line.Type","Collab.Body.Line.StipplingMotif"],"Group.BackLine":["Collab.Body.Line.Back.Color","Collab.Body.Line.Back.Width","Collab.Body.Line.Back.Color.Opacity","Collab.Body.Line.Back.Type","Collab.Body.Line.Back.StipplingMotif"]};var t=this._parent()||{};for(const i in e)t[i]=e[i];return t}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Construction":5,"Group.Path.Debug":7,"Group.FrontLine":10,"Group.BackLine":20,"Group.Actions":30}),i},t})),define("DS/VCXWebDressup/VCXPathLines/VCXPolylineModifiableView",["DS/VCXWebDressup/VCXPathLines/VCXPathLinesModifiableView"],(function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e={"Group.Essentials":["Actor.Name","Modifiable.Style","Actor.Color","Actor.Opacity","Polyline.Is.Closed","Collab.Body.Line.UseHiddenStyle"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0}),i},t})),define("DS/VCXWebDressup/VCXViewpoint/VCXCameraNode",["DS/Mesh/MeshUtils","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXMarkup/VCXExtremityNode","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/VCXWebSystem/VCXMathTools","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec"],(function(e,t,i,r,a,o,s,n,l,p){"use strict";return i.extend({init:function(e){return this._parent(e),this._Node=null,this},_getPosVectArray:function(){if(!this.matrixAndDOI){var e=this.Modifiable.QueryInterface("VCXIViewpointController");if(!e)return;this.matrixAndDOI=e.getMatrixAndDOI()}var t=[],i=-this.matrixAndDOI.doi,r=Math.abs(Math.tan(Math.PI*this.GetPropertyValue("Camera.Angle")/360)*i),a=1,o=this.Modifiable.ExperienceBase.getManager("VCXPaperManager");o&&(a=o.Ratio);var n=r/a,l=new s.Vector3(0,0,0);t.push(l);var p=new s.Vector3(0,0,-this.matrixAndDOI.doi);t.push(p);var u=new s.Vector3(-n,r,i);t.push(u);var h=new s.Vector3(n,r,i);t.push(h);var d=new s.Vector3(-n,-r,i);t.push(d);var c=new s.Vector3(n,-r,i);return t.push(c),t},_ComputePosBuffer:function(e){var t=this._getPosVectArray();if(!(Array.isArray(t)&&t.length>0))return t;for(var i=t.length,r=0;r<i;r++)e[3*r+0]=t[r].x,e[3*r+1]=t[r].y,e[3*r+2]=t[r].z;return i},dispose:function(){this._CameraBodyNode&&(this._CameraBodyNode.dispose(),this._CameraBodyNode=null),this._targetExtremityNode&&(this._targetExtremityNode.dispose(),this._targetExtremityNode=null),this._parent()},_Build:function(){if(this._Node||(this._Node=new n,this.add(this._Node)),!this._FrustrumNode&&this.GetPropertyGroupVisibility("Group.Collab.Gizmo")){var i=this._getPosVectArray(),o=new Uint16Array([0,1,0,2,0,3,0,4,0,5,2,3,3,5,5,4,4,2]),u={type:t.ELineType.Plain,lineWidth:1,color:(new s.Color).setRGB(1,1,1)};this._lineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(u,this._lineMaterial);var h={points:i,idx:o,editable:!0,drawMode:e.ConnectivityTypeEnum.LINES,material:this._lineMaterial};this._FrustrumNode=l.createLineNode(h),this._FrustrumNode.setVisibilityInTree(!1),this._FrustrumNode.setPickParent(!0),this._Node.addChild(this._FrustrumNode)}if(!this._targetExtremityNode&&this.GetPropertyGroupVisibility("Group.Collab.Gizmo")){var d={name:"TargetExtremity",modifiable:this.Modifiable,type:p.EExtremityType.Dot};this._targetExtremityNode=new r(d),this.add(this._targetExtremityNode)}if(!this._CameraBodyNode){this._bodyMat=new s.MeshLambertMaterial({side:s.DoubleSide}),this._bodyMat.force=!0;var c=l.createCuboidNode({cornerPoint:new s.Vector3(-8,-10,0),firstAxis:new s.Vector3(16,0,0),secondAxis:new s.Vector3(0,20,0),thirdAxis:new s.Vector3(0,0,40)}),C=l.createCuboidNode({cornerPoint:new s.Vector3(-8.1,-8,5),firstAxis:new s.Vector3(16.2,0,0),secondAxis:new s.Vector3(0,16,0),thirdAxis:new s.Vector3(0,0,30),material:this._bodyMat}),y=l.createCuboidNode({cornerPoint:new s.Vector3(-5,-5,-10),firstAxis:new s.Vector3(10,0,0),secondAxis:new s.Vector3(0,10,0),thirdAxis:new s.Vector3(0,0,20)}),m=l.createCylinderNode({bottomCenterPoint:new s.Vector3(-4,20,30),topCenterPoint:new s.Vector3(4,20,30),radius:9,sag:16,material:this._bodyMat}),V=l.createCylinderNode({bottomCenterPoint:new s.Vector3(-4,20,10),topCenterPoint:new s.Vector3(4,20,10),radius:9,sag:16,material:this._bodyMat});d={name:"CameraBodyNode",experience:this.ExperienceBase,type:this._type};this._CameraBodyNode=new a(d),this._CameraBodyNode.SizeControlType=1,this._CameraBodyNode.ScalingFactor=.2,this._CameraBodyNode.addChild(c),this._CameraBodyNode.addChild(C),this._CameraBodyNode.addChild(y),this._CameraBodyNode.addChild(m),this._CameraBodyNode.addChild(V),this.add(this._CameraBodyNode),this._CameraBodyNode.SetReferential(new s.Matrix4)}},preRender:function(e){if(!this._parent(e))return!1;var t=!1;if(this._Node){var i=o.getOFromMatrix(this._Node.getMatrix()).sub(e.viewpoint.getEyePosition());t=100*i.length()>this.matrixAndDOI.doi&&i.dot(e.viewpoint.getSightDirection())>0&&this._visible,this._Node.setVisibility(t)}this.setVisibility(t),t&&(this._CameraBodyNode&&this._CameraBodyNode.preRender(e),this._targetExtremityNode&&this._targetExtremityNode.preRender(e))},GetNode:function(e){return this},update:function(t){this._parent(t);var i=this.GetOpacity(t);if(this._globalOpacity!==i&&(this._globalOpacity=i,this._visible=this._globalOpacity>0,this._visible&&(this._Node||this._Build()),this.setVisibility(this._visible),this._Node&&this._Node.setVisibility(this._visible)),!(this._globalOpacity<=0)){this._Node||this._Build();var r=this.Modifiable.QueryInterface("VCXIViewpointController");if(r){if(this.matrixAndDOI=r.getMatrixAndDOI(),this._FrustrumNode&&this.GetPropertyGroupVisibility("Group.Collab.Gizmo")){var a=this._FrustrumNode.getBuffer(e.VertexComponentEnum.POSITION);if(void 0!==a){var n=this._ComputePosBuffer(a);this._FrustrumNode.updateBuffer(e.VertexComponentEnum.POSITION,0,n),this._FrustrumNode.computeBoundingElements()}}else this._targetAxisSystemNode&&(this._Node.remove(this._targetAxisSystemNode),this._targetAxisSystemNode=null),this._positionAxisSystemNode&&(this._Node.remove(this._positionAxisSystemNode),this._positionAxisSystemNode=null);this._FrustrumNode&&this._FrustrumNode.setVisibility(this.GetPropertyGroupVisibility("Group.Collab.Gizmo")),this._targetExtremityNode&&this._targetExtremityNode.setVisibility(this.GetPropertyGroupVisibility("Group.Collab.Gizmo"));var l=this.matrixAndDOI.matrix;if(this._Node.setMatrix(l),this._CameraBodyNode&&this._CameraBodyNode.SetReferential(this.matrixAndDOI.matrix),this._targetExtremityNode&&this._targetExtremityNode.update(t),this._positionAxisSystemNode){var p=(new s.Matrix4).getInverse(this.matrixAndDOI.matrix),u=(new s.Matrix4).multiplyMatrices(p,this.GetAnchorWorldMatrix(1,null));this._positionAxisSystemNode.setMatrix(u),this._positionAxisSystemNode.setNoZ(this.GetPropertyValue("Actor.IsAlwaysOnTop"))}if(this._targetAxisSystemNode){p=(new s.Matrix4).getInverse(this.matrixAndDOI.matrix),u=(new s.Matrix4).multiplyMatrices(p,this.GetAnchorWorldMatrix(2,null));this._targetAxisSystemNode.setMatrix(u),this._targetAxisSystemNode.setNoZ(this.GetPropertyValue("Actor.IsAlwaysOnTop"))}if(this._targetExtremityNode&&this._targetExtremityNode.SetReferential(o.getMatrixFromOVx(this.matrixAndDOI.target,o.getVzFromMatrix(this.matrixAndDOI.matrix))),this._bodyMat){var h=this.GetColorPropertyValue("Actor");this._bodyMat.color=h.GetThreeColor(),this._bodyMat.opacity=this._globalOpacity,this._bodyMat.opacity*=h.a}if(this._lineMaterial){var d=this.GetColorPropertyValue("Collab.Gizmo.Line");this._lineMaterial.color=d.GetThreeColor(),this._lineMaterial.opacity=this._globalOpacity*d.a,this._lineMaterial.setLineWidth(this.GetPropertyValue("Collab.Gizmo.Line.Width"))}this.handleLayers()}}}})}));var __decorate=this&&this.__decorate||function(e,t,i,r){var a,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var n=e.length-1;n>=0;n--)(a=e[n])&&(s=(o<3?a(s):o>3?a(t,i,s):a(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXAmbience/AmbienceModel_Spec",["require","exports","DS/Visualization/ThreeJS_DS","WebappsUtils/WebappsUtils","DS/VCXWebDressup/VCXDressup_Spec","DS/VCXWebPlatform/VCX3DSpaceServices","DS/VCXWebPlatform/VCXPlatformServices","DS/VCXWebVisu/VCXAmbienceUtils","DS/VCXWebIO/VCXPixelImage","DS/VCXWebSystem/VCXMutex","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],(function(e,t,i,r,a,o,s,n,l,p,u){"use strict";a=__importDefault(a),o=__importDefault(o),s=__importDefault(s),n=__importDefault(n),l=__importDefault(l),p=__importDefault(p),u=__importDefault(u);class h extends a.default{constructor(){super(...arguments),this._cacheBackgroundThumbnail=null,this._cacheIBLThumbnail=null}CallDispose(){super.CallDispose(),this._ambience&&this._ambience.dispose()}async isPLMAmbience(){return this.QueryInterface("CATI3DXAmbienceAsset")?.isPLMAmbience()}async getBackgroundURL(){return this._cacheBackgroundThumbnail||(this._cacheBackgroundThumbnail=await this._getTextureURL((e=>e?.getBackground()?.getImage()?.getTexture()))),this._cacheBackgroundThumbnail}async getLightningURL(){return this._cacheIBLThumbnail||(this._cacheIBLThumbnail=await this._getTextureURL((e=>e?.getEnvironmentLight()?.getImage()?.getTexture()))),this._cacheIBLThumbnail}async _getTextureURL(e){let t=await(this.QueryInterface("CATI3DXAmbienceAsset")?.getAmbience()),i=await n.default.getPlainImageFromTexture(e(t),92400);return new l.default(i).toDataUrl()??""}async getImageThumbnail(){if(await this.isPLMAmbience()){const e=await o.default.Get3DSpaceURL();let t=await this.QueryInterface("CATI3DXAssetProperties").getPhysicalId();if(e){let i=await s.default.getObjectInfo(t,e);const a=i?.dataelements?.image;let o=r.getWebappsAssetUrl("VCXWebAuthoringApp","ambiences/Thumbnail_vide_ambience_v4.png");return a&&!a.includes("enovia")&&(o=a),o}}else{let e=this.QueryInterface("VCXIModifiable"),t=e?.GetPropertyValue("Ambience.LibrarySourceName"),i=e?.GetPropertyValue("Ambience.CreatedByUser");if(!i)return r.getWebappsAssetUrl("VCXWebAuthoringApp","ambiences/library/"+t+".jpg")}return this.getBackgroundURL()}getAmbience(){return this._ambience}async _getAmbienceAsync(){this._ambience=null;var e=this.QueryInterface("CATI3DXAmbienceAsset");let t=await e.getAmbience();if(t){if(!this._experienceBase.isValid)return void console.error(new Error("Experience not valid anymore"));this.setDirty(!0)}return this._ambience=t,this._ambience}async getAmbienceAsync(){if(this._ambience)return this._ambience;let e=this._getAmbienceAsync();this._experienceBase.getManager("VCXNotificationManager").addProgressNotification({strObjectType:u.default["ProgressNotification.Ambience"],strObjectName:this.QueryInterface("VCXIModifiable")?.GetPropertyValue("Actor.Name"),iPromise:e});var t=this.QueryInterface("VCXIReadiness");return t?.registerPromise(e),e}async getAmbienceSourceInfo(){let e=await this._experienceBase.getManager("VCXEWSManager").GetFactory();if(await(this.QueryInterface("CATI3DXAmbienceAsset")?.isPLMAmbience())){let t=await this.QueryInterface("CATI3DXAssetProperties").getPhysicalId();return await e.getAmbienceVisu(t)}{let t=await e.getNonPLMAmbienceVisu(this._experienceBase.getManager("VCXEWSManager").GetCAT3DXModel()._getDataFromExpObject(this));return t?JSON.parse(t.getText()):null}}}return __decorate([p.default.RunExclusive],h.prototype,"getBackgroundURL",null),__decorate([p.default.RunExclusive],h.prototype,"getLightningURL",null),__decorate([p.default.RunExclusive],h.prototype,"getImageThumbnail",null),__decorate([p.default.RunExclusive],h.prototype,"getAmbienceAsync",null),function(e){let t;!function(e){e[e.Map_360=0]="Map_360",e[e.Backplate=1]="Backplate"}(t=e.TypeBackground||(e.TypeBackground={}))}(h||(h={})),h.prototype.getDefaultName=function(){return"Ambience"},Object.defineProperty(h.prototype,"componentType",{enumerable:!0,get:function(){return"AmbienceModel_Spec"}}),h.prototype.dressupGroupName="Ambiences",h})),define("DS/VCXWebDressup/VCXAmbience/VCXAmbienceModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/CoreEvents/Events","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValuePoint","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebDressup/VCXAmbience/AmbienceModel_Spec","DS/VCXWebProperties/VCXPropertyValueBase64"],(function(e,t,i,r,a,o,s,n,l,p){"use strict";return e.extend({init:function(){this._parent(),this._bIsGround=!0,this._envMapNeverLoaded=!1},Build:function(){this._parent();var e=[{Name:"Actor.Opacity",visibleInPropertyGroups:!1},{Name:"Ambience.Lighting.Exposure",Type:r,DefaultValue:0,Bounds:{Min:-9,Max:9,Step:.1},GroupId:"Group.Ambience.Lighting",FormatPainter:!0},{Name:"Ambience.Lighting.Rotation",Type:r,DefaultValue:0,Bounds:{Min:-180,Max:180,Step:1},GroupId:"Group.Ambience.Lighting",FormatPainter:!0},{Name:"Ambience.Lighting.InputFile",Persistent:!1,BehaviorType:2,Type:p,DefaultValue:"",GroupId:"Group.Ambience.Lighting",FormatPainter:!1},{Name:"Ambience.Background.Type",Persistent:!1,BehaviorType:2,Type:n,DefaultValue:l.TypeBackground.Map_360,MapChoice:this._generateMapChoiceFromEnumAndId(l.TypeBackground,"Ambience"),GroupId:"Group.Ambience.Background",FormatPainter:!1},{Name:"Ambience.Background.Background.InputFile",Persistent:!1,BehaviorType:2,Type:p,DefaultValue:"",GroupId:"Group.Ambience.Background",FormatPainter:!1},{Name:"Ambience.Background.Backplate.InputFile",Persistent:!1,BehaviorType:2,Type:p,DefaultValue:"",GroupId:"Group.Ambience.Background",FormatPainter:!1},{Name:"Ambience.Background.Finite",Type:i,DefaultValue:!0,GroupId:"Group.Ambience.Background",FormatPainter:!0},{Name:"Ambience.Background.Radius.Auto",Type:i,DefaultValue:!0,GroupId:"Group.Ambience.Background",FormatPainter:!0},{Name:"Ambience.Background.Radius.FinalValue",Type:r,DefaultValue:15e3,GroupId:"Group.Ambience.Background",FormatPainter:!0,visibleInPropertyGroups:!1},{Name:"Ambience.Background.Radius",Type:r,DefaultValue:15e3,GroupId:"Group.Ambience.Background",FormatPainter:!0},{Name:"Ambience.Background.Position.Auto",Type:i,DefaultValue:!0,GroupId:"Group.Ambience.Background",FormatPainter:!0},{Name:"Ambience.Background.Position.FinalValue",Type:a,DefaultValue:new o.Vector3,GroupId:"Group.Ambience.Background",FormatPainter:!0,visibleInPropertyGroups:!1},{Name:"Ambience.Background.Position",Type:a,DefaultValue:new o.Vector3,GroupId:"Group.Ambience.Background",FormatPainter:!0},{Name:"Ambience.Background.Rotation",Type:r,DefaultValue:0,Bounds:{Min:-180,Max:180,Step:1},GroupId:"Group.Ambience.Background",FormatPainter:!0},{Name:"Ambience.Background.Exposure",Type:r,DefaultValue:0,Bounds:{Min:-9,Max:9,Step:.1},GroupId:"Group.Ambience.Background",FormatPainter:!0},{Name:"Ambience.Ground.Scaleratio",Type:r,DefaultValue:.8,Bounds:{Min:.01,Max:6,Step:.1},GroupId:"Group.Ambience.Ground",FormatPainter:!0},{Name:"Ambience.Ground.Offset",Type:r,DefaultValue:0,GroupId:"Group.Ambience.Ground",FormatPainter:!0},{Name:"Ambience.Ground.Reflectivity",Type:r,DefaultValue:0,Bounds:{Min:0,Max:100,Step:.1},GroupId:"Group.Ambience.Ground",FormatPainter:!0},{Name:"Ambience.Ground.Glossiness",Type:r,DefaultValue:0,Bounds:{Min:0,Max:100,Step:.1,Decimals:1},GroupId:"Group.Ambience.Ground",FormatPainter:!0},{Name:"Ambience.Ground.ShadowIntensity",Type:r,DefaultValue:0,Bounds:{Min:0,Max:100,Step:.1},GroupId:"Group.Ambience.Ground",FormatPainter:!0},{Name:"Ambience.DefaultAmbience",BehaviorType:2,Type:i,DefaultValue:!1,GroupId:"Group.Ambience",FormatPainter:!0,visibleInPropertyGroups:!1},{Name:"Ambience.LibrarySourceName",BehaviorType:2,Type:s,DefaultValue:"Preset_Default",GroupId:"Group.Ambience",FormatPainter:!0,visibleInPropertyGroups:!1},{Name:"Ambience.CreatedByUser",BehaviorType:2,Type:i,DefaultValue:!1,GroupId:"Group.Ambience",FormatPainter:!0,visibleInPropertyGroups:!1}];this._BuildPropertyValues(e)},OnChangePropertiesEnd:function(){t.publish({event:"VCX_ENVIRONNEMENT_PROPERTY_CHANGED"}),this._parent()},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Actor.Color",!0),this.GetProperty("Actor.Color").GetPropertyInfo()._bPersistent=!1,this.SetPropertyInvisible("Actor.Color.Defined",!0),this.GetProperty("Actor.Color.Defined").GetPropertyInfo()._bPersistent=!1,this.SetPropertyInvisible("Actor.Opacity",!0),this.GetProperty("Actor.Opacity").GetPropertyInfo()._bPersistent=!1,this.GetProperty("Actor.Opacity").GetPropertyInfo(),this.SetPropertyInvisible("Actor.IsAlwaysOnTop",!0),this.GetProperty("Actor.Opacity").GetPropertyInfo()._bPersistent=!1;let t=this.GetPropertyValue("Ambience.Background.Finite"),i=this.GetPropertyValue("Ambience.Background.Position.Auto"),r=this.GetPropertyValue("Ambience.Background.Radius.Auto"),a=this.GetPropertyValue("Ambience.Background.Type")===l.TypeBackground.Map_360;this.SetPropertyInvisible("Ambience.Background.Finite",!a),this.SetPropertyInvisible("Ambience.Background.Position.Auto",!(a&t)),this.SetPropertyInvisible("Ambience.Background.Radius.Auto",!(a&t)),this.SetPropertyInvisible("Ambience.Background.Position",!(a&t&!i)),this.SetPropertyInvisible("Ambience.Background.Radius",!(a&t&!r)),this.SetPropertyInvisible("Ambience.Background.Rotation",!a),this.SetPropertyInvisible("Ambience.Background.Exposure",!a),this.SetPropertyInvisible("Ambience.Background.Background.InputFile",!a),this.SetPropertyInvisible("Ambience.Background.Backplate.InputFile",a),this.ChangeGroupAvailability("Group.Actions",e.EAvailability.AppForceNotAvailable)},RequestModification:function(e,t){if(e){var i=e.GetPropertyInfo().GetPropertyName();return!e.GetPropertyValue().Value||"Ambience.Background.Background.InputFile"!==i&&"Ambience.Background.Backplate.InputFile"!==i&&"Ambience.Lighting.InputFile"!==i||(this.GetObject()._experienceBase.getManager("VCXGUIManager").GetGUIComponentFromName("VCXAmbienceCtrl").showChangeSourcePanel({blobURL:e.GetPropertyValue().Value,comeFrom:"Ambience.Background.Background.InputFile"===i?1:"Ambience.Background.Backplate.InputFile"===i?2:3}),e.SetPropertyValue(new p(""))),this._parent(e,t)}}})})),define("DS/VCXWebDressup/VCXAmbience/VCXAmbienceModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView","DS/VCXWebDressup/VCXAmbience/AmbienceModel_Spec"],(function(e,t){"use strict";var i=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Ambience.Lighting":["Ambience.Lighting.InputFile","Ambience.Lighting.Exposure","Ambience.Lighting.Rotation"],"Group.Ambience.Background":["Ambience.Background.Type","Ambience.Background.Background.InputFile","Ambience.Background.Backplate.InputFile","Ambience.Background.Finite","Ambience.Background.Radius.Auto","Ambience.Background.Radius","Ambience.Background.Position.Auto","Ambience.Background.Position"],"Group.Ambience.Ground":["Ambience.Ground.Scaleratio","Ambience.Ground.Offset","Ambience.Ground.Reflectivity","Ambience.Ground.Glossiness","Ambience.Ground.ShadowIntensity"]}),e},getAdditionalPropertySettings:function(e){let t=this._parent()||{};t["Ambience.Background.Type"]={displayStyle:"buttonGroup",hiddenLabel:!0};let i={fileTypes:".png,.hdr,.jpg,.jpeg"};return t["Ambience.Background.Backplate.InputFile"]=i,t["Ambience.Background.Background.InputFile"]=i,t["Ambience.Lighting.InputFile"]=i,t}});return i.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Ambience.Lighting":10,"Group.Ambience.Background":20,"Group.Ambience.Ground":30}),i},i})),define("DS/VCXWebDressup/VCXMarkup/VCXAttachSegmentNode",["DS/Mesh/MeshUtils","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXDressup_Spec","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXMarkup/VCXExtremityNode","DS/VCXWebSystem/VCXMathTools","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS"],(function(e,t,i,r,a,o,s,n,l){"use strict";var p=a.extend({init:function(e){return this._parent(e),this.anchorID=e.anchorID,this._StartExtremity=new l.Vector3,this._BreakExtremity=new l.Vector3,this._EndExtremity=new l.Vector3,this._EndExtremityType=t.EExtremityType.Dot,e&&"number"==typeof e.endExtremityType&&(this._EndExtremityType=e.endExtremityType),this},_ComputePosBuffer:function(e){return e[0]=this.StartExtremity.x,e[1]=this.StartExtremity.y,e[2]=this.StartExtremity.z,e[3]=this.BreakExtremity.x,e[4]=this.BreakExtremity.y,e[5]=this.BreakExtremity.z,e[6]=this.EndExtremity.x,e[7]=this.EndExtremity.y,e[8]=this.EndExtremity.z,3},dispose:function(){this._Node&&this.removeChild(this._Node),this._ExtremityNode&&(this._ExtremityNode.dispose(),this.removeChild(this._ExtremityNode)),this._ExtremityStart&&(this._ExtremityStart.dispose(),this.removeChild(this._ExtremityStart)),this._ExtremityBreak&&(this._ExtremityBreak.dispose(),this.removeChild(this._ExtremityBreak)),this._parent()},_Build:function(){this._PrimitiveGroup=new e.PrimitiveGroup({editable:!0,lineGAS:new e.LineAttributes(this.GetColorPropertyValue("Collab.Attach.Line").GetThreeColor(),this.GetPropertyValue("Collab.Attach.Line.Width"))});var i=new e.Buffer({component:e.VertexComponentEnum.POSITION,data:new Float32Array(9),dimension:3}),r=new e.Buffer({indexBuffer:!0,data:new Uint16Array(4)});this._PrimitiveGroup.addBuffer(0,i),this._PrimitiveGroup.addBuffer(1,r),this._ComputePosBuffer(i.data);var a=r.data;a[0]=0,a[1]=1,a[2]=1,a[3]=2;var s=new e.VertexComponent({bufferId:0,indices:new e.IndexArray({bufferId:1,offset:0})}),l=new e.Primitive({nbIndices:4,connectivity:e.ConnectivityTypeEnum.LINES,fillGAS:new e.FillAttributes(this.GetColorPropertyValue("Collab.Attach.Line").GetThreeColor()),lineGAS:new e.LineAttributes(this.GetColorPropertyValue("Collab.Attach.Line").GetThreeColor(),this.GetPropertyValue("Collab.Attach.Line.Width"))});l.addVertexComponent(s),this._PrimitiveGroup.addPrimitive(l);var p=this.Modifiable.getLineMaterialParams("Collab.Attach.Line",this._lineMaterial,this._lastFrontLineType);if(Object.keys(p).length>0&&("number"==typeof p.type&&p.type!==this._lastFrontLineType&&(this._lastFrontLineType=p.type),this._lineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(p,this._lineMaterial)),this._Node=n.createMeshNode(this._PrimitiveGroup,this._lineMaterial),this.add(this._Node),this.GetPropertyValue("Collab.Attach.BentDot")){var u={name:this.name+" ExtremityBreak",experience:this.ExperienceBase,modifiable:this.Modifiable,anchorID:this.anchorID,type:t.EExtremityType.Dot};this._ExtremityBreak=new o(u),this.add(this._ExtremityBreak)}this.handleLayers(!0)},preRender:function(t){if(this._parent(t),this.viewpointVisibility&&this.GetOpacity(t)){if(this.setVisibility(!0),this._lineMaterial){this._lineMaterial.handleByPrerender=!0;let e=this.ExperienceBase.getManager("VCXPaperManager").UnitValueToPixel(this.Modifiable.GetPropertyValue("Collab.Attach.Line.Width"));this.Modifiable.GetPropertyValue("Collab.Lead.AlwaysVisible")||e>=1?(this._lineMaterial.setLineWidth(e),this._lineMaterial.visible=!0):this._lineMaterial.visible=!1}if(this._Node){var i=this._Node.getBuffer(e.VertexComponentEnum.POSITION);if(void 0!==i){var r=this._ComputePosBuffer(i);this._Node.updateBuffer(e.VertexComponentEnum.POSITION,0,r),this._Node.computeBoundingElements()}}if(this._ExtremityNode){var a=(new l.Vector3).subVectors(this.EndExtremity,this.BreakExtremity);this._ExtremityNode.SetReferential(s.getMatrixFromOVx(this.EndExtremity,a)),this._ExtremityNode.preRender(t)}if(this._ExtremityStart){a=(new l.Vector3).subVectors(this.BreakExtremity,this.StartExtremity);this._ExtremityStart.SetReferential(s.getMatrixFromOVx(this.StartExtremity,a)),this._ExtremityStart.preRender(t)}if(this._ExtremityBreak){a=(new l.Vector3).subVectors(this.BreakExtremity,this.StartExtremity);this._ExtremityBreak.SetReferential(s.getMatrixFromOVx(this.BreakExtremity,a)),this._ExtremityBreak.preRender(t)}}else this.setVisibility(!1)},update:function(e){if(this._parent(e),this._globalOpacity!==this.GetOpacity(e)){this._globalOpacity=this.GetOpacity(e);var t=this._globalOpacity>0;t&&(this._Node||this._Build()),this._Node&&this._Node.setVisibility(t),this._ExtremityNode&&this._ExtremityNode.setVisibility(t),this._ExtremityBreak&&this._ExtremityBreak.setVisibility(t),this._ExtremityEnd&&this._ExtremityEnd.setVisibility(t)}if(!(this._globalOpacity<=0)){if(this._EndExtremityType=this.GetPropertyValue("Collab.Attach.ExtremityType"),this._previousEndExtremityType!==this._EndExtremityType&&(this._previousEndExtremityType=this._EndExtremityType,this._ExtremityNode&&(this.remove(this._ExtremityNode),this._ExtremityNode=null),this._EndExtremityType)){var i={name:this.name+" Extremity",modifiable:this.Modifiable,anchorID:this.anchorID,type:this._EndExtremityType};this._ExtremityNode=new o(i),this.add(this._ExtremityNode),this.handleLayers(!0)}if(this._ExtremityNode&&this._ExtremityNode.update(e),this._ExtremityStart&&this._ExtremityStart.update(e),this._ExtremityBreak&&this._ExtremityBreak.update(e),this._Node){var r=this.Modifiable.getLineMaterialParams("Collab.Attach.Line",this._lineMaterial,this._lastFrontLineType,this._globalOpacity);Object.keys(r).length>0&&("number"==typeof r.type&&r.type!==this._lastFrontLineType&&(this._lastFrontLineType=r.type),this._lineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(r,this._lineMaterial)),(!this._Node.material||this._lineMaterial&&this._Node.material.id!==this._lineMaterial.id)&&this._Node.setMaterial(this._lineMaterial),this.handleLayers()}}},postUpdate:function(e){this._parent(e),this._ExtremityNode&&this._ExtremityNode.postUpdate(e),this._ExtremityStart&&this._ExtremityStart.postUpdate(e),this._ExtremityBreak&&this._ExtremityBreak.postUpdate(e)}});return Object.defineProperty(p.prototype,"StartExtremity",{enumerable:!0,get:function(){return this._StartExtremity},set:function(e){this._StartExtremity=e}}),Object.defineProperty(p.prototype,"BreakExtremity",{enumerable:!0,get:function(){return this._BreakExtremity},set:function(e){this._BreakExtremity=e}}),Object.defineProperty(p.prototype,"EndExtremity",{enumerable:!0,get:function(){return this._EndExtremity},set:function(e){this._EndExtremity=e}}),Object.defineProperty(p.prototype,"EndExtremityType",{enumerable:!0,get:function(){return this._EndExtremityType},set:function(e){this._EndExtremityType=e}}),p})),define("DS/VCXWebDressup/VCXArrow/VCXArrowModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],(function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Arrow.Head":["Arrow.Body.Color","Arrow.Body.Color.Opacity","Arrow.Width.1","Arrow.Head.ShowMode","Arrow.Head.Length","Arrow.Head.Size","Arrow.Head.Shape"],"Group.Arrow.Head.2":["Arrow.Body.2.Color","Arrow.Body.2.Color.Opacity","Arrow.Width.2","Arrow.Head.2.ShowMode","Arrow.Head.2.Length","Arrow.Head.2.Size","Arrow.Head.2.Shape"],"Group.Border":["Collab.Border.Line.Color","Collab.Border.Line.Color.Opacity","Collab.Border.Line.Width","Collab.Border.Line.Type","Collab.Border.Line.2.Color","Collab.Border.Line.2.Color.Opacity"]}),e}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Arrow":10,"Group.Arrow.Head":20,"Group.Arrow.Head.2":30,"Group.Border":35,"Group.Actions":100}),i},t})),define("DS/VCXWebDressup/VCXArrow/VCXCircularArrowModifiableView",["DS/VCXWebDressup/VCXArrow/VCXArrowModifiableView"],(function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Arrow":["Arrow.Circular.Radius","Arrow.Circular.Angle","Arrow.Circular.Step","Arrow.Circular.Flat","Arrow.Scale","Collab.Is.Paper"]}),e}});return t.prototype._getGroupsPriorities=function(t){return e.prototype._getGroupsPriorities()},t})),define("DS/VCXWebDressup/VCXArrow/VCXLinearArrowModifiableView",["DS/VCXWebDressup/VCXArrow/VCXArrowModifiableView"],(function(e){"use strict";return e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Arrow":["Arrow.Fixed.Length","Arrow.Length","Arrow.Scale","Collab.Is.Paper","Arrow.Billboarded","Arrow.ZRotation"]}),e}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXHotspot/VCXHotspot_Spec",["require","exports","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{}return r.maxRadius=25,function(e){let t;!function(e){e[e.Circle=3]="Circle",e[e.Square=20]="Square",e[e.RoundedSquare=2]="RoundedSquare",e[e.Rhombus=5]="Rhombus"}(t=e.EShapeType||(e.EShapeType={}))}(r||(r={})),r.prototype.getDefaultName=function(){return"Hotspot"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXHotspot_Spec"}}),r.prototype.dressupGroupName="Hotspots",r})),define("DS/VCXWebDressup/VCXHotspot/VCXHotspotModifiable",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXHotspot/VCXHotspot_Spec","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueDocId","DS/VCXWebSystem/VCXMathTools"],(function(e,t,i,r,a,o,s,n,l,p){"use strict";return i.extend({init:function(){this._parent(),this._bIsHotspot=!0},Build:function(){this._parent();var i=[{Name:"Hotspot.Radius",Type:o,DefaultValue:5,GroupId:"Group.Essentials",Bounds:{Min:0,Max:100,Step:.1},FormatPainter:!0},{Name:"Hotspot.Radius.Variation.Max",Type:o,DefaultValue:.5,GroupId:"Group.Essentials",Bounds:{Min:0,Max:5,Step:.1},visibleInPropertyGroups:!1},{Name:"Hotspot.Radius.Variation",Type:o,DefaultValue:1,GroupId:"Group.Essentials",Bounds:{Min:0,Max:1,Step:.1},visibleInPropertyGroups:!1},{Name:"Hotspot.Angle.Inner",Type:o,DefaultValue:360,GroupId:"Group.Hotspot.Center",Bounds:{Min:0,Max:360,Step:1},FormatPainter:!0,visibleInPropertyGroups:!1},{Name:"Collab.Body.Shape.Inner",Type:n,DefaultValue:t.EShapeType.Circle,GroupId:"Group.Hotspot.Center",MapChoice:this._generateMapChoiceFromEnumAndId(t.EShapeType,"Collab.Body.Shape"),FormatPainter:!0},{Name:"Hotspot.Radius.Inner",Type:o,DefaultValue:50,Bounds:{Min:0,Max:100,Step:.1},GroupId:"Group.Hotspot.Center",FormatPainter:!0},{Name:"Collab.Background.Color",Type:s,DefaultValue:(new r).FromRGBA(.953125,.95703125,.9609375,.5),GroupId:"Group.Hotspot.Center",FormatPainter:!0},{Name:"Collab.Background.Color.Opacity",Type:o,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Hotspot.Center",FormatPainter:!0},{Name:"Hotspot.Angle",Type:o,DefaultValue:360,GroupId:"Group.Hotspot.Border",Bounds:{Min:0,Max:360,Step:1},FormatPainter:!0,visibleInPropertyGroups:!1},{Name:"Collab.Body.Shape",Type:n,DefaultValue:t.EShapeType.Circle,GroupId:"Group.Hotspot.Border",MapChoice:this._generateMapChoiceFromEnumAndId(t.EShapeType,"Collab.Body.Shape"),FormatPainter:!0},{Name:"Collab.Body.Line.Color",Type:s,DefaultValue:(new r).FromRGBA(.953125,.95703125,.9609375,1),GroupId:"Group.Hotspot.Border",FormatPainter:!0},{Name:"Collab.Body.Line.Color.Opacity",Type:o,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Hotspot.Border",FormatPainter:!0},{Name:"Collab.Body.Line.Width",Type:o,DefaultValue:1,GroupId:"Group.Hotspot.Border",FormatPainter:!0},{Name:"Collab.Body.Line.Type",Type:n,DefaultValue:e.ELineType.Plain,GroupId:"Group.Hotspot.Border",MapChoice:this._generateMapChoiceFromEnumAndId(e.ELineType,"Collab.DashType",["UserDefined","Advanced"]),FormatPainter:!0},{Name:"Collab.Image.Availability",Type:n,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Image",FormatPainter:!0},{Name:"Collab.Image.Doc.PrepareRender",Type:a,DefaultValue:!1,visibleInPropertyGroups:!1,Persistent:!1},{Name:"Collab.Image.Show",Type:a,DefaultValue:!1,ControlsGroupVisibility:!0,GroupId:"Group.Image",FormatPainter:!0},{Name:"Collab.Image.Doc.ID",Type:l,DefaultValue:-1,GroupId:"Group.Image",FormatPainter:!0},{Name:"Collab.Image.Color",Type:s,DefaultValue:(new r).FromRGBA(1,1,1,1),GroupId:"Group.Image",FormatPainter:!0,visibleInPropertyGroups:!1},{Name:"Collab.Image.Color.Opacity",Type:o,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Image",FormatPainter:!0,visibleInPropertyGroups:!1},{Name:"Collab.Image.Scale",Type:o,DefaultValue:.5,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Image",FormatPainter:!0},{Name:"Collab.Body.Shadow.Availability",Type:n,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Shadow",FormatPainter:!0},{Name:"Collab.Body.Shadow.Show",Type:a,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Shadow",FormatPainter:!0},{Name:"Collab.Body.Shadow.Opacity",Type:o,DefaultValue:.55,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:1,Step:.1}},{Name:"Collab.Body.Shadow.Distance",Type:o,DefaultValue:3,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:20,Step:.1}},{Name:"Collab.Body.Shadow.Orientation",Type:o,DefaultValue:45,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:360,Step:.1}},{Name:"Collab.Body.Shadow.Blur",Type:o,DefaultValue:12,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:20,Step:.1}}];this._BuildPropertyValues(i)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Actor.Color",!0),this.GetProperty("Actor.Color").GetPropertyInfo()._bPersistent=!1},getPropertiesFormatPainter:function(){let e=this._parent();return e.push("Actor.Pulse.Condition"),e.push("Actor.Pulse.Loop"),e.push("Actor.Pulse.Type"),e.push("Actor.Pulse.Sinus"),e.push("Actor.Pulse.Period"),e.push("Actor.Pulse.PauseAnim"),e},GetProperty:function(e){return"Actor.Color"===e?this.GetNewProperty(e,this.GetPropertyValue("Collab.Background.Color")):this._parent(e)},RequestModification:function(e,t){if(e){var i=e.GetPropertyInfo().GetPropertyName();if("Actor.Color"===i){var r=e.GetPropertyValue().Value.getAssociatedColors();return t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Background.Color",r.body)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Body.Line.Color",r.border)),this._parent(e,t)}if("Collab.Is.Paper"===i){var a=this.ExperienceBase.getManager("VCXPaperManager"),o=[{idx:0}];o.forEach((t=>{var i=p.getOFromMatrix(this.GetAnchorWorldMatrix(t.idx)),r=a.GetPaperRatio(null,i),o=1;e.GetPropertyValue().Value?o/=r:o*=r,t.scaleToApply=o}));return[{idx:0,propertyName:"Hotspot.Radius"}].forEach((e=>{var i=this.GetPropertyValue(e.propertyName);i*=o[e.idx].scaleToApply,t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty(e.propertyName,i))})),t.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,t)}}return this._parent(e,t)}})})),define("DS/VCXWebDressup/VCXPathLines/VCXPathLinesModifiable",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueVector"],(function(e,t,i,r,a,o,s,n,l){"use strict";return t.extend({init:function(){this._parent()},Build:function(){this._parent();var t=this._generateMapChoiceFromEnumAndId(e.ELineType,"Collab.DashType"),l=[{Name:"Actor.IsAlwaysOnTop",DefaultValue:!0},{Name:"Collab.Body.Line.UseHiddenStyle",Type:r,DefaultValue:!1,visibleInPropertyGroups:!1},{Name:"Collab.Body.Line.Color",Type:o,DefaultValue:(new i).FromRGBA(0,0,0,1),GroupId:"Group.FrontLine",FormatPainter:!0},{Name:"Collab.Body.Line.Color.Opacity",Type:a,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.FrontLine",FormatPainter:!0},{Name:"Collab.Body.Line.Width",Type:a,DefaultValue:2,GroupId:"Group.FrontLine",FormatPainter:!0},{Name:"Collab.Body.Line.Type",Type:s,DefaultValue:e.ELineType.Plain,GroupId:"Group.FrontLine",MapChoice:t,FormatPainter:!0},{Name:"Collab.Body.Line.StipplingMotif",Type:n,DefaultValue:"0",GroupId:"Group.FrontLine",FormatPainter:!0},{Name:"Collab.Body.Line.Back.Color",Type:o,DefaultValue:(new i).FromRGBA(.5,.5,.5,1),GroupId:"Group.BackLine",FormatPainter:!0},{Name:"Collab.Body.Line.Back.Color.Opacity",Type:a,DefaultValue:.5,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.BackLine",FormatPainter:!0},{Name:"Collab.Body.Line.Back.Type",Type:s,DefaultValue:e.ELineType.SmallDash,GroupId:"Group.BackLine",MapChoice:t,FormatPainter:!0},{Name:"Collab.Body.Line.Back.Width",Type:a,DefaultValue:1.5,GroupId:"Group.BackLine",FormatPainter:!0},{Name:"Collab.Body.Line.Back.StipplingMotif",Type:n,DefaultValue:"0",GroupId:"Group.BackLine",FormatPainter:!0}];this._BuildPropertyValues(l)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Actor.Color",!0),this.GetProperty("Actor.Color").GetPropertyInfo()._bPersistent=!1,this.SetPropertyInvisible("Collab.Body.Line.UseHiddenStyle",!0),this.SetPropertyInvisible("Collab.Body.Line.StipplingMotif",this.GetPropertyValue("Collab.Body.Line.Type")!==e.ELineType.UserDefined),this.SetPropertyInvisible("Collab.Body.Line.Back.StipplingMotif",this.GetPropertyValue("Collab.Body.Line.Back.Type")!==e.ELineType.UserDefined)},GetProperty:function(e){return"Actor.Color"===e?this.GetNewProperty(e,this.GetPropertyValue("Collab.Body.Line.Color")):this._parent(e)},RequestModification:function(e,t){if(e&&"Actor.Color"===e.GetPropertyInfo().GetPropertyName()){var i=e.GetPropertyValue().Value.getAssociatedColors();return t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Body.Line.Color",i.body)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Body.Line.Back.Color",i.border)),this._parent(e,t)}return this._parent(e,t)}})})),define("DS/VCXWebDressup/VCXPathLines/VCXPolylineModifiable",["DS/VCXWebDressup/VCXPathLines/VCXPathLinesModifiable","DS/VCXWebProperties/VCXPropertyValueBoolean"],(function(e,t){"use strict";return e.extend({init:function(){this._bIsPolyline=!0,this._parent()},Build:function(){this._parent();var e=[{Name:"Polyline.Is.Closed",Type:t,DefaultValue:!1}];this._BuildPropertyValues(e)},SetPropertiesInfo:function(){this._parent()},GetProperty:function(e){return this._parent(e)},RequestModification:function(e,t){return this._parent(e,t)}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXPathLines/VCXAssociativePath_Spec",["require","exports","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXDressup_Spec"],(function(e,t,i,r){"use strict";r=__importDefault(r);class a extends r.default{constructor(){super()}preRender(e){super.preRender(e)}update(e){super.update(e)}postUpdate(e){super.postUpdate(e)}Dispose(){}}return function(e){let t,i,r,a;!function(e){e[e.World=0]="World",e[e.Local=1]="Local",e[e.CustomOrigin=2]="CustomOrigin",e[e.CustomDestination=3]="CustomDestination"}(t=e.EReferential||(e.EReferential={})),function(e){e[e.World=0]="World",e[e.Local=1]="Local",e[e.Custom=2]="Custom"}(i=e.EReferentialView||(e.EReferentialView={})),function(e){e[e.XYZ=0]="XYZ",e[e.XZY=1]="XZY",e[e.YXZ=2]="YXZ",e[e.YZX=3]="YZX",e[e.ZXY=4]="ZXY",e[e.ZYX=5]="ZYX"}(r=e.EAxisOrder||(e.EAxisOrder={})),function(e){e[e.Step=0]="Step",e[e.Straight=1]="Straight"}(a=e.EConstructionMode||(e.EConstructionMode={}))}(a||(a={})),a.prototype.getDefaultName=function(){return"Path"},Object.defineProperty(a.prototype,"componentType",{enumerable:!0,get:function(){return"VCXAssociativePath_Spec"}}),a.prototype.dressupGroupName="AssociativePaths",a})),define("DS/VCXWebDressup/VCXPathLines/VCXAssociativePathModifiable",["DS/VCXWebDressup/VCXPathLines/VCXPathLinesModifiable","DS/VCXWebDressup/VCXPathLines/VCXAssociativePath_Spec","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueLink","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueLocation"],(function(e,t,i,r,a,o,s,n,l,p,u,h,d){"use strict";return e.extend({init:function(){this._parent()},Build:function(){this._parent();const e=this.ExperienceBase.getManager("VCXContextManager").isSupported("VCXAssociativePathDebug"),i=[{Name:"Actor.IsAlwaysOnTop",DefaultValue:!0},{Name:"Path.Extremity.Free",Type:d,DefaultValue:(new d).GetValue(),visibleInPropertyGroups:!1,GroupId:"Group.Path.Debug"},{Name:"Path.Extremity.Fixed",Type:d,DefaultValue:(new d).GetValue(),visibleInPropertyGroups:!1,GroupId:"Group.Path.Debug"},{Name:"Path.Manipulation.DefaultRatio",Type:a,DefaultValue:!0,visibleInPropertyGroups:e,GroupId:"Group.Path.Debug"},{Name:"Path.Extremities.Visible",Type:a,DefaultValue:!0,visibleInPropertyGroups:e,GroupId:"Group.Path.Debug"},{Name:"Path.AxisSystem.Fixed.Visible",Type:a,DefaultValue:!1,visibleInPropertyGroups:e,GroupId:"Group.Path.Debug"},{Name:"Back.Line.Show",Type:a,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.BackLine",FormatPainter:!0},{Name:"Path.AxisSystem.Free.Visible",Type:a,DefaultValue:!1,visibleInPropertyGroups:e,GroupId:"Group.Path.Debug"},{Name:"Path.AxisSystem.Global",Type:a,DefaultValue:!1,visibleInPropertyGroups:e,GroupId:"Group.Path.Debug"},{Name:"Actor.Color",DefaultValue:(new r).FromRGBA(.2,.2,0,1)},{Name:"Path.Construction.Direct",Type:a,DefaultValue:!1,visibleInPropertyGroups:!1,GroupId:"Group.Construction"},{Name:"Path.Construction.Direct.Idx",Type:s,DefaultValue:new s(t.EConstructionMode.Step),MapChoice:this._generateMapChoiceFromEnumAndId(t.EConstructionMode),GroupId:"Group.Construction",visibleInPropertyGroups:!0},{Name:"Path.Referential.Local",Type:d,DefaultValue:(new d).GetValue(),visibleInPropertyGroups:!1,GroupId:"Group.Path.Debug"},{Name:"Path.Reference.Type",Type:s,DefaultValue:new s(t.EReferential.World),MapChoice:this._generateMapChoiceFromEnumAndId(t.EReferential),visibleInPropertyGroups:!1,GroupId:"Group.Construction"},{Name:"Path.Reference.Type.Idx",Type:s,DefaultValue:new s(t.EReferentialView.World),MapChoice:this._generateMapChoiceFromEnumAndId(t.EReferentialView,null,["Custom"]),visibleInPropertyGroups:!0,GroupId:"Group.Construction"},{Name:"Path.Axis.Type",Type:s,DefaultValue:new s(t.EAxisOrder.XYZ),MapChoice:this._generateMapChoiceFromEnumAndId(t.EAxisOrder),GroupId:"Group.Construction",visibleInPropertyGroups:!0},{Name:"Path.Linked.Object",Type:l,FormatPainter:!0,visibleInPropertyGroups:!1},{Name:"Path.Level.Ratio",Type:n,DefaultValue:.5,Bounds:{Min:-1,Max:2,Step:.1},visibleInPropertyGroups:e,GroupId:"Group.Path.Debug"},{Name:"Path.Indicator.Length",Type:n,DefaultValue:.35,visibleInPropertyGroups:e,GroupId:"Group.Path.Debug",Bounds:{Min:0,Max:3,Step:.1}},{Name:"Path.Level.Lines",Type:o,DefaultValue:1,visibleInPropertyGroups:!1}];this._BuildPropertyValues(i),this.SetPropertyInvisible("Actor.Position",!0)},SetPropertiesInfo:function(){this._parent()},OnChangeProperty:function(e,t,i){this._parent(e,t,i)},RequestModification:function(e,i){if(e){var r=e.GetPropertyInfo().GetPropertyName();if("Path.Reference.Type"===r){const r=e.GetPropertyValue().GetValue();if(r===t.EReferential.World||r===t.EReferential.Local){const e=t.EReferentialView[r],a=this.GetNewProperty("Path.Reference.Type.Idx",t.EReferentialView[e]);a.GetPropertyInfo().SetMapChoiceEnum(this._generateMapChoiceFromEnumAndId(t.EReferentialView,null,["Custom"])),i.AddOrModifyProperty(this.GetHashing(),a)}else{const e=t.EReferentialView.Custom,r=this.GetNewProperty("Path.Reference.Type.Idx",e);r.GetPropertyInfo().SetMapChoiceEnum(this._generateMapChoiceFromEnumAndId(t.EReferentialView)),i.AddOrModifyProperty(this.GetHashing(),r)}return i.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,i)}if("Path.Reference.Type.Idx"===r){const r=e.GetPropertyValue().GetValue();let a=null;a=r===t.EReferentialView.Custom?t.EReferential.CustomDestination:t.EReferential[t.EReferentialView[r]];const o=this.GetNewProperty("Path.Reference.Type",a);return i.AddOrModifyProperty(this.GetHashing(),o),i.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,i)}if("Path.Construction.Direct"===r){const r=e.GetPropertyValue().GetValue(),a=e.GetPropertyInfo().GetGroupId(),o=this._PropertyGroups[a];o.setVisible("Path.Reference.Type.Idx",!r),o.setVisible("Path.Axis.Type",!r);let s=r?t.EConstructionMode.Straight:t.EConstructionMode.Step;const n=this.GetNewProperty("Path.Construction.Direct.Idx",s);return i.AddOrModifyProperty(this.GetHashing(),n),i.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,i)}if("Path.Construction.Direct.Idx"===r){const r=e.GetPropertyValue().GetValue(),a=this.GetProperty("Path.Construction.Direct").GetPropertyInfo().GetGroupId(),o=this._PropertyGroups[a],s=r===t.EConstructionMode.Straight;o.setVisible("Path.Reference.Type.Idx",!s),o.setVisible("Path.Axis.Type",!s);const n=this.GetNewProperty("Path.Construction.Direct",s);return i.AddOrModifyProperty(this.GetHashing(),n),i.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,i)}if("Path.Extremities.Visible"===r){const t=e.GetPropertyValue().GetValue(),r=e.GetPropertyInfo().GetGroupId(),a=this._PropertyGroups[r];return a.setVisible("Path.AxisSystem.Free.Visible",t),a.setVisible("Path.AxisSystem.Fixed.Visible",t),i.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,i)}}return this._parent(e,i)},getPropertiesToBePasted:function(e){let t=e.Clone();if(e&&e._map){var i=this.ExperienceBase.getManager("VCXExperience");for(let r in e._map)if(e._map.hasOwnProperty(r)){let a=e.GetProperty(r);a&&("Actor.Name"==r&&(a=a.Clone(),a.GetPropertyValue().SetValue(a.GetPropertyValue().GetValue()+" - Copy ("+i._ccp_number+")")),t.AddOrModifyProperty(a))}return t}}})})),define("DS/VCXWebDressup/VCXHotspot/VCXHotspotNode",["DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXHotspot/VCXHotspot_Spec","DS/VCXWebIO/VCXCanvasServices","DS/Mesh/MeshUtils","DS/SceneGraphNodes/CanvasNodeTexture","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/VCXWebSystem/VCXMathTools","DS/VCXWebVisualization/VCXImageManager","DS/VCXWebSystem/VCXHardwareServices"],(function(e,t,i,r,a,o,s,n,l,p,u){"use strict";var h=e.extend({oversizeFactor:2,init:function(e){return this._parent(e),this},dispose:function(){this._Smart3DPaperNode&&(this._Smart3DPaperNode.dispose(),this._Smart3DPaperNode=null),this._canvasNode&&(this._canvasNode=null),this._canvasNodeTexture&&(this._canvasNodeTexture=null),this._HLCanvasNode&&(this._HLCanvasNode=null),this._HLCanvasNodeTexture&&(this._HLCanvasNodeTexture=null),this._parent()},_RotateAround:function(e,t,i){e.translate(t.x,t.y),e.rotate(i*Math.PI/180),e.translate(-t.x,-t.y)},_SetShadow:function(e,t){e.shadowColor="transparent",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,this.GetPropertyGroupVisibility("Group.Shadow")&&(e.shadowColor="rgba(0, 0, 0, "+this.GetPropertyValue("Collab.Body.Shadow.Opacity")+")",e.shadowBlur=.05*t*this.GetPropertyValue("Collab.Body.Shadow.Blur"),e.shadowOffsetX=.1*t*Math.cos(this.GetPropertyValue("Collab.Body.Shadow.Orientation")/180*Math.PI)*this.GetPropertyValue("Collab.Body.Shadow.Distance"),e.shadowOffsetY=.1*t*Math.sin(this.GetPropertyValue("Collab.Body.Shadow.Orientation")/180*Math.PI)*this.GetPropertyValue("Collab.Body.Shadow.Distance"))},drawRegularCanvas:function(e,t,i,r){this.drawCanvas(e,t,r,!1)},drawHLCanvas:function(e,t,i,r){this.drawCanvas(e,t,r,!0)},drawCanvas:function(e,r,a,o){const s=e.width,n=s/this.oversizeFactor,l=.5*s-.5*n,p=l+.5*n,h=n/this.GetRadius(),d=this.GetPropertyValue("Collab.Body.Line.Width");r.lineWidth=.3*h*d;const c=Math.max(1,.5*n),C=Math.max(1,this.Modifiable.GetPropertyValue("Hotspot.Radius.Inner")*c*.01),y={shape:this.Modifiable.GetPropertyValue("Collab.Body.Shape"),x:l,y:l,width:n,height:n,cornerRadius:2*h},m={shape:this.Modifiable.GetPropertyValue("Collab.Body.Shape.Inner"),x:p-C,y:p-C,width:2*C,height:2*C,cornerRadius:2*h};if(!o&&this.Modifiable.GetObject().backgroundImage&&this.Modifiable.GetObject().backgroundImage._IsReadyToUse){r.save(),this._RotateAround(r,{x:p,y:p},this.GetPropertyValue("Hotspot.Angle"));const e=this.GetPropertyValue("Collab.Image.Scale");r.translate(p,p),r.scale(e,e),r.translate(-p,-p),r.globalCompositeOperation="source-over";var V=this.GetColorPropertyValue("Collab.Image"),f=V.a;V.a=1,r.fillStyle=V.GetStyle(),r.globalAlpha=f,u.isIE11()||1===V.r&&1===V.g&&1===V.b?(r.globalCompositeOperation="source-over",r.drawImage(this.Modifiable.GetObject().backgroundImage,0,0,s,s)):(r.globalCompositeOperation="destination-in",r.drawImage(this.Modifiable.GetObject().backgroundImage,0,0,s,s),r.globalCompositeOperation="multiply",r.drawImage(this.Modifiable.GetObject().backgroundImage,0,0,s,s)),r.restore()}if(o||(r.save(),r.fillStyle="#"+this.GetColorPropertyValue("Collab.Background").getHexString(),r.globalAlpha=this._globalOpacity*this.GetColorPropertyValue("Collab.Background").a,this._RotateAround(r,{x:p,y:p},this.GetPropertyValue("Hotspot.Angle.Inner")),i.drawShapePath(r,m,t.EShapeType),r.fill(),r.restore()),r.save(),this._RotateAround(r,{x:p,y:p},this.GetPropertyValue("Hotspot.Angle")),o)r.globalAlpha=.02,i.drawShapePath(r,y,t.EShapeType),r.fill();else{r.strokeStyle="#"+this.GetColorPropertyValue("Collab.Body.Line").getHexString(),r.globalAlpha=this._globalOpacity*this.GetColorPropertyValue("Collab.Body.Line").a;let e=[];switch(this.GetPropertyValue("Collab.Body.Line.Type")){case 1:e=[4,2];break;case 2:e=[6,2];break;case 3:e=[8,2,2,2];break;case 4:e=[8,2];break;case 5:e=[2,2];break;case 6:e=[10,2]}for(let t=0;t<e.length;t++)e[t]*=h;r.setLineDash(e),this._SetShadow(r,h*a),i.drawShapePath(r,y,t.EShapeType),r.stroke()}r.restore()},_Build:function(){var t={name:"HotspotSmartNode",modifiable:this.Modifiable};this._Smart3DPaperNode=new o(t),this._Smart3DPaperNode.SizeControlType=1,this._Smart3DPaperNode.BillboardType=o.BillboardTypeEnum.SPHERICAL;var i=new s.Vector3(-1,-1,0),l=new s.Vector3(2,0,0),p=new s.Vector3(0,2,0);if(this._canvasNodeTexture=new a({width:512,height:512,rectangleTexture:!0,drawCB:this.drawRegularCanvas.bind(this),alphaTest:0,materialParams:{opacity:1,depthTest:!1,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-10,polygonOffsetUnits:-10}}),this._canvasNode=n.createCanvasNode({bottomLeftcorner:i,widthVector:l,heightVector:p,canvasNodeTexture:this._canvasNodeTexture}),this._canvasNode.setPickable(r.PICKTHROUGH),this._canvasNode.rectangle.excludeFromHighlight(!0,!0),this._canvasNode.setVisibilityInTree(!1),this._canvasNode.traverse((function(e,t){return e.noAA=!0,!1}),!0),this._Smart3DPaperNode.add(this._canvasNode,{exludeFromBounding:!0}),this._HLCanvasNodeTexture=new a({width:512,height:512,rectangleTexture:!0,drawCB:this.drawHLCanvas.bind(this),alphaTest:.005,materialParams:{opacity:0,depthTest:!1,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-10,polygonOffsetUnits:-10}}),this._HLCanvasNode=n.createCanvasNode({bottomLeftcorner:i,widthVector:l,heightVector:p,canvasNodeTexture:this._HLCanvasNodeTexture}),this._HLCanvasNode.setVisibilityInTree(!1),this._Smart3DPaperNode.add(this._HLCanvasNode,{exludeFromBounding:!0}),this.add(this._Smart3DPaperNode),!this._radiusHandleNodes){this._radiusHandleNodes=[{id:1}];var u=0;this._radiusHandleNodes.forEach(function(t){var i=(new s.Matrix4).makeRotationZ(u+Math.PI/2),r=(new s.Matrix4).setPosition({x:Math.cos(u),y:Math.sin(u),z:0});u+=Math.PI/2,t.matrixLocal=(new s.Matrix4).multiplyMatrices(r,i),t.node=new e({name:"HotspotCore"}),this._Smart3DPaperNode.add(t.node)}.bind(this))}},preRender:function(e){return!!this._parent(e)&&(this.viewpointVisibility&&this.GetOpacity(e)?(this.setVisibility(!0),this._Smart3DPaperNode&&this._Smart3DPaperNode.preRender(e),!0):(this.setVisibility(!1),!1))},GetVarianceNode(e){return new h({name:e.viewerID+"_"+this.name,modifiable:this.Modifiable,experience:this.ExperienceBase})},GetRadius(){return this.GetPropertyValue("Hotspot.Radius")*t.maxRadius*.01+this.GetPropertyValue("Hotspot.Radius.Variation.Max")*Math.sin((this.GetPropertyValue("Hotspot.Radius.Variation")-1)*Math.PI)},getDocID(){let e=this.GetPropertyValue("Collab.Image.Doc.ID");return null!=e&&this.GetPropertyGroupVisibility("Group.Image")||(e=-1),e},update:function(e){if(this._parent(e),this._globalOpacity!==this.GetOpacity(e)){this._globalOpacity=this.GetOpacity(e);var t=this._globalOpacity>0;t&&(this._Smart3DPaperNode||this._Build()),this._Smart3DPaperNode&&this._Smart3DPaperNode.setVisibility(t)}if(!(this._globalOpacity<=0)&&this._Smart3DPaperNode){this._Smart3DPaperNode.update(e);const t=this.GetRadius(),r=(new s.Matrix4).makeScale(t,t,1);this._radiusHandleNodes.forEach((e=>{var t=(new s.Matrix4).multiplyMatrices(r,e.matrixLocal),i=l.normalizeMatrix(t);i.setPosition(l.getOFromMatrix(t)),e.node.setMatrix(i)}));let a=(new s.Matrix4).makeScale(t*this.oversizeFactor,t*this.oversizeFactor,1);this._canvasNode.setMatrix(a);const o=Math.max(3,t);a=(new s.Matrix4).makeScale(o*this.oversizeFactor,o*this.oversizeFactor,1),this._HLCanvasNode.setMatrix(a);const n=!this.GetPropertyValue("Actor.IsAlwaysOnTop");this._canvasNodeTexture.setMaterialParams({opacity:1,depthTest:n,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-10,polygonOffsetUnits:-10}),this._HLCanvasNodeTexture.setMaterialParams({opacity:0,depthTest:n,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-10,polygonOffsetUnits:-10}),this._canvasNodeTexture.requestRedraw(),this._HLCanvasNodeTexture.requestRedraw();let u=this.getDocID();if(this._previousBackgroundDocID!==u||this.GetPropertyValue("Collab.Image.Doc.PrepareRender"))if(this._previousBackgroundDocID=u,this.GetPropertyValue("Collab.Image.Doc.PrepareRender")&&(this._previousBackgroundDocID=-1),-1!==u){var i=p.Effect.None;this.Modifiable&&this.Modifiable.GetObject().getImage(i).then((()=>{this._canvasNodeTexture.requestRedraw()}))}else this.Modifiable.GetObject().backgroundImage&&this.Modifiable&&(this.Modifiable.GetObject().clearImage(),this._canvasNodeTexture.requestRedraw());this.handleLayers()}}});return h})),define("DS/VCXWebDressup/VCXHotspot/VCXHotspotSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXHotspot/VCXHotspotNode"],(function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Hotspot",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Hotspot.png")}return this._parent()}})})),define("DS/VCXWebDressup/VCXPartList/VCXPartListPaperNode",["DS/VCXWebDressup/VCXSmart3DPaperNode","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","DS/VCXWebSystem/VCXMathTools"],(function(e,t,i,r){"use strict";return e.extend({init:function(e){return this._parent(e),this},update:function(e){if(this._parent(e),this._ModifiableProperties){if(void 0!==this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")){if(this.PositioningType=this.GetPropertyValue("Collab.3D.Paper.Positioning.Type"),this.lastPositioningType!==this.PositioningType){var t=this.PositioningType<=i.EPositionType.Free2D,r=this.Modifiable.QueryInterface("W3AISGNodeHolder").giveSGNode();r.exludeFromBounding&&r.exludeFromBounding(t)}this.lastPositioningType=this.PositioningType}void 0!==this.GetPropertyValue("Collab.3D.Paper.Paper.Position")?this.Position2D=this.GetPropertyValue("Collab.3D.Paper.Paper.Position"):(void 0!==this.GetPropertyValue("Collab.3D.Paper.Paper.Position.X")&&(this.Position2D.x=this.GetPropertyValue("Collab.3D.Paper.Paper.Position.X")),void 0!==this.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y")&&(this.Position2D.y=this.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y")))}},_computeBOMPosition:function(){if(this.Modifiable&&this.Modifiable._bIsPartList){var e=this.Modifiable.GetPropertyValue("Collab.3D.Paper.Positioning.Type");this.Modifiable.GetPropertyValue("Collab.3D.Paper.BOM.Percentage");if(e===i.EPositionType.Free2D)return}},_computeMatrix:function(e,a){var o=this.Position.clone();if(this.PositioningType<=i.EPositionType.Free2D){this._computeBOMPosition();var s=(new t.Vector3).getPositionFromMatrix(this.GetReferential(e)),n=this.ExperienceBase.getManager("VCXPaperManager").ModelToMM2(e,s),l=r.clamp(n.z,-.99,.99);(m=new t.Vector3).x=this.Position2D.x,m.y=this.Position2D.y,m.z=l,o=this.ExperienceBase.getManager("VCXPaperManager").MMToModel2(e,m)}var p=1;if(1===this.SizeControlType)p=this.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(e,o);else if(2===this.SizeControlType){var u=e.viewpoint.getEyePosition().distanceTo(o);u||(u=1);var h=.5*e.viewer.div.clientHeight*Math.abs(1/(Math.tan(Math.PI*e.viewpoint.getAngle()/360)*u));(p=0!==(h*=this.ExperienceBase.getManager("VCXPaperManager").Zoom)?1/h:1)||(p=1)}p*=this.ScalingFactor;var d=this.ExperienceBase.getManager("VCXPaperManager"),c=new t.Matrix4,C=new t.Matrix4,y=new t.Matrix4;if(y.makeScale(p,p,p),this.is2D()&&d.shouldUsePaperReferential()){var m;(m=new t.Vector3).x=this.Position2D.x,m.y=-this.Position2D.y,m.z=0,C.setPosition(m);var V=d.getPaperReferential();c.copy(V),c.multiply(C)}else{C.setPosition(o);var f=this._ComputeBillboardMatrix(e,o,this.GetReferential(e));c.multiply(C),c.multiply(f),c.multiply(y)}return a&&this.setMatrix(c),c}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXViewpoint/VCXViewport_Spec",["require","exports","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXDressup_Spec"],(function(e,t,i,r){"use strict";r=__importDefault(r);class a extends r.default{constructor(){super(),this._hdrUrl=null}Build(){return this}getActiveAmbienceID(){var e=this.QueryInterface("VCXIModifiable");if(e){var t=e.GetPropertyValue("Viewport.ActiveAmbience");if(t&&t.length)return t}return null}setLightingMode(e,t,r,o){var s=this.GetObject()._experienceBase.getManager("VCXContextManager");s.getMainViewer().planeV2=e;var n=!1,l=16777215,p=1,u=null,h=!1,d=16777215,c=1,C=null,y=!1,m=1,V=null;switch(t){case a.ERenderLightingMode.Custom:case a.ERenderLightingMode.Soft:n=!0,p=.8*r,u=new i.Vector3(0,0,1);break;case a.ERenderLightingMode.Medium:var f=.5;n=!0,p=.8*r,u=new i.Vector3(f,f,1),h=!0,c=.8*r,C=new i.Vector3(-f,-f,-1);break;case a.ERenderLightingMode.Metal:f=.7;n=!0,p=r,u=new i.Vector3(f,f,1),h=!0,c=.6*r,C=new i.Vector3(-f,-f,1),y=!0,m=.5*r,V=new i.Vector3(-1,1,-.5);break;case a.ERenderLightingMode.HeavyMetal:f=.7;n=!0,l=15461375,p=.8*r,u=new i.Vector3(2*f,f,1),h=!0,d=15268095,c=.8*r,C=new i.Vector3(-f,-2*f,1),y=!0,m=.5*r,V=new i.Vector3(-1,1,-.5);break;case a.ERenderLightingMode.HighContrast:f=-.7;n=!0,l=16772075,p=.9*r,u=new i.Vector3(2*f,f,1),h=!0,d=15268095,c=.9*r,C=new i.Vector3(-f,-2*f,1),y=!0,m=.5*r,V=new i.Vector3(1,-1,-1);break;case a.ERenderLightingMode.ShadedIllustration:f=.2;n=!0,l=13158455,p=.9*r,u=new i.Vector3(f,0,1),h=!0,d=3618760,c=.9*r,C=new i.Vector3(-f,0,1);break;case a.ERenderLightingMode.Archi:n=!0,p=1,u=new i.Vector3(-1,1,1);break;case a.ERenderLightingMode.DefaultComposer:n=!0,u=new i.Vector3(-.25,.25,.5),h=!0,c=.6,C=new i.Vector3(.25,-.75,0)}var b=!1;e||(p=0,c=0,m=0),s.applyToViewers((function(t){t.setVisuAppearanceMode(e?i.DefaultAppearanceMode.BASIC:i.DefaultAppearanceMode.GASLOOK),n&&u?t.setLightParameters({isPhysical:b,lightIndex:0,intensity:p,color:l,direction:u.normalize(),directionType:"camera"}):t.setLightParameters({lightIndex:0,intensity:0,color:0,direction:new i.Vector3(0,0,1),directionType:"camera"}),h&&C?t.setLightParameters({isPhysical:b,lightIndex:1,intensity:c,color:d,direction:C.normalize(),directionType:"camera"}):t.setLightParameters({lightIndex:1,intensity:0,color:0,direction:new i.Vector3(0,0,1),directionType:"camera"}),y&&V?t.setLightParameters({isPhysical:b,lightIndex:2,intensity:m,color:16777215,direction:V.normalize(),directionType:"camera"}):t.setLightParameters({lightIndex:2,intensity:0,color:0,direction:new i.Vector3(0,0,1),directionType:"camera"})}))}setLightingModeForComposerPlayer(e,t,r,o){var s=this.GetObject()._experienceBase.getManager("VCXContextManager");s.getMainViewer().planeV2=e;var n=!1,l=16777215,p=1,u=null,h=!1,d=16777215,c=1,C=null,y=!1,m=1,V=null,f=null,b=null,P=null;switch(t){case a.ERenderLightingMode.Custom:case a.ERenderLightingMode.Soft:n=!0,p=.8*r,u=new i.Vector3(0,0,1),f=0;break;case a.ERenderLightingMode.Medium:var g=.5;n=!0,p=.8*r,u=new i.Vector3(g,g,1),h=!0,c=.8*r,C=new i.Vector3(-g,-g,-1),f=3355469,b=3355469;break;case a.ERenderLightingMode.Metal:g=.7;n=!0,p=r,u=new i.Vector3(g,g,1),h=!0,c=.6*r,C=new i.Vector3(-g,-g,1),y=!0,m=.5*r,V=new i.Vector3(-1,1,-.5),f=3355443,b=0,P=0;break;case a.ERenderLightingMode.HeavyMetal:g=.7;n=!0,l=15461375,p=.8*r,u=new i.Vector3(2*g,g,1),h=!0,d=15268095,c=.8*r,C=new i.Vector3(-g,-2*g,1),y=!0,m=.5*r,V=new i.Vector3(-1,1,-.5),f=3355443,b=0,P=0;break;case a.ERenderLightingMode.HighContrast:g=-.7;n=!0,l=16772075,p=.9*r,u=new i.Vector3(2*g,g,1),h=!0,d=15268095,c=.9*r,C=new i.Vector3(-g,-2*g,1),y=!0,m=.5*r,V=new i.Vector3(1,-1,-1),f=3355443,b=0,P=0;break;case a.ERenderLightingMode.ShadedIllustration:g=.2;n=!0,l=13158455,p=.9*r,u=new i.Vector3(g,0,1),h=!0,d=3618760,c=.9*r,C=new i.Vector3(-g,0,1),f=this.rgbToHex(1*p,1*p,0*p),b=this.rgbToHex(0*c,0*c,1*c);break;case a.ERenderLightingMode.Archi:n=!0,p=1,u=new i.Vector3(-1,1,1),f=0;break;case a.ERenderLightingMode.DefaultComposer:n=!0,u=new i.Vector3(-.25,.25,.5),h=!0,c=.25,C=new i.Vector3(.25,-.75,0),f=0,b=0}var _=!1;e||(p=0,c=0,m=0),s.applyToViewers((function(t){t.setVisuAppearanceMode(e?i.DefaultAppearanceMode.BASIC:i.DefaultAppearanceMode.GASLOOK),n&&u?(null!==f&&t.setAmbientLight(f),t.setLightParameters({isPhysical:_,lightIndex:0,intensity:p,color:l,direction:u.normalize(),directionType:"camera"})):t.setLightParameters({lightIndex:0,intensity:0,color:0,direction:new i.Vector3(0,0,1),directionType:"camera"}),h&&C?(null!==b&&t.setAmbientLight(b),t.setLightParameters({isPhysical:_,lightIndex:1,intensity:c,color:d,direction:C.normalize(),directionType:"camera"})):t.setLightParameters({lightIndex:1,intensity:0,color:0,direction:new i.Vector3(0,0,1),directionType:"camera"}),y&&V?(null!==P&&t.setAmbientLight(P),t.setLightParameters({isPhysical:_,lightIndex:2,intensity:m,color:16777215,direction:V.normalize(),directionType:"camera"})):t.setLightParameters({lightIndex:2,intensity:0,color:0,direction:new i.Vector3(0,0,1),directionType:"camera"})}))}rgbToHex(e,t,i){e=Math.round(255*e),t=Math.round(255*t),i=Math.round(255*i);let r=e.toString(16),a=t.toString(16),o=i.toString(16);return 1==r.length&&(r="0"+e),1==a.length&&(a="0"+t),1==o.length&&(o="0"+i),parseInt("0x"+r+a+o)}}return function(e){let t,i,r,a,o,s;!function(e){e[e.Portrait=0]="Portrait",e[e.Landscape=1]="Landscape"}(t=e.EPaperOrientation||(e.EPaperOrientation={})),function(e){e[e["X+"]=0]="X+",e[e["Y+"]=1]="Y+",e[e["Z+"]=2]="Z+",e[e["X-"]=3]="X-",e[e["Y-"]=4]="Y-",e[e["Z-"]=5]="Z-"}(i=e.EVertical||(e.EVertical={})),function(e){e[e.NoAA=0]="NoAA",e[e.SMAA=1]="SMAA",e[e.FXAA=3]="FXAA",e[e.FSAA=4]="FSAA",e[e.SSAA=6]="SSAA",e[e.TAA=8]="TAA"}(r=e.EAA||(e.EAA={})),function(e){e[e.NoSSAO=1]="NoSSAO",e[e.OnIdle=2]="OnIdle",e[e.Always=3]="Always"}(a=e.ESSAO||(e.ESSAO={})),function(e){e[e.None=0]="None",e[e.exterior_parking=1]="exterior_parking",e[e.arches_pinetree=2]="arches_pinetree",e[e.barcelona_rooftop=3]="barcelona_rooftop",e[e.exterior_plaza_4=4]="exterior_plaza_4",e[e.exterior_scenic_5=5]="exterior_scenic_5",e[e.exterior_sky=6]="exterior_sky",e[e.interior_apartment_1=7]="interior_apartment_1",e[e.studio_panel_3=8]="studio_panel_3",e[e.studio_spot_1=9]="studio_spot_1",e[e.studio_spot_2=10]="studio_spot_2",e[e.PLM=100]="PLM"}(o=e.EEnvironment||(e.EEnvironment={})),function(e){e[e.Custom=0]="Custom",e[e.Soft=1]="Soft",e[e.Medium=2]="Medium",e[e.Metal=3]="Metal",e[e.HeavyMetal=4]="HeavyMetal",e[e.HighContrast=5]="HighContrast",e[e.ShadedIllustration=6]="ShadedIllustration",e[e.Archi=7]="Archi",e[e.DefaultComposer=8]="DefaultComposer"}(s=e.ERenderLightingMode||(e.ERenderLightingMode={}))}(a||(a={})),a.prototype.getDefaultName=function(){return"Viewport"},Object.defineProperty(a.prototype,"componentType",{enumerable:!0,get:function(){return"VCXViewport_Spec"}}),a.prototype.dressupGroupName="Environment",Object.defineProperty(a.prototype,"renderMode",{enumerable:!0,set:function(e){this._renderMode=e},get:function(){return this._renderMode}}),Object.defineProperty(a.prototype,"outlineType",{enumerable:!0,set:function(e){this._outlineType=e},get:function(){return this._outlineType}}),a})),define("DS/VCXWebDressup/VCXViewpoint/VCXViewportModifiable",["DS/VCXWebDressup/VCXViewpoint/VCXViewport_Spec","DS/CoreEvents/Events","DS/VCXWebDressup/VCXDressupModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelCommands/VCXCmdChangePropertiesVolatile","DS/VCXWebSystem/VCXMathTools","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertyValueLink","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueDocId","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebVisualization/VCXVisuManager","DS/VCXWebVisualization/VCXIViewpointController","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables"],(function(e,t,i,r,a,o,s,n,l,p,u,h,d,c,C,y,m,V,f,b,P,g,_,M){"use strict";return i.extend({init:function(){this._parent(),this._bIsViewport=!0,this._envMapNeverLoaded=!1,this._forceRefresh=!1,this._fullFrameSize=36},Dispose:function(){this._parent(),delete this._currentAmbienceIDXs},Build:function(){this._parent();var t=[{Name:"Actor.Name",Type:C,DefaultValue:"Viewport",i18n:M,visibleInPropertyGroups:!1},{Name:"Camera.Position",Type:c,DefaultValue:new r.Matrix4,Persistent:!1,hiddenFields:["Orientation","Scale"],GroupId:"Group.Camera",visibleInPropertyGroups:!1},{Name:"Camera.Orientation.Preset",Type:h,DefaultValue:_.EViewPosition.Front,GroupId:"Group.Camera.Orientation",MapChoice:this._generateMapChoiceFromEnumAndId(_.EViewPosition,"Camera.Orientation.Preset")},{Name:"Camera.Position.Frame",Type:y,Persistent:!1,GroupId:"Group.Camera.Orientation"},{Name:"Camera.Target.Frame",Type:y,Persistent:!1,GroupId:"Group.Camera.Orientation"},{Name:"Camera.Dolly",Type:p,Persistent:!0,GroupId:"Group.Camera.Perspective"},{Name:"Camera.Focal.Length",Type:u,GroupId:"Group.Camera.Perspective",Persistent:!1,Bounds:{Min:10,Max:600,Step:1}},{Name:"Camera.Angle",Type:u,DefaultValue:45,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.Height",Type:u,DefaultValue:400,GroupId:"Group.Camera.Perspective",Persistent:!1},{Name:"Camera.Ortho",Type:p,DefaultValue:!1,GroupId:"Group.Camera.Perspective",Persistent:!1},{Name:"Camera.Arcball",Type:p,DefaultValue:!0,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.Pitch",Type:p,DefaultValue:!0,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.Roll",Type:p,DefaultValue:!1,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.Roll.Angle",Type:u,DefaultValue:0,GroupId:"Group.Camera.Roll",Persistent:!1,Bounds:{Min:-179,Max:180,Step:1}},{Name:"Camera.Yaw",Type:p,DefaultValue:!0,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.LockDistCOI",Type:p,DefaultValue:!1,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.DistCOI",Type:u,DefaultValue:500,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.DOF.Actif",Type:p,DefaultValue:!1,ControlsGroupVisibility:!0,Persistent:!1,visibleInPropertyGroups:!1,GroupId:"Group.Camera.DOF"},{Name:"Camera.DOF.Type",Type:h,DefaultValue:g.EDOFType.Follow,GroupId:"Group.Camera.DOF",Persistent:!1,MapChoice:this._generateMapChoiceFromEnumAndId(g.EDOFType,"Camera.DOF.Type"),visibleInPropertyGroups:!1},{Name:"Camera.DOF.Distance",Type:u,DefaultValue:100,GroupId:"Group.Camera.DOF",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.DOF.Blur",Type:u,DefaultValue:50,GroupId:"Group.Camera.DOF",Persistent:!1,Bounds:{Min:0,Max:100,Step:1},visibleInPropertyGroups:!1},{Name:"Camera.DOF.FocusPlane.Visible",Type:p,DefaultValue:!0,GroupId:"Group.Camera.DOF",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.DOF.FocusPlane.Opacity",Type:u,DefaultValue:.5,GroupId:"Group.Camera.DOF",Bounds:{Min:0,Max:1,Step:.1},Persistent:!1,visibleInPropertyGroups:!1},{Name:"Paper.Width",Type:u,GroupId:"Group.Paper",DefaultValue:300},{Name:"Paper.Height",Type:u,GroupId:"Group.Paper",DefaultValue:168.75},{Name:"Paper.Orientation",Type:h,GroupId:"Group.Paper",MapChoice:this._generateMapChoiceFromEnumAndId(e.EPaperOrientation,"Paper.Orientation"),Persistent:!1},{Name:"Viewport.ActiveAmbience",Type:m,DefaultValue:"",GroupId:"Group.Environment",BehaviorType:1,visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Viewport.ActiveCamera",Type:l,DefaultValue:0,GroupId:"Group.Environment",Persistent:!1,BehaviorType:1,visibleInPropertyGroups:!1},{Name:"Environment.Vertical",Type:h,DefaultValue:e.EVertical["Z+"],GroupId:"Group.Environment",MapChoice:this._generateMapChoiceFromEnumAndId(e.EVertical),FormatPainter:!0,visibleInPropertyGroups:!1},{Name:"Environment.Background.Override",Type:p,ControlsGroupVisibility:!0,DefaultValue:!1,GroupId:"Group.Environment.Background"},{Name:"Environment.Background.Color",Type:d,DefaultValue:(new V).FromRGBA(236/255,236/255,236/255),GroupId:"Group.Environment.Background",FormatPainter:!0},{Name:"Environment.Background.Color.Opacity",Type:u,DefaultValue:1,GroupId:"Group.Environment.Background",FormatPainter:!0},{Name:"Environment.Background.Image",Type:f,DefaultValue:-1,GroupId:"Group.Environment.Background",FormatPainter:!0},{Name:"Environment.Background.Gradient",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Background",FormatPainter:!0},{Name:"Environment.Background.Foot.Color",Type:d,DefaultValue:(new V).FromRGBA(236/255,236/255,236/255),GroupId:"Group.Environment.Background",FormatPainter:!0},{Name:"Environment.Shadow",Type:p,DefaultValue:!1,Persistent:!1,GroupId:"Group.Environment.Effects",FormatPainter:!0},{Name:"Environment.AA",Type:h,DefaultValue:e.EAA.SMAA,GroupId:"Group.Environment.Effects",MapChoice:this._generateMapChoiceFromEnumAndId(e.EAA,"Environment.AA"),FormatPainter:!0},{Name:"Environment.SSAO",Type:h,DefaultValue:e.ESSAO.OnIdle,GroupId:"Group.Environment.Effects",MapChoice:this._generateMapChoiceFromEnumAndId(e.ESSAO,"Environment.SSAO"),FormatPainter:!0},{Name:"Environment.Vignetting",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Effects",FormatPainter:!0},{Name:"Environment.Bloom",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Effects",FormatPainter:!0},{Name:"Environment.Flare",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Effects",FormatPainter:!0},{Name:"Environment.BackFaceCulling",Type:p,DefaultValue:!0,GroupId:"Group.Environment.Effects",FormatPainter:!0},{Name:"Render.Mode",Type:h,DefaultValue:b.ERenderingMode.Smooth,GroupId:"Group.Render",MapChoice:this._generateMapChoiceFromEnumAndId(b.ERenderingMode,"Render"),FormatPainter:!0},{Name:"Render.OutlineType",Type:h,DefaultValue:b.EOutlineType.Construction,GroupId:"Group.Render",MapChoice:this._generateMapChoiceFromEnumAndId(b.EOutlineType,"Render.OutlineType"),FormatPainter:!0},{Name:"Render.Lighting.Availability",Type:h,DefaultValue:i.EAvailability.AppForceAvailable,ControlsGroupAvailability:!0,GroupId:"Group.Render.Lighting"},{Name:"Render.Lighting.Override",Type:p,ControlsGroupVisibility:!0,DefaultValue:!1,GroupId:"Group.Render.Lighting"},{Name:"Render.Lighting.Intensity",Type:u,DefaultValue:.9,GroupId:"Group.Render.Lighting",FormatPainter:!0},{Name:"Render.Lighting.Mode",Type:h,DefaultValue:e.ERenderLightingMode.DefaultComposer,GroupId:"Group.Render.Lighting",MapChoice:this._generateMapChoiceFromEnumAndId(e.ERenderLightingMode,"Render.Lighting.Mode"),FormatPainter:!0},{Name:"Render.ShowConstructions",Type:p,DefaultValue:!1,GroupId:"Group.Render",FormatPainter:!0},{Name:"Render.ChildrenStronger",Type:p,DefaultValue:!1,GroupId:"Group.Render",FormatPainter:!0},{Name:"Environment.Debug.Availability",Type:h,DefaultValue:i.EAvailability.AppForceNotAvailable,ControlsGroupAvailability:!0,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.Show",Type:p,DefaultValue:!1,ControlsGroupVisibility:!0,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.ShadowLight",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.BSphere",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.PrimitiveBSphere",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.RepBBox",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.Picking",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.Normals",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.PickHybrid",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.PostProcessing",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.ShadowMaps",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.FPS",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Render.PixelCulling",Type:u,DefaultValue:1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.Render.DefaultAppearanceMode",Type:h,DefaultValue:0,GroupId:"Group.Environment.Debug",MapChoice:this._generateMapChoiceFromEnumAndId(r.DefaultAppearanceMode,"")},{Name:"Viewport.DefaultAmbience",Type:h,GroupId:"Group.Environment.Debug",DefaultValue:1e4,Persistent:!0,BehaviorType:1,MapChoice:this._generateMapChoiceFromEnumAndId(P.EDefaultAmbience,""),FormatPainter:!0},{Name:"Actor.Color",visibleInPropertyGroups:!1},{Name:"Actor.Opacity",visibleInPropertyGroups:!1},{Name:"Actor.IsAlwaysOnTop",visibleInPropertyGroups:!1}];const a=this.GetObject()._experienceBase.getManager("VCXContextManager");a&&a.isSupported("VCXPIPSupport")&&t.push({Name:"Environment.Background.Transparent",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Background",FormatPainter:!0}),this._BuildPropertyValues(t)},GetVirtualProperties:function(){var e={"Camera.Position":!0,"Camera.DOF.Distance":!0};return e},GetRequiredPropertiesForTransition:function(){var e=this.QueryInterface("VCXIViewpointController");e&&e.fromViewpoint();var t={"Camera.Position":!0,"Actor.Anchor.1":!0,"Actor.Anchor.2":!0,"Camera.Angle":!0,"Camera.Height":!0,"Camera.Ortho":!0,"Camera.Arcball":!0,"Actor.Interpolation.Type":!0,"Camera.Pitch":!0,"Camera.Roll":!0,"Camera.Roll.Angle":!0,"Camera.Yaw":!0,"Camera.LockDistCOI":!0,"Camera.DistCOI":!0,"Camera.DOF.Distance":!0,"Camera.DOF.Blur":!0,"Actor.Anchor.10":!0};return t},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Environment.Background.Color.Opacity",-1===this.GetPropertyValue("Environment.Background.Image")),this.SetPropertyInvisible("Environment.Background.Color",!this.GetPropertyValue("Environment.Background.Override")),this.SetPropertyInvisible("Environment.Background.Color.Opacity",!this.GetPropertyValue("Environment.Background.Override")),this.SetPropertyInvisible("Environment.Background.Gradient",!this.GetPropertyValue("Environment.Background.Override")),this.SetPropertyInvisible("Environment.Background.Image",!this.GetPropertyValue("Environment.Background.Override")),this.SetPropertyInvisible("Environment.Background.Foot.Color",!this.GetPropertyValue("Environment.Background.Override")||!this.GetPropertyValue("Environment.Background.Gradient"));const e=this.GetObject()._experienceBase.getManager("VCXContextManager");e&&e.isSupported("VCXPIPSupport")&&this.SetPropertyInvisible("Environment.Background.Transparent",!this.GetPropertyValue("Environment.Background.Override")||!this.GetPropertyValue("Environment.Background.Gradient")),this.SetPropertyInvisible("Viewport.ActiveAmbience",!0),e.isEnopadLoaderUsed()||(this.SetPropertyInvisible("Render.ShowConstructions",!0),this.ChangeGroupAvailability("Group.Render.Lighting",i.EAvailability.AppForceAvailable)),this.SetPropertyInvisible("Render.Lighting.Intensity",!this.GetPropertyValue("Render.Lighting.Override")),this.SetPropertyInvisible("Render.Lighting.Mode",!this.GetPropertyValue("Render.Lighting.Override")),this.SetPropertyInvisible("Camera.Focal.Length",this.GetPropertyValue("Camera.Ortho")),this.SetPropertyInvisible("Camera.Height",!this.GetPropertyValue("Camera.Ortho")),e.isSupported("ViewportDebug")?(this.ChangeGroupAvailability("Group.Environment.Debug",i.EAvailability.AppForceAvailable),this.ChangeGroupAvailability("Group.Render.Lighting",i.EAvailability.AppForceAvailable)):(this.changeMapChoice("Render.Mode",this._generateMapChoiceFromEnumAndId(b.ERenderingMode,"Render",["FlatTechnical"])),this.changeMapChoice("Render.OutlineType",this._generateMapChoiceFromEnumAndId(b.EOutlineType,"Render.OutlineType",["Smart"])),this.SetPropertyInvisible("Render.ChildrenStronger",!0),this.SetPropertyInvisible("Environment.Vignetting",!0),this.SetPropertyInvisible("Environment.Flare",!0),this.SetPropertyInvisible("Environment.Bloom",!0)),this.ChangeGroupAvailability("Group.Camera.DOF",i.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Actions",i.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Camera",i.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Camera.Orientation",i.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Camera.Perspective",i.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Camera.Roll",i.EAvailability.AppForceNotAvailable)},GetProperties:function(e){var t=this.QueryInterface("VCXIViewpointController");return t&&t.fromViewpoint(),this._parent(e)},GetProperty:function(e){if("Camera.Roll.Angle"===e){if(i=this.QueryInterface("VCXIViewpointController")){var t=i.getMatrixAndDOI();return this.GetNewProperty(e,180*t.roll/Math.PI)}}else if("Camera.Position.Frame"===e||"Camera.Target.Frame"===e){var i;if(i=this.QueryInterface("VCXIViewpointController")){t=i.getMatrixAndDOI();if("Camera.Position.Frame"===e)return this.GetNewProperty(e,o.getOFromMatrix(t.matrix));if("Camera.Target.Frame"===e)return this.GetNewProperty(e,t.target)}}else{if("Camera.Focal.Length"===e){var r=this.GetPropertyValue("Camera.Angle");r/=360/Math.PI;var a=Math.tan(r),s=.5*this._fullFrameSize/a;return this.GetNewProperty(e,s)}if("Paper.Width"===e){if(n=this.ExperienceBase.getManager("VCXPaperManager"))return this.GetNewProperty(e,n.GetWidth())}else if("Paper.Height"===e){if(n=this.ExperienceBase.getManager("VCXPaperManager"))return this.GetNewProperty(e,n.GetHeight())}else if("Paper.Orientation"===e){var n;if(n=this.GetObject()._experienceBase.getManager("VCXPaperManager"))return this.GetNewProperty(e,n.GetWidth()<n.GetHeight()?0:1)}else if("Environment.AA"===e){if(l=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewEnumProperty(e,e+"."+l.antiAliasing)}else if("Environment.Shadow"===e){if(l=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewProperty(e,l.useShadowMap)}else if("Environment.Vignetting"===e){if(l=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewProperty(e,l.useVignetting)}else if("Environment.Bloom"===e){if(l=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewProperty(e,l.useBloom)}else if("Environment.Flare"===e){if(l=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewProperty(e,l.useFlare)}else if("Environment.BackFaceCulling"===e){if(l=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewProperty(e,!1===l.renderer.disableBackFaceCulling)}else{if("Render.PixelCulling"!==e)return"Render.ShowConstructions"===e?this.GetNewProperty(e,this.GetObject().showConstructions):this._parent(e);var l;if(l=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewProperty(e,l.currentViewpoint.camera.pixelCulling)}}},RequestModification:function(e,t){if(e){var i=e.GetPropertyInfo().GetPropertyName();if("Camera.Position.Frame"===i||"Camera.Target.Frame"===i){if(this._needToUpdateViewpoint=!0,m=this.QueryInterface("VCXIViewpointController")){var a,s,n=this.ExperienceBase.getManager("VCXVisuManager"),l=m.getMatrixAndDOI(),p=new r.Vector3(0,0,1);a="Camera.Position.Frame"===i?e.GetPropertyValue().Value:o.getOFromMatrix(l.matrix),s="Camera.Target.Frame"===i?e.GetPropertyValue().Value:l.target;var u=(new r.Vector3).subVectors(a,s),h=u.length(),d=n.getMatrixToAdjustVertical().clone().multiply(o.rotateMatrixAroundZ(o.getMatrixFromOVzVy(a,u,p),l.roll)),c=n.getMatrixToAdjustVertical().clone().multiply(o.rotateMatrixAroundZ(o.getMatrixFromOVzVy(s,u,p),l.roll));if((V=this.GetProperty("Camera.Position").Clone()).GetPropertyValue().SetValue(d),t.AddOrModifyProperty(this.GetHashing(),V),(V=this.GetProperty("Actor.Anchor.2").Clone()).GetPropertyValue().GetValueFrame().SetValue(c),t.AddOrModifyProperty(this.GetHashing(),V),this.GetPropertyValue("Camera.Dolly")&&!this.GetPropertyValue("Camera.Ortho")){var C=360*Math.atan(.5*l.height/h)/Math.PI;t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Camera.Angle",C))}}return this._parent(e,t)}if("Camera.Focal.Length"===i){C=360*Math.atan(.5*this._fullFrameSize/e.GetPropertyValue().Value)/Math.PI;if(t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Camera.Angle",C)),this.GetPropertyValue("Camera.Dolly")&&!this.GetPropertyValue("Camera.Ortho")){n=this.ExperienceBase.getManager("VCXVisuManager");if(m=this.QueryInterface("VCXIViewpointController")){h=.5*(l=m.getMatrixAndDOI()).height/Math.tan(.5*C*Math.PI/180);var y=l.target.add(o.getVzFromMatrix(l.matrix).normalize().multiplyScalar(h));d=n.getMatrixToAdjustVertical().clone().multiply(l.matrix.setPosition(y));(V=this.GetProperty("Camera.Position").Clone()).GetPropertyValue().SetValue(d),t.AddOrModifyProperty(this.GetHashing(),V)}}return this._parent(e,t)}if("Camera.Roll.Angle"===i){n=this.ExperienceBase.getManager("VCXVisuManager");var m=this.QueryInterface("VCXIViewpointController");if(n&&m){l=m.getMatrixAndDOI();var V,f=o.getMatrixFromOVzVy(o.getOFromMatrix(l.matrix),o.getVzFromMatrix(l.matrix),new r.Vector3(0,0,1));d=n.getMatrixToAdjustVertical().clone().multiply(o.rotateMatrixAroundZ(f,e.GetPropertyValue().Value*Math.PI/180));(V=this.GetProperty("Camera.Position").Clone()).GetPropertyValue().SetValue(d),t.AddOrModifyProperty(this.GetHashing(),V)}return this._parent(e,t)}if("Paper.Orientation"===i){var b=(g=this.GetObject()._experienceBase.getManager("VCXPaperManager")).GetWidth(),P=g.GetHeight();return(0===e.GetPropertyValue().Value&&P<b||1===e.GetPropertyValue().Value&&P>b)&&(t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Paper.Width",P)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Paper.Height",b))),t.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,t)}if("Paper.Width"===i||"Paper.Height"===i){var g;b=(g=this.GetObject()._experienceBase.getManager("VCXPaperManager")).GetWidth(),P=g.GetHeight();if("Paper.Width"===i?(b=e.GetPropertyValue().Value,t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Paper.Height",P))):(P=e.GetPropertyValue().Value,t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Paper.Width",b))),P<b&&0===this.GetProperty("Paper.Orientation").GetPropertyValue().Value||P>b&&1===this.GetProperty("Paper.Orientation").GetPropertyValue().Value){var _=this.GetProperty("Paper.Orientation").GetPropertyValue().Value?0:1;t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Paper.Orientation",_))}return t.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,t)}}return this._parent(e,t)},OnChangeProperty:function(e,t,i){if(i||(i={}),i.fromChildClass);else if(this.OnChangePropertyBegin(e,t))return!0;if("Collab.ListAnchorsIDs"===e&&t&&t.Value&&3!==t.Value.length)return console.log("Collab.ListAnchorsIDs"),!0;i.fromChildClass=!0,this._parent(e,t,i);var r,a=this.ExperienceBase.getManager("VCXContextManager");if("Paper.Width"===e)this._paperRequestedWidth=t;else if("Paper.Height"===e)this._paperRequestedHeight=t;else if("Environment.AA"===e){let i=this.GetProperty(e);var o=(r=i&&i.GetPropertyInfo().GetMapChoiceEnum())&&r[t.Value];o&&(this._requestedAA=o.split(".").pop())}else"Environment.SSAO"===e?this._requestedSSAO=t.Value:"Environment.Mirror"===e?a.applyToViewers((function(e){e.setMirror(t.Value)})):"Environment.Shadow"===e?a.applyToViewers((function(e){e.setShadow(t.Value)})):"Environment.Vignetting"===e?a.applyToViewers((function(e){e.setVignetting(t.Value)})):"Environment.Bloom"===e?a.applyToViewers((function(e){e.setBloom(t.Value)})):"Environment.Flare"===e?a.applyToViewers((function(e){e.setFlare(t.Value)})):"Environment.BackFaceCulling"===e?a.applyToViewers((function(e){e.setDisableBackFaceCulling(!1===t.Value)})):"Render.PixelCulling"===e?a.applyToViewers((function(e){e.currentViewpoint.setPixelCulling(t.Value)})):"Render.ShowConstructions"===e?this._requestedShowConstructions=t.Value:"Environment.Debug.ShadowLight"===e?a.applyToViewers((function(e){e.debugShadowLight=t.Value})):"Environment.Debug.BSphere"===e?a.applyToViewers((function(e){e.debugBSphere=t.Value})):"Environment.Debug.PrimitiveBSphere"===e?a.applyToViewers((function(e){e.debugPrimitiveBSphere=t.Value})):"Environment.Debug.RepBBox"===e?a.applyToViewers((function(e){e.debugRepBBox=t.Value})):"Environment.Debug.Picking"===e?a.applyToViewers((function(e){e.debugPicking=t.Value})):"Environment.Debug.Normals"===e?a.applyToViewers((function(e){e.debugNormals=t.Value})):"Environment.Debug.BackfaceCulling"===e?a.applyToViewers((function(e){e.debugBackfaceCulling=t.Value})):"Environment.Debug.PickHybrid"===e?a.applyToViewers((function(e){e.debugPickHybrid=t.Value})):"Environment.Debug.PostProcessing"===e?a.applyToViewers((function(e){e.setDebugPostProcessing(t.Value)})):"Environment.Debug.ShadowMaps"===e?a.applyToViewers((function(e){e.setDebugShadowMaps(t.Value)})):"Environment.Debug.Render.DefaultAppearanceMode"===e?a.applyToViewers((function(e){e.setVisuAppearanceMode(t.Value)})):"Environment.Debug.FPS"===e||("Render.Mode"===e?this._requestedRenderMode=t.Value:"Render.OutlineType"===e&&(this._requestedOutlineType=t.Value))},OnChangePropertiesEnd:function(){if(this._parent(),this._requestedAA||this._requestedSSAO){var i=this._requestedAA||this.GetPropertyValue("Environment.AA"),r=this._requestedSSAO||this.GetPropertyValue("Environment.SSAO"),o=r!==e.ESSAO.NoSSAO,l=o&&"MSAA"===i,u=r===e.ESSAO.Always;(f=this.ExperienceBase.getManager("VCXContextManager")).applyToViewers((function(e){e.setAntiAliasing(i),e.setSSAO(o,"static"),e.setIterativeSSAO(l),e.setSSAO(u,"dynamic")}))}if(this._requestedRenderMode!==this.GetObject().renderMode||this._requestedOutlineType!==this.GetObject().outlineType||this._requestedShowConstructions!==this.GetObject().showConstructions||this._forceRefresh){this.GetObject().renderMode=this._requestedRenderMode,this.GetObject().outlineType=this._requestedOutlineType,this.GetObject().showConstructions=this._requestedShowConstructions;var h=this.GetObject().renderMode,d=this.GetObject().outlineType,c=this.GetObject().showConstructions;(f=this.ExperienceBase.getManager("VCXContextManager")).getRootComponent().setDirtyFlag&&f.getRootComponent().setDirtyFlag(b.FDirty.RenderingMode),f.traverseGraphMustBePerformed=!0;var C=this.ExperienceBase.getManager("VCXVisuManager"),y=this.ExperienceBase.ComponentsMap.GetComponentFromType("VCXWebComponentOccurrence"),m=this.ExperienceBase.getManager("VCXMaterialManager").getRenderStyle(h,d,c);f.applyToViewers((function(e){switch(e.setAxisFilter(c),e.setLinesFilter(c),e.setPointsFilter(c),e.setVerticesFilter(c),e.setRenderStyle(m),h){case b.ERenderingMode.Smooth:case b.ERenderingMode.SmoothOutline:e.setRenderPriority&&e.setRenderPriority(!1),e.setRenderPriority&&e.setRenderPriorityDefaultOpacity(1);break;case b.ERenderingMode.Custom:C&&C.dirtifyRenderPriority()}if(!f.useTraverseGraph)for(var t=0;t<y.length;++t){var i=y[t],r=i.QueryInterface("VCXIModifiable");r&&(i.setDirtyFlag(b.FDirty.RenderingMode,!0),r.applyChanges&&r.applyChanges())}})),t.publish({event:"VCX_ENVIRONNEMENT_PROPERTY_CHANGED"})}if(this._paperRequestedWidth||this._paperRequestedHeight||this._paperRequestedVisibility){var V=this.ExperienceBase.getManager("VCXPaperManager");V&&(this._paperRequestedWidth&&(this._paperRequestedWidth.Value!==V.GetWidth()||this._forceRefresh)&&(V.SetWidth(this._paperRequestedWidth.Value),this._paperRequestedWidth=null),this._paperRequestedHeight&&(this._paperRequestedHeight.Value!==V.GetHeight()||this._forceRefresh)&&(V.SetHeight(this._paperRequestedHeight.Value),this._paperRequestedHeight=null),V.updatePaper({propagateEvent:!0}))}var f;if((f=this.ExperienceBase.getManager("VCXContextManager"))&&(this._previousEnvMapStr=this._envMapStr,this._previousShowEnv=this._showEnv),this._previousVertical!==this.GetPropertyValue("Environment.Vertical")||this._forceRefresh){this._previousVertical=this.GetPropertyValue("Environment.Vertical"),this.ExperienceBase.getManager("VCXVisuManager").setVertical(this.GetPropertyValue("Environment.Vertical"));var P=this.ExperienceBase.getManager("VCXVisuManager").getInverseMatrixToAdjustVertical();this.ExperienceBase.getManager("VCXContextManager").getRootNode().setMatrix(P);var g=this.ExperienceBase.ComponentsMap.GetComponentFromType("CXPCameraActor_Spec")[this.GetPropertyValue("Viewport.ActiveCamera")];g&&g.updatePosition()}if(this._previousActiveAmbience!==this.GetPropertyValue("Viewport.ActiveAmbience")||this._previousDefaultAmbience!==this.GetPropertyValue("Viewport.DefaultAmbience")){let e=this.ExperienceBase.ComponentsMap.GetComponentFromID(this.GetPropertyValue("Viewport.ActiveAmbience"));if(this._previousActiveAmbience=this.GetPropertyValue("Viewport.ActiveAmbience"),this._previousDefaultAmbience=this.GetPropertyValue("Viewport.DefaultAmbience"),!e)(C=this.ExperienceBase.getManager("VCXVisuManager")).activateDefaultAmbience(this.GetPropertyValue("Viewport.DefaultAmbience"))}if(this._previousActiveCam!==this.GetPropertyValue("Viewport.ActiveCamera")||this._forceRefresh){this._previousActiveCam=this.GetPropertyValue("Viewport.ActiveCamera");var _=this.ExperienceBase.ComponentsMap.GetComponentFromType("CXPCameraActor_Spec")[this.GetPropertyValue("Viewport.ActiveCamera")];if(_){var M=_.QueryInterface("VCXIModifiable"),S=new a(this.ExperienceBase),D=new s(new n("Actor.IsActive",2),new p(!0));S.ChangeProperty(M,D),this.ExperienceBase.getManager("VCXCommandManager").Do(S),_.updatePosition()}}var G=this.QueryInterface("VCXIViewpointController");this._needToUpdateViewpoint&&(this._needToUpdateViewpoint=!1,G.toViewpoint()),G&&!this.ExperienceBase.getManager("VCXVisuManager").CameraControlsViewpoint&&(G.resetMatrixAndDOI(),G.toViewpoint())},GetInterpolator:function(e){var t=this.QueryInterface("VCXIViewpointController");if(t)return t.GetInterpolator(e)}})})),define("DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeLeft",["DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools"],(function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iPariteY=0,this.fX=this.fHalfSizeX-this.fCellSize,this.fX<0&&(this.fX=0),this.dy=0,this.fY=0},next:function(){return this._parent(),0===this.fY&&this.iPariteY++,this.iPariteY++,2===this.iPariteY&&(this.iPariteY=0,this.fY+=this.fCellSize,this.fY>this.fHalfSizeY-this.fCellSize&&(0===this.dy?this.dy=.5*this.fCellSize:this.dy=0,this.fY=0,this.fX-=this.fCellSize,this.fX<-this.fHalfSizeX+this.fCellSize))&&(this.rewind(),!0)},getPoint:function(){var e=new t.Vector2;return e.x=this.fHalfSizeX-this.fX,1&this.iPariteY?e.y=this.fHalfSizeY-this.fY+this.dy:e.y=this.fHalfSizeY+this.fY+this.dy,e}})})),define("DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeBottomAndTop",["DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools"],(function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iPariteX=0,this.iPariteY=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0)},next:function(){return this._parent(),this.iPariteY++,2===this.iPariteY&&(this.iPariteY=0,0===this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.fHalfSizeX-this.fCellSize&&(0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<this.fCellSize)))&&(this.rewind(),!0)},getPoint:function(){var e=new t.Vector2;return 1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,1&this.iPariteY?e.y=this.fHalfSizeY-this.fY:e.y=this.fHalfSizeY+this.fY,e}})})),define("DS/VCXWebDressup/VCXArrow/VCXLinearArrowNode",["DS/VCXWebDressup/VCXArrow/VCXArrowNode","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools"],(function(e,t,i){"use strict";var r=e.extend({init:function(e){this._parent(e)},_ComputePosBuffer:function(e,r,a,o,s){var n,l=this.GetAnchorWorldMatrix(0,e),p=(new t.Vector3).getPositionFromMatrix(l);if(this.GetPropertyValue("Arrow.Head.2.Position.Is.Paper")){var u=new t.Vector2(this.GetPropertyValue("Arrow.Head.2.Position.X"),this.GetPropertyValue("Arrow.Head.2.Position.Y")),h=0;this.GetPropertyValue("Arrow.Fixed.Length")&&(h=this.GetPropertyValue("Arrow.Length")),n=this.ExperienceBase.getManager("VCXPaperManager").GetModelPointFromModelPointAndPaperPosition(e,p,u,h)}else{var d=this.GetAnchorWorldMatrix(1,e);n=(new t.Vector3).getPositionFromMatrix(d)}var c=e.viewpoint.getEyePosition(),C=new t.Vector3(1,0,0);C.subVectors(n,p);var y,m=C.length();if(C.normalize(),!(this.Modifiable.GetProperty("Actor.Anchor.1")&&this.Modifiable.GetProperty("Actor.Anchor.1").GetPropertyValue()&&this.Modifiable.GetProperty("Actor.Anchor.1").GetPropertyValue().GetValueLink()&&this.Modifiable.GetProperty("Actor.Anchor.1").GetPropertyValue().GetValueLink().Value)||this.GetPropertyValue("Arrow.Billboarded"))y=(new t.Vector3).subVectors(c,p);else{let e=this.GetPropertyValue("Arrow.ZRotation"),t=Math.PI*e/180;y=i.getVxFromMatrix(l).applyAxisAngle(C,t)}var V=new t.Vector3(0,1,0);1===y.normalize().dot(C.normalize())||(V.crossVectors(y,C),V.normalize()),this.GetPropertyValue("Arrow.Fixed.Length")&&(m=this.GetPropertyValue("Arrow.Length"));var f=1,b=1;this.GetPropertyValue("Collab.Is.Paper")&&(f=this.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(e,p),b=this.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(e,n),f*=this.GetPropertyValue("Arrow.Scale"),b*=this.GetPropertyValue("Arrow.Scale"),this.GetPropertyValue("Arrow.Fixed.Length")&&(m*=f));var P=this.GetPropertyValue("Arrow.Width.1")*f,g=0,_=0,M=0;this.GetPropertyValue("Arrow.Head.ShowMode")&&(g=this.GetPropertyValue("Arrow.Head.Length")*f,_=this.GetPropertyValue("Arrow.Head.Size")*f,M=this.GetPropertyValue("Arrow.Head.Shape")*f);var S=this.GetPropertyValue("Arrow.Width.2")*b,D=0,G=0,x=0;this.GetPropertyValue("Arrow.Head.2.ShowMode")&&(D=this.GetPropertyValue("Arrow.Head.2.Length")*b,G=this.GetPropertyValue("Arrow.Head.2.Size")*b,x=this.GetPropertyValue("Arrow.Head.2.Shape")*b);var X=0,v=[];for(v[2*X+0]=m,v[2*X+1]=0,v[2*++X+0]=m-D,v[2*X+1]=.5*S+G,v[2*++X+0]=m-(D+x),v[2*X+1]=.5*S,v[2*++X+0]=g+M,v[2*X+1]=.5*P,v[2*++X+0]=g,v[2*X+1]=.5*P+_,v[2*++X+0]=0,v[2*X+1]=0,v[2*++X+0]=v[8],v[2*X+1]=-v[9],v[2*++X+0]=v[6],v[2*X+1]=-v[7],v[2*++X+0]=v[4],v[2*X+1]=-v[5],v[2*++X+0]=v[2],v[2*X+1]=-v[3],X++,X=0;X<this._verticesNb;X++)r[3*X+0]=p.x+v[2*X+0]*C.x+v[2*X+1]*V.x,r[3*X+1]=p.y+v[2*X+0]*C.y+v[2*X+1]*V.y,r[3*X+2]=p.z+v[2*X+0]*C.z+v[2*X+1]*V.z,o[3*X+0]=p.x+v[2*X+0]*C.x+v[2*X+1]*V.x,o[3*X+1]=p.y+v[2*X+0]*C.y+v[2*X+1]*V.y,o[3*X+2]=p.z+v[2*X+0]*C.z+v[2*X+1]*V.z;return this._fillColorBuffer(a,s),X},preRender:function(e){if(!this._parent(e))return!1},GetVarianceNode(e){return new r({name:e.viewerID+"_"+this.name,modifiable:this.Modifiable,experience:this.ExperienceBase})},update:function(e){this._parent(e),this._step||(this._step=this._getArrowStep()),this._updateNodePresence(e),this._globalOpacity<=0||this._Node&&(this._updateArrowMaterialsParameters(),this.handleLayers())},_updateNodePresence:function(e){if(!this._Node&&this.GetOpacity(e)>0||this._globalOpacity!==this.GetOpacity(e)){this._globalOpacity=this.GetOpacity(e);var t=this._globalOpacity>0;t&&!this._Node&&this._Build(),this._Node&&this._Node.setVisibility(t)}},_getArrowStep:function(){return 1}});return r})),define("DS/VCXWebDressup/VCXArrow/VCXLinearArrowSGNodeHolder",["DS/VCXWebDressup/VCXArrow/VCXArrowSGNodeHolder","DS/VCXWebDressup/VCXArrow/VCXLinearArrowNode"],(function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Linear Arrow",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Arrow.png")}return this._parent()}})})),define("DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeCircle",["DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS"],(function(e,t){"use strict";return e.extend({rewind:function(){this._parent(),this.iCurrent=0,this.rMax=Math.min(this.sizeView.x,this.sizeView.y),this.rMax=.5*this.rMax-this.fCellSize,this.rMax<this.fCellSize&&(this.rMax=this.fCellSize),this.r=this.rMax,this.nbPerCircle=Math.floor(2*Math.PI*this.r/this.fCellSize+.5),this.iT=0,this.dt=0,this.iParite=0},next:function(){if(this._parent(),this.iT++,this.iT>=this.nbPerCircle){if(this.r-=this.fCellSize,this.r<this.fCellSize)return this.rewind(),!0;this.iT=0,this.nbPerCircle=Math.floor(2*Math.PI*this.r/this.fCellSize+.5),1&this.iParite?this.dt=Math.PI/this.nbPerCircle:this.dt=0,this.iParite++}return!1},getPoint:function(){var e=new t.Vector2,i=this.dt+2*Math.PI*this.iT/this.nbPerCircle;return e.x=Math.cos(i)*this.r+.5*this.sizeView.x,e.y=Math.sin(i)*this.r+.5*this.sizeView.y,e}})})),define("DS/VCXWebDressup/VCXViewpoint/VCXViewpointNode",["DS/VCXWebDressup/VCXDressupNode","DS/VCXWebVisualization/VCXBillBoardNode3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/WebappsUtils/WebappsUtils","DS/Visualization/ThreeJS_DS","DS/VCXWebModifiables/VCXPropertiesObserver","DS/Visualization/SceneGraphFactory","DS/VCXWebProperties/VCXColor"],(function(e,t,i,r,a,o,s,n){"use strict";return e.extend({init:function(t){return this._parent(t),this._viewpointNode=new e({name:"ViewpointCore"}),this.add(this._viewpointNode),this.DOFObserver=new o,this.DOFObserver.add(this.Modifiable,"Camera.DOF.Actif"),this.DOFObserver.add(this.Modifiable,"Camera.DOF.Type"),this.DOFObserver.add(this.Modifiable,"Camera.DOF.Blur"),this.DOFObserver.add(this.Modifiable,"Actor.Anchor.10"),this},_Build:function(){this._MeshNode=s.createRectangleNode({width:1,height:1,cornerPoint:new a.Vector2(-.5,-.5),fill:!0,material:this._getTargetMaterial("VCX_Target.png")}),this._MeshNode.setVisibilityInTree(!1),this._MeshNode.excludeFromHighlight(!0);this.billBoardNode=new t({name:"VCXFocalTargetBillboarded"}),this.billBoardNode.add(this._MeshNode),this.fixedSizeNode=new i({name:"VCXFocalTargetFixedSize",ratio:64}),this.fixedSizeNode.add(this.billBoardNode),this.add(this.fixedSizeNode);const e=this.ExperienceBase.getManager("VCXVisuManager");this.RecursiveSetRenderPasses({AA:[e.getRenderList("VCXPre2DDressups"),e.getRenderList("VCX2DDressups")],noAA:[e.getRenderList("VCXPre2DDressups"),e.getRenderList("VCXNoAADressups")]})},dispose:function(){this.DOFObserver=null,this._parent()},_getTargetMaterial:function(e){if(this.targetAttachedMat||(this.targetAttachedMat={}),!this.targetAttachedMat[e]){var t=r.getWebappsAssetUrl("VCXWebDressup","textures"),i=new a.ImageUtils.loadTexture(t+"/"+e);i.flipY=!1,i.minFilter=a.LinearMipMapLinearFilter,i.magFilter=a.NearestFilter,this.targetAttachedMat[e]=new a.MeshBasicMaterial({map:i,side:a.DoubleSide,alphaTest:.05,enableClipPlanes:!1,opacity:this.opacity}),this.targetAttachedMat[e].force=!0}return this.targetAttachedMat[e]},update:function(e){if(this._parent(e),this.ExperienceBase.getManager("VCXVisuManager").HasViewpointMoved&&(this._viewpointIsDirty=!0),this.DOFObserver&&(this.DOFObserver.update(),this.DOFObserver.isDirty()||e&&e.force||this._viewpointIsDirty)){const i=this.Modifiable.QueryInterface("VCXIViewpointController").getDOFInfo(e);e.viewer.getDOF()!==i.actif&&e.viewer.setDOF(i.actif);let r=i.actif;if(r&&=this.GetPropertyValue("Camera.DOF.FocusPlane.Visible")?this.GetPropertyValue("Camera.DOF.FocusPlane.Opacity"):0,r&&=this.Modifiable.GetObject().panelVisible,!this._MeshNode&&r>0||this._globalOpacity!==r){this._globalOpacity=r;var t=this._globalOpacity>0;t&&!this._MeshNode&&this._Build(),this._MeshNode&&this._MeshNode.setVisibility(t)}if(i.actif){const t=e.viewer.getEffect("DOF");t.setAutoFocus(i.autoFocus),t.updateFStop(i.aperture),t.updateFocalLength(i.focalLength),i.autoFocus||t.updateFocalPlane(i.focalDistance),this.setMatrix(i.focalPlaneMatrix),this._MeshNode&&(this.Modifiable.GetAttachedOccurence(10)?this._MeshNode.material!==this._getTargetMaterial("VCX_AttachedTarget.png")&&this._MeshNode.setMaterial(this._getTargetMaterial("VCX_AttachedTarget.png")):this._MeshNode.material!==this._getTargetMaterial("VCX_Target.png")&&this._MeshNode.setMaterial(this._getTargetMaterial("VCX_Target.png")))}}},postUpdate:function(e){this._parent(),this.DOFObserver&&this.DOFObserver.reset()},getViewpointNode:function(){return this._viewpointNode}})})),define("DS/VCXWebDressup/VCXViewpoint/VCXViewpointSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXViewpoint/VCXViewpointNode"],(function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Viewport",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_ViewportLeaf.png")}return this._parent()}})})),define("DS/VCXWebDressup/VCXPathLines/VCXPolylineNode",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXPathLines/VCXPathLinesNode","DS/VCXWebDressup/VCXDressup_Spec","DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory"],(function(e,t,i,r,a,o,s){"use strict";return t.extend({init:function(e){return this._parent(e),this},_getPosVectArray:function(){var e=[],t=0;if(this.Modifiable._Anchors&&Object.keys(this.Modifiable._Anchors).length>0){this.Modifiable.processAnchorsIDs((i=>{var r=this.GetAnchorWorldMatrix(i);if(r){var o=new a.Vector3(0,0,0);o.getPositionFromMatrix(r),e[t++]=o}}));var i=t+1;return this._currentPointsNumber!==i?-1:(this.GetPropertyValue("Polyline.Is.Closed")?e[i-1]=e[0].clone():e[i-1]=e[i-2].clone(),e)}console.log("No point")},_ComputePosBuffer:function(e){if(this._currentPointsNumber!==this._getCurrentPointsNumber())return-1;var t=this._getPosVectArray();if(!(Array.isArray(t)&&t.length>0))return t;for(var i=t.length,r=0;r<i;r++)e[3*r+0]=t[r].x,e[3*r+1]=t[r].y,e[3*r+2]=t[r].z;return i},_Build:function(e){if(0!==this.Modifiable.getAnchorsCount()){this._currentPointsNumber=this._getCurrentPointsNumber();var t=this._getPosVectArray();if(!Array.isArray(t)||t.length<2)console.log("Can't build the polyline");else{for(var i=this._currentPointsNumber-1,r=new Uint16Array(2*i),a=0;a<i;++a)r[2*a+0]=a,r[2*a+1]=a+1;this.CreateUpdateMaterials(e);var n={points:t,idx:r,editable:!0,drawMode:o.ConnectivityTypeEnum.LINES,material:this._lineMaterial};this._Node=s.createLineNode(n),this._Node.setVisibilityInTree(!1),this.add(this._Node)}}else console.log("No point")},preRender:function(e){return!!this._parent(e)&&(this.viewpointVisibility&&this.GetOpacity(e)?(this.setVisibility(!0),!0):void this.setVisibility(!1))},GetNode:function(e){return this},update:function(e){if(this._parent(e),this._globalOpacity!==this.GetOpacity(e)){this._globalOpacity=this.GetOpacity(e);var t=this._globalOpacity>0;t&&(this._Node||this._Build(e)),this._Node&&(this._Node.setVisibility(t),this.setVisibility(t))}if(!(this._globalOpacity<=0)&&this._Node){var i=this._Node.getBuffer(o.VertexComponentEnum.POSITION);if(void 0!==i){var r=this._ComputePosBuffer(i);-1===r?(this.remove(this._Node),this._Node=null,this._Build(e)):"number"==typeof r&&(this._Node.updateBuffer(o.VertexComponentEnum.POSITION,0,r),this._Node.computeBoundingElements())}this.CreateUpdateMaterials(e),this._Node&&(!this._Node.material||this._lineMaterial&&this._Node.material.id!==this._lineMaterial.id)&&this._Node.setMaterial(this._lineMaterial),this.handleLayers()}},isNodeBuilt:function(){return Boolean(this._Node)},_getCurrentPointsNumber:function(){return this.Modifiable.getAnchorsCount()+1}})})),define("DS/VCXWebDressup/VCXPathLines/VCXPolylineSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXPathLines/VCXPolylineNode"],(function(e,t){"use strict";return e.extend({init:function(){},getWorldMatrix:function(e){var t=this.GetObject()._experienceBase.getManager("VCXContextManager"),i=this.GetObject().getWorkingRootPathElement().getWorldMatrix(t.getMainViewer()),r=this.QueryInterface("VCXIModifiable");if(r)return this._actorPosition=r.GetFramePropertyValue("Actor.Position"),this._actorPosition&&i.multiply(this._actorPosition),i},buildSGNode:function(){if(!this._sgNode){var e={name:"Polyline",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_PolylineLeaf.png")}return this._parent()}})})),define("DS/VCXWebDressup/VCXCompass/VCXCompassNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebVisibility/VCXIVisibility"],(function(e,t,i,r,a){"use strict";return r.extend({init:function(e){return this._convertFunc=null,this._currentGeomId=-1,this._nodeGeom=null,this._geomBSphereRadius=-1,this._compassMaterial=null,this._currentViewportWidth=0,this._currentViewportHeight=0,this._parent(e),this},_Build:function(){this._Node=null},setGeomConverter:function(e){this._convertFunc=e},preRender:function(e){},_showDefaultRobot:function(e){if(this.ExperienceBase.getManager("VCXContextManager").getContextFromName("PlayerMode")){var t=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();if(t){var i=t.getRobot();if(i)if(e){i.setVisibility(!1);const e=this.ExperienceBase.getManager("VCXRobotAdapter");e&&e.showReferenceAxisSystem(!0)}else{this._defaultRobotState={isConnected:i.isConnected,matrix:i.getMatrix(),visibility:!0,ratio:7},i.setVisibility(!1);const e=this.ExperienceBase.getManager("VCXRobotAdapter");e&&e.showReferenceAxisSystem(!1)}}}},_updateCompassAspect:function(){var e=this,t=this.ExperienceBase.getManager("VCXContextManager").getMainViewer(),i=t.getRobot(),r=i._isEnabled();e._showDefaultRobot(!1);var a=0;a=!0===e.GetPropertyValue("Compass.AbsoluteSize")?e.GetPropertyValue("Compass.SizePixel"):e.GetPropertyValue("Compass.Size")*t.canvas.width;var o=-e.GetPropertyValue("Compass.Translation").x*t.canvas.width,s=+e.GetPropertyValue("Compass.Translation").y*t.canvas.height,n=2*e._geomBSphereRadius;t.setCustomReferenceAxisSystem(null),t.setCustomReferenceAxisSystem({node:e._nodeGeom,getPosition:function(e,t){return{x:2*((e-o-.5*a)/e)-1,y:2*((t-s-.5*a)/t)-1}},ratio:a/n}),i._setEnabled(r)},GetNode:function(e){return this},update:function(i){this._parent(i);var r=this.GetPropertyValue("Compass.GeomPath"),o=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();if(-1===r)return o.setCustomReferenceAxisSystem(null),this._showDefaultRobot(!0),o.render(),this._currentGeomId=-1,this._nodeGeom=null,void(this._geomBSphereRadius=-1);if(this.Modifiable.QueryInterface("VCXIVisibility")._visible===a.EVisState.Visible){if(r!==this._currentGeomId&&this._convertFunc){var s=this,n=s.ExperienceBase.getManager("VCXDocManager").GetPropPath(r).GetValueURL().GetValue();this._convertFunc(n,(function(i){if(r===s._currentGeomId){var a=new t;s._nodeGeom=a;var n=new t;a.addChild(n),s._compassMaterial||(s._compassMaterial=new e.MeshPhongMaterial({color:(new e.Color).setRGB(.5,.5,.5),opacity:1,metal:!0,emissive:(new e.Color).setRGB(.25,.25,.25)}),s._compassMaterial.force=!0),n.material=s._compassMaterial,i.forEach((function(e,t){n.add(e.geode)})),o.setCustomReferenceAxisSystem(a?{node:a,getPosition:function(e,t){return{x:0,y:0}},ratio:1}:null),s._geomBSphereRadius=1.1*a.bSphere.radius;var l=new e.Vector3(-a.bSphere.center.x,-a.bSphere.center.y,-a.bSphere.center.z),p=(new e.Matrix4).setPosition(l);a.setMatrix(p),n.setMatrix(s.GetPropertyValue("Compass.Alignment")),s._updateCompassAspect()}}))}else this._updateCompassAspect();this._currentGeomId=r}else o.getCustomReferenceAxisSystem()&&(o.setCustomReferenceAxisSystem(null),this._showDefaultRobot(!0),o.render(),this._currentGeomId=-1,this._nodeGeom=null,this._geomBSphereRadius=-1)}})})),define("DS/VCXWebDressup/VCXCompass/VCXCompassSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXCompass/VCXCompassNode"],(function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Compass",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_CompassLeaf.png")}return this._parent()}})})),define("DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeRight",["DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools"],(function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iPariteY=0,this.fX=this.fHalfSizeX-this.fCellSize,this.fX<0&&(this.fX=0),this.dy=0,this.fY=0},next:function(){return this._parent(),0===this.fY&&this.iPariteY++,this.iPariteY++,2===this.iPariteY&&(this.iPariteY=0,this.fY+=this.fCellSize,this.fY>this.fHalfSizeY-this.fCellSize&&(0===this.dy?this.dy=.5*this.fCellSize:this.dy=0,this.fY=0,this.fX-=this.fCellSize,this.fX<-this.fHalfSizeX+this.fCellSize))&&(this.rewind(),!0)},getPoint:function(){var e=new t.Vector2;return e.x=this.fHalfSizeX+this.fX,1&this.iPariteY?e.y=this.fHalfSizeY-this.fY+this.dy:e.y=this.fHalfSizeY+this.fY+this.dy,e}})})),define("DS/VCXWebDressup/VCXViewpoint/VCXCameraSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXViewpoint/VCXCameraNode"],(function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Camera",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Camera.png")}return this._parent()}})})),define("DS/VCXWebDressup/VCXCamera/VCXCamera_SpecSGNodeHolder",["DS/VCXWebDressup/VCXViewpoint/VCXCameraSGNodeHolder","DS/VCXWebDressup/VCXViewpoint/VCXCameraNode"],(function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Camera",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Camera.png"),this._parent()}return this._sgNode}})})),define("DS/VCXWebDressup/VCXPathLines/VCXAssociativePathNode",["DS/VCXWebDressup/VCXPathLines/VCXPathLinesNode","DS/VCXWebDressup/VCXPathLines/VCXAssociativePath_Spec","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebSystem/VCXMathTools","DS/SceneGraphNodes/AxisSystemNode","DS/VCXWebDressup/VCXAnchorServices","DS/VCXWebProperties/VCXColor","DS/Mesh/MeshUtils","DS/WebappsUtils/WebappsUtils"],(function(e,t,i,r,a,o,s,n,l,p,u,h){"use strict";const d=1e-6;return e.extend({init:function(e){this._parent(e),this.referentialMatrix=new i.Matrix4,this._node1=null,this._node2=null,this._indicatorLine=null},_GetMatrixLinkedObject:function(e){let t=this._Modifiable.GetProperty("Path.Linked.Object").GetPropertyValue().GetValue();if(t){const i=this._Modifiable.ExperienceBase.ComponentsMap.GetComponentFromID(t);if(i){const t=i.QueryInterface("W3AISGNodeHolder");if(t)return t.getMatrix(e)}}return new i.Matrix4},_UpdateReferential:function(e,r,a){let o=null,s=t.EReferential.World;switch(this.Modifiable.GetProperty("Path.Reference.Type")&&(s=this.Modifiable.GetProperty("Path.Reference.Type").GetPropertyValue().GetValue()),s){case t.EReferential.World:o=new i.Matrix4;break;case t.EReferential.Local:o=this._GetMatrixLinkedObject(a);break;case t.EReferential.CustomOrigin:o=e;break;case t.EReferential.CustomDestination:o=r;break;default:o=new i.Matrix4}this.referentialMatrix=o},_GetPathLengthOnDirectionalAxis:function(){const{fixedPosition:e,freePosition:t}=this.GetExtremitiesPositions(),i=this.GetDirectionalAxis(),r=i.dot(e),a=i.dot(t);return Math.abs(r-a)},_BuildUpdateIndicatorLine:function(e){const t=this.Modifiable.GetProperty("Path.Indicator.Length").GetPropertyValue().GetValue()*this._GetPathLengthOnDirectionalAxis(),i=this.Modifiable.GetProperty("Path.Axis.Type").GetPropertyValue().GetValue(),{point1:r,point2:s}=this._ComputeExtremitiesOfIndicatorLines(e,i[0],t),n=this.Modifiable.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams({type:o.ELineType.Dot,lineWidth:1,color:(new p).SetRGB(255,255,255).GetThreeColor(),opacity:1});var l={pickable:!0,points:[r,s],editable:!0,drawMode:u.ConnectivityTypeEnum.LINES,material:n},h=a.createLineNode(l);return h.excludeFromCSO(!0),h.excludeFromHighlight(!0,!0),h.setNoHighlightNoZ(!0),h},_ComputeExtremitiesOfIndicatorLines:function(e,t="X",r=5){const a=s.getLocalVectorInReferential(e,this.referentialMatrix);let o=new i.Vector3,n=new i.Vector3;switch(t.toUpperCase()){case"X":default:o.x=a.x-r/2,n.x=a.x+r/2,o.y=a.y,n.y=a.y,o.z=a.z,n.z=a.z;break;case"Y":o.y=a.y-r/2,n.y=a.y+r/2,o.x=a.x,n.x=a.x,o.z=a.z,n.z=a.z;break;case"Z":o.z=a.z-r/2,n.z=a.z+r/2,o.y=a.y,n.y=a.y,o.z=a.z,n.z=a.z}return{point1:s.getWorldVectorInReferential(o,this.referentialMatrix),point2:s.getWorldVectorInReferential(n,this.referentialMatrix)}},_ComputePositionEveryStep:function(e,t,r=!1,a="X",o=.5){const n=s.getLocalVectorInReferential(e,this.referentialMatrix),l=s.getLocalVectorInReferential(t,this.referentialMatrix);let p,u,h=new i.Vector3;const d=(e,t)=>(t-e)*(o=r?o:1);switch(a.toUpperCase()){case"X":p=n.x,u=l.x,h.x=p+d(p,u),h.y=n.y,h.z=n.z;break;case"Y":p=n.y,u=l.y,h.y=p+d(p,u),h.x=n.x,h.z=n.z;break;case"Z":p=n.z,u=l.z,h.z=p+d(p,u),h.x=n.x,h.y=n.y;break;default:console.warn("Axis not valid. Default Axis X has been used."),p=n.x,u=l.x,h.x=p+d(p,u),h.y=n.y,h.z=n.z}return s.getWorldVectorInReferential(h,this.referentialMatrix)},_ComputeStepPositionsOfPath:function(e,r){let a="XYZ";if(this.Modifiable.GetProperty("Path.Axis.Type")){const e=this.Modifiable.GetProperty("Path.Axis.Type").GetPropertyValue().GetValue();a=t.EAxisOrder[e]}let o=4;this.Modifiable.GetProperty("Path.Level.Lines")&&(o*=this.Modifiable.GetProperty("Path.Level.Lines").GetPropertyValue().GetValue());let s=.5;this.Modifiable.GetProperty("Path.Level.Ratio")&&(s=this.Modifiable.GetProperty("Path.Level.Ratio").GetPropertyValue().GetValue());const n=(new i.Vector3).getPositionFromMatrix(e),l=(new i.Vector3).getPositionFromMatrix(r);if(this.Modifiable.GetProperty("Path.Construction.Direct").GetPropertyValue().GetValue())return[n,l];let p=[];p.push(n);let u=n;for(let e=0;e<o-1;e++){let t=e%3,i=a[t],r=this._ComputePositionEveryStep(u,l,0===t,i,s);p.push(r),u=r}return p.push(l),p},_BuildExtremity:function(e){var t=a.createSphereNode(e);t.setNoZ(!0);var r=a.createFixedSizeNode();return r.addChild(t),r.setMatrix(new i.Matrix4),r.setNoZ(!0),r},_UpdateAxisSystem:function(e){const t=(new i.Vector3).getPositionFromMatrix(e);let r=this.referentialMatrix.clone();r.setPosition(t),this._AxisSystem.setMatrix(r)},_BuildExtremityV2:function(e){var t=h.getWebappsAssetUrl("VCXWebDressup","textures");const r=new i.ImageUtils.loadTexture(t+"/VCX_Point.png");r.flipY=!1,r.minFilter=i.LinearMipMapLinearFilter,this._materialExtremity=new i.MeshBasicMaterial({map:r,side:i.DoubleSide,alphaTest:.05,enableClipPlanes:!1,opacity:1,color:new i.Color(0)}),this._materialExtremity.force=!0;const o=a.createRectangleNode({width:e.radius,height:e.radius,cornerPoint:new i.Vector2(-e.radius/2,-e.radius/2),fill:!0,noEdge:!0,layerNb:1,material:this._materialExtremity});o.setNoZ(!0);var s=a.createFixedSizeNode();return s.addChild(o),s.setMatrix(new i.Matrix4),s.setNoZ(!0),s},_BuildLine:function(e,t){var i={pickable:!0,points:[e,t],editable:!0,drawMode:u.ConnectivityTypeEnum.LINES,material:this._lineMaterial},r=a.createLineNode(i);return r.setPickParent(!0),r},_BuildUpdateMidLineNode:function(e,t,r,a,o){const n=(new i.Vector3).subVectors(o,a).normalize(),l=(new i.Vector3).subVectors(r,t).normalize(),p=s.getMatrixFromOVxVy(new i.Vector3,n,l);let u=new i.Vector3((a.x+o.x)/2,(a.y+o.y)/2,(a.z+o.z)/2);if(p.setPosition(u),1===e)this._node1.setMatrix(p);else{if(2!==e)return;this._node2.setMatrix(p)}},_BuildPathBetweenExtremities:function(e){if(e.length<2)return;this._linePath&&(this.NodeHolder.removeChild(this._linePath),this._linePath=null),this._linePath=new r("Path"),this._linePath.setPickParent(!0);let t=!1;const i=this.Modifiable.GetProperty("Path.Construction.Direct");if(i&&(t=i.GetPropertyValue().GetValue()),t){const t=this._BuildLine(e[0],e[e.length-1]);this._linePath.addChild(t)}else for(let t=0;t<e.length-1;t++){const i=this._BuildLine(e[t],e[t+1]);this._linePath.addChild(i),t>0&&t<e.length-2&&(1===t&&this._BuildUpdateMidLineNode(1,e[0],e[e.length-1],e[t],e[t+1]),t===e.length-3&&this._BuildUpdateMidLineNode(2,e[0],e[e.length-1],e[t],e[t+1]))}this._node1.setVisibility(!t),this._node2.setVisibility(!t),this.NodeHolder.addChild(this._linePath),this.NodeHolder.setPickParent(!0)},_Build:function(e){this.NodeHolder=new r("NodeHolder"),this.fixedExtremity=new r("FixedExtremity"),this.freeExtremity=new r("FreeExtremity"),this._node1=new r("Node1"),this._node2=new r("Node2"),this._indicatorLine=new r("IndicatorLine"),this.CreateUpdateMaterials(e);this._Modifiable.ExperienceBase.getManager("VCXContextManager");this._ExtremityMat=new i.MeshBasicMaterial({side:i.DoubleSide,opacity:1,force:!0}),this._ExtremityMatBack=new i.MeshBasicMaterial({side:i.DoubleSide,opacity:1,force:!0}),this._ExtremityMat.setBackMaterial(this._ExtremityMatBack),this.fixedExtremity.addChild(this._BuildExtremity({radius:3,material:this._ExtremityMat})),this.freeExtremity.addChild(this._BuildExtremity({radius:3,material:this._ExtremityMat})),this._AxisSystemNode_1=new n({name:"AxisSystem1",headLength:10,arrowLength:50,arrowWidth:2,colors:{colorX:(new p).FromRGBA(1,0,0,1),colorY:(new p).FromRGBA(0,1,0,1),colorZ:(new p).FromRGBA(0,0,1,1)},head:n.types.ARROW}),this._AxisSystemNode_2=new n({name:"AxisSystem2",headLength:10,arrowLength:50,arrowWidth:2,colors:{colorX:(new p).FromRGBA(1,0,0,1),colorY:(new p).FromRGBA(0,1,0,1),colorZ:(new p).FromRGBA(0,0,1,1)},head:n.types.ARROW}),this._AxisSystem=new n({name:"AxisSystem",headLength:10,arrowLength:50,arrowWidth:2,colors:{colorX:(new p).FromRGBA(1,0,0,1),colorY:(new p).FromRGBA(0,1,0,1),colorZ:(new p).FromRGBA(0,0,1,1)},head:n.types.ARROW}),this.fixedExtremity.addChild(this._AxisSystemNode_1),this.freeExtremity.addChild(this._AxisSystemNode_2),this.NodeHolder.addChild(this.fixedExtremity),this.NodeHolder.addChild(this.freeExtremity),this.NodeHolder.addChild(this._node1),this.NodeHolder.addChild(this._node2),this.NodeHolder.addChild(this._indicatorLine),this.NodeHolder.addChild(this._AxisSystem),this.addChild(this.NodeHolder,{exludeFromBounding:!1})},AreExtremitiesInSameAxis(){const{fixedPosition:e,freePosition:t}=this.GetExtremitiesPositions(),r=(new i.Vector3).subVectors(e,t).normalize(),a=this.GetDirectionalAxis().normalize();r.normalize(),a.normalize();const o=r.dot(a);return Math.abs(o-1)<d||Math.abs(o+1)<d},GetExtremitiesPositions(){const e=this.Modifiable.GetProperty("Actor.Anchor.0"),t=this.Modifiable.GetProperty("Actor.Anchor.1"),r=l.getWorldMatrix(e.GetPropertyValue(),this.Modifiable.GetObject()),a=l.getWorldMatrix(t.GetPropertyValue(),this.Modifiable.GetObject());return{fixedPosition:(new i.Vector3).getPositionFromMatrix(r),freePosition:(new i.Vector3).getPositionFromMatrix(a)}},GetExtremitiesMatrices(){const e=this.Modifiable.GetProperty("Actor.Anchor.0"),t=this.Modifiable.GetProperty("Actor.Anchor.1");return{worldMatrixFixed:l.getWorldMatrix(e.GetPropertyValue(),this.Modifiable.GetObject()),worldMatrixFree:l.getWorldMatrix(t.GetPropertyValue(),this.Modifiable.GetObject())}},GetDirectionalAxis(e){let r="XYZ";if(this.Modifiable.GetProperty("Path.Axis.Type")){const e=this.Modifiable.GetProperty("Path.Axis.Type").GetPropertyValue().GetValue();r=t.EAxisOrder[e]}let a=null;switch(r[0].toUpperCase()){case"X":default:a=s.getVxFromMatrix(this.referentialMatrix);break;case"Y":a=s.getVyFromMatrix(this.referentialMatrix);break;case"Z":a=s.getVzFromMatrix(this.referentialMatrix)}const{fixedPosition:o,freePosition:n}=this.GetExtremitiesPositions(),l=new i.Vector3;l.subVectors(n,o);const p=l.dot(a),u=new i.Vector3;return u.copy(a).multiplyScalar(p),u.normalize()},_ApplyBillboardExtremity:function(e,t){const r=s.getOFromMatrix(e).sub(t.getEyePosition()).normalize(),a=s.getVzFromMatrix(e).dot(r),o=r.clone();a<0&&o.negate();const n=s.getMatrixFromOVzVx(new i.Vector3,o,s.getVxFromMatrix(e)),l=new i.Matrix4;l.identity();const p=new i.Matrix4;p.identity(),p.extractRotation(e),l.getInverse(p),p.multiplyMatrices(l,n);const u=new i.Vector3;return p.setPosition(u.getPositionFromMatrix(e)),p},_HideShowNodeMidLines:function(e,t,r){const a=r.position,o=e,s=t,n=(new i.Vector3).subVectors(o,a),l=(new i.Vector3).subVectors(s,a),p=n.dot(l)/(n.length()*l.length());return Math.acos(p)},_GetLengthInRatio:function(e,t,r){const a=this._Modifiable.ExperienceBase.getManager("VCXPaperManager");if(a){const o=e,s=t;let n=new i.Vector3;n.x=(o.x+s.x)/2,n.y=(o.y+s.y)/2,n.z=(o.z+s.z)/2;const l=(new i.Vector3).subVectors(s,o),p=a.GetPaperRatio(r,n);return l.length()/p>=8}return!0},preRender:function(e){if(!this._parent(e))return!1;if(this.NodeHolder){const{worldMatrixFixed:t,worldMatrixFree:i}=this.GetExtremitiesMatrices();if(t&&i){const r=this._ComputeStepPositionsOfPath(t,i);if(5===r.length){const t=this._HideShowNodeMidLines(r[1],r[2],e.viewpoint),i=this._HideShowNodeMidLines(r[2],r[3],e.viewpoint);this._node1.setVisibility(t>=.03),this._node2.setVisibility(i>=.03)}}}},update:function(e){this._parent(e);let t=this.Modifiable.QueryInterface("VCXIVisibility"),i=!1;if(t&&(i=t.GetVisibility()),i||this.GetOpacity(e)){var r=this.GetOpacity(e)>0;if(r){this.NodeHolder||this._Build(e);const t=this.Modifiable.GetProperty("Actor.Anchor.0"),i=this.Modifiable.GetProperty("Actor.Anchor.1"),r=l.getWorldMatrix(t.GetPropertyValue(),this.Modifiable.GetObject(),e),a=l.getWorldMatrix(i.GetPropertyValue(),this.Modifiable.GetObject(),e);if(r&&a){this._UpdateReferential(r,a,e.viewer),this.freeExtremity.setMatrix(a),this.fixedExtremity.setMatrix(r);const t=this._ComputeStepPositionsOfPath(r,a);this._BuildPathBetweenExtremities(t),this.Dirty=!1}else this.Dirty=!0;const o=this.Modifiable.GetProperty("Path.Extremities.Visible");o?(this.freeExtremity.setVisibility(o.GetPropertyValue().GetValue()),this.fixedExtremity.setVisibility(o.GetPropertyValue().GetValue())):(this.freeExtremity.setVisibility(!0),this.fixedExtremity.setVisibility(!0));const s=this.Modifiable.GetProperty("Path.AxisSystem.Fixed.Visible");s?this._AxisSystemNode_1&&this._AxisSystemNode_1.setVisibility(s.GetPropertyValue().GetValue()):this._AxisSystemNode_1&&this._AxisSystemNode_1.setVisibility(!0);const n=this.Modifiable.GetProperty("Path.AxisSystem.Free.Visible");n?this._AxisSystemNode_2.setVisibility(n.GetPropertyValue().GetValue()):this._AxisSystemNode_2.setVisibility(!0);const p=this.Modifiable.GetProperty("Path.AxisSystem.Global");p?(p.GetPropertyValue().GetValue()&&this._UpdateAxisSystem(r),this._AxisSystem.setVisibility(p.GetPropertyValue().GetValue())):(this._UpdateAxisSystem(r),this._AxisSystem.setVisibility(!0))}}let a=!0;if(i?this.GetOpacity(e)&&(a=!1):a=!1,this.setVisibility(r),!(this.GetOpacity(e)<=0)){if(this.CreateUpdateMaterials(e),this._linePath&&(!this._linePath.material||this._lineMaterial&&this._linePath.material.id!==this._lineMaterial.id)&&(this._lineBackMaterial&&this._lineMaterial.setBackMaterial(this._lineBackMaterial),this._linePath.setMaterial(this._lineMaterial)),this._lineMaterial&&this._lineMaterial.color&&this._materialExtremity&&(this._materialExtremity.color=this._lineMaterial.color),this._ExtremityMat&&(this._ExtremityMat.opacity=this.GetOpacity(e),this._ExtremityMat.color=this.Modifiable.GetProperty("Collab.Body.Line.Color").GetPropertyValue().GetValue().GetThreeColor()),this._ExtremityMatBack){let t=!0;const i=this._Modifiable.GetProperty("Back.Line.Show");i&&(t=i.GetPropertyValue().GetValue()),t?(this._ExtremityMatBack.visible=!0,this._ExtremityMatBack.opacity=t?this.GetOpacity(e):t,this._ExtremityMatBack.color=this.Modifiable.GetProperty("Collab.Body.Line.Back.Color").GetPropertyValue().GetValue().GetThreeColor()):this._ExtremityMatBack.visible=!1}this.handleLayers()}},dispose:function(){this.NodeHolder&&(this.NodeHolder.removeChildren(),this.NodeHolder=null),this._parent()}})})),define("DS/VCXWebDressup/VCXPathLines/VCXAssociativePathSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXPathLines/VCXAssociativePathNode"],(function(e,t){"use strict";return e.extend({init:function(){},getWorldMatrix:function(e){var t=this.getAnchorReferential(),i=this.QueryInterface("VCXIModifiable");return i&&(this._actorPosition=i.GetFramePropertyValue("Actor.Position"),this._actorPosition&&t.multiply(this._actorPosition)),t},buildSGNode:function(){if(!this._sgNode){var e={name:"Path",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Paths.png")}return this._parent()},update:function(e){return!(!this._sgNode||!this._sgNode.update)&&(this._sgNode.update(e),this._sgNode.Dirty)}})})),define("DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeBottom",["DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools"],(function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iPariteX=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0)},next:function(){return this._parent(),0===this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.fHalfSizeX-this.fCellSize&&(0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<-this.fHalfSizeY+this.fCellSize))&&(this.rewind(),!0)},getPoint:function(){var e=new t.Vector2;return 1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,e.y=this.fHalfSizeY+this.fY,e}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXArrow/VCXCircularArrow_Spec",["require","exports","DS/VCXWebDressup/VCXArrow/VCXArrow_Spec"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{constructor(){super()}}return function(e){let t;!function(e){e[e.Cylindrical=0]="Cylindrical",e[e.Flat=1]="Flat",e[e.Hybrid=2]="Hybrid"}(t=e.EFlatMode||(e.EFlatMode={}))}(r||(r={})),r.prototype.getDefaultName=function(){return"CircularArrow"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXCircularArrow_Spec"}}),r.prototype.dressupGroupName="Markups",r})),define("DS/VCXWebDressup/VCXArrow/VCXCircularArrowModifiable",["DS/VCXWebDressup/VCXArrow/VCXArrowModifiable","DS/VCXWebDressup/VCXArrow/VCXCircularArrow_Spec","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueVector"],(function(e,t,i,r,a,o,s,n,l){"use strict";return e.extend({init:function(){this._parent(),this._handleAnchor=null},Build:function(){this._parent();var e=[{Name:"Arrow.Circular.Flat",Type:r,DefaultValue:t.EFlatMode.Flat,GroupId:"Group.Arrow",MapChoice:this._generateMapChoiceFromEnumAndId(t.EFlatMode,"Flatness.Type",["Hybrid"])},{Name:"Arrow.Circular.Angle",Type:a,DefaultValue:270,Bounds:{Min:0,Max:360,Step:1},GroupId:"Group.Arrow"},{Name:"Arrow.Circular.Radius",Type:a,DefaultValue:100,GroupId:"Group.Arrow"},{Name:"Arrow.Circular.Step",Type:o,DefaultValue:64,Bounds:{Min:2,Max:100,Step:1},GroupId:"Group.Arrow",visibleInPropertyGroups:!1},{Name:"Actor.Position.Frame",Type:s,Persistent:!1,GroupId:"Group.Position",hiddenFields:["Orientation","Scale"],visibleInPropertyGroups:!1}];this._BuildPropertyValues(e)},GetProperty:function(e){if("Actor.Position.Frame"===e){var t=this.GetProperty("Actor.Anchor.0");return this.GetNewProperty(e,t.GetPropertyValue().GetValueFrame().Value)}return this._parent(e)},RequestModification:function(e,t){if(e&&"Actor.Position.Frame"===e.GetPropertyInfo().GetPropertyName()){var i=this.GetProperty("Actor.Anchor.0").Clone();return i.GetPropertyValue().SetValueFrame(e.GetPropertyValue()),t.AddOrModifyProperty(this.GetHashing(),i),t.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,t)}return this._parent(e,t)}})})),define("DS/VCXWebDressup/VCXSection/VCXSectionNode",["DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/VCXWebSystem/VCXMathTools","DS/SceneGraphNodes/AxisSystemNode","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebProperties/VCXColor","DS/Visualization/SceneGraphUtils"],(function(e,t,i,r,a,o,s,n,l){"use strict";return e.extend({init:function(e){return this._parent(e),this},_Build:function(){this._bodyMat=new t.MeshBasicMaterial({side:t.DoubleSide,opacity:1,force:!0}),this._bodyMat.line=new t.LineBasicMaterial({side:t.DoubleSide,opacity:1,force:!0,polygonBorderMode:!0,lineWidth:2}),this._borderMat=new t.MeshBasicMaterial({side:t.DoubleSide,color:(new n).SetRGB(255,255,255).GetThreeColor(),opacity:1,force:!0}),this._borderMat.line=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams({lineWidth:2,color:(new n).SetRGB(0,0,0).GetThreeColor(),opacity:1}),this._borderMat.line.polygonOffset=!0,this._borderMat.line.polygonOffsetFactor=1,this._borderMat.line.polygonOffsetUnits=-200,this._borderMat.line.linecap="round";this._rightLineNode=new e({name:"RightMiddle"}),this._leftLineNode=new e({name:"LeftMiddle"}),this._bottomLineNode=new e({name:"BottomMiddle"}),this._topLineNode=new e({name:"TopMiddle"}),this._axisSystemNode=new o({name:"AxisSystem",headLength:10,arrowLength:50,arrowWidth:2,colors:{colorX:new i.Color(1,0,0,0),colorY:new i.Color(0,1,0,0),colorZ:new i.Color(0,0,1,0)},head:o.types.ARROW}),this._axisSystemNode.setVisibility(!0),this._MeshNode=r.createRectangleNode({width:1,height:1,cornerPoint:new t.Vector2(-.5,-.5),fill:!0,material:this._bodyMat}),this._MeshNode.setVisibilityInTree(!1),this._MeshNodeHolder=new e({name:"mesh"}),this._MeshNodeHolder.add(this._MeshNode),this._ScalingNode=new e({name:"scaling"}),this._ScalingNode.add(this._MeshNodeHolder),this._CenteringNode=new e({name:"CenterNode"}),this._CenteringNode.add(this._ScalingNode),this._CenteringNode.add(this._topLineNode),this._CenteringNode.add(this._leftLineNode),this._CenteringNode.add(this._rightLineNode),this._CenteringNode.add(this._bottomLineNode),this.add(this._CenteringNode,{exludeFromBounding:!1}),this._axisMat=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams({type:s.ELineType.Dot,lineWidth:1,color:(new n).SetRGB(255,255,255).GetThreeColor(),opacity:1});var a=this.ExperienceBase.getManager("VCXVisuManager");this._rightAxisNode=r.createLineNode({points:[new t.Vector3(0,0,0),new t.Vector3(1,0,0)],material:this._axisMat}),this._leftAxisNode=r.createLineNode({points:[new t.Vector3(0,0,0),new t.Vector3(-1,0,0)],material:this._axisMat}),this._bottomAxisNode=r.createLineNode({points:[new t.Vector3(0,0,0),new t.Vector3(0,-1,0)],material:this._axisMat}),this._topAxisNode=r.createLineNode({points:[new t.Vector3(0,0,0),new t.Vector3(0,1,0)],material:this._axisMat});var l=this;[this._rightAxisNode,this._leftAxisNode,this._bottomAxisNode,this._topAxisNode].forEach((function(e){e.setVisibility(!1),e.setRenderPasses([a.getRenderList("VCXPreManipulators"),a.getRenderList("VCXManipulators")]),e.excludeFromCSO(!0),e.excludeFromHighlight(!0,!0),e.setNoHighlightNoZ(!0),l.add(e)})),this._MeshNodeHolder.setPickingPriorityId("VCXSection"),this._MeshNode.setPickingPriorityId("VCXSection")},preRender:function(e){if(!this._parent(e))return!1;if(this._globalOpacity>0&&this._MeshNodeHolder&&(this.Modifiable.GetObject()._plane&&this.Modifiable.ExperienceBase.getManager("VCXContextManager"))){var i=this.Modifiable.GetObject().getWorkingRootPathElement();if(i){var r=(u=this.Modifiable.QueryInterface("W3AISGNodeHolder")).getWorldMatrix(e.viewer),o=(new t.Matrix4).getInverse(r),s=this.Modifiable.GetPropertyValue("Actor.ListActors"),n=[];if(s.length)for(var p=0;p<s.length;p++){var u,h=this.Modifiable.GetObject()._experienceBase.ComponentsMap.GetComponentFromID(s[p].Value);if(h)if(u=h.QueryInterface("W3AISGNodeHolder")){var d=u.getPathElement();d&&n.push(d)}}n.length||n.push(i);var c=l.getOrientedBoundingBoxFromPathElements(n,r,e.viewer);c.localBBox.expandByPoint(a.getOFromMatrix(r).applyMatrix4(o));var C=c.localBBox.min,y=c.localBBox.max,m=this.ExperienceBase.getManager("VCXPaperManager");if(this.compactMode){var V=10*m.GetPaperRatio(e,a.getOFromMatrix(r));c.localBBox.min.set(-V,-V),c.localBBox.max.set(V,V)}var f=(new t.Vector3).addVectors(C,y).multiplyScalar(.5);C.clone().applyMatrix4(r),y.clone().applyMatrix4(r),f.clone().applyMatrix4(r);this.setMatrix(r),this._MeshNodeHolder.setMatrix((new t.Matrix4).setPosition(new t.Vector3(0,0,.001*-y.length()))),this._CenteringNode.setMatrix((new t.Matrix4).setPosition(new t.Vector3(f.x,f.y,0)));var b=r.clone().multiply(this._CenteringNode.getMatrix()),P=10*m.GetPaperRatio(e,a.getOFromMatrix(r)),g=1e3*P,_=Math.min(Math.max(P,Math.abs(y.x-C.x)),g),M=Math.min(Math.max(P,Math.abs(y.y-C.y)),g);this._ScalingNode.setMatrix((new t.Matrix4).makeScale(1.1*_,1.1*M,1));var S=new t.Vector3(1.1*-_*.5,0,0),D=4*m.GetPaperRatio(e,S.clone().applyMatrix4(b));this._rightLineNode.setMatrix(this._rightLineNode.getMatrix().makeRotationZ(-Math.PI/2).setPosition(S));var G=new t.Vector3(1.1*_*.5,0,0),x=4*m.GetPaperRatio(e,G.clone().applyMatrix4(b));this._leftLineNode.setMatrix(this._leftLineNode.getMatrix().makeRotationZ(Math.PI/2).setPosition(G));var X=new t.Vector3(0,1.1*-M*.5,0),v=4*m.GetPaperRatio(e,X.clone().applyMatrix4(b));this._bottomLineNode.setMatrix(this._bottomLineNode.getMatrix().setPosition(X));var A=new t.Vector3(0,1.1*M*.5,0),I=4*m.GetPaperRatio(e,A.clone().applyMatrix4(b));this._topLineNode.setMatrix(this._topLineNode.getMatrix().makeRotationZ(Math.PI).setPosition(A)),this._rightAxisNode.setMatrix((new t.Matrix4).makeScale(y.x+.05*_+2*D,1,1)),this._leftAxisNode.setMatrix((new t.Matrix4).makeScale(-C.x+.05*_+2*x,1,1)),this._topAxisNode.setMatrix((new t.Matrix4).makeScale(1,y.y+.05*M+2*I,1)),this._bottomAxisNode.setMatrix((new t.Matrix4).makeScale(1,-C.y+.05*M+2*v,1))}}},GetNode:function(e){return this},update:function(e){this._parent(e);var i=!1,r=this.Modifiable.QueryInterface("VCXIVisibility");r&&(i=r.GetVisibility());var a=this.GetPropertyValue("Section.Plane.Enable")?this.GetOpacity(e):0;if(this._globalOpacity!==a){this._globalOpacity=a;var o=this._globalOpacity>0;o&&(this._MeshNode||(this._viewer=e.viewer,this._Build())),this.setVisibility(o)}var s=this.Modifiable.GetObject()._cappingMaterial;if(s&&i){var n=Math.cos(this.GetPropertyValue("Section.Hatching.Angle")*Math.PI/180),l=Math.sin(this.GetPropertyValue("Section.Hatching.Angle")*Math.PI/180),p=this.GetColorPropertyValue("Section.Capping"),u=this.GetColorPropertyValue("Section.Hatching"),h=this.GetPropertyValue("Section.Hatching.Frequency");s.stripesDirection=new t.Vector2(n+l,l-n),s.spaceWidth=500/(h+1),s.stripesWidth=Boolean(h)?1.5:0,s.spaceColor=p.GetThreeColor(),s.stripesColor=u.GetThreeColor(),s.autoSpaceColor!==this.GetPropertyValue("Section.Capping.ActorColor")&&(s.autoSpaceColor=this.GetPropertyValue("Section.Capping.ActorColor"))}if(!(this._globalOpacity<=0)){this._bodyMat&&(this._bodyMat.opacity=this._globalOpacity);var d=this.GetColorPropertyValue("Actor");this._bodyMat&&this._bodyMat.line&&(this._bodyMat.line.color=d.GetThreeColor(),this._bodyMat.line.opacity=1,this._bodyMat.color=d.GetThreeColor(),this._axisMat.color=d.GetThreeColor()),this.handleLayers()}}})})),define("DS/VCXWebDressup/VCXSection/VCXSectionSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXSection/VCXSectionNode"],(function(e,t){"use strict";return e.extend({init:function(){},getWorldMatrix:function(e){var t=this.getAnchorReferential(),i=this.QueryInterface("VCXIModifiable");return i&&(this._actorPosition=i.GetFramePropertyValue("Actor.Position"),this._actorPosition&&t.multiply(this._actorPosition)),t},buildSGNode:function(){if(!this._sgNode){var e={name:"Section",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Section.png")}return this._parent()}})})),define("DS/VCXWebDressup/VCXRedLine/VCXRedLineNode",["DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebSystem/VCXMeshServices"],(function(e,t,i,r){"use strict";return i.extend({init:function(t){return this._parent(t),this._localMaterial=new e.LineBasicMaterial({color:(new e.Color).setRGB(1,0,0),opacity:1,dashSize:0,gapSize:0}),this},_Build:function(){this._Node||(this._Node=new i({name:"RedLineCore"}),this.add(this._Node));for(var e=this._Node.getChildren(),a=e.length-1;a>=0;--a)this._Node.removeChild(e[a]);var o=this.Modifiable.GetPropertyValue("Collab.VertexBuffers");if(o)for(var s=0;s<o.length;++s){var n=o[s].GetValue(),l=this._BuildFloat32arrayFromBase64(n);if(l){var p=r.buildLine(l,new t.Color(1,0,0,1),1,null,null);p.setPickParent(!0),this._updateGeom(p,1)}}},_BuildFloat32arrayFromBase64:function(e){if(!e||!e.length)return null;for(var t=window.atob(e),i=new Uint8Array(t.length),r="",a=0,o=0;o<t.length;++o)","!==t[o]?r+=t[o]:(i[a++]=parseInt(r),r="");i[a++]=parseInt(r);var s=new ArrayBuffer(a),n=new Uint8Array(s);for(o=0;o<n.length;++o)n[o]=i[o];return s.byteLength%4?null:new Float32Array(s)},_updateGeom:function(e,t){if(this._Node){if(t)this._Node.addChild(e);else{var i=this._Node.getChildren();i.length&&this._Node.removeChild(i[i.length-1]),this._Node.addChild(e)}e.setMaterial(this._localMaterial),this._localMaterial.force=!0,this.update()}},preRender:function(e){if(!this._parent(e))return!1;if(this._localMaterial){this._localMaterial.handleByPrerender=!0;var t=this.ExperienceBase.getManager("VCXPaperManager");let e=Math.round(t.UnitValueToPixel(this.Modifiable.GetPropertyValue("Collab.Body.Line.Width")));e>=1?this._localMaterial.lineWidth!==e&&(this._localMaterial.setLineWidth(e),this._localMaterial.visible=!0):this._localMaterial.visible&&(this._localMaterial.visible=!1)}},GetNode:function(e){return this},update:function(e){if(this._Node||this._Build(),this._parent(e),this._globalOpacity!==this.GetOpacity(e)){this._globalOpacity=this.GetOpacity(e);var t=this._globalOpacity>0;t&&(this._Node&&this._Node.getChildren().length||this._Build()),this._Node&&this._Node.setVisibility(t)}if(!(this._globalOpacity<=0)&&this._Node){var i=this.GetAnchorWorldMatrix(0,e);i&&this.setMatrix(i);var r=this.GetColorPropertyValue("Actor");this._localMaterial.color=r.GetThreeColor(),this._localMaterial.force=!0;var a=this.GetPropertyValue("Collab.Body.Line.Width");this._localMaterial.setLineWidth(a),this._localMaterial.opacity=this._globalOpacity,this.handleLayers()}}})})),define("DS/VCXWebDressup/VCXRedLine/VCXRedLineSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXRedLine/VCXRedLineNode"],(function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode||void 0===this._sgNode){var e={name:"RedLine",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_RedLineLeaf.png")}return this._parent()}})})),define("DS/VCXWebDressup/VCX3DAligner/VCX3DAlignerNode",["DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/Visualization/ThreeJS_DS"],(function(e,t,i){"use strict";return e.extend({init:function(e){return this._parent(e),this._nodeMagnetOn=null,this._nodeMagnetOff=null,this},_Build:function(){var e={name:"HandSmartNode",modifiable:this.Modifiable};this._Smart3DPaperNode=new t(e),this._Smart3DPaperNode.SizeControlType=1,this._Smart3DPaperNode.ScalingFactor=2,this._Smart3DPaperNode.setVisibilityInTree(!1),this._Smart3DPaperNode.excludeFromCSO(!0),this._Smart3DPaperNode.excludeFromHighlight(!0,!0),this.add(this._Smart3DPaperNode);let i=this.ExperienceBase.getManager("VCXVisuManager");this._nodeMagnetOn=i.load3DXMLModel("3DAligner_MagnetON"),this._nodeMagnetOff=i.load3DXMLModel("3DAligner_MagnetOFF"),this._nodeMagnetOff&&this._Smart3DPaperNode.add(this._nodeMagnetOff),this._nodeMagnetOn&&this._Smart3DPaperNode.add(this._nodeMagnetOn),this.switchOn2Off(),this._Smart3DPaperNode.traverse((function(e){return e.excludeFromHighlight(!0,!0),!1}),!0)},switchOff2On:function(){this._nodeMagnetOff&&this._nodeMagnetOff.setVisibility(!1),this._nodeMagnetOn&&this._nodeMagnetOn.setVisibility(!0)},switchOn2Off:function(){this._nodeMagnetOff&&this._nodeMagnetOff.setVisibility(!0),this._nodeMagnetOn&&this._nodeMagnetOn.setVisibility(!1)},preRender:function(e){this._globalOpacity>0&&this._Smart3DPaperNode&&this._Smart3DPaperNode.preRender(e)},update:function(e){if(this._parent(e),this._globalOpacity!==this.GetOpacity(e)){this._globalOpacity=this.GetOpacity(e);var t=this._globalOpacity>0;t&&(this._Smart3DPaperNode||this._Build()),this._Smart3DPaperNode&&this._Smart3DPaperNode.setVisibility(t)}this._globalOpacity<=0||(this._Smart3DPaperNode&&this._Smart3DPaperNode.update(e),this.handleLayers())}})})),define("DS/VCXWebDressup/VCX3DAligner/VCX3DAlignerSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCX3DAligner/VCX3DAlignerNode"],(function(e,t){"use strict";return e.extend({init:function(){},getWorldMatrix:function(e){var t=this.getAnchorReferential(),i=this.QueryInterface("VCXIModifiable");return i&&(this._actorPosition=i.GetFramePropertyValue("Actor.Position"),this._actorPosition&&t.multiply(this._actorPosition)),t},buildSGNode:function(){if(!this._sgNode){var e={name:"3DAligner",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Section.png")}return this._parent()}})})),define("DS/VCXWebDressup/VCXMagnetLine/VCXMagnetLineNode",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXDressup_Spec","DS/VCXWebDressup/VCXDressupNode","DS/Visualization/Node3D","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/VCXWebProperties/VCXColor"],(function(e,t,i,r,a,o,s,n,l){"use strict";return i.extend({init:function(e){return this._parent(e),this._axisMat=null,this._dotMatExtremity=null,this._sphereParamsExtremity=null,this._dotMatMagnetPoint=null,this._sphereParamsMagnetPoint=null,this._Smart3DPaperNode=null,this._lineNode=null,this._arcNode=null,this._lineNodeManip=null,this._magnetPointNode=null,this._magnetPoint2Display=new Array,this._displayExtendedLine=!1,this},DisplayExtendedLine:function(e){e!=this._displayExtendedLine&&(e?(this._displayExtendedLine=!0,this._posBeforeManipulateA=this._getExtremityA(),this._posBeforeManipulateB=this._getExtremityB()):(this._displayExtendedLine=!1,this._posBeforeManipulateA=null,this._posBeforeManipulateB=null,this.remove(this._lineNodeManip)))},_getExtremityA:function(){var e=this.GetPropertyValue("Collab.MagnetLine.Position.A.X"),t=this.GetPropertyValue("Collab.MagnetLine.Position.A.Y");return new o.Vector3(e,t,0)},_getExtremityB:function(){var e=this.GetPropertyValue("Collab.MagnetLine.Position.B.X"),t=this.GetPropertyValue("Collab.MagnetLine.Position.B.Y");return new o.Vector3(e,t,0)},_Build:function(){const e=this.Modifiable.QueryInterface("VCXIVisibility");if(!e||1===e.GetVisibility()){this._BuildMaterials(),void 0!==this._lineNode&&null!==this._lineNode||(this._lineNode=this._BuildLineNode()),void 0===this._arcNode||this._arcNode;var t=this._getExtremityA(),r=this._getExtremityB();this._dotA??=this._dotA=n.createSphereNode(this._sphereParamsExtremity),this._dotA.applyMatrix((new o.Matrix4).makeTranslation(t.x,t.y,0)),this._dotB??=this._dotB=n.createSphereNode(this._sphereParamsExtremity),this._dotB.applyMatrix((new o.Matrix4).makeTranslation(r.x,r.y,0)),void 0!==this._lineNodeManip&&null!==this._lineNodeManip||(this._lineNodeManip=this._BuildExtendedLine(t,r));var s={name:"MagnetLineSmartNode",modifiable:this.Modifiable};this._Smart3DPaperNode??=this._Smart3DPaperNode=new a(s),this._Smart3DPaperNode.BillboardType=a.BillboardTypeEnum.SPHERICAL,this._Smart3DPaperNode.SizeControlType=a.SizeControlTypeEnum.InPaper,this._Smart3DPaperNode.PositioningType=1e3,this._Smart3DPaperNode.Depth=0,this._magnetPointNode=new i(s),this._lineNode&&this._Smart3DPaperNode.add(this._lineNode),this._dotA&&this._Smart3DPaperNode.add(this._dotA),this._dotB&&this._Smart3DPaperNode.add(this._dotB),this._magnetPointNode&&this._Smart3DPaperNode.add(this._magnetPointNode),this._displayExtendedLine&&(this.remove(this._lineNodeManip),this.add(this._lineNodeManip)),this.add(this._Smart3DPaperNode)}},_BuildExtendedLine:function(t,i){var r=new o.Vector3(i.x-t.x,i.y-t.y,i.z-t.z),a=new o.Vector3(t.x-i.x,t.y-i.y,t.z-i.z);r.normalize(),r.multiplyScalar(10),a.normalize(),a.multiplyScalar(10);var p=t;p.add(a);var u=i;u.add(r),this._axisMatManipulate=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams({type:e.ELineType.Dot,lineWidth:1,color:(new l).SetRGB(1,123/255,0).GetThreeColor(),opacity:1});var h={points:[p,u],editable:!0,drawMode:s.ConnectivityTypeEnum.LINES,material:this._axisMatManipulate},d=n.createLineNode(h);return d.setVisibilityInTree(!1),d.excludeFromHighlight(!0,!0),this._posBeforeManipulateA=this._getExtremityA(),this._posBeforeManipulateB=this._getExtremityB(),d},_BuildMaterials:function(){void 0!==this._axisMat&&null!==this._axisMat||(this._axisMat=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams({type:e.ELineType.Dot,lineWidth:2,color:(new l).SetRGB(0,0,0).GetThreeColor(),opacity:1})),void 0!==this._dotMatExtremity&&null!==this._dotMatExtremity||(this._dotMatExtremity=new o.MeshBasicMaterial({side:o.DoubleSide,opacity:1,color:(new l).SetRGB(0,0,0).GetThreeColor(),force:!0})),void 0!==this._sphereParamsExtremity&&null!==this._sphereParamsExtremity||(this._sphereParamsExtremity={matrix:new o.Matrix4,radius:.6,material:this._dotMatExtremity}),void 0!==this._dotMatMagnetPoint&&null!==this._dotMatMagnetPoint||(this._dotMatMagnetPoint=new o.MeshBasicMaterial({side:o.DoubleSide,opacity:1,color:(new l).SetRGB(231/255,123/255,2/255).GetThreeColor(),force:!0})),void 0!==this._sphereParamsMagnetPoint&&null!==this._sphereParamsMagnetPoint||(this._sphereParamsMagnetPoint={matrix:new o.Matrix4,radius:1,material:this._dotMatMagnetPoint})},_BuildLineNode:function(){this._BuildMaterials();var e={points:[this._getExtremityA(),this._getExtremityB()],editable:!0,drawMode:s.ConnectivityTypeEnum.LINES,material:this._axisMat},t=n.createLineNode(e);return t.setVisibilityInTree(!1),t},_BuildArcNode:function(){this._BuildMaterials();var e=this._getExtremityA(),t=this._getExtremityB(),i=new o.Vector3((t.x-e.x)/2+e.x,(t.y-e.y)/2+e.y,(t.z-e.z)/2+e.z),r=this.Modifiable.GetObject().computeArcCenter(),a=r.distanceTo(e),s=this.Modifiable.GetObject()._curvature<0,p=new o.Vector3(e.x,e.y+100,e.z),u=this.Modifiable.GetObject().computeAngleRad(t,p,e);t.x<e.x&&(u*=-1);var h=this.Modifiable.GetObject().computeAngleRad(e,t,r),d=Math.PI-h/2+u,c=Math.PI+h/2+u;if(s){var C=d;d=c+Math.PI,c=C+Math.PI}var y=n.createCircleNode({radius:a,segments:96,fill:!1,layerNb:1,color:(new l).SetRGB(255,0,0).GetThreeColor(),opacity:1,startAngle:d,endAngle:c,noEdge:!1,material:this._axisMat});y.setShadow(!1),y.setVisibilityInTree(!1);var m=r.x-i.x,V=-1*r.y+i.y;return y.setMatrix((new o.Matrix4).makeTranslation(m,V,0)),y},preRender:function(e){if(!this._parent(e))return!1;this._Smart3DPaperNode&&this._Smart3DPaperNode.preRender(e)},GetNode:function(e){return this},update:function(e){if(this._parent(e),this._globalOpacity!==this.GetOpacity(e)){this._globalOpacity=this.GetOpacity(e);var t=this._globalOpacity>0;t&&(this._Smart3DPaperNode||this._Build()),this._Smart3DPaperNode&&this._Smart3DPaperNode.setVisibility(t)}if(this._Smart3DPaperNode){var i=this._getExtremityA(),r=this._getExtremityB(),a=new o.Vector3((r.x-i.x)/2+i.x,(r.y-i.y)/2+i.y,(r.z-i.z)/2+i.z),l=this.Modifiable.GetNewProperty("Collab.3D.Paper.Paper.Position.X",a.x),p=this.Modifiable.GetNewProperty("Collab.3D.Paper.Paper.Position.Y",a.y);if(this.Modifiable.OnChangeProperty("Collab.3D.Paper.Paper.Position.X",l.GetPropertyValue()),this.Modifiable.OnChangeProperty("Collab.3D.Paper.Paper.Position.Y",p.GetPropertyValue()),this._Smart3DPaperNode.update(e),this._lineNodeManip&&this._displayExtendedLine){var u=this._lineNodeManip.getBuffer(s.VertexComponentEnum.POSITION);if(void 0!==u){const e=this.ExperienceBase.getManager("VCXPaperManager");var h=this.ExperienceBase.getManager("VCXContextManager").getMainViewer(),d=e.MMToModel2({viewer:h,viewpoint:h.currentViewpoint},this._posBeforeManipulateA),c=e.MMToModel2({viewer:h,viewpoint:h.currentViewpoint},this._posBeforeManipulateB);u[0]=d.x,u[1]=d.y,u[2]=d.z,u[3]=c.x,u[4]=c.y,u[5]=c.z,this._lineNodeManip.updateBuffer(s.VertexComponentEnum.POSITION,0,u.length)}this.remove(this._lineNodeManip),this.add(this._lineNodeManip)}if(this._lineNode){var C=this.GetPropertyValue("Actor.Color");this._axisMat.color=C,this._lineNode.setMaterial(this._axisMat);var y=this._lineNode.getBuffer(s.VertexComponentEnum.POSITION);void 0!==y&&(y[0]=i.x-a.x,y[1]=r.y-a.y,y[2]=0,y[3]=r.x-a.x,y[4]=i.y-a.y,y[5]=0,this._lineNode.updateBuffer(s.VertexComponentEnum.POSITION,0,y.length)),this._dotA.setMatrix((new o.Matrix4).makeTranslation(y[0],y[1],0)),this._dotB.setMatrix((new o.Matrix4).makeTranslation(y[3],y[4],0))}this._magnetPointNode.removeChildren();const t=this.ExperienceBase.getManager("VCXVisuManager");for(var m=0;m<this._magnetPoint2Display.length;m++){var V=n.createSphereNode(this._sphereParamsMagnetPoint),f=this._magnetPoint2Display[m].x-a.x,b=-1*this._magnetPoint2Display[m].y+a.y;V.excludeFromHighlight(!0,!0),V.applyMatrix((new o.Matrix4).makeTranslation(f,b,0)),V.setRenderPasses([t.getRenderList("VCXPreManipulators"),t.getRenderList("VCXManipulators")]),this._magnetPointNode.addChild(V)}this._Smart3DPaperNode.remove(this._arcNode),this._Smart3DPaperNode.remove(this._lineNode),0==this.Modifiable.GetObject()._curvature?this._lineNode&&this._Smart3DPaperNode.add(this._lineNode):(this._arcNode=this._BuildArcNode(),this._Smart3DPaperNode.add(this._arcNode))}},setMagnetPoint2Show:function(e,t){t?this._magnetPoint2Display.push(...e):this._magnetPoint2Display=e}})})),define("DS/VCXWebDressup/VCXMagnetLine/VCXMagnetLineSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXMagnetLine/VCXMagnetLineNode"],(function(e,t){"use strict";return e.extend({init:function(){},getWorldMatrix:function(e){var t=this.GetObject()._experienceBase.getManager("VCXContextManager"),i=this.GetObject().getWorkingRootPathElement().getWorldMatrix(t.getMainViewer()),r=this.QueryInterface("VCXIModifiable");if(r)return this._actorPosition=r.GetFramePropertyValue("Actor.Position"),this._actorPosition&&i.multiply(this._actorPosition),i},buildSGNode:function(){if(!this._sgNode){var e={name:"MagnetLine",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_MagnetLineLeaf.png")}return this._parent()}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXMarkup/VCXMarkupPrepareRenderToTexture",["require","exports","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","DS/VCXWebDressup/VCXDressupPrepareRenderToTexture","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueBoolean"],(function(e,t,i,r,a,o){"use strict";a=__importDefault(a),o=__importDefault(o);return class extends r{filterVisibleTopLayerProperty(e){if(super.filterVisibleTopLayerProperty(e))return!0;switch(e.GetPropertyInfo().GetPropertyName()){case"Collab.3D.Paper.Is.Background":case"Actor.Opacity":return!0}return!1}filterWhiteLayerProperty(e){if(super.filterWhiteLayerProperty(e))return!0;switch(e.GetPropertyInfo().GetPropertyName()){case"Collab.Attach.ExtremityType.Additionnal":case"Collab.Image.Doc.PrepareRender":return!0}return!1}GetType(){return"VCXMarkupPrepareRenderToTexture"}getValueForMask(e,t){return"Collab.Attach.ExtremityType.Additionnal"===e?new a.default(i.EExtremityType.White):"Collab.3D.Paper.Is.Background"===e?new o.default(!1):"Collab.Image.Doc.PrepareRender"===e?new o.default(!0):super.getValueForMask(e,t)}}})),define("DS/VCXWebDressup/VCXMarkup/VCXMeasurementPrepareRenderToTexture",["require","exports","DS/VCXWebDressup/VCXMarkup/VCXMarkupPrepareRenderToTexture"],(function(e,t,i){"use strict";return class extends i{async prepareRender(e,t){let i=this.GetObject()?.QueryInterface("W3AISGNodeHolder")?.getSGNode();i&&(i._primaryAdditionalGeometryMaterial=null,i._secondaryAdditionalGeometryMaterial=null,i._thirdAdditionalGeometryMaterial=null,i._fourthAdditionalGeometryMaterial=null),super.prepareRender(e,t)}async postRender(e,t){super.postRender(e,t)}GetType(){return"VCXMeasurementPrepareRenderToTexture"}}})),define("DS/VCXWebDressup/VCXMarkup/VCXAttachTooltipNode",["DS/Mesh/MeshUtils","DS/VCXWebDressup/VCXDressupNode","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS"],(function(e,t,i,r){"use strict";var a=t.extend({init:function(e){return this._parent(e),this.anchorID=e.anchorID,this._bConsiderCurvature="boolean"!=typeof e.bConsiderCurvature||e.bConsiderCurvature,this.updateParams(),this._StartExtremity=new r.Vector3,this._EndExtremity=new r.Vector3,this._zValue=new r.Vector3,this},updateParams:function(){this._bConsiderCurvature||console.log("Shouldn't we consider a curvature at anytime, to be sure ?"),this._bGradientBackGround=this.GetPropertyValue("Collab.Attach.Background.Gradient"),this._bGradientBorder=this.GetPropertyValue("Collab.Attach.Border.Gradient"),this._step=this._bConsiderCurvature?32:1,this._verticesNb=2*this._step+1,this._lineIndicesNb=2*this._verticesNb;var e=2*this._step-1;this._trianglesIndicesNb=3*e},dispose:function(){this._Node&&this.removeChild(this._Node)},_getAngleBetweenXAxisAndVector:function(e){var t=new r.Vector3(1,0,0),i=new r.Vector3(0,1,0),a=Math.acos(t.dot(e));return i.dot(e)<0&&(a=2*Math.PI-a),a},_getArcVerticesPosFromStartEndPosRadDiffAndCurvSign:function(e,t,i,a,o){var s=[],n=new r.Vector3(0,0,1),l=o?1:-1,p=(new r.Vector3).addVectors(e,t).multiplyScalar(.5),u=(new r.Vector3).subVectors(e,t);u.cross(n),u.normalize(),p.x+=u.x*i,p.y+=u.y*i;var h,d,c,C=(new r.Vector3).subVectors(e,p),y=(new r.Vector3).subVectors(t,p);o?(h=C.length(),d=this._getAngleBetweenXAxisAndVector(C.normalize()),c=this._getAngleBetweenXAxisAndVector(y.normalize())):(h=y.length(),d=this._getAngleBetweenXAxisAndVector(y.normalize()),c=this._getAngleBetweenXAxisAndVector(C.normalize())),c-d<0&&a*l==1?d-=2*Math.PI:c-d>0&&a*l==-1&&(c-=2*Math.PI);for(var m,V=0,f=Math.abs((c-d)%(2*Math.PI)),b=0;b<=this._step;++b){var P=b/this._step;V=d+a*l*f*P,m=o?e.z*(1-P)+t.z*P:e.z*P+t.z*(1-P);var g=new r.Vector3(p.x+h*Math.cos(V),p.y+h*Math.sin(V),m);s.push(g)}return s},_getAttachShapeVerticesPositionsWithCurvature:function(e,t,i,a){var o=new r.Vector3(0,0,1),s=(new r.Vector3).subVectors(e,t),n=.5*s.length(),l=n;0===a&&(a=.001),l=Math.abs(100*l/a);var p=a>0?-1:1,u=(new r.Vector3).addVectors(e,t).multiplyScalar(.5),h=(l-n)*p;s.z=0,s.cross(o),s.normalize();var d=s.clone().multiplyScalar(h);u.add(d),u.z=0;var c=(new r.Vector3).subVectors(e,u);c.z=0,c.normalize();var C=(new r.Vector3).copy(c).multiplyScalar(2.5*i).add(e),y=(new r.Vector3).copy(c).multiplyScalar(-2.5*i).add(e),m=this._getArcVerticesPosFromStartEndPosRadDiffAndCurvSign(C,t,h,p,!0);m.pop();var V=this._getArcVerticesPosFromStartEndPosRadDiffAndCurvSign(y,t,h,p,!1);return m.concat(V)},_getAttachShapeVerticesPositionsWithoutCurvature:function(e,t,i){var a=[],o=new r.Vector3(0,0,1),s=(new r.Vector3).subVectors(e,t),n=(new r.Vector3).crossVectors(s,o).normalize(),l=(new r.Vector3).copy(n).multiplyScalar(2.5*i).add(e),p=(new r.Vector3).copy(n).multiplyScalar(-2.5*i).add(e);return a.push(l),a.push(t),a.push(p),a},_computePosBuffers:function(e,t,i){var r,a=this.ExperienceBase.getManager("VCXPaperManager"),o=this.StartExtremity.clone(),s=this.EndExtremity.clone(),n=a.ModelToMM2(e,o),l=a.ModelToMM2(e,s),p=this.GetPropertyValue("Collab.Attach.Line.Width");if(this._bConsiderCurvature){var u=this.GetPropertyValue("Collab.Attach.Curvature");r=this._getAttachShapeVerticesPositionsWithCurvature(n,l,p,u)}else r=this._getAttachShapeVerticesPositionsWithoutCurvature(n,l,p);for(var h=[],d=0;d<r.length;++d){var c=r[d],C=a.MMToModel2(e,c);h.push(C)}for(var y=h.length,m=0;m<y;++m)t[3*m+0]=h[m].x,t[3*m+1]=h[m].y,t[3*m+2]=h[m].z,i[3*m+0]=h[m].x,i[3*m+1]=h[m].y,i[3*m+2]=h[m].z},_computeColorBuffers:function(e,t){for(var i=this.GetColorPropertyValue("Collab.Attach.Line").GetRGBA(),r=0;r<=this._step;++r){var a=4*r,o=4*(this._verticesNb-1-r),s=this._bGradientBackGround?r*i[3]/this._step:i[3];e[a+0]=i[0],e[a+1]=i[1],e[a+2]=i[2],e[a+3]=s,e[o+0]=i[0],e[o+1]=i[1],e[o+2]=i[2],e[o+3]=s;var n=this._bGradientBorder?r*i[3]/this._step:i[3];t[a+0]=0,t[a+1]=0,t[a+2]=0,t[a+3]=n,t[o+0]=0,t[o+1]=0,t[o+2]=0,t[o+3]=n}},_computeBuffers:function(e,t,i,r,a){this._computePosBuffers(e,t,r),this._computeColorBuffers(i,a)},_Build:function(){this._bkGrndPrimGrp=new e.PrimitiveGroup({editable:!0}),this._borderPrimGrp=new e.PrimitiveGroup({editable:!0});var a=new e.Buffer({component:e.VertexComponentEnum.POSITION,data:new Float32Array(3*this._verticesNb),dimension:3}),o=new e.Buffer({component:e.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(4*this._verticesNb),dimension:4}),s=new e.Buffer({indexBuffer:!0,data:new Uint16Array(this._trianglesIndicesNb)}),n=new e.Buffer({component:e.VertexComponentEnum.POSITION,data:new Float32Array(3*this._verticesNb),dimension:3}),l=new e.Buffer({component:e.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(4*this._verticesNb),dimension:4}),p=new e.Buffer({indexBuffer:!0,data:new Uint16Array(this._lineIndicesNb)});this._bkGrndPrimGrp.addBuffer(0,a),this._bkGrndPrimGrp.addBuffer(1,o),this._bkGrndPrimGrp.addBuffer(2,s),this._borderPrimGrp.addBuffer(0,n),this._borderPrimGrp.addBuffer(1,l),this._borderPrimGrp.addBuffer(2,p);var u=0,h=0,d=s.data,c=this._verticesNb-1;for(h=0;h<this._step-1;++h)d[u++]=h,d[u++]=c-h,d[u++]=c-(h+1),d[u++]=h,d[u++]=c-(h+1),d[u++]=h+1;for(d[u++]=this._step-1,d[u++]=this._step+1,d[u++]=this._step,d=p.data,u=0,h=0;h<this._verticesNb;++h)d[u++]=h,d[u++]=h!==this._verticesNb-1?h+1:0;var C=new e.Primitive({nbIndices:this._trianglesIndicesNb,connectivity:e.ConnectivityTypeEnum.TRIANGLES}),y=new e.VertexComponent({nbVertices:this._verticesNb,bufferId:0,indices:new e.IndexArray({bufferId:2,offset:0})}),m=new e.VertexComponent({nbVertices:this._verticesNb,bufferId:1,indices:new e.IndexArray({bufferId:2,offset:0})});C.addVertexComponent(y),C.addVertexComponent(m),this._bkGrndPrimGrp.addPrimitive(C);var V=new e.Primitive({nbIndices:this._lineIndicesNb,connectivity:e.ConnectivityTypeEnum.LINES}),f=new e.VertexComponent({nbVertices:this._verticesNb,bufferId:0,indices:new e.IndexArray({bufferId:2,offset:0})}),b=new e.VertexComponent({nbVertices:this._verticesNb,bufferId:1,indices:new e.IndexArray({bufferId:2,offset:0})});V.addVertexComponent(f),V.addVertexComponent(b),this._borderPrimGrp.addPrimitive(V);this._bodyMat=new r.MeshBasicMaterial({side:r.DoubleSide,vertexColors:r.VertexColors,color:"#ffffff",transparent:!0,opacity:1,force:!0,depthTest:true,depthWrite:false}),this._lineMat=new r.LineBasicMaterial({side:r.DoubleSide,vertexColors:r.VertexColors,color:"#ffffff",transparent:!0,opacity:1,polygonBorderMode:!1,force:!0,depthTest:true,depthWrite:false}),this._NodeBkGrnd=i.createMeshNode(this._bkGrndPrimGrp),this._NodeBkGrnd.setMaterial(this._bodyMat),this._NodeBkGrnd.setVisibilityInTree(!1),this._NodeBorder=i.createMeshNode(this._borderPrimGrp),this._NodeBorder.setMaterial(this._lineMat),this._NodeBorder.setVisibilityInTree(!1),this._Node=new t({name:"AttachCore"}),this._Node.addChild(this._NodeBkGrnd),this._Node.addChild(this._NodeBorder),this.addChild(this._Node),this.handleLayers(!0)},preRender:function(t){var i=this._NodeBkGrnd.getBuffer(e.VertexComponentEnum.POSITION),r=this._NodeBkGrnd.getBuffer(e.VertexComponentEnum.DIFFUSE_COLOR),a=this._NodeBorder.getBuffer(e.VertexComponentEnum.POSITION),o=this._NodeBorder.getBuffer(e.VertexComponentEnum.DIFFUSE_COLOR);void 0!==i&&void 0!==r&&void 0!==a&&void 0!==o&&(this._computeBuffers(t,i,r,a,o),this._NodeBkGrnd.updateBuffer(e.VertexComponentEnum.POSITION,0,this._verticesNb),this._NodeBkGrnd.updateBuffer(e.VertexComponentEnum.DIFFUSE_COLOR,0,this._verticesNb),this._NodeBkGrnd.computeBoundingElements(),this._NodeBorder.updateBuffer(e.VertexComponentEnum.POSITION,0,this._verticesNb),this._NodeBorder.updateBuffer(e.VertexComponentEnum.DIFFUSE_COLOR,0,this._verticesNb),this._NodeBorder.computeBoundingElements())},update:function(e){if(this._parent(e),this._globalOpacity!==this.GetOpacity(e)){this._globalOpacity=this.GetOpacity(e);var t=this._globalOpacity>0;t&&(this._Node||this._Build()),this._Node&&(this._lineMat.setLineWidth(2),this._Node.setVisibility(t)),this._ExtremityNode&&this._ExtremityNode.setVisibility(t)}this._globalOpacity<=0||(this._ExtremityNode&&this._ExtremityNode.update(e),this._Node&&(this.updateParams(),this._bodyMat&&(this._bodyMat.opacity=this._globalOpacity),this._lineMat&&(this._lineMat.opacity=this._globalOpacity),this.handleLayers()))},postUpdate:function(e){this._parent(e),this._ExtremityNode&&this._ExtremityNode.postUpdate(e)}});return Object.defineProperty(a.prototype,"StartExtremity",{enumerable:!0,get:function(){return this._StartExtremity},set:function(e){this._StartExtremity=e}}),Object.defineProperty(a.prototype,"EndExtremity",{enumerable:!0,get:function(){return this._EndExtremity},set:function(e){this._EndExtremity=e}}),a})),define("DS/VCXWebDressup/VCXViewpoint/VCXForegroundNode",["DS/VCXWebDressup/VCXDressupNode","DS/WebappsUtils/WebappsUtils","DS/Visualization/ThreeJS_DS","DS/VCXWebVisualization/VCXImageManager","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/VCXWebDressup/VCXSmart3DPaperNode"],(function(e,t,i,r,a,o,s){"use strict";var n=e.extend({init:function(e){return this._parent(e),this},dispose:function(){this._Smart3DPaperNode&&(this._Smart3DPaperNode.dispose(),this._Smart3DPaperNode=null),this._parent()},_Build:function(){var e=this.Modifiable.ExperienceBase.getManager("VCXVisuManager");this.setRenderPasses([e.getRenderList("VCXPreForeground"),e.getRenderList("VCXForeground")]),this._currentTime=0;var r=i.ImageUtils.loadTexture(t.getWebappsBaseUrl()+"VCXWebDressup/assets/textures/fgTextureA.png");r.wrapS=i.RepeatWrapping,r.wrapT=i.RepeatWrapping,r.repeat.set(500,500),this._bodyMat=new i.MeshLambertMaterial({color:"#ffffff",map:r,side:i.DoubleSide}),this._bodyMat.force=!0,this._MeshNode=o.createRectangleNode({width:1,height:1,fill:!0,material:this._bodyMat});var n=new i.Vector2(1e3,1e3,1),l=this.Modifiable.ExperienceBase.getManager("VCXPaperManager");l&&(n=l.Size,this._MeshNode.setMatrix((new i.Matrix4).makeScale(n.x,n.y,1)));var p=new i.Matrix4;p.multiply((new i.Matrix4).makeScale(100*n.x,100*n.y,1)),p.multiply((new i.Matrix4).makeRotationAxis(new i.Vector3(0,0,1),.3*Math.PI)),p.multiply((new i.Matrix4).makeTranslation(-.5,-.5,0)),this._MeshNode.setMatrix(p),this._MeshNode.setVisibilityInTree(!1);var u={name:"ForegroundSmartNode",experience:this.ExperienceBase};this._Smart3DPaperNode=new s(u),this._Smart3DPaperNode.Position2D.x=.5*n.x,this._Smart3DPaperNode.Position2D.y=.5*n.y,this._Smart3DPaperNode.BillboardType=2,this._Smart3DPaperNode.SizeControlType=1,this._Smart3DPaperNode.PositioningType=1e3,this._Smart3DPaperNode.Depth=0,this._Smart3DPaperNode.add(this._MeshNode),this.add(this._Smart3DPaperNode),this.traverse((function(e,t){e.setPickable(a.PICKTHROUGH),e.excludeFromHighlight(t,t)}),!0)},preRender:function(e){if(!this._parent(e))return!1;this._bodyMat&&(this._currentTime+=.01,this._bodyMat.opacity=this._globalOpacity*(.4*Math.cos(this._currentTime)+.6)),this._Smart3DPaperNode&&this._Smart3DPaperNode.preRender(e)},GetVarianceNode(e){return new n({name:e.viewerID+"_"+this.name,modifiable:this.Modifiable,experience:this.ExperienceBase})},update:function(e){var t=0;if(this.Modifiable.ExperienceBase.getManager("VCXDRMManager").GetDisplayWatermark()&&(t=1),this._globalOpacity!==t){this._globalOpacity=t;var i=this._globalOpacity>0;i&&(this._Smart3DPaperNode||this._Build()),this._Smart3DPaperNode&&this._Smart3DPaperNode.setVisibility(i)}}});return n})),define("DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeTopAndLeft",["DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS"],(function(e,t){"use strict";return e.extend({rewind:function(){this._parent(),this.iSwap=0,this.iPariteX=0,this.iPariteY=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0),this.maxfx=this.fHalfSizeX-this.fCellSize-this.fCellSize,this.LRiPariteX=0,this.LRiPariteY=0,this.LRfX=this.fHalfSizeX-this.fCellSize,this.LRfX<0&&(this.LRfX=0),this.LRdy=0,this.LRfY=0,this.LRmaxfy=this.fHalfSizeY-this.fCellSize},next:function(){if(this._parent(),this.iSwap++,1&this.iSwap){if(this.LRiPariteY++,2===this.LRiPariteY&&(this.LRiPariteY=0,this.LRfY+=this.fCellSize,this.LRfY>this.fHalfSizeY-this.fCellSize&&(0===this.LRdy?this.LRdy=.5*this.fCellSize:this.LRdy=0,this.LRfY=0,this.LRfX-=this.fCellSize,this.LRfX<this.fCellSize)))return this.rewind(),!0}else if(0==this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.maxfx&&(this.maxfx-=this.fCellSize,this.maxfx<this.fCellSize&&(this.maxfx=this.fCellSize),0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<this.fCellSize)))return this.rewind(),!0;return!1},getPoint:function(){var e=new t.Vector2;return 1&this.iSwap?(e.x=this.fHalfSizeX-this.LRfX,1&this.LRiPariteY?e.y=this.fHalfSizeY-this.LRfY+this.LRdy:e.y=this.fHalfSizeY+this.LRfY+this.LRdy):(1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,e.y=this.fHalfSizeY-this.fY),e}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXCircle/VCXCircle_Spec",["require","exports","DS/VCXWebDressup/VCXDressup_Spec"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{}return function(e){let t;!function(e){e[e.Empty=0]="Empty",e[e.Gradient=1]="Gradient",e[e.Plain=2]="Plain"}(t=e.EBackgroundType||(e.EBackgroundType={}))}(r||(r={})),r.prototype.getDefaultName=function(){return"Circle"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXCircle_Spec"}}),r.prototype.dressupGroupName="Markups",r})),define("DS/VCXWebDressup/VCXCircle/VCXCircleModifiable",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXCircle/VCXCircle_Spec","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","DS/VCXWebDressup/VCXDressupModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebSystem/VCXMathTools"],(function(e,t,i,r,a,o,s,n,l,p,u,h,d,c){"use strict";return r.extend({init:function(){this._parent(),this._bIsCircle=!0},Build:function(){this._parent();var r=[{Name:"Circle.Radius",Type:n,DefaultValue:1,GroupId:"Group.Circle"},{Name:"Circle.Scale",Type:n,DefaultValue:1,GroupId:"Group.Circle"},{Name:"Circle.Thickness",Type:n,DefaultValue:20,Bounds:{Min:0,Max:100,Step:.1},GroupId:"Group.Circle",FormatPainter:!0},{Name:"Collab.Border.AlwaysVisible",Type:s,DefaultValue:!1},{Name:"Collab.3D.Paper.Billboard.Type",Type:h,DefaultValue:i.EBillboardType.Spherical,GroupId:"Group.Circle",MapChoice:this._generateMapChoiceFromEnumAndId(i.EBillboardType,"Billboard.Type",["AlongX_yInCam","AlongX_yInCamUp"]),FormatPainter:!0},{Name:"Collab.Is.Paper",Type:s,DefaultValue:!0,GroupId:"Group.Circle"},{Name:"Circle.Background.Type",Type:h,DefaultValue:t.EBackgroundType.Gradient,GroupId:"Group.Circle",MapChoice:this._generateMapChoiceFromEnumAndId(t.EBackgroundType,"Circle.BackgroundType"),FormatPainter:!0},{Name:"Collab.Background.Color",Type:p,DefaultValue:(new o).FromRGBA(.9294117647058824,.3176470588235294,.3176470588235294,.5),GroupId:"Group.Circle",FormatPainter:!0},{Name:"Collab.Background.Color.Opacity",Type:n,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Circle",FormatPainter:!0},{Name:"Collab.Background2.Color",Type:p,DefaultValue:(new o).FromRGBA(.9294117647058824,.3176470588235294,.3176470588235294,.5),GroupId:"Group.Circle",FormatPainter:!0,visibleInPropertyGroups:!1},{Name:"Collab.Body.Line.Width",Type:n,DefaultValue:1,GroupId:"Group.CircleBorder",FormatPainter:!0},{Name:"Collab.Body.Line.Color",Type:p,DefaultValue:(new o).FromRGBA(.6431372549019608,.1686274509803922,.1568627450980392,1),GroupId:"Group.CircleBorder",FormatPainter:!0},{Name:"Collab.Body.Line.Color.Opacity",Type:n,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.CircleBorder",FormatPainter:!0},{Name:"Collab.Body.Line.Type",Type:h,DefaultValue:e.ELineType.Plain,GroupId:"Group.CircleBorder",MapChoice:this._generateMapChoiceFromEnumAndId(e.ELineType,"Collab.DashType",["UserDefined","Advanced"]),FormatPainter:!0}];this._BuildPropertyValues(r)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Actor.Color",!0),this.GetProperty("Actor.Color").GetPropertyInfo()._bPersistent=!1,this.SetPropertyInvisible("Collab.Background.Color",0===this.GetPropertyValue("Circle.Background.Type")),this.SetPropertyInvisible("Collab.Background.Color.Opacity",0===this.GetPropertyValue("Circle.Background.Type")),this.SetPropertyInvisible("Circle.Thickness",1!==this.GetPropertyValue("Circle.Background.Type")),this.SetPropertyInvisible("Circle.Scale",!0)},GetProperty:function(e){return"Actor.Color"===e?this.GetNewProperty(e,this.GetPropertyValue("Collab.Background.Color")):this._parent(e)},RequestModification:function(e,t){if(e){var i=e.GetPropertyInfo().GetPropertyName();if("Actor.Color"===i){var r=e.GetPropertyValue().Value.getAssociatedColors();return t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Background.Color",r.body)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Body.Line.Color",r.border)),this._parent(e,t)}if("Collab.Is.Paper"===i){var a=this.ExperienceBase.getManager("VCXPaperManager"),o=[{idx:0}];o.forEach((t=>{var i=c.getOFromMatrix(this.GetAnchorWorldMatrix(t.idx)),r=a.GetPaperRatio(null,i),o=1;e.GetPropertyValue().Value?o/=r:o*=r,t.scaleToApply=o}));return[{idx:0,propertyName:"Circle.Radius"}].forEach((e=>{var i=this.GetPropertyValue(e.propertyName);i*=o[e.idx].scaleToApply,t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty(e.propertyName,i))})),t.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,t)}}return this._parent(e,t)}})})),define("DS/VCXWebDressup/VCXMarkup/VCXAttachesNode",["DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXMarkup/VCXAttachSegmentNode","DS/VCXWebDressup/VCXMarkup/VCXAttachTooltipNode","DS/Visualization/ThreeJS_DS","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],(function(e,t,i,r,a,o){"use strict";var s="warning",n={unsupportedAttach:{level:s,title:o["Notification.UnSupportedAttach.Title"],message:o["Notification.UnSupportedAttach.Message"]},noPaperManager:{level:s,title:o["Notification.noPaperManager.Title"],message:o["Notification.noPaperManager.Message"]}};return t.extend({init:function(t){return this._parent(t),this._PanelNode=t.panelNode,this._BentLineSize=2,this._MinAngleAllowed=5,this._MinAngleAllowedRad=this._MinAngleAllowed*Math.PI/180,this._horizontalLineMargin=1,this._AttachType=e.ELeadType.Middle,this._AttachNodes={},this._smartNodeCenter=new a.Vector3,this._xAxis=new a.Vector3,this._yAxis=new a.Vector3,this._zAxis=new a.Vector3,this},_getBentLineVerticesPosInPaper:function(e,t){var i=t?-1:1,r=e.clone();r.x=r.x+i*this._PanelNode.GetShapeInfo().size.x*.5;var a=r.clone();return a.x=a.x+i*this._BentLineSize,{start:r,end:a}},_getHorizontalLineVerticesPosInPaper:function(e,t,i){var r=t?-1:1,a=i?-1:1,o=e.clone();o.x=o.x-r*this._PanelNode.GetShapeInfo().size.x*.5,o.y=o.y+a*(.5*this._PanelNode.GetShapeInfo().size.y+this._horizontalLineMargin);var s=o.clone();return s.x=s.x+r*this._PanelNode.GetShapeInfo().size.x,{start:o,end:s}},_checkBreakStillToBeUsedFromBentEndPos:function(e,t,i){var r=new a.Vector3(e.EndExtremityPaper.x-t.x,e.EndExtremityPaper.y-t.y,e.EndExtremityPaper.z);return i.angleTo(r)*(180/Math.PI)>=90+this._MinAngleAllowed},_findBestCorner:function(e,t){return{left:e.x>t.EndExtremityPaper.x,top:e.y>t.EndExtremityPaper.y}},_ComputePosLinesAttaches:function(t,i){var r,o,s=null,n=null,l=!0,p=!0,u=(new a.Vector3).getPositionFromMatrix(this._PanelNode.GetShapeInfo().smartNode.getMatrix(t)),h=i.ModelToMM2(t,u);if(h.x+=this._PanelNode.GetShapeInfo().center.x,h.y+=this._PanelNode.GetShapeInfo().center.y,this._AttachType===e.ELeadType.Middle)l=!1,p=!1;else if(this._AttachType===e.ELeadType.Line){var d=0,c=0;for(s in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(s)){n=this._AttachNodes[s];var C=this._findBestCorner(h,n);C.top?d++:d--,C.left?c++:c--}var y=this._getHorizontalLineVerticesPosInPaper(h,c>0,d>0),m=this._getHorizontalLineVerticesPosInPaper(h,c<0,d>0);r=i.MMToModel2(t,y.start),o=i.MMToModel2(t,y.end)}else{y=this._getBentLineVerticesPosInPaper(h,!0),m=this._getBentLineVerticesPosInPaper(h,!1);var V=new a.Vector3(h.x-y.end.x,h.y-y.end.y,h.z),f=new a.Vector3(h.x-m.end.x,h.y-m.end.y,h.z);for(s in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(s)){if(!l&&!p)break;n=this._AttachNodes[s],l=l&&this._checkBreakStillToBeUsedFromBentEndPos(n,y.end,V),p=p&&this._checkBreakStillToBeUsedFromBentEndPos(n,m.end,f)}l?(r=i.MMToModel2(t,y.start),o=i.MMToModel2(t,y.end)):p&&(r=i.MMToModel2(t,m.start),o=i.MMToModel2(t,m.end))}for(s in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(s)){if(n=this._AttachNodes[s],this._AttachType===e.ELeadType.Line)n.StartExtremity=r,n.BreakExtremity=o;else if(l||p)n.StartExtremity=r,n.BreakExtremity=o;else{var b=h.clone(),P=new a.Vector3;n.EndExtremityPaper.sub(new a.Vector3(b.x,b.y,0));var g=.5*this._PanelNode.GetShapeInfo().size.x,_=.5*this._PanelNode.GetShapeInfo().size.y,M=this._PanelNode.GetShapeInfo().shape;(M!==e.EBodyShape.None&&M!==e.EBodyShape.RoundedRectangle&&M!==e.EBodyShape.Rectangle&&M!==e.EBodyShape.RoundedSquare&&M!==e.EBodyShape.Square||!this.SegmentIntersectRectangle(n.EndExtremityPaper,-g,-_,g,_,P))&&(M!==e.EBodyShape.Circle&&M!==e.EBodyShape.Ellipse||!this.SegmentIntersectEllipse(n.EndExtremityPaper,g,_,!1,P))||b.add(new a.Vector3(P.x,P.y,0)),n.StartExtremity=i.MMToModel2(t,b),n.BreakExtremity=n.StartExtremity.clone()}n.preRender(t)}},_ComputePosTooltipAttaches:function(e,t){var i,r,o=this.getBodyCenterPosInPaper(e,t);if(this.Modifiable.GetPropertyValue("Collab.Attach.CenteredOrigin"))r=o;else{var s=this.Modifiable.GetPropertyValue("Collab.Attach.Origin");if(s.equals(new a.Vector3)){var n=this.Modifiable.GetProperty("Collab.Attach.Origin").GetPropertyValue().Clone();n.SetValue(o.clone()),this.Modifiable.OnChangeProperty("Collab.Attach.Origin",n),r=this.Modifiable.GetPropertyValue("Collab.Attach.Origin")}else{r=(new a.Vector3).copy(s).setZ(o.z)}}for(var l in i=t.MMToModel2(e,r),this._AttachNodes)if(this._AttachNodes.hasOwnProperty(l)){var p=this._AttachNodes[l];p.StartExtremity=i,p.preRender(e)}},getBodyCenterPosInPaper:function(e,t){var i=(new a.Vector3).getPositionFromMatrix(this._PanelNode.GetShapeInfo().smartNode.getMatrix(e)),r=t.ModelToMM2(e,i);return r.x+=this._PanelNode.GetShapeInfo().center.x,r.y+=this._PanelNode.GetShapeInfo().center.y,r},_ComputePosAttaches:function(t){var i=this.ExperienceBase.getManager("VCXPaperManager");if(i){if(this._AttachType!==e.ELeadType.None&&0!==Object.keys(this._AttachNodes).length){for(var r in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(r)){var a=this.GetAnchorWorldMatrix(r,t);if(a){var o=this._AttachNodes[r];o.EndExtremity.getPositionFromMatrix(a),o.EndExtremityPaper=i.ModelToMM2(t,o.EndExtremity)}}if(this._AttachType===e.ELeadType.Mustache)this._ComputePosTooltipAttaches(t,i);else this._ComputePosLinesAttaches(t,i)}}else this.ExperienceBase.getManager("VCXNotificationManager").addNotification(n.noPaperManager)},dispose:function(){for(var e in this._AttachNodes)this._AttachNodes.hasOwnProperty(e)&&this._AttachNodes[e].dispose();this._AttachNodes={},this._parent()},_Build:function(){},preRender:function(e){this._parent(e),this.viewpointVisibility&&this.GetOpacity(e)?(this.setVisibility(!0),this._ComputePosAttachesSmartNode(e)):this.setVisibility(!1)},update:function(t){this._parent(t);var a=this.GetOpacity(t),o=this.GetPropertyValue("Collab.Attach.LeadType");if(this._AttachType!==o){for(var s in this._AttachNodes)this._AttachNodes.hasOwnProperty(s)&&this._AttachNodes[s].dispose();this._AttachNodes={},this._AttachType=o}var n=!1,l=this.Modifiable&&this.Modifiable._Anchors;for(let e in l)l[e].toDelete=!0;if(l&&Object.keys(l).length>0){this.Modifiable.processAnchorsIDs((t=>{if("Location"!==t)if(this.GetPropertyGroupVisibility("Group.Attach")&&this._AttachType!==e.ELeadType.None&&a>0){if(l[t].toDelete=!1,!this._AttachNodes.hasOwnProperty(t)){var o={name:"AttachNode "+t,modifiable:this.Modifiable,type:this._type,anchorID:t};this._AttachType===e.ELeadType.Mustache?(o.bConsiderCurvature=!0,o.gradientBackGround=this.GetPropertyValue("Collab.Attach.Background.Gradient"),o.gradientBorder=this.GetPropertyValue("Collab.Attach.Border.Gradient"),this._AttachNodes[t]=new r(o)):(o.endExtremityType=this.GetPropertyValue("Collab.Attach.ExtremityType"),this._AttachNodes[t]=new i(o)),this._AttachNodes[t].exludeFromBounding(!0),this.add(this._AttachNodes[t]),n=!0,this.handleLayers(!0)}}else this._AttachNodes.hasOwnProperty(t)&&(this.remove(this._AttachNodes[t]),delete this._AttachNodes[t],n=!0)}));for(let e in l)l[e].toDelete&&this._AttachNodes.hasOwnProperty(e)&&(this.remove(this._AttachNodes[e]),delete this._AttachNodes[e],n=!0);for(var p in this._AttachNodes)this._AttachNodes.hasOwnProperty(p)&&this._AttachNodes[p].update(t)}this.handleLayers(n)},postUpdate:function(e){for(var t in this._parent(e),this._AttachNodes)this._AttachNodes.hasOwnProperty(t)&&this._AttachNodes[t].postUpdate(e)},_ComputePosAttachesSmartNode:function(t){const i=this.ExperienceBase.getManager("VCXPaperManager");if(!i)return void this.ExperienceBase.getManager("VCXNotificationManager").addNotification(n.noPaperManager);if(this._AttachType===e.ELeadType.None||0===Object.keys(this._AttachNodes).length)return;const r=this._PanelNode.GetShapeInfo().smartNode.getMatrix(t);if(!r)return;this._smartNodeCenter.getPositionFromMatrix(r),r.extractBasis(this._xAxis,this._yAxis,this._zAxis),this._xAxis.normalize(),this._yAxis.normalize(),this._zAxis.normalize();const o=i.GetPaperRatio(t,this._smartNodeCenter);var s=this._xAxis.clone().multiplyScalar(this._PanelNode.GetShapeInfo().center.x*o),l=this._yAxis.clone().multiplyScalar(-this._PanelNode.GetShapeInfo().center.y*o);this._smartNodeCenter.add(s).add(l);var p=(new a.Plane).setFromNormalAndCoplanarPoint(this._zAxis,this._smartNodeCenter),u=t.viewpoint.getEyePosition();for(var h in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(h)){var d=this.GetAnchorWorldMatrix(h,t);if(d){var c=this._AttachNodes[h];c.EndExtremity.getPositionFromMatrix(d);var C=new a.Ray(u,c.EndExtremity.clone().sub(u));c.EndExtremityInSmartNodePlane=C.intersectPlane(p)}}if(this._AttachType===e.ELeadType.Mustache)this._ComputePosTooltipAttachesSmartNode(o,t,i);else this._ComputePosLinesAttachesSmartNode(o,t)},_ComputePosTooltipAttachesSmartNode:function(e,t){var i;if(this.Modifiable.GetPropertyValue("Collab.Attach.CenteredOrigin")||!this._PanelNode.GetShapeInfo().smartNode.is2D())i=this._smartNodeCenter.clone();else{var r=this.Modifiable.GetPropertyValue("Collab.Attach.Origin");if(r.equals(new a.Vector3)){var o=this.Modifiable.GetProperty("Collab.Attach.Origin").GetPropertyValue().Clone();o.SetValue(this._smartNodeCenter),this.Modifiable.OnChangeProperty("Collab.Attach.Origin",o),i=this._smartNodeCenter.clone()}else{var s=this._PanelNode.GetShapeInfo().smartNode.Position2D,n=r.x-s.x,l=-(r.y-s.y),p=this.Modifiable.GetPropertyValue("Collab.Body.HAlignment")-1,u=this.Modifiable.GetPropertyValue("Collab.Body.VAlignment")-1;n+=p*this._PanelNode.GetShapeInfo().size.x*.5,l-=u*this._PanelNode.GetShapeInfo().size.y*.5;var h=this._xAxis.clone().multiplyScalar(n*e),d=this._yAxis.clone().multiplyScalar(l*e);i=this._smartNodeCenter.clone().add(h).add(d)}}for(var c in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(c)){var C=this._AttachNodes[c];C.StartExtremity=i,C.preRender(t)}},_ComputePosLinesAttachesSmartNode:function(t,i){var r,o,s=null,n=null,l=!0,p=!0;if(this._AttachType===e.ELeadType.Middle)l=!1,p=!1;else if(this._AttachType===e.ELeadType.Line){var u=0,h=0;for(s in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(s)){n=this._AttachNodes[s];var d=this._findBestCornerSmartNode(n);d.top?u++:u--,d.left?h++:h--}var c=this._getHorizontalLineVerticesSmartNode(t,h>0,u>0);r=c.start,o=c.end}else{var C=this._getBentLineVerticesSmartNode(t,!0),y=this._getBentLineVerticesSmartNode(t,!1);for(s in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(s)){if(!l&&!p)break;n=this._AttachNodes[s],l=l&&this._checkBreakStillToBeUsed(n,C),p=p&&this._checkBreakStillToBeUsed(n,y)}l?(r=C.start,o=C.end):p&&(r=y.start,o=y.end)}for(s in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(s)){if(n=this._AttachNodes[s],this._AttachType===e.ELeadType.Line)n.StartExtremity=r,n.BreakExtremity=o;else if(l||p)n.StartExtremity=r,n.BreakExtremity=o;else{var m=this._smartNodeCenter.clone(),V=new a.Vector3,f=n.EndExtremityInSmartNodePlane.clone().sub(this._smartNodeCenter),b=this._xAxis.clone().dot(f)/t,P=this._yAxis.clone().dot(f)/t,g=new a.Vector2(b,P),_=.5*this._PanelNode.GetShapeInfo().size.x,M=.5*this._PanelNode.GetShapeInfo().size.y,S=this._PanelNode.GetShapeInfo().shape;(S!==e.EBodyShape.None&&S!==e.EBodyShape.RoundedRectangle&&S!==e.EBodyShape.Rectangle&&S!==e.EBodyShape.RoundedSquare&&S!==e.EBodyShape.Square||!this.SegmentIntersectRectangle(g,-_,-M,_,M,V))&&(S!==e.EBodyShape.Circle&&S!==e.EBodyShape.Ellipse||!this.SegmentIntersectEllipse(g,_,M,!1,V))||m.add(this._xAxis.clone().multiplyScalar(V.x*t)).add(this._yAxis.clone().multiplyScalar(V.y*t)),n.StartExtremity=m,n.BreakExtremity=n.StartExtremity.clone()}n.preRender(i)}},_getBentLineVerticesSmartNode:function(e,t){var i=t?-1:1,r=this._xAxis.clone().multiplyScalar(.5*i*this._PanelNode.GetShapeInfo().size.x*e),a=this._xAxis.clone().multiplyScalar(i*this._BentLineSize*e),o=this._smartNodeCenter.clone().add(r),s=o.clone().add(a);return{start:o,end:s}},_getHorizontalLineVerticesSmartNode:function(e,t,i){var r=t?1:-1,a=i?-1:1,o=this._xAxis.clone().multiplyScalar(.5*r*this._PanelNode.GetShapeInfo().size.x*e),s=this._yAxis.clone().multiplyScalar((.5*a*this._PanelNode.GetShapeInfo().size.y+this._horizontalLineMargin)*e),n=this._smartNodeCenter.clone().add(o).add(s),l=n.clone().sub(o.clone().multiplyScalar(2));return{start:n,end:l}},_checkBreakStillToBeUsed:function(e,t){var i=e.EndExtremityInSmartNodePlane.clone().sub(t.end);return t.start.clone().sub(t.end).angleTo(i)>=.5*Math.PI+this._MinAngleAllowedRad},_findBestCornerSmartNode:function(e){var t=e.EndExtremityInSmartNodePlane.clone().sub(this._smartNodeCenter);return{left:this._xAxis.dot(t)<0,top:this._yAxis.dot(t)<0}},SegmentIntersectRectangle:function(e,t,i,r,o,s){if(e.x>t&&e.x<r&&e.y>i&&e.y<o)return!1;var n=new a.Vector2(r,o),l=new a.Vector2(t,o);if(this.IntersectSegment(e,n,l,s))return!0;var p=new a.Vector2(t,i);if(this.IntersectSegment(e,l,p,s))return!0;var u=new a.Vector2(r,i);return!!this.IntersectSegment(e,u,n,s)||(!!this.IntersectSegment(e,u,p,s)||(s=e.clone(),!1))},SegmentIntersectEllipse:function(e,t,i,r,o){var s,n;o.x=e.x,o.y=e.y,o.z=e.z;var l,p,u=new a.Vector2(e.x,e.y),h=new a.Vector2(e.x,e.y),d=!1,c=0,C=0,y=0,m=0,V=0;l=t*t,p=i*i,Math.abs(h.y)>Math.abs(h.x)?(d=!0,y=1/p+(c=h.x/h.y)*c/l,m=2*c*(C=u.x-c*u.y)/l,V=C*C/l-1):(y=1/l+(c=h.y/h.x)*c/p,m=2*c*(C=u.y-c*u.x)/p,V=C*C/p-1);var f=m*m-4*y*V;if(f<0)return!1;var b=!1;if(0===f)d?(n=-m/2*y,u.x=c*n+C,u.y=n):(s=-m/2*y,u.x=s,u.y=c*s+C),(b=!!r||this.IsPointInSegment(e,u))&&(o.x=u.x,o.y=u.y);else{var P=Math.sqrt(f);d?s=c*(n=(-m+P)/(2*y))+C:n=c*(s=(-m+P)/(2*y))+C;var g,_=new a.Vector2(s,n);g=!!r||this.IsPointInSegment(e,_),d?s=c*(n=(-m-P)/(2*y))+C:n=c*(s=(-m-P)/(2*y))+C;var M=new a.Vector2(s,n),S=!1;if(S=!!r||this.IsPointInSegment(e,M),g&&S){var D=_.x-M.x,G=_.y-M.y,x=D*D+G*G,X=.1*Math.min(t,i);if(x<X*X)return!1;x=(D=_.x-o.x)*D+(G=_.y-o.y)*G,(D=M.x-o.x)*D+(G=M.y-o.y)*G<x?(o.x=M.x,o.y=M.y):(o.x=_.x,o.y=_.y),b=!0}else g?(o.x=_.x,o.y=_.y,b=!0):S&&(o.x=M.x,o.y=M.y,b=!0)}return b},IsPointInSegment:function(e,t){var i=e.x,r=e.y,a=i*i+r*r,o=i*t.x+r*t.y;return!(o<0||o>a)},IntersectSegment:function(e,t,i,r){var a=-e.x*(t.y-e.y)- -e.y*(t.x-e.x),o=(i.x-t.x)*(t.y-e.y)-(i.y-t.y)*(t.x-e.x),s=-e.y*(i.x-t.x)- -e.x*(i.y-t.y);if(0===s)return!1;var n=a/s,l=o/s;return r.x=t.x+n*(i.x-t.x),r.y=t.y+n*(i.y-t.y),n>=0&&n<=1&&l>=0&&l<=1}})})),define("DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeTopAndRight",["DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools"],(function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iSwap=0,this.iPariteX=0,this.iPariteY=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0),this.maxfx=this.fHalfSizeX-this.fCellSize-this.fCellSize,this.LRiPariteX=0,this.LRiPariteY=0,this.LRfX=this.fHalfSizeX-this.fCellSize,this.LRfX<0&&(this.LRfX=0),this.LRdy=0,this.LRfY=0,this.LRmaxfy=this.fHalfSizeY-this.fCellSize},next:function(){if(this._parent(),this.iSwap++,1&this.iSwap){if(this.LRiPariteY++,2===this.LRiPariteY&&(this.LRiPariteY=0,this.LRfY+=this.fCellSize,this.LRfY>this.fHalfSizeY-this.fCellSize&&(0===this.LRdy?this.LRdy=.5*this.fCellSize:this.LRdy=0,this.LRfY=0,this.LRfX-=this.fCellSize,this.LRfX<this.fCellSize)))return this.rewind(),!0}else if(0==this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.maxfx&&(this.maxfx-=this.fCellSize,this.maxfx<this.fCellSize&&(this.maxfx=this.fCellSize),0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<this.fCellSize)))return this.rewind(),!0;return!1},getPoint:function(){var e=new t.Vector2;return 1&this.iSwap?(e.x=this.fHalfSizeX+this.LRfX,1&this.LRiPariteY?e.y=this.fHalfSizeY-this.LRfY+this.LRdy:e.y=this.fHalfSizeY+this.LRfY+this.LRdy):(1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,e.y=this.fHalfSizeY-this.fY),e}})})),define("DS/VCXWebDressup/VCXCircle/VCXCircleNode",["DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/VCXWebSystem/VCXMathTools"],(function(e,t,i,r,a,o){"use strict";var s=e.extend({_circleSubdivision:64,init:function(e){this._parent(e),this._verticesNb=2*this._circleSubdivision;var t=2*this._circleSubdivision;return this._trianglesIndicesNb=3*t,this._lineIndicesNb=2*this._circleSubdivision,this},_getPosVectArray:function(){for(var e=[],t=2*Math.PI/this._circleSubdivision,r=0;r<this._circleSubdivision;++r){var a=r*t,o=new i.Vector3(Math.cos(a),Math.sin(a),0);e.push(o)}if(2===this.GetPropertyValue("Circle.Background.Type"))for(r=this._circleSubdivision;r<this._verticesNb;++r)e.push(new i.Vector3(0,0,0));else if(1===this.GetPropertyValue("Circle.Background.Type")||3===this.GetPropertyValue("Circle.Background.Type")){var s=(100-this.GetPropertyValue("Circle.Thickness"))/100;for(r=this._circleSubdivision;r<this._verticesNb;++r){a=r*t;var n=new i.Vector3(s*Math.cos(a),s*Math.sin(a),0);e.push(n)}}return e},_computePosBuffer:function(e){for(var t=this._getPosVectArray(),i=0;i<t.length;++i)e[3*i+0]=t[i].x,e[3*i+1]=t[i].y,e[3*i+2]=t[i].z},_computeColorBuffers:function(e){var t=0,i=this.GetColorPropertyValue("Collab.Background");0===this.GetPropertyValue("Circle.Background.Type")&&(i.a=0);var r=i.Clone();this.GetPropertyValue("Circle.Background.Type")<2&&(r.a=0),3===this.GetPropertyValue("Circle.Background.Type")&&(r=this.GetColorPropertyValue("Collab.Background2"));var a=i.GetRGBA(),o=r.GetRGBA();for(t=0;t<this._circleSubdivision;++t)e[4*t+0]=a[0],e[4*t+1]=a[1],e[4*t+2]=a[2],e[4*t+3]=a[3];for(t=this._verticesNb/2;t<this._verticesNb;++t)e[4*t+0]=o[0],e[4*t+1]=o[1],e[4*t+2]=o[2],e[4*t+3]=o[3]},_ComputeBuffers:function(e,t){return this._computePosBuffer(e),this._computeColorBuffers(t),this._verticesNb},dispose:function(){this._Smart3DPaperNode&&(this._Smart3DPaperNode.dispose(),this._Smart3DPaperNode=null),this._parent()},_Build:function(){this._PrimitiveGroup=new r.PrimitiveGroup({editable:!0});var o=new r.Buffer({component:r.VertexComponentEnum.POSITION,data:new Float32Array(3*this._verticesNb),dimension:3}),s=new r.Buffer({component:r.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(4*this._verticesNb),dimension:4}),n=new r.Buffer({indexBuffer:!0,data:new Uint16Array(this._trianglesIndicesNb+this._lineIndicesNb)});this._PrimitiveGroup.addBuffer(0,o),this._PrimitiveGroup.addBuffer(1,s),this._PrimitiveGroup.addBuffer(2,n);var l=n.data,p=0,u=0,h=0;for(p=0,u=1;p<this._circleSubdivision;++p,++u)u===this._circleSubdivision&&(u=0),l[h++]=p,l[h++]=u,l[h++]=this._circleSubdivision+p,l[h++]=this._circleSubdivision+p,l[h++]=u,l[h++]=this._circleSubdivision+u;for(p=0;p<this._circleSubdivision;++p)l[h++]=p,l[h++]=p===this._circleSubdivision-1?0:p+1;var d=new r.Primitive({nbIndices:this._trianglesIndicesNb,connectivity:r.ConnectivityTypeEnum.TRIANGLES}),c=new r.VertexComponent({bufferId:0,indices:new r.IndexArray({bufferId:2,offset:0})}),C=new r.VertexComponent({bufferId:1,indices:new r.IndexArray({bufferId:2,offset:0})});d.addVertexComponent(c),d.addVertexComponent(C),this._PrimitiveGroup.addPrimitive(d);var y=new r.Primitive({nbIndices:this._lineIndicesNb,connectivity:r.ConnectivityTypeEnum.LINES}),m=new r.VertexComponent({bufferId:0,indices:new r.IndexArray({bufferId:2,offset:this._trianglesIndicesNb})});y.addVertexComponent(m),this._PrimitiveGroup.addPrimitive(y),this._bodyMat=new i.MeshBasicMaterial({side:i.DoubleSide,vertexColors:i.VertexColors,color:"#ffffff",transparent:!0,opacity:1,polygonOffset:!0,polygonOffsetFactor:-1,polygonOffsetUnits:-10,force:!0});var V=this.Modifiable.getLineMaterialParams("Collab.Body.Line",this._bodyMat.line,this._lastFrontLineType);V.polygonOffset=!0,V.polygonOffsetFactor=1,V.polygonOffsetUnits=-2,Object.keys(V).length>0&&("number"==typeof V.type&&V.type!==this._lastFrontLineType&&(this._lastFrontLineType=V.type),V.polygonBorderMode=!0,this._bodyMat.line=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(V,this._bodyMat.line));var f=new i.Vector3(0,0,0),b=this.GetAnchorWorldMatrix(0,null);b?f.getPositionFromMatrix(b):console.log("centerMatrix is null or undefined...");var P=(new i.Quaternion).setFromRotationMatrix(b),g=(new i.Matrix4).compose(f,P,new i.Vector3(1,1,1));this._MeshNode=a.createMeshNode(this._PrimitiveGroup),this._MeshNode.setMaterial(this._bodyMat),this._MeshNode.setVisibilityInTree(!1),this._MeshNode.setMatrix(g),this._MeshNode.excludeFromHighlight(!0,!0),this._hlMeshNode=a.createCircleNode({radius:1,segments:this._circleSubdivision,fill:!0,color:new r.Color(0,0,0,0),noEdge:!0}),this._hlMeshNode.setVisibilityInTree(!1),this._hlMeshNode.setMatrix(g),this._hlMeshNode.setPickable(r.PICKABLE);var _={name:"CircleSmartNode",modifiable:this.Modifiable};if(this._Smart3DPaperNode=new t(_),this._Smart3DPaperNode.add(this._MeshNode),this._Smart3DPaperNode.add(this._hlMeshNode),this.add(this._Smart3DPaperNode),this._Smart3DPaperNode&&!this._radiusHandleNodes){this._radiusHandleNodes=[{id:1}];var M=0;this._radiusHandleNodes.forEach(function(t){var r=(new i.Matrix4).makeRotationZ(M+Math.PI/2),a=(new i.Matrix4).setPosition({x:Math.cos(M),y:Math.sin(M),z:0});M+=Math.PI/2,t.matrixLocal=(new i.Matrix4).multiplyMatrices(a,r),t.node=new e({name:"CircleCore"}),this._Smart3DPaperNode.add(t.node)}.bind(this))}},preRender:function(e){if(!this._parent(e))return!1;if(!this.viewpointVisibility||!this.GetOpacity(e))return this.setVisibility(!1),!1;if(this.setVisibility(!0),this._bodyMat&&this._bodyMat.line){this._bodyMat.line.handleByPrerender=!0;let e=this.ExperienceBase.getManager("VCXPaperManager").UnitValueToPixel(this.Modifiable.GetPropertyValue("Collab.Body.Line.Width"));this.Modifiable.GetPropertyValue("Collab.Border.AlwaysVisible")||e>=1?(this._bodyMat.line.setLineWidth(e),this._bodyMat.line.visible=!0):this._bodyMat.line.visible=!1}return this._Smart3DPaperNode&&this._Smart3DPaperNode.preRender(e),!0},GetVarianceNode(e){return new s({name:e.viewerID+"_"+this.name,modifiable:this.Modifiable,experience:this.ExperienceBase})},update:function(e){if(this._parent(e),this._globalOpacity!==this.GetOpacity(e)){this._globalOpacity=this.GetOpacity(e);var t=this._globalOpacity>0;t&&(this._Smart3DPaperNode||this._Build()),this._Smart3DPaperNode&&this._Smart3DPaperNode.setVisibility(t)}if(!(this._globalOpacity<=0)&&this._Smart3DPaperNode){this._Smart3DPaperNode.SizeControlType=this.GetPropertyValue("Collab.Is.Paper")?1:0,this._Smart3DPaperNode.update(e);var a=this._MeshNode.getBuffer(r.VertexComponentEnum.POSITION),s=this._MeshNode.getBuffer(r.VertexComponentEnum.DIFFUSE_COLOR);if(a&&s){var n=this._ComputeBuffers(a,s);this._MeshNode.updateBuffer(r.VertexComponentEnum.POSITION,0,n),this._MeshNode.updateBuffer(r.VertexComponentEnum.DIFFUSE_COLOR,0,n),this._MeshNode.computeBoundingElements()}this._Smart3DPaperNode&&this._bodyMat&&(this._bodyMat.opacity=this._globalOpacity);var l=this.GetPropertyValue("Circle.Radius");l*=this.GetPropertyValue("Circle.Scale");var p=(new i.Matrix4).makeScale(l,l,1);this._MeshNode.setMatrix(p),this._hlMeshNode.setMatrix(p),this._radiusHandleNodes.forEach((function(e){var t=(new i.Matrix4).multiplyMatrices(p,e.matrixLocal),r=o.normalizeMatrix(t);r.setPosition(o.getOFromMatrix(t)),e.node.setMatrix(r)}));var u=this.Modifiable.getLineMaterialParams("Collab.Body.Line",this._bodyMat.line,this._lastFrontLineType,this._globalOpacity);Object.keys(u).length>0&&("number"==typeof u.type&&u.type!==this._lastFrontLineType&&(this._lastFrontLineType=u.type),u.polygonBorderMode=!0,this._bodyMat.line=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(u,this._bodyMat.line)),this.handleLayers()}}});return s})),define("DS/VCXWebDressup/VCXCircle/VCXCircleSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXCircle/VCXCircleNode"],(function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Circle",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Circle.png")}return this._parent()}})})),define("DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeBottomAndRight",["DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools"],(function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iSwap=0,this.iPariteX=0,this.iPariteY=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0),this.maxfx=this.fHalfSizeX-this.fCellSize-this.fCellSize,this.LRiPariteX=0,this.LRiPariteY=0,this.LRfX=this.fHalfSizeX-this.fCellSize,this.LRfX<0&&(this.LRfX=0),this.LRdy=0,this.LRfY=0,this.LRmaxfy=this.fHalfSizeY-this.fCellSize},next:function(){if(this._parent(),this.iSwap++,1&this.iSwap){if(this.LRiPariteY++,2===this.LRiPariteY&&(this.LRiPariteY=0,this.LRfY+=this.fCellSize,this.LRfY>this.fHalfSizeY-this.fCellSize&&(0===this.LRdy?this.LRdy=.5*this.fCellSize:this.LRdy=0,this.LRfY=0,this.LRfX-=this.fCellSize,this.LRfX<this.fCellSize)))return this.rewind(),!0}else if(0===this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.maxfx&&(this.maxfx-=this.fCellSize,this.maxfx<this.fCellSize&&(this.maxfx=this.fCellSize),0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<this.fCellSize)))return this.rewind(),!0;return!1},getPoint:function(){var e=new t.Vector2;return 1&this.iSwap?(e.x=this.fHalfSizeX+this.LRfX,1&this.LRiPariteY?e.y=this.fHalfSizeY-this.LRfY+this.LRdy:e.y=this.fHalfSizeY+this.LRfY+this.LRdy):(1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,e.y=this.fHalfSizeY+this.fY),e}})})),define("DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeTop",["DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS"],(function(e,t){"use strict";return e.extend({rewind:function(){this._parent(),this.iPariteX=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0)},next:function(){return this._parent(),0===this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.fHalfSizeX-this.fCellSize&&(0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<-this.fHalfSizeY+this.fCellSize))&&(this.rewind(),!0)},getPoint:function(){var e=new t.Vector2;return 1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,e.y=this.fHalfSizeY-this.fY,e}})})),define("DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeLeftAndRight",["DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools"],(function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iPariteX=0,this.iPariteY=0,this.fX=this.fHalfSizeX-this.fCellSize,this.dy=0,this.fY=0,this.fX<0&&(this.fX=0)},next:function(){return this._parent(),this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,0===this.fY&&this.iPariteY++,this.iPariteY++,2===this.iPariteY&&(this.iPariteY=0,this.fY+=this.fCellSize,this.fY>this.fHalfSizeY-this.fCellSize&&(0===this.dy?this.dy=.5*this.fCellSize:this.dy=0,this.fY=0,this.fX-=this.fCellSize,this.fX<this.fCellSize)))&&(this.rewind(),!0)},getPoint:function(){var e=new t.Vector2;return 1&this.iPariteX?e.x=this.fHalfSizeX-this.fX:e.x=this.fHalfSizeX+this.fX,1&this.iPariteY?e.y=this.fHalfSizeY-this.fY+this.dy:e.y=this.fHalfSizeY+this.fY+this.dy,e}})})),define("DS/VCXWebDressup/VCXPartList/VCXPartListCSSNode",["DS/Core/Core","DS/Core/PointerEvents","DS/CoreEvents/Events","UWA/Core","DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXPartList/VCXPartListPaperNode","DS/VCXWebVisu/VCXModifiablesAccess","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebDressup/VCXPropertyValueHTMLFormater","DS/VCXWebModifiables/VCXPropertiesObserver","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueMap","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueFont","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebModifiables/VCXModelChangeListener"],(function(e,t,i,r,a,o,s,n,l,p,u,h,d,c,C,y,m,V,f,b,P,g,_){"use strict";var M=a.extend({init:function(e){return this._parent(e),this._BOMPaperNode=null,this._BomContent=null,this._totalBOMColmnsWidthMM=0,this._BOMAlignment=d.EPositionType.Free2D,this._BOMPercentage=0,this._trapSelection=!1,this._bIsScenarioTransitionInProgress=!1,this._isEmptyTable=!1,this.addCallbacks(),this._bInRecordMode=!1,this.tokens={},this.tokens.VCX_PARTLIST_EDITMODE=i.subscribe({event:"VCX_PARTLIST_EDITMODE"},(()=>{this._isEmptyTable||(this._experienceBase.getManager("VCXComponentPartListManager")._hideSelection(),i.publish({event:"VCX_EditMode_PartList_Display_UI",data:{}}))})),this.tokens.VCX_SELECTION_COMPONENTSLIST_ADD=i.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},(e=>{this._updateManipulatorDisplay(e)})),this.tokens.VCX_SELECTION_COMPONENTSLIST_REMOVE=i.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},(e=>{this._updateManipulatorDisplay(e)})),this.tokens.VCX_VIDEO_RECORD_START=i.subscribe({event:"VCX_VIDEO_RECORD_START"},(()=>{this._bInRecordMode=!0})),this.tokens.VCX_VIDEO_RECORD_END=i.subscribe({event:"VCX_VIDEO_RECORD_END"},(()=>{this._bInRecordMode=!1})),this.tokens.VCX_BEGIN_TRANSITION=i.subscribe({event:"VCX_BEGIN_TRANSITION"},(()=>{this._bIsScenarioTransitionInProgress=!0})),this.tokens.VCX_CHANGE_EDIT_MODE=i.subscribe({event:"VCX_SWITCH_EDIT_SELECTION"},(e=>{let t=this._experienceBase.getManager("VCXComponentPartListManager");if(1!==e.mode&&2!==e.mode||t.SetChangePropertyMode(e.state),0===e.mode||2===e.mode){if(t.GetEditMode()&&!e.state&&this._experienceBase&&this._Modifiable){console.log(`[1m[31mSwitch edit mode to ${e.state}[0m`);let i=new l(this._experienceBase);i.AddToSelection(this.Modifiable.GetObject()),this._experienceBase.getManager("VCXCommandManager").Do(i),t._showSelection(),t._addPartListToCSO(this._Modifiable)}t.SetEditMode(e.state)}e.allowUpdate&&this._UpdateDIV(!1)})),this.tokens.VCX_END_TRANSITION=i.subscribe({event:"VCX_END_TRANSITION"},(()=>{this._bIsScenarioTransitionInProgress=!1})),this.tokens.VCX_PROPERTIES_CHANGED=i.subscribe({event:"VCX_PROPERTIES_CHANGED"},(e=>{if(this._bomColumnsExternalPropsObserver&&!this._experienceBase.getManager("VCXComponentPartListManager").GetEditMode()&&this._globalOpacity>0&&e&&e.component){let t=e.component;if("VCXComponentOccurrenceComposer"===t.GetType()&&t._PartListEnabled&&(this._bomColumnsExternalPropsObserver.update(),this._bomColumnsExternalPropsObserver.isDirty())){let e=this._experienceBase.getManager("VCXModelChangeListener");e&&e.hasChanged(_.FChangeFlag.PartListDescription,!0)}}})),this.tokens.VISU=i.subscribe({event:"/VISU/"},(async e=>{let t=document.getElementById("partListTableContainer");if(null!=t&&e&&e.event&&"@onClickEvent"===e.eventType&&e.trapSelection){let i=e.event._startPosition,r=e.event._lastPosition,a={x:Math.min(i.x,r.x),y:Math.min(i.y,r.y),width:Math.abs(i.x-r.x),height:Math.abs(i.y-r.y)},o=parseFloat(t.style.transform.replace(/[A-Za-z$-()]/g,"")),s={x:t.offsetLeft,y:t.offsetTop,width:t.offsetWidth*o,height:t.offsetHeight*o};if(!(a.x>s.x+s.width||a.x+a.width<s.x||a.y>s.y+s.height||a.y+a.height<s.y)){let t=this._Modifiable,i=this._experienceBase.getManager("VCXComponentPartListManager"),r=new l(this._experienceBase);r.AddToSelection(t.GetObject()),this._experienceBase.getManager("VCXCommandManager").Do(r),i._showSelection(),i._addPartListToCSO(t),i._handleOnSelectElement(e),this._trapSelection=!0}}})),this},_UpdateDIV:async function(e){var t=this.Modifiable.ExperienceBase;const r=t.getManager("VCXVisuManager");if(r&&r.getNonVisibleSpaceState())return;this._isEmptyTable=!!document.getElementById("divBomEmptyRow"),this._bomColumnsExternalPropsObserver&&delete this._bomColumnsExternalPropsObserver,this._bomColumnsExternalPropsObserver=new u,this.data={columns:[],data:[]};let a=t.getManager("VCXComponentPartListManager"),s=this.Modifiable.GetProperty("Collab.PartList.ColumnList");if(!s.GetPropertyValue().GetValue().length){let e=new y;for(let t=0;t<3;t++){let i=new C;switch(t){case 0:i.SetValue("Actor.PartList.ID");break;case 1:i.SetValue("Actor.PartList.Description");break;case 2:i.SetValue("PartList.Quantity");break;default:console.error("Something went wrong while setting default columns")}e.SetValueAtIndex(t,i)}a._updatePropertyValues([s],[e],this.Modifiable)}var n=a.GetColumnNumber();let l=new Set(["VCXPropertyValueLocation","VCXPropertyValueString","VCXPropertyValueFloat","VCXPropertyValueBoolean","VCXPropertyValueEnum","VCXPropertyValueColor","VCXPropertyValueHyperLinkId","VCXPropertyValueLink"]);for(var h=0;h<n;h++){var d=a.GetColumnName(h).Value,c="";const e=a.QueryInterface("VCXIModifiable");if(e){const t="Meta.NLS."+d,i=e.GetProperty(t);i&&(c=i.GetPropertyValue().GetValue())}c||(c=(c=d).slice(c.indexOf(".")+1)),"Quantity"===c?c="Quantity":"PartList.ID"===c?c="ID":"PartList.Description"===c&&(c="Description"),this.data.columns.push({text:c,dataIndex:d,width:"auto"})}for(var m in this._BomContent)if(""!==m&&this._BomContent.hasOwnProperty(m)){var V={},f=this._BomContent[m];if(f){var b=f.itemComponents[0].QueryInterface("VCXIModifiable");for(h=0;h<n;h++){var P;switch(c=a.GetColumnName(h).Value){case"Actor.PartList.Description":P=b.GetObject().PartListDescription;break;case"PartList.Quantity":case"Bom.Quantity":P=f.itemComponents.length;break;case"Actor.PartList.ID":P=b.GetObject().PartListID;break;default:if(P="",b){this._bomColumnsExternalPropsObserver.add(b,c);var g=b.GetProperty(c);if(g)if(l.has(g.GetPropertyValue().GetType()))if("VCXPropertyValueColor"===g.GetPropertyValue().GetType())P="#"+g.GetPropertyValue().GetValue().getHexString();else if("VCXPropertyValueLocation"===g.GetPropertyValue().GetType()){const e=g.GetPropertyValue().GetFrame().GetValue(),t=(new o.Vector3).getPositionFromMatrix(e);P="^actor:position#"+t.x.toFixed(2)+","+t.y.toFixed(2)+","+t.z.toFixed(2)}else"VCXPropertyValueLink"===g.GetPropertyValue().GetType()?"Actor.PLM.Material"===c&&(P="^mat:name#"+g.GetPropertyValue().GetValue()):P=g.GetPropertyValue().GetValue();else P=p.format(g)}}V[this.data.columns[h].dataIndex]=P}}V["Actor.PartList.ID"]||(V["Actor.PartList.ID"]=m),this.data.data.push(V)}let _=this.Modifiable.GetProperty("Collab.PartList.SortColumn").GetPropertyValue().GetValue(),M=this.Modifiable.GetProperty("Collab.PartList.SortAscending").GetPropertyValue().GetValue();this.data.data.sort((function(e,t){var i=M?1:-1,r=e[_],a=t[_];if(r!==a){var o=Number(r),s=Number(a);return o==r&&s==a?(o-s)*i:(r.toLowerCase&&(r=r.toLowerCase()),a.toLowerCase&&(a=a.toLowerCase()),r>a?i:-i)}return 0})),this._buildBOM({sortColumn:_,sortAscending:M},e),a.GetEditMode()&&!a.GetChangePropertyMode()&&i.publish({event:"VCX_PartList_Build_Complete_Edit_Mode"}),a.GetManipulatorsInitialized()||(a.initializeManipulators(),a.SetManipulatorsInitialized(!0))},_createSlaveTable:function(){let e=document.getElementById("partListTableContainer"),t=new r.Element("div",{id:"divBomSlave",class:"Part_List slave"}),i=document.getElementById("divBomRowHead");return t.appendChild(i.cloneNode(!0)),t.style.height="auto",e.appendChild(t),t},_setDefaultProperties:function(){let e=[],t=[],i=this._experienceBase.getManager("VCXScenarioManager").GetNeutrals(this.Modifiable.GetHashing());if(i){let r=i.GetProperty("Collab.3D.Paper.Paper.Position.X"),a=i.GetProperty("Collab.3D.Paper.Paper.Position.Y");if(r&&a){let i=r.GetPropertyValue("Collab.3D.Paper.Paper.Position.X").GetValue(),o=a.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y").GetValue(),s=new c(i),n=new c(o);e.push(r),t.push(s),e.push(a),t.push(n)}let o=i.GetProperty("Collab.Body.Width"),s=i.GetProperty("Collab.Body.Height");if(o&&s){let i=o.GetPropertyValue("Collab.Body.Height").GetValue(),r=s.GetPropertyValue("Collab.Body.Width").GetValue(),a=new c(r),n=new c(i);e.push(o),t.push(n),e.push(s),t.push(a)}let n=i.GetProperty("Collab.PartList.Split.HeaderCount");if(n){let i=n.GetPropertyValue("Collab.PartList.Split.HeaderCount").GetValue(),r=new C(i);e.push(n),t.push(r)}let l=i.GetProperty("Collab.Text.Font");if(l){let i=l.GetPropertyValue("Collab.Text.Font").GetFont(),r=new b,a=new C(i.Family),o=new c(parseFloat(i.Height));r.SetFamily(a),r.SetHeight(o),e.push(l),t.push(r)}let p=i.GetProperty("Collab.Text.HAlignment");if(p){let i=p.GetPropertyValue("Collab.Text.HAlignment").GetValue(),r=new g(parseInt(i));e.push(p),t.push(r)}let u=i.GetProperty("Collab.PartList.Body.ConsiderAlternateColor");if(u){let i=u.GetPropertyValue("Collab.PartList.Body.ConsiderAlternateColor").GetValue(),r=new m(i);e.push(u),t.push(r)}let h=i.GetProperty("Collab.PartList.FilterOnVisibleCallouts");if(h){let i=h.GetPropertyValue("Collab.PartList.FilterOnVisibleCallouts").GetValue(),r=new m(i);e.push(h),t.push(r)}this._getColorPropStrDefaultValues("Collab.PartList.Container.Text.Color","Collab.PartList.Container.Text.Color.Opacity",i,e,t),this._getColorPropStrDefaultValues("Collab.PartList.Body.SecondRow.Color","Collab.PartList.Body.SecondRow.Color.Opacity",i,e,t),this._getColorPropStrDefaultValues("Collab.PartList.Body.Row.Color","Collab.PartList.Body.Row.Color.Opacity",i,e,t),this._getColorPropStrDefaultValues("Collab.PartList.Header.Text.Color","Collab.PartList.Header.Text.Color.Opacity",i,e,t),this._getColorPropStrDefaultValues("Collab.PartList.Header.Background.Color","Collab.PartList.Header.Background.Color.Opacity",i,e,t);let d=i.GetProperty("Collab.PartList.ColumnList");if(d){let i=new y;for(let e=0;e<3;e++){let t=new C;switch(e){case 0:t.SetValue("Actor.PartList.ID");break;case 1:t.SetValue("Actor.PartList.Description");break;case 2:t.SetValue("PartList.Quantity");break;default:console.error("Something went wrong while setting default columns")}i.SetValueAtIndex(e,t)}e.push(d),t.push(i)}let V=i.GetProperty("Collab.PartList.SortColumn");if(V){let i=V.GetPropertyValue("Collab.PartList.SortColumn").GetValue(),r=new C(i);e.push(V),t.push(r)}let f=i.GetProperty("Collab.PartList.SortAscending");if(f){let i=f.GetPropertyValue("Collab.PartList.SortAscending").GetValue(),r=new m(i);e.push(f),t.push(r)}}this._AddScenarioIDToList(e,t),this.Modifiable.ExperienceBase.getManager("VCXComponentPartListManager")._updatePropertyValues(e,t,this.Modifiable)},_AddScenarioIDToList:function(e,t){let i=this.Modifiable.GetProperty("Collab.PartList.ScenarioIDs"),r=this.ExperienceBase.getManager("VCXScenarioManager");if(r&&i){let a=r.GetCurrentScenario(),o=this.Modifiable.GetPropertyValue("Collab.PartList.ScenarioIDs");o&&Array.isArray(o)&&o.length>0||(o=o.GetValue()),o.push(new C(a));let s=new y(o);e.push(i),t.push(s)}},_getColorPropStrDefaultValues:function(e,t,i,r,a){let o=i.GetProperty(e),s=i.GetProperty(t);if(o){let e=o.GetPropertyValue(t).GetValue();if(void 0!==e){let t=new f((new P).FromRGBA(e.r,e.g,e.b,1));r.push(o),a.push(t)}}if(s){let e=s.GetPropertyValue(t).GetValue();if(void 0!==e){let t=new c(parseFloat(e));r.push(s),a.push(t)}}},_getColorPropStrToApply:function(e,t){let i=1;void 0!==this.GetPropertyValue(t)&&(i=this.GetPropertyValue(t));var r=this.GetPropertyValue(e);return`rgba(${(255*r.r).toFixed(0)},${(255*r.g).toFixed(0)},${(255*r.b).toFixed(0)},${i})`},_getTextLength:function(e,t,i){this._span||(this._span=new r.Element("span",{}),this._span.style.visibility="hidden",this._span.style.pointerEvents="none",this._span.style.whiteSpace="nowrap",this._span.style.position="absolute",this._span.style.left="-500px",this.divParent=this.Modifiable.ExperienceBase.getManager("VCXDressupManager").getDressupsOverViewerDiv(),this._span.inject(this.divParent)),this._span.style.fontFamily=t.text.font.fontFamily,this._myDiv.style.fontSize=t.text.font.fontSize+"px",this._span.style.fontSize=t.text.font.fontSize+"px";var a=0;return e.length&&(a+=20),this._span.style.fontWeight=i?"600":"normal",this._span.textContent=e,a+=this._span.offsetWidth},_fetchPartListTableProperties:function(){var e={text:{font:{fontFamily:"Arial",fontSize:12,currentsize:11},headerColor:"white",rowColor:0},background:{visible:!0,headerColor:"gray",oddRowColor:0,evenRowColor:0},border:{visible:!0,thickness:1,color:0},alignment:{textAlign:"start"}},t=this.GetPropertyValue("Collab.PartList.Body.ConsiderAlternateColor");void 0!==this.GetPropertyValue("Collab.PartList.Container.Text.Color")&&(e.text.contentColor=this._getColorPropStrToApply("Collab.PartList.Container.Text.Color","Collab.PartList.Container.Text.Color.Opacity")),void 0!==this.GetPropertyValue("Collab.PartList.Header.Text.Color")&&(e.text.headerColor=this._getColorPropStrToApply("Collab.PartList.Header.Text.Color","Collab.PartList.Header.Text.Color.Opacity")),void 0!==this.GetPropertyValue("Collab.PartList.Header.Background.Color")&&(e.background.headerColor=this._getColorPropStrToApply("Collab.PartList.Header.Background.Color","Collab.PartList.Header.Background.Color.Opacity")),void 0!==this.GetPropertyValue("Collab.PartList.Body.Row.Color")&&(e.background.oddRowColor=this._getColorPropStrToApply("Collab.PartList.Body.Row.Color","Collab.PartList.Body.Row.Color.Opacity")),void 0!==this.GetPropertyValue("Collab.PartList.Body.SecondRow.Color")&&(e.background.evenRowColor=t?this._getColorPropStrToApply("Collab.PartList.Body.SecondRow.Color","Collab.PartList.Body.SecondRow.Color.Opacity"):this._getColorPropStrToApply("Collab.PartList.Body.Row.Color","Collab.PartList.Body.Row.Color.Opacity")),this.GetFontPropertyValue("Collab.Text.Font")&&(e.text.font.fontFamily=this.GetFontPropertyValue("Collab.Text.Font").Family,e.text.font.fontSize=this.GetFontPropertyValue("Collab.Text.Font").Height);let i=this.GetPropertyValue("Collab.Text.HAlignment");return i===d.EHTextAlignment.Right?e.alignment="end":i===d.EHTextAlignment.Centered?e.alignment="center":i===d.EHTextAlignment.Justified?e.alignment="justify":e.alignment="start",e},_buildBOM:function(e,t){this._exr;let i=document.getElementById("partListTableContainer");var r=null,a=!0;let o=this._fetchPartListTableProperties();this.appearance=o;var s=null;for(o.text.font.fontSize<7&&(o.text.font.fontSize=7);a;){if(r&&this._removeRowsEvents(r),r=this._buildFlexBOM(o),i){let e=i.querySelectorAll(".Part_List");if(e.length)for(let t=0;t<e.length;t++)i.removeChild(e[t])}i.appendChild(r);s=this._analyzeBOM(r);var n=this._addBorderTop(s);s=this._analyzeBOM(r),this._addHeader(s,r,o,e),s=this._analyzeBOM(r),this._removeBorderTop(n),this._addBorderTop(s);var l=this._calcColumnProportion(s,o);this._applyColumnProportion(s,l),this._calcSizeInPixel(),i.style.width=this.Size.x+"px",i.style.height=this.Size.y+"px";let t=this.GetPropertyValue("Collab.PartList.Split.HeaderCount");if(t=t.split("-"),t=t.map((e=>parseInt(e))),t.length>1){let e=[];for(let t=1;t<r.children.length;t++)e.push(r.children[t]);let i=t.reduce(((e,t)=>e+t),0);if(i>e.length){let r=i-e.length;for(;r;){if(t[t.length-1]>r){t[t.length-1]-=r;break}r-=t[t.length-1],t.pop()}}if(i<e.length){let r=e.length-i,a=1;for(;r;)if(t[a]){if(r<=t[0]-t[a]){t[a]+=r;break}r-=t[0]-t[a],t[a]+=t[0]-t[a],a++}else{if(r<=t[0]){t.push(r);break}t.push(t[0]),r-=t[0]}}for(let i=0;i<t.length;i++)if(0===i)for(let a=0;a<t[i];a++)e.length&&r.appendChild(e.shift());else{let r=this._createSlaveTable();for(let a=0;a<t[i];a++)e.length&&r.appendChild(e.shift())}this._Modifiable.ExperienceBase.getManager("VCXComponentPartListManager").setSlaveTablesHeight()}let y=document.querySelectorAll(".Part_List");if(a=!1,y.length)for(let e=0;e<y.length;e++)for(var p=y[e].children,u=0;u<p.length;u++)for(var h=p[u].children,d=0;d<h.length;d++){for(var c=h[d],C=this._getTextLength(c.textContent,o,!1);c.clientWidth<C;)i.style.width=parseFloat(i.style.width)+10+"px",C=this._getTextLength(c.textContent,o,!1);for(;c.scrollHeight>c.clientHeight;)i.style.height=parseFloat(i.style.height)+2+"px"}break}s&&s.length,r&&(r.style.justifyContent="flex-start"),i.style.alignItems="flex-start",i.style.visibility="visible"},_checkTruncation:function(){let e=document.querySelectorAll(".Part_List");for(let n=0;n<e.length;n++)for(var t=e[n].children,i=0;i<t.length;i++)for(var r=t[i].children,a=0;a<r.length;a++){var o=r[a],s=this._getTextLength(o.textContent,this.appearance,!1);if(o.clientWidth<s)return!0}return!1},_analyzeBOM:function(e){var t,i=[],r=[],a=e.children,o=0,s=null,n=0;for(t=0;t<a.length;t++){var l=a[t],p=l.offsetLeft;s?p===n?(r.push(l)):(i[o]=r,1,(r=[]).push(l),o++):(r.push(l)),s=l,n=p}return i[o]=r,i},_removeBorderTop:function(e){for(var t=0;t<e.length;t++){e[t].style.borderTop=""}},_addBorderTop:function(e){for(var t=[],i=0;i<e.length;i++)for(var r=e[i],a=0;a<r.length;a++){var o=r[a];0===a&&(o.style.borderTop="1px solid #F1F1F1",t.push(o))}return t},_addHeader:function(e,t,i,r){if(e.length>1)for(var a=0,o=1;o<e.length;o++){for(var s=e[o][0],n=0;n<a;n++)s=s.previousSibling;var l=this.createHeader(i,r);t.insertBefore(l,s),a++}},_calcColumnProportion:function(e,t){var i=[];this._totalBOMColmnsWidthMM=0;for(var r=0;r<e.length;r++){for(var a=[],o=e[r],s=o.length,n=0;n<s;n++)for(var l=o[n].children,p=0;p<l.length;p++){var u=l[p],h=this._getTextLength(u.textContent,t,!1);a[p]?a[p]=Math.max(a[p],h):a[p]=h}var d=a.length,c=0;for(p=0;p<d;p++)c+=a[p];for(p=0;p<d;p++){var C=100*a[p]/c;a[p]=C.toFixed(2)}if(c>0&&t){var y=.3527*c,m=y*(t.text.font.fontSize/100);this._totalBOMColmnsWidthMM+=y+m}i[r]=a}return i},_applyColumnProportion:function(e,t){e[0][1]&&"divBomEmptyRow"===e[0][1].id&&(t[0][0]="10",t[0][1]="70",t[0][2]="20");for(var i=0;i<e.length;i++)for(var r=t[i],a=e[i],o=a.length,s=0;s<o;s++){var n=a[s],l=n.children;if("divBomEmptyRow"===n.id){l[0].style.flexBasis="100%"}else for(var p=0;p<l.length;p++){l[p].style.flexBasis=r[p]+"%"}}},_createHeaderCell:function(e){var t=this._createCell(e);return t.style.color=e.text.headerColor,t.style.borderColor=e.border.color,t.style.backgroundColor=e.background.headerColor,t},_fillHeaderCell:function(e,t){var i=this.data.columns[t].text;this._setContent(e,i)},_fillEmptyCell:function(e){let t;t="There is no part with the part list option activated",this._setContent(e,"There is no part with the part list option activated")},_createCell:function(e,t){var i=new r.Element("div",{class:"Part_List_Cell"});return i.style.fontFamily=e.text.font.fontFamily,"Color"===t?(i.style.justifyContent="center",i.style.fontSize="1px"):i.style.justifyContent=e.alignment,i},_fillCell:function(e,t,i){var r;r=this.data.data[t][this.data.columns[i].dataIndex],this._setContent(e,r)},_fillEmptyCell:function(e){let t;t="There is no part with the part list option activated",this._setContent(e,"There is no part with the part list option activated")},_setContent:function(e,t){if("string"==typeof t&&t.includes("^actor:position#")){const a=t.split("^actor:position#")[1].split(",");var i=new r.Element("span",{});i.textContent=a.join("/"),i.inject(e)}else if("string"==typeof t&&t.includes("^mat")){let i=null,o=!0;if(t.includes("^mat:name#")?i=t.split("^mat:name#")[1]:t.includes("^mat:preview#")&&(i=t.split("^mat:preview#")[1],o=!1),i){const t=this.Modifiable.ExperienceBase.ComponentsMap.GetComponentFromID(i).QueryInterface("VCXIMaterialCache");if(o){let i=new r.Element("span",{});i.textContent=t.GetTitle(),i.inject(e)}else{var a=new r.Element("div",{});a.style.height="90%",a.style.backgroundImage=t.GetImage(),a.inject(e)}}else{let t=new r.Element("span",{});t.textContent=" ",t.inject(e)}}else{let i=new r.Element("span",{});"#"===t[0]&&7===t.length&&(i.style=`color:${t}; height: 80%; width: 80%; background: ${t}; box-shadow: 0px 0px 2px 1px #3d3d3d30`),i.textContent=t,i.inject(e)}},_getDescriptionColId:function(){for(var e=1,t=0;t<this.data.columns.length;t++){if("Bom.Description"===this.data.columns[t].dataIndex){e=t;break}}return e},createHeader:function(e){for(var t=new r.Element("div",{id:"divBomRowHead",class:"Part_List_Row"}),i=0;i<this.data.columns.length;i++){var a=this._createHeaderCell(e);this._fillHeaderCell(a,i),a.classList.add(this.data.columns[i].text.split(" ").join(".")),a.inject(t)}return t},_buildFlexBOM:function(t,i){var a=new r.Element("div",{id:"divBom",class:"Part_List"});if(this.createHeader(t,i).inject(a),this.data.data.length)for(var o=0;o<this.data.data.length;o++){var s=this._BomContent[this.data.data[o]["Actor.PartList.ID"]];s||(s=this._BomContent[o+1]),(l=new r.Element("div",{id:"divBomRow"+this.data.data[o]["Actor.PartList.ID"],class:"Part_List_Row"})).inject(a),l._bomLine=s,s._tr=l,e.Selection.CSOManager.isIn({pathElement:s.itemComponents[0].QueryInterface("W3AISGNodeHolder").getPathElement()})&&l.classList.add("selected"),u=o%2==0?t.background.oddRowColor:t.background.evenRowColor,l.style.backgroundColor=u;for(var n=0;n<this.data.columns.length;n++){(p=this._createCell(t,this.data.columns[n].text.split(" ").join("."))).style.color=t.text.contentColor,p.classList.add(this.data.columns[n].text.split(" ").join(".")),this._fillCell(p,o,n),p.inject(l)}this._addRowEvents(l)}else{var l;(l=new r.Element("div",{id:"divBomEmptyRow",class:"Part_List_Row"})).inject(a);var p,u=t.background.oddRowColor;l.style.backgroundColor=u,l.style.borderColor=u,(p=this._createCell(t)).style.color="rgb(193,198,201)",p.style.borderColor=u,p.style.fontStyle="italic",this._fillEmptyCell(p),p.inject(l)}return a},_addRowEvents:function(e){e.addEventListener("mouseenter",M.rowMouseEnter,!1),e.addEventListener("mouseleave",M.rowMouseLeave,!1),e._experienceBase=this.Modifiable.ExperienceBase,e._this=this,e.addEventListener(t.POINTERUP,M.rowPointerEventUp,!1)},_removeRowEvents:function(e){e.removeEventListener("mouseenter",M.rowMouseEnter),e.removeEventListener("mouseleave",M.rowMouseLeave),e.removeEventListener(t.POINTERUP,M.rowPointerEventUp),e._experienceBase=null},_removeRowsEvents:function(e){var t,i=e.children;for(t=1;t<i.length;t++){var r=i[t];this._removeRowEvents(r)}},_calcSizeInPixel:function(){this.Size=new o.Vector2,this.Size.x=this.GetPropertyValue("Collab.Body.Width"),this.Size.y=this.GetPropertyValue("Collab.Body.Height");var e=.3527;this.Size.x/=e,this.Size.y/=e},dispose:function(){this._BOMPaperNode&&(this._BOMPaperNode.dispose(),this._BOMPaperNode=null),delete this._bomContentObserver,delete this._bomColumnsExternalPropsObserver,this._parent()},_Build:function(){var e={name:"BOMSmartNode",modifiable:this.Modifiable,type:this._type};this._BOMPaperNode=new s(e),this._BOMPaperNode.setVisibilityInTree(!1),this.add(this._BOMPaperNode),this._myDiv||(this._myDiv=new r.Element("div",{class:"CSSTableGenerator",id:"partListTableContainer"}),this._myDiv.style.position="absolute",this._myDiv.style["pointer-events"]="all",this.divParent=this.Modifiable.ExperienceBase.getManager("VCXDressupManager").getDressupsOverViewerDiv(),this._myDiv.inject(this.divParent)),this._bomContentObserver=new u,this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Header.Background.Color"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Header.Background.Color.Opacity"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Container.Text.Color.Opacity"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Container.Text.Color"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Header.Text.Color"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Header.Text.Color.Opacity"),this._bomContentObserver.add(this.Modifiable,"Collab.Text.Font"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Body.Row.Color"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Body.Row.Color.Opacity"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Body.ConsiderAlternateColor"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Body.SecondRow.Color"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Body.SecondRow.Color.Opacity"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Container.Text.Color"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Container.Text.Color.Opacity"),this._bomContentObserver.add(this.Modifiable,"Collab.Border.Line.Color"),this._bomContentObserver.add(this.Modifiable,"Collab.Border.Line.Color.Opacity"),this._bomContentObserver.add(this.Modifiable,"Collab.Text.HAlignment"),this._bomContentObserver.add(this.Modifiable,"Collab.Body.Width"),this._bomContentObserver.add(this.Modifiable,"Collab.Body.Height"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.ColumnList"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.SortColumn"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.SortAscending"),addEventListener("keydown",this._onKeydownEvent),addEventListener("keyup",this._onKeyupEvent),this._BOMPaperNode.AttachedDiv=this._myDiv},removeDiv:function(){this._myDiv&&(this.divParent=this.Modifiable.ExperienceBase.getManager("VCXDressupManager").getDressupsOverViewerDiv(),this.divParent.removeChild(this._myDiv)),removeEventListener("keydown",this._onKeydownEvent),removeEventListener("keyup",this._onKeyupEvent),delete this._bomContentObserver,delete this._bomColumnsExternalPropsObserver;for(let e in this.tokens)i.unsubscribe(this.tokens[e]);this.tokens={}},preRender:function(e){if(!this._parent(e))return!1;this._BOMPaperNode&&!this._bInRecordMode&&(this._BOMPaperNode.preRender(e),this._updateManipulatorSize())},addOrRemoveObjectToFromPSO:function(t,i){if(this._BomContent){var r=n.GetModifiableFromPathElement(t,this.ExperienceBase);if(r){var a;if(r._bIsCallout&&r.GetComputedStringProperty)a=r.GetComputedStringProperty("Collab.Text");else{var o=r.GetProperty("Actor.PartList.ID");o&&(a=o.GetPropertyValue().Value)}if(a){var s=this._BomContent[a];if(s&&s.itemComponents){var l=0;for(l=0;l<s.itemComponents.length;l++){var p={pathElement:s.itemComponents[l].QueryInterface("W3AISGNodeHolder").getPathElement()},u=e.Selection.PSOManager;i?u.add(p):u.remove(p)}s._tr&&(i?s._tr.classList.add("hover"):s._tr.classList.remove("hover"))}}}}},addOrRemoveObjectToFromCSO:function(t,i){if(this._BomContent&&t&&this.Modifiable.GetOpacity()){var r=n.GetModifiableFromPathElement(t,this.ExperienceBase);if(r){var a,o=r.GetProperty("Actor.PartList.ID");if(o&&(a=o.GetPropertyValue().Value),a){var s=this._BomContent[a];if(s){var l;if(l=s._bIsSelectedInTable,s._bIsSelectedInTable=!1,i){if(s.itemComponents){var p=0;if(l)for(p=0;p<s.itemComponents.length;p++){var u={pathElement:s.itemComponents[p].QueryInterface("W3AISGNodeHolder").getPathElement()};e.Selection.CSOManager.add(u)}else{u={pathElement:t};e.Selection.CSOManager.add(u)}s._tr&&s._tr.classList.add("selected")}}else s._tr&&s._tr.classList.remove("selected")}}}}},addToPSO:function(e){this.addOrRemoveObjectToFromPSO(e,!0)},removeFromPSO:function(e){this.addOrRemoveObjectToFromPSO(e,!1)},emptyPSO:function(){for(var e in this._BomContent)""!==e&&this._BomContent.hasOwnProperty(e)&&this._BomContent[e]._tr&&this._BomContent[e]._tr.classList.contains("hover")&&this._BomContent[e]._tr.classList.remove("hover")},addToCSO:function(e){this._experienceBase.getManager("VCXComponentPartListManager").GetPartListManipulation()&&this.addOrRemoveObjectToFromCSO(e,!0)},removeFromCSO:function(e){this.addOrRemoveObjectToFromCSO(e,!1)},emptyCSO:function(){for(var e in this._BomContent)""!==e&&this._BomContent.hasOwnProperty(e)&&this._BomContent[e]._tr&&this._BomContent[e]._tr.classList.contains("selected")&&this._BomContent[e]._tr.classList.remove("selected")},postUpdate:function(e){this._parent(e),this._bomContentObserver&&this._bomContentObserver.reset(),this._bomColumnsExternalPropsObserver&&this._bomColumnsExternalPropsObserver.reset(),this.addCallbacks()},checkIfSceneAlreadyHasPartList:function(){let e=!1,t=this.Modifiable.GetPropertyValue("Collab.PartList.ScenarioIDs");if(t&&Array.isArray(t)&&t.length>0){let i=this.ExperienceBase.getManager("VCXScenarioManager");if(i){let r=i.GetCurrentScenario();for(let i=0;i<t.length;i++)if(t[i].GetValue()===r){e=!0;break}}}return e},checkPartListVisibilityAndTurnONIfNeeded:function(e){let t=!1;if(this.ExperienceBase.getManager("VCXComponentPartListManager")){let a=this.ExperienceBase.getManager("VCXComponentPartListManager").turnOnPartListVisibility;if(a&&(this.Modifiable.GetObject()._experienceBase.getManager("VCXComponentPartListManager").turnOnPartListVisibility=!1),a&&!this.GetOpacity(e))if(this.Modifiable.GetObject().QueryInterface("VCXIVisibility")){var i=new V(this.ExperienceBase);if(i.ChangeVisibility([this.Modifiable.GetObject()],h.EVisState.Visible),this.ExperienceBase.getManager("VCXCommandManager").Push(i),this.Modifiable){var r=new c;r.SetValue(1),this.Modifiable.OnChangeProperty("Actor.Visibility.Opacity",r),this.Modifiable.OnChangePropertiesEnd()}t=!0}}return t},updateforvideo:function(){let e=this.Modifiable.GetProperty("Collab.3D.Paper.Paper.Position.X"),t=this.Modifiable.GetProperty("Collab.3D.Paper.Paper.Position.Y"),i=e._propertyValue._value,r=t._propertyValue._value;var a=this.ExperienceBase.getManager("VCXPaperManager");let o=document.getElementById("partListTableContainer");a&&o&&(i=a.MMToPixelX(i),r=a.MMToPixelY(r),o.style.left=i+"px",o.style.top=r+"px")},GetShapeInfo:function(e){return{size:this.Size}},update:function(e){let t=this.checkPartListVisibilityAndTurnONIfNeeded(e),i=this.ExperienceBase.getManager("VCXComponentPartListManager");if(this._parent(e),this._bInRecordMode&&this.updateforvideo(),(this.needToRebuildDiv||i)&&(this.needToRebuildDiv=i.ListHasChanged),this.Modifiable&&this.Modifiable._bIsPartList){var r=this.Modifiable.GetPropertyValue("Collab.3D.Paper.Positioning.Type"),a=this.Modifiable.GetPropertyValue("Collab.3D.Paper.BOM.Percentage");r===this._BOMAlignment&&a===this._BOMPercentage||(this.needToRebuildDiv=!0,this._BOMAlignment=r,this._BOMPercentage=a)}var o=!1,s=this.GetOpacity(e);if(this.Modifiable&&this.Modifiable.GetObject()){var n=this.Modifiable.GetObject().QueryInterface("VCXIVisibility");n&&n.GetVisibility()===h.EVisState.Hidden&&(s=0)}s&&(this.needToRebuildDiv?i&&i.GetBOMContent&&(this._BomContent=i.GetBOMContent(this.Modifiable.GetPropertyValue("Collab.PartList.FilterOnVisibleCallouts"))):this._bomContentObserver&&(this._bomContentObserver.update(),o=this._bomContentObserver.isDirty()));var l=!1;if(this._BomContent&&this._BomContent.length&&(l=!0),this._globalOpacity!==s){if(this._globalOpacity=s,this._globalOpacity<=0)return this._myDiv&&(i.unInitializeManipulators(),this._myDiv.parentNode.removeChild(this._myDiv),this._myDiv=null),this._BOMPaperNode&&(this.remove(this._BOMPaperNode),this._BOMPaperNode=null),void(this._currentText=null);this._BOMPaperNode||(this._Build(),this.needToRebuildDiv=!0),this._myDiv&&this._myDiv.style.opacity!==this._globalOpacity&&(this._myDiv.style.opacity=this._globalOpacity)}if(this._globalOpacity>0){let e=!1,i=this.checkIfSceneAlreadyHasPartList();if(!i&&!this._bIsScenarioTransitionInProgress)if(t||!l)e=!0;else if(!t&&l){let e=[],t=[];this._AddScenarioIDToList(e,t),this.Modifiable.ExperienceBase.getManager("VCXComponentPartListManager")._updatePropertyValues(e,t,this.Modifiable)}e&&this._setDefaultProperties()}this._BOMPaperNode&&(this._BOMPaperNode.update(e),(this.needToRebuildDiv||o)&&(this._UpdateDIV(this.needToRebuildDiv),this.needToRebuildDiv&&(this.needToRebuildDiv=!1)),this.handleLayers())},onKeydownEvent:function(e){17===e.keyCode&&this.Modifiable.ExperienceBase.getManager("VCXComponentPartListManager").GetKeyState()},onKeyupEvent:function(e){17===e.keyCode&&this.Modifiable.ExperienceBase.getManager("VCXComponentPartListManager").SetKeyState(0)},addCallbacks:function(){var e=this;this._onKeydownEvent=function(t){e.onKeydownEvent(t)},this._onKeyupEvent=function(t){e.onKeyupEvent(t)}},_updateManipulatorDisplay:function(e){if(!e||!e[0]||!e[0]._experienceBase)return;let t=e[0]._experienceBase,i=t.getManager("VCXComponentPartListManager");if(!i.GetPartListManipulation())return;let r=t.getManager("VCXSelectionManager"),a=r?r.GetComponentsFromCurrentSelection("VCXPartList_Spec"):null;document.getElementById("partListTableContainer")&&(a&&1===a.length&&!i.GetEditMode()?i._showSelection():(i._hideSelection(),i.GetActivateEditInPlace()&&(i._disableEditInPlace(),i.SetActivateEditInPlace(!1))))},_updateManipulatorSize:function(){let e=document.getElementById("partListTableContainer");if(!e)return;let t=document.querySelectorAll(".partListCorner"),i=document.querySelectorAll(".partListSplitManipulator"),r=parseFloat(e.style.transform.replace(/[A-Za-z$-()]/g,""));for(let e=0;e<t.length;e++)t[e].style.transform=t[e].style.transform.replace(/scale\([^\)]+\)\s*/,""),i[e].style.transform=i[e].style.transform.replace(/scale\([^\)]+\)\s*/,""),t[e].style.transform+=` scale(${1/r})`,i[e].style.transform+=` scale(${1/r})`}});return M.rowMouseEnter=function(t){var i=t.currentTarget,r=e.Selection.PSOManager;let a=i._this._Modifiable.ExperienceBase.getManager("VCXComponentPartListManager");if(!i||!a.GetIsPartListBeingMovedOrResized()){if(i._bomLine.itemComponents)for(var o=0;o<i._bomLine.itemComponents.length;o++){var s={pathElement:i._bomLine.itemComponents[o].QueryInterface("W3AISGNodeHolder").getPathElement()};r.add(s)}if(i._bomLine.calloutComponents)for(o=0;o<i._bomLine.calloutComponents.length;o++){s={pathElement:i._bomLine.calloutComponents[o].QueryInterface("W3AISGNodeHolder").getPathElement()};r.add(s)}}},M.rowMouseLeave=function(t){e.Selection.PSOManager.empty()},M.rowPointerEventUp=function(t){let i=t.currentTarget,r=i._this._Modifiable.ExperienceBase.getManager("VCXComponentPartListManager");if(!r.GetEditMode()&&(!i||!r.GetIsPartListBeingMovedOrResized())&&i._bomLine.itemComponents){let a=!0,o=i._experienceBase;if(!r.GetPartListManipulation())return;let s=o.getManager("VCXSelectionManager"),n=s.GetComponentsFromCurrentSelection("VCXPartList_Spec");n&&1===n.length&&(a=!1);let p=s.GetComponentsFromSelection("CSO");for(let e=0;e<p.length&&a;e++){let t=p[e];t&&t.PartListEnabled&&(a=!1)}let u=i._this.Modifiable,h=new l(o);if(r.GetActivateEditInPlace()&&!i.getAttribute("contenteditable")&&r._disableEditInPlace(),a)0===r.GetKeyState()&&h.RemoveComponentsFromSelection(p),h.AddToSelection(u.GetObject());else{h.RemoveFromSelection(u.GetObject()),i._bomLine._bIsSelectedInTable=!0;let a=!1;for(let t=0;t<i._bomLine.itemComponents.length&&!a;t++)e.Selection.CSOManager.isIn({pathElement:i._bomLine.itemComponents[t].QueryInterface("W3AISGNodeHolder").getPathElement()})&&(a=!0);for(let e=0;e<i._bomLine.itemComponents.length;e++)a?r._enableEditInPlace(i,t):(h.AddToSelection(i._bomLine.itemComponents[e]),0===r.GetKeyState()&&h.RemoveComponentsFromSelection(p))}o.getManager("VCXCommandManager").Do(h),a&&r._addPartListToCSO(u)}},M})),define("DS/VCXWebDressup/VCXPartList/VCXPartListSGNodeHolder",["DS/CoreEvents/Events","DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXPartList/VCXPartListCSSNode"],(function(e,t,i){"use strict";return t.extend({init:function(){},buildSGNode:function(){if(void 0===this._sgNode){var t={name:"PartList",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new i(t)}var r=this._sgNode;return this.event_VCX_PREHIGHLIGHT_EMPTY=e.subscribe({event:"VCX_PREHIGHLIGHT_EMPTY"},(function(e){r.emptyPSO()})),this.event_VCX_PREHIGHLIGHT_REMOVE=e.subscribe({event:"VCX_PREHIGHLIGHT_REMOVE"},(function(e){if(Array.isArray(e))for(var t=0;t<e.length;++t)r.removeFromPSO(e[t].pathElement);else e.pathElement?r.removeFromPSO(e.pathElement):console.warn("Data given by SelectionManager for removes have changed..")})),this.event_VCX_PREHIGHLIGHT_ADD=e.subscribe({event:"VCX_PREHIGHLIGHT_ADD"},(function(e){if(Array.isArray(e))for(var t=0;t<e.length;++t)r.addToPSO(e[t].pathElement);else console.warn("Data given by SelectionManager for adds have changed..")})),this.event_VCX_SELECTION_EMPTY=e.subscribe({event:"VCX_SELECTION_EMPTY"},(function(e){r.emptyCSO()})),this.event_VCX_SELECTION_COMPONENTSLIST_REMOVE=e.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},(function(e){if(Array.isArray(e))for(var t=0;t<e.length;++t){var i=e[t];if(i){var a=i.QueryInterface("W3AISGNodeHolder");a&&r.removeFromCSO(a.getPathElement())}}else console.log("Problem: Something changed with the VCX_SELECTION_COMPONENTSLIST_REMOVE event...")})),this.event_VCX_SELECTION_COMPONENTSLIST_ADD=e.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},(function(e){if(Array.isArray(e))for(var t=0;t<e.length;++t){var i=e[t];if(i){var a=i.QueryInterface("W3AISGNodeHolder");if(a){var o=a.getPathElement();o&&r.addToCSO(o)}}}else console.log("Problem: Something changed with the VCX_SELECTION_COMPONENTSLIST_ADD event...")})),this._parent()},Dispose:function(){this.event_VCX_PREHIGHLIGHT_EMPTY&&(e.unsubscribe(this.event_VCX_PREHIGHLIGHT_EMPTY),delete this.event_VCX_PREHIGHLIGHT_EMPTY),this.event_VCX_PREHIGHLIGHT_REMOVE&&(e.unsubscribe(this.event_VCX_PREHIGHLIGHT_REMOVE),delete this.event_VCX_PREHIGHLIGHT_REMOVE),this.event_VCX_PREHIGHLIGHT_ADD&&(e.unsubscribe(this.event_VCX_PREHIGHLIGHT_ADD),delete this.event_VCX_PREHIGHLIGHT_ADD),this.event_VCX_SELECTION_EMPTY&&(e.unsubscribe(this.event_VCX_SELECTION_EMPTY),delete this.event_VCX_SELECTION_EMPTY),this.event_VCX_SELECTION_REMOVE&&(e.unsubscribe(this.event_VCX_SELECTION_REMOVE),delete this.event_VCX_SELECTION_REMOVE),this.event_VCX_SELECTION_COMPONENTSLIST_REMOVE&&(e.unsubscribe(this.event_VCX_SELECTION_COMPONENTSLIST_REMOVE),delete this.event_VCX_SELECTION_COMPONENTSLIST_REMOVE),this.event_VCX_SELECTION_COMPONENTSLIST_ADD&&(e.unsubscribe(this.event_VCX_SELECTION_COMPONENTSLIST_ADD),delete this.event_VCX_SELECTION_COMPONENTSLIST_ADD),this._sgNode&&(this._sgNode.removeDiv(),delete this._sgNode),this._parent()}})})),define("DS/VCXWebDressup/VCXDressupManagerNode",["DS/VCXWebDressup/VCXDressupNode"],(function(e){"use strict";return e.extend({init:function(e){return this._parent(e),this.setVisibilityFree(!0),this},setVisibility:function(e){this._parent(e);let t=this._experienceBase.getManager("VCXDressupManager").getDressupsOverViewerDiv();t&&(e?t.show():t.hide())}})})),define("DS/VCXWebDressup/VCXDressupManagerSGNodeHolder",["DS/WebApplicationBase/W3AASGNodeHolder","DS/Visualization/PathElement","DS/VCXWebDressup/VCXDressupManagerNode"],(function(e,t,i){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Design",experience:this.GetObject()._experienceBase};this._sgNode=new i(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_DressupManagerLeaf.png")}return this.GetObject()._experienceBase.getManager("VCXContextManager").getMainViewer().addNode(this._sgNode),this._pathElement=new t,this._pathElement.setFromArray([this._sgNode]),this._sgNode},isSelfManagedPathElement:function(){return!0}})})),define("DS/VCXWebDressup/VCXArrow/VCXCornerArrowNode",["DS/VCXWebDressup/VCXArrow/VCXArrowNode","DS/Visualization/ThreeJS_DS"],(function(e,t){"use strict";var i=e.extend({init:function(e){this._parent(e)},_ComputePosBuffer:function(e,i,r,a,o){var s=this.GetAnchorWorldMatrix(0,e);if(null!=s){var n=(new t.Vector3).getPositionFromMatrix(s),l=1;this.GetPropertyValue("Collab.Is.Paper")&&(l=this.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(e,n),l*=this.GetPropertyValue("Arrow.Scale"));var p=this.GetPropertyValue("Arrow.Width.1")*l,u=0,h=0,d=0;this.GetPropertyValue("Arrow.Head.ShowMode")&&(u=this.GetPropertyValue("Arrow.Head.Length")*l,h=this.GetPropertyValue("Arrow.Head.Size")*l,d=this.GetPropertyValue("Arrow.Head.Shape")*l);var c=this.GetPropertyValue("Arrow.Width.2")*l,C=0,y=0,m=0;this.GetPropertyValue("Arrow.Head.2.ShowMode")&&(C=this.GetPropertyValue("Arrow.Head.2.Length")*l,y=this.GetPropertyValue("Arrow.Head.2.Size")*l,m=this.GetPropertyValue("Arrow.Head.2.Shape")*l);var V=this.GetPropertyValue("Arrow.Corner.Length.1")*l,f=this.GetPropertyValue("Arrow.Corner.Length.2")*l,b=p/2,P=c/2,g=[],_=0;g[2*_+0]=C,g[2*_+1]=0,g[2*++_+0]=0,g[2*_+1]=-(c/2+y),g[2*++_+0]=-m,g[2*_+1]=-c/2,g[2*++_+0]=-b,g[2*_+1]=-P,g[2*++_+0]=-p/2,g[2*_+1]=-d,g[2*++_+0]=-(p/2+h),g[2*_+1]=0,g[2*++_+0]=0,g[2*_+1]=u,g[2*++_+0]=-g[10],g[2*_+1]=g[11],g[2*++_+0]=-g[8],g[2*_+1]=g[9],g[2*++_+0]=-g[6],g[2*_+1]=-g[7],g[2*++_+0]=g[4],g[2*_+1]=-g[5],g[2*++_+0]=g[2],g[2*_+1]=-g[3],++_;var M=new t.Vector3;for(_=0;_<this._verticesNb;_++){var S=(_+2)%this._verticesNb;S<5?M.set(f,0,0):S>5&&S<11?M.set(0,V,0):M.set(0,0,0),i[3*_+0]=M.x+g[2*_+0],i[3*_+1]=M.y+g[2*_+1],i[3*_+2]=M.z,a[3*_+0]=M.x+g[2*_+0],a[3*_+1]=M.y+g[2*_+1],a[3*_+2]=M.z}return this._fillColorBuffer(r,o),this._verticesNb}console.error("anchorMatrix is null or undefined for circular arrow: ",this.Modifiable.GetObject())},preRender:function(e){if(!this._parent(e))return!1},GetVarianceNode(e){return new i({name:e.viewerID+"_"+this.name,modifiable:this.Modifiable,experience:this.ExperienceBase})},update:function(e){this._parent(e),this._step||(this._step=2),this._updateNodePresence(e),this._updateNodeBuffers(e,!1),this._updateNodePositionFromAnchor(),this._globalOpacity<=0||this._Node&&(this._updateArrowMaterialsParameters(),this.handleLayers())},_updateNodePresence:function(e){if(!this._Node&&this.GetOpacity(e)>0||this._globalOpacity!==this.GetOpacity(e)){this._globalOpacity=this.GetOpacity(e);var t=this._globalOpacity>0;t&&!this._Node&&this._Build(),this._Node&&this._Node.setVisibility(t)}}});return i})),define("DS/VCXWebDressup/VCXArrow/VCXCornerArrowSGNodeHolder",["DS/VCXWebDressup/VCXArrow/VCXArrowSGNodeHolder","DS/VCXWebDressup/VCXArrow/VCXCornerArrowNode"],(function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Arrow Corner",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_ArrowCircular.png")}return this._parent()}})})),define("DS/VCXWebDressup/VCXArrow/VCXCircularArrowNode",["DS/VCXWebDressup/VCXArrow/VCXArrowNode","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebSystem/VCXMathTools"],(function(e,t,i,r){"use strict";var a=e.extend({init:function(e){this._parent(e)},_ComputePosBuffer:function(e,i,r,a,o){var s=this.GetAnchorWorldMatrix(0,e);if(s){var n=(new t.Vector3).getPositionFromMatrix(s),l=1;this.GetPropertyValue("Collab.Is.Paper")&&(l=this.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(e,n),l*=this.GetPropertyValue("Arrow.Scale"));var p=this.GetPropertyValue("Arrow.Width.1")*l,u=0,h=0,d=0;this.GetPropertyValue("Arrow.Head.ShowMode")&&(u=this.GetPropertyValue("Arrow.Head.Length")*l,h=this.GetPropertyValue("Arrow.Head.Size")*l,d=this.GetPropertyValue("Arrow.Head.Shape")*l);var c=this.GetPropertyValue("Arrow.Width.2")*l,C=0,y=0,m=0;this.GetPropertyValue("Arrow.Head.2.ShowMode")&&(C=this.GetPropertyValue("Arrow.Head.2.Length")*l,y=this.GetPropertyValue("Arrow.Head.2.Size")*l,m=this.GetPropertyValue("Arrow.Head.2.Shape")*l);var V=this.GetPropertyValue("Arrow.Circular.Flat");"number"!=typeof V&&(V=1);var f=this.GetPropertyValue("Arrow.Circular.Angle"),b={width1:p,head1Length:u,head1Size:h,head1Shape:d,width2:c,head2Length:C,head2Size:y,head2Shape:m,arcAngleRad:2*Math.PI*f/360,arrowRadius:this.GetPropertyValue("Arrow.Circular.Radius"),flatnessMode:V};return this._fillPosBuffer(i,a,b),this._fillColorBuffer(r,o),this._verticesNb}console.error("anchorMatrix is null or undefined for circular arrow: ",this.Modifiable.GetObject())},_addCoupleVerticesConsideredMainTransfMatrix:function(e,i,r,a,o){var s=((this._step-a)*r.width2+a*r.width1)/(2*this._step),n=new t.Vector3(-s,0,0).applyMatrix4(o),l=new t.Vector3(+s,0,0).applyMatrix4(o),p=a+2,u=3*p,h=3*(this._verticesNb-p);e[u]=n.x,e[u+1]=n.y,e[u+2]=n.z,e[h]=l.x,e[h+1]=l.y,e[h+2]=l.z,i[u]=n.x,i[u+1]=n.y,i[u+2]=n.z,i[h]=l.x,i[h+1]=l.y,i[h+2]=l.z},_addHeadPosInBuffer:function(e,i,a,o,s){var n,l,p,u,h,d=new t.Matrix4;if(1===o)n=3*(this._step+3),l=a.width1,p=a.head1Size,u=a.head1Length,h=a.head1Shape;else{if(2!==o)throw new Error("Arguments for _addHeadPosInBuffer method not valid.");n=3*(2*this._step+7),l=a.width2,p=a.head2Size,u=a.head2Length,h=a.head2Shape,d.makeRotationZ(Math.PI)}s.multiply(d);var c=new t.Vector3(-(l/2+p),h,0),C=new t.Vector3(0,u,0),y=new t.Vector3(-c.x,c.y,c.z);c.applyMatrix4(s),C.applyMatrix4(s),y.applyMatrix4(s),this._headRootNodes&&this._headRootNodes[o-1]&&this._headRootNodes[o-1].node.setMatrix(r.rotateMatrixAroundZ(s,.5*Math.PI)),e[n]=c.x,i[n]=c.x,e[++n]=c.y,i[n]=c.y,e[++n]=c.z,i[n]=c.z,n++,e[n%=3*this._verticesNb]=C.x,i[n]=C.x,e[++n]=C.y,i[n]=C.y,e[++n]=C.z,i[n]=C.z,e[++n]=y.x,i[n]=y.x,e[++n]=y.y,i[n]=y.y,e[++n]=y.z,i[n]=y.z,n++},_fillPosBuffer:function(e,i,a){var o=new t.Matrix4,s=new t.Matrix4,n=new t.Matrix4,l=new t.Matrix4,p=new t.Matrix4;0===a.flatnessMode&&o.makeRotationY(Math.PI/2),s.makeTranslation(a.arrowRadius,0,0),l.multiply(s).multiply(o),this._addHeadPosInBuffer(e,i,a,2,l.clone());for(var u=0;u<=this._step;++u)n.makeRotationZ(a.arcAngleRad*u/this._step),p.copy(n).multiply(l),u===Math.round(.5*this._step)&&this._headRootNodes&&this._headRootNodes[2]&&this._headRootNodes[2].node.setMatrix(r.rotateMatrixAroundZ(p,.5*Math.PI)),this._addCoupleVerticesConsideredMainTransfMatrix(e,i,a,u,p.clone());n.makeRotationZ(a.arcAngleRad),p.copy(n).multiply(l),this._addHeadPosInBuffer(e,i,a,1,p.clone())},preRender:function(e){if(!this._parent(e))return!1},GetVarianceNode(e){return new a({name:e.viewerID+"_"+this.name,modifiable:this.Modifiable,experience:this.ExperienceBase})},update:function(e){this._parent(e),this._updateNodePositionFromAnchor(),this._step=this.GetPropertyValue("Arrow.Circular.Step"),this._updateNodePresence(e),this._updateNodeBuffers(e,!1),this._globalOpacity<=0||this._Node&&(this._updateArrowMaterialsParameters(),this.handleLayers())},_Build:function(){return this._parent(),this._Node&&(this._headRootNodes||(this._headRootNodes=[{id:1},{id:2},{id:3}],this._headRootNodes.forEach(function(e){e.node=new i({name:"ArrowHeads"}),this._Node.add(e.node)}.bind(this)))),!0},_updateNodePresence:function(e){if(this._lastStep!==this._step&&(this.removeChild(this._Node),this._Node=null),!this._Node&&this.GetOpacity(e)>0||this._globalOpacity!==this.GetOpacity(e)){this._globalOpacity=this.GetOpacity(e);var t=this._globalOpacity>0;t&&!this._Node&&(this._Build(),this._lastStep=this._step),this._Node&&this._Node.setVisibility(t)}}});return a})),define("DS/VCXWebDressup/VCXArrow/VCXCircularArrowSGNodeHolder",["DS/VCXWebDressup/VCXArrow/VCXArrowSGNodeHolder","DS/VCXWebDressup/VCXArrow/VCXCircularArrowNode"],(function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Circular Arrow",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_ArrowCircular.png")}return this._parent()}})})),define("DS/VCXWebDressup/VCXDressupGrpNode",["DS/VCXWebDressup/VCXDressupNode"],(function(e){"use strict";return e.extend({GetNode:function(e){return this}})})),define("DS/VCXWebDressup/VCXDressupGrpSGNodeHolder",["DS/WebApplicationBase/W3AASGNodeHolder","DS/VCXWebDressup/VCXDressupGrpNode"],(function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e=this.GetObject().QueryInterface("VCXIModifiable"),i={name:this.GetObject().getName(),modifiable:e};this._sgNode=new t(i),this._sgNode.isDressupGrp=!0}this._sgNode.setVisibilityInTree(!1);var r=this.QueryInterface("VCXIModelNavigable");if(r){var a=r.getParent().QueryInterface("W3AISGNodeHolder");a&&(a.getSGNode().addChild(this._sgNode,{noTreatment:!0}),this._pathElement=a.getPathElement().clone(),this._pathElement.addElement(this._sgNode))}return this._sgNode},isSelfManagedPathElement:function(){return!0}})})),define("DS/VCXWebDressup/VCXMarkup/VCXPanelModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebDressup/VCXMarkup/VCXMarkupModifiable","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","DS/VCXWebDressup/VCXMarkup/VCXPanel_Spec","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueLink","DS/VCXWebProperties/VCXPropertyValueString"],(function(e,t,i,r,a,o,s,n,l){"use strict";return t.extend({init:function(){this._bIsPanel=!0,this._parent()},Build:function(){this._parent();var e=[{Name:"Collab.Markup.SubType",DefaultValue:r.ESubType.None},{Name:"Collab.Text.Show",DefaultValue:!1,FormatPainter:!0},{Name:"Collab.Text.Wordwrap",DefaultValue:!0},{Name:"Collab.Text.HAlignment",DefaultValue:i.EHTextAlignment.Justified,FormatPainter:!0},{Name:"Collab.Text.VAlignment",DefaultValue:i.EVTextAlignment.Top,FormatPainter:!0},{Name:"Collab.Body.InnerMargin",DefaultValue:0,FormatPainter:!0},{Name:"Collab.Body.Shape",DefaultValue:i.EBodyShape.Rectangle,FormatPainter:!0},{Name:"Collab.Body.Width",DefaultValue:100},{Name:"Collab.Body.Height",DefaultValue:100},{Name:"Collab.Border.Show",DefaultValue:!1,FormatPainter:!0},{Name:"Collab.Background.Show",DefaultValue:!1,FormatPainter:!0},{Name:"Collab.Image.Show",DefaultValue:!0},{Name:"Collab.Attach.Show",DefaultValue:!0,FormatPainter:!0},{Name:"Collab.3D.Paper.Billboard.Type",DefaultValue:2},{Name:"Collab.3D.Paper.Referential.In.World",DefaultValue:!1},{Name:"Collab.3D.Paper.Size.Control.Type",DefaultValue:1},{Name:"Actor.IsAlwaysOnTop",DefaultValue:!0,FormatPainter:!0},{Name:"Collab.Body.VAlignment",DefaultValue:i.EVAlignment.Bottom,visibleInPropertyGroups:!1},{Name:"Collab.3D.Paper.Positioning.Type",DefaultValue:i.EPositionType.Free2D},{Name:"Collab.UseDepthFromAnchor",Type:s,DefaultValue:!1,visibleInPropertyGroups:!1,Persistent:!1}];this._BuildPropertyValues(e)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Collab.3D.Paper.Positioning.Type",!0),this.GetPropertyValue("Collab.Markup.SubType")===r.ESubType.Image||this.GetPropertyValue("Collab.Markup.SubType")===r.ESubType.Text?(this.SetPropertyInvisible("Collab.Image.Color",!0),this.SetPropertyInvisible("Collab.Image.Color.Opacity",!0),this.SetPropertyInvisible("Collab.Image.Scale",!0),this.GetPropertyValue("Collab.Markup.SubType")===r.ESubType.Image&&(this.SetPropertyInvisible("Collab.Text",!0),this.ChangeGroupAvailability("Group.Text",e.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Background",e.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Image",e.EAvailability.AppForceAvailable))):(this.ChangeGroupAvailability("Group.Image",e.EAvailability.NoControl),this.ChangeGroupAvailability("Group.Attach",e.EAvailability.NoControl))},OnChangeProperty:function(e,t,i){this._parent(e,t,i),"Collab.Markup.SubType"===e&&this.SetPropertiesInfo()},Set2DPanelProperties:function(e,t,r,n){var p=new a(e);this.OnChangeProperty("Collab.Markup.SubType",p);var u=new s(!1);if(this.OnChangeProperty("Collab.Body.FitToText",u),this._Properties["Collab.Text.Font"].GetPropertyValue().SetHeight(new o(30)),this.OnChangeProperty("Collab.Background.Show",new s(!0)),this.OnChangeProperty("Collab.Background.Color.Opacity",new o(.5)),this.OnChangeProperty("Collab.Image.Show",new s(Boolean(t||n))),this.OnChangeProperty("Collab.Text.Show",new s(!t&&!n)),t&&this.OnChangeProperty("Collab.Image.Doc.ID",t),n&&this.OnChangeProperty("Collab.PIP.Scenario.ID",new l(n)),r){var h=new s(!0);this.OnChangeProperty("Collab.Text.Show",h);var d=new l(r);this.OnChangeProperty("Collab.Text",d);var c=new o(2);this.OnChangeProperty("Collab.Body.InnerMargin",c)}this.OnChangeProperty("Collab.Body.KeepAspectRatio",new s(!1));var C=new s(!1);this.OnChangeProperty("Collab.Attach.Show",C);var y=new a(2);this.OnChangeProperty("Collab.3D.Paper.Billboard.Type",y);var m=new a(1);this.OnChangeProperty("Collab.3D.Paper.Size.Control.Type",m);var V=new a(1e3);this.OnChangeProperty("Collab.3D.Paper.Positioning.Type",V);var f=new o(this.GetObject()._experienceBase.getManager("VCXDressupManager").GetDepthInformation().highest+1);this.OnChangeProperty("Collab.3D.Paper.Depth",f),n&&(this.OnChangeProperty("Collab.Body.HAlignment",new o(i.EHAlignment.Center)),this.OnChangeProperty("Collab.Body.VAlignment",new o(i.EVAlignment.Middle))),this.OnChangeProperty("Collab.Body.Width",new o(40)),this.OnChangeProperty("Collab.Body.Height",new o(30)),this.OnChangeProperty("Collab.Body.Shadow.Show",new s(!0))},getFormatPainterCompatibilityClass:function(){return this.GetObject().GetType()+"."+this.QueryInterface("VCXIModifiable").GetPropertyValue("Collab.Markup.SubType")+"."+this.QueryInterface("VCXIModifiable").GetPropertyValue("Collab.3D.Paper.Billboard.Type")+"."+this.QueryInterface("VCXIModifiable").GetPropertyValue("Collab.3D.Paper.Positioning.Type")}})})),define("DS/VCXWebDressup/VCXMarkup/VCXDiggerPanelModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebDressup/VCXMarkup/VCXPanelModifiable","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebDressup/VCXMarkup/VCXPanel_Spec"],(function(e,t,i,r){"use strict";return t.extend({init:function(){this._parent()},Build:function(){this._parent();var t=[{Name:"Collab.AssociatedObjectID",Type:i,DefaultValue:""},{Name:"Collab.Attach.Availability",DefaultValue:e.EAvailability.NoControl},{Name:"Collab.Markup.SubType",DefaultValue:r.ESubType.Image}];this._BuildPropertyValues(t),this.SetPropertyInvisible("Collab.AssociatedObjectID",!0)},SetPropertiesInfo:function(){this._parent(),this.ChangeGroupAvailability("Group.Attach",e.EAvailability.NoControl),this.ChangeGroupAvailability("Group.Image",e.EAvailability.NoControl),this.SetPropertyInvisible("Collab.Image.Color",!1),this.SetPropertyInvisible("Collab.Image.Color.Opacity",!1)}})})),define("DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeBottomAndLeft",["DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools"],(function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iSwap=0,this.iPariteX=0,this.iPariteY=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0),this.maxfx=this.fHalfSizeX-this.fCellSize-this.fCellSize,this.LRiPariteX=0,this.LRiPariteY=0,this.LRfX=this.fHalfSizeX-this.fCellSize,this.LRfX<0&&(this.LRfX=0),this.LRdy=0,this.LRfY=0,this.LRmaxfy=this.fHalfSizeY-this.fCellSize},next:function(){if(this._parent(),this.iSwap++,1&this.iSwap){if(this.LRiPariteY++,2===this.LRiPariteY&&(this.LRiPariteY=0,this.LRfY+=this.fCellSize,this.LRfY>this.fHalfSizeY-this.fCellSize&&(0===this.LRdy?this.LRdy=.5*this.fCellSize:this.LRdy=0,this.LRfY=0,this.LRfX-=this.fCellSize,this.LRfX<this.fCellSize)))return this.rewind(),!0}else if(0==this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.maxfx&&(this.maxfx-=this.fCellSize,this.maxfx<this.fCellSize&&(this.maxfx=this.fCellSize),0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<this.fCellSize)))return this.rewind(),!0;return!1},getPoint:function(){var e=new t.Vector2;return 1&this.iSwap?(e.x=this.fHalfSizeX-this.LRfX,1&this.LRiPariteY?e.y=this.fHalfSizeY-this.LRfY+this.LRdy:e.y=this.fHalfSizeY+this.LRfY+this.LRdy):(1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,e.y=this.fHalfSizeY+this.fY),e}})})),define("DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeRectangle",["DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS"],(function(e,t){"use strict";return e.extend({rewind:function(){this._parent(),this.iSwap=0,this.iPariteX=0,this.iPariteY=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0),this.maxfx=this.fHalfSizeX-this.fCellSize-this.fCellSize,this.LRiPariteX=0,this.LRiPariteY=0,this.LRfX=this.fHalfSizeX-this.fCellSize,this.LRfX<0&&(this.LRfX=0),this.LRdy=0,this.LRfY=0,this.LRmaxfy=this.fHalfSizeY-this.fCellSize},next:function(){if(this._parent(),this.iSwap++,1===this.iSwap)return!1;if(1&this.iSwap){if(this.LRiPariteX++,2===this.LRiPariteX&&(this.LRiPariteX=0,0===this.LRfY&&this.LRiPariteY++,this.LRiPariteY++,2===this.LRiPariteY&&(this.LRiPariteY=0,this.LRfY+=this.fCellSize,this.LRfY>this.fHalfSizeY-this.fCellSize&&(0===this.LRdy?this.LRdy=.5*this.fCellSize:this.LRdy=0,this.LRfY=0,this.LRfX-=this.fCellSize,this.LRfX<this.fCellSize))))return this.rewind(),!0}else if(this.iPariteY++,2===this.iPariteY&&(this.iPariteY=0,0==this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.maxfx&&(this.maxfx-=this.fCellSize,this.maxfx<this.fCellSize&&(this.maxfx=this.fCellSize),0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<this.fCellSize))))return this.rewind(),!0;return!1},getPoint:function(){var e=new t.Vector2;return 1&this.iSwap?(1&this.LRiPariteX?e.x=this.fHalfSizeX-this.LRfX:e.x=this.fHalfSizeX+this.LRfX,1&this.LRiPariteY?e.y=this.fHalfSizeY-this.LRfY+this.LRdy:e.y=this.fHalfSizeY+this.LRfY+this.LRdy):(1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,1&this.iPariteY?e.y=this.fHalfSizeY-this.fY:e.y=this.fHalfSizeY+this.fY),e}})})),define("DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapePerimetric",["DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS"],(function(e,t){"use strict";return e.extend({rewind:function(){this._parent(),this.iCurrent=0,this.rMax=Math.min(this.sizeView.x,this.sizeView.y),this.rMax<this.fCellSize&&(this.rMax=this.fCellSize),this.r=this.fCellSize,this.nbPerCircle=Math.floor(2*Math.PI*this.r/this.fCellSize+.5),this.iT=0,this.dt=0,this.iParite=0},next:function(){if(this._parent(),this.iT++,this.iT>=this.nbPerCircle){if(this.r+=this.fCellSize,this.r>this.rMax)return this.rewind(),!0;this.iT=0,this.nbPerCircle=Math.floor(2*Math.PI*this.r/this.fCellSize+.5),1&this.iParite?this.dt=Math.PI/this.nbPerCircle:this.dt=0,this.iParite++}return!1},getPoint:function(e){var i=new t.Vector2,r=this.dt+2*Math.PI*this.iT/this.nbPerCircle;return i.x=Math.cos(r)*this.r+e.x,i.y=Math.sin(r)*this.r+e.y,i}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXMarkup/VCXLabel_Spec",["require","exports","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{}return r.prototype.getDefaultName=function(){return"Label"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXLabel_Spec"}}),r.prototype.dressupGroupName="Annotations",r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXMarkup/VCXMeasurement_Spec",["require","exports","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXMarkup/VCXLabel_Spec","DS/VCXWebSystem/VCXMathTools","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec"],(function(e,t,i,r,a,o){"use strict";r=__importDefault(r),a=__importDefault(a),o=__importDefault(o);class s extends r.default{constructor(){super(),this._keyValues={}}getAttachType(){var e=this.QueryInterface("VCXIModifiable");if(e)switch(e.GetPropertyValue("Collab.Measurement.Type")){case s.EType.Arc:case s.EType.GDT:case s.EType.Area:case s.EType.Volume:case s.EType.PipeLength:case s.EType.AreaMultiplePoints:case s.EType.VolumeMultiplePoints:case s.EType.PipeLengthMultiplePoints:case s.EType.Coord:case s.EType.Projected:return s.EAttachTypeMeasurement.Simple;case s.EType.Angle:case s.EType.BetweenAxis:case s.EType.BetweenLines:case s.EType.BetweenPlanes:case s.EType.PlanePoint:case s.EType.LinePoint:case s.EType.BetweenPoints:case s.EType.Linear:case s.EType.BetweenCentres:return s.EAttachTypeMeasurement.Double;case s.EType.Diameter:case s.EType.Radius:return e.GetPropertyValue("Collab.Measurement.Attach.Type")}}getKeyPoints(e,t){var r=this.QueryInterface("VCXIModifiable");if(r&&r.GetAnchorWorldMatrix(0,e)){switch(this._keyValues.labelLineExtremity0=a.default.getOFromMatrix(t.getMatrix()),this.newLabel0Position=this._keyValues.labelLineExtremity0,r.GetPropertyValue("Collab.Measurement.Type")){case s.EType.Arc:case s.EType.GDT:case s.EType.Area:case s.EType.Volume:case s.EType.PipeLength:case s.EType.AreaMultiplePoints:case s.EType.VolumeMultiplePoints:case s.EType.PipeLengthMultiplePoints:case s.EType.BetweenAxis:case s.EType.BetweenCentres:case s.EType.Coord:case s.EType.Projected:break;case s.EType.Angle:this._keyValues.angle=!0,this._keyValues.measurementExtremity1||this.getValue(e,t);break;case s.EType.BetweenLines:case s.EType.BetweenPlanes:case s.EType.PlanePoint:case s.EType.LinePoint:this._keyValues.measurementExtremity1||this.getValue(e,t);break;case s.EType.Linear:this._getMeasurementExtremity1(),this._keyValues.measurementExtremity2=new i.Vector3(this.getValue(e,t),0,0).applyMatrix4(this._keyValues.measurementExtremity1Frame);break;case s.EType.BetweenPoints:var n=(new i.Vector3).subVectors(this._getMeasurementExtremity2(),this._getMeasurementExtremity1()).normalize();this._keyValues.measurementExtremity1Frame=a.default.getMatrixFromOVxVy(this._keyValues.measurementExtremity1,n,this.newLabel0Position);break;case s.EType.Radius:case s.EType.Diameter:if(!this._keyValues.labelLineExtremity1||!this._keyValues.labelLineExtremity2){this._keyValues.measurementExtremity0Frame=r.GetAnchorWorldMatrix(0,e),this._keyValues.measurementExtremity0=a.default.getOFromMatrix(this._keyValues.measurementExtremity0Frame),this._keyValues.value=r.GetPropertyValue("Collab.Measurement.Radius");var l=(new i.Vector3).subVectors(this.newLabel0Position,this._keyValues.measurementExtremity0),p=a.default.getVzFromMatrix(this._keyValues.measurementExtremity0Frame);p.normalize();n=(new i.Vector3).crossVectors(p,l).normalize();r.GetPropertyValue("Collab.Measurement.Type")===s.EType.Radius?(n.multiplyScalar(this._keyValues.value),this._keyValues.measurementExtremity1=this._keyValues.measurementExtremity0.clone()):(n.multiplyScalar(.5*this._keyValues.value),this._keyValues.measurementExtremity1=this._keyValues.measurementExtremity0.clone().add(n)),this._keyValues.measurementExtremity2=this._keyValues.measurementExtremity0.clone().sub(n),n.negate().normalize(),this._keyValues.measurementExtremity1Frame=a.default.getMatrixFromOVxVy(this._keyValues.measurementExtremity1,n,p),this._keyValues.labelLineExtremity1=this._keyValues.measurementExtremity1.clone().add(l),this._keyValues.labelLineExtremity2=this._keyValues.measurementExtremity2.clone().add(l),this._keyValues.arrowLineExtremity1=this._keyValues.labelLineExtremity1,this._keyValues.arrowLineExtremity2=this._keyValues.labelLineExtremity2}}switch(r.GetPropertyValue("Collab.Measurement.Type")){case s.EType.Arc:case s.EType.Area:case s.EType.Volume:case s.EType.PipeLength:case s.EType.AreaMultiplePoints:case s.EType.VolumeMultiplePoints:case s.EType.PipeLengthMultiplePoints:case s.EType.Radius:case s.EType.Diameter:case s.EType.GDT:case s.EType.Coord:case s.EType.Projected:break;case s.EType.Angle:case s.EType.BetweenLines:case s.EType.BetweenPlanes:case s.EType.LinePoint:case s.EType.BetweenPoints:case s.EType.PlanePoint:case s.EType.BetweenAxis:case s.EType.BetweenCentres:if(t.PositioningType<=o.default.EPositionType.Free2D){n=(new i.Vector3).subVectors(this._getMeasurementExtremity2(),this._getMeasurementExtremity1()).normalize();var u=(new i.Vector3).subVectors(this.newLabel0Position,e.viewpoint.getEyePosition()).normalize(),h=a.default.getNearestDistanceBetween2Lines(this.newLabel0Position,u,this._getMeasurementExtremity1(),n);this.newLabel0Position=h.p1}}switch(r.GetPropertyValue("Collab.Measurement.Type")){case s.EType.Arc:case s.EType.Area:case s.EType.Volume:case s.EType.PipeLength:case s.EType.AreaMultiplePoints:case s.EType.VolumeMultiplePoints:case s.EType.PipeLengthMultiplePoints:case s.EType.Radius:case s.EType.Diameter:case s.EType.GDT:case s.EType.Coord:case s.EType.Projected:break;case s.EType.Angle:case s.EType.BetweenLines:case s.EType.BetweenPlanes:case s.EType.LinePoint:case s.EType.BetweenPoints:case s.EType.PlanePoint:case s.EType.BetweenAxis:case s.EType.Linear:case s.EType.BetweenCentres:if(!this._keyValues.labelLineExtremity1||!this._keyValues.labelLineExtremity2)if(this._keyValues.angle){var d=(new i.Plane).setFromNormalAndCoplanarPoint(a.default.getVzFromMatrix(this._keyValues.measurementExtremity0Frame),this._keyValues.measurementExtremity0);this._keyValues.projectedPoint=d.projectPoint(this.newLabel0Position),this._keyValues.radius=this._keyValues.projectedPoint.distanceTo(this._keyValues.measurementExtremity1);var c=Math.max(this._keyValues.radius,this._keyValues.measurementAnglePoint1.distanceTo(this._keyValues.measurementExtremity0)),C=(new i.Vector3).subVectors(this._keyValues.measurementExtremity5,this._keyValues.measurementExtremity1).normalize();this._keyValues.labelLineExtremity1=this._keyValues.measurementExtremity1.clone().add(C.clone().multiplyScalar(c)),this._keyValues.labelLineExtremity1Frame=this._keyValues.measurementExtremity1Frame.clone().setPosition(this._keyValues.labelLineExtremity1),this._keyValues.arrowLineExtremity1=this._keyValues.measurementExtremity1.clone().add(C.clone().multiplyScalar(this._keyValues.radius));c=Math.max(this._keyValues.radius,this._keyValues.measurementAnglePoint2.distanceTo(this._keyValues.measurementExtremity0));r.GetPropertyValue("Collab.Measurement.Type")===s.EType.BetweenLines&&(c=Math.max(this._keyValues.radius,r.GetPropertyValue("Collab.Measurement.Length2")));var y=(new i.Vector3).subVectors(this._keyValues.measurementExtremity6,this._keyValues.measurementExtremity2).normalize();this._keyValues.labelLineExtremity2=this._keyValues.measurementExtremity2.clone().add(y.clone().multiplyScalar(c)),this._keyValues.labelLineExtremity2Frame=this._keyValues.measurementExtremity1Frame.clone().setPosition(this._keyValues.labelLineExtremity2),this._keyValues.arrowLineExtremity2=this._keyValues.measurementExtremity2.clone().add(y.clone().multiplyScalar(this._keyValues.radius))}else{n=(new i.Vector3).subVectors(this._getMeasurementExtremity2(),this._getMeasurementExtremity1());var m=(new i.Vector3).subVectors(this.newLabel0Position,this._getMeasurementExtremity1()),V=(new i.Vector3).crossVectors(n,m).normalize(),f=(new i.Vector3).crossVectors(V,n).normalize(),b=m.dot(f);f.multiplyScalar(b),this._keyValues.labelLineExtremity1=f.clone().add(this._getMeasurementExtremity1()),this._keyValues.labelLineExtremity2=f.clone().add(this._getMeasurementExtremity1()).add(n),this._keyValues.arrowLineExtremity1=this._keyValues.labelLineExtremity1,this._keyValues.arrowLineExtremity2=this._keyValues.labelLineExtremity2}}}return this._keyValues}_getMeasurementExtremity1(){if(!this._keyValues.measurementExtremity1){var e=this.QueryInterface("VCXIModifiable");e&&(this._keyValues.measurementExtremity1Frame=e.GetAnchorWorldMatrix(0,null),this._keyValues.measurementExtremity1=a.default.getOFromMatrix(this._keyValues.measurementExtremity1Frame))}return this._keyValues.measurementExtremity1}_getMeasurementExtremity2(){if(!this._keyValues.measurementExtremity2){var e=this.QueryInterface("VCXIModifiable");e&&(this._keyValues.measurementExtremity2Frame=e.GetAnchorWorldMatrix(1,null),this._keyValues.measurementExtremity2=a.default.getOFromMatrix(this._keyValues.measurementExtremity2Frame))}return this._keyValues.measurementExtremity2}_getMeasurementExtremity3(){if(!this._keyValues.measurementExtremity3){var e=this.QueryInterface("VCXIModifiable");e&&(this._keyValues.measurementExtremity3Frame=e.GetAnchorWorldMatrix(2,null),this._keyValues.measurementExtremity3=a.default.getOFromMatrix(this._keyValues.measurementExtremity3Frame))}return this._keyValues.measurementExtremity3}getValue(e,t){if(void 0===this._keyValues.value){this.newLabel0Position||(this.newLabel0Position=a.default.getOFromMatrix(this.getReferential()));var r=this.QueryInterface("VCXIModifiable");if(r&&r.GetAnchorWorldMatrix(0,e))switch(r.GetPropertyValue("Collab.Measurement.Type")){case s.EType.GDT:case s.EType.Projected:this._keyValues.value=r._Properties["Collab.Measurement.Value"].GetPropertyValue().Value;break;case s.EType.Radius:case s.EType.Diameter:this._keyValues.value=r.GetPropertyValue("Collab.Measurement.Radius");break;case s.EType.Arc:case s.EType.PipeLength:case s.EType.PipeLengthMultiplePoints:case s.EType.Linear:this._keyValues.value=r.GetPropertyValue("Collab.Measurement.Length");break;case s.EType.Coord:this._keyValues.value=0;break;case s.EType.Area:case s.EType.AreaMultiplePoints:this._keyValues.value=r.GetPropertyValue("Collab.Measurement.Area");break;case s.EType.Volume:case s.EType.VolumeMultiplePoints:this._keyValues.value=r.GetPropertyValue("Collab.Measurement.Volume");break;case s.EType.BetweenAxis:case s.EType.BetweenPoints:case s.EType.BetweenCentres:this._keyValues.value=this._getMeasurementExtremity1().distanceTo(this._getMeasurementExtremity2());break;case s.EType.Angle:this._keyValues.angle=!0,this._getMeasurementExtremity1(),this._getMeasurementExtremity2(),this._getMeasurementExtremity3(),this._keyValues.measurementAnglePoint1=this._keyValues.measurementExtremity3.clone(),this._keyValues.measurementAnglePoint2=this._keyValues.measurementExtremity2.clone(),this._keyValues.measurementExtremity4=this._keyValues.measurementExtremity2.clone(),this._keyValues.measurementExtremity4Frame=this._keyValues.measurementExtremity2Frame.clone().setPosition(this._keyValues.measurementExtremity4),this._keyValues.measurementExtremity2=this._keyValues.measurementExtremity1.clone(),this._keyValues.measurementExtremity2Frame=this._keyValues.measurementExtremity1Frame.clone().setPosition(this._keyValues.measurementExtremity2),this._keyValues.measurementExtremity5=this._keyValues.measurementExtremity3.clone(),this._keyValues.measurementExtremity5Frame=this._keyValues.measurementExtremity3Frame.clone().setPosition(this._keyValues.measurementExtremity5),this._keyValues.measurementExtremity6=this._keyValues.measurementExtremity4.clone(),this._keyValues.measurementExtremity6Frame=this._keyValues.measurementExtremity4Frame.clone().setPosition(this._keyValues.measurementExtremity6);var o=(new i.Vector3).subVectors(this._keyValues.measurementExtremity3,this._keyValues.measurementExtremity1).normalize(),n=(new i.Vector3).subVectors(this._keyValues.measurementExtremity4,this._keyValues.measurementExtremity2).normalize();this._keyValues.value=o.angleTo(n),this._keyValues.measurementExtremity0=this._keyValues.measurementExtremity1,this._keyValues.measurementExtremity0Frame=a.default.getMatrixFromOVxVy(this._keyValues.measurementExtremity1,o,n);break;case s.EType.BetweenLines:if(this._getMeasurementExtremity1(),this._getMeasurementExtremity2(),f=a.default.getNearestDistanceBetween2Lines(this._getMeasurementExtremity1(),a.default.getVxFromMatrix(this._keyValues.measurementExtremity1Frame),this._getMeasurementExtremity2(),a.default.getVxFromMatrix(this._keyValues.measurementExtremity2Frame)))if(this._keyValues.measurementExtremity3Frame=this._keyValues.measurementExtremity1Frame.clone(),this._keyValues.measurementExtremity3=this._keyValues.measurementExtremity1.clone(),this._keyValues.measurementExtremity4Frame=this._keyValues.measurementExtremity2Frame.clone(),this._keyValues.measurementExtremity4=this._keyValues.measurementExtremity2.clone(),Math.abs(f.d)<=.001){this._keyValues.angle=!0,"Angle"!==r._Properties["Collab.Measurement.Value"].GetPropertyInfo().GetUnitType()&&r._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Angle");var l=a.default.getVxFromMatrix(this._keyValues.measurementExtremity1Frame).normalize(),p=a.default.getVxFromMatrix(this._keyValues.measurementExtremity2Frame).normalize();if(this.newLabel0Position){var u=(new i.Vector3).crossVectors(l,p).normalize(),h=(new i.Plane).setFromNormalAndCoplanarPoint(u,f.p1);this._keyValues.projectedPoint=h.projectPoint(this.newLabel0Position),this._keyValues.radius=this._keyValues.projectedPoint.distanceTo(f.p1);var d=this._keyValues.projectedPoint.clone().sub(f.p1).normalize(),c=(new i.Vector3).crossVectors(l,d).normalize();u.dot(c)<0&&p.negate();u=(new i.Vector3).crossVectors(p,l).normalize();var C=this._keyValues.projectedPoint.clone().sub(f.p2).normalize();c=(new i.Vector3).crossVectors(p,C).normalize();u.dot(c)<0&&l.negate()}this._keyValues.measurementExtremity5=f.p1.clone().add(l.clone().multiplyScalar(this._keyValues.radius)),this._keyValues.measurementExtremity5Frame=this._keyValues.measurementExtremity1Frame.clone().setPosition(this._keyValues.measurementExtremity5),this._keyValues.measurementExtremity6=f.p2.clone().add(p.clone().multiplyScalar(this._keyValues.radius)),this._keyValues.measurementExtremity6Frame=this._keyValues.measurementExtremity2Frame.clone().setPosition(this._keyValues.measurementExtremity6),this._keyValues.measurementAnglePoint1=f.p1.clone().add(l.clone().multiplyScalar(r.GetPropertyValue("Collab.Measurement.Length1"))),this._keyValues.measurementAnglePoint2=f.p2.clone().add(p.clone().multiplyScalar(r.GetPropertyValue("Collab.Measurement.Length2"))),this._keyValues.value=l.angleTo(p),this._keyValues.measurementExtremity1=f.p1,this._keyValues.measurementExtremity2=f.p2,this._keyValues.measurementExtremity0=f.p1,this._keyValues.measurementExtremity0Frame=a.default.getMatrixFromOVxVy(f.p1,l,p)}else this._keyValues.angle=!1,"Length"!==r._Properties["Collab.Measurement.Value"].GetPropertyInfo().GetUnitType()&&r._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Length"),this._keyValues.measurementExtremity1=f.p1,this._keyValues.measurementExtremity2=f.p2,this._keyValues.value=f.d;break;case s.EType.LinePoint:this._getMeasurementExtremity1(),this._getMeasurementExtremity2(),this._keyValues.measurementExtremity3Frame=this._keyValues.measurementExtremity1Frame.clone(),this._keyValues.measurementExtremity3=this._keyValues.measurementExtremity1.clone(),new i.Ray(this._keyValues.measurementExtremity3,a.default.getVxFromMatrix(this._keyValues.measurementExtremity3Frame)).closestPointToPoint(this._keyValues.measurementExtremity2,this._keyValues.measurementExtremity1),this._keyValues.value=this._keyValues.measurementExtremity2.distanceTo(this._keyValues.measurementExtremity1);break;case s.EType.PlanePoint:if(!this._keyValues.measurementExtremity1){this._getMeasurementExtremity1();var y=(new i.Plane).setFromNormalAndCoplanarPoint(a.default.getVzFromMatrix(this._keyValues.measurementExtremity1Frame),this._getMeasurementExtremity1());this._keyValues.measurementExtremity3Frame=this._keyValues.measurementExtremity1Frame.clone(),this._keyValues.measurementExtremity3=a.default.getOFromMatrix(this._keyValues.measurementExtremity3Frame),this._keyValues.measurementExtremity4Frame=this._keyValues.measurementExtremity1Frame.clone(),this._getMeasurementExtremity2(),this._keyValues.value=Math.abs(y.distanceToPoint(this._keyValues.measurementExtremity2)),this._keyValues.measurementExtremity1=y.projectPoint(this._keyValues.measurementExtremity2),this._keyValues.measurementExtremity1Frame.setPosition(this._keyValues.measurementExtremity1);var m=(new i.Plane).setFromNormalAndCoplanarPoint(a.default.getVzFromMatrix(this._keyValues.measurementExtremity1Frame),this._getMeasurementExtremity2());this._keyValues.measurementExtremity4=m.projectPoint(this._keyValues.measurementExtremity3),this._keyValues.measurementExtremity4Frame.setPosition(this._keyValues.measurementExtremity4)}break;case s.EType.BetweenPlanes:if(!this._keyValues.measurementExtremity1){this._getMeasurementExtremity1();y=(new i.Plane).setFromNormalAndCoplanarPoint(a.default.getVzFromMatrix(this._keyValues.measurementExtremity1Frame),this._getMeasurementExtremity1());this._getMeasurementExtremity2();m=(new i.Plane).setFromNormalAndCoplanarPoint(a.default.getVzFromMatrix(this._keyValues.measurementExtremity2Frame),this._getMeasurementExtremity2());this._keyValues.measurementExtremity3=this._keyValues.measurementExtremity1.clone(),this._keyValues.measurementExtremity3Frame=this._keyValues.measurementExtremity1Frame.clone();var V=a.default.getVzFromMatrix(this._keyValues.measurementExtremity2Frame).normalize().dot(a.default.getVzFromMatrix(this._keyValues.measurementExtremity1Frame).normalize());if(Math.abs(V)>=.999)this._keyValues.measurementExtremity4=m.projectPoint(this._keyValues.measurementExtremity1),this._keyValues.measurementExtremity4Frame=this._keyValues.measurementExtremity2Frame.clone().setPosition(this._keyValues.measurementExtremity4),this._keyValues.measurementExtremity5=y.projectPoint(this._keyValues.measurementExtremity2),this._keyValues.measurementExtremity5Frame=this._keyValues.measurementExtremity1Frame.clone().setPosition(this._keyValues.measurementExtremity5),this._keyValues.measurementExtremity6=this._keyValues.measurementExtremity2.clone(),this._keyValues.measurementExtremity6Frame=this._keyValues.measurementExtremity2Frame.clone(),this._keyValues.value=Math.abs(y.distanceToPoint(this._keyValues.measurementExtremity2)),this._keyValues.angle=!1,"Length"!==r._Properties["Collab.Measurement.Value"].GetPropertyInfo().GetUnitType()&&r._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Length"),this._keyValues.measurementExtremity1=(new i.Vector3).addVectors(this._keyValues.measurementExtremity3,this._keyValues.measurementExtremity5).multiplyScalar(.5),this._keyValues.measurementExtremity1Frame.setPosition(this._keyValues.measurementExtremity1),this._keyValues.measurementExtremity2=(new i.Vector3).addVectors(this._keyValues.measurementExtremity4,this._keyValues.measurementExtremity6).multiplyScalar(.5),this._keyValues.measurementExtremity2Frame.setPosition(this._keyValues.measurementExtremity2);else{this._keyValues.angle=!0,this._keyValues.measurementAnglePoint2=this._keyValues.measurementExtremity2.clone(),"Angle"!==r._Properties["Collab.Measurement.Value"].GetPropertyInfo().GetUnitType()&&r._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Angle");var f,b=a.default.getVzFromMatrix(this._keyValues.measurementExtremity1Frame).normalize(),P=a.default.getVzFromMatrix(this._keyValues.measurementExtremity2Frame).normalize(),g=(u=(new i.Vector3).crossVectors(b,P).normalize(),(new i.Vector3).crossVectors(b,u).normalize()),_=(new i.Vector3).crossVectors(P,u).normalize();if((f=a.default.getNearestDistanceBetween2Lines(this._getMeasurementExtremity1(),g,this._getMeasurementExtremity2(),_)).p2){var M=f.p2,S=this._keyValues.measurementExtremity1.clone().add(f.p2).sub(f.p1),D=this._keyValues.measurementExtremity2.clone();let e=(new i.Vector3).subVectors(S,M),t=(new i.Vector3).subVectors(D,M);if(this.newLabel0Position){h=(new i.Plane).setFromNormalAndCoplanarPoint(u,M);this._keyValues.projectedPoint=h.projectPoint(this.newLabel0Position),this._keyValues.radius=this._keyValues.projectedPoint.distanceTo(M),this._keyValues.measurementAnglePoint1=h.projectPoint(this._keyValues.measurementExtremity1)}this._keyValues.measurementExtremity0=M.clone(),this._keyValues.measurementExtremity0Frame=a.default.getMatrixFromOVxVy(M,e,t),this._keyValues.measurementExtremity4=this._keyValues.measurementExtremity2.clone(),this._keyValues.measurementExtremity4Frame=this._keyValues.measurementExtremity2Frame.clone(),this._keyValues.measurementExtremity5=M.clone().add(e.clone().multiplyScalar(this._keyValues.radius)),this._keyValues.measurementExtremity5Frame=a.default.getMatrixFromOVxVz(M,e,a.default.getVzFromMatrix(this._keyValues.measurementExtremity1Frame)),this._keyValues.measurementExtremity6=M.clone().add(t.clone().multiplyScalar(this._keyValues.radius)),this._keyValues.measurementExtremity6Frame=a.default.getMatrixFromOVxVz(M,t,a.default.getVzFromMatrix(this._keyValues.measurementExtremity2Frame)),this._keyValues.value=e.angleTo(t),this._keyValues.measurementExtremity1=M.clone(),this._keyValues.measurementExtremity2=M.clone()}}}}}return this._keyValues.value}getReferential(){if(this._keyValues.referential)return this._keyValues.referential;var e=this.QueryInterface("VCXIModifiable");if(e)switch(e.GetPropertyValue("Collab.Measurement.Type")){case s.EType.LinePoint:case s.EType.BetweenLines:var t,r=e.GetAnchorWorldMatrix(0,null),o=a.default.getOFromMatrix(r),n=e.GetAnchorWorldMatrix(1,null),l=a.default.getOFromMatrix(n),p=(new i.Vector3).addVectors(l,o).multiplyScalar(.5);return(t=this.QueryInterface("W3AISGNodeHolder"))&&(this._keyValues.referential=t.getAnchorReferential()),this._keyValues.referential.setPosition(p),this._keyValues.referential;case s.EType.Angle:r=e.GetAnchorWorldMatrix(0,null),o=a.default.getOFromMatrix(r),n=e.GetAnchorWorldMatrix(1,null),l=a.default.getOFromMatrix(n);var u=e.GetAnchorWorldMatrix(2,null),h=a.default.getOFromMatrix(u),d=(new i.Vector3).subVectors(l,o),c=(new i.Vector3).subVectors(h,o);return d.lengthSq()<1e-4&&(d=new i.Vector3(1,0,0)),this._keyValues.referential=a.default.getMatrixFromOVxVy(o,d,c),this._keyValues.referential;case s.EType.PlanePoint:case s.EType.BetweenPlanes:case s.EType.BetweenPoints:r=e.GetAnchorWorldMatrix(0,null),o=a.default.getOFromMatrix(r),n=e.GetAnchorWorldMatrix(1,null),l=a.default.getOFromMatrix(n);var C=(new i.Vector3).subVectors(l,o);return C.lengthSq()<1e-4&&(C=new i.Vector3(1,0,0)),this._keyValues.referential=a.default.getMatrixFromOVx(o,C),this._keyValues.referential}return(t=this.QueryInterface("W3AISGNodeHolder"))&&(this._keyValues.referential=t.getAnchorReferential()),this._keyValues.referential}postUpdate(e){super.postUpdate(e),this._keyValues={}}}return function(e){let t,i,r;!function(e){e[e.None=0]="None",e[e.Straightness=1]="Straightness",e[e.Flatness=2]="Flatness",e[e.Circularity=3]="Circularity",e[e.Cylindricity=4]="Cylindricity",e[e.LineProfile=5]="LineProfile",e[e.SurfaceProfile=6]="SurfaceProfile",e[e.Angularity=7]="Angularity",e[e.Perpendicularity=8]="Perpendicularity",e[e.Parallelism=9]="Parallelism",e[e.Position=10]="Position",e[e.Concentricity=11]="Concentricity",e[e.Symmetry=12]="Symmetry",e[e.CircularRunout=13]="CircularRunout",e[e.TotalRunout=14]="TotalRunout",e[e.ProjectedToleranceZone=15]="ProjectedToleranceZone",e[e.MaxMaterialCondition=16]="MaxMaterialCondition",e[e.MinMaterialCondition=17]="MinMaterialCondition",e[e.FreeStateVariations=18]="FreeStateVariations",e[e.Diameter=20]="Diameter",e[e.PlusMinus=21]="PlusMinus",e[e.Plus=22]="Plus",e[e.Minus=23]="Minus",e[e.Equal=24]="Equal",e[e.ToBeDefined=25]="ToBeDefined"}(t=e.ESymbol||(e.ESymbol={})),function(e){e[e.Simple=0]="Simple",e[e.Double=1]="Double"}(i=e.EAttachTypeMeasurement||(e.EAttachTypeMeasurement={})),function(e){e[e.Arc=110]="Arc",e[e.Angle=120]="Angle",e[e.Linear=130]="Linear",e[e.Diameter=140]="Diameter",e[e.GDT=150]="GDT",e[e.BetweenAxis=160]="BetweenAxis",e[e.BetweenCentres=170]="BetweenCentres",e[e.BetweenPlanes=180]="BetweenPlanes",e[e.PlanePoint=190]="PlanePoint",e[e.BetweenPoints=200]="BetweenPoints",e[e.Area=220]="Area",e[e.Volume=230]="Volume",e[e.PipeLength=240]="PipeLength",e[e.AreaMultiplePoints=250]="AreaMultiplePoints",e[e.VolumeMultiplePoints=260]="VolumeMultiplePoints",e[e.PipeLengthMultiplePoints=270]="PipeLengthMultiplePoints",e[e.BetweenLines=280]="BetweenLines",e[e.LinePoint=290]="LinePoint",e[e.Radius=300]="Radius",e[e.Coord=310]="Coord",e[e.Projected=320]="Projected"}(r=e.EType||(e.EType={}))}(s||(s={})),s.prototype.getDefaultName=function(){return"Measurement"},Object.defineProperty(s.prototype,"componentType",{enumerable:!0,get:function(){return"VCXMeasurement_Spec"}}),s.prototype.dressupGroupName="Measurements",s})),define("DS/VCXWebDressup/VCXMarkup/VCXMeasurementModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebDressup/VCXMarkup/VCXMeasurement_Spec","DS/VCXWebDressup/VCXMarkup/VCXMarkupModifiable","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","DS/VCXWebSystem/VCXMathTools","DS/VCXWebDressup/VCXPropertyValueUnitFormater","DS/VCXWebUnits/VCXUnitType","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueColor"],(function(e,t,i,r,a,o,s,n,l,p,u,h,d){"use strict";return i.extend({init:function(){this._bIsMeasurement=!0,this._parent()},Build:function(){this._parent();var e=this._generateMapChoiceFromEnumAndId(t.ESymbol,"Collab.Measurement.Symbol"),i=[{Name:"Collab.Measurement.DisplayValue",Type:u,DefaultValue:!0,GroupId:"Group.Measurement"},{Name:"Collab.Measurement.PreSymbol",Type:h,DefaultValue:t.ESymbol.None,GroupId:"Group.Measurement",MapChoice:e},{Name:"Collab.Measurement.PreString",Type:p,DefaultValue:"",GroupId:"Group.Measurement"},{Name:"Collab.Measurement.MiddleSymbol",Type:h,DefaultValue:t.ESymbol.None,GroupId:"Group.Measurement",MapChoice:e},{Name:"Collab.Measurement.MiddleString",Type:p,DefaultValue:"",GroupId:"Group.Measurement"},{Name:"Collab.Measurement.PostSymbol",Type:h,DefaultValue:t.ESymbol.None,GroupId:"Group.Measurement",MapChoice:e},{Name:"Collab.Measurement.PostString",Type:p,DefaultValue:"",GroupId:"Group.Measurement"},{Name:"Collab.Measurement.Attach.Type",Type:h,DefaultValue:t.EAttachTypeMeasurement.Double,GroupId:"Group.Attach",MapChoice:this._generateMapChoiceFromEnumAndId(t.EAttachTypeMeasurement,"Collab.Measurement.Attach.Type")},{Name:"Collab.Measurement.Value",Type:l,DefaultValue:0,GroupId:"Group.Measurement"},{Name:"Collab.Measurement.Length",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.Length1",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.Length2",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.Radius",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.Radius1",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.Radius2",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.Area",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Area",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.Volume",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Volume",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.ShowConstructionLines",Type:u,DefaultValue:!0,GroupId:"Group.Measurement"},{Name:"Collab.Measurement.ShowRedlines",Type:u,DefaultValue:!0,GroupId:"Group.Measurement"},{Name:"Collab.Measurement.ShowPlanes",Type:u,DefaultValue:!0,GroupId:"Group.Measurement"},{Name:"Collab.Measurement.ShowEndPoints",Type:u,DefaultValue:!0,GroupId:"Group.Measurement",visibleInPropertyGroups:!1},{Name:"Collab.3D.Paper.Billboard.Type",DefaultValue:2,FormatPainter:!0},{Name:"Collab.Text",DefaultValue:""},{Name:"Collab.Text.Color",DefaultValue:(new n).FromRGBA(1,1,1,1),FormatPainter:!0},{Name:"Collab.Background.Color",DefaultValue:(new n).FromRGBA(.0666666666666667,.596078431372549,.8980392156862745,1),FormatPainter:!0},{Name:"Collab.Body.Shape",DefaultValue:r.EBodyShape.RoundedRectangle,FormatPainter:!0},{Name:"Collab.3D.Paper.Referential.In.World",DefaultValue:!1},{Name:"Collab.Body.HAlignment",DefaultValue:r.EHAlignment.Center},{Name:"Collab.Body.VAlignment",DefaultValue:r.EVAlignment.Bottom},{Name:"Collab.3D.Paper.UsesBarycenter",DefaultValue:!1},{Name:"Collab.Body.InnerMargin",DefaultValue:1,FormatPainter:!0},{Name:"Collab.HideIfOutsideAnchorFrustrum",DefaultValue:!0},{Name:"Collab.Measurement.Plane.Color",Type:d,visibleInPropertyGroups:!1,DefaultValue:(new n).FromRGBA(.533,.533,.533)},{Name:"Collab.Measurement.Plane.Border.Color",Type:d,visibleInPropertyGroups:!1,DefaultValue:(new n).FromRGBA(0,0,0)},{Name:"Collab.Measurement.Additional.Color",Type:d,visibleInPropertyGroups:!1,DefaultValue:(new n).FromRGBA(0,0,0)},{Name:"Collab.Measurement.Additional.2.Color",Type:d,visibleInPropertyGroups:!1,DefaultValue:(new n).FromRGBA(.784,.392,0)},{Name:"Collab.Measurement.Type",Type:h,DefaultValue:t.EType.BetweenPoints,GroupId:"Group.Measurement",MapChoice:this._generateMapChoiceFromEnumAndId(t.EType,"Collab.Measurement.Type"),visibleInPropertyGroups:!0}];this._BuildPropertyValues(i),this.SetPropertyInvisible("Collab.HideIfOutsideAnchorFrustrum",!1),this.SetPropertyInvisible("Collab.Text",!0)},SetPropertiesInfo:function(){switch(this._parent(),this.GetPropertyValue("Collab.Measurement.Type")){case t.EType.BetweenPlanes:case t.EType.PlanePoint:this.SetPropertyInvisible("Collab.Measurement.ShowPlanes",!1),this.SetPropertyInvisible("Collab.Measurement.ShowConstructionLines",!1),this.SetPropertyInvisible("Collab.Measurement.ShowRedlines",!1);break;case t.EType.Arc:case t.EType.Angle:case t.EType.Volume:case t.EType.Area:case t.EType.AreaMultiplePoints:case t.EType.VolumeMultiplePoints:case t.EType.Coord:this.SetPropertyInvisible("Collab.Measurement.ShowPlanes",!0),this.SetPropertyInvisible("Collab.Measurement.ShowConstructionLines",!0),this.SetPropertyInvisible("Collab.Measurement.ShowRedlines",!0);break;case t.EType.BetweenPoints:this.SetPropertyInvisible("Collab.Measurement.ShowPlanes",!0),this.SetPropertyInvisible("Collab.Measurement.ShowConstructionLines",!1),this.SetPropertyInvisible("Collab.Measurement.ShowRedlines",!0);break;default:this.SetPropertyInvisible("Collab.Measurement.ShowConstructionLines",!1),this.SetPropertyInvisible("Collab.Measurement.ShowRedlines",!1),this.SetPropertyInvisible("Collab.Measurement.ShowPlanes",!0)}this.SetPropertyInvisible("Collab.Measurement.Type",!0),this.SetPropertyInvisible("Collab.Measurement.Length",!0),this.SetPropertyInvisible("Collab.Measurement.Length1",!0),this.SetPropertyInvisible("Collab.Measurement.Length2",!0),this.SetPropertyInvisible("Collab.Measurement.Radius",!0),this.SetPropertyInvisible("Collab.Measurement.Radius1",!0),this.SetPropertyInvisible("Collab.Measurement.Radius2",!0),this.SetPropertyInvisible("Collab.Measurement.Area",!0),this.SetPropertyInvisible("Collab.Measurement.Volume",!0),this.SetPropertyInvisible("Collab.Body.KeepAspectRatio",!0),this.ChangeGroupAvailability("Group.Paragraph",e.EAvailability.AppForceNotAvailable)},OnChangeProperty:function(e,t,i,r){"Collab.Measurement.Type"===e&&(this.GetObject()._keyValues={}),this._parent(e,t,i,r)},GetProperty:function(e){if("Collab.Measurement.Value"===e){if(this._Properties["Collab.Measurement.Value"])switch(this.GetPropertyValue("Collab.Measurement.Type")){case t.EType.Angle:this._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Angle");break;case t.EType.AreaMultiplePoints:case t.EType.Area:this._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Area");break;case t.EType.VolumeMultiplePoints:case t.EType.Volume:this._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Volume");break;case t.EType.BetweenPlanes:case t.EType.BetweenLines:break;default:this._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Length")}var i=this.GetObject().getValue();return this.GetNewProperty(e,i)}return this._parent(e)},GetComputedStringProperty:function(e,i){if(this.GetPropertyValue("Collab.Measurement.Type")===t.EType.Coord){var r=this.ExperienceBase.getManager("VCXUnitManager"),n=this.GetAnchorWorldMatrix(0,null),l=a.getOFromMatrix(n),p="",u=r.getUnitType("Length"),h=u.SymbolDisplay;return u.SymbolDisplay=s.ESymbolDisplay.None,p+="x = "+u.getString(l.x)+"\n",p+="y = "+u.getString(l.y)+"\n",p+="z = "+u.getString(l.z),u.SymbolDisplay=h,p}p="";return p+=o.format(this.GetProperty("Collab.Measurement.PreSymbol"),this.ExperienceBase),(p+=this.GetPropertyValue("Collab.Measurement.PreString")).length>0&&(p+=" "),this.GetPropertyValue("Collab.Measurement.DisplayValue")&&(p+=o.format(this.GetProperty("Collab.Measurement.Value"),this.ExperienceBase)),p+=o.format(this.GetProperty("Collab.Measurement.MiddleSymbol"),this.ExperienceBase),p+=this.GetPropertyValue("Collab.Measurement.MiddleString"),p+=o.format(this.GetProperty("Collab.Measurement.PostSymbol"),this.ExperienceBase),p+=this.GetPropertyValue("Collab.Measurement.PostString")}})})),define("DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationManager",["UWA/Class","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools","DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapePerimetric","DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeCircle","DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeRectangle","DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeBottom","DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeBottomAndLeft","DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeBottomAndRight","DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeBottomAndTop","DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeTop","DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeTopAndLeft","DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeTopAndRight","DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeLeft","DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeLeftAndRight","DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationShapeRight","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXColor","DS/VCXWebVisibility/VCXIVisibility"],(function(e,t,i,r,a,o,s,n,l,p,u,h,d,c,C,y,m,V,f,b,P){"use strict";var g=e.extend({setExperienceBase:function(e){this._experienceBase=e},_checkIfCellFree:function(e,t,i,r){for(var a=t-r-1;a<t+r;a++)for(var o=i-r-1;o<i+r;o++){if(!(o>0&&o<e.height&&a>0&&a<e.width))return!1;var s=(e.height-o)*e.width+a;if(s*=4,0!==e.data[s+0]||0!==e.data[s+1]||0!==e.data[s+2]||255!==e.data[s+3])return!1}return!0},_flagCellBusy:function(e,t,i,r){for(var a=t-r-1;a<t+r;a++)for(var o=i-r-1;o<i+r;o++)if(o>0&&o<e.height&&a>0&&a<e.width){var s=(e.height-o)*e.width+a;s*=4,e.data[s+0]=1,e.data[s+1]=1,e.data[s+2]=1,e.data[s+3]=1}},_findFirstCellCandidatePerimetric:function(e,t){for(var i=this._experienceBase.getManager("VCXPaperManager").Size,r=Math.floor(t.leadGridPositionInMM.x*e.width/i.x),a=Math.floor(t.leadGridPositionInMM.y*e.height/i.y),o=0,s=0,n=1;n<Math.max(e.width,e.height);n++){for(o=Math.max(0,r-n);o<Math.min(e.width,r+n);o++){s=Math.max(0,a-n);if(this._checkIfCellFree(e,o,s))return{col:o,row:s};if(s=Math.min(e.height,a+n),this._checkIfCellFree(e,o,s))return{col:o,row:s}}for(s=Math.max(0,a-n-1);s<Math.min(e.height,a+n-1);s++){o=Math.max(0,r-n);if(this._checkIfCellFree(e,o,s))return{col:o,row:s};if(o=Math.min(e.width,r+n),this._checkIfCellFree(e,o,s))return{col:o,row:s}}}},autoAlignDressups:function(e,V){if(this._dressupsToAlign=V,this._dressupsToAlign&&0!==this._dressupsToAlign.length){var f=this._experienceBase.getManager("VCXVisuManager"),b=this._experienceBase.getManager("VCXPaperManager"),g=b.Size,_=Math.round(256/g.x*g.y),M=f.getOccupationGrid(256,_,e.viewer);for(var S in this.organisationShapes||(this.organisationShapes={}),this.organisationShapes)this.organisationShapes.hasOwnProperty(S)&&(this.organisationShapes[S]._dressups=[],this.organisationShapes[S].rewind());if(M){const V=this._experienceBase.getManager("VCXContextManager").getActivePartList();if(V){var D=V.QueryInterface("VCXIVisibility");if(D&&D.GetVisibility()!==P.EVisState.Hidden){var G=V.QueryInterface("VCXIModifiable");if(G.GetPropertyValue("Actor.Opacity"))for(var x=G.GetPropertyValue("Collab.3D.Paper.Paper.Position.X"),X=G.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y"),v=G.GetPropertyValue("Collab.Body.Width"),A=G.GetPropertyValue("Collab.Body.Height"),I=Math.floor(x*M.width/g.x),w=Math.ceil((x+v)*M.width/g.x),T=Math.floor(X*M.height/g.y),N=Math.ceil((X+A)*M.height/g.y),B=I;B<=w;B++)for(var E=T;E<=N;E++){var L=(M.height-E)*M.width+B;L*=4,M.data[L+0]=1,M.data[L+1]=1,M.data[L+2]=1,M.data[L+3]=1}}}for(var O,W=0;W<this._dressupsToAlign.length;W++){var R=this._dressupsToAlign[W];R.leadAutoPosLock=!1,R.textAutoPosLock=!1;const V=R.QueryInterface("W3AISGNodeHolder"),f=V&&V.giveSGNode();var F=f&&f.GetShapeInfo()&&f.GetShapeInfo().size&&f.GetShapeInfo().size.x||1;F/b.Size.x<.001&&(F=.01*b.Size.x);var k=R.QueryInterface("VCXIModifiable"),H=k.GetPropertyValue("Collab.3D.Paper.Positioning.Type");if(!(O=this.organisationShapes[H])){switch(H){case t.EPositionType.Perimetric:O=new a(g);break;case t.EPositionType.Circle:O=new o(g);break;case t.EPositionType.Rectangle:O=new s(g);break;case t.EPositionType.Bottom:O=new n(g);break;case t.EPositionType.BottomAndLeft:O=new l(g);break;case t.EPositionType.BottomAndRight:O=new p(g);break;case t.EPositionType.BottomAndTop:O=new u(g);break;case t.EPositionType.Top:O=new h(g);break;case t.EPositionType.TopAndLeft:O=new d(g);break;case t.EPositionType.TopAndRight:O=new c(g);break;case t.EPositionType.Left:O=new C(g);break;case t.EPositionType.LeftAndRight:O=new y(g);break;case t.EPositionType.Right:O=new m(g)}this.organisationShapes[H]=O,O&&(O.fCellSize=1.5*F,O.rewind())}if(O&&(O.fCellSize=1.5*F,H===t.EPositionType.Perimetric&&O.rewind(),O._dressups||(O._dressups=[]),O._dressups.push(R)),k.processAnchorsIDs((t=>{if("Location"!==t){var a=r.getOFromMatrix(k.GetAnchorWorldMatrix(t,e)),o=b.ModelToMM2(e,a);R.leadGridPositionInMM=new i.Vector2(o.x,o.y);var s=Math.floor(R.leadGridPositionInMM.x*M.width/g.x),n=Math.floor(R.leadGridPositionInMM.y*M.height/g.y),l=(M.height-n)*M.width+s;l*=4,M.data[l+0]=1,M.data[l+1]=1,M.data[l+2]=1,M.data[l+3]=1}})),O){for(var z,j=!1,U=!1;!j;){z=O.getPoint(R.leadGridPositionInMM);var Y=Math.floor(z.x*M.width/g.x),Q=Math.floor(z.y*M.height/g.y),q=Math.floor(.5*F*g.x/M.width);(j=U||this._checkIfCellFree(M,Y,Q,q))&&this._flagCellBusy(M,Y,Q,q),O.next()&&(U=!0)}R.textGridPositionInMM=z}}}for(var S in this.organisationShapes)this.organisationShapes.hasOwnProperty(S)&&(this.organisationShapes[S]&&0!==this.organisationShapes[S]._dressups.length||delete this.organisationShapes[S]);this._uncrossLinks(e)}},_locateCallout:function(e,t,i){var r=e.QueryInterface("W3AISGNodeHolder");if(r){var a=r.getSGNode();a&&a._Smart3DPaperNode&&(a._Smart3DPaperNode.Position2D=t,a.preRender(i))}var o=e.QueryInterface("VCXIModifiable");if(o){var s=!1;if(t.x!==o.GetPropertyValue("Collab.3D.Paper.Paper.Position.X")){s=!0;var n=new V(t.x);o.OnChangeProperty("Collab.3D.Paper.Paper.Position.X",n)}if(t.y!==o.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y")){s=!0;var l=new V(t.y);o.OnChangeProperty("Collab.3D.Paper.Paper.Position.Y",l)}s&&a.update(i)}},_uncrossLinks:function(e){for(var t in this.organisationShapes)if(this.organisationShapes.hasOwnProperty(t)){var i=this.organisationShapes[t],r=i._dressups.length;i._squareDistances&&i._squareDistances.length===r*r||(i._squareDistances=new Array(r*r));for(var a=0;a<r;a++){var o=i._dressups[a];o.leadSector=0,o.textSector=0;for(var s=0;s<r;s++){var n=i._dressups[s];if(n&&n.leadGridPositionInMM){n.leadSector=0,n.textSector=0;var l=a*r+s,p=n.leadGridPositionInMM.distanceToSquared(o.textGridPositionInMM);i._squareDistances[l]={textComponent:o,textSector:0,leadComponent:n,leadSector:0,squareDistance:p}}}}i._squareDistances.sort((function(e,t){return e.squareDistance-t.squareDistance})),this._splitSectorInto2Sectors(0,0,i,e)}},_splitSectorInto2Sectors:function(e,t,r,a){for(var o=0,s=0;s<e;s++)o|=1<<s;for(var n=r._squareDistances.length,l=new i.Vector2,p=new i.Vector2,u=!1,h=0;h<n&&!u;h++){var d=r._squareDistances[h];if(d&&!d.leadComponent.leadAutoPosLock&&!d.textComponent.textAutoPosLock&&t===(d.leadComponent.leadSector&o)&&t===(d.textComponent.textSector&o)){d.leadComponent.leadAutoPosLock=!0,d.textComponent.textAutoPosLock=!0,l.copy(d.leadComponent.leadGridPositionInMM).sub(d.textComponent.textGridPositionInMM);for(var c,C,y,m,V=0,f=0,b=0,P=1<<e,g=~P,_=r._dressups.length,M=0;M<_;M++){var S=r._dressups[M];S.leadAutoPosLock||t!==(S.leadSector&o)||(p.copy(S.leadGridPositionInMM).sub(d.textComponent.textGridPositionInMM),l.x*p.y>l.y*p.x?(V++,c=S,S.leadSector|=P):(b++,C=S,S.leadSector&=g)),S.textAutoPosLock||t!==(S.textSector&o)||(p.copy(S.textGridPositionInMM).sub(d.textComponent.textGridPositionInMM),l.x*p.y>l.y*p.x?(f++,y=S,S.textSector|=P):(m=S,S.textSector&=g))}V===f?(u=!0,this._locateCallout(d.leadComponent,d.textComponent.textGridPositionInMM,a),V>1?this._splitSectorInto2Sectors(e+1,t|P,r,a):1===V&&y&&c&&this._locateCallout(c,y.textGridPositionInMM,a),b>1?this._splitSectorInto2Sectors(e+1,t,r,a):1===b&&m&&C&&this._locateCallout(C,m.textGridPositionInMM,a)):(d.leadComponent.leadAutoPosLock=!1,d.textComponent.textAutoPosLock=!1,d=null)}}u||console.warn("No candidate found")}});return Object.defineProperty(g.prototype,"componentType",{enumerable:!0,get:function(){return"VCXDressupOrganisationManager"}}),g})),define("DS/VCXWebDressup/VCXDressupManager",["DS/CoreEvents/Events","UWA/Class","DS/VCXWebDressup/VCXDressupOrganisation/VCXDressupOrganisationManager","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebModifiables/VCXModelChangeListener","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","DS/VCXWebProperties/VCXPropertyValueString","DS/Mesh/MeshUtils","DS/VCXWebExperienceBase/VCXPathElementTools","DS/SceneGraphOverrides/SceneGraphOverrideSet","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup","DS/WebComponentModeler/WebComponentBase"],(function(e,t,i,r,a,o,s,n,l,p,u,h,d,c){"use strict";var C=t.extend({init:function(){this._DressupGrpsComponents=null,this._DressupGrpsDescription={}},initialize:function(){this._calloutMaxSize=new o.Vector2,this._DressupRoot=null,this._DressupComponents={},this._DressupVisibilityHasChanged=!0,this._autoAlignmentDirty=!1,this._viewerOverrideSet={},this._DressupComponentsToPreRender={},this._DressupSectionsToPreRender={},this._DressupComponentsToPostRender={},this.event_VCX_ROOT_COMPONENT_CREATED=e.subscribe({event:"VCX_ROOT_COMPONENT_CREATED"},function(){this.createDressupsBases()}.bind(this)),this.event_VCX_PROPERTIES_CHANGED=e.subscribe({event:"VCX_PROPERTIES_CHANGED"},function(){this.SetDirty()}.bind(this))},postInitialize:function(){if(this._currentWorkingRootMatrix=new o.Matrix4,this._experienceBase.getManager("VCXContextManager").loadCssFile("VCXWebDressup/VCXWebDressup.css",1),this._experienceBase.getManager("VCXContextManager").isSupported("ViewpointCamera")&&!this._experienceBase.ComponentsMap.GetComponentFromID("ViewpointID")){const e=this._experienceBase.Factory.BuildComponent("VCXViewpoint_Spec");this._experienceBase.ComponentsMap.AddComponent(e),e.SetID("ViewpointID"),e.SetPersistency(2)}if(this._experienceBase.getManager("VCXContextManager").isSupported("3DAlignerSupport")){let e=this._experienceBase.getManager("VCXVisuManager");e.load3DXMLModel("3DAligner_MagnetON",{module:"VCXWebAuthoringDressup",path:"models/VCX3DMagnetOn.3dxml",callBackCreation:e=>{let t=.03;var i=(new o.Matrix4).makeScale(t,t,t);i.multiply((new o.Matrix4).makeRotationY(Math.PI/2)),e.setMatrix(i),e.setVisibilityInTree(!1)}}),e.load3DXMLModel("3DAligner_MagnetOFF",{module:"VCXWebAuthoringDressup",path:"models/VCX3DMagnetOff.3dxml",callBackCreation:e=>{let t=.03;var i=(new o.Matrix4).makeScale(t,t,t);i.multiply((new o.Matrix4).makeRotationY(Math.PI/2)),e.setMatrix(i),e.setVisibilityInTree(!1)}})}},RegisterDressupGroup:function(e,t){this._DressupGrpsDescription[e.name]=e,t&&this.CreateDressupGroup(e.name)},CreateDressupGroup:function(t){const i=this._DressupGrpsDescription[t];i||console.warn("No Description of the group "+t+" is found");const r=this._experienceBase.Factory.BuildComponent("VCXComponentDressupGrp");if(r.SetID(t+"ID"),r.setName(t),r.SetPersistency(2),i){r.setNLSName(i.nlsName);const e=r.QueryInterface("VCXITreeNode");e&&(e.setOrder(i.order),e.setIconDescription(i.icon))}this._experienceBase.ComponentsMap.AddComponent(r),this._DressupGrpsComponents||(this._DressupGrpsComponents={}),this._DressupGrpsComponents[t]=r;var a=this.QueryInterface("VCXIModelNavigable"),o=r.QueryInterface("VCXIModelNavigable");return o&&a&&o.setParent(a),e.publish({event:"VCX_DRESSUP_GROUP_CREATED",data:r}),r},getDressupGroups:function(){return this._DressupGrpsComponents||(this._DressupGrpsComponents={},this._DressupGrpsComponents.Annotations=null,this._DressupGrpsComponents.Callouts=null,this._DressupGrpsComponents.Grids=null,this._DressupGrpsComponents.AssociativePaths=null,this._experienceBase.getManager("VCXContextManager").isSupported("CameraDisplay")&&(this._DressupGrpsComponents.Cameras=null),this._DressupGrpsComponents.Sections=null,this._DressupGrpsComponents.Diggers=null,this._DressupGrpsComponents.Markups=null,this._DressupGrpsComponents.Measurements=null,this._DressupGrpsComponents.Hotspots=null,this._DressupGrpsComponents.Panels=null,this._DressupGrpsComponents.MagnetLine=null,this._experienceBase.getManager("VCXContextManager").isSupported("PartList")&&(this._DressupGrpsComponents.PartList=null),this._experienceBase.getManager("VCXContextManager").isSupported("Paths")&&(this._DressupGrpsComponents.Paths=null),this._experienceBase.getManager("VCXContextManager").isSupported("EnvironmentDisplay")&&(this._DressupGrpsComponents.Environment=null),this._DressupGrpsComponents.Ambiences=null,this._experienceBase.getManager("VCXContextManager").isSupported("ViewpointCamera")&&(this._DressupGrpsComponents.ViewpointCamera=null)),this._DressupGrpsComponents},SetDirty:function(){this.needUpdate=2},getUpdatePriority:function(){return-5},getInitPhase:function(){return 4},unInitialize:function(){this._DressupOrganisationManager=null,e.unsubscribe(this.event_VCX_ROOT_COMPONENT_CREATED),this.event_VCX_ROOT_COMPONENT_CREATED=null,e.unsubscribe(this.event_VCX_PROPERTIES_CHANGED),this.event_VCX_PROPERTIES_CHANGED=null;var t=this._experienceBase.getManager("VCXContextManager");t.applyToViewers((function(e){delete e.dressupSGOS})),t.unloadCssFile("VCXWebDressup/VCXWebDressup.css",1),this.RemoveDressups(this._DressupComponents);let i=t.getMainViewer();this._DressupRoot&&(i&&i.removeNode(this._DressupRoot),this._DressupRoot=null);for(let e of Object.keys(this._viewerOverrideSet)){let t=this._experienceBase.getManager("VCXContextManager").getViewerById(e);t&&t.getSceneGraphOverrideSetManager().removeSceneGraphOverrideSet(this._viewerOverrideSet[e])}for(var r in this._viewerOverrideSet={},this._DressupComponents)this._DressupComponents[r].CallDispose();this._DressupComponents=null,this._DressupGrpsComponents=null,this._DressupComponentsToPreRender=null,this._DressupSectionsToPreRender=null,this._DressupComponentsToPostRender=null,this._automaticAlignmentDressups=null},CheckDressupIsAlignable:function(e){let t={modifiable:null,isAlignableValue:!1};if(e.IsKindOf("VCXMarkup_Spec")){const i=e.QueryInterface("VCXIVisibility");if(i&&i.GetVisibility()){const i=e.QueryInterface("VCXIModifiable");i&&i.GetPropertyValue("Collab.3D.Paper.Positioning.Type")===n.EPositionType.Free2D&&(t.modifiable=i,t.isAlignableValue=!0)}}return t},createDressupsBases:function(){var e=this.QueryInterface("W3AISGNodeHolder");this._DressupRoot=e.getSGNode();let t=this._experienceBase.getManager("VCXContextManager");if(t.getRootComponent()){var i=this._experienceBase.getManager("VCXContextManager").getRootComponent().QueryInterface("VCXIModelNavigable"),r=this.QueryInterface("VCXIModelNavigable");if(r)for(var a in r.setParent(i),this.getDressupGroups())if(this.getDressupGroups().hasOwnProperty(a)){if(this.getDressupGroups().dressupGrpType)continue;this.GetDressupGroup(a,!0)}}if(t.getMainViewer()){let e=t.getMainViewer().getContent();this.dressupsOverViewerDiv=new UWA.Element("div",{id:"divDressupsOverViewer",styles:{height:"100%",width:"100%",position:"absolute",top:"0px",left:"0px","pointer-events":"none"}}),this.dressupsOverViewerDiv.inject(e)}},getDressupsOverViewerDiv(){return this.dressupsOverViewerDiv},GetDepthInformation:function(){var e={highest:0,lowest:0};for(var t in this._DressupComponents)if(this._DressupComponents.hasOwnProperty(t)){var i=this._DressupComponents[t];if(i.IsKindOf("VCXMarkup_Spec")){var r=i.QueryInterface("VCXIModifiable");if(r){var a=r.GetPropertyValue("Collab.3D.Paper.Depth");e.highest<a&&(e.highest=a),e.lowest>a&&(e.lowest=a)}}}return e},getDressupDressupNodeOverride:function(e,t){var i=this.QueryInterface("W3AISGNodeHolder"),r=i.giveSGNode();if(!this._viewerOverrideSet[e.viewerID]){var a=e.getSceneGraphOverrideSetManager();this._viewerOverrideSet[e.viewerID]=new h(r),this._viewerOverrideSet[e.viewerID].name="DressupManagerOverrideSet",a.pushSceneGraphOverrideSet(this._viewerOverrideSet[e.viewerID])}var o=u.buildPathElement(i.getPathElement(),t);return this._viewerOverrideSet[e.viewerID].createOverride(o)},FindBestName:function(e,t,i){var r=this.GetDressupGroup(e,!1),a=d["DefaultComponentName."+t]||i&&i["DefaultComponentName."+t];if(a||(a="Dressup"),!r)return a;if(!r.highestValue){var o=r.QueryInterface("VCXIModelNavigable");r.highestValue=0;for(var s=o.getChildren(),n=s.length,l=0;l<n;++l){var p=s[l].QueryInterface("VCXIModifiable");if(p){var u=p.GetPropertyValue("Actor.Name"),h=RegExp(a+"_(\\d*)$"),c=u.match(h);c&&parseInt(c[1])>r.highestValue&&(r.highestValue=c[1])}}}return r.highestValue++,a+"_"+(r.highestValue+"").padStart(3,"0")},GetDressupGroup:function(e,t){e||console.warn("?? Check with ITY");let i=this.getDressupGroups()[e];return!i&&t&&(i=this.CreateDressupGroup(e)),i},AddDressups:function(t){for(var i=0;i<t.length;++i)this._addDressup(t[i]);0!==t.length&&e.publish({event:"VCX_DRESSUPS_ADDED",data:t})},_addDressup:function(e){var t=e.QueryInterface("VCXIModifiable");if(t){if(""===t.GetPropertyValue("Actor.Name")){var i=this.FindBestName(e.dressupGroupName,e.getDefaultName());t.OnChangeProperty("Actor.Name",new l(i))}var r=e.GetID();if(r){if(this._DressupComponents[r])return;this._DressupComponents[r]=e,e.preRender&&(e.IsKindOf("VCXSection_Spec")?this._DressupSectionsToPreRender[r]=e:this._DressupComponentsToPreRender[r]=e),e.postRender&&(this._DressupComponentsToPostRender[r]=e);var a=this.GetDressupGroup(e.dressupGroupName,!0).QueryInterface("VCXIModelNavigable"),o=e.QueryInterface("VCXIModelNavigable");o&&a&&o.setParent(a);var s=e.QueryInterface("W3AISGNodeHolder");if(s){var n=s.getSGNode();if(n){var p=e.QueryInterface("VCXIModelNavigable");if(p){var u=p.getParent().QueryInterface("W3AISGNodeHolder");u&&(n.getParents()&&0!==n.getParents().length||u.getSGNode().addChild(n),s._pathElement||(s._pathElement=u.getPathElement().clone(),s._pathElement.addElement(n)),this._experienceBase.ComponentsMap.addToHashTree(e))}n.setVisibility(!0)}}}}},RemoveDressups:function(t){if(t&&0!==Object.keys(t).length){for(var i in e.publish({event:"VCX_DRESSUPS_PREREMOVED",data:t}),t)t.hasOwnProperty(i)&&this._removeDressup(t[i]);for(i=0;i<t.length;++i){var r=t[i].GetID();delete this._DressupComponents[r],delete this._DressupComponentsToPreRender[r],delete this._DressupSectionsToPreRender[r],delete this._DressupComponentsToPostRender[r]}e.publish({event:"VCX_DRESSUPS_REMOVED",data:t})}},_removeDressup:function(e){var t;this.getDressupGroups()[e.dressupGroupName]&&(t=this.getDressupGroups()[e.dressupGroupName].QueryInterface("VCXIModelNavigable"))&&t.removeChild(e);var i=e.QueryInterface("W3AISGNodeHolder");if(i){var r=i.giveSGNode();if(r){r.setVisibility(!1);var a=r.getParents()[0];if(a){try{a.removeChild(r)}catch(e){console.warn(e)}0===a.getChildren().length&&a.setVisibilityInTree(!1)}}}},_deleteDressup:function(e){const t=this._experienceBase.getManager("VCXCAT3DXModelManager");return t&&e&&e.GetPersistency()===c.EPersistencyType.persistent&&e.QueryInterface("CATI3DExperienceObject")?t.DeleteActor(e):UWA.Promise.resolve(e.CallDispose())},DeleteDressups:function(e){if(this.RemoveDressups(e),!e||!e.length)return UWA.Promise.resolve();var t=[];return e.forEach((e=>{e.IsDressup&&t.push(this._deleteDressup(e))})),UWA.Promise.all(t)},RefreshVisuAfterDressupChange:function(){this.SetDirty(),this.UpdateDressupList();var e=this._experienceBase.getManager("VCXModelChangeListener");e&&(e.hasChanged(a.FChangeFlag.BomID,!0),e.hasChanged(a.FChangeFlag.Visibility,!0),e.hasChanged(a.FChangeFlag.DressupVisibility,!0)),this._experienceBase.getManager("VCXContextManager").renderAll()},changeDressupsPickability:function(e){for(var t in this._DressupComponents)if(this._DressupComponents.hasOwnProperty(t)){var i=this._DressupComponents[t];if(!i.IsPickerSensitive){var r=i.QueryInterface("W3AISGNodeHolder");r&&r.giveSGNode()&&r.giveSGNode().setPickable(e?p.PICKABLE:p.PICKTHROUGH)}}},getDressups:function(){return this._DressupComponents},getDressupsFromGroup:function(e){var t=[],i=this.GetDressupGroup(e,!1);if(i){var r=i.QueryInterface("VCXIModelNavigable");if(r)for(var a=r.getChildren(),o=a.length,s=0;s<o;++s)t.push(a[s].GetObject())}return t},GetDressupCount:function(){var e=0;for(var t in this._DressupComponents)this._DressupComponents.hasOwnProperty(t)&&e++;return e},shouldComponentBeDisplayedInTree:function(e){if(this._experienceBase)return e.IsKindOf("VCXWebComponentCamera")||e.IsKindOf("CXPCameraActor_Spec")||e.IsKindOf("VCXComponentDressupGrp")&&"Cameras"===e.getName()?this._experienceBase.getManager("VCXContextManager").isSupported("CameraDisplay"):e.IsKindOf("VCXViewport_Spec")||e.IsKindOf("VCXComponentDressupGrp")&&"Environment"===e.getName()?this._experienceBase.getManager("VCXContextManager").isSupported("EnvironmentDisplay"):e.IsKindOf("VCXComponentPath")||e.IsKindOf("VCXComponentDressupGrp")&&"Paths"===e.getName()?this._experienceBase.getManager("VCXContextManager").isSupported("Paths"):e.IsKindOf("VCXComponentDressupGrp")||e.IsKindOf("VCXDressup_Spec")},update:function(e){this._parent(e);const t=this._experienceBase.getManager("VCXVisuManager"),r=this.QueryInterface("W3AISGNodeHolder");if(r&&r.getSGNode()){const e=r.getSGNode();t.getNonVisibleSpaceState()?e.setVisibility(!1):e.setVisibility(!0)}const a=this._experienceBase.getManager("VCXContextManager");if(a){e.viewer||(e.viewer=a.getMainViewer());var o=this.QueryInterface("VCXIModelNavigable").getWorkingRoot();if(o){var l=o.QueryInterface("W3AISGNodeHolder");if(l){var p=l.getWorldMatrix(a.getMainViewer());p&&!s.IsMat1EqualsToMat2(p,this._currentWorkingRootMatrix)&&(this._currentWorkingRootMatrix=p.clone(),this.SetDirty())}}if(a.partHasMoved&&(this.groundDirty=2,this.needUpdate=2),this.groundDirty>0){if(1===this.groundDirty){var u=-1,h=a.getActiveGround();if(h){var d=h.QueryInterface("VCXIModifiable");d&&!d.GetPropertyValue("Environment.Ground.Diameter.Auto")&&(u=d.GetPropertyValue("Environment.Ground.Diameter")/2),t.updateGroundPosition({radius:u})}else if(a.getActiveViewport()){var c=a.getActiveViewport().getActiveAmbienceID(),C=c&&this._experienceBase.ComponentsMap.GetComponentFromID(c);C?C.setDirty(!0):t.updateGroundPosition({radius:-1})}}this.groundDirty--}for(var y in t.HasViewpointMoved||/*!this._RenderInProcess &&*/this._automaticAlignmentDressups&&this._automaticAlignmentDressups.length&&(this._DressupOrganisationManager||(this._DressupOrganisationManager=new i,this._DressupOrganisationManager.setExperienceBase(this._experienceBase)),this._DressupOrganisationManager.autoAlignDressups(e,this._automaticAlignmentDressups)),this.needUpdate||=t.HasViewpointMoved,this._dressupsHaveBeenAligned=!1,this._automaticAlignmentDressups=[],this._DressupComponents)if(this._DressupComponents.hasOwnProperty(y)){const i=this._DressupComponents[y],r=i.QueryInterface("VCXIDressup");if(this.needUpdate>0||r.isDressupPropertiesChangeIndependent()){const a=i.QueryInterface("VCXIModifiable"),o=a&&a.GetOpacity(e);o&&a.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<n.EPositionType.EndOfAutomaticPositionning&&a.GetViewpointVisibility(e)&&this._automaticAlignmentDressups.push(i);var m=i.isDirty();if(!m&&o&&(r.isAnchorDependent()&&r.hasPointedObjectMoved(e)||r.isViewPointDependent()&&t.HasViewpointMoved)&&(m=!0),(m||e&&e.force)&&i.update)try{i.update(e)}catch(e){if(this._experienceBase.odt)throw e;console.warn(e)}}}}},postUpdate:function(e){this._parent(e);const t=this._experienceBase.getManager("VCXContextManager");if(!t)return;e.viewer||(e.viewer=t.getMainViewer());let i=0,r=0;for(var a in this._DressupComponents)if(this._DressupComponents.hasOwnProperty(a)){var o=this._DressupComponents[a];if(o.postUpdate)try{o.postUpdate(e)}catch(e){console.warn(e)}const t=o.QueryInterface("VCXIModifiable");if(t&&t.GetOpacity(e)&&t.GetPropertyValue("Collab.Body.ContributeToEqualSize")){const e=o.QueryInterface("W3AISGNodeHolder"),t=e&&e.getSGNode(),a=t&&t.GetShapeInfo&&t.GetShapeInfo();a&&(i=Math.max(i,a.sizeBeforeEqualization?a.sizeBeforeEqualization.x:4),r=Math.max(i,a.sizeBeforeEqualization?a.sizeBeforeEqualization.y:4))}}this._calloutMaxSize.x!==i&&(this._calloutMaxSize.x=i,this.SetDirty()),this._calloutMaxSize.y!==r&&(this._calloutMaxSize.y=r,this.SetDirty()),this.needUpdate&&this.needUpdate--,this._DressupVisibilityHasChanged=!1},preRender:function(e){if(this._parent(e),this._preRenderDone=!1,!e.onlyPostProcess){var t=this._experienceBase.getManager("VCXContextManager");for(var i in t.getMainViewer(),e.viewer,t.applyToViewers((function(e){e.lockRenderIteration&&e.lockRenderIteration()})),this._DressupSectionsToPreRender)if(this._DressupSectionsToPreRender.hasOwnProperty(i)){if((o=(a=this._DressupSectionsToPreRender[i]).QueryInterface("VCXIVisibility"))&&o.GetVisibility()===r.EVisState.Hidden)continue;if(a.preRender)try{a.preRender(e)}catch(e){console.warn(e)}}for(var i in this._DressupComponentsToPreRender)if(this._DressupComponentsToPreRender.hasOwnProperty(i)){var a,o;if((o=(a=this._DressupComponentsToPreRender[i]).QueryInterface("VCXIVisibility"))&&o.GetVisibility()===r.EVisState.Hidden)continue;if(a.preRender)try{a.preRender(e)}catch(e){console.warn(e)}}this._preRenderDone=!0,t.applyToViewers((function(e){e.unlockRenderIteration&&e.unlockRenderIteration()}))}},postRender:function(e){if(this._parent(e),this._preRenderDone)for(var t in this._DressupComponentsToPostRender)if(this._DressupComponentsToPostRender.hasOwnProperty(t)){var i=this._DressupComponentsToPostRender[t],a=i.QueryInterface("VCXIVisibility");if(a&&a.GetVisibility()!==r.EVisState.Hidden&&i.postRender)try{i.postRender(e)}catch(e){console.warn(e)}}},toggleVisiblityDressupGroup:function(e,t){"all"===e&&(e=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentDressupGrp").map((e=>e.GetID())));for(let i of e){let e=this._experienceBase.ComponentsMap.GetComponentFromID(i);if(e){let i=e.QueryInterface("W3AISGNodeHolder");if(i){let e=i.getSGNode();e&&e.setVisibility(t)}}}},overrideAlwaysOnTop:function(e,t){e?this._overrideAlwaysOnTop=t:delete this._overrideAlwaysOnTop,this.SetDirty(),this.UpdateDressupList()},getOverrideAlwaysOnTop:function(){return this._overrideAlwaysOnTop},ChangeVisuProperties:function(e,t,i,r){},UpdateDressupList:function(){for(var e in this._DressupComponents)if(this._DressupComponents.hasOwnProperty(e)){var t=this._DressupComponents[e];if(t.update){var i={deltaTime:0,viewer:this._experienceBase.getManager("VCXContextManager").getMainViewer(),viewpoint:this._experienceBase.getManager("VCXContextManager").getMainViewer().currentViewpoint};try{t.update(i)}catch(e){console.warn(e)}}}},GetCalloutMaxSize:function(){return this._calloutMaxSize},changeDressupVisibility:function(){this._DressupVisibilityHasChanged=!0,this._autoAlignmentDirty=!0}});return Object.defineProperty(C.prototype,"componentType",{enumerable:!0,get:function(){return"VCXDressupManager"}}),C})),define("DS/VCXWebDressup/VCXMarkup/VCXMeasurementAttachesNode",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXMarkup/VCXAttachSegmentNode","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","DS/VCXWebDressup/VCXMarkup/VCXMeasurement_Spec","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXMarkup/VCXExtremityNode","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/VCXWebModifiables/VCXPropertiesObserver","DS/VCXWebSystem/VCXMathTools","DS/VCXWebProperties/VCXColor","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS"],(function(e,t,i,r,a,o,s,n,l,p,u,h,d){"use strict";return a.extend({init:function(e){return this._parent(e),this._PanelNode=e.panelNode,this._BentLineSize=2,this._MinAngleAllowed=5,this._AttachType=i.EAttachType.Line,this._AttachNodes={},this.additionalGeometryRebuildObserver=new n,this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Value"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Area"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Volume"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Type"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Radius"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Radius1"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Radius2"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Length"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.ShowConstructionLines"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.ShowEndPoints"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.ShowRedlines"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.ShowPlanes"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Length1"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Length2"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Plane.Color"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Plane.Border.Color"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Additional.Color"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Additional.2.Color"),this},_computePosBuffer:function(e,t,i){return e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=i.x,e[4]=i.y,e[5]=i.z,2},_getLineNode:function(){var t=[new d.Vector3,new d.Vector3],i=new Uint16Array([0,1]),r=this.GetPropertyValue("Collab.Attach.Line.Type"),a=this.GetColorPropertyValue("Collab.Attach.Line"),o=1;if(r!==e.ELineType.Plain){var s=1;0===s&&(s=1),o=1/s}var n={type:this.GetPropertyValue("Collab.Attach.Line.Type"),lineWidth:this.GetPropertyValue("Collab.Attach.Line.Width"),color:a.GetThreeColor(),opacity:a.a,scale:o};this._LineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(n,this._LineMaterial);var l={points:t,idx:i,editable:!0,drawMode:u.ConnectivityTypeEnum.LINES,material:this._LineMaterial};return h.createLineNode(l)},dispose:function(){this._attachMeasurementLabelLine1&&(this._attachMeasurementLabelLine1.dispose(),this._attachMeasurementLabelLine1=null),this._attachMeasurementLabelLine2&&(this._attachMeasurementLabelLine2.dispose(),this._attachMeasurementLabelLine2=null),this._attachMeasurementExtremity1&&(this._attachMeasurementExtremity1.dispose(),this._attachMeasurementExtremity1=null),this._attachMeasurementExtremity2&&(this._attachMeasurementExtremity2.dispose(),this._attachMeasurementExtremity2=null),this.additionalGeometryRebuildObserver=null,this._parent()},_ComputePosAttaches:function(e){var t=this.Modifiable.GetObject().getKeyPoints(e,this._PanelNode.GetShapeInfo().smartNode);this._PanelNode.GetShapeInfo().smartNode.BillboardXAxis=(new d.Vector3).subVectors(t.labelLineExtremity2,t.labelLineExtremity1);var r,a=(new d.Vector3).addVectors(t.labelLineExtremity1,t.labelLineExtremity2).multiplyScalar(.5);r=t.angle&&t.projectedPoint?t.projectedPoint:t.labelLineExtremity0;var o,s=(new d.Vector3).subVectors(r,t.labelLineExtremity1),n=(new d.Vector3).subVectors(r,t.labelLineExtremity2),p=s.dot(n)>0;if(this.extremityType=i.EExtremityType.FullArrow_1,t.labelLineExtremity0&&t.labelLineExtremity1&&t.measurementExtremity1){if(t.angle){this._attachMeasurementExtremity1._ArrowTail=!1;var c=t.labelLineExtremity0.distanceTo(t.labelLineExtremity1);this._attachMeasurementLabelLine1.StartExtremity=l.getVxFromMatrix(t.measurementExtremity0Frame).multiplyScalar(.1*c).add(t.labelLineExtremity1)}else this._attachMeasurementLabelLine1._ArrowTail=!0,this._attachMeasurementLabelLine1.StartExtremity=a;this._attachMeasurementLabelLine1.BreakExtremity=t.labelLineExtremity1,this._attachMeasurementLabelLine1.EndExtremity=t.measurementExtremity1,this._attachMeasurementLabelLine1.preRender(e),this._attachMeasurementExtremity1&&(this._attachMeasurementExtremity1.Type=this.extremityType,o=t.angle?l.getVyFromMatrix(t.measurementExtremity0Frame).negate():(new d.Vector3).subVectors(this._attachMeasurementLabelLine1.BreakExtremity,this._attachMeasurementLabelLine1.StartExtremity),p&&(this._attachMeasurementExtremity1.Type=this.extremityType+1,o.negate()),this._attachMeasurementExtremity1.SetReferential(l.getMatrixFromOVx(t.arrowLineExtremity1,o)),this._attachMeasurementExtremity1.preRender(e))}if(t.labelLineExtremity0&&t.labelLineExtremity2&&t.measurementExtremity2){if(t.angle){this._attachMeasurementExtremity2._ArrowTail=!1;c=t.labelLineExtremity0.distanceTo(t.labelLineExtremity2);this._attachMeasurementLabelLine2.StartExtremity=l.getVxFromMatrix(t.measurementExtremity0Frame).applyAxisAngle(l.getVzFromMatrix(t.measurementExtremity0Frame),Math.PI+t.value).multiplyScalar(-.1*c).add(t.labelLineExtremity2)}else this._attachMeasurementExtremity2._ArrowTail=!0,this._attachMeasurementLabelLine2.StartExtremity=a;this._attachMeasurementLabelLine2.BreakExtremity=t.labelLineExtremity2,this._attachMeasurementLabelLine2.EndExtremity=t.measurementExtremity2,this._attachMeasurementLabelLine2.preRender(e),this._attachMeasurementExtremity2&&(this._attachMeasurementExtremity2.Type=this.extremityType+1,o=t.angle?l.getVyFromMatrix(t.measurementExtremity0Frame).applyAxisAngle(l.getVzFromMatrix(t.measurementExtremity0Frame),t.value):(new d.Vector3).subVectors(this._attachMeasurementLabelLine2.BreakExtremity,this._attachMeasurementLabelLine2.StartExtremity),p&&(this._attachMeasurementExtremity2.Type=this.extremityType,o.negate()),this._attachMeasurementExtremity2.SetReferential(l.getMatrixFromOVx(t.arrowLineExtremity2,o)),this._attachMeasurementExtremity2.preRender(e))}if(this._lineNode){var C,y=this._lineNode.getBuffer(u.VertexComponentEnum.POSITION);if(y)C=t.angle&&t.projectedPoint?this._computePosBuffer(y,t.projectedPoint,t.labelLineExtremity0):p?t.labelLineExtremity0.distanceToSquared(t.labelLineExtremity1)<t.labelLineExtremity0.distanceToSquared(t.labelLineExtremity2)?this._computePosBuffer(y,t.labelLineExtremity1,t.labelLineExtremity0):this._computePosBuffer(y,t.labelLineExtremity2,t.labelLineExtremity0):this._computePosBuffer(y,t.labelLineExtremity0,t.labelLineExtremity0),this._lineNode.updateBuffer(u.VertexComponentEnum.POSITION,0,C),this._lineNode.computeBoundingElements()}if(this._additionalGeometryBasedOnAttach0&&t.measurementExtremity0Frame&&this._additionalGeometryBasedOnAttach0.setMatrix(t.measurementExtremity0Frame),this._additionalGeometryBasedOnAttach1&&t.measurementExtremity1Frame&&this._additionalGeometryBasedOnAttach1.setMatrix(t.measurementExtremity1Frame),this._additionalGeometryBasedOnAttach2&&t.measurementExtremity2Frame&&this._additionalGeometryBasedOnAttach2.setMatrix(t.measurementExtremity2Frame),this._additionalGeometryBasedOnAttach3&&t.measurementExtremity3Frame&&this._additionalGeometryBasedOnAttach3.setMatrix(t.measurementExtremity3Frame),this._additionalGeometryBasedOnAttach4&&t.measurementExtremity4Frame&&this._additionalGeometryBasedOnAttach4.setMatrix(t.measurementExtremity4Frame),t.angle){var m=0,V=t.value;if(t.projectedPoint){var f=(new d.Vector3).subVectors(t.projectedPoint,t.measurementExtremity0),b=(new d.Vector3).crossVectors(l.getVxFromMatrix(t.measurementExtremity0Frame),f),P=l.getVxFromMatrix(t.measurementExtremity0Frame).angleTo(f);l.getVzFromMatrix(t.measurementExtremity0Frame).dot(b)<0?(m=-P,V+=.05*Math.PI):P>V&&(V=P,m-=.05*Math.PI)}this._arcNode&&(this._additionalGeometryBasedOnAttach0.remove(this._arcNode),this._arcNode=null),this._arcNode=h.createCircleNode({radius:t.radius,startAngle:m,endAngle:V,material:this._attachMeasurementLabelLine1._lineMaterial}),this._additionalGeometryBasedOnAttach0.add(this._arcNode),this._geometryAdded=!0}return this._PanelNode.GetShapeInfo().smartNode.preRender(e),2},postUpdate:function(e){this._parent(e),this.additionalGeometryRebuildObserver&&this.additionalGeometryRebuildObserver.reset()},preRender:function(e){if(this._parent(e),this.viewpointVisibility&&this.GetOpacity(e)){this.setVisibility(!0);var t=this.ExperienceBase.getManager("VCXPaperManager");if(this._lineMaterial){this._lineMaterial.handleByPrerender=!0;let e=t.UnitValueToPixel(this.Modifiable.GetPropertyValue("Collab.Attach.Line.Width"));e>=1?(this._lineMaterial.setLineWidth(e),this._lineMaterial.visible=!0):this._lineMaterial.visible=!1}if(this._primaryAdditionalGeometryMaterial){this._primaryAdditionalGeometryMaterial.handleByPrerender=!0;let e=t.UnitValueToPixel(2);e>=1?(this._primaryAdditionalGeometryMaterial.setLineWidth(e),this._primaryAdditionalGeometryMaterial.visible=!0):this._primaryAdditionalGeometryMaterial.visible=!1}if(this._secondaryAdditionalGeometryMaterial){this._secondaryAdditionalGeometryMaterial.handleByPrerender=!0;let e=t.UnitValueToPixel(1);e>=1?(this._secondaryAdditionalGeometryMaterial.setLineWidth(e),this._secondaryAdditionalGeometryMaterial.visible=!0):this._secondaryAdditionalGeometryMaterial.visible=!1}if(this._thirdAdditionalGeometryMaterial){this._thirdAdditionalGeometryMaterial.handleByPrerender=!0;let e=t.UnitValueToPixel(1);e>=1?(this._thirdAdditionalGeometryMaterial.setLineWidth(e),this._thirdAdditionalGeometryMaterial.visible=!0):this._thirdAdditionalGeometryMaterial.visible=!1}if(this._fourthAdditionalGeometryMaterial){this._fourthAdditionalGeometryMaterial.handleByPrerender=!0;let e=t.UnitValueToPixel(1);e>=1?(this._fourthAdditionalGeometryMaterial.setLineWidth(e),this._fourthAdditionalGeometryMaterial.visible=!0):this._fourthAdditionalGeometryMaterial.visible=!1}this._ComputePosAttaches(e);for(var i=0;i<this._preRenderGeometries.length;i++)this._preRenderGeometries[i].preRender(e)}else this.setVisibility(!1)},getPlaneNode:function(e){var t=new d.MeshBasicMaterial({side:d.DoubleSide,opacity:.3,color:this.GetColorPropertyValue("Collab.Measurement.Plane").GetThreeColor(),force:!0});t.line=new d.LineBasicMaterial({side:d.DoubleSide,transparent:!1,color:this.GetColorPropertyValue("Collab.Measurement.Plane.Border").GetThreeColor(),opacity:1,force:!0,polygonBorderMode:!0,lineWidth:2});var i=h.createRectangleNode({width:1,height:1,fill:!0,material:t}),r=new a({name:"plane"});r.setMatrix((new d.Matrix4).setPosition(new d.Vector3(-.5,-.5,0))),r.add(i);var o=new s(e);return o.ModifiableProperties=!1,o.SizeControlType=1,o.ScalingFactor=10,o.add(r),o},update:function(s){this._parent(s);var n=this.GetOpacity(s),l=this.GetPropertyValue("Collab.Attach.LeadType");this._AttachType!==l&&(this._AttachType=l);this._AttachType!==i.ELeadType.None&&n>0&&(this._AxisSystemNode,this._AxisSystemNode&&this._AxisSystemNode.setMatrix(this.Modifiable.GetObject().getReferential()),this._attachMeasurementLabelLine1||(G={name:"AttachMeasurementLabelLine1",modifiable:this.Modifiable,endExtremityType:i.EExtremityType.Yellow},this._attachMeasurementLabelLine1=new t(G),this.add(this._attachMeasurementLabelLine1),this._geometryAdded=!0),this._attachMeasurementLabelLine2||(G={name:"AttachMeasurementLabelLine2",modifiable:this.Modifiable,endExtremityType:i.EExtremityType.Yellow},this._attachMeasurementLabelLine2=new t(G),this.add(this._attachMeasurementLabelLine2),this._geometryAdded=!0),this._lineNode||(this._lineNode=this._getLineNode(),this.add(this._lineNode),this._geometryAdded=!0),this._attachMeasurementExtremity1||(G={name:"AttachMeasurementExtremity1",modifiable:this.Modifiable,type:i.EExtremityType.Dot},this._attachMeasurementExtremity1=new o(G),this.add(this._attachMeasurementExtremity1),this._geometryAdded=!0),this._attachMeasurementExtremity2||(G={name:"AttachMeasurementExtremity2",modifiable:this.Modifiable,type:i.EExtremityType.Dot},this._attachMeasurementExtremity2=new o(G),this.add(this._attachMeasurementExtremity2),this._geometryAdded=!0));this.additionalGeometryRebuildObserver&&this.additionalGeometryRebuildObserver.update(),(this.additionalGeometryRebuildObserver&&this.additionalGeometryRebuildObserver.isDirty()||this.Modifiable.QueryInterface("VCXIDressup").hasPointedObjectMoved(s))&&(this._preRenderGeometries=[],this._additionalGeometryToUpdate&&(this.remove(this._additionalGeometryToUpdate),this._additionalGeometryToUpdate=null),this._additionalGeometryBasedOnAttach0&&(this.remove(this._additionalGeometryBasedOnAttach0),this._additionalGeometryBasedOnAttach0=null),this._additionalGeometryBasedOnAttach1&&(this.remove(this._additionalGeometryBasedOnAttach1),this._additionalGeometryBasedOnAttach1=null),this._additionalGeometryBasedOnAttach2&&(this.remove(this._additionalGeometryBasedOnAttach2),this._additionalGeometryBasedOnAttach2=null),this._additionalGeometryBasedOnAttach3&&(this.remove(this._additionalGeometryBasedOnAttach3),this._additionalGeometryBasedOnAttach3=null),this._additionalGeometryBasedOnAttach4&&(this.remove(this._additionalGeometryBasedOnAttach4),this._additionalGeometryBasedOnAttach4=null),this._primaryAdditionalGeometryMaterial&&(this.remove(this._primaryAdditionalGeometryMaterial),this._primaryAdditionalGeometryMaterial=null),this._secondaryAdditionalGeometryMaterial&&(this.remove(this._secondaryAdditionalGeometryMaterial),this._secondaryAdditionalGeometryMaterial=null),this._thirdAdditionalGeometryMaterial&&(this.remove(this._thirdAdditionalGeometryMaterial),this._thirdAdditionalGeometryMaterial=null),this._fourthAdditionalGeometryMaterial&&(this.remove(this._fourthAdditionalGeometryMaterial),this._fourthAdditionalGeometryMaterial=null));var u=this.ExperienceBase.getManager("VCXMaterialManager");if(!this._primaryAdditionalGeometryMaterial){var c={type:e.ELineType.Plain,lineWidth:3,color:(new p).SetRGB(255,0,0).GetThreeColor(),opacity:n};this._primaryAdditionalGeometryMaterial=u.getLineMaterialFromParams(c)}if(!this._secondaryAdditionalGeometryMaterial){var C={type:e.ELineType.Dot,lineWidth:1,color:this.GetColorPropertyValue("Collab.Measurement.Additional").GetThreeColor(),opacity:n};this._secondaryAdditionalGeometryMaterial=u.getLineMaterialFromParams(C)}if(!this._thirdAdditionalGeometryMaterial){var y={type:e.ELineType.Plain,lineWidth:1,color:this.GetColorPropertyValue("Collab.Measurement.Additional.2").GetThreeColor(),opacity:n};this._thirdAdditionalGeometryMaterial=u.getLineMaterialFromParams(y)}if(!this._fourthAdditionalGeometryMaterial){var m={type:e.ELineType.Dot,lineWidth:1,color:(new p).SetRGB(255,0,0).GetThreeColor(),opacity:n};this._fourthAdditionalGeometryMaterial=u.getLineMaterialFromParams(m)}this._PanelNode.GetShapeInfo().smartNode.update(s),this._PanelNode.GetShapeInfo().smartNode.preRender(s);var V,f,b,P,g=this.Modifiable.GetObject().getKeyPoints(s,this._PanelNode.GetShapeInfo().smartNode);if(g.angle&&this.GetPropertyValue("Collab.Measurement.Type")===r.EType.BetweenLines){var _=(new d.Matrix4).getInverse(this._PanelNode.GetShapeInfo().smartNode.GetReferential(s));this._PanelNode.GetShapeInfo().smartNode.Position=g.projectedPoint.clone().applyMatrix4(_)}if(!this._additionalGeometryToUpdate){if(this._additionalGeometryToUpdate=new a({name:"additionalGeometryA"}),this.add(this._additionalGeometryToUpdate),this._geometryAdded=!0,this.GetPropertyValue("Collab.Measurement.ShowConstructionLines"))switch(this.GetPropertyValue("Collab.Measurement.Type")){case r.EType.BetweenCentres:case r.EType.BetweenPoints:case r.EType.LinePoint:case r.EType.BetweenLines:case r.EType.PlanePoint:case r.EType.BetweenPlanes:if(!g.angle){var M=h.createLineNode({points:[g.measurementExtremity1,g.measurementExtremity2],material:this._secondaryAdditionalGeometryMaterial});this._additionalGeometryToUpdate.add(M)}}if(g.angle&&this.GetPropertyValue("Collab.Measurement.ShowEndPoints")){var S;if(g.measurementAnglePoint1)G={name:"MeasurementAnglePoint1",modifiable:this.Modifiable,type:this.GetPropertyValue("Collab.Attach.ExtremityType.Additionnal")},(S=new o(G)).SetReferential((new d.Matrix4).setPosition(g.measurementAnglePoint1)),this._additionalGeometryToUpdate.add(S),this._preRenderGeometries.push(S);if(g.measurementAnglePoint2)G={name:"MeasurementAnglePoint2",modifiable:this.Modifiable,type:this.GetPropertyValue("Collab.Attach.ExtremityType.Additionnal")},(S=new o(G)).SetReferential((new d.Matrix4).setPosition(g.measurementAnglePoint2)),this._additionalGeometryToUpdate.add(S),this._preRenderGeometries.push(S)}switch(this.GetPropertyValue("Collab.Measurement.Type")){case r.EType.BetweenLines:M=h.createLineNode({points:[g.measurementExtremity2,g.measurementExtremity4],material:this._fourthAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(M),this._geometryAdded=!0;break;case r.EType.LinePoint:M=h.createLineNode({points:[g.measurementExtremity1,g.measurementExtremity3],material:this._fourthAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(M),this._geometryAdded=!0;break;case r.EType.PlanePoint:case r.EType.BetweenPlanes:if(this.GetPropertyValue("Collab.Measurement.ShowPlanes")){this._geometryAdded=!0;var D,G={name:"planeSmartNode",modifiable:this.Modifiable,type:this._type};if(g.measurementExtremity3Frame)G.name="planeSmartNode1",(D=this.getPlaneNode(G)).SetReferential(g.measurementExtremity3Frame),this._preRenderGeometries.push(D),this._additionalGeometryToUpdate.add(D);if(g.angle){if(g.measurementExtremity4Frame)G.name="planeSmartNode2",(D=this.getPlaneNode(G)).SetReferential(g.measurementExtremity4Frame),this._preRenderGeometries.push(D),this._additionalGeometryToUpdate.add(D)}else if(g.measurementExtremity6Frame)G.name="planeSmartNode2",(D=this.getPlaneNode(G)).SetReferential(g.measurementExtremity6Frame),this._preRenderGeometries.push(D),this._additionalGeometryToUpdate.add(D)}this.GetPropertyValue("Collab.Measurement.ShowConstructionLines")&&(!g.angle&&g.measurementExtremity4&&(M=h.createLineNode({points:[g.measurementExtremity4,g.measurementExtremity3],material:this._secondaryAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(M)),!g.angle&&g.measurementExtremity6&&(M=h.createLineNode({points:[g.measurementExtremity6,g.measurementExtremity5],material:this._secondaryAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(M)),g.angle&&(M=h.createLineNode({points:[g.measurementExtremity1,g.measurementExtremity3],material:this._secondaryAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(M))),!g.angle&&this.GetPropertyValue("Collab.Measurement.ShowRedlines")&&(M=h.createLineNode({points:[g.measurementExtremity1,g.measurementExtremity3],material:this._thirdAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(M),M=h.createLineNode({points:[g.measurementExtremity2,g.measurementExtremity4],material:this._thirdAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(M),g.measurementExtremity5&&(M=h.createLineNode({points:[g.measurementExtremity1,g.measurementExtremity5],material:this._thirdAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(M)),g.measurementExtremity6&&(M=h.createLineNode({points:[g.measurementExtremity2,g.measurementExtremity6],material:this._thirdAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(M)))}}if(!this._additionalGeometryBasedOnAttach0)switch(this._additionalGeometryBasedOnAttach0=new a({name:"additionalGeometryB"}),this.add(this._additionalGeometryBasedOnAttach0),this._geometryAdded=!0,this.GetPropertyValue("Collab.Measurement.Type")){case r.EType.Radius:case r.EType.Diameter:V=this.GetPropertyValue("Collab.Measurement.Radius"),this.GetPropertyValue("Collab.Measurement.Type")===r.EType.Diameter&&(V*=.5),this.GetPropertyValue("Collab.Measurement.ShowRedlines")&&(f=h.createCircleNode({radius:V,material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach0.add(f),b=h.createLineNode({points:[new d.Vector3(.2*-V,.2*-V,0),new d.Vector3(.2*V,.2*V,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach0.add(b),P=h.createLineNode({points:[new d.Vector3(.2*-V,.2*V,0),new d.Vector3(.2*V,.2*-V,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach0.add(P))}if(!this._additionalGeometryBasedOnAttach1)switch(this._additionalGeometryBasedOnAttach1=new a({name:"additionalGeometryB1"}),this.add(this._additionalGeometryBasedOnAttach1),this._geometryAdded=!0,this.GetPropertyValue("Collab.Measurement.Type")){case r.EType.LinePoint:case r.EType.BetweenLines:this.GetPropertyValue("Collab.Measurement.ShowRedlines")&&(M=h.createLineNode({points:[new d.Vector3(0,0,0),new d.Vector3(this.GetPropertyValue("Collab.Measurement.Length1"),0,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach1.add(M));break;case r.EType.Linear:this.GetPropertyValue("Collab.Measurement.ShowRedlines")&&(M=h.createLineNode({points:[new d.Vector3(0,0,0),new d.Vector3(g.value,0,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach1.add(M));break;case r.EType.BetweenCentres:V=this.GetPropertyValue("Collab.Measurement.Radius1"),this.GetPropertyValue("Collab.Measurement.ShowRedlines")&&(f=h.createCircleNode({radius:V,material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach1.add(f),b=h.createLineNode({points:[new d.Vector3(.2*-V,.2*-V,0),new d.Vector3(.2*V,.2*V,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach1.add(b),P=h.createLineNode({points:[new d.Vector3(.2*-V,.2*V,0),new d.Vector3(.2*V,.2*-V,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach1.add(P));break;case r.EType.Radius:case r.EType.Diameter:this.GetPropertyValue("Collab.Measurement.ShowConstructionLines")&&(M=h.createLineNode({points:[new d.Vector3(0,0,0),new d.Vector3(g.value,0,0)],material:this._secondaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach1.add(M))}if(!this._additionalGeometryBasedOnAttach2)switch(this._additionalGeometryBasedOnAttach2=new a({name:"additionalGeometryB2"}),this.add(this._additionalGeometryBasedOnAttach2),this._geometryAdded=!0,this.GetPropertyValue("Collab.Measurement.Type")){case r.EType.BetweenLines:this.GetPropertyValue("Collab.Measurement.ShowRedlines")&&(M=h.createLineNode({points:[new d.Vector3(0,0,0),new d.Vector3(this.GetPropertyValue("Collab.Measurement.Length2"),0,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach2.add(M));break;case r.EType.BetweenCentres:V=this.GetPropertyValue("Collab.Measurement.Radius2"),this.GetPropertyValue("Collab.Measurement.ShowRedlines")&&(f=h.createCircleNode({radius:V,material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach2.add(f),b=h.createLineNode({points:[new d.Vector3(.2*-V,.2*-V,0),new d.Vector3(.2*V,.2*V,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach2.add(b),P=h.createLineNode({points:[new d.Vector3(.2*-V,.2*V,0),new d.Vector3(.2*V,.2*-V,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach2.add(P))}this._additionalGeometryBasedOnAttach3||(this._additionalGeometryBasedOnAttach3=new a({name:"additionalGeometryB3"}),this.add(this._additionalGeometryBasedOnAttach3),this._geometryAdded=!0,this.GetPropertyValue("Collab.Measurement.Type")),this._additionalGeometryBasedOnAttach4||(this._additionalGeometryBasedOnAttach4=new a({name:"additionalGeometryB4"}),this.add(this._additionalGeometryBasedOnAttach4),this._geometryAdded=!0,this.GetPropertyValue("Collab.Measurement.Type"));for(var x=0;x<this._preRenderGeometries.length;x++)this._preRenderGeometries[x].update(s);this.GetPropertyValue("Collab.Measurement.ShowEndPoints")?(this._attachMeasurementLabelLine1.EndExtremityType=i.EExtremityType.Yellow,this._attachMeasurementLabelLine2.EndExtremityType=i.EExtremityType.Yellow):(this._attachMeasurementLabelLine1.EndExtremityType=i.EExtremityType.None,this._attachMeasurementLabelLine2.EndExtremityType=i.EExtremityType.None),this._attachMeasurementLabelLine1.update(s),this._attachMeasurementLabelLine2.update(s),this._attachMeasurementExtremity1.update(s),this._attachMeasurementExtremity2.update(s);var X=this.Modifiable.getLineMaterialParams("Collab.Attach.Line",this._LineMaterial,this._lastFrontLineType,n);Object.keys(X).length>0&&("number"==typeof X.type&&X.type!==this._lastFrontLineType&&(this._lastFrontLineType=X.type),this._LineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(X,this._LineMaterial)),this._primaryAdditionalGeometryMaterial.opacity=n,this._secondaryAdditionalGeometryMaterial.opacity=n,this._thirdAdditionalGeometryMaterial.opacity=n,this._fourthAdditionalGeometryMaterial.opacity=n,this.handleLayers(!1)}})})),define("DS/VCXWebDressup/VCXMarkup/VCXPanelNode",["DS/Mesh/MeshUtils","DS/SceneGraphNodes/CanvasNode","DS/SceneGraphNodes/CanvasNodeTexture","DS/VCXWebDressup/VCXMarkup/VCXAttachesNode","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXMarkup/VCXMeasurementAttachesNode","DS/VCXWebModifiables/VCXPropertiesObserver","DS/VCXWebDressup/VCXPropertyValueUnitFormater","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/VCXWebVisualization/VCXImageManager","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXTextTools","DS/VCXWebSystem/VCXHardwareServices","DS/VCXWebIO/VCXCanvasServices"],(function(e,t,i,r,a,o,s,n,l,p,u,h,d,c,C,y){"use strict";var m=.3527,V=o.extend({init:function(e){return this._parent(e),this._previousBackgroundDocID=null,this._CanvasNode=null,this._CanvasNodeTexture=null,this._HighlightCanvasNode=null,this._HighlightCanvasNodeTexture=null,this._Smart3DPaperNode=null,this._externalMargin=0,this._lineWidth=0,this._editingState=null,this._TextSize=new d.Vector2,this._currentText=null,this._analysedText=null,this._requestedFontRatio=1,this.visible=!1,this.FirstDrawDeferred=UWA.Promise.deferred(),this},_SetShadow:function(e,t,i){e.shadowColor="transparent",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,t&&this.GetPropertyGroupVisibility("Group.Shadow")&&(e.shadowColor="rgba(0, 0, 0, "+this.GetPropertyValue("Collab.Body.Shadow.Opacity")+")",e.shadowBlur=i*this.GetPropertyValue("Collab.Body.Shadow.Blur")/4,e.shadowOffsetX=i*Math.cos(this.GetPropertyValue("Collab.Body.Shadow.Orientation")/180*Math.PI)*this.GetPropertyValue("Collab.Body.Shadow.Distance"),e.shadowOffsetY=i*Math.sin(this.GetPropertyValue("Collab.Body.Shadow.Orientation")/180*Math.PI)*this.GetPropertyValue("Collab.Body.Shadow.Distance"))},_DrawShape:function(e,t,i,r,o){this._SetShadow(e,i,o),y.drawShapePath(e,t,a.EBodyShape);var s=t.shape;s!==a.EBodyShape.Circle&&s!==a.EBodyShape.Ellipse&&s!==a.EBodyShape.Rhombus||"stroke"===t.type||e.clip(),"fill"===t.type?e.fill():"stroke"===t.type?(this._SetShadow(e,!1,o),e.stroke()):"clip"===t.type&&e.clip()},_DrawRegularCanvas:function(e,t,i,r){this._DrawCanvas(e,t,r,!1),this.FirstDrawDeferred.resolve()},_DrawHighlightCanvas:function(e,t,i,r){this._DrawCanvas(e,t,r,!0)},_DrawCanvas:function(e,t,i,r){if(this.Modifiable){var o=this.Modifiable.GetProperty("Collab.Attach.Preset");if(o)if(30===o.GetPropertyValue()._value)(y=this.GetShapeInfo())&&y.shape&&(y.shape=a.EBodyShape.None)}var s=this.GetShapeInfo().externalSize.x-2*this._externalMargin,n=this.GetShapeInfo().externalSize.y-2*this._externalMargin,l=0;void 0!==this.GetPropertyValue("Collab.Body.InnerMargin")&&(l=this.GetPropertyValue("Collab.Body.InnerMargin"));var p=l,u=this._externalMargin,h=this._externalMargin;if(this.GetShapeInfo().shape===a.EBodyShape.Square||this.GetShapeInfo().shape===a.EBodyShape.RoundedSquare||this.GetShapeInfo().shape===a.EBodyShape.Circle){var d=Math.max(s,n);s=d,n=d}var y={shape:this.GetShapeInfo().shape,x:u,y:h,width:s,height:n,cornerRadius:p,type:"fill",border:this.GetShapeInfo().border},V=this.GetColorPropertyValue("Collab.Background"),f=V.Clone();f.a=0;var b=f.GetStyle();t.save(),t.globalCompositeOperation="copy",t.fillStyle=b,t.globalAlpha=1,t.fillRect(0,0,e.width,e.height),t.restore();var P=!1;if(this.GetShapeInfo().shape===a.EBodyShape.None||this.GetShapeInfo().shape===a.EBodyShape.RemoveBorder||(t.save(),r?(t.globalCompositeOperation="copy",f.a=2/255,t.fillStyle=f.GetStyle(),t.globalAlpha=1):(t.globalCompositeOperation="source-over",t.fillStyle=V.GetStyle(),V.a>100/255&&this.GetPropertyGroupVisibility("Group.Background")&&(P=!0)),r||this.GetPropertyGroupVisibility("Group.Background")||(y.type="none"),this._DrawShape(t,y,P,!1,i),t.restore(),!r)){var g=this.GetPropertyValue("Collab.Image.Scale"),_=l+this._externalMargin,M=l+this._externalMargin,S=s-2*l,D=n-2*l,G=S*g,x=D*g;if(_+=.5*(S-G),M+=.5*(D-x),!r&&this.Modifiable.GetObject().backgroundImage&&this.Modifiable.GetObject().backgroundImage._IsReadyToUse){t.save(),t.globalCompositeOperation="source-over";var X=this.GetColorPropertyValue("Collab.Image"),v=X.a;X.a=1,t.fillStyle=X.GetStyle(),t.globalAlpha=v,C.isIE11()||1===X.r&&1===X.g&&1===X.b?(y.type="none",this._DrawShape(t,y,!1,!0,i),t.globalCompositeOperation="source-over",this._SetShadow(t,!P,i),P=!0,t.drawImage(this.Modifiable.GetObject().backgroundImage,_,M,G,x)):(y.type="fill",this._DrawShape(t,y,!1,!0,i),t.globalCompositeOperation="destination-in",this._SetShadow(t,!1,i),t.drawImage(this.Modifiable.GetObject().backgroundImage,_,M,G,x),t.globalCompositeOperation="multiply",this._SetShadow(t,!P,i),P=!0,t.drawImage(this.Modifiable.GetObject().backgroundImage,_,M,G,x)),t.restore()}if(r&&this.Modifiable.GetObject().backgroundImage&&this.Modifiable.GetObject().backgroundImage._IsReadyToUse){t.save(),t.globalCompositeOperation="source-over",t.globalAlpha=1;var A=V.Clone();return A.a=1,t.fillStyle=A.GetStyle(),this._SetShadow(t,!1,i),y.type="fill",this._DrawShape(t,y,!1,!0,i),t.globalCompositeOperation="destination-in",t.drawImage(this.Modifiable.GetObject().backgroundImage,_,M,G,x),void t.restore()}if(!r&&this._lineWidth&&this.GetShapeInfo().shape>0){t.save(),t.globalCompositeOperation="source-over";var I=this.GetColorPropertyValue("Collab.Border.Line");t.strokeStyle=I.GetStyle(),t.lineWidth=this._lineWidth,t.globalAlpha=I.a,y.type="stroke",this._DrawShape(t,y,!1,!1,i),t.restore()}if((!r||this.GetShapeInfo().shape===a.EBodyShape.None)&&this._analysedText){t.save(),y.type="clip",this._DrawShape(t,y,!1,!0,i),t.globalCompositeOperation="source-over",this._SetShadow(t,!P,i),P=!0;var w=u+l;w/=m;var T=h+l;this.GetPropertyValue("Collab.Text.VAlignment")===a.EVTextAlignment.Middle?T+=.5*(D-this._TextSize.y):this.GetPropertyValue("Collab.Text.VAlignment")===a.EVTextAlignment.Bottom&&(T+=D-this._TextSize.y),T/=m,t.scale(m,m),this._SetContextToDrawText(t),c.drawText(this._analysedText,t,w,T,S/m,this.GetPropertyValue("Collab.Text.HAlignment")),t.restore()}r&&(t.save(),t.globalCompositeOperation="source-over",t.fillStyle=b,t.globalAlpha=1,y.shape=a.EBodyShape.Rectangle,y.type="fill",this._DrawShape(t,y,!1,!0,i),t.restore())}},_SetContextToDrawText:function(e){var t=this.GetColorPropertyValue("Collab.Text");e.fillStyle=t.GetStyle(),this.Modifiable._panelDiv&&this.Modifiable._panelDiv.ckEditor&&this.Modifiable._panelDiv.ckEditor.isEditing?e.globalAlpha=0:e.globalAlpha=t.a;var i=this.GetFontPropertyValue("Collab.Text.Font");if(i){this.Modifiable.GetObject().fontHeight=this._requestedFontRatio*i.Height;var r="";r+=" "+(i.Italic?"italic":"normal"),r+=" "+(i.Weight||400),r+=" "+(this.Modifiable.GetObject().fontHeight||22)+"px",r+=" "+(i.Family||"Arial"),e.font=r}},GetShapeInfo:function(){return this.shapeInfo||(this.shapeInfo={},this.shapeInfo.border={top:!1,bottom:!0,left:!1,right:!1}),this.shapeInfo},_ComputeShapeInfo:function(){this._ComputeSize(),this._ComputeCenter()},_ComputeCenter:function(){var e={};switch(e.hPosition=-this._externalMargin,e.vPosition=-this._externalMargin,e.horizontalPosition=-this._externalMargin,e.verticalPosition=-this._externalMargin,e.horizontalPosition-=.5*this.GetShapeInfo().size.x,e.verticalPosition-=0,this.GetPropertyValue("Collab.Body.HAlignment")){case a.EHAlignment.Left:this.GetShapeInfo().center.x=.5*this.GetShapeInfo().size.x,e.hPosition-=0;break;case a.EHAlignment.Center:this.GetShapeInfo().center.x=0,e.hPosition-=.5*this.GetShapeInfo().size.x;break;case a.EHAlignment.Right:this.GetShapeInfo().center.x=.5*-this.GetShapeInfo().size.x,e.hPosition-=1*this.GetShapeInfo().size.x}switch(this.GetPropertyValue("Collab.Body.VAlignment")){case a.EVAlignment.Top:this.GetShapeInfo().center.y=.5*this.GetShapeInfo().size.y,e.vPosition-=1*this.GetShapeInfo().size.y;break;case a.EVAlignment.Middle:this.GetShapeInfo().center.y=0,e.vPosition-=.5*this.GetShapeInfo().size.y;break;case a.EVAlignment.Bottom:this.GetShapeInfo().center.y=.5*-this.GetShapeInfo().size.y,e.vPosition-=0}return e},_ComputeSize:function(){this.GetShapeInfo().size.set(this.GetPropertyValue("Collab.Body.Width"),this.GetPropertyValue("Collab.Body.Height"));var e=0;if(void 0!==this.GetPropertyValue("Collab.Body.InnerMargin")&&(e=this.GetPropertyValue("Collab.Body.InnerMargin")),this._currentText&&this.GetPropertyValue("Collab.Body.FitToText")&&(this.GetPropertyValue("Collab.Text.Wordwrap")?this.GetShapeInfo().size.y=this._TextSize.y:this.GetShapeInfo().size.copy(this._TextSize),this.GetShapeInfo().size.x+=2*e,this.GetShapeInfo().size.y+=2*e),this.GetShapeInfo().keepAspectRatio=!1,this.GetPropertyValue("Collab.Body.KeepAspectRatio")&&(this.GetShapeInfo().keepAspectRatio=!0,this.Modifiable.GetObject().backgroundImage?this.GetShapeInfo().size.y=this.GetShapeInfo().size.x*this.Modifiable.GetObject().backgroundImage.height/this.Modifiable.GetObject().backgroundImage.width:this._TextSize.x>0&&(this.GetShapeInfo().size.y=this.GetShapeInfo().size.x*this._TextSize.y/this._TextSize.x)),this._TextSize&&this._TextSize.x>0?this.GetShapeInfo().sizeBeforeEqualization=this.GetShapeInfo().size.clone():delete this.GetShapeInfo().sizeBeforeEqualization,this.GetPropertyValue("Collab.Body.ContributeToEqualSize")&&(this.GetShapeInfo().size.x=Math.max(this.GetShapeInfo().size.x,this.ExperienceBase.getManager("VCXDressupManager").GetCalloutMaxSize().x),this.GetShapeInfo().size.y=Math.max(this.GetShapeInfo().size.y,this.ExperienceBase.getManager("VCXDressupManager").GetCalloutMaxSize().y)),this.GetShapeInfo().shape===a.EBodyShape.Square||this.GetShapeInfo().shape===a.EBodyShape.RoundedSquare||this.GetShapeInfo().shape===a.EBodyShape.Circle){this.GetShapeInfo().keepAspectRatio=!0;var t=Math.max(this.GetShapeInfo().size.x,this.GetShapeInfo().size.y);this.GetShapeInfo().size.x=t,this.GetShapeInfo().size.y=t}this.GetShapeInfo().internalSize.copy(this.GetShapeInfo().size),this.GetShapeInfo().internalSize.x-=2*e,this.GetShapeInfo().internalSize.y-=2*e,this.GetShapeInfo().externalSize.copy(this.GetShapeInfo().size),this.GetPropertyGroupVisibility("Group.Shadow")?this._externalMargin=this.GetPropertyValue("Collab.Body.Shadow.Distance")+1:this._externalMargin=.5,this._externalMargin+=.5*this._lineWidth,this.GetShapeInfo().externalSize.x+=2*this._externalMargin,this.GetShapeInfo().externalSize.y+=2*this._externalMargin},computePow:function(e){let t=262144;if(!e){t=Math.pow(2024,2);let e=this.Modifiable.GetObject().backgroundImage&&this.Modifiable.GetObject().backgroundImage._IsReadyToUse,i=!(this.GetPropertyGroupVisibility("Group.Shadow")&&0!==this.GetPropertyValue("Collab.Body.Shadow.Opacity")||1!==this.GetPropertyValue("Collab.Border.Line.Color").GetRGBA()[3]&&0!==this.GetPropertyValue("Collab.Border.Line.Width"));e&&i&&(t=Math.min(t,this.Modifiable.GetObject().backgroundImage.width*this.Modifiable.GetObject().backgroundImage.height))}return Math.log(t/(this.GetShapeInfo().externalSize.x*this.GetShapeInfo().externalSize.y))/(2*Math.log(2))},_ReBuildCanvasNodeTexture:function(r){if(this._ComputeSize(),!this._CanvasNode||!this._CanvasNodeTexture||Math.abs(this._CanvasNodeTexture.width-this.GetShapeInfo().externalSize.x)>.1||Math.abs(this._CanvasNodeTexture.height-this.GetShapeInfo().externalSize.y)>.1||this.realignCanvasObserver.isDirty()){if(this._CanvasNode&&this._Smart3DPaperNode&&(this._Smart3DPaperNode.remove(this._CanvasNode),this._CanvasNode=null,this._CanvasNodeTexture=null,this._Smart3DPaperNode.remove(this._HighlightCanvasNode),this._HighlightCanvasNode=null,this._HighlightCanvasNodeTexture=null),this.GetShapeInfo().externalSize.x*this.GetShapeInfo().externalSize.y>0){var o=this._ComputeCenter(),s=this._computePanelCenterMM(r);s&&(this.GetShapeInfo().centerInPaper=s);var n=new d.Vector3(o.hPosition,o.vPosition,0);this.tempCorner=new d.Vector3(o.horizontalPosition,o.verticalPosition,0);var l=!0;let m=!1;this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=a.EPositionType.Free2D&&!this.GetPropertyValue("Collab.3D.Paper.Is.Background")&&(m=!0,l=!1);var p=new d.Vector3(this.GetShapeInfo().externalSize.x,0,0),u=new d.Vector3(0,this.GetShapeInfo().externalSize.y,0);if(!this._HighlightCanvasNodeTexture){var c=this.GetShapeInfo().externalSize.x,C=this.GetShapeInfo().externalSize.y,y=!0;this._HighlightCanvasNodeTexture=new i({width:c,height:C,rectangleTexture:y,drawCB:this._DrawHighlightCanvas.bind(this),alphaTest:.005,materialParams:{opacity:0,depthTest:l,depthWrite:false,polygonOffset:!0,polygonOffsetFactor:-10,polygonOffsetUnits:-10}}),this._HighlightCanvasNodeTexture.maxPow=this.computePow(!0)}if(this._HighlightCanvasNode=new t({name:"highlightCanvas",bottomLeftcorner:n,widthVector:p,heightVector:u,canvasNodeTexture:this._HighlightCanvasNodeTexture},h),this._Smart3DPaperNode&&(this._Smart3DPaperNode.add(this._HighlightCanvasNode,{exludeFromBounding:m}),this.handleLayers(!0)),!this._CanvasNodeTexture){c=this.GetShapeInfo().externalSize.x,C=this.GetShapeInfo().externalSize.y,y=!0;this._CanvasNodeTexture=new i({width:c,height:C,rectangleTexture:y,drawCB:this._DrawRegularCanvas.bind(this),alphaTest:0,materialParams:{opacity:this._globalOpacity,depthTest:l,depthWrite:false,polygonOffset:!0,polygonOffsetFactor:-10,polygonOffsetUnits:-10}}),this._CanvasNodeTexture.maxPow=this.computePow(!1)}this._CanvasNode=new t({name:"regularCanvas",bottomLeftcorner:n,widthVector:p,heightVector:u,canvasNodeTexture:this._CanvasNodeTexture},h),this._CanvasNode.setPickable(e.PICKTHROUGH),this._CanvasNode.rectangle.excludeFromHighlight(!0,!0),this._CanvasNode.traverse((function(e,t){return e.noAA=!0,!1}),!0),this._Smart3DPaperNode&&this._Smart3DPaperNode.add(this._CanvasNode,{exludeFromBounding:m}),this._AttachesNodeContainer&&this._AttachesNodeContainer.RecursiveSetRenderDepth(this.renderDepth),this._Smart3DPaperNode&&this._Smart3DPaperNode.RecursiveSetRenderDepth(this.renderDepth+.1),this.handleLayers(!0),this._CanvasNodeTexture._requestRedraw(),this._HighlightCanvasNodeTexture._requestRedraw()}}else this._CanvasNodeTexture._requestRedraw(),this._HighlightCanvasNodeTexture._requestRedraw();return this.ExperienceBase.getManager("VCXContextManager").renderAll(),this._CanvasNode},isNodeBuilt:function(){return Boolean(this._Smart3DPaperNode)},dispose:function(){this._Smart3DPaperNode&&(this._Smart3DPaperNode.dispose(),this._Smart3DPaperNode=null,this.GetShapeInfo().smartNode=null),this._AttachesNode&&(this._AttachesNode.dispose(),this._AttachesNode=null),delete this.realignCanvasObserver,delete this.rebuildAttachesObserver,delete this.rebuildCanvasObserver,delete this.textChangeObserver,delete this.textFontObserver,delete this.htmlChangeObserver,delete this.redrawCanvasObserver,delete this.otherOptionsObserver,delete this.observers,this._parent()},_Build:function(){this.GetShapeInfo().shape=1,this.GetShapeInfo().externalSize=new d.Vector2,this.GetShapeInfo().internalSize=new d.Vector2,this.GetShapeInfo().center=new d.Vector2,this.GetShapeInfo().centerInPaper=new d.Vector2,this.GetShapeInfo().size=new d.Vector2,this.GetShapeInfo().keepAspectRatio=null;var e={name:"AttachContainerNode",modifiable:this.Modifiable};this._AttachesNodeContainer=new o(e),this.add(this._AttachesNodeContainer);e={name:"PanelSmartNode",modifiable:this.Modifiable};this._Smart3DPaperNode=new p(e),this.GetShapeInfo().smartNode=this._Smart3DPaperNode,this.add(this._Smart3DPaperNode),this.handleLayers(!0),this.observers=[],this.realignCanvasObserver=new n,this.observers.push(this.realignCanvasObserver),this.realignCanvasObserver.add(this.Modifiable,"Collab.Body.HAlignment"),this.realignCanvasObserver.add(this.Modifiable,"Collab.Body.VAlignment"),this.rebuildAttachesObserver=new n,this.observers.push(this.rebuildAttachesObserver),this.rebuildAttachesObserver.add(this.Modifiable,"Collab.Measurement.Type"),this.rebuildAttachesObserver.add(this.Modifiable,"Collab.Measurement.Attach.Type"),this.rebuildAttachesObserver.add(this.Modifiable,"Collab.Attach.BentDot"),this.rebuildAttachesObserver.add(this.Modifiable,"Collab.Attach.LeadType"),this.rebuildAttachesObserver.add(this.Modifiable,"Collab.Attach.Origin"),this.rebuildCanvasObserver=new n,this.observers.push(this.rebuildCanvasObserver),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.Shape"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.Width"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.Height"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.InnerMargin"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.KeepAspectRatio"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Border.Show"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Border.Line.Width"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Image.Show"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Image.Doc.ID"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.PIP.Scenario.ID"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Image.Doc.PrepareRender"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Image.Scale"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.Shadow.Show"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.Shadow.Distance"),this.textChangeObserver=new n,this.observers.push(this.textChangeObserver),this.textChangeObserver.add(this.Modifiable,"Collab.Text"),this.textChangeObserver.add(this.Modifiable,"Collab.Text.Show"),this.textChangeObserver.add(this.Modifiable,"Collab.Body.FitToText"),this.textChangeObserver.add(this.Modifiable,"Collab.Text.Wordwrap"),this.textChangeObserver.add(this.Modifiable,"Collab.Text.Font"),this.textChangeObserver.add(this.Modifiable,"Collab.Text.HAlignment"),this.textChangeObserver.add(this.Modifiable,"Collab.Text.VAlignment"),this.textChangeObserver.add(this.Modifiable,"Collab.Text.LineSpacing"),this.textChangeObserver.add(this.Modifiable,"Collab.Text.ParagraphSpacing"),this.textChangeObserver.add(this.Modifiable,"Collab.Text.SizeToFit"),this.textChangeObserver.add(this.Modifiable,"Collab.Body.Width"),this.textChangeObserver.add(this.Modifiable,"Collab.Body.InnerMargin"),this.textFontObserver=new n,this.observers.push(this.textFontObserver),this.textFontObserver.add(this.Modifiable,"Collab.Text.Font"),this.textFontObserver.add(this.Modifiable,"Collab.Text.SizeToFit"),this.htmlChangeObserver=new n,this.observers.push(this.htmlChangeObserver),this.htmlChangeObserver.add(this.Modifiable,"Collab.Body.Width"),this.htmlChangeObserver.add(this.Modifiable,"Collab.Body.Height"),this.htmlChangeObserver.add(this.Modifiable,"Collab.Text.html"),this.redrawCanvasObserver=new n,this.observers.push(this.redrawCanvasObserver),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Background.Color"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Background.Color.Opacity"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Background.Show"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Border.Line.Color"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Border.Line.Color.Opacity"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Text.Color"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Text.Color.Opacity"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Image.Color"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Image.Color.Opacity"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Body.Shadow.Orientation"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Body.Shadow.Opacity"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Body.Shadow.Blur"),this.otherOptionsObserver=new n,this.observers.push(this.otherOptionsObserver),this.otherOptionsObserver.add(this.Modifiable,"Collab.3D.Paper.Depth"),this.otherOptionsObserver.add(this.Modifiable,"Actor.IsAlwaysOnTop"),this.otherOptionsObserver.add(this.Modifiable,"Collab.3D.Paper.Billboard.Type")},preRender:function(e){if(!this._parent(e))return!1;var t=!1;if(this._isVisible){if(this._parent(e),!this.viewpointVisibility||!this.GetOpacity(e))return this.setVisibility(!1),!1;this.setVisibility(!0),this._Smart3DPaperNode&&(t|=this._Smart3DPaperNode.preRender(e)),this._AttachesNode&&(t|=this._AttachesNode.preRender(e)),this.GetShapeInfo().centerInPaper=this._computePanelCenterMM(e)}return t},postUpdate:function(e){this._parent(e),this.Modifiable._panelDiv&&this.Modifiable._panelDiv.ckEditor&&this.Modifiable._panelDiv.ckEditor.checkForNecessaryRessources()&&(this.Modifiable._panelDiv.ckEditor.updateDivPosition(),this.Modifiable._panelDiv.ckEditor.updateDivSize()),this._Smart3DPaperNode&&this._Smart3DPaperNode.postUpdate(e),this._AttachesNode&&this._AttachesNode.postUpdate(e),this.observers&&this.observers.every((function(e){return e.reset(),!0}))},GetVarianceNode(e){return new V({name:e.viewerID+"_"+this.name,modifiable:this.Modifiable,experience:this.ExperienceBase})},update:function(e){if(this._parent(e),this._globalOpacity!==this.GetOpacity(e)&&(this._globalOpacity=this.GetOpacity(e),this._isVisible=this._globalOpacity>0,this._isVisible?this._Smart3DPaperNode||this._Build():null!==this._Smart3DPaperNode&&(this._CanvasNode&&(this._Smart3DPaperNode.remove(this._CanvasNode),this._CanvasNodeTexture=null,this._CanvasNode=null),this._HighlightCanvasNode&&(this._Smart3DPaperNode.remove(this._HighlightCanvasNode),this._HighlightCanvasNode=null,this._HighlightCanvasNodeTexture=null)),this.setVisibility(this._isVisible),this._myDiv&&this._myDiv.style.opacity!==this._globalOpacity&&(this._myDiv.style.opacity=this._globalOpacity)),this._globalOpacity<=0)return;var t=!1;if(this._Smart3DPaperNode&&this._Smart3DPaperNode.update(e),this.observers&&this.observers.every((function(e){return e.update(),!0})),!this._AttachesNode||this.rebuildAttachesObserver.isDirty()){this._AttachesNode&&this.rebuildAttachesObserver.isDirty()&&(this._AttachesNodeContainer.remove(this._AttachesNode),this._AttachesNode=null);var i={name:"AttachesNode",modifiable:this.Modifiable,panelNode:this};if(this.Modifiable.GetPropertyGroupVisibility("Group.Attach")&&(this.Modifiable.GetObject().getAttachType&&this.Modifiable.GetObject().getAttachType()?this._AttachesNode=new s(i):this._AttachesNode=new r(i),this._AttachesNodeContainer)){let e=!1;this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=a.EPositionType.Free2D&&!this.GetPropertyValue("Collab.3D.Paper.Is.Background")&&(e=!0),this._AttachesNodeContainer.add(this._AttachesNode,{exludeFromBounding:e})}}this._AttachesNode&&this._AttachesNode.update(e);var o=!0,n=!1;this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=a.EPositionType.Free2D&&!this.GetPropertyValue("Collab.3D.Paper.Is.Background")&&(o=!1);var p=this._computePanelCenterMM(e);this.GetShapeInfo().centerInPaper=p,this._CanvasNodeTexture&&this._CanvasNodeTexture.setMaterialParams&&this._CanvasNodeTexture.setMaterialParams({opacity:this._globalOpacity,depthTest:o,depthWrite:n,polygonOffset:!0,polygonOffsetFactor:-10,polygonOffsetUnits:-10}),this._HighlightCanvasNodeTexture&&this._HighlightCanvasNodeTexture.setMaterialParams&&this._HighlightCanvasNodeTexture.setMaterialParams({opacity:0,depthTest:o,depthWrite:n,polygonOffset:!0,polygonOffsetFactor:-10,polygonOffsetUnits:-10});var h=this.textFontObserver.isDirty(),d=this.redrawCanvasObserver.isDirty();d||(this.Modifiable._panelDiv&&!this._editingState?(this._editingState=!0,d=!0):!this.Modifiable._panelDiv&&this._editingState&&(this._editingState=!1,d=!0));var C=this.textChangeObserver.isDirty(),y=null===this._HighlightCanvasNode||null===this._CanvasNode||C||this.rebuildCanvasObserver.isDirty()||this.realignCanvasObserver.isDirty(),V="";if(this.GetPropertyGroupVisibility("Group.Text")&&((V=this.Modifiable.GetComputedStringProperty("Collab.Text",l.format))||(V=" ")),V||(V=""),this._currentText!==V&&(h=!0,this._currentText=V,y=!0,C=!0),this.GetPropertyValue("Collab.Text.SizeToFit")&&y&&(C=!0),!this.GetPropertyValue("Collab.Body.ContributeToEqualSize")||this._calloutMaxSize&&this.ExperienceBase.getManager("VCXDressupManager").GetCalloutMaxSize().equals(this._calloutMaxSize)||(this._calloutMaxSize=this.ExperienceBase.getManager("VCXDressupManager").GetCalloutMaxSize().clone(),y=!0),!(this.otherOptionsObserver.isDirty()||y||d||C||h))return;if(this._CanvasNodeTexture&&this._CanvasNodeTexture.setMaterialParams&&this._CanvasNodeTexture.setMaterialParams({opacity:this._globalOpacity,depthTest:o,depthWrite:n,polygonOffset:!0,polygonOffsetFactor:-10,polygonOffsetUnits:-10}),this._HighlightCanvasNodeTexture&&this._HighlightCanvasNodeTexture.setMaterialParams&&this._HighlightCanvasNodeTexture.setMaterialParams({opacity:0,depthTest:o,depthWrite:n,polygonOffset:!0,polygonOffsetFactor:-10,polygonOffsetUnits:-10}),this.GetShapeInfo().shape=this.GetPropertyValue("Collab.Body.Shape"),this._lineWidth=this.GetPropertyValue("Collab.Border.Line.Width"),this.GetPropertyGroupVisibility("Group.Border")?this._lineWidth*=m:this._lineWidth=0,void 0!==this.GetPropertyValue("Collab.3D.Paper.Depth")&&(this.renderDepth=this.GetPropertyValue("Collab.3D.Paper.Depth",!0),this._AttachesNodeContainer&&this._AttachesNodeContainer.RecursiveSetRenderDepth(this.renderDepth),this._Smart3DPaperNode&&this._Smart3DPaperNode.RecursiveSetRenderDepth(this.renderDepth+.1)),C)if(this._currentText&&""!==this._currentText){var f=document.createElement("canvas");f.width=0,f.height=0;var b=f.getContext("2d"),P=-1;if(this.Modifiable.GetPropertyValue("Collab.Text.SizeToFit")){this._ComputeSize(),this._requestedFontRatio=1,this._SetContextToDrawText(b),this._analysedText=c.analyseText(this._currentText,null,b,P,this.Modifiable.GetObject().fontHeight,this.GetPropertyValue("Collab.Text.LineSpacing"),this.GetPropertyValue("Collab.Text.ParagraphSpacing")),this._TextSize.x=this._analysedText.maxWidth*m,this._TextSize.y=this._analysedText.maxHeight*m;var g=this.GetShapeInfo().internalSize.x/this._TextSize.x,_=this.GetShapeInfo().internalSize.y/this._TextSize.y;this._requestedFontRatio=Math.min(g,_),h=!0}else this._requestedFontRatio=1,this.GetPropertyValue("Collab.Text.Wordwrap")&&(this._ComputeSize(),P=this.GetShapeInfo().internalSize.x/m);this._SetContextToDrawText(b),this._analysedText=c.analyseText(this._currentText,h?null:this._analysedText,b,P,this.Modifiable.GetObject().fontHeight,this.GetPropertyValue("Collab.Text.LineSpacing"),this.GetPropertyValue("Collab.Text.ParagraphSpacing")),this._TextSize.x=this._analysedText.maxWidth*m,this._TextSize.y=this._analysedText.maxHeight*m}else this._TextSize.x=0,this._TextSize.y=0,this._analysedText=null;var M=!1;let S=this.getDocID();if(this._previousBackgroundDocID!==S||this._previousShape!==this.GetShapeInfo().shape||this.GetPropertyValue("Collab.Image.Doc.PrepareRender"))if(this._previousShape=this.GetShapeInfo().shape,this._previousBackgroundDocID=S,this.GetPropertyValue("Collab.Image.Doc.PrepareRender")&&(this._previousBackgroundDocID=-1),-1!==S){var D=u.Effect.None;if(this.GetShapeInfo().shape===a.EBodyShape.RemoveBorder&&(D=u.Effect.RemoveBorder),this.Modifiable){var G=this.Modifiable.GetObject().getImage(D).then((i=>{this._ReBuildCanvasNodeTexture(e),t=!0}));this.Modifiable.GetObject().QueryInterface("VCXIReadiness").registerPromise(G)}M=!0}else this.Modifiable.GetObject().backgroundImage&&(this.Modifiable&&this.Modifiable.GetObject().clearImage(),y=!0);M||(!this._CanvasNode||y?(this._ReBuildCanvasNodeTexture(e),t=!0):d&&(this._CanvasNodeTexture._requestRedraw(),this._HighlightCanvasNodeTexture._requestRedraw(),this.ExperienceBase.getManager("VCXContextManager").renderAll())),this.handleLayers(t)},getDocID(){let e=null;const t=this.GetPropertyValue("Collab.PIP.Scenario.ID");if(t){const i=this.ExperienceBase.getManager("VCXScenarioManager").GetScenarios()[t];if(i){const t=i.GetPIPDocId&&i.GetPIPDocId();t.docID>=0&&(this._scenarioDocTS!==t.timeStamp&&(this._previousBackgroundDocID=-1,this._scenarioDocTS=t.timeStamp),e=t.docID)}}return e=e||this.GetPropertyValue("Collab.Image.Doc.ID"),null!=e&&this.GetPropertyGroupVisibility("Group.Image")||(e=-1),e},_computePanelCenterMM:function(e){var t=this.Modifiable,i=null,r=this.GetShapeInfo().smartNode.BillboardType===a.EBillboardType.Spherical;switch(this.GetShapeInfo().smartNode.PositioningType){case a.EPositionType.Free3D:if(!r)return;var o=this.GetShapeInfo().smartNode.Position,s=t.QueryInterface("W3AISGNodeHolder").getPositionInWCS(e.viewer,o),n=(l=this._experienceBase.getManager("VCXPaperManager")).ModelToMM2(e,s);i=new d.Vector2(n.x,n.y);break;case a.EPositionType.RelativeToReferential:var l=this.ExperienceBase.getManager("VCXPaperManager"),p=(new d.Vector3).getPositionFromMatrix(this.GetShapeInfo().smartNode.GetReferential(e)),u=l.GetModelPointFromModelPointAndPaperPosition(e,p,this.GetShapeInfo().smartNode.Position2D,this.GetShapeInfo().smartNode.PositionRadius);i=l.ModelToMM2(e,u);break;default:var h=t.GetPropertyValue("Collab.3D.Paper.Paper.Position.X"),c=t.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y");i=new d.Vector2(h,c)}return i.x+=this.GetShapeInfo().center.x,i.y+=this.GetShapeInfo().center.y,i},_getPanelBoundsMM:function(e){var t=this._computePanelCenterMM(e);if(t){this.GetShapeInfo().centerInPaper=t;var i=this.GetShapeInfo().size.x,r=this.GetShapeInfo().size.y;return{center:t,left:t.x-.5*i,right:t.x+.5*i,top:t.y-.5*r,bottom:t.y+.5*r}}}});return V})),define("DS/VCXWebDressup/VCXMarkup/VCXLabelSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXMarkup/VCXPanelNode"],(function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Label",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_LabelLeaf.png")}return this._parent()}})})),define("DS/VCXWebDressup/VCXMarkup/VCXMeasurementSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXMarkup/VCXPanelNode"],(function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Measurement",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_LabelLeaf.png")}return this._parent()},getWorldMatrix:function(e){return this.GetObject().getReferential()}})})),define("DS/VCXWebDressup/VCXMarkup/VCXCalloutSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXMarkup/VCXPanelNode"],(function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Callout",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_CalloutLeaf.png")}return this._parent()}})})),define("DS/VCXWebDressup/VCXMarkup/VCXPanelSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXMarkup/VCXPanelNode"],(function(e,t){"use strict";return e.extend({init:function(){this._parent()},buildSGNode:function(){if(!this._sgNode){var e={name:"Panel",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Image2DLeaf.png")}return this._parent()}})})),define("DS/VCXWebDressup/VCXAmbience/VCXAmbienceNode",["DS/CoreEvents/Events","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebModifiables/VCXPropertiesObserver","DS/Visualization/ThreeJS_DS"],(function(e,t,i,r){"use strict";var a=t.extend({init:function(e){this._parent(e),this._propertyObserver=new i,this._propertyObserver.addAll(this.Modifiable.GetObject()),this._propertyObserver.removeProp(this.Modifiable,"Ambience.Background.Radius.FinalValue"),this._propertyObserver.removeProp(this.Modifiable,"Ambience.Background.Position.FinalValue"),this._propertyObserver.dirtify()},GetVarianceNode(e){return new a({name:e.viewerID+"_"+this.name,modifiable:this.Modifiable,experience:this.ExperienceBase})},_Build:function(e){this.loading||(this.loading=!0,this.Modifiable.GetObject().getAmbienceAsync().then((t=>{t&&(this._varianceAmbience=t.clone({viewer:e.viewer}),this._varianceAmbience.setIblMap({texture:t.getIblMap(),mapping:new r.LatLongReflectionMapping,hdr:t.getIblMap().hdr,doneCallback:()=>{this._propertyObserver.dirtify(),this.Modifiable.GetObject().setDirty(!0)},generateRougnessMap:!0}))})))},isActive:function(){const e=this.Modifiable.ExperienceBase.getManager("VCXVisuManager");return(!e||!e.getNonVisibleSpaceState())&&this.Modifiable.ExperienceBase.getManager("VCXContextManager").getActiveViewport().getActiveAmbienceID()===this.Modifiable.GetObject().GetID()},preRender:function(t){if(!this._parent(t))return!1;if(this.isActive()){let r=t.viewer;if(!this._varianceAmbience)return void(this.loading||this._Build(t));var i=this._varianceAmbience;i!==r.ambience&&(r.setAmbience(i,!0),i.getBackground().setActivated(!0),r.planeGrid&&(r.planeGrid.displayGrid=0),e.publish({event:"VCX_ENVIRONNEMENT_PROPERTY_CHANGED"}),e.publish({event:"VCX_AMBIENCE_CHANGED"}))}},update:function(e){this._parent(e),this.Modifiable.ExperienceBase.getManager("VCXContextManager").getActiveViewport().getActiveAmbienceID()===this.Modifiable.GetObject().GetID()&&this._varianceAmbience&&(this._propertyObserver.update(),this._propertyObserver.isDirty()&&this._applyOverride(),this._propertyObserver.reset(),this._applyOverridePosition())},_applyOverride:function(){let e=this._varianceAmbience;if(e){"backplate"===e.getBackground().getType()&&e.getBackground().setSizeScaling("bestFit"),e.getEnvironmentLight().setIntensity(Math.pow(2,this.Modifiable.GetPropertyValue("Ambience.Lighting.Exposure")));var t=e.getEnvironmentLightMatrix();t.makeRotationZ(this.Modifiable.GetPropertyValue("Ambience.Lighting.Rotation")*Math.PI/180),e.setEnvironmentLightMatrix(t);var i=this.Modifiable.ExperienceBase.getManager("VCXContextManager").getActiveViewport(),a=i&&i.QueryInterface("VCXIModifiable");a&&a.QueryInterface("VCXIModifiable").GetPropertyValue("Environment.Background.Override")||e.getBackground().setIntensity(Math.pow(2,this.Modifiable.GetPropertyValue("Ambience.Background.Exposure"))),e.setGroundGlossiness(this.Modifiable.GetPropertyValue("Ambience.Ground.Glossiness")/100),e.setGroundReflectivitiy(this.Modifiable.GetPropertyValue("Ambience.Ground.Reflectivity")/100),e.setGroundShadowIntensity&&e.setGroundShadowIntensity(this.Modifiable.GetPropertyValue("Ambience.Ground.ShadowIntensity")/100),e.setAutoGroundOffset(!1),e.setGroundHeight(new r.Vector3(0,0,this.Modifiable.GetPropertyValue("Ambience.Ground.Scaleratio")/6)),e.setGroundOffset(this.Modifiable.GetPropertyValue("Ambience.Ground.Offset")),e.getTransform().makeRotationZ(this.Modifiable.GetPropertyValue("Ambience.Background.Rotation")*Math.PI/180),e.setFiniteMode(this.Modifiable.GetPropertyValue("Ambience.Background.Finite"))}},_applyOverridePosition:function(){let e=this._varianceAmbience;e&&!this._varianceViewerID&&(this._experienceBase.getManager("VCXVisuManager").updateGroundPosition({radius:this.Modifiable.GetPropertyValue("Ambience.Background.Radius.Auto")?-1:this.Modifiable.GetPropertyValue("Ambience.Background.Radius"),position:this.Modifiable.GetPropertyValue("Ambience.Background.Position.Auto")?null:this.Modifiable.GetPropertyValue("Ambience.Background.Position"),ambience:e}),e.updateMatrix())},dispose:function(){this.Modifiable.ExperienceBase.getManager("VCXContextManager").applyToViewers((e=>{try{e&&this._varianceAmbience&&e.ambience===this._varianceAmbience&&e.removeAmbience()}catch(e){console.warn(e)}})),this._varianceAmbience&&this._varianceAmbience.dispose(),this._parent()}});return a})),define("DS/VCXWebDressup/VCXAmbience/VCXAmbienceSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXAmbience/VCXAmbienceNode"],(function(e,t){"use strict";return e.extend({init:function(){},getWorldMatrix:function(e){var t=this.QueryInterface("VCXIModifiable");if(t)return t.GetFramePropertyValue("Actor.Position")},buildSGNode:function(){if(!this._sgNode){var e={name:"Ambience",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_AmbienceLeaf.png")}return this._parent()}})})),define("DS/VCXWebDressup/VCX3DGrid/VCX3DGridNode",["DS/VCXWebDressup/VCXDressupNode","DS/VCXWebSystem/VCXGridHelper","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/Visualization/Node3D","DS/VCXWebSystem/VCXMathTools","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValuePoint","DS/Visualization/SceneGraphUtils","DS/CoreEvents/Events","DS/WebappsUtils/WebappsUtils","DS/SceneGraphNodes/BillBoardNode3D"],(function(e,t,i,r,a,o,s,n,l,p,u,h,d,c,C){"use strict";return e.extend({init:function(e){return this.CellSize=1,this.GridStep=-1,this.TextureName="grid512_new",this.GridUnit=1,this.GridBigUnit=1,this.width=0,this.height=0,this._active=!0,this.addZoomLevel=null,this._bodyMat=new i.MeshBasicMaterial({side:i.DoubleSide,opacity:1,force:!0}),this.textureMaterials={},this.textures={},this._bodyMat.line=new i.LineBasicMaterial({side:i.DoubleSide,opacity:1,force:!0,polygonBorderMode:!0,lineWidth:2}),this._bodyMat.line2=new i.LineBasicMaterial({side:i.DoubleSide,opacity:.5,force:!0,polygonBorderMode:!0,lineWidth:.3}),this._parent(e),this},_ComputeGridCellSize:function(e){let t=Math.floor(e/40);this.CellSize=t,0===this.CellSize&&(this.CellSize=1),this.GridStep=5*this.CellSize,this.GridUnit=this.GridStep,this.previousGridUnit=this.GridUnit},GetNodeDimensionsLimit:function(){return{XMin:this.XGridListHelper.head,XMax:this.XGridListHelper.tail,YMin:this.YGridListHelper.head,YMax:this.YGridListHelper.tail}},_UpdateTextureTiling:function(e){let t={TopLeft:{height:Math.abs(this.YGridListHelper.tail),width:Math.abs(this.XGridListHelper.head)},TopRight:{height:Math.abs(this.YGridListHelper.tail),width:Math.abs(this.XGridListHelper.tail)},BottomRight:{height:Math.abs(this.YGridListHelper.head),width:Math.abs(this.XGridListHelper.tail)},BottomLeft:{height:Math.abs(this.YGridListHelper.head),width:Math.abs(this.XGridListHelper.head)}};this.GridBigUnit=this.GridStep/e,this.GridUnit=this.CellSize/e,this.previousGridUnit!==this.GridUnit&&(this.previousGridUnit=this.GridUnit),this.XGridListHelper&&(this.XGridListHelper.step=this.GridUnit),this.YGridListHelper&&(this.YGridListHelper.step=this.GridUnit);for(let i in t)t.hasOwnProperty(i)&&this._UpdateTextureTilingForEachSide(i,t[i].width,t[i].height,e)},_UpdateTextureTilingForEachSide:function(e,t,i,r){let a=r*t/this.GridStep,o=r*i/this.GridStep;this.textures.hasOwnProperty(e)&&this.textureMaterials.hasOwnProperty(e)&&(this.textures[e].repeat.set(a,o),this.textureMaterials[e].updatePDSFXUniform("gridTexture",this.textures[e]))},GetGridUnit:function(){return this.GridUnit.toFixed(3)},GetGridSizeAllLines:function(){return this.XGridListHelper&&this.YGridListHelper?this.XGridListHelper.getSize()*this.YGridListHelper.getSize():0},ComputeGridUnit:function(e,t){if(!e.position||!e.camera)return;const r=this.GetWorldGridNodeCorners(t);let a=(new i.Vector3).subVectors(r.TopRight,r.TopLeft),o=(new i.Vector3).subVectors(r.TopLeft,r.BottomLeft),n=(new i.Vector3).crossVectors(a,o).normalize(),l=s.getOFromMatrix(this.GetWorldMatrix(t)),p=(new i.Vector3).subVectors(e.position,l),u=Math.abs(p.dot(n)),h=1;e.camera instanceof i.PerspectiveCamera&&(h=100*Math.tan(Math.PI*e.getAngle()/360)*u/t._getDivClientHeight()),e.camera instanceof i.OrthographicCamera&&(h=50*(e.camera.top-e.camera.bottom)/t._getDivClientHeight());let d=h/this.CellSize,c=1,C=Math.floor(Math.log2(d));c=d<1?Math.pow(C,2):1/Math.pow(2,C),this._UpdateTextureTiling(c)},SetCoordinatesLinesSnapping:function(){this.tokenCoordinatesLines=d.subscribe({event:"/3DGrid/CoordinatesLines"},(e=>{if(!e.gridObject)return;if(!e.hasOwnProperty("x")||!e.hasOwnProperty("y"))return;if(!this.GridNodeHolder&&!this.Modifiable)return;if(e.gridObject.GetID()!==this.Modifiable.GetObject().GetID())return void this._removeLinesCoordinates();let t=e.x,r=e.y,o=this.GridNodeHolder.getChildByName("XLineCoordinate"),s=this.GridNodeHolder.getChildByName("YLineCoordinate");o&&o.removeChildren(),s&&s.removeChildren();let n=this.Modifiable.GetProperty("3DGrid.Corner.Top.Left").GetPropertyValue().GetValue(),l=this.Modifiable.GetProperty("3DGrid.Corner.Bottom.Left").GetPropertyValue().GetValue(),p=this.Modifiable.GetProperty("3DGrid.Corner.Top.Right").GetPropertyValue().GetValue(),u=(this.Modifiable.GetProperty("3DGrid.Corner.Bottom.Right").GetPropertyValue().GetValue(),a.createLineNode({points:[new i.Vector3(t,n.y,0),new i.Vector3(t,l.y,0)],material:this._bodyMat.line})),h=a.createLineNode({points:[new i.Vector3(p.x,r,0),new i.Vector3(n.x,r,0)],material:this._bodyMat.line});o.addChild(u),s.addChild(h),this.Modifiable.ExperienceBase.getManager("VCXContextManager").renderAll()})),this.tokenRemoveCoordinatesLines=d.subscribe({event:"VCX_INTERACTOR_END_MANIPULATE"},(()=>{this._removeLinesCoordinates(),this.Modifiable.ExperienceBase.getManager("VCXContextManager").renderAll()}))},_removeLinesCoordinates:function(){if(!this.GridNodeHolder||!this.Modifiable)return;let e=this.GridNodeHolder.getChildByName("XLineCoordinate"),t=this.GridNodeHolder.getChildByName("YLineCoordinate");e&&e.removeChildren(),t&&t.removeChildren(),this.GridNodeHolder.getChildByName("CandidatePoint").removeChildren()},_GetOrientedBB:function(e){let t=[this.Modifiable.GetObject().getWorkingRootPathElement()];const r=this.Modifiable.QueryInterface("W3AISGNodeHolder").getWorldMatrix(e.viewer);this.setMatrix(r);const a=(new i.Matrix4).getInverse(r);let o=h.getOrientedBoundingBoxFromPathElements(t,r,e.viewer);return o.localBBox.expandByPoint(s.getOFromMatrix(r).applyMatrix4(a)),{orientedBB:o,worldMatrix:r}},_SetGridDimensions:function(e){const t=this._GetOrientedBB(e),r=t.worldMatrix,a=t.orientedBB,o=a.localBBox.min,n=a.localBBox.max;this.Modifiable.OnChangeProperty("3DGrid.Position.Min",new u(o)),this.Modifiable.OnChangeProperty("3DGrid.Position.Max",new u(n)),this._viewer=e.viewer;let l=10*this.Modifiable.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(e,s.getOFromMatrix(r)),h=1e3*l,d=Math.min(Math.max(l,Math.abs(n.x-o.x)),h),c=Math.min(Math.max(l,Math.abs(n.y-o.y)),h);const C=this.Modifiable.GetProperty("3DGrid.Width").GetPropertyValue().GetValue(),y=this.Modifiable.GetProperty("3DGrid.Height").GetPropertyValue().GetValue();C&&y&&(d=C,c=y),this._ComputeGridCellSize(Math.max(d,c));let m=Math.floor(d/this.CellSize)*this.CellSize,V=Math.floor(c/this.CellSize)*this.CellSize;m%2&&(m=(Math.floor(d/this.CellSize)+1)*this.CellSize),V%2&&(V=(Math.floor(d/this.CellSize)+1)*this.CellSize);const f=new p(m),b=new p(V);this.width=m,this.height=V,this.Modifiable.OnChangeProperty("3DGrid.Width",f),this.Modifiable.OnChangeProperty("3DGrid.Height",b);let P=new i.Vector3(-m/2,V/2,0);this.Modifiable.OnChangeProperty("3DGrid.Corner.Top.Left",new u(P)),P=new i.Vector3(m/2,V/2,0),this.Modifiable.OnChangeProperty("3DGrid.Corner.Top.Right",new u(P)),P=new i.Vector3(-m/2,-V/2,0),this.Modifiable.OnChangeProperty("3DGrid.Corner.Bottom.Left",new u(P)),P=new i.Vector3(m/2,-V/2,0),this.Modifiable.OnChangeProperty("3DGrid.Corner.Bottom.Right",new u(P))},_BuildGridTextureNode:function(e,t,i,o){const s=new r.PrimitiveGroup({editable:!0});let n=new r.Buffer({component:r.VertexComponentEnum.POSITION,data:new Float32Array(12)});n.dimension=3,s.addBuffer(0,n);let l=new r.Buffer({component:r.VertexComponentEnum.TEX_COORD_0,data:new Float32Array(16)});l.dimension=3,s.addBuffer(1,l);let p,u=new r.Buffer({indexBuffer:!0,data:new Uint16Array(6)});s.addBuffer(2,u),p=n.data;let h=0;p[h++]=i.x,p[h++]=i.y,p[h++]=0,p[h++]=i.x+e,p[h++]=i.y,p[h++]=0,p[h++]=i.x+e,p[h++]=i.y+t,p[h++]=0,p[h++]=i.x,p[h++]=i.y+t,p[h++]=0,p=l.data,h=0,p[h++]=0,p[h++]=0,p[h++]=0,p[h++]=1,p[h++]=0,p[h++]=0,p[h++]=1,p[h++]=1,p[h++]=0,p[h++]=0,p[h++]=1,p[h++]=0,p=u.data,h=0,p[h++]=0,p[h++]=2,p[h++]=1,p[h++]=0,p[h++]=3,p[h++]=2;const d=new r.Primitive({nbIndices:6,connectivity:r.ConnectivityTypeEnum.TRIANGLES,fillGAS:new r.FillAttributes}),c=new r.VertexComponent({nbVertices:4,bufferId:0,indices:new r.IndexArray({bufferId:2,offset:0})}),C=new r.VertexComponent({nbVertices:4,bufferId:1,indices:new r.IndexArray({bufferId:2,offset:0})});d.addVertexComponent(c),d.addVertexComponent(C),s.addPrimitive(d);let y=a.createMeshNode(s);return this._CreateTextureMaterial(e,t,o),this.textureMaterials[o]&&y.setMaterial(this.textureMaterials[o]),y},_BuildGridBorderPlaneNode:function(e,t,r,o,s){return a.createRectangleNode({width:e,height:t,fill:o,cornerPoint:new i.Vector2(r.x,r.y),material:this._bodyMat,noEdge:s})},_BuiLdAxisNode:function(e,t,r){let s=.1*t,n=.1*r;const l=this.Modifiable.ExperienceBase.getManager("VCXVisuManager");let p,u,h={XAxis:[new i.Vector3(e.TopLeft.x-s,-this.offsetY,0),new i.Vector3(e.TopRight.x+s,-this.offsetY,0)],YAxis:[new i.Vector3(-this.offsetX,e.BottomLeft.y-n,0),new i.Vector3(-this.offsetX,e.TopLeft.y+n,0)]},d=[];for(let e in h)h.hasOwnProperty(e)&&(p=new o(e),u=a.createLineNode({points:h[e],material:this._axisMat}),u.setVisibility(!1),u.setRenderPasses([l.getRenderList("VCXPreManipulators"),l.getRenderList("VCXManipulators")]),u.excludeFromCSO(!0),u.excludeFromHighlight(!0,!0),u.setNoHighlightNoZ(!0),p.addChild(u),d.push(p));return d},_CreateTextureMaterial:function(e,t,r){let a=e/this.GridStep,o=t/this.GridStep;this.Modifiable.OnChangeProperty("3DGrid.Texture.RepeatFactor.X",new p(a)),this.Modifiable.OnChangeProperty("3DGrid.Texture.RepeatFactor.Y",new p(o));let s=i.ImageUtils.loadTexture(c.getWebappsBaseUrl()+"VCXWebDressup/assets/textures/"+this.TextureName+".png");s.anisotropy=8,s.wrapS=i.RepeatWrapping,s.wrapT=i.RepeatWrapping,s.repeat=new i.Vector2(a,o),this.textures[r]=s,this.texture=s;let n=new i.MeshBasicMaterial({useBlending:!0,depthTest:!0,transparent:!0,enableClipPlanes:!1,map:s,force:!0,opacity:1,side:i.DoubleSide});n.needsUpdate=!0,this.textureMaterials[r]=n},_BuildGridLinesLists:function(e,i,r){this.XGridListHelper=new t(this.GridUnit),this.YGridListHelper=new t(this.GridUnit),this.XGridListHelper.head=r.TopLeft.x,this.XGridListHelper.tail=r.TopRight.x,this.YGridListHelper.head=r.BottomLeft.y,this.YGridListHelper.tail=r.TopLeft.y},_AddNodeForDebugSnapping:function(e){if(void 0===e.x||void 0===e.y)return;if(!this.GridNodeHolder&&!this.Modifiable)return;let t=this.GridNodeHolder.getChildByName("CandidatePoint");if(t&&0===t.getChildren().length){var r=a.createSphereNode({radius:3,material:this._bodyMat.line});r.setNoZ(!0);var o=a.createFixedSizeNode();o.addChild(r),o.setNoZ(!0),o.setVisibility(this.Modifiable.GetProperty("3DGrid.Origin.Show").GetPropertyValue().GetValue()),t.addChild(o)}const s=t.getChildren()[0];let n=(new i.Matrix4).setPosition(e);s.setMatrix(n);let l=this.GridNodeHolder.getChildByName("XLineCoordinate"),p=this.GridNodeHolder.getChildByName("YLineCoordinate");l&&l.removeChildren(),p&&p.removeChildren();let u=this.Modifiable.GetProperty("3DGrid.Corner.Top.Left").GetPropertyValue().GetValue(),h=this.Modifiable.GetProperty("3DGrid.Corner.Bottom.Left").GetPropertyValue().GetValue(),d=this.Modifiable.GetProperty("3DGrid.Corner.Top.Right").GetPropertyValue().GetValue(),c=(this.Modifiable.GetProperty("3DGrid.Corner.Bottom.Right").GetPropertyValue().GetValue(),a.createLineNode({points:[new i.Vector3(e.x,u.y,0),new i.Vector3(e.x,h.y,0)],material:this._bodyMat})),C=a.createLineNode({points:[new i.Vector3(d.x,e.y,0),new i.Vector3(u.x,e.y,0)],material:this._bodyMat});l.addChild(c),p.addChild(C),this.Modifiable.ExperienceBase.getManager("VCXContextManager").renderAll()},_Build:function(){this._axisMat=this.Modifiable.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams({type:n.ELineType.Dot,lineWidth:1,color:(new l).SetRGB(255,255,255).GetThreeColor(),opacity:1});const e=this.Modifiable.ExperienceBase.getManager("VCXVisuManager");this.GridNodeHolder=new o("GridNodeHolder");const t=new o("CenterNode"),r=new o("CornersNode"),s=new o("PlaneNode"),p=(new o("BorderNode"),new o("TextureNode")),u=new o("GridPlaneNode"),h=new o("TranslationNode"),d=new o("RotationNode"),c=(new o("PlaneDragNode"),new o("MiddlesNode")),C=new o("AxisNode");let y=this.Modifiable.GetProperty("3DGrid.Width").GetPropertyValue().GetValue(),m=this.Modifiable.GetProperty("3DGrid.Height").GetPropertyValue().GetValue();const V=this.Modifiable.GetProperty("3DGrid.Position.Min").GetPropertyValue().GetValue(),f=this.Modifiable.GetProperty("3DGrid.Position.Max").GetPropertyValue().GetValue();let b=(new i.Vector3).addVectors(V,f).multiplyScalar(.5);var P=a.createSphereNode({radius:2.05,material:this._bodyMat.line});P.setNoZ(!0);var g=a.createFixedSizeNode();g.addChild(P);let _=this.Modifiable.GetProperty("3DGrid.Origin.Local.Position").GetPropertyValue().GetFrame();g.setMatrix(_.GetValue()),g.setNoZ(!0),g.setVisibility(this.Modifiable.GetProperty("3DGrid.Origin.Show").GetPropertyValue().GetValue()),t.addChild(g),t.setPickParent(!0),this._CreateTextureMaterial(y,m);let M={TopLeft:this.Modifiable.GetProperty("3DGrid.Corner.Top.Left").GetPropertyValue().GetValue(),TopRight:this.Modifiable.GetProperty("3DGrid.Corner.Top.Right").GetPropertyValue().GetValue(),BottomLeft:this.Modifiable.GetProperty("3DGrid.Corner.Bottom.Left").GetPropertyValue().GetValue(),BottomRight:this.Modifiable.GetProperty("3DGrid.Corner.Bottom.Right").GetPropertyValue().GetValue()};this.offsetX=b.x,this.offsetY=b.y;let S,D,G={TopMiddle:{position:new i.Vector3(0,M.TopLeft.y,0),rotation:(new i.Matrix4).makeRotationZ(Math.PI)},RightMiddle:{position:new i.Vector3(M.TopRight.x,0,0),rotation:(new i.Matrix4).makeRotationZ(Math.PI/2)},BottomMiddle:{position:new i.Vector3(0,M.BottomLeft.y,0),rotation:new i.Matrix4},LeftMiddle:{position:new i.Vector3(M.TopLeft.x,0,0),rotation:(new i.Matrix4).makeRotationZ(-Math.PI/2)}};for(let e in M)M.hasOwnProperty(e)&&(S=new o("Corner"+e),S.setMatrix(S.getMatrix().setPosition(M[e])),S.setPickParent(!0),r.addChild(S));for(let e in G)G.hasOwnProperty(e)&&(D=new o(e),D.setMatrix(G[e].rotation),D.setMatrix(D.getMatrix().setPosition(G[e].position)),c.addChild(D));let x={Z:(new i.Matrix4).makeRotationX(-Math.PI/2),Y:(new i.Matrix4).makeRotationX(-Math.PI),X:(new i.Matrix4).makeRotationZ(-Math.PI/2)},X=null;for(let t in x)x.hasOwnProperty(t)&&(X=new o(t+"Translation"),X.setRenderPasses([e.getRenderList("VCXPreManipulators"),e.getRenderList("VCXManipulators")]),X.excludeFromCSO(!0),X.excludeFromHighlight(!0,!0),X.setNoHighlightNoZ(!0),X.setNoZ(!0),X.setPickParent(!0),h.addChild(X));h.setPickParent(!0);let v={Z:(new i.Matrix4).makeRotationX(-Math.PI/2),Y:(new i.Matrix4).makeRotationX(-Math.PI),X:(new i.Matrix4).makeRotationZ(-Math.PI/2)},A=null;for(let t in v)v.hasOwnProperty(t)&&(A=new o(t+"Rotation"),A.setRenderPasses([e.getRenderList("VCXPreManipulators"),e.getRenderList("VCXManipulators")]),A.excludeFromCSO(!0),A.excludeFromHighlight(!0,!0),A.setNoHighlightNoZ(!0),A.setNoZ(!0),A.setPickParent(!0),d.addChild(A));d.setPickParent(!0),this._BuiLdAxisNode(M,y,m).forEach((e=>{C.addChild(e)})),this.planeNode_=this._BuildGridBorderPlaneNode(y,m,M.BottomLeft,!0,!1),this.planeNode_.setPickParent(!0),s.addChild(this.planeNode_);let I=new i.Vector3(0,0,0);this.textureNodeGroup={},this.textureNodeGroup.TopRight=this._BuildGridTextureNode(y/2,m/2,I,"TopRight"),this.textureNodeGroup.TopLeft=this._BuildGridTextureNode(y/2,m/2,I,"TopLeft"),this.textureNodeGroup.BottomRight=this._BuildGridTextureNode(y/2,m/2,I,"BottomRight"),this.textureNodeGroup.BottomLeft=this._BuildGridTextureNode(y/2,m/2,I,"BottomLeft"),this.textureNodeGroup.BottomLeft.setMatrix((new i.Matrix4).makeRotationZ(-Math.PI)),this.textureNodeGroup.TopLeft.setMatrix((new i.Matrix4).makeRotationY(-Math.PI)),this.textureNodeGroup.BottomRight.setMatrix((new i.Matrix4).makeRotationX(-Math.PI));for(let e in this.textureNodeGroup)this.textureNodeGroup.hasOwnProperty(e)&&(this.textureNodeGroup[e].setPickParent(!0),p.addChild(this.textureNodeGroup[e]));this._BuildGridLinesLists(y,m,M),this.GridNodeHolder.addChild(t),this.GridNodeHolder.addChild(r),this.GridNodeHolder.addChild(c),this.GridNodeHolder.addChild(h),this.GridNodeHolder.addChild(d),this.GridNodeHolder.addChild(C),u.addChild(s),u.addChild(p),u.setVisibilityInTree(!1),[u,s,p].forEach((t=>{t.setRenderPasses([e.getRenderList("VCXPreManipulators"),e.getRenderList("VCXManipulators")]),t.setNoHighlightNoZ(!0),t.setNoZ(!0),t.setPickParent(!0)})),u.setPickingPriorityId("VCXMagnetGrid"),this.GridNodeHolder.addChild(u),this.GridNodeHolder.addChild(new o("XLineCoordinate")),this.GridNodeHolder.addChild(new o("YLineCoordinate")),this.GridNodeHolder.addChild(new o("CandidatePoint")),this.GridNodeHolder.setPickingPriorityId("VCXMagnetGrid"),this.GridNodeHolder.setVisibilityInTree(!1);const w=this.Modifiable.GetProperty("3DGrid.Default.Orientation").GetPropertyValue().GetValue();if("None"!==w){let e=null;switch(w){case"X":e=(new i.Matrix4).makeRotationX(Math.PI/2);break;case"Y":e=(new i.Matrix4).makeRotationY(Math.PI/2);break;default:e=(new i.Matrix4).makeRotationZ(Math.PI/2)}this.GridNodeHolder.setMatrix(e)}this.GridNodeHolder.setPickParent(!0),this.addChild(this.GridNodeHolder,{exludeFromBounding:!1})},_UpdateTexturesNodes:function(e,t){const i=Math.abs(e.TopLeft.x-e.TopRight.x),a=Math.abs(e.TopLeft.y-e.BottomLeft.y);let o=this.textureNodeGroup[t].getBuffer(r.VertexComponentEnum.POSITION),s=0;o[s++]=e.BottomLeft.x,o[s++]=e.BottomLeft.y,s++,o[s++]=e.BottomRight.x,o[s++]=e.BottomRight.y,s++,o[s++]=e.TopRight.x,o[s++]=e.TopRight.y,s++,o[s++]=e.TopLeft.x,o[s++]=e.TopLeft.y,s++,this.textureNodeGroup[t].updateBuffer(r.VertexComponentEnum.POSITION,0,4),this.textureNodeGroup[t].computeBoundingElements();let n=i/this.GridStep,l=a/this.GridStep;this.textures[t].repeat.set(n,l),this.textureMaterials[t].updatePDSFXUniform("gridTexture",this.textures[t])},_UpdatePlaneNode:function(e){const t=Math.abs(e.TopLeft.x-e.TopRight.x),i=Math.abs(e.TopLeft.y-e.BottomLeft.y);this.GridNodeHolder.getChildByName("PlaneNode").removeChild(this.planeNode_),this.planeNode_=this._BuildGridBorderPlaneNode(t,i,e.BottomLeft,!0,!1),this.planeNode_.setPickParent(!0),this.GridNodeHolder.getChildByName("PlaneNode").addChild(this.planeNode_),this.GridNodeHolder.getChildByName("AxisNode").removeChildren(),this._BuiLdAxisNode(e,t,i).forEach((e=>{this.GridNodeHolder.getChildByName("AxisNode").addChild(e)}))},_UpdateCornersAndMiddles:function(e){this.getChildByName("CornerTopLeft").setMatrix(this.getChildByName("CornerTopLeft").getMatrix().setPosition(new i.Vector3(e.TopLeft.x,e.TopLeft.y,0))),this.getChildByName("CornerTopRight").setMatrix(this.getChildByName("CornerTopRight").getMatrix().setPosition(new i.Vector3(e.TopRight.x,e.TopRight.y,0))),this.getChildByName("CornerBottomLeft").setMatrix(this.getChildByName("CornerBottomLeft").getMatrix().setPosition(new i.Vector3(e.BottomLeft.x,e.BottomLeft.y,0))),this.getChildByName("CornerBottomRight").setMatrix(this.getChildByName("CornerBottomRight").getMatrix().setPosition(new i.Vector3(e.BottomRight.x,e.BottomRight.y,0))),this.getChildByName("TopMiddle").setMatrix(this.getChildByName("TopMiddle").getMatrix().setPosition(new i.Vector3((e.TopLeft.x+e.TopRight.x)/2,e.TopLeft.y,0))),this.getChildByName("BottomMiddle").setMatrix(this.getChildByName("BottomMiddle").getMatrix().setPosition(new i.Vector3((e.TopLeft.x+e.TopRight.x)/2,e.BottomLeft.y,0))),this.getChildByName("RightMiddle").setMatrix(this.getChildByName("RightMiddle").getMatrix().setPosition(new i.Vector3(e.TopRight.x,(e.TopRight.y+e.BottomRight.y)/2,0))),this.getChildByName("LeftMiddle").setMatrix(this.getChildByName("LeftMiddle").getMatrix().setPosition(new i.Vector3(e.TopLeft.x,(e.TopRight.y+e.BottomRight.y)/2,0)));var t=this.GetColorPropertyValue("Actor");if(this.textureMaterials)for(let e in this.textureMaterials)this.textureMaterials.hasOwnProperty(e)&&(this.textureMaterials[e].color=t.GetThreeColor(),this.textureMaterials[e].opacity=1)},UpdateCornersPropertiesAfterResize_:function(e,t){let r=e.x,a=e.y,o=Math.floor(Math.abs(r/this.GridUnit)),s=Math.floor(Math.abs(a/this.GridUnit));switch(t){case"topLeftResize":if(o)for(let e=0;e<=o;e++){let e=this.XGridListHelper.head;if(r<0){if(e+this.GridUnit>=0)break;this.XGridListHelper.shiftLine()}else this.XGridListHelper.addNewLine(e-this.GridUnit,!0)}if(s)for(let e=0;e<=s;e++){let e=this.YGridListHelper.tail;if(a<0){if(e-this.GridUnit<=0)break;this.YGridListHelper.popLine()}else this.YGridListHelper.addNewLine(e+this.GridUnit,!1)}break;case"topRightResize":if(o)for(let e=0;e<=o;e++){let e=this.XGridListHelper.tail;if(r<0){if(e-this.GridUnit<=0)break;this.XGridListHelper.popLine()}else this.XGridListHelper.addNewLine(e+this.GridUnit,!1)}if(s)for(let e=0;e<=s;e++){let e=this.YGridListHelper.tail;if(a<0){if(e-this.GridUnit<=0)break;this.YGridListHelper.popLine()}else this.YGridListHelper.addNewLine(e+this.GridUnit,!1)}break;case"bottomRightResize":if(o)for(let e=0;e<=o;e++){let e=this.XGridListHelper.tail;if(r<0){if(e-this.GridUnit<=0)break;this.XGridListHelper.popLine()}else this.XGridListHelper.addNewLine(e+this.GridUnit,!1)}if(s)for(let e=0;e<=s;e++){let e=this.YGridListHelper.head;if(a<0){if(e+this.GridUnit>=0)break;this.YGridListHelper.shiftLine()}else this.YGridListHelper.addNewLine(e-this.GridUnit,!0)}break;case"bottomLeftResize":if(o)for(let e=0;e<=o;e++){let e=this.XGridListHelper.head;if(r<0){if(e+this.GridUnit>=0)break;this.XGridListHelper.shiftLine()}else this.XGridListHelper.addNewLine(e-this.GridUnit,!0)}if(s)for(let e=0;e<=s;e++){let e=this.YGridListHelper.head;if(a<0){if(e+this.GridUnit>=0)break;this.YGridListHelper.shiftLine()}else this.YGridListHelper.addNewLine(e-this.GridUnit,!0)}}const n=Math.abs(this.XGridListHelper.tail-this.XGridListHelper.head),l=Math.abs(this.YGridListHelper.tail-this.YGridListHelper.head);let h={TopLeft:new i.Vector3(this.XGridListHelper.head,this.YGridListHelper.tail,0),TopRight:new i.Vector3(this.XGridListHelper.tail,this.YGridListHelper.tail,0),BottomLeft:new i.Vector3(this.XGridListHelper.head,this.YGridListHelper.head,0),BottomRight:new i.Vector3(this.XGridListHelper.tail,this.YGridListHelper.head,0)};this.Modifiable.OnChangeProperty("3DGrid.Corner.Top.Left",new u(h.TopLeft)),this.Modifiable.OnChangeProperty("3DGrid.Corner.Top.Right",new u(h.TopRight)),this.Modifiable.OnChangeProperty("3DGrid.Corner.Bottom.Left",new u(h.BottomLeft)),this.Modifiable.OnChangeProperty("3DGrid.Corner.Bottom.Right",new u(h.BottomRight)),this.width=n,this.height=l,this.Modifiable.OnChangeProperty("3DGrid.Width",new p(n)),this.Modifiable.OnChangeProperty("3DGrid.Height",new p(l)),this._UpdateCornersAndMiddles(h);let d={TopLeft:new i.Vector3(0,this.YGridListHelper.tail,0),TopRight:new i.Vector3(this.XGridListHelper.tail,this.YGridListHelper.tail,0),BottomLeft:new i.Vector3(0,0,0),BottomRight:new i.Vector3(this.XGridListHelper.tail,0,0)};this._UpdateTexturesNodes(d,"TopRight"),d={TopLeft:new i.Vector3(0,this.YGridListHelper.tail,0),TopRight:new i.Vector3(-this.XGridListHelper.head,this.YGridListHelper.tail,0),BottomLeft:new i.Vector3(0,0,0),BottomRight:new i.Vector3(-this.XGridListHelper.head,0,0)},this._UpdateTexturesNodes(d,"TopLeft"),d={TopLeft:new i.Vector3(0,-this.YGridListHelper.head,0),TopRight:new i.Vector3(this.XGridListHelper.tail,-this.YGridListHelper.head,0),BottomLeft:new i.Vector3(0,0,0),BottomRight:new i.Vector3(this.XGridListHelper.tail,0,0)},this._UpdateTexturesNodes(d,"BottomRight"),d={TopLeft:new i.Vector3(0,-this.YGridListHelper.head,0),TopRight:new i.Vector3(-this.XGridListHelper.head,-this.YGridListHelper.head,0),BottomLeft:new i.Vector3(0,0,0),BottomRight:new i.Vector3(-this.XGridListHelper.head,0,0)},this._UpdateTexturesNodes(d,"BottomLeft"),this._UpdatePlaneNode(h)},GetGridStep:function(){return this.CellSize},GetWorldGridNodeCorners:function(e){return{TopLeft:s.getOFromMatrix(this.GetWorldMatrix(e,"CornerTopLeft")),TopRight:s.getOFromMatrix(this.GetWorldMatrix(e,"CornerTopRight")),BottomLeft:s.getOFromMatrix(this.GetWorldMatrix(e,"CornerBottomLeft")),BottomRight:s.getOFromMatrix(this.GetWorldMatrix(e,"CornerBottomRight"))}},GetGridNodeCorners:function(){return{TopLeft:s.getOFromMatrix(this.getChildByName("CornerTopLeft").getMatrix()),TopRight:s.getOFromMatrix(this.getChildByName("CornerTopRight").getMatrix()),BottomLeft:s.getOFromMatrix(this.getChildByName("CornerBottomLeft").getMatrix()),BottomRight:s.getOFromMatrix(this.getChildByName("CornerBottomRight").getMatrix())}},UpdateCornersPropertiesAfterResize:function(e,t){let i=e.x,r=e.y,a=Math.floor(Math.abs(i/this.GridUnit)),o=Math.floor(Math.abs(r/this.GridUnit));i=a*this.GridUnit,r=o*this.GridUnit;let s={TopLeft:this.Modifiable.GetProperty("3DGrid.Corner.Top.Left").GetPropertyValue().GetValue(),TopRight:this.Modifiable.GetProperty("3DGrid.Corner.Top.Right").GetPropertyValue().GetValue(),BottomLeft:this.Modifiable.GetProperty("3DGrid.Corner.Bottom.Left").GetPropertyValue().GetValue(),BottomRight:this.Modifiable.GetProperty("3DGrid.Corner.Bottom.Right").GetPropertyValue().GetValue()};switch(t){case"topLeftResize":s.TopLeft.x=s.TopLeft.x-i,s.TopLeft.y=s.TopLeft.y+r,s.TopRight.y=s.TopRight.y+r,s.BottomLeft.x=s.BottomLeft.x-i;break;case"topRightResize":s.TopRight.x=s.TopRight.x+i,s.TopRight.y=s.TopRight.y+r,s.TopLeft.y=s.TopLeft.y+r,s.BottomRight.x=s.BottomRight.x+i;break;case"bottomLeftResize":s.BottomLeft.x=s.BottomLeft.x-i,s.BottomLeft.y=s.BottomLeft.y-r,s.TopLeft.x=s.TopLeft.x-i,s.BottomRight.y=s.BottomRight.y-r;break;case"bottomRightResize":s.BottomRight.x=s.BottomRight.x+i,s.BottomRight.y=s.BottomRight.y-r,s.TopRight.x=s.TopRight.x+i,s.BottomLeft.y=s.BottomLeft.y-r}this.Modifiable.OnChangeProperty("3DGrid.Corner.Top.Left",new u(s.TopLeft)),this.Modifiable.OnChangeProperty("3DGrid.Corner.Top.Right",new u(s.TopRight)),this.Modifiable.OnChangeProperty("3DGrid.Corner.Bottom.Left",new u(s.BottomLeft)),this.Modifiable.OnChangeProperty("3DGrid.Corner.Bottom.Right",new u(s.BottomRight));let n=Math.abs(s.TopRight.x-s.TopLeft.x),l=Math.abs(s.TopRight.y-s.BottomRight.y);this.width=n,this.height=l,this.Modifiable.OnChangeProperty("3DGrid.Width",new p(n)),this.Modifiable.OnChangeProperty("3DGrid.Height",new p(l)),this._UpdateCornersAndMiddles(s),this._UpdateTexturesNodes(s)},preRender:function(e){if(this._globalOpacity>0&&this.GridNodeHolder){if(this.Modifiable.GetObject()._plane){let o;const n=this.Modifiable.ExperienceBase.getManager("VCXPaperManager"),l=this._GetOrientedBB(e),p=l.worldMatrix,u=l.orientedBB;var t=10*n.GetPaperRatio(e,s.getOFromMatrix(p));u.localBBox.min.set(-t,-t,u.localBBox.min.z),u.localBBox.max.set(t,t,u.localBBox.max.z);var r=u.localBBox.min,a=u.localBBox.max;n.GetPaperRatio(e,s.getOFromMatrix(p));this.setMatrix(p),o=(new i.Vector3).addVectors(r,a).multiplyScalar(.5),this.GridNodeHolder.setMatrix((new i.Matrix4).setPosition(new i.Vector3(o.x,o.y,0))),this.compactMode?this.GridNodeHolder.setMatrix((new i.Matrix4).makeScale(.2,.2,1)):this.ComputeGridUnit(e.viewpoint,e.viewer)}}},GetGridDimensions:function(){return{width:this.Modifiable.GetProperty("3DGrid.Width").GetPropertyValue().GetValue(),height:this.Modifiable.GetProperty("3DGrid.Height").GetPropertyValue().GetValue()}},getActiveStatus:function(){return this._active},update:function(e){this._parent();let t=this.Modifiable.QueryInterface("VCXIVisibility"),i=!1;t&&(i=t.GetVisibility());var r=this.GetPropertyValue("3DGrid.Plane.Enable")?this.GetOpacity(e):0;if(this._globalOpacity!==r){this._globalOpacity=r;var a=this._globalOpacity>0;a&&(this.GridNodeHolder||(this._SetGridDimensions(e),this._Build(),this.SetCoordinatesLinesSnapping())),this.setVisibility(a)}if(this.GridNodeHolder){var o=this.GetPropertyValue("3DGrid.Origin.Show");this.GridNodeHolder.getChildByName("CenterNode").setVisibility(o);const e=this.GetPropertyValue("3DGrid.Active");this._active=e;let t=this.Modifiable.GetProperty("3DGrid.Width").GetPropertyValue().GetValue(),i=this.Modifiable.GetProperty("3DGrid.Height").GetPropertyValue().GetValue(),r=t-this.width,a=i-this.height;this.width=t,this.height=i,this.UpdateCornersPropertiesAfterResize_({x:r,y:a},"topRightResize")}if(!(this._globalOpacity<=0)){this._bodyMat&&(this._bodyMat.opacity=this._globalOpacity);var s=this.GetColorPropertyValue("Actor");if(this._axisMat&&(this._axisMat.color=s.GetThreeColor(),this._axisMat.opacity=1),this._bodyMat&&this._bodyMat.line&&(this._bodyMat.line.color=s.GetThreeColor(),this._bodyMat.line.opacity=1,this._bodyMat.line2.color=s.GetThreeColor(),this._bodyMat.line2.opacity=.6,this._bodyMat.color=s.GetThreeColor()),this.textureMaterials)for(let e in this.textureMaterials)this.textureMaterials.hasOwnProperty(e)&&(this.textureMaterials[e].color=s.GetThreeColor(),this.textureMaterials[e].opacity=1);this._arrowMat&&(this._arrowMat.opacity=1),this.handleLayers()}},dispose:function(){this.token&&(d.unsubscribe(this.token),delete this.token),this.tokenCoordinatesLines&&(d.unsubscribe(this.tokenCoordinatesLines),delete this.tokenCoordinatesLines),this.tokenRemoveCoordinatesLines&&(d.unsubscribe(this.tokenRemoveCoordinatesLines),delete this.tokenRemoveCoordinatesLines),this.GridNodeHolder&&(this.GridNodeHolder.removeChildren(),this.GridNodeHolder=null),this.XGridListHelper=null,this.YGridListHelper=null,this._parent()}})})),define("DS/VCXWebDressup/VCX3DGrid/VCX3DGridSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCX3DGrid/VCX3DGridNode"],(function(e,t){"use strict";return e.extend({init:function(){},getWorldMatrix:function(e){var t=this.getAnchorReferential(),i=this.QueryInterface("VCXIModifiable");return i&&(this._actorPosition=i.GetFramePropertyValue("Actor.Position"),this._actorPosition&&t.multiply(this._actorPosition)),t},buildSGNode:function(){if(!this._sgNode){var e={name:"3DGrid",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Grids.png")}return this._parent()}})})),define("DS/VCXWebDressup/VCXViewpoint/VCXBackgroundNode",["DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/VCXWebVisualization/VCXImageManager","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/VCXWebProperties/VCXColor"],(function(e,t,i,r,a,o,s){"use strict";var n=e.extend({init:function(e){return this._parent(e),this._previousBackgroundDocID=null,this},dispose:function(){this._Smart3DPaperNode&&(this._Smart3DPaperNode.dispose(),this._Smart3DPaperNode=null),this._parent()},_Build:function(){var e=this.Modifiable.ExperienceBase.getManager("VCXVisuManager");this.setRenderPasses([e.getRenderList("VCXBackground")]),this._PrimitiveGroup=new r.PrimitiveGroup;var t=new r.Buffer({component:r.VertexComponentEnum.POSITION,data:new Float32Array(12)});t.dimension=3,this._PrimitiveGroup.addBuffer(0,t);var i=new r.Buffer({component:r.VertexComponentEnum.TEX_COORD_0,data:new Float32Array(16)});i.dimension=3,this._PrimitiveGroup.addBuffer(1,i);var s,n=new r.Buffer({indexBuffer:!0,data:new Uint16Array(6)});this._PrimitiveGroup.addBuffer(2,n);var l=0;(s=t.data)[l++]=0,s[l++]=0,s[l++]=0,s[l++]=1,s[l++]=0,s[l++]=0,s[l++]=1,s[l++]=-1,s[l++]=0,s[l++]=0,s[l++]=-1,s[l++]=0;l=0;(s=i.data)[l++]=0,s[l++]=1,s[l++]=0,s[l++]=1,s[l++]=1,s[l++]=0,s[l++]=1,s[l++]=0,s[l++]=0,s[l++]=0,s[l++]=0,s[l++]=0,l=0,(s=n.data)[l++]=0,s[l++]=2,s[l++]=1,s[l++]=0,s[l++]=3,s[l++]=2;var p=new r.Primitive({nbIndices:6,connectivity:r.ConnectivityTypeEnum.TRIANGLES,fillGAS:new r.FillAttributes}),u=new r.VertexComponent({nbVertices:4,bufferId:0,indices:new r.IndexArray({bufferId:2,offset:0})}),h=new r.VertexComponent({nbVertices:4,bufferId:1,indices:new r.IndexArray({bufferId:2,offset:0})});p.addVertexComponent(u),p.addVertexComponent(h),this._PrimitiveGroup.addPrimitive(p),this._MeshNode=a.createMeshNode(this._PrimitiveGroup),this.setMaterial(),this._MeshNode.setVisibilityInTree(!1);var d={name:"BackgroundSmartNode",experience:this.ExperienceBase};this._Smart3DPaperNode=new o(d),this._Smart3DPaperNode.BillboardType=2,this._Smart3DPaperNode.SizeControlType=1,this._Smart3DPaperNode.PositioningType=1e3,this._Smart3DPaperNode.Depth=0,this._Smart3DPaperNode.add(this._MeshNode),this.add(this._Smart3DPaperNode),this.traverse((function(e,t){return e.setPickable(r.PICKTHROUGH),e.excludeFromHighlight(t,t),!1}),!0)},preRender:function(e){if(!this._parent(e))return!1;this._Smart3DPaperNode&&this._Smart3DPaperNode.preRender(e)},setMaterial:function(e){this._bodyMat||(this._bodyMat=new t.MeshBasicMaterial({side:t.FrontSide,forceSide:!0,color:"#ffffff",opacity:this.backgroundOpacity,force:!0,depthWrite:!1}),this._MeshNode&&this._MeshNode.setMaterial(this._bodyMat)),e?(this._bodyMat.map=e,this._bodyMat.needsUpdate=!0):(this._bodyMat.map=null,this._bodyMat.needsUpdate=!0)},GetVarianceNode(e){return new n({name:e.viewerID+"_"+this.name,modifiable:this.Modifiable,experience:this.ExperienceBase})},update:function(e){this._parent(e);var r=this.ExperienceBase.getManager("VCXIVManager");if(r&&r.scenario&&r.scenario.transparentBackground){var a=this.ExperienceBase.getManager("VCXVisuManager");a&&a.setTransparentBackground(!0)}else{var o=this.GetColorPropertyValue("Environment.Background"),n=this.GetColorPropertyValue("Environment.Background.Foot"),l=this.GetOpacity(e),p=this.GetPropertyValue("Environment.Background.Override"),u=this.GetPropertyValue("Environment.Background.Gradient"),h=this.GetPropertyValue("Environment.Background.Transparent"),d=this.GetPropertyValue("Environment.Background.Image");null==d&&(d=-1);l=1;if(d>=0&&p?(l=this.GetOpacity(e),o=(new s).SetRGBA(1,1,1,1),n=(new s).SetRGBA(1,1,1,1)):l=0,this.backgroundOpacity=this.GetOpacity(e),this.backgroundOpacity=o.a,this._globalOpacity!==l){this._globalOpacity=l;var c=this._globalOpacity>0;c&&(this._Smart3DPaperNode||this._Build()),this._Smart3DPaperNode&&this._Smart3DPaperNode.setVisibility(c)}if((!this._hasBeenActivated&&p||this._hasBeenActivated)&&(u!==this._previousGradient||h!==this._previousTransparent||d!==this._previousImageDocID||p!==this._previousBackgroundVisible||o&&!o.IsEqualTo(this._previousColor)||n&&!n.IsEqualTo(this._previousFootColor)||e&&e.force)){this._previousImageDocID=d,this._hasBeenActivated=!0,this._previousGradient=u,this._previousColor=o.Clone(),this._previousFootColor=n.Clone(),this._previousBackgroundVisible=p,this._previousTransparent=h;var C=o.Clone();u&&C.Lerp(n,.5);var y=this.Modifiable.ExperienceBase.getManager("VCXContextManager"),m=this;y.applyToViewers((function(e){var t=e.ambience&&e.ambience.getBackground();t&&!t._initialType&&(t._initialType=t.getType()),p?(t&&t.setActivated(!1),h?(t.setActivated(!1),e.setGrid(!1),e.setBackgroundColor("rgb(0,0,0)","0"),e._transparentBackground=!0):(e._transparentBackground&&(e.removeAmbience(),e.restoreAmbiance(),e._transparentBackground=!1),e.setBackgroundColor(C.GetHex(),m.backgroundOpacity),u&&-1===d?e.setGradientBackground([o.GetHex(),C.GetHex(),n.GetHex()]):e.setGradientBackground(null))):t&&(t.setActivated(!0),t.setType(t._initialType))}))}if(!(l<=0)&&this._MeshNode){if(this._previousBackgroundDocID!==d)if(this._previousBackgroundDocID=d,-1!==d){m=this;this.ExperienceBase.getManager("VCXImageManager").GetImageFromDocID(d,i.Effect.None).then((function(e){t.ImageUtils.loadTexture(e.toDataURL(),{},(function(e){m.setMaterial(e),m=null}))}))}else this.setMaterial();this._Smart3DPaperNode&&this._bodyMat&&(this._bodyMat.opacity=this.backgroundOpacity);var V=this.Modifiable.ExperienceBase.getManager("VCXPaperManager");if(V){var f=V.Size;this._MeshNode.setMatrix((new t.Matrix4).makeScale(f.x,f.y,1))}}}}});return n})),define("DS/VCXWebDressup/VCXViewpoint/VCXAViewpointController",["UWA/Class","DS/VCXWebVisualization/VCXIViewpointController","DS/Visualization/ThreeJS_DS","DS/Visualization/Viewpoint","DS/VCXWebTracks/VCXInterpolator","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebTracks/VCXInterpolatorLinear","DS/VCXWebTracks/VCXInterpolatorCubic","DS/VCXWebTracks/VCXInterpolatorSpherical","DS/VCXWebSystem/VCXMathTools","DS/VCXWebKernelCommands/VCXCmdChangePropertiesWithAnimation","DS/VCXWebProperties/VCXProperty","DS/VCXWebDressup/VCXAnchorServices","DS/VCXWebProperties/VCXPropertyValueFloat"],(function(e,t,i,r,a,o,s,n,l,p,u,h,d,c){"use strict";var C=e.extend({init:function(){this._parent()},GetInterpolator:function(e){if("Camera.Position"===e){if(this.shouldUseSphericalInterpolator()){var t=new l;return t.setPositionPropertyName("Actor.Anchor.1"),t.setTargetPropertyName("Actor.Anchor.2"),t.setHeightPropertyName("Camera.Height"),t.setAnglePropertyName("Camera.Angle"),t.setOrthoPropertyName("Camera.Ortho"),t}return null}if("Actor.Anchor.1"===e||"Actor.Anchor.2"===e){var i=this.GetObject()._experienceBase.getManager("VCXVisuManager"),r=this.QueryInterface("VCXIModifiable");return"Actor.Anchor.1"===e&&(i.isInTransitionMode()||r.GetPropertyValue("Camera.Arcball")&&r.GetPropertyValue("Actor.Interpolation.Type")===a.EInterpolationType.Linear)||r.GetPropertyValue("Actor.Interpolation.Type")===a.EInterpolationType.Linear?new s:new n}return null},toViewpoint:function(){if(this.GetObject()._experienceBase.getManager("VCXVisuManager").getUpdateViewport()){var e=this.GetObject()._experienceBase.getManager("VCXContextManager"),t=this.QueryInterface("VCXIModifiable");if(e&&t){const V=e.getMainViewer(),f=V&&V.currentViewpoint,b=this.GetObject()._experienceBase.ComponentsMap.GetComponentFromID("ViewpointID"),P=b&&b.QueryInterface("VCXIModifiable");if(P){C.viewpointPropertiesToCopy.forEach((e=>{var i=t.GetProperty(e);P.OnChangeProperty(e,i.GetPropertyValue().Clone())}));const e=this.getDOFInfo({viewer:V,viewpoint:f});e.actif&&P.OnChangeProperty("Camera.DOF.Distance",new c(e.focalDistance))}this.__translation||(this.__translation=new i.Vector3),this.__quaternion||(this.__quaternion=new i.Quaternion);var a=this.getMatrixAndDOI();a.matrix.decompose(this.__translation,this.__quaternion,void 0),f.moveTo({eyePosition:this.__translation,orientation:this.__quaternion,distanceToTarget:a.doi});var o=f.camera.pixelCulling;f.setProjectionType(t.GetPropertyValue("Camera.Ortho")?r.ORTHOGRAPHIC:r.PERSPECTIVE),f.setPixelCulling(o);var s=45;t.GetPropertyValue("Camera.Ortho")?a.doi&&(s=360*Math.atan(.5*t.GetPropertyValue("Camera.Height")/a.doi)/Math.PI):t.GetPropertyValue("Camera.Angle")>0&&(s=t.GetPropertyValue("Camera.Angle")),s=Math.max(.001,Math.min(s,179)),f.getAngle()!==s&&f.setAngle(s);var n=this.GetObject()._experienceBase.getManager("VCXIVManager");if(n&&n.scenario){var l=new i.Vector3(0,0,1),u=(new i.Vector3).crossVectors(l,f.getSightDirection()),h=(new i.Vector3).crossVectors(l,u),d=p.getMatrixFromOVxVy(new i.Vector3,u,h),y=e.getRootNode().getMatrix().clone().multiply(n.scenario.getInverseTranslationToCenterModelOnTable()),m=(new i.Matrix4).getInverse(y,!1);d.multiply(m),n.scenario.setTurnTableBasis(d)}}}},fromViewpoint:function(e){var t=this.GetObject()._experienceBase.getManager("VCXContextManager"),a=this.QueryInterface("VCXIModifiable");if(t&&a){const D=t.getMainViewer(),G=D&&D.currentViewpoint,x=this.GetObject()._experienceBase.ComponentsMap.GetComponentFromID("ViewpointID"),X=x&&x.QueryInterface("VCXIModifiable");if(X){C.viewpointPropertiesToCopy.forEach((t=>{var i=X.GetProperty(t);e?e.AddOrModifyProperty(i.Clone()):a.OnChangeProperty(t,i.GetPropertyValue().Clone())}));const t=x.QueryInterface("VCXIViewpointController"),i=t&&t.getDOFInfo({viewer:D,viewpoint:G});if(i.actif){var s=a.GetProperty("Camera.DOF.Distance"),n=new c(i.focalDistance);s.SetPropertyValue(n),e?e.AddOrModifyProperty(s):a.OnChangeProperty("Camera.DOF.Distance",n)}}if(G){var l=G.getEyePosition(),p=G.getTarget(),u=G.getSightDirection();u.negate();var h,d=G.getUpDirection(),y=(new i.Vector3).crossVectors(d,u),m=(new i.Matrix4).makeBasis(y,d,u).setPosition(l),V=a.GetProperty("Actor.Anchor.1"),f=this.GetObject()._experienceBase.ComponentsMap.GetComponentFromLink(V.GetPropertyValue().GetValueLink());f||(f=this.GetObject().getWorkingRootComponent()),f&&(h=f.QueryInterface("W3AISGNodeHolder").getWorldMatrix(t.getMainViewer())),h||(h=new i.Matrix4);var b=(new i.Matrix4).getInverse(h),P=(new i.Matrix4).multiplyMatrices(b,m);s=a.GetProperty("Camera.Position"),n=new o(P);s.SetPropertyValue(n),e?e.AddOrModifyProperty(s):a.OnChangeProperty("Camera.Position",n),(n=(s=a.GetProperty("Actor.Anchor.1")).GetPropertyValue()).SetValueFrame(new o(P)),s.SetPropertyValue(n),e?e.AddOrModifyProperty(s):a.OnChangeProperty("Actor.Anchor.1",n);var g=(new i.Matrix4).makeBasis(y,d,u).setPosition(p),_=(new i.Matrix4).multiplyMatrices(b,g);(n=(s=a.GetProperty("Actor.Anchor.2")).GetPropertyValue()).SetValueFrame(new o(_)),s.SetPropertyValue(n),e?e.AddOrModifyProperty(s):a.OnChangeProperty("Actor.Anchor.2",n),(n=(s=a.GetProperty("Camera.Ortho")).GetPropertyValue()).SetValue(G.getProjectionType()===r.ORTHOGRAPHIC),s.SetPropertyValue(n),e?e.AddOrModifyProperty(s):a.OnChangeProperty("Camera.Ortho",n);var M=G.getAngle();(n=(s=a.GetProperty("Camera.Angle")).GetPropertyValue()).SetValue(M),s.SetPropertyValue(n),e?e.AddOrModifyProperty(s):a.OnChangeProperty("Camera.Angle",n),M/=360/Math.PI;var S=Math.tan(M)*G.getTargetDistance();S*=2,(n=(s=a.GetProperty("Camera.Height")).GetPropertyValue()).SetValue(S),s.SetPropertyValue(n),e?e.AddOrModifyProperty(s):a.OnChangeProperty("Camera.Height",n)}}},resetMatrixAndDOI:function(){this._matrixAndDOI=null},shouldUseSphericalInterpolator:function(){var e=this.QueryInterface("VCXIModifiable");return this.GetObject()._experienceBase.getManager("VCXVisuManager").isInTransitionMode()||
/*!cameraModifiable.GetPropertyValue("Camera.Ortho") && */e.GetPropertyValue("Camera.Arcball")&&e.GetPropertyValue("Actor.Interpolation.Type")===a.EInterpolationType.Linear},getMatrixAndDOI:function(){if(this._matrixAndDOI)return this._matrixAndDOI;var e=this.QueryInterface("VCXIModifiable");if(e){var t,r=this.shouldUseSphericalInterpolator();if(r){var a=this.GetObject()._experienceBase.getManager("VCXContextManager"),o=e.GetProperty("Actor.Anchor.1"),s=this.GetObject()._experienceBase.ComponentsMap.GetComponentFromLink(o.GetPropertyValue().GetValueLink());if(s||(s=this.GetObject().getWorkingRootComponent()),s){var n=s.QueryInterface("W3AISGNodeHolder").getWorldMatrix(a.getMainViewer());n||(n=new i.Matrix4),t=n.multiply(e.GetPropertyValue("Camera.Position"))}else t=e.GetPropertyValue("Camera.Position")}else t=e.GetAnchorWorldMatrix(1,null);var l=e.GetAnchorWorldMatrix(2,null),u=(new i.Vector3).getPositionFromMatrix(l),h=(new i.Vector3).getPositionFromMatrix(t);if(e.GetPropertyValue("Camera.Ortho")){var d=e.GetPropertyValue("Camera.Height");h=new i.Vector3(0,0,d).applyMatrix4(l),t.setPosition(h)}if(!r){if(!e.GetPropertyValue("Camera.Pitch")&&!e.GetPropertyValue("Camera.Yaw")&&e.GetPropertyValue("Camera.LockDistCOI")){var c=new i.Vector3,C=new i.Vector3,y=new i.Vector3;t.extractBasis(c,C,y),t.setPosition((new i.Vector3).addVectors(u,y.multiplyScalar(Math.abs(e.GetPropertyValue("Camera.DistCOI")))))}if(!e.GetPropertyValue("Camera.Pitch")){var m=(new i.Matrix3).copy(t),V=(new i.Matrix3).getInverse(t);h=(new i.Vector3).getPositionFromMatrix(t);(f=(new i.Vector3).subVectors(u,h)).applyMatrix3(V),f.y=0,f.applyMatrix3(m),t.setPosition((new i.Vector3).subVectors(u,f))}if(!e.GetPropertyValue("Camera.Yaw")){var f;m=(new i.Matrix3).copy(t),V=(new i.Matrix3).getInverse(t),h=(new i.Vector3).getPositionFromMatrix(t);(f=(new i.Vector3).subVectors(u,h)).applyMatrix3(V),f.x=0,f.applyMatrix3(m),t.setPosition((new i.Vector3).subVectors(u,f))}h=(new i.Vector3).getPositionFromMatrix(t);if(e.GetPropertyValue("Camera.Roll")){c=new i.Vector3,C=new i.Vector3,y=new i.Vector3;if(t.extractBasis(c,C,y),(M=(new i.Vector3).subVectors(h,u)).length()){M.normalize();var b=(new i.Vector3).crossVectors(C,M).normalize(),P=(new i.Vector3).crossVectors(M,b).normalize(),g=(new i.Vector3).crossVectors(b,P).normalize(),_=(new i.Vector3).crossVectors(g,b);t.makeBasis(b,_,g).setPosition(h)}}else{var M=(new i.Vector3).subVectors(h,u);b=(new i.Vector3).crossVectors(new i.Vector3(0,0,1),M),P=new i.Vector3;0===b.length()?(b=new i.Vector3(1,0,0),P=new i.Vector3(0,1,0)):P.crossVectors(M,b);g=(new i.Vector3).crossVectors(b,P).normalize();b.normalize();_=(new i.Vector3).crossVectors(g,b);t.makeBasis(b,_,g),t.setPosition(h)}if(e.GetPropertyValue("Camera.LockDistCOI")){c=new i.Vector3,C=new i.Vector3,y=new i.Vector3;t.extractBasis(c,C,y),t.setPosition((new i.Vector3).addVectors(u,y.multiplyScalar(Math.abs(e.GetPropertyValue("Camera.DistCOI")))))}}h.getPositionFromMatrix(t);var S=h.distanceTo(u),D=p.getVzFromMatrix(t),G=(new i.Vector3).crossVectors(new i.Vector3(0,0,1),D),x=p.getVxFromMatrix(t),X=G.angleTo(x);G.cross(x).dot(D)<=0&&(X=-X);var v=45;d=100;if(e.GetPropertyValue("Camera.Ortho"))S&&(d=e.GetPropertyValue("Camera.Height"),v=360*Math.atan(.5*e.GetPropertyValue("Camera.Height")/S)/Math.PI);else v=e.GetPropertyValue("Camera.Angle"),d=Math.tan(.5*v*Math.PI/180)*S*2;return v=Math.max(.001,Math.min(v,179)),e._matrixAndDOI={matrix:t,target:u,doi:S,angle:v,height:d,roll:X},e._matrixAndDOI}},alignToObject:async function(e){var t=this.GetObject()._experienceBase,r=t.getManager("VCXContextManager").getMainViewer(),a=e.QueryInterface("W3AISGNodeHolder");if(a){var o=this.QueryInterface("VCXIModifiable");if(o){var s=a.getWorldMatrix(r).multiply((new i.Matrix4).makeRotationY(Math.PI)),n=t.ComponentsMap.GetComponentFromLink(o.GetProperty("Actor.Anchor.2").GetPropertyValue().GetValueLink());n||(n=this.GetObject().getWorkingRootComponent());var l=n.QueryInterface("W3AISGNodeHolder");if(l){var c=d.GetNewPropertyValueAnchor(l.getMatrixInLCS(r,s),n),C=.5*o.GetPropertyValue("Camera.Angle"),y=a.getPathElement().getBoundingSphere(r).radius/Math.tan(C);s.setPosition(a.getPathElement().getBoundingSphere(r).center);var m=p.getOFromMatrix(s).add(p.getVzFromMatrix(s).normalize().multiplyScalar(y)),V=s.clone().setPosition(m),f=t.ComponentsMap.GetComponentFromLink(o.GetProperty("Actor.Anchor.1").GetPropertyValue().GetValueLink());f||(f=this.GetObject().getWorkingRootComponent());var b=f.QueryInterface("W3AISGNodeHolder");if(b){var P=d.GetNewPropertyValueAnchor(b.getMatrixInLCS(r,V),f),g=new u(t);g.SetTransitionTime(1e3);var _=new h(o.GetProperty("Actor.Anchor.1").GetPropertyInfo(),P);g.ChangeProperty(o,_);_=new h(o.GetProperty("Actor.Anchor.2").GetPropertyInfo(),c);g.ChangeProperty(o,_),await t.getManager("VCXCommandManager").Push(g)}}}}},getDOFInfo:function(e,r){const a=this.QueryInterface("VCXIModifiable"),o={actif:!1};if(!a)return o;if(o.actif=a.GetPropertyValue("Camera.DOF.Actif"),o.actif){switch(a.GetPropertyValue("Camera.DOF.Type")){case t.EDOFType.Auto:o.autoFocus=!0,o.focalDistance=e.viewpoint.getTargetDistance(),o.focalPlaneCenter=e.viewpoint.getEyePosition().clone().add(e.viewpoint.getSightDirection().clone().multiplyScalar(o.focalDistance));break;case t.EDOFType.DOI:o.autoFocus=!1,o.focalDistance=r?Math.abs((new i.Vector3).subVectors(r,e.viewpoint.getEyePosition()).dot(e.viewpoint.getSightDirection())):a.GetPropertyValue("Camera.DOF.Distance"),o.focalPlaneCenter=e.viewpoint.getEyePosition().clone().add(e.viewpoint.getSightDirection().clone().multiplyScalar(o.focalDistance));break;case t.EDOFType.Follow:o.autoFocus=!1,o.focalPlaneCenter=r||p.getOFromMatrix(a.GetAnchorWorldMatrix(10,e)),o.focalPlaneCenter&&(o.focalDistance=Math.abs((new i.Vector3).subVectors(o.focalPlaneCenter,e.viewpoint.getEyePosition()).dot(e.viewpoint.getSightDirection())))}o.blur=a.GetPropertyValue("Camera.DOF.Blur"),o.aperture=this.blurToAperture(o.blur);const s=e.viewpoint.getAngle()/360*Math.PI,n=Math.tan(s),l=36;o.focalLength=.5*l/n,o.focalPlaneMatrix=o.focalPlaneCenter&&p.getMatrixFromOVzVy(o.focalPlaneCenter,e.viewpoint.getSightDirection(),e.viewpoint.getUpDirection())}return o},blurToAperture:function(e){if(!e)return C.highestFNumberConstant;const t=(e-100)/C.blurCalculationConstant;return Math.pow(Math.SQRT2,t)},apertureToBlur(e){const t=Math.log(e)/Math.log(Math.SQRT2),i=C.blurCalculationConstant*t+100;return Math.max(0,Math.min(i,C.blurMaxValue))}});return C.blurCalculationConstant=-7.692,C.highestFNumberConstant=256,C.blurMaxValue=100,C.viewpointPropertiesToCopy=["Actor.Anchor.10","Camera.DOF.Actif","Camera.DOF.Type","Camera.DOF.Blur"],C})),define("DS/VCXWebDressup/VCXViewpoint/VCXViewpointModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebVisualization/VCXIViewpointController","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebDressup/VCXViewpoint/VCXAViewpointController"],(function(e,t,i,r,a,o,s,n,l,p,u,h){"use strict";return e.extend({Dispose:function(){this._parent(),this.viewport=null},Build:function(){this._parent();var e=[{Name:"Actor.Name",Type:s,DefaultValue:"Viewpoint",i18n:p,visibleInPropertyGroups:!1},{Name:"Camera.Position",Type:o,DefaultValue:new t.Matrix4,Persistent:!1,hiddenFields:["Orientation","Scale"],GroupId:"Group.Camera",visibleInPropertyGroups:!1},{Name:"Camera.Orientation.Preset",Type:u,DefaultValue:l.EViewPosition.Front,GroupId:"Group.Camera.Orientation",MapChoice:this._generateMapChoiceFromEnumAndId(l.EViewPosition,"Camera.Orientation.Preset")},{Name:"Camera.Position.Frame",Type:n,Persistent:!1,GroupId:"Group.Camera.Orientation"},{Name:"Camera.Target.Frame",Type:n,Persistent:!1,GroupId:"Group.Camera.Orientation"},{Name:"Camera.Dolly",Type:r,Persistent:!0,GroupId:"Group.Camera.Perspective"},{Name:"Camera.Focal.Length",Type:a,GroupId:"Group.Camera.Perspective",Persistent:!1,Bounds:{Min:10,Max:600,Step:1}},{Name:"Camera.Angle",Type:a,DefaultValue:45,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.Height",Type:a,DefaultValue:400,GroupId:"Group.Camera.Perspective",Persistent:!1},{Name:"Camera.Ortho",Type:r,DefaultValue:!1,GroupId:"Group.Camera.Perspective",Persistent:!1},{Name:"Camera.Arcball",Type:r,DefaultValue:!0,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.Pitch",Type:r,DefaultValue:!0,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.Roll",Type:r,DefaultValue:!1,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.Roll.Angle",Type:a,DefaultValue:0,GroupId:"Group.Camera.Roll",Persistent:!1,Bounds:{Min:-179,Max:180,Step:1}},{Name:"Camera.Yaw",Type:r,DefaultValue:!0,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.LockDistCOI",Type:r,DefaultValue:!1,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.DistCOI",Type:a,DefaultValue:500,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.DOF.Actif",Type:r,DefaultValue:!1,ControlsGroupVisibility:!0,Persistent:!1,GroupId:"Group.Camera.DOF"},{Name:"Camera.DOF.Type",Type:u,DefaultValue:i.EDOFType.Follow,GroupId:"Group.Camera.DOF",Persistent:!1,MapChoice:this._generateMapChoiceFromEnumAndId(i.EDOFType,"Camera.DOF.Type")},{Name:"Camera.DOF.Distance",Type:a,DefaultValue:50,GroupId:"Group.Camera.DOF",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.DOF.Blur",Type:a,DefaultValue:50,GroupId:"Group.Camera.DOF",Bounds:{Min:0,Max:100,Step:1},Persistent:!1},{Name:"Camera.DOF.FocusPlane.Visible",Type:r,DefaultValue:!0,GroupId:"Group.Camera.DOF",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.DOF.FocusPlane.Opacity",Type:a,DefaultValue:.2,GroupId:"Group.Camera.DOF",Bounds:{Min:0,Max:1,Step:.1},Persistent:!1,visibleInPropertyGroups:!1},{Name:"Actor.Color",visibleInPropertyGroups:!1},{Name:"Actor.Opacity",visibleInPropertyGroups:!1},{Name:"Actor.IsAlwaysOnTop",visibleInPropertyGroups:!1}];this._BuildPropertyValues(e),this.viewport=null;let h=this.GetObject()._experienceBase.ComponentsMap.GetComponentFromType("VCXViewport_Spec");h&&h.length>0&&(this.viewport=h[0]),this.viewport},GetVirtualProperties:function(){var e={"Camera.Position":!0,"Camera.DOF.Distance":!0};return e},GetRequiredPropertiesForTransition:function(){let e=this.viewport&&this.viewport.QueryInterface("VCXIModifiable");if(e)return e.GetRequiredPropertiesForTransition();console.warn("no viewportModifiable found")},GetAnchorWorldMatrix:function(e,t){let i=this.viewport&&this.viewport.QueryInterface("VCXIModifiable");if(i)return i.GetAnchorWorldMatrix(e,t);console.warn("no viewportModifiable found")},GetPropertyValue:function(e,t){let i=this.viewport&&this.viewport.QueryInterface("VCXIModifiable");if(i)return i.GetPropertyValue(e,t);console.warn("no viewportModifiable found")},GetProperty:function(e){let t=this.viewport&&this.viewport.QueryInterface("VCXIModifiable");if(t)return t.GetProperty(e)},RequestModification:function(e,t){this._parent(e,t);let i=this.viewport&&this.viewport.QueryInterface("VCXIModifiable");if(!i)return void console.warn("no viewportModifiable found");const r=e.GetPropertyInfo().GetPropertyName();if(i.RequestModification(i.GetNewProperty(r,e.GetPropertyValue().Value),t),h.viewpointPropertiesToCopy.indexOf(r)){const i=this.GetObject()._experienceBase.getManager("VCXContextManager").getActiveCamera(),a=i&&i.QueryInterface("VCXIModifiable");a&&a.RequestModification(a.GetNewProperty(r,e.GetPropertyValue().Value),t)}},OnChangeProperty:function(e,t,i){this._parent(e,t,i);let r=this.viewport&&this.viewport.QueryInterface("VCXIModifiable");if(r)return r.OnChangeProperty(e,t,i)},OnChangePropertiesEnd:function(){this._parent();let e=this.viewport&&this.viewport.QueryInterface("VCXIModifiable");if(e)return e.OnChangePropertiesEnd();console.warn("no viewportModifiable found")},GetInterpolator:function(e){let t=this.viewport&&this.viewport.QueryInterface("VCXIModifiable");if(t)return t.GetInterpolator(e);console.warn("no viewportModifiable found")},SetPropertiesInfo:function(){this._parent();let t=this.viewport&&this.viewport.QueryInterface("VCXIModifiable");t?(this.SetPropertyInvisible("Camera.Focal.Length",t.GetPropertyValue("Camera.Ortho")),this.SetPropertyInvisible("Camera.Height",!t.GetPropertyValue("Camera.Ortho")),this.ChangeGroupAvailability("Group.Actions",e.EAvailability.AppForceNotAvailable)):console.warn("no viewportModifiable found")},GetViewpointVisibility:function(e){return!0}})})),define("DS/VCXWebDressup/VCXViewpoint/VCXViewportNode",["DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXViewpoint/VCXForegroundNode","DS/VCXWebDressup/VCXViewpoint/VCXBackgroundNode","DS/VCXWebModifiables/VCXPropertiesObserver"],(function(e,t,i,r,a){"use strict";return e.extend({init:function(t){return this._parent(t),this._foreground=new i(t),this.add(this._foreground),this._background=new r(t),this.add(this._background),this._viewpointNode=new e({name:"ViewpointCore"}),this.add(this._viewpointNode),this.lightingModeObserver=new a,this.lightingModeObserver.add(this.Modifiable,"Render.Lighting.Override"),this.lightingModeObserver.add(this.Modifiable,"Render.Lighting.Intensity"),this.lightingModeObserver.add(this.Modifiable,"Render.Lighting.Mode"),this.lightingModeObserver.add(this.Modifiable,"Render.Lighting.Static"),this},dispose:function(){this._foreground&&(this._foreground.dispose(),this._foreground=null),this._background&&(this._background.dispose(),this._background=null),this.lightingModeObserver=null,this._parent()},preRender:function(e){this._foreground.preRender(e),this._background.preRender(e),e&&e.viewpoint&&this._viewpointNode.setMatrix(e.viewpoint.camera.matrix.clone().setPosition(new t.Vector3(0,0,0)))},update:function(e){(this._parent(e),this.lightingModeObserver)&&(this.lightingModeObserver.update(),(this.lightingModeObserver.isDirty()||e&&e.force)&&(this.ExperienceBase.getManager("VCXContextManager").getContextFromName("ExperienceIn3DPlay")?this.Modifiable.GetObject().setLightingModeForComposerPlayer(this.GetPropertyValue("Render.Lighting.Override"),this.GetPropertyValue("Render.Lighting.Mode"),this.GetPropertyValue("Render.Lighting.Intensity"),this.GetPropertyValue("Render.Lighting.Static")):this.Modifiable.GetObject().setLightingMode(this.GetPropertyValue("Render.Lighting.Override"),this.GetPropertyValue("Render.Lighting.Mode"),this.GetPropertyValue("Render.Lighting.Intensity"),this.GetPropertyValue("Render.Lighting.Static"))));this._foreground.update(e),this._background.update(e)},postUpdate:function(e){this._parent(),this.lightingModeObserver&&this.lightingModeObserver.reset()},getViewpointNode:function(){return this._viewpointNode}})})),define("DS/VCXWebDressup/VCXViewpoint/VCXViewportSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXViewpoint/VCXViewportNode"],(function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Viewport",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_ViewportLeaf.png")}return this._parent()}})})),define("DS/VCXWebDressup/VCXMarkup/VCXDiggerPanelNode",["DS/CoreEvents/Events","DS/VCXWebDressup/VCXMarkup/VCXMarkup_Spec","DS/VCXWebDressup/VCXMarkup/VCXPanelNode","DS/VCXWebGUIInfra/VCXArcBar","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebKernel/VCXCmdChangeSelection","DS/WebappsUtils/WebappsUtils","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],(function(e,t,i,r,a,o,s,n){"use strict";return i.extend({init:function(e){return this._parent(e),this},dispose:function(){this.deleteDiggerPanelToolbar()},isDiggerPanel:function(e){return!!(void 0===e?this.Modifiable:e.QueryInterface("VCXIModifiable")).GetPropertyValue("Collab.AssociatedObjectID")},_Build:function(){this._parent(),this.isDiggerPanel()&&this.createDiggerPanelToolbar()},preRender:function(e){if(this._isVisible&&(this._parent(e),this.isDiggerPanel()&&this._toolbar&&this._toolbar.isVisible())){var t=this.Modifiable.QueryInterface("VCXIManipulable");t&&this._toolbar.setInManipulation(t.isManipulated());var i=this.calcToolbarInfo();this._toolbar.updateLayout(i.centerPx,i.radiusPx),this._toolbar.updateVisibilityStyle()}return!1},update:function(e){var t=this._isVisible;this._parent(e),t!==this._isVisible&&this.isDiggerPanel()&&this._toolbar&&(this._toolbar.setVisible(this._isVisible),this._toolbar.updateVisibilityStyle())},addDiggerPanelEvents:function(){this._WUXEventTokens={};var t=this,i=function(e,i){if(t._toolbar&&t._isVisible)for(var r=0;r<i.length;++r){if(i[r]===t.Modifiable.GetObject()){t._toolbar.setSelected(e),t._toolbar.updateVisibilityStyle();break}}};this._WUXEventTokens.VCX_SELECTION_ADD=e.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},(function(e){i(!0,e)})),this._WUXEventTokens.VCX_SELECTION_REMOVE=e.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},(function(e){i(!1,e)}))},removeDiggerPanelEvents:function(){for(var t in this._WUXEventTokens)this._WUXEventTokens.hasOwnProperty(t)&&this._WUXEventTokens[t]&&(e.unsubscribe(this._WUXEventTokens[t]),this._WUXEventTokens[t]=null)},calcToolbarInfo:function(){var e={},t=this.ExperienceBase.getManager("VCXPaperManager"),i=t.GetMmToPxRatio();e.radiusPx=(i*this.GetShapeInfo().size.x+32)/2+5;var r=this.GetShapeInfo().centerInPaper;e.centerPx={x:i*r.x,y:i*r.y};var a=t._ViewBoxPx;return e.centerPx.x+=a.x,e.centerPx.y+=a.y,e},createDiggerPanelToolbar:function(){if(!this._toolbar){var e=this._experienceBase.getManager("VCXContextManager");if(!e.getContextFromName("ExperienceIn3DPlay")){var t=this.calcToolbarInfo(),i=this;this._toolbar=new r({experienceBase:this._experienceBase,body:e.getUIFrame(),frmWindow:e.getFrameWindow(),title:"Digger Panel",actionBar:e.getActionBar(),heightElem:22,widthElem:22,padding:2,updateOpacity:!1,startAngle:50,clockwise:!1,center:t.centerPx,radius:t.radiusPx,lJsonElement:[{nls:n["DiggerPanel.Update"],url:s.getWebappsAssetUrl("VCXWebDressup","icons/I_VCX_DiggerPanel_Update.png"),id:"id_1",type:"element",callback:function(e){i.reliveDiggers(!0)}},{nls:n["DiggerPanel.Relive"],url:s.getWebappsAssetUrl("VCXWebDressup","icons/I_VCX_DiggerPanel_Relive.png"),id:"id_2",type:"element",callback:function(e){i.reliveDiggers(!1)}}]}),this.addDiggerPanelEvents()}}},deleteDiggerPanelToolbar:function(){this.removeDiggerPanelEvents(),this._toolbar&&(this._toolbar.clear(),this._toolbar=null)},reliveDiggers:function(e){var t=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO"),i=this.Modifiable.GetObject();t.includes(i)||t.push(i);for(var r=0;r<t.length;++r){i=t[r];if(this.isDiggerPanel(i)){var a=i.QueryInterface("W3AISGNodeHolder");if(a){var o=a.getSGNode();o&&o.reliveDigger(e,i)}}}},reliveDigger:function(e,i){var r,s=(r=void 0===i?this.Modifiable:i.QueryInterface("VCXIModifiable")).GetPropertyValue("Collab.AssociatedObjectID");if(s){var n=this._experienceBase.ComponentsMap.GetComponentFromID(s);if(n){var l=r.GetObject().QueryInterface("VCXIVisibility");l&&l.SetVisibility(a.EVisState.Hidden),!e&&this._toolbar&&this._toolbar.setVisible(!1);var p=n.QueryInterface("W3AISGNodeHolder");if(p){var u=p.getSGNode();if(u){var h=this.GetShapeInfo(),d=this.Modifiable.GetPropertyValue("Collab.Attach.Show")&&this.Modifiable.GetPropertyValue("Collab.Attach.LeadType")!==t.ELeadType.None,c=Object.keys(this.Anchors)[0],C=this.Modifiable.GetAnchorWorldMatrix(c,null);if(u.SetPropertiesFromPanel(h,d,C),e)(y=n.QueryInterface("VCXIVisibility"))&&y.SetVisibility(a.EVisState.Visible),this.ExperienceBase.webApplication.runloop.func.apply(this.ExperienceBase.webApplication.runloop.data,[{time:1,deltaTime:1}]),u.createSnapshot2D(!1),y&&y.SetVisibility(a.EVisState.Hidden)}}if(!e){var y;(y=n.QueryInterface("VCXIVisibility"))&&y.SetVisibility(a.EVisState.Visible);var m=new o(this.ExperienceBase);m.SetSelection(n),this.ExperienceBase.getManager("VCXCommandManager").Do(m)}}}},onDoubleClick:function(){this.isDiggerPanel()&&this.reliveDigger(!1)}})})),define("DS/VCXWebDressup/VCXMarkup/VCXDiggerPanelSGNodeHolder",["DS/VCXWebDressup/VCXMarkup/VCXPanelSGNodeHolder","DS/VCXWebDressup/VCXMarkup/VCXDiggerPanelNode"],(function(e,t){"use strict";return e.extend({init:function(){},unreferenceSGNode:function(){this._sgNode&&(this._sgNode.dispose(),delete this._sgNode)},buildSGNode:function(){if(!this._sgNode){var e={name:"Panel",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Image2DLeaf.png")}return this._parent()}})}));